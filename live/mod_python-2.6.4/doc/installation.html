<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">

<!-- $Id: installation.html,v 1.13 2000/10/18 20:01:29 gtrubetskoy Exp $ -->

<html>
  <head>
    <title>Installation</title>
  </head>

  <body bgcolor=white>
    <h1>Installation</h1>

<em>NOTE: By far the best place to get help with installation and other issues
is the mod_python mailing list. Please take a moment to join the
mod_python mailing list by sending an e-mail with the word "subscribe"
in the subject to <a href="mailto:mod_python-request@modpython.org">
mod_python-request@modpython.org</a>.</em>
<p>
For installation on Windows, click <a href="windows.html">here.</a>
<p>
The installation involves the following steps:

    <ul>
      <li><a href="#prerequisites">1. Prerequisites</a>
      <li><a href="#compiling">2. Compiling</a>
	<ul>
	  <li><a href="#configure">Run ./configure.</a>
	  <li><a href="#make">Run make</a>
	</ul>
      <li><a href="#install">3. Installing</a>
      <li><a href="#config">4. Configuring Apache</a>
      <li><a href="#test">5. Testing</a>
      <li><a href="#trouble">6. Troubleshooting</a>
    </ul>

    <blockquote>


      <a name="prerequisites"><h2>1. Prerequisites</h2></a>

      <ul>
	<li> Python 1.5.2 or 1.6 (2.0 reportedly works as well)
	<li> Apache 1.3 (1.3.12 or higher recommended)
      </ul>
      
      You will need to have the include files for both Apache and
      Python, as well as the Python library installed on your
      system. If you installed Python and Apache from source, then you
      have nothing to worry about. However, if you are using
      prepackaged software (e.g. Linux Red Hat RPM, Debian, or
      Solaris packages from sunsite, etc) then chances are, you just
      have the binaries and not the sources on your system. Often, the
      include files and the libraries are part of separate
      "development" package. If you are not sure whether you have all the
      necessary files, either compile and install Python and Apache
      from source, or refer to the documentation for your system on
      how to get the development packages.

      <a name="compiling"><h2>2. Compiling</h2></a>
      
      There are two ways that this module can be compiled and linked to Apache -
      <em>statically</em>, or as a <em>DSO</em> (Dynamic Shared Object). 
      <p>
	<em>Static</em> linking is a more &quot;traditional&quot; approach, and
	most programmers prefer it for its simplicity. The drawback is
	that it entails recompiling Apache, which some people cannot
	do for a variety of reasons. For example in a shared web
	hosting environment the Apache binary might not be writable by
	the user.
      <p>
	Dynamic Shared Object (<em>DSO</em>) is a newer and still somewhat 
	experimental
	approach. The module gets compiled as a library that is dynamically
	loaded by the server at run time. A more detailed description of the
	Apache DSO mechanism is available 
	<a href="http://www.apache.org/docs/dso.html">here</a>.
      <p>
	The advantage is that a module can be installed without
	recompiling Apache and used as needed. DSO has its
	disadvantages, however. Compiling a module like mod_python
	into a DSO can be a complicated process because Python, depending
	on configuration, may rely on a number of other libraries, and you
	need to make sure that the DSO is statically linked against each of
	them. Luckely, the configure script below will solve this
	headache for you by automatically figuring out all the necessary
	parameters.

	<a name="configure"><h3>Run ./configure</h3>

	  The <code>./configure</code> script will analyze your environment and
	  create custom Makefiles particular to your system. Aside from all the standard
	  autoconf stuff, <code>./configure</code> does the following:
      <ul>
	<li> Finds out whether a program called <code>apxs</code> is available. This program
	  is part of the standard Apache distribution, and is necessary for DSO
	  compilation. If <code>apxs</code> cannot be found in your PATH or in
	  <code>/usr/local/apache/bin</code>, DSO compilation will not
	  be availale.
	  <p>
	    You can manually specify the location of <code>apxs</code> by using the 
	    <code>--with-apxs</code> option, e.g.:
	  <pre>
            $ ./configure --with-apxs=/usr/local/apache/bin/apxs</pre>

	<li>Checks for <code>--with-apache</code> option. Use this option to tell
	  where the Apache sources are on your system. The Apache sources are 
	  necessary for static compilation. If you do not specify this options,
	  static compilation will not be available. Here is an example:
	  <pre>
            $ ./configure --with-apache=../src/apache_1.3.12 --with-apxs=/usr/local/apache/bin/apxs</pre>

	<li>Checks your Python version and attempt to figure out where <code>libpython</code>
	  is by looking at various parameters compiled into your Python binary. By default,
	  it will use the <code>python</code> program found in your PATH.
	  <p>
	    If the Python installation on your system is not suitable for mod_python (which
	    can be the case if Python is compiled with thread support), you can specify an 
	    alternative location with the <code>--with-python</code> options. This options
	    needs to point to the root directory of the Python <em>source</em>, e.g.:
	  <pre>
              $ ./configure --with-python=/usr/local/src/Python-1.5.2
	  </pre>
	  Note that the directory needs to contain already configured and compiled 
	  Python. In other words, you must at least run <code>./configure</code> and
	  <code>make</code>.

      </ul>

      <a name="make"><h3>Run make</h3>

      <ul>
	<li>
	If possible, the <code>./configure</code> script will default to dso compilation,
	otherwise, it will default to static. To stay with whatever <code>./configure</code>
	decided, simply run
      <pre>
          $ make
      </pre>
      Or, if you would like to be specific, give make a <Code>dso</code> or
      <code>static</code> target:
      <pre>
          $ make dso
       OR
          $ make static
      </pre>
      </ul>


      <a name="install"><h2>3. Installing</h2></a>

      <ul>
	<li>This part of the installation needs to be done as root.
	  <pre>
            $ su
            # make install
	  </pre>

	  <ul>
	    <li>For DSO, this will simply copy the library into your Apache libexec directory,
	      where all the other modules are.
	    <li>For static, it will copy some files into your Apache source tree.
	    <li>Lastly, it will install the Python libraries in <code>site-packages</code>
	      and compile them.
	  </ul>

	  </ul>

      <a name="config"><h2>4. Configuring Apache</h2></a>

      <ul>
	    
	<li> To configure Apache for mod_python:
	  <p>

	  <ul>
	    <li>
	  If you compiled mod_python as a DSO, you will need to
	  tell Apache to load the module by adding the following line in
	  the Apache configuration file, usually called
	  <code>httpd.conf</code> or <code> apache.conf</code>:
	  <pre>
      LoadModule python_module libexec/mod_python.so</pre>
	      The actual path to <code>mod_python.so</code> may vary, but
	      <code>make install</code> should report at the very end exactly where
	      <code>mod_python.so</code> was placed and how the 
	      <code>LoadModule</code> directive should appear. 

	  <p>
	    If your Apache configuration uses
	    <code>ClearModuleList</code> directive, you will need to add
	    mod_python to the module list in the Apache configuration file:
	  <pre>
      AddModule mod_python.c</pre>

	  NB: Some (not all) RedHat Linux users reported that mod_python needs to be first
	  in the module list, or Apache will crash.
	  <p>
	  <li>

	  If you used the static installation, you now need to recompile Apache:
	  <pre>
            $ cd ../src/apache_1.3.12
            $ ./configure --activate-module=src/modules/python/libpython.a
            $ make
          </pre>
	  Or, if you prefer the old &quot;Configure&quot; style, edit 
	  <code>src/Configuration</code> to have
	  <pre>
            AddModule modules/python/libpython.a"
	  </pre>
	  then run
	  <pre>
            $ cd src
            $ ./Configure
            $ make
	  </pre>

	  </ul>
      </ul>


      <a name="test"><h2>5. Testing</h2></a>

      <ul>
	<li> Make some directory that would be visible on your website, for 
	  example, <code>htdocs/test</code>.

	  <p>
	<li> Add the following Apache directives, which can appear in either the 
	  main server configuration file, or <code>.htaccess</code>. If you
	are going to be using the <code>.htaccess</code> file, you will not
	  need the &lt;Directory&gt; tag below, and you will need to make
	sure the <code>AllowOverride</code> directive applicable to this
	directory has at least <code>FileInfo</code> specified.  The
	default is <code>None</code>, which will not work.

	  <pre>
      &lt;Directory /some/directory/htdocs/test&gt;
          AddHandler python-program .py
          PythonHandler mptest
          PythonDebug On
      &lt;/Directory&gt;</pre>
	  (Substitute /some/directory above for somethng applicable to your system,
           usually your Apache server root)

	  <p>
	<li> At this time, if you made changes to the main configuration file, 
	  you will need to restart Apache in order for the changes to take effect.

	  <p>
	<li> Edit <code>mptest.py</code> file in the <code>htdocs/test</code> 
	  directory so that is has the following lines <em>(Be careful when
	    cutting and pasting from your browser, you may end up with incorrect
	    indentation and a syntax error)</em>:
	  <pre>
      from mod_python import apache

      def handler(req):
          req.send_http_header()
          req.write("Hello World!")
          return apache.OK </pre>

	<li> Point your browser to the URL referring to the mptest.py, you should
	  see "Hellow World!". If you didn't - refer to the troubleshooting step
	  next.
      </ul>

      If everything worked well, move on to the <a href="tutorial.html">tutorial</a>.
      
      <a name="trouble"><h2>6. Troubleshooting</h2></a>

      There are a couple things you can try to identify the problem:

      <ul>
	<li> Carefully study the error output, if any.
	<li> Check the error_log file, it may contain useful clues.
	<li> Try running Apache from the command line with an -X argument:
	  <pre>
      ./httpd -X</pre>
	  This prevents it from backgrounding itself and may provide some useful
	  information.
	<li> Ask on the mod_python list. Make sure to provide 
	  specifics such as:<br>
	  . Your operating system type, name and version.<br>
	  . Your Python version, and any unusual compilation options.<br>
	  . Your Apache version.<br>
	  . Relevant parts of the Apache config, .htaccess.<br>
	  . Relevant parts of the Python code.<br>
      </ul>
	  
	

    </blockquote>


      </pre>
    </blockquote>

    <hr>
<!-- Created: Wed May 10 09:06:54 EDT 2000 -->
<!-- hhmts start -->
Last modified: Wed Oct 18 12:07:07 EDT 2000
<!-- hhmts end -->
  </body>
</html>
