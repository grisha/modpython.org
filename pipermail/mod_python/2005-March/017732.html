<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Re: some questions about using mod_python
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Re%3A%20some%20questions%20about%20using%20mod_python&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017736.html">
   <LINK REL="Next"  HREF="017733.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Re: some questions about using mod_python</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Re%3A%20some%20questions%20about%20using%20mod_python&In-Reply-To="
       TITLE="[mod_python] Re: some questions about using mod_python">grahamd at dscpl.com.au
       </A><BR>
    <I>Sun Mar 20 19:39:54 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="017736.html">[mod_python] Re: some questions about using mod_python
</A></li>
        <LI>Next message: <A HREF="017733.html">[mod_python] Re: Re: some questions about using mod_python
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17732">[ date ]</a>
              <a href="thread.html#17732">[ thread ]</a>
              <a href="subject.html#17732">[ subject ]</a>
              <a href="author.html#17732">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>vegetax wrote ..
&gt;<i> Graham Dumpleton wrote:
</I>&gt;<i> 
</I>&gt;<i> &gt;&gt; - Where do i set a database connection pool to load at server
</I>&gt;<i> &gt;&gt; initialization ,so that all request can access it? is the pythonImport
</I>&gt;<i> &gt;&gt; directive the best place? where do i set a clean up function for the
</I>&gt;<i> &gt;&gt; pool
</I>&gt;<i> &gt;&gt; at server finalization ?
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Cleanup function registration for stuff that should be done at time of
</I>&gt;<i> &gt; child
</I>&gt;<i> &gt; termination can only be done with req.server.register_cleanup(). There
</I>&gt;<i> &gt; probably should be an apache.register_cleanup() method which would be
</I>&gt;<i> &gt; available from a module imported using PythonImport. This would then
</I>&gt;<i> be
</I>&gt;<i> &gt; the
</I>&gt;<i> &gt; best way of doing it.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; It seems that the best one could do now is import the module when
</I>&gt;<i> &gt; required
</I>&gt;<i> &gt; but don't do anything at the time of import which would require a
</I>&gt;<i> &gt; cleanup
</I>&gt;<i> &gt; function to be registered. Then, when the first handler calls in to the
</I>&gt;<i> &gt; actual module, require that the &quot;req&quot; object be passed into the pool,
</I>&gt;<i> &gt; with
</I>&gt;<i> &gt; those resources which need to be cleaned up later being created then
</I>&gt;<i> &gt; with a
</I>&gt;<i> &gt; cleanup function being registered through req.server.register_cleanup().
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; I have added a bug report suggesting that apache.register_cleanup() be
</I>&gt;<i> &gt; added to allow it to be used from module imported using PythonImport.
</I>&gt;<i> 
</I>&gt;<i> But is to problematic to clean resources at request level, i think in the
</I>&gt;<i> midtime i will be cleaning up resources like connections with an external
</I>&gt;<i> script which i run after apache exits.
</I>
I perhaps didn't explain it properly or I don't understand what you are
saying.

&gt;<i>From a request object there are two ways of registering a cleanup
</I>function. The first is:

  req.register_cleanup()

The register function in this case will be called when the handler for
that specific request is finished.

The other which I referenced was:

  req.server.register_cleanup()

This registers a function which will only be called when the Apache
process itself terminates. Ie., when one does apachectl stop or
restart.

Thus, wasn't talking about cleaning up resources at request level.
The unfortunate bit was that since apache.register_cleanup() doesn't
exist, one has to defer registration of cleanup function for process
termination until one has access to req.server, which is at point of
first request that needs pool.

&gt;<i> &gt; FWIW, in Vampire, when Vampire's module importing mechanism is used a
</I>&gt;<i> &gt; stripped down request object is available in the set of global variables
</I>&gt;<i> &gt; during import as __req__. Thus in Vampire one could actually register
</I>&gt;<i> &gt; a cleanup function during import by using:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt;    __req__.server.register_cleanup(....)
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; This would save each handler having to pass the req object into a pool
</I>&gt;<i> &gt; and
</I>&gt;<i> &gt; means one wouldn't have to delay creation of resources which needed the
</I>&gt;<i> &gt; cleanup function to be registered.
</I>&gt;<i> 
</I>&gt;<i> Looks like a good solution when the clean up is needed per request,and
</I>&gt;<i> is
</I>&gt;<i> also posible that the pool component was made by someone else,and cant
</I>&gt;<i> take
</I>&gt;<i> req as parameter.
</I>
Again, not talking per request here as am registering cleanup handler
via the server object and not the actual request object.

&gt;<i> &gt; BTW, have you considered other page templating solutions besides PSP?
</I>&gt;<i> &gt; In terms
</I>&gt;<i> &gt; of best separation between model, view and controller, or at least
</I>&gt;<i> &gt; between the
</I>&gt;<i> &gt; HTML that represents a page and the code that populates it, I would
</I>&gt;<i> &gt; recommend
</I>&gt;<i> &gt; using HTMLTemplate.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt;    <A HREF="http://freespace.virgin.net/hamish.sanderson/htmltemplate.html">http://freespace.virgin.net/hamish.sanderson/htmltemplate.html</A>
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Why I prefer it over PSP is that in PSP you are effectively still
</I>&gt;<i> &gt; embedding
</I>&gt;<i> &gt; Python code in the template itself and to render the template you are
</I>&gt;<i> &gt; actually
</I>&gt;<i> &gt; executing it, with there being call outs from the template to collect
</I>&gt;<i> &gt; data.
</I>&gt;<i> &gt; In HTMLTemplate, the template object is distinct, with your controller
</I>&gt;<i> &gt; code
</I>&gt;<i> &gt; making calls into the template object when desired to set fields within
</I>&gt;<i> &gt; it.
</I>&gt;<i> &gt; Ie., DOM like but not having the overhead of a DOM because only
</I>&gt;<i> &gt; fillable parts
</I>&gt;<i> &gt; of the template are indexed.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; What this means is that with HTMLTemplate you aren't forced to prepare
</I>&gt;<i> &gt; all your
</I>&gt;<i> &gt; data up front before filling in the template, instead you can fill it
</I>&gt;<i> &gt; in bit
</I>&gt;<i> &gt; by bit.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; I can supply references to example of using HTMLTemplate from Vampire
</I>&gt;<i> &gt; later if
</I>&gt;<i> &gt; you are interested.
</I>&gt;<i> &gt; Graham
</I>&gt;<i> 
</I>&gt;<i> Thanks for the advice graham,but i dont share the philosophy kind of those
</I>&gt;<i> templates engines, first and last it uses its own tag language, i HATE
</I>&gt;<i> that.
</I>
Huh. PSP also defines its own language within HTML so I don't really
see the difference. I personally find the PSP syntax more confusing,
more complicated and more error prone especially if embedding actual
Python code. Please don't confuse HTMLTemplate with systems like
TAL and Metal. It is different and much simpler, with the manner in
which pages are constructed and then rendered being different as well.

&gt;<i> I like psp because it lets you embed python code, so that i can
</I>&gt;<i> generate complex dynamic views,but the code inside the psp is only for
</I>&gt;<i> content displaying, 100% of the form processing is done by the controler
</I>&gt;<i> calling domain object's methods! in extremely exceptional situations the
</I>&gt;<i> psp code will have a litle processing or data gathering, but those are
</I>&gt;<i> only
</I>&gt;<i> exceptions, the key here is that the team respect the rules.
</I>&gt;<i> 
</I>&gt;<i> I work with web designers,you simply cant let them touch the dynamic
</I>&gt;<i> parts,those parts tend to be complex,they should work in the static parts
</I>&gt;<i> and coordinate with the programmer in charge of the dynamic view
</I>&gt;<i> generation,and then plug dynamic and static parts together, in order to
</I>&gt;<i> coordinate they MUST have some programming knowledge ,anyway i use
</I>&gt;<i> javascript a lot and i dont take a person who doesnt know javascript as
</I>&gt;<i> a
</I>&gt;<i> web designer.Thats my point of view.
</I>
When using HTMLTemplate the web designers don't need to touch
any Python code at all and thus don't go anywhere near the controller
aspects of the application. Because HTMLTemplate is standard XHTML
the web designer can even use high level web design tools. All they
need to do is add the appropriate namespace designated attributes
in the XHTML as per Python coders directions as to what data will be
filled in. The web designer can even put in dummy data in the template
as place holders so the pages look correct for some set of data when
they are designing it, with the dummy content being replaced by the
controller code when it runs.

Anyway, there is probably no point continuing this particular discussion.
As I always find it is always very hard to get someone else to see what
you can see, especially when one is using a different framework to
bring all the bits together. :-(

Graham
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017736.html">[mod_python] Re: some questions about using mod_python
</A></li>
	<LI>Next message: <A HREF="017733.html">[mod_python] Re: Re: some questions about using mod_python
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17732">[ date ]</a>
              <a href="thread.html#17732">[ thread ]</a>
              <a href="subject.html#17732">[ subject ]</a>
              <a href="author.html#17732">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
