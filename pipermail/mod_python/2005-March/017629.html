<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] OS X / Apache 2 / mod_python bug
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20OS%20X%20/%20Apache%202%20/%20mod_python%20bug&In-Reply-To=3CC55788-3F95-43DB-B05C-BD07CB1805C4%40kirkconsulting.co.uk">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017628.html">
   <LINK REL="Next"  HREF="017631.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] OS X / Apache 2 / mod_python bug</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20OS%20X%20/%20Apache%202%20/%20mod_python%20bug&In-Reply-To=3CC55788-3F95-43DB-B05C-BD07CB1805C4%40kirkconsulting.co.uk"
       TITLE="[mod_python] OS X / Apache 2 / mod_python bug">grahamd at dscpl.com.au
       </A><BR>
    <I>Sun Mar 13 16:06:13 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="017628.html">[mod_python] OS X / Apache 2 / mod_python bug
</A></li>
        <LI>Next message: <A HREF="017631.html">[mod_python] OS X / Apache 2 / mod_python bug
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17629">[ date ]</a>
              <a href="thread.html#17629">[ thread ]</a>
              <a href="subject.html#17629">[ subject ]</a>
              <a href="author.html#17629">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Just want to confirm a few things. Please try and answer all the
questions even if you think the answer should be obvious. Something
in your response might indicate something to someone.

On Sunday, March 13, 2005, at 10:39  PM, Jamie Kirkpatrick wrote:

&gt;<i> The bug I have discovered basically boils down to a tiny thing that is 
</I>&gt;<i> not an easy thing to discover.  If you use `apachectl restart` to 
</I>&gt;<i> control the execution of Apache with mod_python installed on OS X 
</I>&gt;<i> (server at least, I didnt try the client version but I imagine it will 
</I>&gt;<i> be the same), you will find mod_python ceases to function, producing a 
</I>&gt;<i> 500 error from apache.
</I>
A 500 error is something that would be returned for a request from
a client. This therefore suggests that the restart appears to work
but then upon receiving a request it delivers up a 500 error to the
client. Is this what you mean?

Does every request against the server result in 500 being returned,
or only requests which fall under the control of mod_python?

Does running &quot;apachectl configtest&quot; yield any sort of error or warning
message?

If there is some sort of configuration error in the main Apache config
file, this would usually be displayed on restart/start but can also be
seen by running configtest.

If a configuration error appears in a .htaccess file however, you only
know because the client will receive a 500 error when making a request
against a directory controlled by that .htaccess file. From what I have
seen, nothing normally gets logged in this case.

That said, have you setup use of Apache in the main configuration file
or in a .htaccess file? Can you post what configuration you are using
so we can see if it is pretty normal or something strange? Post it if
you can.

Do you get these 500 errors if the only mod_python application 
configured
is a really basic &quot;mptest&quot; type test handler, or does it only happen
when you go to set it up for this more complicated application?

What parts of mod_python does this more complicated application use?
does it use mod_python.psp, or mod_python.publisher? Does it make use of
cookies or session support in mod_python?

Apart from configuration problems, 500 errors can be raised from within
your code itself, so knowing whether your code is dependent on certain
packages may be important. Also knowing if it uses sessions may also be
useful, as it may be some sort of corruption in the session database.

In both cases when you use restart/start, does the Apache log file 
clearly
show mod_python being loaded and initialised?

&gt;<i> As I say , this is not an easy bug to discover, since you never expect 
</I>&gt;<i> there to be a difference in the way  a module behaves due to such an 
</I>&gt;<i> obscure thing.  I can confirm that this happens on OS X Server 
</I>&gt;<i> 10.3.6-8 with various different builds of apache2.  I used the stock 
</I>&gt;<i> build, a custom built version (from the latest sources) and one from 
</I>&gt;<i> dports with the same results.  I also tried different versions of 
</I>&gt;<i> python (The stock 2.3 Framework, 2.4 built as a framework, 2.4 normal, 
</I>&gt;<i> 2.3 normal....) as I had read on these lists that there are some 
</I>&gt;<i> oddities in this area on OS X.    Same results.  Just as I was 
</I>&gt;<i> beginning to give up completely I worked out what was going on. :p
</I>
When you used stock Python 2.3 supplied by Apple, did you have the 
patches
applied which were mentioned in previous email? Without this patch, the
Apache child process would have crashed the first time it received a 
request
for mod_python. I don't recollect whether the client would have seen a 
500
error or not, but that the process crashed is evident in the Apache log 
file.

&gt;<i> I really hope however that my findings can be investigated further so 
</I>&gt;<i> that the bug can be resolved and a fix can be rolled into the trunk.
</I>&gt;<i>
</I>&gt;<i> I am happy to do any further testing if a patch is added by anyone.  I 
</I>&gt;<i> would like to try myself, but I just don't have the time to get 
</I>&gt;<i> further into this stuff.
</I>
Answering the above questions would be a good first step to knowing a 
bit more
about your circumstances. A few other things that may prove useful are 
listed
below.

Are you using Apache in &quot;prefork&quot; mode? Did you ever compile it up in 
&quot;worker&quot;
mode with threading to see if it made a difference? If using &quot;worker&quot; 
did you
restrict it to one process with many threads? Doing this would cause 
session
database to go from being disked based to memory based. Did you try 
removing
the session database from /tmp.

Anyway, if you are prepared to go to a bit of effort to answer each 
question we
can see if we can sort this out.

Graham

</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017628.html">[mod_python] OS X / Apache 2 / mod_python bug
</A></li>
	<LI>Next message: <A HREF="017631.html">[mod_python] OS X / Apache 2 / mod_python bug
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17629">[ date ]</a>
              <a href="thread.html#17629">[ thread ]</a>
              <a href="subject.html#17629">[ subject ]</a>
              <a href="author.html#17629">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
