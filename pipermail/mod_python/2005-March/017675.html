<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] OS X / Apache 2 / mod_python bug
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20OS%20X%20/%20Apache%202%20/%20mod_python%20bug&In-Reply-To=1D262F53-1919-4AA2-8AE9-5213E5C414A2%40kirkconsulting.co.uk">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017672.html">
   <LINK REL="Next"  HREF="017676.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] OS X / Apache 2 / mod_python bug</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20OS%20X%20/%20Apache%202%20/%20mod_python%20bug&In-Reply-To=1D262F53-1919-4AA2-8AE9-5213E5C414A2%40kirkconsulting.co.uk"
       TITLE="[mod_python] OS X / Apache 2 / mod_python bug">grahamd at dscpl.com.au
       </A><BR>
    <I>Wed Mar 16 16:20:30 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="017672.html">[mod_python] OS X / Apache 2 / mod_python bug
</A></li>
        <LI>Next message: <A HREF="017676.html">[mod_python] OS X / Apache 2 / mod_python bug
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17675">[ date ]</a>
              <a href="thread.html#17675">[ thread ]</a>
              <a href="subject.html#17675">[ subject ]</a>
              <a href="author.html#17675">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On 17/03/2005, at 6:03 AM, Jamie Kirkpatrick wrote:

&gt;<i>
</I>&gt;<i> On 16 Mar 2005, at 10:05, Graham Dumpleton wrote:
</I>&gt;&gt;<i> BTW, can you confirm that you have the Mac OS X fix for Python 2.3  
</I>&gt;&gt;<i> (standard)
</I>&gt;&gt;<i> that I have previously mentioned. If you have applied the patch, in  
</I>&gt;&gt;<i> python_init()
</I>&gt;&gt;<i> there will be:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     /* initialize global Python interpreter if necessary */
</I>&gt;&gt;<i>     if (initialized == 0 || ! Py_IsInitialized())
</I>&gt;&gt;<i>     {
</I>&gt;&gt;<i>         initialized = 1;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> where as unpatched mod_python has:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     /* initialize global Python interpreter if necessary */
</I>&gt;&gt;<i>     if (! Py_IsInitialized())
</I>&gt;&gt;<i>     {
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I'm unpatched...I tried first by making the alteration to the logging  
</I>&gt;<i> of name and including the other logging statement shown below.
</I>&gt;<i>
</I>&gt;<i> &lt;snip&gt;
</I>&gt;<i>
</I>&gt;&gt;<i> /* initialize global Python interpreter if necessary */
</I>&gt;&gt;<i>     if (! Py_IsInitialized())
</I>&gt;&gt;<i>     {
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>        ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, srv,
</I>&gt;&gt;<i>              &quot;Performing Initialisation.&quot;);
</I>&gt;<i>
</I>&gt;<i> So, after a normal start error log shows:
</I>&gt;<i>
</I>&gt;<i> [Wed Mar 16 11:03:43 2005] [notice] mod_python: Creating 32 session  
</I>&gt;<i> mutexes based on 150 max processes and 0 max threads.
</I>&gt;<i> [Wed Mar 16 11:03:43 2005] [error] Performing Initialisation.
</I>&gt;<i> [Wed Mar 16 11:03:43 2005] [notice] Digest: generating secret for  
</I>&gt;<i> digest authentication ...
</I>&gt;<i> [Wed Mar 16 11:03:43 2005] [notice] Digest: done
</I>&gt;<i> [Wed Mar 16 11:03:44 2005] [notice] Apache/2.0.53 (Unix) DAV/2  
</I>&gt;<i> mod_python/3.1.3 Python/2.4 configured -- resuming normal operations
</I>&gt;<i>
</I>&gt;<i> Then I call the test script:
</I>&gt;<i>
</I>&gt;<i> [Wed Mar 16 11:04:52 2005] [error] The name passed was:
</I>&gt;<i> [Wed Mar 16 11:04:52 2005] [error] thegrove.homeip.net
</I>&gt;<i> [Wed Mar 16 11:04:53 2005] [notice] mod_python: (Re)importing module  
</I>&gt;<i> 'test'
</I>&gt;<i> [Wed Mar 16 11:04:53 2005] [error] start import
</I>&gt;<i> [Wed Mar 16 11:04:53 2005] [error] end import
</I>&gt;<i> [Wed Mar 16 11:04:53 2005] [error] start handler
</I>&gt;<i> [Wed Mar 16 11:04:53 2005] [error] end handler
</I>&gt;<i> [Wed Mar 16 11:04:53 2005] [error] Name was NULL.
</I>&gt;<i>
</I>&gt;<i> Cool - fixed that crash (my fault!), but it still puzzles me why the  
</I>&gt;<i> handler gets called again here.
</I>
Am not sure which part of the logs you are referring to, I only see
the handler itself being called once.

&gt;<i> Now a restart - the following is added to the logs:
</I>&gt;<i>
</I>&gt;<i> [Wed Mar 16 11:06:01 2005] [error] Name was NULL.
</I>&gt;<i> [Wed Mar 16 11:06:01 2005] [error] Name was NULL.
</I>&gt;<i> [Wed Mar 16 11:06:01 2005] [error] Name was NULL.
</I>&gt;<i> [Wed Mar 16 11:06:01 2005] [error] Name was NULL.
</I>&gt;<i> [Wed Mar 16 11:06:01 2005] [error] Name was NULL.
</I>&gt;<i> [Wed Mar 16 11:06:01 2005] [error] Name was NULL.
</I>&gt;<i> [Wed Mar 16 11:06:07 2005] [notice] SIGHUP received.  Attempting to  
</I>&gt;<i> restart
</I>&gt;<i> [Wed Mar 16 11:06:07 2005] [notice] mod_python: Creating 32 session  
</I>&gt;<i> mutexes based on 150 max processes and 0 max threads.
</I>&gt;<i> [Wed Mar 16 11:06:07 2005] [notice] Digest: generating secret for  
</I>&gt;<i> digest authentication ...
</I>&gt;<i> [Wed Mar 16 11:06:07 2005] [notice] Digest: done
</I>&gt;<i> [Wed Mar 16 11:06:08 2005] [notice] Apache/2.0.53 (Unix) DAV/2  
</I>&gt;<i> mod_python/3.1.3 Python/2.4 configured -- resuming normal operations
</I>&gt;<i>
</I>&gt;<i> Again I have multiple instances of httpd running now ... is this  
</I>&gt;<i> normal?
</I>
The lookup of interpreters by NULL is something to do with the
cleanup handlers for the interpreter. Not sure why NULL though.
Can't tell here whether they are in separate processes or not.
Are you using &quot;ps&quot; to note there are multiple processes running.
Because your Apache is running in prefork mode, it is normal for
it to create multiple processes even if not all may be used in
your simple test.

&gt;<i> Now to make the call again:
</I>&gt;<i>
</I>&gt;<i> [Wed Mar 16 11:08:09 2005] [error] The name passed was:
</I>&gt;<i> [Wed Mar 16 11:08:09 2005] [error] thegrove.homeip.net
</I>&gt;<i> [Wed Mar 16 11:08:09 2005] [error] python_handler: interpreters  
</I>&gt;<i> dictionary not initialised.
</I>&gt;<i>
</I>&gt;<i> Same results as before - at least we eliminated the crash i  
</I>&gt;<i> introduced!  Next I tried compiling again with the os x patch started  
</I>&gt;<i> normal and pulled up the page - this yields the same log as what i  
</I>&gt;<i> have posted above.  Now the restart - again, the same logs as i posted  
</I>&gt;<i> above, and pulling up the page works!
</I>&gt;<i>
</I>&gt;<i> So, basically, it seems that I have been unfortunate enough not to  
</I>&gt;<i> have stumbled on your patch when I was working on this.  Is there any  
</I>&gt;<i> reason it hasn't been rolled into the main trunk yet?  A few #IFDEF  
</I>&gt;<i> DARWIN or suchlike could surely allow the inclusion of such a patch.   
</I>&gt;<i> I will take the immediate measure of posting my findings to the  
</I>&gt;<i> darwinports mailing lists in order to make them aware of the issue and  
</I>&gt;<i> the fix.  I have to say, that from the point of view of an OS X user  
</I>&gt;<i> it would be useful to at least mention the patch in one of the docs in  
</I>&gt;<i> the main disto.  I appologise for seemingly wasting your time, but I  
</I>&gt;<i> honestly spent days on this and never stumbled on that patch - the  
</I>&gt;<i> only patches I saw were for the Makefile's.
</I>&gt;<i>
</I>&gt;<i> Many thanks for all your time and effort - it has been educational for  
</I>&gt;<i> me at least!  I would like to hear whether or not this patch will in  
</I>&gt;<i> some way be added to the main release anyway.
</I>
I understand the patch is in the subversion repository for the  
mod_python
source code:

    
<A HREF="https://svn.apache.org/repos/asf/httpd/mod_python/trunk/src/">https://svn.apache.org/repos/asf/httpd/mod_python/trunk/src/</A> 
mod_python.c

The original person who developed mod_python doesn't really look after  
it
anymore and maintenance has been taken over by someone else. He has been
slowly working through fixing some of the known problems and simply  
hasn't
made an updated release yet. The security fix release done recently was  
a
rush job based on source of previous version. Because there is this
transition to a new maintainer, updating of the web site is also in a  
state
of flux to a degree.

I possibly should point out that although I try and provide help to  
people
on the mailing list, I am not involved in the maintenance of mod_python
itself except as far as I have posted up a lot of bug reports for stuff  
I've
found and possible fixes. I have only been using mod_python for about  
six
months and wasn't intending to get so involved in it nor develop  
Vampire.
I was only after an easier way to construct web pages for my site. I  
really
need to be getting back to my main projects which have been stagnating  
while
on this diversion. :-(

Anyway, outcome from your problem is that I now know that the Mac OS X  
fix
is relevant to the platform generally and not just Apples Python 2.3
installation. Another bit of useful information to help people out.

Graham

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017672.html">[mod_python] OS X / Apache 2 / mod_python bug
</A></li>
	<LI>Next message: <A HREF="017676.html">[mod_python] OS X / Apache 2 / mod_python bug
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17675">[ date ]</a>
              <a href="thread.html#17675">[ thread ]</a>
              <a href="subject.html#17675">[ subject ]</a>
              <a href="author.html#17675">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
