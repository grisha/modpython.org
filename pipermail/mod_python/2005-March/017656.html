<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] OS X / Apache 2 / mod_python bug
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20OS%20X%20/%20Apache%202%20/%20mod_python%20bug&In-Reply-To=21B3AD9A-947A-11D9-93F3-000393BB31F6%40dscpl.com.au">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017632.html">
   <LINK REL="Next"  HREF="017657.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] OS X / Apache 2 / mod_python bug</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Jamie Kirkpatrick</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20OS%20X%20/%20Apache%202%20/%20mod_python%20bug&In-Reply-To=21B3AD9A-947A-11D9-93F3-000393BB31F6%40dscpl.com.au"
       TITLE="[mod_python] OS X / Apache 2 / mod_python bug">jkp at kirkconsulting.co.uk
       </A><BR>
    <I>Tue Mar 15 14:12:37 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="017632.html">[mod_python] OS X / Apache 2 / mod_python bug
</A></li>
        <LI>Next message: <A HREF="017657.html">[mod_python] OS X / Apache 2 / mod_python bug
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17656">[ date ]</a>
              <a href="thread.html#17656">[ thread ]</a>
              <a href="subject.html#17656">[ subject ]</a>
              <a href="author.html#17656">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I just throught I'd drop a line to say that I'm not the only one who 
has had this issue.  A fellow OS X user who is actually the author of 
the python package i wanted to install (trac) has the same issue - it's 
a shame he didnt understand fully what I was seeing as he could have 
saved me days of hassle!

This should get nailed if possible.

Jamie

On 14 Mar 2005, at 11:13, Graham Dumpleton wrote:

&gt;<i>
</I>&gt;<i> On Monday, March 14, 2005, at 08:07  PM, Jamie Kirkpatrick wrote:
</I>&gt;&gt;<i> That said, have you setup use of Apache in the main configuration 
</I>&gt;&gt;<i> file
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> or in a .htaccess file? Can you post what configuration you are using
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> so we can see if it is pretty normal or something strange? Post it if
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> you can.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I can post but its rather long - I am pretty darn confident that 
</I>&gt;&gt;<i> there is nothing wrong with the config tho.  I havent changed barely 
</I>&gt;&gt;<i> anything from the stock install, in-fact, I can reproduce the error 
</I>&gt;&gt;<i> by leaving everything as is from when the install is performed and 
</I>&gt;&gt;<i> only adding a python handler to the default htdocs directory.  The 
</I>&gt;&gt;<i> only thing I have consistently changed is the port the server is 
</I>&gt;&gt;<i> listening on to port 8080.  I have tested with the minimum of 
</I>&gt;&gt;<i> changes: added a handler and dropped in a small test script.
</I>&gt;<i>
</I>&gt;<i> The whole Apache config file isn't required, but just the small 
</I>&gt;<i> section where
</I>&gt;<i> your define SetHandler/AddHandler and PythonHandler. Ie., the 
</I>&gt;<i> appropriate
</I>&gt;<i> &lt;Directory&gt; construct covering your htdocs directory. This is just to 
</I>&gt;<i> get the
</I>&gt;<i> whole picture and clarify that it is being done within a Directory 
</I>&gt;<i> directive
</I>&gt;<i> as opposed to being at global scope in the config.
</I>&gt;<i>
</I>&gt;&gt;<i> Do you get these 500 errors if the only mod_python application 
</I>&gt;&gt;<i> configured
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> is a really basic &quot;mptest&quot; type test handler, or does it only happen
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> when you go to set it up for this more complicated application?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I used the hello.py example from the site and consistently got the 
</I>&gt;&gt;<i> same results.  This was how I finally pinned it down to mod_python.  
</I>&gt;&gt;<i> See the last answer for further details.
</I>&gt;<i>
</I>&gt;<i> Sending a copy of the hello.py wouldn't hurt as well.
</I>&gt;<i>
</I>&gt;<i> Based on your other answers, is very strange and nothing obvious 
</I>&gt;<i> stands out.
</I>&gt;<i> The next thing I would try is to localise where the 500 error 
</I>&gt;<i> actually gets
</I>&gt;<i> raised. There are four possible places it could be occurring. These 
</I>&gt;<i> are:
</I>&gt;<i>
</I>&gt;<i> 1. In Python code executed within the handler itself.
</I>&gt;<i>
</I>&gt;<i> 2. In the Python code part of mod_python. Ie., somewhere within the 
</I>&gt;<i> file
</I>&gt;<i> lib/python/mod_python/apache.py.
</I>&gt;<i>
</I>&gt;<i> 3. In the C code part of mod_python. Ie., somewhere within the file
</I>&gt;<i> src/mod_python.c.
</I>&gt;<i>
</I>&gt;<i> 4. In Apache itself somewhere prior to, but possibly after mod_python 
</I>&gt;<i> is
</I>&gt;<i> invoked. Lets hope not. :-)
</I>&gt;<i>
</I>&gt;<i> Elimination of 1 is pretty straight forward by using a test handler 
</I>&gt;<i> which
</I>&gt;<i> contains:
</I>&gt;<i>
</I>&gt;<i>     from mod_python import apache
</I>&gt;<i>     apache.log_error(&quot;start import&quot;)
</I>&gt;<i>
</I>&gt;<i>     def handler(req):
</I>&gt;<i>         apache.log_error(&quot;start handler&quot;)
</I>&gt;<i>         req.content_type = &quot;text/plain&quot;
</I>&gt;<i>         req.send_http_header()
</I>&gt;<i>         req.write(&quot;Hello World!&quot;)
</I>&gt;<i>         apache.log_error(&quot;end handler&quot;)
</I>&gt;<i>         return apache.OK
</I>&gt;<i>
</I>&gt;<i>     apache.log_error(&quot;end import&quot;)
</I>&gt;<i>
</I>&gt;<i> If the 500 error is not generated from within the import of the 
</I>&gt;<i> handler
</I>&gt;<i> module or the handler itself when called, you should see in the Apache
</I>&gt;<i> error log all of the messages above.
</I>&gt;<i>
</I>&gt;<i> BTW, as an extra precaution, if Apache is able to write to your 
</I>&gt;<i> document
</I>&gt;<i> directories, you may want to manually remove any &quot;.pyc&quot; files that may
</I>&gt;<i> have been generated as the result of a prior test, before running the 
</I>&gt;<i> test.
</I>&gt;<i>
</I>&gt;<i> To test out 2, one would need to modify 
</I>&gt;<i> lib/python/mod_python/apache.py
</I>&gt;<i> and reinstall it. You should add calls to apache.log_error() into 
</I>&gt;<i> apache.py
</I>&gt;<i> to track where it may get to within its execution.
</I>&gt;<i>
</I>&gt;<i> I think the appropriate place to place log statements in that file is 
</I>&gt;<i> at
</I>&gt;<i> the start of the class method:
</I>&gt;<i>
</I>&gt;<i>   def HandlerDispatch(self, req):
</I>&gt;<i>
</I>&gt;<i>     log_error(&quot;start dispatch&quot;)
</I>&gt;<i>
</I>&gt;<i> Prior to the final return of the method, add:
</I>&gt;<i>
</I>&gt;<i>     log_error(&quot;end dispatch %s&quot;%str(result))
</I>&gt;<i>
</I>&gt;<i> There is a return part way through the method which returns a 500 
</I>&gt;<i> error,
</I>&gt;<i> but it is preceded by logging of a message anyway.
</I>&gt;<i>
</I>&gt;<i> If it is found that 500 is being returned from the method, this would
</I>&gt;<i> localise the cause of the problem to this method. At this point we 
</I>&gt;<i> would
</I>&gt;<i> have to start analysing further the method and the potential sources 
</I>&gt;<i> of
</I>&gt;<i> the 500 error by adding more logging and checking where result is 
</I>&gt;<i> being
</I>&gt;<i> set to 500.
</I>&gt;<i>
</I>&gt;<i> If this method always returns a 200 status response, yet the browser
</I>&gt;<i> still sees 500, we would have to consider number 3 above.
</I>&gt;<i>
</I>&gt;<i> At this point things get a bit trickier as one is dealing with the C 
</I>&gt;<i> code.
</I>&gt;<i> It is worth noting though that most instances of where a 500 response 
</I>&gt;<i> are
</I>&gt;<i> generated in the mod_python.c file are preceded by message logging. 
</I>&gt;<i> The
</I>&gt;<i> only ones that aren't are all of the form:
</I>&gt;<i>
</I>&gt;<i>     /* get/create interpreter */
</I>&gt;<i>     idata = get_interpreter(interp_name, req-&gt;server);
</I>&gt;<i>
</I>&gt;<i>     if (!idata)
</I>&gt;<i>         return HTTP_INTERNAL_SERVER_ERROR;
</I>&gt;<i>
</I>&gt;<i> Not being able to get/create the interpreter is pretty severe and if 
</I>&gt;<i> that
</I>&gt;<i> was happening then no Python code at all would be getting executed. I 
</I>&gt;<i> am
</I>&gt;<i> not sure why this situation couldn't be logged as well. Thus instead 
</I>&gt;<i> of
</I>&gt;<i> that above, have:
</I>&gt;<i>
</I>&gt;<i>     if (!idata) {
</I>&gt;<i>         ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, req,
</I>&gt;<i>                       &quot;python_handler: Can't get/create 
</I>&gt;<i> interpreter.&quot;);
</I>&gt;<i>
</I>&gt;<i>         return HTTP_INTERNAL_SERVER_ERROR;
</I>&gt;<i>     }
</I>&gt;<i>
</I>&gt;<i> Anyway, that is the steps I would personally pursue to try and narrow 
</I>&gt;<i> down
</I>&gt;<i> where the 500 error is being generated from. Once one can reliably 
</I>&gt;<i> pinpoint
</I>&gt;<i> it down to a specific area of code in this way, have a better chance 
</I>&gt;<i> of
</I>&gt;<i> determining why it is happening.
</I>&gt;<i>
</I>&gt;<i> Graham
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017632.html">[mod_python] OS X / Apache 2 / mod_python bug
</A></li>
	<LI>Next message: <A HREF="017657.html">[mod_python] OS X / Apache 2 / mod_python bug
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17656">[ date ]</a>
              <a href="thread.html#17656">[ thread ]</a>
              <a href="subject.html#17656">[ subject ]</a>
              <a href="author.html#17656">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
