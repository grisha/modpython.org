<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] session locking causes hang with mpservlets
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20session%20locking%20causes%20hang%20with%20mpservlets&In-Reply-To=c8f51f407304b22351a60022d12f4075%40dscpl.com.au">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017775.html">
   <LINK REL="Next"  HREF="017778.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] session locking causes hang with mpservlets</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Daniel Popowich</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20session%20locking%20causes%20hang%20with%20mpservlets&In-Reply-To=c8f51f407304b22351a60022d12f4075%40dscpl.com.au"
       TITLE="[mod_python] session locking causes hang with mpservlets">dpopowich at comcast.net
       </A><BR>
    <I>Mon Mar 28 09:38:19 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="017775.html">[mod_python] session locking causes hang with mpservlets
</A></li>
        <LI>Next message: <A HREF="017778.html">[mod_python] session locking causes hang with mpservlets
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17777">[ date ]</a>
              <a href="thread.html#17777">[ thread ]</a>
              <a href="subject.html#17777">[ subject ]</a>
              <a href="author.html#17777">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Graham Dumpleton writes:
&gt;<i> 
</I>&gt;<i> On 28/03/2005, at 10:31 AM, Graham Dumpleton wrote:
</I>&gt;<i> &gt; The change in mpservlets is:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     def __cleanup_session(self):
</I>&gt;<i> &gt;         if self.use_session and self.session is not None:
</I>&gt;<i> &gt;             self.session.save()
</I>&gt;<i> &gt;             self.session.unlock()
</I>&gt;<i> &gt;             self.session = None
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Ie., add call to unlock() just after saving the session.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Normally this unlock() would be called, but only when the Session
</I>&gt;<i> &gt; object itself is deleted or by way of a cleanup function
</I>&gt;<i> &gt; registered against the request using req.register_cleanup().
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The problem is that even though one sets self.session to None,
</I>&gt;<i> &gt; this doesn't mean it will be deleted immediately as one is in part
</I>&gt;<i> &gt; at the mercy of the Python garbage collector. That it isn't
</I>&gt;<i> &gt; unlocked may actually keep it alive longer and normally it may
</I>&gt;<i> &gt; only be unlocked by request cleanup function at which point it
</I>&gt;<i> &gt; then gets destroyed.
</I>
Thanks for digging into this Graham.  Yes, I thought this would be
sufficient:

            self.session.save()
            self.session = None

as the garbage collector would clean up the session.  I have used this
extensively with and without internal redirects, without error or
deadlock, but as you say, you're at the whimsy of the garbage
collector.

To be on the safe side, I will patch mpservlets to include the explict
call to unlock().

Daniel Popowich
-----------------------------------------------
<A HREF="http://home.comcast.net/~d.popowich/mpservlets/">http://home.comcast.net/~d.popowich/mpservlets/</A>

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017775.html">[mod_python] session locking causes hang with mpservlets
</A></li>
	<LI>Next message: <A HREF="017778.html">[mod_python] session locking causes hang with mpservlets
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17777">[ date ]</a>
              <a href="thread.html#17777">[ thread ]</a>
              <a href="subject.html#17777">[ subject ]</a>
              <a href="author.html#17777">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
