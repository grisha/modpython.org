<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Mod_python &amp; global persistence
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Mod_python%20%26%20global%20persistence&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017601.html">
   <LINK REL="Next"  HREF="017602.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Mod_python &amp; global persistence</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Mod_python%20%26%20global%20persistence&In-Reply-To="
       TITLE="[mod_python] Mod_python &amp; global persistence">grahamd at dscpl.com.au
       </A><BR>
    <I>Mon Mar  7 17:04:32 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="017601.html">[mod_python] Mod_python &amp; global persistence
</A></li>
        <LI>Next message: <A HREF="017602.html">[mod_python] Mod_python &amp; global persistence
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17598">[ date ]</a>
              <a href="thread.html#17598">[ thread ]</a>
              <a href="subject.html#17598">[ subject ]</a>
              <a href="author.html#17598">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The variable assignments and code at global scope within one instance of an
interpreter should not be getting executed on each request. What you are
possibly getting confused other is that if running in prefork mode for Apache,
there will be multiple processes, each with their own interpreter and thus their
own copy of the load module and data.

Thus, the data assignment and code at global scope will be executed once
per process. Each process has its own copy. The data is not shared across
processes. You will need to use some form of external persistence if you
want data shared between processes.

Just to make things more confusing, if using a multithreaded MPM for Apache,
there are some bugs in mod_python which can cause multiple interpreters to
be incorrectly created within one process. Further within one interpreter, a
module at startup may be loaded more than once, thus causing code to be
executed more than once. Fixes for the bugs can be found at:

  <A HREF="http://www.dscpl.com.au/projects/vampire/PATCHES">http://www.dscpl.com.au/projects/vampire/PATCHES</A>

BTW, it is not generally good practice to be caching a request object into
global data structures as the request object only really exists in a valid
state for the length of the request. Also, in general the approach you are
using looks like it would fail in a multithreaded MPM. This is because more
than one request could invoke the handler at the same time, and thus they
will muck up each other because they both manipulate the global data
without any exclusion locks.

Wagner,Harry wrote ..
&gt;<i> Is there a way with mod_python to init global variables in a handler the
</I>&gt;<i> first time it is called, so that they are available (and already
</I>&gt;<i> initialized) in subsequent calls to the handler?  I thought the
</I>&gt;<i> following might work, but no joy:
</I>&gt;<i> 
</I>&gt;<i> from mod_python import apache, util, Session
</I>&gt;<i> 
</I>&gt;<i> def handler(req):
</I>&gt;<i> #	req.log_error(&quot;in handler&quot;)
</I>&gt;<i> 	global ddcServer
</I>&gt;<i> 	ddcServer.req = req
</I>&gt;<i> 	ddcServer.do_GET()
</I>&gt;<i> 	return apache.OK
</I>&gt;<i> ...
</I>&gt;<i> ddcServer = ''
</I>&gt;<i> if not ddcServer:
</I>&gt;<i> 	...
</I>&gt;<i> 	ddcServer = DDCServer(None)	
</I>&gt;<i> 	ddcServer.captions = DDCCaptions(captionsFile)
</I>&gt;<i> 	ddcServer.localText = TextLocalization(captionsFile)
</I>&gt;<i> 	ddcServer.ddcSearch = ddc3.DDCSearch(oclc2ddcFile, recFileName,
</I>&gt;<i> compFile)
</I>&gt;<i> 
</I>&gt;<i> The 'if not ddcServer' code is invoked with every call to the handler.
</I>&gt;<i> Any ideas what I am doing wrong, or if this is possible with mod_python?
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> TIA... harry
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I></PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017601.html">[mod_python] Mod_python &amp; global persistence
</A></li>
	<LI>Next message: <A HREF="017602.html">[mod_python] Mod_python &amp; global persistence
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17598">[ date ]</a>
              <a href="thread.html#17598">[ thread ]</a>
              <a href="subject.html#17598">[ subject ]</a>
              <a href="author.html#17598">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
