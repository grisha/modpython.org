<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Trouble fetching POST arguments
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Trouble%20fetching%20POST%20arguments&In-Reply-To=1111027275.31817%40dscpl.user.openhosting.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017696.html">
   <LINK REL="Next"  HREF="017697.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Trouble fetching POST arguments</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Davin Boling</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Trouble%20fetching%20POST%20arguments&In-Reply-To=1111027275.31817%40dscpl.user.openhosting.com"
       TITLE="[mod_python] Trouble fetching POST arguments">davin at wordpainter.net
       </A><BR>
    <I>Wed Mar 16 21:57:28 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="017696.html">[mod_python] Trouble fetching POST arguments
</A></li>
        <LI>Next message: <A HREF="017697.html">[mod_python] Transparently using mod_python to handle images
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17698">[ date ]</a>
              <a href="thread.html#17698">[ thread ]</a>
              <a href="subject.html#17698">[ subject ]</a>
              <a href="author.html#17698">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I had already established that the method type is somehow getting 
switched in the non-working handler. As much as it's hell-bent to force 
me to use a GET for my form, I'd much rather figure out why it's forcing 
a GET when I'm telling it to use a POST.


1) I can make a script from scratch that accepts a POST operation just 
fine. That's the one that I provided a moment ago.
2) req.read() isn't working on the bad handler, even if I put it at the 
top of the bad handler. That was my first hint that something was 
strange, and by logging req.method I was able to find out that Apache 
wants to use GET instead of POST with my non-working handler. It doesn't 
make sense, since I'm using the exact same form that worked with the 
smaller (working) handler.
3) Before anyone asks, I'm manually killing my browser cache between 
submissions just to be safe. The strange behavior is exhibited in both 
Mozilla and IE.


Graham Dumpleton wrote:

&gt;<i> The content length will not be set for a GET, thus I had in mine:
</I>&gt;<i> 
</I>&gt;<i>     if req.method == &quot;POST&quot;:
</I>&gt;<i>       length = int(req.headers_in[&quot;content-length&quot;])
</I>&gt;<i>       template.req_read.content = req.read(length)
</I>&gt;<i> 
</I>&gt;<i> I believe that for a POST, content length must be provided by the
</I>&gt;<i> client, certainly for the content types that FieldStorage is designed
</I>&gt;<i> to work with.
</I>&gt;<i> 
</I>&gt;<i> Davin Boling wrote ..
</I>&gt;<i> 
</I>&gt;&gt;<i>(forgive the double-mail Graham, replied direct and didn't hit the list
</I>&gt;&gt;<i>by accident)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>I took your suggestion involving time.sleep, but it made no difference.
</I>&gt;&gt;<i>As for grabbing the content-length in the method you described...the 
</I>&gt;&gt;<i>plot thickens!
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Using your code at the very beginning of the handler(req):, I get the 
</I>&gt;&gt;<i>following exception:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Mod_python error: &quot;PythonHandler handler&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Traceback (most recent call last):
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   File &quot;/usr/lib/python2.3/site-packages/mod_python/apache.py&quot;, line 
</I>&gt;&gt;<i>299, in HandlerDispatch
</I>&gt;&gt;<i>     result = object(req)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   File &quot;/home/davin/public_html/demo/handler/__init__.py&quot;, line 83, in
</I>&gt;&gt;<i>handler
</I>&gt;&gt;<i>     length = int(req.headers_in[&quot;content-length&quot;])
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>KeyError: 'content-length'
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Graham Dumpleton wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>Davin Boling wrote ..
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>I've got an example that works correctly already. The problem is that
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>in
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>the larger handler that I've written, SOMETHING is breaking. I can't
</I>&gt;&gt;&gt;&gt;<i>understand at all why req.read() returns nothing on a POST when it's
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>the
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>very first thing I assign to a variable. I'm about to go on a commenting
</I>&gt;&gt;&gt;&gt;<i>crusade to narrow down where the problem is.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>This is my &quot;from scratch&quot; handler, which works correctly...just to show
</I>&gt;&gt;&gt;&gt;<i>that I know how to handle a POST:
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>from mod_python import apache
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>def handler(req):
</I>&gt;&gt;&gt;&gt;<i>    head = &quot;&quot;&quot;
</I>&gt;&gt;&gt;&gt;<i>           &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
</I>&gt;&gt;&gt;&gt;<i>           &lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot;
</I>&gt;&gt;&gt;&gt;<i>            &quot;<A HREF="http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;">http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;</A>&gt;
</I>&gt;&gt;&gt;&gt;<i>            &lt;html&gt;
</I>&gt;&gt;&gt;&gt;<i>            &lt;head&gt;
</I>&gt;&gt;&gt;&gt;<i>            &lt;title&gt;Debug&lt;/title&gt;
</I>&gt;&gt;&gt;&gt;<i>            &lt;/head&gt;
</I>&gt;&gt;&gt;&gt;<i>            &lt;body&gt;
</I>&gt;&gt;&gt;&gt;<i>           &quot;&quot;&quot;
</I>&gt;&gt;&gt;&gt;<i>    data = req.read()
</I>&gt;&gt;&gt;&gt;<i>    method = req.method
</I>&gt;&gt;&gt;&gt;<i>    req.content_type = &quot;text/html&quot;
</I>&gt;&gt;&gt;&gt;<i>    req.write(head + data + method + '&lt;/body&gt;&lt;/html&gt;')
</I>&gt;&gt;&gt;&gt;<i>    return apache.OK
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>Get the content length out of the headers and supply it to req.read()
</I>&gt;&gt;&gt;<i>and see if that makes a difference. Ie.,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>      length = int(req.headers_in[&quot;content-length&quot;])
</I>&gt;&gt;&gt;<i>      data = req.read(length)
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>Also note what documentation says about timeouts.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>  read([len])
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>    Reads at most len bytes directly from the client, returning a  string
</I>&gt;&gt;&gt;<i>    with the data read. If the len argument is negative or omitted, reads
</I>&gt;&gt;&gt;<i>    all data given by the client.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>    This function is affected by the Timeout Apache configuration  directive.
</I>&gt;&gt;&gt;<i>    The read will be aborted and an IOError  raised if the Timeout is
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>reached
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>    while reading client data.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>    This function relies on the client providing the Content-length 
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>header.
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>    Absence of the Content-length header will be treated as  if
</I>&gt;&gt;&gt;<i>    Content-length: 0 was supplied.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>    Incorrect Content-length may cause the function to try to read  more
</I>&gt;&gt;&gt;<i>    data than available, which will make the function block until a 
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Timeout
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>    is reached.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>One would expect an IOError according to this if a timeout occured, but
</I>&gt;&gt;&gt;<i>maybe it isn't being generated for some reason.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>You might also add:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>  time.sleep(10)
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>at the start of your handler and see if it makes a difference. Ie., try
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>and
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>determine if it is the time the client takes to send the post data.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>Graham
</I>&gt;&gt;&gt;<i>     
</I>
</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017696.html">[mod_python] Trouble fetching POST arguments
</A></li>
	<LI>Next message: <A HREF="017697.html">[mod_python] Transparently using mod_python to handle images
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17698">[ date ]</a>
              <a href="thread.html#17698">[ thread ]</a>
              <a href="subject.html#17698">[ subject ]</a>
              <a href="author.html#17698">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
