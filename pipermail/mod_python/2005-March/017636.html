<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] mod_python.publisher and Cheetah
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20mod_python.publisher%20and%20Cheetah&In-Reply-To=20050314151737.GA9521%40generic-nic.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017634.html">
   <LINK REL="Next"  HREF="017653.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] mod_python.publisher and Cheetah</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20mod_python.publisher%20and%20Cheetah&In-Reply-To=20050314151737.GA9521%40generic-nic.net"
       TITLE="[mod_python] mod_python.publisher and Cheetah">grahamd at dscpl.com.au
       </A><BR>
    <I>Mon Mar 14 16:29:50 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="017634.html">[mod_python] mod_python.publisher and Cheetah
</A></li>
        <LI>Next message: <A HREF="017653.html">[mod_python] Re: mod_python.publisher and Cheetah
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17636">[ date ]</a>
              <a href="thread.html#17636">[ thread ]</a>
              <a href="subject.html#17636">[ subject ]</a>
              <a href="author.html#17636">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I somewhat suspect that you aren't going to get the code as by
default generated by Cheetah to play well with publisher. As to
your original custom handler, you could clean it up somewhat
by using something like:

start = &quot;/python/&quot;

from mod_python import apache
import string

def handler(req):

      req.content_type = &quot;text/html&quot;
      module_name = string.replace (req.uri, start, &quot;&quot;)

      #     try:
      #              exec (&quot;&quot;&quot;import %s
      #tmpl = %s.%s()
      #tmpl.req = req&quot;&quot;&quot; % (module_name, module_name, module_name))
      #     except ImportError:
      #              return apache.HTTP_NOT_FOUND

      module = apache.import_module(module_name)
      if not hasattr(module,module_name):
            return apache.HTTP_NOT_FOUND

      tmpl = getattr(module,module_name)()
      tmpl.req = req

      req.send_http_header()
      req.write(tmpl.respond())

      return apache.OK

I still see some issues with this code in as much as I think it
requires everything to be in the one directory. Ie., can't have
subdirectories. Using &quot;start&quot; as a fixed value is not good, but
that can also be fixed. Also, you can't mix different file types
in the same directory.

When I get a chance, I'll write you a better version of this
which would fix these problems and provide new abilities as well.
I am surprised though that someone hasn't already written a
better handler for integrating Cheetah with mod_python.

BTW, I am not on the Cheetah mailing list, so ensure any responses
also go back to the mod_python list as well.

Graham

On Tuesday, March 15, 2005, at 02:17  AM, Stephane Bortzmeyer wrote:

&gt;<i> I always used Cheetah on Apache with a custom mod_python handler (see
</I>&gt;<i> <A HREF="http://wiki.cheetahtemplate.org/cheetahrecipes.html">http://wiki.cheetahtemplate.org/cheetahrecipes.html</A>). I would like to
</I>&gt;<i> use mod_python's publisher
</I>&gt;<i> <A HREF="http://www.modpython.org/live/current/doc-html/hand-pub.html,">http://www.modpython.org/live/current/doc-html/hand-pub.html,</A> in order
</I>&gt;<i> to limit my liability :-) specially for security reasons.
</I>&gt;<i>
</I>&gt;<i> It works fine but not if I use Cheetah's inheritance, as described in
</I>&gt;<i> <A HREF="http://www.cheetahtemplate.org/docs/users_guide_html_multipage/">http://www.cheetahtemplate.org/docs/users_guide_html_multipage/</A> 
</I>&gt;<i> inheritanceEtc.extends.html.
</I>&gt;<i> My foobar.tmpl Cheetah file is compiled as foobar.py, which includes a
</I>&gt;<i> foobar class. I added a index() routine but Cheetah puts in in the
</I>&gt;<i> foobar class, not directly in the foobar module. When
</I>&gt;<i> mod_python.publisher calls index(), it finds nothing and returns
</I>&gt;<i> NOT_FOUND.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> My SiteLogic.py:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> from Cheetah.Template import Template
</I>&gt;<i>
</I>&gt;<i> class SiteLogic(Template):
</I>&gt;<i>         &quot;&quot;&quot; Pure Python class containing methods for the site &quot;&quot;&quot;
</I>&gt;<i>
</I>&gt;<i>         # Never found because Cheetah puts it in a class
</I>&gt;<i>         def index(req):
</I>&gt;<i>             return &quot;Dummy&quot;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> My Site.tmpl:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> #from SiteLogic import SiteLogic
</I>&gt;<i> #extends SiteLogic
</I>&gt;<i> #implements respond
</I>&gt;<i>
</I>&gt;<i> #def title
</I>&gt;<i> No title #slurp
</I>&gt;<i> #end def
</I>&gt;<i>
</I>&gt;<i> #def body
</I>&gt;<i> &lt;P&gt;Default body.
</I>&gt;<i> #end def
</I>&gt;<i>
</I>&gt;<i> &lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;&gt;
</I>&gt;<i> &lt;HTML&gt;
</I>&gt;<i> &lt;HEAD&gt;
</I>&gt;<i> &lt;TITLE&gt;
</I>&gt;<i> $title
</I>&gt;<i> &lt;/TITLE&gt;
</I>&gt;<i> &lt;/HEAD&gt;
</I>&gt;<i> &lt;BODY&gt;
</I>&gt;<i> &lt;H1&gt;$title&lt;/H1&gt;
</I>&gt;<i> $body
</I>&gt;<i> &lt;HR&gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> A typical page:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> #from Site import Site
</I>&gt;<i> #extends Site
</I>&gt;<i> #implements body
</I>&gt;<i> #def title
</I>&gt;<i> Welcome
</I>&gt;<i> #end def
</I>&gt;<i>
</I>&gt;<i> &lt;P&gt;Some content.
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>
</PRE>















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017634.html">[mod_python] mod_python.publisher and Cheetah
</A></li>
	<LI>Next message: <A HREF="017653.html">[mod_python] Re: mod_python.publisher and Cheetah
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17636">[ date ]</a>
              <a href="thread.html#17636">[ thread ]</a>
              <a href="subject.html#17636">[ subject ]</a>
              <a href="author.html#17636">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
