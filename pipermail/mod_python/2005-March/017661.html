<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] OS X / Apache 2 / mod_python bug
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20OS%20X%20/%20Apache%202%20/%20mod_python%20bug&In-Reply-To=D3529EB8-2AA2-4BD9-9FF3-659EAE62F146%40kirkconsulting.co.uk">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017657.html">
   <LINK REL="Next"  HREF="017665.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] OS X / Apache 2 / mod_python bug</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20OS%20X%20/%20Apache%202%20/%20mod_python%20bug&In-Reply-To=D3529EB8-2AA2-4BD9-9FF3-659EAE62F146%40kirkconsulting.co.uk"
       TITLE="[mod_python] OS X / Apache 2 / mod_python bug">grahamd at dscpl.com.au
       </A><BR>
    <I>Tue Mar 15 16:31:30 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="017657.html">[mod_python] OS X / Apache 2 / mod_python bug
</A></li>
        <LI>Next message: <A HREF="017665.html">[mod_python] OS X / Apache 2 / mod_python bug
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17661">[ date ]</a>
              <a href="thread.html#17661">[ thread ]</a>
              <a href="subject.html#17661">[ subject ]</a>
              <a href="author.html#17661">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks for going to all the effort, a lot of times when suggesting 
things on
the mailing list, you simply never hear from people again, so you have 
no
idea if what you suggested worked or not.

See further suggestions below.

On 16/03/2005, at 7:25 AM, Jamie Kirkpatrick wrote:
&gt;&gt;<i> At this point things get a bit trickier as one is dealing with the C 
</I>&gt;&gt;<i> code.
</I>&gt;&gt;<i> It is worth noting though that most instances of where a 500 response 
</I>&gt;&gt;<i> are
</I>&gt;&gt;<i> generated in the mod_python.c file are preceded by message logging. 
</I>&gt;&gt;<i> The
</I>&gt;&gt;<i> only ones that aren't are all of the form:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     /* get/create interpreter */
</I>&gt;&gt;<i>     idata = get_interpreter(interp_name, req-&gt;server);
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     if (!idata)
</I>&gt;&gt;<i>         return HTTP_INTERNAL_SERVER_ERROR;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Not being able to get/create the interpreter is pretty severe and if 
</I>&gt;&gt;<i> that
</I>&gt;&gt;<i> was happening then no Python code at all would be getting executed. I 
</I>&gt;&gt;<i> am
</I>&gt;&gt;<i> not sure why this situation couldn't be logged as well. Thus instead 
</I>&gt;&gt;<i> of
</I>&gt;&gt;<i> that above, have:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     if (!idata) {
</I>&gt;&gt;<i>         ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, req,
</I>&gt;&gt;<i>                       &quot;python_handler: Can't get/create 
</I>&gt;&gt;<i> interpreter.&quot;);
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         return HTTP_INTERNAL_SERVER_ERROR;
</I>&gt;&gt;<i>     }
</I>&gt;<i>
</I>&gt;<i> OK - so this does indeed seem to be the case.  On a restart I get the 
</I>&gt;<i> message logged:
</I>&gt;<i>
</I>&gt;<i> [Tue Mar 15 20:20:55 2005] [notice] Apache/2.0.53 (Unix) DAV/2 
</I>&gt;<i> mod_python/3.1.3 Python/2.4 configured -- resuming normal operations
</I>&gt;<i> [Tue Mar 15 20:20:59 2005] [error] [client 192.168.2.2] 
</I>&gt;<i> python_handler: Can't get/create interpreter.
</I>
Next thing to try would be to add logging inside the get_interpreter() 
function.
Suggest logging the &quot;name&quot; input parameter supplied to the function, 
but more
importantly log whether the &quot;interpreters&quot; global variable is actually 
set when
the function is being called. Ie.,

     if (!interpreters) {
         ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, req,
                       &quot;python_handler: interpreters dictionary not 
initialised.&quot;);
         return NULL;
     }

There is a return near the end of the function as well which doesn't 
log anything
which you could add something for as well.

         if (!idata-&gt;obcallback)
         {
#ifdef WITH_THREAD
             PyEval_ReleaseThread(tstate);
#endif
             PyThreadState_Delete(tstate);
             ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, req,
                       &quot;python_handler: no interpreter callback found.&quot;);

             return NULL;
         }

When I get a chance I'll have a look at how &quot;interpreters&quot; gets set and 
what problems
could result. Wander if my Mac OS X patch screws this up in some cases.

Graham

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017657.html">[mod_python] OS X / Apache 2 / mod_python bug
</A></li>
	<LI>Next message: <A HREF="017665.html">[mod_python] OS X / Apache 2 / mod_python bug
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17661">[ date ]</a>
              <a href="thread.html#17661">[ thread ]</a>
              <a href="subject.html#17661">[ subject ]</a>
              <a href="author.html#17661">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
