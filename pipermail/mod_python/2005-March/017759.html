<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Due to design of code util.FieldStorage causes
	MemoryError on V.Large files
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Due%20to%20design%20of%20code%20util.FieldStorage%20causes%0A%09MemoryError%20on%20V.Large%20files&In-Reply-To=42444571.1050605%40joreybump.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017758.html">
   <LINK REL="Next"  HREF="017762.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Due to design of code util.FieldStorage causes
	MemoryError on V.Large files</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Nicolas Lehuen</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Due%20to%20design%20of%20code%20util.FieldStorage%20causes%0A%09MemoryError%20on%20V.Large%20files&In-Reply-To=42444571.1050605%40joreybump.com"
       TITLE="[mod_python] Due to design of code util.FieldStorage causes
	MemoryError on V.Large files">nicolas.lehuen at gmail.com
       </A><BR>
    <I>Fri Mar 25 15:04:47 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="017758.html">[mod_python] Due to design of code util.FieldStorage causes
	MemoryError on V.Large files
</A></li>
        <LI>Next message: <A HREF="017762.html">[mod_python] _req.write buffer/flush question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17759">[ date ]</a>
              <a href="thread.html#17759">[ thread ]</a>
              <a href="subject.html#17759">[ subject ]</a>
              <a href="author.html#17759">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i>From the source code (mod_python/util.py line 169), it seems that
</I>mod_python will stream to a temporary file instead of memory if and
only if the Content-Disposition header of the file attachement
contains a filename attribute. Otherwise, it loads the file into
memory, hence the MemoryError.

Now, does your browser correctly send a filename attribute ? Maybe
FieldStorage should not care about a filename being available and
always try to stream to disk ?

Anyway, I agree with Jorey, HTTP is not made for this kind of huge
file transfer...

Regards,
Nicolas

On Fri, 25 Mar 2005 12:08:01 -0500, Jorey Bump &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">list at joreybump.com</A>&gt; wrote:
&gt;<i> Barry Pearce wrote:
</I>&gt;<i> 
</I>&gt;<i> &gt; Ive just tried to upload an .iso using FieldStorage - an unfortunately
</I>&gt;<i> &gt; this causes some problems - namely it just calls 'readline' without a
</I>&gt;<i> &gt; specific sizing.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Im going to take a look at the code and try to improve it so that it
</I>&gt;<i> &gt; would cope with multi-GB files...
</I>&gt;<i> 
</I>&gt;<i> &gt; Any thoughts before I plough headlong into this?
</I>&gt;<i> 
</I>&gt;<i> I would probably never allow transfers of this type using HTTP, so be
</I>&gt;<i> sure to provide sane defaults and a limiting mechanism.
</I>&gt;<i> 
</I>&gt;<i> Also, considering the amount of time it would take to complete the
</I>&gt;<i> transfer on just about any typical connection, how many simultaneous
</I>&gt;<i> transfers would be possible in a default apache setup before it
</I>&gt;<i> effectively stops serving pages?
</I>&gt;<i> 
</I>&gt;<i> How will you handle uploads of the same file when a luser keeps
</I>&gt;<i> submitting the same form? For small files, this is a nuisance, but for
</I>&gt;<i> large ones it could be a catastrophe.
</I>&gt;<i> 
</I>&gt;<i> Finally, consider every aspect of the worst case scenario and don't
</I>&gt;<i> discount human stupidity. For example, a user once tried to send me an
</I>&gt;<i> email with a 40GB attachment (the entire C: drive) using Outlook
</I>&gt;<i> Express. His mail server properly identified the maximum size it would
</I>&gt;<i> handle, but OE stubbornly continued to transfer bytes and attempted to
</I>&gt;<i> clear out its Outbox all night long (he had gone to bed). In the
</I>&gt;<i> morning, his provider gave him an angry call. We took the machine
</I>&gt;<i> offline and spent a couple of hours trying to purge the message from OE
</I>&gt;<i> (harder than you would think). Test your code with every browser
</I>&gt;<i> available to you, and do every stupid thing you can think of before
</I>&gt;<i> giving ordinary users the power to DoS your system.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i>
</I></PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017758.html">[mod_python] Due to design of code util.FieldStorage causes
	MemoryError on V.Large files
</A></li>
	<LI>Next message: <A HREF="017762.html">[mod_python] _req.write buffer/flush question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17759">[ date ]</a>
              <a href="thread.html#17759">[ thread ]</a>
              <a href="subject.html#17759">[ subject ]</a>
              <a href="author.html#17759">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
