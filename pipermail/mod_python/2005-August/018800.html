<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] How to make mod_python know when Apache
	is	shutdown/restarted?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20How%20to%20make%20mod_python%20know%20when%20Apache%0A%09is%09shutdown/restarted%3F&In-Reply-To=42F3DF83.2070307%40mischko.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018799.html">
   <LINK REL="Next"  HREF="018801.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] How to make mod_python know when Apache
	is	shutdown/restarted?</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20How%20to%20make%20mod_python%20know%20when%20Apache%0A%09is%09shutdown/restarted%3F&In-Reply-To=42F3DF83.2070307%40mischko.com"
       TITLE="[mod_python] How to make mod_python know when Apache
	is	shutdown/restarted?">grahamd at dscpl.com.au
       </A><BR>
    <I>Fri Aug  5 18:39:13 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="018799.html">[mod_python] How to make mod_python know when Apache
	is	shutdown/restarted?
</A></li>
        <LI>Next message: <A HREF="018801.html">[mod_python] How to make mod_python know when Apache
	is	shutdown/restarted?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18800">[ date ]</a>
              <a href="thread.html#18800">[ thread ]</a>
              <a href="subject.html#18800">[ subject ]</a>
              <a href="author.html#18800">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On 06/08/2005, at 7:52 AM, Scott Chapman wrote:

&gt;<i> Scott Chapman wrote:
</I>&gt;&gt;<i> I need to make mod_python close the database connection nicely when 
</I>&gt;&gt;<i> Apache is shutdown or restarted.  How do I get this info into 
</I>&gt;&gt;<i> mod_python's world?
</I>&gt;<i>
</I>&gt;<i> I found the Server's &quot;register cleanup(request, callable[, data ])&quot; 
</I>&gt;<i> method.
</I>&gt;<i>
</I>&gt;<i> When do I call it?
</I>&gt;<i>
</I>&gt;<i> It seems it should be done once per Apache child process, not with 
</I>&gt;<i> every request.
</I>
Since to get the server object you need a request object, the only
option is to call it as a side effect of a request. To avoid calling it
more than once, you simply need to keep a global data flag some where
which you can set the first time you register the cleanup handler
thereby avoiding calling it again. If using a multithreaded MPM, just
make sure you thread protect access to the flag and registration of the
cleanup handler so you don't get race conditions.

Note that the consequence of this is you can't really create a database
connection using PythonImport but have to wait until the first time it
is required by any request. If you did do it from PythonImport, and
Apache was shutdown before a request was handled that needed the
database connection, you wouldn't get your cleanup handler called as it
wouldn't have been registered yet.

&gt;<i> I don't see a way to run something only when mod_python is 
</I>&gt;<i> instantiated initially.
</I>
Correct, see:

   <A HREF="http://issues.apache.org/jira/browse/MODPYTHON-37">http://issues.apache.org/jira/browse/MODPYTHON-37</A>

I still believe it would be possible to implement such a feature, and
previously described how I felt it could be done, but it has low
priority in the scheme of things.

Graham

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018799.html">[mod_python] How to make mod_python know when Apache
	is	shutdown/restarted?
</A></li>
	<LI>Next message: <A HREF="018801.html">[mod_python] How to make mod_python know when Apache
	is	shutdown/restarted?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18800">[ date ]</a>
              <a href="thread.html#18800">[ thread ]</a>
              <a href="subject.html#18800">[ subject ]</a>
              <a href="author.html#18800">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
