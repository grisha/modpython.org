<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] How to make mod_python know when Apache
	is	shutdown/restarted?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20How%20to%20make%20mod_python%20know%20when%20Apache%0A%09is%09shutdown/restarted%3F&In-Reply-To=42F432C3.4010206%40mischko.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018805.html">
   <LINK REL="Next"  HREF="018807.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] How to make mod_python know when Apache
	is	shutdown/restarted?</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20How%20to%20make%20mod_python%20know%20when%20Apache%0A%09is%09shutdown/restarted%3F&In-Reply-To=42F432C3.4010206%40mischko.com"
       TITLE="[mod_python] How to make mod_python know when Apache
	is	shutdown/restarted?">grahamd at dscpl.com.au
       </A><BR>
    <I>Sat Aug  6 00:13:06 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="018805.html">[mod_python] How to make mod_python know when Apache
	is	shutdown/restarted?
</A></li>
        <LI>Next message: <A HREF="018807.html">[mod_python] How to make mod_python know when Apache
	is	shutdown/restarted?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18806">[ date ]</a>
              <a href="thread.html#18806">[ thread ]</a>
              <a href="subject.html#18806">[ subject ]</a>
              <a href="author.html#18806">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On 06/08/2005, at 1:47 PM, Scott Chapman wrote:

&gt;<i> Graham Dumpleton wrote:
</I>&gt;&gt;<i> On 06/08/2005, at 10:26 AM, Scott Chapman wrote:
</I>&gt;&gt;&gt;<i> Graham Dumpleton wrote:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> BTW, almost have a working version of apache.register_cleanup() 
</I>&gt;&gt;&gt;&gt;<i> going anyway
</I>&gt;&gt;&gt;&gt;<i> if you want to try it when I am done. Means modify mod_python 
</I>&gt;&gt;&gt;&gt;<i> source though.
</I>&gt;<i>
</I>&gt;<i> I downloaded svn, patched it and compiled it.  Got a lot of warnings 
</I>&gt;<i> about things being redefined but it's running fine so far.  I need to 
</I>&gt;<i> know what all parameters apache.register_cleanup() is expecting.
</I>
Just like you had called req.register_cleanup() except that cleanup
handler is called on server shutdown like req.server.register_cleanup().

  register_cleanup(callable[, data])

    Registers a cleanup. Argument callable can be any callable object, 
the
    optional argument data can be any object (default is  None). At 
Apache
    child process termination, callable will be called with one 
argument, data.

    If errors are encountered during cleanup processing, they should be 
in
    error log.

Note that I have actually made a minor mistake in the code. In 
apache.py,
the prototype should be:

   def register_cleanup(handler,data=None):
       _apache.register_cleanup(_interpreter,_server,handler,data)

I used &quot;args=()&quot; which isn't technically correct but only in as much as
I used &quot;()&quot; instead of &quot;None&quot;. I was thinking you could supply a tuple 
of
arguments whereas you can actually only supply a single argument. What I
did wouldn't have stopped it working though.

Anyway, you should be able to do:

   def shutdown1():
       apache.log_error(&quot;shutdown1&quot;)

   apache.register_cleanup(shutdown1)

   def shutdown2(data):
       apache.log_error(&quot;shutdown2 %r&quot;%data)

   apache.register_cleanup(shutdown2,&quot;data&quot;)


Graham

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018805.html">[mod_python] How to make mod_python know when Apache
	is	shutdown/restarted?
</A></li>
	<LI>Next message: <A HREF="018807.html">[mod_python] How to make mod_python know when Apache
	is	shutdown/restarted?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18806">[ date ]</a>
              <a href="thread.html#18806">[ thread ]</a>
              <a href="subject.html#18806">[ subject ]</a>
              <a href="author.html#18806">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
