<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Request sendfile question
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Request%20sendfile%20question&In-Reply-To=Pine.LNX.4.64.0603241413420.11098%40wolf.ebi.ac.uk">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020667.html">
   <LINK REL="Next"  HREF="020669.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Request sendfile question</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Mike Looijmans</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Request%20sendfile%20question&In-Reply-To=Pine.LNX.4.64.0603241413420.11098%40wolf.ebi.ac.uk"
       TITLE="[mod_python] Request sendfile question">nlv11281 at natlab.research.philips.com
       </A><BR>
    <I>Mon Mar 27 00:52:26 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="020667.html">[mod_python] [ANN] markup.py - 1.1 - an HTML/XML generator
</A></li>
        <LI>Next message: <A HREF="020669.html">[mod_python] Templates et. al.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20668">[ date ]</a>
              <a href="thread.html#20668">[ thread ]</a>
              <a href="subject.html#20668">[ subject ]</a>
              <a href="author.html#20668">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I think the book is getting old - gzip decompression is built into IE 
and Netscape in versions around 4.0, so you can expect them all to 
support it. You can examine the 'accept' header sent by the browser to 
determine whether it will be capable of handling gzipped content.

--
Mike Looijmans
Philips Natlab / Topic Automation


Ville Silventoinen wrote:
&gt;<i> Hi Mike,
</I>&gt;<i> 
</I>&gt;<i> do all browsers support Gzip data? I've got a book called &quot;Writing 
</I>&gt;<i> Apache Modules with Perl and C&quot; which states that only Unix browsers 
</I>&gt;<i> would decompress Gzip data on-the-fly. We've got lot of Windows and Mac 
</I>&gt;<i> users who wouldn't know how to open the .gz file. I know it wastes 
</I>&gt;<i> network bandwidth to send the files uncompressed, but this application 
</I>&gt;<i> is used mostly in our intranet.
</I>&gt;<i> 
</I>&gt;<i> Thanks for you advice,
</I>&gt;<i> 
</I>&gt;<i> Ville
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On Fri, 24 Mar 2006, Mike Looijmans wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> There is shutil.copyfileobj() which basically does what you do here.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> If there's only one file in each archive file, your might want to try 
</I>&gt;&gt;<i> just setting the transfer-encoding (or so, not entirely sure here) to 
</I>&gt;&gt;<i> gzipped, just like mod_gzip does (the difference being that mod_gzip 
</I>&gt;&gt;<i> compresses your output, while your output is already compressed). If 
</I>&gt;&gt;<i> you do that right, you can send back the GZIP data without 
</I>&gt;&gt;<i> decompressing it and the client will decompress it on the fly (saving 
</I>&gt;&gt;<i> bandwidth in the process).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> -- 
</I>&gt;&gt;<i> Mike Looijmans
</I>&gt;&gt;<i> Philips Natlab / Topic Automation
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Ville Silventoinen wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Hi,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> is there a way to send a file using a file handle?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I've got a file archive, which stores files in gzip format. When a 
</I>&gt;&gt;&gt;<i> client downloads the file, I'd like to send the file uncompressed, 
</I>&gt;&gt;&gt;<i> without creating a temporary file.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I'm sending the file like this (bit simplified):
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>     req.filename = fname
</I>&gt;&gt;&gt;<i>     req.content_type = ctype
</I>&gt;&gt;&gt;<i>     req.set_content_length = flen
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>     fh = gzip.GzipFile(fpath, 'rb', 9)
</I>&gt;&gt;&gt;<i>     block_size = 1024
</I>&gt;&gt;&gt;<i>     while 1:
</I>&gt;&gt;&gt;<i>         data = fh.read(block_size)
</I>&gt;&gt;&gt;<i>         if not data:
</I>&gt;&gt;&gt;<i>             break
</I>&gt;&gt;&gt;<i>         req.write(data)
</I>&gt;&gt;&gt;<i>     fh.close()
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>     return apache.OK
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I've tested this with different files, it seems to work ok. I was 
</I>&gt;&gt;&gt;<i> looking at the requestobject.c. Would it be easy to implement 
</I>&gt;&gt;&gt;<i> something like req_sendfh in addition to req_sendfile?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Thanks,
</I>&gt;&gt;&gt;<i> Ville
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;<i> Mod_python mailing list
</I>&gt;&gt;&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;&gt;&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020667.html">[mod_python] [ANN] markup.py - 1.1 - an HTML/XML generator
</A></li>
	<LI>Next message: <A HREF="020669.html">[mod_python] Templates et. al.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20668">[ date ]</a>
              <a href="thread.html#20668">[ thread ]</a>
              <a href="subject.html#20668">[ subject ]</a>
              <a href="author.html#20668">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
