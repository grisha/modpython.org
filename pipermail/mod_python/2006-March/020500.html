<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] changing req.proxyreq on the fly
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20changing%20req.proxyreq%20on%20the%20fly&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020495.html">
   <LINK REL="Next"  HREF="020504.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] changing req.proxyreq on the fly</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Bill Fraser</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20changing%20req.proxyreq%20on%20the%20fly&In-Reply-To="
       TITLE="[mod_python] changing req.proxyreq on the fly">bill.fraser at gmail.com
       </A><BR>
    <I>Thu Mar  2 22:12:18 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="020495.html">[mod_python] How to make a handler for static files?
</A></li>
        <LI>Next message: <A HREF="020504.html">[mod_python] changing req.proxyreq on the fly
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20500">[ date ]</a>
              <a href="thread.html#20500">[ thread ]</a>
              <a href="subject.html#20500">[ subject ]</a>
              <a href="author.html#20500">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello, this is my first post to this list, and I'm rather new to
Python, so please excuse me if my question is a trivial one. :)

I'm using Apache2's mod_rewrite for a proxy system on my webserver,
and I've noticed that no matter what, mod_rewrite instructs mod_proxy
to add all the X-Forwarded-* headers, despite the fact that the proxy
request is forward proxy and not a reverse one. Looking at the Apache2
source, mod_proxy specifically mentions in the relevant comment block
that this should NOT be done for forward proxy requests (and in fact
they are messing up the application this is for), yet mod_rewrite will
ALWAYS add them, no matter what the nature of the proxy request is.

Looking further in the source, I found that the way to change this
behavior is to change the value of the r-&gt;proxyreq variable from
PROXYREQ_REVERSE (what mod_rewrite sets it to) to PROXYREQ_PROXY. A
nice thing about Python is its ability to attach itself to arbitrary
points in the request process, so I thought I could change this value.
No luck. req.proxyreq is marked as read-only.

Is there any other way to change the value of req.proxyreq? Is there
some obscure Apache setting that might do the same that I've somehow
missed? Yes, I know I could write an Apache module in C that would get
this done, but that's way more than I want to do. I might as well
recompile Apache with the section that adds the headers commented out.

The method I tried was to define a this method:

def fixuphandler(req):
    req.proxyreq = 1
    return apache.OK

and use this in a PythonFixupHandler Apache directive. This causes a
500 error and throws 'TypeError: attribute 'proxyreq' of 'mp_request'
objects is not writable'.

Thanks in advance,
-Bill

</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020495.html">[mod_python] How to make a handler for static files?
</A></li>
	<LI>Next message: <A HREF="020504.html">[mod_python] changing req.proxyreq on the fly
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20500">[ date ]</a>
              <a href="thread.html#20500">[ thread ]</a>
              <a href="subject.html#20500">[ subject ]</a>
              <a href="author.html#20500">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
