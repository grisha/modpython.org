<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] I need to create a Zip file on the fly and write
	it to	the stream without any temp files or in memory file creation?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20I%20need%20to%20create%20a%20Zip%20file%20on%20the%20fly%20and%20write%0A%09it%20to%09the%20stream%20without%20any%20temp%20files%20or%20in%20memory%20file%20creation%3F&In-Reply-To=440D274C.7080309%40natlab.research.philips.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020556.html">
   <LINK REL="Next"  HREF="020548.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] I need to create a Zip file on the fly and write
	it to	the stream without any temp files or in memory file creation?</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Mike Looijmans</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20I%20need%20to%20create%20a%20Zip%20file%20on%20the%20fly%20and%20write%0A%09it%20to%09the%20stream%20without%20any%20temp%20files%20or%20in%20memory%20file%20creation%3F&In-Reply-To=440D274C.7080309%40natlab.research.philips.com"
       TITLE="[mod_python] I need to create a Zip file on the fly and write
	it to	the stream without any temp files or in memory file creation?">nlv11281 at natlab.research.philips.com
       </A><BR>
    <I>Tue Mar  7 01:41:08 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="020556.html">[mod_python] I need to create a Zip file on the fly and write
	it to	the stream without any temp files or in memory file creation?
</A></li>
        <LI>Next message: <A HREF="020548.html">[mod_python] I need to create a Zip file on the fly and write it
	tothe stream without any temp files or in memory file creation?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20557">[ date ]</a>
              <a href="thread.html#20557">[ thread ]</a>
              <a href="subject.html#20557">[ subject ]</a>
              <a href="author.html#20557">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Practical example:

import tarfile
...

    tar = tarfile.open(mode=&quot;w|&quot;, fileobj=req)
    for f in files:
        tar.add(f)
    tar.close()
...

Use a mode of &quot;w|gz&quot; or &quot;w|bz2&quot; to enable gzip/bzip2 compression (see 
Python help or docs on tarfile for that)

Note: On unix systems (linux), it is a wee bit faster to run the (g)tar 
program and stream its output, especially with lots of small files. On 
Windows systems, this just does not work reliably.

Mike Looijmans
Philips Natlab / Topic Automation


Mike Looijmans wrote:
&gt;<i> Use TarFile (python 2.3 or higher) instead of zip.
</I>&gt;<i> 
</I>&gt;<i> Most &quot;winzip&quot; alike programs can handle TAR files just fine, so your 
</I>&gt;<i> users won't notice the difference. TAR files are designed to be 
</I>&gt;<i> streamable (Tape ARchive) and the python interface won't need tell(). 
</I>&gt;<i> You can stream anything that supports read() to a TAR  stream.
</I>&gt;<i> 
</I>&gt;<i> TAR does not support compression, but it is common to (g)zip the tar 
</I>&gt;<i> stream, which yields a streamable compressed result (and still delivers 
</I>&gt;<i> a tar file on the other side if you use a content-encoding of x-gzip)
</I>&gt;<i> 
</I>&gt;<i> Mike Looijmans
</I>&gt;<i> Philips Natlab / Topic Automation
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> jarrod roberson wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> just to stop the responses now mod_deflate is NOT what I need. I need 
</I>&gt;&gt;<i> the end user to get a pop up that allows them to down load the 
</I>&gt;&gt;<i> contents of a directory as one big zip file.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I have a servlet in Java that does just this using the ZipOutputStream 
</I>&gt;&gt;<i> and it works great! You can download giant directorys with very very 
</I>&gt;&gt;<i> little load on the server since I am doing a ZERO level compression.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The reason I am looking at a mod_python solution is the way we have 
</I>&gt;&gt;<i> mod_dav set up right now it takes over the namespace that we need to 
</I>&gt;&gt;<i> do redirects from and can't get Apache to redirect the URL to the Java 
</I>&gt;&gt;<i> Servlet, and we have a big time crunch and can't re-archtiect the 
</I>&gt;&gt;<i> entire directory layout to try and fix it right now.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I saw a post recommending to use ZipFile, ZipFile won't work, it needs 
</I>&gt;&gt;<i> .tell(). It updates all the zip headers after the fact.
</I>&gt;&gt;<i> I found something called zipstream.py, but alas, it does the same thing!
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Before I go and write a ZipOutputStream wrapper around the request 
</I>&gt;&gt;<i> object, I wanted to see if any of you know of anythign out there that 
</I>&gt;&gt;<i> does this.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thanks again, and remember mod_deflate is NOT going to work.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i> 
</I>
</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020556.html">[mod_python] I need to create a Zip file on the fly and write
	it to	the stream without any temp files or in memory file creation?
</A></li>
	<LI>Next message: <A HREF="020548.html">[mod_python] I need to create a Zip file on the fly and write it
	tothe stream without any temp files or in memory file creation?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20557">[ date ]</a>
              <a href="thread.html#20557">[ thread ]</a>
              <a href="subject.html#20557">[ subject ]</a>
              <a href="author.html#20557">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
