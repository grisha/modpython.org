<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Object cleanup with child process scaling
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Object%20cleanup%20with%20child%20process%20scaling&In-Reply-To=71a75690703191024o7faa4fe8yfb0b77c04f0dba07%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023291.html">
   <LINK REL="Next"  HREF="023293.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Object cleanup with child process scaling</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Object%20cleanup%20with%20child%20process%20scaling&In-Reply-To=71a75690703191024o7faa4fe8yfb0b77c04f0dba07%40mail.gmail.com"
       TITLE="[mod_python] Object cleanup with child process scaling">graham.dumpleton at gmail.com
       </A><BR>
    <I>Mon Mar 19 15:57:02 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="023291.html">[mod_python] Object cleanup with child process scaling
</A></li>
        <LI>Next message: <A HREF="023293.html">[mod_python] Compiling mod_python
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23292">[ date ]</a>
              <a href="thread.html#23292">[ thread ]</a>
              <a href="subject.html#23292">[ subject ]</a>
              <a href="author.html#23292">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 20/03/07, Nicholas Milkovits &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">nmilkovits at gmail.com</A>&gt; wrote:
&gt;<i> Hello all,
</I>&gt;<i>
</I>&gt;<i> I have a quick question about how apache2 and mod python work. When
</I>&gt;<i> apache (running in prefork mode) decides to scale back the number of
</I>&gt;<i> running child processes running because of a low request volume, does
</I>&gt;<i> mod python ensure that all objects have their __del__ methods called
</I>
No it doesn't currently ensure that __del__ methods are called.

&gt;<i> or does apache just kill it and release the memory back to the system?
</I>
Yes and no. See below.

&gt;<i> I am running across a problem where my oracle db has to many sessions
</I>&gt;<i> open (although they are marked as idle/invalid) and it appears to be
</I>&gt;<i> because the client application is never explicity telling oracle to
</I>&gt;<i> close the sessions before exiting. Is there any way to ensure a chunk
</I>&gt;<i> of code gets run before apache kills the process?
</I>
When an Apache child process is killed the socket will be closed off.
The Oracle server side should detect this and recycle the connection
automatically. Because of this fact, I would suggest the problem might
lie elsewhere.

That said, look at the apache.register_cleanup() method.

  <A HREF="http://www.modpython.org/live/current/doc-html/pyapi-apmeth.html">http://www.modpython.org/live/current/doc-html/pyapi-apmeth.html</A>

This allows registration of callback to be called when Apache child
process is being shutdown. Note though that it is not guaranteed that
the callback will be called as various things could cause shutdown to
hang and parent Apache process will forcibly kill off child processes
if this occurs. Child process could also just die of their own accord
as well which would also mean that this would not be triggered.

Graham
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023291.html">[mod_python] Object cleanup with child process scaling
</A></li>
	<LI>Next message: <A HREF="023293.html">[mod_python] Compiling mod_python
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23292">[ date ]</a>
              <a href="thread.html#23292">[ thread ]</a>
              <a href="subject.html#23292">[ subject ]</a>
              <a href="author.html#23292">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
