<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] When using PSP is request object persistent?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20When%20using%20PSP%20is%20request%20object%20persistent%3F&In-Reply-To=88e286470703110142i67904132hab2759df4f093a86%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023270.html">
   <LINK REL="Next"  HREF="023272.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] When using PSP is request object persistent?</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>PETER BARKER</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20When%20using%20PSP%20is%20request%20object%20persistent%3F&In-Reply-To=88e286470703110142i67904132hab2759df4f093a86%40mail.gmail.com"
       TITLE="[mod_python] When using PSP is request object persistent?">newbarker at btinternet.com
       </A><BR>
    <I>Sun Mar 11 06:05:34 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="023270.html">[mod_python] When using PSP is request object persistent?
</A></li>
        <LI>Next message: <A HREF="023272.html">[mod_python] When using PSP is request object persistent?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23271">[ date ]</a>
              <a href="thread.html#23271">[ thread ]</a>
              <a href="subject.html#23271">[ subject ]</a>
              <a href="author.html#23271">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Graham,
   
  I appreciate the reply. My method fits in the corner case you mention. The stripped down example is from a project where a protected area of the website is entered. The previous presence of the session means they're already logged in, and the absence means they are required to login. This logic is based upon the description of the is_new() method at <A HREF="http://www.modpython.org/live/current/doc-html/pyapi-sess-classes.html">http://www.modpython.org/live/current/doc-html/pyapi-sess-classes.html</A> where it suggests you could use:
   
  sess = Session(req)
if sess.is_new():
    # redirect to login
    util.redirect(req, '<A HREF="http://www.mysite.com/login'">http://www.mysite.com/login'</A>)
   
  Of course, I'm doing something slightly different and composing a page from PSP templates. It's a shame this templating method which doesn't logically have anything to do with sessions (when viewed purely from a templating perspective) disables the ability to use is_new() in this way.
   
  I was going to store additional session information in a relational database anyway, so for me I guess the fix is to check for existence of corresponding record in the database as I'm definitely in control of that persistence! I'm going to have to store the last access time in the database too so I can implement the timing out of a session.
   
  Regards,
   
  Pete

Graham Dumpleton &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">graham.dumpleton at gmail.com</A>&gt; wrote:
  On 11/03/07, PETER BARKER wrote:
&gt;<i> Hello,
</I>&gt;<i>
</I>&gt;<i> See below for the stripped-down code to my problem/query. Note that I do not
</I>&gt;<i> save the session anywhere.
</I>&gt;<i>
</I>&gt;<i> With the two PSP template lines commented, the session is always new
</I>&gt;<i> (because I'm not saving it). When the templating code is uncommented, the
</I>&gt;<i> session is remembered across requests. Why is this?
</I>&gt;<i>
</I>&gt;<i> APACHE CONFIG:
</I>&gt;<i> 
</I>&gt;<i> SetHandler mod_python
</I>&gt;<i> PythonDebug On
</I>&gt;<i> PythonHandler mod_python.publisher
</I>&gt;<i> 
</I>&gt;<i>
</I>&gt;<i> INDEX.HTML:
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>
</I>&gt;<i> THETEST.PY:
</I>&gt;<i> from mod_python import Session, psp
</I>&gt;<i> import os
</I>&gt;<i> def entry(req):
</I>&gt;<i> req.session = Session.Session(req)
</I>&gt;<i> if req.session.is_new():
</I>&gt;<i> returnedDoc = &quot;Newly created session: &quot; + req.session.id()
</I>&gt;<i> else:
</I>&gt;<i> returnedDoc = 'Existing session:' + req.session.id()
</I>&gt;<i> #pathname = os.path.join(os.path.dirname(req.filename),'index.html')
</I>&gt;<i> #psp.PSP(req,filename=pathname).run()
</I>&gt;<i> req.content_type = 'text/html'
</I>&gt;<i> return returnedDoc
</I>
Do you use the session object in the PSP page? If you do, then what
you are seeing is consistent with how PSP has perhaps always worked.

As the code stands, if a session object is created, whether it be
prior to PSP being invoked or as a result of a reference to the
session object in a PSP page, the PSP code is always saving the
session object to ensure that the last accessed time is updated.

If the session object wasn't actually referenced from within the PSP
page this raises an interesting corner case which wasn't perhaps
thought of when PSP was changed to use a session object present as
req.session. The issue is if req.session exists but the session object
is not used in the PSP page, should the PSP code be saving the session
to have the last accessed time updated.

Thus, the code in PSP code should perhaps instead of saying:

# the mere instantiation of a session changes it
# (access time), so it *always* has to be saved
if hasattr(req, 'session'):
req.session.save()

perhaps say:

# the mere instantiation of a session changes it
# (access time), so it *always* has to be saved
if &quot;session&quot; in code.co_names and hasattr(req, 'session'):
req.session.save()

In summary, it is a feature of PSP that if a session object is used in
a PSP page that the session is always saved automatically. The
question is whether it should be saving it when the session was
created before PSP was invoked and the session isn't used in the PSP
page. Problem is that changing the behaviour may be too late now that
it is working this way.


Graham

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070311/888f5fe3/attachment-0001.html">http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070311/888f5fe3/attachment-0001.html</A>
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023270.html">[mod_python] When using PSP is request object persistent?
</A></li>
	<LI>Next message: <A HREF="023272.html">[mod_python] When using PSP is request object persistent?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23271">[ date ]</a>
              <a href="thread.html#23271">[ thread ]</a>
              <a href="subject.html#23271">[ subject ]</a>
              <a href="author.html#23271">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
