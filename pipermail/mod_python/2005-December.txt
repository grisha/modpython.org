From nicolas.lehuen at gmail.com  Thu Dec  1 01:16:21 2005
From: nicolas.lehuen at gmail.com (Nicolas Lehuen)
Date: Thu Dec  1 01:16:24 2005
Subject: [mod_python] ANNOUNCE: Mod_python 3.2.5 Beta
In-Reply-To: <438E6840.1040902@mischko.com>
References: <20051123102324.A63699@grisha.dyndns.org>
	<438E6840.1040902@mischko.com>
Message-ID: <c298f2d70511302216r7a779559j@mail.gmail.com>

Hi Scott,

It's not obvious from the download page (having only a tgz in the dropdown
list), but you can click on "Other downloads" under the 2.7 heading and
reach this page where you'll find everything you need :

http://apache.fastorama.com/dist/httpd/modpython/

Perhaps we could add some direct links to the Win32 binaries (for
Python 2.3and Python
2.4) in the download page ?

Regards,
Nicolas

2005/12/1, Scott Chapman <scott_list@mischko.com>:
>
> Does anyone have this available binary for Windows and Python 2.4.2?
>
> Gregory (Grisha) Trubetskoy wrote:
> >
> > The Apache Software Foundation and The Apache HTTP Server Project are
> > pleased to announce the 3.2.5 Beta release mod_python.
> >
> > Version 3.2.5b of mod_python features several new functions and
> > attributes providing better access to apache internals, file-based
> > sessions and other session improvements, as well as many bug fixes and
> > various performance and security improvements. A detailed description of
> > the changes is available in Appendix A of the mod_python manual, also
> > available here:
> >
> > http://www.modpython.org/live/mod_python-3.2.5b/doc-html/node97.html
> >
> > Beta releases are NOT considered stable and usually contain bugs.
> >
> > This release is intended to solicit widespread testing of the code. We
> > strongly recommend that you try out your existing applications and
> > experiment with new features in a non-production environment using this
> > version and report any problems you may encounter so that they can be
> > addressed before the final release.
> >
> > Preferred method of reporting problems is the mod_python user list
> > mod_python@modpython.org.
> >
> > Mod_python 3.2.5b is available for download from:
> >
> > http://httpd.apache.org/modules/python-download.cgi
> >
> > For more information about mod_python visit http://www.modpython.org/
> >
> > Regards,
> >
> > Grisha Trubetskoy and the Apache mod_python team.
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
> >
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20051201/4dcde178/attachment.html
From gzlist at googlemail.com  Thu Dec  1 01:17:47 2005
From: gzlist at googlemail.com (Martin _)
Date: Thu Dec  1 01:17:50 2005
Subject: [mod_python] returning errors from python handler and
	ErrorDocument
In-Reply-To: <0F56EF57-484A-45E5-AC25-3B8339401661@dscpl.com.au>
References: <d80792120511271427v5506a3f5x8fe29373ac213dca@mail.gmail.com>
	<0F56EF57-484A-45E5-AC25-3B8339401661@dscpl.com.au>
Message-ID: <d80792120511302217j3dac2040nedfbd44ad64cef25@mail.gmail.com>

I like the idea, unfortunately it seems to suffer from the same
problem - the file is created, status is 200 as it leaves the python,
but ends up as a 404, and a browser refresh is needed to fetch the
content. Even bumping up the pre-check to HeaderParserHandler had the
same problem, which makes me wonder if apache has already decided if
the file exists or not when it resolves the filename, and doesn't look
again... but then I don't quite understand why it doesn't set the 404
then. Or maybe the file isn't created 'enough', or there's some kinda
race condition... I don't know. As the file is created literally with:
if not os.path.isfile(req.filename):
    fi = file(req.filename, mode='wb')
    ## etc ##
it really should be finding the file if it looks...

Martin

On 11/28/05, Graham Dumpleton <grahamd@dscpl.com.au> wrote:
> My guess is that once the content handler phase has been executed,
> or logically passed, that you have no chance of changing what the return
> status is. Thus, since for an ErrorDocument directive it is only applied
> after the content handler phase of the first attempt has been passed,
> whether that is for a mod_python content handler or an inbuilt static
> Apache handler for serving static files, you will not be able to do it.
>
> What you instead need to do is to try and detect the condition of a
> missing
> file before the content handler phase is executed. To do that, setup a
> PythonFixupHandler. Eg:
>
>    <Directory "D:/website/search">
>    PythonFixupHandler check_for_missing_target
>    </Directory>
>
> This should be done for the search directory. You DO NOT not need to
> specify any corresponding SetHandler/AddHandler directive as they
> are only relevant to PythonHandler directive and not the other phase
> directives.
>
> What will happen now is that for any request received, it will be routed
> through the function "fixuphandler" within the specified module. In that
> module, you could check for the existance of the target. If it doesn't
> exist, then create it:
>
>    # check_for_missing_target.py (module)
>
>    def fixuphandler(req):
>      if target is missing:
>        create target of request
>      return apache.OK
>
> With the target now existing, the content handler phase when applied
> will
> possibly be able to find it. I say possibly, as I don't know what you
> are
> serving up and other issues such as Apache's URL matching algorithms
> may come into play. You may need to actually adjust req.filename to
> undo some of what Apache has done.
>
> Anyway, hope that gives you some ideas to play with.
>
> Graham
>
> On 28/11/2005, at 9:27 AM, Martin _ wrote:
>
> > In a related query to this one, is it possible to undo a raised
> > http error? I've not had much luck in sending 404s to a script that
> > then creates the resource asked for and bounces apache back to try
> > again from the start, the 404 sticks despite my best attempts to
> > overwrite it with a 200:
> >
> > # httpd.conf
> > <Directory "D:/website/search">
> >         ErrorDocument 404 /py/404.xml
> > </Directory>
> >
> > <Directory "D:/website/py">
> >         AddHandler mod_python .xml
> >         PythonHandler index
> > </Directory>
> >
> > # D:/website/py/index.py
> > def handler(req):
> >         if not req.prev:
> >                 return apache.HTTP_FORBIDDEN
> >
> >         ## create relevant resource here ##
> >
> >         # doesn't help # req.prev.state = apache.HTTP_OK
> >         # doesn't help # req.state = apache.HTTP_OK
> >         req.internal_redirect(req.prev.unparsed_uri)
> >         # doesn't help # req.next.state = apache.HTTP_OK
> >         # doesn't help # raise apache.SERVER_RETURN, apache.HTTP_OK
> >         return apache.OK
> >
> > I'm open to complete rethinks here, this doesn't strike me as
> > optimal, as the few requests that don't want existing resources
> > will go through three independant handlers, but for requirements:
> > -I want to serve static content, even if it's generated because of
> > that request, as static content, not mod_python created chunked output
> > -I want to keep all python stuff in that /py/ dir, rather than
> > scattering scripts all over the tree
> >
> > Any wise thoughts gratefully received,
> >
> > Martin
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
>
>

From richboardman at gmail.com  Thu Dec  1 05:16:43 2005
From: richboardman at gmail.com (Richard Boardman)
Date: Thu Dec  1 05:16:47 2005
Subject: [mod_python] ImportError with https
Message-ID: <438ECD8B.8010302@gmail.com>

Greetings,

Apologies if this has appeared twice; my other email account is having
some trouble at the moment and it would appear that this message didn't
make it to the list.

I'm having an issue with HTTPS and mod_python. If I create some python
file /var/www/foobarsite/foo.py:

   from mod_python import apache

   def handler(req):
       req.write('This is a test\n')
       return apache.OK

then having the file /var/www/foobarsite/.htaccess reading:

   AddHandler python-program .py
   PythonDebug On
   <Files "foo.py">
     PythonHandler foo
   </Files>
   <Files "bar.py">
     PythonHandler bar
   </Files>
   # etc.

then there is no problem when I visit the site through my browser with 
an HTTP prefix; as expected, the text "This is a text" appears in the 
browser window. My issue is this: if I access this with the https://... 
prefix, the following error is yielded:

   Mod_python error: "PythonHandler foo"

   Traceback (most recent call last):

     File "/usr/lib/python2.2/site-packages/mod_python/apache.py", line 
320,
   in HandlerDispatch
       module = import_module(module_name, config)

     File "/usr/lib/python2.2/site-packages/mod_python/apache.py", line 
496,
   in import_module
       f, p, d = imp.find_module(parts[i], path)

   ImportError: No module named foo

To the best of my knowledge, the server on which this resides is 'fine'
with HTTPS (other people have set this up): if I create a file foo.html
with a similar text, then this works fine with https as the prefix.

Is there something obvious I'm doing wrong? From the error it seems as
though the '.' directory is not in the path (!) - mod_python (and
consequently python) appear to be executing. I've given the file
permissions and directory permissions a cursory tweak (+x, -x) but this
doesn't make a difference [granted, this is clutching at straws].

The server purports to be running Apache/2.0.52 (Unix), mod_ssl/2.0.52, 
OpenSSL/0.9.7a, mod_python/3.0.3 and Python/2.2.2.

If it's just a simple tweak needed in the .htaccess file, then that's
ideal, but all suggestions gratefully received :)

Thanks in advance,

Rich

From richboardman at gmail.com  Thu Dec  1 05:34:11 2005
From: richboardman at gmail.com (Richard Boardman)
Date: Thu Dec  1 05:34:16 2005
Subject: [mod_python] Re: ImportError with https
In-Reply-To: <438ECD8B.8010302@gmail.com>
References: <438ECD8B.8010302@gmail.com>
Message-ID: <438ED1A3.6090003@gmail.com>

Richard Boardman wrote:
<snip>
> then having the file /var/www/foobarsite/.htaccess reading:
> 
>   AddHandler python-program .py
>   PythonDebug On
>   <Files "foo.py">
>     PythonHandler foo
>   </Files>
>   <Files "bar.py">
>     PythonHandler bar
>   </Files>
>   # etc.

I've fixed it myself. Turns out I was missing a line in my .htaccess. 
Adding:

   PythonPath "['/full/path/to/file']+sys.path"

beneath the AddHandler line sorted everything out. I'm taking a wild 
guess that there's some Apache gremlin causing it to run fine on http 
but not https. Now it all works :)

Thanks,

Rich
From prologic at shortcircuit.net.au  Fri Dec  2 00:02:03 2005
From: prologic at shortcircuit.net.au (James Mills)
Date: Fri Dec  2 00:02:12 2005
Subject: [mod_python] Caching Issue ?
Message-ID: <20051202050203.GA1717@shortcircuit.net.au>

Hi,

I have a strange problem with mod_python (possibly maybe even with
clearsilver, but I doubt it).

Basically I've noticed, if I hit "Refresh" in my browser sometimes I
will get an exception:

  File "/home/prologic/www/helpdesk/helpdesk/module.py", line 70, in
  __init__   
      import neo_cs                                                               
      ImportError: No module named neo_cs                           

Here's a snippet of that code:

class Module:
   .
   .
   .
   def __init__(...):
      .
      .
      .
      import neo_cgi
      import neo_cs # <-- Line 70
      import neo_util
      self._hdf = neo_util.HDF()
      self._setupPaths(self._hdf)
      self._cs = neo_cs.CS(self._hdf)
      self._cs.parseFile(self._template)

Any ideas ? (I'm guessing some caching issue?)

cheers
James

-- 
--
-"Problems are Solved by Method"
-
- James Mills <prologic@shortcircuit.net.au>
- HomePage: http://shortcircuit.net.au/~prologic/
- Phone: +61732166379
- Mobile: +61404270962
- Skype: therealprologic
- MSN: prologic@shortcircuit.net.au
- ICQ: 98888663
- IRC: irc://shortcircuit.net.au#se

Please avoid sending me Word or PowerPoint attachments.
See http://www.gnu.org/philosophy/no-word-attachments.html
From prologic at shortcircuit.net.au  Fri Dec  2 00:29:26 2005
From: prologic at shortcircuit.net.au (James Mills)
Date: Fri Dec  2 00:29:36 2005
Subject: [mod_python] Caching Issue ?
In-Reply-To: <20051202050203.GA1717@shortcircuit.net.au>
References: <20051202050203.GA1717@shortcircuit.net.au>
Message-ID: <20051202052926.GA1790@shortcircuit.net.au>

On Fri, Dec 02, 2005 at 03:02:03PM +1000, James Mills wrote:
> I have a strange problem with mod_python (possibly maybe even with
> clearsilver, but I doubt it).
> 
> Basically I've noticed, if I hit "Refresh" in my browser sometimes I
> will get an exception:
> 
>   File "/home/prologic/www/helpdesk/helpdesk/module.py", line 70, in
>   __init__   
>       import neo_cs                                                               
>       ImportError: No module named neo_cs                           
> 
> Here's a snippet of that code:
> 
> class Module:
>    .
>    .
>    .
>    def __init__(...):
>       .
>       .
>       .
>       import neo_cgi
>       import neo_cs # <-- Line 70
>       import neo_util
>       self._hdf = neo_util.HDF()
>       self._setupPaths(self._hdf)
>       self._cs = neo_cs.CS(self._hdf)
>       self._cs.parseFile(self._template)
> 
> Any ideas ? (I'm guessing some caching issue?)

Just a side-note, this only seems to happen when using SSL

ie: https://localhost/~prologic/helpdesk/

cheers
James

-- 
--
-"Problems are Solved by Method"
-
- James Mills <prologic@shortcircuit.net.au>
- HomePage: http://shortcircuit.net.au/~prologic/
- Phone: +61732166379
- Mobile: +61404270962
- Skype: therealprologic
- MSN: prologic@shortcircuit.net.au
- ICQ: 98888663
- IRC: irc://shortcircuit.net.au#se

Please avoid sending me Word or PowerPoint attachments.
See http://www.gnu.org/philosophy/no-word-attachments.html
From grahamd at dscpl.com.au  Fri Dec  2 02:19:03 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Fri Dec  2 02:19:20 2005
Subject: [mod_python] Caching Issue ?
In-Reply-To: <20051202052926.GA1790@shortcircuit.net.au>
References: <20051202050203.GA1717@shortcircuit.net.au>
	<20051202052926.GA1790@shortcircuit.net.au>
Message-ID: <985D26F8-0083-4BAB-84D1-E8676CD6D48C@dscpl.com.au>

Any chance of you trying mod_python 3.2.5b? Some module loading
problems are addressed in this version, although not all.

BTW, do you use PythonPath directive? Do you set this directive
in multiple places within your document hierarchy to different
values? Do the problems you see go away if you perform the imports
at global scope instead of within the constructor of your class?

On 02/12/2005, at 4:29 PM, James Mills wrote:

> On Fri, Dec 02, 2005 at 03:02:03PM +1000, James Mills wrote:
>
>> I have a strange problem with mod_python (possibly maybe even with
>> clearsilver, but I doubt it).
>>
>> Basically I've noticed, if I hit "Refresh" in my browser sometimes I
>> will get an exception:
>>
>>   File "/home/prologic/www/helpdesk/helpdesk/module.py", line 70, in
>>   __init__
>>       import neo_cs
>>       ImportError: No module named neo_cs
>>
>> Here's a snippet of that code:
>>
>> class Module:
>>    .
>>    .
>>    .
>>    def __init__(...):
>>       .
>>       .
>>       .
>>       import neo_cgi
>>       import neo_cs # <-- Line 70
>>       import neo_util
>>       self._hdf = neo_util.HDF()
>>       self._setupPaths(self._hdf)
>>       self._cs = neo_cs.CS(self._hdf)
>>       self._cs.parseFile(self._template)
>>
>> Any ideas ? (I'm guessing some caching issue?)
>>
>
> Just a side-note, this only seems to happen when using SSL
>
> ie: https://localhost/~prologic/helpdesk/
>
> cheers
> James
>
> -- 
> --
> -"Problems are Solved by Method"
> -
> - James Mills <prologic@shortcircuit.net.au>
> - HomePage: http://shortcircuit.net.au/~prologic/
> - Phone: +61732166379
> - Mobile: +61404270962
> - Skype: therealprologic
> - MSN: prologic@shortcircuit.net.au
> - ICQ: 98888663
> - IRC: irc://shortcircuit.net.au#se
>
> Please avoid sending me Word or PowerPoint attachments.
> See http://www.gnu.org/philosophy/no-word-attachments.html
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>

From paolophp3 at gmail.com  Fri Dec  2 03:35:39 2005
From: paolophp3 at gmail.com (Paolo)
Date: Fri Dec  2 03:36:12 2005
Subject: [mod_python] Help with Apache and mod_python
Message-ID: <5e6decd0512020035x6d801eccs@mail.gmail.com>

Hi all, I'm trying to setup Apache and mod_python in order tu run
Django (http://www.djangoproject.com/) with this setup.

I'm facing a problem that other people already have experienced: no
response is returned to the browser after each request is made. These
errors are notified in error_log:

[Fri Dec 02 09:20:48 2005] [notice] mod_python: Creating 32 session
mutexes based on 150 max processes and 0 max threads.
[Fri Dec 02 09:20:48 2005] [notice] Apache/2.0.55 (Unix)
mod_python/3.1.4 Python/2.4.2 configured -- resuming normal operations
[Fri Dec 02 09:20:48 2005] [info] Server built: Dec  1 2005 18:51:05
[Fri Dec 02 09:20:48 2005] [debug] prefork.c(956): AcceptMutex:
sysvsem (default: sysvsem)
[Fri Dec 02 09:20:51 2005] [notice] mod_python: (Re)importing module
'django.core.handlers.modpython'
[Fri Dec 02 09:20:54 2005] [notice] child pid 3645 exit signal
Segmentation fault (11)

I tried different configurations (apache 2.0.54/mod_python
3.1.4/python 2.3.4, apache 2.0.55/mod_python 3.1.4/python 2.3.4,
apache 2.0.55/mod_python 3.1.4/python 2.4.2) but I didn't see any
changes. Experiments happen on Slackware, kernel 2.4.26.

I discovered interesting information that might resemble my scenario
also: Expat Causing Apache Crash
(http://www.dscpl.com.au/articles/modpython-006.html), Segfault with
Vampire (http://www.modpython.org/pipermail/mod_python/2005-October/019390.html),
mod_python and MySQLDb won't work together
(http://www.modpython.org/FAQ/faqw.py?req=show&file=faq02.013.htp),
mod_python and mysql - problem solved!
(http://www.modpython.org/pipermail/mod_python/2004-January/014886.html).

I have followed the proposed solutions, but nothing applies succesfully.

As I already have stressed the helpful Django people at django-users
(complete thread for details at http://tinyurl.com/7k3qt), and the
issue is still unresolved, I guess that or the cause of this behavior
is so evident that it results even hard to trace, or that it's really
obscure.

Can I have an opinion from you, too?

Finally... I'm using PythonDebug On and LogLevel debug. Is there some
way to obtain further details?

Thanks!

From grahamd at dscpl.com.au  Fri Dec  2 06:15:16 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Fri Dec  2 06:15:22 2005
Subject: [mod_python] Help with Apache and mod_python
In-Reply-To: <5e6decd0512020035x6d801eccs@mail.gmail.com>
References: <5e6decd0512020035x6d801eccs@mail.gmail.com>
Message-ID: <03BF0B31-3F2E-4DE3-8194-6BE04A36329C@dscpl.com.au>

Can you get simple mod_python test handlers working at all? Ie.,
take Django out of the picture and use a simple example like that
described at:

   http://www.dscpl.com.au/articles/modpython-001.html

Ie.. let us ensure that your mod_python installation works first.

Graham

On 02/12/2005, at 7:35 PM, Paolo wrote:

> Hi all, I'm trying to setup Apache and mod_python in order tu run
> Django (http://www.djangoproject.com/) with this setup.
>
> I'm facing a problem that other people already have experienced: no
> response is returned to the browser after each request is made. These
> errors are notified in error_log:
>
> [Fri Dec 02 09:20:48 2005] [notice] mod_python: Creating 32 session
> mutexes based on 150 max processes and 0 max threads.
> [Fri Dec 02 09:20:48 2005] [notice] Apache/2.0.55 (Unix)
> mod_python/3.1.4 Python/2.4.2 configured -- resuming normal operations
> [Fri Dec 02 09:20:48 2005] [info] Server built: Dec  1 2005 18:51:05
> [Fri Dec 02 09:20:48 2005] [debug] prefork.c(956): AcceptMutex:
> sysvsem (default: sysvsem)
> [Fri Dec 02 09:20:51 2005] [notice] mod_python: (Re)importing module
> 'django.core.handlers.modpython'
> [Fri Dec 02 09:20:54 2005] [notice] child pid 3645 exit signal
> Segmentation fault (11)
>
> I tried different configurations (apache 2.0.54/mod_python
> 3.1.4/python 2.3.4, apache 2.0.55/mod_python 3.1.4/python 2.3.4,
> apache 2.0.55/mod_python 3.1.4/python 2.4.2) but I didn't see any
> changes. Experiments happen on Slackware, kernel 2.4.26.
>
> I discovered interesting information that might resemble my scenario
> also: Expat Causing Apache Crash
> (http://www.dscpl.com.au/articles/modpython-006.html), Segfault with
> Vampire (http://www.modpython.org/pipermail/mod_python/2005-October/ 
> 019390.html),
> mod_python and MySQLDb won't work together
> (http://www.modpython.org/FAQ/faqw.py?req=show&file=faq02.013.htp),
> mod_python and mysql - problem solved!
> (http://www.modpython.org/pipermail/mod_python/2004-January/ 
> 014886.html).
>
> I have followed the proposed solutions, but nothing applies  
> succesfully.
>
> As I already have stressed the helpful Django people at django-users
> (complete thread for details at http://tinyurl.com/7k3qt), and the
> issue is still unresolved, I guess that or the cause of this behavior
> is so evident that it results even hard to trace, or that it's really
> obscure.
>
> Can I have an opinion from you, too?
>
> Finally... I'm using PythonDebug On and LogLevel debug. Is there some
> way to obtain further details?
>
> Thanks!
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From paolophp3 at gmail.com  Fri Dec  2 08:36:24 2005
From: paolophp3 at gmail.com (Paolo)
Date: Fri Dec  2 08:36:27 2005
Subject: [mod_python] Help with Apache and mod_python
In-Reply-To: <03BF0B31-3F2E-4DE3-8194-6BE04A36329C@dscpl.com.au>
References: <5e6decd0512020035x6d801eccs@mail.gmail.com>
	<03BF0B31-3F2E-4DE3-8194-6BE04A36329C@dscpl.com.au>
Message-ID: <5e6decd0512020536gb716639y@mail.gmail.com>

2005/12/2, Graham Dumpleton <grahamd@dscpl.com.au>:
> Can you get simple mod_python test handlers working at all? Ie.,
> take Django out of the picture and use a simple example like that
> described at:
>
>    http://www.dscpl.com.au/articles/modpython-001.html
>
> Ie.. let us ensure that your mod_python installation works first.

Hi Graham, mptest.py is executed correctly (via .htaccess and global
configuration in httpd.conf as well).

Even more meaningful, I have been able to get 'with pyexpat' running
the handler described at
http://www.dscpl.com.au/articles/modpython-006.html#id2.

From chase at oldben.llnl.gov  Fri Dec  2 12:58:03 2005
From: chase at oldben.llnl.gov (chase3@llnl.gov)
Date: Fri Dec  2 13:00:37 2005
Subject: [mod_python] mod_python configuration problem?
Message-ID: <Pine.LNX.4.44.0512020954510.15159-100000@oldben.llnl.gov>

Hi, 

I am trying new to mod-python and have only light knowledge of
CGI scripting.  A CGI script written by someone else is too slow, 
and I want to try converting it to mod_python.  

Looking at Graham's "Getting mod_python Working" doc, I think 
mod_python is installed at version 2.7 because I get the 
message: 

   "ImportError: No module named psp."  

The sys admin told me that mod_python is built into apache, so no need to 
load it.  Our local Apache server is at 2.0.46.  Earlier he gave me 
this version info on Python products: python 2.2.35 and 
mod_python-3.0.3-3.ent
(We are only approved to run enterprise 3.x and apache 2.x.)
uname -a shows: Linux ... 2.4.21-20.ELsmp #1 SMP ... i686 i686 i386 
Gnu/Linux

I put the following mptest.py:

   from mod_python import apache

   def handler ( req ):
      req.content_type = "text/plain"
      req.send_http_header()
      req.write ( "Hello modtest" )
      return apache.OK

with .htaccess:

   <Directory /usr/web/cgi-bin/tracker/modtest>
   AddHandler mod_python .py
   PythonHandler mptest 
   PythonDebug On
   </Directory>

and pointed to URL:  
https://bugzi.llnl.gov/cgi-bin/tracker/modtest/mptest.py

I got an Internal server error and found out that it was due to an 
import error:

from mod_python import apache
File 
"/usr/src/build/345626-i386/install/usr/lib/lib/python2.2/site-packages/mod
_python/apache.py line 67 in ?
Import Error: No module named _apache

I also get a Premature end of script.

Another posting suggested that my problem is because mptest.py is being
run as a CGI script.  However, if I put the test in my home space, my 
browser is not able to get find it.

Any suggestions that would be helpful to getting the initial test to work
would be appreciated.
Thanks,
Lila

-- 
Lila Chase
lchase@llnl.gov

From paolophp3 at gmail.com  Fri Dec  2 13:13:50 2005
From: paolophp3 at gmail.com (Paolo)
Date: Fri Dec  2 13:13:57 2005
Subject: [mod_python] mod_python configuration problem?
In-Reply-To: <Pine.LNX.4.44.0512020954510.15159-100000@oldben.llnl.gov>
References: <Pine.LNX.4.44.0512020954510.15159-100000@oldben.llnl.gov>
Message-ID: <5e6decd0512021013l60a631d4h@mail.gmail.com>

2005/12/2, chase3@llnl.gov <chase@oldben.llnl.gov>:
>
>
> with .htaccess:
>
>    <Directory /usr/web/cgi-bin/tracker/modtest>
>    AddHandler mod_python .py
>    PythonHandler mptest
>    PythonDebug On
>    </Directory>



If you are using mod_python 2.7 you should type python-program instead of
mod_python.

HTH
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20051202/5932cab6/attachment.html
From chase at oldben.llnl.gov  Fri Dec  2 13:32:15 2005
From: chase at oldben.llnl.gov (chase3@llnl.gov)
Date: Fri Dec  2 13:34:53 2005
Subject: [mod_python] mod_python configuration problem?
In-Reply-To: <5e6decd0512021013l60a631d4h@mail.gmail.com>
Message-ID: <Pine.LNX.4.44.0512021031320.15225-100000@oldben.llnl.gov>

Thanks, I have also tried python-program w/o any luck.
Lila

On Fri, 2 Dec 2005, Paolo wrote:

> 2005/12/2, chase3@llnl.gov <chase@oldben.llnl.gov>:
> >
> >
> > with .htaccess:
> >
> >    <Directory /usr/web/cgi-bin/tracker/modtest>
> >    AddHandler mod_python .py
> >    PythonHandler mptest
> >    PythonDebug On
> >    </Directory>
> 
> 
> 
> If you are using mod_python 2.7 you should type python-program instead of
> mod_python.
> 
> HTH
> 

-- 
Lila Chase
lchase@llnl.gov
925-422-4086

From grahamd at dscpl.com.au  Fri Dec  2 23:56:14 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Fri Dec  2 23:56:24 2005
Subject: [mod_python] Help with Apache and mod_python
In-Reply-To: <5e6decd0512020536gb716639y@mail.gmail.com>
References: <5e6decd0512020035x6d801eccs@mail.gmail.com>
	<03BF0B31-3F2E-4DE3-8194-6BE04A36329C@dscpl.com.au>
	<5e6decd0512020536gb716639y@mail.gmail.com>
Message-ID: <2F7677FC-DCD9-49ED-A669-B3DA39121064@dscpl.com.au>


On 03/12/2005, at 12:36 AM, Paolo wrote:

> 2005/12/2, Graham Dumpleton <grahamd@dscpl.com.au>:
>> Can you get simple mod_python test handlers working at all? Ie.,
>> take Django out of the picture and use a simple example like that
>> described at:
>>
>>    http://www.dscpl.com.au/articles/modpython-001.html
>>
>> Ie.. let us ensure that your mod_python installation works first.
>
> Hi Graham, mptest.py is executed correctly (via .htaccess and global
> configuration in httpd.conf as well).
>
> Even more meaningful, I have been able to get 'with pyexpat' running
> the handler described at
> http://www.dscpl.com.au/articles/modpython-006.html#id2.

Next step then would be to import into the handler of your test code,
the module which you specify needs to be imported in order to make
use of Django. If done in the test handler function, accessing the
test URL will cause it to be imported and if it does crash at that point
you have confirmed that it is the actual import of the Django stuff that
is the problem. If that is confirmed, then look internally at Django and
see what module it imports, and instead of importing the Django top  
level
module, import what it imports. Gradually reduce the set of imports  
until
it stops crashing so as to find the specific module that causes the
problem. Drop down further into modules and look at their imports as
necessary.

This sort of process of elimination is the only way you are going to
be able to narrow it down. Unless you can determine precisely which
module is the issue, we aren't really going to be able to help.

Graham
From grahamd at dscpl.com.au  Sat Dec  3 00:04:36 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sat Dec  3 00:04:43 2005
Subject: [mod_python] mod_python configuration problem?
In-Reply-To: <Pine.LNX.4.44.0512020954510.15159-100000@oldben.llnl.gov>
References: <Pine.LNX.4.44.0512020954510.15159-100000@oldben.llnl.gov>
Message-ID: <DEE00566-B204-4180-9B13-06D982AF0631@dscpl.com.au>


On 03/12/2005, at 4:58 AM, chase3@llnl.gov wrote:

> Hi,
>
> I am trying new to mod-python and have only light knowledge of
> CGI scripting.  A CGI script written by someone else is too slow,
> and I want to try converting it to mod_python.
>
> Looking at Graham's "Getting mod_python Working" doc, I think
> mod_python is installed at version 2.7 because I get the
> message:
>
>    "ImportError: No module named psp."
>
> The sys admin told me that mod_python is built into apache, so no  
> need to
> load it.  Our local Apache server is at 2.0.46.  Earlier he gave me
> this version info on Python products: python 2.2.35 and
> mod_python-3.0.3-3.ent
> (We are only approved to run enterprise 3.x and apache 2.x.)
> uname -a shows: Linux ... 2.4.21-20.ELsmp #1 SMP ... i686 i686 i386
> Gnu/Linux

Your admin may be correct. My document tends to ignore 3.0.X
versions. A quick check of documentation for 3.0.X suggests that
it doesn't have PSP module either.

> I put the following mptest.py:
>
>    from mod_python import apache
>
>    def handler ( req ):
>       req.content_type = "text/plain"
>       req.send_http_header()
>       req.write ( "Hello modtest" )
>       return apache.OK
>
> with .htaccess:
>
>    <Directory /usr/web/cgi-bin/tracker/modtest>
>    AddHandler mod_python .py
>    PythonHandler mptest
>    PythonDebug On
>    </Directory>

For a .htaccess file, you shouldn't have <Directory> directive.

> and pointed to URL:
> https://bugzi.llnl.gov/cgi-bin/tracker/modtest/mptest.py
>
> I got an Internal server error and found out that it was due to an
> import error:
>
> from mod_python import apache
> File
> "/usr/src/build/345626-i386/install/usr/lib/lib/python2.2/site- 
> packages/mod
> _python/apache.py line 67 in ?
> Import Error: No module named _apache
>
> I also get a Premature end of script.
>
> Another posting suggested that my problem is because mptest.py is  
> being
> run as a CGI script.  However, if I put the test in my home space, my
> browser is not able to get find it.

I would tend to agree that this looks like it is being executed as
a CGI.

> Any suggestions that would be helpful to getting the initial test  
> to work
> would be appreciated.

Put a syntax error in your .htaccess file. Ie., add a line consisting of
"XXX" by itself. If the .htaccess file is actually being consulted, you
should now get a 500 error due to the syntax error.

If no 500 error, then Apache is probably configured not to allow use of
.htaccess files in that part of the document tree and as a result, the
higher level CGI definitions are taking precedence.

Graham
From paolophp3 at gmail.com  Sat Dec  3 06:19:49 2005
From: paolophp3 at gmail.com (Paolo)
Date: Sat Dec  3 06:20:14 2005
Subject: [mod_python] Help with Apache and mod_python
In-Reply-To: <2F7677FC-DCD9-49ED-A669-B3DA39121064@dscpl.com.au>
References: <5e6decd0512020035x6d801eccs@mail.gmail.com>
	<03BF0B31-3F2E-4DE3-8194-6BE04A36329C@dscpl.com.au>
	<5e6decd0512020536gb716639y@mail.gmail.com>
	<2F7677FC-DCD9-49ED-A669-B3DA39121064@dscpl.com.au>
Message-ID: <5e6decd0512030319y5269aa0ag@mail.gmail.com>

2005/12/3, Graham Dumpleton <grahamd@dscpl.com.au>:
>
>
> Next step then would be to import into the handler of your test code,
> the module which you specify needs to be imported in order to make
> use of Django.


Now mptest.py looks like:
from mod_python import apache

def handler(req):
    import django.core.handlers.modpython
    req.content_type = 'text/plain'
    req.write('mptest.py\n')
    return apache.OK


> If done in the test handler function, accessing the
> test URL will cause it to be imported and if it does crash at that point
> you have confirmed that it is the actual import of the Django stuff that
> is the problem.


It seems that django.core.handlers.modpython is imported very well, as in
error_log I can't see signs of crash and 'mptest.py' is still printed.

I have something new to say.
This morning I created a Django project (called erp) to be used as a test.
Then I have configured Apache with the same lines in httpd.conf used for the
other project (called cardano), discovering that erp project is served fine
by Apache, while cardano project crashes Apache.

These are the lines of httpd.conf that have been added:

# test project - it works
<VirtualHost 192.168.0.68:85>
DocumentRoot "/home/paolo/projects/django"
<Location "/">
    SetHandler mod_python
    PythonHandler django.core.handlers.modpython
    PythonPath "['/home/paolo/projects/django']+sys.path"
    SetEnv DJANGO_SETTINGS_MODULE erp.settings
    PythonDebug On
    PythonInterpreter erp
</Location>
</VirtualHost>

# the other project - it doesn't work
<VirtualHost 192.168.0.68:86>
DocumentRoot "/home/paolo/projects/django"
<Location "/">
    SetHandler mod_python
    PythonHandler django.core.handlers.modpython
    PythonPath "['/home/paolo/projects/django']+sys.path"
    SetEnv DJANGO_SETTINGS_MODULE cardano.settings
    PythonDebug On
    PythonInterpreter cardano
</Location>
</VirtualHost>

I hope these new indications can help, thanks very much for your support.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20051203/f041b605/attachment.html
From andrew_s_webb at yahoo.com  Mon Dec  5 06:24:44 2005
From: andrew_s_webb at yahoo.com (Andrew Webb)
Date: Mon Dec  5 06:24:59 2005
Subject: [mod_python] Apache can't find mod_python
Message-ID: <20051205112444.45779.qmail@web31613.mail.mud.yahoo.com>

This is Apache 2055 on XP Pro, can't find mod_python
in modules directory, even though it is there. I saw
this in FAQ 2.10 but A. that is 2003 & b. what is a
dotnet redistributable?

Appreciate any help going. 


		
__________________________________ 
Start your day with Yahoo! - Make it your home page! 
http://www.yahoo.com/r/hs
From dsr at best-off.org  Mon Dec  5 07:14:46 2005
From: dsr at best-off.org (Daniel S. Reichenbach)
Date: Mon Dec  5 07:14:51 2005
Subject: [mod_python] Segfaults when running mod_python and mod_php4/mod_php5
Message-ID: <1133784886.18574.24.camel@theater-mob.best-off.lan>

Hi,

at the weekend I have installed a small host for my private software
projects based on current Debian Testing branch.

The plan was to install a SubVersion repository as well as the Trac
issue tracker (http://projects.edgewall.com/trac/).

I have installed Apache 2, version 2.0.54 with mod_python 3.1.3,
as well as Trac 0.9.1 with SubVersion 1.2.3 as backend.

Now I configured things according to this page:
http://projects.edgewall.com/trac/wiki/TracModPython

So far everything worked.

Now I needed to add mod-php4 or mod-php5 since there should run a
forum on the server, too. I installed PHP 4.4.0 and now things start
to get strange.

Both PHP and Python seem to work, as I can open the configured web
sites, both living on different vhosts. Now when I try to login to
Trac, mod_python will segfault. Actually it's this configuration part:

<Location "/projects/myproject/login">
  AuthType Basic
  AuthName "myproject"
  AuthUserFile /var/trac/myproject/.htaccess
  Require valid-user
</Location>

Situation: Trac site and PHP site work, until someone tries to login.
Afterwords PHP will stay alive and working, each call to mod_python
causes segfault in error log.

If I don't have login enabled, Python and thus Trac will work. Is this
a known issue or are there perhaps any solutions to this?

What I have checked so far: FAQ hint on libraries. PHP and Python use
the same ones. Disabling PHP for the login location, does not change
anything. Without PHP everything works fine. As well tried to use
AddHandler instead of SetHandler, this as well results in segfaults
when logging in.

With kind regards,
Daniel
-- 
blog - http://people.best-off.org/~dsr/
gpg  - http://people.best-off.org/~dsr/gpg.asc
work - http://www.best-off.org/

-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20051205/70b9f578/attachment.bin
From t.schneider at livingliquid.com  Mon Dec  5 08:15:19 2005
From: t.schneider at livingliquid.com (T.Schneider@livingliquid)
Date: Mon Dec  5 08:15:34 2005
Subject: [mod_python] mod_python with apache 2.2.0 is not working
Message-ID: <024901c5f99d$f480a360$e151a8c0@blomma>

hi list,

i compiled today mod_python with the new apache 2.2.0 but it is not working.
if i load the module i get the following error message:

--
httpd: Syntax error on line 100 of /usr/local/apache2/conf/httpd.conf:
Cannot load /usr/local/apache2/modules/mod_python.so into server:
/usr/local/apache2/modules/mod_python.so: undefined symbol:
APR_STATUS_IS_SUCCESS
--

any help would be nice,

regards,
thomas 

From jcigar at ulb.ac.be  Mon Dec  5 09:05:55 2005
From: jcigar at ulb.ac.be (Julien Cigar)
Date: Mon Dec  5 09:05:25 2005
Subject: [mod_python] Segfaults when running mod_python and
	mod_php4/mod_php5
In-Reply-To: <1133784886.18574.24.camel@theater-mob.best-off.lan>
References: <1133784886.18574.24.camel@theater-mob.best-off.lan>
Message-ID: <43944943.2040004@ulb.ac.be>

Are you using SSL ?

I'm also running debian testing and mod_python segfaults when ssl is 
enabled in Postgresql ...
I don't think that the maintener of libapache2-mod-python is still 
active ... (?)

I suspect that libapache2-mod-python on debian should be recompiled 
because of some libraries upgrade ...

Regards,
Julien

Daniel S. Reichenbach wrote:

>Hi,
>
>at the weekend I have installed a small host for my private software
>projects based on current Debian Testing branch.
>
>The plan was to install a SubVersion repository as well as the Trac
>issue tracker (http://projects.edgewall.com/trac/).
>
>I have installed Apache 2, version 2.0.54 with mod_python 3.1.3,
>as well as Trac 0.9.1 with SubVersion 1.2.3 as backend.
>
>Now I configured things according to this page:
>http://projects.edgewall.com/trac/wiki/TracModPython
>
>So far everything worked.
>
>Now I needed to add mod-php4 or mod-php5 since there should run a
>forum on the server, too. I installed PHP 4.4.0 and now things start
>to get strange.
>
>Both PHP and Python seem to work, as I can open the configured web
>sites, both living on different vhosts. Now when I try to login to
>Trac, mod_python will segfault. Actually it's this configuration part:
>
><Location "/projects/myproject/login">
>  AuthType Basic
>  AuthName "myproject"
>  AuthUserFile /var/trac/myproject/.htaccess
>  Require valid-user
></Location>
>
>Situation: Trac site and PHP site work, until someone tries to login.
>Afterwords PHP will stay alive and working, each call to mod_python
>causes segfault in error log.
>
>If I don't have login enabled, Python and thus Trac will work. Is this
>a known issue or are there perhaps any solutions to this?
>
>What I have checked so far: FAQ hint on libraries. PHP and Python use
>the same ones. Disabling PHP for the login location, does not change
>anything. Without PHP everything works fine. As well tried to use
>AddHandler instead of SetHandler, this as well results in segfaults
>when logging in.
>
>With kind regards,
>Daniel
>  
>
>------------------------------------------------------------------------
>
>_______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org
>http://mailman.modpython.org/mailman/listinfo/mod_python
>  
>

From jcigar at ulb.ac.be  Mon Dec  5 09:38:59 2005
From: jcigar at ulb.ac.be (Julien Cigar)
Date: Mon Dec  5 09:37:56 2005
Subject: [mod_python] Segfaults when running mod_python
	and	mod_php4/mod_php5
In-Reply-To: <1133792227.20797.3.camel@theater-mob.best-off.lan>
References: <1133784886.18574.24.camel@theater-mob.best-off.lan>	
	<43944943.2040004@ulb.ac.be>
	<1133792227.20797.3.camel@theater-mob.best-off.lan>
Message-ID: <43945103.8000503@ulb.ac.be>

Daniel S. Reichenbach wrote:

>On Mon, 2005-12-05 at 15:05 +0100, Julien Cigar wrote:
>  
>
>>Are you using SSL ?
>>    
>>
>Yes, could this cause this issue?
>
>  
>
Yes it could be the cause of the issue ...

>>I don't think that the maintener of libapache2-mod-python is still 
>>active ... (?)
>>    
>>
>At least there is only mod_python 3.1.3 in all branches. So one might
>thinks its really unmaintained.
>
>  
>
I think that something has been forgotten to be recompiled during the 
transition of libssl0.9.7 -> libssl0.9.8

>With kind regards,
>Daniel
>  
>

From list at joreybump.com  Mon Dec  5 09:37:56 2005
From: list at joreybump.com (Jorey Bump)
Date: Mon Dec  5 09:38:15 2005
Subject: [mod_python] mod_python with apache 2.2.0 is not working
In-Reply-To: <024901c5f99d$f480a360$e151a8c0@blomma>
References: <024901c5f99d$f480a360$e151a8c0@blomma>
Message-ID: <439450C4.30207@joreybump.com>

T.Schneider@livingliquid wrote:
> hi list,
> 
> i compiled today mod_python with the new apache 2.2.0 but it is not 
> working.
> if i load the module i get the following error message:
> 
> -- 
> httpd: Syntax error on line 100 of /usr/local/apache2/conf/httpd.conf:
> Cannot load /usr/local/apache2/modules/mod_python.so into server:
> /usr/local/apache2/modules/mod_python.so: undefined symbol:
> APR_STATUS_IS_SUCCESS

I've attached a source tree patch against 3.2.5b that identifies and, in 
some cases, *bypasses* some of the issues that prevent mod_python from 
operating with apache 2.2.0. IT IS NOT A FIX, but may be useful to help 
with the related discussion on the mod_python developer's list, python-dev.

The changes are small. The test suite will still fail, possibly related 
to the patch, but Apache 2.2.0 will now be able to load and run 
mod_python. Please try out your applications against it, and send any 
useful information/observations to python-dev. Consider the patch to be 
unsuitable for production use until a proper version is released that is 
backwards-compatible with Apache 2.0.x, restores all functionality, and 
passes all tests in the test suite. YOU HAVE BEEN WARNED.

To apply the patch, move into the source code directory and issue the 
following command:

   patch -p1 < /path/to/mod_python-3.2.5b.patch

-------------- next part --------------
diff -uNr mod_python-3.2.5b/src/connobject.c mod_python-3.2.5b.new/src/connobject.c
--- mod_python-3.2.5b/src/connobject.c	2005-11-12 13:59:35.000000000 -0500
+++ mod_python-3.2.5b.new/src/connobject.c	2005-12-03 15:26:27.000000000 -0500
@@ -78,12 +78,6 @@
     rc = ap_get_brigade(c->input_filters, bb, mode, APR_BLOCK_READ, bufsize);
     Py_END_ALLOW_THREADS;
 
-    if (! APR_STATUS_IS_SUCCESS(rc)) {
-        PyErr_SetObject(PyExc_IOError, 
-                        PyString_FromString("Connection read error"));
-        return NULL;
-    }
-
     /* 
      * loop through the brigade reading buckets into the string 
      */
@@ -312,24 +306,17 @@
  **
  *  utility func to make a socket address
  */
-
 static PyObject *makesockaddr(struct apr_sockaddr_t *addr)
-{
+{   
     PyObject *addrobj = makeipaddr(addr);
     PyObject *ret = NULL;
     if (addrobj) {
-        apr_port_t port;
-        if(apr_sockaddr_port_get(&port, addr)==APR_SUCCESS) {
-            ret = Py_BuildValue("Oi", addrobj, port );
-        }
-        else {
-            PyErr_SetString(PyExc_SystemError,"apr_sockaddr_port_get failure");
-        }
+        ret = Py_BuildValue("Oi", addrobj, ntohs(addr->sa.sin.sin_port));
         Py_DECREF(addrobj);
     }
     return ret;
 }
-
+    
 /**
  ** conn_getattr
  **
diff -uNr mod_python-3.2.5b/src/filterobject.c mod_python-3.2.5b.new/src/filterobject.c
--- mod_python-3.2.5b/src/filterobject.c	2004-11-25 17:10:52.000000000 -0500
+++ mod_python-3.2.5b.new/src/filterobject.c	2005-12-03 14:20:29.000000000 -0500
@@ -178,11 +178,6 @@
                                   APR_BLOCK_READ, self->readbytes);
         Py_END_ALLOW_THREADS;
 
-        if (!APR_STATUS_IS_EAGAIN(self->rc) && !APR_STATUS_IS_SUCCESS(self->rc)) {
-            PyErr_SetObject(PyExc_IOError, 
-                            PyString_FromString("Input filter read error"));
-            return NULL;
-        }
     }
 
     /* 
diff -uNr mod_python-3.2.5b/test/test.py mod_python-3.2.5b.new/test/test.py
--- mod_python-3.2.5b/test/test.py	2005-11-14 13:09:49.000000000 -0500
+++ mod_python-3.2.5b.new/test/test.py	2005-12-03 14:23:45.000000000 -0500
@@ -242,9 +242,9 @@
             PythonOption('PythonOptionTest sample_value'),
             DocumentRoot(DOCUMENT_ROOT),
             LoadModule("python_module %s" % MOD_PYTHON_SO),
-            IfModule("!mod_auth.c",
-                     LoadModule("auth_module %s" %
-                                quoteIfSpace(os.path.join(modpath, "mod_auth.so")))))
+            IfModule("!mod_auth_basic.c",
+                     LoadModule("auth_basic_module %s" %
+                                quoteIfSpace(os.path.join(modpath, "mod_auth_basic.so")))))
 
         f = open(CONFIG, "w")
         f.write(str(s))
From dsr at best-off.org  Mon Dec  5 09:52:47 2005
From: dsr at best-off.org (Daniel S. Reichenbach)
Date: Mon Dec  5 09:52:52 2005
Subject: [mod_python] Segfaults when running mod_python
	and	mod_php4/mod_php5
In-Reply-To: <43945103.8000503@ulb.ac.be>
References: <1133784886.18574.24.camel@theater-mob.best-off.lan>
	<43944943.2040004@ulb.ac.be>
	<1133792227.20797.3.camel@theater-mob.best-off.lan>
	<43945103.8000503@ulb.ac.be>
Message-ID: <1133794367.21347.3.camel@theater-mob.best-off.lan>

> >>Are you using SSL ?
> >Yes, could this cause this issue?
> Yes it could be the cause of the issue ...
Oh sorry, didn't notice that the list does not set Reply-To header.

Anyway, I'll try without SSL enabled and see if the segfault still
occurs.

With kind regards,
Daniel
-- 
blog - http://people.best-off.org/~dsr/
gpg  - http://people.best-off.org/~dsr/gpg.asc
work - http://www.best-off.org/

-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20051205/1ec7d6c0/attachment.bin
From jd at commandprompt.com  Mon Dec  5 17:32:50 2005
From: jd at commandprompt.com (Joshua D. Drake)
Date: Mon Dec  5 17:32:47 2005
Subject: [mod_python] Compiling on X86_64?
Message-ID: <4394C012.3030804@commandprompt.com>

Hello,

I have a FC2 machine that is giving me some grief.

gcc 3.3.3
python 242
libtool-1.5.16
Apache 2.0.52

Configure command:

 ./configure --with-apxs=/usr/local/apache2/bin/apxs 
--with-python=/usr/local/python242/bin/python

Make result:
*** Warning: linker path does not have real file for library -lm.
*** I have the capability to make that library automatically link in when
*** you link to this library.  But I can only do this if you have a
*** shared version of the library, which you do not appear to have
*** because I did check the linker path looking for a file starting
*** with libm and none of the candidates passed a file format test
*** using a file magic. Last file checked: 
/usr/local/lib/libpython2.4.so.1.0

*** Warning: libtool could not satisfy all declared inter-library
*** dependencies of module mod_python.  Therefore, libtool will create
*** a static module, that should work as long as the dlopening
*** application is linked with the -dlopen flag.
make[2]: Leaving directory `/usr/local/src/mod_python-3.1.4/src'
make[2]: Entering directory `/usr/local/src/mod_python-3.1.4/dist'
make[3]: Entering directory `/usr/local/src/mod_python-3.1.4/src'
make[3]: `psp_parser.c' is up to date.
make[3]: Leaving directory `/usr/local/src/mod_python-3.1.4/src'
/usr/local/python242/bin/python setup.py build
running build
running build_py
running build_ext
make[2]: Leaving directory `/usr/local/src/mod_python-3.1.4/dist'

Now su and make install
  (or, if you only want to perform a partial install,
   you can use make install_dso and make install_py_lib)


Performing DSO installation.

/usr/bin/install -c -d /usr/local/apache2/modules
/usr/bin/install -c src/mod_python.so /usr/local/apache2/modules
/usr/bin/install: cannot stat `src/mod_python.so': No such file or directory
make[1]: *** [install_dso] Error 1
make[1]: Leaving directory `/usr/local/src/mod_python-3.1.4'
make: *** [install] Error 2
[root@hosting-two mod_python-3.1.4]#

A quick look in src/.libs shows that mod_python.a is created but not the so?

Sincerely

Joshua D. Drake
 

From blackhex at post.cz  Mon Dec  5 17:12:31 2005
From: blackhex at post.cz (Radek =?iso-8859-2?q?Barto=F2?=)
Date: Mon Dec  5 17:38:45 2005
Subject: [mod_python] Getting request object
In-Reply-To: <mailman.0.1133820802.32219.mod_python@modpython.org>
References: <mailman.0.1133820802.32219.mod_python@modpython.org>
Message-ID: <200512052312.31029.blackhex@post.cz>

Hello.
I like using mod_python's mod_python.publisher like this:

class MyClass:
  def __init__(self):
    # can I get request object here?
    ...
  def __str__(self):
    ...
  def method1(self, req):
    ...
  def method2(self, req):
    ...

# or can I get request object here and pass it to MyClass's constructor?
index = MyClass():
...

instead of classic usage:

....
def index(req)
   instance = MyClass()
   ....

because you can access each class method by typing URL (i. e. 
http://hostname/file/index/method1) or you can access object itself (i. e. 
http://hostname/file). The problem is that when you use second way you can't 
pass request object in class's constructor. Is there any posibility how to 
get request object in class's constructor or in global scope?
From grisha at modpython.org  Mon Dec  5 18:13:25 2005
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Mon Dec  5 18:13:32 2005
Subject: [mod_python] Compiling on X86_64?
In-Reply-To: <4394C012.3030804@commandprompt.com>
References: <4394C012.3030804@commandprompt.com>
Message-ID: <20051205181157.K59199@grisha.dyndns.org>


On Mon, 5 Dec 2005, Joshua D. Drake wrote:

> *** Warning: linker path does not have real file for library -lm.

Do you have glibc-devel installed?

Grisha
From grahamd at dscpl.com.au  Mon Dec  5 18:27:16 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon Dec  5 18:27:19 2005
Subject: [mod_python] Getting request object
Message-ID: <1133825236.14342@dscpl.user.openhosting.com>

Radek =?iso-8859-2?q?Barto=F2?= wrote ..
> instead of classic usage:
> 
> ....
> def index(req)
>    instance = MyClass()
>    ....
> 
> because you can access each class method by typing URL (i. e. 
> http://hostname/file/index/method1) or you can access object itself (i.
> e. 
> http://hostname/file). The problem is that when you use second way you
> can't 
> pass request object in class's constructor. Is there any posibility how
> to 
> get request object in class's constructor or in global scope?

I maybe don't understand what you are asking, but why can't you do:

  def index(req):
    instance = MyClass(req)
    ...

This is presuming that you are creating an instance of MyClass for each
request.

Graham
From jd at commandprompt.com  Mon Dec  5 20:21:03 2005
From: jd at commandprompt.com (Joshua D. Drake)
Date: Mon Dec  5 20:21:04 2005
Subject: [mod_python] Compiling on X86_64?
In-Reply-To: <20051205181157.K59199@grisha.dyndns.org>
References: <4394C012.3030804@commandprompt.com>
	<20051205181157.K59199@grisha.dyndns.org>
Message-ID: <4394E77F.4010307@commandprompt.com>

Gregory (Grisha) Trubetskoy wrote:
>
> On Mon, 5 Dec 2005, Joshua D. Drake wrote:
>
>> *** Warning: linker path does not have real file for library -lm.
>
> Do you have glibc-devel installed?
Yes. I have seen a similar warning before when compiling PHP for x86_64. 
The only thing I had to do there was
edit the libtool file that ships with PHP to:

# Compile-time system search path for libraries
sys_lib_search_path_spec="/lib64 /usr/lib64 /lib /usr/lib /usr/local/lib"

# Run-time system search path for libraries
sys_lib_dlsearch_path_spec="/lib64 /usr/lib64 /lib /usr/lib"

But the similar fix does not work for mod_python.

Joshua D. Drake


>
> Grisha

From grisha at modpython.org  Mon Dec  5 22:39:54 2005
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Mon Dec  5 22:39:59 2005
Subject: [mod_python] Compiling on X86_64?
In-Reply-To: <4394E77F.4010307@commandprompt.com>
References: <4394C012.3030804@commandprompt.com>
	<20051205181157.K59199@grisha.dyndns.org>
	<4394E77F.4010307@commandprompt.com>
Message-ID: <20051205223847.X66546@grisha.dyndns.org>


Could you try mod_python 3.2.5b, I seem to recall this (or similar?) issue 
being fixed.

Grisha

On Mon, 5 Dec 2005, Joshua D. Drake wrote:

> Gregory (Grisha) Trubetskoy wrote:
>> 
>> On Mon, 5 Dec 2005, Joshua D. Drake wrote:
>> 
>>> *** Warning: linker path does not have real file for library -lm.
>> 
>> Do you have glibc-devel installed?
> Yes. I have seen a similar warning before when compiling PHP for x86_64. The 
> only thing I had to do there was
> edit the libtool file that ships with PHP to:
>
> # Compile-time system search path for libraries
> sys_lib_search_path_spec="/lib64 /usr/lib64 /lib /usr/lib /usr/local/lib"
>
> # Run-time system search path for libraries
> sys_lib_dlsearch_path_spec="/lib64 /usr/lib64 /lib /usr/lib"
>
> But the similar fix does not work for mod_python.
>
> Joshua D. Drake
>
>
>> 
>> Grisha
>
From enotus at tut.by  Tue Dec  6 01:57:47 2005
From: enotus at tut.by (Enot)
Date: Tue Dec  6 01:57:08 2005
Subject: [mod_python] How check permissions to GET JPG image
Message-ID: <1803113527.20051206085747@tut.by>

Hello mod,

I need check permissions to GET JPG images and ZIP files. After that i
need convert JPG image name and URL to internal form.

When I use req.sendfile() all works exept for download resume. After
download stops at middle, resume is impossibe. Error in download
manager when trying resume.

What can I do?


Sorry for English.
Best regards,
Enot                          mailto:enotus@tut.by

From nlv11281 at natlab.research.philips.com  Tue Dec  6 02:20:55 2005
From: nlv11281 at natlab.research.philips.com (Mike Looijmans)
Date: Tue Dec  6 02:21:01 2005
Subject: [mod_python] How check permissions to GET JPG image
In-Reply-To: <1803113527.20051206085747@tut.by>
References: <1803113527.20051206085747@tut.by>
Message-ID: <43953BD7.1060901@natlab.research.philips.com>

Enot wrote:
> I need check permissions to GET JPG images and ZIP files.

Use any authorization/authentication scheme you like. There are plenty. 
Simplest is to program "if password == 's3cret': ..." Even apache will 
do it for you.

> After that i need convert JPG image name and URL to internal form.

No idea what you mean ???

> When I use req.sendfile() all works exept for download resume. After
> download stops at middle, resume is impossibe. Error in download
> manager when trying resume.

You will probably have to implement the HTTP/1.1 "Range" header. Is not 
hard to program, but will take a little finger typing. Find the HTTP RFC 
2616, and look for "Range".

Mike.

From enotus at tut.by  Tue Dec  6 08:15:15 2005
From: enotus at tut.by (Enot)
Date: Tue Dec  6 08:14:36 2005
Subject: [mod_python] How check permissions to GET JPG image
In-Reply-To: <43953BD7.1060901@natlab.research.philips.com>
References: <1803113527.20051206085747@tut.by>
	<43953BD7.1060901@natlab.research.philips.com>
Message-ID: <1603761136.20051206151515@tut.by>

Hello Mike,

>> I need check permissions to GET JPG images and ZIP files.
ML> Use any authorization/authentication scheme you like. ...

Its OK with authorization.

>> After that i need convert JPG image name and URL to internal form.
ML> No idea what you mean ???

Request URL "http://www.hostname.org/Article/ArticleOne/Image1.jpg"
after authorization i need seend "c://webdir/Images/Article_ArticleOne_Image1.jpg"

How redirect Apache or use req.sendfile() with resume?


>> When I use req.sendfile() all works exept for download resume. After
>> download stops at middle, resume is impossibe. Error in download
>> manager when trying resume.
ML> You will probably have to implement the HTTP/1.1 "Range" header. Is not
ML> hard to program, but will take a little finger typing. Find the HTTP RFC
ML> 2616, and look for "Range".

How i can access HTTP/1.1 "Range" header from mod_python? I found
nothing about "Range" header. "req.range" always "None",
"req.headers_out" do nothing at least when using with
"req.sendfile()".
As i understand, Apache or rewrite header when using "req.sendfile()".
And this is main problem.


Thanks,
Enot                            mailto:enotus@tut.by

From nlv11281 at natlab.research.philips.com  Tue Dec  6 08:34:13 2005
From: nlv11281 at natlab.research.philips.com (Mike Looijmans)
Date: Tue Dec  6 08:34:37 2005
Subject: [mod_python] How check permissions to GET JPG image
In-Reply-To: <1603761136.20051206151515@tut.by>
References: <1803113527.20051206085747@tut.by>	<43953BD7.1060901@natlab.research.philips.com>
	<1603761136.20051206151515@tut.by>
Message-ID: <43959355.804@natlab.research.philips.com>


>>>When I use req.sendfile() all works exept for download resume. After
>>>download stops at middle, resume is impossibe. Error in download
>>>manager when trying resume.
> 
> ML> You will probably have to implement the HTTP/1.1 "Range" header. Is not
> ML> hard to program, but will take a little finger typing. Find the HTTP RFC
> ML> 2616, and look for "Range".
> 
> How i can access HTTP/1.1 "Range" header from mod_python? I found
> nothing about "Range" header. "req.range" always "None",
> "req.headers_out" do nothing at least when using with
> "req.sendfile()".
> As i understand, Apache or rewrite header when using "req.sendfile()".
> And this is main problem.

The Range header is sent by the client, so it will be in headers_in (not 
in headers-out, which is what the client will receive from you).

You must read the RFC2616 documentation and implement what is described 
there. I'm sorry, there's no free lunch.

But before doing so, verify that your "download manager" is actually 
using that header. One way to do so is to abort a download, attempt a 
resume and see what gets sent to the server (have your python script 
dump the headers_in to a text file or so). If there's no "Range" in the 
headers, implementing it will not help you solve your problem.

The range header normally specifies what the client wants, so you can 
set up a correct response (read the RFC!) open the file, seek to the 
requested position (using file.seek(..)) and start sending from there.

From enotus at tut.by  Tue Dec  6 10:26:43 2005
From: enotus at tut.by (Enot)
Date: Tue Dec  6 10:26:43 2005
Subject: [mod_python] How check permissions to GET JPG image
In-Reply-To: <43959355.804@natlab.research.philips.com>
References: <1803113527.20051206085747@tut.by>
	<43953BD7.1060901@natlab.research.philips.com>
	<1603761136.20051206151515@tut.by>
	<43959355.804@natlab.research.philips.com>
Message-ID: <2210377802.20051206172643@tut.by>

Hello Mike,

>>>>When I use req.sendfile() all works exept for download resume. After
>>>>download stops at middle, resume is impossibe. Error in download
>>>>manager when trying resume.
>> 
>> ML> You will probably have to implement the HTTP/1.1 "Range" header. Is not
>> ML> hard to program, but will take a little finger typing. Find the HTTP RFC
>> ML> 2616, and look for "Range".
>> 
>> How i can access HTTP/1.1 "Range" header from mod_python? I found
>> nothing about "Range" header. "req.range" always "None",
>> "req.headers_out" do nothing at least when using with
>> "req.sendfile()".
>> As i understand, Apache or rewrite header when using "req.sendfile()".
>> And this is main problem.

ML> The Range header is sent by the client, so it will be in headers_in (not
ML> in headers-out, which is what the client will receive from you).
I know this basics. Thanks.

ML> You must read the RFC2616 documentation and implement what is described
ML> there. I'm sorry, there's no free lunch.
Not a problem.

ML> But before doing so, verify that your "download manager" is actually
ML> using that header. One way to do so is to abort a download, attempt a
ML> resume and see what gets sent to the server (have your python script
ML> dump the headers_in to a text file or so). If there's no "Range" in the
ML> headers, implementing it will not help you solve your problem.
I tryed that befor posting my problem.

ML> The range header normally specifies what the client wants, so you can
ML> set up a correct response (read the RFC!) open the file, seek to the
ML> requested position (using file.seek(..)) and start sending from there.
The problem is in mod_python. When i use "req.sendfile()"
my "req.headers_out" probably are rewrited by Apache.
Is any way to use "req.sendfile()" with resume? Where i must search?

Using "req.write()" for lage files is very bad.
Can i use successive "req.write(); req.flush()" with small pieces of
lage file?

-- 
Best regards,
 Enot                            mailto:enotus@tut.by

From blackhex at post.cz  Tue Dec  6 13:09:23 2005
From: blackhex at post.cz (Radek =?iso-8859-2?q?Barto=F2?=)
Date: Tue Dec  6 13:35:39 2005
Subject: [mod_python] Getting request object
In-Reply-To: <1133825236.14342@dscpl.user.openhosting.com>
References: <1133825236.14342@dscpl.user.openhosting.com>
Message-ID: <200512061909.23537.blackhex@post.cz>

Dne ?ter? 06 prosinec 2005 00:27 Graham Dumpleton napsal(a):

When I use 

def index(req):
    instance = MyClass(req)
    ...

I can't access any method of instance by typing URL 
http://hostname/file/index/instance/method1 in web browser, or am I wrong?
I tried this yesterday but it didn't work. 

> I maybe don't understand what you are asking, but why can't you do:
>
>   def index(req):
>     instance = MyClass(req)
>     ...
>
> This is presuming that you are creating an instance of MyClass for each
> request.
>
> Graham

From jd at commandprompt.com  Tue Dec  6 16:17:05 2005
From: jd at commandprompt.com (Joshua D. Drake)
Date: Tue Dec  6 16:15:17 2005
Subject: [mod_python] Compiling on X86_64?
In-Reply-To: <20051205223847.X66546@grisha.dyndns.org>
References: <4394C012.3030804@commandprompt.com>
	<20051205181157.K59199@grisha.dyndns.org>
	<4394E77F.4010307@commandprompt.com>
	<20051205223847.X66546@grisha.dyndns.org>
Message-ID: <1133903826.18643.39.camel@jd.commandprompt.com>

On Mon, 2005-12-05 at 22:39 -0500, Gregory (Grisha) Trubetskoy wrote:
> Could you try mod_python 3.2.5b, I seem to recall this (or similar?) issue 
> being fixed.

Unfortunately there was no change... I even upgraded flex as requested
by the ./configure script.

Joshua D. Drake

> 
> Grisha
> 
> On Mon, 5 Dec 2005, Joshua D. Drake wrote:
> 
> > Gregory (Grisha) Trubetskoy wrote:
> >> 
> >> On Mon, 5 Dec 2005, Joshua D. Drake wrote:
> >> 
> >>> *** Warning: linker path does not have real file for library -lm.
> >> 
> >> Do you have glibc-devel installed?
> > Yes. I have seen a similar warning before when compiling PHP for x86_64. The 
> > only thing I had to do there was
> > edit the libtool file that ships with PHP to:
> >
> > # Compile-time system search path for libraries
> > sys_lib_search_path_spec="/lib64 /usr/lib64 /lib /usr/lib /usr/local/lib"
> >
> > # Run-time system search path for libraries
> > sys_lib_dlsearch_path_spec="/lib64 /usr/lib64 /lib /usr/lib"
> >
> > But the similar fix does not work for mod_python.
> >
> > Joshua D. Drake
> >
> >
> >> 
> >> Grisha
> >
-- 
The PostgreSQL Company - Command Prompt, Inc. 1.503.667.4564
PostgreSQL Replication, Consulting, Custom Development, 24x7 support
Managed Services, Shared and Dedicated Hosting
Co-Authors: PLphp, PLperl, ODBCng - http://www.commandprompt.com/


From grahamd at dscpl.com.au  Tue Dec  6 16:49:11 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Dec  6 16:49:15 2005
Subject: [mod_python] How check permissions to GET JPG image
Message-ID: <1133905751.6569@dscpl.user.openhosting.com>

Enot wrote ..
> ML> The range header normally specifies what the client wants, so you can
> ML> set up a correct response (read the RFC!) open the file, seek to the
> ML> requested position (using file.seek(..)) and start sending from there.
> The problem is in mod_python. When i use "req.sendfile()"
> my "req.headers_out" probably are rewrited by Apache.
> Is any way to use "req.sendfile()" with resume? Where i must search?
> 
> Using "req.write()" for lage files is very bad.
> Can i use successive "req.write(); req.flush()" with small pieces of
> lage file?

You shouldn't need to use file.seek() or req.write() as req.sendfile() allows
an offset to be specified.

  sendfile(path[, offset, len])

    Sends len bytes of file path directly to the client, starting at offset
    offset using the server's internal API. offset defaults to 0, and len
    defaults to -1 (send the entire file).

    This function provides the most efficient way to send a file to the client.

Thus calculate from the headers where you need to start and tell
req.sendfile() to start there instead.

Graham
From grahamd at dscpl.com.au  Tue Dec  6 17:53:58 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Dec  6 17:54:01 2005
Subject: [mod_python] Getting request object
Message-ID: <1133909638.15567@dscpl.user.openhosting.com>

Going back to your original email ....

Radek =?iso-8859-2?q?Barto=F2?= wrote ..
> Hello.
> I like using mod_python's mod_python.publisher like this:
> 
> class MyClass:
>   def __init__(self):
>     # can I get request object here?
>     ...
>   def __str__(self):
>     ...
>   def method1(self, req):
>     ...
>   def method2(self, req):
>     ...
> 
> # or can I get request object here and pass it to MyClass's constructor?
> index = MyClass():
> ...

If what it is that you want is that an instance of MyClass be created
specific for each request, before any URL mapping against methods is
being done, then using mod_python.publisher alone the answer is that no
it cannot be done easily. Unless my brain is overlooking something
obvious, you have to do something convoluted like:

from mod_python import util, apache

import types

class Wrapper:
  
  def __init__(self,function):
    self.__class = function.im_class
    self.__name = function.im_func.__name__

  def __call__(self,req):
    instance = self.__class(req)
    function = getattr(instance,self.__name)
    return util.apply_fs_data(function,req.form)

class MyClass:

  def __init__(self,req):
    self.__req = req

  def method1(self):
    return "method1"

  def method2(self):
    return "method2"

class Object: pass

index = Object()
index.method1 = Wrapper(MyClass.method1)
index.method2 = Wrapper(MyClass.method2)

Apart from that, if you were using Vampire, you could simply use basic
handlers are write:

import vampire

class MyClass:

  def __init__(self,req):
    self.__req = req

  def __call__(self):
    return "__call__"

  def method1(self):
    return "method1",self.__req.filename

  def method2(self, req):
    return "method2",req.filename

handler = vampire.Publisher(MyClass)

The vampire.Publisher() wrapper class handlers both creating an instance
of the class and mapping URLs onto methods of the instance. It only
supports callable methods in classes though. Ie., it will not map URLs
to __str__() or to basic data types which are a member of the class.

Note that creating an instance of a class per request could be quite
inefficient. What is the original reason that you wanted to access the
request object in the constructor in the first place?

Graham




From blackhex at post.cz  Wed Dec  7 03:21:34 2005
From: blackhex at post.cz (Radek =?iso-8859-2?q?Barto=F2?=)
Date: Wed Dec  7 03:47:50 2005
Subject: [mod_python] Getting request object
In-Reply-To: <1133909638.15567@dscpl.user.openhosting.com>
References: <1133909638.15567@dscpl.user.openhosting.com>
Message-ID: <200512070921.35487.blackhex@post.cz>

Hello, thanks for your reply.

> If what it is that you want is that an instance of MyClass be created
> specific for each request, before any URL mapping against methods is
> being done, then using mod_python.publisher alone the answer is that no
> it cannot be done easily. Unless my brain is overlooking something
> obvious, you have to do something convoluted like:
>
> from mod_python import util, apache
>
> import types
>
> class Wrapper:
>
>   def __init__(self,function):
>     self.__class = function.im_class
>     self.__name = function.im_func.__name__
>
>   def __call__(self,req):
>     instance = self.__class(req)
>     function = getattr(instance,self.__name)
>     return util.apply_fs_data(function,req.form)
>
> class MyClass:
>
>   def __init__(self,req):
>     self.__req = req
>
>   def method1(self):
>     return "method1"
>
>   def method2(self):
>     return "method2"
>
> class Object: pass
>
> index = Object()
> index.method1 = Wrapper(MyClass.method1)
> index.method2 = Wrapper(MyClass.method2)

 I tried this wrapper. When I typed URL http://localhost/test.py/index page 
returned string representation of object so I could write __str__ function of 
Object class to make it working. But URLs  
http://localhost/test.py/index/method1 and  
http://localhost/test.py/index/method2 returned errors "Not Found".
  Nevertheless I think that functionality of this wrapper was mentioned same 
as functionality of my first example:

class MyClass:
 ? def __init__(self):
  ? ? ...
 ? def __str__(self):
 ? ? ...
 ? def method1(self, req):
 ? ? ...
 ? def method2(self, req):
 ? ? ...

index = MyClass():

I don't know much about mod_python and its publisher internal function but 
this one works because I think that publisher when parse request URL looks 
first for matching file in web root and then it looks into this file for 
index function or for index object. If index object has defined __str__ 
function publisher returns string representation of this object as reply for 
request. If index object has methods and URL is containing identifier of some 
method publisher call it. Repair me if this is bad idea.

>
> Apart from that, if you were using Vampire, you could simply use basic
> handlers are write:
>
> import vampire
>
> class MyClass:
>
>   def __init__(self,req):
>     self.__req = req
>
>   def __call__(self):
>     return "__call__"
>
>   def method1(self):
>     return "method1",self.__req.filename
>
>   def method2(self, req):
>     return "method2",req.filename
>
> handler = vampire.Publisher(MyClass)
>
> The vampire.Publisher() wrapper class handlers both creating an instance
> of the class and mapping URLs onto methods of the instance. It only
> supports callable methods in classes though. Ie., it will not map URLs
> to __str__() or to basic data types which are a member of the class.
>

This looks that it cold have functionality I want. But mayby it will be 
sufficent to look how vampire gets request object and write this to MyClass's 
constructor.

> Note that creating an instance of a class per request could be quite
> inefficient. What is the original reason that you wanted to access the
> request object in the constructor in the first place?

I didn' know that when I use 

def index(req):
   instance = MyClass(req)

mod_python creates only one instance of MyClass for every request and when I 
use

index = MyClass

it creates instance for each. But creating instance isn't the purpose. Purpose 
is to have page witch is class. Its string representation or its callable 
function returns main content with forms i. e. and its methost handles 
request connected with forms on main page.

Hope that I make my self clear and thanks for response.

Radek

From grahamd at dscpl.com.au  Wed Dec  7 06:29:14 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Dec  7 06:29:34 2005
Subject: [mod_python] Getting request object
In-Reply-To: <200512070921.35487.blackhex@post.cz>
References: <1133909638.15567@dscpl.user.openhosting.com>
	<200512070921.35487.blackhex@post.cz>
Message-ID: <1DDA1325-6C0A-4D76-B9CC-389595B9604C@dscpl.com.au>


On 07/12/2005, at 7:21 PM, Radek Barto? wrote:

> Hello, thanks for your reply.
>
>
>> If what it is that you want is that an instance of MyClass be created
>> specific for each request, before any URL mapping against methods is
>> being done, then using mod_python.publisher alone the answer is  
>> that no
>> it cannot be done easily. Unless my brain is overlooking something
>> obvious, you have to do something convoluted like:
>>
>> from mod_python import util, apache
>>
>> import types
>>
>> class Wrapper:
>>
>>   def __init__(self,function):
>>     self.__class = function.im_class
>>     self.__name = function.im_func.__name__
>>
>>   def __call__(self,req):
>>     instance = self.__class(req)
>>     function = getattr(instance,self.__name)
>>     return util.apply_fs_data(function,req.form)
>>
>> class MyClass:
>>
>>   def __init__(self,req):
>>     self.__req = req
>>
>>   def method1(self):
>>     return "method1"
>>
>>   def method2(self):
>>     return "method2"
>>
>> class Object: pass
>>
>> index = Object()
>> index.method1 = Wrapper(MyClass.method1)
>> index.method2 = Wrapper(MyClass.method2)
>>
>
>  I tried this wrapper. When I typed URL http://localhost/test.py/ 
> index page
> returned string representation of object so I could write __str__  
> function of
> Object class to make it working.

You are better off defining __call__() for the instance and not  
__str__()
as __call__() still allows you access to form parameters and the request
object. Thus you might have:

   class MyClass:

       ...

       def __call__(self):
           return "__call__"

...

index.__call__ = Wrapper(MyClass.__call__)

> But URLs
> http://localhost/test.py/index/method1 and
> http://localhost/test.py/index/method2 returned errors "Not Found".

You might need to be running mod_python 3.2.5b for it to work, but I  
would not
have expected that to be the case. This code was actual code I tried  
and tested
before I sent it, albeit on mod_python 3.2.5b.

>   Nevertheless I think that functionality of this wrapper was  
> mentioned same
> as functionality of my first example:
>
> class MyClass:
>    def __init__(self):
>       ...
>    def __str__(self):
>      ...
>    def method1(self, req):
>      ...
>    def method2(self, req):
>      ...
>
> index = MyClass():

The code I posted is not the same. In your code, there is one and  
only one
instance of MyClass created and all requested are handled within the
context of the one instance. This instance of MyClass is created at the
time the module is imported and is why it is not possible for the  
request
object to be available to the constructor of the class.

In the code I posted, the Wrapper instance __call__() method is  
called for
each request and an instance of MyClass is created for each request  
which
is received. The distinct request object for each request is passed  
to the
constructor for the instance of MyClass created specifically for each  
request.

> I don't know much about mod_python and its publisher internal  
> function but
> this one works because I think that publisher when parse request  
> URL looks
> first for matching file in web root and then it looks into this  
> file for
> index function or for index object. If index object has defined  
> __str__
> function publisher returns string representation of this object as  
> reply for
> request. If index object has methods and URL is containing  
> identifier of some
> method publisher call it. Repair me if this is bad idea.

More or less. If MyClass provides __call__() it will call that in  
preference to
converting the instance to a string, thus triggering execution of  
__str__().

>> Apart from that, if you were using Vampire, you could simply use  
>> basic
>> handlers are write:
>>
>> import vampire
>>
>> class MyClass:
>>
>>   def __init__(self,req):
>>     self.__req = req
>>
>>   def __call__(self):
>>     return "__call__"
>>
>>   def method1(self):
>>     return "method1",self.__req.filename
>>
>>   def method2(self, req):
>>     return "method2",req.filename
>>
>> handler = vampire.Publisher(MyClass)
>>
>> The vampire.Publisher() wrapper class handlers both creating an  
>> instance
>> of the class and mapping URLs onto methods of the instance. It only
>> supports callable methods in classes though. Ie., it will not map  
>> URLs
>> to __str__() or to basic data types which are a member of the class.
>>
>>
>
> This looks that it cold have functionality I want. But mayby it  
> will be
> sufficent to look how vampire gets request object and write this to  
> MyClass's
> constructor.

It is not that simple. The vampire.Publisher class and the code it  
relies on
to do what it does is not trivial. It in effect implements a complete  
mechanism
for mapping URLs onto objects, much like mod_python.publisher. It isn't
just a few lines that you could emulate.

>> Note that creating an instance of a class per request could be quite
>> inefficient. What is the original reason that you wanted to access  
>> the
>> request object in the constructor in the first place?
>>
>
> I didn' know that when I use
>
> def index(req):
>    instance = MyClass(req)
>
> mod_python creates only one instance of MyClass for every request  
> and when I
> use

It doesn't, it is creating an instance of MyClass per request.

> index = MyClass
>
> it creates instance for each.

You are starting to mix techniques here. If you are actually talking  
about basic
handlers and not mod_python.publisher, you can do this but for your  
MyClass
it will fail. If using basic handlers, you can say:

   class MyClass:

     def __call__(self,req):
         ....

   handler = MyClass

and mod_python will create an instance of MyClass for each request  
and then
call the instance, thus why it must define __call__(). With basic  
handlers as you
seem to realise though, there is no further URL mapping done by  
mod_python.

If using mod_python.publisher, as:

   index = MyClass

you should I believe get NotFound as it will not automatically create  
instances
of classes for you if a class type is referenced. I know Nicolas hand  
it in mind
to perhaps support this, but personally I don't think it is a good  
idea as it could
introduce other problems where people think methods are not  
accessible but
may actually. The authorisation schemes as written also would not  
work for the
instance created. Ie., authorisation could only be done at file scope.

> But creating instance isn't the purpose. Purpose
> is to have page witch is class. Its string representation or its  
> callable
> function returns main content with forms i. e. and its methost handles
> request connected with forms on main page.
>
> Hope that I make my self clear and thanks for response.

Not entirely, you still haven't explicitly said for what reason you  
want to access
the "req" object in the constructor of MyClass, which is basically  
what your original
question was about. If you can specify what information you are  
wanting to get
from the request object in the constructor, can perhaps say why you  
would not
want to do that or how you might do it.

Graham
From trepca at gmail.com  Wed Dec  7 08:14:00 2005
From: trepca at gmail.com (Sebastjan Trepca)
Date: Wed Dec  7 08:14:07 2005
Subject: [mod_python] Problems with headers in proxy handler
Message-ID: <cd329af80512070514p5a749d1fl@mail.gmail.com>

Hi,

I'm writing a proxy handler which makes a request to a different page
and retrieves its content and headers. This is the source:

import urllib2
from mod_python import util

def handler(req):
	req.headers_out.clear()
	f = util.FieldStorage(req)
	url = f.get('url',None)
	if(url):
		url=url.split('?')
		if(len(url)>1):
			u = url[0]
			p = url[1]
			ureq = urllib2.Request(u,p)
		else:
			u = url[0]
			ureq = urllib2.Request(u)
		for h in req.headers_in:
			ureq.add_header(h,req.headers_in[h])
		r = urllib2.urlopen(ureq)
		for h in r.headers:
			req.headers_out[h]=r.headers[h]
		data = 	r.read()
		req.write(data)
		return 0#-2 doesn't help either
	return 0

But this seems to have problems with headers, I get back basic headers
from my Apache server, which is wrong of course.
Any ideas why is this happening?

Thanks, Sebastjan

From dpopowich at comcast.net  Wed Dec  7 15:04:30 2005
From: dpopowich at comcast.net (Daniel J. Popowich)
Date: Wed Dec  7 15:04:25 2005
Subject: [mod_python] Getting request object
In-Reply-To: <200512052312.31029.blackhex@post.cz>
References: <mailman.0.1133820802.32219.mod_python@modpython.org>
	<200512052312.31029.blackhex@post.cz>
Message-ID: <17303.16462.812571.236537@io.astro.umass.edu>

Radek Barto? writes:
> Hello.
> I like using mod_python's mod_python.publisher like this:
> 
> class MyClass:
>   def __init__(self):
>     # can I get request object here?
>     ...
>   def __str__(self):
>     ...
>   def method1(self, req):
>     ...
>   def method2(self, req):
>     ...
> 
> # or can I get request object here and pass it to MyClass's constructor?
> index = MyClass():
> ...
> 
> instead of classic usage:
> 
> ....
> def index(req)
>    instance = MyClass()
>    ....
> 

You may want to check out mod_python servlets which offers an object
oriented paradigm for web application development.  Each request is
represented by an instance of a class and the response is generated by
calling a series of methods on the class.  Check out the link below in
my signature.  There's a live tutorial you can try out.

Daniel Popowich
---------------
http://home.comcast.net/~d.popowich/mpservlets/

From blackhex at post.cz  Wed Dec  7 15:11:46 2005
From: blackhex at post.cz (Radek =?iso-8859-2?q?Barto=F2?=)
Date: Wed Dec  7 15:38:02 2005
Subject: [mod_python] Getting request object
In-Reply-To: <17303.16462.812571.236537@io.astro.umass.edu>
References: <mailman.0.1133820802.32219.mod_python@modpython.org>
	<200512052312.31029.blackhex@post.cz>
	<17303.16462.812571.236537@io.astro.umass.edu>
Message-ID: <200512072111.46842.blackhex@post.cz>

>
> You may want to check out mod_python servlets which offers an object
> oriented paradigm for web application development.  Each request is
> represented by an instance of a class and the response is generated by
> calling a series of methods on the class.  Check out the link below in
> my signature.  There's a live tutorial you can try out.
>
> Daniel Popowich
> ---------------
> http://home.comcast.net/~d.popowich/mpservlets/

 I have seen this already when I was looking for something about sessions but 
I didn't pay so much atention what it worths. Now I look to this more 
carefully and I notice how do you do that. Unfortunately you are using your 
own handler like Graham wrote. I was only wondering if there is another way 
with publisher. Thank you.

From jgentil at sebistar.net  Wed Dec  7 16:36:52 2005
From: jgentil at sebistar.net (Jon-Pierre Gentil)
Date: Wed Dec  7 16:36:48 2005
Subject: [mod_python] Debian
In-Reply-To: <17275.18322.926446.881937@localhost.astro.umass.edu>
References: <200511152358.02416.jgentil@sebistar.net>
	<17275.18322.926446.881937@localhost.astro.umass.edu>
Message-ID: <200512071537.00133.jgentil@sebistar.net>

On Wednesday 16 November 2005 08:52 am, Daniel J. Popowich wrote:

> > It seems that the debian maintainer of mod_python no longer has
> > sufficient time to recompile and keep mod_python updated in Debian. 
> > I spoke to him and he stated that he'll likely set the packages up
> > for adoption.
> >
> > I am unfortunately not a debian developer and wouldn't have a clue
> > where to begin.  Is anyone interested in picking up the package?
>
> Yes, I would be willing to do this!  I'm a regular Debian user
> (supporting Debian machines is the day job).  What are the adoption
> procedures?  God, I hope it doesn't include blood work.  :-)

Ack, sorry for the very very late response on this.

I'd suggest contacting Peter directly about it.  His published email 
address is peterh@debian.org.

Thanks for the interest.  I'd love to see Debian keep up-to-date on 
things.  Especially with Python 2.4 our and mod_python 3.2.x coming along 
so well.  I'd offer to do it myself, but alas, I do not have the time to 
accomplish it myself.

-- 
_________________________________________________________

  Jon-Pierre Gentil     KC9CAF    PGP: 0x7E1CBA17
  jabber: jgentil@sebistar.net    web: www.sebistar.net
  "If you think education is expensive, try ignorance."
_________________________________________________________ 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 835 bytes
Desc: not available
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20051207/ecc39540/attachment.bin
From jd at commandprompt.com  Wed Dec  7 21:11:52 2005
From: jd at commandprompt.com (Joshua D. Drake)
Date: Wed Dec  7 21:11:49 2005
Subject: [mod_python] Compiling on X86_64?
In-Reply-To: <20051205223847.X66546@grisha.dyndns.org>
References: <4394C012.3030804@commandprompt.com>
	<20051205181157.K59199@grisha.dyndns.org>
	<4394E77F.4010307@commandprompt.com>
	<20051205223847.X66546@grisha.dyndns.org>
Message-ID: <43979668.8070808@commandprompt.com>

Gregory (Grisha) Trubetskoy wrote:
>
> Could you try mod_python 3.2.5b, I seem to recall this (or similar?) 
> issue being fixed.
>
I was able to fix this with passing LDFLAGS="-L/lib/64"

Thanks for trying to help.

Joshua D. Drake



> Grisha
>
> On Mon, 5 Dec 2005, Joshua D. Drake wrote:
>
>> Gregory (Grisha) Trubetskoy wrote:
>>>
>>> On Mon, 5 Dec 2005, Joshua D. Drake wrote:
>>>
>>>> *** Warning: linker path does not have real file for library -lm.
>>>
>>> Do you have glibc-devel installed?
>> Yes. I have seen a similar warning before when compiling PHP for 
>> x86_64. The only thing I had to do there was
>> edit the libtool file that ships with PHP to:
>>
>> # Compile-time system search path for libraries
>> sys_lib_search_path_spec="/lib64 /usr/lib64 /lib /usr/lib 
>> /usr/local/lib"
>>
>> # Run-time system search path for libraries
>> sys_lib_dlsearch_path_spec="/lib64 /usr/lib64 /lib /usr/lib"
>>
>> But the similar fix does not work for mod_python.
>>
>> Joshua D. Drake
>>
>>
>>>
>>> Grisha
>>

From jd at commandprompt.com  Wed Dec  7 21:51:11 2005
From: jd at commandprompt.com (Joshua D. Drake)
Date: Wed Dec  7 21:51:07 2005
Subject: [mod_python] Compiling on X86_64?
In-Reply-To: <43979668.8070808@commandprompt.com>
References: <4394C012.3030804@commandprompt.com>	<20051205181157.K59199@grisha.dyndns.org>	<4394E77F.4010307@commandprompt.com>	<20051205223847.X66546@grisha.dyndns.org>
	<43979668.8070808@commandprompt.com>
Message-ID: <43979F9F.2040608@commandprompt.com>

Joshua D. Drake wrote:
> Gregory (Grisha) Trubetskoy wrote:
>>
>> Could you try mod_python 3.2.5b, I seem to recall this (or similar?) 
>> issue being fixed.
>>
> I was able to fix this with passing LDFLAGS="-L/lib/64"
>
err LDFLAGS="-L/lib64"

> Thanks for trying to help.
>
> Joshua D. Drake
>

From grisha at modpython.org  Wed Dec  7 22:40:31 2005
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Wed Dec  7 22:40:35 2005
Subject: [mod_python] Compiling on X86_64?
In-Reply-To: <43979F9F.2040608@commandprompt.com>
References: <4394C012.3030804@commandprompt.com>
	<20051205181157.K59199@grisha.dyndns.org>
	<4394E77F.4010307@commandprompt.com>
	<20051205223847.X66546@grisha.dyndns.org>
	<43979668.8070808@commandprompt.com>
	<43979F9F.2040608@commandprompt.com>
Message-ID: <20051207223950.N7686@grisha.dyndns.org>




On Wed, 7 Dec 2005, Joshua D. Drake wrote:

> Joshua D. Drake wrote:
>> Gregory (Grisha) Trubetskoy wrote:
>>> 
>>> Could you try mod_python 3.2.5b, I seem to recall this (or similar?) 
>>> issue being fixed.
>>> 
>> I was able to fix this with passing LDFLAGS="-L/lib/64"
>> 
> err LDFLAGS="-L/lib64"

...using which mod_python version?

Grisha
From devik at cdi.cz  Wed Dec  7 23:17:19 2005
From: devik at cdi.cz (Martin Devera)
Date: Wed Dec  7 23:17:25 2005
Subject: [mod_python] inspect.getmembers(req) segfaults
Message-ID: <4397B3CF.3060103@cdi.cz>

Hello,

I just started to play with mod_python and managed it to
coredump.
It is:
Apache/2.0.53 (Unix) mod_ssl/2.0.53 OpenSSL/0.9.7b PHP/5.0.5 
mod_python/3.2.5b Python/2.4.2 , prefork mpm

I used .htaccess:
SetHandler mod_python
PythonHandler testh
PythonDebug On

code:
from mod_python import apache
import os
import inspect

def handler(req):
         req.content_type = "text/plain"
         m = inspect.getmembers(req);
         req.write("PID "+str(os.getpid())+" "+str(1))

         return apache.OK

getmembers line coredumps apache child.

thanks, Martin
From grahamd at dscpl.com.au  Thu Dec  8 00:20:05 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Dec  8 00:20:12 2005
Subject: [mod_python] inspect.getmembers(req) segfaults
Message-ID: <1134019205.13049@dscpl.user.openhosting.com>

Martin Devera wrote ..
> Hello,
> 
> I just started to play with mod_python and managed it to
> coredump.
> It is:
> Apache/2.0.53 (Unix) mod_ssl/2.0.53 OpenSSL/0.9.7b PHP/5.0.5 
> mod_python/3.2.5b Python/2.4.2 , prefork mpm
> 
> I used .htaccess:
> SetHandler mod_python
> PythonHandler testh
> PythonDebug On
> 
> code:
> from mod_python import apache
> import os
> import inspect
> 
> def handler(req):
>          req.content_type = "text/plain"
>          m = inspect.getmembers(req);
>          req.write("PID "+str(os.getpid())+" "+str(1))
> 
>          return apache.OK
> 
> getmembers line coredumps apache child.

Is even easier than that. Simply access 'req.boundary' and it crashes.

The code contains:

    {"boundary",     (getter)getreq_recmbr, NULL, "Multipart/byteranges boundary", "boundary"},

in the request_getsets[] array, but there is no definition of 'boundary' in
the request_rec_mbrs[] array. As a consequence, when you access it, it
will crash.

The 'boundary' line therefore needs to be deleted from the source as it
appears to serve no purpose.

I'll log a bug report.

Graham
From jd at commandprompt.com  Thu Dec  8 13:51:49 2005
From: jd at commandprompt.com (Joshua D. Drake)
Date: Thu Dec  8 13:49:26 2005
Subject: [mod_python] Compiling on X86_64?
In-Reply-To: <20051207223950.N7686@grisha.dyndns.org>
References: <4394C012.3030804@commandprompt.com>
	<20051205181157.K59199@grisha.dyndns.org>
	<4394E77F.4010307@commandprompt.com>
	<20051205223847.X66546@grisha.dyndns.org>
	<43979668.8070808@commandprompt.com>
	<43979F9F.2040608@commandprompt.com>
	<20051207223950.N7686@grisha.dyndns.org>
Message-ID: <1134067909.8592.11.camel@jd.commandprompt.com>


> >> I was able to fix this with passing LDFLAGS="-L/lib/64"
> >> 
> > err LDFLAGS="-L/lib64"
> 
> ...using which mod_python version?

Oh good point :). I was able to resolve my issue with 3.1.4 and Python
2.4.2 on FC2 by passing LDFLAGS to ./configure.

I also tested 3.2.5b which worked as well with the above change.

However, one thing I did note on 3.2.5b is that it wants to have a newer
version of Flex. However FC2, FC3 and FC4 ship with a old version of
flex.

It GNU no longer supports the version of flex that is actively developed
and it the newer version needs to be retrieved from sourceforge. You may
want to make note in your docs.

Sincerely,

Joshua D. Drake

> 
> Grisha
-- 
The PostgreSQL Company - Command Prompt, Inc. 1.503.667.4564
PostgreSQL Replication, Consulting, Custom Development, 24x7 support
Managed Services, Shared and Dedicated Hosting
Co-Authors: PLphp, PLperl, ODBCng - http://www.commandprompt.com/


From grisha at modpython.org  Thu Dec  8 14:05:54 2005
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Thu Dec  8 14:06:00 2005
Subject: [mod_python] Compiling on X86_64?
In-Reply-To: <1134067909.8592.11.camel@jd.commandprompt.com>
References: <4394C012.3030804@commandprompt.com>
	<20051205181157.K59199@grisha.dyndns.org>
	<4394E77F.4010307@commandprompt.com>
	<20051205223847.X66546@grisha.dyndns.org>
	<43979668.8070808@commandprompt.com>
	<43979F9F.2040608@commandprompt.com>
	<20051207223950.N7686@grisha.dyndns.org>
	<1134067909.8592.11.camel@jd.commandprompt.com>
Message-ID: <20051208140319.O24291@grisha.dyndns.org>





On Thu, 8 Dec 2005, Joshua D. Drake wrote:

> However, one thing I did note on 3.2.5b is that it wants to have a newer
> version of Flex. However FC2, FC3 and FC4 ship with a old version of
> flex.
>
> It GNU no longer supports the version of flex that is actively developed
> and it the newer version needs to be retrieved from sourceforge. You may
> want to make note in your docs.
>

Not quite - actually 3.1 also requires the new version of flex, but since 
the flex generated file is distributed with the source you don't need flex 
to compile it. 3.2.5 just generates a warning, whereas 3.1 kept quiet 
about it.

Grisha
From jpg at jgassociates.ca  Thu Dec  8 14:09:59 2005
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Thu Dec  8 14:08:34 2005
Subject: [mod_python] Compiling on X86_64?
In-Reply-To: <1134067909.8592.11.camel@jd.commandprompt.com>
References: <4394C012.3030804@commandprompt.com>	<20051205181157.K59199@grisha.dyndns.org>	<4394E77F.4010307@commandprompt.com>	<20051205223847.X66546@grisha.dyndns.org>	<43979668.8070808@commandprompt.com>	<43979F9F.2040608@commandprompt.com>	<20051207223950.N7686@grisha.dyndns.org>
	<1134067909.8592.11.camel@jd.commandprompt.com>
Message-ID: <43988507.6070104@jgassociates.ca>

Joshua D. Drake wrote:
>>>>I was able to fix this with passing LDFLAGS="-L/lib/64"
>>>>
>>>
>>>err LDFLAGS="-L/lib64"
>>
>>...using which mod_python version?
> 
> 
> Oh good point :). I was able to resolve my issue with 3.1.4 and Python
> 2.4.2 on FC2 by passing LDFLAGS to ./configure.
> 
> I also tested 3.2.5b which worked as well with the above change.
> 
> However, one thing I did note on 3.2.5b is that it wants to have a newer
> version of Flex. However FC2, FC3 and FC4 ship with a old version of
> flex.
> 
> It GNU no longer supports the version of flex that is actively developed
> and it the newer version needs to be retrieved from sourceforge. You may
> want to make note in your docs.
> 

You may want to read the output from configure more carefully. You only 
need flex if you want to regenerate psp_parser.c after making changes to 
psp_parser.l. Otherwise you can use the pre-generated psp_parser.c 
provided with the source to accomodate distributions that ship with the 
older flex. This is information is also detailed in the docs and README.

Jim
From blackhex at post.cz  Thu Dec  8 16:18:02 2005
From: blackhex at post.cz (Radek =?utf-8?q?Barto=C5=88?=)
Date: Thu Dec  8 16:44:22 2005
Subject: [mod_python] Getting request object
In-Reply-To: <1DDA1325-6C0A-4D76-B9CC-389595B9604C@dscpl.com.au>
References: <1133909638.15567@dscpl.user.openhosting.com>
	<200512070921.35487.blackhex@post.cz>
	<1DDA1325-6C0A-4D76-B9CC-389595B9604C@dscpl.com.au>
Message-ID: <200512082218.03239.blackhex@post.cz>

> You might need to be running mod_python 3.2.5b for it to work, but I
> would not
> have expected that to be the case. This code was actual code I tried
> and tested
> before I sent it, albeit on mod_python 3.2.5b.

I have installed 3.1.4 from gentoo's portage.

> If using mod_python.publisher, as:
>
>    index = MyClass
>
> you should I believe get NotFound as it will not automatically create
> instances
> of classes for you if a class type is referenced. I know Nicolas hand
> it in mind
> to perhaps support this, but personally I don't think it is a good
> idea as it could
> introduce other problems where people think methods are not
> accessible but
> may actually. The authorisation schemes as written also would not
> work for the
> instance created. Ie., authorisation could only be done at file scope.

With file test.py:

class MyClass:
  def __init__(self):
    pass # some initialization
  def __call__(self, req):
    return "whole class"
  def method1(self, req):
    return "method1"
  def method2(self, req):
    return "method2"

index = MyClass()

and URLs http://locahost/test/ http://localhost/test/index/method1 and 
http://localhost/test/index/method2 I didn't get any Not Found error.

And by the way it does all I want. Here is some example of using this 
approach:

from mod_python import Session,util

class MyClass:
  def __init__(self):
    pass # some initialization
  def __call__(self, req):
    session = Session.Session(req)
    # lazy evaluation
    if session.has_key('logged') and session['logged']:
      return """
        <HTML>
	<HEAD>
	</HEAD>
	<BODY> 
          Logged
	</BODY>
	</HTML>"""
    else: 	  
      return """
        <HTML>
	<HEAD>
	</HEAD>
	<BODY>
        <FORM method="POST" action="/test/index/submit">
          <INPUT test="text" name="user" size="10"><BR>
          <INPUT TYPE="password" name="password" size="10"><BR>
          <INPUT TYPE="submit" name="submint" value="Login">
        </FORM>
	</BODY>
	</HTML>"""
  def submit(self, req):
    form_user = req.form['user'].value
    form_password = req.form['password'].value
    session = Session.Session(req)
    if form_user == 'test' and form_password == 'test':
      session['logged'] = True
      session.save()
    util.redirect(req, '/test') 

index = MyClass()

Thank you all.
From grahamd at dscpl.com.au  Thu Dec  8 17:43:53 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Dec  8 17:43:57 2005
Subject: [mod_python] Getting request object
Message-ID: <1134081833.28972@dscpl.user.openhosting.com>

Radek =?utf-8?q?Barto=C5=88?= wrote ..
> > If using mod_python.publisher, as:
> >
> >    index = MyClass
> >
> > you should I believe get NotFound as it will not automatically create
> > instances
> > of classes for you if a class type is referenced. I know Nicolas hand
> > it in mind
> > to perhaps support this, but personally I don't think it is a good
> > idea as it could
> > introduce other problems where people think methods are not
> > accessible but
> > may actually. The authorisation schemes as written also would not
> > work for the
> > instance created. Ie., authorisation could only be done at file scope.
> 
> With file test.py:
> 
> class MyClass:
>   def __init__(self):
>     pass # some initialization
>   def __call__(self, req):
>     return "whole class"
>   def method1(self, req):
>     return "method1"
>   def method2(self, req):
>     return "method2"
> 
> index = MyClass()
> 
> and URLs http://locahost/test/ http://localhost/test/index/method1 and
> http://localhost/test/index/method2 I didn't get any Not Found error.

That is different to what you originally had and not what I was talking about.
It may have been a typo, but I believe you had at one point:

  index = MyClass

not:

  index = MyClass()

There is a big difference. In one case you are publishing the class itself and
in the other and instance of the class. My description above was talking about
publication of a class verses publication of an instance of the class.

> And by the way it does all I want. Here is some example of using this 
> approach:
> 
> from mod_python import Session,util
> 
> class MyClass:
>   def __init__(self):
>     pass # some initialization
>   def __call__(self, req):
>     session = Session.Session(req)
>     # lazy evaluation
>     if session.has_key('logged') and session['logged']:
>       return """
>         <HTML>
> 	<HEAD>
> 	</HEAD>
> 	<BODY> 
>           Logged
> 	</BODY>
> 	</HTML>"""
>     else: 	  
>       return """
>         <HTML>
> 	<HEAD>
> 	</HEAD>
> 	<BODY>
>         <FORM method="POST" action="/test/index/submit">
>           <INPUT test="text" name="user" size="10"><BR>
>           <INPUT TYPE="password" name="password" size="10"><BR>
>           <INPUT TYPE="submit" name="submint" value="Login">
>         </FORM>
> 	</BODY>
> 	</HTML>"""
>   def submit(self, req):
>     form_user = req.form['user'].value
>     form_password = req.form['password'].value
>     session = Session.Session(req)
>     if form_user == 'test' and form_password == 'test':
>       session['logged'] = True
>       session.save()
>     util.redirect(req, '/test') 
> 
> index = MyClass()

So in other words you didn't actually need access to the request object
in the constructor after all. What you were missing was that __call__()
could be used in place of __str__() with __call__() allowing you to still
access the request object and form parameters if need be.

Graham
From scott_list at mischko.com  Fri Dec  9 00:52:02 2005
From: scott_list at mischko.com (Scott Chapman)
Date: Fri Dec  9 00:52:14 2005
Subject: [mod_python] Why can't  psycopg2 beta adapt this:
Message-ID: <43991B82.3050401@mischko.com>

Mod_Python has a StringField class and psycopg2 can't seem to adapt it 
correctly. Type(stringfield_string) shows as:
<class 'mod_python.util.StringField'>

Strings of this class have 3 extra items in dir(stringfield_string) which 
regular strins don't have:
'__dict__', '__module__', 'value'

Here's the class definition from mod_python.util:
class StringField(str):
    """ This class is basically a string with
    a value attribute for compatibility with std lib cgi.py
    """

    def __init__(self, str=""):
        str.__init__(self, str)
        self.value = self.__str__()

How do I make psycopg2 deal with these correctly?  It seems like there's a way 
to make custom "adapters" but I'm rather clueless here.  I just need psycopg2 to 
run str() on the StringField instance and it'd work great.

Cordially,
Scott
From devik at cdi.cz  Fri Dec  9 09:23:16 2005
From: devik at cdi.cz (Martin Devera)
Date: Fri Dec  9 09:23:26 2005
Subject: [mod_python] inspect.getmembers(req) segfaults
In-Reply-To: <1134019205.13049@dscpl.user.openhosting.com>
References: <1134019205.13049@dscpl.user.openhosting.com>
Message-ID: <43999354.2090904@cdi.cz>

>> code:
>> from mod_python import apache
>> import os
>> import inspect
>>
>> def handler(req):
>>          req.content_type = "text/plain"
>>          m = inspect.getmembers(req);
>>          req.write("PID "+str(os.getpid())+" "+str(1))
>>
>>          return apache.OK
>>
>> getmembers line coredumps apache child.
> 
> Is even easier than that. Simply access 'req.boundary' and it crashes.
> 
> The code contains:
> 
>     {"boundary",     (getter)getreq_recmbr, NULL, "Multipart/byteranges boundary", "boundary"},
> 
> in the request_getsets[] array, but there is no definition of 'boundary' in
> the request_rec_mbrs[] array. As a consequence, when you access it, it
> will crash.
> 
> The 'boundary' line therefore needs to be deleted from the source as it
> appears to serve no purpose.
> 
> I'll log a bug report.

Hello Graham,

I fixed the boundary problem temporarily and found another. And it
seems to be harder (I'm looking at it in GDB for 3 hours now):

def handler(req):
         req.content_type = "text/plain"
         req.write("EE\n")
         a = getattr(req,"allowed_methods");
	return apache.OK

Coredumps in getreq_rec_ml...

Martin
From downgrade at gmx.org  Fri Dec  9 10:11:50 2005
From: downgrade at gmx.org (Lars Eriksen)
Date: Fri Dec  9 10:11:52 2005
Subject: [mod_python] Concurrent requests
Message-ID: <001a01c5fcd2$e1f097e0$3701a8c0@targa>

I have created a simple .psp script that simply calls sleep(...) and blocks 
execution for a certain amount of time (x seconds).

If I access the .psp script in two instances of my browser at the same time, 
request one waits x seconds, then it finishes, then request two is processed 
and finishes after x * 2 seconds.

Requests are obviously queued and not several Python interpreters spawned to 
handle them concurrently.

Is there any setting that allows you to specify the number of Python 
interpreters that should be used?

Thanks,

-Lars 

From jpg at jgassociates.ca  Fri Dec  9 11:03:01 2005
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Fri Dec  9 11:02:51 2005
Subject: [mod_python] Concurrent requests
In-Reply-To: <001a01c5fcd2$e1f097e0$3701a8c0@targa>
References: <001a01c5fcd2$e1f097e0$3701a8c0@targa>
Message-ID: <4399AAB5.3090404@jgassociates.ca>

Are you using sessions?
Which mod_python version?
Apache mpm prefork, worker or threaded?

Jim


Lars Eriksen wrote:
> I have created a simple .psp script that simply calls sleep(...) and 
> blocks execution for a certain amount of time (x seconds).
> 
> If I access the .psp script in two instances of my browser at the same 
> time, request one waits x seconds, then it finishes, then request two is 
> processed and finishes after x * 2 seconds.
> 
> Requests are obviously queued and not several Python interpreters 
> spawned to handle them concurrently.
> 
> Is there any setting that allows you to specify the number of Python 
> interpreters that should be used?
> 
> Thanks,
> 
> -Lars
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 

From downgrade at gmx.org  Fri Dec  9 11:40:42 2005
From: downgrade at gmx.org (Lars Eriksen)
Date: Fri Dec  9 11:40:05 2005
Subject: [mod_python] Concurrent requests
References: <001a01c5fcd2$e1f097e0$3701a8c0@targa>
	<4399AAB5.3090404@jgassociates.ca>
Message-ID: <001001c5fcdf$4bf9dd20$3701a8c0@targa>

> Are you using sessions?
No.

> Which mod_python version?
Apache/2.0.55 (Win32) mod_python/3.2.5b Python/2.4.2

> Apache mpm prefork, worker or threaded?
Default Apache NT installation, which uses the MPM in threaded mode.

I only added the following to my main directory configuration:

AddHandler mod_python .htm
PythonHandler mod_python.psp
PythonDebug On

Thanks in advance!


----- Original Message ----- 
From: "Jim Gallacher" <jpg@jgassociates.ca>
To: "Lars Eriksen" <downgrade@gmx.org>
Cc: <mod_python@modpython.org>
Sent: Friday, December 09, 2005 5:03 PM
Subject: Re: [mod_python] Concurrent requests


> Are you using sessions?
> Which mod_python version?
> Apache mpm prefork, worker or threaded?
>
> Jim
>
>
> Lars Eriksen wrote:
>> I have created a simple .psp script that simply calls sleep(...) and 
>> blocks execution for a certain amount of time (x seconds).
>>
>> If I access the .psp script in two instances of my browser at the same 
>> time, request one waits x seconds, then it finishes, then request two is 
>> processed and finishes after x * 2 seconds.
>>
>> Requests are obviously queued and not several Python interpreters spawned 
>> to handle them concurrently.
>>
>> Is there any setting that allows you to specify the number of Python 
>> interpreters that should be used?
>>
>> Thanks,
>>
>> -Lars
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>
>
> 

From jpg at jgassociates.ca  Fri Dec  9 12:00:47 2005
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Fri Dec  9 11:59:57 2005
Subject: [mod_python] Concurrent requests
In-Reply-To: <001001c5fcdf$4bf9dd20$3701a8c0@targa>
References: <001a01c5fcd2$e1f097e0$3701a8c0@targa>	<4399AAB5.3090404@jgassociates.ca>
	<001001c5fcdf$4bf9dd20$3701a8c0@targa>
Message-ID: <4399B83F.8080000@jgassociates.ca>

I wonder if it's related to the page cache mechanism acquring a global 
lock? Niclolas is more familiar with that code in psp.py and may be able 
to comment.

Jim

Lars Eriksen wrote:
>> Are you using sessions?
> 
> No.
> 
>> Which mod_python version?
> 
> Apache/2.0.55 (Win32) mod_python/3.2.5b Python/2.4.2
> 
>> Apache mpm prefork, worker or threaded?
> 
> Default Apache NT installation, which uses the MPM in threaded mode.
> 
> I only added the following to my main directory configuration:
> 
> AddHandler mod_python .htm
> PythonHandler mod_python.psp
> PythonDebug On
> 
> Thanks in advance!
> 
> 
> ----- Original Message ----- From: "Jim Gallacher" <jpg@jgassociates.ca>
> To: "Lars Eriksen" <downgrade@gmx.org>
> Cc: <mod_python@modpython.org>
> Sent: Friday, December 09, 2005 5:03 PM
> Subject: Re: [mod_python] Concurrent requests
> 
> 
>> Are you using sessions?
>> Which mod_python version?
>> Apache mpm prefork, worker or threaded?
>>
>> Jim
>>
>>
>> Lars Eriksen wrote:
>>
>>> I have created a simple .psp script that simply calls sleep(...) and 
>>> blocks execution for a certain amount of time (x seconds).
>>>
>>> If I access the .psp script in two instances of my browser at the 
>>> same time, request one waits x seconds, then it finishes, then 
>>> request two is processed and finishes after x * 2 seconds.
>>>
>>> Requests are obviously queued and not several Python interpreters 
>>> spawned to handle them concurrently.
>>>
>>> Is there any setting that allows you to specify the number of Python 
>>> interpreters that should be used?
>>>
>>> Thanks,
>>>
>>> -Lars
>>> _______________________________________________
>>> Mod_python mailing list
>>> Mod_python@modpython.org
>>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>>
>>
>>
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 

From jpg at jgassociates.ca  Fri Dec  9 12:10:33 2005
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Fri Dec  9 12:09:41 2005
Subject: [mod_python] inspect.getmembers(req) segfaults
In-Reply-To: <43999354.2090904@cdi.cz>
References: <1134019205.13049@dscpl.user.openhosting.com>
	<43999354.2090904@cdi.cz>
Message-ID: <4399BA89.3010500@jgassociates.ca>

Martin Devera wrote:
>>> code:
>>> from mod_python import apache
>>> import os
>>> import inspect
>>>
>>> def handler(req):
>>>          req.content_type = "text/plain"
>>>          m = inspect.getmembers(req);
>>>          req.write("PID "+str(os.getpid())+" "+str(1))
>>>
>>>          return apache.OK
>>>
>>> getmembers line coredumps apache child.
>>
>>
>> Is even easier than that. Simply access 'req.boundary' and it crashes.
>>
>> The code contains:
>>
>>     {"boundary",     (getter)getreq_recmbr, NULL, 
>> "Multipart/byteranges boundary", "boundary"},
>>
>> in the request_getsets[] array, but there is no definition of 
>> 'boundary' in
>> the request_rec_mbrs[] array. As a consequence, when you access it, it
>> will crash.
>>
>> The 'boundary' line therefore needs to be deleted from the source as it
>> appears to serve no purpose.
>>
>> I'll log a bug report.
> 
> 
> Hello Graham,
> 
> I fixed the boundary problem temporarily and found another. And it
> seems to be harder (I'm looking at it in GDB for 3 hours now):
> 
> def handler(req):
>         req.content_type = "text/plain"
>         req.write("EE\n")
>         a = getattr(req,"allowed_methods");
>     return apache.OK
> 
> Coredumps in getreq_rec_ml...

I stuffed some ap_log_rerror statements into getreq_rec_ml and every 
thing is fine up to  "return tuple_from_method_list(ml);".

tuple_from_method_list is defined in src/util.c. I'm out of time right 
now but I'll poke at it later and see what I can learn.

Jim


From dpopowich at comcast.net  Fri Dec  9 12:20:50 2005
From: dpopowich at comcast.net (Daniel J. Popowich)
Date: Fri Dec  9 12:20:55 2005
Subject: [mod_python] Why can't  psycopg2 beta adapt this:
In-Reply-To: <43991B82.3050401@mischko.com>
References: <43991B82.3050401@mischko.com>
Message-ID: <17305.48370.148028.841814@io.astro.umass.edu>


Scott Chapman writes:
> Mod_Python has a StringField class and psycopg2 can't seem to adapt it 
> correctly. Type(stringfield_string) shows as:
> <class 'mod_python.util.StringField'>
> 
> Strings of this class have 3 extra items in dir(stringfield_string) which 
> regular strins don't have:
> '__dict__', '__module__', 'value'
> 
> Here's the class definition from mod_python.util:
> class StringField(str):
>     """ This class is basically a string with
>     a value attribute for compatibility with std lib cgi.py
>     """
> 
>     def __init__(self, str=""):
>         str.__init__(self, str)
>         self.value = self.__str__()
>
> How do I make psycopg2 deal with these correctly?  It seems like
> there's a way to make custom "adapters" but I'm rather clueless
> here.  I just need psycopg2 to run str() on the StringField instance
> and it'd work great.

This is a pain, I know.  I use psycopg extensively and have been
burned more than once.  There's nothing you can really do at the
psycopg module (afaik), but it's easy enough in your code...you can do
one of a few things:

  1. a pain, but use str() explicitly.

  2. build your query strings using python string formatting, instead
     of the parameters of the cursor.execute() method.  E.g.:

       cur.execute("insert into mytable (col1, col5)
                    values ('%s', %d)" % (some_str, some_int))

     the %s will automatically call __str__() if some_str is not a
     str.

  3. Are you still using mpservlets? (you were at one time)  If you
     use query_vars to process your forms, your instance variables are
     converted to str automagically.  In the attached servlet,
     types.mps, if you call it with: types?field=abc&realstr=def the
     output will be:

	  field: abc
	  type(field): <class 'mod_python.util.StringField'>
	  realstr: def
	  type(realstr): <type 'str'>


Cheers,

Daniel Popowich
---------------
http://home.comcast.net/~d.popowich/mpservlets/


-------------- next part --------------
# -*- python -*-
from mod_python.servlet import HTMLPage

import cgi

class types(HTMLPage):
      
    query_vars = ['realstr']

    def prep(self):
        HTMLPage.prep(self)
        self.field = self.form.getfirst('field')
    
    def write_content(self):
        self.writeln('field: %s<br>' % self.field)

        self.writeln('type(field): %s<br>' %
                     cgi.escape(str(type(self.field))))

        self.writeln('realstr: %s<br>' % self.realstr)

        self.writeln('type(realstr): %s<br>' %
                     cgi.escape(str(type(self.realstr))))
From devik at cdi.cz  Fri Dec  9 12:32:55 2005
From: devik at cdi.cz (Martin Devera)
Date: Fri Dec  9 12:33:06 2005
Subject: [mod_python] inspect.getmembers(req) segfaults
In-Reply-To: <4399BA89.3010500@jgassociates.ca>
References: <1134019205.13049@dscpl.user.openhosting.com>
	<43999354.2090904@cdi.cz> <4399BA89.3010500@jgassociates.ca>
Message-ID: <4399BFC7.3060109@cdi.cz>

>>     return apache.OK
>>
>> Coredumps in getreq_rec_ml...
> 
> I stuffed some ap_log_rerror statements into getreq_rec_ml and every 
> thing is fine up to  "return tuple_from_method_list(ml);".
> 
> tuple_from_method_list is defined in src/util.c. I'm out of time right 
> now but I'll poke at it later and see what I can learn.

Fix:
--- src/requestobject.c.old     Fri Dec  9 16:36:46 2005
+++ src/requestobject.c Fri Dec  9 16:36:53 2005
@@ -1311,7 +1311,7 @@ static PyObject *getreq_rec_ml(requestob
  {
      const PyMemberDef *md = find_memberdef(request_rec_mbrs, (char*)name);
      ap_method_list_t *ml =
-        (ap_method_list_t *)((char *)self->request_rec + md->offset);
+        *(ap_method_list_t **)((char *)self->request_rec + md->offset);

      return tuple_from_method_list(ml);
  }

I found other coredump, more on it later :)
From chase at oldben.llnl.gov  Fri Dec  9 13:36:55 2005
From: chase at oldben.llnl.gov (chase3@llnl.gov)
Date: Fri Dec  9 13:39:56 2005
Subject: [mod_python] 500 internal server error
Message-ID: <Pine.LNX.4.44.0512091029250.25729-100000@oldben.llnl.gov>

As a first step in moving a CGI script to mod_python, I wrapped the
script in a handler.  This seems to work and the database does 
receive the data.   It looks like things should be ok.  However,
I am getting a 500 Internal Server Error back that I have not been
able to figure out, as there were no other clues in the error_log.  
In fact, putting an log message shows execution is successful:

  ...
    # Close the connection
    db.close()
    apache.log_error ( "success", apache.APLOG_ERR )
    return apache.OK
  else:
    apache.log_error ( "Failed!", apache.APLOG_ERR )
    return apache.SERVER_RETURN

I get "success" in the log file.

I put this mod_python script in the cgi-bin because when it was 
in htdocs, I ran into 401 Authorization Required problems.
I should mention that I am not communicating to the server with
a URL in a browser, but through a utility that uses CURL and SSL to
do an HTTPS post, so user authentication is not possible.
When the mod_python script is in cgi-bin, user authentication is 
not required. The software uses a digital signature for authentication.

<Directory "/etc/httpd/cgi-bin/tracker">
    AddHandler python-program .py
    PythonHandler mod_python.publisher
    PythonDebug On
</Directory>

Any ideas on how to locate the server error?

Apache server is at 2.0.46; python 2.2.35 and mod_python-3.0.3-3.ent

Thanks,
Lila
 

-- 
Lila Chase
lchase@llnl.gov

From devik at cdi.cz  Fri Dec  9 13:57:30 2005
From: devik at cdi.cz (Martin Devera)
Date: Fri Dec  9 13:57:43 2005
Subject: [mod_python] inspect.getmembers(req) segfaults
In-Reply-To: <4399BFC7.3060109@cdi.cz>
References: <1134019205.13049@dscpl.user.openhosting.com>	<43999354.2090904@cdi.cz>
	<4399BA89.3010500@jgassociates.ca> <4399BFC7.3060109@cdi.cz>
Message-ID: <4399D39A.3060907@cdi.cz>

> I found other coredump, more on it later :)

Ok I attached cumulative fix for 3 similar bugs. By the way
I found no information who is the original author and how
to for example get SVN write access (If I'd like to fix
more bugs on the way).

regards, Martin
-------------- next part --------------
--- src/requestobject.c.old	Fri Dec  9 16:36:46 2005
+++ src/requestobject.c	Fri Dec  9 18:50:42 2005
@@ -1296,7 +1296,7 @@ static PyObject *getreq_rec_ah(requestob
 {
     const PyMemberDef *md = find_memberdef(request_rec_mbrs, name);
     apr_array_header_t *ah = 
-        (apr_array_header_t *)((char *)self->request_rec + md->offset);
+        *(apr_array_header_t **)((char *)self->request_rec + md->offset);
 
     return tuple_from_array_header(ah);
 }
@@ -1311,7 +1311,7 @@ static PyObject *getreq_rec_ml(requestob
 {
     const PyMemberDef *md = find_memberdef(request_rec_mbrs, (char*)name);
     ap_method_list_t *ml = 
-        (ap_method_list_t *)((char *)self->request_rec + md->offset);
+        *(ap_method_list_t **)((char *)self->request_rec + md->offset);
 
     return tuple_from_method_list(ml);
 }
--- src/serverobject.c.old	Fri Dec  9 19:20:43 2005
+++ src/serverobject.c	Fri Dec  9 19:20:49 2005
@@ -206,7 +206,7 @@ static PyObject *getsrv_recmbr_ah(server
 {
     const PyMemberDef *md = find_memberdef(server_rec_mbrs, name);
     apr_array_header_t *ah = 
-        (apr_array_header_t *)((char *)self->server + md->offset);
+        *(apr_array_header_t **)((char *)self->server + md->offset);
 
     return tuple_from_array_header(ah);
 }
From pjs at packet-addiction.org  Fri Dec  9 14:07:54 2005
From: pjs at packet-addiction.org (Peter Sanchez)
Date: Fri Dec  9 14:07:24 2005
Subject: [mod_python] 500 internal server error
In-Reply-To: <Pine.LNX.4.44.0512091029250.25729-100000@oldben.llnl.gov>
References: <Pine.LNX.4.44.0512091029250.25729-100000@oldben.llnl.gov>
Message-ID: <66A801E7-1B2B-41EF-A521-B85A11AB29FC@packet-addiction.org>

You are using mod_python.publisher, so you need to return your HTML  
code. Try this, instead of:

     return apache.OK

Use:

    return '<center><h1>Testing</h1></center>'

Should solve your problem.

Peter


On Dec 9, 2005, at 10:36 AM, chase3@llnl.gov wrote:

> As a first step in moving a CGI script to mod_python, I wrapped the
> script in a handler.  This seems to work and the database does
> receive the data.   It looks like things should be ok.  However,
> I am getting a 500 Internal Server Error back that I have not been
> able to figure out, as there were no other clues in the error_log.
> In fact, putting an log message shows execution is successful:
>
>   ...
>     # Close the connection
>     db.close()
>     apache.log_error ( "success", apache.APLOG_ERR )
>     return apache.OK
>   else:
>     apache.log_error ( "Failed!", apache.APLOG_ERR )
>     return apache.SERVER_RETURN
>
> I get "success" in the log file.
>
> I put this mod_python script in the cgi-bin because when it was
> in htdocs, I ran into 401 Authorization Required problems.
> I should mention that I am not communicating to the server with
> a URL in a browser, but through a utility that uses CURL and SSL to
> do an HTTPS post, so user authentication is not possible.
> When the mod_python script is in cgi-bin, user authentication is
> not required. The software uses a digital signature for  
> authentication.
>
> <Directory "/etc/httpd/cgi-bin/tracker">
>     AddHandler python-program .py
>     PythonHandler mod_python.publisher
>     PythonDebug On
> </Directory>
>
> Any ideas on how to locate the server error?
>
> Apache server is at 2.0.46; python 2.2.35 and mod_python-3.0.3-3.ent
>
> Thanks,
> Lila
>
>
> -- 
> Lila Chase
> lchase@llnl.gov
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From list at joreybump.com  Fri Dec  9 14:17:57 2005
From: list at joreybump.com (Jorey Bump)
Date: Fri Dec  9 14:18:05 2005
Subject: [mod_python] 500 internal server error
In-Reply-To: <Pine.LNX.4.44.0512091029250.25729-100000@oldben.llnl.gov>
References: <Pine.LNX.4.44.0512091029250.25729-100000@oldben.llnl.gov>
Message-ID: <4399D865.1090707@joreybump.com>

chase3@llnl.gov wrote:
> As a first step in moving a CGI script to mod_python, I wrapped the
> script in a handler.  This seems to work and the database does 
> receive the data.   It looks like things should be ok.  However,
> I am getting a 500 Internal Server Error back that I have not been
> able to figure out, as there were no other clues in the error_log.  
> In fact, putting an log message shows execution is successful:
> 
>   ...
>     # Close the connection
>     db.close()
>     apache.log_error ( "success", apache.APLOG_ERR )
>     return apache.OK
>   else:
>     apache.log_error ( "Failed!", apache.APLOG_ERR )
>     return apache.SERVER_RETURN
> 
> I get "success" in the log file.

if...?

> I put this mod_python script in the cgi-bin because when it was 
> in htdocs, I ran into 401 Authorization Required problems.

First, don't put mod_python scripts in cgi-bin. They are not CGI.

> I should mention that I am not communicating to the server with
> a URL in a browser, but through a utility that uses CURL and SSL to
> do an HTTPS post, so user authentication is not possible.

If you want unrestricted access to a file, put it in a directory without 
restrictions or override the restrictions in your configuration.

> When the mod_python script is in cgi-bin, user authentication is 
> not required. 

Perhaps, but it will cause problems in some configurations.

> The software uses a digital signature for authentication.
> 
> <Directory "/etc/httpd/cgi-bin/tracker">
>     AddHandler python-program .py
>     PythonHandler mod_python.publisher
>     PythonDebug On
> </Directory>

Create a separate directory outside of your document root. Use the Alias 
directive to make it accessible. Revise your Directory container above 
to refer to the new directory. Use SetHandler instead of AddHandler, and 
only put .py files in it. Put other resources like images, css, etc. in 
your normal document root. Although switching to SetHandler is optional, 
there are a lot of benefits.

> Any ideas on how to locate the server error?

Your apache error log is the best source. But your current configuration 
is a little screwy, so try the steps I've described.

From jd at commandprompt.com  Fri Dec  9 14:33:29 2005
From: jd at commandprompt.com (Joshua D. Drake)
Date: Fri Dec  9 14:30:46 2005
Subject: [mod_python] Compiling on X86_64?
In-Reply-To: <43988507.6070104@jgassociates.ca>
References: <4394C012.3030804@commandprompt.com>
	<20051205181157.K59199@grisha.dyndns.org>
	<4394E77F.4010307@commandprompt.com>
	<20051205223847.X66546@grisha.dyndns.org>
	<43979668.8070808@commandprompt.com>	<43979F9F.2040608@commandprompt.com>
	<20051207223950.N7686@grisha.dyndns.org>
	<1134067909.8592.11.camel@jd.commandprompt.com>
	<43988507.6070104@jgassociates.ca>
Message-ID: <1134156809.28319.17.camel@jd.commandprompt.com>


> > It GNU no longer supports the version of flex that is actively developed
> > and it the newer version needs to be retrieved from sourceforge. You may
> > want to make note in your docs.
> > 
> 
> You may want to read the output from configure more carefully. You only 
> need flex if you want to regenerate psp_parser.c after making changes to 
> psp_parser.l. Otherwise you can use the pre-generated psp_parser.c 
> provided with the source to accomodate distributions that ship with the 
> older flex. This is information is also detailed in the docs and README.

Fair enough :) but that doesn't actually address  my point which is that
the mod_python docs to not state that the newer version of flex is not
retrieved from your normal channels for the majority of your users :)

Sincerely,

Joshua D. Drake

> 
> Jim
-- 
The PostgreSQL Company - Command Prompt, Inc. 1.503.667.4564
PostgreSQL Replication, Consulting, Custom Development, 24x7 support
Managed Services, Shared and Dedicated Hosting
Co-Authors: PLphp, PLperl, ODBCng - http://www.commandprompt.com/


From grahamd at dscpl.com.au  Fri Dec  9 15:26:38 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Fri Dec  9 15:26:48 2005
Subject: [mod_python] Concurrent requests
In-Reply-To: <4399B83F.8080000@jgassociates.ca>
References: <001a01c5fcd2$e1f097e0$3701a8c0@targa>	<4399AAB5.3090404@jgassociates.ca>
	<001001c5fcdf$4bf9dd20$3701a8c0@targa>
	<4399B83F.8080000@jgassociates.ca>
Message-ID: <E69C045C-634C-4C24-ADE9-2060EA563AA5@dscpl.com.au>

The lock would only be a problem if the sleep() call were being  
executed as
part of a module import.

Can OP post simplified code demonstrating problem?

BTW, why do you want to call sleep(), or is this just experimenting?

Graham

On 10/12/2005, at 4:00 AM, Jim Gallacher wrote:

> I wonder if it's related to the page cache mechanism acquring a  
> global lock? Niclolas is more familiar with that code in psp.py and  
> may be able to comment.
>
> Jim
>
> Lars Eriksen wrote:
>
>>> Are you using sessions?
>>>
>> No.
>>
>>> Which mod_python version?
>>>
>> Apache/2.0.55 (Win32) mod_python/3.2.5b Python/2.4.2
>>
>>> Apache mpm prefork, worker or threaded?
>>>
>> Default Apache NT installation, which uses the MPM in threaded mode.
>> I only added the following to my main directory configuration:
>> AddHandler mod_python .htm
>> PythonHandler mod_python.psp
>> PythonDebug On
>> Thanks in advance!
>> ----- Original Message ----- From: "Jim Gallacher"  
>> <jpg@jgassociates.ca>
>> To: "Lars Eriksen" <downgrade@gmx.org>
>> Cc: <mod_python@modpython.org>
>> Sent: Friday, December 09, 2005 5:03 PM
>> Subject: Re: [mod_python] Concurrent requests
>>
>>> Are you using sessions?
>>> Which mod_python version?
>>> Apache mpm prefork, worker or threaded?
>>>
>>> Jim
>>>
>>>
>>> Lars Eriksen wrote:
>>>
>>>
>>>> I have created a simple .psp script that simply calls sleep(...)  
>>>> and blocks execution for a certain amount of time (x seconds).
>>>>
>>>> If I access the .psp script in two instances of my browser at  
>>>> the same time, request one waits x seconds, then it finishes,  
>>>> then request two is processed and finishes after x * 2 seconds.
>>>>
>>>> Requests are obviously queued and not several Python  
>>>> interpreters spawned to handle them concurrently.
>>>>
>>>> Is there any setting that allows you to specify the number of  
>>>> Python interpreters that should be used?
>>>>
>>>> Thanks,
>>>>
>>>> -Lars
>>>> _______________________________________________
>>>> Mod_python mailing list
>>>> Mod_python@modpython.org
>>>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>>>
>>>>
>>>
>>>
>>>
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>

From grahamd at dscpl.com.au  Fri Dec  9 15:32:46 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Fri Dec  9 15:33:29 2005
Subject: [mod_python] Concurrent requests
In-Reply-To: <E69C045C-634C-4C24-ADE9-2060EA563AA5@dscpl.com.au>
References: <001a01c5fcd2$e1f097e0$3701a8c0@targa>	<4399AAB5.3090404@jgassociates.ca>
	<001001c5fcdf$4bf9dd20$3701a8c0@targa>
	<4399B83F.8080000@jgassociates.ca>
	<E69C045C-634C-4C24-ADE9-2060EA563AA5@dscpl.com.au>
Message-ID: <849F5AEC-A7D0-47E5-A5AD-33F5BE3A4889@dscpl.com.au>

Also, are you using sessions?

So many questions, that is why an example would be good.

Graham

On 10/12/2005, at 7:26 AM, Graham Dumpleton wrote:

> The lock would only be a problem if the sleep() call were being  
> executed as
> part of a module import.
>
> Can OP post simplified code demonstrating problem?
>
> BTW, why do you want to call sleep(), or is this just experimenting?
>
> Graham
>
> On 10/12/2005, at 4:00 AM, Jim Gallacher wrote:
>
>
>> I wonder if it's related to the page cache mechanism acquring a  
>> global lock? Niclolas is more familiar with that code in psp.py  
>> and may be able to comment.
>>
>> Jim
>>
>> Lars Eriksen wrote:
>>
>>
>>>> Are you using sessions?
>>>>
>>>>
>>> No.
>>>
>>>
>>>> Which mod_python version?
>>>>
>>>>
>>> Apache/2.0.55 (Win32) mod_python/3.2.5b Python/2.4.2
>>>
>>>
>>>> Apache mpm prefork, worker or threaded?
>>>>
>>>>
>>> Default Apache NT installation, which uses the MPM in threaded mode.
>>> I only added the following to my main directory configuration:
>>> AddHandler mod_python .htm
>>> PythonHandler mod_python.psp
>>> PythonDebug On
>>> Thanks in advance!
>>> ----- Original Message ----- From: "Jim Gallacher"  
>>> <jpg@jgassociates.ca>
>>> To: "Lars Eriksen" <downgrade@gmx.org>
>>> Cc: <mod_python@modpython.org>
>>> Sent: Friday, December 09, 2005 5:03 PM
>>> Subject: Re: [mod_python] Concurrent requests
>>>
>>>
>>>> Are you using sessions?
>>>> Which mod_python version?
>>>> Apache mpm prefork, worker or threaded?
>>>>
>>>> Jim
>>>>
>>>>
>>>> Lars Eriksen wrote:
>>>>
>>>>
>>>>
>>>>> I have created a simple .psp script that simply calls sleep 
>>>>> (...) and blocks execution for a certain amount of time (x  
>>>>> seconds).
>>>>>
>>>>> If I access the .psp script in two instances of my browser at  
>>>>> the same time, request one waits x seconds, then it finishes,  
>>>>> then request two is processed and finishes after x * 2 seconds.
>>>>>
>>>>> Requests are obviously queued and not several Python  
>>>>> interpreters spawned to handle them concurrently.
>>>>>
>>>>> Is there any setting that allows you to specify the number of  
>>>>> Python interpreters that should be used?
>>>>>
>>>>> Thanks,
>>>>>
>>>>> -Lars
>>>>> _______________________________________________
>>>>> Mod_python mailing list
>>>>> Mod_python@modpython.org
>>>>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>>>>
>>>>>
>>>>>
>>>>
>>>>
>>>>
>>>>
>>> _______________________________________________
>>> Mod_python mailing list
>>> Mod_python@modpython.org
>>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>>
>>>
>>
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>
>>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>

From jpg at jgassociates.ca  Fri Dec  9 16:21:14 2005
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Fri Dec  9 16:19:02 2005
Subject: [mod_python] Compiling on X86_64?
In-Reply-To: <1134156809.28319.17.camel@jd.commandprompt.com>
References: <4394C012.3030804@commandprompt.com>	<20051205181157.K59199@grisha.dyndns.org>	<4394E77F.4010307@commandprompt.com>	<20051205223847.X66546@grisha.dyndns.org>	<43979668.8070808@commandprompt.com>	<43979F9F.2040608@commandprompt.com>	<20051207223950.N7686@grisha.dyndns.org>	<1134067909.8592.11.camel@jd.commandprompt.com>	<43988507.6070104@jgassociates.ca>
	<1134156809.28319.17.camel@jd.commandprompt.com>
Message-ID: <4399F54A.5050008@jgassociates.ca>

Joshua D. Drake wrote:
>>>It GNU no longer supports the version of flex that is actively developed
>>>and it the newer version needs to be retrieved from sourceforge. You may
>>>want to make note in your docs.
>>>
>>
>>You may want to read the output from configure more carefully. You only 
>>need flex if you want to regenerate psp_parser.c after making changes to 
>>psp_parser.l. Otherwise you can use the pre-generated psp_parser.c 
>>provided with the source to accomodate distributions that ship with the 
>>older flex. This is information is also detailed in the docs and README.
> 
> 
> Fair enough :) but that doesn't actually address  my point which is that
> the mod_python docs to not state that the newer version of flex is not
> retrieved from your normal channels for the majority of your users :)

Here is the relevant section of the README (3.2.5b), which is pretty
much duplicated in the html-docs.

----------------------------------------------------------------
2. ./configure will generate a WARNING if it cannot find flex, or it
is the wrong version. Generally you can ignore this warning and still
successfully compile mod_python.

The parser used by psp is written in C generated using flex. This
requires a reentrant version of flex, which at this time is 2.5.31.
Most platforms however ship with version 2.5.4 which is not suitable,
so a pre-generated copy of src/psp_parser.c is included with the source.
If you make changes to src/psp_parser.l and need to recompile the
src/psp_parser.c file, you must get the correct flex version.

You can specify the path the flex binary by using
./configure --with-flex=/path/to/flex/binary.
--------------------------------------------------------------

Any suggestions on how to improve this literary gem are welcome. I agree
that we should mention that the correct flex is available from
http://lex.sourceforge.net. The confusing part is that most people
compiling mod_python will never need flex, since the file that it
generates is included with the source. If someone can come up with the
magic words that convey this I'd be more than happy to change the docs.

Personally, I think the correct answer to the problem is "use Debian"
which seems to be the only platform that *does* ship with the more
recent flex. But since people will insist on using other platforms... ;)

Jim

From nick at dd.revealed.net  Fri Dec  9 16:26:16 2005
From: nick at dd.revealed.net (Nick)
Date: Fri Dec  9 16:26:20 2005
Subject: [mod_python] Compiling on X86_64?
In-Reply-To: <4399F54A.5050008@jgassociates.ca>
References: <4394C012.3030804@commandprompt.com>	<20051205181157.K59199@grisha.dyndns.org>	<4394E77F.4010307@commandprompt.com>	<20051205223847.X66546@grisha.dyndns.org>	<43979668.8070808@commandprompt.com>	<43979F9F.2040608@commandprompt.com>	<20051207223950.N7686@grisha.dyndns.org>	<1134067909.8592.11.camel@jd.commandprompt.com>	<43988507.6070104@jgassociates.ca>	<1134156809.28319.17.camel@jd.commandprompt.com>
	<4399F54A.5050008@jgassociates.ca>
Message-ID: <4399F678.8020104@dd.revealed.net>

Jim Gallacher wrote:
> Personally, I think the correct answer to the problem is "use Debian"
> which seems to be the only platform that *does* ship with the more
> recent flex. But since people will insist on using other platforms... ;)

Silly people ;-)

Nick
From jpg at jgassociates.ca  Fri Dec  9 16:49:11 2005
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Fri Dec  9 16:46:51 2005
Subject: Developer guidelines (was Re:[mod_python] inspect.getmembers(req)
	segfaults)
In-Reply-To: <4399D39A.3060907@cdi.cz>
References: <1134019205.13049@dscpl.user.openhosting.com>	<43999354.2090904@cdi.cz>	<4399BA89.3010500@jgassociates.ca>
	<4399BFC7.3060109@cdi.cz> <4399D39A.3060907@cdi.cz>
Message-ID: <4399FBD7.3060900@jgassociates.ca>

Hello Martin,

Martin Devera wrote:
>> I found other coredump, more on it later :)

Death to the coredumps!

> Ok I attached cumulative fix for 3 similar bugs. By the way
> I found no information who is the original author

Why? Are you looking for someone to blame? ;)

You may want to join the python-dev mailing list and shift these 
discussions over there. I've attached my developer's guide which should 
answer your questions on how to contribute. It's still a work in 
progress but I don't think I've made any serious blunders. One day this 
document may even find a home on the web.

In the mean time I'll create a JIRA issue for your bug. Thanks for your 
contribution.

Jim




-------------- next part --------------
:version: $Id: developers-guide.rst 348589 2005-11-23 23:11:11Z jgallacher $

=============================================
Developer's Guide for mod_python Contributors
=============================================

Mod_Python is a subproject of the Apache `httpd server project`_.
As such we strive to conform to the practices recommended by the
`Apache Software Foundation`_.

.. _httpd server project: http://httpd.apache.org/
.. _Apache Software Foundation: http://www.apache.org/


Becoming a Developer
====================

A developer_ is a user who contributes to a project in the form of code or 
documentation. They take extra steps to participate in a project, are active
on the developer mailing list, participate in discussions, provide patches,
documentation, suggestions, and criticism. Developers are also known as 
contributors.

Contributions from developers are integrated into mod_python by committers_
at the committer's discretion.

*(Should we mention that everyone on python-dev gets a vote on releases? -jg)*

*(Should we mention that becoming a committer is by invitation only? -jg)*

See `ASF roles`_ for more information.

.. _developer: http://www.apache.org/foundation/how-it-works.html#developers
.. _committers: http://www.apache.org/foundation/how-it-works.html#committers

.. _ASF roles: http://www.apache.org/foundation/how-it-works.html#roles

Developer Mailing List
======================

Development issues such as patches, bug fixes, ideas, etc are discussed
on the python-dev mailing list. Subscribe to the python-dev@httpd.apache.org
list by mailing python-dev-subscribe@httpd.apache.org.  This is a advanced
topic list for people who are versed in C and Apache httpd internals. 

The mailing list archive is available from gmane.org. See
http://dir.gmane.org/gmane.comp.apache.mod-python.devel


*(I borrowed this bit from the website. I think we could re-phrase this to 
be a little less intimidating. People with good python skills but no knowledge
of apache internals or C can still make valuable contributions. -jg)*

Issue Tracking
==============

The mod_python project uses JIRA. The best way to ensure
your improvements, suggestions or bug reports are not lost in the noise of the
mailing list is to create a new issue in JIRA. Likewise, if you have a patch
you want to submit it is best to attach it to the appropriate JIRA issue rather
than sending it to directly to the mailing list. The python-dev mailing list
automatically receives a message when a JIRA issue is created or modified so
you can be assured your issue will get noticed.

See http://issues.apache.org/jira/browse/MODPYTHON.

.. _issue tracking: http://issues.apache.org/jira/browse/MODPYTHON

Subversion Code Repository
==========================

The mod_python project uses Subversion for version control. You can browse_
the repository online. For more help on using Subversion, consult the `Subversion website`_ or 
the `Subversion book`_. The web site provides a list of `clients and useful
links`_.

.. _browse: http://svn.apache.org/viewcvs.cgi/httpd/mod_python/

.. _Subversion website: http://subversion.tigris.org/
.. _Subversion book: http://svnbook.red-bean.com/
.. _clients and useful links: http://subversion.tigris.org/project_links.html

Anonymous Subversion Checkout
-----------------------------

To access the Subversion repositories anonymously, you will need a Subversion
client.

Choose the branch you would like to work on and check it out. For example, 
to get the current development branch (trunk), use::

  svn co http://svn.apache.org/repos/asf/httpd/mod_python/trunk mod_python

Subversion Commit Notifications
-------------------------------

Subversion commit notifications are available on the  python-cvs mailing list.
Subscribe to the python-cvs@httpd.apache.org mailing list by mailing
python-cvs-subscribe@httpd.apache.org.


Writing Code
============

You should develop your code using the working copy of mod_python you checked
out with Subversion.

Coding Style
------------

Python
......

Indent your code with 4 spaces.

*(Let's expand this section with some good general recommendations. -jg)*


C Language
..........

For C-language coding style, follow the `Apache Developers' C Language Style
Guide`_.

.. _Apache Developers' C Language Style Guide: http://www.apache.org/dev/styleguide.html


Comments
........

As per the Apache style guide, use only C-style comments in your C-code. 
Do not use C++ style comments.

Use the Doxygen format for comments.

*(I'll add a quick and dirty guide to doxygen. -jg)*


Unit Tests
==========

We like unit tests. Get in the habit of running the tests when you modify some
code. Likewise it's very helpful if you can write unit tests for your new code.

*(Maybe stick a simple example explaining how to write a unit test here? -jg)*


Documentation
=============

Ideally you'll provide documentation for your code as a patch to the current
docs.  However, if you don't feel comfortable writing LaTex code feel
free to write in plain text. Heck, we'll accept good documentation in just
about any format.

Preparing Your Code For Submission
==================================

The preferred form for submitted code is as a patch created as a diff against
the current development branch. The diffs should be in the unified diff
format. Luckily, Subversion makes this easy. To create a patch for 
changes made to src/util.c use svn diff::

  svn diff src/util.c > jg-20051114.diff

Choose a reasonable name for your patch. Files attached to a JIRA issue
are sorted alphabetically and listed at the top of the JIRA page for that
issue. It'll make it easier to understand what has been uploaded if you
adopt a consistent naming scheme.

*(Perhaps we can agree on a naming scheme that contributors would be 
urged to adopt. Take a look at `MODPYTHON-77`_ to see why this is desirable.)*

.. _MODPYTHON-77: http://issues.apache.org/jira/browse/MODPYTHON-77

License
=======

As with all Apache Software Foundation projects, mod_python is licensed under
the current `Apache Software License (ASL)`_, `Version 2.0`_.

.. _Apache Software License (ASL): http://www.apache.org/licenses
.. _Version 2.0: http://www.apache.org/licenses/LICENSE-2.0.html
From downgrade at gmx.org  Fri Dec  9 17:08:18 2005
From: downgrade at gmx.org (Lars Eriksen)
Date: Fri Dec  9 17:07:50 2005
Subject: [mod_python] Concurrent requests
References: <001a01c5fcd2$e1f097e0$3701a8c0@targa>	<4399AAB5.3090404@jgassociates.ca>
	<001001c5fcdf$4bf9dd20$3701a8c0@targa>
	<4399B83F.8080000@jgassociates.ca>
	<E69C045C-634C-4C24-ADE9-2060EA563AA5@dscpl.com.au>
Message-ID: <001401c5fd0d$1037ed30$3701a8c0@targa>

I posted my httpd.conf setup earlier. I am just experimenting, yes. Here is 
the content of the .psp file I use:

<%
import time
time.sleep(10)
req.write('Done.')
%>

As I've mentioned, I access the script concurrently using two browser 
instances.


----- Original Message ----- 
From: "Graham Dumpleton" <grahamd@dscpl.com.au>
To: "Jim Gallacher" <jpg@jgassociates.ca>
Cc: "Lars Eriksen" <downgrade@gmx.org>; <mod_python@modpython.org>
Sent: Friday, December 09, 2005 9:26 PM
Subject: Re: [mod_python] Concurrent requests


> The lock would only be a problem if the sleep() call were being  executed 
> as
> part of a module import.
>
> Can OP post simplified code demonstrating problem?
>
> BTW, why do you want to call sleep(), or is this just experimenting?
>
> Graham
>
> On 10/12/2005, at 4:00 AM, Jim Gallacher wrote:
>
>> I wonder if it's related to the page cache mechanism acquring a  global 
>> lock? Niclolas is more familiar with that code in psp.py and  may be able 
>> to comment.
>>
>> Jim
>>
>> Lars Eriksen wrote:
>>
>>>> Are you using sessions?
>>>>
>>> No.
>>>
>>>> Which mod_python version?
>>>>
>>> Apache/2.0.55 (Win32) mod_python/3.2.5b Python/2.4.2
>>>
>>>> Apache mpm prefork, worker or threaded?
>>>>
>>> Default Apache NT installation, which uses the MPM in threaded mode.
>>> I only added the following to my main directory configuration:
>>> AddHandler mod_python .htm
>>> PythonHandler mod_python.psp
>>> PythonDebug On
>>> Thanks in advance!
>>> ----- Original Message ----- From: "Jim Gallacher" 
>>> <jpg@jgassociates.ca>
>>> To: "Lars Eriksen" <downgrade@gmx.org>
>>> Cc: <mod_python@modpython.org>
>>> Sent: Friday, December 09, 2005 5:03 PM
>>> Subject: Re: [mod_python] Concurrent requests
>>>
>>>> Are you using sessions?
>>>> Which mod_python version?
>>>> Apache mpm prefork, worker or threaded?
>>>>
>>>> Jim
>>>>
>>>>
>>>> Lars Eriksen wrote:
>>>>
>>>>
>>>>> I have created a simple .psp script that simply calls sleep(...)  and 
>>>>> blocks execution for a certain amount of time (x seconds).
>>>>>
>>>>> If I access the .psp script in two instances of my browser at  the 
>>>>> same time, request one waits x seconds, then it finishes,  then 
>>>>> request two is processed and finishes after x * 2 seconds.
>>>>>
>>>>> Requests are obviously queued and not several Python  interpreters 
>>>>> spawned to handle them concurrently.
>>>>>
>>>>> Is there any setting that allows you to specify the number of  Python 
>>>>> interpreters that should be used?
>>>>>
>>>>> Thanks,
>>>>>
>>>>> -Lars
>>>>> _______________________________________________
>>>>> Mod_python mailing list
>>>>> Mod_python@modpython.org
>>>>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>>>>
>>>>>
>>>>
>>>>
>>>>
>>> _______________________________________________
>>> Mod_python mailing list
>>> Mod_python@modpython.org
>>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>>
>>
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>
>
> 

From scott_list at mischko.com  Fri Dec  9 17:33:35 2005
From: scott_list at mischko.com (Scott Chapman)
Date: Fri Dec  9 17:33:44 2005
Subject: [mod_python] Why can't  psycopg2 beta adapt this:
In-Reply-To: <17305.48370.148028.841814@io.astro.umass.edu>
References: <43991B82.3050401@mischko.com>
	<17305.48370.148028.841814@io.astro.umass.edu>
Message-ID: <439A063F.1030607@mischko.com>

Daniel J. Popowich wrote:
> Scott Chapman writes:
> 
>>Mod_Python has a StringField class and psycopg2 can't seem to adapt it 
>>correctly. Type(stringfield_string) shows as:
>><class 'mod_python.util.StringField'>
>>
>>Strings of this class have 3 extra items in dir(stringfield_string) which 
>>regular strins don't have:
>>'__dict__', '__module__', 'value'
>>
>>Here's the class definition from mod_python.util:
>>class StringField(str):
>>    """ This class is basically a string with
>>    a value attribute for compatibility with std lib cgi.py
>>    """
>>
>>    def __init__(self, str=""):
>>        str.__init__(self, str)
>>        self.value = self.__str__()
>>
>>How do I make psycopg2 deal with these correctly?  It seems like
>>there's a way to make custom "adapters" but I'm rather clueless
>>here.  I just need psycopg2 to run str() on the StringField instance
>>and it'd work great.
> 
> 
> This is a pain, I know.  I use psycopg extensively and have been
> burned more than once.  There's nothing you can really do at the
> psycopg module (afaik), but it's easy enough in your code...you can do
> one of a few things:
> 
>   1. a pain, but use str() explicitly.
> 
>   2. build your query strings using python string formatting, instead
>      of the parameters of the cursor.execute() method.  E.g.:
> 
>        cur.execute("insert into mytable (col1, col5)
>                     values ('%s', %d)" % (some_str, some_int))
> 
>      the %s will automatically call __str__() if some_str is not a
>      str.
> 
>   3. Are you still using mpservlets? (you were at one time)  If you
>      use query_vars to process your forms, your instance variables are
>      converted to str automagically.  In the attached servlet,
>      types.mps, if you call it with: types?field=abc&realstr=def the
>      output will be:
> 
> 	  field: abc
> 	  type(field): <class 'mod_python.util.StringField'>
> 	  realstr: def
> 	  type(realstr): <type 'str'>
> 

You've got a good memory Daniel!  I took what I wanted of mpservlets and made my 
own mod_python handler from it.

Here's the fix action:

import psycopg2
import psycopg2.extras
import psycopg2.extensions
import mod_python

psycopg2.extensions.register_adapter(mod_python.util.StringField, 
psycopg2.extensions.QuotedString)

Scott
From dpopowich at comcast.net  Fri Dec  9 18:09:51 2005
From: dpopowich at comcast.net (Daniel J. Popowich)
Date: Fri Dec  9 18:09:45 2005
Subject: [mod_python] Why can't  psycopg2 beta adapt this:
In-Reply-To: <439A063F.1030607@mischko.com>
References: <43991B82.3050401@mischko.com>
	<17305.48370.148028.841814@io.astro.umass.edu>
	<439A063F.1030607@mischko.com>
Message-ID: <17306.3775.116605.492296@io.astro.umass.edu>


Scott Chapman writes:
> >   3. Are you still using mpservlets? (you were at one time)
> >      ...
> 
> You've got a good memory Daniel!  I took what I wanted of mpservlets and made my 
> own mod_python handler from it.

It's easy to remember all three of you!  :-)

> Here's the fix action:
> 
> import psycopg2
> import psycopg2.extras
> import psycopg2.extensions
> import mod_python
> 
> psycopg2.extensions.register_adapter(mod_python.util.StringField, 
> psycopg2.extensions.QuotedString)

Thanks for the tip...I'll file that away.

-d
From jd at commandprompt.com  Fri Dec  9 18:59:45 2005
From: jd at commandprompt.com (Joshua D. Drake)
Date: Fri Dec  9 18:57:06 2005
Subject: [mod_python] Compiling on X86_64?
In-Reply-To: <4399F678.8020104@dd.revealed.net>
References: <4394C012.3030804@commandprompt.com>
	<20051205181157.K59199@grisha.dyndns.org>
	<4394E77F.4010307@commandprompt.com>
	<20051205223847.X66546@grisha.dyndns.org>
	<43979668.8070808@commandprompt.com>	<43979F9F.2040608@commandprompt.com>
	<20051207223950.N7686@grisha.dyndns.org>
	<1134067909.8592.11.camel@jd.commandprompt.com>
	<43988507.6070104@jgassociates.ca>
	<1134156809.28319.17.camel@jd.commandprompt.com>
	<4399F54A.5050008@jgassociates.ca> <4399F678.8020104@dd.revealed.net>
Message-ID: <1134172785.30268.9.camel@jd.commandprompt.com>

On Fri, 2005-12-09 at 15:26 -0600, Nick wrote:
> Jim Gallacher wrote:
> > Personally, I think the correct answer to the problem is "use Debian"
> > which seems to be the only platform that *does* ship with the more
> > recent flex. But since people will insist on using other platforms... ;)
> 
> Silly people ;-)

Actually that is simple. I have a X64 machine so I have to run Ubuntu ;)

Joshua D. Drake

> 
> Nick
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
-- 
The PostgreSQL Company - Command Prompt, Inc. 1.503.667.4564
PostgreSQL Replication, Consulting, Custom Development, 24x7 support
Managed Services, Shared and Dedicated Hosting
Co-Authors: PLphp, PLperl, ODBCng - http://www.commandprompt.com/


From devik at cdi.cz  Fri Dec  9 19:44:13 2005
From: devik at cdi.cz (Martin Devera)
Date: Fri Dec  9 19:44:26 2005
Subject: Developer guidelines (was Re:[mod_python] inspect.getmembers(req)
	segfaults)
In-Reply-To: <4399FBD7.3060900@jgassociates.ca>
References: <1134019205.13049@dscpl.user.openhosting.com>	<43999354.2090904@cdi.cz>	<4399BA89.3010500@jgassociates.ca>
	<4399BFC7.3060109@cdi.cz> <4399D39A.3060907@cdi.cz>
	<4399FBD7.3060900@jgassociates.ca>
Message-ID: <439A24DD.5090607@cdi.cz>

Jim Gallacher wrote:
> Hello Martin,
> 
> Martin Devera wrote:
>>> I found other coredump, more on it later :)
> 
> Death to the coredumps!
> 
>> Ok I attached cumulative fix for 3 similar bugs. By the way
>> I found no information who is the original author
> 
> Why? Are you looking for someone to blame? ;)

Well, no, I'm just always interested when I start to use some project
about its history and ppl behind :-)
The guidelines you sent are helpful in any case !

regards, devik

From grahamd at dscpl.com.au  Fri Dec  9 23:10:56 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Fri Dec  9 23:11:07 2005
Subject: [mod_python] 500 internal server error
In-Reply-To: <66A801E7-1B2B-41EF-A521-B85A11AB29FC@packet-addiction.org>
References: <Pine.LNX.4.44.0512091029250.25729-100000@oldben.llnl.gov>
	<66A801E7-1B2B-41EF-A521-B85A11AB29FC@packet-addiction.org>
Message-ID: <48AF2457-7091-474E-AB62-7E3BE1FE2B3F@dscpl.com.au>

Even if apache.OK is returned, I would have expected it to display "0"
unless mod_python 3.0.3 is a bit different. There is though possibly  
some
other exit point from the function where no explicit return values is  
given
and thus None is returned. This would cause a 500 error with older
versions of mod_python.

Either way, I would really suggest that you upgrade from mod_python  
3.0.3
to mod_python 3.2.5b if your problems continue as it is easier for us to
debug things when the current version is used and not some obsolete
version that is no longer even supported.

Graham


On 10/12/2005, at 6:07 AM, Peter Sanchez wrote:

> You are using mod_python.publisher, so you need to return your HTML  
> code. Try this, instead of:
>
>     return apache.OK
>
> Use:
>
>    return '<center><h1>Testing</h1></center>'
>
> Should solve your problem.
>
> Peter
>
>
> On Dec 9, 2005, at 10:36 AM, chase3@llnl.gov wrote:
>
>
>> As a first step in moving a CGI script to mod_python, I wrapped the
>> script in a handler.  This seems to work and the database does
>> receive the data.   It looks like things should be ok.  However,
>> I am getting a 500 Internal Server Error back that I have not been
>> able to figure out, as there were no other clues in the error_log.
>> In fact, putting an log message shows execution is successful:
>>
>>   ...
>>     # Close the connection
>>     db.close()
>>     apache.log_error ( "success", apache.APLOG_ERR )
>>     return apache.OK
>>   else:
>>     apache.log_error ( "Failed!", apache.APLOG_ERR )
>>     return apache.SERVER_RETURN
>>
>> I get "success" in the log file.
>>
>> I put this mod_python script in the cgi-bin because when it was
>> in htdocs, I ran into 401 Authorization Required problems.
>> I should mention that I am not communicating to the server with
>> a URL in a browser, but through a utility that uses CURL and SSL to
>> do an HTTPS post, so user authentication is not possible.
>> When the mod_python script is in cgi-bin, user authentication is
>> not required. The software uses a digital signature for  
>> authentication.
>>
>> <Directory "/etc/httpd/cgi-bin/tracker">
>>     AddHandler python-program .py
>>     PythonHandler mod_python.publisher
>>     PythonDebug On
>> </Directory>
>>
>> Any ideas on how to locate the server error?
>>
>> Apache server is at 2.0.46; python 2.2.35 and mod_python-3.0.3-3.ent
>>
>> Thanks,
>> Lila
>>
>>
>> -- 
>> Lila Chase
>> lchase@llnl.gov
>>
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>

From grahamd at dscpl.com.au  Fri Dec  9 23:17:00 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Fri Dec  9 23:17:11 2005
Subject: [mod_python] Problems with headers in proxy handler
In-Reply-To: <cd329af80512070514p5a749d1fl@mail.gmail.com>
References: <cd329af80512070514p5a749d1fl@mail.gmail.com>
Message-ID: <629F8D5D-BF37-48DC-822A-B1B60643351A@dscpl.com.au>

Which version of mod_python are you using?

On 08/12/2005, at 12:14 AM, Sebastjan Trepca wrote:

> Hi,
>
> I'm writing a proxy handler which makes a request to a different page
> and retrieves its content and headers. This is the source:
>
> import urllib2
> from mod_python import util
>
> def handler(req):
>     req.headers_out.clear()
>     f = util.FieldStorage(req)
>     url = f.get('url',None)
>     if(url):
>         url=url.split('?')
>         if(len(url)>1):
>             u = url[0]
>             p = url[1]
>             ureq = urllib2.Request(u,p)
>         else:
>             u = url[0]
>             ureq = urllib2.Request(u)
>         for h in req.headers_in:
>             ureq.add_header(h,req.headers_in[h])
>         r = urllib2.urlopen(ureq)
>         for h in r.headers:
>             req.headers_out[h]=r.headers[h]
>         data =     r.read()

In case you are using mod_python 2.7.X, add at this point:

            req.send_http_header()

>         req.write(data)
>         return 0#-2 doesn't help either
>     return 0

Will not make a difference, but don't return 0/2, use apache.OK/ 
apache.DONE
instead. Using literal integer values is bad programming practice.

> But this seems to have problems with headers, I get back basic headers
> from my Apache server, which is wrong of course.
> Any ideas why is this happening?

Graham
From nicolas.lehuen at gmail.com  Sat Dec 10 03:59:44 2005
From: nicolas.lehuen at gmail.com (Nicolas Lehuen)
Date: Sat Dec 10 03:59:48 2005
Subject: [mod_python] Concurrent requests
In-Reply-To: <001401c5fd0d$1037ed30$3701a8c0@targa>
References: <001a01c5fcd2$e1f097e0$3701a8c0@targa>
	<4399AAB5.3090404@jgassociates.ca>
	<001001c5fcdf$4bf9dd20$3701a8c0@targa>
	<4399B83F.8080000@jgassociates.ca>
	<E69C045C-634C-4C24-ADE9-2060EA563AA5@dscpl.com.au>
	<001401c5fd0d$1037ed30$3701a8c0@targa>
Message-ID: <c298f2d70512100059n2b3eb417q@mail.gmail.com>

Hi Lars,

I cannot reproduce your problem. Here is what I've done :

E:\Documents and Settings\Nico>ab -c 10 -n 10 http://shuttle/test.psp
This is ApacheBench, Version 2.0.41-dev <$Revision: 1.121.2.12 $> apache-2.0
Copyright (c) 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
Copyright (c) 1998-2002 The Apache Software Foundation, http://www.apache.org/

Benchmarking shuttle (be patient).....done


Server Software:        Apache
Server Hostname:        shuttle
Server Port:            80

Document Path:          /test.psp
Document Length:        5 bytes

Concurrency Level:      10
Time taken for tests:   10.34429 seconds
Complete requests:      10
Failed requests:        0
Write errors:           0
Total transferred:      1410 bytes
HTML transferred:       50 bytes
Requests per second:    1.00 [#/sec] (mean)
Time per request:       10034.429 [ms] (mean)
Time per request:       1003.443 [ms] (mean, across all concurrent requests)
Transfer rate:          0.10 [Kbytes/sec] received

Connection Times (ms)
              min  mean[+/-sd] median   max
Connect:        0    1   3.2      0      10
Processing: 10014 10019   7.1  10014   10034
Waiting:    10004 10018   8.4  10014   10034
Total:      10014 10020   7.0  10024   10034

Percentage of the requests served within a certain time (ms)
  50%  10024
  66%  10024
  75%  10024
  80%  10024
  90%  10034
  95%  10034
  98%  10034
  99%  10034
 100%  10034 (longest request)

Clearly the 10 requests are handled concurrently. I've also done tests
with raw handlers and mod_python.publisher, and everything looks fine.
I have exactly the same configuration, running under Windows XP.

Please try doing the same tests using ab and tell us what you get.

Regards;
Nicolas

2005/12/9, Lars Eriksen <downgrade@gmx.org>:
> I posted my httpd.conf setup earlier. I am just experimenting, yes. Here is
> the content of the .psp file I use:
>
> <%
> import time
> time.sleep(10)
> req.write('Done.')
> %>
>
> As I've mentioned, I access the script concurrently using two browser
> instances.
>
>
> ----- Original Message -----
> From: "Graham Dumpleton" <grahamd@dscpl.com.au>
> To: "Jim Gallacher" <jpg@jgassociates.ca>
> Cc: "Lars Eriksen" <downgrade@gmx.org>; <mod_python@modpython.org>
> Sent: Friday, December 09, 2005 9:26 PM
> Subject: Re: [mod_python] Concurrent requests
>
>
> > The lock would only be a problem if the sleep() call were being  executed
> > as
> > part of a module import.
> >
> > Can OP post simplified code demonstrating problem?
> >
> > BTW, why do you want to call sleep(), or is this just experimenting?
> >
> > Graham
> >
> > On 10/12/2005, at 4:00 AM, Jim Gallacher wrote:
> >
> >> I wonder if it's related to the page cache mechanism acquring a  global
> >> lock? Niclolas is more familiar with that code in psp.py and  may be able
> >> to comment.
> >>
> >> Jim
> >>
> >> Lars Eriksen wrote:
> >>
> >>>> Are you using sessions?
> >>>>
> >>> No.
> >>>
> >>>> Which mod_python version?
> >>>>
> >>> Apache/2.0.55 (Win32) mod_python/3.2.5b Python/2.4.2
> >>>
> >>>> Apache mpm prefork, worker or threaded?
> >>>>
> >>> Default Apache NT installation, which uses the MPM in threaded mode.
> >>> I only added the following to my main directory configuration:
> >>> AddHandler mod_python .htm
> >>> PythonHandler mod_python.psp
> >>> PythonDebug On
> >>> Thanks in advance!
> >>> ----- Original Message ----- From: "Jim Gallacher"
> >>> <jpg@jgassociates.ca>
> >>> To: "Lars Eriksen" <downgrade@gmx.org>
> >>> Cc: <mod_python@modpython.org>
> >>> Sent: Friday, December 09, 2005 5:03 PM
> >>> Subject: Re: [mod_python] Concurrent requests
> >>>
> >>>> Are you using sessions?
> >>>> Which mod_python version?
> >>>> Apache mpm prefork, worker or threaded?
> >>>>
> >>>> Jim
> >>>>
> >>>>
> >>>> Lars Eriksen wrote:
> >>>>
> >>>>
> >>>>> I have created a simple .psp script that simply calls sleep(...)  and
> >>>>> blocks execution for a certain amount of time (x seconds).
> >>>>>
> >>>>> If I access the .psp script in two instances of my browser at  the
> >>>>> same time, request one waits x seconds, then it finishes,  then
> >>>>> request two is processed and finishes after x * 2 seconds.
> >>>>>
> >>>>> Requests are obviously queued and not several Python  interpreters
> >>>>> spawned to handle them concurrently.
> >>>>>
> >>>>> Is there any setting that allows you to specify the number of  Python
> >>>>> interpreters that should be used?
> >>>>>
> >>>>> Thanks,
> >>>>>
> >>>>> -Lars
> >>>>> _______________________________________________
> >>>>> Mod_python mailing list
> >>>>> Mod_python@modpython.org
> >>>>> http://mailman.modpython.org/mailman/listinfo/mod_python
> >>>>>
> >>>>>
> >>>>
> >>>>
> >>>>
> >>> _______________________________________________
> >>> Mod_python mailing list
> >>> Mod_python@modpython.org
> >>> http://mailman.modpython.org/mailman/listinfo/mod_python
> >>>
> >>
> >> _______________________________________________
> >> Mod_python mailing list
> >> Mod_python@modpython.org
> >> http://mailman.modpython.org/mailman/listinfo/mod_python
> >>
> >
> >
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>

From downgrade at gmx.org  Sat Dec 10 06:09:04 2005
From: downgrade at gmx.org (Lars Eriksen)
Date: Sat Dec 10 06:08:46 2005
Subject: [mod_python] Concurrent requests
References: <001a01c5fcd2$e1f097e0$3701a8c0@targa>
	<4399AAB5.3090404@jgassociates.ca>
	<001001c5fcdf$4bf9dd20$3701a8c0@targa>
	<4399B83F.8080000@jgassociates.ca>
	<E69C045C-634C-4C24-ADE9-2060EA563AA5@dscpl.com.au>
	<001401c5fd0d$1037ed30$3701a8c0@targa>
	<c298f2d70512100059n2b3eb417q@mail.gmail.com>
Message-ID: <001801c5fd7a$228e0f60$3701a8c0@targa>

Nicolas,

Thank you very much! Highly appreciated. I ran the AB tool and the results 
were identical to yours. So my configuration definitely handles requests 
concurrently.

Confused, however, I opened two Firefox instances again and let them access 
the script concurrently, with the exact same results I got previously - the 
second request is processed *after* the first one finishes.

I replaced Firefox with IE then, and the results were the same as with the 
AB tool - the requests were handled concurrently.

So I have come to believe that Firefox (1.0.7) itself delays the second 
request to the server, for whatever reason.

Thanks again,

-Lars






----- Original Message ----- 
From: "Nicolas Lehuen" <nicolas.lehuen@gmail.com>
To: "Lars Eriksen" <downgrade@gmx.org>
Cc: <mod_python@modpython.org>
Sent: Saturday, December 10, 2005 9:59 AM
Subject: Re: [mod_python] Concurrent requests


Hi Lars,

I cannot reproduce your problem. Here is what I've done :

E:\Documents and Settings\Nico>ab -c 10 -n 10 http://shuttle/test.psp
This is ApacheBench, Version 2.0.41-dev <$Revision: 1.121.2.12 $> apache-2.0
Copyright (c) 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
Copyright (c) 1998-2002 The Apache Software Foundation, 
http://www.apache.org/

Benchmarking shuttle (be patient).....done


Server Software:        Apache
Server Hostname:        shuttle
Server Port:            80

Document Path:          /test.psp
Document Length:        5 bytes

Concurrency Level:      10
Time taken for tests:   10.34429 seconds
Complete requests:      10
Failed requests:        0
Write errors:           0
Total transferred:      1410 bytes
HTML transferred:       50 bytes
Requests per second:    1.00 [#/sec] (mean)
Time per request:       10034.429 [ms] (mean)
Time per request:       1003.443 [ms] (mean, across all concurrent requests)
Transfer rate:          0.10 [Kbytes/sec] received

Connection Times (ms)
              min  mean[+/-sd] median   max
Connect:        0    1   3.2      0      10
Processing: 10014 10019   7.1  10014   10034
Waiting:    10004 10018   8.4  10014   10034
Total:      10014 10020   7.0  10024   10034

Percentage of the requests served within a certain time (ms)
  50%  10024
  66%  10024
  75%  10024
  80%  10024
  90%  10034
  95%  10034
  98%  10034
  99%  10034
 100%  10034 (longest request)

Clearly the 10 requests are handled concurrently. I've also done tests
with raw handlers and mod_python.publisher, and everything looks fine.
I have exactly the same configuration, running under Windows XP.

Please try doing the same tests using ab and tell us what you get.

Regards;
Nicolas

2005/12/9, Lars Eriksen <downgrade@gmx.org>:
> I posted my httpd.conf setup earlier. I am just experimenting, yes. Here 
> is
> the content of the .psp file I use:
>
> <%
> import time
> time.sleep(10)
> req.write('Done.')
> %>
>
> As I've mentioned, I access the script concurrently using two browser
> instances.
>
>
> ----- Original Message -----
> From: "Graham Dumpleton" <grahamd@dscpl.com.au>
> To: "Jim Gallacher" <jpg@jgassociates.ca>
> Cc: "Lars Eriksen" <downgrade@gmx.org>; <mod_python@modpython.org>
> Sent: Friday, December 09, 2005 9:26 PM
> Subject: Re: [mod_python] Concurrent requests
>
>
> > The lock would only be a problem if the sleep() call were being 
> > executed
> > as
> > part of a module import.
> >
> > Can OP post simplified code demonstrating problem?
> >
> > BTW, why do you want to call sleep(), or is this just experimenting?
> >
> > Graham
> >
> > On 10/12/2005, at 4:00 AM, Jim Gallacher wrote:
> >
> >> I wonder if it's related to the page cache mechanism acquring a  global
> >> lock? Niclolas is more familiar with that code in psp.py and  may be 
> >> able
> >> to comment.
> >>
> >> Jim
> >>
> >> Lars Eriksen wrote:
> >>
> >>>> Are you using sessions?
> >>>>
> >>> No.
> >>>
> >>>> Which mod_python version?
> >>>>
> >>> Apache/2.0.55 (Win32) mod_python/3.2.5b Python/2.4.2
> >>>
> >>>> Apache mpm prefork, worker or threaded?
> >>>>
> >>> Default Apache NT installation, which uses the MPM in threaded mode.
> >>> I only added the following to my main directory configuration:
> >>> AddHandler mod_python .htm
> >>> PythonHandler mod_python.psp
> >>> PythonDebug On
> >>> Thanks in advance!
> >>> ----- Original Message ----- From: "Jim Gallacher"
> >>> <jpg@jgassociates.ca>
> >>> To: "Lars Eriksen" <downgrade@gmx.org>
> >>> Cc: <mod_python@modpython.org>
> >>> Sent: Friday, December 09, 2005 5:03 PM
> >>> Subject: Re: [mod_python] Concurrent requests
> >>>
> >>>> Are you using sessions?
> >>>> Which mod_python version?
> >>>> Apache mpm prefork, worker or threaded?
> >>>>
> >>>> Jim
> >>>>
> >>>>
> >>>> Lars Eriksen wrote:
> >>>>
> >>>>
> >>>>> I have created a simple .psp script that simply calls sleep(...) 
> >>>>> and
> >>>>> blocks execution for a certain amount of time (x seconds).
> >>>>>
> >>>>> If I access the .psp script in two instances of my browser at  the
> >>>>> same time, request one waits x seconds, then it finishes,  then
> >>>>> request two is processed and finishes after x * 2 seconds.
> >>>>>
> >>>>> Requests are obviously queued and not several Python  interpreters
> >>>>> spawned to handle them concurrently.
> >>>>>
> >>>>> Is there any setting that allows you to specify the number of 
> >>>>> Python
> >>>>> interpreters that should be used?
> >>>>>
> >>>>> Thanks,
> >>>>>
> >>>>> -Lars
> >>>>> _______________________________________________
> >>>>> Mod_python mailing list
> >>>>> Mod_python@modpython.org
> >>>>> http://mailman.modpython.org/mailman/listinfo/mod_python
> >>>>>
> >>>>>
> >>>>
> >>>>
> >>>>
> >>> _______________________________________________
> >>> Mod_python mailing list
> >>> Mod_python@modpython.org
> >>> http://mailman.modpython.org/mailman/listinfo/mod_python
> >>>
> >>
> >> _______________________________________________
> >> Mod_python mailing list
> >> Mod_python@modpython.org
> >> http://mailman.modpython.org/mailman/listinfo/mod_python
> >>
> >
> >
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>


From trepca at gmail.com  Sat Dec 10 06:51:17 2005
From: trepca at gmail.com (Sebastjan Trepca)
Date: Sat Dec 10 06:51:20 2005
Subject: [mod_python] Problems with headers in proxy handler
In-Reply-To: <629F8D5D-BF37-48DC-822A-B1B60643351A@dscpl.com.au>
References: <cd329af80512070514p5a749d1fl@mail.gmail.com>
	<629F8D5D-BF37-48DC-822A-B1B60643351A@dscpl.com.au>
Message-ID: <cd329af80512100351n301c9057x@mail.gmail.com>

Ok :) Just didn't want to import whole module because of a constant.

Btw, what is the difference between OK and DONE? I understand that
DONE will stop Apache to go processing further, but where further can
it go? I mean what is processed after the request handler ?

Sebastjan

On 10/12/05, Graham Dumpleton <grahamd@dscpl.com.au> wrote:
> Which version of mod_python are you using?
>
> On 08/12/2005, at 12:14 AM, Sebastjan Trepca wrote:
>
> > Hi,
> >
> > I'm writing a proxy handler which makes a request to a different page
> > and retrieves its content and headers. This is the source:
> >
> > import urllib2
> > from mod_python import util
> >
> > def handler(req):
> >     req.headers_out.clear()
> >     f = util.FieldStorage(req)
> >     url = f.get('url',None)
> >     if(url):
> >         url=url.split('?')
> >         if(len(url)>1):
> >             u = url[0]
> >             p = url[1]
> >             ureq = urllib2.Request(u,p)
> >         else:
> >             u = url[0]
> >             ureq = urllib2.Request(u)
> >         for h in req.headers_in:
> >             ureq.add_header(h,req.headers_in[h])
> >         r = urllib2.urlopen(ureq)
> >         for h in r.headers:
> >             req.headers_out[h]=r.headers[h]
> >         data =     r.read()
>
> In case you are using mod_python 2.7.X, add at this point:
>
>             req.send_http_header()
>
> >         req.write(data)
> >         return 0#-2 doesn't help either
> >     return 0
>
> Will not make a difference, but don't return 0/2, use apache.OK/
> apache.DONE
> instead. Using literal integer values is bad programming practice.
>
> > But this seems to have problems with headers, I get back basic headers
> > from my Apache server, which is wrong of course.
> > Any ideas why is this happening?
>
> Graham
>

From grahamd at dscpl.com.au  Sat Dec 10 15:58:19 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sat Dec 10 15:58:33 2005
Subject: [mod_python] Problems with headers in proxy handler
In-Reply-To: <cd329af80512100351n301c9057x@mail.gmail.com>
References: <cd329af80512070514p5a749d1fl@mail.gmail.com>
	<629F8D5D-BF37-48DC-822A-B1B60643351A@dscpl.com.au>
	<cd329af80512100351n301c9057x@mail.gmail.com>
Message-ID: <A8ADE346-BC01-4ECC-AD18-82ED0D1D2071@dscpl.com.au>


On 10/12/2005, at 10:51 PM, Sebastjan Trepca wrote:

> Ok :) Just didn't want to import whole module because of a constant.

The module is already resident in memory because it contains a lot of
stuff which mod_python itself uses. When you import it, it is just a  
quick
lookup of sys.modules by Python internals to get it and it doesn't have
to go back to disk. Even this quick lookup only happens once, it isn't
like CGI where everything is loaded on each request.

> Btw, what is the difference between OK and DONE? I understand that
> DONE will stop Apache to go processing further, but where further can
> it go? I mean what is processed after the request handler ?

If DONE is used in content handler phase, it may well be not much
different than OK (not sure), but it will be if used in earlier  
phases such
as access handler, auth handler, fixup handler etc.

> Sebastjan
>
> On 10/12/05, Graham Dumpleton <grahamd@dscpl.com.au> wrote:
>
>> Which version of mod_python are you using?
>>
>> On 08/12/2005, at 12:14 AM, Sebastjan Trepca wrote:
>>
>>
>>> Hi,
>>>
>>> I'm writing a proxy handler which makes a request to a different  
>>> page
>>> and retrieves its content and headers. This is the source:
>>>
>>> import urllib2
>>> from mod_python import util
>>>
>>> def handler(req):
>>>     req.headers_out.clear()
>>>     f = util.FieldStorage(req)
>>>     url = f.get('url',None)
>>>     if(url):
>>>         url=url.split('?')
>>>         if(len(url)>1):
>>>             u = url[0]
>>>             p = url[1]
>>>             ureq = urllib2.Request(u,p)
>>>         else:
>>>             u = url[0]
>>>             ureq = urllib2.Request(u)
>>>         for h in req.headers_in:
>>>             ureq.add_header(h,req.headers_in[h])
>>>         r = urllib2.urlopen(ureq)
>>>         for h in r.headers:
>>>             req.headers_out[h]=r.headers[h]
>>>         data =     r.read()
>>>
>>
>> In case you are using mod_python 2.7.X, add at this point:
>>
>>             req.send_http_header()
>>
>>
>>>         req.write(data)
>>>         return 0#-2 doesn't help either
>>>     return 0
>>>
>>
>> Will not make a difference, but don't return 0/2, use apache.OK/
>> apache.DONE
>> instead. Using literal integer values is bad programming practice.
>>
>>
>>> But this seems to have problems with headers, I get back basic  
>>> headers
>>> from my Apache server, which is wrong of course.
>>> Any ideas why is this happening?
>>>
>>
>> Graham
>>
>

From grahamd at dscpl.com.au  Sun Dec 11 06:02:06 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sun Dec 11 06:02:31 2005
Subject: [mod_python] returning errors from python handler and
	ErrorDocument
In-Reply-To: <d80792120511302217j3dac2040nedfbd44ad64cef25@mail.gmail.com>
References: <d80792120511271427v5506a3f5x8fe29373ac213dca@mail.gmail.com>
	<0F56EF57-484A-45E5-AC25-3B8339401661@dscpl.com.au>
	<d80792120511302217j3dac2040nedfbd44ad64cef25@mail.gmail.com>
Message-ID: <bb8f77f1442c5b8c0f240cc6d839a4ac@dscpl.com.au>

On 01/12/2005, at 5:17 PM, Martin _ wrote:

> I like the idea, unfortunately it seems to suffer from the same
> problem - the file is created, status is 200 as it leaves the python,
> but ends up as a 404, and a browser refresh is needed to fetch the
> content. Even bumping up the pre-check to HeaderParserHandler had the
> same problem, which makes me wonder if apache has already decided if
> the file exists or not when it resolves the filename, and doesn't look
> again... but then I don't quite understand why it doesn't set the 404
> then. Or maybe the file isn't created 'enough', or there's some kinda
> race condition... I don't know. As the file is created literally with:
> if not os.path.isfile(req.filename):
>     fi = file(req.filename, mode='wb')
>     ## etc ##
> it really should be finding the file if it looks...

Use req.internal_redirect() to force Apache to reevaluate the URL from
the beginning.

   from mod_python import apache
   import os

   def fixuphandler(req):
     apache.log_error('req.filename=%s'%req.filename)
     if not os.path.exists(req.filename):
       file = open(req.filename,"w")
       file.write(req.unparsed_uri)
       file.close()
       req.internal_redirect(req.unparsed_uri)
       return apache.DONE
     return apache.OK

Not sure if there is a better way or not. There are also some 
implications
of using req.internal_redirect() if the original request was POST. That 
is
that on subsequent interpretation it will be seen as a GET request 
instead.
This will be a problem if the form parameters for the POST were in the
content of the request and not in the URL as with GET.

I'll think some more about other ways of doing it.

Graham

> On 11/28/05, Graham Dumpleton <grahamd@dscpl.com.au> wrote:
>> My guess is that once the content handler phase has been executed,
>> or logically passed, that you have no chance of changing what the 
>> return
>> status is. Thus, since for an ErrorDocument directive it is only 
>> applied
>> after the content handler phase of the first attempt has been passed,
>> whether that is for a mod_python content handler or an inbuilt static
>> Apache handler for serving static files, you will not be able to do 
>> it.
>>
>> What you instead need to do is to try and detect the condition of a
>> missing
>> file before the content handler phase is executed. To do that, setup a
>> PythonFixupHandler. Eg:
>>
>>    <Directory "D:/website/search">
>>    PythonFixupHandler check_for_missing_target
>>    </Directory>
>>
>> This should be done for the search directory. You DO NOT not need to
>> specify any corresponding SetHandler/AddHandler directive as they
>> are only relevant to PythonHandler directive and not the other phase
>> directives.
>>
>> What will happen now is that for any request received, it will be 
>> routed
>> through the function "fixuphandler" within the specified module. In 
>> that
>> module, you could check for the existance of the target. If it doesn't
>> exist, then create it:
>>
>>    # check_for_missing_target.py (module)
>>
>>    def fixuphandler(req):
>>      if target is missing:
>>        create target of request
>>      return apache.OK
>>
>> With the target now existing, the content handler phase when applied
>> will
>> possibly be able to find it. I say possibly, as I don't know what you
>> are
>> serving up and other issues such as Apache's URL matching algorithms
>> may come into play. You may need to actually adjust req.filename to
>> undo some of what Apache has done.
>>
>> Anyway, hope that gives you some ideas to play with.
>>
>> Graham
>>
>> On 28/11/2005, at 9:27 AM, Martin _ wrote:
>>
>>> In a related query to this one, is it possible to undo a raised
>>> http error? I've not had much luck in sending 404s to a script that
>>> then creates the resource asked for and bounces apache back to try
>>> again from the start, the 404 sticks despite my best attempts to
>>> overwrite it with a 200:
>>>
>>> # httpd.conf
>>> <Directory "D:/website/search">
>>>         ErrorDocument 404 /py/404.xml
>>> </Directory>
>>>
>>> <Directory "D:/website/py">
>>>         AddHandler mod_python .xml
>>>         PythonHandler index
>>> </Directory>
>>>
>>> # D:/website/py/index.py
>>> def handler(req):
>>>         if not req.prev:
>>>                 return apache.HTTP_FORBIDDEN
>>>
>>>         ## create relevant resource here ##
>>>
>>>         # doesn't help # req.prev.state = apache.HTTP_OK
>>>         # doesn't help # req.state = apache.HTTP_OK
>>>         req.internal_redirect(req.prev.unparsed_uri)
>>>         # doesn't help # req.next.state = apache.HTTP_OK
>>>         # doesn't help # raise apache.SERVER_RETURN, apache.HTTP_OK
>>>         return apache.OK
>>>
>>> I'm open to complete rethinks here, this doesn't strike me as
>>> optimal, as the few requests that don't want existing resources
>>> will go through three independant handlers, but for requirements:
>>> -I want to serve static content, even if it's generated because of
>>> that request, as static content, not mod_python created chunked 
>>> output
>>> -I want to keep all python stuff in that /py/ dir, rather than
>>> scattering scripts all over the tree
>>>
>>> Any wise thoughts gratefully received,
>>>
>>> Martin
>>> _______________________________________________
>>> Mod_python mailing list
>>> Mod_python@modpython.org
>>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>>
>>
>>

From grahamd at dscpl.com.au  Sun Dec 11 06:25:37 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sun Dec 11 06:25:48 2005
Subject: [mod_python] returning errors from python handler and
	ErrorDocument
In-Reply-To: <bb8f77f1442c5b8c0f240cc6d839a4ac@dscpl.com.au>
References: <d80792120511271427v5506a3f5x8fe29373ac213dca@mail.gmail.com>
	<0F56EF57-484A-45E5-AC25-3B8339401661@dscpl.com.au>
	<d80792120511302217j3dac2040nedfbd44ad64cef25@mail.gmail.com>
	<bb8f77f1442c5b8c0f240cc6d839a4ac@dscpl.com.au>
Message-ID: <0be1a0e39979629d7209754d3ec9d0f0@dscpl.com.au>


On 11/12/2005, at 10:02 PM, Graham Dumpleton wrote:
> There are also some implications
> of using req.internal_redirect() if the original request was POST. 
> That is
> that on subsequent interpretation it will be seen as a GET request 
> instead.
> This will be a problem if the form parameters for the POST were in the
> content of the request and not in the URL as with GET.

Whoops, partly spouting nonsense here. Am getting myself confused with
mod_python.publisher behaviour, whereby an internal redirect for a POST
with mod_python.publisher will not necessarily work as the first 
application
of mod_python.publisher will consume request content so that it isn't
available to the latter to which the request may be redirected.

There is a case where POST gets converted to GET on an internal 
redirect,
but I think that is where the target mapped to an actual directory. Thus
it is a quite specific case which will probably not be an issue.

Getting late, time to go get some sleep.....

Graham

From jim.steil at customcall.com  Sun Dec 11 11:29:32 2005
From: jim.steil at customcall.com (Jim Steil)
Date: Sun Dec 11 11:29:36 2005
Subject: [mod_python] Newbie - Database connection pooling
Message-ID: <439C53EC.2070800@customcall.com>

Can someone point me to some examples or documentation on how to do 
database connection pooling using mod_python?


    -Jim

-- 
*Jim Steil*
VP of Application Development
CustomCall Data Systems
(608) 274-3009 x286
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20051211/c47cdd54/attachment.html
From grahamd at dscpl.com.au  Sun Dec 11 14:33:36 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sun Dec 11 14:33:56 2005
Subject: [mod_python] Newbie - Database connection pooling
In-Reply-To: <439C53EC.2070800@customcall.com>
References: <439C53EC.2070800@customcall.com>
Message-ID: <669a96ecf01b7562dccc9000e47f6a72@dscpl.com.au>


On 12/12/2005, at 3:29 AM, Jim Steil wrote:

> Can someone point me to some examples or documentation on how to do  
> database connection pooling using mod_python?

Don't know how up to date the entry is, but try the FAQ:

   http://www.modpython.org/FAQ/faqw.py?req=show&file=faq03.003.htp

You might also dig through past mailing list messages on the topic as  
you
might be able to get something from them.

    
http://www.google.com/search? 
q=database+connection+pooling&q=site%3Awww.modpython.org

Graham

From jim.steil at customcall.com  Sun Dec 11 14:40:30 2005
From: jim.steil at customcall.com (Jim Steil)
Date: Sun Dec 11 14:40:32 2005
Subject: [mod_python] Newbie - Database connection pooling
In-Reply-To: <669a96ecf01b7562dccc9000e47f6a72@dscpl.com.au>
References: <439C53EC.2070800@customcall.com>
	<669a96ecf01b7562dccc9000e47f6a72@dscpl.com.au>
Message-ID: <439C80AE.6050805@customcall.com>

Graham:  Thanks for the pointer.  I'll read though it this afternoon.  
Also, I am using a SQL Server database and have been looking at ADO 
connections through win32com and via ODBC using mxODBC.  In reading 
about these, it seems like they may be doing connection pooling 
already.  And, I have run some tests with up to six browsers running, 
and it appears as though the database connections never exceed 2.


Again, any input is greatly appreciated.


    -Jim


Graham Dumpleton wrote:
>
> On 12/12/2005, at 3:29 AM, Jim Steil wrote:
>
>> Can someone point me to some examples or documentation on how to do 
>> database connection pooling using mod_python?
>
> Don't know how up to date the entry is, but try the FAQ:
>
>   http://www.modpython.org/FAQ/faqw.py?req=show&file=faq03.003.htp
>
> You might also dig through past mailing list messages on the topic as you
> might be able to get something from them.
>
>   
> http://www.google.com/search?q=database+connection+pooling&q=site%3Awww.modpython.org 
>
>
> Graham
>
>
>

-- 
*Jim Steil*
VP of Application Development
CustomCall Data Systems
(608) 274-3009 x286
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20051211/8164ca9b/attachment.html
From enotus at tut.by  Mon Dec 12 12:54:59 2005
From: enotus at tut.by (Enot)
Date: Mon Dec 12 12:54:54 2005
Subject: [mod_python] How set max uploading file size in FieldStorage
Message-ID: <1995838526.20051212195459@tut.by>

Hello,

How set max uploading file size in FieldStorage?

What happen if many users start uploading of huge files?
What happen to Apache?
Is any security issues?

-- 
Best regards,
 Enot                          mailto:enotus@tut.by

From pjs at packet-addiction.org  Mon Dec 12 13:58:21 2005
From: pjs at packet-addiction.org (Peter Sanchez)
Date: Mon Dec 12 13:57:46 2005
Subject: [mod_python] Session Timeouts
Message-ID: <5AC31A0D-A31F-4928-B728-47363AF0DAA8@packet-addiction.org>

I have a question regarding session timeouts. I would like to set the  
timeout, to say, 1 hour. Instead of whatever the default is now. I  
know of set_timeout() function, but my question is this. Can I use  
the set_timeout() multiple times? For example, a user comes to my  
site, logs in, I set the timeout to 1 hour. Every page in the members  
section checks the session, and every time a page is accessed, I want  
to reset the time to 1 hour from the time that page was accessed. So  
will using set_timeout() every time do that?

I hope that makes sense, but it probably doesn't ;) So here is a  
"flow chart"

10:45 - User logs in, set_timeout() to 1 hour from now (11:45)
10:47 - User accesses email page, set_timeout to 1 hour from now (11:47)

etc.. on and on it goes.

Thanks!

Peter
From petersanchez at gmail.com  Mon Dec 12 14:25:00 2005
From: petersanchez at gmail.com (Peter Sanchez)
Date: Mon Dec 12 14:24:26 2005
Subject: [mod_python] Session Timeouts
Message-ID: <EC8A0950-DA4E-4A4B-B281-D0F1B8C6413F@gmail.com>

I have a question regarding session timeouts. I would like to set the  
timeout, to say, 1 hour. Instead of whatever the default is now. I  
know of set_timeout() function, but my question is this. Can I use  
the set_timeout() multiple times? For example, a user comes to my  
site, logs in, I set the timeout to 1 hour. Every page in the members  
section checks the session, and every time a page is accessed, I want  
to reset the time to 1 hour from the time that page was accessed. So  
will using set_timeout() every time do that?

I hope that makes sense, but it probably doesn't ;) So here is a  
"flow chart"

10:45 - User logs in, set_timeout() to 1 hour from now (11:45)
10:47 - User accesses email page, set_timeout to 1 hour from now (11:47)

etc.. on and on it goes.

Thanks!

Peter
From dpopowich at comcast.net  Mon Dec 12 15:06:49 2005
From: dpopowich at comcast.net (Daniel J. Popowich)
Date: Mon Dec 12 15:06:45 2005
Subject: [mod_python] Session Timeouts
In-Reply-To: <EC8A0950-DA4E-4A4B-B281-D0F1B8C6413F@gmail.com>
References: <EC8A0950-DA4E-4A4B-B281-D0F1B8C6413F@gmail.com>
Message-ID: <17309.55385.993257.970101@io.astro.umass.edu>


Peter Sanchez writes:
> I have a question regarding session timeouts. I would like to set the  
> timeout, to say, 1 hour. Instead of whatever the default is now. I  
> know of set_timeout() function, but my question is this. Can I use  
> the set_timeout() multiple times? For example, a user comes to my  
> site, logs in, I set the timeout to 1 hour. Every page in the members  
> section checks the session, and every time a page is accessed, I want  
> to reset the time to 1 hour from the time that page was accessed. So  
> will using set_timeout() every time do that?
> 
> I hope that makes sense, but it probably doesn't ;) So here is a  
> "flow chart"
> 
> 10:45 - User logs in, set_timeout() to 1 hour from now (11:45)
> 10:47 - User accesses email page, set_timeout to 1 hour from now (11:47)
> 
> etc.. on and on it goes.
> 

You don't have to do anything special to get what you want...it works
that way out-of-the-box.  If you create your session specifying a
timeout of one hour:

   ses = Session(req, timeout=3600)
   ...
   ses.save()

then the session will stay alive as long as it's *accessed* within an
hour and when it is, the access time will be reset so you have another
hour, and so on...

The session code does something like this:

  if time.time() - ses.last_accessed() > ses.timeout():
     SESSION-HAS-TIMED-OUT

The last accessed time of a session is updated to the current time
with every request (when the session is instantiated), but not stored
until you call save() (if you never call save() then you will never
re-use a session).

Cheers,

Daniel Popowich
---------------
http://home.comcast.net/~d.popowich/mpservlets/

From list at joreybump.com  Mon Dec 12 15:22:46 2005
From: list at joreybump.com (Jorey Bump)
Date: Mon Dec 12 15:22:54 2005
Subject: [mod_python] How set max uploading file size in FieldStorage
In-Reply-To: <1995838526.20051212195459@tut.by>
References: <1995838526.20051212195459@tut.by>
Message-ID: <439DDC16.40107@joreybump.com>

Enot wrote:

> How set max uploading file size in FieldStorage?
> 
> What happen if many users start uploading of huge files?
> What happen to Apache?
> Is any security issues?

I prefer to do this at the Apache level with LimitRequestBody:

  http://httpd.apache.org/docs/2.0/mod/core.html#limitrequestbody
From dsr at best-off.org  Tue Dec 13 03:56:52 2005
From: dsr at best-off.org (Daniel S. Reichenbach)
Date: Tue Dec 13 03:56:59 2005
Subject: [mod_python] Segfaults when running mod_python and
	mod_php4/mod_php5
In-Reply-To: <43945103.8000503@ulb.ac.be>
References: <1133784886.18574.24.camel@theater-mob.best-off.lan>
	<43944943.2040004@ulb.ac.be>
	<1133792227.20797.3.camel@theater-mob.best-off.lan>
	<43945103.8000503@ulb.ac.be>
Message-ID: <20051213095652.15othkhecybk4848@toaster.best-off.org>

Hi again,

I have been trying to find the reason why and where mod_python segfaults
on my
system for a while now.

Following the hints in the FAQ I have checked if mod_python, python and
PHP had
been built against different versions of libraries and as this is the
case in
Debian testing, I have switched to Debian unstable, where PHP and
mod_python
are both seem to be linked against the same library versions.

Still, the issue did not change. Whenever I call any Authentication like
basic
auth using .htaccess files on a mod_python enabled server, it will
result in
a segfault with a message like

child pid ... exit signal Segmentation fault (11)

in the error logs.

I have tried building the whole dependency tree manual from sources to
make
extra sure that there are no mixed dependencies,  and tried mod_python
3.1.4
as well as 3.2.5b. As well I tried to use PHP5 instead of PHP4 but still
the
segfaults stay the same. Following a hint from Julien Cigar I as well
tried
disabling mod_ssl, but this did not have any impact. Still segfaults.

Setting LogLevel to debug did not reveal any additional information
where the
crash occurs, so I am pretty stuck here. I tried using the PythonDebug
directive as well as any other debug output related configuration
directive I
could find

Can anyone give me a hint, what I can try next to figure where and why
the
crash occurs? Should I cary over this to the development list?

With kind regards,
Daniel
-- 
blog - http://people.best-off.org/~dsr/
gpg  - http://people.best-off.org/~dsr/gpg.asc
work - http://www.best-off.org/

-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: PGP Digital Signature
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20051213/4a2873d9/attachment.bin
From grahamd at dscpl.com.au  Tue Dec 13 04:54:40 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Dec 13 04:54:54 2005
Subject: [mod_python] Segfaults when running mod_python and
	mod_php4/mod_php5
In-Reply-To: <20051213095652.15othkhecybk4848@toaster.best-off.org>
References: <1133784886.18574.24.camel@theater-mob.best-off.lan>
	<43944943.2040004@ulb.ac.be>
	<1133792227.20797.3.camel@theater-mob.best-off.lan>
	<43945103.8000503@ulb.ac.be>
	<20051213095652.15othkhecybk4848@toaster.best-off.org>
Message-ID: <40d39d4964b2adb28f6ab45f43946909@dscpl.com.au>



On 13/12/2005, at 7:56 PM, Daniel S. Reichenbach wrote:

> Hi again,
>
> I have been trying to find the reason why and where mod_python 
> segfaults
> on my
> system for a while now.
>
> Following the hints in the FAQ I have checked if mod_python, python and
> PHP had
> been built against different versions of libraries and as this is the
> case in
> Debian testing, I have switched to Debian unstable, where PHP and
> mod_python
> are both seem to be linked against the same library versions.
>
> Still, the issue did not change. Whenever I call any Authentication 
> like
> basic
> auth using .htaccess files on a mod_python enabled server, it will
> result in
> a segfault with a message like
>
> child pid ... exit signal Segmentation fault (11)
>
> in the error logs.
>
> I have tried building the whole dependency tree manual from sources to
> make
> extra sure that there are no mixed dependencies,  and tried mod_python
> 3.1.4
> as well as 3.2.5b. As well I tried to use PHP5 instead of PHP4 but 
> still
> the
> segfaults stay the same. Following a hint from Julien Cigar I as well
> tried
> disabling mod_ssl, but this did not have any impact. Still segfaults.
>
> Setting LogLevel to debug did not reveal any additional information
> where the
> crash occurs, so I am pretty stuck here. I tried using the PythonDebug
> directive as well as any other debug output related configuration
> directive I
> could find
>
> Can anyone give me a hint, what I can try next to figure where and why
> the
> crash occurs? Should I cary over this to the development list?

Shutdown Apache:

   apachectl stop

Run Apache in single process mode:

   /usr/local/apache-2.0/bin/httpd -DONE_PROCESS

In another window run "ps" to find the process IDs of the Apache
process. There may be two.

   ps x | grep httpd

   377  p1  S+     0:00.87 ./httpd -DONE_PROCESS
   382  p1  S+     0:00.02 ./httpd -DONE_PROCESS

Use "gdb" to attach to the lowest parent process ID:

   gdb /usr/local/apache-2.0/bin/httpd -p 377

Expect it to stop Apache at sigwait():

   0x949d7fac in sigwait ()
   (gdb)

Enter command "cont":

   (gdb) cont
   Continuing.

Now use a web browser to access the URL which gives you the problem.

If everything goes as expected, Apache will crash and gdb will throw you
back to its prompt. Enter "where" command to get stack trace of where it
crashed.

Post stack trace here.

Graham

From dsr at best-off.org  Tue Dec 13 05:44:19 2005
From: dsr at best-off.org (Daniel S. Reichenbach)
Date: Tue Dec 13 05:44:24 2005
Subject: [mod_python] Segfaults when running mod_python and
	mod_php4/mod_php5
In-Reply-To: <40d39d4964b2adb28f6ab45f43946909@dscpl.com.au>
References: <1133784886.18574.24.camel@theater-mob.best-off.lan>
	<43944943.2040004@ulb.ac.be>
	<1133792227.20797.3.camel@theater-mob.best-off.lan>
	<43945103.8000503@ulb.ac.be>
	<20051213095652.15othkhecybk4848@toaster.best-off.org>
	<40d39d4964b2adb28f6ab45f43946909@dscpl.com.au>
Message-ID: <20051213114419.dd4i80xhbesksccc@toaster.best-off.org>

Hi again,

> Now use a web browser to access the URL which gives you the problem.
>
> If everything goes as expected, Apache will crash and gdb will throw you
> back to its prompt. Enter "where" command to get stack trace of where it
> crashed.
I have followed your instructions step by step and tried opening the
URL. The result was expected, auth window opened, valid username and
password enter and then again Zero Reply from the server and again it
show segfault in error log. But *sigh* in gdb nothing happened. It
still stood there telling me it was Continuing.

What next?

With kind regards,
Daniel
-- 
blog - http://people.best-off.org/~dsr/
gpg  - http://people.best-off.org/~dsr/gpg.asc
work - http://www.best-off.org/

-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: PGP Digital Signature
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20051213/2e484765/attachment.bin
From grahamd at dscpl.com.au  Tue Dec 13 05:52:53 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Dec 13 05:53:05 2005
Subject: [mod_python] Segfaults when running mod_python and
	mod_php4/mod_php5
In-Reply-To: <20051213114419.dd4i80xhbesksccc@toaster.best-off.org>
References: <1133784886.18574.24.camel@theater-mob.best-off.lan>
	<43944943.2040004@ulb.ac.be>
	<1133792227.20797.3.camel@theater-mob.best-off.lan>
	<43945103.8000503@ulb.ac.be>
	<20051213095652.15othkhecybk4848@toaster.best-off.org>
	<40d39d4964b2adb28f6ab45f43946909@dscpl.com.au>
	<20051213114419.dd4i80xhbesksccc@toaster.best-off.org>
Message-ID: <6b3a6efb250a4952768fac812b2f0624@dscpl.com.au>


On 13/12/2005, at 9:44 PM, Daniel S. Reichenbach wrote:

> Hi again,
>
>> Now use a web browser to access the URL which gives you the problem.
>>
>> If everything goes as expected, Apache will crash and gdb will throw 
>> you
>> back to its prompt. Enter "where" command to get stack trace of where 
>> it
>> crashed.
> I have followed your instructions step by step and tried opening the
> URL. The result was expected, auth window opened, valid username and
> password enter and then again Zero Reply from the server and again it
> show segfault in error log. But *sigh* in gdb nothing happened. It
> still stood there telling me it was Continuing.
>
> What next?

When you used "ps" to find instances of "httpd" which were running, how
many were there? If there was a pair like in my example, use the pid
of the other. Ie., instead of the lowest pid of the pair, used the 
highest.
If there are more than two, or that still doesn't help, you may have to
change your Apache config so that it only starts up at most one child
subprocess. That way when you are attached to it with gdb, you will be
guaranteed the request will be handled by the child process you are
debugging.

Instead of -DONE_PROCESS, you might also instead try the -X option.

Anyway, you just need to play with it until you work out a reliable
way of ensuring the request is handled by the process attached to gdb.
The only other alternative is to see if you can find a "core" file
which has been dumped by Apache when it crashes and run gdb against it:

   gdb /usr/local/apache-2.0/bin/httpd core

Then use "where" command to get stack trace.

Time for me to sleep, so I'll see how you go in the morning. If you
get a stack trace, others here may be able to help you interpret it.

Graham

From grahamd at dscpl.com.au  Tue Dec 13 06:00:51 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Dec 13 06:01:03 2005
Subject: [mod_python] Segfaults when running mod_python and
	mod_php4/mod_php5
In-Reply-To: <6b3a6efb250a4952768fac812b2f0624@dscpl.com.au>
References: <1133784886.18574.24.camel@theater-mob.best-off.lan>
	<43944943.2040004@ulb.ac.be>
	<1133792227.20797.3.camel@theater-mob.best-off.lan>
	<43945103.8000503@ulb.ac.be>
	<20051213095652.15othkhecybk4848@toaster.best-off.org>
	<40d39d4964b2adb28f6ab45f43946909@dscpl.com.au>
	<20051213114419.dd4i80xhbesksccc@toaster.best-off.org>
	<6b3a6efb250a4952768fac812b2f0624@dscpl.com.au>
Message-ID: <c0d86e6eea8626f4312832363393e614@dscpl.com.au>


On 13/12/2005, at 9:52 PM, Graham Dumpleton wrote:
> Anyway, you just need to play with it until you work out a reliable
> way of ensuring the request is handled by the process attached to gdb.
> The only other alternative is to see if you can find a "core" file
> which has been dumped by Apache when it crashes and run gdb against it:
>
>   gdb /usr/local/apache-2.0/bin/httpd core

One last thing. If it isn't dropping core files try using 'ulimit' 
command
to ensure they can be created. For example on my box I go:

   ~/Workspaces/ose-8.0 [506]$ ulimit -c
   0
   ~/Workspaces/ose-8.0 [507]$ ulimit -c unlimited
   ~/Workspaces/ose-8.0 [508]$ ulimit -c
   unlimited

Then run "httpd -DONE_PROCESS", don't bother attaching gdb and when it 
crashes
hopefully a "core" file will be left behind that you can use with gdb
explicitly.

Graham

From jpg at jgassociates.ca  Tue Dec 13 08:25:13 2005
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Tue Dec 13 08:25:14 2005
Subject: [mod_python] Segfaults when running mod_python
	and	mod_php4/mod_php5
In-Reply-To: <20051213095652.15othkhecybk4848@toaster.best-off.org>
References: <1133784886.18574.24.camel@theater-mob.best-off.lan>	<43944943.2040004@ulb.ac.be>	<1133792227.20797.3.camel@theater-mob.best-off.lan>	<43945103.8000503@ulb.ac.be>
	<20051213095652.15othkhecybk4848@toaster.best-off.org>
Message-ID: <439ECBB9.7020507@jgassociates.ca>

Daniel S. Reichenbach wrote:
> Hi again,
> 
> I have been trying to find the reason why and where mod_python segfaults
> on my
> system for a while now.
> 
> Following the hints in the FAQ I have checked if mod_python, python and
> PHP had
> been built against different versions of libraries and as this is the
> case in
> Debian testing, I have switched to Debian unstable, where PHP and
> mod_python
> are both seem to be linked against the same library versions.


Is it possible that you have mod_auth_mysql enabled?

I recently did an update on my Debian unstable machine and started 
getting segfaults with mod_python 3.2.5b. As it happens mod_auth_mysql 
links against libmysqlclient_r.so.12 whereas python2.3 uses 
libmysqlclient_r.so.14. When I disabled mod_auth_mysql the problem went 
away.

Just a though.

Jim




From dsr at best-off.org  Tue Dec 13 08:41:36 2005
From: dsr at best-off.org (Daniel S. Reichenbach)
Date: Tue Dec 13 08:41:40 2005
Subject: [mod_python] Segfaults when running mod_python and
	mod_php4/mod_php5
In-Reply-To: <439ECBB9.7020507@jgassociates.ca>
References: <1133784886.18574.24.camel@theater-mob.best-off.lan>
	<43944943.2040004@ulb.ac.be>
	<1133792227.20797.3.camel@theater-mob.best-off.lan>
	<43945103.8000503@ulb.ac.be>
	<20051213095652.15othkhecybk4848@toaster.best-off.org>
	<439ECBB9.7020507@jgassociates.ca>
Message-ID: <20051213144136.or4iuz3pfekgs0sg@toaster.best-off.org>

> Is it possible that you have mod_auth_mysql enabled?
No, not enabled. Mods enabled include:

- mod_cgi
- mod_dav
- mod_dav-svn
- mod_python
- mod_php5
- mod_ssl

And if if remove php5 or php4, mod_python will stay alive. As
long as it's enabled, mod_python will segfault and no longer
serve pages. I've been trying lots of combinations in the last
two weeks.

I'll try the debug hints later, hopefully something will show
up.

With kind regards,
Daniel
-- 
blog - http://people.best-off.org/~dsr/
gpg  - http://people.best-off.org/~dsr/gpg.asc
work - http://www.best-off.org/

-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: PGP Digital Signature
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20051213/510c45fd/attachment.bin
From jcigar at ulb.ac.be  Tue Dec 13 09:29:46 2005
From: jcigar at ulb.ac.be (Julien Cigar)
Date: Tue Dec 13 09:28:08 2005
Subject: [mod_python] Segfaults when running mod_python
	and	mod_php4/mod_php5
In-Reply-To: <20051213144136.or4iuz3pfekgs0sg@toaster.best-off.org>
References: <1133784886.18574.24.camel@theater-mob.best-off.lan>	<43944943.2040004@ulb.ac.be>	<1133792227.20797.3.camel@theater-mob.best-off.lan>	<43945103.8000503@ulb.ac.be>	<20051213095652.15othkhecybk4848@toaster.best-off.org>	<439ECBB9.7020507@jgassociates.ca>
	<20051213144136.or4iuz3pfekgs0sg@toaster.best-off.org>
Message-ID: <439EDADA.1080302@ulb.ac.be>

mod_python on debian is totally broken.
I have a lot of segfaults here too (especially with ssl connections).
I think the package is unmaintenand (no update since Feb 2005) ...

Daniel S. Reichenbach wrote:

>> Is it possible that you have mod_auth_mysql enabled?
>
> No, not enabled. Mods enabled include:
>
> - mod_cgi
> - mod_dav
> - mod_dav-svn
> - mod_python
> - mod_php5
> - mod_ssl
>
> And if if remove php5 or php4, mod_python will stay alive. As
> long as it's enabled, mod_python will segfault and no longer
> serve pages. I've been trying lots of combinations in the last
> two weeks.
>
> I'll try the debug hints later, hopefully something will show
> up.
>
> With kind regards,
> Daniel
>
>------------------------------------------------------------------------
>
>_______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org
>http://mailman.modpython.org/mailman/listinfo/mod_python
>  
>

From dsr at best-off.org  Tue Dec 13 09:42:10 2005
From: dsr at best-off.org (Daniel S. Reichenbach)
Date: Tue Dec 13 09:42:16 2005
Subject: [mod_python] Segfaults when running
	mod_python	and	mod_php4/mod_php5
In-Reply-To: <439EDADA.1080302@ulb.ac.be>
References: <1133784886.18574.24.camel@theater-mob.best-off.lan>	<43944943.2040004@ulb.ac.be>	<1133792227.20797.3.camel@theater-mob.best-off.lan>	<43945103.8000503@ulb.ac.be>	<20051213095652.15othkhecybk4848@toaster.best-off.org>	<439ECBB9.7020507@jgassociates.ca>	<20051213144136.or4iuz3pfekgs0sg@toaster.best-off.org>
	<439EDADA.1080302@ulb.ac.be>
Message-ID: <439EDDC2.2040300@best-off.org>

> mod_python on debian is totally broken.
> I have a lot of segfaults here too (especially with ssl connections).
> I think the package is unmaintenand (no update since Feb 2005) ...
Yes, it is not updated anymore. But I have tried with self-built debs
for 3.2.5b release and this does not change anything. The segfaults
will still occur in the same situations.

Some more hours to work, then I can try another gdb run :-)
-- 
blog - http://people.best-off.org/~dsr/
gpg  - http://people.best-off.org/~dsr/gpg.asc
work - http://www.best-off.org/
From johnbmudd at gmail.com  Tue Dec 13 10:57:14 2005
From: johnbmudd at gmail.com (John Mudd)
Date: Tue Dec 13 10:57:18 2005
Subject: [mod_python] multiple html pages?
Message-ID: <8cbda4900512130757v126f71c9j883fb204a629024d@mail.gmail.com>

I need to use frames in my HTML.  I thought maybe I could use frames
and have all the sources in one HTML file (generated by mod_python)
but HTML doesn't seem to support this.  I need a separate HTML file
for each frame.  Any way around this?  It seems like a waste to write
HTML to separate files just so Apache can then read them back.

Could using PSP pages help?  Maybe invoke my Python code from the main
PSP page, generate the HTML code for each frame, save that HTML code
in python variables, have each frame use other PSP pages as their
source, have the frame PSP pages just expand the python variables set
in my main PSP page.

Any suggestions?

John

From list at joreybump.com  Tue Dec 13 11:40:38 2005
From: list at joreybump.com (Jorey Bump)
Date: Tue Dec 13 11:40:55 2005
Subject: [mod_python] multiple html pages?
In-Reply-To: <8cbda4900512130757v126f71c9j883fb204a629024d@mail.gmail.com>
References: <8cbda4900512130757v126f71c9j883fb204a629024d@mail.gmail.com>
Message-ID: <439EF986.6060808@joreybump.com>

John Mudd wrote:
> I need to use frames in my HTML.  I thought maybe I could use frames
> and have all the sources in one HTML file (generated by mod_python)
> but HTML doesn't seem to support this.  I need a separate HTML file
> for each frame.  Any way around this?  It seems like a waste to write
> HTML to separate files just so Apache can then read them back.

This should be possible. What specific errors are you encountering?
From chase at oldben.llnl.gov  Tue Dec 13 21:41:04 2005
From: chase at oldben.llnl.gov (chase3@llnl.gov)
Date: Tue Dec 13 21:44:22 2005
Subject: [mod_python] connection pool (newbie question)
Message-ID: <Pine.LNX.4.44.0512131837540.2792-100000@oldben.llnl.gov>

I've looked at connection pool code for a persistent database
connection.   I don't know where to create the connection pool.
If in the handler code (I'm using publisher), wouldn't a new
pool be created each time the handler is called?
In doing a test, I think the web server is prefork MPM.

Thanks,
Lila

-- 
Lila Chase
lchase@llnl.gov

From grahamd at dscpl.com.au  Tue Dec 13 22:41:28 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Dec 13 22:41:33 2005
Subject: [mod_python] connection pool (newbie question)
Message-ID: <1134531688.31116@dscpl.user.openhosting.com>

chase3@llnl.gov wrote ..
> I've looked at connection pool code for a persistent database
> connection.   I don't know where to create the connection pool.
> If in the handler code (I'm using publisher), wouldn't a new
> pool be created each time the handler is called?
> In doing a test, I think the web server is prefork MPM.

For a bit of light reading, check out:

  http://www.dscpl.com.au/articles/modpython-004.html

This will give a bit of context in respect of to what degree global data
is shared when different Apache process modules are used.

Also, read through the past mailing list threads on resource initialisation.
Start with the following entry points and go back and forth through the
discussion.

  http://www.modpython.org/pipermail/mod_python/2005-September/019092.html
  http://www.modpython.org/pipermail/mod_python/2005-October/019287.html

I'll have to review the past messages myself to try and work out what
might be most relevant and whether it does actually cover what you
might need to know, but it is a starting point.

Graham
From roberto at familiasanchez.net  Wed Dec 14 08:07:38 2005
From: roberto at familiasanchez.net (Roberto C. Sanchez)
Date: Wed Dec 14 08:08:07 2005
Subject: [mod_python] Configuring mod_python via reverse proxy
Message-ID: <43A0191A.20605@familiasanchez.net>

I am trying to get this working but having no luck.  Essentially, I
start up a second apache2 process as an unpriveleged user with all
dynamic data located under $HOME/apache2 (i.e., configs, logs, and so
on).  When I do this for mod_python it doesn't work at all.  PHP works
fine and the virtualhosts and proxy settings are all properly
configured.  I am not even sure where to start.

I tried the "form" example in section 3.1 of the mod_python
documentation and also a simple Python Server Pages example.  In the
former case, I get a 404 for /form.py/email and in the latter case, I
just get the source of the .psp file.  This tells me that mod_python is
not doing its job.  However, the banner from the server indicates that
mod_python is loaded.

Any help woule be appreciated.

-Roberto

-- 
Roberto C. Sanchez
http://familiasanchez.net/~roberto

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 256 bytes
Desc: OpenPGP digital signature
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20051214/9fb818a1/signature.bin
From list at joreybump.com  Wed Dec 14 08:19:07 2005
From: list at joreybump.com (Jorey Bump)
Date: Wed Dec 14 08:19:26 2005
Subject: [mod_python] Configuring mod_python via reverse proxy
In-Reply-To: <43A0191A.20605@familiasanchez.net>
References: <43A0191A.20605@familiasanchez.net>
Message-ID: <43A01BCB.5040607@joreybump.com>

Roberto C. Sanchez wrote:
> I am trying to get this working but having no luck.  Essentially, I
> start up a second apache2 process as an unpriveleged user with all
> dynamic data located under $HOME/apache2 (i.e., configs, logs, and so
> on).  When I do this for mod_python it doesn't work at all.  PHP works
> fine and the virtualhosts and proxy settings are all properly
> configured.  I am not even sure where to start.
> 
> I tried the "form" example in section 3.1 of the mod_python
> documentation and also a simple Python Server Pages example.  In the
> former case, I get a 404 for /form.py/email and in the latter case, I
> just get the source of the .psp file.  This tells me that mod_python is
> not doing its job.  However, the banner from the server indicates that
> mod_python is loaded.

Show how you are starting apache & how you have configured mod_python.
From nlv11281 at natlab.research.philips.com  Wed Dec 14 08:21:21 2005
From: nlv11281 at natlab.research.philips.com (Mike Looijmans)
Date: Wed Dec 14 08:21:31 2005
Subject: [mod_python] multiple html pages?
Message-ID: <43A01C51.10407@natlab.research.philips.com>

You can also use a simple TABLE on your page, which has roughly the same
effect. This is what 99% of web pages use nowadays. The trouble with
frames is that it is hard to make a link have effect in more than one
frame (e.g. adapt the location in a navigation tree), and for users it
is impossible to bookmark a frame set, since that will invariably take
them to the 'start' page.

With frames, you'd have to put the code into separate PSP files, so
you'd need at least 4 pages if you have 3 frames (one for the top page
and three for the frames themselves).

Your solution with global variables may work on some systems
(threading), but having each frame do its own work is much more
scalable, even if that duplicates a lot. There is also the question of
garbage: When will you discard the generated pages?


Mike Looijmans
Philips Natlab / Topic Automation


John Mudd wrote:
> I need to use frames in my HTML.  I thought maybe I could use frames
> and have all the sources in one HTML file (generated by mod_python)
> but HTML doesn't seem to support this.  I need a separate HTML file
> for each frame.  Any way around this?  It seems like a waste to write
> HTML to separate files just so Apache can then read them back.
> 
> Could using PSP pages help?  Maybe invoke my Python code from the main
> PSP page, generate the HTML code for each frame, save that HTML code
> in python variables, have each frame use other PSP pages as their
> source, have the frame PSP pages just expand the python variables set
> in my main PSP page.

-- 
Mike Looijmans
Philips Natlab / Topic Automation

From nlv11281 at natlab.research.philips.com  Wed Dec 14 08:32:37 2005
From: nlv11281 at natlab.research.philips.com (Mike Looijmans)
Date: Wed Dec 14 08:32:52 2005
Subject: [mod_python] connection pool (newbie question)
In-Reply-To: <Pine.LNX.4.44.0512131837540.2792-100000@oldben.llnl.gov>
References: <Pine.LNX.4.44.0512131837540.2792-100000@oldben.llnl.gov>
Message-ID: <43A01EF5.5050106@natlab.research.philips.com>

> I've looked at connection pool code for a persistent database
> connection.   I don't know where to create the connection pool.
> If in the handler code (I'm using publisher), wouldn't a new
> pool be created each time the handler is called?

You'll get a new pool for each process (not for each thread)

> In doing a test, I think the web server is prefork MPM.

That means you get as many pools as child processes, which means lots! 
(hundreds...)

If your database is MySQL, forget about pooling, it won't help, 
particularly when using prefork. MySQL is so fast in setting up 
connections, that I could not measure any performance difference in 
using a pooling system on a threading Apache.

Step 1 is to determine whether you really need pooling - it's not a 
problem until it's a problem (Oracle for one is notoriously slow in 
setting up connections, but a few seconds per page might not even really 
hurt your application)

Step 2 is to see what you value more: Your DB engine or the simplicity 
and performance of your program. If you value the latter more, I suggest 
considering switching DBMS in favour of one that sets up connections faster.

Step 3: If you then still "need" pooling, get Apache to use threads 
(worker is also very good on most unix systems) so that you won't need 
to cross process boundaries in order to access and manage your pool 
efficiently.

Step 4: Ouch... you have to do some magic now...
One way is to set up a process that just fetches/updates data using a 
private pool, and use some RPC mechanism (may be as simple as a raw 
socket, or a HTTP based thing) to access it.
Another is to have a "pool" of size 1 for each process. Close that 
connection if the client closes the network connection.

From roberto at familiasanchez.net  Wed Dec 14 08:32:48 2005
From: roberto at familiasanchez.net (Roberto C. Sanchez)
Date: Wed Dec 14 08:33:21 2005
Subject: [mod_python] Configuring mod_python via reverse proxy
In-Reply-To: <8cbda4900512140520r17a2de80q8b8aa7d1065268fc@mail.gmail.com>
References: <43A0191A.20605@familiasanchez.net>
	<8cbda4900512140520r17a2de80q8b8aa7d1065268fc@mail.gmail.com>
Message-ID: <43A01F00.6000909@familiasanchez.net>

John Mudd wrote:
> In your Apache config file, $HOME/apache2/conf/httpd.conf, you have to
> tell Apache that a certain file/directory is to be treated at
> Python/PSP.
> 

I already did that :-(

-Roberto

-- 
Roberto C. Sanchez
http://familiasanchez.net/~roberto
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 256 bytes
Desc: OpenPGP digital signature
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20051214/24e08e73/signature.bin
From roberto at familiasanchez.net  Wed Dec 14 08:40:48 2005
From: roberto at familiasanchez.net (Roberto C. Sanchez)
Date: Wed Dec 14 08:41:19 2005
Subject: [mod_python] Configuring mod_python via reverse proxy
In-Reply-To: <43A01BCB.5040607@joreybump.com>
References: <43A0191A.20605@familiasanchez.net>
	<43A01BCB.5040607@joreybump.com>
Message-ID: <43A020E0.1070601@familiasanchez.net>

Jorey Bump wrote:
> Roberto C. Sanchez wrote:
> 
>> I am trying to get this working but having no luck.  Essentially, I
>> start up a second apache2 process as an unpriveleged user with all
>> dynamic data located under $HOME/apache2 (i.e., configs, logs, and so
>> on).  When I do this for mod_python it doesn't work at all.  PHP works
>> fine and the virtualhosts and proxy settings are all properly
>> configured.  I am not even sure where to start.
>>
>> I tried the "form" example in section 3.1 of the mod_python
>> documentation and also a simple Python Server Pages example.  In the
>> former case, I get a 404 for /form.py/email and in the latter case, I
>> just get the source of the .psp file.  This tells me that mod_python is
>> not doing its job.  However, the banner from the server indicates that
>> mod_python is loaded.
> 
> 
> Show how you are starting apache & how you have configured mod_python.

For me, HOME=/home/roberto

I have a modified apache2ctl in $HOME/apache2/bin, which starts it like
this:

case $ARGV in
start|stop|restart|graceful)
    $HTTPD -d $HOME/apache2 -f $HOME/apache2/conf/apache2.conf -k $ARGV
    ERROR=$?
    ;;

In $HOME/public_html/.htaccess, I have:

<IfModule mod_python.c>
# Enable mod_python Python Server Pages
  AddHandler mod_python .psp .psp_
  PythonHandler mod_python.psp
  PythonDebug On
</IfModule>

I use the IfModule directive so that access to my home directory via
~roberto doesn't cause the real Aapche server on port 80 to barf since I
don't have mod_python enabled in it at all.  The one I am starting from
within $HOME is on port 8080.

-Roberto

-- 
Roberto C. Sanchez
http://familiasanchez.net/~roberto
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 256 bytes
Desc: OpenPGP digital signature
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20051214/cd63e674/signature.bin
From list at joreybump.com  Wed Dec 14 10:32:02 2005
From: list at joreybump.com (Jorey Bump)
Date: Wed Dec 14 10:32:08 2005
Subject: [mod_python] Configuring mod_python via reverse proxy
In-Reply-To: <43A020E0.1070601@familiasanchez.net>
References: <43A0191A.20605@familiasanchez.net>
	<43A01BCB.5040607@joreybump.com>
	<43A020E0.1070601@familiasanchez.net>
Message-ID: <43A03AF2.9010905@joreybump.com>

Roberto C. Sanchez wrote:

> I have a modified apache2ctl in $HOME/apache2/bin, which starts it like
> this:
> 
> case $ARGV in
> start|stop|restart|graceful)
>     $HTTPD -d $HOME/apache2 -f $HOME/apache2/conf/apache2.conf -k $ARGV
>     ERROR=$?
>     ;;
> 
> In $HOME/public_html/.htaccess, I have:
> 
> <IfModule mod_python.c>
> # Enable mod_python Python Server Pages
>   AddHandler mod_python .psp .psp_
>   PythonHandler mod_python.psp
>   PythonDebug On
> </IfModule>
> 
> I use the IfModule directive so that access to my home directory via
> ~roberto doesn't cause the real Aapche server on port 80 to barf since I
> don't have mod_python enabled in it at all.  The one I am starting from
> within $HOME is on port 8080.

If you are starting apache with a dedicated conf file, specify a 
DocumentRoot within it that isn't shared with the main instance to 
prevent conflicts or security leaks (does the main instance of apache 
show your python code as text?). In addition, try to do your 
configuration in a Directory container in the custom conf file, at least 
until you get everything working. Start with the mptest example. 
Gradually alter your configuration from a working base, so you can 
determine which change is causing problems.


From chase at oldben.llnl.gov  Wed Dec 14 10:49:27 2005
From: chase at oldben.llnl.gov (chase3@llnl.gov)
Date: Wed Dec 14 10:52:47 2005
Subject: [mod_python] connection pool (newbie question)
In-Reply-To: <43A01EF5.5050106@natlab.research.philips.com>
Message-ID: <Pine.LNX.4.44.0512140747080.7675-100000@oldben.llnl.gov>

Thanks to all of you for your excellent suggestions for this and my
earlier problems.  You've all been very helpful.
Lila

-- 
Lila Chase
lchase@llnl.gov

From roberto at familiasanchez.net  Wed Dec 14 12:36:39 2005
From: roberto at familiasanchez.net (Roberto C. Sanchez)
Date: Wed Dec 14 12:37:15 2005
Subject: [mod_python] Configuring mod_python via reverse proxy
In-Reply-To: <43A03AF2.9010905@joreybump.com>
References: <43A0191A.20605@familiasanchez.net>	<43A01BCB.5040607@joreybump.com>	<43A020E0.1070601@familiasanchez.net>
	<43A03AF2.9010905@joreybump.com>
Message-ID: <43A05827.3010607@familiasanchez.net>

Jorey Bump wrote:
> Roberto C. Sanchez wrote:
> 
>> I have a modified apache2ctl in $HOME/apache2/bin, which starts it like
>> this:
>>
>> case $ARGV in
>> start|stop|restart|graceful)
>>     $HTTPD -d $HOME/apache2 -f $HOME/apache2/conf/apache2.conf -k $ARGV
>>     ERROR=$?
>>     ;;
>>
>> In $HOME/public_html/.htaccess, I have:
>>
>> <IfModule mod_python.c>
>> # Enable mod_python Python Server Pages
>>   AddHandler mod_python .psp .psp_
>>   PythonHandler mod_python.psp
>>   PythonDebug On
>> </IfModule>
>>
>> I use the IfModule directive so that access to my home directory via
>> ~roberto doesn't cause the real Aapche server on port 80 to barf since I
>> don't have mod_python enabled in it at all.  The one I am starting from
>> within $HOME is on port 8080.
> 
> 
> If you are starting apache with a dedicated conf file, specify a
> DocumentRoot within it that isn't shared with the main instance to
> prevent conflicts or security leaks (does the main instance of apache
> show your python code as text?). In addition, try to do your
> configuration in a Directory container in the custom conf file, at least
> until you get everything working. Start with the mptest example.
> Gradually alter your configuration from a working base, so you can
> determine which change is causing problems.

The DocumentRoot is $HOME/public_html, which is also accessible via
user_dir from the main apache instance.  Is that a problem?

Basically, for Python Server Pages I get the source displayed in the
browser.  For .py files using the publisher handler, I get either the
source downloaded (in the case of just the .py file, e.g.,
http://foo/form.py) or a 404, (in the case of http://foo/form.py/email).
 Of course, I am referring to the form example here:
http://www.modpython.org/live/current/doc-html/tut-pub.html

-Roberto

-- 
Roberto C. Sanchez
http://familiasanchez.net/~roberto
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 256 bytes
Desc: OpenPGP digital signature
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20051214/728b664c/signature.bin
From deathowl at gmail.com  Wed Dec 14 15:19:04 2005
From: deathowl at gmail.com (Andrey Kuznetsov)
Date: Wed Dec 14 15:19:06 2005
Subject: [mod_python] Session Timeouts
In-Reply-To: <5AC31A0D-A31F-4928-B728-47363AF0DAA8@packet-addiction.org>
References: <5AC31A0D-A31F-4928-B728-47363AF0DAA8@packet-addiction.org>
Message-ID: <15e1d2810512141219w16850dc6m5b431e2d54941b4@mail.gmail.com>

I was under the impression that timeout in modpython worked just like
you described, have you tested this? Am I wrong?

On 12/12/05, Peter Sanchez <pjs@packet-addiction.org> wrote:
> I have a question regarding session timeouts. I would like to set the
> timeout, to say, 1 hour. Instead of whatever the default is now. I
> know of set_timeout() function, but my question is this. Can I use
> the set_timeout() multiple times? For example, a user comes to my
> site, logs in, I set the timeout to 1 hour. Every page in the members
> section checks the session, and every time a page is accessed, I want
> to reset the time to 1 hour from the time that page was accessed. So
> will using set_timeout() every time do that?
>
> I hope that makes sense, but it probably doesn't ;) So here is a
> "flow chart"
>
> 10:45 - User logs in, set_timeout() to 1 hour from now (11:45)
> 10:47 - User accesses email page, set_timeout to 1 hour from now (11:47)
>
> etc.. on and on it goes.
>
> Thanks!
>
> Peter
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>


--
Live Long and Prosper,
by Andrey Kuznetsov aka "Death Owl"

From jpg at jgassociates.ca  Wed Dec 14 15:23:46 2005
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Wed Dec 14 15:21:58 2005
Subject: [mod_python] Configuring mod_python via reverse proxy
In-Reply-To: <43A05827.3010607@familiasanchez.net>
References: <43A0191A.20605@familiasanchez.net>	<43A01BCB.5040607@joreybump.com>	<43A020E0.1070601@familiasanchez.net>	<43A03AF2.9010905@joreybump.com>
	<43A05827.3010607@familiasanchez.net>
Message-ID: <43A07F52.1060105@jgassociates.ca>

Roberto C. Sanchez wrote:
> Jorey Bump wrote:
> 
>>Roberto C. Sanchez wrote:
>>
>>
>>>I have a modified apache2ctl in $HOME/apache2/bin, which starts it like
>>>this:
>>>
>>>case $ARGV in
>>>start|stop|restart|graceful)
>>>    $HTTPD -d $HOME/apache2 -f $HOME/apache2/conf/apache2.conf -k $ARGV
>>>    ERROR=$?
>>>    ;;
>>>
>>>In $HOME/public_html/.htaccess, I have:
>>>
>>><IfModule mod_python.c>
>>># Enable mod_python Python Server Pages
>>>  AddHandler mod_python .psp .psp_
>>>  PythonHandler mod_python.psp
>>>  PythonDebug On
>>></IfModule>
>>>
>>>I use the IfModule directive so that access to my home directory via
>>>~roberto doesn't cause the real Aapche server on port 80 to barf since I
>>>don't have mod_python enabled in it at all.  The one I am starting from
>>>within $HOME is on port 8080.
>>
>>
>>If you are starting apache with a dedicated conf file, specify a
>>DocumentRoot within it that isn't shared with the main instance to
>>prevent conflicts or security leaks (does the main instance of apache
>>show your python code as text?). In addition, try to do your
>>configuration in a Directory container in the custom conf file, at least
>>until you get everything working. Start with the mptest example.
>>Gradually alter your configuration from a working base, so you can
>>determine which change is causing problems.
> 
> 
> The DocumentRoot is $HOME/public_html, which is also accessible via
> user_dir from the main apache instance.  Is that a problem?
> 
> Basically, for Python Server Pages I get the source displayed in the
> browser.  For .py files using the publisher handler, I get either the
> source downloaded (in the case of just the .py file, e.g.,
> http://foo/form.py) or a 404, (in the case of http://foo/form.py/email).
>  Of course, I am referring to the form example here:
> http://www.modpython.org/live/current/doc-html/tut-pub.html
> 
> -Roberto

This maybe too obvious but is AllowOverride perhapas set to None such 
that your .htaccess file is not getting processed?

Jim

From roberto at familiasanchez.net  Wed Dec 14 15:44:19 2005
From: roberto at familiasanchez.net (Roberto C. Sanchez)
Date: Wed Dec 14 15:44:56 2005
Subject: [mod_python] Configuring mod_python via reverse proxy
In-Reply-To: <43A07F52.1060105@jgassociates.ca>
References: <43A0191A.20605@familiasanchez.net>	<43A01BCB.5040607@joreybump.com>	<43A020E0.1070601@familiasanchez.net>	<43A03AF2.9010905@joreybump.com>
	<43A05827.3010607@familiasanchez.net>
	<43A07F52.1060105@jgassociates.ca>
Message-ID: <43A08423.8040308@familiasanchez.net>

Jim Gallacher wrote:
> 
> This maybe too obvious but is AllowOverride perhapas set to None such
> that your .htaccess file is not getting processed?
> 
> Jim
> 

OK.  I feel like a complete retard.  In copying over the VirtualHost
settings for the instance of apache running from $HOME, I accidentally
copied the wrong AllowOverride line.  It was set to None.  Thus, when I
accessed mod_python from the main apache server running on port 80, it
worked since it was allowing the override.  When I proxied to the
instance on port 8080, it failed, as the overrides were not allowed.

Thanks for the blinding insight.

-Roberto

-- 
Roberto C. Sanchez
http://familiasanchez.net/~roberto
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 256 bytes
Desc: OpenPGP digital signature
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20051214/9d11a1d6/signature.bin
From grahamd at dscpl.com.au  Wed Dec 14 16:07:13 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Dec 14 16:07:28 2005
Subject: [mod_python] connection pool (newbie question)
In-Reply-To: <43A01EF5.5050106@natlab.research.philips.com>
References: <Pine.LNX.4.44.0512131837540.2792-100000@oldben.llnl.gov>
	<43A01EF5.5050106@natlab.research.philips.com>
Message-ID: <2DFB1375-AF4B-4DA4-B79C-FD56E57ED450@dscpl.com.au>


On 15/12/2005, at 12:32 AM, Mike Looijmans wrote:

>> I've looked at connection pool code for a persistent database
>> connection.   I don't know where to create the connection pool.
>> If in the handler code (I'm using publisher), wouldn't a new
>> pool be created each time the handler is called?
>>
>
> You'll get a new pool for each process (not for each thread)

Technically speaking, not necessarily. :-)

There will actually be one per Python interpreter instance which uses  
that
handler module. Thus if you were supporting two virtual hosts and  
both used
the same handler module there would be one for each virtual host in each
process. This even presumes the pool was created at global scope within
the handler module. If it was created within the handler function  
itself, then
there could be one per request.

If pool was created at global scope within the handler module and module
reloading is used, then over time you could end up with multiple  
pools with
older ones potentially becoming inaccessible resources with a  
resource leak
resulting. Resource pools should ideally be created in modules which are
not the subject of mod_python module reloading.

All this was what the referenced article and old mailing list posts  
help to
describe.

Graham

From blaing at vancoservices.com  Wed Dec 14 16:09:56 2005
From: blaing at vancoservices.com (Brandon Laing)
Date: Wed Dec 14 16:10:01 2005
Subject: [mod_python] Build errors
Message-ID: <20051214210956.56bd0c47@email.vancoservices.com>

Hey all,

I'm running into a problem trying to build Mod Python 3.1.4 on a Fedora 4 system. I'm building it because I need to to run Python 2.3, which has already been installed on the system and appears to be working properly.

So, I downloaded and extracted Mod Python 3.1.4, and ran "./configure --with-python=/usr/local/bin/python2.3" to build it against the correct version. Ok, it detects Python 2.3 and creates the make file. 

Next, I run make. After a minute, the make fails with this error:

------------------------------------------
/usr/bin/ld: /usr/local/lib/python2.3/config/libpython2.3.a(abstract.o): relocation R_X86_64_32S against `_Py_NotImplementedStruct' can not be used when making a shared object; recompile with -fPIC
/usr/local/lib/python2.3/config/libpython2.3.a: could not read symbols: Bad value
collect2: ld returned 1 exit status
apxs:Error: Command failed with rc=65536
.
make[1]: *** [mod_python.so] Error 1
make[1]: Leaving directory `/root/mod_python-3.1.4/src'
make: *** [do_dso] Error 2
------------------------------------------

I've reinstalled Fedora twice now, just to be sure, and have been met with this same result both times. I have no idea where to go from here, or how to get this to build properly. 

Anyone seen this before, or know of a way to get around it?

Thanks,
Brandon
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20051214/cda0c676/attachment.html
From grahamd at dscpl.com.au  Wed Dec 14 16:12:48 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Dec 14 16:12:56 2005
Subject: [mod_python] Configuring mod_python via reverse proxy
In-Reply-To: <43A08423.8040308@familiasanchez.net>
References: <43A0191A.20605@familiasanchez.net>	<43A01BCB.5040607@joreybump.com>	<43A020E0.1070601@familiasanchez.net>	<43A03AF2.9010905@joreybump.com>
	<43A05827.3010607@familiasanchez.net>
	<43A07F52.1060105@jgassociates.ca>
	<43A08423.8040308@familiasanchez.net>
Message-ID: <C7EDC024-DC70-4D0B-A85B-2F935A73714C@dscpl.com.au>


On 15/12/2005, at 7:44 AM, Roberto C. Sanchez wrote:

> Jim Gallacher wrote:
>
>>
>> This maybe too obvious but is AllowOverride perhapas set to None such
>> that your .htaccess file is not getting processed?
>
> OK.  I feel like a complete retard.  In copying over the VirtualHost
> settings for the instance of apache running from $HOME, I accidentally
> copied the wrong AllowOverride line.  It was set to None.  Thus,  
> when I
> accessed mod_python from the main apache server running on port 80, it
> worked since it was allowing the override.  When I proxied to the
> instance on port 8080, it failed, as the overrides were not allowed.

Too late for me to contribute since you got it working, but the article:

   http://www.dscpl.com.au/articles/modpython-001.html

is often better for helping to troubleshoot why mod_python isn't  
working.
It even mentions AllowOverride. ;-)

Graham
From list at joreybump.com  Wed Dec 14 17:36:39 2005
From: list at joreybump.com (Jorey Bump)
Date: Wed Dec 14 17:36:47 2005
Subject: [mod_python] Configuring mod_python via reverse proxy
In-Reply-To: <43A08423.8040308@familiasanchez.net>
References: <43A0191A.20605@familiasanchez.net>	<43A01BCB.5040607@joreybump.com>	<43A020E0.1070601@familiasanchez.net>	<43A03AF2.9010905@joreybump.com>	<43A05827.3010607@familiasanchez.net>	<43A07F52.1060105@jgassociates.ca>
	<43A08423.8040308@familiasanchez.net>
Message-ID: <43A09E77.3070305@joreybump.com>

Roberto C. Sanchez wrote:
> Jim Gallacher wrote:
> 
>>This maybe too obvious but is AllowOverride perhapas set to None such
>>that your .htaccess file is not getting processed?
>>
>>Jim
>>
> 
> OK.  I feel like a complete retard.  In copying over the VirtualHost
> settings for the instance of apache running from $HOME, I accidentally
> copied the wrong AllowOverride line.  It was set to None.  Thus, when I
> accessed mod_python from the main apache server running on port 80, it
> worked since it was allowing the override.  When I proxied to the
> instance on port 8080, it failed, as the overrides were not allowed.
> 
> Thanks for the blinding insight.

This is why I suggested using your custom configuration file instead of 
.htaccess, and still recommend it if you're running your own instance of 
apache.

It's up to you to decide if it's safe to share the directory between 
multiple instances of apache. You risk an information leak by leaving 
source code in public_html.
From roberto at familiasanchez.net  Wed Dec 14 17:42:29 2005
From: roberto at familiasanchez.net (Roberto C. Sanchez)
Date: Wed Dec 14 17:43:00 2005
Subject: [mod_python] Configuring mod_python via reverse proxy
In-Reply-To: <43A09E77.3070305@joreybump.com>
References: <43A0191A.20605@familiasanchez.net>	<43A01BCB.5040607@joreybump.com>	<43A020E0.1070601@familiasanchez.net>	<43A03AF2.9010905@joreybump.com>	<43A05827.3010607@familiasanchez.net>	<43A07F52.1060105@jgassociates.ca>	<43A08423.8040308@familiasanchez.net>
	<43A09E77.3070305@joreybump.com>
Message-ID: <43A09FD5.301@familiasanchez.net>

Jorey Bump wrote:

> This is why I suggested using your custom configuration file instead of
> .htaccess, and still recommend it if you're running your own instance of
> apache.
> 
I was getting around to that :-)

> It's up to you to decide if it's safe to share the directory between
> multiple instances of apache. You risk an information leak by leaving
> source code in public_html.

True.  However, at this point I was just testing and I didn't want to
setup another user just for that.  Besides, the virtualhost for the
instance running in $HOME only has DNS records on my private LAN.  I am
still getting a feel for it.

-Roberto

-- 
Roberto C. Sanchez
http://familiasanchez.net/~roberto
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 256 bytes
Desc: OpenPGP digital signature
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20051214/40638e68/signature-0001.bin
From grahamd at dscpl.com.au  Wed Dec 14 18:14:57 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Dec 14 18:15:00 2005
Subject: [mod_python] Configuring mod_python via reverse proxy
Message-ID: <1134602097.15974@dscpl.user.openhosting.com>

Jorey Bump wrote ..
> Roberto C. Sanchez wrote:
> > Jim Gallacher wrote:
> > 
> >>This maybe too obvious but is AllowOverride perhapas set to None such
> >>that your .htaccess file is not getting processed?
> >>
> >>Jim
> >>
> > 
> > OK.  I feel like a complete retard.  In copying over the VirtualHost
> > settings for the instance of apache running from $HOME, I accidentally
> > copied the wrong AllowOverride line.  It was set to None.  Thus, when
> I
> > accessed mod_python from the main apache server running on port 80, it
> > worked since it was allowing the override.  When I proxied to the
> > instance on port 8080, it failed, as the overrides were not allowed.
> > 
> > Thanks for the blinding insight.
> 
> This is why I suggested using your custom configuration file instead of
> .htaccess, and still recommend it if you're running your own instance of
> apache.
> 
> It's up to you to decide if it's safe to share the directory between 
> multiple instances of apache. You risk an information leak by leaving 
> source code in public_html.

Another non obvious problem which arises because of this arrangement is
that if the second instance of Apache you are running has write access
to the directories, it will dump Python .pyc files. If you are then only
using AddHandler and not SetHandler, there will be nothing to stop
someone specifying a URL which targets the .pyc files and they will be
able to download them also and then decompile them, thus potentially
getting access to sensitive information.

Good idea to have an excplicit rule:

  <Files *.pyc>
  deny from all
  </Files>

Graham
From roberto at familiasanchez.net  Wed Dec 14 21:29:07 2005
From: roberto at familiasanchez.net (Roberto C. Sanchez)
Date: Wed Dec 14 21:29:39 2005
Subject: [mod_python] Configuring mod_python via reverse proxy
In-Reply-To: <1134602097.15974@dscpl.user.openhosting.com>
References: <1134602097.15974@dscpl.user.openhosting.com>
Message-ID: <43A0D4F3.2070405@familiasanchez.net>

Graham Dumpleton wrote:
> 
> Another non obvious problem which arises because of this arrangement is
> that if the second instance of Apache you are running has write access
> to the directories, it will dump Python .pyc files. If you are then only
> using AddHandler and not SetHandler, there will be nothing to stop
> someone specifying a URL which targets the .pyc files and they will be
> able to download them also and then decompile them, thus potentially
> getting access to sensitive information.
> 
> Good idea to have an excplicit rule:
> 
>   <Files *.pyc>
>   deny from all
>   </Files>
> 

I had not considered that.  However, I don't see any .pyc files anywhere
under ~/public_html/.

-Roberto

-- 
Roberto C. Sanchez
http://familiasanchez.net/~roberto
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 256 bytes
Desc: OpenPGP digital signature
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20051214/77f4032f/signature.bin
From grahamd at dscpl.com.au  Wed Dec 14 22:01:15 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Dec 14 22:01:27 2005
Subject: [mod_python] Configuring mod_python via reverse proxy
Message-ID: <1134615675.29540@dscpl.user.openhosting.com>

Roberto C. Sanchez wrote ..
> Graham Dumpleton wrote:
> > 
> > Another non obvious problem which arises because of this arrangement
> is
> > that if the second instance of Apache you are running has write access
> > to the directories, it will dump Python .pyc files. If you are then only
> > using AddHandler and not SetHandler, there will be nothing to stop
> > someone specifying a URL which targets the .pyc files and they will be
> > able to download them also and then decompile them, thus potentially
> > getting access to sensitive information.
> > 
> > Good idea to have an excplicit rule:
> > 
> >   <Files *.pyc>
> >   deny from all
> >   </Files>
> > 
> 
> I had not considered that.  However, I don't see any .pyc files anywhere
> under ~/public_html/.

If you are using mod_python.psp you will not, but if you use PythonHandler
to target a handler .py file in ~/public_html, or you are using mod_python
version 3.1.4 or older and mod_python.publisher, you can.

Graham

From nicolas.lehuen at gmail.com  Thu Dec 15 01:08:38 2005
From: nicolas.lehuen at gmail.com (Nicolas Lehuen)
Date: Thu Dec 15 01:08:45 2005
Subject: [mod_python] connection pool (newbie question)
In-Reply-To: <2DFB1375-AF4B-4DA4-B79C-FD56E57ED450@dscpl.com.au>
References: <Pine.LNX.4.44.0512131837540.2792-100000@oldben.llnl.gov>
	<43A01EF5.5050106@natlab.research.philips.com>
	<2DFB1375-AF4B-4DA4-B79C-FD56E57ED450@dscpl.com.au>
Message-ID: <c298f2d70512142208r402db41dp@mail.gmail.com>

Note that Apache 2.2  features a database API with connection pooling
capabilities. This is all very brand new and bug-prone, but we could
imagine building a DBAPI wrapper around this API, thus making it
possible to rely on Apache-level pooling mechanisms. See :

http://httpd.apache.org/docs/2.1/mod/mod_dbd.html

Anyway, this is not a solution in the short term.

Regards,
Nicolas

2005/12/14, Graham Dumpleton <grahamd@dscpl.com.au>:
>
> On 15/12/2005, at 12:32 AM, Mike Looijmans wrote:
>
> >> I've looked at connection pool code for a persistent database
> >> connection.   I don't know where to create the connection pool.
> >> If in the handler code (I'm using publisher), wouldn't a new
> >> pool be created each time the handler is called?
> >>
> >
> > You'll get a new pool for each process (not for each thread)
>
> Technically speaking, not necessarily. :-)
>
> There will actually be one per Python interpreter instance which uses
> that
> handler module. Thus if you were supporting two virtual hosts and
> both used
> the same handler module there would be one for each virtual host in each
> process. This even presumes the pool was created at global scope within
> the handler module. If it was created within the handler function
> itself, then
> there could be one per request.
>
> If pool was created at global scope within the handler module and module
> reloading is used, then over time you could end up with multiple
> pools with
> older ones potentially becoming inaccessible resources with a
> resource leak
> resulting. Resource pools should ideally be created in modules which are
> not the subject of mod_python module reloading.
>
> All this was what the referenced article and old mailing list posts
> help to
> describe.
>
> Graham
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>

From davidf at sjsoft.com  Thu Dec 15 03:13:07 2005
From: davidf at sjsoft.com (David Fraser)
Date: Thu Dec 15 03:13:13 2005
Subject: [mod_python] connection pool (OT)
In-Reply-To: <c298f2d70512142208r402db41dp@mail.gmail.com>
References: <Pine.LNX.4.44.0512131837540.2792-100000@oldben.llnl.gov>	<43A01EF5.5050106@natlab.research.philips.com>	<2DFB1375-AF4B-4DA4-B79C-FD56E57ED450@dscpl.com.au>
	<c298f2d70512142208r402db41dp@mail.gmail.com>
Message-ID: <43A12593.7000906@sjsoft.com>

Hi Nicolas

I saw this too but it seems incredibly sparing in terms of the API...
How do you get it to run the actual SQL commands?

David

Nicolas Lehuen wrote:
> Note that Apache 2.2  features a database API with connection pooling
> capabilities. This is all very brand new and bug-prone, but we could
> imagine building a DBAPI wrapper around this API, thus making it
> possible to rely on Apache-level pooling mechanisms. See :
>
> http://httpd.apache.org/docs/2.1/mod/mod_dbd.html
>
> Anyway, this is not a solution in the short term.
>
> Regards,
> Nicolas
>
> 2005/12/14, Graham Dumpleton <grahamd@dscpl.com.au>:
>   
>> On 15/12/2005, at 12:32 AM, Mike Looijmans wrote:
>>
>>     
>>>> I've looked at connection pool code for a persistent database
>>>> connection.   I don't know where to create the connection pool.
>>>> If in the handler code (I'm using publisher), wouldn't a new
>>>> pool be created each time the handler is called?
>>>>
>>>>         
>>> You'll get a new pool for each process (not for each thread)
>>>       
>> Technically speaking, not necessarily. :-)
>>
>> There will actually be one per Python interpreter instance which uses
>> that
>> handler module. Thus if you were supporting two virtual hosts and
>> both used
>> the same handler module there would be one for each virtual host in each
>> process. This even presumes the pool was created at global scope within
>> the handler module. If it was created within the handler function
>> itself, then
>> there could be one per request.
>>
>> If pool was created at global scope within the handler module and module
>> reloading is used, then over time you could end up with multiple
>> pools with
>> older ones potentially becoming inaccessible resources with a
>> resource leak
>> resulting. Resource pools should ideally be created in modules which are
>> not the subject of mod_python module reloading.
>>
>> All this was what the referenced article and old mailing list posts
>> help to
>> describe.
>>
>> Graham
>>
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>
>>     
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>   

From nicolas.lehuen at gmail.com  Thu Dec 15 03:27:38 2005
From: nicolas.lehuen at gmail.com (Nicolas Lehuen)
Date: Thu Dec 15 03:27:41 2005
Subject: [mod_python] connection pool (OT)
In-Reply-To: <43A12593.7000906@sjsoft.com>
References: <Pine.LNX.4.44.0512131837540.2792-100000@oldben.llnl.gov>
	<43A01EF5.5050106@natlab.research.philips.com>
	<2DFB1375-AF4B-4DA4-B79C-FD56E57ED450@dscpl.com.au>
	<c298f2d70512142208r402db41dp@mail.gmail.com>
	<43A12593.7000906@sjsoft.com>
Message-ID: <c298f2d70512150027k5cfa0089v@mail.gmail.com>

It looks like the mod_dbd API is just the Apache's wrapping side to
the APR DB API :

http://people.apache.org/~niq/dbd.html

Now, that's about all the available documentation about this subject,
so I guess we'll have to wait a long time before it is usable...

Regards,
Nicolas

2005/12/15, David Fraser <davidf@sjsoft.com>:
> Hi Nicolas
>
> I saw this too but it seems incredibly sparing in terms of the API...
> How do you get it to run the actual SQL commands?
>
> David
>
> Nicolas Lehuen wrote:
> > Note that Apache 2.2  features a database API with connection pooling
> > capabilities. This is all very brand new and bug-prone, but we could
> > imagine building a DBAPI wrapper around this API, thus making it
> > possible to rely on Apache-level pooling mechanisms. See :
> >
> > http://httpd.apache.org/docs/2.1/mod/mod_dbd.html
> >
> > Anyway, this is not a solution in the short term.
> >
> > Regards,
> > Nicolas
> >
> > 2005/12/14, Graham Dumpleton <grahamd@dscpl.com.au>:
> >
> >> On 15/12/2005, at 12:32 AM, Mike Looijmans wrote:
> >>
> >>
> >>>> I've looked at connection pool code for a persistent database
> >>>> connection.   I don't know where to create the connection pool.
> >>>> If in the handler code (I'm using publisher), wouldn't a new
> >>>> pool be created each time the handler is called?
> >>>>
> >>>>
> >>> You'll get a new pool for each process (not for each thread)
> >>>
> >> Technically speaking, not necessarily. :-)
> >>
> >> There will actually be one per Python interpreter instance which uses
> >> that
> >> handler module. Thus if you were supporting two virtual hosts and
> >> both used
> >> the same handler module there would be one for each virtual host in each
> >> process. This even presumes the pool was created at global scope within
> >> the handler module. If it was created within the handler function
> >> itself, then
> >> there could be one per request.
> >>
> >> If pool was created at global scope within the handler module and module
> >> reloading is used, then over time you could end up with multiple
> >> pools with
> >> older ones potentially becoming inaccessible resources with a
> >> resource leak
> >> resulting. Resource pools should ideally be created in modules which are
> >> not the subject of mod_python module reloading.
> >>
> >> All this was what the referenced article and old mailing list posts
> >> help to
> >> describe.
> >>
> >> Graham
> >>
> >> _______________________________________________
> >> Mod_python mailing list
> >> Mod_python@modpython.org
> >> http://mailman.modpython.org/mailman/listinfo/mod_python
> >>
> >>
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
> >
>
>

From nicolas.lehuen at gmail.com  Thu Dec 15 03:29:06 2005
From: nicolas.lehuen at gmail.com (Nicolas Lehuen)
Date: Thu Dec 15 03:29:09 2005
Subject: [mod_python] connection pool (OT)
In-Reply-To: <c298f2d70512150027k5cfa0089v@mail.gmail.com>
References: <Pine.LNX.4.44.0512131837540.2792-100000@oldben.llnl.gov>
	<43A01EF5.5050106@natlab.research.philips.com>
	<2DFB1375-AF4B-4DA4-B79C-FD56E57ED450@dscpl.com.au>
	<c298f2d70512142208r402db41dp@mail.gmail.com>
	<43A12593.7000906@sjsoft.com>
	<c298f2d70512150027k5cfa0089v@mail.gmail.com>
Message-ID: <c298f2d70512150029k33dcca4bn@mail.gmail.com>

We also have this cross reference :

http://docx.webperf.org/apr__dbd_8h.html

You can perform SELECTs and all :

http://docx.webperf.org/apr__dbd_8h.html#a17

Regards,
Nicolas

2005/12/15, Nicolas Lehuen <nicolas.lehuen@gmail.com>:
> It looks like the mod_dbd API is just the Apache's wrapping side to
> the APR DB API :
>
> http://people.apache.org/~niq/dbd.html
>
> Now, that's about all the available documentation about this subject,
> so I guess we'll have to wait a long time before it is usable...
>
> Regards,
> Nicolas
>
> 2005/12/15, David Fraser <davidf@sjsoft.com>:
> > Hi Nicolas
> >
> > I saw this too but it seems incredibly sparing in terms of the API...
> > How do you get it to run the actual SQL commands?
> >
> > David
> >
> > Nicolas Lehuen wrote:
> > > Note that Apache 2.2  features a database API with connection pooling
> > > capabilities. This is all very brand new and bug-prone, but we could
> > > imagine building a DBAPI wrapper around this API, thus making it
> > > possible to rely on Apache-level pooling mechanisms. See :
> > >
> > > http://httpd.apache.org/docs/2.1/mod/mod_dbd.html
> > >
> > > Anyway, this is not a solution in the short term.
> > >
> > > Regards,
> > > Nicolas
> > >
> > > 2005/12/14, Graham Dumpleton <grahamd@dscpl.com.au>:
> > >
> > >> On 15/12/2005, at 12:32 AM, Mike Looijmans wrote:
> > >>
> > >>
> > >>>> I've looked at connection pool code for a persistent database
> > >>>> connection.   I don't know where to create the connection pool.
> > >>>> If in the handler code (I'm using publisher), wouldn't a new
> > >>>> pool be created each time the handler is called?
> > >>>>
> > >>>>
> > >>> You'll get a new pool for each process (not for each thread)
> > >>>
> > >> Technically speaking, not necessarily. :-)
> > >>
> > >> There will actually be one per Python interpreter instance which uses
> > >> that
> > >> handler module. Thus if you were supporting two virtual hosts and
> > >> both used
> > >> the same handler module there would be one for each virtual host in each
> > >> process. This even presumes the pool was created at global scope within
> > >> the handler module. If it was created within the handler function
> > >> itself, then
> > >> there could be one per request.
> > >>
> > >> If pool was created at global scope within the handler module and module
> > >> reloading is used, then over time you could end up with multiple
> > >> pools with
> > >> older ones potentially becoming inaccessible resources with a
> > >> resource leak
> > >> resulting. Resource pools should ideally be created in modules which are
> > >> not the subject of mod_python module reloading.
> > >>
> > >> All this was what the referenced article and old mailing list posts
> > >> help to
> > >> describe.
> > >>
> > >> Graham
> > >>
> > >> _______________________________________________
> > >> Mod_python mailing list
> > >> Mod_python@modpython.org
> > >> http://mailman.modpython.org/mailman/listinfo/mod_python
> > >>
> > >>
> > >
> > > _______________________________________________
> > > Mod_python mailing list
> > > Mod_python@modpython.org
> > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > >
> > >
> >
> >
>

From nm at estadias.com  Thu Dec 15 10:42:28 2005
From: nm at estadias.com (nm@estadias.com)
Date: Thu Dec 15 10:42:51 2005
Subject: [mod_python] Problem installing mod_python
Message-ID: <1134661348.43a18ee44aac9@webmail.estadias.com>

Hi,
I'm new to python, and i have a problem with the mod_python installation.
I'm running Debian linux 3.1 STABLE, i've done an apt-get install
libapache2-mod-python.
I've tried to run the simple example of:
http://www.modpython.org/live/current/doc-html/inst-testing.html
But don't works. When i call the page, the browser simply show a window to save
the file.
In my apache2.conf i have:
<Directory /home/*/public_html>
        AllowOverride All
        Options Indexes SymLinksIfOwnerMatch IncludesNoExec
</Directory>

Any ideas?
Thanks,
Nuno


----------------------------------------------------------------
This message was sent using IMP, the Internet Messaging Program.

From oduzlevski at intechjanus.com  Thu Dec 15 10:45:29 2005
From: oduzlevski at intechjanus.com (Ognen Duzlevski)
Date: Thu Dec 15 10:45:41 2005
Subject: [mod_python] mod_python and importing cheetah templates
In-Reply-To: <1134602097.15974@dscpl.user.openhosting.com>
References: <1134602097.15974@dscpl.user.openhosting.com>
Message-ID: <3B2F7E56-2F93-4790-8039-16BC7805712D@intechjanus.com>

Hi all,

I have a directory structure as such:

dir1
      templates

In dir1/templates I store cheetah templates which are compiled with  
cheetah-compile into python files.

dir1/main.py is a file that looks at a req.filename and decides to  
load a python module.

So when a request comes for dir1/templates/something.py - it is  
imported and its respond() method is called.

So far so good. However, if something.py is trying to use Cheetah's  
#import <module>, its search path appears to be dir1/ and not dir1/ 
templates where something.py lives. I can see why this might be but  
how do I go about fixing it?

Thanks,
Ognen
From roberto at familiasanchez.net  Thu Dec 15 12:04:33 2005
From: roberto at familiasanchez.net (Roberto Sanchez)
Date: Thu Dec 15 12:04:39 2005
Subject: [mod_python] Problem installing mod_python
In-Reply-To: <1134661348.43a18ee44aac9@webmail.estadias.com>
References: <1134661348.43a18ee44aac9@webmail.estadias.com>
Message-ID: <43A1A221.4080700@familiasanchez.net>

nm@estadias.com wrote:
> Hi,
> I'm new to python, and i have a problem with the mod_python installation.
> I'm running Debian linux 3.1 STABLE, i've done an apt-get install
> libapache2-mod-python.
> I've tried to run the simple example of:
> http://www.modpython.org/live/current/doc-html/inst-testing.html
> But don't works. When i call the page, the browser simply show a window to save
> the file.
> In my apache2.conf i have:
> <Directory /home/*/public_html>
>         AllowOverride All
>         Options Indexes SymLinksIfOwnerMatch IncludesNoExec
> </Directory>
> 
> Any ideas?
> Thanks,
> Nuno

What are the contents of the .htaccess in ~/public_html/?  If you are 
not enabling the mod_python handler there, then is it in your server 
config or virtualhost config?  If so, what are you using?

-Roberto

-- 
Roberto C. Sanchez
http://familiasanchez.net/~roberto
From nm at estadias.com  Thu Dec 15 12:20:40 2005
From: nm at estadias.com (nm@estadias.com)
Date: Thu Dec 15 12:21:01 2005
Subject: [mod_python] Problem installing mod_python
In-Reply-To: <43A1A221.4080700@familiasanchez.net>
References: <1134661348.43a18ee44aac9@webmail.estadias.com>
	<43A1A221.4080700@familiasanchez.net>
Message-ID: <1134667240.43a1a5e8bf903@webmail.estadias.com>

Hi,
My virtual host is:

<VirtualHost *>
    ServerAdmin xx@xxxx.com
    ServerName python.debian
    DocumentRoot /home/nm/public_html/python/
    ErrorLog logs/python.debian-error_log
    CustomLog logs/python.debian-access_log common
</VirtualHost>

In my /home/nm/public_html/python/.htaccess:

AllowOverride All
AddHandler mod_python .py
PythonHandler mptest
PythonDebug On

My mptest.py:

from mod_python import apache

def handler(req):
    req.write("Hello World!")
    return apache.OK

Thats it.
Thanks

Quoting Roberto Sanchez <roberto@familiasanchez.net>:

> nm@estadias.com wrote:
> > Hi,
> > I'm new to python, and i have a problem with the mod_python installation.
> > I'm running Debian linux 3.1 STABLE, i've done an apt-get install
> > libapache2-mod-python.
> > I've tried to run the simple example of:
> > http://www.modpython.org/live/current/doc-html/inst-testing.html
> > But don't works. When i call the page, the browser simply show a window to
> save
> > the file.
> > In my apache2.conf i have:
> > <Directory /home/*/public_html>
> >         AllowOverride All
> >         Options Indexes SymLinksIfOwnerMatch IncludesNoExec
> > </Directory>
> >
> > Any ideas?
> > Thanks,
> > Nuno
>
> What are the contents of the .htaccess in ~/public_html/?  If you are
> not enabling the mod_python handler there, then is it in your server
> config or virtualhost config?  If so, what are you using?
>
> -Roberto
>
> --
> Roberto C. Sanchez
> http://familiasanchez.net/~roberto
>




----------------------------------------------------------------
This message was sent using IMP, the Internet Messaging Program.

From list at joreybump.com  Thu Dec 15 14:32:16 2005
From: list at joreybump.com (Jorey Bump)
Date: Thu Dec 15 14:32:29 2005
Subject: [mod_python] Problem installing mod_python
In-Reply-To: <1134667240.43a1a5e8bf903@webmail.estadias.com>
References: <1134661348.43a18ee44aac9@webmail.estadias.com>	<43A1A221.4080700@familiasanchez.net>
	<1134667240.43a1a5e8bf903@webmail.estadias.com>
Message-ID: <43A1C4C0.9090800@joreybump.com>

nm@estadias.com wrote:

> In my /home/nm/public_html/python/.htaccess:
> 
> AllowOverride All
> AddHandler mod_python .py
> PythonHandler mptest
> PythonDebug On

AllowOverride is not legal in .htaccess, for obvious reasons:

  http://httpd.apache.org/docs/2.0/mod/core.html#allowoverride
From johnbmudd at gmail.com  Thu Dec 15 14:47:05 2005
From: johnbmudd at gmail.com (John Mudd)
Date: Thu Dec 15 14:47:08 2005
Subject: [mod_python] Re: multiple html pages?
In-Reply-To: <8cbda4900512130757v126f71c9j883fb204a629024d@mail.gmail.com>
References: <8cbda4900512130757v126f71c9j883fb204a629024d@mail.gmail.com>
Message-ID: <8cbda4900512151147q42ca7ea4l4a0763c1710234b7@mail.gmail.com>

FYI:  I got a fix from kelly23 on http://www.webdeveloper.com, a HTML
forum.  All I needed is to put the wide table inside a DIV set to
overflow: scroll.  Now the table scrolls within its own space and
stays within the border.   This is what I was trying to accomplish
with frames but much simpler.

John


On 12/13/05, John Mudd <johnbmudd@gmail.com> wrote:
> I need to use frames in my HTML.  I thought maybe I could use frames
> and have all the sources in one HTML file (generated by mod_python)
> but HTML doesn't seem to support this.  I need a separate HTML file
> for each frame.  Any way around this?  It seems like a waste to write
> HTML to separate files just so Apache can then read them back.
>
> Could using PSP pages help?  Maybe invoke my Python code from the main
> PSP page, generate the HTML code for each frame, save that HTML code
> in python variables, have each frame use other PSP pages as their
> source, have the frame PSP pages just expand the python variables set
> in my main PSP page.
>
> Any suggestions?
>
> John
>

From grahamd at dscpl.com.au  Thu Dec 15 15:29:14 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Dec 15 15:29:29 2005
Subject: [mod_python] mod_python and importing cheetah templates
In-Reply-To: <3B2F7E56-2F93-4790-8039-16BC7805712D@intechjanus.com>
References: <1134602097.15974@dscpl.user.openhosting.com>
	<3B2F7E56-2F93-4790-8039-16BC7805712D@intechjanus.com>
Message-ID: <64173d91dd8d83023b5c826e5a059742@dscpl.com.au>


On 16/12/2005, at 2:45 AM, Ognen Duzlevski wrote:

> Hi all,
>
> I have a directory structure as such:
>
> dir1
>      templates
>
> In dir1/templates I store cheetah templates which are compiled with 
> cheetah-compile into python files.
>
> dir1/main.py is a file that looks at a req.filename and decides to 
> load a python module.
>
> So when a request comes for dir1/templates/something.py - it is 
> imported and its respond() method is called.
>
> So far so good. However, if something.py is trying to use Cheetah's 
> #import <module>, its search path appears to be dir1/ and not 
> dir1/templates where something.py lives. I can see why this might be 
> but how do I go about fixing it?

You need to look at manually specifying the PythonPath directive to
include "dir1" and "dir1/templates", both as absolute paths.

Graham

From grahamd at dscpl.com.au  Thu Dec 15 15:34:14 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Dec 15 15:34:42 2005
Subject: [mod_python] Problem installing mod_python
In-Reply-To: <1134661348.43a18ee44aac9@webmail.estadias.com>
References: <1134661348.43a18ee44aac9@webmail.estadias.com>
Message-ID: <30126e890a2c1c82822ad8bb602f46f4@dscpl.com.au>


On 16/12/2005, at 2:42 AM, nm@estadias.com wrote:

> Hi,
> I'm new to python, and i have a problem with the mod_python 
> installation.
> I'm running Debian linux 3.1 STABLE, i've done an apt-get install
> libapache2-mod-python.
> I've tried to run the simple example of:
> http://www.modpython.org/live/current/doc-html/inst-testing.html
> But don't works. When i call the page, the browser simply show a 
> window to save
> the file.
> In my apache2.conf i have:
> <Directory /home/*/public_html>
>         AllowOverride All
>         Options Indexes SymLinksIfOwnerMatch IncludesNoExec
> </Directory>

Is the file it saves the source code, or the actual content of the page?
If the content, it may be because in your code you don't set
req.content_type which can cause this behaviour.

For a better guide for a simple test example in mod_python, see:

   http://www.dscpl.com.au/articles/modpython-001.html

Graham

From roberto at familiasanchez.net  Thu Dec 15 16:16:50 2005
From: roberto at familiasanchez.net (Roberto Sanchez)
Date: Thu Dec 15 16:16:54 2005
Subject: [mod_python] Configuring mod_python via reverse proxy
In-Reply-To: <1134615675.29540@dscpl.user.openhosting.com>
References: <1134615675.29540@dscpl.user.openhosting.com>
Message-ID: <43A1DD42.6050605@familiasanchez.net>

Graham Dumpleton wrote:

> If you are using mod_python.psp you will not, but if you use PythonHandler
> to target a handler .py file in ~/public_html, or you are using mod_python
> version 3.1.4 or older and mod_python.publisher, you can.
> 
> Graham
> 

That makes me wonder if it is a Bad Idea(TM) to let apache run as the 
user himself.  Is there an alternative there?  Originally, I was trying 
to avoid the problems encountered by using mod_python on a shared 
machine.  This is similar to the problem with using mod_php on a shared 
machine, except that PHP has a safe mode (which I understand is not very 
safe at all).  Running separate instances of apache seems like the 
better alternative in this case.  I am just wondering of problems that 
may occur by letting the web server run and then having write access to 
the document root.

-Roberto

-- 
Roberto C. Sanchez
http://familiasanchez.net/~roberto
From josh at janrain.com  Thu Dec 15 16:43:05 2005
From: josh at janrain.com (Josh Hoyt)
Date: Thu Dec 15 16:43:10 2005
Subject: [mod_python] Using mod_python for auth only
Message-ID: <34714aad0512151343n1bc7e5d5g742e07ca505bf4b8@mail.gmail.com>

Hello,

I'm using mod_python to implement a custom authorization handler. I
have the authorization code working how I want it to work. Now I want
to be able to use mod_python for authorization and specify a
non-Python handler for the remainder of the request. Is it possible to
use mod_python to handle just the authorization phase?

In case I didn't make myself clear, here is what I'd like to be able to do:

  <Files "foo">
    SetHandler foo-handler
    # Not SetHandler mod_python, because that removes the foo-handler
    PythonAuthenHandler myhandler
    Require valid-user
  </Files>

  <Files "bar">
    SetHandler bar-handler
    PythonAuthenHandler myhandler
    Require valid-user
  </Files>

Thanks in advance,
Josh Hoyt

From grahamd at dscpl.com.au  Thu Dec 15 17:51:25 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Dec 15 17:51:30 2005
Subject: [mod_python] Using mod_python for auth only
Message-ID: <1134687085.23119@dscpl.user.openhosting.com>

Josh Hoyt wrote ..
> Hello,
> 
> I'm using mod_python to implement a custom authorization handler. I
> have the authorization code working how I want it to work. Now I want
> to be able to use mod_python for authorization and specify a
> non-Python handler for the remainder of the request. Is it possible to
> use mod_python to handle just the authorization phase?
> 
> In case I didn't make myself clear, here is what I'd like to be able to
> do:
> 
>   <Files "foo">
>     SetHandler foo-handler
>     # Not SetHandler mod_python, because that removes the foo-handler
>     PythonAuthenHandler myhandler
>     Require valid-user
>   </Files>
> 
>   <Files "bar">
>     SetHandler bar-handler
>     PythonAuthenHandler myhandler
>     Require valid-user
>   </Files>

It should be possible to do what you want and the above is more or
less right. The mod_python authentication handler will not be called
by default though, the Apache configuration has to be such as to
cause it to be triggered. This generally requires AuthType directive,
plus Require directive. Eg:

  AuthType Basic
  AuthName "Restricted Files"
  Require valid-user
  PythonAuthenHandler myhandler

Graham

From arnaudsj at emedialibrary.org  Thu Dec 15 17:54:52 2005
From: arnaudsj at emedialibrary.org (=?ISO-8859-1?Q?S=E9bastien_Arnaud?=)
Date: Thu Dec 15 17:54:57 2005
Subject: [mod_python] Apache processes "eating up" too much memory (leak?)
Message-ID: <25F47ABD-C93C-40F3-87A6-9F3D42A0A07E@emedialibrary.org>

Hello!

I am running mod_python on 2 identical production server for 2 small  
apps I wrote which basically render over 100 of different SVG charts.  
I am running Gentoo on those servers, mod_python 3.1.4, apache 2.0.55  
in prefork mode, each server has 1 Go of mem.

Both applications have been in beta testing for like 1 month or so,  
and I just noticed today that the memory usage was really high for  
each apache process running (max of 10 set in the conf file). When I  
started those apache process 30 days ago they stabilize at 2.0 % of  
memory used, but somehow after 30 days of users testing the app, it  
went to 10% per apache process, which made the swap usage go to 1Go  
(over 2Go avail). I am doing quite a lot of caching of XSL files in  
the app, but this is suppose to happen at launch time, meaning I  
instantiate all the objects I need at the first call of the  
mod_python handler and they persist through the life of those apache  
processes. Does somebody know anyway to inspect each apache process  
to see where the memory is being used? Basically I am trying here to  
figure out if I have some kind of memory leak going on, or if there  
is something I miscalculated when caching the large amount of XSL  
files in persistent Python objects.

Apart from that, those 2 little applications fly in terms of speed! A  
lot of people (including me) got really blown away to witness the  
speed of those 2 apps on those "old" servers (which are quad PIII  
550Mhz btw).

Thank you in advance for any insights so that I can get to the bottom  
of this!

Cheers!

S?bastien Arnaud
eMedia Library, inc
sebastien@emedialibrary.org




From grahamd at dscpl.com.au  Thu Dec 15 18:07:00 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Dec 15 18:07:02 2005
Subject: [mod_python] Apache processes "eating up" too much memory (leak?)
Message-ID: <1134688020.611@dscpl.user.openhosting.com>

FWIW, you might consider upgrading to mod_python 3.2.5b if you can. I
believe that that version eliminates a few memory leaks in certain
circumstances in mod_python itself, although I don't remember the
details. This may or may not be contributing. My understanding was that
the mod_python leaks weren't that great, but if you are handling a lot
of requests it may be noticeable. You also may want to configure Apache
to recycle child processes after a certain number of requests to avoid
overblown processes.

Sorry, I know this doesn't really help with tracking down the source of
any problem if in your code. :-)

Graham

=?ISO-8859-1?Q?S=E9bastien_Arnaud?= wrote ..
> Hello!
> 
> I am running mod_python on 2 identical production server for 2 small  
> apps I wrote which basically render over 100 of different SVG charts. 
> I am running Gentoo on those servers, mod_python 3.1.4, apache 2.0.55 
> in prefork mode, each server has 1 Go of mem.
> 
> Both applications have been in beta testing for like 1 month or so,  
> and I just noticed today that the memory usage was really high for  
> each apache process running (max of 10 set in the conf file). When I  
> started those apache process 30 days ago they stabilize at 2.0 % of  
> memory used, but somehow after 30 days of users testing the app, it  
> went to 10% per apache process, which made the swap usage go to 1Go  
> (over 2Go avail). I am doing quite a lot of caching of XSL files in  
> the app, but this is suppose to happen at launch time, meaning I  
> instantiate all the objects I need at the first call of the  
> mod_python handler and they persist through the life of those apache  
> processes. Does somebody know anyway to inspect each apache process  
> to see where the memory is being used? Basically I am trying here to  
> figure out if I have some kind of memory leak going on, or if there  
> is something I miscalculated when caching the large amount of XSL  
> files in persistent Python objects.
> 
> Apart from that, those 2 little applications fly in terms of speed! A 
> lot of people (including me) got really blown away to witness the  
> speed of those 2 apps on those "old" servers (which are quad PIII  
> 550Mhz btw).
> 
> Thank you in advance for any insights so that I can get to the bottom 
> of this!
> 
> Cheers!
> 
> S?bastien Arnaud
> eMedia Library, inc
> sebastien@emedialibrary.org
> 
> 
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
From jpg at jgassociates.ca  Thu Dec 15 18:41:58 2005
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Thu Dec 15 18:40:23 2005
Subject: [mod_python] Apache processes "eating up" too much memory (leak?)
In-Reply-To: <1134688020.611@dscpl.user.openhosting.com>
References: <1134688020.611@dscpl.user.openhosting.com>
Message-ID: <43A1FF46.9060200@jgassociates.ca>

The leak in 3.1.4 resulted from the use of the PythonOption directive. 
Around 25 bytes was lost for each directive on each request. This was 
pretty small, but does add up when you really hammer the server. Check 
the following JIRA issues for details:

http://issues.apache.org/jira/browse/MODPYTHON-60
http://issues.apache.org/jira/browse/MODPYTHON-75

You want 3.2.5b all the way.

Jim


Graham Dumpleton wrote:
> FWIW, you might consider upgrading to mod_python 3.2.5b if you can. I
> believe that that version eliminates a few memory leaks in certain
> circumstances in mod_python itself, although I don't remember the
> details. This may or may not be contributing. My understanding was that
> the mod_python leaks weren't that great, but if you are handling a lot
> of requests it may be noticeable. You also may want to configure Apache
> to recycle child processes after a certain number of requests to avoid
> overblown processes.
> 
> Sorry, I know this doesn't really help with tracking down the source of
> any problem if in your code. :-)
> 
> Graham
> 
> =?ISO-8859-1?Q?S=E9bastien_Arnaud?= wrote ..
> 
>>Hello!
>>
>>I am running mod_python on 2 identical production server for 2 small  
>>apps I wrote which basically render over 100 of different SVG charts. 
>>I am running Gentoo on those servers, mod_python 3.1.4, apache 2.0.55 
>>in prefork mode, each server has 1 Go of mem.
>>
>>Both applications have been in beta testing for like 1 month or so,  
>>and I just noticed today that the memory usage was really high for  
>>each apache process running (max of 10 set in the conf file). When I  
>>started those apache process 30 days ago they stabilize at 2.0 % of  
>>memory used, but somehow after 30 days of users testing the app, it  
>>went to 10% per apache process, which made the swap usage go to 1Go  
>>(over 2Go avail). I am doing quite a lot of caching of XSL files in  
>>the app, but this is suppose to happen at launch time, meaning I  
>>instantiate all the objects I need at the first call of the  
>>mod_python handler and they persist through the life of those apache  
>>processes. Does somebody know anyway to inspect each apache process  
>>to see where the memory is being used? Basically I am trying here to  
>>figure out if I have some kind of memory leak going on, or if there  
>>is something I miscalculated when caching the large amount of XSL  
>>files in persistent Python objects.
>>
>>Apart from that, those 2 little applications fly in terms of speed! A 
>>lot of people (including me) got really blown away to witness the  
>>speed of those 2 apps on those "old" servers (which are quad PIII  
>>550Mhz btw).
>>
>>Thank you in advance for any insights so that I can get to the bottom 
>>of this!
>>
>>Cheers!
>>
>>S?bastien Arnaud
>>eMedia Library, inc
>>sebastien@emedialibrary.org
>>
>>
>>
>>
>>_______________________________________________
>>Mod_python mailing list
>>Mod_python@modpython.org
>>http://mailman.modpython.org/mailman/listinfo/mod_python
>>
>>
>>------------------------------------------------------------------------
>>
>>_______________________________________________
>>Mod_python mailing list
>>Mod_python@modpython.org
>>http://mailman.modpython.org/mailman/listinfo/mod_python

From list at joreybump.com  Thu Dec 15 20:12:13 2005
From: list at joreybump.com (Jorey Bump)
Date: Thu Dec 15 20:12:20 2005
Subject: [mod_python] Configuring mod_python via reverse proxy
In-Reply-To: <43A1DD42.6050605@familiasanchez.net>
References: <1134615675.29540@dscpl.user.openhosting.com>
	<43A1DD42.6050605@familiasanchez.net>
Message-ID: <43A2146D.8040302@joreybump.com>

Roberto Sanchez wrote:
> Graham Dumpleton wrote:
> 
>> If you are using mod_python.psp you will not, but if you use 
>> PythonHandler
>> to target a handler .py file in ~/public_html, or you are using 
>> mod_python
>> version 3.1.4 or older and mod_python.publisher, you can.
> 
> That makes me wonder if it is a Bad Idea(TM) to let apache run as the 
> user himself.  Is there an alternative there?  Originally, I was trying 
> to avoid the problems encountered by using mod_python on a shared 
> machine.  This is similar to the problem with using mod_php on a shared 
> machine, except that PHP has a safe mode (which I understand is not very 
> safe at all).  Running separate instances of apache seems like the 
> better alternative in this case.  I am just wondering of problems that 
> may occur by letting the web server run and then having write access to 
> the document root.

It's a double-edged sword, much like running CGI with suexec.

Be sure to limit the user so there are no important assets in the home 
directory (like personal mail or private keys).


From roberto at familiasanchez.net  Thu Dec 15 20:20:52 2005
From: roberto at familiasanchez.net (Roberto Sanchez)
Date: Thu Dec 15 20:20:56 2005
Subject: [mod_python] Configuring mod_python via reverse proxy
In-Reply-To: <43A2146D.8040302@joreybump.com>
References: <1134615675.29540@dscpl.user.openhosting.com>	<43A1DD42.6050605@familiasanchez.net>
	<43A2146D.8040302@joreybump.com>
Message-ID: <43A21674.6050307@familiasanchez.net>

Jorey Bump wrote:
> 
> It's a double-edged sword, much like running CGI with suexec.
> 
> Be sure to limit the user so there are no important assets in the home 
> directory (like personal mail or private keys).
> 

So, what would be the best course of action in that case?  Put Maildirs 
in a common directory under /var?  Even then, that directory would still 
be writable by the user, just not under /home.  So, what's an admin to do?

-Roberto

-- 
Roberto C. Sanchez
http://familiasanchez.net/~roberto
From grahamd at dscpl.com.au  Thu Dec 15 21:37:11 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Dec 15 21:37:20 2005
Subject: [mod_python] Configuring mod_python via reverse proxy
Message-ID: <1134700631.366@dscpl.user.openhosting.com>

Roberto Sanchez wrote ..
> Graham Dumpleton wrote:
> 
> > If you are using mod_python.psp you will not, but if you use PythonHandler
> > to target a handler .py file in ~/public_html, or you are using mod_python
> > version 3.1.4 or older and mod_python.publisher, you can.
> > 
> > Graham
> > 
> 
> That makes me wonder if it is a Bad Idea(TM) to let apache run as the 
> user himself.  Is there an alternative there?  Originally, I was trying
> to avoid the problems encountered by using mod_python on a shared 
> machine.  This is similar to the problem with using mod_php on a shared
> machine, except that PHP has a safe mode (which I understand is not very
> safe at all).  Running separate instances of apache seems like the 
> better alternative in this case.  I am just wondering of problems that
> may occur by letting the web server run and then having write access to
> the document root.

So we know exactly where you are coming from, what do you understand
as being the "problems encountered by using mod_python on a shared
machine"?

There are indeed some issues, some of which can be partly resolved, but
would be good to know specifically which ones you are thinking of.

Graham
From list at joreybump.com  Thu Dec 15 21:55:44 2005
From: list at joreybump.com (Jorey Bump)
Date: Thu Dec 15 21:55:54 2005
Subject: [mod_python] Configuring mod_python via reverse proxy
In-Reply-To: <43A21674.6050307@familiasanchez.net>
References: <1134615675.29540@dscpl.user.openhosting.com>	<43A1DD42.6050605@familiasanchez.net>
	<43A2146D.8040302@joreybump.com>
	<43A21674.6050307@familiasanchez.net>
Message-ID: <43A22CB0.5050807@joreybump.com>

Roberto Sanchez wrote:
> Jorey Bump wrote:
> 
>> It's a double-edged sword, much like running CGI with suexec.
>>
>> Be sure to limit the user so there are no important assets in the home 
>> directory (like personal mail or private keys).
> 
> So, what would be the best course of action in that case?  Put Maildirs 
> in a common directory under /var?  Even then, that directory would still 
> be writable by the user, just not under /home.  So, what's an admin to do?

Well, in my case, I split mail and web onto different machines. On the 
web machine(s), each virtual host gets a dedicated user with home 
directory in /var/www/hosts. On the mail machine(s), accounts are 
assigned to people as needed. By default, nobody gets a shell (but I'll 
make a rare exception for some web users).

This separation is more secure and much easier to manage. Users are free 
to hire developers or transfer domains without putting email accounts at 
risk. The servers are more specialized, so the number of exposed 
services is reduced.

If you're limited to one machine, it's still a good idea to separate 
your mail users from your web users.


From roberto at familiasanchez.net  Thu Dec 15 22:02:58 2005
From: roberto at familiasanchez.net (Roberto Sanchez)
Date: Thu Dec 15 22:03:05 2005
Subject: [mod_python] Configuring mod_python via reverse proxy
In-Reply-To: <43A22CB0.5050807@joreybump.com>
References: <1134615675.29540@dscpl.user.openhosting.com>	<43A1DD42.6050605@familiasanchez.net>	<43A2146D.8040302@joreybump.com>	<43A21674.6050307@familiasanchez.net>
	<43A22CB0.5050807@joreybump.com>
Message-ID: <43A22E62.7030505@familiasanchez.net>

Jorey Bump wrote:
> 
> Well, in my case, I split mail and web onto different machines. On the 
> web machine(s), each virtual host gets a dedicated user with home 
> directory in /var/www/hosts. On the mail machine(s), accounts are 
> assigned to people as needed. By default, nobody gets a shell (but I'll 
> make a rare exception for some web users).
> 
> This separation is more secure and much easier to manage. Users are free 
> to hire developers or transfer domains without putting email accounts at 
> risk. The servers are more specialized, so the number of exposed 
> services is reduced.
> 
> If you're limited to one machine, it's still a good idea to separate 
> your mail users from your web users.

That makes sense.  So then, you could have user foo-web and foo-mail if 
you were confined to accounts on one machine.  I like the two machine 
approach, but that is not feasible for me at the moment.

-Roberto

-- 
Roberto C. Sanchez
http://familiasanchez.net/~roberto
From roberto at familiasanchez.net  Thu Dec 15 22:11:41 2005
From: roberto at familiasanchez.net (Roberto Sanchez)
Date: Thu Dec 15 22:11:45 2005
Subject: [mod_python] Configuring mod_python via reverse proxy
In-Reply-To: <1134700631.366@dscpl.user.openhosting.com>
References: <1134700631.366@dscpl.user.openhosting.com>
Message-ID: <43A2306D.9000905@familiasanchez.net>

Graham Dumpleton wrote:
> 
> So we know exactly where you are coming from, what do you understand
> as being the "problems encountered by using mod_python on a shared
> machine"?
> 
I was under the impression that there was the possibility of 
"cross-polution" by having different users' python scripts running under 
a single apache instance.

For example, from the Apache security tips:

"Embedded scripting options which run as part of the server itself, such 
as mod_php, mod_perl, mod_tcl, and mod_python, run under the identity of 
the server itself (see the User directive), and therefore scripts 
executed by these engines potentially can access anything the server 
user can. Some scripting engines may provide restrictions, but it is 
better to be safe and assume not."

> There are indeed some issues, some of which can be partly resolved, but
> would be good to know specifically which ones you are thinking of.
> 
> Graham
> 

Basically, I am concerned by what I read in these two threads:

http://www.modpython.org/pipermail/mod_python/2005-February/017297.html
http://www.modpython.org/pipermail/mod_python/2004-February/015059.html

-Roberto

-- 
Roberto C. Sanchez
http://familiasanchez.net/~roberto
From grahamd at dscpl.com.au  Thu Dec 15 23:02:49 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Dec 15 23:02:56 2005
Subject: [mod_python] Configuring mod_python via reverse proxy
Message-ID: <1134705769.21065@dscpl.user.openhosting.com>

Roberto Sanchez wrote ..
> Graham Dumpleton wrote:
> > 
> > So we know exactly where you are coming from, what do you understand
> > as being the "problems encountered by using mod_python on a shared
> > machine"?
> > 
> I was under the impression that there was the possibility of 
> "cross-polution" by having different users' python scripts running under
> a single apache instance.
> 
> For example, from the Apache security tips:
> 
> "Embedded scripting options which run as part of the server itself, such
> as mod_php, mod_perl, mod_tcl, and mod_python, run under the identity of
> the server itself (see the User directive), and therefore scripts 
> executed by these engines potentially can access anything the server 
> user can. Some scripting engines may provide restrictions, but it is 
> better to be safe and assume not."

Yes, except that there are really two issues here. The first as you
highlight is that all scripts run as the same user.

The bigger immediate problem is the potential cross pollution of Python
modules and the visibility of another users Python modules within the
executing process. This will occur where requests for each user are
handled within the context of one Python interpreter instance, which is
the default if both users requests are handled within the context of the
same virtual host.

With a bit of work, one could specify in the main Apache configuration
file that each user has a distinct interpreter using PythonInterpreter
directive, but there is no way of stopping the user changing it to
something else in .htaccess file, bar preventing the use of .htaccess
file altogether.

The consequence of this is that I could use PythonInterpreter to name
some other users interpreter and create special handlers that allowed
me to then browse all his loaded modules looking for senstive data
such as login details, or cached data out of a database etc.

What is really required in mod_python is a way for an administrator to
set PythonInterpreter in the main Apache configuration differently for
differently parts of the URL namespace and then set some other option
to say that it cannot be overridden in a .htaccess file at all.

This way the administrator has better control and can ensure some
seperation. I'm not sure though whether there is a means by which it
could be added to mod_python such that this could be done. Would need
some digging into the Apache internals.

This wouldn't solve the problem completely though, as the fact that
all users code runs as the same actual user, means that you could just
read the source code in direct as text and steal it that way. This means
someone is doing it deliberately, but at present with how mod_python
works, the cross pollution of in memory modules can lead to unexpected
behaviour without even trying. Hopefully mod_python 3.3 will solve this
with the module importing system being reimplemented.

So yes, your concerns are quite valid and no there aren't any simple
answers. :-(

Graham
From roberto at familiasanchez.net  Thu Dec 15 23:07:12 2005
From: roberto at familiasanchez.net (Roberto Sanchez)
Date: Thu Dec 15 23:07:20 2005
Subject: [mod_python] Configuring mod_python via reverse proxy
In-Reply-To: <1134705769.21065@dscpl.user.openhosting.com>
References: <1134705769.21065@dscpl.user.openhosting.com>
Message-ID: <43A23D70.7050200@familiasanchez.net>

Graham Dumpleton wrote:
> 
> Yes, except that there are really two issues here. The first as you
> highlight is that all scripts run as the same user.
> 
> The bigger immediate problem is the potential cross pollution of Python
> modules and the visibility of another users Python modules within the
> executing process. This will occur where requests for each user are
> handled within the context of one Python interpreter instance, which is
> the default if both users requests are handled within the context of the
> same virtual host.
> 
> With a bit of work, one could specify in the main Apache configuration
> file that each user has a distinct interpreter using PythonInterpreter
> directive, but there is no way of stopping the user changing it to
> something else in .htaccess file, bar preventing the use of .htaccess
> file altogether.
> 
> The consequence of this is that I could use PythonInterpreter to name
> some other users interpreter and create special handlers that allowed
> me to then browse all his loaded modules looking for senstive data
> such as login details, or cached data out of a database etc.
> 
> What is really required in mod_python is a way for an administrator to
> set PythonInterpreter in the main Apache configuration differently for
> differently parts of the URL namespace and then set some other option
> to say that it cannot be overridden in a .htaccess file at all.
> 
> This way the administrator has better control and can ensure some
> seperation. I'm not sure though whether there is a means by which it
> could be added to mod_python such that this could be done. Would need
> some digging into the Apache internals.
> 
> This wouldn't solve the problem completely though, as the fact that
> all users code runs as the same actual user, means that you could just
> read the source code in direct as text and steal it that way. This means
> someone is doing it deliberately, but at present with how mod_python
> works, the cross pollution of in memory modules can lead to unexpected
> behaviour without even trying. Hopefully mod_python 3.3 will solve this
> with the module importing system being reimplemented.
> 
> So yes, your concerns are quite valid and no there aren't any simple
> answers. :-(
> 
> Graham
> 

That is why I was attempting to get the mod_python behind a reverse 
proxy to work.  At least that way, the apache instance is running as the 
user that owns the python modules.  There are also implications there, 
but those are more easily solved.  In the future, I will try and go with 
a complete virtual server approach, but my machine's resources will not 
allow that now.

Anyhow, thanks for all the great insight.

-Roberto

-- 
Roberto C. Sanchez
http://familiasanchez.net/~roberto
From list at joreybump.com  Thu Dec 15 23:13:40 2005
From: list at joreybump.com (Jorey Bump)
Date: Thu Dec 15 23:13:47 2005
Subject: [mod_python] Configuring mod_python via reverse proxy
In-Reply-To: <43A2306D.9000905@familiasanchez.net>
References: <1134700631.366@dscpl.user.openhosting.com>
	<43A2306D.9000905@familiasanchez.net>
Message-ID: <43A23EF4.1050409@joreybump.com>

Roberto Sanchez wrote:
> Graham Dumpleton wrote:
> 
>>
>> So we know exactly where you are coming from, what do you understand
>> as being the "problems encountered by using mod_python on a shared
>> machine"?
>>
> I was under the impression that there was the possibility of 
> "cross-polution" by having different users' python scripts running under 
> a single apache instance.

Yes, that's true. But it's more of a risk when a team of developers 
share a virtual host. Each virtual host gets its own interpreter, so in 
a typical shared hosting situation (one developer per virtual host), a 
single apache instance is capable of providing enough separation to 
prevent namespace collisions with other mod_python users.

> For example, from the Apache security tips:
> 
> "Embedded scripting options which run as part of the server itself, such 
> as mod_php, mod_perl, mod_tcl, and mod_python, run under the identity of 
> the server itself (see the User directive), and therefore scripts 
> executed by these engines potentially can access anything the server 
> user can. Some scripting engines may provide restrictions, but it is 
> better to be safe and assume not."

And this is still true. Running your own apache instance addresses this 
point.

>> There are indeed some issues, some of which can be partly resolved, but
>> would be good to know specifically which ones you are thinking of.
>>
>> Graham
>>
> 
> Basically, I am concerned by what I read in these two threads:
> 
> http://www.modpython.org/pipermail/mod_python/2005-February/017297.html
> http://www.modpython.org/pipermail/mod_python/2004-February/015059.html

Some work has gone into addressing the way published modules are 
imported, to reduce or eliminate common namespace collisions. Besides 
that, most of the topics discussed in those threads still apply.

It's difficult to develop mod_python applications without some sort of 
adminstrative control over apache. Are you trying to find a way to make 
mod_python available to joeuser in a typical commercial web hosting 
environment, or to a team developing applications on a single company 
web server?

From roberto at familiasanchez.net  Thu Dec 15 23:21:09 2005
From: roberto at familiasanchez.net (Roberto Sanchez)
Date: Thu Dec 15 23:21:13 2005
Subject: [mod_python] Configuring mod_python via reverse proxy
In-Reply-To: <43A23EF4.1050409@joreybump.com>
References: <1134700631.366@dscpl.user.openhosting.com>	<43A2306D.9000905@familiasanchez.net>
	<43A23EF4.1050409@joreybump.com>
Message-ID: <43A240B5.2010202@familiasanchez.net>

Jorey Bump wrote:

> Some work has gone into addressing the way published modules are 
> imported, to reduce or eliminate common namespace collisions. Besides 
> that, most of the topics discussed in those threads still apply.
> 
> It's difficult to develop mod_python applications without some sort of 
> adminstrative control over apache. Are you trying to find a way to make 
> mod_python available to joeuser in a typical commercial web hosting 
> environment, or to a team developing applications on a single company 
> web server?

I am looking for a hosting environment.  I admin the apache server and 
will be hosting for some people that I know.  I personally trust them, 
but there is no sense in skimping on security.  The rest of the server 
is pretty well locked down, so I don't want to create a potential 
vulnerability.

-Roberto


-- 
Roberto C. Sanchez
http://familiasanchez.net/~roberto
From arnaudsj at emedialibrary.org  Thu Dec 15 23:30:12 2005
From: arnaudsj at emedialibrary.org (=?ISO-8859-1?Q?S=E9bastien_Arnaud?=)
Date: Thu Dec 15 23:30:18 2005
Subject: [mod_python] Apache processes "eating up" too much memory (leak?)
In-Reply-To: <1134688020.611@dscpl.user.openhosting.com>
References: <1134688020.611@dscpl.user.openhosting.com>
Message-ID: <828D4503-6F7C-452D-B9E3-0DEB0EA1A164@emedialibrary.org>

Thank you Graham and Jim for the pointers!

I guess I was directly affected by the bug in question in 3.1.4 !  
Since I was running 2 apps as virtual hosts, 10 PythonOption  
instructions per app, I also have 1 Load Balancer in front of those  
app servers making 1 request each minute to poll each app, it was  
making me loose 2x10x25 = 500 bytes / min !

As soon as 3.2 is golden, I will grab it and run it on our test farm  
before I push it out to our prod environment, sounds like 3.2 is full  
of sweet bug fix and enhancements! Any idea when it will be  
officially released?

Also, I noticed that Apache had released 2.2 officially, how does  
mod_python 3.2 handles this, will it work on apache 2.2? I am asking  
this, because I just did a port sync on my Mac and I just saw that  
apache 2.2 was already ready to replace my 2.0.55 install!

Thanks again for the help!

S?bastien Arnaud
eMedia Library, inc
sebastien@emedialibrary.org



On Dec 15, 2005, at 5:07 PM, Graham Dumpleton wrote:

> FWIW, you might consider upgrading to mod_python 3.2.5b if you can. I
> believe that that version eliminates a few memory leaks in certain
> circumstances in mod_python itself, although I don't remember the
> details. This may or may not be contributing. My understanding was  
> that
> the mod_python leaks weren't that great, but if you are handling a lot
> of requests it may be noticeable. You also may want to configure  
> Apache
> to recycle child processes after a certain number of requests to avoid
> overblown processes.
>
> Sorry, I know this doesn't really help with tracking down the  
> source of
> any problem if in your code. :-)
>
> Graham
>
> =?ISO-8859-1?Q?S=E9bastien_Arnaud?= wrote ..
>> Hello!
>>
>> I am running mod_python on 2 identical production server for 2 small
>> apps I wrote which basically render over 100 of different SVG charts.
>> I am running Gentoo on those servers, mod_python 3.1.4, apache 2.0.55
>> in prefork mode, each server has 1 Go of mem.
>>
>> Both applications have been in beta testing for like 1 month or so,
>> and I just noticed today that the memory usage was really high for
>> each apache process running (max of 10 set in the conf file). When I
>> started those apache process 30 days ago they stabilize at 2.0 % of
>> memory used, but somehow after 30 days of users testing the app, it
>> went to 10% per apache process, which made the swap usage go to 1Go
>> (over 2Go avail). I am doing quite a lot of caching of XSL files in
>> the app, but this is suppose to happen at launch time, meaning I
>> instantiate all the objects I need at the first call of the
>> mod_python handler and they persist through the life of those apache
>> processes. Does somebody know anyway to inspect each apache process
>> to see where the memory is being used? Basically I am trying here to
>> figure out if I have some kind of memory leak going on, or if there
>> is something I miscalculated when caching the large amount of XSL
>> files in persistent Python objects.
>>
>> Apart from that, those 2 little applications fly in terms of speed! A
>> lot of people (including me) got really blown away to witness the
>> speed of those 2 apps on those "old" servers (which are quad PIII
>> 550Mhz btw).
>>
>> Thank you in advance for any insights so that I can get to the bottom
>> of this!
>>
>> Cheers!
>>
>> S?bastien Arnaud
>> eMedia Library, inc
>> sebastien@emedialibrary.org
>>
>>
>>
>>
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python


From list at joreybump.com  Fri Dec 16 00:05:44 2005
From: list at joreybump.com (Jorey Bump)
Date: Fri Dec 16 00:05:51 2005
Subject: [mod_python] Apache processes "eating up" too much memory (leak?)
In-Reply-To: <828D4503-6F7C-452D-B9E3-0DEB0EA1A164@emedialibrary.org>
References: <1134688020.611@dscpl.user.openhosting.com>
	<828D4503-6F7C-452D-B9E3-0DEB0EA1A164@emedialibrary.org>
Message-ID: <43A24B28.7040907@joreybump.com>

S?bastien Arnaud wrote:

> Also, I noticed that Apache had released 2.2 officially, how does  
> mod_python 3.2 handles this, will it work on apache 2.2? I am asking  
> this, because I just did a port sync on my Mac and I just saw that  
> apache 2.2 was already ready to replace my 2.0.55 install!

See this article:

http://www.modpython.org/pipermail/mod_python/2005-December/019661.html

Stick with Apache 2.0.55, unless you are willing to troubleshoot the 
patch in the article.
From deron.meranda at gmail.com  Fri Dec 16 03:00:50 2005
From: deron.meranda at gmail.com (Deron Meranda)
Date: Fri Dec 16 03:00:58 2005
Subject: [mod_python] Using mod_python for auth only
In-Reply-To: <1134687085.23119@dscpl.user.openhosting.com>
References: <1134687085.23119@dscpl.user.openhosting.com>
Message-ID: <5c06fa770512160000n392cbbbcs3e8462a820a730b6@mail.gmail.com>

On 12/15/05, Graham Dumpleton <grahamd@dscpl.com.au> wrote:
> The mod_python authentication handler will not be called
> by default though, the Apache configuration has to be such as to
> cause it to be triggered. This generally requires AuthType directive,
> plus Require directive.

If you don't want to get Apache's Auth* directives involved,
you can use the PythonAccessHandler instead.  That request
phase occurs between the authentication and fixup phases,
and is called regardless of any require directives.  It's a bit
cheating, since authentication is not exactly the purpose of
that phase, but you can still use it as such with some
restrictions.
--
Deron Meranda

From nm at estadias.com  Fri Dec 16 05:13:03 2005
From: nm at estadias.com (nm@estadias.com)
Date: Fri Dec 16 05:13:10 2005
Subject: [mod_python] Problem installing mod_python
In-Reply-To: <43A1C4C0.9090800@joreybump.com>
References: <1134661348.43a18ee44aac9@webmail.estadias.com>
	<43A1A221.4080700@familiasanchez.net>
	<1134667240.43a1a5e8bf903@webmail.estadias.com>
	<43A1C4C0.9090800@joreybump.com>
Message-ID: <1134727983.43a2932f06a44@webmail.estadias.com>

Yes,
Ok, i removed the .htaccess and in apache2.conf:
<Directory /home/nm/public_html/python>
AddHandler python-program .py
PythonHandler mptest
PythonDebug On
</Directory>

And still don't work

Quoting Jorey Bump <list@joreybump.com>:

> nm@estadias.com wrote:
>
> > In my /home/nm/public_html/python/.htaccess:
> >
> > AllowOverride All
> > AddHandler mod_python .py
> > PythonHandler mptest
> > PythonDebug On
>
> AllowOverride is not legal in .htaccess, for obvious reasons:
>
>   http://httpd.apache.org/docs/2.0/mod/core.html#allowoverride
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>




----------------------------------------------------------------
This message was sent using IMP, the Internet Messaging Program.

From josh at janrain.com  Fri Dec 16 10:38:26 2005
From: josh at janrain.com (Josh Hoyt)
Date: Fri Dec 16 10:38:30 2005
Subject: [mod_python] Using mod_python for auth only
In-Reply-To: <5c06fa770512160000n392cbbbcs3e8462a820a730b6@mail.gmail.com>
References: <1134687085.23119@dscpl.user.openhosting.com>
	<5c06fa770512160000n392cbbbcs3e8462a820a730b6@mail.gmail.com>
Message-ID: <34714aad0512160738t1ff0fb4ax7118b9b5332fbbde@mail.gmail.com>

> If you don't want to get Apache's Auth* directives involved,
> you can use the PythonAccessHandler instead.  That request
> phase occurs between the authentication and fixup phases,
> and is called regardless of any require directives.  It's a bit
> cheating, since authentication is not exactly the purpose of
> that phase, but you can still use it as such with some
> restrictions.

That's much more what I was looking for. Although the access phase is
not intended for authentication, the extra directives that I had to
add to trigger the auth phase made the configuration misleading at
best. I had to add AuthType and Require, even though my handler did
not use them. I think this trick is a little bit cleaner.

--
Josh Hoyt

From list at joreybump.com  Fri Dec 16 11:02:22 2005
From: list at joreybump.com (Jorey Bump)
Date: Fri Dec 16 11:02:36 2005
Subject: [mod_python] Problem installing mod_python
In-Reply-To: <1134727983.43a2932f06a44@webmail.estadias.com>
References: <1134661348.43a18ee44aac9@webmail.estadias.com>
	<43A1A221.4080700@familiasanchez.net>
	<1134667240.43a1a5e8bf903@webmail.estadias.com>
	<43A1C4C0.9090800@joreybump.com>
	<1134727983.43a2932f06a44@webmail.estadias.com>
Message-ID: <43A2E50E.2040800@joreybump.com>

nm@estadias.com wrote:
> Yes,
> Ok, i removed the .htaccess and in apache2.conf:
> <Directory /home/nm/public_html/python>
> AddHandler python-program .py
> PythonHandler mptest
> PythonDebug On
> </Directory>
> 
> And still don't work

Is this in the VirtualHost container? Are you accessing the VirtualHost 
by name? Have you done whatever Debian needs you to do to load the 
module and enable mod_python? Does your error log show that mod_python 
is loading?
From nm at estadias.com  Fri Dec 16 13:11:59 2005
From: nm at estadias.com (nm@estadias.com)
Date: Fri Dec 16 13:12:07 2005
Subject: [mod_python] Problem installing mod_python
In-Reply-To: <43A2E50E.2040800@joreybump.com>
References: <1134661348.43a18ee44aac9@webmail.estadias.com>
	<43A1A221.4080700@familiasanchez.net>
	<1134667240.43a1a5e8bf903@webmail.estadias.com>
	<43A1C4C0.9090800@joreybump.com>
	<1134727983.43a2932f06a44@webmail.estadias.com>
	<43A2E50E.2040800@joreybump.com>
Message-ID: <1134756719.43a3036f7b0d0@webmail.estadias.com>


> Is this in the VirtualHost container? Are you accessing the VirtualHost
> by name? Have you done whatever Debian needs you to do to load the
> module and enable mod_python? Does your error log show that mod_python
> is loading?

Yes is a virtualhost and i'm accessing by virtualhost name.
And seems that mod_python is loaded successful.

For PHP i have:

AddType application/x-httpd-php .php
AddType application/x-httpd-php-source .phps

For the Python is not needed?


----------------------------------------------------------------
This message was sent using IMP, the Internet Messaging Program.

From list at joreybump.com  Fri Dec 16 15:07:09 2005
From: list at joreybump.com (Jorey Bump)
Date: Fri Dec 16 15:07:16 2005
Subject: [mod_python] Problem installing mod_python
In-Reply-To: <1134756719.43a3036f7b0d0@webmail.estadias.com>
References: <1134661348.43a18ee44aac9@webmail.estadias.com>
	<43A1A221.4080700@familiasanchez.net>
	<1134667240.43a1a5e8bf903@webmail.estadias.com>
	<43A1C4C0.9090800@joreybump.com>
	<1134727983.43a2932f06a44@webmail.estadias.com>
	<43A2E50E.2040800@joreybump.com>
	<1134756719.43a3036f7b0d0@webmail.estadias.com>
Message-ID: <43A31E6D.90204@joreybump.com>

nm@estadias.com wrote:
>>Is this in the VirtualHost container? Are you accessing the VirtualHost
>>by name? Have you done whatever Debian needs you to do to load the
>>module and enable mod_python? Does your error log show that mod_python
>>is loading?
> 
> Yes is a virtualhost and i'm accessing by virtualhost name.

OK, show us the whole VirtualHost container. How are you able to resolve 
   python.debian? Did you modify your client's hosts file, or are you 
running a local DNS server?

> And seems that mod_python is loaded successful.

Did you verify this in your error log (change the path if sarge logs 
elsewhere)?

  grep mod_python /var/log/apache/error.log

How are you enabling mod_python? Debian created their own scheme for 
enabling modules, which makes it even harder to get help. They use some 
custom a2enmod command. The "a" stands for "acid", I think. :)

> For PHP i have:
> 
> AddType application/x-httpd-php .php
> AddType application/x-httpd-php-source .phps
> 
> For the Python is not needed?

It's not even needed for PHP.





From grahamd at dscpl.com.au  Fri Dec 16 16:22:42 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Fri Dec 16 16:22:54 2005
Subject: [mod_python] Using mod_python for auth only
In-Reply-To: <5c06fa770512160000n392cbbbcs3e8462a820a730b6@mail.gmail.com>
References: <1134687085.23119@dscpl.user.openhosting.com>
	<5c06fa770512160000n392cbbbcs3e8462a820a730b6@mail.gmail.com>
Message-ID: <025C67BA-AF71-43F2-90DA-F3E42C1A9DD0@dscpl.com.au>


On 16/12/2005, at 7:00 PM, Deron Meranda wrote:

> On 12/15/05, Graham Dumpleton <grahamd@dscpl.com.au> wrote:
>
>> The mod_python authentication handler will not be called
>> by default though, the Apache configuration has to be such as to
>> cause it to be triggered. This generally requires AuthType directive,
>> plus Require directive.
>>
>
> If you don't want to get Apache's Auth* directives involved,
> you can use the PythonAccessHandler instead.  That request
> phase occurs between the authentication and fixup phases,
> and is called regardless of any require directives.  It's a bit
> cheating, since authentication is not exactly the purpose of
> that phase, but you can still use it as such with some
> restrictions.

I believe the access handler is actually called prior to authentication.

   http://httpd.apache.org/docs/2.0/developer/request.html

Sorry for being pedantic, but always like to see correct details posted
since this all gets archived for later searching... ;-)

Graham


From jpg at jgassociates.ca  Sat Dec 17 10:53:49 2005
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Sat Dec 17 10:50:08 2005
Subject: [mod_python] Apache processes "eating up" too much memory (leak?)
In-Reply-To: <828D4503-6F7C-452D-B9E3-0DEB0EA1A164@emedialibrary.org>
References: <1134688020.611@dscpl.user.openhosting.com>
	<828D4503-6F7C-452D-B9E3-0DEB0EA1A164@emedialibrary.org>
Message-ID: <43A4348D.6080807@jgassociates.ca>

S?bastien Arnaud wrote:
> Thank you Graham and Jim for the pointers!
> 
> I guess I was directly affected by the bug in question in 3.1.4 !  Since 
> I was running 2 apps as virtual hosts, 10 PythonOption  instructions per 
> app, I also have 1 Load Balancer in front of those  app servers making 1 
> request each minute to poll each app, it was  making me loose 2x10x25 = 
> 500 bytes / min !

That would do it. ;)

> As soon as 3.2 is golden, I will grab it and run it on our test farm  
> before I push it out to our prod environment, sounds like 3.2 is full  
> of sweet bug fix and enhancements! Any idea when it will be  officially 
> released?

The 3.2.5b has been out in the wild since Nov 15. We had planned on a 
final release this week, but fixing MODPYTHON-99 may mean another beta. 
Note that this issue likely existed in 3.1 as well, but was only 
recently found. Personally I wouldn't hesitate to start using 3.2.5b on 
your test farm.

See http://issues.apache.org/jira/browse/MODPYTHON-99 for details.

> Also, I noticed that Apache had released 2.2 officially, how does  
> mod_python 3.2 handles this, will it work on apache 2.2? I am asking  
> this, because I just did a port sync on my Mac and I just saw that  
> apache 2.2 was already ready to replace my 2.0.55 install!

As Jorey mentioned, mp 3.2 doesn't support apache 2.2. We made the 
decision a few months ago to defer apache 2.2 support to mod_python 3.3. 
At that time we actually thought we'd have 3.2 out before apache 2.2 was 
available. Oh well.... :(.

Jim

> Thanks again for the help!
> 
> S?bastien Arnaud
> eMedia Library, inc
> sebastien@emedialibrary.org
> 
> 
> 
> On Dec 15, 2005, at 5:07 PM, Graham Dumpleton wrote:
> 
>> FWIW, you might consider upgrading to mod_python 3.2.5b if you can. I
>> believe that that version eliminates a few memory leaks in certain
>> circumstances in mod_python itself, although I don't remember the
>> details. This may or may not be contributing. My understanding was  that
>> the mod_python leaks weren't that great, but if you are handling a lot
>> of requests it may be noticeable. You also may want to configure  Apache
>> to recycle child processes after a certain number of requests to avoid
>> overblown processes.
>>
>> Sorry, I know this doesn't really help with tracking down the  source of
>> any problem if in your code. :-)
>>
>> Graham
>>
>> =?ISO-8859-1?Q?S=E9bastien_Arnaud?= wrote ..
>>
>>> Hello!
>>>
>>> I am running mod_python on 2 identical production server for 2 small
>>> apps I wrote which basically render over 100 of different SVG charts.
>>> I am running Gentoo on those servers, mod_python 3.1.4, apache 2.0.55
>>> in prefork mode, each server has 1 Go of mem.
>>>
>>> Both applications have been in beta testing for like 1 month or so,
>>> and I just noticed today that the memory usage was really high for
>>> each apache process running (max of 10 set in the conf file). When I
>>> started those apache process 30 days ago they stabilize at 2.0 % of
>>> memory used, but somehow after 30 days of users testing the app, it
>>> went to 10% per apache process, which made the swap usage go to 1Go
>>> (over 2Go avail). I am doing quite a lot of caching of XSL files in
>>> the app, but this is suppose to happen at launch time, meaning I
>>> instantiate all the objects I need at the first call of the
>>> mod_python handler and they persist through the life of those apache
>>> processes. Does somebody know anyway to inspect each apache process
>>> to see where the memory is being used? Basically I am trying here to
>>> figure out if I have some kind of memory leak going on, or if there
>>> is something I miscalculated when caching the large amount of XSL
>>> files in persistent Python objects.
>>>
>>> Apart from that, those 2 little applications fly in terms of speed! A
>>> lot of people (including me) got really blown away to witness the
>>> speed of those 2 apps on those "old" servers (which are quad PIII
>>> 550Mhz btw).
>>>
>>> Thank you in advance for any insights so that I can get to the bottom
>>> of this!
>>>
>>> Cheers!
>>>
>>> S?bastien Arnaud
>>> eMedia Library, inc
>>> sebastien@emedialibrary.org
>>>
>>>
>>>
>>>
>>> _______________________________________________
>>> Mod_python mailing list
>>> Mod_python@modpython.org
>>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
> 
> 
> 

From nicolas.lehuen at gmail.com  Sat Dec 17 11:31:00 2005
From: nicolas.lehuen at gmail.com (Nicolas Lehuen)
Date: Sat Dec 17 11:31:05 2005
Subject: [mod_python] Apache processes "eating up" too much memory (leak?)
In-Reply-To: <43A4348D.6080807@jgassociates.ca>
References: <1134688020.611@dscpl.user.openhosting.com>
	<828D4503-6F7C-452D-B9E3-0DEB0EA1A164@emedialibrary.org>
	<43A4348D.6080807@jgassociates.ca>
Message-ID: <c298f2d70512170831l35aaefah@mail.gmail.com>

Just FYI, I've been using subversion HEAD version of mod_python for
months now of my production servers. I've been using the 3.2.5b
version as soon as we've released it, and I don't have any problem
with it.

Regards,
Nicolas

2005/12/17, Jim Gallacher <jpg@jgassociates.ca>:
> S?bastien Arnaud wrote:
> > Thank you Graham and Jim for the pointers!
> >
> > I guess I was directly affected by the bug in question in 3.1.4 !  Since
> > I was running 2 apps as virtual hosts, 10 PythonOption  instructions per
> > app, I also have 1 Load Balancer in front of those  app servers making 1
> > request each minute to poll each app, it was  making me loose 2x10x25 =
> > 500 bytes / min !
>
> That would do it. ;)
>
> > As soon as 3.2 is golden, I will grab it and run it on our test farm
> > before I push it out to our prod environment, sounds like 3.2 is full
> > of sweet bug fix and enhancements! Any idea when it will be  officially
> > released?
>
> The 3.2.5b has been out in the wild since Nov 15. We had planned on a
> final release this week, but fixing MODPYTHON-99 may mean another beta.
> Note that this issue likely existed in 3.1 as well, but was only
> recently found. Personally I wouldn't hesitate to start using 3.2.5b on
> your test farm.
>
> See http://issues.apache.org/jira/browse/MODPYTHON-99 for details.
>
> > Also, I noticed that Apache had released 2.2 officially, how does
> > mod_python 3.2 handles this, will it work on apache 2.2? I am asking
> > this, because I just did a port sync on my Mac and I just saw that
> > apache 2.2 was already ready to replace my 2.0.55 install!
>
> As Jorey mentioned, mp 3.2 doesn't support apache 2.2. We made the
> decision a few months ago to defer apache 2.2 support to mod_python 3.3.
> At that time we actually thought we'd have 3.2 out before apache 2.2 was
> available. Oh well.... :(.
>
> Jim
>
> > Thanks again for the help!
> >
> > S?bastien Arnaud
> > eMedia Library, inc
> > sebastien@emedialibrary.org
> >
> >
> >
> > On Dec 15, 2005, at 5:07 PM, Graham Dumpleton wrote:
> >
> >> FWIW, you might consider upgrading to mod_python 3.2.5b if you can. I
> >> believe that that version eliminates a few memory leaks in certain
> >> circumstances in mod_python itself, although I don't remember the
> >> details. This may or may not be contributing. My understanding was  that
> >> the mod_python leaks weren't that great, but if you are handling a lot
> >> of requests it may be noticeable. You also may want to configure  Apache
> >> to recycle child processes after a certain number of requests to avoid
> >> overblown processes.
> >>
> >> Sorry, I know this doesn't really help with tracking down the  source of
> >> any problem if in your code. :-)
> >>
> >> Graham
> >>
> >> =?ISO-8859-1?Q?S=E9bastien_Arnaud?= wrote ..
> >>
> >>> Hello!
> >>>
> >>> I am running mod_python on 2 identical production server for 2 small
> >>> apps I wrote which basically render over 100 of different SVG charts.
> >>> I am running Gentoo on those servers, mod_python 3.1.4, apache 2.0.55
> >>> in prefork mode, each server has 1 Go of mem.
> >>>
> >>> Both applications have been in beta testing for like 1 month or so,
> >>> and I just noticed today that the memory usage was really high for
> >>> each apache process running (max of 10 set in the conf file). When I
> >>> started those apache process 30 days ago they stabilize at 2.0 % of
> >>> memory used, but somehow after 30 days of users testing the app, it
> >>> went to 10% per apache process, which made the swap usage go to 1Go
> >>> (over 2Go avail). I am doing quite a lot of caching of XSL files in
> >>> the app, but this is suppose to happen at launch time, meaning I
> >>> instantiate all the objects I need at the first call of the
> >>> mod_python handler and they persist through the life of those apache
> >>> processes. Does somebody know anyway to inspect each apache process
> >>> to see where the memory is being used? Basically I am trying here to
> >>> figure out if I have some kind of memory leak going on, or if there
> >>> is something I miscalculated when caching the large amount of XSL
> >>> files in persistent Python objects.
> >>>
> >>> Apart from that, those 2 little applications fly in terms of speed! A
> >>> lot of people (including me) got really blown away to witness the
> >>> speed of those 2 apps on those "old" servers (which are quad PIII
> >>> 550Mhz btw).
> >>>
> >>> Thank you in advance for any insights so that I can get to the bottom
> >>> of this!
> >>>
> >>> Cheers!
> >>>
> >>> S?bastien Arnaud
> >>> eMedia Library, inc
> >>> sebastien@emedialibrary.org
> >>>
> >>>
> >>>
> >>>
> >>> _______________________________________________
> >>> Mod_python mailing list
> >>> Mod_python@modpython.org
> >>> http://mailman.modpython.org/mailman/listinfo/mod_python
> >>
> >> _______________________________________________
> >> Mod_python mailing list
> >> Mod_python@modpython.org
> >> http://mailman.modpython.org/mailman/listinfo/mod_python
> >
> >
> >
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>

From scott_list at mischko.com  Mon Dec 19 14:14:53 2005
From: scott_list at mischko.com (Scott Chapman)
Date: Mon Dec 19 14:15:05 2005
Subject: [mod_python] Where is the referrer found?
Message-ID: <43A706AD.3080701@mischko.com>

I searched the docs on mod_python and don't find a way to get the referrer, but 
it shows up in the Apache logs.  Where do I find it in mod_python?

Scott
From jpg at jgassociates.ca  Mon Dec 19 14:47:17 2005
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Mon Dec 19 14:45:54 2005
Subject: [mod_python] Where is the referrer found?
In-Reply-To: <43A706AD.3080701@mischko.com>
References: <43A706AD.3080701@mischko.com>
Message-ID: <43A70E45.4020001@jgassociates.ca>

Scott Chapman wrote:
> I searched the docs on mod_python and don't find a way to get the 
> referrer, but it shows up in the Apache logs.  Where do I find it in 
> mod_python?
> 

req.headers_in['referer']

Jim
From lists at tuxdoit.com  Mon Dec 19 19:26:09 2005
From: lists at tuxdoit.com (MARG)
Date: Mon Dec 19 19:26:15 2005
Subject: [mod_python] Can't start Apache with mod_python
Message-ID: <43A74FA1.2090704@tuxdoit.com>

Hi,

I'm trying to compile mod_python with Apache 2.2.0

After installing Apache, i install mod_python with:
./configure --with-apxs=/usr/local/httpd/bin/apxs

Now the problem: when i start Apache, it says:
Cannot load /usr/local/httpd/modules/mod_python.so into server:
/usr/local/httpd/modules/mod_python.so: undefined symbol:
APR_STATUS_IS_SUCCESS

and Apache doesn't start.

Any ideas ?

Any help would be apreciated.

Warm Regards,
MARG
From grahamd at dscpl.com.au  Mon Dec 19 19:43:08 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon Dec 19 19:43:11 2005
Subject: [mod_python] Can't start Apache with mod_python
Message-ID: <1135039388.15725@dscpl.user.openhosting.com>

Apache 2.2 is not yet supported. See:

  http://issues.apache.org/jira/browse/MODPYTHON-78

Specfically, it links to a mailing list posts\ which suggests changes to make
it work, but they need to be checked properly yet to see if they are correct.

Graham

MARG wrote ..
> Hi,
> 
> I'm trying to compile mod_python with Apache 2.2.0
> 
> After installing Apache, i install mod_python with:
> ./configure --with-apxs=/usr/local/httpd/bin/apxs
> 
> Now the problem: when i start Apache, it says:
> Cannot load /usr/local/httpd/modules/mod_python.so into server:
> /usr/local/httpd/modules/mod_python.so: undefined symbol:
> APR_STATUS_IS_SUCCESS
> 
> and Apache doesn't start.
> 
> Any ideas ?
> 
> Any help would be apreciated.
> 
> Warm Regards,
> MARG
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
From list at joreybump.com  Mon Dec 19 20:29:00 2005
From: list at joreybump.com (Jorey Bump)
Date: Mon Dec 19 20:29:24 2005
Subject: [mod_python] Can't start Apache with mod_python
In-Reply-To: <1135039388.15725@dscpl.user.openhosting.com>
References: <1135039388.15725@dscpl.user.openhosting.com>
Message-ID: <43A75E5C.8090700@joreybump.com>

Graham Dumpleton wrote:
> Apache 2.2 is not yet supported. See:
> 
>   http://issues.apache.org/jira/browse/MODPYTHON-78
> 
> Specfically, it links to a mailing list posts\ which suggests changes to make
> it work, but they need to be checked properly yet to see if they are correct.

I've attached the source tree patch. To apply the patch, move into the 
source code directory and issue the following command:

   patch -p1 < /path/to/mod_python-3.2.5b.patch

As Graham points out, the patch is not thoroughly tested, but it does 
indicate where the problems are. Consider it not ready for production 
use. Note that some of the tests will fail, but Apache will load the 
module. I've tested it with Publisher, and it seems to work.


-------------- next part --------------
diff -uNr mod_python-3.2.5b/src/connobject.c mod_python-3.2.5b.new/src/connobject.c
--- mod_python-3.2.5b/src/connobject.c	2005-11-12 13:59:35.000000000 -0500
+++ mod_python-3.2.5b.new/src/connobject.c	2005-12-03 15:26:27.000000000 -0500
@@ -78,12 +78,6 @@
     rc = ap_get_brigade(c->input_filters, bb, mode, APR_BLOCK_READ, bufsize);
     Py_END_ALLOW_THREADS;
 
-    if (! APR_STATUS_IS_SUCCESS(rc)) {
-        PyErr_SetObject(PyExc_IOError, 
-                        PyString_FromString("Connection read error"));
-        return NULL;
-    }
-
     /* 
      * loop through the brigade reading buckets into the string 
      */
@@ -312,24 +306,17 @@
  **
  *  utility func to make a socket address
  */
-
 static PyObject *makesockaddr(struct apr_sockaddr_t *addr)
-{
+{   
     PyObject *addrobj = makeipaddr(addr);
     PyObject *ret = NULL;
     if (addrobj) {
-        apr_port_t port;
-        if(apr_sockaddr_port_get(&port, addr)==APR_SUCCESS) {
-            ret = Py_BuildValue("Oi", addrobj, port );
-        }
-        else {
-            PyErr_SetString(PyExc_SystemError,"apr_sockaddr_port_get failure");
-        }
+        ret = Py_BuildValue("Oi", addrobj, ntohs(addr->sa.sin.sin_port));
         Py_DECREF(addrobj);
     }
     return ret;
 }
-
+    
 /**
  ** conn_getattr
  **
diff -uNr mod_python-3.2.5b/src/filterobject.c mod_python-3.2.5b.new/src/filterobject.c
--- mod_python-3.2.5b/src/filterobject.c	2004-11-25 17:10:52.000000000 -0500
+++ mod_python-3.2.5b.new/src/filterobject.c	2005-12-03 14:20:29.000000000 -0500
@@ -178,11 +178,6 @@
                                   APR_BLOCK_READ, self->readbytes);
         Py_END_ALLOW_THREADS;
 
-        if (!APR_STATUS_IS_EAGAIN(self->rc) && !APR_STATUS_IS_SUCCESS(self->rc)) {
-            PyErr_SetObject(PyExc_IOError, 
-                            PyString_FromString("Input filter read error"));
-            return NULL;
-        }
     }
 
     /* 
diff -uNr mod_python-3.2.5b/test/test.py mod_python-3.2.5b.new/test/test.py
--- mod_python-3.2.5b/test/test.py	2005-11-14 13:09:49.000000000 -0500
+++ mod_python-3.2.5b.new/test/test.py	2005-12-03 14:23:45.000000000 -0500
@@ -242,9 +242,9 @@
             PythonOption('PythonOptionTest sample_value'),
             DocumentRoot(DOCUMENT_ROOT),
             LoadModule("python_module %s" % MOD_PYTHON_SO),
-            IfModule("!mod_auth.c",
-                     LoadModule("auth_module %s" %
-                                quoteIfSpace(os.path.join(modpath, "mod_auth.so")))))
+            IfModule("!mod_auth_basic.c",
+                     LoadModule("auth_basic_module %s" %
+                                quoteIfSpace(os.path.join(modpath, "mod_auth_basic.so")))))
 
         f = open(CONFIG, "w")
         f.write(str(s))
From arnaudsj at emedialibrary.org  Wed Dec 21 00:31:32 2005
From: arnaudsj at emedialibrary.org (=?ISO-8859-1?Q?S=E9bastien_Arnaud?=)
Date: Wed Dec 21 00:31:43 2005
Subject: [mod_python] Bug in 3.2b5?
Message-ID: <500A7F54-1F54-43EA-B433-25FCC9A8F513@emedialibrary.org>

Hi,

I am running into a pretty bad crash of apache 2.0.55 under OS 10.4.3  
with mod_python 3.2b5 installed... Before I file a bug though, I  
would like to know if anybody else has noticed it.

I run the following code:
[..]
	req.content_type = "application/pdf"
    	req.sendfile("/tmp/test.pdf")

The file returned in my browser is empty (0K) and I see the following  
in the apache error_log:
[Tue Dec 20 23:20:04 2005] [notice] child pid 983 exit signal  
Segmentation fault (11)

I tested on my test server (PPC Linux running 3.1.4 and apache 2.0.55  
as well) and I don't witness the problem, the file is returned  
properly to the browser.

If somebody else is able to reproduce the problem, then I guess we  
should file a bug.

Thanks,

S?bastien



From grahamd at dscpl.com.au  Wed Dec 21 00:57:06 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Dec 21 00:57:12 2005
Subject: [mod_python] Bug in 3.2b5?
Message-ID: <1135144626.31929@dscpl.user.openhosting.com>


=?ISO-8859-1?Q?S=E9bastien_Arnaud?= wrote ..
> Hi,
> 
> I am running into a pretty bad crash of apache 2.0.55 under OS 10.4.3 
> with mod_python 3.2b5 installed... Before I file a bug though, I  
> would like to know if anybody else has noticed it.
> 
> I run the following code:
> [..]
> 	req.content_type = "application/pdf"
>     	req.sendfile("/tmp/test.pdf")
> 
> The file returned in my browser is empty (0K) and I see the following 
> in the apache error_log:
> [Tue Dec 20 23:20:04 2005] [notice] child pid 983 exit signal  
> Segmentation fault (11)

Are you saying it crashes in "req.sendfile()"? Does it crash on various
filles or just that one PDF file? How big is that PDF file? Can you send
the complete handler code, or is that it, bar returning of apache.OK?

It might also help if you go through procedure described in:

  http://www.modpython.org/pipermail/mod_python/2005-December/019735.html

to use gdb to find out exactly where it is crashing.

> I tested on my test server (PPC Linux running 3.1.4 and apache 2.0.55 
> as well) and I don't witness the problem, the file is returned  
> properly to the browser.
> 
> If somebody else is able to reproduce the problem, then I guess we  
> should file a bug.

Lets see if we can work out why first as logging a bug with just this
information isn't really going to help too much.

Graham
From arnaudsj at emedialibrary.org  Thu Dec 22 12:04:16 2005
From: arnaudsj at emedialibrary.org (=?ISO-8859-1?Q?S=E9bastien_Arnaud?=)
Date: Thu Dec 22 12:04:23 2005
Subject: [mod_python] Bug in 3.2b5?
In-Reply-To: <1135144626.31929@dscpl.user.openhosting.com>
References: <1135144626.31929@dscpl.user.openhosting.com>
Message-ID: <D5C01602-4D5C-498D-8A4B-DBD6C4299A3D@emedialibrary.org>

To follow up, nothing was wrong with mod_python. Somehow my apache  
conf file had changed and MaxClients was set to 1 in Prefork mode...  
And actually ANY requests to the server was failing... Anyway, sorry  
to have wasted anybody's time on this. I will make sure next time to  
only email the list after a good night of sleep and not past midnight ;)

On a side note, let me take the opportunity to say THANK YOU to all  
the people that make the mod_python community one of the best one  
around! Happy holidays to you all ! Can't wait for 3.2 final ;)

Cheers!

S?bastien


On Dec 20, 2005, at 11:57 PM, Graham Dumpleton wrote:

>
> =?ISO-8859-1?Q?S=E9bastien_Arnaud?= wrote ..
>> Hi,
>>
>> I am running into a pretty bad crash of apache 2.0.55 under OS 10.4.3
>> with mod_python 3.2b5 installed... Before I file a bug though, I
>> would like to know if anybody else has noticed it.
>>
>> I run the following code:
>> [..]
>> 	req.content_type = "application/pdf"
>>     	req.sendfile("/tmp/test.pdf")
>>
>> The file returned in my browser is empty (0K) and I see the following
>> in the apache error_log:
>> [Tue Dec 20 23:20:04 2005] [notice] child pid 983 exit signal
>> Segmentation fault (11)
>
> Are you saying it crashes in "req.sendfile()"? Does it crash on  
> various
> filles or just that one PDF file? How big is that PDF file? Can you  
> send
> the complete handler code, or is that it, bar returning of apache.OK?
>
> It might also help if you go through procedure described in:
>
>   http://www.modpython.org/pipermail/mod_python/2005-December/ 
> 019735.html
>
> to use gdb to find out exactly where it is crashing.
>
>> I tested on my test server (PPC Linux running 3.1.4 and apache 2.0.55
>> as well) and I don't witness the problem, the file is returned
>> properly to the browser.
>>
>> If somebody else is able to reproduce the problem, then I guess we
>> should file a bug.
>
> Lets see if we can work out why first as logging a bug with just this
> information isn't really going to help too much.
>
> Graham


From chase at oldben.llnl.gov  Thu Dec 22 12:11:51 2005
From: chase at oldben.llnl.gov (chase3@llnl.gov)
Date: Thu Dec 22 12:15:43 2005
Subject: [mod_python] pickle objects
Message-ID: <Pine.LNX.4.44.0512220910270.14307-100000@oldben.llnl.gov>

Still stuck using 
apache server is at 2.0.46; python 2.2.35 and mod_python-3.0.3-3.ent

I am using mod_python publisher and sending data to a separate server: 

Attempted to pickle data of the following type and pass
it through a socket to the server:

class Prop:
   def __init__ ( self, propName, propValue, propType ):
      self.propName = propName
      self.propValue = propValue
      self.propType = propType

but got the following error:

bugzi.llnl.gov:/home/chase/tracker/src[33] tracker-server.py &
[1] 3559
bugzi.llnl.gov:/home/chase/tracker/src[34] Traceback (most recent call last):
  File "tracker-server.py", line 468, in ?
    handleDBUpdate ( clientSocket )
  File "tracker-server.py", line 64, in handleDBUpdate
    d = cPickle.load ( f )
  File "tracker-receive.py", line 24, in ?
    from mod_python import apache
  File "/usr/src/build/513032-i386/install/usr/lib/python2.2/site-packages/mod_python/apache.py", line 67, in ?
ImportError: No module named _apache

I am wondering if this is connected to Graham's article on Issues with
Session Objects.

Thanks,
Lila

-- 
Lila Chase
lchase@llnl.gov

From grahamd at dscpl.com.au  Thu Dec 22 14:56:41 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Dec 22 14:56:52 2005
Subject: [mod_python] pickle objects
In-Reply-To: <Pine.LNX.4.44.0512220910270.14307-100000@oldben.llnl.gov>
References: <Pine.LNX.4.44.0512220910270.14307-100000@oldben.llnl.gov>
Message-ID: <EC3F5255-7C58-4C88-B86E-DB14CCF13FBC@dscpl.com.au>


On 23/12/2005, at 4:11 AM, chase3@llnl.gov wrote:

> Still stuck using
> apache server is at 2.0.46; python 2.2.35 and mod_python-3.0.3-3.ent
>
> I am using mod_python publisher and sending data to a separate server:
>
> Attempted to pickle data of the following type and pass
> it through a socket to the server:
>
> class Prop:
>    def __init__ ( self, propName, propValue, propType ):
>       self.propName = propName
>       self.propValue = propValue
>       self.propType = propType
>
> but got the following error:
>
> bugzi.llnl.gov:/home/chase/tracker/src[33] tracker-server.py &
> [1] 3559
> bugzi.llnl.gov:/home/chase/tracker/src[34] Traceback (most recent  
> call last):
>   File "tracker-server.py", line 468, in ?
>     handleDBUpdate ( clientSocket )
>   File "tracker-server.py", line 64, in handleDBUpdate
>     d = cPickle.load ( f )
>   File "tracker-receive.py", line 24, in ?
>     from mod_python import apache
>   File "/usr/src/build/513032-i386/install/usr/lib/python2.2/site- 
> packages/mod_python/apache.py", line 67, in ?
> ImportError: No module named _apache
>
> I am wondering if this is connected to Graham's article on Issues with
> Session Objects.

The question is, what were the types of the members of the instance  
of the above
class when you pickled it in the first place. The error suggests you  
tried to pickle
some data for which the class type was defined in or dependent on  
mod_python
specific modules. As a consequence, when you tried to unpickle them  
in the
separate application, it tried to load mod_python modules which isn't  
going to
work outside of mod_python running under Apache.

Graham
From downgrade at gmx.org  Thu Dec 22 23:36:58 2005
From: downgrade at gmx.org (Lars Eriksen)
Date: Thu Dec 22 23:35:53 2005
Subject: [mod_python] Default funtion values - memory leak?
Message-ID: <001601c6077a$8398c6b0$3701a8c0@targa>

I have the following configuration:

Apache/2.0.55 (Win32) mod_python/3.2.5b Python/2.4.2

And I have a function similar to

def foo(bar=[])

During the first request, bar is [].

When execution enters the function during the second request, however, and 
no value for bar is supplied, bar is *not* [] in the function body, but 
contains the previous value!

Is that in any way expected behaviour? 

From amand.tihon at alrj.org  Thu Dec 22 23:47:26 2005
From: amand.tihon at alrj.org (Amand Tihon)
Date: Thu Dec 22 23:47:11 2005
Subject: [mod_python] Default funtion values - memory leak?
In-Reply-To: <001601c6077a$8398c6b0$3701a8c0@targa>
References: <001601c6077a$8398c6b0$3701a8c0@targa>
Message-ID: <200512230547.33728.amand.tihon@alrj.org>

Le Vendredi 23 D?cembre 2005 05:36, Lars Eriksen a ?crit :
> I have the following configuration:
>
> Apache/2.0.55 (Win32) mod_python/3.2.5b Python/2.4.2
>
> And I have a function similar to
>
> def foo(bar=[])
>
> During the first request, bar is [].
>
> When execution enters the function during the second request, however, and
> no value for bar is supplied, bar is *not* [] in the function body, but
> contains the previous value!
>
> Is that in any way expected behaviour?

This is standard python behaviour.

You can find more informations on this subjet on 
http://docs.python.org/tut/node6.html#SECTION006710000000000000000

-- 
Amand Tihon
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20051223/d6c01202/attachment.bin
From python_eager at yahoo.com  Fri Dec 23 00:16:17 2005
From: python_eager at yahoo.com (python eager)
Date: Fri Dec 23 00:16:19 2005
Subject: [mod_python] wanted database programs
Message-ID: <20051223051617.76657.qmail@web36407.mail.mud.yahoo.com>

Hi
    i want sample program of database connectivty using python. in this program we should add all the values in the form like(textbox,listbox,textarea,checkbox,option., etc). please send sample program regarding his. 
   
  Environment :
   
  Database : oracle 9i
  python = 2.4.2
  Webware=0.9
  Editor = Python Shell
   
  regards
  Hari

		
---------------------------------
Yahoo! for Good - Make a difference this year. 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20051222/ca44d805/attachment.html
From downgrade at gmx.org  Fri Dec 23 03:51:46 2005
From: downgrade at gmx.org (Lars Eriksen)
Date: Fri Dec 23 03:50:36 2005
Subject: [mod_python] Default funtion values - memory leak?
References: <001601c6077a$8398c6b0$3701a8c0@targa>
	<200512230547.33728.amand.tihon@alrj.org>
Message-ID: <001701c6079e$1bf92da0$3701a8c0@targa>

Thank you!

----- Original Message ----- 
From: "Amand Tihon" <amand.tihon@alrj.org>
To: <mod_python@modpython.org>
Sent: Friday, December 23, 2005 5:47 AM
Subject: Re: [mod_python] Default funtion values - memory leak?


> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From jim.steil at customcall.com  Fri Dec 23 10:44:56 2005
From: jim.steil at customcall.com (Jim Steil)
Date: Fri Dec 23 10:43:48 2005
Subject: [mod_python] Newbie - Development tools
Message-ID: <43AC1B78.7000602@customcall.com>

I'm new to mod-python and am wondering what development tools people are 
using?  I am using psp templates and am looking for a good html editor 
and preferably one that would include a nice python editor.  Does such a 
tool exist?  I'm thinking of something like Dreamweaver for python.  
What are people using?  So far, I'm using HTMLPad and SPE or PythonWin, 
but would prefer one integrated tool.

    -Jim

-- 
Jim Steil
VP of Application Development
CustomCall Data Systems
(608) 274-3009 x286
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20051223/8bb43a83/attachment.html
From roberto at familiasanchez.net  Fri Dec 23 11:27:21 2005
From: roberto at familiasanchez.net (Roberto Sanchez)
Date: Fri Dec 23 11:27:28 2005
Subject: [mod_python] Newbie - Development tools
In-Reply-To: <43AC1B78.7000602@customcall.com>
References: <43AC1B78.7000602@customcall.com>
Message-ID: <43AC2569.3090001@familiasanchez.net>

Jim Steil wrote:
> I'm new to mod-python and am wondering what development tools people are 
> using?  I am using psp templates and am looking for a good html editor 
> and preferably one that would include a nice python editor.  Does such a 
> tool exist?  I'm thinking of something like Dreamweaver for python.  
> What are people using?  So far, I'm using HTMLPad and SPE or PythonWin, 
> but would prefer one integrated tool.

Vim would fit the bill nicely.  You can even customize your syntax 
highlighting, which have done for when I am editing PSPs.

-Roberto

-- 
Roberto C. Sanchez
http://familiasanchez.net/~roberto
From grisha at modpython.org  Fri Dec 23 12:25:21 2005
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Dec 23 12:25:25 2005
Subject: [mod_python] Newbie - Development tools
In-Reply-To: <43AC2569.3090001@familiasanchez.net>
References: <43AC1B78.7000602@customcall.com>
	<43AC2569.3090001@familiasanchez.net>
Message-ID: <20051223122323.I59915@grisha.dyndns.org>



On Fri, 23 Dec 2005, Roberto Sanchez wrote:

> Vim would fit the bill nicely.  You can even customize your syntax 
> highlighting, which have done for when I am editing PSPs.

Yep, lots of folks use vim. I use emacs - the Python mode is great. It 
doesn't do anything special for PSP, just treats it like HTML, but I 
consider that a feature because it discourages you from putting too much 
code inside a PSP file ;)

Grisha
From jim.steil at customcall.com  Fri Dec 23 12:40:22 2005
From: jim.steil at customcall.com (Jim Steil)
Date: Fri Dec 23 12:39:12 2005
Subject: [mod_python] Newbie - Development tools
In-Reply-To: <20051223122323.I59915@grisha.dyndns.org>
References: <43AC1B78.7000602@customcall.com>
	<43AC2569.3090001@familiasanchez.net>
	<20051223122323.I59915@grisha.dyndns.org>
Message-ID: <43AC3686.8090508@customcall.com>

I know that I can use any number of different editors that are 'Ok' for 
the job, or even 1/2 of the job.  What I'm looking for is ONE editor 
that is good at both Python and HTML (syntax highlighting, code 
completion, etc) all in one tool.  The way I've got my stuff coded, 
there isn't one bit of python in my HTML pages and only a tiny bit of 
HTML in my Python scripts that I'm passing back to the HTML template.  
I'd like to be able to setup something like a 'project' in an IDE that 
let me click on any of the files there and edit them.  I'd like to be 
able to preview the html as I build it without having to jump to a 
browser.  I'd like to drag-n-drop some html tags onto a palette and have 
it generate code.  But, I don't want to use something as bulky as 
Eclipse.  Any ideas.  I appreciate the input already given, but am 
looking for something a bit more all-encompassing.

    -Jim

Jim Steil
VP of Application Development
CustomCall Data Systems
(608) 274-3009 x286


Gregory (Grisha) Trubetskoy wrote:
>
>
> On Fri, 23 Dec 2005, Roberto Sanchez wrote:
>
>> Vim would fit the bill nicely.  You can even customize your syntax 
>> highlighting, which have done for when I am editing PSPs.
>
> Yep, lots of folks use vim. I use emacs - the Python mode is great. It 
> doesn't do anything special for PSP, just treats it like HTML, but I 
> consider that a feature because it discourages you from putting too 
> much code inside a PSP file ;)
>
> Grisha
> .
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20051223/76cb0948/attachment.html
From nick at dd.revealed.net  Fri Dec 23 18:52:25 2005
From: nick at dd.revealed.net (Nick)
Date: Fri Dec 23 18:52:35 2005
Subject: [mod_python] Newbie - Development tools
In-Reply-To: <20051223122323.I59915@grisha.dyndns.org>
References: <43AC1B78.7000602@customcall.com>	<43AC2569.3090001@familiasanchez.net>
	<20051223122323.I59915@grisha.dyndns.org>
Message-ID: <43AC8DB9.3010502@dd.revealed.net>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

For emacs, I've used multi-mode to edit mixed Python/HTML or whatnot.
You can tell it to use HTML as the major mode for PSP files, for
example, and look for start and end markers for the embedded Python as a
submode.

Nick

Gregory (Grisha) Trubetskoy wrote:
|
|
| On Fri, 23 Dec 2005, Roberto Sanchez wrote:
|
|> Vim would fit the bill nicely.  You can even customize your syntax
|> highlighting, which have done for when I am editing PSPs.
|
|
| Yep, lots of folks use vim. I use emacs - the Python mode is great. It
| doesn't do anything special for PSP, just treats it like HTML, but I
| consider that a feature because it discourages you from putting too much
| code inside a PSP file ;)
|
| Grisha
| _______________________________________________
| Mod_python mailing list
| Mod_python@modpython.org
| http://mailman.modpython.org/mailman/listinfo/mod_python
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.1 (GNU/Linux)

iD8DBQFDrI25v4zJ7LQ+i84RAqCrAKCnBHQx5k5xh/uFKJ9vrb1SyKwAKgCeKaXO
qEc9dEpC/b/LhD7rjd0CVN8=
=EmVo
-----END PGP SIGNATURE-----
From downgrade at gmx.org  Sat Dec 24 04:01:35 2005
From: downgrade at gmx.org (Lars Eriksen)
Date: Sat Dec 24 03:59:45 2005
Subject: [mod_python] Newbie - Development tools
References: <43AC1B78.7000602@customcall.com>
Message-ID: <001b01c60868$a55fd560$3701a8c0@targa>

Wing IDE  (which allows you to debug mod_python apps) + Dreamweaver.

----- Original Message ----- 
From: Jim Steil
To: mod_python@modpython.org
Sent: Friday, December 23, 2005 4:44 PM
Subject: [mod_python] Newbie - Development tools


I'm new to mod-python and am wondering what development tools people are 
using?  I am using psp templates and am looking for a good html editor and 
preferably one that would include a nice python editor.  Does such a tool 
exist?  I'm thinking of something like Dreamweaver for python.  What are 
people using?  So far, I'm using HTMLPad and SPE or PythonWin, but would 
prefer one integrated tool.

    -Jim


-- 
Jim Steil
VP of Application Development
CustomCall Data Systems
(608) 274-3009 x286



_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://mailman.modpython.org/mailman/listinfo/mod_python 

From bluszcz at jabberpl.org  Mon Dec 26 12:44:48 2005
From: bluszcz at jabberpl.org (Rafal Zawadzki)
Date: Mon Dec 26 12:45:05 2005
Subject: [mod_python] Problem with PythonImport
Message-ID: <200512261844.49069.bluszcz@jabberpl.org>

Hi. At the beginning I have to say that I read:

* thread called "PythonImport: Can someone please draw a diagram for this 
idiot?" and others similar ;>
* documentation about PythonImport

I am writing web application using modpython 3.1 + psp. I am using apache2, my 
apache2.conf contains:

PythonImport Baza glam.idoru
PythonOptimize on

and file of my virtual host contains:

<Directory /home/bluszcz/www/glam.idoru>
DirectoryIndex index.psp index.html
AddHandler mod_python .psp
PythonHandler mod_python.psp
PythonDebug On
PythonPath "sys.path+['/home/bluszcz/www/glam.idoru']"
AllowOverride None
</Directory>

cat testimport.py

<%
req.write(str(dir()))
req.write("<br />")
req.write(str(req.interpreter))
%>


links -dump http://glam.idoru/admin/testimport.psp

gives me:

['FileCache', 'HitsCache', 'PSP', 'PSPInterface', 'Session', '__builtins__', 
'__doc__', '__file__', '__mtime__', '__name__', '_apache', '_psp', 'anydbm', 
'apache', 'code2str', 'dbm_cache_get', 'dbm_cache_store', 'dbm_cache_type', 
'dbm_types', 'escape', 'form', 'handler', 'marshal', 'mem_fcache', 
'mem_scache', 'new', 'os', 'parse', 'parsestring', 'path_split', 'psp', 
'req', 'session', 'str2code', 'sys', 'tempdir', 'tempfile', 'util', 
'whichdb']
glam.idoru


My question is how can I get to my "Baza" module? I am trying to use it with 
persisten database connection (there is no enough docs about it!). Module 
Baza is has been loaded (i tried to put into this command creating dir, and 
it works).

Thanks and cheers, 

-- 
Rafa? Zawadzki [jid/mail: bluszcz@jabberpl.org, skype: blvszcz]

From grahamd at dscpl.com.au  Mon Dec 26 22:56:36 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon Dec 26 22:56:56 2005
Subject: [mod_python] Problem with PythonImport
In-Reply-To: <200512261844.49069.bluszcz@jabberpl.org>
References: <200512261844.49069.bluszcz@jabberpl.org>
Message-ID: <7649D876-03FA-4889-A2A5-64444E81CBFF@dscpl.com.au>

You still need to import your module in your PSP code. All the  
PythonImport
statement does is preload the module prior to any request being handled
such that code with side effects can be done early. Just like any  
other Python
module, it has to use "import" statement to import anything it wants  
to use,
even if already imported by some other separate module/code. More  
comments
below.

On 27/12/2005, at 4:44 AM, Rafal Zawadzki wrote:

> Hi. At the beginning I have to say that I read:
>
> * thread called "PythonImport: Can someone please draw a diagram  
> for this
> idiot?" and others similar ;>
> * documentation about PythonImport
>
> I am writing web application using modpython 3.1 + psp. I am using  
> apache2, my
> apache2.conf contains:
>
> PythonImport Baza glam.idoru
> PythonOptimize on
>
> and file of my virtual host contains:
>
> <Directory /home/bluszcz/www/glam.idoru>
> DirectoryIndex index.psp index.html
> AddHandler mod_python .psp
> PythonHandler mod_python.psp
> PythonDebug On
> PythonPath "sys.path+['/home/bluszcz/www/glam.idoru']"
> AllowOverride None
> </Directory>
>
> cat testimport.py
>
> <%

import Baza

> req.write(str(dir()))
> req.write("<br />")
> req.write(str(req.interpreter))
> %>
>
>
> links -dump http://glam.idoru/admin/testimport.psp
>
> gives me:
>
> ['FileCache', 'HitsCache', 'PSP', 'PSPInterface', 'Session',  
> '__builtins__',
> '__doc__', '__file__', '__mtime__', '__name__', '_apache', '_psp',  
> 'anydbm',
> 'apache', 'code2str', 'dbm_cache_get', 'dbm_cache_store',  
> 'dbm_cache_type',
> 'dbm_types', 'escape', 'form', 'handler', 'marshal', 'mem_fcache',
> 'mem_scache', 'new', 'os', 'parse', 'parsestring', 'path_split',  
> 'psp',
> 'req', 'session', 'str2code', 'sys', 'tempdir', 'tempfile', 'util',
> 'whichdb']
> glam.idoru
>
>
> My question is how can I get to my "Baza" module? I am trying to  
> use it with
> persisten database connection (there is no enough docs about it!).  
> Module
> Baza is has been loaded (i tried to put into this command creating  
> dir, and
> it works).

There are downsides to using PythonImport to initialise database  
connections
as a side effect. Namely, if it fails, if you don't have fallback  
means of having the
database connections initialised, you have to restart Apache. Thus,  
you need
to make sure you do it properly.

See mailing list threads:

   http://www.modpython.org/pipermail/mod_python/2005-October/ 
019287.html
   http://www.modpython.org/pipermail/mod_python/2005-September/ 
019092.html

Also be aware that current versions of mod_python have various issues  
with
module importing in general, see:

   http://www.dscpl.com.au/articles/modpython-003.html

Graham

  
  
From fabianosidler at gmail.com  Wed Dec 28 15:53:13 2005
From: fabianosidler at gmail.com (Fabiano Sidler)
Date: Wed Dec 28 15:53:18 2005
Subject: [mod_python] Collecting GET and POST vars
Message-ID: <d3d66b1c0512281253p7b009c6r@mail.gmail.com>

Hi folks!

I know I could use req.the_request[1] and req.read() for gathering
such data, but isn't there any other (easier) way to get a
dictionary-like object with both GET and POST variables created? I
have found solutions using the publisher handler, but I'd need it for
general handlers.

Greetings,
fips

From grahamd at dscpl.com.au  Wed Dec 28 17:15:42 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Dec 28 17:15:48 2005
Subject: [mod_python] Collecting GET and POST vars
Message-ID: <1135808142.3963@dscpl.user.openhosting.com>

See documentation:

  http://www.modpython.org/live/current/doc-html/pyapi-util-fstor.html
  http://www.modpython.org/live/current/doc-html/pyapi-util-fstor-fld.html

Look at source code for mod_python.publisher to see how it uses it if
you need to.

Graham

Fabiano Sidler wrote ..
> Hi folks!
> 
> I know I could use req.the_request[1] and req.read() for gathering
> such data, but isn't there any other (easier) way to get a
> dictionary-like object with both GET and POST variables created? I
> have found solutions using the publisher handler, but I'd need it for
> general handlers.
> 
> Greetings,
> fips
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
From fabianosidler at gmail.com  Wed Dec 28 18:17:22 2005
From: fabianosidler at gmail.com (Fabiano Sidler)
Date: Wed Dec 28 18:17:26 2005
Subject: [mod_python] Collecting GET and POST vars
In-Reply-To: <1135808142.3963@dscpl.user.openhosting.com>
References: <1135808142.3963@dscpl.user.openhosting.com>
Message-ID: <d3d66b1c0512281517r600fc33ck@mail.gmail.com>

Oh, that fast? Thank you lots! :)

Graham Dumpleton <grahamd@dscpl.com.au> wrote:
>   http://www.modpython.org/live/current/doc-html/pyapi-util-fstor.html
>   http://www.modpython.org/live/current/doc-html/pyapi-util-fstor-fld.html

Doh! I read the doc, but did not give enough attention to it for
realising, that this is exactly what I needed. Sorry...! ;-)

Best wishes!
Fips

From fabianosidler at gmail.com  Thu Dec 29 17:05:45 2005
From: fabianosidler at gmail.com (Fabiano Sidler)
Date: Thu Dec 29 17:05:49 2005
Subject: [mod_python] File upload with no publisher handler
Message-ID: <d3d66b1c0512291405g174b3c06k@mail.gmail.com>

Hi folks!

I worked on implementing file upload through a form with an input of
type "file". The form data is sent to the server, but the type of the
file field is "text/plain", and it doesn't have an associated file
object from which I could read. What could I have done wrong? As
mentioned in the subject. I don't have the possibility to use the
publisher handler.

Thanks for reply!
Greetings,
fips

From grahamd at dscpl.com.au  Thu Dec 29 17:25:11 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Dec 29 17:25:19 2005
Subject: [mod_python] File upload with no publisher handler
Message-ID: <1135895111.10439@dscpl.user.openhosting.com>

Fabiano Sidler wrote ..
> Hi folks!
> 
> I worked on implementing file upload through a form with an input of
> type "file". The form data is sent to the server, but the type of the
> file field is "text/plain", and it doesn't have an associated file
> object from which I could read. What could I have done wrong? As
> mentioned in the subject. I don't have the possibility to use the
> publisher handler.

What exactly does the HTML of the form you are using to perform the
upload contain? Post the HTML here and people can see whether it is
correct or not as a start.

Graham
From fabianosidler at gmail.com  Thu Dec 29 18:01:03 2005
From: fabianosidler at gmail.com (Fabiano Sidler)
Date: Thu Dec 29 18:01:07 2005
Subject: [mod_python] File upload with no publisher handler
In-Reply-To: <1135895111.10439@dscpl.user.openhosting.com>
References: <1135895111.10439@dscpl.user.openhosting.com>
Message-ID: <d3d66b1c0512291501t4bc4de4dt@mail.gmail.com>

PEBKAC! :(
I forgot to add the enctype="multipart/form-data" to the form declaration!
The work I do would be much easier and more straight forward if not
done by an narrow-gauge programmer...;)

Thank you for your work!
Best wishes,
Fips

