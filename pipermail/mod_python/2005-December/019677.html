<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Getting request object
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Getting%20request%20object&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019676.html">
   <LINK REL="Next"  HREF="019678.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Getting request object</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Getting%20request%20object&In-Reply-To="
       TITLE="[mod_python] Getting request object">grahamd at dscpl.com.au
       </A><BR>
    <I>Tue Dec  6 17:53:58 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="019676.html">[mod_python] How check permissions to GET JPG image
</A></li>
        <LI>Next message: <A HREF="019678.html">[mod_python] Getting request object
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19677">[ date ]</a>
              <a href="thread.html#19677">[ thread ]</a>
              <a href="subject.html#19677">[ subject ]</a>
              <a href="author.html#19677">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Going back to your original email ....

Radek =?iso-8859-2?q?Barto=F2?= wrote ..
&gt;<i> Hello.
</I>&gt;<i> I like using mod_python's mod_python.publisher like this:
</I>&gt;<i> 
</I>&gt;<i> class MyClass:
</I>&gt;<i>   def __init__(self):
</I>&gt;<i>     # can I get request object here?
</I>&gt;<i>     ...
</I>&gt;<i>   def __str__(self):
</I>&gt;<i>     ...
</I>&gt;<i>   def method1(self, req):
</I>&gt;<i>     ...
</I>&gt;<i>   def method2(self, req):
</I>&gt;<i>     ...
</I>&gt;<i> 
</I>&gt;<i> # or can I get request object here and pass it to MyClass's constructor?
</I>&gt;<i> index = MyClass():
</I>&gt;<i> ...
</I>
If what it is that you want is that an instance of MyClass be created
specific for each request, before any URL mapping against methods is
being done, then using mod_python.publisher alone the answer is that no
it cannot be done easily. Unless my brain is overlooking something
obvious, you have to do something convoluted like:

from mod_python import util, apache

import types

class Wrapper:
  
  def __init__(self,function):
    self.__class = function.im_class
    self.__name = function.im_func.__name__

  def __call__(self,req):
    instance = self.__class(req)
    function = getattr(instance,self.__name)
    return util.apply_fs_data(function,req.form)

class MyClass:

  def __init__(self,req):
    self.__req = req

  def method1(self):
    return &quot;method1&quot;

  def method2(self):
    return &quot;method2&quot;

class Object: pass

index = Object()
index.method1 = Wrapper(MyClass.method1)
index.method2 = Wrapper(MyClass.method2)

Apart from that, if you were using Vampire, you could simply use basic
handlers are write:

import vampire

class MyClass:

  def __init__(self,req):
    self.__req = req

  def __call__(self):
    return &quot;__call__&quot;

  def method1(self):
    return &quot;method1&quot;,self.__req.filename

  def method2(self, req):
    return &quot;method2&quot;,req.filename

handler = vampire.Publisher(MyClass)

The vampire.Publisher() wrapper class handlers both creating an instance
of the class and mapping URLs onto methods of the instance. It only
supports callable methods in classes though. Ie., it will not map URLs
to __str__() or to basic data types which are a member of the class.

Note that creating an instance of a class per request could be quite
inefficient. What is the original reason that you wanted to access the
request object in the constructor in the first place?

Graham




</PRE>

























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019676.html">[mod_python] How check permissions to GET JPG image
</A></li>
	<LI>Next message: <A HREF="019678.html">[mod_python] Getting request object
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19677">[ date ]</a>
              <a href="thread.html#19677">[ thread ]</a>
              <a href="subject.html#19677">[ subject ]</a>
              <a href="author.html#19677">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
