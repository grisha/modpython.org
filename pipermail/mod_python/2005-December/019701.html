<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Why can't  psycopg2 beta adapt this:
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Why%20can%27t%20%20psycopg2%20beta%20adapt%20this%3A&In-Reply-To=43991B82.3050401%40mischko.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019694.html">
   <LINK REL="Next"  HREF="019714.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Why can't  psycopg2 beta adapt this:</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Daniel J. Popowich</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Why%20can%27t%20%20psycopg2%20beta%20adapt%20this%3A&In-Reply-To=43991B82.3050401%40mischko.com"
       TITLE="[mod_python] Why can't  psycopg2 beta adapt this:">dpopowich at comcast.net
       </A><BR>
    <I>Fri Dec  9 12:20:50 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="019694.html">[mod_python] Why can't  psycopg2 beta adapt this:
</A></li>
        <LI>Next message: <A HREF="019714.html">[mod_python] Why can't  psycopg2 beta adapt this:
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19701">[ date ]</a>
              <a href="thread.html#19701">[ thread ]</a>
              <a href="subject.html#19701">[ subject ]</a>
              <a href="author.html#19701">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Scott Chapman writes:
&gt;<i> Mod_Python has a StringField class and psycopg2 can't seem to adapt it 
</I>&gt;<i> correctly. Type(stringfield_string) shows as:
</I>&gt;<i> &lt;class 'mod_python.util.StringField'&gt;
</I>&gt;<i> 
</I>&gt;<i> Strings of this class have 3 extra items in dir(stringfield_string) which 
</I>&gt;<i> regular strins don't have:
</I>&gt;<i> '__dict__', '__module__', 'value'
</I>&gt;<i> 
</I>&gt;<i> Here's the class definition from mod_python.util:
</I>&gt;<i> class StringField(str):
</I>&gt;<i>     &quot;&quot;&quot; This class is basically a string with
</I>&gt;<i>     a value attribute for compatibility with std lib cgi.py
</I>&gt;<i>     &quot;&quot;&quot;
</I>&gt;<i> 
</I>&gt;<i>     def __init__(self, str=&quot;&quot;):
</I>&gt;<i>         str.__init__(self, str)
</I>&gt;<i>         self.value = self.__str__()
</I>&gt;<i>
</I>&gt;<i> How do I make psycopg2 deal with these correctly?  It seems like
</I>&gt;<i> there's a way to make custom &quot;adapters&quot; but I'm rather clueless
</I>&gt;<i> here.  I just need psycopg2 to run str() on the StringField instance
</I>&gt;<i> and it'd work great.
</I>
This is a pain, I know.  I use psycopg extensively and have been
burned more than once.  There's nothing you can really do at the
psycopg module (afaik), but it's easy enough in your code...you can do
one of a few things:

  1. a pain, but use str() explicitly.

  2. build your query strings using python string formatting, instead
     of the parameters of the cursor.execute() method.  E.g.:

       cur.execute(&quot;insert into mytable (col1, col5)
                    values ('%s', %d)&quot; % (some_str, some_int))

     the %s will automatically call __str__() if some_str is not a
     str.

  3. Are you still using mpservlets? (you were at one time)  If you
     use query_vars to process your forms, your instance variables are
     converted to str automagically.  In the attached servlet,
     types.mps, if you call it with: types?field=abc&amp;realstr=def the
     output will be:

	  field: abc
	  type(field): &lt;class 'mod_python.util.StringField'&gt;
	  realstr: def
	  type(realstr): &lt;type 'str'&gt;


Cheers,

Daniel Popowich
---------------
<A HREF="http://home.comcast.net/~d.popowich/mpservlets/">http://home.comcast.net/~d.popowich/mpservlets/</A>


-------------- next part --------------
# -*- python -*-
from mod_python.servlet import HTMLPage

import cgi

class types(HTMLPage):
      
    query_vars = ['realstr']

    def prep(self):
        HTMLPage.prep(self)
        self.field = self.form.getfirst('field')
    
    def write_content(self):
        self.writeln('field: %s&lt;br&gt;' % self.field)

        self.writeln('type(field): %s&lt;br&gt;' %
                     cgi.escape(str(type(self.field))))

        self.writeln('realstr: %s&lt;br&gt;' % self.realstr)

        self.writeln('type(realstr): %s&lt;br&gt;' %
                     cgi.escape(str(type(self.realstr))))
</PRE>
























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019694.html">[mod_python] Why can't  psycopg2 beta adapt this:
</A></li>
	<LI>Next message: <A HREF="019714.html">[mod_python] Why can't  psycopg2 beta adapt this:
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19701">[ date ]</a>
              <a href="thread.html#19701">[ thread ]</a>
              <a href="subject.html#19701">[ subject ]</a>
              <a href="author.html#19701">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
