<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Problems with headers in proxy handler
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Problems%20with%20headers%20in%20proxy%20handler&In-Reply-To=cd329af80512100351n301c9057x%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019722.html">
   <LINK REL="Next"  HREF="019683.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Problems with headers in proxy handler</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Problems%20with%20headers%20in%20proxy%20handler&In-Reply-To=cd329af80512100351n301c9057x%40mail.gmail.com"
       TITLE="[mod_python] Problems with headers in proxy handler">grahamd at dscpl.com.au
       </A><BR>
    <I>Sat Dec 10 15:58:19 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="019722.html">[mod_python] Problems with headers in proxy handler
</A></li>
        <LI>Next message: <A HREF="019683.html">[mod_python] Debian
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19723">[ date ]</a>
              <a href="thread.html#19723">[ thread ]</a>
              <a href="subject.html#19723">[ subject ]</a>
              <a href="author.html#19723">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On 10/12/2005, at 10:51 PM, Sebastjan Trepca wrote:

&gt;<i> Ok :) Just didn't want to import whole module because of a constant.
</I>
The module is already resident in memory because it contains a lot of
stuff which mod_python itself uses. When you import it, it is just a  
quick
lookup of sys.modules by Python internals to get it and it doesn't have
to go back to disk. Even this quick lookup only happens once, it isn't
like CGI where everything is loaded on each request.

&gt;<i> Btw, what is the difference between OK and DONE? I understand that
</I>&gt;<i> DONE will stop Apache to go processing further, but where further can
</I>&gt;<i> it go? I mean what is processed after the request handler ?
</I>
If DONE is used in content handler phase, it may well be not much
different than OK (not sure), but it will be if used in earlier  
phases such
as access handler, auth handler, fixup handler etc.

&gt;<i> Sebastjan
</I>&gt;<i>
</I>&gt;<i> On 10/12/05, Graham Dumpleton &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">grahamd at dscpl.com.au</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Which version of mod_python are you using?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On 08/12/2005, at 12:14 AM, Sebastjan Trepca wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Hi,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I'm writing a proxy handler which makes a request to a different  
</I>&gt;&gt;&gt;<i> page
</I>&gt;&gt;&gt;<i> and retrieves its content and headers. This is the source:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> import urllib2
</I>&gt;&gt;&gt;<i> from mod_python import util
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> def handler(req):
</I>&gt;&gt;&gt;<i>     req.headers_out.clear()
</I>&gt;&gt;&gt;<i>     f = util.FieldStorage(req)
</I>&gt;&gt;&gt;<i>     url = f.get('url',None)
</I>&gt;&gt;&gt;<i>     if(url):
</I>&gt;&gt;&gt;<i>         url=url.split('?')
</I>&gt;&gt;&gt;<i>         if(len(url)&gt;1):
</I>&gt;&gt;&gt;<i>             u = url[0]
</I>&gt;&gt;&gt;<i>             p = url[1]
</I>&gt;&gt;&gt;<i>             ureq = urllib2.Request(u,p)
</I>&gt;&gt;&gt;<i>         else:
</I>&gt;&gt;&gt;<i>             u = url[0]
</I>&gt;&gt;&gt;<i>             ureq = urllib2.Request(u)
</I>&gt;&gt;&gt;<i>         for h in req.headers_in:
</I>&gt;&gt;&gt;<i>             ureq.add_header(h,req.headers_in[h])
</I>&gt;&gt;&gt;<i>         r = urllib2.urlopen(ureq)
</I>&gt;&gt;&gt;<i>         for h in r.headers:
</I>&gt;&gt;&gt;<i>             req.headers_out[h]=r.headers[h]
</I>&gt;&gt;&gt;<i>         data =     r.read()
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> In case you are using mod_python 2.7.X, add at this point:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>             req.send_http_header()
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>         req.write(data)
</I>&gt;&gt;&gt;<i>         return 0#-2 doesn't help either
</I>&gt;&gt;&gt;<i>     return 0
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Will not make a difference, but don't return 0/2, use apache.OK/
</I>&gt;&gt;<i> apache.DONE
</I>&gt;&gt;<i> instead. Using literal integer values is bad programming practice.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> But this seems to have problems with headers, I get back basic  
</I>&gt;&gt;&gt;<i> headers
</I>&gt;&gt;&gt;<i> from my Apache server, which is wrong of course.
</I>&gt;&gt;&gt;<i> Any ideas why is this happening?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Graham
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>
</PRE>












<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019722.html">[mod_python] Problems with headers in proxy handler
</A></li>
	<LI>Next message: <A HREF="019683.html">[mod_python] Debian
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19723">[ date ]</a>
              <a href="thread.html#19723">[ thread ]</a>
              <a href="subject.html#19723">[ subject ]</a>
              <a href="author.html#19723">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
