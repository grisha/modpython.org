<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Paramiko connection to SFTP web-based client
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Paramiko%20connection%20to%20SFTP%20web-based%20client&In-Reply-To=0B1220B1BC53C04384C8EACA4EEA24C2814EE259A6%40GS-EXCH-01.greensky.local">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026547.html">
   <LINK REL="Next"  HREF="026549.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Paramiko connection to SFTP web-based client</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Paramiko%20connection%20to%20SFTP%20web-based%20client&In-Reply-To=0B1220B1BC53C04384C8EACA4EEA24C2814EE259A6%40GS-EXCH-01.greensky.local"
       TITLE="[mod_python] Paramiko connection to SFTP web-based client">graham.dumpleton at gmail.com
       </A><BR>
    <I>Thu Mar 11 19:32:31 EST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="026547.html">[mod_python] Paramiko connection to SFTP web-based client
</A></li>
        <LI>Next message: <A HREF="026549.html">[mod_python] Paramiko connection to SFTP web-based client
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26548">[ date ]</a>
              <a href="thread.html#26548">[ thread ]</a>
              <a href="subject.html#26548">[ subject ]</a>
              <a href="author.html#26548">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 12 March 2010 09:09, Mark Brown &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mark.Brown at greenskycredit.com</A>&gt; wrote:
&gt;<i> Sorry that I am really, really new to Python but I have run into a wall and
</I>&gt;<i> need some help:
</I>&gt;<i>
</I>&gt;<i> Basically, I am trying to create a web-client for a sftp server.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> You enter your user name and password and you authenticate against the sftp
</I>&gt;<i> server, see a list of all the files on the server, can browse the server,
</I>&gt;<i> and if you click on a link download the file.
</I>&gt;<i>
</I>&gt;<i> I have tried several different methods to keep the network-resource in the
</I>&gt;<i> session, but nothing thus far has worked. My research seems to indicate that
</I>&gt;<i> in order to achieve this I would need to write a daemon that handles the
</I>&gt;<i> connection, and pass the session id to the daemon to match connection to web
</I>&gt;<i> request.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I have found some articles on how to turn a python script into a daemon, but
</I>&gt;<i> I need some help understanding what is really going.
</I>&gt;<i>
</I>&gt;<i> Anyways, the script&#160; I have tested thus far using mod_python is below:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> from mod_python import apache
</I>&gt;<i> from mod_python import Session
</I>&gt;<i> import paramiko
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> def handler(req):
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160; session=Session.Session(req)
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160; req.content_type=&quot;text/html&quot;
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160; try:
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; session['hits'] +=1
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; #dirlist=session['sftp'].listdir('.')
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; req.write('From Session')
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160; except:
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; t=paramiko.Transport(('[SERVER NAME],22))
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; t.connect(username='[USER NAME]',password='[PASSWORD]')
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; sftp=paramiko.SFTPClient.from_transport(t)
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; dirlist = sftp.listdir('.')
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; session['hits']=1
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; session['sftp']=sftp
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; req.write('New Session')
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160; session.save()
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160; req.write('Hits %d\n' % session['hits'])
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160; req.write(dirlist)
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160; return apache.OK
</I>
To ensure portability and overall guarantee it will always work, you
should only store in session basic Python data types. Even class
objects should be avoided even if they can be pickled. This is because
normally the session is stored in a database outside of the process.
Complex objects such as a socket handle obviously cant therefore be
stored.

The only time doing so would work is on Windows. That is because in
that case the session database is in memory and isn't actually written
to a separate database. You could only make it work on UNIX systems by
changing your Apache configuration such that it only ever used a
single server child process such that all requests handled by same
process and forcing the use of in memory session database. Forcing a
single process when using mod_python on UNIX sort of defeats the
problem of using Apache.

You could use this single process model by instead using mod_wsgi as
at least with that you could use its daemon mode and force your web
application to run in single dedicated process separate to the Apache
server child processes. You then though have to learn WSGI or use one
of the WSGI frameworks/toolkits. You still couldn't use traditional
session layers though and would need to maintain your own data
structure with active pool of connections in memory.

BTW, are you sure there aren't already web interfaces to SFTP clients?
Sure there would be one somewhere, albeit maybe implemented in a
different language.

Graham

</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026547.html">[mod_python] Paramiko connection to SFTP web-based client
</A></li>
	<LI>Next message: <A HREF="026549.html">[mod_python] Paramiko connection to SFTP web-based client
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26548">[ date ]</a>
              <a href="thread.html#26548">[ thread ]</a>
              <a href="subject.html#26548">[ subject ]</a>
              <a href="author.html#26548">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
