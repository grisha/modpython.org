<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Re: Upgrading expat for apache question
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Re%3A%20Upgrading%20expat%20for%20apache%20question&In-Reply-To=4B9ADC41.3010000%40noaa.gov">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026552.html">
   <LINK REL="Next"  HREF="026554.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Re: Upgrading expat for apache question</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Re%3A%20Upgrading%20expat%20for%20apache%20question&In-Reply-To=4B9ADC41.3010000%40noaa.gov"
       TITLE="[mod_python] Re: Upgrading expat for apache question">graham.dumpleton at gmail.com
       </A><BR>
    <I>Fri Mar 12 22:09:24 EST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="026552.html">[mod_python] Re: Upgrading expat for apache question
</A></li>
        <LI>Next message: <A HREF="026554.html">[mod_python] Re: Upgrading expat for apache question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26553">[ date ]</a>
              <a href="thread.html#26553">[ thread ]</a>
              <a href="subject.html#26553">[ subject ]</a>
              <a href="author.html#26553">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 13 March 2010 11:28, wayne collier &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Wayne.Collier at noaa.gov</A>&gt; wrote:
&gt;<i> Okay I am running RH linux and I don't seem to have mod_ldap or
</I>&gt;<i> mod_authnz_ldap shared objects loaded in my httpd.conf file.
</I>
They may not be loaded from httpd.conf but from a configuration file
snippet loaded into Apache. I don't know RH Apache configuration
layout, but check all snippet files in subdirectories to the
httpd.conf directory.

The conflict may also be because you are loading mod_php.

Ultimately you may have to use gdb to work out exactly where it
crashes. Hopefully not too much symbol information has been stripped
and gdb will be able to tell you from which library LDAP code that is
crashing is coming from.

Use first documented procedure for running Apache in single process
under gdb in:

  <A HREF="http://code.google.com/p/modwsgi/wiki/DebuggingTechniques#Debugging_Crashes_With_GDB">http://code.google.com/p/modwsgi/wiki/DebuggingTechniques#Debugging_Crashes_With_GDB</A>

This is for mod_wsgi, but same can be done for mod_python.

Graham

&gt;<i> Also I ran ldd
</I>&gt;<i> and got the following results:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> ldd /usr/local/httpd-2.2.11/bin/httpd
</I>&gt;<i> &#160;&#160;&#160; linux-gate.so.1 =&gt;&#160; (0x00157000)
</I>&gt;<i> &#160;&#160;&#160; libm.so.6 =&gt; /lib/libm.so.6 (0x00ce8000)
</I>&gt;<i> &#160;&#160;&#160; libaprutil-1.so.0 =&gt; /usr/local/httpd-2.2.11/lib/libaprutil-1.so.0
</I>&gt;<i> (0x00315000)
</I>&gt;<i> &#160;&#160;&#160; libexpat.so.0 =&gt; /lib/libexpat.so.0 (0x00d70000)
</I>&gt;<i> &#160;&#160;&#160; libapr-1.so.0 =&gt; /usr/local/httpd-2.2.11/lib/libapr-1.so.0 (0x00844000)
</I>&gt;<i> &#160;&#160;&#160; libuuid.so.1 =&gt; /lib/libuuid.so.1 (0x002f2000)
</I>&gt;<i> &#160;&#160;&#160; librt.so.1 =&gt; /lib/librt.so.1 (0x00d65000)
</I>&gt;<i> &#160;&#160;&#160; libcrypt.so.1 =&gt; /lib/libcrypt.so.1 (0x07e07000)
</I>&gt;<i> &#160;&#160;&#160; libpthread.so.0 =&gt; /lib/libpthread.so.0 (0x00d17000)
</I>&gt;<i> &#160;&#160;&#160; libdl.so.2 =&gt; /lib/libdl.so.2 (0x00d11000)
</I>&gt;<i> &#160;&#160;&#160; libc.so.6 =&gt; /lib/libc.so.6 (0x00ba0000)
</I>&gt;<i> &#160;&#160;&#160; /lib/ld-linux.so.2 (0x00b82000)
</I>&gt;<i>
</I>&gt;&gt;<i> ldd /usr/local/httpd-2.2.11/modules/mod_python.so
</I>&gt;<i> &#160;&#160;&#160; linux-gate.so.1 =&gt;&#160; (0x00aec000)
</I>&gt;<i> &#160;&#160;&#160; libpthread.so.0 =&gt; /lib/libpthread.so.0 (0x00730000)
</I>&gt;<i> &#160;&#160;&#160; libdl.so.2 =&gt; /lib/libdl.so.2 (0x0027f000)
</I>&gt;<i> &#160;&#160;&#160; libutil.so.1 =&gt; /lib/libutil.so.1 (0x00f70000)
</I>&gt;<i> &#160;&#160;&#160; libm.so.6 =&gt; /lib/libm.so.6 (0x009b1000)
</I>&gt;<i> &#160;&#160;&#160; libc.so.6 =&gt; /lib/libc.so.6 (0x00110000)
</I>&gt;<i> &#160;&#160;&#160; /lib/ld-linux.so.2 (0x00b82000)
</I>&gt;<i>
</I>&gt;<i> I don't seem to have anything with ldap listed. Am I on the right track.?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Wayne
</I>&gt;<i>
</I>&gt;<i> Graham Dumpleton wrote:
</I>&gt;<i>
</I>&gt;<i> A segmentation fault can occur for other reasons. If it is happening
</I>&gt;<i> when you use LDAP, it could be a conflict in versions of LDAP
</I>&gt;<i> libraries being used by Apache or PHP and Python LDAP module.
</I>&gt;<i>
</I>&gt;<i> You should use the 'ldd' command to determine what LDAP shared library
</I>&gt;<i> is used by mod_authnz_ldap and compare that to the LDAP library being
</I>&gt;<i> used by the C extension module component of the Python module you are
</I>&gt;<i> using to access LDAP. Similarly find any PHP extension modules which
</I>&gt;<i> use LDAP and look at those.
</I>&gt;<i>
</I>&gt;<i> If mod_authnz_ldap is loaded into Apache and you don't need it, then
</I>&gt;<i> don't load it and see if problem goes away. Also try not loading PHP
</I>&gt;<i> if it is being loaded. Narrow down which is in conflict.
</I>&gt;<i>
</I>&gt;<i> As far as I remember, Apache itself doesn't link to LDAP library and
</I>&gt;<i> even possible that mod_authnz_ldap uses an internal LDAP library
</I>&gt;<i> rather than linking external library. All the same even use ldd on
</I>&gt;<i> Apache binary itself to see which LDAP library may be linked.
</I>&gt;<i>
</I>&gt;<i> Graham
</I>&gt;<i>
</I>&gt;<i> On 10 March 2010 04:18, wayne collier &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Wayne.Collier at noaa.gov</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Okay I guess I will look else where. However, I keep getting segmentation
</I>&gt;<i> faults when try an execute the ldap command
</I>&gt;<i>
</I>&gt;<i> t=l.simple_bind_s(dn,pw). It is only line of code that crashes. If the have
</I>&gt;<i> the classic expat problem, would that mean I would get a segmentation
</I>&gt;<i> fault problem from the start.  Also, ldap script works okay as a stand alone
</I>&gt;<i> script. Thanks.
</I>&gt;<i>
</I>&gt;<i> Wayne
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Graham Dumpleton wrote:
</I>&gt;<i>
</I>&gt;<i> That is not your problem, quoting:
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://code.google.com/p/modwsgi/wiki/IssuesWithExpatLibrary">http://code.google.com/p/modwsgi/wiki/IssuesWithExpatLibrary</A>
</I>&gt;<i>
</I>&gt;<i> which is more up to date in respect of this issue, even if the
</I>&gt;<i> mod_wsgi variant of that document:
</I>&gt;<i>
</I>&gt;<i> &quot;&quot;&quot;Note that this only applies to Python versions prior to Python 2.5.
</I>&gt;<i> &gt;From Python 2.5 onwards, the copy of the &quot;expat&quot; library bundled in
</I>&gt;<i> with Python is name space prefixed, thereby avoid name clashes with an
</I>&gt;<i> &quot;expat&quot; library which has previously been loaded.&quot;&quot;&quot;
</I>&gt;<i>
</I>&gt;<i> You are using Python 2.6, so you cannot be affected by this problem.
</I>&gt;<i>
</I>&gt;<i> Graham
</I>&gt;<i>
</I>&gt;<i> On 9 March 2010 05:54, wayne collier &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Wayne.Collier at noaa.gov</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Hello all. I need some help solving the dreaded segmentation fault that has
</I>&gt;<i> cropped several time on this board. I have read the link
</I>&gt;<i> <A HREF="http://www.dscpl.com.au/wiki/ModPython/Articles/ExpatCausingApacheCrash">http://www.dscpl.com.au/wiki/ModPython/Articles/ExpatCausingApacheCrash</A> and
</I>&gt;<i> followed the step and have uncovered the following.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ldd&#160;&#160;&#160; /usr/local/httpd-2.2.11/bin/httpd | grep expat
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160; libexpat.so.0 =&gt; /lib/libexpat.so.0 (0x00d70000)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> strings /lib/libexpat.so.0&#160; | grep expat_
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> expat_1.95.8
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &#160; ps aux | grep http | head -3
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> webuser&#160; 14986&#160; 0.0&#160; 2.1&#160; 54236 19048 ?&#160;&#160;&#160;&#160;&#160;&#160;&#160; S&#160;&#160;&#160; Mar04&#160;&#160; 0:01
</I>&gt;<i> /usr/local/httpd-2.2.11/bin/httpd -d /usr/local/httpd-2.2.11 -f
</I>&gt;<i> /usr/local/httpd-2.2.11/conf/httpd.conf
</I>&gt;<i> webuser&#160; 14987&#160; 0.0&#160; 3.2 144128 29540 ?&#160;&#160;&#160;&#160;&#160;&#160;&#160; S&#160;&#160;&#160; Mar04&#160;&#160; 0:01
</I>&gt;<i> /usr/local/httpd-2.2.11/bin/httpd -d /usr/local/httpd-2.2.11 -f
</I>&gt;<i> /usr/local/httpd-2.2.11/conf/httpd.conf
</I>&gt;<i> webuser&#160; 14998&#160; 0.0&#160; 3.2 144212 29660 ?&#160;&#160;&#160;&#160;&#160;&#160;&#160; S&#160;&#160;&#160; Mar04&#160;&#160; 0:01
</I>&gt;<i> /usr/local/httpd-2.2.11/bin/httpd -d /usr/local/httpd-2.2.11 -f
</I>&gt;<i> /usr/local/httpd-2.2.11/conf/httpd.conf
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &#160; /usr/sbin/lsof -p 14986 | grep expat
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> httpd&#160;&#160; 14986 webuser&#160; mem&#160;&#160;&#160; REG&#160;&#160;&#160;&#160; 3,5&#160;&#160; 572313&#160; 972637
</I>&gt;<i> /opt/Python/lib/python2.6/lib-dynload/pyexpat.so
</I>&gt;<i> httpd&#160;&#160; 14986 webuser&#160; mem&#160;&#160;&#160; REG&#160;&#160;&#160;&#160; 3,5&#160;&#160; 133120 1883791
</I>&gt;<i> /lib/libexpat.so.0.5.0
</I>&gt;<i>
</I>&gt;<i> I am not sure why I get 2 shared libaries here.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &#160; strings&#160; /lib/libexpat.so.0.5.0 | grep expat_
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> expat_1.95.8
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> strings /opt/Python/lib/python2.6/lib-dynload/pyexpat.so | grep expat_
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> pyexpat.expat_CAPI 1.0
</I>&gt;<i> expat_CAPI
</I>&gt;<i> expat_2.0.0
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> import pyexpat
</I>&gt;<i> pyexpat.version_info
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> (2, 0, 0)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> So it seems like I need get expat_1.95.8 apache is using up to expat_2.0.0.
</I>&gt;<i> Can I simply try replacing the 1.95.8 library with 2.0.0. Or do I have
</I>&gt;<i> recompile with Apache? If I do recompile I need to recompile apache with
</I>&gt;<i> mod_python as well?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026552.html">[mod_python] Re: Upgrading expat for apache question
</A></li>
	<LI>Next message: <A HREF="026554.html">[mod_python] Re: Upgrading expat for apache question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26553">[ date ]</a>
              <a href="thread.html#26553">[ thread ]</a>
              <a href="subject.html#26553">[ subject ]</a>
              <a href="author.html#26553">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
