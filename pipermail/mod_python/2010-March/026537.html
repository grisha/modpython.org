<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> Isolated: Was: [mod_python] ModPython + Virtual Hosting Apache2 
	instance = poor performance.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=Isolated%3A%20Was%3A%20%5Bmod_python%5D%20ModPython%20%2B%20Virtual%20Hosting%20Apache2%20%0A%09instance%20%3D%20poor%20performance.&In-Reply-To=6C62ED43-E3F0-4B7B-B334-179EF107B700%40vindaloo.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026535.html">
   <LINK REL="Next"  HREF="026538.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>Isolated: Was: [mod_python] ModPython + Virtual Hosting Apache2 
	instance = poor performance.</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=Isolated%3A%20Was%3A%20%5Bmod_python%5D%20ModPython%20%2B%20Virtual%20Hosting%20Apache2%20%0A%09instance%20%3D%20poor%20performance.&In-Reply-To=6C62ED43-E3F0-4B7B-B334-179EF107B700%40vindaloo.com"
       TITLE="Isolated: Was: [mod_python] ModPython + Virtual Hosting Apache2 
	instance = poor performance.">graham.dumpleton at gmail.com
       </A><BR>
    <I>Sun Mar  7 21:59:16 EST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="026535.html">Isolated: Was: [mod_python] ModPython + Virtual Hosting Apache2
	instance = poor performance.
</A></li>
        <LI>Next message: <A HREF="026538.html">Solved: [mod_python] ModPython + Virtual Hosting Apache2 instance =
	poor performance.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26537">[ date ]</a>
              <a href="thread.html#26537">[ thread ]</a>
              <a href="subject.html#26537">[ subject ]</a>
              <a href="author.html#26537">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 8 March 2010 13:42, Christopher Sean Hilton &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">chris at vindaloo.com</A>&gt; wrote:
&gt;<i>
</I>&gt;<i> On Mar 7, 2010, at 6:06 PM, Graham Dumpleton wrote:
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> You said you were using PHP, so you cant use worker MPM with Apache.
</I>&gt;&gt;<i> You can still use mod_wsgi with prefork MPM, just ensure you run WSGI
</I>&gt;&gt;<i> application in daemon mode of mod_wsgi to avoid issues discussed in
</I>&gt;&gt;<i> article. Do note though that you can't use mod_wsgi with a Python
</I>&gt;&gt;<i> installation which hasn't been compiled with thread support. You also
</I>&gt;&gt;<i> cannot use daemon mode with a APR library for Apache that doesn't have
</I>&gt;&gt;<i> thread support.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Thanks for the tip, That would have been a real huge problem.
</I>&gt;<i>
</I>&gt;&gt;<i> Rebuilding Python without threading should not cause such a dramatic
</I>&gt;&gt;<i> improvement especially considering I recollect you had only loaded
</I>&gt;&gt;<i> mod_python and not used it. I would suggest your rebuilding has seen
</I>&gt;&gt;<i> some other change. I also don't know what earlier post you are talking
</I>&gt;&gt;<i> about as there was no such post in this current thread on mod_python
</I>&gt;&gt;<i> list.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I didn't make any quantitative measurements. Here's what I observed:
</I>&gt;<i>
</I>&gt;<i> Browsing this page with the &quot;broken&quot; configuration took approximately 1min to load all of the thumbnails. In the &quot;fixed&quot; configuration it loads instantly. N.B. that I'm looking at this over 100Mbit LAN.
</I>&gt;<i>
</I>&gt;<i> &#160; &#160; <A HREF="http://fileshare.vindaloo.com/SoccerPhotos/page-0001.html">http://fileshare.vindaloo.com/SoccerPhotos/page-0001.html</A>
</I>&gt;<i>
</I>&gt;<i> The thread Martin pointed to seemed to conjecture that the problem has to do with apache under FreeBSD being single threaded and thus depending on libc.so while a threaded python and thus a mod_python built to use it depends on libc_r.so. I believe the thread mentions a patch by you but it may be a different Graham.
</I>&gt;<i>
</I>&gt;<i> &#160; &#160; <A HREF="http://osdir.com/ml/apache.mod-python.devel/2008-10/msg00000.html">http://osdir.com/ml/apache.mod-python.devel/2008-10/msg00000.html</A>
</I>&gt;<i>
</I>&gt;<i> I confess that I didn't understand the whole thing. What I took from it is that I'm going to have problems using a non-threaded apache with a threaded mod_python. I tested this conjecture by building a fresh FreeBSD install with fresh installs of apache 2.0.63, python2.6 and mod_python. And I can make the problem appear and disappear by simply changing the configuration of the python 2.6 build from threaded to non-threaded. I feel that I may have the logic about the reason wrong. I think its a weird libc.so vs libc_r.so issue. But I'm confident that I've trapped the problem.
</I>
Don't know then. Not what I would have expected unless there is a
conflict in PHP or elsewhere in Apache with forcing use of rentrant C
library.

&gt;<i> To tell the truth it doesn't matter. My end goal is to run Django and nowadays Django want's mod_wsgi so I'm moving over there. What I'm learning talking to you is that as far as performance goes python want's a worker MPM apache which php cannot do.
</I>
No, neither mod_wsgi or Python require Apache worker MPM. You can
still use mod_wsgi with Apache prefork MPM, thus allowing you to still
use PHP, but you would want to ensure you configure mod_wsgi such that
it creates a separate daemon process group to run your Django instance
in, similar to how FASTCGI works. This separate daemon process group
can be multithreaded, regarded of fact that single threaded Apache
prefork MPM is used, and so can have a single Python process, keeping
memory footprint down. It is because the mod_wsgi daemon process
supports threading that Python and APR have to also support threading,
even if you aren't using threading in main Apache server processes
managed under prefork MPM.

Perhaps have a read of:

  <A HREF="http://code.google.com/p/modwsgi/wiki/ProcessesAndThreading">http://code.google.com/p/modwsgi/wiki/ProcessesAndThreading</A>

Graham

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026535.html">Isolated: Was: [mod_python] ModPython + Virtual Hosting Apache2
	instance = poor performance.
</A></li>
	<LI>Next message: <A HREF="026538.html">Solved: [mod_python] ModPython + Virtual Hosting Apache2 instance =
	poor performance.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26537">[ date ]</a>
              <a href="thread.html#26537">[ thread ]</a>
              <a href="subject.html#26537">[ subject ]</a>
              <a href="author.html#26537">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
