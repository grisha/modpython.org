<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Problem with mod_proxy + inputfilter + headers_in
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Problem%20with%20mod_proxy%20%2B%20inputfilter%20%2B%20headers_in&In-Reply-To=e79469d0704190821x12a0ffa9ve94e9d13e37898e6%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023483.html">
   <LINK REL="Next"  HREF="023491.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Problem with mod_proxy + inputfilter + headers_in</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Problem%20with%20mod_proxy%20%2B%20inputfilter%20%2B%20headers_in&In-Reply-To=e79469d0704190821x12a0ffa9ve94e9d13e37898e6%40mail.gmail.com"
       TITLE="[mod_python] Problem with mod_proxy + inputfilter + headers_in">graham.dumpleton at gmail.com
       </A><BR>
    <I>Thu Apr 19 17:53:30 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="023483.html">[mod_python] Problem with mod_proxy + inputfilter + headers_in
</A></li>
        <LI>Next message: <A HREF="023491.html">[mod_python] using FieldStorage without publishing handler
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23484">[ date ]</a>
              <a href="thread.html#23484">[ thread ]</a>
              <a href="subject.html#23484">[ subject ]</a>
              <a href="author.html#23484">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>You can't use a mod_python input filter to modify incoming headers. If
the changes to the headers aren't intended to influence the behaviour
of what Apache does during access, authentication, authorisation and
type checking phases, use a PythonFixupHandler to update any headers
to then be used by the actual response handler.

Note, provided you are using mod_python 3.3, you can actually use
mod_python to trigger the proxying as well. See:

<A HREF="http://issues.apache.org/jira/browse/MODPYTHON-141">http://issues.apache.org/jira/browse/MODPYTHON-141</A>

Graham

On 20/04/07, indyone ;o) &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">indyone at gmail.com</A>&gt; wrote:
&gt;<i> Hi list,
</I>&gt;<i>
</I>&gt;<i> I'm trying to get the headers_in from the client, and after changing/adding
</I>&gt;<i> some headers i would like to pass them to the backend server.
</I>&gt;<i> I'm using Apache/2.0.55 (Win32) mod_python/3.1.3 Python/2.3.5
</I>&gt;<i> The problem is that the headers are sent to the backend unchanged when using
</I>&gt;<i> this simple input filter:
</I>&gt;<i>
</I>&gt;<i> def inputfilter(filter):
</I>&gt;<i>
</I>&gt;<i>     filter.req.headers_in['X-MyHeader'] = 'Test'
</I>&gt;<i>     if filter.req.main is not None:
</I>&gt;<i>         filter.pass_on()
</I>&gt;<i>         return
</I>&gt;<i>
</I>&gt;<i>     filter.req.log_error('Start %s' % filter.req.uri)
</I>&gt;<i>     s = filter.read()
</I>&gt;<i>     while s:
</I>&gt;<i>         filter.write(s)
</I>&gt;<i>         s = filter.read()
</I>&gt;<i>     if s is None:
</I>&gt;<i>         filter.close()
</I>&gt;<i>         filter.req.log_error('End %s' % filter.req.uri)
</I>&gt;<i>
</I>&gt;<i>     filter.req.log_error('%s' % filter.req.headers_in)
</I>&gt;<i>
</I>&gt;<i> and Apache logs:
</I>&gt;<i>
</I>&gt;<i> [Thu Apr 19 18:17:28 2007] [error] [client 127.0.0.1] Start /, referer:
</I>&gt;<i> <A HREF="http://localhost/">http://localhost/</A>
</I>&gt;<i> [Thu Apr 19 18:17:28 2007] [error] [client 127.0.0.1] End /, referer:
</I>&gt;<i> <A HREF="http://localhost/">http://localhost/</A>
</I>&gt;<i> [Thu Apr 19 18:17:28 2007] [error] [client 127.0.0.1] {'X-MyHeader': 'Test',
</I>&gt;<i> 'X-Forwarded-Server': 'luna', 'X-Forwarded-Host': 'localhost',
</I>&gt;<i> 'X-Forwarded-For': ' 127.0.0.1', 'Max-Forwards': '10', 'Cookie': 'wstyle=;
</I>&gt;<i> __ac=&quot;YWRtaW46bWF0cml4&quot;;
</I>&gt;<i> tree-s=&quot;eJzT0MgpMOQKVneEAKcAN19bda4CI67EkgJjLj0AegYHmA&quot;',
</I>&gt;<i> 'Referer': ' <A HREF="http://localhost/',">http://localhost/',</A> 'Accept-Charset':
</I>&gt;<i> 'ISO-8859-7,utf-8;q=0.7,*;q=0.7', 'Accept-Encoding': 'gzip,deflate',
</I>&gt;<i> 'Accept-Language': 'el,en-us;q=0.7 ,en;q=0.3', 'Accept':
</I>&gt;<i> 'text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5',
</I>&gt;<i> 'User-Agent': 'Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv: 1.8.0.8)
</I>&gt;<i> Gecko/20061030 SeaMonkey/1.0.6', 'Host': 'localhost'}, referer:
</I>&gt;<i> <A HREF="http://localhost/">http://localhost/</A>
</I>&gt;<i> ...(multiple times)...
</I>&gt;<i>
</I>&gt;<i> Which is right i think... But my backend server gets this request:
</I>&gt;<i>
</I>&gt;<i> GET
</I>&gt;<i> /VirtualHostBase/http/localhost:80/Editorial/VirtualHostRoot/
</I>&gt;<i> HTTP/1.1
</I>&gt;<i> Host: localhost:8081
</I>&gt;<i> User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.0.8)
</I>&gt;<i> Gecko/20061030 SeaMonkey/1.0.6
</I>&gt;<i> Accept:
</I>&gt;<i> text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5
</I>&gt;<i> Accept-Language: el,en-us;q=0.7,en;q=0.3
</I>&gt;<i> Accept-Encoding: gzip,deflate
</I>&gt;<i> Accept-Charset: ISO-8859-7,utf-8;q= 0.7,*;q=0.7
</I>&gt;<i> Referer: <A HREF="http://localhost/">http://localhost/</A>
</I>&gt;<i> Cookie: wstyle=; __ac=&quot;YWRtaW46bWF0cml4&quot;;
</I>&gt;<i> tree-s=&quot;eJzT0MgpMOQKVneEAKcAN19bda4CI67EkgJjLj0AegYHmA&quot;
</I>&gt;<i> Max-Forwards: 10
</I>&gt;<i> X-Forwarded-For: 127.0.0.1
</I>&gt;<i> X-Forwarded-Host: localhost
</I>&gt;<i> X-Forwarded-Server: luna
</I>&gt;<i>
</I>&gt;<i> Thank you in advance,
</I>&gt;<i>
</I>&gt;<i> Ioannis Stavrinos
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i>
</I>&gt;<i>
</I></PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023483.html">[mod_python] Problem with mod_proxy + inputfilter + headers_in
</A></li>
	<LI>Next message: <A HREF="023491.html">[mod_python] using FieldStorage without publishing handler
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23484">[ date ]</a>
              <a href="thread.html#23484">[ thread ]</a>
              <a href="subject.html#23484">[ subject ]</a>
              <a href="author.html#23484">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
