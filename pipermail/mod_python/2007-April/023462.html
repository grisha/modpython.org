<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Mod_Python and RewriteRule
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Mod_Python%20and%20RewriteRule&In-Reply-To=8e3f377c0704111626t24a4eec3re68f672ce275af7a%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023461.html">
   <LINK REL="Next"  HREF="023463.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Mod_Python and RewriteRule</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Mod_Python%20and%20RewriteRule&In-Reply-To=8e3f377c0704111626t24a4eec3re68f672ce275af7a%40mail.gmail.com"
       TITLE="[mod_python] Mod_Python and RewriteRule">graham.dumpleton at gmail.com
       </A><BR>
    <I>Wed Apr 11 19:38:54 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="023461.html">[mod_python] Mod_Python and RewriteRule
</A></li>
        <LI>Next message: <A HREF="023463.html">[mod_python] Mod_Python and RewriteRule
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23462">[ date ]</a>
              <a href="thread.html#23462">[ thread ]</a>
              <a href="subject.html#23462">[ subject ]</a>
              <a href="author.html#23462">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>What if you use wget/curl to get the page? At least with those
programs it should only make one request. There must be something in
the page that causes the browser to re-request it.

If mod_rewrite becomes a pain, the only other way would be to write
using mod_python your own transhandler (I think this is best) which
matches req.uri for what you want and then sets req.filename and
req.args to what you need. Also possibly may want to even set
req.handler at that point to 'mod_python' and even register the
handler to call using req.add_handler(). That way the only thing in
Apache configuration is PythonTransHandler and PythonOption
directives. This will possibly give you better control than
mod_rewrite but does mean that all requests go through Python handler
code which may be a performance issue.

Other than that suggestion, would need to experiment but don't have
time right now.

Graham

On 12/04/07, Nathan C. Tresch &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">nathan at yapta.com</A>&gt; wrote:
&gt;<i> When I load JUST the page I don't get the reloading problem, only when I use
</I>&gt;<i> the rewrite engine and [PT].
</I>&gt;<i>
</I>&gt;<i> Using liveHeaders for Firefox I end up with a zillion(sic) 200 status's,
</I>&gt;<i> they never seem to stop.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 4/11/07, Graham Dumpleton &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">graham.dumpleton at gmail.com</A>&gt; wrote:
</I>&gt;<i> &gt; On 12/04/07, Nathan C. Tresch &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">nathan at yapta.com</A>&gt; wrote:
</I>&gt;<i> &gt; &gt; When I use [PT] both Firefox and IE continually reload the page and peg
</I>&gt;<i> the
</I>&gt;<i> &gt; &gt; CPU at 100%, however, I get the content I'm after.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; If you see the content you want but the browser is reloading, that
</I>&gt;<i> &gt; would suggest an issue with the page. Does the HTML for the page have
</I>&gt;<i> &gt; some meta data which forces a reload after some period. Can you use
</I>&gt;<i> &gt; some low level mechanism to get the page (curl, wget, telnet) and see
</I>&gt;<i> &gt; what the actual HTTP status code is and confirm it is just a 200 and
</I>&gt;<i> &gt; not some sort of redirection status. Also look to see if a Location
</I>&gt;<i> &gt; header is being returned which may be a target of a redirect.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Graham
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; The other two options alter the debug output slightly, but still give
</I>&gt;<i> the
</I>&gt;<i> &gt; &gt; same result.  The extra output just seems to specify it's setting the
</I>&gt;<i> &gt; &gt; MIME-type to mod_python
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; On 4/11/07, Graham Dumpleton &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">graham.dumpleton at gmail.com</A>&gt; wrote:
</I>&gt;<i> &gt; &gt; &gt; Does it make any difference if you use:
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;   RewriteRule /trip-([0-9]*)/.*/
</I>&gt;<i> &gt; &gt; /user/trip.myt\?tab=airlines&amp;id=$1 [PT]
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; or:
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;   RewriteRule /trip-([0-9]*)/.*/
</I>&gt;<i> &gt; &gt; /user/trip.myt\?tab=airlines&amp;id=$1
</I>&gt;<i> &gt; &gt; &gt; [H=mod_python]
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; Can't remember if latter requires Apache 2.2 If older version of
</I>&gt;<i> &gt; &gt; &gt; Apache maybe try:
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;   RewriteRule /trip-([0-9]*)/.*/
</I>&gt;<i> &gt; &gt; /user/trip.myt\?tab=airlines&amp;id=$1
</I>&gt;<i> &gt; &gt; &gt; [T=mod_python]
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; Graham
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; On 12/04/07, Nathan C. Tresch &lt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">nathan at yapta.com</A>&gt; wrote:
</I>&gt;<i> &gt; &gt; &gt; &gt; Yes,  /user/trip.myt?tab=airline&amp;id=18335 works.
</I>&gt;<i> &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt;     AddHandler mod_python .py
</I>&gt;<i> &gt; &gt; &gt; &gt;     AddHandler mod_python .myt
</I>&gt;<i> &gt; &gt; &gt; &gt;     PythonHandler myghty.ApacheHandler::handle
</I>&gt;<i> &gt; &gt; &gt; &gt;     PythonPath
</I>&gt;<i> &gt; &gt; &gt; &gt; &quot;[r'/usr/local/data/wwwdev/ntresch']+sys.path&quot;
</I>&gt;<i> &gt; &gt; &gt; &gt;     PythonOption MyghtyInterpreterName r&quot;ntresch_interp&quot;
</I>&gt;<i> &gt; &gt; &gt; &gt;     PythonOption MyghtyComponentRoot \
</I>&gt;<i> &gt; &gt; &gt; &gt;     &quot;[  \
</I>&gt;<i> &gt; &gt; &gt; &gt;
</I>&gt;<i> {'components':'/data/wwwdev/ntresch/public'}, \
</I>&gt;<i> &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt;
</I>&gt;<i> {'templates':'/data/wwwdev/ntresch/myghty/templates'} \
</I>&gt;<i> &gt; &gt; &gt; &gt;     ]&quot;
</I>&gt;<i> &gt; &gt; &gt; &gt;     PythonOption MyghtyDataDir
</I>&gt;<i> &gt; &gt; &gt; &gt; r&quot;/data/wwwdev/ntresch/myghty/data&quot;
</I>&gt;<i> &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt;     #PythonHandler mod_python.publisher
</I>&gt;<i> &gt; &gt; &gt; &gt;     PythonDebug On
</I>&gt;<i> &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; These lines are located in the main apache config file.
</I>&gt;<i> &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; On 4/11/07, Graham Dumpleton &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">graham.dumpleton at gmail.com</A>&gt; wrote:
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; Does using:
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt;   /user/trip.myt?tab=airline&amp;id=18335
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; in the browser work?
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; What is the Apache configuration snippet you are using to enable
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; mod_python for this URL? Where is it located, main Apache
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; configuration or .htaccess file?
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; Graham
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; On 12/04/07, Nathan C. Tresch &lt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">nathan at yapta.com</A>&gt; wrote:
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; So, here is what I get:
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; %tail -f rewrite_log
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; 67.42.99.238 - - [11/Apr/2007:15:44:23 --0700] [
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; dev.yapta.com/sid#80d05f0][rid#8d3c050/initial
</I>&gt;<i> ]
</I>&gt;<i> &gt; &gt; (2)
</I>&gt;<i> &gt; &gt; &gt; &gt; init
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; rewrite engine with requested uri /trip-18335/Minneapolis/St.
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; Paul/Washington/
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; 67.42.99.238 - - [11/Apr/2007:15:44:23 --0700] [
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; dev.yapta.com/sid#80d05f0][rid#8d3c050/initial]
</I>&gt;<i> (3)
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; applying pattern '/trip-([0-9]*)/.*/' to uri
</I>&gt;<i> &gt; &gt; &gt; &gt; '/trip-18335/Minneapolis/St.
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; Paul/Washington/'
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt;  67.42.99.238 - - [11/Apr/2007:15:44:23 --0700] [
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; dev.yapta.com/sid#80d05f0][rid#8d3c050/initial]
</I>&gt;<i> (2)
</I>&gt;<i> &gt; &gt; &gt; &gt; rewrite
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; '/trip-18335/Minneapolis/St. Paul/Washington/' -&gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; '/user/trip.myt?tab=airline&amp;id=18335'
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; 67.42.99.238 - - [11/Apr/2007:15:44:23 --0700] [
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; dev.yapta.com/sid#80d05f0][rid#8d3c050/initial
</I>&gt;<i> ]
</I>&gt;<i> &gt; &gt; (3)
</I>&gt;<i> &gt; &gt; &gt; &gt; split
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; uri=/user/trip.myt?tab=airline&amp;id=18335 -&gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; uri=/user/trip.myt, args=tab=airline&amp;id=18335
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; 67.42.99.238 - - [11/Apr/2007:15:44:23 --0700] [
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; dev.yapta.com/sid#80d05f0][rid#8d3c050/initial
</I>&gt;<i> ] (2)
</I>&gt;<i> &gt; &gt; &gt; &gt; local
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; path result: /user/trip.myt
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; 67.42.99.238 - - [11/Apr/2007:15:44:23 --0700] [
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; dev.yapta.com/sid#80d05f0][rid#8d3c050/initial
</I>&gt;<i> ]
</I>&gt;<i> &gt; &gt; (2)
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; prefixed with document_root to
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> /usr/local/data/wwwdev/ntresch/public/user/trip.myt
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; 67.42.99.238 - - [11/Apr/2007:15:44:23 --0700] [
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; dev.yapta.com/sid#80d05f0][rid#8d3c050/initial
</I>&gt;<i> ]
</I>&gt;<i> &gt; &gt; (1)
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; go-ahead with
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> /usr/local/data/wwwdev/ntresch/public/user/trip.myt
</I>&gt;<i> &gt; &gt; &gt; &gt; [OK]
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; Yet my browser still gives me a 404.
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; I suspect it's because python/myghty is looking for something in
</I>&gt;<i> the
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; origional path, it's modules maybe?  And it can't find anything
</I>&gt;<i> &gt; &gt; there.
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt;  On 4/11/07, Graham Dumpleton &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">graham.dumpleton at gmail.com</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; On 12/04/07, Nathan C. Tresch &lt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">nathan at yapta.com</A>&gt; wrote:
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; We're using Myghty and Mod_Python.  The following
</I>&gt;<i> RewriteRule
</I>&gt;<i> &gt; &gt; &gt; &gt; produces a
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; 404:
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; RewriteRule /trip-([0-9]*)/.*/
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; /user/trip.myt\?tab=airlines&amp;id=$1 [L]
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; Previously, before we converted to PHP, the rule looked like
</I>&gt;<i> &gt; &gt; this:
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; RewriteRule /trip-([0-9]*)/.*/
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; /user/trip.php\?tab=airlines&amp;id=$1 [L]
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; This worked.
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; Can anyone tell me what gives?
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; Have you tried debugging what mod_rewrite is doing by
</I>&gt;<i> increasing
</I>&gt;<i> &gt; &gt; its
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; logging output using the RewriteLogLevel directive etc? From
</I>&gt;<i> that
</I>&gt;<i> &gt; &gt; you
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; can see what it finally rewrites it to. You can then try
</I>&gt;<i> putting
</I>&gt;<i> &gt; &gt; that
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; URL into the browser directly and try and work out why any
</I>&gt;<i> other
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; configuration may not be correct.
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; Graham
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; --
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; Nathan C. Tresch
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; Software Engineer
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; YapTA! Inc.
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; --
</I>&gt;<i> &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; Nathan C. Tresch
</I>&gt;<i> &gt; &gt; &gt; &gt; Software Engineer
</I>&gt;<i> &gt; &gt; &gt; &gt; YapTA! Inc.
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; --
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Nathan C. Tresch
</I>&gt;<i> &gt; &gt; Software Engineer
</I>&gt;<i> &gt; &gt; YapTA! Inc.
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i>
</I>&gt;<i> Nathan C. Tresch
</I>&gt;<i> Software Engineer
</I>&gt;<i> YapTA! Inc.
</I></PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023461.html">[mod_python] Mod_Python and RewriteRule
</A></li>
	<LI>Next message: <A HREF="023463.html">[mod_python] Mod_Python and RewriteRule
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23462">[ date ]</a>
              <a href="thread.html#23462">[ thread ]</a>
              <a href="subject.html#23462">[ subject ]</a>
              <a href="author.html#23462">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
