<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Problem with mod_proxy + inputfilter + headers_in
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Problem%20with%20mod_proxy%20%2B%20inputfilter%20%2B%20headers_in&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023479.html">
   <LINK REL="Next"  HREF="023484.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Problem with mod_proxy + inputfilter + headers_in</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>indyone ;o)</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Problem%20with%20mod_proxy%20%2B%20inputfilter%20%2B%20headers_in&In-Reply-To="
       TITLE="[mod_python] Problem with mod_proxy + inputfilter + headers_in">indyone at gmail.com
       </A><BR>
    <I>Thu Apr 19 11:21:05 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="023479.html">[mod_python] handling multiple users with mod_python
</A></li>
        <LI>Next message: <A HREF="023484.html">[mod_python] Problem with mod_proxy + inputfilter + headers_in
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23483">[ date ]</a>
              <a href="thread.html#23483">[ thread ]</a>
              <a href="subject.html#23483">[ subject ]</a>
              <a href="author.html#23483">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi list,

I'm trying to get the headers_in from the client, and after changing/adding
some headers i would like to pass them to the backend server.
I'm using Apache/2.0.55 (Win32) mod_python/3.1.3 Python/2.3.5
The problem is that the headers are sent to the backend unchanged when using
this simple input filter:

def inputfilter(filter):

    filter.req.headers_in['X-MyHeader'] = 'Test'
    if filter.req.main is not None:
        filter.pass_on()
        return

    filter.req.log_error('Start %s' % filter.req.uri)
    s = filter.read()
    while s:
        filter.write(s)
        s = filter.read()
    if s is None:
        filter.close()
        filter.req.log_error('End %s' % filter.req.uri)

    filter.req.log_error('%s' % filter.req.headers_in)

and Apache logs:

[Thu Apr 19 18:17:28 2007] [error] [client 127.0.0.1] Start /, referer:
<A HREF="http://localhost/">http://localhost/</A>
[Thu Apr 19 18:17:28 2007] [error] [client 127.0.0.1] End /, referer:
<A HREF="http://localhost/">http://localhost/</A>
[Thu Apr 19 18:17:28 2007] [error] [client 127.0.0.1] {'X-MyHeader': 'Test',
'X-Forwarded-Server': 'luna', 'X-Forwarded-Host': 'localhost',
'X-Forwarded-For': '127.0.0.1', 'Max-Forwards': '10', 'Cookie': 'wstyle=;
__ac=&quot;YWRtaW46bWF0cml4&quot;;
tree-s=&quot;eJzT0MgpMOQKVneEAKcAN19bda4CI67EkgJjLj0AegYHmA&quot;', 'Referer': '
<A HREF="http://localhost/',">http://localhost/',</A> 'Accept-Charset': 'ISO-8859-7,utf-8;q=0.7,*;q=0.7',
'Accept-Encoding': 'gzip,deflate', 'Accept-Language': 'el,en-us;q=0.7,en;q=
0.3', 'Accept': 'text/xml,application/xml,application/xhtml+xml,text/html;q=
0.9,text/plain;q=0.8,image/png,*/*;q=0.5', 'User-Agent': 'Mozilla/5.0
(Windows; U; Windows NT 5.1; en-US; rv:1.8.0.8) Gecko/20061030
SeaMonkey/1.0.6', 'Host': 'localhost'}, referer: <A HREF="http://localhost/">http://localhost/</A>
...(multiple times)...

Which is right i think... But my backend server gets this request:

GET /VirtualHostBase/http/localhost:80/Editorial/VirtualHostRoot/ HTTP/1.1
Host: localhost:8081
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.0.8)
Gecko/20061030 SeaMonkey/1.0.6
Accept: text/xml,application/xml,application/xhtml+xml,text/html;q=0.9
,text/plain;q=0.8,image/png,*/*;q=0.5
Accept-Language: el,en-us;q=0.7,en;q=0.3
Accept-Encoding: gzip,deflate
Accept-Charset: ISO-8859-7,utf-8;q=0.7,*;q=0.7
Referer: <A HREF="http://localhost/">http://localhost/</A>
Cookie: wstyle=; __ac=&quot;YWRtaW46bWF0cml4&quot;;
tree-s=&quot;eJzT0MgpMOQKVneEAKcAN19bda4CI67EkgJjLj0AegYHmA&quot;
Max-Forwards: 10
X-Forwarded-For: 127.0.0.1
X-Forwarded-Host: localhost
X-Forwarded-Server: luna

Thank you in advance,

Ioannis Stavrinos
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070419/bb5876e0/attachment.html">http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070419/bb5876e0/attachment.html</A>
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023479.html">[mod_python] handling multiple users with mod_python
</A></li>
	<LI>Next message: <A HREF="023484.html">[mod_python] Problem with mod_proxy + inputfilter + headers_in
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23483">[ date ]</a>
              <a href="thread.html#23483">[ thread ]</a>
              <a href="subject.html#23483">[ subject ]</a>
              <a href="author.html#23483">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
