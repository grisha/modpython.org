<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Mod_Python, Mod_Proxy, and Set-Cookie
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Mod_Python%2C%20Mod_Proxy%2C%20and%20Set-Cookie&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025665.html">
   <LINK REL="Next"  HREF="025667.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Mod_Python, Mod_Proxy, and Set-Cookie</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Tom Wells</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Mod_Python%2C%20Mod_Proxy%2C%20and%20Set-Cookie&In-Reply-To="
       TITLE="[mod_python] Mod_Python, Mod_Proxy, and Set-Cookie">drshade at gmail.com
       </A><BR>
    <I>Mon Sep 29 10:05:25 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="025665.html">[mod_python] AuthHandler to restrict ip adress only (no need to
	ask user for a password)
</A></li>
        <LI>Next message: <A HREF="025667.html">[mod_python] Re: Mod_Python, Mod_Proxy, and Set-Cookie
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25666">[ date ]</a>
              <a href="thread.html#25666">[ thread ]</a>
              <a href="subject.html#25666">[ subject ]</a>
              <a href="author.html#25666">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Group

I'm facing an interesting problem at the moment and wondered if anyone could
give me a pointer. Our setup is the following:
Apache running mod_python and mod_proxy, with python handlers for Authen and
Authz, we have an Oracle Application Server and a JRUN Application Server in
the back, which are where mod_proxy is configured to forward to. Our python
Authen and Authz handlers are responsible for getting and setting session
related cookies before proxying, or to redirect the user if the session
cookie is bad or he is not logged in (no cookie). Even if the user has a
valid cookie we refresh it every 2 minutes, i.e. generate a new cookie, add
the Set-Cookie header, then allow the request to continue (i.e. mod_proxy
kicks in and forwards the request to oracle or jrun). This is nice because
we have a single authentication model up front for multiple disparate web
applications in the back.

Now the good news is that this works really well, mostly. Browser requests
to and from the webserver correctly get and update cookies and
allow/disallow requests to be proxied. More specifically the &quot;Set-Cookie&quot;
header is present in responses where the cookie has been updated. This is
true for both the oracle and jrun application servers being proxied to.

HOWEVER - we have a rich client (desktop) app written in C# which has been
designed to POST to some of the oracle url's in order to fetch data, after
it performs a login. So it logs in, gets a fresh new cookie and regularly
hits the backend for data. For each request our Authen and Authz handlers
process the cookie and ensure the session is valid etc, and allow or
disallow the request (i.e. return apache.OK or do a
mod_python_util.redirect() to get rid of him). The problem is that requests
from this app don't ever get back a refreshed cookie (after 2 minutes) -
there is every indication according to my apache logs that my Authz handler
is calling the mod_python.Cookie.add_cookie(req, newCookie) function to set
the new cookie, and even printing out the list of headers_in and headers_out
in a fixuphandler shows the Set-Cookie header is present. BUT the Set-Cookie
never makes it back to the app as we have used fiddler2 and httpdebugger to
monitor the traffic.

So I blame the Oracle Application Server for eating the cookie somehow, but
surely as the cookie is added to the headers_out of the request it MUST go
back to the browser regardless of how it was proxied or whatever the proxied
application responds with?

Please help - getting desperate for a solution - any pointers as to track
down the issue would be greatly appreciated!

Thanks,
Tom

-- 
<A HREF="http://www.tomwells.org">http://www.tomwells.org</A>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080929/672e16db/attachment.html">http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080929/672e16db/attachment.html</A>
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025665.html">[mod_python] AuthHandler to restrict ip adress only (no need to
	ask user for a password)
</A></li>
	<LI>Next message: <A HREF="025667.html">[mod_python] Re: Mod_Python, Mod_Proxy, and Set-Cookie
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25666">[ date ]</a>
              <a href="thread.html#25666">[ thread ]</a>
              <a href="subject.html#25666">[ subject ]</a>
              <a href="author.html#25666">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
