<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Performance Question
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Performance%20Question&In-Reply-To=2CB7C4C8-530D-4136-912D-AC17E7E5D611%40cse.psu.edu">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025629.html">
   <LINK REL="Next"  HREF="025631.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Performance Question</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Performance%20Question&In-Reply-To=2CB7C4C8-530D-4136-912D-AC17E7E5D611%40cse.psu.edu"
       TITLE="[mod_python] Performance Question">graham.dumpleton at gmail.com
       </A><BR>
    <I>Thu Sep 11 19:00:15 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="025629.html">[mod_python] Performance Question
</A></li>
        <LI>Next message: <A HREF="025631.html">[mod_python] Problem with Cookies and databases
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25630">[ date ]</a>
              <a href="thread.html#25630">[ thread ]</a>
              <a href="subject.html#25630">[ subject ]</a>
              <a href="author.html#25630">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>How many Apache processes do you have configured to be started up?

Are you using worker or prefork MPM?

If worker, how many threads in each process?

How fat is your application?

Do you preload/precalculate data when application loaded?

Especially if you are using prefork MPM and only have small number of
initial Apache processes configured, then hitting it with 100
concurrent requests is going to force Apache to start a lot more
processes to handle the requests. If your application is fat, or does
a lot of preloading of data, then starting up those processes will
take time and so initial requests will appear to be slow.

Graham

2008/9/11 Thomas Moyer &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">tmmoyer at cse.psu.edu</A>&gt;:
&gt;<i> -----BEGIN PGP SIGNED MESSAGE-----
</I>&gt;<i> Hash: SHA1
</I>&gt;<i>
</I>&gt;<i> I am having some problems with performance when using mod_python to serve
</I>&gt;<i> some dynamic content.  The request handler gathers information being
</I>&gt;<i> generated by background processes on the system, and then creates a simple
</I>&gt;<i> XML document that is sent to the client. Here is the code I am using with
</I>&gt;<i> some explanation.
</I>&gt;<i>
</I>&gt;<i>    requestedFilePath = &quot;/&quot; + req.filename.split(&quot;/&quot;)[-1][:-4].replace(&quot;_&quot;,
</I>&gt;<i> &quot;/&quot;).replace(&quot;-&quot;,&quot;.&quot;)
</I>&gt;<i>    sock = socket.socket(socket.AF_UNIX, socket.SOCK_STREAM)
</I>&gt;<i>    sock.connect(ATTService)
</I>&gt;<i>    Attest = message.recvMsg(sock)[0]
</I>&gt;<i>    sock.close()
</I>&gt;<i>
</I>&gt;<i>    fmt = &quot;%ds&quot; % len(requestedFilePath)
</I>&gt;<i>    msg = struct.pack(fmt, requestedFilePath)
</I>&gt;<i>    sock = socket.socket(socket.AF_UNIX, socket.SOCK_STREAM)
</I>&gt;<i>    sock.connect(MHTService)
</I>&gt;<i>    message.sendMsg(sock, msg, fmt)
</I>&gt;<i>    MHTList = message.recvMsg(sock)[0]
</I>&gt;<i>    sock.close()
</I>&gt;<i>
</I>&gt;<i>    req.content_type = 'text/xml'
</I>&gt;<i>    req.write(&quot;&lt;ACA&gt;%s%s&lt;/ACA&gt;&quot; % (Attest,MHTList))
</I>&gt;<i>    return apache.OK
</I>&gt;<i>
</I>&gt;<i> There are 3 different pieces here.  The first block connects to a daemon
</I>&gt;<i> running on the system that is monitoring the system. I connect to a Unix
</I>&gt;<i> domain socket and receive the most recent information it has.  I then do the
</I>&gt;<i> same thing with another daemon that is gathering information about files
</I>&gt;<i> that are available on the system. Finally I combine these two blocks of
</I>&gt;<i> information and send it to the client.
</I>&gt;<i>
</I>&gt;<i> My problem is, when I start using benchmarking tools like JMeter, and I put
</I>&gt;<i> the system under any sort of load (100 clients for example), the first
</I>&gt;<i> recvMsg call (Attest = message.recvMsg(sock)[0]) takes about 12 seconds to
</I>&gt;<i> complete per client.  I watch top during the run and see that the apache
</I>&gt;<i> processes are completely occupied (usually showing 120+% CPU usage).  The
</I>&gt;<i> system running apache is an 8-core machine with 16GB of RAM so I'm pretty
</I>&gt;<i> sure there isn't a resource problem for either memory or processor.
</I>&gt;<i>
</I>&gt;<i> I'm not really sure where to look next to understand why a simple socket
</I>&gt;<i> recv() call is taking 12 seconds to complete.  The amount of data being
</I>&gt;<i> recv()'d is ~80K of text if that makes a difference.
</I>&gt;<i>
</I>&gt;<i> ~tom
</I>&gt;<i> -----BEGIN PGP SIGNATURE-----
</I>&gt;<i> Version: GnuPG v1.4.8 (Darwin)
</I>&gt;<i>
</I>&gt;<i> iEYEARECAAYFAkjJDI0ACgkQa7Yypxfw9TeOPwCfb29vCZlna6WZL9X/SASxT4Ms
</I>&gt;<i> cxYAnRyDlcMF6gWuSgdT8HHPnq1Urs/H
</I>&gt;<i> =NPk2
</I>&gt;<i> -----END PGP SIGNATURE-----
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i>
</I></PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025629.html">[mod_python] Performance Question
</A></li>
	<LI>Next message: <A HREF="025631.html">[mod_python] Problem with Cookies and databases
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25630">[ date ]</a>
              <a href="thread.html#25630">[ thread ]</a>
              <a href="subject.html#25630">[ subject ]</a>
              <a href="author.html#25630">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
