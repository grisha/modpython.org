From ben at micropledge.com  Fri Jun  1 03:50:03 2007
From: ben at micropledge.com (Ben Hoyt)
Date: Fri Jun  1 03:50:11 2007
Subject: [mod_python] mod_python 3.3 importer with "import" statement
In-Reply-To: <88e286470705310307h781cc2a7t2fa9ee9d9df5e93a@mail.gmail.com>
References: <7c93bf1e0705310212h5f9a435fga8d8a1cd0ad983b6@mail.gmail.com>
	<7c93bf1e0705310242ia9e991dh26bc831d6151e291@mail.gmail.com>
	<88e286470705310307h781cc2a7t2fa9ee9d9df5e93a@mail.gmail.com>
Message-ID: <7c93bf1e0706010050h1bb30eddw2c012c63d1088302@mail.gmail.com>

> By default VirtualHosts use distinct Python interpreter instances.


Thanks for that, Graham. That stuff about Python interpreter instances was
really helpful, and started us hunting down the right track. Anyway, the
problems we were having were caused by:

1) Moving/renaming our root code directory without deleting the *.pyc files.
I think this was adding to the confusion because we were seeing some path
strings from the .pyc files in the error messages.

2) Using mod_python 3.3 on our development servers and something older on
our live one. I think this was confusing us with regard to the import
problem and PythonPath.

3) Relying on relative paths in a few places in our actually (actually in
web.py's template handling, which we're using). We used os.chdir() to set
the current working directory, but of course (we realise now) that the cwd
is process-dependent rather than Python-interpreter dependent. So depending
on which process Apache picked, it'd use the other virtual host's template
directory and confuse everyone. I think I'll tell the web.py people that
depending on relative paths is pretty much a bug (at least with mod_python
-- maybe that's why they haven't seen the bug).

Anyone else using mod_python with web.py, just out of curiosity?

Anyway, it's fixed, and I've got my head around PythonInterpreter and
PythonPath and various other things now. Cheers!

Overriding import is more complicated than just replacing __import__. ;-)


I suspected that was the case. Looks like you've been there and done that.

Thanks,
Ben

-- 
Ben Hoyt, +64 21 331 841
http://www.benhoyt.com/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070601/31e1012e/attachment.html
From graham.dumpleton at gmail.com  Fri Jun  1 03:58:14 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Fri Jun  1 03:58:20 2007
Subject: [mod_python] mod_python 3.3 importer with "import" statement
In-Reply-To: <7c93bf1e0706010050h1bb30eddw2c012c63d1088302@mail.gmail.com>
References: <7c93bf1e0705310212h5f9a435fga8d8a1cd0ad983b6@mail.gmail.com>
	<7c93bf1e0705310242ia9e991dh26bc831d6151e291@mail.gmail.com>
	<88e286470705310307h781cc2a7t2fa9ee9d9df5e93a@mail.gmail.com>
	<7c93bf1e0706010050h1bb30eddw2c012c63d1088302@mail.gmail.com>
Message-ID: <88e286470706010058p4d3f0e9eka6697229fd586990@mail.gmail.com>

FWIW, I cover a range of issues such as Apache user permissions,
environment variables, working directories etc in:

  http://code.google.com/p/modwsgi/wiki/ApplicationIssues

This discussion is in relation to mod_wsgi, but many of the same
issues apply to mod_python.

Also worth a read if you haven't done so before is:

  http://www.dscpl.com.au/wiki/ModPython/Articles/TheProcessInterpreterModel

Finally, plugging mod_wsgi once more, information about web.py:

  http://code.google.com/p/modwsgi/wiki/IntegrationWithWebPy

Some comments in there about how web.py intercepts 'print' are also
relevant to mod_python as use of 'print' for debugging can cause
interference with web.py.

Graham

On 01/06/07, Ben Hoyt <ben@micropledge.com> wrote:
>
>
> > By default VirtualHosts use distinct Python interpreter instances.
>
> Thanks for that, Graham. That stuff about Python interpreter instances was
> really helpful, and started us hunting down the right track. Anyway, the
> problems we were having were caused by:
>
> 1) Moving/renaming our root code directory without deleting the *.pyc files.
> I think this was adding to the confusion because we were seeing some path
> strings from the .pyc files in the error messages.
>
> 2) Using mod_python 3.3 on our development servers and something older on
> our live one. I think this was confusing us with regard to the import
> problem and PythonPath.
>
> 3) Relying on relative paths in a few places in our actually (actually in
> web.py's template handling, which we're using). We used os.chdir() to set
> the current working directory, but of course (we realise now) that the cwd
> is process-dependent rather than Python-interpreter dependent. So depending
> on which process Apache picked, it'd use the other virtual host's template
> directory and confuse everyone. I think I'll tell the web.py people that
> depending on relative paths is pretty much a bug (at least with mod_python
> -- maybe that's why they haven't seen the bug).
>
> Anyone else using mod_python with web.py, just out of curiosity?
>
> Anyway, it's fixed, and I've got my head around PythonInterpreter and
> PythonPath and various other things now. Cheers!
>
> > Overriding import is more complicated than just replacing __import__. ;-)
>
> I suspected that was the case. Looks like you've been there and done that.
>
> Thanks,
> Ben
>
> --
> Ben Hoyt, +64 21 331 841
> http://www.benhoyt.com/
From ben at micropledge.com  Fri Jun  1 21:37:06 2007
From: ben at micropledge.com (Ben Hoyt)
Date: Fri Jun  1 21:37:14 2007
Subject: [mod_python] mod_python 3.3 importer with "import" statement
In-Reply-To: <88e286470706010058p4d3f0e9eka6697229fd586990@mail.gmail.com>
References: <7c93bf1e0705310212h5f9a435fga8d8a1cd0ad983b6@mail.gmail.com>
	<7c93bf1e0705310242ia9e991dh26bc831d6151e291@mail.gmail.com>
	<88e286470705310307h781cc2a7t2fa9ee9d9df5e93a@mail.gmail.com>
	<7c93bf1e0706010050h1bb30eddw2c012c63d1088302@mail.gmail.com>
	<88e286470706010058p4d3f0e9eka6697229fd586990@mail.gmail.com>
Message-ID: <7c93bf1e0706011837g68fb8d75v1fc0b6d3e23b0fca@mail.gmail.com>

> FWIW, I cover a range of issues such as Apache user permissions,
> environment variables, working directories etc in:
>
>   http://code.google.com/p/modwsgi/wiki/ApplicationIssues


Ah, that's a really helpful doccy, thanks.

And I see (in retrospect, of course :-) that other people on the web.py list
have struggled with this relative path issue and you've replied there (
http://tinyurl.com/258qh8).

Cheers!
Ben.

-- 
Ben Hoyt, +64 21 331 841
http://www.benhoyt.com/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070602/b026a63e/attachment.html
From David.Bear at asu.edu  Mon Jun  4 16:25:36 2007
From: David.Bear at asu.edu (David Bear)
Date: Mon Jun  4 16:32:23 2007
Subject: [mod_python] seeing python code instead of output
Message-ID: <20070604202536.GC28400@asu.edu>

I've munged my configuration somehow. 

I have in my .htaccess file the following:

  AddHandler mod-python .py
  PythonHandler s2
  PythonDebug On

Yet, when I click on s2.py I see the contents of the python script,
not the output of all my req.write statements.

I'm sure this is address in the docs somewhere but I'n not getting any
hits when googling for it.

any pointers?

-- 
David Bear
phone: 	602-496-0424
fax: 	602-496-0955
College of Public Programs/ASU
University Center Rm 622
411 N Central
Phoenix, AZ 85007-0685
 "Beware the IP portfolio, everyone will be suspect of trespassing"
From jpg at jgassociates.ca  Mon Jun  4 17:05:57 2007
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Mon Jun  4 17:05:11 2007
Subject: [mod_python] seeing python code instead of output
In-Reply-To: <20070604202536.GC28400@asu.edu>
References: <20070604202536.GC28400@asu.edu>
Message-ID: <46647EB5.1010707@jgassociates.ca>

David Bear wrote:
> I've munged my configuration somehow. 
> 
> I have in my .htaccess file the following:
> 
>   AddHandler mod-python .py

                ...^......

Spot the typo? ;)


>   PythonHandler s2
>   PythonDebug On
> 
> Yet, when I click on s2.py I see the contents of the python script,
> not the output of all my req.write statements.
> 
> I'm sure this is address in the docs somewhere but I'n not getting any
> hits when googling for it.
> 
> any pointers?

AddHandler mod_python .py

Jim

From graham.dumpleton at gmail.com  Mon Jun  4 17:06:37 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon Jun  4 17:06:44 2007
Subject: [mod_python] seeing python code instead of output
In-Reply-To: <20070604202536.GC28400@asu.edu>
References: <20070604202536.GC28400@asu.edu>
Message-ID: <88e286470706041406p3f02a3fk815e45306045c11e@mail.gmail.com>

Do you really have 'mod-python' which a hyphen, instead of
'mod_python' with an underscore?

On 05/06/07, David Bear <David.Bear@asu.edu> wrote:
> I've munged my configuration somehow.
>
> I have in my .htaccess file the following:
>
>   AddHandler mod-python .py
>   PythonHandler s2
>   PythonDebug On
>
> Yet, when I click on s2.py I see the contents of the python script,
> not the output of all my req.write statements.
>
> I'm sure this is address in the docs somewhere but I'n not getting any
> hits when googling for it.
>
> any pointers?
>
> --
> David Bear
> phone:  602-496-0424
> fax:    602-496-0955
> College of Public Programs/ASU
> University Center Rm 622
> 411 N Central
> Phoenix, AZ 85007-0685
>  "Beware the IP portfolio, everyone will be suspect of trespassing"
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From habnabit at gmail.com  Mon Jun  4 17:22:17 2007
From: habnabit at gmail.com (Aaron Gallagher)
Date: Mon Jun  4 17:22:33 2007
Subject: [mod_python] Apache directory listing
In-Reply-To: <88e286470705301545v47c67caejae2910b5145e48cc@mail.gmail.com>
References: <641494D0-A3E3-400B-BC16-9A8F2995B2CD@gmail.com>
	<12B98D29-1414-4305-BF7F-24E5107E4438@gmail.com>
	<88e286470705291931o2d6af656w6590aa625ebac7ed@mail.gmail.com>
	<2240ED84-D42F-47C4-B2C6-9DF135169512@gmail.com>
	<88e286470705291941w7d7d6cenef4d9ef497ce7728@mail.gmail.com>
	<88e286470705291952i3e6bd497ncf25128ee0da35ff@mail.gmail.com>
	<5D9FEA5B-107F-4535-B9A9-99FFB5F28D93@gmail.com>
	<88e286470705292118x54f50240uabd13d56ecec50fd@mail.gmail.com>
	<C4D7CF4C-F980-40F0-87CE-CFFE9ADF4912@gmail.com>
	<98BF7227-DB03-464B-BA16-F5DEB4ED380E@gmail.com>
	<88e286470705301545v47c67caejae2910b5145e48cc@mail.gmail.com>
Message-ID: <80CBF84A-E3C7-496A-A17E-1D1F40EFF7EC@gmail.com>

Haha, I worked it out a while ago anyway. It was a stupid problem;  
when I rebuilt apache, I forgot to change my modules directory over  
to being owned by the apache user. Everything is working perfectly  
now, but I have a new question anyway!

Is it better to send documents chunked by calling req.send_http_header 
() and then using req.write unbuffered, or to send it all together by  
not using req.send_http_header() and with buffered req.write?

On May 30, 2007, at 6:45 PM, Graham Dumpleton wrote:

> Apache runs as a special user. Are your modules and the full directory
> path to where they are located readable to others?
>
> On 30/05/07, Aaron Gallagher <habnabit@gmail.com> wrote:
>> I just completely cleaned out my apache install, reinstalled it, and
>> it seems to be working, but I'm having problems again, and I've heard
>> of other people having the same problem. Every mod_python module I
>> try to load will not load, and the error I get is that the modules
>> can't be found.
>>
>> I'm using a .pth file in my site-packages directory, and I can import
>> the modules just fine from the interactive interpreter anywhere, and
>> mod_python.testhandler is reporting that my module directory is in
>> sys.path.
>>
>> So, what's going on?
>>
>> On May 29, 2007, at 10:49 PM, Aaron Gallagher wrote:
>>
>> > Hah, wow, I guess that explains everything.
>> >
>> > I got really frustrated with all of my bizarre problems, so I tried
>> > testing it on another machine.
>> >
>> > Everything worked _perfectly_. No problems whatsoever. Apache
>> > autoindexed my directories and everything.
>> >
>> > The first thing I did was check the versions, and they're both
>> > running apache 2.0.59 with mod_python 3.3.1. Weird.
>> >
>> > I'm going to do a complete reinstall of apache and see if that
>> > fixes everything on the server. I hope so.
>>
>> Aaron Gallagher
>> <habnabit@gmail.com>
>>
>>
>>

Aaron Gallagher
<habnabit@gmail.com>


From graham.dumpleton at gmail.com  Mon Jun  4 17:27:55 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon Jun  4 17:28:01 2007
Subject: [mod_python] Apache directory listing
In-Reply-To: <80CBF84A-E3C7-496A-A17E-1D1F40EFF7EC@gmail.com>
References: <641494D0-A3E3-400B-BC16-9A8F2995B2CD@gmail.com>
	<2240ED84-D42F-47C4-B2C6-9DF135169512@gmail.com>
	<88e286470705291941w7d7d6cenef4d9ef497ce7728@mail.gmail.com>
	<88e286470705291952i3e6bd497ncf25128ee0da35ff@mail.gmail.com>
	<5D9FEA5B-107F-4535-B9A9-99FFB5F28D93@gmail.com>
	<88e286470705292118x54f50240uabd13d56ecec50fd@mail.gmail.com>
	<C4D7CF4C-F980-40F0-87CE-CFFE9ADF4912@gmail.com>
	<98BF7227-DB03-464B-BA16-F5DEB4ED380E@gmail.com>
	<88e286470705301545v47c67caejae2910b5145e48cc@mail.gmail.com>
	<80CBF84A-E3C7-496A-A17E-1D1F40EFF7EC@gmail.com>
Message-ID: <88e286470706041427q447aace0q399d95faf514370c@mail.gmail.com>

On 05/06/07, Aaron Gallagher <habnabit@gmail.com> wrote:
> Haha, I worked it out a while ago anyway. It was a stupid problem;
> when I rebuilt apache, I forgot to change my modules directory over
> to being owned by the apache user. Everything is working perfectly
> now, but I have a new question anyway!
>
> Is it better to send documents chunked by calling req.send_http_header
> () and then using req.write unbuffered, or to send it all together by
> not using req.send_http_header() and with buffered req.write?

In Apache 2.X, send_http_header() is actually redundant.

The most time efficient way generally is to actually buffer output in
a Python list and then use:

  req.write(''.join(mylist))

Ie., write all data in one go.

This will probably use more memory, but less runtime overhead than
Apache doing the buffering.

Graham

> On May 30, 2007, at 6:45 PM, Graham Dumpleton wrote:
>
> > Apache runs as a special user. Are your modules and the full directory
> > path to where they are located readable to others?
> >
> > On 30/05/07, Aaron Gallagher <habnabit@gmail.com> wrote:
> >> I just completely cleaned out my apache install, reinstalled it, and
> >> it seems to be working, but I'm having problems again, and I've heard
> >> of other people having the same problem. Every mod_python module I
> >> try to load will not load, and the error I get is that the modules
> >> can't be found.
> >>
> >> I'm using a .pth file in my site-packages directory, and I can import
> >> the modules just fine from the interactive interpreter anywhere, and
> >> mod_python.testhandler is reporting that my module directory is in
> >> sys.path.
> >>
> >> So, what's going on?
> >>
> >> On May 29, 2007, at 10:49 PM, Aaron Gallagher wrote:
> >>
> >> > Hah, wow, I guess that explains everything.
> >> >
> >> > I got really frustrated with all of my bizarre problems, so I tried
> >> > testing it on another machine.
> >> >
> >> > Everything worked _perfectly_. No problems whatsoever. Apache
> >> > autoindexed my directories and everything.
> >> >
> >> > The first thing I did was check the versions, and they're both
> >> > running apache 2.0.59 with mod_python 3.3.1. Weird.
> >> >
> >> > I'm going to do a complete reinstall of apache and see if that
> >> > fixes everything on the server. I hope so.
> >>
> >> Aaron Gallagher
> >> <habnabit@gmail.com>
> >>
> >>
> >>
>
> Aaron Gallagher
> <habnabit@gmail.com>
>
>
>
From David.Bear at asu.edu  Mon Jun  4 18:39:12 2007
From: David.Bear at asu.edu (David Bear)
Date: Mon Jun  4 18:45:56 2007
Subject: [mod_python] seeing python code instead of output
In-Reply-To: <88e286470706041406p3f02a3fk815e45306045c11e@mail.gmail.com>
References: <20070604202536.GC28400@asu.edu>
	<88e286470706041406p3f02a3fk815e45306045c11e@mail.gmail.com>
Message-ID: <20070604223912.GE28400@asu.edu>

arg... sorry to waste everyone's time...

On Tue, Jun 05, 2007 at 07:06:37AM +1000, Graham Dumpleton wrote:
> Do you really have 'mod-python' which a hyphen, instead of
> 'mod_python' with an underscore?
> 
> On 05/06/07, David Bear <David.Bear@asu.edu> wrote:
> >I've munged my configuration somehow.
> >
> >I have in my .htaccess file the following:
> >
> >  AddHandler mod-python .py
> >  PythonHandler s2
> >  PythonDebug On
> >
> >Yet, when I click on s2.py I see the contents of the python script,
> >not the output of all my req.write statements.
> >
> >I'm sure this is address in the docs somewhere but I'n not getting any
> >hits when googling for it.
> >
> >any pointers?
> >
> >--
> >David Bear
> >phone:  602-496-0424
> >fax:    602-496-0955
> >College of Public Programs/ASU
> >University Center Rm 622
> >411 N Central
> >Phoenix, AZ 85007-0685
> > "Beware the IP portfolio, everyone will be suspect of trespassing"
> >_______________________________________________
> >Mod_python mailing list
> >Mod_python@modpython.org
> >http://mailman.modpython.org/mailman/listinfo/mod_python
> >

-- 
David Bear
phone: 	602-496-0424
fax: 	602-496-0955
College of Public Programs/ASU
University Center Rm 622
411 N Central
Phoenix, AZ 85007-0685
 "Beware the IP portfolio, everyone will be suspect of trespassing"
From David.Bear at asu.edu  Mon Jun  4 19:30:01 2007
From: David.Bear at asu.edu (David Bear)
Date: Mon Jun  4 19:36:44 2007
Subject: [mod_python] better understanding of the req object
Message-ID: <20070604233001.GH28400@asu.edu>

I'm trying to understand all the members/methods of the req object but
anytime I try something like

req.write('the uri is ', req.uri) 

or req.write('the hostname is ', req.hostname)

I get an TypeError.

I'm completely not understanding how to work with the req object.

I assumed members would be 'callable' and return their value.

-- 
David Bear
phone: 	602-496-0424
fax: 	602-496-0955
College of Public Programs/ASU
University Center Rm 622
411 N Central
Phoenix, AZ 85007-0685
 "Beware the IP portfolio, everyone will be suspect of trespassing"
From graham.dumpleton at gmail.com  Mon Jun  4 19:45:44 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon Jun  4 19:45:51 2007
Subject: [mod_python] better understanding of the req object
In-Reply-To: <20070604233001.GH28400@asu.edu>
References: <20070604233001.GH28400@asu.edu>
Message-ID: <88e286470706041645g6f5bc743x5d5724814066b266@mail.gmail.com>

The functions (callable) and attributes are documented in:

  http://www.modpython.org/live/current/doc-html/pyapi-mprequest.html

If you look at prototype for write() in the documentation you will see
it takes two arguments, the second being optional.

The first argument is the text to write, the second is an integer used
as boolean value to indicate if flushing should occur.

You are passing a string instead of integer second argument so of
course you are going to get a TypeError.

Graham

On 05/06/07, David Bear <David.Bear@asu.edu> wrote:
> I'm trying to understand all the members/methods of the req object but
> anytime I try something like
>
> req.write('the uri is ', req.uri)
>
> or req.write('the hostname is ', req.hostname)
>
> I get an TypeError.
>
> I'm completely not understanding how to work with the req object.
>
> I assumed members would be 'callable' and return their value.
>
> --
> David Bear
> phone:  602-496-0424
> fax:    602-496-0955
> College of Public Programs/ASU
> University Center Rm 622
> 411 N Central
> Phoenix, AZ 85007-0685
>  "Beware the IP portfolio, everyone will be suspect of trespassing"
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From David.Bear at asu.edu  Mon Jun  4 19:58:19 2007
From: David.Bear at asu.edu (David Bear)
Date: Mon Jun  4 20:05:06 2007
Subject: [mod_python] better understanding of the req object
In-Reply-To: <4664A4A4.4010209@bittorrent.com>
References: <20070604233001.GH28400@asu.edu> <4664A4A4.4010209@bittorrent.com>
Message-ID: <20070604235819.GI28400@asu.edu>

Thanks.

I was thinking in terms of using ',' string catenation like
print 'this ', 'is something'.. while using req.write method.

I hate having to keep learning the same thing over and over...

On Mon, Jun 04, 2007 at 04:47:48PM -0700, David Schachter wrote:
> David--
> 
> Try one of these:
> 
> req.write("the uri is %s" % req.uri)
> print >> req, "the uri is %s" % req.uri
> print >> req, "the uri is", req.uri
> 
> The latter two forms use the fact that the req object has a write() 
> method compatible with what the print keyword expects. It's a bit nicer 
> than the first form, imho.
> 
> You tried to pass two strings to a function that takes only one string 
> and an optional boolean flag (flush=0). You are lucky the universe did 
> not invert into a black hole. Or perhaps unlucky; it depends on your 
> point of view, I suppose.
> 
>                      -- David Schachter
> 
> David Bear wrote:
> >I'm trying to understand all the members/methods of the req object but
> >anytime I try something like
> >
> >req.write('the uri is ', req.uri) 
> >
> >or req.write('the hostname is ', req.hostname)
> >
> >I get an TypeError.
> >
> >I'm completely not understanding how to work with the req object.
> >
> >I assumed members would be 'callable' and return their value.
> >
> >  

-- 
David Bear
phone: 	602-496-0424
fax: 	602-496-0955
College of Public Programs/ASU
University Center Rm 622
411 N Central
Phoenix, AZ 85007-0685
 "Beware the IP portfolio, everyone will be suspect of trespassing"
From graham.dumpleton at gmail.com  Mon Jun  4 20:15:02 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon Jun  4 20:15:10 2007
Subject: [mod_python] better understanding of the req object
In-Reply-To: <20070604235819.GI28400@asu.edu>
References: <20070604233001.GH28400@asu.edu> <4664A4A4.4010209@bittorrent.com>
	<20070604235819.GI28400@asu.edu>
Message-ID: <88e286470706041715n6340b2f2mbbde6cde325b4a76@mail.gmail.com>

The only problem with using the 'print' method as shown is that there
is no way to control buffering. As a result, every one of those little
strings gets written out by Apache separately which can slow down
throughput.

It is actually better to use the following if outputing lots of little
strings using 'print'.

  import StringIO

  data = StringIO.StringIO()

  print >> data, "the uri is", req.uri

  req.write(data.getvalue())

Ie., perform only one call to write() with data accumulated using
StringIO (or cStringIO).

Graham

On 05/06/07, David Bear <David.Bear@asu.edu> wrote:
> Thanks.
>
> I was thinking in terms of using ',' string catenation like
> print 'this ', 'is something'.. while using req.write method.
>
> I hate having to keep learning the same thing over and over...
>
> On Mon, Jun 04, 2007 at 04:47:48PM -0700, David Schachter wrote:
> > David--
> >
> > Try one of these:
> >
> > req.write("the uri is %s" % req.uri)
> > print >> req, "the uri is %s" % req.uri
> > print >> req, "the uri is", req.uri
> >
> > The latter two forms use the fact that the req object has a write()
> > method compatible with what the print keyword expects. It's a bit nicer
> > than the first form, imho.
> >
> > You tried to pass two strings to a function that takes only one string
> > and an optional boolean flag (flush=0). You are lucky the universe did
> > not invert into a black hole. Or perhaps unlucky; it depends on your
> > point of view, I suppose.
> >
> >                      -- David Schachter
> >
> > David Bear wrote:
> > >I'm trying to understand all the members/methods of the req object but
> > >anytime I try something like
> > >
> > >req.write('the uri is ', req.uri)
> > >
> > >or req.write('the hostname is ', req.hostname)
> > >
> > >I get an TypeError.
> > >
> > >I'm completely not understanding how to work with the req object.
> > >
> > >I assumed members would be 'callable' and return their value.
> > >
> > >
>
> --
> David Bear
> phone:  602-496-0424
> fax:    602-496-0955
> College of Public Programs/ASU
> University Center Rm 622
> 411 N Central
> Phoenix, AZ 85007-0685
>  "Beware the IP portfolio, everyone will be suspect of trespassing"
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From nlv11281 at natlab.research.philips.com  Tue Jun  5 03:02:00 2007
From: nlv11281 at natlab.research.philips.com (Mike Looijmans)
Date: Tue Jun  5 03:02:15 2007
Subject: [mod_python] better understanding of the req object
In-Reply-To: <88e286470706041715n6340b2f2mbbde6cde325b4a76@mail.gmail.com>
References: <20070604233001.GH28400@asu.edu>
	<4664A4A4.4010209@bittorrent.com>	<20070604235819.GI28400@asu.edu>
	<88e286470706041715n6340b2f2mbbde6cde325b4a76@mail.gmail.com>
Message-ID: <46650A68.9030208@natlab.research.philips.com>

Tip: Output the "heading" of your page first and "flush" it to the user as soon as possible. Then 
run the queries and feed him the results.

Sending the header quickly prevents the user accidentally submitting a web form twice (he'll get 
impatient) and provides fast feedback that we're processing his request. Gives the website a fast 
appearance too.

If the query results tend to come in small chunks (e.g. sequential scan with few matches), i usually 
output the data one row at a time (one req.write() for each <tr>...</tr> part). When outputting 
large tables, i usually send out tens of rows at a time.

Buffering parts of the page in strings or list is in general a good idea. Buffering the whole page 
is, in my opinion, bad practice. The user presses a button, then nothing seems to happen for a 
while, and then suddenly the new page appears. I prefer to respond to the button press as quickly as 
possible, even though the new page will just be a title for the next two seconds.


Mike Looijmans
Philips Natlab / Topic Automation


Graham Dumpleton wrote:
> The only problem with using the 'print' method as shown is that there
> is no way to control buffering. As a result, every one of those little
> strings gets written out by Apache separately which can slow down
> throughput.
> 
> It is actually better to use the following if outputing lots of little
> strings using 'print'.
> 
>  import StringIO
> 
>  data = StringIO.StringIO()
> 
>  print >> data, "the uri is", req.uri
> 
>  req.write(data.getvalue())
> 
> Ie., perform only one call to write() with data accumulated using
> StringIO (or cStringIO).
> 
> Graham
> 
> On 05/06/07, David Bear <David.Bear@asu.edu> wrote:
> 
>> Thanks.
>>
>> I was thinking in terms of using ',' string catenation like
>> print 'this ', 'is something'.. while using req.write method.
>>
>> I hate having to keep learning the same thing over and over...
>>
>> On Mon, Jun 04, 2007 at 04:47:48PM -0700, David Schachter wrote:
>> > David--
>> >
>> > Try one of these:
>> >
>> > req.write("the uri is %s" % req.uri)
>> > print >> req, "the uri is %s" % req.uri
>> > print >> req, "the uri is", req.uri
>> >
>> > The latter two forms use the fact that the req object has a write()
>> > method compatible with what the print keyword expects. It's a bit nicer
>> > than the first form, imho.
>> >
>> > You tried to pass two strings to a function that takes only one string
>> > and an optional boolean flag (flush=0). You are lucky the universe did
>> > not invert into a black hole. Or perhaps unlucky; it depends on your
>> > point of view, I suppose.
>> >
>> >                      -- David Schachter
>> >
>> > David Bear wrote:
>> > >I'm trying to understand all the members/methods of the req object but
>> > >anytime I try something like
>> > >
>> > >req.write('the uri is ', req.uri)
>> > >
>> > >or req.write('the hostname is ', req.hostname)
>> > >
>> > >I get an TypeError.
>> > >
>> > >I'm completely not understanding how to work with the req object.
>> > >
>> > >I assumed members would be 'callable' and return their value.
>> > >
>> > >
>>
>> -- 
>> David Bear
>> phone:  602-496-0424
>> fax:    602-496-0955
>> College of Public Programs/ASU
>> University Center Rm 622
>> 411 N Central
>> Phoenix, AZ 85007-0685
>>  "Beware the IP portfolio, everyone will be suspect of trespassing"
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 
> 


From rogerb at rogerbinns.com  Tue Jun  5 11:58:19 2007
From: rogerb at rogerbinns.com (Roger Binns)
Date: Tue Jun  5 11:58:26 2007
Subject: [mod_python] Some observations after writing my own modpython
In-Reply-To: <88e286470705301722x5244474fs2d3b2314648e7d0b@mail.gmail.com>
References: <465BA139.9020208@rogerbinns.com>	
	<88e286470705282123n6f2caf3ey3c4231ce8b244f06@mail.gmail.com>	
	<465D2A6D.2090101@rogerbinns.com>
	<88e286470705301722x5244474fs2d3b2314648e7d0b@mail.gmail.com>
Message-ID: <4665881B.6080804@rogerbinns.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Graham Dumpleton wrote:
> Wow, when I suggested that it was more 'tongue in cheek', if you
> understand the expression. 

Of course.  But the code was fresh in my mind so what the heck :-)

> The complaints one keep seeing about fastcgi/scgi is that it is a pain
> to setup both in the fact that you need to install separate backend
> packages and also in the configuration. 

Can't that be fixed by better documentation/installers?

> You also see various
> complaints about it those process will just die or will hang around
> and not die.

I assume that is bugs in wsgiref or one of the other servers.

> Overall, the intent is to make it as secure, simple and uncomplicated
> as possible for web hosting companies so they can see it as a viable
> option for hosting Python web applications.

I'd strongly recommend putting that paragraph at the top of the modwsgi
home page.  A problem with a lot of open source projects is that they
don't say what they are really good at.

> Anyway, again, it is all about providing a system which is going to be
> safe to use in shared web hosting environments where users can't
> create havoc.

def handler(...):
   while True:
      pass

> There are no APR functions in Apache 1.3. It doesn't have some
> equivalents as ap_ functions but not as many.

I guess you'd have to use the Python equivalent functions then.

> Also, the apr_ functions
> mean you are using the Apache memory pools. I didn't want to use the
> memory pools as then the cumulative memory used is held until the end
> of the request, whereas using malloc/free means only hold memory for
> just the period I need to.

I can't imagine requests live that long to matter.  Also if you are
talking premature optimizations, I believe it is far more effective to
have the one free called that gets rid of the whole pool rather than
individual frees.  The main thing that seemed wierd in the code is that
it was doing these precise allocations whereas I'd expect Python or apr
to do allocations larger than you requested so that when you add more
chunks of data the space is likely already there.

>> You may find it worthwhile using PyObject_CallFunction instead of
>> BuildValue and CallObject.  You have one less thing to track refcounts
>> for and one less line of code.
> 
> Probably just did it that way as that is what the basic Python
> documentation examples use and so have always done that.

Yes, it would be nice if the docs and examples showed other functions
you can use, especially ones that result in less code and one less
variable to keep track of references on.

>> For the various objects that have a request_rec*, I don't see how they
>> deal with outliving the request_req.
> 
> They don't and since I keep pushing this idea that mod_wsgi is meant
> to be as secure and robust as possible to satisfy web hosting
> companies, maybe I should.

reqs=[]

def handler(req):
   reqs.append(req)
   [r.uri for r in reqs]

That code will cause a core dump :-)

> Strictly speaking though, a WSGI application should not be retaining
> references to the WSGI environment, the start_response function or
> anything else provided as part of the request. If it does, then it is
> incorrect.

There is incorrect, and there is crashing the entire process :-)

> Maybe I misunderstand what you are talking about, or to what level you
> are applying it. What I thought you meant is that if one access an
> attribute of request_rec, such as content type, that you create a
> Python string object and return it, but that you also remember that
> Python string instance so the next time content type is access in same
> request, that Python string instance which is being held is return
> instead of having to create a new one.

OOR is not referring to individual attributes and "small" types such as
string and integer but rather objects such as what wraps the
request_rec, server, apr_tables etc.

> Anyway, thanks greatly for reviewing my code and commenting on it.
> Just about everyone grabs the code and uses it, rather than digging
> into what it does and giving any feedback and how to make it better.

You are welcome.  It was interesting for me too.

Roger
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)

iD8DBQFGZYgbmOOfHg372QQRAoaSAJ4tU16GndmvMOomUYzPw5rt4N+WhgCdEOB9
lFcRVenn25VgX5y8P+PywSE=
=GvGG
-----END PGP SIGNATURE-----
From graham.dumpleton at gmail.com  Tue Jun  5 18:45:02 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue Jun  5 18:45:09 2007
Subject: [mod_python] Some observations after writing my own modpython
In-Reply-To: <4665881B.6080804@rogerbinns.com>
References: <465BA139.9020208@rogerbinns.com>
	<88e286470705282123n6f2caf3ey3c4231ce8b244f06@mail.gmail.com>
	<465D2A6D.2090101@rogerbinns.com>
	<88e286470705301722x5244474fs2d3b2314648e7d0b@mail.gmail.com>
	<4665881B.6080804@rogerbinns.com>
Message-ID: <88e286470706051545m64534a7fo52a9fb1dc2f9959d@mail.gmail.com>

On 06/06/07, Roger Binns <rogerb@rogerbinns.com> wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
> > The complaints one keep seeing about fastcgi/scgi is that it is a pain
> > to setup both in the fact that you need to install separate backend
> > packages and also in the configuration.
>
> Can't that be fixed by better documentation/installers?

Not all authors are that dedicated to come up with really good
documentation and why document a project written by someone else is
usually the attitude. Most will just spend just enough time to get it
working for themselves and leave it at that. Even more seem not even
to bother to read what documentation exists and will instead refer to
some arbitrary persons comments on a blog as to how they got it
working.

> > You also see various
> > complaints about it those process will just die or will hang around
> > and not die.
>
> I assume that is bugs in wsgiref or one of the other servers.

Nothing to do with wsgiref as they aren't Python specific solutions.
The problem is more to do with how the supervisor mechanisms are
implemented for both those packages, or not as the case may be. In
mod_wsgi I use the Apache supervisor mechanism which because it is a
part of Apache should provide more of a guarantee that things get
cleaned up properly on shutdown and restart.

> > Overall, the intent is to make it as secure, simple and uncomplicated
> > as possible for web hosting companies so they can see it as a viable
> > option for hosting Python web applications.
>
> I'd strongly recommend putting that paragraph at the top of the modwsgi
> home page.  A problem with a lot of open source projects is that they
> don't say what they are really good at.

True, I acknowledge I have a lot more work to do on documentation and
I do intend doing it. :-)

Also intend approaching some web hosting companies to see what they
think they need to be able to better support Python. Whether this be
features or simple documentation.

> > Anyway, again, it is all about providing a system which is going to be
> > safe to use in shared web hosting environments where users can't
> > create havoc.
>
> def handler(...):
>    while True:
>       pass

Okay, less havoc. I should really phrase it as being 'where
administrators have more control over the users applications'. Problem
with mod_python for example is that even the entry points sit outside
of the Apache access/auth/authz mechanisms, plus having full access to
request details means one can do password harvesting and other nasty
things. It is also too easy in mod_python to force some of your code
to run in a distinct Python interpreter where code belonging to
someone else is running and thus interact with that other persons
code.

> > Also, the apr_ functions
> > mean you are using the Apache memory pools. I didn't want to use the
> > memory pools as then the cumulative memory used is held until the end
> > of the request, whereas using malloc/free means only hold memory for
> > just the period I need to.
>
> I can't imagine requests live that long to matter.  Also if you are
> talking premature optimizations, I believe it is far more effective to
> have the one free called that gets rid of the whole pool rather than
> individual frees.  The main thing that seemed wierd in the code is that
> it was doing these precise allocations whereas I'd expect Python or apr
> to do allocations larger than you requested so that when you add more
> chunks of data the space is likely already there.

It is not the length of time for the request that matters, it is the
amount of data since if one uses Apache pools one can't give back
memory to the Apache pools such that it can be used straight away
within the lifetime of the pool, ie., one can't free it back to the
pool.

Also, in the log object, these aren't just used for 'wsgi.errors' for
life of request with them being used as replacements for 'sys.stdout'
and 'sys.stderr'. One can't use an Apache pool here as the log objects
live for the life of the interpreter (generally the process).

So, Apache pools are pretty well out unless one wants to add more code
complexity on top to deal with reusing memory etc. Even then still
problem of what to do with extra large chunks of memory if it has to
be allocated.

One could feasibly make use of stuff in Python to replace what I did
and I do use Python string objects at points where it is is easy and
makes sense. The only point I used malloc/free was where I needed to
retain buffered data between calls. For most cases where I did this,
the likelihood of the code actually being triggered is low as they
aren't on the most commonly used path. Thus for now it was a case of
getting something working. So yes it could be changed, but at this
point there is no pressing need.

> >> For the various objects that have a request_rec*, I don't see how they
> >> deal with outliving the request_req.
> >
> > They don't and since I keep pushing this idea that mod_wsgi is meant
> > to be as secure and robust as possible to satisfy web hosting
> > companies, maybe I should.
>
> reqs=[]
>
> def handler(req):
>    reqs.append(req)
>    [r.uri for r in reqs]
>
> That code will cause a core dump :-)

I have already updated mod_wsgi to avoid such problems.

> > Maybe I misunderstand what you are talking about, or to what level you
> > are applying it. What I thought you meant is that if one access an
> > attribute of request_rec, such as content type, that you create a
> > Python string object and return it, but that you also remember that
> > Python string instance so the next time content type is access in same
> > request, that Python string instance which is being held is return
> > instead of having to create a new one.
>
> OOR is not referring to individual attributes and "small" types such as
> string and integer but rather objects such as what wraps the
> request_rec, server, apr_tables etc.

Which is already done for request_rec and because of caching also for
the tables such as subprocess_env, notes, headers etc within a
mod_python request object. It isn't done for server_rec and conn_rec
within a request object however as I pointed out. Thus I think there
is perhaps more OOR going on in mod_python than may be obvious.

> > Anyway, thanks greatly for reviewing my code and commenting on it.
> > Just about everyone grabs the code and uses it, rather than digging
> > into what it does and giving any feedback and how to make it better.
>
> You are welcome.  It was interesting for me too.

FWIW, I have gone through and made some changes to mod_wsgi based on
your comments. Some I see as much lower priority and will only revisit
if there appears to be a great need for it.

So much thanks still for your feedback.

Graham
From epanepucci at gmail.com  Wed Jun  6 07:14:42 2007
From: epanepucci at gmail.com (Ezequiel Panepucci)
Date: Wed Jun  6 07:14:48 2007
Subject: [mod_python] form POST, redirect to GET, lost POST
Message-ID: <bf30be80706060414r124d991fi6a2282ca791b6a8@mail.gmail.com>

Client:
 * Firefox 2.0.0.3

Server:
 * httpd: Apache 2.2.4
 * mod_python: 3.3.1
 * python 2.5

Hi There,

I have a <form method="post" action="/pyweb"> (see below for
httpd.conf). The "/pyweb" maps to "/pyweb/index.py" which contains
a "def index(req)".

When I submit the form, my httpd access_log shows:
*.*,*,* - - [date] "POST /pyweb HTTP/1.1" 301 241
*.*,*,* - - [date] "GET /pyweb/ HTTP/1.1" 302 62

In the end, the "def index(req)" never sees what was POSTed.

I understand that the POST form is lost when the request is turned
into GET by misbehavior of my trusty browser (see section 10.3.2 in
http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html)

The workaround is to have action="/pyweb/" as opposed
to  action="/pyweb" so I prevent the "301".

Question: Is there a way to configure httpd or mod_python
so I do not have to worry about making sure that an ending
'/' is added to the action attribute of forms?

Thanks much for any comments.

Cheers,
   Zac

###########
########### httpd.conf
###########

Alias /pyweb /home/local/pyweb
<Directory "/home/local/pyweb">
    SetHandler python-program
    PythonHandler mod_python.publisher
    PythonDebug On

    Order allow,deny
    Allow from all
</Directory>
From graham.dumpleton at gmail.com  Wed Jun  6 07:28:15 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Wed Jun  6 07:28:21 2007
Subject: [mod_python] form POST, redirect to GET, lost POST
In-Reply-To: <bf30be80706060414r124d991fi6a2282ca791b6a8@mail.gmail.com>
References: <bf30be80706060414r124d991fi6a2282ca791b6a8@mail.gmail.com>
Message-ID: <88e286470706060428x5ec75e9fwce95d73aff609af0@mail.gmail.com>

On 06/06/07, Ezequiel Panepucci <epanepucci@gmail.com> wrote:
> Client:
>  * Firefox 2.0.0.3
>
> Server:
>  * httpd: Apache 2.2.4
>  * mod_python: 3.3.1
>  * python 2.5
>
> Hi There,
>
> I have a <form method="post" action="/pyweb"> (see below for
> httpd.conf). The "/pyweb" maps to "/pyweb/index.py" which contains
> a "def index(req)".
>
> When I submit the form, my httpd access_log shows:
> *.*,*,* - - [date] "POST /pyweb HTTP/1.1" 301 241
> *.*,*,* - - [date] "GET /pyweb/ HTTP/1.1" 302 62
>
> In the end, the "def index(req)" never sees what was POSTed.
>
> I understand that the POST form is lost when the request is turned
> into GET by misbehavior of my trusty browser (see section 10.3.2 in
> http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html)
>
> The workaround is to have action="/pyweb/" as opposed
> to  action="/pyweb" so I prevent the "301".
>
> Question: Is there a way to configure httpd or mod_python
> so I do not have to worry about making sure that an ending
> '/' is added to the action attribute of forms?
>
> Thanks much for any comments.

The trailing slash is actually very important. If your browser isn't
told that it must be there then all your relative page references can
be screwed up. Thus, you don't really have a choice but to ensure it
is there.

That said, I would highly discourage you from using a directory as a
target of a form post. Instead be explicit and use /pyweb/index.py
instead as target of form.

Any particular reason why you wouldn't want to do that?

Graham

> Cheers,
>    Zac
>
> ###########
> ########### httpd.conf
> ###########
>
> Alias /pyweb /home/local/pyweb
> <Directory "/home/local/pyweb">
>     SetHandler python-program
>     PythonHandler mod_python.publisher
>     PythonDebug On
>
>     Order allow,deny
>     Allow from all
> </Directory>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From epanepucci at gmail.com  Wed Jun  6 07:44:48 2007
From: epanepucci at gmail.com (Ezequiel Panepucci)
Date: Wed Jun  6 07:44:54 2007
Subject: [mod_python] form POST, redirect to GET, lost POST
In-Reply-To: <88e286470706060428x5ec75e9fwce95d73aff609af0@mail.gmail.com>
References: <bf30be80706060414r124d991fi6a2282ca791b6a8@mail.gmail.com>
	<88e286470706060428x5ec75e9fwce95d73aff609af0@mail.gmail.com>
Message-ID: <bf30be80706060444j4f38964cle5d67f95a0124cec@mail.gmail.com>

On 6/6/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> The trailing slash is actually very important. If your browser isn't
> told that it must be there then all your relative page references can
> be screwed up. Thus, you don't really have a choice but to ensure it
> is there.

Most of requests I issue are AJAX and I always use a full path
so I do not worry about relativity (unlike Einstein).

> That said, I would highly discourage you from using a directory as a
> target of a form post. Instead be explicit and use /pyweb/index.py
> instead as target of form.
>
> Any particular reason why you wouldn't want to do that?

No particular reason, I was just using the fact that "index" is
the default target when accessing a directory.

I understand now that this practice of using directory names can
bite me back in the future.

Thanks much for answering so quickly.

Regards,
  Zac
From labs at ixopusada.com  Wed Jun  6 10:03:04 2007
From: labs at ixopusada.com (Dirk van Oosterbosch, IR labs)
Date: Wed Jun  6 10:06:37 2007
Subject: [mod_python] Breaking things after upgrading MySQLdb (to 1.2.2)
Message-ID: <770EF919-5302-4C28-A74E-13E463C8A491@ixopusada.com>

Hi Guys,

I'm not sure if this is the right list for this problem, but I guess  
I try.

I just upgraded my MySQLdb python database module (from IIRC 1.2.0   
to 1.2.2). But now things break down. I'm getting the following error:
ImportError: Inappropriate file type for dynamic loading

If I import MySQLdb from the interpreter there seem no problems.
Python 2.4.1 (#2, Mar 31 2005, 00:05:10)
[GCC 3.3 20030304 (Apple Computer, Inc. build 1666)] on darwin
 >>> import MySQLdb
 >>> MySQLdb.version_info
(1, 2, 2, 'final', 0)

But when I try to run one of my web-apps the following error (pasted  
here below) gets printed in the log.

Does anybody of you know what I'm doing wrong or what I miss to fix  
this?

Thanks
dirk


[Wed Jun 06 15:46:13 2007] [notice] mod_python: Creating 8 session  
mutexes based on 6 max processes and 25 max threads.
[Wed Jun 06 15:46:13 2007] [notice] mod_python: using  
mutex_directory /tmp
[Wed Jun 06 15:46:13 2007] [notice] Apache/2.0.55 (Unix) mod_python/ 
3.3.0b Python/2.4.1 configured -- resuming normal operations
[Wed Jun 06 15:46:28 2007] [notice] mod_python (pid=5418,  
interpreter='sol740satelite.lan'): Importing module '/Users/dirk/ 
Sites/www/python/translate.py'
[Wed Jun 06 15:46:28 2007] [notice] mod_python (pid=5418,  
interpreter='sol740satelite.lan'): Importing module '/Users/dirk/ 
Sites/www/python/LocalConf.py'
[Wed Jun 06 15:46:28 2007] [error] [client ::1] mod_python (pid=5418,  
interpreter='sol740satelite.lan', phase='PythonTransHandler',  
handler='translate'): Application error
[Wed Jun 06 15:46:28 2007] [error] [client ::1] ServerName:  
'sol740satelite.lan'
[Wed Jun 06 15:46:28 2007] [error] [client ::1] DocumentRoot: '/Users/ 
dirk/Sites/www'
[Wed Jun 06 15:46:28 2007] [error] [client ::1] URI: '/admin/'
[Wed Jun 06 15:46:28 2007] [error] [client ::1] Location: None
[Wed Jun 06 15:46:28 2007] [error] [client ::1] Directory: None
[Wed Jun 06 15:46:28 2007] [error] [client ::1] Filename: None
[Wed Jun 06 15:46:28 2007] [error] [client ::1] PathInfo: None
[Wed Jun 06 15:46:28 2007] [error] [client ::1] Traceback (most  
recent call last):
[Wed Jun 06 15:46:28 2007] [error] [client ::1]   File "/Library/ 
Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/ 
mod_python/importer.py", line 1537, in HandlerDispatch\n     
default=default_handler, arg=req, silent=hlist.silent)
[Wed Jun 06 15:46:28 2007] [error] [client ::1]   File "/Library/ 
Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/ 
mod_python/importer.py", line 1202, in _process_target\n    module =  
import_module(module_name, path=path)
[Wed Jun 06 15:46:28 2007] [error] [client ::1]   File "/Library/ 
Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/ 
mod_python/importer.py", line 296, in import_module\n    log,  
import_path)
[Wed Jun 06 15:46:28 2007] [error] [client ::1]   File "/Library/ 
Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/ 
mod_python/importer.py", line 680, in import_module\n    execfile 
(file, module.__dict__)
[Wed Jun 06 15:46:28 2007] [error] [client ::1]   File "/Users/dirk/ 
Sites/www/python/translate.py", line 30, in ?\n    import LocalConf
[Wed Jun 06 15:46:28 2007] [error] [client ::1]   File "/Library/ 
Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/ 
mod_python/importer.py", line 991, in load_module\n    return  
_global_modules_cache.import_module(self.__file)
[Wed Jun 06 15:46:28 2007] [error] [client ::1]   File "/Library/ 
Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/ 
mod_python/importer.py", line 680, in import_module\n    execfile 
(file, module.__dict__)
[Wed Jun 06 15:46:28 2007] [error] [client ::1]   File "/Users/dirk/ 
Sites/www/python/LocalConf.py", line 22, in ?\n    import MySQLdb
[Wed Jun 06 15:46:28 2007] [error] [client ::1]   File "build/ 
bdist.darwin-8.9.0-Power_Macintosh/egg/MySQLdb/__init__.py", line 19,  
in ?
[Wed Jun 06 15:46:28 2007] [error] [client ::1]   File "build/ 
bdist.darwin-8.9.0-Power_Macintosh/egg/_mysql.py", line 7, in ?
[Wed Jun 06 15:46:28 2007] [error] [client ::1]   File "build/ 
bdist.darwin-8.9.0-Power_Macintosh/egg/_mysql.py", line 6, in  
__bootstrap__
[Wed Jun 06 15:46:28 2007] [error] [client ::1] ImportError:  
Inappropriate file type for dynamic loading



-----------------------------
Dirk van Oosterbosch
de Wittenstraat 225
1052 AT Amsterdam
the Netherlands

http://labs.ixopusada.com
-----------------------------


-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070606/9fa6a8fa/attachment-0001.html
From David.Bear at asu.edu  Wed Jun  6 12:10:07 2007
From: David.Bear at asu.edu (David Bear)
Date: Wed Jun  6 12:17:10 2007
Subject: [mod_python] simpleTAL and modpython
Message-ID: <20070606161007.GA11822@asu.edu>

I was wondering if anyone is using simpleTAL with modpython -- and if
there are any issues with it.

While Zope is a great BIG framework with lots of stuff, it really is
overkill for some stuff. But I miss TAL when I don't have zope. 

-- 
David Bear
phone: 	602-496-0424
fax: 	602-496-0955
College of Public Programs/ASU
University Center Rm 622
411 N Central
Phoenix, AZ 85007-0685
 "Beware the IP portfolio, everyone will be suspect of trespassing"
From graham.dumpleton at gmail.com  Wed Jun  6 19:31:40 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Wed Jun  6 19:31:47 2007
Subject: [mod_python] Breaking things after upgrading MySQLdb (to 1.2.2)
In-Reply-To: <770EF919-5302-4C28-A74E-13E463C8A491@ixopusada.com>
References: <770EF919-5302-4C28-A74E-13E463C8A491@ixopusada.com>
Message-ID: <88e286470706061631h12df422dq417ece1575e6fb2c@mail.gmail.com>

These sorts of issues on upgrades are usually cause by modules in PHP,
other Apache modules or Python MySQLdb client libraries having been
compiled against different versions of MySQLdb shared libraries.

You need to ensure you rebuild all such packages which use MySQLdb so
they all use the same version.

Graham

On 07/06/07, Dirk van Oosterbosch, IR labs <labs@ixopusada.com> wrote:
> Hi Guys,
>
> I'm not sure if this is the right list for this problem, but I guess I try.
>
> I just upgraded my MySQLdb python database module (from IIRC 1.2.0  to
> 1.2.2). But now things break down. I'm getting the following error:
> ImportError: Inappropriate file type for dynamic loading
>
> If I import MySQLdb from the interpreter there seem no problems.
> Python 2.4.1 (#2, Mar 31 2005, 00:05:10)
> [GCC 3.3 20030304 (Apple Computer, Inc. build 1666)] on darwin
> >>> import MySQLdb
> >>> MySQLdb.version_info
> (1, 2, 2, 'final', 0)
>
> But when I try to run one of my web-apps the following error (pasted here
> below) gets printed in the log.
>
> Does anybody of you know what I'm doing wrong or what I miss to fix this?
>
> Thanks
> dirk
>
>
> [Wed Jun 06 15:46:13 2007] [notice] mod_python: Creating 8 session mutexes
> based on 6 max processes and 25 max threads.
> [Wed Jun 06 15:46:13 2007] [notice] mod_python: using mutex_directory /tmp
> [Wed Jun 06 15:46:13 2007] [notice] Apache/2.0.55 (Unix) mod_python/3.3.0b
> Python/2.4.1 configured -- resuming normal operations
> [Wed Jun 06 15:46:28 2007] [notice] mod_python (pid=5418,
> interpreter='sol740satelite.lan'): Importing module
> '/Users/dirk/Sites/www/python/translate.py'
> [Wed Jun 06 15:46:28 2007] [notice] mod_python (pid=5418,
> interpreter='sol740satelite.lan'): Importing module
> '/Users/dirk/Sites/www/python/LocalConf.py'
> [Wed Jun 06 15:46:28 2007] [error] [client ::1] mod_python (pid=5418,
> interpreter='sol740satelite.lan', phase='PythonTransHandler',
> handler='translate'): Application error
> [Wed Jun 06 15:46:28 2007] [error] [client ::1] ServerName:
> 'sol740satelite.lan'
> [Wed Jun 06 15:46:28 2007] [error] [client ::1] DocumentRoot:
> '/Users/dirk/Sites/www'
> [Wed Jun 06 15:46:28 2007] [error] [client ::1] URI: '/admin/'
> [Wed Jun 06 15:46:28 2007] [error] [client ::1] Location: None
> [Wed Jun 06 15:46:28 2007] [error] [client ::1] Directory: None
> [Wed Jun 06 15:46:28 2007] [error] [client ::1] Filename: None
> [Wed Jun 06 15:46:28 2007] [error] [client ::1] PathInfo: None
> [Wed Jun 06 15:46:28 2007] [error] [client ::1] Traceback (most recent call
> last):
> [Wed Jun 06 15:46:28 2007] [error] [client ::1]   File
> "/Library/Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/mod_python/importer.py",
> line 1537, in HandlerDispatch\n    default=default_handler, arg=req,
> silent=hlist.silent)
> [Wed Jun 06 15:46:28 2007] [error] [client ::1]   File
> "/Library/Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/mod_python/importer.py",
> line 1202, in _process_target\n    module = import_module(module_name,
> path=path)
> [Wed Jun 06 15:46:28 2007] [error] [client ::1]   File
> "/Library/Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/mod_python/importer.py",
> line 296, in import_module\n    log, import_path)
> [Wed Jun 06 15:46:28 2007] [error] [client ::1]   File
> "/Library/Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/mod_python/importer.py",
> line 680, in import_module\n    execfile(file, module.__dict__)
> [Wed Jun 06 15:46:28 2007] [error] [client ::1]   File
> "/Users/dirk/Sites/www/python/translate.py", line 30, in
> ?\n    import LocalConf
> [Wed Jun 06 15:46:28 2007] [error] [client ::1]   File
> "/Library/Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/mod_python/importer.py",
> line 991, in load_module\n    return
> _global_modules_cache.import_module(self.__file)
> [Wed Jun 06 15:46:28 2007] [error] [client ::1]   File
> "/Library/Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/mod_python/importer.py",
> line 680, in import_module\n    execfile(file, module.__dict__)
> [Wed Jun 06 15:46:28 2007] [error] [client ::1]   File
> "/Users/dirk/Sites/www/python/LocalConf.py", line 22, in
> ?\n    import MySQLdb
> [Wed Jun 06 15:46:28 2007] [error] [client ::1]   File
> "build/bdist.darwin-8.9.0-Power_Macintosh/egg/MySQLdb/__init__.py",
> line 19, in ?
> [Wed Jun 06 15:46:28 2007] [error] [client ::1]   File
> "build/bdist.darwin-8.9.0-Power_Macintosh/egg/_mysql.py",
> line 7, in ?
> [Wed Jun 06 15:46:28 2007] [error] [client ::1]   File
> "build/bdist.darwin-8.9.0-Power_Macintosh/egg/_mysql.py",
> line 6, in __bootstrap__
> [Wed Jun 06 15:46:28 2007] [error] [client ::1] ImportError: Inappropriate
> file type for dynamic loading
>
>
>
> -----------------------------
> Dirk van Oosterbosch
> de Wittenstraat 225
> 1052 AT Amsterdam
> the Netherlands
>
> http://labs.ixopusada.com
> -----------------------------
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
From rogerb at rogerbinns.com  Thu Jun  7 02:54:20 2007
From: rogerb at rogerbinns.com (Roger Binns)
Date: Thu Jun  7 02:54:24 2007
Subject: [mod_python] simpleTAL and modpython
In-Reply-To: <20070606161007.GA11822@asu.edu>
References: <20070606161007.GA11822@asu.edu>
Message-ID: <4667AB9C.5050607@rogerbinns.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

David Bear wrote:
> I was wondering if anyone is using simpleTAL with modpython -- and if
> there are any issues with it.
> 
> While Zope is a great BIG framework with lots of stuff, it really is
> overkill for some stuff. But I miss TAL when I don't have zope. 

I've been using Genshi from http://genshi.edgewall.org/ and it works
wonderfully without the need for any other framework.  I've never used
TAL before but a quick look through the docs leads me to believe that
all the same features are in Genshi and in most cases in exactly the
same way.

Roger

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)

iD8DBQFGZ6ubmOOfHg372QQRAo9eAJwP9b4BSl6XWg60K0W/wUEARxZ3AACg4mkF
F0x9KBh2ds8XY03uCQp3+Pc=
=gqRi
-----END PGP SIGNATURE-----
From labs at ixopusada.com  Thu Jun  7 04:37:45 2007
From: labs at ixopusada.com (Dirk van Oosterbosch, IR labs)
Date: Thu Jun  7 04:41:41 2007
Subject: [mod_python] Breaking things after upgrading MySQLdb (to 1.2.2)
In-Reply-To: <88e286470706061631h12df422dq417ece1575e6fb2c@mail.gmail.com>
References: <770EF919-5302-4C28-A74E-13E463C8A491@ixopusada.com>
	<88e286470706061631h12df422dq417ece1575e6fb2c@mail.gmail.com>
Message-ID: <7CE349CC-707C-481C-B0D7-A6C8DD605134@ixopusada.com>

Thanks,

but I still won't know what would have caused this.
I'm not running PHP (& never installed modules for it)
I don't have any other Apache modules that I know of that could be  
using MySQLdb.

After I restarted my machine, it first gave:

[Thu Jun 07 10:05:54 2007] [error] [client ::1] ExtractionError:  
Can't extract file(s) to egg cache\n\nThe following error occurred  
while trying to extract file(s) to the Python egg\ncache:\n\n  [Errno  
13] Permission denied: '/var/empty/.python-eggs'\n\nThe Python egg  
cache directory is currently set to:\n\n  /var/empty/.python-eggs\n 
\nPerhaps your account does not have write access to this directory?   
You can\nchange the cache directory by setting the PYTHON_EGG_CACHE  
environment\nvariable to point to an accessible directory.\n

(the full log details follow below)

Then I stop & started Apache, and the error was (again):

[Thu Jun 07 10:06:14 2007] [error] [client ::1] ImportError:  
Inappropriate file type for dynamic loading

So I decided that maybe MySQLdb 1.2.2 is too new for me, and I  
installed MySQLdb 1.2.1_p2
However, I am afraid that MySQLdb 1.2.2. is still there:
Python 2.4.1 (#2, Mar 31 2005, 00:05:10)
[GCC 3.3 20030304 (Apple Computer, Inc. build 1666)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
 >>> import MySQLdb
 >>> MySQLdb.version_info
(1, 2, 2, 'final', 0)

How could I revert safely to MySQLdb 1.2.1_p2 ?
Or what would I need to rebuild to get things working again? Apache?  
python?


dirk



On 7-jun-2007, at 1:31, Graham Dumpleton wrote:

> These sorts of issues on upgrades are usually cause by modules in PHP,
> other Apache modules or Python MySQLdb client libraries having been
> compiled against different versions of MySQLdb shared libraries.
>
> You need to ensure you rebuild all such packages which use MySQLdb so
> they all use the same version.
>
> Graham



after restart

[Thu Jun 07 10:05:54 2007] [notice] mod_python (pid=224,  
interpreter='sol740satelite.lan'): Importing module '/Users/dirk/ 
Sites/www/python/translate.py'
[Thu Jun 07 10:05:54 2007] [notice] mod_python (pid=224,  
interpreter='sol740satelite.lan'): Importing module '/Users/dirk/ 
Sites/www/python/LocalConf.py'
[Thu Jun 07 10:05:54 2007] [error] [client ::1] mod_python (pid=224,  
interpreter='sol740satelite.lan', phase='PythonTransHandler',  
handler='translate'): Application error
[Thu Jun 07 10:05:54 2007] [error] [client ::1] ServerName:  
'sol740satelite.lan'
[Thu Jun 07 10:05:54 2007] [error] [client ::1] DocumentRoot: '/Users/ 
dirk/Sites/www'
[Thu Jun 07 10:05:54 2007] [error] [client ::1] URI: '/admin/'
[Thu Jun 07 10:05:54 2007] [error] [client ::1] Location: None
[Thu Jun 07 10:05:54 2007] [error] [client ::1] Directory: None
[Thu Jun 07 10:05:54 2007] [error] [client ::1] Filename: None
[Thu Jun 07 10:05:54 2007] [error] [client ::1] PathInfo: None
[Thu Jun 07 10:05:54 2007] [error] [client ::1] Traceback (most  
recent call last):
[Thu Jun 07 10:05:54 2007] [error] [client ::1]   File "/Library/ 
Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/ 
mod_python/importer.py", line 1537, in HandlerDispatch\n     
default=default_handler, arg=req, silent=hlist.silent)
[Thu Jun 07 10:05:54 2007] [error] [client ::1]   File "/Library/ 
Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/ 
mod_python/importer.py", line 1202, in _process_target\n    module =  
import_module(module_name, path=path)
[Thu Jun 07 10:05:54 2007] [error] [client ::1]   File "/Library/ 
Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/ 
mod_python/importer.py", line 296, in import_module\n    log,  
import_path)
[Thu Jun 07 10:05:54 2007] [error] [client ::1]   File "/Library/ 
Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/ 
mod_python/importer.py", line 680, in import_module\n    execfile 
(file, module.__dict__)
[Thu Jun 07 10:05:54 2007] [error] [client ::1]   File "/Users/dirk/ 
Sites/www/python/translate.py", line 30, in ?\n    import LocalConf
[Thu Jun 07 10:05:54 2007] [error] [client ::1]   File "/Library/ 
Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/ 
mod_python/importer.py", line 991, in load_module\n    return  
_global_modules_cache.import_module(self.__file)
[Thu Jun 07 10:05:54 2007] [error] [client ::1]   File "/Library/ 
Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/ 
mod_python/importer.py", line 680, in import_module\n    execfile 
(file, module.__dict__)
[Thu Jun 07 10:05:54 2007] [error] [client ::1]   File "/Users/dirk/ 
Sites/www/python/LocalConf.py", line 22, in ?\n    import MySQLdb
[Thu Jun 07 10:05:54 2007] [error] [client ::1]   File "build/ 
bdist.darwin-8.9.0-Power_Macintosh/egg/MySQLdb/__init__.py", line 19,  
in ?
[Thu Jun 07 10:05:54 2007] [error] [client ::1]   File "build/ 
bdist.darwin-8.9.0-Power_Macintosh/egg/_mysql.py", line 7, in ?
[Thu Jun 07 10:05:54 2007] [error] [client ::1]   File "build/ 
bdist.darwin-8.9.0-Power_Macintosh/egg/_mysql.py", line 4, in  
__bootstrap__
[Thu Jun 07 10:05:54 2007] [error] [client ::1]   File "/Library/ 
Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/ 
setuptools-0.6c5-py2.4.egg/pkg_resources.py", line 799, in  
resource_filename\n    return get_provider 
(package_or_requirement).get_resource_filename(
[Thu Jun 07 10:05:54 2007] [error] [client ::1]   File "/Library/ 
Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/ 
setuptools-0.6c5-py2.4.egg/pkg_resources.py", line 1228, in  
get_resource_filename\n    self._extract_resource(manager,  
self._eager_to_zip(name))
[Thu Jun 07 10:05:54 2007] [error] [client ::1]   File "/Library/ 
Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/ 
setuptools-0.6c5-py2.4.egg/pkg_resources.py", line 1249, in  
_extract_resource\n    real_path = manager.get_cache_path(
[Thu Jun 07 10:05:54 2007] [error] [client ::1]   File "/Library/ 
Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/ 
setuptools-0.6c5-py2.4.egg/pkg_resources.py", line 880, in  
get_cache_path\n    self.extraction_error()
[Thu Jun 07 10:05:54 2007] [error] [client ::1]   File "/Library/ 
Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/ 
setuptools-0.6c5-py2.4.egg/pkg_resources.py", line 846, in  
extraction_error\n    raise err
[Thu Jun 07 10:05:54 2007] [error] [client ::1] ExtractionError:  
Can't extract file(s) to egg cache\n\nThe following error occurred  
while trying to extract file(s) to the Python egg\ncache:\n\n  [Errno  
13] Permission denied: '/var/empty/.python-eggs'\n\nThe Python egg  
cache directory is currently set to:\n\n  /var/empty/.python-eggs\n 
\nPerhaps your account does not have write access to this directory?   
You can\nchange the cache directory by setting the PYTHON_EGG_CACHE  
environment\nvariable to point to an accessible directory.\n

after apache stop & start

[Thu Jun 07 10:06:08 2007] [notice] mod_python: Creating 8 session  
mutexes based on 6 max processes and 25 max threads.
[Thu Jun 07 10:06:08 2007] [notice] mod_python: using  
mutex_directory /tmp
[Thu Jun 07 10:06:08 2007] [notice] Apache/2.0.55 (Unix) mod_python/ 
3.3.0b Python/2.4.1 configured -- resuming normal operations
[Thu Jun 07 10:06:14 2007] [notice] mod_python (pid=504,  
interpreter='sol740satelite.lan'): Importing module '/Users/dirk/ 
Sites/www/python/translate.py'
[Thu Jun 07 10:06:14 2007] [notice] mod_python (pid=504,  
interpreter='sol740satelite.lan'): Importing module '/Users/dirk/ 
Sites/www/python/LocalConf.py'
[Thu Jun 07 10:06:14 2007] [error] [client ::1] mod_python (pid=504,  
interpreter='sol740satelite.lan', phase='PythonTransHandler',  
handler='translate'): Application error
[Thu Jun 07 10:06:14 2007] [error] [client ::1] ServerName:  
'sol740satelite.lan'
[Thu Jun 07 10:06:14 2007] [error] [client ::1] DocumentRoot: '/Users/ 
dirk/Sites/www'
[Thu Jun 07 10:06:14 2007] [error] [client ::1] URI: '/admin/'
[Thu Jun 07 10:06:14 2007] [error] [client ::1] Location: None
[Thu Jun 07 10:06:14 2007] [error] [client ::1] Directory: None
[Thu Jun 07 10:06:14 2007] [error] [client ::1] Filename: None
[Thu Jun 07 10:06:14 2007] [error] [client ::1] PathInfo: None
[Thu Jun 07 10:06:14 2007] [error] [client ::1] Traceback (most  
recent call last):
[Thu Jun 07 10:06:14 2007] [error] [client ::1]   File "/Library/ 
Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/ 
mod_python/importer.py", line 1537, in HandlerDispatch\n     
default=default_handler, arg=req, silent=hlist.silent)
[Thu Jun 07 10:06:14 2007] [error] [client ::1]   File "/Library/ 
Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/ 
mod_python/importer.py", line 1202, in _process_target\n    module =  
import_module(module_name, path=path)
[Thu Jun 07 10:06:14 2007] [error] [client ::1]   File "/Library/ 
Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/ 
mod_python/importer.py", line 296, in import_module\n    log,  
import_path)
[Thu Jun 07 10:06:14 2007] [error] [client ::1]   File "/Library/ 
Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/ 
mod_python/importer.py", line 680, in import_module\n    execfile 
(file, module.__dict__)
[Thu Jun 07 10:06:14 2007] [error] [client ::1]   File "/Users/dirk/ 
Sites/www/python/translate.py", line 30, in ?\n    import LocalConf
[Thu Jun 07 10:06:14 2007] [error] [client ::1]   File "/Library/ 
Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/ 
mod_python/importer.py", line 991, in load_module\n    return  
_global_modules_cache.import_module(self.__file)
[Thu Jun 07 10:06:14 2007] [error] [client ::1]   File "/Library/ 
Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/ 
mod_python/importer.py", line 680, in import_module\n    execfile 
(file, module.__dict__)
[Thu Jun 07 10:06:14 2007] [error] [client ::1]   File "/Users/dirk/ 
Sites/www/python/LocalConf.py", line 22, in ?\n    import MySQLdb
[Thu Jun 07 10:06:14 2007] [error] [client ::1]   File "build/ 
bdist.darwin-8.9.0-Power_Macintosh/egg/MySQLdb/__init__.py", line 19,  
in ?
[Thu Jun 07 10:06:14 2007] [error] [client ::1]   File "build/ 
bdist.darwin-8.9.0-Power_Macintosh/egg/_mysql.py", line 7, in ?
[Thu Jun 07 10:06:14 2007] [error] [client ::1]   File "build/ 
bdist.darwin-8.9.0-Power_Macintosh/egg/_mysql.py", line 6, in  
__bootstrap__
[Thu Jun 07 10:06:14 2007] [error] [client ::1] ImportError:  
Inappropriate file type for dynamic loading


-----------------------------
Dirk van Oosterbosch
de Wittenstraat 225
1052 AT Amsterdam
the Netherlands

http://labs.ixopusada.com
-----------------------------


-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070607/e93cb632/attachment-0001.html
From graham.dumpleton at gmail.com  Thu Jun  7 07:27:43 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu Jun  7 07:27:51 2007
Subject: [mod_python] Breaking things after upgrading MySQLdb (to 1.2.2)
In-Reply-To: <7CE349CC-707C-481C-B0D7-A6C8DD605134@ixopusada.com>
References: <770EF919-5302-4C28-A74E-13E463C8A491@ixopusada.com>
	<88e286470706061631h12df422dq417ece1575e6fb2c@mail.gmail.com>
	<7CE349CC-707C-481C-B0D7-A6C8DD605134@ixopusada.com>
Message-ID: <88e286470706070427y5d1ebfcckdd3f4979778f176a@mail.gmail.com>

On 07/06/07, Dirk van Oosterbosch, IR labs <labs@ixopusada.com> wrote:
>
> Thanks,
>
> but I still won't know what would have caused this.
> I'm not running PHP (& never installed modules for it)
> I don't have any other Apache modules that I know of that could be using
> MySQLdb.
>
> After I restarted my machine, it first gave:
>
> [Thu Jun 07 10:05:54 2007] [error] [client ::1] ExtractionError: Can't
> extract file(s) to egg cache\n\nThe following error occurred while trying to
> extract file(s) to the Python egg\ncache:\n\n  [Errno 13] Permission denied:
> '/var/empty/.python-eggs'\n\nThe Python egg cache directory
> is currently set to:\n\n
> /var/empty/.python-eggs\n\nPerhaps your account does not
> have write access to this directory?  You can\nchange the cache directory by
> setting the PYTHON_EGG_CACHE environment\nvariable to point to an accessible
> directory.\n

To get rid of this problem, create a new Python code module somewhere
containing:

  import os
  os.environ['PYTHON_EGG_CACHE'] = '/some/path'

The directory /some/path must be writable to the user that Apache runs as.

Then add to Apache global configuration:

  PythonImport interpreter_name module_name

Where interpreter_name is the name of the interpreter your mod_python
application is running in, found by query req.interpreter in a request
handler. And module_name is the name of the module you created above.
If that module not in standard place, if using mod_python 3.3, use
absolute path to code file instead.

> (the full log details follow below)
>
> Then I stop & started Apache, and the error was (again):
>
> [Thu Jun 07 10:06:14 2007] [error] [client ::1] ImportError: Inappropriate
> file type for dynamic loading
>
> So I decided that maybe MySQLdb 1.2.2 is too new for me, and I installed
> MySQLdb 1.2.1_p2
> However, I am afraid that MySQLdb 1.2.2. is still there:
> Python 2.4.1 (#2, Mar 31 2005, 00:05:10)
> [GCC 3.3 20030304 (Apple Computer, Inc. build 1666)] on darwin
> Type "help", "copyright", "credits" or "license" for more information.
> >>> import MySQLdb
> >>> MySQLdb.version_info
> (1, 2, 2, 'final', 0)
>
> How could I revert safely to MySQLdb 1.2.1_p2 ?
> Or what would I need to rebuild to get things working again? Apache? python?

Work out where it is installed using:

  MySQLdb.__file__

then explicitly remove it and start over.

If it is one of these horrible Python eggs, you may have to fiddle
with the eggs .pth file in site-packages to remove the reference to
it.

Graham

>
>
> On 7-jun-2007, at 1:31, Graham Dumpleton wrote:
>
>
> These sorts of issues on upgrades are usually cause by modules in PHP,
>
> other Apache modules or Python MySQLdb client libraries having been
>
> compiled against different versions of MySQLdb shared libraries.
>
>
>
>
> You need to ensure you rebuild all such packages which use MySQLdb so
>
> they all use the same version.
>
>
>
>
> Graham
>
>
> after restart
>
> [Thu Jun 07 10:05:54 2007] [notice] mod_python (pid=224,
> interpreter='sol740satelite.lan'): Importing module
> '/Users/dirk/Sites/www/python/translate.py'
> [Thu Jun 07 10:05:54 2007] [notice] mod_python (pid=224,
> interpreter='sol740satelite.lan'): Importing module
> '/Users/dirk/Sites/www/python/LocalConf.py'
> [Thu Jun 07 10:05:54 2007] [error] [client ::1] mod_python (pid=224,
> interpreter='sol740satelite.lan', phase='PythonTransHandler',
> handler='translate'): Application error
> [Thu Jun 07 10:05:54 2007] [error] [client ::1] ServerName:
> 'sol740satelite.lan'
> [Thu Jun 07 10:05:54 2007] [error] [client ::1] DocumentRoot:
> '/Users/dirk/Sites/www'
> [Thu Jun 07 10:05:54 2007] [error] [client ::1] URI: '/admin/'
> [Thu Jun 07 10:05:54 2007] [error] [client ::1] Location: None
> [Thu Jun 07 10:05:54 2007] [error] [client ::1] Directory: None
> [Thu Jun 07 10:05:54 2007] [error] [client ::1] Filename: None
> [Thu Jun 07 10:05:54 2007] [error] [client ::1] PathInfo: None
> [Thu Jun 07 10:05:54 2007] [error] [client ::1] Traceback (most recent call
> last):
> [Thu Jun 07 10:05:54 2007] [error] [client ::1]   File
> "/Library/Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/mod_python/importer.py",
> line 1537, in HandlerDispatch\n    default=default_handler, arg=req,
> silent=hlist.silent)
> [Thu Jun 07 10:05:54 2007] [error] [client ::1]   File
> "/Library/Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/mod_python/importer.py",
> line 1202, in _process_target\n    module = import_module(module_name,
> path=path)
> [Thu Jun 07 10:05:54 2007] [error] [client ::1]   File
> "/Library/Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/mod_python/importer.py",
> line 296, in import_module\n    log, import_path)
> [Thu Jun 07 10:05:54 2007] [error] [client ::1]   File
> "/Library/Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/mod_python/importer.py",
> line 680, in import_module\n    execfile(file, module.__dict__)
> [Thu Jun 07 10:05:54 2007] [error] [client ::1]   File
> "/Users/dirk/Sites/www/python/translate.py", line 30, in
> ?\n    import LocalConf
> [Thu Jun 07 10:05:54 2007] [error] [client ::1]   File
> "/Library/Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/mod_python/importer.py",
> line 991, in load_module\n    return
> _global_modules_cache.import_module(self.__file)
> [Thu Jun 07 10:05:54 2007] [error] [client ::1]   File
> "/Library/Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/mod_python/importer.py",
> line 680, in import_module\n    execfile(file, module.__dict__)
> [Thu Jun 07 10:05:54 2007] [error] [client ::1]   File
> "/Users/dirk/Sites/www/python/LocalConf.py", line 22, in
> ?\n    import MySQLdb
> [Thu Jun 07 10:05:54 2007] [error] [client ::1]   File
> "build/bdist.darwin-8.9.0-Power_Macintosh/egg/MySQLdb/__init__.py",
> line 19, in ?
> [Thu Jun 07 10:05:54 2007] [error] [client ::1]   File
> "build/bdist.darwin-8.9.0-Power_Macintosh/egg/_mysql.py",
> line 7, in ?
> [Thu Jun 07 10:05:54 2007] [error] [client ::1]   File
> "build/bdist.darwin-8.9.0-Power_Macintosh/egg/_mysql.py",
> line 4, in __bootstrap__
> [Thu Jun 07 10:05:54 2007] [error] [client ::1]   File
> "/Library/Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/setuptools-0.6c5-py2.4.egg/pkg_resources.py",
> line 799, in resource_filename\n    return
> get_provider(package_or_requirement).get_resource_filename(
> [Thu Jun 07 10:05:54 2007] [error] [client ::1]   File
> "/Library/Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/setuptools-0.6c5-py2.4.egg/pkg_resources.py",
> line 1228, in get_resource_filename\n    self._extract_resource(manager,
> self._eager_to_zip(name))
> [Thu Jun 07 10:05:54 2007] [error] [client ::1]   File
> "/Library/Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/setuptools-0.6c5-py2.4.egg/pkg_resources.py",
> line 1249, in _extract_resource\n    real_path = manager.get_cache_path(
> [Thu Jun 07 10:05:54 2007] [error] [client ::1]   File
> "/Library/Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/setuptools-0.6c5-py2.4.egg/pkg_resources.py",
> line 880, in get_cache_path\n    self.extraction_error()
> [Thu Jun 07 10:05:54 2007] [error] [client ::1]   File
> "/Library/Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/setuptools-0.6c5-py2.4.egg/pkg_resources.py",
> line 846, in extraction_error\n    raise err
> [Thu Jun 07 10:05:54 2007] [error] [client ::1] ExtractionError: Can't
> extract file(s) to egg cache\n\nThe following error occurred while trying to
> extract file(s) to the Python egg\ncache:\n\n  [Errno 13] Permission denied:
> '/var/empty/.python-eggs'\n\nThe Python egg cache directory
> is currently set to:\n\n
> /var/empty/.python-eggs\n\nPerhaps your account does not
> have write access to this directory?  You can\nchange the cache directory by
> setting the PYTHON_EGG_CACHE environment\nvariable to point to an accessible
> directory.\n
>
> after apache stop & start
>
> [Thu Jun 07 10:06:08 2007] [notice] mod_python: Creating 8 session mutexes
> based on 6 max processes and 25 max threads.
> [Thu Jun 07 10:06:08 2007] [notice] mod_python: using mutex_directory /tmp
> [Thu Jun 07 10:06:08 2007] [notice] Apache/2.0.55 (Unix) mod_python/3.3.0b
> Python/2.4.1 configured -- resuming normal operations
> [Thu Jun 07 10:06:14 2007] [notice] mod_python (pid=504,
> interpreter='sol740satelite.lan'): Importing module
> '/Users/dirk/Sites/www/python/translate.py'
> [Thu Jun 07 10:06:14 2007] [notice] mod_python (pid=504,
> interpreter='sol740satelite.lan'): Importing module
> '/Users/dirk/Sites/www/python/LocalConf.py'
> [Thu Jun 07 10:06:14 2007] [error] [client ::1] mod_python (pid=504,
> interpreter='sol740satelite.lan', phase='PythonTransHandler',
> handler='translate'): Application error
> [Thu Jun 07 10:06:14 2007] [error] [client ::1] ServerName:
> 'sol740satelite.lan'
> [Thu Jun 07 10:06:14 2007] [error] [client ::1] DocumentRoot:
> '/Users/dirk/Sites/www'
> [Thu Jun 07 10:06:14 2007] [error] [client ::1] URI: '/admin/'
> [Thu Jun 07 10:06:14 2007] [error] [client ::1] Location: None
> [Thu Jun 07 10:06:14 2007] [error] [client ::1] Directory: None
> [Thu Jun 07 10:06:14 2007] [error] [client ::1] Filename: None
> [Thu Jun 07 10:06:14 2007] [error] [client ::1] PathInfo: None
> [Thu Jun 07 10:06:14 2007] [error] [client ::1] Traceback (most recent call
> last):
> [Thu Jun 07 10:06:14 2007] [error] [client ::1]   File
> "/Library/Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/mod_python/importer.py",
> line 1537, in HandlerDispatch\n    default=default_handler, arg=req,
> silent=hlist.silent)
> [Thu Jun 07 10:06:14 2007] [error] [client ::1]   File
> "/Library/Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/mod_python/importer.py",
> line 1202, in _process_target\n    module = import_module(module_name,
> path=path)
> [Thu Jun 07 10:06:14 2007] [error] [client ::1]   File
> "/Library/Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/mod_python/importer.py",
> line 296, in import_module\n    log, import_path)
> [Thu Jun 07 10:06:14 2007] [error] [client ::1]   File
> "/Library/Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/mod_python/importer.py",
> line 680, in import_module\n    execfile(file, module.__dict__)
> [Thu Jun 07 10:06:14 2007] [error] [client ::1]   File
> "/Users/dirk/Sites/www/python/translate.py", line 30, in
> ?\n    import LocalConf
> [Thu Jun 07 10:06:14 2007] [error] [client ::1]   File
> "/Library/Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/mod_python/importer.py",
> line 991, in load_module\n    return
> _global_modules_cache.import_module(self.__file)
> [Thu Jun 07 10:06:14 2007] [error] [client ::1]   File
> "/Library/Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/mod_python/importer.py",
> line 680, in import_module\n    execfile(file, module.__dict__)
> [Thu Jun 07 10:06:14 2007] [error] [client ::1]   File
> "/Users/dirk/Sites/www/python/LocalConf.py", line 22, in
> ?\n    import MySQLdb
> [Thu Jun 07 10:06:14 2007] [error] [client ::1]   File
> "build/bdist.darwin-8.9.0-Power_Macintosh/egg/MySQLdb/__init__.py",
> line 19, in ?
> [Thu Jun 07 10:06:14 2007] [error] [client ::1]   File
> "build/bdist.darwin-8.9.0-Power_Macintosh/egg/_mysql.py",
> line 7, in ?
> [Thu Jun 07 10:06:14 2007] [error] [client ::1]   File
> "build/bdist.darwin-8.9.0-Power_Macintosh/egg/_mysql.py",
> line 6, in __bootstrap__
> [Thu Jun 07 10:06:14 2007] [error] [client ::1] ImportError: Inappropriate
> file type for dynamic loading
>
>
> -----------------------------
> Dirk van Oosterbosch
> de Wittenstraat 225
> 1052 AT Amsterdam
> the Netherlands
>
> http://labs.ixopusada.com
> -----------------------------
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
From labs at ixopusada.com  Thu Jun  7 09:43:20 2007
From: labs at ixopusada.com (Dirk van Oosterbosch, IR labs)
Date: Thu Jun  7 09:46:40 2007
Subject: [mod_python] Breaking things after upgrading MySQLdb (to 1.2.2)
In-Reply-To: <88e286470706070427y5d1ebfcckdd3f4979778f176a@mail.gmail.com>
References: <770EF919-5302-4C28-A74E-13E463C8A491@ixopusada.com>
	<88e286470706061631h12df422dq417ece1575e6fb2c@mail.gmail.com>
	<7CE349CC-707C-481C-B0D7-A6C8DD605134@ixopusada.com>
	<88e286470706070427y5d1ebfcckdd3f4979778f176a@mail.gmail.com>
Message-ID: <39EBA100-8EF0-4D2C-8B4A-8600D2F486CB@ixopusada.com>

Hi,

I'm not sure I follow, or why all this is necessary.

First, what should be the interpreter_name you speak of? 'python'? / 
usr/local/bin/python'? sol740satelite.lan' (as is stated in the  
logs ...(pid=553, interpreter='sol740satelite.lan') ) ?

Second, this directory that nobody (the User defined in httpd.conf)  
can write to, could that just me /var/tmp ?

Thirdly. Why is this necessary? Does this PythonImport statement (and  
the module) has to stay there? Or is this just the last, obscure,  
step in the installation process?

----

BTW, in the meantime, I decided to upgrade to Python 2.5.1, because I  
thought that might fix my problems. Unfortunately, it did not. But it  
did change the error messages I got returned. ;-)
Still, after I restart my powerBook, the ExtractionError, with the  
PYTHON_EGG_CACHE setting pops up.
And then when I stop/start apache (without yet putting this module in  
place, because I don't know what to use as interpreter_name), the  
following error gets there (full log transscript below):

ImportError: dlopen(/Users/dirk/.python-eggs/MySQL_python-1.2.2-py2.5- 
macosx-10.3-fat.egg-tmp/_mysql.so, 2): image not found

I noticed while building MySQLdb, it said something about ppc / i386  
incompatibility, but since it continued building I ignored this  
warning. Shouldn't I? (Cant recall the exact message, and lost the  
information in that Terminal window after the last restart, obviously).

Also I noticed that the .py modules I use with mod_python (my web- 
app) start with #!/usr/bin/python, but there exists no python binary  
(or symlink) in /usr/bin.
% which python
/usr/local/bin/python
% ls /usr/local/bin/python
/usr/local/bin/python@ -> ../../../Library/Frameworks/ 
Python.framework/Versions/2.5/bin/python

Should I copy the /usr/local/bin/python symlink to /usr/bin/python  
aswell?


(
Finally (again), the thing to note,  is that these problems with  
importing MySQLdb only happen from within Apache/mod_python. Not from  
the interpreter.
% python
Python 2.5.1 (r251:54869, Apr 18 2007, 22:08:04)
[GCC 4.0.1 (Apple Computer, Inc. build 5367)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
 >>> import MySQLdb

I read on the forum of MySQLdb at sourceforge, that others also had  
this problem with 'ImportError: dlopen(/Users/dirk/.python-eggs/...):  
image not found'. But they seem to experience this from the  
interpreter as well.
)


dirk



On 7-jun-2007, at 13:27, Graham Dumpleton wrote:

> To get rid of this problem, create a new Python code module somewhere
> containing:
>
>  import os
>  os.environ['PYTHON_EGG_CACHE'] = '/some/path'
>
> The directory /some/path must be writable to the user that Apache  
> runs as.
>
> Then add to Apache global configuration:
>
>  PythonImport interpreter_name module_name
>
> Where interpreter_name is the name of the interpreter your mod_python
> application is running in, found by query req.interpreter in a request
> handler. And module_name is the name of the module you created above.
> If that module not in standard place, if using mod_python 3.3, use
> absolute path to code file instead.

> On 07/06/07, Dirk van Oosterbosch, IR labs <labs@ixopusada.com> wrote:
>
>>
>> Thanks,
>>
>> but I still won't know what would have caused this.
>> I'm not running PHP (& never installed modules for it)
>> I don't have any other Apache modules that I know of that could be  
>> using
>> MySQLdb.
>>
>> After I restarted my machine, it first gave:
>>
>> [Thu Jun 07 10:05:54 2007] [error] [client ::1] ExtractionError:  
>> Can't
>> extract file(s) to egg cache\n\nThe following error occurred while  
>> trying to
>> extract file(s) to the Python egg\ncache:\n\n  [Errno 13]  
>> Permission denied:
>> '/var/empty/.python-eggs'\n\nThe Python egg cache directory
>> is currently set to:\n\n
>> /var/empty/.python-eggs\n\nPerhaps your account does not
>> have write access to this directory?  You can\nchange the cache  
>> directory by
>> setting the PYTHON_EGG_CACHE environment\nvariable to point to an  
>> accessible
>> directory.\n




[Thu Jun 07 15:09:12 2007] [notice] mod_python: Creating 8 session  
mutexes based on 6 max processes and 25 max threads.
[Thu Jun 07 15:09:12 2007] [notice] mod_python: using  
mutex_directory /tmp
[Thu Jun 07 15:09:12 2007] [notice] Apache/2.0.55 (Unix) mod_python/ 
3.3.1 Python/2.5.1 configured -- resuming normal operations
[Thu Jun 07 15:09:20 2007] [notice] mod_python (pid=553,  
interpreter='sol740satelite.lan'): Importing module '/Users/dirk/ 
Sites/www/python/translate.py'
[Thu Jun 07 15:09:20 2007] [notice] mod_python (pid=553,  
interpreter='sol740satelite.lan'): Importing module '/Users/dirk/ 
Sites/www/python/LocalConf.py'
[Thu Jun 07 15:09:20 2007] [error] [client ::1] mod_python (pid=553,  
interpreter='sol740satelite.lan', phase='PythonTransHandler',  
handler='translate'): Application error
[Thu Jun 07 15:09:20 2007] [error] [client ::1] ServerName:  
'sol740satelite.lan'
[Thu Jun 07 15:09:20 2007] [error] [client ::1] DocumentRoot: '/Users/ 
dirk/Sites/www'
[Thu Jun 07 15:09:20 2007] [error] [client ::1] URI: '/'
[Thu Jun 07 15:09:20 2007] [error] [client ::1] Location: None
[Thu Jun 07 15:09:20 2007] [error] [client ::1] Directory: None
[Thu Jun 07 15:09:20 2007] [error] [client ::1] Filename: None
[Thu Jun 07 15:09:20 2007] [error] [client ::1] PathInfo: None
[Thu Jun 07 15:09:20 2007] [error] [client ::1] Traceback (most  
recent call last):
[Thu Jun 07 15:09:20 2007] [error] [client ::1]   File "/Library/ 
Frameworks/Python.framework/Versions/2.5/lib/python2.5/site-packages/ 
mod_python/importer.py", line 1537, in HandlerDispatch\n     
default=default_handler, arg=req, silent=hlist.silent)
[Thu Jun 07 15:09:20 2007] [error] [client ::1]   File "/Library/ 
Frameworks/Python.framework/Versions/2.5/lib/python2.5/site-packages/ 
mod_python/importer.py", line 1202, in _process_target\n    module =  
import_module(module_name, path=path)
[Thu Jun 07 15:09:20 2007] [error] [client ::1]   File "/Library/ 
Frameworks/Python.framework/Versions/2.5/lib/python2.5/site-packages/ 
mod_python/importer.py", line 296, in import_module\n    log,  
import_path)
[Thu Jun 07 15:09:20 2007] [error] [client ::1]   File "/Library/ 
Frameworks/Python.framework/Versions/2.5/lib/python2.5/site-packages/ 
mod_python/importer.py", line 680, in import_module\n    execfile 
(file, module.__dict__)
[Thu Jun 07 15:09:20 2007] [error] [client ::1]   File "/Users/dirk/ 
Sites/www/python/translate.py", line 31, in <module>\n    from  
LocalConf import log_file, path_wwwroot
[Thu Jun 07 15:09:20 2007] [error] [client ::1]   File "/Library/ 
Frameworks/Python.framework/Versions/2.5/lib/python2.5/site-packages/ 
mod_python/importer.py", line 991, in load_module\n    return  
_global_modules_cache.import_module(self.__file)
[Thu Jun 07 15:09:20 2007] [error] [client ::1]   File "/Library/ 
Frameworks/Python.framework/Versions/2.5/lib/python2.5/site-packages/ 
mod_python/importer.py", line 680, in import_module\n    execfile 
(file, module.__dict__)
[Thu Jun 07 15:09:20 2007] [error] [client ::1]   File "/Users/dirk/ 
Sites/www/python/LocalConf.py", line 22, in <module>\n    import  
MySQLdb # FIXME
[Thu Jun 07 15:09:20 2007] [error] [client ::1]   File "build/ 
bdist.macosx-10.3-fat/egg/MySQLdb/__init__.py", line 19, in <module>
[Thu Jun 07 15:09:20 2007] [error] [client ::1]   File "build/ 
bdist.macosx-10.3-fat/egg/_mysql.py", line 7, in <module>
[Thu Jun 07 15:09:20 2007] [error] [client ::1]   File "build/ 
bdist.macosx-10.3-fat/egg/_mysql.py", line 6, in __bootstrap__
[Thu Jun 07 15:09:20 2007] [error] [client ::1] ImportError: dlopen(/ 
Users/dirk/.python-eggs/MySQL_python-1.2.2-py2.5-macosx-10.3-fat.egg- 
tmp/_mysql.so, 2): image not found



-----------------------------
Dirk van Oosterbosch
de Wittenstraat 225
1052 AT Amsterdam
the Netherlands

http://labs.ixopusada.com
-----------------------------


-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070607/aef68601/attachment-0001.html
From David.Bear at asu.edu  Thu Jun  7 12:07:43 2007
From: David.Bear at asu.edu (David Bear)
Date: Thu Jun  7 12:15:15 2007
Subject: [mod_python] simpleTAL and modpython
In-Reply-To: <4667AB9C.5050607@rogerbinns.com>
References: <20070606161007.GA11822@asu.edu> <4667AB9C.5050607@rogerbinns.com>
Message-ID: <20070607160743.GA8205@asu.edu>

On Wed, Jun 06, 2007 at 11:54:20PM -0700, Roger Binns wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
> 
> David Bear wrote:
> > I was wondering if anyone is using simpleTAL with modpython -- and if
> > there are any issues with it.
> > 
> > While Zope is a great BIG framework with lots of stuff, it really is
> > overkill for some stuff. But I miss TAL when I don't have zope. 
> 
> I've been using Genshi from http://genshi.edgewall.org/ and it works
> wonderfully without the need for any other framework.  I've never used
> TAL before but a quick look through the docs leads me to believe that
> all the same features are in Genshi and in most cases in exactly the
> same way.

This looks like an interesting product. Syntactially it is very
similar to simpleTAL. I was interested in simpleTAL becuase it is
syntactically identical to the way TAL works in zope.

Obviously there are a lot of 'contextual' differences since there is
not zope framework running around simpleTAL. I'll have to look at
genshi more closely. 

Thanks for the pointer.

> 
> Roger
> 
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.6 (GNU/Linux)
> 
> iD8DBQFGZ6ubmOOfHg372QQRAo9eAJwP9b4BSl6XWg60K0W/wUEARxZ3AACg4mkF
> F0x9KBh2ds8XY03uCQp3+Pc=
> =gqRi
> -----END PGP SIGNATURE-----
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

-- 
David Bear
phone: 	602-496-0424
fax: 	602-496-0955
College of Public Programs/ASU
University Center Rm 622
411 N Central
Phoenix, AZ 85007-0685
 "Beware the IP portfolio, everyone will be suspect of trespassing"
From labs at ixopusada.com  Thu Jun  7 20:22:00 2007
From: labs at ixopusada.com (Dirk van Oosterbosch, IR labs)
Date: Thu Jun  7 20:26:38 2007
Subject: [mod_python] Breaking things after upgrading MySQLdb (to 1.2.2)
In-Reply-To: <88e286470706070427y5d1ebfcckdd3f4979778f176a@mail.gmail.com>
References: <770EF919-5302-4C28-A74E-13E463C8A491@ixopusada.com>
	<88e286470706061631h12df422dq417ece1575e6fb2c@mail.gmail.com>
	<7CE349CC-707C-481C-B0D7-A6C8DD605134@ixopusada.com>
	<88e286470706070427y5d1ebfcckdd3f4979778f176a@mail.gmail.com>
Message-ID: <6B47231F-A40F-4F1C-A9C9-0FF26487AB98@ixopusada.com>

Thanks a bunch!

Making a egg_cache_module.py file containing:
import os
os.environ['PYTHON_EGG_CACHE'] = '/var/tmp'

and just adding
PythonImport /full/path/to/some/egg_cache_module.py mynetworkname.lan
to httpd.conf. And restarting fixed the MySQLdb problem.
(and after I rebuild & reinstalled all my other python modules, since  
I'm now with python 2.5.1, my original web-app works again!)

once again you solved some mysterious problem, ;-)
Thanks Graham!

dirk



On 7-jun-2007, at 13:27, Graham Dumpleton wrote:

>> After I restarted my machine, it first gave:
>>
>> [Thu Jun 07 10:05:54 2007] [error] [client ::1] ExtractionError:  
>> Can't
>> extract file(s) to egg cache\n\nThe following error occurred while  
>> trying to
>> extract file(s) to the Python egg\ncache:\n\n  [Errno 13]  
>> Permission denied:
>> '/var/empty/.python-eggs'\n\nThe Python egg cache directory
>> is currently set to:\n\n
>> /var/empty/.python-eggs\n\nPerhaps your account does not
>> have write access to this directory?  You can\nchange the cache  
>> directory by
>> setting the PYTHON_EGG_CACHE environment\nvariable to point to an  
>> accessible
>> directory.\n
>
> To get rid of this problem, create a new Python code module somewhere
> containing:
>
>  import os
>  os.environ['PYTHON_EGG_CACHE'] = '/some/path'
>
> The directory /some/path must be writable to the user that Apache  
> runs as.
>
> Then add to Apache global configuration:
>
>  PythonImport interpreter_name module_name
>
> Where interpreter_name is the name of the interpreter your mod_python
> application is running in, found by query req.interpreter in a request
> handler. And module_name is the name of the module you created above.
> If that module not in standard place, if using mod_python 3.3, use
> absolute path to code file instead.




-----------------------------
Dirk van Oosterbosch
de Wittenstraat 225
1052 AT Amsterdam
the Netherlands

http://labs.ixopusada.com
-----------------------------


-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070608/a358bdec/attachment.html
From graham.dumpleton at gmail.com  Thu Jun  7 20:38:21 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu Jun  7 20:38:36 2007
Subject: [mod_python] Breaking things after upgrading MySQLdb (to 1.2.2)
In-Reply-To: <6B47231F-A40F-4F1C-A9C9-0FF26487AB98@ixopusada.com>
References: <770EF919-5302-4C28-A74E-13E463C8A491@ixopusada.com>
	<88e286470706061631h12df422dq417ece1575e6fb2c@mail.gmail.com>
	<7CE349CC-707C-481C-B0D7-A6C8DD605134@ixopusada.com>
	<88e286470706070427y5d1ebfcckdd3f4979778f176a@mail.gmail.com>
	<6B47231F-A40F-4F1C-A9C9-0FF26487AB98@ixopusada.com>
Message-ID: <88e286470706071738s591930ccm2d8dd4af338c6e9a@mail.gmail.com>

Glad to see you worked out my instructions. :-)

I probably suggest not using /var/tmp though because if this is a
shared machine, too easy for some one to place in /var/tmp a Python
module which overrides some important standard Python module. Ie.,
would be used in place of the real one. Thus, someone could either
inadvertently or deliberately interfere with your application.

Graham

On 08/06/07, Dirk van Oosterbosch, IR labs <labs@ixopusada.com> wrote:
>
> Thanks a bunch!
>
> Making a egg_cache_module.py file containing:
> import os
> os.environ['PYTHON_EGG_CACHE'] = '/var/tmp'
>
> and just adding
> PythonImport /full/path/to/some/egg_cache_module.py
> mynetworkname.lan
> to httpd.conf. And restarting fixed the MySQLdb problem.
> (and after I rebuild & reinstalled all my other python modules, since I'm
> now with python 2.5.1, my original web-app works again!)
>
> once again you solved some mysterious problem, ;-)
> Thanks Graham!
>
> dirk
>
>
>
>
> On 7-jun-2007, at 13:27, Graham Dumpleton wrote:
>
>
>
> After I restarted my machine, it first gave:
>
>
>
>
> [Thu Jun 07 10:05:54 2007] [error] [client ::1] ExtractionError: Can't
>
> extract file(s) to egg cache\n\nThe following error occurred while trying to
>
> extract file(s) to the Python egg\ncache:\n\n  [Errno 13] Permission denied:
>
> '/var/empty/.python-eggs'\n\nThe Python egg cache directory
>
> is currently set to:\n\n
>
> /var/empty/.python-eggs\n\nPerhaps your account does not
>
> have write access to this directory?  You can\nchange the cache directory by
>
> setting the PYTHON_EGG_CACHE environment\nvariable to point to an accessible
>
> directory.\n
>
>
>
>
> To get rid of this problem, create a new Python code module somewhere
>
> containing:
>
>
>
>
>  import os
>
>  os.environ['PYTHON_EGG_CACHE'] = '/some/path'
>
>
>
>
> The directory /some/path must be writable to the user that Apache runs as.
>
>
>
>
> Then add to Apache global configuration:
>
>
>
>
>  PythonImport interpreter_name module_name
>
>
>
>
> Where interpreter_name is the name of the interpreter your mod_python
>
> application is running in, found by query req.interpreter in a request
>
> handler. And module_name is the name of the module you created above.
>
> If that module not in standard place, if using mod_python 3.3, use
>
> absolute path to code file instead.
>
>
>
> -----------------------------
> Dirk van Oosterbosch
> de Wittenstraat 225
> 1052 AT Amsterdam
> the Netherlands
>
> http://labs.ixopusada.com
> -----------------------------
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
From alex.greif at gmail.com  Fri Jun  8 09:25:12 2007
From: alex.greif at gmail.com (Alex Greif)
Date: Fri Jun  8 09:25:23 2007
Subject: [mod_python] psp import problem
Message-ID: <245E0FBD-30B3-4EBC-AA59-BE5BAD316618@gmail.com>

Hi,

I use version 4 of the document (http://www.modpython.org/pipermail/ 
mod_python/2006-November/022726.html) to store my mod_python sources.
If I put consts.py in the lib folder (which is on the same level as  
the handlers), then I can import consts from the handlers, but not  
from the psp files.

What is the prefered way to import custom python sources in psp files?

In my apache conf I have the following:

     SetHandler mod_python
     PythonHandler mod_python.publisher
     PythonDebug On
     PythonOption mod_python.importer.path "['~/lib']"


I am using MP 3.3.1 with apache 2.2.4 on Mac Os X 10.4.9



Alex.

--
alex.greif@gmail.com



-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070608/b21fb057/attachment.html
From bert at tela.com  Fri Jun  8 10:09:14 2007
From: bert at tela.com (Bert Hughes)
Date: Fri Jun  8 10:09:16 2007
Subject: [mod_python] simpleTAL and modpython
In-Reply-To: <20070607160743.GA8205@asu.edu>
References: <20070606161007.GA11822@asu.edu> <4667AB9C.5050607@rogerbinns.com>
	<20070607160743.GA8205@asu.edu>
Message-ID: <00b401c7a9d6$986882b0$cb0510ac@berthomexp>

I've used SimpleTAL/mod_python together, only one minor issue - can't get
escaped sequences (like &nbsp; , &lt;) in the template to work.  But it's
very fast, simplified development of somewhat project. Used the Zope-TAL
docs.

Bert Hughes

-----Original Message-----
From: mod_python-bounces@modpython.org
[mailto:mod_python-bounces@modpython.org] On Behalf Of David Bear
Sent: Thursday, June 07, 2007 11:08 AM
To: Roger Binns
Cc: list
Subject: Re: [mod_python] simpleTAL and modpython

On Wed, Jun 06, 2007 at 11:54:20PM -0700, Roger Binns wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
> 
> David Bear wrote:
> > I was wondering if anyone is using simpleTAL with modpython -- and if
> > there are any issues with it.
> > 
> > While Zope is a great BIG framework with lots of stuff, it really is
> > overkill for some stuff. But I miss TAL when I don't have zope. 
> 
> I've been using Genshi from http://genshi.edgewall.org/ and it works
> wonderfully without the need for any other framework.  I've never used
> TAL before but a quick look through the docs leads me to believe that
> all the same features are in Genshi and in most cases in exactly the
> same way.

This looks like an interesting product. Syntactially it is very
similar to simpleTAL. I was interested in simpleTAL becuase it is
syntactically identical to the way TAL works in zope.

Obviously there are a lot of 'contextual' differences since there is
not zope framework running around simpleTAL. I'll have to look at
genshi more closely. 

Thanks for the pointer.

> 
> Roger
> 
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.6 (GNU/Linux)
> 
> iD8DBQFGZ6ubmOOfHg372QQRAo9eAJwP9b4BSl6XWg60K0W/wUEARxZ3AACg4mkF
> F0x9KBh2ds8XY03uCQp3+Pc=
> =gqRi
> -----END PGP SIGNATURE-----
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

-- 
David Bear
phone: 	602-496-0424
fax: 	602-496-0955
College of Public Programs/ASU
University Center Rm 622
411 N Central
Phoenix, AZ 85007-0685
 "Beware the IP portfolio, everyone will be suspect of trespassing"
_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://mailman.modpython.org/mailman/listinfo/mod_python


From clodoaldo.pinto.neto at gmail.com  Fri Jun  8 10:53:44 2007
From: clodoaldo.pinto.neto at gmail.com (Clodoaldo)
Date: Fri Jun  8 10:53:52 2007
Subject: [mod_python] SystemError: bad argument to internal function
Message-ID: <a595de7a0706080753q6a02ce87u6c2c289ab6141546@mail.gmail.com>

I have this in my error log and I don't know what it means or what to do:

[Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] mod_python
(pid=15022, interpreter='carroarodo.com', phase='PythonHandler',
handler='~/_publisher.py'): Application error, referer:
http://carroarodo.com/meu_anuncio
[Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] ServerName:
'carroarodo.com', referer: http://carroarodo.com/meu_anuncio
[Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]
DocumentRoot: '/var/www/html/carroarodo.com', referer:
http://carroarodo.com/meu_anuncio
[Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] URI:
'/meu_anuncio', referer: http://carroarodo.com/meu_anuncio
[Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] Location:
None, referer: http://carroarodo.com/meu_anuncio
[Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] Directory:
'/var/www/html/carroarodo.com/', referer:
http://carroarodo.com/meu_anuncio
[Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] Filename:
'/var/www/html/carroarodo.com/meu_anuncio.py', referer:
http://carroarodo.com/meu_anuncio
[Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] PathInfo:
'', referer: http://carroarodo.com/meu_anuncio
[Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] Traceback
(most recent call last):, referer: http://carroarodo.com/meu_anuncio
[Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]   File
"/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
1537, in HandlerDispatch\n    default=default_handler, arg=req,
silent=hlist.silent), referer: http://carroarodo.com/meu_anuncio
[Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]   File
"/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
1229, in _process_target\n    result = _execute_target(config, req,
object, arg), referer: http://carroarodo.com/meu_anuncio
[Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]   File
"/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
1128, in _execute_target\n    result = object(arg), referer:
http://carroarodo.com/meu_anuncio
[Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]   File
"/var/www/html/carroarodo.com/_publisher.py", line 5, in handler\n
return publisher.handler(req), referer:
http://carroarodo.com/meu_anuncio
[Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]   File
"/usr/lib64/python2.4/site-packages/mod_python/publisher.py", line
213, in handler\n    published = publish_object(req, object), referer:
http://carroarodo.com/meu_anuncio
[Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]   File
"/usr/lib64/python2.4/site-packages/mod_python/publisher.py", line
424, in publish_object\n    req.form = util.FieldStorage(req,
keep_blank_values=1), referer: http://carroarodo.com/meu_anuncio
[Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]   File
"/usr/lib64/python2.4/site-packages/mod_python/util.py", line 225, in
__init__\n    pairs = parse_qsl(req.read(clen), keep_blank_val[Tue Jun
05 18:33:49 2007] [error] [client 200.155.85.225] SystemError:
Objects/stringobject.c:3515: bad argument to internal function,
referer: http://carroarodo.com/meu_anuncio

Any hints?

Regards, Clodoaldo Pinto Neto
From gambit at alpenjodel.de  Fri Jun  8 16:25:18 2007
From: gambit at alpenjodel.de (Gambit)
Date: Fri Jun  8 16:25:36 2007
Subject: [mod_python] mod_python and SQLAlchemy don't mix?
Message-ID: <f4cdva$8ra$1@sea.gmane.org>

Hi,

I'm trying to write a fairly simple web app using mod_python and 
SQLAlchemy and I'm getting stability problems with the database which 
apparently are threading issues.

Basically what I do is to create a SQLAlchemy engine in a separate 
module that is imported once at the beggining of my app:

db = sa.create_engine('mysql://user:pass@localhost/mydb')

And then I use this db variable freely in my code. This leads to errors 
when multiple users are using the app.

The people at the SQLAlchemy mailing list didn't saw a problem with my 
approach and suggested this is a mod_python/mysql issue.

Browsing through the archives of this list I found some possible 
explanations in an earlier discussion:

> multiple threads in apache get multiple copies of mod_python, each with
> it's own copy of the imported database module in memory and each module
> maintaining a different database connection

> The process which apache chooses to to handle a request is random.

> Don't be fooled into thinking that module-level attributes are global
> across your application as they are not. In anything other than winnt-mpm
> (which is a single, threaded process), you will have multiple, independent
> copies of that variable. 

So... I conclude I have multiple, independent SQLAlchemy engines created 
and thus I cannot just use the db object I created freely in my app.

Does anyone knows how to solve this? Is someone here using mod_python 
and SQLAlchemy together successfully? Care to share some best practices?

Thanks in advance


Some sample code follows

In dbinit.py:

db = sa.create_engine('mysql://user:pass@localhost/mydb')
metadata = sa.BoundMetaData(db)
users_table = sa.Table('Users', metadata, autoload=True)

class User(object):
     pass

sa.orm.clear_mappers()
sa.mapper(User, users_table)

In myapp.py

import logging
import sqlalchemy as sa
from dbinit import *

def justatest(req):
      dbsession = sa.create_session(bind_to=db)
      query = dbsession.query(User)
      requested_uid = sanitize(req.form['uid'])
      try:
          user = query.get_by(Uid=requested_uid)
      except sa.exceptions.SQLError, details:
          logging.debug("got this error: %s" % details)
          dbsession.close()
          return "Yet another crash"
      else:
          dbsession.close()
          return show_message(req, "Looks good")

From graham.dumpleton at gmail.com  Fri Jun  8 18:21:14 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Fri Jun  8 18:21:22 2007
Subject: [mod_python] psp import problem
In-Reply-To: <245E0FBD-30B3-4EBC-AA59-BE5BAD316618@gmail.com>
References: <245E0FBD-30B3-4EBC-AA59-BE5BAD316618@gmail.com>
Message-ID: <88e286470706081521x35017279qf251d4e20c0edce6@mail.gmail.com>

Problem described here:

  https://issues.apache.org/jira/browse/MODPYTHON-220

Where you have:

  import xyz

try replacing it with:

  from mod_python import apache
  xyz = apache.import_module("~/xyz.py")

Tell us if this work around fixes problem.

Graham

On 08/06/07, Alex Greif <alex.greif@gmail.com> wrote:
> Hi,
>
> I use version 4 of the document
> (http://www.modpython.org/pipermail/mod_python/2006-November/022726.html)
> to store my mod_python sources.
> If I put consts.py in the lib folder (which is on the same level as the
> handlers), then I can import consts from the handlers, but not from the psp
> files.
>
> What is the prefered way to import custom python sources in psp files?
>
> In my apache conf I have the following:
>
>     SetHandler mod_python
>     PythonHandler mod_python.publisher
>     PythonDebug On
>     PythonOption mod_python.importer.path "['~/lib']"
>
>
> I am using MP 3.3.1 with apache 2.2.4 on Mac Os X 10.4.9
>
>
>
>
> Alex.
>
> --
> alex.greif@gmail.com
>
>
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
From graham.dumpleton at gmail.com  Fri Jun  8 18:33:35 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Fri Jun  8 18:33:42 2007
Subject: [mod_python] mod_python and SQLAlchemy don't mix?
In-Reply-To: <f4cdva$8ra$1@sea.gmane.org>
References: <f4cdva$8ra$1@sea.gmane.org>
Message-ID: <88e286470706081533u168b3078t9188c14447e933fe@mail.gmail.com>

On 09/06/07, Gambit <gambit@alpenjodel.de> wrote:
> Hi,
>
> I'm trying to write a fairly simple web app using mod_python and
> SQLAlchemy and I'm getting stability problems with the database which
> apparently are threading issues.
>
> Basically what I do is to create a SQLAlchemy engine in a separate
> module that is imported once at the beggining of my app:
>
> db = sa.create_engine('mysql://user:pass@localhost/mydb')
>
> And then I use this db variable freely in my code. This leads to errors
> when multiple users are using the app.
>
> The people at the SQLAlchemy mailing list didn't saw a problem with my
> approach and suggested this is a mod_python/mysql issue.
>
> Browsing through the archives of this list I found some possible
> explanations in an earlier discussion:
>
> > multiple threads in apache get multiple copies of mod_python, each with
> > it's own copy of the imported database module in memory and each module
> > maintaining a different database connection

Which mailing list did this come from as the statement is wrong? This
myth is one I have been trying to stamp out as it just causes
misunderstandings of how mod_python works and lead people to think it
is crap.

When concurrent requests are handled by one Apache child process they
are done so in different threads, but all those threads execute within
the context of the same Python interpreter instance and use the same
modules and data.

Read:

  http://www.dscpl.com.au/wiki/ModPython/Articles/TheProcessInterpreterModel

for further details.

Beyond that, I am not familiar with SQLAlchemy and whether it is
itself actually thread safe, maybe others can comment.

One thing I would ask though is what version of mod_python are you
using? If you aren't using mod_python 3.3.1 I would suggest you
upgrade. If you are using mod_python 3.1.X or older, then be aware
there are multithreading bugs in it which conceivably could cause you
problems.

BTW, define what you mean by stability problems. One of the problems
with these database adapters is that the caching they do can cause
problems in a multiprocess web server like Apache as they cache data
in the processes and don't necessarily reflect quickly changes commit
by an alternate process.

Graham

> > The process which apache chooses to to handle a request is random.
>
> > Don't be fooled into thinking that module-level attributes are global
> > across your application as they are not. In anything other than winnt-mpm
> > (which is a single, threaded process), you will have multiple, independent
> > copies of that variable.
>
> So... I conclude I have multiple, independent SQLAlchemy engines created
> and thus I cannot just use the db object I created freely in my app.
>
> Does anyone knows how to solve this? Is someone here using mod_python
> and SQLAlchemy together successfully? Care to share some best practices?
>
> Thanks in advance
>
>
> Some sample code follows
>
> In dbinit.py:
>
> db = sa.create_engine('mysql://user:pass@localhost/mydb')
> metadata = sa.BoundMetaData(db)
> users_table = sa.Table('Users', metadata, autoload=True)
>
> class User(object):
>      pass
>
> sa.orm.clear_mappers()
> sa.mapper(User, users_table)
>
> In myapp.py
>
> import logging
> import sqlalchemy as sa
> from dbinit import *
>
> def justatest(req):
>       dbsession = sa.create_session(bind_to=db)
>       query = dbsession.query(User)
>       requested_uid = sanitize(req.form['uid'])
>       try:
>           user = query.get_by(Uid=requested_uid)
>       except sa.exceptions.SQLError, details:
>           logging.debug("got this error: %s" % details)
>           dbsession.close()
>           return "Yet another crash"
>       else:
>           dbsession.close()
>           return show_message(req, "Looks good")
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From gambit at alpenjodel.de  Fri Jun  8 19:09:08 2007
From: gambit at alpenjodel.de (Gambit)
Date: Fri Jun  8 19:19:35 2007
Subject: [mod_python] Re: mod_python and SQLAlchemy don't mix?
In-Reply-To: <88e286470706081533u168b3078t9188c14447e933fe@mail.gmail.com>
References: <f4cdva$8ra$1@sea.gmane.org>
	<88e286470706081533u168b3078t9188c14447e933fe@mail.gmail.com>
Message-ID: <f4cnif$5tp$1@sea.gmane.org>

> Which mailing list did this come from as the statement is wrong? This
> myth is one I have been trying to stamp out as it just causes
> misunderstandings of how mod_python works and lead people to think it
> is crap.

It came from an old discussion in this very same list:

news://news.gmane.org:119/450AF3E0.4080403@brunson.com

I'm glad to know it's a myth. I'll read the article you wrote, thanks 
for the pointer.

> One thing I would ask though is what version of mod_python are you
> using? If you aren't using mod_python 3.3.1 I would suggest you
> upgrade.

I upgraded to 3.3.1 a few days ago in yet another failed attempt to make 
my app stable as I read about the threading issues in older versions, 
but it didn't take care of the issues, I'm also using the latest stable 
mysql-python.

> BTW, define what you mean by stability problems. 

My app gets InterfaceError exceptions regularly under concurrent usage. 
The exception in the sample code I provided catches and logs an error 
like this:

(InterfaceError) (0, '') u'SELECT `Users`.`Uid` AS `Users_Uid`, 
`Users`.`CountryCode` AS `Users_CountryCode`, `Users`.`Country` AS 
`Users_Country`, `Users`.`LName` AS `Users_LName`, `Users`.`Credits` AS 
`Users_Credits`, `Users`.`Pwd` AS `Users_Pwd`, `Users`.`PhoneNumber` AS 
`Users_PhoneNumber`, `Users`.`FName` AS `Users_FName`, 
`Users`.`MoneyBalance` AS `Users_MoneyBalance`, `Users`.`Email` AS 
`Users_Email` \nFROM `Users` \nWHERE `Users`.`Uid` = %s ORDER BY 
`Users`.`Uid` \n LIMIT 1' ['testuser']

Thanks!


From graham.dumpleton at gmail.com  Fri Jun  8 19:37:43 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Fri Jun  8 19:37:50 2007
Subject: [mod_python] Re: mod_python and SQLAlchemy don't mix?
In-Reply-To: <f4cnif$5tp$1@sea.gmane.org>
References: <f4cdva$8ra$1@sea.gmane.org>
	<88e286470706081533u168b3078t9188c14447e933fe@mail.gmail.com>
	<f4cnif$5tp$1@sea.gmane.org>
Message-ID: <88e286470706081637r35ec522rb8cfecd6b71b72@mail.gmail.com>

One possibility for strange database problems is where you have PHP
also loaded by Apache and it was compiled against a different version
of the database client library than the Python module for the same
database.

Are you also loading PHP into Apache?

Which actual database backend are you using?

Graham

On 09/06/07, Gambit <gambit@alpenjodel.de> wrote:
> > Which mailing list did this come from as the statement is wrong? This
> > myth is one I have been trying to stamp out as it just causes
> > misunderstandings of how mod_python works and lead people to think it
> > is crap.
>
> It came from an old discussion in this very same list:
>
> news://news.gmane.org:119/450AF3E0.4080403@brunson.com
>
> I'm glad to know it's a myth. I'll read the article you wrote, thanks
> for the pointer.
>
> > One thing I would ask though is what version of mod_python are you
> > using? If you aren't using mod_python 3.3.1 I would suggest you
> > upgrade.
>
> I upgraded to 3.3.1 a few days ago in yet another failed attempt to make
> my app stable as I read about the threading issues in older versions,
> but it didn't take care of the issues, I'm also using the latest stable
> mysql-python.
>
> > BTW, define what you mean by stability problems.
>
> My app gets InterfaceError exceptions regularly under concurrent usage.
> The exception in the sample code I provided catches and logs an error
> like this:
>
> (InterfaceError) (0, '') u'SELECT `Users`.`Uid` AS `Users_Uid`,
> `Users`.`CountryCode` AS `Users_CountryCode`, `Users`.`Country` AS
> `Users_Country`, `Users`.`LName` AS `Users_LName`, `Users`.`Credits` AS
> `Users_Credits`, `Users`.`Pwd` AS `Users_Pwd`, `Users`.`PhoneNumber` AS
> `Users_PhoneNumber`, `Users`.`FName` AS `Users_FName`,
> `Users`.`MoneyBalance` AS `Users_MoneyBalance`, `Users`.`Email` AS
> `Users_Email` \nFROM `Users` \nWHERE `Users`.`Uid` = %s ORDER BY
> `Users`.`Uid` \n LIMIT 1' ['testuser']
>
> Thanks!
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From gambit at alpenjodel.de  Fri Jun  8 21:17:04 2007
From: gambit at alpenjodel.de (Gambit)
Date: Fri Jun  8 21:17:19 2007
Subject: [mod_python] Re: mod_python and SQLAlchemy don't mix?
In-Reply-To: <88e286470706081637r35ec522rb8cfecd6b71b72@mail.gmail.com>
References: <f4cdva$8ra$1@sea.gmane.org>	<88e286470706081533u168b3078t9188c14447e933fe@mail.gmail.com>	<f4cnif$5tp$1@sea.gmane.org>
	<88e286470706081637r35ec522rb8cfecd6b71b72@mail.gmail.com>
Message-ID: <f4cv2c$npb$1@sea.gmane.org>

> Are you also loading PHP into Apache? 

Yes, I'll try to verify the versions of the database client library of 
PHP and Python. Any chance you know where to get more information on 
this issue?


> Which actual database backend are you using? 

MySQL 5.0


Thanks!

From graham.dumpleton at gmail.com  Fri Jun  8 21:33:49 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Fri Jun  8 21:33:55 2007
Subject: [mod_python] Re: mod_python and SQLAlchemy don't mix?
In-Reply-To: <f4cv2c$npb$1@sea.gmane.org>
References: <f4cdva$8ra$1@sea.gmane.org>
	<88e286470706081533u168b3078t9188c14447e933fe@mail.gmail.com>
	<f4cnif$5tp$1@sea.gmane.org>
	<88e286470706081637r35ec522rb8cfecd6b71b72@mail.gmail.com>
	<f4cv2c$npb$1@sea.gmane.org>
Message-ID: <88e286470706081833j2a47f1ecg3cb23c7ae38addb@mail.gmail.com>

The problem can also just be caused by you using a newer version of
database client libraries than which Python module was originally
compiled with.

I have a little bit of information on it in my mod_wsgi pages. See
"MySQL Shared Library Conflicts" section in:

  http://code.google.com/p/modwsgi/wiki/ApplicationIssues

Because I don't use such databases myself and people do not typically
feedback information to the mailing list about exactly what they found
in respect of version problems, have scant information to actually
quote about how to track it down.

For example, the instructions in my page may not actually cover
finding what database client library version a PHP module itself may
load as no one has ever showed me where such modules are what the
output of ldd on then gives. Thus, try doing the ldd trick on your PHP
module directory as well and post the output of that as well.

Graham

On 09/06/07, Gambit <gambit@alpenjodel.de> wrote:
> > Are you also loading PHP into Apache?
>
> Yes, I'll try to verify the versions of the database client library of
> PHP and Python. Any chance you know where to get more information on
> this issue?
>
>
> > Which actual database backend are you using?
>
> MySQL 5.0
>
>
> Thanks!
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From gambit at alpenjodel.de  Fri Jun  8 22:22:13 2007
From: gambit at alpenjodel.de (Gambit)
Date: Fri Jun  8 22:22:42 2007
Subject: [mod_python] Re: mod_python and SQLAlchemy don't mix?
In-Reply-To: <88e286470706081833j2a47f1ecg3cb23c7ae38addb@mail.gmail.com>
References: <f4cdva$8ra$1@sea.gmane.org>	<88e286470706081533u168b3078t9188c14447e933fe@mail.gmail.com>	<f4cnif$5tp$1@sea.gmane.org>	<88e286470706081637r35ec522rb8cfecd6b71b72@mail.gmail.com>	<f4cv2c$npb$1@sea.gmane.org>
	<88e286470706081833j2a47f1ecg3cb23c7ae38addb@mail.gmail.com>
Message-ID: <f4d2sh$vtd$1@sea.gmane.org>

These are the results of running ldd on the python and php dirs:

/usr/lib/python2.4/site-packages
ldd *.so | grep mysql
_mysql.so:
	libmysqlclient_r.so.14 => /usr/lib/libmysqlclient_r.so.14 (0x0025a000)

/usr/lib/php/modules
ldd *.so | grep mysql
mysqli.so:
	libmysqlclient.so.14 => /usr/lib/libmysqlclient.so.14 (0x0036c000)
mysql.so:
	libmysqlclient.so.14 => /usr/lib/libmysqlclient.so.14 (0x00111000)
	libmysqlclient.so.14 => /usr/lib/libmysqlclient.so.14 (0x0042a000)


I guess this advice applies...

> one version is reentrant and the other isn't, you will need to 
> recompile one or both of the packages such that they use the same library.

From graham.dumpleton at gmail.com  Fri Jun  8 23:34:00 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Fri Jun  8 23:34:08 2007
Subject: [mod_python] Re: mod_python and SQLAlchemy don't mix?
In-Reply-To: <f4d2sh$vtd$1@sea.gmane.org>
References: <f4cdva$8ra$1@sea.gmane.org>
	<88e286470706081533u168b3078t9188c14447e933fe@mail.gmail.com>
	<f4cnif$5tp$1@sea.gmane.org>
	<88e286470706081637r35ec522rb8cfecd6b71b72@mail.gmail.com>
	<f4cv2c$npb$1@sea.gmane.org>
	<88e286470706081833j2a47f1ecg3cb23c7ae38addb@mail.gmail.com>
	<f4d2sh$vtd$1@sea.gmane.org>
Message-ID: <88e286470706082034x4fb271c3s4415fd8e98f7d850@mail.gmail.com>

That would be my guess. Since a re-entrant library is the one that
would normally support multithreading, would suggest use of _r variant
of libraries. It may be necessary to configure PHP package as it might
need some preprocessor define set as well to indicate reentrant code.

What one could do initially is simply change the configuration for PHP
so as not to load the mysql module into PHP, or simply not load PHP
into Apache at all. That would allow you to test and see if you
problem goes away. If you require PHP, obviously that isn't an option.

Graham

On 09/06/07, Gambit <gambit@alpenjodel.de> wrote:
> These are the results of running ldd on the python and php dirs:
>
> /usr/lib/python2.4/site-packages
> ldd *.so | grep mysql
> _mysql.so:
>         libmysqlclient_r.so.14 => /usr/lib/libmysqlclient_r.so.14 (0x0025a000)
>
> /usr/lib/php/modules
> ldd *.so | grep mysql
> mysqli.so:
>         libmysqlclient.so.14 => /usr/lib/libmysqlclient.so.14 (0x0036c000)
> mysql.so:
>         libmysqlclient.so.14 => /usr/lib/libmysqlclient.so.14 (0x00111000)
>         libmysqlclient.so.14 => /usr/lib/libmysqlclient.so.14 (0x0042a000)
>
>
> I guess this advice applies...
>
> > one version is reentrant and the other isn't, you will need to
> > recompile one or both of the packages such that they use the same library.
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From habnabit at gmail.com  Sat Jun  9 01:46:00 2007
From: habnabit at gmail.com (Aaron Gallagher)
Date: Sat Jun  9 01:46:20 2007
Subject: [mod_python] req.sendfile and the Content-length header
Message-ID: <B1348DE2-5D69-4D83-8B9A-B313D80492B7@gmail.com>

Is there any easy way to make req.sendfile use a content-length  
header instead of chunking the output? This is what I've been doing,  
and it's very fast, but I'm sure there's a more elegant way of doing it.

		st = open(req.filename)
		st.seek(0, 2)
		req.set_content_length(st.tell())
		st.close()
		req.sendfile(req.filename)

Aaron Gallagher
<habnabit@gmail.com>


-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070608/be4d877e/attachment.html
From graham.dumpleton at gmail.com  Sat Jun  9 02:02:07 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sat Jun  9 02:02:14 2007
Subject: [mod_python] req.sendfile and the Content-length header
In-Reply-To: <B1348DE2-5D69-4D83-8B9A-B313D80492B7@gmail.com>
References: <B1348DE2-5D69-4D83-8B9A-B313D80492B7@gmail.com>
Message-ID: <88e286470706082302u4af0e761p50865c599725e59f@mail.gmail.com>

On 09/06/07, Aaron Gallagher <habnabit@gmail.com> wrote:
>
> Is there any easy way to make req.sendfile use a content-length header
> instead of chunking the output? This is what I've been doing, and it's very
> fast, but I'm sure there's a more elegant way of doing it.
>
>  st = open(req.filename)
>  st.seek(0, 2)
>  req.set_content_length(st.tell())
>  st.close()
>  req.sendfile(req.filename)

What you are doing isn't actually guaranteed to yield the correct
result as the file might be changed between the close() and the call
to sendfile() and thus you could end up sending a different amount of
data.

Note that if your mod_python handler simply returns apache.DECLINED,
the file defined by req.filename will be served up as static file for
you by Apache.

If you are instead using mod_python.publisher, use:

  raise apache.SERVER_RETURN, apache.DECLINED

Let us know if this works as I expect it should. If you have changed
req.filename there are some further steps you will need to possibly do
to have it work like I expect.

Graham
From gambit at alpenjodel.de  Sat Jun  9 13:14:39 2007
From: gambit at alpenjodel.de (Gambit)
Date: Sat Jun  9 13:14:52 2007
Subject: [mod_python] Re: mod_python and SQLAlchemy don't mix?
In-Reply-To: <88e286470706082034x4fb271c3s4415fd8e98f7d850@mail.gmail.com>
References: <f4cdva$8ra$1@sea.gmane.org>	<88e286470706081533u168b3078t9188c14447e933fe@mail.gmail.com>	<f4cnif$5tp$1@sea.gmane.org>	<88e286470706081637r35ec522rb8cfecd6b71b72@mail.gmail.com>	<f4cv2c$npb$1@sea.gmane.org>	<88e286470706081833j2a47f1ecg3cb23c7ae38addb@mail.gmail.com>	<f4d2sh$vtd$1@sea.gmane.org>
	<88e286470706082034x4fb271c3s4415fd8e98f7d850@mail.gmail.com>
Message-ID: <f4en5n$q6q$1@sea.gmane.org>

Thanks for the help. Shutting down PHP is not an option, but I'll setup 
a new server without it and see if the problems go away.

From rogerb at rogerbinns.com  Sat Jun  9 20:41:26 2007
From: rogerb at rogerbinns.com (Roger Binns)
Date: Sat Jun  9 20:41:32 2007
Subject: [mod_python] req.sendfile and the Content-length header
In-Reply-To: <88e286470706082302u4af0e761p50865c599725e59f@mail.gmail.com>
References: <B1348DE2-5D69-4D83-8B9A-B313D80492B7@gmail.com>
	<88e286470706082302u4af0e761p50865c599725e59f@mail.gmail.com>
Message-ID: <466B48B6.3030101@rogerbinns.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Graham Dumpleton wrote:
> What you are doing isn't actually guaranteed to yield the correct
> result as the file might be changed between the close() and the call
> to sendfile() and thus you could end up sending a different amount of
> data.

The modpython code has a similar problem except that it doesn't set the
content length so the protocol won't be bad.  It does do a stat first to
get the size then does an open and then a send of that size and so also
has the race condition.

In theory an alternative is to open the file and use apr_file_seek to
find the end although even then the file contents could change while
sending.

Roger
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)

iD8DBQFGa0i2mOOfHg372QQRAiK6AKDemPtKaXiKG0ey7LhzunR6DvlyNwCglnxo
G8QCn0Up/k1XykoDPizTbQk=
=zMcD
-----END PGP SIGNATURE-----
From gert.cuykens at gmail.com  Mon Jun 11 10:26:25 2007
From: gert.cuykens at gmail.com (Gert Cuykens)
Date: Mon Jun 11 10:26:32 2007
Subject: [mod_python] http://www.modpython.org/examples/
In-Reply-To: <ef60af090706110721v19b230e9o463951380fabb9c6@mail.gmail.com>
References: <ef60af090706110721v19b230e9o463951380fabb9c6@mail.gmail.com>
Message-ID: <ef60af090706110726i2aff0a90r2bdb617c4d263c03@mail.gmail.com>

Can http://sourceforge.net/projects/dfo/ be on the
http://www.modpython.org/examples/ page please :)
From list at joreybump.com  Mon Jun 11 10:42:09 2007
From: list at joreybump.com (Jorey Bump)
Date: Mon Jun 11 10:42:19 2007
Subject: [mod_python] http://www.modpython.org/examples/
In-Reply-To: <ef60af090706110726i2aff0a90r2bdb617c4d263c03@mail.gmail.com>
References: <ef60af090706110721v19b230e9o463951380fabb9c6@mail.gmail.com>
	<ef60af090706110726i2aff0a90r2bdb617c4d263c03@mail.gmail.com>
Message-ID: <466D5F41.9050005@joreybump.com>

Gert Cuykens wrote:
> Can http://sourceforge.net/projects/dfo/ be on the
> http://www.modpython.org/examples/ page please :)

There is no meaningful summary, documentation or functional web site for 
this project. Perhaps you should work more on those areas before 
submitting this request. :)

From gert.cuykens at gmail.com  Mon Jun 11 11:05:31 2007
From: gert.cuykens at gmail.com (Gert Cuykens)
Date: Mon Jun 11 11:05:37 2007
Subject: [mod_python] http://www.modpython.org/examples/
In-Reply-To: <466D5F41.9050005@joreybump.com>
References: <ef60af090706110721v19b230e9o463951380fabb9c6@mail.gmail.com>
	<ef60af090706110726i2aff0a90r2bdb617c4d263c03@mail.gmail.com>
	<466D5F41.9050005@joreybump.com>
Message-ID: <ef60af090706110805x4dc6ab14oabef3a06014c82ed@mail.gmail.com>

On 6/11/07, Jorey Bump <list@joreybump.com> wrote:
> Gert Cuykens wrote:
> > Can http://sourceforge.net/projects/dfo/ be on the
> > http://www.modpython.org/examples/ page please :)
>
> There is no meaningful summary, documentation or functional web site for
> this project. Perhaps you should work more on those areas before
> submitting this request. :)
>

I have screenshots :)

O man its super easy to understand like everything else that is based
on python and it has better performance then php

Can i not be in the random code example section or something it has
everything from smtp to soap to pymysqladmin to forums , appointments
, orders , barcodes , invoice , crm , security and as bonus some
special effects.
From gert.cuykens at gmail.com  Mon Jun 11 13:10:50 2007
From: gert.cuykens at gmail.com (Gert Cuykens)
Date: Mon Jun 11 13:10:57 2007
Subject: [mod_python] http://www.modpython.org/examples/
In-Reply-To: <ef60af090706110805x4dc6ab14oabef3a06014c82ed@mail.gmail.com>
References: <ef60af090706110721v19b230e9o463951380fabb9c6@mail.gmail.com>
	<ef60af090706110726i2aff0a90r2bdb617c4d263c03@mail.gmail.com>
	<466D5F41.9050005@joreybump.com>
	<ef60af090706110805x4dc6ab14oabef3a06014c82ed@mail.gmail.com>
Message-ID: <ef60af090706111010u5a3aae1fwf5bd2327c31d4ac5@mail.gmail.com>

On 6/11/07, Gert Cuykens <gert.cuykens@gmail.com> wrote:
> On 6/11/07, Jorey Bump <list@joreybump.com> wrote:
> > Gert Cuykens wrote:
> > > Can http://sourceforge.net/projects/dfo/ be on the
> > > http://www.modpython.org/examples/ page please :)
> >
> > There is no meaningful summary, documentation or functional web site for
> > this project. Perhaps you should work more on those areas before
> > submitting this request. :)
> >
>
> I have screenshots :)
>
> O man its super easy to understand like everything else that is based
> on python and it has better performance then php
>
> Can i not be in the random code example section or something it has
> everything from smtp to soap to pymysqladmin to forums , appointments
> , orders , barcodes , invoice , crm , security and as bonus some
> special effects.
>

ok did some quick html stuff at http://dfo.sourceforge.net/ i think it
can now be called a site :)
From amax at snaplogic.org  Mon Jun 11 15:03:59 2007
From: amax at snaplogic.org (Aaron Maxwell)
Date: Mon Jun 11 15:04:07 2007
Subject: [mod_python] Mixed Python versions
Message-ID: <200706111203.59703.amax@snaplogic.org>

Hi,

I'm getting an error with either apache or mod_python using an
unexpected Python version.  The system is RHEL 4.5, which ships with
python2.3 .  We want to use 2.4 for our webapps, and have installed it
on the system as well (under /usr/local).  We think we have configured things
correctly, including setting PATH for apache.  At this
point we are still trying to get a test script (mptest.py [1])
working.  It currently fails, with an internal server error (500).

Two interesting lines appear in the apache error log:
[Mon Jun 11 11:51:04 2007] [error] python_init: Python executable 
found '/usr/local/python2.4/bin/python'.
[Mon Jun 11 11:51:04 2007] [error] python_init: Python path being 
used '/usr/lib/python23.zip:/usr/lib/python2.3/:/usr/lib/python2.3/plat-linux2:/usr/lib/python2.3/lib-tk:/usr/lib/python2.3/lib-dynload'.

Basically, the correct executable under /usr/local/python2.4 is being
used.  But the python path is all python2.3. 

Several people have had a version-mismatch problem and posted about it
on this list; none of their fixes seem to help here.  Any ideas or
suggestions?

Thanks in advance.

[1] http://www.modpython.org/live/current/doc-html/inst-testing.html

-- 
Aaron Maxwell
SnapLogic - Open Source Internet Data Services
http://snaplogic.org
From list at joreybump.com  Mon Jun 11 16:11:20 2007
From: list at joreybump.com (Jorey Bump)
Date: Mon Jun 11 16:11:25 2007
Subject: [mod_python] http://www.modpython.org/examples/
In-Reply-To: <ef60af090706111010u5a3aae1fwf5bd2327c31d4ac5@mail.gmail.com>
References: <ef60af090706110721v19b230e9o463951380fabb9c6@mail.gmail.com>	<ef60af090706110726i2aff0a90r2bdb617c4d263c03@mail.gmail.com>	<466D5F41.9050005@joreybump.com>	<ef60af090706110805x4dc6ab14oabef3a06014c82ed@mail.gmail.com>
	<ef60af090706111010u5a3aae1fwf5bd2327c31d4ac5@mail.gmail.com>
Message-ID: <466DAC68.1070305@joreybump.com>

Gert Cuykens wrote:

> ok did some quick html stuff at http://dfo.sourceforge.net/ i think it
> can now be called a site :)

WTF is DFO?

From amax at snaplogic.org  Mon Jun 11 16:58:10 2007
From: amax at snaplogic.org (Aaron Maxwell)
Date: Mon Jun 11 16:58:17 2007
Subject: [mod_python] Mixed Python versions
In-Reply-To: <200706111203.59703.amax@snaplogic.org>
References: <200706111203.59703.amax@snaplogic.org>
Message-ID: <200706111358.11165.amax@snaplogic.org>

On Monday 11 June 2007 12:03, Aaron Maxwell wrote:
> I'm getting an error with either apache or mod_python using an
> unexpected Python version.  The system is RHEL 4.5, which ships with

Here's some extra information.  I configured and installed mod_python from 
source using the following:

./configure --libdir=/usr/local/python2.4/lib --with-python-src=/home/amlocal/src/Python-2.4.4 --with-python=/usr/local/python2.4/bin/python --includedir=/usr/local/python2.4/include/python2.4/ 
&& make && echo Okay
sudo make install

Apache is version 2.0.52.  The python referred to above is version 2.4.4.  The 
build proceeds without errors or significant warnings; I can post a log if it 
if it helps.  Again, this is on Linux - specifically RHEL 4, on an athlon 
i686.

Bouncing httpd and pointing the browser to mptest.py generates the following 
in the apache error log:
<pre>
[Mon Jun 11 13:50:53 2007] [notice] caught SIGTERM, shutting down
[[ snip a few lines about LDAP, etc. ]]
[Mon Jun 11 13:50:54 2007] [error] python_init: Python version mismatch, 
expected '2.4.4', found '2.3.4'.
[Mon Jun 11 13:50:54 2007] [error] python_init: Python executable 
found '/usr/local/python2.4/bin/python'.
[Mon Jun 11 13:50:54 2007] [error] python_init: Python path being 
used '/usr/lib/python23.zip:/usr/lib/python2.3/:/usr/lib/python2.3/plat-linux2:/usr/lib/python2.3/lib-tk:/usr/lib/python2.3/lib-dynload'.
[Mon Jun 11 13:50:54 2007] [notice] mod_python: Creating 8 session mutexes 
based on 256 max processes and 0 max threads.
[Mon Jun 11 13:50:54 2007] [notice] mod_python: using mutex_directory /tmp
[Mon Jun 11 13:50:54 2007] [notice] mod_wsgi (pid=4161): Attach 
interpreter ''.
[[ previous line repeated 8 times ]]
[Mon Jun 11 13:50:54 2007] [notice] Apache/2.0.52 (Red Hat) configured -- 
resuming normal operations
[Mon Jun 11 13:50:58 2007] [error] make_obcallback: could not import 
mod_python.apache.\n
ImportError: No module named mod_python.apache
[Mon Jun 11 13:50:58 2007] [error] make_obcallback: Python path being 
used "['/usr/lib/python2.3/site-packages/setuptools-0.6c5-py2.3.egg', '/usr/lib/python2.3/site-packages/MySQL_python-1.2.2-py2.3-linux-i686.egg', '/usr/lib/python23.zip', '/usr/lib/python2.3', '/usr/lib/python2.3/plat-linux2', '/usr/lib/python2.3/lib-tk', '/usr/lib/python2.3/lib-dynload', '/usr/lib/python2.3/site-packages', '/usr/lib/python2.3/site-packages/gtk-2.0']".
[Mon Jun 11 13:50:58 2007] [error] get_interpreter: no interpreter callback 
found.
</pre>

The messages around 13:50:54 should come from the apache restart; those from 
13:50:58 come from the mptest.py request.

-- 
Aaron Maxwell
SnapLogic - Open Source Internet Data Services
http://snaplogic.org
From gert.cuykens at gmail.com  Mon Jun 11 17:44:04 2007
From: gert.cuykens at gmail.com (Gert Cuykens)
Date: Mon Jun 11 17:44:11 2007
Subject: [mod_python] http://www.modpython.org/examples/
In-Reply-To: <466DAC68.1070305@joreybump.com>
References: <ef60af090706110721v19b230e9o463951380fabb9c6@mail.gmail.com>
	<ef60af090706110726i2aff0a90r2bdb617c4d263c03@mail.gmail.com>
	<466D5F41.9050005@joreybump.com>
	<ef60af090706110805x4dc6ab14oabef3a06014c82ed@mail.gmail.com>
	<ef60af090706111010u5a3aae1fwf5bd2327c31d4ac5@mail.gmail.com>
	<466DAC68.1070305@joreybump.com>
Message-ID: <ef60af090706111444o7be91a45w1ea7adcedd289c8f@mail.gmail.com>

On 6/11/07, Jorey Bump <list@joreybump.com> wrote:
> Gert Cuykens wrote:
>
> > ok did some quick html stuff at http://dfo.sourceforge.net/ i think it
> > can now be called a site :)
>
> WTF is DFO?
>

lol, it is just a collection of example's to show of the potential of
mod_python. It is not something specific. For example when you open
the query.htm page you can put any sql statement on that page and when
pushing submit, it will show you a nice table of all the records.
Thats just one example of many more.

If i would have a python server i could setup a demo of it all,
mod_python can annihilate php if only people would know how to make
web applications. Php is specifically designed for web content. Python
can do the same thing except where php stops python is just starting
warming up.
From amax at snaplogic.org  Mon Jun 11 17:59:05 2007
From: amax at snaplogic.org (Aaron Maxwell)
Date: Mon Jun 11 17:59:11 2007
Subject: [mod_python] Mixed Python versions - FIXED
In-Reply-To: <200706111358.11165.amax@snaplogic.org>
References: <200706111203.59703.amax@snaplogic.org>
	<200706111358.11165.amax@snaplogic.org>
Message-ID: <200706111459.05152.amax@snaplogic.org>

We figured it out.  From a previous configuration, our apache was set to load 
mod_wsgi (stable version, 255).  Apparently there was a conflict between it 
an mod_python in this case.  Note that there is no inherent conflict, AFAIK: 
the problem was with our production server, whilst our development server 
worked fine, even though it was also loading mod_wsgi.  I believe the 
mod_wsgi's were built differently on the two systems.  In any case, removing 
the LoadModule directive for mod_wsgi fixes the problem in our setup.

On Monday 11 June 2007 13:58, Aaron Maxwell wrote:
> On Monday 11 June 2007 12:03, Aaron Maxwell wrote:
> > I'm getting an error with either apache or mod_python using an
> > unexpected Python version.  The system is RHEL 4.5, which ships with
>
> Here's some extra information.  I configured and installed mod_python from
> source using the following:

-- 
Aaron Maxwell
SnapLogic - Open Source Internet Data Services
http://snaplogic.org
From greg at vig.co.nz  Mon Jun 11 18:27:51 2007
From: greg at vig.co.nz (Greg Fawcett)
Date: Mon Jun 11 18:28:00 2007
Subject: [mod_python] http://www.modpython.org/examples/
In-Reply-To: <ef60af090706111444o7be91a45w1ea7adcedd289c8f@mail.gmail.com>
References: <ef60af090706110721v19b230e9o463951380fabb9c6@mail.gmail.com>
	<ef60af090706110726i2aff0a90r2bdb617c4d263c03@mail.gmail.com>
	<466D5F41.9050005@joreybump.com>
	<ef60af090706110805x4dc6ab14oabef3a06014c82ed@mail.gmail.com>
	<ef60af090706111010u5a3aae1fwf5bd2327c31d4ac5@mail.gmail.com>
	<466DAC68.1070305@joreybump.com>
	<ef60af090706111444o7be91a45w1ea7adcedd289c8f@mail.gmail.com>
Message-ID: <928306280706111527x308ea25dj57fdca03dcc63355@mail.gmail.com>

I agree that the mod_python examples are woefully inadequate - potential PHP
converts have to make a big leap to understand handlers, set up apache
directives etc. It would be great to have a PHP-to-mod_python tutorial to
ease the way.

However, the web site at http://dfo.sourceforge.net/ does nothing but
confuse - it doesn't even explain what DFO is or why one might want it. It
says you need to install apache, mysql and python, but only mentions
mod_python in one line. If it was put on the mod_python examples page, I
think it would confuse far more people than it would help.

Cheers!
Greg.


On 12/06/07, Gert Cuykens <gert.cuykens@gmail.com> wrote:
>
> On 6/11/07, Jorey Bump <list@joreybump.com> wrote:
> > Gert Cuykens wrote:
> >
> > > ok did some quick html stuff at http://dfo.sourceforge.net/ i think it
> > > can now be called a site :)
> >
> > WTF is DFO?
> >
>
> lol, it is just a collection of example's to show of the potential of
> mod_python. It is not something specific. For example when you open
> the query.htm page you can put any sql statement on that page and when
> pushing submit, it will show you a nice table of all the records.
> Thats just one example of many more.
>
> If i would have a python server i could setup a demo of it all,
> mod_python can annihilate php if only people would know how to make
> web applications. Php is specifically designed for web content. Python
> can do the same thing except where php stops python is just starting
> warming up.
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>



-- 
Phone: +64 3 409 8165
Mobile: +64 21 333 291
Fax: +64 3 974 6810
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070612/a090b0f2/attachment.html
From graham.dumpleton at gmail.com  Mon Jun 11 18:28:36 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon Jun 11 18:28:41 2007
Subject: [mod_python] Mixed Python versions - FIXED
In-Reply-To: <200706111459.05152.amax@snaplogic.org>
References: <200706111203.59703.amax@snaplogic.org>
	<200706111358.11165.amax@snaplogic.org>
	<200706111459.05152.amax@snaplogic.org>
Message-ID: <88e286470706111528u53bb7215h24a8859eca005bfe@mail.gmail.com>

On 12/06/07, Aaron Maxwell <amax@snaplogic.org> wrote:
> We figured it out.  From a previous configuration, our apache was set to load
> mod_wsgi (stable version, 255).  Apparently there was a conflict between it
> an mod_python in this case.  Note that there is no inherent conflict, AFAIK:
> the problem was with our production server, whilst our development server
> worked fine, even though it was also loading mod_wsgi.  I believe the
> mod_wsgi's were built differently on the two systems.  In any case, removing
> the LoadModule directive for mod_wsgi fixes the problem in our setup.

Your problems are not really caused by mod_wsgi although it does
trigger it. The real problem derives from the fact that on RHEL the
version of Python they provide does not include a shared library, or
it isn't installed in the correct location to be found when compiling.
This causes problems if loading both mod_python and mod_wsgi together
even if both are compiled against the same library as an actual copy
of the library has had to be embedded in both Apache modules meaning
there are two copies on memory. This shortcoming of Linux
distributions such as those from RedHat are described in the README
file and web documentation for mod_wsgi. As the documentation says,
the Python distributions need to be rebuilt so they provide a shared
library. For further information see:

  http://modwsgi.googlecode.com/svn/trunk/README
  http://code.google.com/p/modwsgi/wiki/InstallationIssues

In other words, provided that mod_python and mod_wsgi both use a
Python shared library they can coexist. If for some reason you can't
rebuild your Python distribution, then as documented one can build
mod_wsgi but without linking it to Python, so that it uses the version
that is embedded within mod_python.

Graham



> On Monday 11 June 2007 13:58, Aaron Maxwell wrote:
> > On Monday 11 June 2007 12:03, Aaron Maxwell wrote:
> > > I'm getting an error with either apache or mod_python using an
> > > unexpected Python version.  The system is RHEL 4.5, which ships with
> >
> > Here's some extra information.  I configured and installed mod_python from
> > source using the following:
>
> --
> Aaron Maxwell
> SnapLogic - Open Source Internet Data Services
> http://snaplogic.org
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From graham.dumpleton at gmail.com  Mon Jun 11 18:35:44 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon Jun 11 18:35:50 2007
Subject: [mod_python] http://www.modpython.org/examples/
In-Reply-To: <ef60af090706110726i2aff0a90r2bdb617c4d263c03@mail.gmail.com>
References: <ef60af090706110721v19b230e9o463951380fabb9c6@mail.gmail.com>
	<ef60af090706110726i2aff0a90r2bdb617c4d263c03@mail.gmail.com>
Message-ID: <88e286470706111535i6cc30625v41f4d939464a2460@mail.gmail.com>

On 12/06/07, Gert Cuykens <gert.cuykens@gmail.com> wrote:
> Can http://sourceforge.net/projects/dfo/ be on the
> http://www.modpython.org/examples/ page please :)

FWIW, we don't have the ability to change that page.

Someone may want to consider making a page on the mod_python wiki
instead for references to examples:

  http://wiki.apache.org/mod_python/

Any examples would have to be well documented else there wouldn't be
much point. Also, if the examples were found to do things in
particularly bad ways or were insecure you would need to be aware that
we would remove the reference.

Graham
From gert.cuykens at gmail.com  Mon Jun 11 18:51:31 2007
From: gert.cuykens at gmail.com (Gert Cuykens)
Date: Mon Jun 11 18:51:39 2007
Subject: [mod_python] http://www.modpython.org/examples/
In-Reply-To: <928306280706111527x308ea25dj57fdca03dcc63355@mail.gmail.com>
References: <ef60af090706110721v19b230e9o463951380fabb9c6@mail.gmail.com>
	<ef60af090706110726i2aff0a90r2bdb617c4d263c03@mail.gmail.com>
	<466D5F41.9050005@joreybump.com>
	<ef60af090706110805x4dc6ab14oabef3a06014c82ed@mail.gmail.com>
	<ef60af090706111010u5a3aae1fwf5bd2327c31d4ac5@mail.gmail.com>
	<466DAC68.1070305@joreybump.com>
	<ef60af090706111444o7be91a45w1ea7adcedd289c8f@mail.gmail.com>
	<928306280706111527x308ea25dj57fdca03dcc63355@mail.gmail.com>
Message-ID: <ef60af090706111551o783034baq263c8b9b6bd74e22@mail.gmail.com>

On 6/12/07, Greg Fawcett <greg@vig.co.nz> wrote:
> I agree that the mod_python examples are woefully inadequate - potential PHP
> converts have to make a big leap to understand handlers, set up apache
> directives etc. It would be great to have a PHP-to-mod_python tutorial to
> ease the way.
>
> However, the web site at http://dfo.sourceforge.net/ does nothing but
> confuse - it doesn't even explain what DFO is or why one might want it. It
> says you need to install apache, mysql and python, but only mentions
> mod_python in one line. If it was put on the mod_python examples page, I
> think it would confuse far more people than it would help.
>
> Cheers!
> Greg.
>

That is true. Fact is, i suck at writing documentation, especially
when i start waving my hands while talking to my computer screen to
explain what i am trying to tell php people on the internet. I would
be happy if you could guide me how to speak English to php people or
even mod_python people.

So i guess my first thing would be explaining dfo is nothing else then
a bunch of  handlers and some static xhtml javascript pages that post
xml data to communicate with the server using xmlhttprequest.

O man i think i am going to cry lol
From gert.cuykens at gmail.com  Mon Jun 11 19:02:51 2007
From: gert.cuykens at gmail.com (Gert Cuykens)
Date: Mon Jun 11 19:02:59 2007
Subject: [mod_python] http://www.modpython.org/examples/
In-Reply-To: <88e286470706111535i6cc30625v41f4d939464a2460@mail.gmail.com>
References: <ef60af090706110721v19b230e9o463951380fabb9c6@mail.gmail.com>
	<ef60af090706110726i2aff0a90r2bdb617c4d263c03@mail.gmail.com>
	<88e286470706111535i6cc30625v41f4d939464a2460@mail.gmail.com>
Message-ID: <ef60af090706111602l5322d4b5q12cb501fc0ad5f47@mail.gmail.com>

On 6/12/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> On 12/06/07, Gert Cuykens <gert.cuykens@gmail.com> wrote:
> > Can http://sourceforge.net/projects/dfo/ be on the
> > http://www.modpython.org/examples/ page please :)
>
> FWIW, we don't have the ability to change that page.
>
> Someone may want to consider making a page on the mod_python wiki
> instead for references to examples:
>
>   http://wiki.apache.org/mod_python/
>
> Any examples would have to be well documented else there wouldn't be
> much point. Also, if the examples were found to do things in
> particularly bad ways or were insecure you would need to be aware that
> we would remove the reference.
>
> Graham
>

Ok, if you just tell me what needs to be changed or is insecure, i
will change it instantly, like you told me when i did put the handlers
in the mod_python directory :)
From list at joreybump.com  Mon Jun 11 19:17:06 2007
From: list at joreybump.com (Jorey Bump)
Date: Mon Jun 11 19:17:11 2007
Subject: [mod_python] http://www.modpython.org/examples/
In-Reply-To: <ef60af090706111551o783034baq263c8b9b6bd74e22@mail.gmail.com>
References: <ef60af090706110721v19b230e9o463951380fabb9c6@mail.gmail.com>	
	<ef60af090706110726i2aff0a90r2bdb617c4d263c03@mail.gmail.com>	
	<466D5F41.9050005@joreybump.com>	
	<ef60af090706110805x4dc6ab14oabef3a06014c82ed@mail.gmail.com>	
	<ef60af090706111010u5a3aae1fwf5bd2327c31d4ac5@mail.gmail.com>	
	<466DAC68.1070305@joreybump.com>	
	<ef60af090706111444o7be91a45w1ea7adcedd289c8f@mail.gmail.com>	
	<928306280706111527x308ea25dj57fdca03dcc63355@mail.gmail.com>
	<ef60af090706111551o783034baq263c8b9b6bd74e22@mail.gmail.com>
Message-ID: <466DD7F2.3020104@joreybump.com>

Gert Cuykens wrote:

> So i guess my first thing would be explaining dfo is nothing else then
> a bunch of  handlers and some static xhtml javascript pages that post
> xml data to communicate with the server using xmlhttprequest.

Actually, the first thing you should do is introduce the full name 
before the abbreviation in any related document or correspondence, then 
define it so we know what you are talking about (fill in the blanks):

  D______ F______ O_______ (DFO) is ______________.

Then write some documentation and include it on your web site. If you 
have documentation in your download, be sure to provide links to that 
documentation on your web site, so it isn't necessary to download and 
expand your tarball just to find out if it's worth trying out. Also, fix 
your spelling and grammatical errors in your documentation, because 
typos here will make visitors suspect that there are typos in your code. 
And if you want people to run your SQL scripts as the mysql root user, 
you'd better have a very good reason (which you don't).

From gert.cuykens at gmail.com  Mon Jun 11 19:40:09 2007
From: gert.cuykens at gmail.com (Gert Cuykens)
Date: Mon Jun 11 19:40:14 2007
Subject: [mod_python] http://www.modpython.org/examples/
In-Reply-To: <466DD7F2.3020104@joreybump.com>
References: <ef60af090706110721v19b230e9o463951380fabb9c6@mail.gmail.com>
	<ef60af090706110726i2aff0a90r2bdb617c4d263c03@mail.gmail.com>
	<466D5F41.9050005@joreybump.com>
	<ef60af090706110805x4dc6ab14oabef3a06014c82ed@mail.gmail.com>
	<ef60af090706111010u5a3aae1fwf5bd2327c31d4ac5@mail.gmail.com>
	<466DAC68.1070305@joreybump.com>
	<ef60af090706111444o7be91a45w1ea7adcedd289c8f@mail.gmail.com>
	<928306280706111527x308ea25dj57fdca03dcc63355@mail.gmail.com>
	<ef60af090706111551o783034baq263c8b9b6bd74e22@mail.gmail.com>
	<466DD7F2.3020104@joreybump.com>
Message-ID: <ef60af090706111640p35cce6a3u407693f2563d441f@mail.gmail.com>

On 6/12/07, Jorey Bump <list@joreybump.com> wrote:
> Gert Cuykens wrote:
>
> > So i guess my first thing would be explaining dfo is nothing else then
> > a bunch of  handlers and some static xhtml javascript pages that post
> > xml data to communicate with the server using xmlhttprequest.
>
> Actually, the first thing you should do is introduce the full name
> before the abbreviation in any related document or correspondence, then
> define it so we know what you are talking about (fill in the blanks):
>
>   D______ F______ O_______ (DFO) is ______________.
>
> Then write some documentation and include it on your web site. If you
> have documentation in your download, be sure to provide links to that
> documentation on your web site, so it isn't necessary to download and
> expand your tarball just to find out if it's worth trying out. Also, fix
> your spelling and grammatical errors in your documentation, because
> typos here will make visitors suspect that there are typos in your code.
> And if you want people to run your SQL scripts as the mysql root user,
> you'd better have a very good reason (which you don't).
>
>

Ok, the reason for root is, i know i know stupid reason, but it was
that there is always a root user :) For example if i would tell people
to do mysql -u www -p < script.sql they probably will get

ERROR 1045 (28000): Access denied for user 'www'@'localhost' (using
password: YES)

But never the less i will change that, the code it self doesn't depend
on root or any specific user at all.
From gert.cuykens at gmail.com  Mon Jun 11 20:56:57 2007
From: gert.cuykens at gmail.com (Gert Cuykens)
Date: Mon Jun 11 21:03:49 2007
Subject: [mod_python] http://www.modpython.org/examples/
In-Reply-To: <ef60af090706111640p35cce6a3u407693f2563d441f@mail.gmail.com>
References: <ef60af090706110721v19b230e9o463951380fabb9c6@mail.gmail.com>
	<466D5F41.9050005@joreybump.com>
	<ef60af090706110805x4dc6ab14oabef3a06014c82ed@mail.gmail.com>
	<ef60af090706111010u5a3aae1fwf5bd2327c31d4ac5@mail.gmail.com>
	<466DAC68.1070305@joreybump.com>
	<ef60af090706111444o7be91a45w1ea7adcedd289c8f@mail.gmail.com>
	<928306280706111527x308ea25dj57fdca03dcc63355@mail.gmail.com>
	<ef60af090706111551o783034baq263c8b9b6bd74e22@mail.gmail.com>
	<466DD7F2.3020104@joreybump.com>
	<ef60af090706111640p35cce6a3u407693f2563d441f@mail.gmail.com>
Message-ID: <ef60af090706111756v7a1acdbxfc7c25f1b1e723ae@mail.gmail.com>

Made the changes you told me to http://dfo.sourceforge.net/ I was
thinking to make interactive documentation where i put documentation
right next to each button in the live demo examples.

Documentation in form of : "Welcom to the dfo mysql client example, if
you fill in your database name in the field below you can ... bla bla
bla ... also note if you have firebug installed you can track the data
that is been sent to and from the server in the firebug console.

Anybody want to sponsor me with a dedicated server, to promote
mod_python ? You can kick me whenever you want :)
From gert.cuykens at gmail.com  Tue Jun 12 11:10:05 2007
From: gert.cuykens at gmail.com (Gert Cuykens)
Date: Tue Jun 12 11:10:12 2007
Subject: [mod_python] http://www.modpython.org/examples/
In-Reply-To: <ef60af090706111756v7a1acdbxfc7c25f1b1e723ae@mail.gmail.com>
References: <ef60af090706110721v19b230e9o463951380fabb9c6@mail.gmail.com>
	<ef60af090706110805x4dc6ab14oabef3a06014c82ed@mail.gmail.com>
	<ef60af090706111010u5a3aae1fwf5bd2327c31d4ac5@mail.gmail.com>
	<466DAC68.1070305@joreybump.com>
	<ef60af090706111444o7be91a45w1ea7adcedd289c8f@mail.gmail.com>
	<928306280706111527x308ea25dj57fdca03dcc63355@mail.gmail.com>
	<ef60af090706111551o783034baq263c8b9b6bd74e22@mail.gmail.com>
	<466DD7F2.3020104@joreybump.com>
	<ef60af090706111640p35cce6a3u407693f2563d441f@mail.gmail.com>
	<ef60af090706111756v7a1acdbxfc7c25f1b1e723ae@mail.gmail.com>
Message-ID: <ef60af090706120810g7a67a3a0j28ab6ddec424a63d@mail.gmail.com>

New release for those who want to test it and provide feedback, login
is changed also most layouts. http://sourceforge.net/projects/dfo/
From David.Bear at asu.edu  Tue Jun 12 19:30:59 2007
From: David.Bear at asu.edu (David Bear)
Date: Tue Jun 12 19:39:21 2007
Subject: [mod_python] attempting some simple documentation
Message-ID: <20070612233059.GC8187@asu.edu>

I've been relearning some modpython stuff the past couple of weeks.
When I hit a problem and trouble the list with a question, I find 
that someone answer that same question probably a year ago -
-- and it we me that asked it.

So, I concluded that there were some important points about modpython
that I didn't comprehend then -- and should document them as I learn
them now.

I've attached the first stab at this... and would appreciate any
comments.

If this kind of documentation is deemed valuable, I would be glad to
put it in google docs -- I really loath wiki's but could be persuaded
to put it in the modpython wiki as well if enough important people
asked.

-- 
David Bear
phone: 	602-496-0424
fax: 	602-496-0955
College of Public Programs/ASU
University Center Rm 622
411 N Central
Phoenix, AZ 85007-0685
 "Beware the IP portfolio, everyone will be suspect of trespassing"
-------------- next part --------------
A non-text attachment was scrubbed...
Name: programmingModPython.odt
Type: application/octet-stream
Size: 22651 bytes
Desc: not available
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070612/a8edc7db/programmingModPython-0001.obj
From gert.cuykens at gmail.com  Tue Jun 12 21:28:14 2007
From: gert.cuykens at gmail.com (Gert Cuykens)
Date: Tue Jun 12 21:28:22 2007
Subject: [mod_python] attempting some simple documentation
In-Reply-To: <20070612233059.GC8187@asu.edu>
References: <20070612233059.GC8187@asu.edu>
Message-ID: <ef60af090706121828le2166cen63ac07df3edf8b4c@mail.gmail.com>

Why use PSP handlers ? It makes it more complicated then just writing
handlers your self, not to mention its more secure depending on where
you put the .py files ?
From graham.dumpleton at gmail.com  Tue Jun 12 21:38:05 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue Jun 12 21:38:10 2007
Subject: [mod_python] attempting some simple documentation
In-Reply-To: <ef60af090706121828le2166cen63ac07df3edf8b4c@mail.gmail.com>
References: <20070612233059.GC8187@asu.edu>
	<ef60af090706121828le2166cen63ac07df3edf8b4c@mail.gmail.com>
Message-ID: <88e286470706121838w65c2a298j7015d498c16101e3@mail.gmail.com>

On 13/06/07, Gert Cuykens <gert.cuykens@gmail.com> wrote:
> Why use PSP handlers ? It makes it more complicated then just writing
> handlers your self, not to mention its more secure depending on where
> you put the .py files ?

Why do you think one is more secure than any other?

Why do you even think that mod_python itself is secure?

Yes I know people may see this as a troll, but I ask it as a genuine
question to try and gauge how people (mis)perceive how secure
mod_python is.

Graham
From David.Bear at asu.edu  Tue Jun 12 21:30:24 2007
From: David.Bear at asu.edu (David Bear)
Date: Tue Jun 12 21:38:47 2007
Subject: [mod_python] having modpython make a data base connection
Message-ID: <20070613013024.GD8187@asu.edu>

I don't want to start a flame ware here, but I'm starting to develop
and application that will connect to a postgresql server.

I realize there are probably a dozen things I should know about
modpython before I begin.

I will be use the standard python handler. I won't be using publisher
or psp (at least I think).

I am afraid of issues like having modpython make a db connection
object that is not shared properly --. The more terrifying question is
what should be be asking.

I wonder if someone has develop a top ten rules of thumb when using
modpython with sql data base connections?


-- 
David Bear
phone: 	602-496-0424
fax: 	602-496-0955
College of Public Programs/ASU
University Center Rm 622
411 N Central
Phoenix, AZ 85007-0685
 "Beware the IP portfolio, everyone will be suspect of trespassing"
From gert.cuykens at gmail.com  Tue Jun 12 21:44:09 2007
From: gert.cuykens at gmail.com (Gert Cuykens)
Date: Tue Jun 12 21:44:14 2007
Subject: [mod_python] attempting some simple documentation
In-Reply-To: <88e286470706121838w65c2a298j7015d498c16101e3@mail.gmail.com>
References: <20070612233059.GC8187@asu.edu>
	<ef60af090706121828le2166cen63ac07df3edf8b4c@mail.gmail.com>
	<88e286470706121838w65c2a298j7015d498c16101e3@mail.gmail.com>
Message-ID: <ef60af090706121844i3ee93a39h2115bcad0abfc709@mail.gmail.com>

On 6/13/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> On 13/06/07, Gert Cuykens <gert.cuykens@gmail.com> wrote:
> > Why use PSP handlers ? It makes it more complicated then just writing
> > handlers your self, not to mention its more secure depending on where
> > you put the .py files ?
>
> Why do you think one is more secure than any other?
>
> Why do you even think that mod_python itself is secure?
>
> Yes I know people may see this as a troll, but I ask it as a genuine
> question to try and gauge how people (mis)perceive how secure
> mod_python is.
>
> Graham
>

Also forgot the word faster then psp, actually its more like waaaaay faster :)

By secure i mean a psp file that is accessible by a internet user like
a html file is less secure then a handler witch only a root user can
have aces too.
From graham.dumpleton at gmail.com  Tue Jun 12 21:55:15 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue Jun 12 21:55:20 2007
Subject: [mod_python] attempting some simple documentation
In-Reply-To: <ef60af090706121844i3ee93a39h2115bcad0abfc709@mail.gmail.com>
References: <20070612233059.GC8187@asu.edu>
	<ef60af090706121828le2166cen63ac07df3edf8b4c@mail.gmail.com>
	<88e286470706121838w65c2a298j7015d498c16101e3@mail.gmail.com>
	<ef60af090706121844i3ee93a39h2115bcad0abfc709@mail.gmail.com>
Message-ID: <88e286470706121855g58dde8e0v6ac57e1ef62e25fc@mail.gmail.com>

On 13/06/07, Gert Cuykens <gert.cuykens@gmail.com> wrote:
> On 6/13/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> > On 13/06/07, Gert Cuykens <gert.cuykens@gmail.com> wrote:
> > > Why use PSP handlers ? It makes it more complicated then just writing
> > > handlers your self, not to mention its more secure depending on where
> > > you put the .py files ?
> >
> > Why do you think one is more secure than any other?
> >
> > Why do you even think that mod_python itself is secure?
> >
> > Yes I know people may see this as a troll, but I ask it as a genuine
> > question to try and gauge how people (mis)perceive how secure
> > mod_python is.
>
> Also forgot the word faster then psp, actually its more like waaaaay faster :)
>
> By secure i mean a psp file that is accessible by a internet user like
> a html file is less secure then a handler witch only a root user can
> have aces too.

That a handler source code file wouldn't be exposed due to a
configuration mistake would only be true if it is outside of the
document tree. It is possible to put handler code files in the
document tree and sometimes this is quite convenient as it means you
can utilise Apache's URL dispatch for various things rather than
writing a slower one of your own in Python code. Also, handler source
code files wouldn't necessarily only be readable as root as Apache
child processes shouldn't be run as root, but as a separate user. Thus
that user has to be able to read the handler source code files and all
directories down to it or Apache can't work. Thus, must be all group
owned by Apache user or made readable to others. Thus, things other
than root will be able to read it one way or the other.

Graham
From graham.dumpleton at gmail.com  Tue Jun 12 21:58:06 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue Jun 12 21:58:11 2007
Subject: [mod_python] having modpython make a data base connection
In-Reply-To: <20070613013024.GD8187@asu.edu>
References: <20070613013024.GD8187@asu.edu>
Message-ID: <88e286470706121858s4204ef0dx32369c9459d50c41@mail.gmail.com>

For starters, if you haven't read:

  http://www.dscpl.com.au/wiki/ModPython/Articles/TheProcessInterpreterModel

do so.

Second, be very careful about putting database connection objects in
modules which are candidates for reloading. For stuff about how to
deal with this if you want to do that, read documentation for
import_module() in:

  http://www.modpython.org/live/current/doc-html/pyapi-apmeth.html

I'll let others argue the merits of database connection pooling versus
a connection per request as not an area I have direct experience with.

Graham

On 13/06/07, David Bear <David.Bear@asu.edu> wrote:
> I don't want to start a flame ware here, but I'm starting to develop
> and application that will connect to a postgresql server.
>
> I realize there are probably a dozen things I should know about
> modpython before I begin.
>
> I will be use the standard python handler. I won't be using publisher
> or psp (at least I think).
>
> I am afraid of issues like having modpython make a db connection
> object that is not shared properly --. The more terrifying question is
> what should be be asking.
>
> I wonder if someone has develop a top ten rules of thumb when using
> modpython with sql data base connections?
>
>
> --
> David Bear
> phone:  602-496-0424
> fax:    602-496-0955
> College of Public Programs/ASU
> University Center Rm 622
> 411 N Central
> Phoenix, AZ 85007-0685
>  "Beware the IP portfolio, everyone will be suspect of trespassing"
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From gert.cuykens at gmail.com  Tue Jun 12 21:55:05 2007
From: gert.cuykens at gmail.com (Gert Cuykens)
Date: Tue Jun 12 22:02:13 2007
Subject: [mod_python] having modpython make a data base connection
In-Reply-To: <20070613013024.GD8187@asu.edu>
References: <20070613013024.GD8187@asu.edu>
Message-ID: <ef60af090706121855l5defeecdl59ad98575ae100f7@mail.gmail.com>

On 6/13/07, David Bear <David.Bear@asu.edu> wrote:
> I don't want to start a flame ware here, but I'm starting to develop
> and application that will connect to a postgresql server.
>
> I realize there are probably a dozen things I should know about
> modpython before I begin.
>
> I will be use the standard python handler. I won't be using publisher
> or psp (at least I think).
>
> I am afraid of issues like having modpython make a db connection
> object that is not shared properly --. The more terrifying question is
> what should be be asking.
>
> I wonder if someone has develop a top ten rules of thumb when using
> modpython with sql data base connections?
>
>

I have mysql sample code in my dfo.sourceforge.net project i also have
postgresql code but you have to enable it manually by modifying the
code. I forgot why i went back to mysql but i had a good reason for
it, one was performance the other had to do with conviniance and error
handling.
From gert.cuykens at gmail.com  Tue Jun 12 22:06:32 2007
From: gert.cuykens at gmail.com (Gert Cuykens)
Date: Tue Jun 12 22:06:37 2007
Subject: [mod_python] attempting some simple documentation
In-Reply-To: <88e286470706121855g58dde8e0v6ac57e1ef62e25fc@mail.gmail.com>
References: <20070612233059.GC8187@asu.edu>
	<ef60af090706121828le2166cen63ac07df3edf8b4c@mail.gmail.com>
	<88e286470706121838w65c2a298j7015d498c16101e3@mail.gmail.com>
	<ef60af090706121844i3ee93a39h2115bcad0abfc709@mail.gmail.com>
	<88e286470706121855g58dde8e0v6ac57e1ef62e25fc@mail.gmail.com>
Message-ID: <ef60af090706121906w13068594ia6b04e3643359226@mail.gmail.com>

On 6/13/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> On 13/06/07, Gert Cuykens <gert.cuykens@gmail.com> wrote:
> > By secure i mean a psp file that is accessible by a internet user like
> > a html file is less secure then a handler witch only a root user can
> > have aces too.
>
> That a handler source code file wouldn't be exposed due to a
> configuration mistake would only be true if it is outside of the
> document tree. It is possible to put handler code files in the
> document tree and sometimes this is quite convenient as it means you
> can utilise Apache's URL dispatch for various things rather than
> writing a slower one of your own in Python code. Also, handler source
> code files wouldn't necessarily only be readable as root as Apache
> child processes shouldn't be run as root, but as a separate user. Thus
> that user has to be able to read the handler source code files and all
> directories down to it or Apache can't work. Thus, must be all group
> owned by Apache user or made readable to others. Thus, things other
> than root will be able to read it one way or the other.
>
> Graham
>

Still www-data user outside the doctree is more secure then internet
user inside doctree :P
From greg at vig.co.nz  Tue Jun 12 22:33:24 2007
From: greg at vig.co.nz (Greg Fawcett)
Date: Tue Jun 12 22:33:31 2007
Subject: [mod_python] having modpython make a data base connection
In-Reply-To: <20070613013024.GD8187@asu.edu>
References: <20070613013024.GD8187@asu.edu>
Message-ID: <928306280706121933t51bdf992p22e4399b0714c76c@mail.gmail.com>

Hi David -

For Postgresql, you have a choice between pygresql (seems to be the defacto
standard) and psycopg (also has a strong following). I tested both and
decided to go with psycopg, because it seemed faster and more complete at
the time. I recommend getting it as source rather than relying on your
distribution's package manager, because there is a lot of improvement
happening. This goes for mod-python too - the latest stable release is far
easier to work with.

If your system is three-tier (database on a separate machine) you might want
to look at pgpool, a very well regarded pooling daemon.

Cheers!
Greg.

On 13/06/07, David Bear <David.Bear@asu.edu> wrote:
>
> I don't want to start a flame ware here, but I'm starting to develop
> and application that will connect to a postgresql server.
>
> I realize there are probably a dozen things I should know about
> modpython before I begin.
>
> I will be use the standard python handler. I won't be using publisher
> or psp (at least I think).
>
> I am afraid of issues like having modpython make a db connection
> object that is not shared properly --. The more terrifying question is
> what should be be asking.
>
> I wonder if someone has develop a top ten rules of thumb when using
> modpython with sql data base connections?
>
>
> --
> David Bear
> phone:  602-496-0424
> fax:    602-496-0955
> College of Public Programs/ASU
> University Center Rm 622
> 411 N Central
> Phoenix, AZ 85007-0685
> "Beware the IP portfolio, everyone will be suspect of trespassing"
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>



-- 
Phone: +64 3 409 8165
Mobile: +64 21 333 291
Fax: +64 3 974 6810
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070613/46e5db42/attachment-0001.html
From David.Bear at asu.edu  Tue Jun 12 23:01:41 2007
From: David.Bear at asu.edu (David Bear)
Date: Tue Jun 12 23:10:08 2007
Subject: [mod_python] having modpython make a data base connection
In-Reply-To: <88e286470706121858s4204ef0dx32369c9459d50c41@mail.gmail.com>
References: <20070613013024.GD8187@asu.edu>
	<88e286470706121858s4204ef0dx32369c9459d50c41@mail.gmail.com>
Message-ID: <20070613030141.GE8187@asu.edu>

On Wed, Jun 13, 2007 at 11:58:06AM +1000, Graham Dumpleton wrote:
> For starters, if you haven't read:
> 
>  http://www.dscpl.com.au/wiki/ModPython/Articles/TheProcessInterpreterModel
> 
> do so.

If I structure the program to exist in a single file, make my db
connections from there, does this imply that I could have 'multiple'
connections made to the data base? 

I am using the worker mode of apache on linux. This means that I do
have multiple child apaches and threads in each. So, I'm not sure if I
have 5 children and 2 thread per child that would imply 10 connections
to the data base?

> 
> Second, be very careful about putting database connection objects in
> modules which are candidates for reloading. For stuff about how to
> deal with this if you want to do that, read documentation for
> import_module() in:

I don't know why a module would be reloaded. I'm still thinking in
terms of the cgi model where the script runs, connection made to db,
data is updated, connection closed, script dies, done.

Under what conditions would a module be reloaded? And if I use the
handler mode (no publisher or psp) and the data base connection is
made in the handler function, does that imply the connection is made
when apache is started (and the script is run for the first time) and
lives untill apache dies?

> 
>  http://www.modpython.org/live/current/doc-html/pyapi-apmeth.html
> 
> I'll let others argue the merits of database connection pooling versus
> a connection per request as not an area I have direct experience with.

As they say, I'm against premature optimization -- I don't know enough
to care at this point. I just want to run in 'safest way', that means
the most predictable.

> 
> Graham
> 
> On 13/06/07, David Bear <David.Bear@asu.edu> wrote:
> >I don't want to start a flame ware here, but I'm starting to develop
> >and application that will connect to a postgresql server.
> >
> >I realize there are probably a dozen things I should know about
> >modpython before I begin.
> >
> >I will be use the standard python handler. I won't be using publisher
> >or psp (at least I think).
> >
> >I am afraid of issues like having modpython make a db connection
> >object that is not shared properly --. The more terrifying question is
> >what should be be asking.
> >
> >I wonder if someone has develop a top ten rules of thumb when using
> >modpython with sql data base connections?
> >
> >
> >--
> >David Bear
> >phone:  602-496-0424
> >fax:    602-496-0955
> >College of Public Programs/ASU
> >University Center Rm 622
> >411 N Central
> >Phoenix, AZ 85007-0685
> > "Beware the IP portfolio, everyone will be suspect of trespassing"
> >_______________________________________________
> >Mod_python mailing list
> >Mod_python@modpython.org
> >http://mailman.modpython.org/mailman/listinfo/mod_python
> >

-- 
David Bear
phone: 	602-496-0424
fax: 	602-496-0955
College of Public Programs/ASU
University Center Rm 622
411 N Central
Phoenix, AZ 85007-0685
 "Beware the IP portfolio, everyone will be suspect of trespassing"
From graham.dumpleton at gmail.com  Wed Jun 13 03:31:07 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Wed Jun 13 03:31:12 2007
Subject: [mod_python] having modpython make a data base connection
In-Reply-To: <20070613030141.GE8187@asu.edu>
References: <20070613013024.GD8187@asu.edu>
	<88e286470706121858s4204ef0dx32369c9459d50c41@mail.gmail.com>
	<20070613030141.GE8187@asu.edu>
Message-ID: <88e286470706130031n5d876bfcya9523346891f3cc7@mail.gmail.com>

On 13/06/07, David Bear <David.Bear@asu.edu> wrote:
> On Wed, Jun 13, 2007 at 11:58:06AM +1000, Graham Dumpleton wrote:
> > For starters, if you haven't read:
> >
> >  http://www.dscpl.com.au/wiki/ModPython/Articles/TheProcessInterpreterModel
> >
> > do so.
>
> If I structure the program to exist in a single file, make my db
> connections from there, does this imply that I could have 'multiple'
> connections made to the data base?
>
> I am using the worker mode of apache on linux. This means that I do
> have multiple child apaches and threads in each. So, I'm not sure if I
> have 5 children and 2 thread per child that would imply 10 connections
> to the data base?

Depends.

The handler module is only loaded once for each process (ignoring
reloads at this point), and all the threads in each process execute
against the same loaded module. If the database client supports one
connection and then multiple sessions across that one connection, then
you can create and/or cache the database connection object at global
scope within the handler module. In that case, there would only be one
connection per process.

BTW, 2 threads per child in worker is very low, normally it would be
25 by default. Also, I strongly discourage creating database
connections as a side effect of importing the handler module as a
failure to connect can then leave the web application unusable as
nothing is going to re-trigger the module import to allow the
connection code to rerun. Thus, even though it delays the creation of
the connection, I would only do it the first time a handler requires
the connection. This does mean that connection creation and caching
has to be thread protected to stop more than one being created at the
same time.

Now, if instead you create the connection for every request as I am
sure some will promote as the simplest approach and for some database
also more than adequate, then every request can result in a separate
connection thus meaning as many as number of process times number of
threads. Noting that Apache may create more than 2 child processes
when under heavy load.

> > Second, be very careful about putting database connection objects in
> > modules which are candidates for reloading. For stuff about how to
> > deal with this if you want to do that, read documentation for
> > import_module() in:
>
> I don't know why a module would be reloaded. I'm still thinking in
> terms of the cgi model where the script runs, connection made to db,
> data is updated, connection closed, script dies, done.
>
> Under what conditions would a module be reloaded?

For a handler module which is located in the document tree (not on
sys.path), it will be automatically reloaded when its code file, or
the code file of any related module also in the document tree or found
on the mod_python module importers path has changed. Same applied to
publisher modules.

The issue with reloading is that the module is reimported into a new
module instance and the old data thrown away. If however the old data
isn't able to clean itself up properly through destructors, ie. close
database connections, you will get resource leakage. The documentation
I pointed you to shows how you can supply hooks to copy data across
from old module to new module when a reload occurs, thus allowing
already open database connection object to be reused.

If you don't want to deal with the possibilities of module reloading,
then turn it off using the directive:

  PythonAutoReload Off

Do this though and you will need to restart Apache when you make any
code changes to modules even if they are in the document tree (not on
sys.path).

> And if I use the
> handler mode (no publisher or psp) and the data base connection is
> made in the handler function, does that imply the connection is made
> when apache is started (and the script is run for the first time) and
> lives untill apache dies?

Depends on whether you are then caching the database connection object
at global scope in module as I mentioned before. Again note that such
caching has to be thread protected to stop multiple requests trying to
do it at the same time in the same process.

Graham

> >  http://www.modpython.org/live/current/doc-html/pyapi-apmeth.html
> >
> > I'll let others argue the merits of database connection pooling versus
> > a connection per request as not an area I have direct experience with.
>
> As they say, I'm against premature optimization -- I don't know enough
> to care at this point. I just want to run in 'safest way', that means
> the most predictable.
>
> >
> > Graham
> >
> > On 13/06/07, David Bear <David.Bear@asu.edu> wrote:
> > >I don't want to start a flame ware here, but I'm starting to develop
> > >and application that will connect to a postgresql server.
> > >
> > >I realize there are probably a dozen things I should know about
> > >modpython before I begin.
> > >
> > >I will be use the standard python handler. I won't be using publisher
> > >or psp (at least I think).
> > >
> > >I am afraid of issues like having modpython make a db connection
> > >object that is not shared properly --. The more terrifying question is
> > >what should be be asking.
> > >
> > >I wonder if someone has develop a top ten rules of thumb when using
> > >modpython with sql data base connections?
> > >
> > >
> > >--
> > >David Bear
> > >phone:  602-496-0424
> > >fax:    602-496-0955
> > >College of Public Programs/ASU
> > >University Center Rm 622
> > >411 N Central
> > >Phoenix, AZ 85007-0685
> > > "Beware the IP portfolio, everyone will be suspect of trespassing"
> > >_______________________________________________
> > >Mod_python mailing list
> > >Mod_python@modpython.org
> > >http://mailman.modpython.org/mailman/listinfo/mod_python
> > >
>
> --
> David Bear
> phone:  602-496-0424
> fax:    602-496-0955
> College of Public Programs/ASU
> University Center Rm 622
> 411 N Central
> Phoenix, AZ 85007-0685
>  "Beware the IP portfolio, everyone will be suspect of trespassing"
>
From David.Bear at asu.edu  Wed Jun 13 13:14:01 2007
From: David.Bear at asu.edu (David Bear)
Date: Wed Jun 13 13:22:31 2007
Subject: [mod_python] the req object
Message-ID: <20070613171401.GA14723@asu.edu>

When is the req object made available?

I'm trying something simple like this.

import sys
try:
   from mod_python import apache
except:
   print "import error"
   sys.exit(1)
try:
   import dummymodule
except:
   req.content_type = 'text/plain'
   req.write('error importing dummy')
   return apache.OK

when the import dummymodule fails, the req object is not available to
it. Without the req object, how does one send output anywhere?

-- 
David Bear
phone: 	602-496-0424
fax: 	602-496-0955
College of Public Programs/ASU
University Center Rm 622
411 N Central
Phoenix, AZ 85007-0685
 "Beware the IP portfolio, everyone will be suspect of trespassing"
From jpg at jgassociates.ca  Wed Jun 13 16:15:38 2007
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Wed Jun 13 16:14:35 2007
Subject: [mod_python] the req object
In-Reply-To: <20070613171401.GA14723@asu.edu>
References: <20070613171401.GA14723@asu.edu>
Message-ID: <4670506A.9040905@jgassociates.ca>

Hi David,

David Bear wrote:
> When is the req object made available?
> 
> I'm trying something simple like this.
> 
> import sys
> try:
>    from mod_python import apache
> except:
>    print "import error"
>    sys.exit(1)
> try:
>    import dummymodule
> except:
>    req.content_type = 'text/plain'
>    req.write('error importing dummy')
>    return apache.OK
> 
> when the import dummymodule fails, the req object is not available to
> it. Without the req object, how does one send output anywhere?

That's a strange bit of code you have there. ;) Your code would only get 
executed by mod_python once, when the module is first loaded.

Read the following treatise and see if things make a bit more sense.

The mod_python request object is a pythonic wrapper around the apache 
request_rec structure and is associated with a *specific* request. It is 
not a global variable and it's not available outside the context of that 
request.

When apache services a new request it fills out the request_rec data 
structure (which is a C struct). In the event that mod_python is invoked 
by a configuration directive (PythonHandler helloworld, for example), 
apache passes this data structure to mod_python. Mod_python creates a 
python object, with a number of methods and attributes which allow you 
to access the contents of the request_rec in a pythonic way. By 
convention we call this object "req" in the documentation and mailing 
lists, but the name has no special meaning beyond that. It is not a 
global variable as your code above would seem to suggest.

For the sake of argument, just assume that your code will be read, 
parsed, compiled and evaluated once when it is first imported. (This is 
not strictly true, but it's close enough for our purposes here). Code at 
the module scope will be executed once.

So, how do you get at the request object and how is the request 
processed? Why, through your handler method of course! The request 
object will be passed as the first parameter to your handler method. 
Think of the handler method as the entry point into your code for each 
request.

Consider the simplest possible handler as an example:

AddHandler mod_python .py
PythonHandler helloworld


helloworld.py
-------------

from mod_python import apache

MSG = 'Hello world'
my_sum = 10 + 10

def handler(req):
     req.content_type = 'text/plain'
     req.write(MSG)
     return apache.OK

Note that the statement my_sum = 10 + 10 is only executed once, not 
every time a new request arrives. Same for MSG and our initial import 
statement.

The AddHandler directive tells apache that mod_python is going to handle 
the content generation phase of the request. The PythonHandler directive 
tells mod_python that the handler is in the helloworld module. 
Mod_python imports that module if it is not already loaed and looks for 
a method named "handler", which is the default method name.

You can actually specify a different method in your apache configuration:

AddHandler mod_python .py
PythonHandler helloworld2::alternate_thingy

helloworld2.py
-------------

from mod_python import apache

def handler(req):
     # This will never be called since we are specifying
     # a different handler method name in our PythonHandler directive.
     req.content_type = 'text/plain'
     req.write('Hello world')
     return apache.OK

def alternate_thingy(req):
     # this is the handler that will get called.
     req.content_type = 'text/plain'
     req.write('Hello world - from the alternate_thingy method')
     return apache.OK

The default method that mod_python will look for depends on the 
particular directive used (and each directive will get invoked in a 
different phase the request processing):

Configurate Directive Name           default mod_python method
----------------------------         ---------------------------
PythonPostReadRequestHandler         postreadrequesthandler(req)
PythonTransHandler                   transhandler(req)
PythonHeaderParserHandler            headerparserhandler(req)
PythonInitHandler                    inithandler(req)
PythonAccessHandler                  accesshandler(req)
PythonAuthenHandler                  authenhandler(req)
PythonAuthzHandler                   authzhandler(req)
PythonTypeHandler                    typehandler(req)
PythonFixupHandler                   fixuphandler(req)
PythonHandler                        handler(req)
PythonLogHandler                     loghandler(req)

(hint: the method name is a lowercase version of the Directive the 
"python" prefix stripped off)

So what about the Publisher handler? Publisher is an example of a 
content handler (it's invoked with PythonHandler) that evaluates the 
request URI and derives the handler method name from that URI. It's 
dynamically doing what we did with a static directive in the helloworld2 
example. Just like any other handler, in any other phase, it calls the 
method with the request object as the first parameter.

I think I know what you're trying to accomplish with your code snippet 
above, but it really is not the way to go. Trying to make your 
mod_python code usable (as far as handlers are concerned) outside of 
mod_python is a loosing proposition. You might want to take a look at 
the source code and dig into the way we do unit testing. I know it's not 
as nice as firing up a command line interpreter, but it is possible to 
write robust code without it.

Jim






From David.Bear at asu.edu  Thu Jun 14 12:37:24 2007
From: David.Bear at asu.edu (David Bear)
Date: Thu Jun 14 12:46:07 2007
Subject: [mod_python] the req object
In-Reply-To: <4670506A.9040905@jgassociates.ca>
References: <20070613171401.GA14723@asu.edu> <4670506A.9040905@jgassociates.ca>
Message-ID: <20070614163723.GA25026@asu.edu>

On Wed, Jun 13, 2007 at 04:15:38PM -0400, Jim Gallacher wrote:
> Hi David,
> 
> David Bear wrote:
> >When is the req object made available?
> >
> >
> >when the import dummymodule fails, the req object is not available to
> >it. Without the req object, how does one send output anywhere?
> 
> That's a strange bit of code you have there. ;) Your code would only get 
> executed by mod_python once, when the module is first loaded.

strange becuase its only illustrates how I think I want to catch
exceptions on module imports.

Thank you so much for the great explanation below. I'll read it a
third time to see if I can make more sense of it.

Prior to that, what recommendations are there for catching exceptions
on module import failures. There is a vast amount of functionality
that isn't available untill modules are correctly imported. So I see a
heirarchy of needs -- modules that MUST import or the script MUST die.
Then, modules that should import or display and error to the browser.
Then, modules that could important -- for better, faster, stronger
ways of doing something, or my code could resort to doing something
different.

So how would I handle the except when
1) critical module import fails and NO access to any apache data is
available, i.e., failure to import mod_python
2) operational module files to import and I need to send the message
to the client browser
3) import failure where a nice message is just included in the output
stream (well, I think I can figure this one out)

number 1 above seems the most problematic.

> 
> 

-- 
David Bear
phone: 	602-496-0424
fax: 	602-496-0955
College of Public Programs/ASU
University Center Rm 622
411 N Central
Phoenix, AZ 85007-0685
 "Beware the IP portfolio, everyone will be suspect of trespassing"
From seb.dailly at gmail.com  Thu Jun 14 17:00:56 2007
From: seb.dailly at gmail.com (Seb)
Date: Thu Jun 14 17:01:03 2007
Subject: [mod_python] Pickle can't save classes instances in mod_python ?
Message-ID: <b4e79f7c0706141400q10e4651awab0b77a5bd517ea5@mail.gmail.com>

Hello !

I've found something a bit strange in mod_python : the pickle
instruction doesn't work when we want to save classes ( there is no
probl?me with tupple or list.. )

I made this code for explain it:

-->
import mod_python
import pickle

#Create a very simple class object
class another_class:

       def __init__(self, text):
               self.text =     text

#Another one class
class a_class:

       def __init__(self):
               self.elements = []

               #Add an element of the second class
               self.add_entry("test")
               self.save()

       def add_entry(self, name):
               self.elements.append( another_class(name) )

       def save(self):
               #Try to save it with pickle.. works but
               result = pickle.dumps(self.elements)
               #We can't load the data after !
               self.elements = pickle.loads(result)

#If all works good, send a message
def handler(req):
       req.write( 'ok' )
       return(mod_python.apache.OK)

#We run this class outside any mod_python event
my_class = a_class()
<--

And here is the result :

-->
MOD_PYTHON ERROR

ProcessId:      5104
Interpreter:    'localhost.localdomain'

ServerName:     'localhost.localdomain'
DocumentRoot:   '/var/www/'

URI:            '/~sebastien/test/'
Location:       None
Directory:      '/home/sebastien/public_html/test/'
Filename:       '/home/sebastien/public_html/test/'
PathInfo:       ''

Phase:          'PythonHandler'
Handler:        'handler'

Traceback (most recent call last):

 File "/usr/lib/python2.4/site-packages/mod_python/importer.py", line
1537, in HandlerDispatch
   default=default_handler, arg=req, silent=hlist.silent)

 File "/usr/lib/python2.4/site-packages/mod_python/importer.py", line
1202, in _process_target
   module = import_module(module_name, path=path)

 File "/usr/lib/python2.4/site-packages/mod_python/importer.py", line
296, in import_module
   log, import_path)

 File "/usr/lib/python2.4/site-packages/mod_python/importer.py", line
680, in import_module
   execfile(file, module.__dict__)

 File "/home/sebastien/public_html/test/handler.py", line 35, in ?
   my_class = a_class()

 File "/home/sebastien/public_html/test/handler.py", line 18, in __init__
   self.save()

 File "/home/sebastien/public_html/test/handler.py", line 27, in save
   self.elements = pickle.loads(result)

 File "pickle.py", line 1394, in loads
   return Unpickler(file).load()

 File "pickle.py", line 872, in load
   dispatch[key](self)

 File "pickle.py", line 1083, in load_inst
   klass = self.find_class(module, name)

 File "pickle.py", line 1138, in find_class
   __import__(module)

ImportError: No module named _mp_e3b5c44c50230d33c470783bc2809f23


MODULE CACHE DETAILS

Accessed:       Thu Jun 14 22:49:06 2007
Generation:     3

_mp_e3b5c44c50230d33c470783bc2809f23 {
 FileName:     '/home/sebastien/public_html/test/handler.py'
 Instance:     3 [RELOAD]
 Generation:   3 [ERROR]
 Modified:     Thu Jun 14 22:48:49 2007
 Imported:     Thu Jun 14 22:37:06 2007
}
<--

When I launch this program inside a terminal, all works fine, there
are no error message, so I don't understand what happend..

From graham.dumpleton at gmail.com  Thu Jun 14 18:40:06 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu Jun 14 18:40:12 2007
Subject: [mod_python] Pickle can't save classes instances in mod_python ?
In-Reply-To: <b4e79f7c0706141400q10e4651awab0b77a5bd517ea5@mail.gmail.com>
References: <b4e79f7c0706141400q10e4651awab0b77a5bd517ea5@mail.gmail.com>
Message-ID: <88e286470706141540w5a6834b6ie4bd5402e8e1e465@mail.gmail.com>

Read:

  http://www.dscpl.com.au/wiki/ModPython/Articles/IssuesWithSessionObjects

Although document was written in reference to sessions, they use
pickle and thus it still applies.

Graham

On 15/06/07, Seb <seb.dailly@gmail.com> wrote:
> Hello !
>
> I've found something a bit strange in mod_python : the pickle
> instruction doesn't work when we want to save classes ( there is no
> probl?me with tupple or list.. )
>
> I made this code for explain it:
>
> -->
> import mod_python
> import pickle
>
> #Create a very simple class object
> class another_class:
>
>        def __init__(self, text):
>                self.text =     text
>
> #Another one class
> class a_class:
>
>        def __init__(self):
>                self.elements = []
>
>                #Add an element of the second class
>                self.add_entry("test")
>                self.save()
>
>        def add_entry(self, name):
>                self.elements.append( another_class(name) )
>
>        def save(self):
>                #Try to save it with pickle.. works but
>                result = pickle.dumps(self.elements)
>                #We can't load the data after !
>                self.elements = pickle.loads(result)
>
> #If all works good, send a message
> def handler(req):
>        req.write( 'ok' )
>        return(mod_python.apache.OK)
>
> #We run this class outside any mod_python event
> my_class = a_class()
> <--
>
> And here is the result :
>
> -->
> MOD_PYTHON ERROR
>
> ProcessId:      5104
> Interpreter:    'localhost.localdomain'
>
> ServerName:     'localhost.localdomain'
> DocumentRoot:   '/var/www/'
>
> URI:            '/~sebastien/test/'
> Location:       None
> Directory:      '/home/sebastien/public_html/test/'
> Filename:       '/home/sebastien/public_html/test/'
> PathInfo:       ''
>
> Phase:          'PythonHandler'
> Handler:        'handler'
>
> Traceback (most recent call last):
>
>  File "/usr/lib/python2.4/site-packages/mod_python/importer.py", line
> 1537, in HandlerDispatch
>    default=default_handler, arg=req, silent=hlist.silent)
>
>  File "/usr/lib/python2.4/site-packages/mod_python/importer.py", line
> 1202, in _process_target
>    module = import_module(module_name, path=path)
>
>  File "/usr/lib/python2.4/site-packages/mod_python/importer.py", line
> 296, in import_module
>    log, import_path)
>
>  File "/usr/lib/python2.4/site-packages/mod_python/importer.py", line
> 680, in import_module
>    execfile(file, module.__dict__)
>
>  File "/home/sebastien/public_html/test/handler.py", line 35, in ?
>    my_class = a_class()
>
>  File "/home/sebastien/public_html/test/handler.py", line 18, in __init__
>    self.save()
>
>  File "/home/sebastien/public_html/test/handler.py", line 27, in save
>    self.elements = pickle.loads(result)
>
>  File "pickle.py", line 1394, in loads
>    return Unpickler(file).load()
>
>  File "pickle.py", line 872, in load
>    dispatch[key](self)
>
>  File "pickle.py", line 1083, in load_inst
>    klass = self.find_class(module, name)
>
>  File "pickle.py", line 1138, in find_class
>    __import__(module)
>
> ImportError: No module named _mp_e3b5c44c50230d33c470783bc2809f23
>
>
> MODULE CACHE DETAILS
>
> Accessed:       Thu Jun 14 22:49:06 2007
> Generation:     3
>
> _mp_e3b5c44c50230d33c470783bc2809f23 {
>  FileName:     '/home/sebastien/public_html/test/handler.py'
>  Instance:     3 [RELOAD]
>  Generation:   3 [ERROR]
>  Modified:     Thu Jun 14 22:48:49 2007
>  Imported:     Thu Jun 14 22:37:06 2007
> }
> <--
>
> When I launch this program inside a terminal, all works fine, there
> are no error message, so I don't understand what happend..

From David.Bear at asu.edu  Thu Jun 14 18:49:44 2007
From: David.Bear at asu.edu (David Bear)
Date: Thu Jun 14 18:58:30 2007
Subject: [mod_python] the req object
In-Reply-To: <4670506A.9040905@jgassociates.ca>
References: <20070613171401.GA14723@asu.edu> <4670506A.9040905@jgassociates.ca>
Message-ID: <20070614224944.GE25026@asu.edu>

On Wed, Jun 13, 2007 at 04:15:38PM -0400, Jim Gallacher wrote:
> Hi David,
> 
> David Bear wrote:
> >When is the req object made available?
> >
> Think of the handler method as the entry point into your code for each 
> request.
> 
> Consider the simplest possible handler as an example:
> 
> AddHandler mod_python .py
> PythonHandler helloworld
> 
> 
> helloworld.py
> -------------
> 
> from mod_python import apache
> 
> MSG = 'Hello world'
> my_sum = 10 + 10
> 
> def handler(req):
>     req.content_type = 'text/plain'
>     req.write(MSG)
>     return apache.OK
> 
> Note that the statement my_sum = 10 + 10 is only executed once, not 
> every time a new request arrives. Same for MSG and our initial import 
> statement.

OK. Great. So, my_sum = 10 + 10 is executed when apache loads and
reads helloworld.py the first time -- and upon any subsequent module
reloads? This makes sense to me.. is it correct?

What if helloworld.py imported another module named goodbye.py that
had this:

goodbye.py
-----------

newvar = 10 + 10

def coolfunc(somestring):
   backwards = somestring.split()
   backwards.reverse()
   return(backwards)

If I understand, when helloworld is imported, any imports it does will
also be executed -- and then any expressions in the imported modules
will ALSO be evaluated when they are imported. So, newvar will be
evaluated when helloworld is imported by apache -- but coolfunc won't
do anything untill it is called presumably by helloword.py.

Am I approaching correctness here?

> 
> 
> 

-- 
David Bear
phone: 	602-496-0424
fax: 	602-496-0955
College of Public Programs/ASU
University Center Rm 622
411 N Central
Phoenix, AZ 85007-0685
 "Beware the IP portfolio, everyone will be suspect of trespassing"
From graham.dumpleton at gmail.com  Thu Jun 14 19:23:48 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu Jun 14 19:23:53 2007
Subject: [mod_python] the req object
In-Reply-To: <20070614163723.GA25026@asu.edu>
References: <20070613171401.GA14723@asu.edu> <4670506A.9040905@jgassociates.ca>
	<20070614163723.GA25026@asu.edu>
Message-ID: <88e286470706141623r40d21e09ked3642796664f81@mail.gmail.com>

On 15/06/07, David Bear <David.Bear@asu.edu> wrote:
> On Wed, Jun 13, 2007 at 04:15:38PM -0400, Jim Gallacher wrote:
> > Hi David,
> >
> > David Bear wrote:
> > >When is the req object made available?
> > >
> > >
> > >when the import dummymodule fails, the req object is not available to
> > >it. Without the req object, how does one send output anywhere?
> >
> > That's a strange bit of code you have there. ;) Your code would only get
> > executed by mod_python once, when the module is first loaded.
>
> strange becuase its only illustrates how I think I want to catch
> exceptions on module imports.
>
> Thank you so much for the great explanation below. I'll read it a
> third time to see if I can make more sense of it.
>
> Prior to that, what recommendations are there for catching exceptions
> on module import failures. There is a vast amount of functionality
> that isn't available untill modules are correctly imported. So I see a
> heirarchy of needs -- modules that MUST import or the script MUST die.
> Then, modules that should import or display and error to the browser.
> Then, modules that could important -- for better, faster, stronger
> ways of doing something, or my code could resort to doing something
> different.
>
> So how would I handle the except when
> 1) critical module import fails and NO access to any apache data is
> available, i.e., failure to import mod_python

If it is actually a syntax error or really unexpected exception then
just let it be raised and don't try and catch it. The actual failure
to import the module will result in a 500 error returned to the HTTP
client which may have triggered the input through the loading of a
specific handler. The details of the exception will also appear in the
error log.

When such errors occurs, at least for a handler module managed by the
mod_python importer it will not cache the broken module and on the
next request will try and import it yet again. If the module which
broke was on sys.path though it will be stuck in memory and an Apache
restart required after fixing it.

If it is some type of runtime error, for example related to creating a
database connection, then catch the exception and log to the Apache
error log using apache.log_error() and some message of your own. Your
code should track when it fails and when a handler subsequently tries
to use what failed to work (connect), should retry the operation again
and if it succeeds keep going otherwise log problem and raise more
specific 500 error page to the HTTP client.

In other words, if you are trying to do something up front at time of
module import and that operation can be retried, log a message but
allow the handler to retry it when it is actually first required as
well.

Graham

> 2) operational module files to import and I need to send the message
> to the client browser
> 3) import failure where a nice message is just included in the output
> stream (well, I think I can figure this one out)
>
> number 1 above seems the most problematic.
>
> >
> >
>
> --
> David Bear
> phone:  602-496-0424
> fax:    602-496-0955
> College of Public Programs/ASU
> University Center Rm 622
> 411 N Central
> Phoenix, AZ 85007-0685
>  "Beware the IP portfolio, everyone will be suspect of trespassing"
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From graham.dumpleton at gmail.com  Thu Jun 14 22:26:39 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu Jun 14 22:26:44 2007
Subject: [mod_python] SystemError: bad argument to internal function
In-Reply-To: <a595de7a0706080753q6a02ce87u6c2c289ab6141546@mail.gmail.com>
References: <a595de7a0706080753q6a02ce87u6c2c289ab6141546@mail.gmail.com>
Message-ID: <88e286470706141926w7b8699a5ob81d0a2478fe98f8@mail.gmail.com>

Did you ever sort this out?

I had the message in my inbox to look at but it got pushed further and
further down and forgot it was there.

Which sub revision of Python 2.4 are you using? The source code line
numbers don't match up with anything meaningful in Python 2.4.3 source
code that I have on hand.

Graham

On 09/06/07, Clodoaldo <clodoaldo.pinto.neto@gmail.com> wrote:
> I have this in my error log and I don't know what it means or what to do:
>
> [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] mod_python
> (pid=15022, interpreter='carroarodo.com', phase='PythonHandler',
> handler='~/_publisher.py'): Application error, referer:
> http://carroarodo.com/meu_anuncio
> [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] ServerName:
> 'carroarodo.com', referer: http://carroarodo.com/meu_anuncio
> [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]
> DocumentRoot: '/var/www/html/carroarodo.com', referer:
> http://carroarodo.com/meu_anuncio
> [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] URI:
> '/meu_anuncio', referer: http://carroarodo.com/meu_anuncio
> [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] Location:
> None, referer: http://carroarodo.com/meu_anuncio
> [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] Directory:
> '/var/www/html/carroarodo.com/', referer:
> http://carroarodo.com/meu_anuncio
> [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] Filename:
> '/var/www/html/carroarodo.com/meu_anuncio.py', referer:
> http://carroarodo.com/meu_anuncio
> [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] PathInfo:
> '', referer: http://carroarodo.com/meu_anuncio
> [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] Traceback
> (most recent call last):, referer: http://carroarodo.com/meu_anuncio
> [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]   File
> "/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
> 1537, in HandlerDispatch\n    default=default_handler, arg=req,
> silent=hlist.silent), referer: http://carroarodo.com/meu_anuncio
> [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]   File
> "/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
> 1229, in _process_target\n    result = _execute_target(config, req,
> object, arg), referer: http://carroarodo.com/meu_anuncio
> [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]   File
> "/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
> 1128, in _execute_target\n    result = object(arg), referer:
> http://carroarodo.com/meu_anuncio
> [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]   File
> "/var/www/html/carroarodo.com/_publisher.py", line 5, in handler\n
> return publisher.handler(req), referer:
> http://carroarodo.com/meu_anuncio
> [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]   File
> "/usr/lib64/python2.4/site-packages/mod_python/publisher.py", line
> 213, in handler\n    published = publish_object(req, object), referer:
> http://carroarodo.com/meu_anuncio
> [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]   File
> "/usr/lib64/python2.4/site-packages/mod_python/publisher.py", line
> 424, in publish_object\n    req.form = util.FieldStorage(req,
> keep_blank_values=1), referer: http://carroarodo.com/meu_anuncio
> [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]   File
> "/usr/lib64/python2.4/site-packages/mod_python/util.py", line 225, in
> __init__\n    pairs = parse_qsl(req.read(clen), keep_blank_val[Tue Jun
> 05 18:33:49 2007] [error] [client 200.155.85.225] SystemError:
> Objects/stringobject.c:3515: bad argument to internal function,
> referer: http://carroarodo.com/meu_anuncio
>
> Any hints?
>
> Regards, Clodoaldo Pinto Neto
From jpg at jgassociates.ca  Thu Jun 14 22:28:20 2007
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Thu Jun 14 22:28:23 2007
Subject: [mod_python] the req object
In-Reply-To: <20070614224944.GE25026@asu.edu>
References: <20070613171401.GA14723@asu.edu> <4670506A.9040905@jgassociates.ca>
	<20070614224944.GE25026@asu.edu>
Message-ID: <4671F944.8080903@jgassociates.ca>

David Bear wrote:
> On Wed, Jun 13, 2007 at 04:15:38PM -0400, Jim Gallacher wrote:
>> Hi David,
>>
>> David Bear wrote:
>>> When is the req object made available?
>>>
>> Think of the handler method as the entry point into your code for each 
>> request.
>>
>> Consider the simplest possible handler as an example:
>>
>> AddHandler mod_python .py
>> PythonHandler helloworld
>>
>>
>> helloworld.py
>> -------------
>>
>> from mod_python import apache
>>
>> MSG = 'Hello world'
>> my_sum = 10 + 10
>>
>> def handler(req):
>>     req.content_type = 'text/plain'
>>     req.write(MSG)
>>     return apache.OK
>>
>> Note that the statement my_sum = 10 + 10 is only executed once, not 
>> every time a new request arrives. Same for MSG and our initial import 
>> statement.
> 
> OK. Great. So, my_sum = 10 + 10 is executed when apache loads and
> reads helloworld.py the first time -- and upon any subsequent module
> reloads? This makes sense to me.. is it correct?
> 
> What if helloworld.py imported another module named goodbye.py that
> had this:
> 
> goodbye.py
> -----------
> 
> newvar = 10 + 10
> 
> def coolfunc(somestring):
>    backwards = somestring.split()
>    backwards.reverse()
>    return(backwards)
> 
> If I understand, when helloworld is imported, any imports it does will
> also be executed -- and then any expressions in the imported modules
> will ALSO be evaluated when they are imported. So, newvar will be
> evaluated when helloworld is imported by apache -- but coolfunc won't
> do anything untill it is called presumably by helloword.py.
> 
> Am I approaching correctness here?

You are indeed.

Jim
From David.Bear at asu.edu  Fri Jun 15 01:45:32 2007
From: David.Bear at asu.edu (David Bear)
Date: Fri Jun 15 01:54:20 2007
Subject: [mod_python] using handler, no req.form
Message-ID: <20070615054531.GH25026@asu.edu>

I'm using python handler. I wrote a simple function to return items in
posted form sent to the handler. However, modpython tells me there is
no req.form... well, more precisely:

mp_request object has no attribute form.

I thought a form object would be created by apache when a post method
was used. Is a req.form object only created when using publisher? I am
looking and some code I wrote a year ago that worked.. but I left it
for other project.

When using handler, where does the post data get put? 

-- 
David Bear
phone: 	602-496-0424
fax: 	602-496-0955
College of Public Programs/ASU
University Center Rm 622
411 N Central
Phoenix, AZ 85007-0685
 "Beware the IP portfolio, everyone will be suspect of trespassing"
From graham.dumpleton at gmail.com  Fri Jun 15 02:03:08 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Fri Jun 15 02:03:14 2007
Subject: [mod_python] using handler, no req.form
In-Reply-To: <20070615054531.GH25026@asu.edu>
References: <20070615054531.GH25026@asu.edu>
Message-ID: <88e286470706142303x5a1f748jad67074b7aca7db2@mail.gmail.com>

On 15/06/07, David Bear <David.Bear@asu.edu> wrote:
> I'm using python handler. I wrote a simple function to return items in
> posted form sent to the handler. However, modpython tells me there is
> no req.form... well, more precisely:
>
> mp_request object has no attribute form.
>
> I thought a form object would be created by apache when a post method
> was used. Is a req.form object only created when using publisher?

Correct.

> I am
> looking and some code I wrote a year ago that worked.. but I left it
> for other project.
>
> When using handler, where does the post data get put?

Not put anywhere, still there waiting to be read in:

  from mod_python import util

  def handler(req):
    req.form = util.FieldStorage(req, keep_blank_values=1)
    ...

Graham
From seb.dailly at gmail.com  Fri Jun 15 04:03:14 2007
From: seb.dailly at gmail.com (Seb)
Date: Fri Jun 15 04:03:19 2007
Subject: [mod_python] Pickle can't save classes instances in mod_python ?
In-Reply-To: <88e286470706141540w5a6834b6ie4bd5402e8e1e465@mail.gmail.com>
References: <b4e79f7c0706141400q10e4651awab0b77a5bd517ea5@mail.gmail.com>
	<88e286470706141540w5a6834b6ie4bd5402e8e1e465@mail.gmail.com>
Message-ID: <b4e79f7c0706150103y344307e5u2da67d21813063a3@mail.gmail.com>

> Read:
>
>   http://www.dscpl.com.au/wiki/ModPython/Articles/IssuesWithSessionObjects
>
> Although document was written in reference to sessions, they use
> pickle and thus it still applies.
>
> Graham
>

Ok, that's a limitation, but I'll now I understand what happened  !

Thanks !

Seb
From clodoaldo.pinto.neto at gmail.com  Fri Jun 15 05:32:00 2007
From: clodoaldo.pinto.neto at gmail.com (Clodoaldo)
Date: Fri Jun 15 05:32:08 2007
Subject: [mod_python] SystemError: bad argument to internal function
In-Reply-To: <88e286470706141926w7b8699a5ob81d0a2478fe98f8@mail.gmail.com>
References: <a595de7a0706080753q6a02ce87u6c2c289ab6141546@mail.gmail.com>
	<88e286470706141926w7b8699a5ob81d0a2478fe98f8@mail.gmail.com>
Message-ID: <a595de7a0706150232i75a86e2ev6733a0cfecebc5d8@mail.gmail.com>

2007/6/14, Graham Dumpleton <graham.dumpleton@gmail.com>:
> Did you ever sort this out?

No

> Which sub revision of Python 2.4 are you using? The source code line
> numbers don't match up with anything meaningful in Python 2.4.3 source
> code that I have on hand.

Python 2.4.4 in Fedora Core 6, Apache 2.2.4, mod_python 3.3.1

Clodoaldo

> On 09/06/07, Clodoaldo <clodoaldo.pinto.neto@gmail.com> wrote:
> > I have this in my error log and I don't know what it means or what to do:
> >
> > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] mod_python
> > (pid=15022, interpreter='carroarodo.com', phase='PythonHandler',
> > handler='~/_publisher.py'): Application error, referer:
> > http://carroarodo.com/meu_anuncio
> > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] ServerName:
> > 'carroarodo.com', referer: http://carroarodo.com/meu_anuncio
> > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]
> > DocumentRoot: '/var/www/html/carroarodo.com', referer:
> > http://carroarodo.com/meu_anuncio
> > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] URI:
> > '/meu_anuncio', referer: http://carroarodo.com/meu_anuncio
> > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] Location:
> > None, referer: http://carroarodo.com/meu_anuncio
> > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] Directory:
> > '/var/www/html/carroarodo.com/', referer:
> > http://carroarodo.com/meu_anuncio
> > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] Filename:
> > '/var/www/html/carroarodo.com/meu_anuncio.py', referer:
> > http://carroarodo.com/meu_anuncio
> > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] PathInfo:
> > '', referer: http://carroarodo.com/meu_anuncio
> > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] Traceback
> > (most recent call last):, referer: http://carroarodo.com/meu_anuncio
> > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]   File
> > "/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
> > 1537, in HandlerDispatch\n    default=default_handler, arg=req,
> > silent=hlist.silent), referer: http://carroarodo.com/meu_anuncio
> > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]   File
> > "/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
> > 1229, in _process_target\n    result = _execute_target(config, req,
> > object, arg), referer: http://carroarodo.com/meu_anuncio
> > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]   File
> > "/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
> > 1128, in _execute_target\n    result = object(arg), referer:
> > http://carroarodo.com/meu_anuncio
> > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]   File
> > "/var/www/html/carroarodo.com/_publisher.py", line 5, in handler\n
> > return publisher.handler(req), referer:
> > http://carroarodo.com/meu_anuncio
> > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]   File
> > "/usr/lib64/python2.4/site-packages/mod_python/publisher.py", line
> > 213, in handler\n    published = publish_object(req, object), referer:
> > http://carroarodo.com/meu_anuncio
> > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]   File
> > "/usr/lib64/python2.4/site-packages/mod_python/publisher.py", line
> > 424, in publish_object\n    req.form = util.FieldStorage(req,
> > keep_blank_values=1), referer: http://carroarodo.com/meu_anuncio
> > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]   File
> > "/usr/lib64/python2.4/site-packages/mod_python/util.py", line 225, in
> > __init__\n    pairs = parse_qsl(req.read(clen), keep_blank_val[Tue Jun
> > 05 18:33:49 2007] [error] [client 200.155.85.225] SystemError:
> > Objects/stringobject.c:3515: bad argument to internal function,
> > referer: http://carroarodo.com/meu_anuncio
> >
> > Any hints?
> >
> > Regards, Clodoaldo Pinto Neto
>
From graham.dumpleton at gmail.com  Fri Jun 15 05:55:58 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Fri Jun 15 05:56:03 2007
Subject: [mod_python] SystemError: bad argument to internal function
In-Reply-To: <a595de7a0706150232i75a86e2ev6733a0cfecebc5d8@mail.gmail.com>
References: <a595de7a0706080753q6a02ce87u6c2c289ab6141546@mail.gmail.com>
	<88e286470706141926w7b8699a5ob81d0a2478fe98f8@mail.gmail.com>
	<a595de7a0706150232i75a86e2ev6733a0cfecebc5d8@mail.gmail.com>
Message-ID: <88e286470706150255i139f2ea2p45eb8c83d137b9de@mail.gmail.com>

Can you send the same POST content to a standard handler containing:

  def handler(req):
    req.content_type = 'text/plain'
    print >> req, req.headers_in["content-length"]
    print >> req, req.headers_in["content-type"]
    print >> req
    print >> req, req.read()
    return apache.OK

Am expecting the content type to be
"application/x-www-form-urlencoded" which is triggering parse_qsl().
The intent of the above script is to capture the POST data so you can
post it and we can then use it as test data for calling parse_qsl()
direct.

At this point figuring that parse_qsl() has bug.

While you do that I'll look through parse_qsl() code and see if I can
see any problem.

Graham



On 15/06/07, Clodoaldo <clodoaldo.pinto.neto@gmail.com> wrote:
> 2007/6/14, Graham Dumpleton <graham.dumpleton@gmail.com>:
> > Did you ever sort this out?
>
> No
>
> > Which sub revision of Python 2.4 are you using? The source code line
> > numbers don't match up with anything meaningful in Python 2.4.3 source
> > code that I have on hand.
>
> Python 2.4.4 in Fedora Core 6, Apache 2.2.4, mod_python 3.3.1
>
> Clodoaldo
>
> > On 09/06/07, Clodoaldo <clodoaldo.pinto.neto@gmail.com> wrote:
> > > I have this in my error log and I don't know what it means or what to do:
> > >
> > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] mod_python
> > > (pid=15022, interpreter='carroarodo.com', phase='PythonHandler',
> > > handler='~/_publisher.py'): Application error, referer:
> > > http://carroarodo.com/meu_anuncio
> > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] ServerName:
> > > 'carroarodo.com', referer: http://carroarodo.com/meu_anuncio
> > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]
> > > DocumentRoot: '/var/www/html/carroarodo.com', referer:
> > > http://carroarodo.com/meu_anuncio
> > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] URI:
> > > '/meu_anuncio', referer: http://carroarodo.com/meu_anuncio
> > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] Location:
> > > None, referer: http://carroarodo.com/meu_anuncio
> > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] Directory:
> > > '/var/www/html/carroarodo.com/', referer:
> > > http://carroarodo.com/meu_anuncio
> > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] Filename:
> > > '/var/www/html/carroarodo.com/meu_anuncio.py', referer:
> > > http://carroarodo.com/meu_anuncio
> > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] PathInfo:
> > > '', referer: http://carroarodo.com/meu_anuncio
> > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] Traceback
> > > (most recent call last):, referer: http://carroarodo.com/meu_anuncio
> > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]   File
> > > "/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
> > > 1537, in HandlerDispatch\n    default=default_handler, arg=req,
> > > silent=hlist.silent), referer: http://carroarodo.com/meu_anuncio
> > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]   File
> > > "/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
> > > 1229, in _process_target\n    result = _execute_target(config, req,
> > > object, arg), referer: http://carroarodo.com/meu_anuncio
> > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]   File
> > > "/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
> > > 1128, in _execute_target\n    result = object(arg), referer:
> > > http://carroarodo.com/meu_anuncio
> > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]   File
> > > "/var/www/html/carroarodo.com/_publisher.py", line 5, in handler\n
> > > return publisher.handler(req), referer:
> > > http://carroarodo.com/meu_anuncio
> > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]   File
> > > "/usr/lib64/python2.4/site-packages/mod_python/publisher.py", line
> > > 213, in handler\n    published = publish_object(req, object), referer:
> > > http://carroarodo.com/meu_anuncio
> > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]   File
> > > "/usr/lib64/python2.4/site-packages/mod_python/publisher.py", line
> > > 424, in publish_object\n    req.form = util.FieldStorage(req,
> > > keep_blank_values=1), referer: http://carroarodo.com/meu_anuncio
> > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]   File
> > > "/usr/lib64/python2.4/site-packages/mod_python/util.py", line 225, in
> > > __init__\n    pairs = parse_qsl(req.read(clen), keep_blank_val[Tue Jun
> > > 05 18:33:49 2007] [error] [client 200.155.85.225] SystemError:
> > > Objects/stringobject.c:3515: bad argument to internal function,
> > > referer: http://carroarodo.com/meu_anuncio
> > >
> > > Any hints?
> > >
> > > Regards, Clodoaldo Pinto Neto
> >
>
From clodoaldo.pinto.neto at gmail.com  Fri Jun 15 06:59:20 2007
From: clodoaldo.pinto.neto at gmail.com (Clodoaldo)
Date: Fri Jun 15 06:59:27 2007
Subject: [mod_python] SystemError: bad argument to internal function
In-Reply-To: <88e286470706150255i139f2ea2p45eb8c83d137b9de@mail.gmail.com>
References: <a595de7a0706080753q6a02ce87u6c2c289ab6141546@mail.gmail.com>
	<88e286470706141926w7b8699a5ob81d0a2478fe98f8@mail.gmail.com>
	<a595de7a0706150232i75a86e2ev6733a0cfecebc5d8@mail.gmail.com>
	<88e286470706150255i139f2ea2p45eb8c83d137b9de@mail.gmail.com>
Message-ID: <a595de7a0706150359o79a22fa3qbc0fb117cedbd261@mail.gmail.com>

2007/6/15, Graham Dumpleton <graham.dumpleton@gmail.com>:
> Can you send the same POST content to a standard handler containing:

The error was triggered by user input I and can't reproduce it. It
happened only twice. To complicate it the same program meu_anuncio.py
handles 2 forms and I don't know which one triggered the error. One of
the forms uploads pictures. I have tested that program extensively and
found no problems. Tried again now in the production machine and I
can't trigger the error.

In some hours I will post the content of a non error-triggering POST.

Clodoaldo

>
>   def handler(req):
>     req.content_type = 'text/plain'
>     print >> req, req.headers_in["content-length"]
>     print >> req, req.headers_in["content-type"]
>     print >> req
>     print >> req, req.read()
>     return apache.OK
>
> Am expecting the content type to be
> "application/x-www-form-urlencoded" which is triggering parse_qsl().
> The intent of the above script is to capture the POST data so you can
> post it and we can then use it as test data for calling parse_qsl()
> direct.
>
> At this point figuring that parse_qsl() has bug.
>
> While you do that I'll look through parse_qsl() code and see if I can
> see any problem.
>
> Graham
>
>
>
> On 15/06/07, Clodoaldo <clodoaldo.pinto.neto@gmail.com> wrote:
> > 2007/6/14, Graham Dumpleton <graham.dumpleton@gmail.com>:
> > > Did you ever sort this out?
> >
> > No
> >
> > > Which sub revision of Python 2.4 are you using? The source code line
> > > numbers don't match up with anything meaningful in Python 2.4.3 source
> > > code that I have on hand.
> >
> > Python 2.4.4 in Fedora Core 6, Apache 2.2.4, mod_python 3.3.1
> >
> > Clodoaldo
> >
> > > On 09/06/07, Clodoaldo <clodoaldo.pinto.neto@gmail.com> wrote:
> > > > I have this in my error log and I don't know what it means or what to do:
> > > >
> > > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] mod_python
> > > > (pid=15022, interpreter='carroarodo.com', phase='PythonHandler',
> > > > handler='~/_publisher.py'): Application error, referer:
> > > > http://carroarodo.com/meu_anuncio
> > > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] ServerName:
> > > > 'carroarodo.com', referer: http://carroarodo.com/meu_anuncio
> > > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]
> > > > DocumentRoot: '/var/www/html/carroarodo.com', referer:
> > > > http://carroarodo.com/meu_anuncio
> > > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] URI:
> > > > '/meu_anuncio', referer: http://carroarodo.com/meu_anuncio
> > > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] Location:
> > > > None, referer: http://carroarodo.com/meu_anuncio
> > > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] Directory:
> > > > '/var/www/html/carroarodo.com/', referer:
> > > > http://carroarodo.com/meu_anuncio
> > > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] Filename:
> > > > '/var/www/html/carroarodo.com/meu_anuncio.py', referer:
> > > > http://carroarodo.com/meu_anuncio
> > > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] PathInfo:
> > > > '', referer: http://carroarodo.com/meu_anuncio
> > > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] Traceback
> > > > (most recent call last):, referer: http://carroarodo.com/meu_anuncio
> > > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]   File
> > > > "/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
> > > > 1537, in HandlerDispatch\n    default=default_handler, arg=req,
> > > > silent=hlist.silent), referer: http://carroarodo.com/meu_anuncio
> > > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]   File
> > > > "/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
> > > > 1229, in _process_target\n    result = _execute_target(config, req,
> > > > object, arg), referer: http://carroarodo.com/meu_anuncio
> > > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]   File
> > > > "/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
> > > > 1128, in _execute_target\n    result = object(arg), referer:
> > > > http://carroarodo.com/meu_anuncio
> > > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]   File
> > > > "/var/www/html/carroarodo.com/_publisher.py", line 5, in handler\n
> > > > return publisher.handler(req), referer:
> > > > http://carroarodo.com/meu_anuncio
> > > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]   File
> > > > "/usr/lib64/python2.4/site-packages/mod_python/publisher.py", line
> > > > 213, in handler\n    published = publish_object(req, object), referer:
> > > > http://carroarodo.com/meu_anuncio
> > > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]   File
> > > > "/usr/lib64/python2.4/site-packages/mod_python/publisher.py", line
> > > > 424, in publish_object\n    req.form = util.FieldStorage(req,
> > > > keep_blank_values=1), referer: http://carroarodo.com/meu_anuncio
> > > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]   File
> > > > "/usr/lib64/python2.4/site-packages/mod_python/util.py", line 225, in
> > > > __init__\n    pairs = parse_qsl(req.read(clen), keep_blank_val[Tue Jun
> > > > 05 18:33:49 2007] [error] [client 200.155.85.225] SystemError:
> > > > Objects/stringobject.c:3515: bad argument to internal function,
> > > > referer: http://carroarodo.com/meu_anuncio
> > > >
> > > > Any hints?
> > > >
> > > > Regards, Clodoaldo Pinto Neto
> > >
> >
>
From graham.dumpleton at gmail.com  Fri Jun 15 07:30:14 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Fri Jun 15 07:30:21 2007
Subject: [mod_python] SystemError: bad argument to internal function
In-Reply-To: <a595de7a0706150359o79a22fa3qbc0fb117cedbd261@mail.gmail.com>
References: <a595de7a0706080753q6a02ce87u6c2c289ab6141546@mail.gmail.com>
	<88e286470706141926w7b8699a5ob81d0a2478fe98f8@mail.gmail.com>
	<a595de7a0706150232i75a86e2ev6733a0cfecebc5d8@mail.gmail.com>
	<88e286470706150255i139f2ea2p45eb8c83d137b9de@mail.gmail.com>
	<a595de7a0706150359o79a22fa3qbc0fb117cedbd261@mail.gmail.com>
Message-ID: <88e286470706150430jf6d8c15v177fab819774ed6a@mail.gmail.com>

I doubt it would be the image as one shouldn't be using
"application/x-www-form-urlencoded" for images. But then that may be
part of the problem as posting data with embedded nulls would probably
cause parse_qsl() to fail or at least give incorrect results because
it uses strlen() on data. Should really be using some form of
"multipart" content type for posts of binary data. For example
"multipart/mixed" perhaps.

If it isn't parse_qsl() the only other possibility is that req.read()
itself is broken in some subtle way and the problem is only triggered
when data is read off the wire in certain random block sizes. But why
this wouldn't be showing as a problem for lots of people I don't know.

FWIW, the actual problem is that _PyString_Resize() is being called
with what Python internally regards as an invalid value. Ie., fails
test:

        if (!PyString_Check(v) || v->ob_refcnt != 1 || newsize < 0 ||
            PyString_CHECK_INTERNED(v)) {
                *pv = 0;
                Py_DECREF(v);
                PyErr_BadInternalCall();
                return -1;
        }

Looking at parse_qsl() I can't see how it could get a wrong value.

One final question, is the incoming body of the request being
compressed in anyway when being sent by the browser as there are
issues in mod_python where an input filter is being applied to
incoming content and the content length of data is changed and ends up
different to the content length header. I only saw this as resulting
in truncated input, but maybe it causes other problems as well.

Graham

On 15/06/07, Clodoaldo <clodoaldo.pinto.neto@gmail.com> wrote:
> 2007/6/15, Graham Dumpleton <graham.dumpleton@gmail.com>:
> > Can you send the same POST content to a standard handler containing:
>
> The error was triggered by user input I and can't reproduce it. It
> happened only twice. To complicate it the same program meu_anuncio.py
> handles 2 forms and I don't know which one triggered the error. One of
> the forms uploads pictures. I have tested that program extensively and
> found no problems. Tried again now in the production machine and I
> can't trigger the error.
>
> In some hours I will post the content of a non error-triggering POST.
>
> Clodoaldo
>
> >
> >   def handler(req):
> >     req.content_type = 'text/plain'
> >     print >> req, req.headers_in["content-length"]
> >     print >> req, req.headers_in["content-type"]
> >     print >> req
> >     print >> req, req.read()
> >     return apache.OK
> >
> > Am expecting the content type to be
> > "application/x-www-form-urlencoded" which is triggering parse_qsl().
> > The intent of the above script is to capture the POST data so you can
> > post it and we can then use it as test data for calling parse_qsl()
> > direct.
> >
> > At this point figuring that parse_qsl() has bug.
> >
> > While you do that I'll look through parse_qsl() code and see if I can
> > see any problem.
> >
> > Graham
> >
> >
> >
> > On 15/06/07, Clodoaldo <clodoaldo.pinto.neto@gmail.com> wrote:
> > > 2007/6/14, Graham Dumpleton <graham.dumpleton@gmail.com>:
> > > > Did you ever sort this out?
> > >
> > > No
> > >
> > > > Which sub revision of Python 2.4 are you using? The source code line
> > > > numbers don't match up with anything meaningful in Python 2.4.3 source
> > > > code that I have on hand.
> > >
> > > Python 2.4.4 in Fedora Core 6, Apache 2.2.4, mod_python 3.3.1
> > >
> > > Clodoaldo
> > >
> > > > On 09/06/07, Clodoaldo <clodoaldo.pinto.neto@gmail.com> wrote:
> > > > > I have this in my error log and I don't know what it means or what to do:
> > > > >
> > > > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] mod_python
> > > > > (pid=15022, interpreter='carroarodo.com', phase='PythonHandler',
> > > > > handler='~/_publisher.py'): Application error, referer:
> > > > > http://carroarodo.com/meu_anuncio
> > > > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] ServerName:
> > > > > 'carroarodo.com', referer: http://carroarodo.com/meu_anuncio
> > > > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]
> > > > > DocumentRoot: '/var/www/html/carroarodo.com', referer:
> > > > > http://carroarodo.com/meu_anuncio
> > > > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] URI:
> > > > > '/meu_anuncio', referer: http://carroarodo.com/meu_anuncio
> > > > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] Location:
> > > > > None, referer: http://carroarodo.com/meu_anuncio
> > > > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] Directory:
> > > > > '/var/www/html/carroarodo.com/', referer:
> > > > > http://carroarodo.com/meu_anuncio
> > > > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] Filename:
> > > > > '/var/www/html/carroarodo.com/meu_anuncio.py', referer:
> > > > > http://carroarodo.com/meu_anuncio
> > > > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] PathInfo:
> > > > > '', referer: http://carroarodo.com/meu_anuncio
> > > > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] Traceback
> > > > > (most recent call last):, referer: http://carroarodo.com/meu_anuncio
> > > > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]   File
> > > > > "/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
> > > > > 1537, in HandlerDispatch\n    default=default_handler, arg=req,
> > > > > silent=hlist.silent), referer: http://carroarodo.com/meu_anuncio
> > > > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]   File
> > > > > "/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
> > > > > 1229, in _process_target\n    result = _execute_target(config, req,
> > > > > object, arg), referer: http://carroarodo.com/meu_anuncio
> > > > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]   File
> > > > > "/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
> > > > > 1128, in _execute_target\n    result = object(arg), referer:
> > > > > http://carroarodo.com/meu_anuncio
> > > > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]   File
> > > > > "/var/www/html/carroarodo.com/_publisher.py", line 5, in handler\n
> > > > > return publisher.handler(req), referer:
> > > > > http://carroarodo.com/meu_anuncio
> > > > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]   File
> > > > > "/usr/lib64/python2.4/site-packages/mod_python/publisher.py", line
> > > > > 213, in handler\n    published = publish_object(req, object), referer:
> > > > > http://carroarodo.com/meu_anuncio
> > > > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]   File
> > > > > "/usr/lib64/python2.4/site-packages/mod_python/publisher.py", line
> > > > > 424, in publish_object\n    req.form = util.FieldStorage(req,
> > > > > keep_blank_values=1), referer: http://carroarodo.com/meu_anuncio
> > > > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]   File
> > > > > "/usr/lib64/python2.4/site-packages/mod_python/util.py", line 225, in
> > > > > __init__\n    pairs = parse_qsl(req.read(clen), keep_blank_val[Tue Jun
> > > > > 05 18:33:49 2007] [error] [client 200.155.85.225] SystemError:
> > > > > Objects/stringobject.c:3515: bad argument to internal function,
> > > > > referer: http://carroarodo.com/meu_anuncio
> > > > >
> > > > > Any hints?
> > > > >
> > > > > Regards, Clodoaldo Pinto Neto
> > > >
> > >
> >
>
From giovanni.porcari at gmail.com  Fri Jun 15 08:54:15 2007
From: giovanni.porcari at gmail.com (Porcari Giovanni)
Date: Fri Jun 15 08:54:30 2007
Subject: [mod_python] [SPAM] Prpblem installing mod_python 3.3.1 in OSX
	10.3.9
Message-ID: <E638CA42-7A6B-4878-920F-C0467212449F@gmail.com>

Hi all

I'm trying to install mod_python 3.3.1 on an OSX Server 10.3.9.
Python version is 2.4.4 and Apache 2.2.


this is my configure command:

./configure --with-python=/Library/Frameworks/Python.framework/ 
Versions/Current/bin/python --with-apxs=/usr/local/apache2/bin/apxs

and this is the error i get in the make command:

/Library/Frameworks/Python.framework/Versions/2.4/include/python2.4/ 
objimpl.h:255: warning: To disable this warning, use -Wno-long-double.)
/usr/local/apache2/build/libtool --silent --mode=link gcc -o  
mod_python.la  -rpath /usr/local/apache2/modules -module -avoid- 
version    finfoobject.lo hlistobject.lo hlist.lo filterobject.lo  
connobject.lo serverobject.lo util.lo tableobject.lo requestobject.lo  
_apachemodule.lo mod_python.lo -Wl,-framework,Python -u _PyMac_Error / 
Versions// -arch i386 -arch ppc -isysroot /Developer/SDKs/ 
MacOSX10.4u.sdk -g -lm -framework Python -ldl
ld: for architecture i386
ld: warning /usr/lib/bundle1.o cputype (18, architecture ppc) does  
not match cputype (7) for specified -arch flag: i386 (file not loaded)
ld: warning .libs/finfoobject.o cputype (18, architecture ppc) does  
not match cputype (7) for specified -arch flag: i386 (file not loaded)
ld: warning .libs/hlistobject.o cputype (18, architecture ppc) does  
not match cputype (7) for specified -arch flag: i386 (file not loaded)
ld: warning .libs/hlist.o cputype (18, architecture ppc) does not  
match cputype (7) for specified -arch flag: i386 (file not loaded)
ld: warning .libs/filterobject.o cputype (18, architecture ppc) does  
not match cputype (7) for specified -arch flag: i386 (file not loaded)
ld: warning .libs/connobject.o cputype (18, architecture ppc) does  
not match cputype (7) for specified -arch flag: i386 (file not loaded)
ld: warning .libs/serverobject.o cputype (18, architecture ppc) does  
not match cputype (7) for specified -arch flag: i386 (file not loaded)
ld: warning .libs/util.o cputype (18, architecture ppc) does not  
match cputype (7) for specified -arch flag: i386 (file not loaded)
ld: warning .libs/tableobject.o cputype (18, architecture ppc) does  
not match cputype (7) for specified -arch flag: i386 (file not loaded)
ld: warning .libs/requestobject.o cputype (18, architecture ppc) does  
not match cputype (7) for specified -arch flag: i386 (file not loaded)
ld: warning .libs/_apachemodule.o cputype (18, architecture ppc) does  
not match cputype (7) for specified -arch flag: i386 (file not loaded)
ld: warning .libs/mod_python.o cputype (18, architecture ppc) does  
not match cputype (7) for specified -arch flag: i386 (file not loaded)
ld: warning /usr/lib/libm.dylib cputype (18, architecture ppc) does  
not match cputype (7) for specified -arch flag: i386 (file not loaded)
ld: warning /usr/lib/libdl.dylib cputype (18, architecture ppc) does  
not match cputype (7) for specified -arch flag: i386 (file not loaded)
ld: warning /usr/lib/gcc/darwin/3.3/libgcc.a archive's cputype (18,  
architecture ppc) does not match cputype (7) for specified -arch  
flag: i386 (can't load from it)
ld: warning /usr/lib/libSystem.dylib cputype (18, architecture ppc)  
does not match cputype (7) for specified -arch flag: i386 (file not  
loaded)
ld: warning /usr/lib/libSystem.B.dylib cputype (18, architecture ppc)  
does not match cputype (7) for specified -arch flag: i386 (file not  
loaded)
ld: for architecture ppc
ld: Undefined symbols:
_fstatvfs referenced from Python expected to be defined in libSystem
_lchown referenced from Python expected to be defined in libSystem
_statvfs referenced from Python expected to be defined in libSystem
apxs:Error: Command failed with rc=65536
.
make[1]: *** [mod_python.so] Error 1
make: *** [do_dso] Error 2



Any clue to solve this issue ?


Thank you

G.

From graham.dumpleton at gmail.com  Sat Jun 16 20:08:49 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sat Jun 16 20:09:08 2007
Subject: [mod_python] SystemError: bad argument to internal function
In-Reply-To: <a595de7a0706150907j61aadc2ew6ef2bd36fb18e04@mail.gmail.com>
References: <a595de7a0706080753q6a02ce87u6c2c289ab6141546@mail.gmail.com>
	<88e286470706141926w7b8699a5ob81d0a2478fe98f8@mail.gmail.com>
	<a595de7a0706150232i75a86e2ev6733a0cfecebc5d8@mail.gmail.com>
	<88e286470706150255i139f2ea2p45eb8c83d137b9de@mail.gmail.com>
	<a595de7a0706150359o79a22fa3qbc0fb117cedbd261@mail.gmail.com>
	<88e286470706150430jf6d8c15v177fab819774ed6a@mail.gmail.com>
	<a595de7a0706150907j61aadc2ew6ef2bd36fb18e04@mail.gmail.com>
Message-ID: <88e286470706161708o4900c0easa0887043d1658711@mail.gmail.com>

I think we can rule out parse_qsl() since someone on Django list has
just had same problem but all they are calling is req.read(). See:

  http://groups.google.com/group/django-users/browse_frm/thread/f0159aca7bfbaf57?hl=en

Thus, looks like some subtle bug in req.read() which only very rarely
is triggered.

Graham

On 16/06/07, Clodoaldo <clodoaldo.pinto@gmail.com> wrote:
> 2007/6/15, Graham Dumpleton <graham.dumpleton@gmail.com>:
> > I doubt it would be the image as one shouldn't be using
> > "application/x-www-form-urlencoded" for images. But then that may be
> > part of the problem as posting data with embedded nulls would probably
> > cause parse_qsl() to fail or at least give incorrect results because
> > it uses strlen() on data. Should really be using some form of
> > "multipart" content type for posts of binary data. For example
> > "multipart/mixed" perhaps.
>
> I was wrong. That program handles two pages, only one has a form and
> it is not the images one.
>
> I did set the action of the form to the standard handler as you
> suggested and this is the output:
>
> 664
> application/x-www-form-urlencoded
>
> pagina_servida=True&estado_sigla=SP&localidade=S%C3%A3o+Paulo&bairro=Jardins&fabricante=1&modelo=213&versao=ELX&ano=2007&ano_modelo=2008&preco=200005&motor_volume=1.0&cor=cinza&quilometragem=23000&combustivel=1&remLen=2&texto_chamada=fiesta+sedan+completo%2C+ar+dire%C3%A7ao%2C+vidros%2C+travas%2C+alarme..%2Clindo+sem+retoques+estado+de+novo+%2Cparticular%2Cunico+dono%2Ccomprei+ha+um+ano+no+valor+de+34.500+reiais+e+dei+12.500+de+entrada+e+financiei+o+restante+%2822.000%29+em+60+vezes+de+600+reais%2C+ja+paguei+15+parcelas+e+ainda+restam+45+parcelas.estou+pedindo+pelo+que+ja+paguei+somente+14.500+reais...&mostra_email=1&publicar=1&salvar=Salvar+%2F+Republicar
>
>
> > One final question, is the incoming body of the request being
> > compressed in anyway when being sent by the browser as there are
> > issues in mod_python where an input filter is being applied to
> > incoming content and the content length of data is changed and ends up
> > different to the content length header. I only saw this as resulting
> > in truncated input, but maybe it causes other problems as well.
>
> I make no compression of the submitted body. I don't use any input
> filter, only a DEFLATE output filter.
>
> These are the headers when submitting to the standard handler in the
> test machine:
>
> Response Headers
> Date    Fri, 15 Jun 2007 15:47:05 GMT
> Server  Apache/2.2.4 (Fedora)
> Keep-Alive      timeout=10, max=100
> Connection      Keep-Alive
> Transfer-Encoding       chunked
> Content-Type    text/plain; charset=UTF-8
>
> Request Headers
> Host    teste.s0
> User-Agent      Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.8.1.4)
> Gecko/20070603 Fedora/2.0.0.4-2.fc7 Firefox/2.0.0.4
> Accept  text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5
> Accept-Language en-us,en;q=0.5
> Accept-Encoding gzip,deflate
> Accept-Charset  ISO-8859-1,utf-8;q=0.7,*;q=0.7
> Keep-Alive      300
> Connection      keep-alive
> Referer http://carroarodo.s0/meu_anuncio
>
> And these are the headers when submitting to the normal form handling
> page in the production machine.
>
> Response Headers
> Date    Fri, 15 Jun 2007 15:53:58 GMT
> Server  Apache/2.2.4 (Fedora)
> Vary    Accept-Encoding
> Content-Encoding        gzip
> Content-Length  2018
> Keep-Alive      timeout=15, max=1000
> Connection      Keep-Alive
> Content-Type    text/html; charset=UTF-8
> Content-Language        pt-BR
>
> Request Headers
> Host    carroarodo.com
> User-Agent      Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.8.1.4)
> Gecko/20070603 Fedora/2.0.0.4-2.fc7 Firefox/2.0.0.4
> Accept  text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5
> Accept-Language en-us,en;q=0.5
> Accept-Encoding gzip,deflate
> Accept-Charset  ISO-8859-1,utf-8;q=0.7,*;q=0.7
> Keep-Alive      300
> Connection      keep-alive
> Referer http://carroarodo.com/meu_anuncio
> Cookie  ja_visitou=1180872725.75;
> pysid=b4b28e54a9e77ddbcf47e1ae3dd4454e36b1f09d4b93434121bc6e1c0760d5c0
>
> Clodoaldo
>
> > On 15/06/07, Clodoaldo <clodoaldo.pinto.neto@gmail.com> wrote:
> > > 2007/6/15, Graham Dumpleton <graham.dumpleton@gmail.com>:
> > > > Can you send the same POST content to a standard handler containing:
> > >
> > > The error was triggered by user input I and can't reproduce it. It
> > > happened only twice. To complicate it the same program meu_anuncio.py
> > > handles 2 forms and I don't know which one triggered the error. One of
> > > the forms uploads pictures. I have tested that program extensively and
> > > found no problems. Tried again now in the production machine and I
> > > can't trigger the error.
> > >
> > > In some hours I will post the content of a non error-triggering POST.
> > >
> > > Clodoaldo
> > >
> > > >
> > > >   def handler(req):
> > > >     req.content_type = 'text/plain'
> > > >     print >> req, req.headers_in["content-length"]
> > > >     print >> req, req.headers_in["content-type"]
> > > >     print >> req
> > > >     print >> req, req.read()
> > > >     return apache.OK
> > > >
> > > > Am expecting the content type to be
> > > > "application/x-www-form-urlencoded" which is triggering parse_qsl().
> > > > The intent of the above script is to capture the POST data so you can
> > > > post it and we can then use it as test data for calling parse_qsl()
> > > > direct.
> > > >
> > > > At this point figuring that parse_qsl() has bug.
> > > >
> > > > While you do that I'll look through parse_qsl() code and see if I can
> > > > see any problem.
> > > >
> > > > Graham
> > > >
> > > >
> > > >
> > > > On 15/06/07, Clodoaldo <clodoaldo.pinto.neto@gmail.com> wrote:
> > > > > 2007/6/14, Graham Dumpleton <graham.dumpleton@gmail.com>:
> > > > > > Did you ever sort this out?
> > > > >
> > > > > No
> > > > >
> > > > > > Which sub revision of Python 2.4 are you using? The source code line
> > > > > > numbers don't match up with anything meaningful in Python 2.4.3 source
> > > > > > code that I have on hand.
> > > > >
> > > > > Python 2.4.4 in Fedora Core 6, Apache 2.2.4, mod_python 3.3.1
> > > > >
> > > > > Clodoaldo
> > > > >
> > > > > > On 09/06/07, Clodoaldo <clodoaldo.pinto.neto@gmail.com> wrote:
> > > > > > > I have this in my error log and I don't know what it means or what to do:
> > > > > > >
> > > > > > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] mod_python
> > > > > > > (pid=15022, interpreter='carroarodo.com', phase='PythonHandler',
> > > > > > > handler='~/_publisher.py'): Application error, referer:
> > > > > > > http://carroarodo.com/meu_anuncio
> > > > > > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] ServerName:
> > > > > > > 'carroarodo.com', referer: http://carroarodo.com/meu_anuncio
> > > > > > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]
> > > > > > > DocumentRoot: '/var/www/html/carroarodo.com', referer:
> > > > > > > http://carroarodo.com/meu_anuncio
> > > > > > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] URI:
> > > > > > > '/meu_anuncio', referer: http://carroarodo.com/meu_anuncio
> > > > > > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] Location:
> > > > > > > None, referer: http://carroarodo.com/meu_anuncio
> > > > > > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] Directory:
> > > > > > > '/var/www/html/carroarodo.com/', referer:
> > > > > > > http://carroarodo.com/meu_anuncio
> > > > > > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] Filename:
> > > > > > > '/var/www/html/carroarodo.com/meu_anuncio.py', referer:
> > > > > > > http://carroarodo.com/meu_anuncio
> > > > > > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] PathInfo:
> > > > > > > '', referer: http://carroarodo.com/meu_anuncio
> > > > > > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225] Traceback
> > > > > > > (most recent call last):, referer: http://carroarodo.com/meu_anuncio
> > > > > > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]   File
> > > > > > > "/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
> > > > > > > 1537, in HandlerDispatch\n    default=default_handler, arg=req,
> > > > > > > silent=hlist.silent), referer: http://carroarodo.com/meu_anuncio
> > > > > > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]   File
> > > > > > > "/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
> > > > > > > 1229, in _process_target\n    result = _execute_target(config, req,
> > > > > > > object, arg), referer: http://carroarodo.com/meu_anuncio
> > > > > > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]   File
> > > > > > > "/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
> > > > > > > 1128, in _execute_target\n    result = object(arg), referer:
> > > > > > > http://carroarodo.com/meu_anuncio
> > > > > > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]   File
> > > > > > > "/var/www/html/carroarodo.com/_publisher.py", line 5, in handler\n
> > > > > > > return publisher.handler(req), referer:
> > > > > > > http://carroarodo.com/meu_anuncio
> > > > > > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]   File
> > > > > > > "/usr/lib64/python2.4/site-packages/mod_python/publisher.py", line
> > > > > > > 213, in handler\n    published = publish_object(req, object), referer:
> > > > > > > http://carroarodo.com/meu_anuncio
> > > > > > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]   File
> > > > > > > "/usr/lib64/python2.4/site-packages/mod_python/publisher.py", line
> > > > > > > 424, in publish_object\n    req.form = util.FieldStorage(req,
> > > > > > > keep_blank_values=1), referer: http://carroarodo.com/meu_anuncio
> > > > > > > [Tue Jun 05 18:33:49 2007] [error] [client 200.155.85.225]   File
> > > > > > > "/usr/lib64/python2.4/site-packages/mod_python/util.py", line 225, in
> > > > > > > __init__\n    pairs = parse_qsl(req.read(clen), keep_blank_val[Tue Jun
> > > > > > > 05 18:33:49 2007] [error] [client 200.155.85.225] SystemError:
> > > > > > > Objects/stringobject.c:3515: bad argument to internal function,
> > > > > > > referer: http://carroarodo.com/meu_anuncio
> > > > > > >
> > > > > > > Any hints?
> > > > > > >
> > > > > > > Regards, Clodoaldo Pinto Neto
> > > > > >
> > > > >
> > > >
> > >
> >
>
From graham.dumpleton at gmail.com  Sat Jun 16 23:18:19 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sat Jun 16 23:18:25 2007
Subject: [SPAM] [mod_python] [SPAM] Prpblem installing mod_python 3.3.1 in
	OSX 10.3.9
In-Reply-To: <E638CA42-7A6B-4878-920F-C0467212449F@gmail.com>
References: <E638CA42-7A6B-4878-920F-C0467212449F@gmail.com>
Message-ID: <88e286470706162018k53335f86y2d936ccf015cbf8@mail.gmail.com>

On 15/06/07, Porcari Giovanni <giovanni.porcari@gmail.com> wrote:
> Hi all
>
> I'm trying to install mod_python 3.3.1 on an OSX Server 10.3.9.
> Python version is 2.4.4 and Apache 2.2.
>
>
> this is my configure command:
>
> ./configure --with-python=/Library/Frameworks/Python.framework/
> Versions/Current/bin/python --with-apxs=/usr/local/apache2/bin/apxs
>
> and this is the error i get in the make command:
>
> /Library/Frameworks/Python.framework/Versions/2.4/include/python2.4/
> objimpl.h:255: warning: To disable this warning, use -Wno-long-double.)
> /usr/local/apache2/build/libtool --silent --mode=link gcc -o
> mod_python.la  -rpath /usr/local/apache2/modules -module -avoid-
> version    finfoobject.lo hlistobject.lo hlist.lo filterobject.lo
> connobject.lo serverobject.lo util.lo tableobject.lo requestobject.lo
> _apachemodule.lo mod_python.lo -Wl,-framework,Python -u _PyMac_Error /
> Versions// -arch i386 -arch ppc -isysroot /Developer/SDKs/
> MacOSX10.4u.sdk -g -lm -framework Python -ldl
> ld: for architecture i386
> ld: warning /usr/lib/bundle1.o cputype (18, architecture ppc) does
> not match cputype (7) for specified -arch flag: i386 (file not loaded)
> ld: warning .libs/finfoobject.o cputype (18, architecture ppc) does
> not match cputype (7) for specified -arch flag: i386 (file not loaded)
> ld: warning .libs/hlistobject.o cputype (18, architecture ppc) does
> not match cputype (7) for specified -arch flag: i386 (file not loaded)
> ld: warning .libs/hlist.o cputype (18, architecture ppc) does not
> match cputype (7) for specified -arch flag: i386 (file not loaded)
> ld: warning .libs/filterobject.o cputype (18, architecture ppc) does
> not match cputype (7) for specified -arch flag: i386 (file not loaded)
> ld: warning .libs/connobject.o cputype (18, architecture ppc) does
> not match cputype (7) for specified -arch flag: i386 (file not loaded)
> ld: warning .libs/serverobject.o cputype (18, architecture ppc) does
> not match cputype (7) for specified -arch flag: i386 (file not loaded)
> ld: warning .libs/util.o cputype (18, architecture ppc) does not
> match cputype (7) for specified -arch flag: i386 (file not loaded)
> ld: warning .libs/tableobject.o cputype (18, architecture ppc) does
> not match cputype (7) for specified -arch flag: i386 (file not loaded)
> ld: warning .libs/requestobject.o cputype (18, architecture ppc) does
> not match cputype (7) for specified -arch flag: i386 (file not loaded)
> ld: warning .libs/_apachemodule.o cputype (18, architecture ppc) does
> not match cputype (7) for specified -arch flag: i386 (file not loaded)
> ld: warning .libs/mod_python.o cputype (18, architecture ppc) does
> not match cputype (7) for specified -arch flag: i386 (file not loaded)
> ld: warning /usr/lib/libm.dylib cputype (18, architecture ppc) does
> not match cputype (7) for specified -arch flag: i386 (file not loaded)
> ld: warning /usr/lib/libdl.dylib cputype (18, architecture ppc) does
> not match cputype (7) for specified -arch flag: i386 (file not loaded)
> ld: warning /usr/lib/gcc/darwin/3.3/libgcc.a archive's cputype (18,
> architecture ppc) does not match cputype (7) for specified -arch
> flag: i386 (can't load from it)
> ld: warning /usr/lib/libSystem.dylib cputype (18, architecture ppc)
> does not match cputype (7) for specified -arch flag: i386 (file not
> loaded)
> ld: warning /usr/lib/libSystem.B.dylib cputype (18, architecture ppc)
> does not match cputype (7) for specified -arch flag: i386 (file not
> loaded)
> ld: for architecture ppc
> ld: Undefined symbols:
> _fstatvfs referenced from Python expected to be defined in libSystem
> _lchown referenced from Python expected to be defined in libSystem
> _statvfs referenced from Python expected to be defined in libSystem
> apxs:Error: Command failed with rc=65536
> .
> make[1]: *** [mod_python.so] Error 1
> make: *** [do_dso] Error 2
>
>
>
> Any clue to solve this issue ?

Either Python configuration or Apache configuration is possibly wrong. Edit:

/Library/Frameworks/Python.framework/Versions/Current/lib/python2.4/config/Makefile

and look for '-arch i386 -arch ppc' and change it to just '-arch i386'
or delete both entries.

If those arguments aren't coming from that file, look in and make change in:

/usr/local/apache2/build/config_vars.mk

instead.

Graham
From chengjialeph at gmail.com  Sun Jun 17 13:56:43 2007
From: chengjialeph at gmail.com (Jia Cheng)
Date: Sun Jun 17 13:57:18 2007
Subject: [mod_python] make_obcallback: could not import mod_python.apache in
	testing
Message-ID: <000001c7b108$de1d8600$9a589200$@com>

Hi, 

 

After installing mod_python and configure it in Apache. I can't get through
the test.

 

My system:

  

OS: Windows Vista Business. 

Mod_python 3.3.1 

Python 2.4.4 

Apache 2.0.59 

 

What I did so far:

1.      I downloaded win32-binary
"mod_python-3.3.1.win32-py2.4-Apache2.0.exe" from download page

2.      Ran the installer as administrator. And the result seems right. It
copied mod_python.so to apache folder too.

3.      I added these lines to Apache configuration file:

----------------------------------------------------------------------------
---

LoadModule python_module modules/mod_python.so

.

# for testing

<Directory "d:/web host/WebRoot/test"> 

                AddHandler mod_python .py

        PythonHandler mptest 

        PythonDebug On 

</Directory>

----------------------------------------------------------------------------
---------

 

But when I point to localhost/test/mptest.py, it gives Internal Server
Error.

>From the error list, it shows: (from very beginning after server started)

[Sun Jun 17 12:11:38 2007] [notice] Apache/2.0.59 (Win32) SVN/1.4.3 DAV/2
configured -- resuming normal operations

[Sun Jun 17 12:11:38 2007] [notice] Server built: Jul 27 2006 15:55:03

[Sun Jun 17 12:11:38 2007] [notice] Parent: Created child process 3252

[Sun Jun 17 12:11:38 2007] [error] python_init: Python version mismatch,
expected '2.4.3', found '2.4.4'.

[Sun Jun 17 12:11:39 2007] [error] python_init: Python executable found
'C:\\Program Files\\Apache Group\\Apache2\\bin\\Apache.exe'.

[Sun Jun 17 12:11:39 2007] [error] python_init: Python path being used
'D:\\python24\\python24.zip;.\\DLLs;.\\lib;.\\lib\\plat-win;.\\lib\\lib-tk;C
:\\Program Files\\Apache Group\\Apache2\\bin'.

[Sun Jun 17 12:11:39 2007] [notice] mod_python: Creating 8 session mutexes
based on 0 max processes and 250 max threads.

[Sun Jun 17 12:11:41 2007] [notice] Child 3252: Child process is running

[Sun Jun 17 12:11:41 2007] [notice] Child 3252: Acquired the start mutex.

[Sun Jun 17 12:11:41 2007] [notice] Child 3252: Starting 250 worker threads.

[Sun Jun 17 12:34:05 2007] [error] make_obcallback: could not import
mod_python.apache.\n

[Sun Jun 17 12:34:05 2007] [error] make_obcallback: Python path being used
"['D:\\\\python24\\\\python24.zip', '.\\\\DLLs', '.\\\\lib',
'.\\\\lib\\\\plat-win', '.\\\\lib\\\\lib-tk', 'C:\\\\Program Files\\\\Apache
Group\\\\Apache2\\\\bin']".

[Sun Jun 17 12:34:05 2007] [error] get_interpreter: no interpreter callback
found.

[Sun Jun 17 12:34:05 2007] [error] [client 165.123.138.0] python_handler:
Can't get/create interpreter.

 

I'm thinking maybe it's because of the python version mismatching (2.4.3,
2.4.4). If so, is there anyway I can get the mod_python for 2.4.4? Or maybe
there're some conflicts between SVN and mod_python? Could any people help me
out of this. Really appreciate!

 

Thanks!

Jia

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070617/faddddda/attachment.html
From mrlobster99 at gmail.com  Sun Jun 17 23:23:43 2007
From: mrlobster99 at gmail.com (Erik Thompson)
Date: Sun Jun 17 23:23:51 2007
Subject: [mod_python] PSP include with absolute path causing blank page
Message-ID: <58d7d2590706172023k6350d8ebq733bc3ceb594d352@mail.gmail.com>

I'm having a weird issue using PSP with trying to include a file with an
absolute path causing the page to be rendered completely blank.  No errors,
no expected content, just blank.
This doesn't happen on my windows machine but on a CentOS 5 server it does.
I found a hack that appears to work but I don't know if it's safe to use
it.  Does anybody have any ideas as to what could be going wrong?

This doesn't work:
<%@ include file="/var/www/html/borders/test.psp" %>

This is a hack that does seem to work to include the file:
<%
PSP(req, "/var/www/html/borders/test.psp").run(form)
%>

The software versions are:
CentOS 5
mod_python: 3.2.8-3.1
python: 2.4.3-19.el5
apache (httpd): 2.2.3-6.el5.centos.1
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070617/1b384b7e/attachment.html
From graham.dumpleton at gmail.com  Mon Jun 18 00:43:01 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon Jun 18 00:43:07 2007
Subject: [mod_python] PSP include with absolute path causing blank page
In-Reply-To: <58d7d2590706172023k6350d8ebq733bc3ceb594d352@mail.gmail.com>
References: <58d7d2590706172023k6350d8ebq733bc3ceb594d352@mail.gmail.com>
Message-ID: <88e286470706172143i6097e4doe027348f3f38dda5@mail.gmail.com>

On 18/06/07, Erik Thompson <mrlobster99@gmail.com> wrote:
> I'm having a weird issue using PSP with trying to include a file with an
> absolute path causing the page to be rendered completely blank.  No errors,
> no expected content, just blank.
> This doesn't happen on my windows machine but on a CentOS 5 server it does.
> I found a hack that appears to work but I don't know if it's safe to use it.
>  Does anybody have any ideas as to what could be going wrong?
>
> This doesn't work:
> <%@ include file="/var/www/html/borders/test.psp" %>
>
> This is a hack that does seem to work to include the file:
> <%
> PSP(req, "/var/www/html/borders/test.psp").run(form)
> %>
>
> The software versions are:
> CentOS 5
> mod_python: 3.2.8-3.1
> python: 2.4.3-19.el5
> apache (httpd): 2.2.3-6.el5.centos.1

Presuming you are using straight PSP and not PSP from within
publisher, follow example on:

  http://www.modpython.org/live/current/doc-html/hand-psp.html

to enable .psp_ access for debug. This will show in browser the source
code when page accessed with .psp_ extension instead of .psp. Post to
the mailing list the snippet of source code being generated for the
section of PSP code giving the problem or look at it yourself and see
why it might not be working.

Graham
From graham.dumpleton at gmail.com  Mon Jun 18 00:50:01 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon Jun 18 00:50:08 2007
Subject: [mod_python] make_obcallback: could not import mod_python.apache
	in testing
In-Reply-To: <000001c7b108$de1d8600$9a589200$@com>
References: <000001c7b108$de1d8600$9a589200$@com>
Message-ID: <88e286470706172150gbdc3637w65110fcb37474244@mail.gmail.com>

Your Python path would not appear to include the site-packages
directory. See prior posts referenced from:

  http://www.modpython.org/pipermail/mod_python/2006-October/022361.html

about registry keys that need to be checked and made to include
directory where mod_python Python package components were installed.
The version mismatch will not cause an issue on Windows as DLL used
for Python library.

BTW, which Python distribution are you using?

Graham

On 18/06/07, Jia Cheng <chengjialeph@gmail.com> wrote:
>
>
>
>
> Hi,
>
>
>
> After installing mod_python and configure it in Apache. I can't get through
> the test.
>
>
>
> My system:
>
>
>
> OS: Windows Vista Business.
>
> Mod_python 3.3.1
>
> Python 2.4.4
>
> Apache 2.0.59
>
>
>
> What I did so far:
>
> 1.      I downloaded win32-binary
> "mod_python-3.3.1.win32-py2.4-Apache2.0.exe" from download page
>
> 2.      Ran the installer as administrator. And the result seems right. It
> copied mod_python.so to apache folder too.
>
> 3.      I added these lines to Apache configuration file:
>
> -------------------------------------------------------------------------------
>
> LoadModule python_module modules/mod_python.so
>
> ?
>
> # for testing
>
> <Directory "d:/web host/WebRoot/test">
>
>                 AddHandler mod_python .py
>
>         PythonHandler mptest
>
>         PythonDebug On
>
> </Directory>
>
> -------------------------------------------------------------------------------------
>
>
>
> But when I point to localhost/test/mptest.py, it gives Internal Server
> Error.
>
> From the error list, it shows: (from very beginning after server started)
>
> [Sun Jun 17 12:11:38 2007] [notice] Apache/2.0.59 (Win32) SVN/1.4.3 DAV/2
> configured -- resuming normal operations
>
> [Sun Jun 17 12:11:38 2007] [notice] Server built: Jul 27 2006 15:55:03
>
> [Sun Jun 17 12:11:38 2007] [notice] Parent: Created child process 3252
>
> [Sun Jun 17 12:11:38 2007] [error] python_init: Python version mismatch,
> expected '2.4.3', found '2.4.4'.
>
> [Sun Jun 17 12:11:39 2007] [error] python_init: Python executable found
> 'C:\\Program Files\\Apache
> Group\\Apache2\\bin\\Apache.exe'.
>
> [Sun Jun 17 12:11:39 2007] [error] python_init: Python path being used
> 'D:\\python24\\python24.zip;.\\DLLs;.\\lib;.\\lib\\plat-win;.\\lib\\lib-tk;C:\\Program
> Files\\Apache Group\\Apache2\\bin'.
>
> [Sun Jun 17 12:11:39 2007] [notice] mod_python: Creating 8 session mutexes
> based on 0 max processes and 250 max threads.
>
> [Sun Jun 17 12:11:41 2007] [notice] Child 3252: Child process is running
>
> [Sun Jun 17 12:11:41 2007] [notice] Child 3252: Acquired the start mutex.
>
> [Sun Jun 17 12:11:41 2007] [notice] Child 3252: Starting 250 worker threads.
>
> [Sun Jun 17 12:34:05 2007] [error] make_obcallback: could not import
> mod_python.apache.\n
>
> [Sun Jun 17 12:34:05 2007] [error] make_obcallback: Python path being used
> "['D:\\\\python24\\\\python24.zip', '.\\\\DLLs',
> '.\\\\lib', '.\\\\lib\\\\plat-win', '.\\\\lib\\\\lib-tk', 'C:\\\\Program
> Files\\\\Apache Group\\\\Apache2\\\\bin']".
>
> [Sun Jun 17 12:34:05 2007] [error] get_interpreter: no interpreter callback
> found.
>
> [Sun Jun 17 12:34:05 2007] [error] [client 165.123.138.0] python_handler:
> Can't get/create interpreter.
>
>
>
> I'm thinking maybe it's because of the python version mismatching (2.4.3,
> 2.4.4). If so, is there anyway I can get the mod_python for 2.4.4? Or maybe
> there're some conflicts between SVN and mod_python? Could any people help me
> out of this. Really appreciate!
>
>
>
> Thanks!
>
> Jia
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>

From mario at avepublishing.com  Mon Jun 18 01:06:12 2007
From: mario at avepublishing.com (mario curiel)
Date: Mon Jun 18 01:06:25 2007
Subject: [mod_python] [SPAM] mod_python.so is so garbled
Message-ID: <996BCD81-9551-4F64-81D8-1BDD470BBDE4@avepublishing.com>

I got the error in apachectl -k start:

httpd: Syntax error on line 54 of /Local/Library/Webserver/ 
Configuration/httpd.conf: API module structure ?python_module? in  
file /System/Library/Apache/Modules/mod_python.so is so garbled -  
perhaps this is not an Apache module DSO?

In the computer has Mac OSX 10.4.9,
MAC Pro with intel processors,
python 2.5.1
apache sever 2.2.4 (unix)

a)installation of mod_python-3.3.1:

-configure --with-apxs=/Library/Apache2/bin/apxs --with-fex=/usr/bin/ 
flex
make
make install


also I tried with

b)
make install_dso
make install_py_lib

in both cases (a and b) the last line of the install is the  
installation of the mod_python-3-3.1/py2.5.egg-info:
writing /Library/Frameworks/Python.framework/verons/2.5/lib/python2.5/ 
site-packages/mod_python-3-3.1/py2.5.egg-info


I added the lines to the httpd.conf:
the lines 54-56 :

LoadModule python-module /System/Library/Apache2/Modules/mod_python.so

AddModule mod_python.c

then I run apachectl -k start and the error appears:

Syntax error on line 54 of /Local/Library/Webserver/Configuration/ 
httpd.conf: API module structure ?python_module? in file /System/ 
Library/Apache/Modules/mod_python.so is so garbled - perhaps this is  
not an Apache module DSO?


how to correct it?

thanks a lot

Alberto
From graham.dumpleton at gmail.com  Mon Jun 18 01:16:58 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon Jun 18 01:17:03 2007
Subject: [mod_python] [SPAM] mod_python.so is so garbled
In-Reply-To: <996BCD81-9551-4F64-81D8-1BDD470BBDE4@avepublishing.com>
References: <996BCD81-9551-4F64-81D8-1BDD470BBDE4@avepublishing.com>
Message-ID: <88e286470706172216w5dce0a7au46195c1445ae6480@mail.gmail.com>

See comments below.

On 18/06/07, mario curiel <mario@avepublishing.com> wrote:
> I got the error in apachectl -k start:
>
> httpd: Syntax error on line 54 of /Local/Library/Webserver/
> Configuration/httpd.conf: API module structure ?python_module? in
> file /System/Library/Apache/Modules/mod_python.so is so garbled -
> perhaps this is not an Apache module DSO?
>
> In the computer has Mac OSX 10.4.9,
> MAC Pro with intel processors,
> python 2.5.1
> apache sever 2.2.4 (unix)
>
> a)installation of mod_python-3.3.1:
>
> -configure --with-apxs=/Library/Apache2/bin/apxs --with-fex=/usr/bin/
> flex
> make
> make install
>
>
> also I tried with
>
> b)
> make install_dso
> make install_py_lib
>
> in both cases (a and b) the last line of the install is the
> installation of the mod_python-3-3.1/py2.5.egg-info:
> writing /Library/Frameworks/Python.framework/verons/2.5/lib/python2.5/
> site-packages/mod_python-3-3.1/py2.5.egg-info
>
>
> I added the lines to the httpd.conf:
> the lines 54-56 :
>
> LoadModule python-module /System/Library/Apache2/Modules/mod_python.so

This line is wrong. Should be 'python_module' not 'python-module'.

> AddModule mod_python.c

This line is not needed with Apache 2.

> then I run apachectl -k start and the error appears:
>
> Syntax error on line 54 of /Local/Library/Webserver/Configuration/
> httpd.conf: API module structure ?python_module? in file /System/
> Library/Apache/Modules/mod_python.so is so garbled - perhaps this is
> not an Apache module DSO?
>
>
> how to correct it?
>
> thanks a lot
>
> Alberto
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>

From mario at avepublishing.com  Mon Jun 18 01:25:49 2007
From: mario at avepublishing.com (mario curiel)
Date: Mon Jun 18 01:26:03 2007
Subject: [SPAM] Re: [mod_python] [SPAM] mod_python.so is so garbled
In-Reply-To: <88e286470706172216w5dce0a7au46195c1445ae6480@mail.gmail.com>
References: <996BCD81-9551-4F64-81D8-1BDD470BBDE4@avepublishing.com>
	<88e286470706172216w5dce0a7au46195c1445ae6480@mail.gmail.com>
Message-ID: <0A3A38CF-EE26-4FCE-A051-8AD3E21A528E@avepublishing.com>

sorry, it was my mistake when I was writing this mail,
the line 54 in the httpd.conf file is:

LoadModule python_module /System/Library/Apache2/Modules/mod_python.so

and not
>> LoadModule python-module /System/Library/Apache2/Modules/ 
>> mod_python.so


ok, thanks,  I removed the line: AddModule mod_python.c

but the error continues, when I enter httpd, of apachectl

>> Syntax error on line 54 of /Local/Library/Webserver/Configuration/
>> httpd.conf: API module structure ?python_module? in file /System/
>> Library/Apache/Modules/mod_python.so is so garbled - perhaps this is
>> not an Apache module DSO?

any idea?

thanks a lot

Alberto


On 18/06/2007, at 12:16 AM, Graham Dumpleton wrote:

> See comments below.
>
> On 18/06/07, mario curiel <mario@avepublishing.com> wrote:
>> I got the error in apachectl -k start:
>>
>> httpd: Syntax error on line 54 of /Local/Library/Webserver/
>> Configuration/httpd.conf: API module structure ?python_module? in
>> file /System/Library/Apache/Modules/mod_python.so is so garbled -
>> perhaps this is not an Apache module DSO?
>>
>> In the computer has Mac OSX 10.4.9,
>> MAC Pro with intel processors,
>> python 2.5.1
>> apache sever 2.2.4 (unix)
>>
>> a)installation of mod_python-3.3.1:
>>
>> -configure --with-apxs=/Library/Apache2/bin/apxs --with-fex=/usr/bin/
>> flex
>> make
>> make install
>>
>>
>> also I tried with
>>
>> b)
>> make install_dso
>> make install_py_lib
>>
>> in both cases (a and b) the last line of the install is the
>> installation of the mod_python-3-3.1/py2.5.egg-info:
>> writing /Library/Frameworks/Python.framework/verons/2.5/lib/ 
>> python2.5/
>> site-packages/mod_python-3-3.1/py2.5.egg-info
>>
>>
>> I added the lines to the httpd.conf:
>> the lines 54-56 :
>>
>> LoadModule python-module /System/Library/Apache2/Modules/ 
>> mod_python.so
>
> This line is wrong. Should be 'python_module' not 'python-module'.
>
>> AddModule mod_python.c
>
> This line is not needed with Apache 2.
>
>> then I run apachectl -k start and the error appears:
>>
>> Syntax error on line 54 of /Local/Library/Webserver/Configuration/
>> httpd.conf: API module structure ?python_module? in file /System/
>> Library/Apache/Modules/mod_python.so is so garbled - perhaps this is
>> not an Apache module DSO?
>>
>>
>> how to correct it?
>>
>> thanks a lot
>>
>> Alberto
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>
>


From graham.dumpleton at gmail.com  Mon Jun 18 01:34:09 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon Jun 18 01:34:15 2007
Subject: [mod_python] [SPAM] mod_python.so is so garbled
In-Reply-To: <0A3A38CF-EE26-4FCE-A051-8AD3E21A528E@avepublishing.com>
References: <996BCD81-9551-4F64-81D8-1BDD470BBDE4@avepublishing.com>
	<88e286470706172216w5dce0a7au46195c1445ae6480@mail.gmail.com>
	<0A3A38CF-EE26-4FCE-A051-8AD3E21A528E@avepublishing.com>
Message-ID: <88e286470706172234v1e7aed10jc5d80678fc116eec@mail.gmail.com>

On 18/06/07, mario curiel <mario@avepublishing.com> wrote:
> sorry, it was my mistake when I was writing this mail,
> the line 54 in the httpd.conf file is:
>
> LoadModule python_module /System/Library/Apache2/Modules/mod_python.so
>
> and not
> >> LoadModule python-module /System/Library/Apache2/Modules/
> >> mod_python.so
>
>
> ok, thanks,  I removed the line: AddModule mod_python.c
>
> but the error continues, when I enter httpd, of apachectl

The other reason this error can occur is that the mod_python.so you
are using wasn't actually compiled for the version of Apache you are
trying to run it with. Check your compilation output to make sure the
-I flags are getting headers file from correct location for that
version of Apache and that the header files in that location are in
fact for that Apache binary version. Also check that where the
mod_python.so file gets installed is where you are picking it up from
with configuration you are using.

You can run:

 strings /usr/local/apache-2.2/modules/mod_python.so | grep AP

on the mod_python.so that Apache is loading and you should get something like:

AP_CONN_UNKNOWN
AP_CONN_CLOSE
AP_CONN_KEEPALIVE
APR_NOFILE
APR_REG
APR_DIR
APR_CHR
APR_BLK
APR_PIPE
APR_LNK
APR_SOCK
APR_UNKFILE
AP22

That last line says mine was compiled for Apache 2.2. If it said AP20
then would have been compiled for Apache 2.0 instead.

> >> Syntax error on line 54 of /Local/Library/Webserver/Configuration/
> >> httpd.conf: API module structure ?python_module? in file /System/
> >> Library/Apache/Modules/mod_python.so is so garbled - perhaps this is
> >> not an Apache module DSO?
>
> any idea?
>
> thanks a lot
>
> Alberto
>
>
> On 18/06/2007, at 12:16 AM, Graham Dumpleton wrote:
>
> > See comments below.
> >
> > On 18/06/07, mario curiel <mario@avepublishing.com> wrote:
> >> I got the error in apachectl -k start:
> >>
> >> httpd: Syntax error on line 54 of /Local/Library/Webserver/
> >> Configuration/httpd.conf: API module structure ?python_module? in
> >> file /System/Library/Apache/Modules/mod_python.so is so garbled -
> >> perhaps this is not an Apache module DSO?
> >>
> >> In the computer has Mac OSX 10.4.9,
> >> MAC Pro with intel processors,
> >> python 2.5.1
> >> apache sever 2.2.4 (unix)
> >>
> >> a)installation of mod_python-3.3.1:
> >>
> >> -configure --with-apxs=/Library/Apache2/bin/apxs --with-fex=/usr/bin/
> >> flex
> >> make
> >> make install
> >>
> >>
> >> also I tried with
> >>
> >> b)
> >> make install_dso
> >> make install_py_lib
> >>
> >> in both cases (a and b) the last line of the install is the
> >> installation of the mod_python-3-3.1/py2.5.egg-info:
> >> writing /Library/Frameworks/Python.framework/verons/2.5/lib/
> >> python2.5/
> >> site-packages/mod_python-3-3.1/py2.5.egg-info
> >>
> >>
> >> I added the lines to the httpd.conf:
> >> the lines 54-56 :
> >>
> >> LoadModule python-module /System/Library/Apache2/Modules/
> >> mod_python.so
> >
> > This line is wrong. Should be 'python_module' not 'python-module'.
> >
> >> AddModule mod_python.c
> >
> > This line is not needed with Apache 2.
> >
> >> then I run apachectl -k start and the error appears:
> >>
> >> Syntax error on line 54 of /Local/Library/Webserver/Configuration/
> >> httpd.conf: API module structure ?python_module? in file /System/
> >> Library/Apache/Modules/mod_python.so is so garbled - perhaps this is
> >> not an Apache module DSO?
> >>
> >>
> >> how to correct it?
> >>
> >> thanks a lot
> >>
> >> Alberto
> >> _______________________________________________
> >> Mod_python mailing list
> >> Mod_python@modpython.org
> >> http://mailman.modpython.org/mailman/listinfo/mod_python
> >>
> >
>
>

From mrlobster99 at gmail.com  Mon Jun 18 02:55:43 2007
From: mrlobster99 at gmail.com (Erik Thompson)
Date: Mon Jun 18 02:55:50 2007
Subject: [mod_python] PSP include with absolute path causing blank page
In-Reply-To: <88e286470706172143i6097e4doe027348f3f38dda5@mail.gmail.com>
References: <58d7d2590706172023k6350d8ebq733bc3ceb594d352@mail.gmail.com>
	<88e286470706172143i6097e4doe027348f3f38dda5@mail.gmail.com>
Message-ID: <58d7d2590706172355u450ddc41v735fe2c5b4579109@mail.gmail.com>

Thanks for the suggestion.  When I use the .psp_ extension to try and view
the generated source on the problem page it also produces a blank page.  I
guess it isn't a big deal as I have a work around.
For the one that works using the work around the .psp_ extension produces:
SP-produced Python Code: /var/www/html/test3.psp: 1. req.write("""""",0); <%
2. PSP(req, "/var/www/html/borders/test.psp").run(form) PSP(req,
"/var/www/html/borders/test.psp").run(form)
3. req.write(""" %> 4.
  5. """,0)
The include file has:
PSP-produced Python Code: /var/www/html/borders/test.psp: 1. req.write
("""<html> <html> 2. <head> <head> 3. <title>include test</title>
<title>include test</title> 4. </head> </head> 5. <body> <body> 6.
include text include text 7. """,0); <% 8. x = 0 x = 0 9. x += 1 x += 1 10.
req.write("<br>hi there.<br>") req.write("<br>hi there.<br>") 11. req.write
(""" %> 12. """,0); req.write(str( x ),0); req.write(""" <%= x %> 13.
</body> </body> 14. </html>""",0) </html>
The resulting expected html is:

<html>
<head>
<title>include test</title>
</
head>
<body>
include text
<br>hi there.<br>
1
</body>

</html>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070617/67ce3219/attachment.html
From graham.dumpleton at gmail.com  Mon Jun 18 02:59:14 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon Jun 18 02:59:19 2007
Subject: [mod_python] PSP include with absolute path causing blank page
In-Reply-To: <58d7d2590706172352n2284c46av8d90d8a5ff3b3630@mail.gmail.com>
References: <58d7d2590706172023k6350d8ebq733bc3ceb594d352@mail.gmail.com>
	<88e286470706172143i6097e4doe027348f3f38dda5@mail.gmail.com>
	<58d7d2590706172352n2284c46av8d90d8a5ff3b3630@mail.gmail.com>
Message-ID: <88e286470706172359p1d0d42edh1d04be1ff2e99f53@mail.gmail.com>

Is there any chance you can upgrade to 3.3.1? There were some bugs fixed for
PSP in 3.3.

One was not dealing with last line of file not having a newline. Think it
only hit UNIX and not Windows. Can't remember what the output from that
problem was though and whether it showed as blank page.

Graham

PS, please use reply-all.

On 18/06/07, Erik Thompson <mrlobster99@gmail.com> wrote:
>
> Presuming you are using straight PSP and not PSP from within
> > publisher, follow example on:
> >
> >   http://www.modpython.org/live/current/doc-html/hand-psp.html
> >
> > to enable .psp_ access for debug. This will show in browser the source
> > code when page accessed with .psp_ extension instead of .psp. Post to
> > the mailing list the snippet of source code being generated for the
> > section of PSP code giving the problem or look at it yourself and see
> > why it might not be working.
> >
> > Graham
>
>
>
> Thanks for the suggestion.  When I use the .psp_ extension to try and view
> the generated source on the problem page it also produces a blank page.  I
> guess it isn't a big deal as I have a work around.
> For the one that works using the work around the .psp_ extension produces:
> SP-produced Python Code: /var/www/html/test3.psp: 1. req.write("""""",0);
> <% 2. PSP(req, "/var/www/html/borders/test.psp").run(form) PSP(req, "/var/www/html/borders/test.psp").run(form)
> 3. req.write(""" %> 4.
>   5. """,0)
> The include file has:
> PSP-produced Python Code: /var/www/html/borders/test.psp: 1. req.write
> ("""<html> <html> 2. <head> <head> 3. <title>include test</title>
> <title>include test</title> 4. </head> </head> 5. <body> <body> 6.
> include text include text 7. """,0); <% 8. x = 0 x = 0 9. x += 1 x += 1
> 10. req.write("<br>hi there.<br>") req.write("<br>hi there.<br>") 11.
> req.write(""" %> 12. """,0); req.write(str( x ),0); req.write(""" <%= x %>
> 13. </body> </body> 14. </html>""",0) </html>
> The resulting expected html is:
>
> <html>
> <head>
> <title>include test</title>
> </
> head>
> <body>
> include text
> <br>hi there.<br>
> 1
> </body>
>
> </html>
>
>
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070618/babb1161/attachment-0001.html
From mario at avepublishing.com  Mon Jun 18 11:09:00 2007
From: mario at avepublishing.com (mario curiel)
Date: Mon Jun 18 11:09:13 2007
Subject: [SPAM] Re: [mod_python] [SPAM] mod_python.so is so garbled
In-Reply-To: <88e286470706172234v1e7aed10jc5d80678fc116eec@mail.gmail.com>
References: <996BCD81-9551-4F64-81D8-1BDD470BBDE4@avepublishing.com>
	<88e286470706172216w5dce0a7au46195c1445ae6480@mail.gmail.com>
	<0A3A38CF-EE26-4FCE-A051-8AD3E21A528E@avepublishing.com>
	<88e286470706172234v1e7aed10jc5d80678fc116eec@mail.gmail.com>
Message-ID: <D4963AB2-12C5-4137-8BBD-24F4A6A181B3@avepublishing.com>

Hello,

thanks, I run the strings line  but there is no AP22, or AP2 line,  
does it mean something?
> AP_CONN_UNKNOWN
> AP_CONN_CLOSE
> AP_CONN_KEEPALIVE
> APR_NOFILE
> APR_REG
> APR_DIR
> APR_CHR
> APR_BLK
> APR_PIPE
> APR_LNK
> APR_SOCK
> APR_UNKFILE

thanks a lot

Alberto


On 18/06/2007, at 12:34 AM, Graham Dumpleton wrote:

> On 18/06/07, mario curiel <mario@avepublishing.com> wrote:
>> sorry, it was my mistake when I was writing this mail,
>> the line 54 in the httpd.conf file is:
>>
>> LoadModule python_module /System/Library/Apache2/Modules/ 
>> mod_python.so
>>
>> and not
>> >> LoadModule python-module /System/Library/Apache2/Modules/
>> >> mod_python.so
>>
>>
>> ok, thanks,  I removed the line: AddModule mod_python.c
>>
>> but the error continues, when I enter httpd, of apachectl
>
> The other reason this error can occur is that the mod_python.so you
> are using wasn't actually compiled for the version of Apache you are
> trying to run it with. Check your compilation output to make sure the
> -I flags are getting headers file from correct location for that
> version of Apache and that the header files in that location are in
> fact for that Apache binary version. Also check that where the
> mod_python.so file gets installed is where you are picking it up from
> with configuration you are using.
>
> You can run:
>
> strings /usr/local/apache-2.2/modules/mod_python.so | grep AP
>
> on the mod_python.so that Apache is loading and you should get  
> something like:
>
> AP_CONN_UNKNOWN
> AP_CONN_CLOSE
> AP_CONN_KEEPALIVE
> APR_NOFILE
> APR_REG
> APR_DIR
> APR_CHR
> APR_BLK
> APR_PIPE
> APR_LNK
> APR_SOCK
> APR_UNKFILE
> AP22
>
> That last line says mine was compiled for Apache 2.2. If it said AP20
> then would have been compiled for Apache 2.0 instead.
>
>> >> Syntax error on line 54 of /Local/Library/Webserver/Configuration/
>> >> httpd.conf: API module structure ?python_module? in file /System/
>> >> Library/Apache/Modules/mod_python.so is so garbled - perhaps  
>> this is
>> >> not an Apache module DSO?
>>
>> any idea?
>>
>> thanks a lot
>>
>> Alberto
>>
>>
>> On 18/06/2007, at 12:16 AM, Graham Dumpleton wrote:
>>
>> > See comments below.
>> >
>> > On 18/06/07, mario curiel <mario@avepublishing.com> wrote:
>> >> I got the error in apachectl -k start:
>> >>
>> >> httpd: Syntax error on line 54 of /Local/Library/Webserver/
>> >> Configuration/httpd.conf: API module structure ?python_module? in
>> >> file /System/Library/Apache/Modules/mod_python.so is so garbled -
>> >> perhaps this is not an Apache module DSO?
>> >>
>> >> In the computer has Mac OSX 10.4.9,
>> >> MAC Pro with intel processors,
>> >> python 2.5.1
>> >> apache sever 2.2.4 (unix)
>> >>
>> >> a)installation of mod_python-3.3.1:
>> >>
>> >> -configure --with-apxs=/Library/Apache2/bin/apxs --with-fex=/ 
>> usr/bin/
>> >> flex
>> >> make
>> >> make install
>> >>
>> >>
>> >> also I tried with
>> >>
>> >> b)
>> >> make install_dso
>> >> make install_py_lib
>> >>
>> >> in both cases (a and b) the last line of the install is the
>> >> installation of the mod_python-3-3.1/py2.5.egg-info:
>> >> writing /Library/Frameworks/Python.framework/verons/2.5/lib/
>> >> python2.5/
>> >> site-packages/mod_python-3-3.1/py2.5.egg-info
>> >>
>> >>
>> >> I added the lines to the httpd.conf:
>> >> the lines 54-56 :
>> >>
>> >> LoadModule python-module /System/Library/Apache2/Modules/
>> >> mod_python.so
>> >
>> > This line is wrong. Should be 'python_module' not 'python-module'.
>> >
>> >> AddModule mod_python.c
>> >
>> > This line is not needed with Apache 2.
>> >
>> >> then I run apachectl -k start and the error appears:
>> >>
>> >> Syntax error on line 54 of /Local/Library/Webserver/Configuration/
>> >> httpd.conf: API module structure ?python_module? in file /System/
>> >> Library/Apache/Modules/mod_python.so is so garbled - perhaps  
>> this is
>> >> not an Apache module DSO?
>> >>
>> >>
>> >> how to correct it?
>> >>
>> >> thanks a lot
>> >>
>> >> Alberto
>> >> _______________________________________________
>> >> Mod_python mailing list
>> >> Mod_python@modpython.org
>> >> http://mailman.modpython.org/mailman/listinfo/mod_python
>> >>
>> >
>>
>>
>


From jpg at jgassociates.ca  Mon Jun 18 11:33:51 2007
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Mon Jun 18 11:32:33 2007
Subject: [SPAM] Re: [mod_python] [SPAM] mod_python.so is so garbled
In-Reply-To: <D4963AB2-12C5-4137-8BBD-24F4A6A181B3@avepublishing.com>
References: <996BCD81-9551-4F64-81D8-1BDD470BBDE4@avepublishing.com>	<88e286470706172216w5dce0a7au46195c1445ae6480@mail.gmail.com>	<0A3A38CF-EE26-4FCE-A051-8AD3E21A528E@avepublishing.com>	<88e286470706172234v1e7aed10jc5d80678fc116eec@mail.gmail.com>
	<D4963AB2-12C5-4137-8BBD-24F4A6A181B3@avepublishing.com>
Message-ID: <4676A5DF.6050102@jgassociates.ca>

I get the same output as Mario on my Ubuntu installation (which works), 
so I'm not sure grepping for AP2 is a definitive test.

Jim


mario curiel wrote:
> Hello,
> 
> thanks, I run the strings line  but there is no AP22, or AP2 line, does 
> it mean something?
>> AP_CONN_UNKNOWN
>> AP_CONN_CLOSE
>> AP_CONN_KEEPALIVE
>> APR_NOFILE
>> APR_REG
>> APR_DIR
>> APR_CHR
>> APR_BLK
>> APR_PIPE
>> APR_LNK
>> APR_SOCK
>> APR_UNKFILE
> 
> thanks a lot
> 
> Alberto
> 
> 
> On 18/06/2007, at 12:34 AM, Graham Dumpleton wrote:
> 
>> On 18/06/07, mario curiel <mario@avepublishing.com> wrote:
>>> sorry, it was my mistake when I was writing this mail,
>>> the line 54 in the httpd.conf file is:
>>>
>>> LoadModule python_module /System/Library/Apache2/Modules/mod_python.so
>>>
>>> and not
>>> >> LoadModule python-module /System/Library/Apache2/Modules/
>>> >> mod_python.so
>>>
>>>
>>> ok, thanks,  I removed the line: AddModule mod_python.c
>>>
>>> but the error continues, when I enter httpd, of apachectl
>>
>> The other reason this error can occur is that the mod_python.so you
>> are using wasn't actually compiled for the version of Apache you are
>> trying to run it with. Check your compilation output to make sure the
>> -I flags are getting headers file from correct location for that
>> version of Apache and that the header files in that location are in
>> fact for that Apache binary version. Also check that where the
>> mod_python.so file gets installed is where you are picking it up from
>> with configuration you are using.
>>
>> You can run:
>>
>> strings /usr/local/apache-2.2/modules/mod_python.so | grep AP
>>
>> on the mod_python.so that Apache is loading and you should get 
>> something like:
>>
>> AP_CONN_UNKNOWN
>> AP_CONN_CLOSE
>> AP_CONN_KEEPALIVE
>> APR_NOFILE
>> APR_REG
>> APR_DIR
>> APR_CHR
>> APR_BLK
>> APR_PIPE
>> APR_LNK
>> APR_SOCK
>> APR_UNKFILE
>> AP22
>>
>> That last line says mine was compiled for Apache 2.2. If it said AP20
>> then would have been compiled for Apache 2.0 instead.
>>
>>> >> Syntax error on line 54 of /Local/Library/Webserver/Configuration/
>>> >> httpd.conf: API module structure ?python_module? in file /System/
>>> >> Library/Apache/Modules/mod_python.so is so garbled - perhaps this is
>>> >> not an Apache module DSO?
>>>
>>> any idea?
>>>
>>> thanks a lot
>>>
>>> Alberto
>>>
>>>
>>> On 18/06/2007, at 12:16 AM, Graham Dumpleton wrote:
>>>
>>> > See comments below.
>>> >
>>> > On 18/06/07, mario curiel <mario@avepublishing.com> wrote:
>>> >> I got the error in apachectl -k start:
>>> >>
>>> >> httpd: Syntax error on line 54 of /Local/Library/Webserver/
>>> >> Configuration/httpd.conf: API module structure ?python_module? in
>>> >> file /System/Library/Apache/Modules/mod_python.so is so garbled -
>>> >> perhaps this is not an Apache module DSO?
>>> >>
>>> >> In the computer has Mac OSX 10.4.9,
>>> >> MAC Pro with intel processors,
>>> >> python 2.5.1
>>> >> apache sever 2.2.4 (unix)
>>> >>
>>> >> a)installation of mod_python-3.3.1:
>>> >>
>>> >> -configure --with-apxs=/Library/Apache2/bin/apxs --with-fex=/usr/bin/
>>> >> flex
>>> >> make
>>> >> make install
>>> >>
>>> >>
>>> >> also I tried with
>>> >>
>>> >> b)
>>> >> make install_dso
>>> >> make install_py_lib
>>> >>
>>> >> in both cases (a and b) the last line of the install is the
>>> >> installation of the mod_python-3-3.1/py2.5.egg-info:
>>> >> writing /Library/Frameworks/Python.framework/verons/2.5/lib/
>>> >> python2.5/
>>> >> site-packages/mod_python-3-3.1/py2.5.egg-info
>>> >>
>>> >>
>>> >> I added the lines to the httpd.conf:
>>> >> the lines 54-56 :
>>> >>
>>> >> LoadModule python-module /System/Library/Apache2/Modules/
>>> >> mod_python.so
>>> >
>>> > This line is wrong. Should be 'python_module' not 'python-module'.
>>> >
>>> >> AddModule mod_python.c
>>> >
>>> > This line is not needed with Apache 2.
>>> >
>>> >> then I run apachectl -k start and the error appears:
>>> >>
>>> >> Syntax error on line 54 of /Local/Library/Webserver/Configuration/
>>> >> httpd.conf: API module structure ?python_module? in file /System/
>>> >> Library/Apache/Modules/mod_python.so is so garbled - perhaps this is
>>> >> not an Apache module DSO?
>>> >>
>>> >>
>>> >> how to correct it?
>>> >>
>>> >> thanks a lot
>>> >>
>>> >> Alberto
>>> >> _______________________________________________
>>> >> Mod_python mailing list
>>> >> Mod_python@modpython.org
>>> >> http://mailman.modpython.org/mailman/listinfo/mod_python
>>> >>
>>> >
>>>
>>>
>>
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 

From mario at avepublishing.com  Mon Jun 18 12:25:33 2007
From: mario at avepublishing.com (mario curiel)
Date: Mon Jun 18 12:25:48 2007
Subject: [mod_python] [SPAM] please recompile it with -DEAPI..
Message-ID: <84ABC318-3EA7-498E-AD1D-ECD40733312C@avepublishing.com>


Hello, on another machine I have
MAC OSX server 10.4.9,
PPC,
Server version: Apache/1.3.33 (Darwin)
mod_python-2.7.11


like the server admin only uses apache 1.3.33, (pre-installeted) then  
I installed mod_python-2.7.11

then error in httpd  is:
[Mon Jun 18 10:43:02 2007] [warn] Loaded DSO /usr/libexec/httpd/ 
mod_python.so uses plain Apache 1.3 API, this module might crash  
under EAPI! (please recompile it with -DEAPI)

any idea how to recompile it with -DEAPI?
which program has to be recompiled with -deapi ? the httpd or the  
program mod_python ?

thanks a lot

Alberto


root# httpd
[Mon Jun 18 10:46:59 2007] [warn] Loaded DSO /usr/libexec/httpd/ 
mod_python.so uses plain Apache 1.3 API, this module might crash  
under EAPI! (please recompile it with -DEAPI)
Processing config directory: /etc/httpd/sites/*.conf
Processing config file: /etc/httpd/sites/ 
0000_10.129.0.37_80_www.NN.com.conf
Processing config file: /etc/httpd/sites/ 
0004_10.129.0.37_80_www.YY.com.mx.conf
Processing config file: /etc/httpd/sites/virtual_host_global.conf

root# CFLAGS="-DEAPI" ./configure --with-apxs=/usr/sbin/apxs
loading cache ./config.cache
checking for gcc... (cached) gcc
checking whether the C compiler (gcc -DEAPI ) works... yes
checking whether the C compiler (gcc -DEAPI ) is a cross-compiler... no
checking whether we are using GNU C... (cached) yes
checking whether gcc accepts -g... (cached) yes
checking for ranlib... (cached) ranlib
checking for ar... (cached) ar
checking for a BSD compatible install... (cached) /usr/bin/install -c
checking whether make sets ${MAKE}... (cached) yes
checking for main in -lm... (cached) yes
checking for working const... (cached) yes
checking your blood pressure... a bit high, but we can proceed
checking whether apxs is available
checking for --with-apxs... /usr/sbin/apxs executable, good
checking for Apache libexec directory... /usr/libexec/httpd
checking for Apache include directory... -I/usr/include/httpd
checking for --with-apache... no
configure: warning: **** No apache sources specified, static  
compilation will not be available.
configure: warning: **** You can use --with-apache to specify where  
your Apache sources are.
checking for --with-python... no
checking for python... (cached) /Library/Frameworks/Python.framework/ 
Versions/Current/bin/python
checking Python version... 2.5
checking whether Python is compiled with thread support... no  
threads, good
checking Python install prefix... /Library/Frameworks/ 
Python.framework/Versions/2.5
checking what libraries Python was linked with... /Library/Frameworks/ 
Python.framework/Versions/2.5/lib/python2.5/config/libpython2.5.a   -ldl
checking linker flags used to link Python...
checking where Python include files are... -I/Library/Frameworks/ 
Python.framework/Versions/2.5/include/python2.5
checking for mkdep... (cached) /usr/bin/mkdep
creating ./config.status
creating Makefile
creating src/Makefile
creating src/libpython.module
creating Doc/Makefile
analyzing dependencies


root# make CFLAGS=-deapi

  root# make install

Performing DSO installation.

/usr/bin/install -c src/mod_python.so /usr/libexec/httpd
/usr/bin/install -c -d /Library/Frameworks/Python.framework/Versions/ 
2.5/lib/python2.5/site-packages/mod_python
python /Library/Frameworks/Python.framework/Versions/2.5/lib/ 
python2.5/compileall.py /Library/Frameworks/Python.framework/Versions/ 
2.5/lib/python2.5/site-packages/mod_python
Listing /Library/Frameworks/Python.framework/Versions/2.5/lib/ 
python2.5/site-packages/mod_python ...
Compiling /Library/Frameworks/Python.framework/Versions/2.5/lib/ 
python2.5/site-packages/mod_python/__init__.py ...
Compiling /Library/Frameworks/Python.framework/Versions/2.5/lib/ 
python2.5/site-packages/mod_python/apache.py ...
Compiling /Library/Frameworks/Python.framework/Versions/2.5/lib/ 
python2.5/site-packages/mod_python/cgihandler.py ...
Compiling /Library/Frameworks/Python.framework/Versions/2.5/lib/ 
python2.5/site-packages/mod_python/httpdapi.py ...
Compiling /Library/Frameworks/Python.framework/Versions/2.5/lib/ 
python2.5/site-packages/mod_python/publisher.py ...
Compiling /Library/Frameworks/Python.framework/Versions/2.5/lib/ 
python2.5/site-packages/mod_python/util.py ...
Compiling /Library/Frameworks/Python.framework/Versions/2.5/lib/ 
python2.5/site-packages/mod_python/zhandler.py ...

Now don't forget to edit your main config and add
     LoadModule python_module /usr/libexec/httpd/mod_python.so
and if your configuration uses ClearModuleList, then also
     AddModule mod_python.c

root#httpd
[Mon Jun 18 10:52:46 2007] [warn] Loaded DSO /usr/libexec/httpd/ 
mod_python.so uses plain Apache 1.3 API, this module might crash  
under EAPI! (please recompile it with -DEAPI)
Processing config directory: /etc/httpd/sites/*.conf
Processing config file: /etc/httpd/sites/ 
0000_10.129.0.37_80_www.NN.com.conf
Processing config file: /etc/httpd/sites/ 
0004_10.129.0.37_80_www.YY.com.mx.conf
Processing config file: /etc/httpd/sites/virtual_host_global.conf


  root# httpd -V
Server version: Apache/1.3.33 (Darwin)
Server built:   Mar 20 2005 15:08:27
Server's Module Magic Number: 19990320:16
Server compiled with....
-D EAPI
-D HAVE_MMAP
-D USE_MMAP_SCOREBOARD
-D USE_MMAP_FILES
-D HAVE_FCNTL_SERIALIZED_ACCEPT
-D HAVE_FLOCK_SERIALIZED_ACCEPT
-D SINGLE_LISTEN_UNSERIALIZED_ACCEPT
-D DYNAMIC_MODULE_LIMIT=64
-D HARD_SERVER_LIMIT=2048
-D HTTPD_ROOT="/usr"
-D SUEXEC_BIN="/usr/sbin/suexec"
-D DEFAULT_PIDLOG="/var/run/httpd.pid"
-D DEFAULT_SCOREBOARD="/var/run/httpd.scoreboard"
-D DEFAULT_LOCKFILE="/var/run/httpd.lock"
-D DEFAULT_ERRORLOG="/var/log/httpd/error_log"
-D TYPES_CONFIG_FILE="/etc/httpd/mime.types"
-D SERVER_CONFIG_FILE="/etc/httpd/httpd.conf"
-D ACCESS_CONFIG_FILE="/etc/httpd/access.conf"
-D RESOURCE_CONFIG_FILE="/etc/httpd/srm.conf"


-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070618/71412f12/attachment.html
From hmg_u at yahoo.co.in  Mon Jun 18 13:54:27 2007
From: hmg_u at yahoo.co.in (haynes george)
Date: Mon Jun 18 13:54:41 2007
Subject: [mod_python] Experience with installing mod_python on Vista
Message-ID: <804602.5870.qm@web7607.mail.in.yahoo.com>

Hi all,

I have finally managed to install mod_python on vista
after 3 days of issues. :)

My configuration is mod_python 3.3.1 , apache 2.2 and
python 2.5.1.

Here are the steps in brief.

1)First and foremost python should be installed for
all users and not just for the current user.

2)Install apache 2.2 normally. Well installing apache
on vista is another days work all together.

3)Under the assumption that you have completed step 2,
download the version of mod_python compatible for your
python version .

4) Open a command prompt in administrator mode (
thanks to UAC in vista, even after being a user with
admin privileges, i donot have write permissions for
C:\Program Files ! )

5)start the mod_python executable to install.

I have to mention one issue with the windows
installer. I tried running the installer in normal
user mode . the final stage in the installation
process is copying the mod_python.so file to the
modules directory in the apache installation. Even
though this copy would fail, no error message was
shown ! 

It would be great if an error message was shown .

i followed the steps given in the mod_python
documentation and set it up . it s working pretty fine
now.

haynes




		
__________________________________________________________
Yahoo! India Answers: Share what you know. Learn something new
http://in.answers.yahoo.com/
From graham.dumpleton at gmail.com  Mon Jun 18 18:11:43 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon Jun 18 18:11:49 2007
Subject: [mod_python] [SPAM] please recompile it with -DEAPI..
In-Reply-To: <84ABC318-3EA7-498E-AD1D-ECD40733312C@avepublishing.com>
References: <84ABC318-3EA7-498E-AD1D-ECD40733312C@avepublishing.com>
Message-ID: <88e286470706181511r459c8f3el2c20c84ffe45939e@mail.gmail.com>

Even if you get past the -DEAPI issue with mod_python 2.7.X with
Apache 1.3 on Mac OS X there are other problems in that old version of
mod_python that will cause it to crash on Mac OS X, especially when
performing an Apache restart.

I would strongly recommend against using mod_python 2.7.X and instead
install a newer version of Apache and use a newer version of
mod_python.

If for some reason you really don't want to upgrade then you could dig
up patches to get it working from old mailing list posts, but as I
said, it wouldn't be my first choice although I will still point you
in the right direction if you want to do that.

If your reason for wanting mod_python is to host a Python application
framework or application which supports WSGI, eg. Django, TurboGears,
MoinMoin, Trac etc, then I would instead suggest you give mod_wsgi
(www.modwsgi.org) a go. This will work straight out of the box with
Apache 1.3 on MacOS X.

Since mod_wsgi exists and will work with your configuration, if you
don't want to upgrade to a newer version of Apache and are doing what
you want because you want to learn about web programming in Python,
you might be better off looking at WSGI based frameworks rather than
mod_python. With WSGI there are standalone Python web servers as well
as mod_wsgi, so your choices are greater.

Graham

On 19/06/07, mario curiel <mario@avepublishing.com> wrote:
>
>
> Hello, on another machine I have
> MAC OSX server 10.4.9,
> PPC,
> Server version: Apache/1.3.33 (Darwin)
> mod_python-2.7.11
>
>
> like the server admin only uses apache 1.3.33, (pre-installeted) then I
> installed mod_python-2.7.11
>
> then error in httpd  is:
> [Mon Jun 18 10:43:02 2007] [warn] Loaded DSO
> /usr/libexec/httpd/mod_python.so uses plain Apache 1.3 API,
> this module might crash under EAPI! (please recompile it with -DEAPI)
>
> any idea how to recompile it with -DEAPI?
> which program has to be recompiled with -deapi ? the httpd or the program
> mod_python ?
>
> thanks a lot
>
> Alberto
>
>
> root# httpd
> [Mon Jun 18 10:46:59 2007] [warn] Loaded DSO
> /usr/libexec/httpd/mod_python.so uses plain Apache 1.3 API,
> this module might crash under EAPI! (please recompile it with -DEAPI)
> Processing config directory: /etc/httpd/sites/*.conf
>  Processing config file:
> /etc/httpd/sites/0000_10.129.0.37_80_www.NN.com.conf
>  Processing config file:
> /etc/httpd/sites/0004_10.129.0.37_80_www.YY.com.mx.conf
>  Processing config file:
> /etc/httpd/sites/virtual_host_global.conf
>
> root# CFLAGS="-DEAPI" ./configure --with-apxs=/usr/sbin/apxs
> loading cache ./config.cache
> checking for gcc... (cached) gcc
> checking whether the C compiler (gcc -DEAPI ) works... yes
> checking whether the C compiler (gcc -DEAPI ) is a cross-compiler... no
> checking whether we are using GNU C... (cached) yes
> checking whether gcc accepts -g... (cached) yes
> checking for ranlib... (cached) ranlib
> checking for ar... (cached) ar
> checking for a BSD compatible install... (cached) /usr/bin/install -c
> checking whether make sets ${MAKE}... (cached) yes
> checking for main in -lm... (cached) yes
> checking for working const... (cached) yes
> checking your blood pressure... a bit high, but we can proceed
> checking whether apxs is available
> checking for --with-apxs... /usr/sbin/apxs executable, good
> checking for Apache libexec directory... /usr/libexec/httpd
> checking for Apache include directory... -I/usr/include/httpd
> checking for --with-apache... no
> configure: warning: **** No apache sources specified, static compilation
> will not be available.
> configure: warning: **** You can use --with-apache to specify where your
> Apache sources are.
> checking for --with-python... no
> checking for python... (cached)
> /Library/Frameworks/Python.framework/Versions/Current/bin/python
> checking Python version... 2.5
> checking whether Python is compiled with thread support... no threads, good
> checking Python install prefix...
> /Library/Frameworks/Python.framework/Versions/2.5
> checking what libraries Python was linked with...
> /Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/config/libpython2.5.a
>   -ldl
> checking linker flags used to link Python...
> checking where Python include files are...
> -I/Library/Frameworks/Python.framework/Versions/2.5/include/python2.5
> checking for mkdep... (cached) /usr/bin/mkdep
> creating ./config.status
> creating Makefile
> creating src/Makefile
> creating src/libpython.module
> creating Doc/Makefile
> analyzing dependencies
>
>
> root# make CFLAGS=-deapi
>
>  root# make install
>
> Performing DSO installation.
>
> /usr/bin/install -c src/mod_python.so /usr/libexec/httpd
> /usr/bin/install -c -d
> /Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/site-packages/mod_python
> python
> /Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/compileall.py
> /Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/site-packages/mod_python
> Listing
> /Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/site-packages/mod_python
> ...
> Compiling
> /Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/site-packages/mod_python/__init__.py
> ...
> Compiling
> /Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/site-packages/mod_python/apache.py
> ...
> Compiling
> /Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/site-packages/mod_python/cgihandler.py
> ...
> Compiling
> /Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/site-packages/mod_python/httpdapi.py
> ...
> Compiling
> /Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/site-packages/mod_python/publisher.py
> ...
> Compiling
> /Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/site-packages/mod_python/util.py
> ...
> Compiling
> /Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/site-packages/mod_python/zhandler.py
> ...
>
> Now don't forget to edit your main config and add
>     LoadModule python_module
> /usr/libexec/httpd/mod_python.so
> and if your configuration uses ClearModuleList, then also
>     AddModule mod_python.c
>
> root#httpd
> [Mon Jun 18 10:52:46 2007] [warn] Loaded DSO
> /usr/libexec/httpd/mod_python.so uses plain Apache 1.3 API,
> this module might crash under EAPI! (please recompile it with -DEAPI)
> Processing config directory: /etc/httpd/sites/*.conf
>  Processing config file:
> /etc/httpd/sites/0000_10.129.0.37_80_www.NN.com.conf
>  Processing config file:
> /etc/httpd/sites/0004_10.129.0.37_80_www.YY.com.mx.conf
>  Processing config file:
> /etc/httpd/sites/virtual_host_global.conf
>
>
>  root# httpd -V
> Server version: Apache/1.3.33 (Darwin)
> Server built:   Mar 20 2005 15:08:27
> Server's Module Magic Number: 19990320:16
> Server compiled with....
>  -D EAPI
>  -D HAVE_MMAP
>  -D USE_MMAP_SCOREBOARD
>  -D USE_MMAP_FILES
>  -D HAVE_FCNTL_SERIALIZED_ACCEPT
>  -D HAVE_FLOCK_SERIALIZED_ACCEPT
>  -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT
>  -D DYNAMIC_MODULE_LIMIT=64
>  -D HARD_SERVER_LIMIT=2048
>  -D HTTPD_ROOT="/usr"
>  -D SUEXEC_BIN="/usr/sbin/suexec"
>  -D DEFAULT_PIDLOG="/var/run/httpd.pid"
>  -D DEFAULT_SCOREBOARD="/var/run/httpd.scoreboard"
>  -D DEFAULT_LOCKFILE="/var/run/httpd.lock"
>  -D DEFAULT_ERRORLOG="/var/log/httpd/error_log"
>  -D TYPES_CONFIG_FILE="/etc/httpd/mime.types"
>  -D SERVER_CONFIG_FILE="/etc/httpd/httpd.conf"
>  -D ACCESS_CONFIG_FILE="/etc/httpd/access.conf"
>  -D RESOURCE_CONFIG_FILE="/etc/httpd/srm.conf"
>
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
From graham.dumpleton at gmail.com  Mon Jun 18 18:20:28 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon Jun 18 18:20:33 2007
Subject: [mod_python] [SPAM] mod_python.so is so garbled
In-Reply-To: <D4963AB2-12C5-4137-8BBD-24F4A6A181B3@avepublishing.com>
References: <996BCD81-9551-4F64-81D8-1BDD470BBDE4@avepublishing.com>
	<88e286470706172216w5dce0a7au46195c1445ae6480@mail.gmail.com>
	<0A3A38CF-EE26-4FCE-A051-8AD3E21A528E@avepublishing.com>
	<88e286470706172234v1e7aed10jc5d80678fc116eec@mail.gmail.com>
	<D4963AB2-12C5-4137-8BBD-24F4A6A181B3@avepublishing.com>
Message-ID: <88e286470706181520w42000882x8fdf407ee3a1886b@mail.gmail.com>

Lets try something else then. Run 'file' on your mod_python.so and
httpd executable.

kundalini:~ grahamd$ file /usr/local/apache-2.0/modules/mod_python.so
/usr/local/apache-2.0/modules/mod_python.so: Mach-O bundle ppc
kundalini:~ grahamd$ file /usr/local/apache-2.0/bin/httpd
/usr/local/apache-2.0/bin/httpd: Mach-O executable ppc

Being on an Intel Mac, want to make sure that both are actually Intel
binaries and you aren't somehow using an PPC Apache in emulation with
a Intel mod_python.so or something similar.

Also run 'otool' on each:

kundalini:~ grahamd$ otool -L /usr/local/apache-2.0/modules/mod_python.so
/usr/local/apache-2.0/modules/mod_python.so:
        /usr/lib/libSystem.B.dylib (compatibility version 1.0.0,
current version 88.1.6)
        /System/Library/Frameworks/Python.framework/Versions/2.3/Python
(compatibility version 2.3.0, current version 2.3.5)
        /System/Library/Frameworks/CoreServices.framework/Versions/A/CoreServices
(compatibility version 1.0.0, current version 18.0.0)
        /System/Library/Frameworks/Foundation.framework/Versions/C/Foundation
(compatibility version 300.0.0, current version 567.27.0)
kundalini:~ grahamd$ otool -L /usr/local/apache-2.0/bin/httpd
/usr/local/apache-2.0/bin/httpd:
        /usr/local/apache-2.0/lib/libaprutil-0.0.dylib (compatibility
version 10.0.0, current version 10.12.0)
        /usr/local/apache-2.0/lib/libexpat.0.dylib (compatibility
version 2.0.0, current version 2.0.0)
        /usr/lib/libiconv.2.dylib (compatibility version 5.0.0,
current version 5.0.0)
        /usr/local/apache-2.0/lib/libapr-0.0.dylib (compatibility
version 10.0.0, current version 10.12.0)
        /usr/lib/libresolv.9.dylib (compatibility version 1.0.0,
current version 369.5.0)
        /usr/lib/libSystem.B.dylib (compatibility version 1.0.0,
current version 88.1.6)

Even doing a 'ls -las' with each may help.

kundalini:~ grahamd$ ls -las /usr/local/apache-2.0/modules/mod_python.so
808 -rwxr-xr-x   1 grahamd  grahamd  410220 Nov 10  2006
/usr/local/apache-2.0/modules/mod_python.so
kundalini:~ grahamd$ ls -las /usr/local/apache-2.0/bin/httpd
3200 -rwxr-xr-x   1 grahamd  grahamd  1636540 Jul 31  2006
/usr/local/apache-2.0/bin/httpd

Post the results you get.

Graham

On 19/06/07, mario curiel <mario@avepublishing.com> wrote:
> Hello,
>
> thanks, I run the strings line  but there is no AP22, or AP2 line,
> does it mean something?
> > AP_CONN_UNKNOWN
> > AP_CONN_CLOSE
> > AP_CONN_KEEPALIVE
> > APR_NOFILE
> > APR_REG
> > APR_DIR
> > APR_CHR
> > APR_BLK
> > APR_PIPE
> > APR_LNK
> > APR_SOCK
> > APR_UNKFILE
>
> thanks a lot
>
> Alberto
>
>
> On 18/06/2007, at 12:34 AM, Graham Dumpleton wrote:
>
> > On 18/06/07, mario curiel <mario@avepublishing.com> wrote:
> >> sorry, it was my mistake when I was writing this mail,
> >> the line 54 in the httpd.conf file is:
> >>
> >> LoadModule python_module /System/Library/Apache2/Modules/
> >> mod_python.so
> >>
> >> and not
> >> >> LoadModule python-module /System/Library/Apache2/Modules/
> >> >> mod_python.so
> >>
> >>
> >> ok, thanks,  I removed the line: AddModule mod_python.c
> >>
> >> but the error continues, when I enter httpd, of apachectl
> >
> > The other reason this error can occur is that the mod_python.so you
> > are using wasn't actually compiled for the version of Apache you are
> > trying to run it with. Check your compilation output to make sure the
> > -I flags are getting headers file from correct location for that
> > version of Apache and that the header files in that location are in
> > fact for that Apache binary version. Also check that where the
> > mod_python.so file gets installed is where you are picking it up from
> > with configuration you are using.
> >
> > You can run:
> >
> > strings /usr/local/apache-2.2/modules/mod_python.so | grep AP
> >
> > on the mod_python.so that Apache is loading and you should get
> > something like:
> >
> > AP_CONN_UNKNOWN
> > AP_CONN_CLOSE
> > AP_CONN_KEEPALIVE
> > APR_NOFILE
> > APR_REG
> > APR_DIR
> > APR_CHR
> > APR_BLK
> > APR_PIPE
> > APR_LNK
> > APR_SOCK
> > APR_UNKFILE
> > AP22
> >
> > That last line says mine was compiled for Apache 2.2. If it said AP20
> > then would have been compiled for Apache 2.0 instead.
> >
> >> >> Syntax error on line 54 of /Local/Library/Webserver/Configuration/
> >> >> httpd.conf: API module structure ?python_module? in file /System/
> >> >> Library/Apache/Modules/mod_python.so is so garbled - perhaps
> >> this is
> >> >> not an Apache module DSO?
> >>
> >> any idea?
> >>
> >> thanks a lot
> >>
> >> Alberto
> >>
> >>
> >> On 18/06/2007, at 12:16 AM, Graham Dumpleton wrote:
> >>
> >> > See comments below.
> >> >
> >> > On 18/06/07, mario curiel <mario@avepublishing.com> wrote:
> >> >> I got the error in apachectl -k start:
> >> >>
> >> >> httpd: Syntax error on line 54 of /Local/Library/Webserver/
> >> >> Configuration/httpd.conf: API module structure ?python_module? in
> >> >> file /System/Library/Apache/Modules/mod_python.so is so garbled -
> >> >> perhaps this is not an Apache module DSO?
> >> >>
> >> >> In the computer has Mac OSX 10.4.9,
> >> >> MAC Pro with intel processors,
> >> >> python 2.5.1
> >> >> apache sever 2.2.4 (unix)
> >> >>
> >> >> a)installation of mod_python-3.3.1:
> >> >>
> >> >> -configure --with-apxs=/Library/Apache2/bin/apxs --with-fex=/
> >> usr/bin/
> >> >> flex
> >> >> make
> >> >> make install
> >> >>
> >> >>
> >> >> also I tried with
> >> >>
> >> >> b)
> >> >> make install_dso
> >> >> make install_py_lib
> >> >>
> >> >> in both cases (a and b) the last line of the install is the
> >> >> installation of the mod_python-3-3.1/py2.5.egg-info:
> >> >> writing /Library/Frameworks/Python.framework/verons/2.5/lib/
> >> >> python2.5/
> >> >> site-packages/mod_python-3-3.1/py2.5.egg-info
> >> >>
> >> >>
> >> >> I added the lines to the httpd.conf:
> >> >> the lines 54-56 :
> >> >>
> >> >> LoadModule python-module /System/Library/Apache2/Modules/
> >> >> mod_python.so
> >> >
> >> > This line is wrong. Should be 'python_module' not 'python-module'.
> >> >
> >> >> AddModule mod_python.c
> >> >
> >> > This line is not needed with Apache 2.
> >> >
> >> >> then I run apachectl -k start and the error appears:
> >> >>
> >> >> Syntax error on line 54 of /Local/Library/Webserver/Configuration/
> >> >> httpd.conf: API module structure ?python_module? in file /System/
> >> >> Library/Apache/Modules/mod_python.so is so garbled - perhaps
> >> this is
> >> >> not an Apache module DSO?
> >> >>
> >> >>
> >> >> how to correct it?
> >> >>
> >> >> thanks a lot
> >> >>
> >> >> Alberto
> >> >> _______________________________________________
> >> >> Mod_python mailing list
> >> >> Mod_python@modpython.org
> >> >> http://mailman.modpython.org/mailman/listinfo/mod_python
> >> >>
> >> >
> >>
> >>
> >
>
>

From graham.dumpleton at gmail.com  Mon Jun 18 19:55:45 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon Jun 18 19:55:51 2007
Subject: [mod_python] [SPAM] mod_python.so is so garbled
In-Reply-To: <7399548D-1B37-4F0B-BA89-B6B4364DE435@avepublishing.com>
References: <996BCD81-9551-4F64-81D8-1BDD470BBDE4@avepublishing.com>
	<88e286470706172216w5dce0a7au46195c1445ae6480@mail.gmail.com>
	<0A3A38CF-EE26-4FCE-A051-8AD3E21A528E@avepublishing.com>
	<88e286470706172234v1e7aed10jc5d80678fc116eec@mail.gmail.com>
	<D4963AB2-12C5-4137-8BBD-24F4A6A181B3@avepublishing.com>
	<88e286470706181520w42000882x8fdf407ee3a1886b@mail.gmail.com>
	<7399548D-1B37-4F0B-BA89-B6B4364DE435@avepublishing.com>
Message-ID: <88e286470706181655l724142e1o5b64f943354466fa@mail.gmail.com>

You would have to recompile Apache from source.

Where did your Apache installation come from to begin with, was it a
binary distribution from somewhere or did you compile it? If you
compiled from source on the same box, not sure how you would have
ended up with a PPC binary.

Graham

On 19/06/07, mario curiel <mario@avepublishing.com> wrote:
> oops,
> here are the results,
> you are right...how can I correct it?
> thanks
>
> ave:/Library/Apache2/bin root# file httpd
> httpd: Mach-O executable ppc
>
> ave:/Library/Apache2/modules mario$ file mod_python.so
> mod_python.so: Mach-O bundle i386
>
> ave:/Library/Apache2/bin root# otool -L httpd
> httpd:
>         /usr/lib/libssl.0.9.7.dylib (compatibility version 0.9.7, current
> version 0.9.7)
>         /usr/lib/libcrypto.0.9.7.dylib (compatibility version 0.9.7, current
> version 0.9.7)
>         /Library/Apache2/lib/libaprutil-0.0.dylib
> (compatibility version 10.0.0, current version 10.5.0)
>
> /System/Library/Frameworks/LDAP.framework/Versions/A/LDAP
> (compatibility version 1.0.0, current version 2.1.0)
>         /Library/Apache2/lib/libexpat.0.dylib
> (compatibility version 2.0.0, current version 2.0.0)
>         /usr/lib/libiconv.2.dylib (compatibility version 5.0.0, current
> version 5.0.0)
>         /Library/Apache2/lib/libapr-0.0.dylib (compatibility version 10.0.0,
> current version 10.5.0)
>         /usr/lib/libresolv.9.dylib (compatibility version 1.0.0, current
> version 324.6.0)
>         /usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current
> version 71.1.1)
>
>
> ave:/Library/Apache2/modules root# otool -L mod_python.so
> mod_python.so:
>         /usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current
> version 88.5.1)
>
> /Library/Frameworks/Python.framework/Versions/2.5/Python
> (compatibility version 2.5.0, current version 2.5.0)
>
>
>
> ave:/Library/Apache2/bin root# ls -las httpd
> 1848 -rwxr-xr-x   1 root  admin  944820 Oct  1  2004 httpd
>
> ave:/Library/Apache2/modules root# ls -las mod_python.so
> 784 -rwxr-xr-x   1 root  admin  397588 Jun 17 23:58 mod_python.so
>
>
> On 18/06/2007, at 05:20 PM, Graham Dumpleton wrote:
>
> Lets try something else then. Run 'file' on your mod_python.so and
> httpd executable.
>
> kundalini:~ grahamd$ file /usr/local/apache-2.0/modules/mod_python.so
> /usr/local/apache-2.0/modules/mod_python.so: Mach-O bundle ppc
> kundalini:~ grahamd$ file /usr/local/apache-2.0/bin/httpd
> /usr/local/apache-2.0/bin/httpd: Mach-O executable ppc
>
> Being on an Intel Mac, want to make sure that both are actually Intel
> binaries and you aren't somehow using an PPC Apache in emulation with
> a Intel mod_python.so or something similar.
>
> Also run 'otool' on each:
>
> kundalini:~ grahamd$ otool -L /usr/local/apache-2.0/modules/mod_python.so
> /usr/local/apache-2.0/modules/mod_python.so:
>        /usr/lib/libSystem.B.dylib (compatibility version 1.0.0,
> current version 88.1.6)
>
> /System/Library/Frameworks/Python.framework/Versions/2.3/Python
> (compatibility version 2.3.0, current version 2.3.5)
>
> /System/Library/Frameworks/CoreServices.framework/Versions/A/CoreServices
> (compatibility version 1.0.0, current version 18.0.0)
>
> /System/Library/Frameworks/Foundation.framework/Versions/C/Foundation
> (compatibility version 300.0.0, current version 567.27.0)
> kundalini:~ grahamd$ otool -L /usr/local/apache-2.0/bin/httpd
> /usr/local/apache-2.0/bin/httpd:
>        /usr/local/apache-2.0/lib/libaprutil-0.0.dylib (compatibility
> version 10.0.0, current version 10.12.0)
>        /usr/local/apache-2.0/lib/libexpat.0.dylib (compatibility
> version 2.0.0, current version 2.0.0)
>        /usr/lib/libiconv.2.dylib (compatibility version 5.0.0,
> current version 5.0.0)
>        /usr/local/apache-2.0/lib/libapr-0.0.dylib (compatibility
> version 10.0.0, current version 10.12.0)
>        /usr/lib/libresolv.9.dylib (compatibility version 1.0.0,
> current version 369.5.0)
>        /usr/lib/libSystem.B.dylib (compatibility version 1.0.0,
> current version 88.1.6)
>
> Even doing a 'ls -las' with each may help.
>
> kundalini:~ grahamd$ ls -las /usr/local/apache-2.0/modules/mod_python.so
> 808 -rwxr-xr-x   1 grahamd  grahamd  410220 Nov 10  2006
> /usr/local/apache-2.0/modules/mod_python.so
> kundalini:~ grahamd$ ls -las /usr/local/apache-2.0/bin/httpd
> 3200 -rwxr-xr-x   1 grahamd  grahamd  1636540 Jul 31  2006
> /usr/local/apache-2.0/bin/httpd
>
> Post the results you get.
>
> Graham
>
> On 19/06/07, mario curiel <mario@avepublishing.com> wrote:
> Hello,
>
> thanks, I run the strings line  but there is no AP22, or AP2 line,
> does it mean something?
> > AP_CONN_UNKNOWN
> > AP_CONN_CLOSE
> > AP_CONN_KEEPALIVE
> > APR_NOFILE
> > APR_REG
> > APR_DIR
> > APR_CHR
> > APR_BLK
> > APR_PIPE
> > APR_LNK
> > APR_SOCK
> > APR_UNKFILE
>
> thanks a lot
>
> Alberto
>
>
> On 18/06/2007, at 12:34 AM, Graham Dumpleton wrote:
>
> > On 18/06/07, mario curiel <mario@avepublishing.com> wrote:
> >> sorry, it was my mistake when I was writing this mail,
> >> the line 54 in the httpd.conf file is:
> >>
> >> LoadModule python_module
> /System/Library/Apache2/Modules/
> >> mod_python.so
> >>
> >> and not
> >> >> LoadModule python-module
> /System/Library/Apache2/Modules/
> >> >> mod_python.so
> >>
> >>
> >> ok, thanks,  I removed the line: AddModule mod_python.c
> >>
> >> but the error continues, when I enter httpd, of apachectl
> >
> > The other reason this error can occur is that the mod_python.so you
> > are using wasn't actually compiled for the version of Apache you are
> > trying to run it with. Check your compilation output to make sure the
> > -I flags are getting headers file from correct location for that
> > version of Apache and that the header files in that location are in
> > fact for that Apache binary version. Also check that where the
> > mod_python.so file gets installed is where you are picking it up from
> > with configuration you are using.
> >
> > You can run:
> >
> > strings /usr/local/apache-2.2/modules/mod_python.so | grep AP
> >
> > on the mod_python.so that Apache is loading and you should get
> > something like:
> >
> > AP_CONN_UNKNOWN
> > AP_CONN_CLOSE
> > AP_CONN_KEEPALIVE
> > APR_NOFILE
> > APR_REG
> > APR_DIR
> > APR_CHR
> > APR_BLK
> > APR_PIPE
> > APR_LNK
> > APR_SOCK
> > APR_UNKFILE
> > AP22
> >
> > That last line says mine was compiled for Apache 2.2. If it said AP20
> > then would have been compiled for Apache 2.0 instead.
> >
> >> >> Syntax error on line 54 of
> /Local/Library/Webserver/Configuration/
> >> >> httpd.conf: API module structure ?python_module? in file /System/
> >> >> Library/Apache/Modules/mod_python.so is so garbled -
> perhaps
> >> this is
> >> >> not an Apache module DSO?
> >>
> >> any idea?
> >>
> >> thanks a lot
> >>
> >> Alberto
> >>
> >>
> >> On 18/06/2007, at 12:16 AM, Graham Dumpleton wrote:
> >>
> >> > See comments below.
> >> >
> >> > On 18/06/07, mario curiel <mario@avepublishing.com> wrote:
> >> >> I got the error in apachectl -k start:
> >> >>
> >> >> httpd: Syntax error on line 54 of /Local/Library/Webserver/
> >> >> Configuration/httpd.conf: API module structure ?python_module? in
> >> >> file /System/Library/Apache/Modules/mod_python.so is
> so garbled -
> >> >> perhaps this is not an Apache module DSO?
> >> >>
> >> >> In the computer has Mac OSX 10.4.9,
> >> >> MAC Pro with intel processors,
> >> >> python 2.5.1
> >> >> apache sever 2.2.4 (unix)
> >> >>
> >> >> a)installation of mod_python-3.3.1:
> >> >>
> >> >> -configure --with-apxs=/Library/Apache2/bin/apxs
> --with-fex=/
> >> usr/bin/
> >> >> flex
> >> >> make
> >> >> make install
> >> >>
> >> >>
> >> >> also I tried with
> >> >>
> >> >> b)
> >> >> make install_dso
> >> >> make install_py_lib
> >> >>
> >> >> in both cases (a and b) the last line of the install is the
> >> >> installation of the mod_python-3-3.1/py2.5.egg-info:
> >> >> writing
> /Library/Frameworks/Python.framework/verons/2.5/lib/
> >> >> python2.5/
> >> >> site-packages/mod_python-3-3.1/py2.5.egg-info
> >> >>
> >> >>
> >> >> I added the lines to the httpd.conf:
> >> >> the lines 54-56 :
> >> >>
> >> >> LoadModule python-module
> /System/Library/Apache2/Modules/
> >> >> mod_python.so
> >> >
> >> > This line is wrong. Should be 'python_module' not 'python-module'.
> >> >
> >> >> AddModule mod_python.c
> >> >
> >> > This line is not needed with Apache 2.
> >> >
> >> >> then I run apachectl -k start and the error appears:
> >> >>
> >> >> Syntax error on line 54 of
> /Local/Library/Webserver/Configuration/
> >> >> httpd.conf: API module structure ?python_module? in file /System/
> >> >> Library/Apache/Modules/mod_python.so is so garbled -
> perhaps
> >> this is
> >> >> not an Apache module DSO?
> >> >>
> >> >>
> >> >> how to correct it?
> >> >>
> >> >> thanks a lot
> >> >>
> >> >> Alberto
> >> >> _______________________________________________
> >> >> Mod_python mailing list
> >> >> Mod_python@modpython.org
> >> >>
> http://mailman.modpython.org/mailman/listinfo/mod_python
> >> >>
> >> >
> >>
> >>
> >
>
>
>
>
>
>

From makerjoe at gmail.com  Tue Jun 19 18:19:02 2007
From: makerjoe at gmail.com (maker joe)
Date: Tue Jun 19 18:19:10 2007
Subject: [mod_python] psp import issue
Message-ID: <227f6fed0706191519s2ca6ab82s9050032e373a8222@mail.gmail.com>

hi
how can i import a module from the current directory on a psp file
eg
test.psp
<%
import somemodule
%>
somemodule.py is at the same directory as test.psp

the same works importing from a file.py
im using publisher and psp hanlers
python 2.5 modputhon 3.31

thanks
joseluis
From graham.dumpleton at gmail.com  Tue Jun 19 19:31:12 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue Jun 19 19:31:18 2007
Subject: [mod_python] psp import issue
In-Reply-To: <227f6fed0706191519s2ca6ab82s9050032e373a8222@mail.gmail.com>
References: <227f6fed0706191519s2ca6ab82s9050032e373a8222@mail.gmail.com>
Message-ID: <88e286470706191631i4e5e9af0vcd1b78eebc89df74@mail.gmail.com>

Issue noted at:

  https://issues.apache.org/jira/browse/MODPYTHON-220

You should be able to use:

  somemodule = apache.import_module("somemodule")

instead.

Graham

On 20/06/07, maker joe <makerjoe@gmail.com> wrote:
> hi
> how can i import a module from the current directory on a psp file
> eg
> test.psp
> <%
> import somemodule
> %>
> somemodule.py is at the same directory as test.psp
>
> the same works importing from a file.py
> im using publisher and psp hanlers
> python 2.5 modputhon 3.31
>
> thanks
> joseluis
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From ah at hatzis.de  Wed Jun 20 13:23:40 2007
From: ah at hatzis.de (Anastasios Hatzis)
Date: Wed Jun 20 13:23:59 2007
Subject: [mod_python] UnicodeDecodeError with
	util.FieldStorage(req).Field.value
Message-ID: <200706201923.46099.ah@hatzis.de>

Hi,

I'm struggling with UnicodeDecodeError when trying to append 
util.FieldStorage(req).Field.value with umlaut into a variable of type 
unicode.

<SNIP>
<%
# file: test.psp

from mod_python import Session, util
req.assbackwards

req.content_type = 'text/html; charset=UTF-8'
%>
<!--SOME HTML HEAD STUFF HERE-->

<form action="/test.psp" method="post" enctype="text/plain" 
accept-charset="UTF-8">
<!-- form calls this very same file -->
<input name="name" type="text" size="30" maxlength="50" />
<input type="submit" value="Submit" />
</form>

<%
req.write('<p>Write values to HTML</p>') # Works fine!
store = util.FieldStorage(req)
for param in store.list:
    req.write(param.value)
%>
<b><%=param.name%></b>:<%=param.value%>:<%=type(param.value)%><br />
<%

req.write('<p>Append all values to the variable msg</p>')
msg = u''
for param in store.list:
    msg += param.name + ': ' + param.value + '\r\n' # UnicodeDecodeError!
%>
<!--SOME HTML FOOT STUFF HERE-->

</SNIP>


So, when calling this page the HTML output for first section is rendered with 
umlaut (?, ?, ...). Value is <type 'str'> ... well, why not, as long as it is 
UTF-8...

But as soon as the script tries to append param.value to the unicode 
variable "msg" I'm getting this error:

UnicodeDecodeError: 'ascii' codec can't decode byte 0xc3 in position 26: 
ordinal not in range(128)


I do not understand why I'm getting this error. How does 'ascii' come into 
this? How do I know which encoding is really applied (in param.value and in 
msg)?

I'm blind, hum?

Anastasios
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 307 bytes
Desc: not available
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070620/851921a7/attachment.bin
From mario at avepublishing.com  Wed Jun 20 19:52:47 2007
From: mario at avepublishing.com (mario curiel)
Date: Wed Jun 20 19:53:04 2007
Subject: [SPAM] Re: [mod_python] [SPAM] please recompile it with -DEAPI..
In-Reply-To: <88e286470706181511r459c8f3el2c20c84ffe45939e@mail.gmail.com>
References: <84ABC318-3EA7-498E-AD1D-ECD40733312C@avepublishing.com>
	<88e286470706181511r459c8f3el2c20c84ffe45939e@mail.gmail.com>
Message-ID: <184E335D-02AC-4882-867A-E6F497D36EC0@avepublishing.com>

Graham

thanks,

I am looking for a way to access via web pages page, databases via  
python
I will check for those software, and update one of the machines with  
apache (but it doesnt seem easy in mac)

Alberto

On 18/06/2007, at 05:11 PM, Graham Dumpleton wrote:

> Even if you get past the -DEAPI issue with mod_python 2.7.X with
> Apache 1.3 on Mac OS X there are other problems in that old version of
> mod_python that will cause it to crash on Mac OS X, especially when
> performing an Apache restart.
>
> I would strongly recommend against using mod_python 2.7.X and instead
> install a newer version of Apache and use a newer version of
> mod_python.
>
> If for some reason you really don't want to upgrade then you could dig
> up patches to get it working from old mailing list posts, but as I
> said, it wouldn't be my first choice although I will still point you
> in the right direction if you want to do that.
>
> If your reason for wanting mod_python is to host a Python application
> framework or application which supports WSGI, eg. Django, TurboGears,
> MoinMoin, Trac etc, then I would instead suggest you give mod_wsgi
> (www.modwsgi.org) a go. This will work straight out of the box with
> Apache 1.3 on MacOS X.
>
> Since mod_wsgi exists and will work with your configuration, if you
> don't want to upgrade to a newer version of Apache and are doing what
> you want because you want to learn about web programming in Python,
> you might be better off looking at WSGI based frameworks rather than
> mod_python. With WSGI there are standalone Python web servers as well
> as mod_wsgi, so your choices are greater.
>
> Graham
>
> On 19/06/07, mario curiel <mario@avepublishing.com> wrote:
>>
>>
>> Hello, on another machine I have
>> MAC OSX server 10.4.9,
>> PPC,
>> Server version: Apache/1.3.33 (Darwin)
>> mod_python-2.7.11
>>
>>
>> like the server admin only uses apache 1.3.33, (pre-installeted)  
>> then I
>> installed mod_python-2.7.11
>>
>> then error in httpd  is:
>> [Mon Jun 18 10:43:02 2007] [warn] Loaded DSO
>> /usr/libexec/httpd/mod_python.so uses plain Apache 1.3 API,
>> this module might crash under EAPI! (please recompile it with -DEAPI)
>>
>> any idea how to recompile it with -DEAPI?
>> which program has to be recompiled with -deapi ? the httpd or the  
>> program
>> mod_python ?
>>
>> thanks a lot
>>
>> Alberto
>>
>>
>> root# httpd
>> [Mon Jun 18 10:46:59 2007] [warn] Loaded DSO
>> /usr/libexec/httpd/mod_python.so uses plain Apache 1.3 API,
>> this module might crash under EAPI! (please recompile it with -DEAPI)
>> Processing config directory: /etc/httpd/sites/*.conf
>>  Processing config file:
>> /etc/httpd/sites/0000_10.129.0.37_80_www.NN.com.conf
>>  Processing config file:
>> /etc/httpd/sites/0004_10.129.0.37_80_www.YY.com.mx.conf
>>  Processing config file:
>> /etc/httpd/sites/virtual_host_global.conf
>>
>> root# CFLAGS="-DEAPI" ./configure --with-apxs=/usr/sbin/apxs
>> loading cache ./config.cache
>> checking for gcc... (cached) gcc
>> checking whether the C compiler (gcc -DEAPI ) works... yes
>> checking whether the C compiler (gcc -DEAPI ) is a cross- 
>> compiler... no
>> checking whether we are using GNU C... (cached) yes
>> checking whether gcc accepts -g... (cached) yes
>> checking for ranlib... (cached) ranlib
>> checking for ar... (cached) ar
>> checking for a BSD compatible install... (cached) /usr/bin/install -c
>> checking whether make sets ${MAKE}... (cached) yes
>> checking for main in -lm... (cached) yes
>> checking for working const... (cached) yes
>> checking your blood pressure... a bit high, but we can proceed
>> checking whether apxs is available
>> checking for --with-apxs... /usr/sbin/apxs executable, good
>> checking for Apache libexec directory... /usr/libexec/httpd
>> checking for Apache include directory... -I/usr/include/httpd
>> checking for --with-apache... no
>> configure: warning: **** No apache sources specified, static  
>> compilation
>> will not be available.
>> configure: warning: **** You can use --with-apache to specify  
>> where your
>> Apache sources are.
>> checking for --with-python... no
>> checking for python... (cached)
>> /Library/Frameworks/Python.framework/Versions/Current/bin/python
>> checking Python version... 2.5
>> checking whether Python is compiled with thread support... no  
>> threads, good
>> checking Python install prefix...
>> /Library/Frameworks/Python.framework/Versions/2.5
>> checking what libraries Python was linked with...
>> /Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/ 
>> config/libpython2.5.a
>>   -ldl
>> checking linker flags used to link Python...
>> checking where Python include files are...
>> -I/Library/Frameworks/Python.framework/Versions/2.5/include/python2.5
>> checking for mkdep... (cached) /usr/bin/mkdep
>> creating ./config.status
>> creating Makefile
>> creating src/Makefile
>> creating src/libpython.module
>> creating Doc/Makefile
>> analyzing dependencies
>>
>>
>> root# make CFLAGS=-deapi
>>
>>  root# make install
>>
>> Performing DSO installation.
>>
>> /usr/bin/install -c src/mod_python.so /usr/libexec/httpd
>> /usr/bin/install -c -d
>> /Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/ 
>> site-packages/mod_python
>> python
>> /Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/ 
>> compileall.py
>> /Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/ 
>> site-packages/mod_python
>> Listing
>> /Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/ 
>> site-packages/mod_python
>> ...
>> Compiling
>> /Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/ 
>> site-packages/mod_python/__init__.py
>> ...
>> Compiling
>> /Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/ 
>> site-packages/mod_python/apache.py
>> ...
>> Compiling
>> /Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/ 
>> site-packages/mod_python/cgihandler.py
>> ...
>> Compiling
>> /Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/ 
>> site-packages/mod_python/httpdapi.py
>> ...
>> Compiling
>> /Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/ 
>> site-packages/mod_python/publisher.py
>> ...
>> Compiling
>> /Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/ 
>> site-packages/mod_python/util.py
>> ...
>> Compiling
>> /Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/ 
>> site-packages/mod_python/zhandler.py
>> ...
>>
>> Now don't forget to edit your main config and add
>>     LoadModule python_module
>> /usr/libexec/httpd/mod_python.so
>> and if your configuration uses ClearModuleList, then also
>>     AddModule mod_python.c
>>
>> root#httpd
>> [Mon Jun 18 10:52:46 2007] [warn] Loaded DSO
>> /usr/libexec/httpd/mod_python.so uses plain Apache 1.3 API,
>> this module might crash under EAPI! (please recompile it with -DEAPI)
>> Processing config directory: /etc/httpd/sites/*.conf
>>  Processing config file:
>> /etc/httpd/sites/0000_10.129.0.37_80_www.NN.com.conf
>>  Processing config file:
>> /etc/httpd/sites/0004_10.129.0.37_80_www.YY.com.mx.conf
>>  Processing config file:
>> /etc/httpd/sites/virtual_host_global.conf
>>
>>
>>  root# httpd -V
>> Server version: Apache/1.3.33 (Darwin)
>> Server built:   Mar 20 2005 15:08:27
>> Server's Module Magic Number: 19990320:16
>> Server compiled with....
>>  -D EAPI
>>  -D HAVE_MMAP
>>  -D USE_MMAP_SCOREBOARD
>>  -D USE_MMAP_FILES
>>  -D HAVE_FCNTL_SERIALIZED_ACCEPT
>>  -D HAVE_FLOCK_SERIALIZED_ACCEPT
>>  -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT
>>  -D DYNAMIC_MODULE_LIMIT=64
>>  -D HARD_SERVER_LIMIT=2048
>>  -D HTTPD_ROOT="/usr"
>>  -D SUEXEC_BIN="/usr/sbin/suexec"
>>  -D DEFAULT_PIDLOG="/var/run/httpd.pid"
>>  -D DEFAULT_SCOREBOARD="/var/run/httpd.scoreboard"
>>  -D DEFAULT_LOCKFILE="/var/run/httpd.lock"
>>  -D DEFAULT_ERRORLOG="/var/log/httpd/error_log"
>>  -D TYPES_CONFIG_FILE="/etc/httpd/mime.types"
>>  -D SERVER_CONFIG_FILE="/etc/httpd/httpd.conf"
>>  -D ACCESS_CONFIG_FILE="/etc/httpd/access.conf"
>>  -D RESOURCE_CONFIG_FILE="/etc/httpd/srm.conf"
>>
>>
>>
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>
>>
>

From mario at avepublishing.com  Wed Jun 20 19:57:36 2007
From: mario at avepublishing.com (mario curiel)
Date: Wed Jun 20 19:57:52 2007
Subject: [SPAM] Re: [mod_python] [SPAM] mod_python.so is so garbled
In-Reply-To: <88e286470706181520w42000882x8fdf407ee3a1886b@mail.gmail.com>
References: <996BCD81-9551-4F64-81D8-1BDD470BBDE4@avepublishing.com>
	<88e286470706172216w5dce0a7au46195c1445ae6480@mail.gmail.com>
	<0A3A38CF-EE26-4FCE-A051-8AD3E21A528E@avepublishing.com>
	<88e286470706172234v1e7aed10jc5d80678fc116eec@mail.gmail.com>
	<D4963AB2-12C5-4137-8BBD-24F4A6A181B3@avepublishing.com>
	<88e286470706181520w42000882x8fdf407ee3a1886b@mail.gmail.com>
Message-ID: <6E584857-821A-498F-871B-2EB878B50969@avepublishing.com>

Hi,

I found that the package that I downloaded from serverlogistics was  
for PPC and not for Intel,
As it was so mixed in the mac, I   formatted the disk , reinstalled  
the OS and I am starting to install the apache2,
now I have to find how to tell the machine to use the apache2 and not  
the apache1.3 preinstalled, but maybe it is another post.

thanks a lot

Alberto

On 18/06/2007, at 05:20 PM, Graham Dumpleton wrote:

> Lets try something else then. Run 'file' on your mod_python.so and
> httpd executable.
>
> kundalini:~ grahamd$ file /usr/local/apache-2.0/modules/mod_python.so
> /usr/local/apache-2.0/modules/mod_python.so: Mach-O bundle ppc
> kundalini:~ grahamd$ file /usr/local/apache-2.0/bin/httpd
> /usr/local/apache-2.0/bin/httpd: Mach-O executable ppc
>
> Being on an Intel Mac, want to make sure that both are actually Intel
> binaries and you aren't somehow using an PPC Apache in emulation with
> a Intel mod_python.so or something similar.
>
> Also run 'otool' on each:
>
> kundalini:~ grahamd$ otool -L /usr/local/apache-2.0/modules/ 
> mod_python.so
> /usr/local/apache-2.0/modules/mod_python.so:
>        /usr/lib/libSystem.B.dylib (compatibility version 1.0.0,
> current version 88.1.6)
>        /System/Library/Frameworks/Python.framework/Versions/2.3/Python
> (compatibility version 2.3.0, current version 2.3.5)
>        /System/Library/Frameworks/CoreServices.framework/Versions/A/ 
> CoreServices
> (compatibility version 1.0.0, current version 18.0.0)
>        /System/Library/Frameworks/Foundation.framework/Versions/C/ 
> Foundation
> (compatibility version 300.0.0, current version 567.27.0)
> kundalini:~ grahamd$ otool -L /usr/local/apache-2.0/bin/httpd
> /usr/local/apache-2.0/bin/httpd:
>        /usr/local/apache-2.0/lib/libaprutil-0.0.dylib (compatibility
> version 10.0.0, current version 10.12.0)
>        /usr/local/apache-2.0/lib/libexpat.0.dylib (compatibility
> version 2.0.0, current version 2.0.0)
>        /usr/lib/libiconv.2.dylib (compatibility version 5.0.0,
> current version 5.0.0)
>        /usr/local/apache-2.0/lib/libapr-0.0.dylib (compatibility
> version 10.0.0, current version 10.12.0)
>        /usr/lib/libresolv.9.dylib (compatibility version 1.0.0,
> current version 369.5.0)
>        /usr/lib/libSystem.B.dylib (compatibility version 1.0.0,
> current version 88.1.6)
>
> Even doing a 'ls -las' with each may help.
>
> kundalini:~ grahamd$ ls -las /usr/local/apache-2.0/modules/ 
> mod_python.so
> 808 -rwxr-xr-x   1 grahamd  grahamd  410220 Nov 10  2006
> /usr/local/apache-2.0/modules/mod_python.so
> kundalini:~ grahamd$ ls -las /usr/local/apache-2.0/bin/httpd
> 3200 -rwxr-xr-x   1 grahamd  grahamd  1636540 Jul 31  2006
> /usr/local/apache-2.0/bin/httpd
>
> Post the results you get.
>
> Graham
>
> On 19/06/07, mario curiel <mario@avepublishing.com> wrote:
>> Hello,
>>
>> thanks, I run the strings line  but there is no AP22, or AP2 line,
>> does it mean something?
>> > AP_CONN_UNKNOWN
>> > AP_CONN_CLOSE
>> > AP_CONN_KEEPALIVE
>> > APR_NOFILE
>> > APR_REG
>> > APR_DIR
>> > APR_CHR
>> > APR_BLK
>> > APR_PIPE
>> > APR_LNK
>> > APR_SOCK
>> > APR_UNKFILE
>>
>> thanks a lot
>>
>> Alberto
>>
>>
>> On 18/06/2007, at 12:34 AM, Graham Dumpleton wrote:
>>
>> > On 18/06/07, mario curiel <mario@avepublishing.com> wrote:
>> >> sorry, it was my mistake when I was writing this mail,
>> >> the line 54 in the httpd.conf file is:
>> >>
>> >> LoadModule python_module /System/Library/Apache2/Modules/
>> >> mod_python.so
>> >>
>> >> and not
>> >> >> LoadModule python-module /System/Library/Apache2/Modules/
>> >> >> mod_python.so
>> >>
>> >>
>> >> ok, thanks,  I removed the line: AddModule mod_python.c
>> >>
>> >> but the error continues, when I enter httpd, of apachectl
>> >
>> > The other reason this error can occur is that the mod_python.so you
>> > are using wasn't actually compiled for the version of Apache you  
>> are
>> > trying to run it with. Check your compilation output to make  
>> sure the
>> > -I flags are getting headers file from correct location for that
>> > version of Apache and that the header files in that location are in
>> > fact for that Apache binary version. Also check that where the
>> > mod_python.so file gets installed is where you are picking it up  
>> from
>> > with configuration you are using.
>> >
>> > You can run:
>> >
>> > strings /usr/local/apache-2.2/modules/mod_python.so | grep AP
>> >
>> > on the mod_python.so that Apache is loading and you should get
>> > something like:
>> >
>> > AP_CONN_UNKNOWN
>> > AP_CONN_CLOSE
>> > AP_CONN_KEEPALIVE
>> > APR_NOFILE
>> > APR_REG
>> > APR_DIR
>> > APR_CHR
>> > APR_BLK
>> > APR_PIPE
>> > APR_LNK
>> > APR_SOCK
>> > APR_UNKFILE
>> > AP22
>> >
>> > That last line says mine was compiled for Apache 2.2. If it said  
>> AP20
>> > then would have been compiled for Apache 2.0 instead.
>> >
>> >> >> Syntax error on line 54 of /Local/Library/Webserver/ 
>> Configuration/
>> >> >> httpd.conf: API module structure ?python_module? in file / 
>> System/
>> >> >> Library/Apache/Modules/mod_python.so is so garbled - perhaps
>> >> this is
>> >> >> not an Apache module DSO?
>> >>
>> >> any idea?
>> >>
>> >> thanks a lot
>> >>
>> >> Alberto
>> >>
>> >>
>> >> On 18/06/2007, at 12:16 AM, Graham Dumpleton wrote:
>> >>
>> >> > See comments below.
>> >> >
>> >> > On 18/06/07, mario curiel <mario@avepublishing.com> wrote:
>> >> >> I got the error in apachectl -k start:
>> >> >>
>> >> >> httpd: Syntax error on line 54 of /Local/Library/Webserver/
>> >> >> Configuration/httpd.conf: API module structure ?python_module 
>> ? in
>> >> >> file /System/Library/Apache/Modules/mod_python.so is so  
>> garbled -
>> >> >> perhaps this is not an Apache module DSO?
>> >> >>
>> >> >> In the computer has Mac OSX 10.4.9,
>> >> >> MAC Pro with intel processors,
>> >> >> python 2.5.1
>> >> >> apache sever 2.2.4 (unix)
>> >> >>
>> >> >> a)installation of mod_python-3.3.1:
>> >> >>
>> >> >> -configure --with-apxs=/Library/Apache2/bin/apxs --with-fex=/
>> >> usr/bin/
>> >> >> flex
>> >> >> make
>> >> >> make install
>> >> >>
>> >> >>
>> >> >> also I tried with
>> >> >>
>> >> >> b)
>> >> >> make install_dso
>> >> >> make install_py_lib
>> >> >>
>> >> >> in both cases (a and b) the last line of the install is the
>> >> >> installation of the mod_python-3-3.1/py2.5.egg-info:
>> >> >> writing /Library/Frameworks/Python.framework/verons/2.5/lib/
>> >> >> python2.5/
>> >> >> site-packages/mod_python-3-3.1/py2.5.egg-info
>> >> >>
>> >> >>
>> >> >> I added the lines to the httpd.conf:
>> >> >> the lines 54-56 :
>> >> >>
>> >> >> LoadModule python-module /System/Library/Apache2/Modules/
>> >> >> mod_python.so
>> >> >
>> >> > This line is wrong. Should be 'python_module' not 'python- 
>> module'.
>> >> >
>> >> >> AddModule mod_python.c
>> >> >
>> >> > This line is not needed with Apache 2.
>> >> >
>> >> >> then I run apachectl -k start and the error appears:
>> >> >>
>> >> >> Syntax error on line 54 of /Local/Library/Webserver/ 
>> Configuration/
>> >> >> httpd.conf: API module structure ?python_module? in file / 
>> System/
>> >> >> Library/Apache/Modules/mod_python.so is so garbled - perhaps
>> >> this is
>> >> >> not an Apache module DSO?
>> >> >>
>> >> >>
>> >> >> how to correct it?
>> >> >>
>> >> >> thanks a lot
>> >> >>
>> >> >> Alberto
>> >> >> _______________________________________________
>> >> >> Mod_python mailing list
>> >> >> Mod_python@modpython.org
>> >> >> http://mailman.modpython.org/mailman/listinfo/mod_python
>> >> >>
>> >> >
>> >>
>> >>
>> >
>>
>>
>


From graham.dumpleton at gmail.com  Wed Jun 20 20:01:30 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Wed Jun 20 20:01:37 2007
Subject: [mod_python] [SPAM] please recompile it with -DEAPI..
In-Reply-To: <184E335D-02AC-4882-867A-E6F497D36EC0@avepublishing.com>
References: <84ABC318-3EA7-498E-AD1D-ECD40733312C@avepublishing.com>
	<88e286470706181511r459c8f3el2c20c84ffe45939e@mail.gmail.com>
	<184E335D-02AC-4882-867A-E6F497D36EC0@avepublishing.com>
Message-ID: <88e286470706201701u29c4ed80rb2bbdeb55b0c251a@mail.gmail.com>

On 21/06/07, mario curiel <mario@avepublishing.com> wrote:
> Graham
>
> thanks,
>
> I am looking for a way to access via web pages page, databases via
> python
> I will check for those software, and update one of the machines with
> apache (but it doesnt seem easy in mac)

As long as you use Apache 2.0 or 2.2 and mod_python 3.3.1 compilation
and installation should be quite straight forward. The only problems
people generally have with the Mac are when they have installed
additional versions of Python and aren't using the default version
supplied with the OS. From what I understand though the MacPython
prebuilt binaries are quite good these days and don't cause problems
with the existing Python installation. If unsure, just use the OS
supplied Python 2.3.5 to start with.

Graham

> On 18/06/2007, at 05:11 PM, Graham Dumpleton wrote:
>
> > Even if you get past the -DEAPI issue with mod_python 2.7.X with
> > Apache 1.3 on Mac OS X there are other problems in that old version of
> > mod_python that will cause it to crash on Mac OS X, especially when
> > performing an Apache restart.
> >
> > I would strongly recommend against using mod_python 2.7.X and instead
> > install a newer version of Apache and use a newer version of
> > mod_python.
> >
> > If for some reason you really don't want to upgrade then you could dig
> > up patches to get it working from old mailing list posts, but as I
> > said, it wouldn't be my first choice although I will still point you
> > in the right direction if you want to do that.
> >
> > If your reason for wanting mod_python is to host a Python application
> > framework or application which supports WSGI, eg. Django, TurboGears,
> > MoinMoin, Trac etc, then I would instead suggest you give mod_wsgi
> > (www.modwsgi.org) a go. This will work straight out of the box with
> > Apache 1.3 on MacOS X.
> >
> > Since mod_wsgi exists and will work with your configuration, if you
> > don't want to upgrade to a newer version of Apache and are doing what
> > you want because you want to learn about web programming in Python,
> > you might be better off looking at WSGI based frameworks rather than
> > mod_python. With WSGI there are standalone Python web servers as well
> > as mod_wsgi, so your choices are greater.
> >
> > Graham
> >
> > On 19/06/07, mario curiel <mario@avepublishing.com> wrote:
> >>
> >>
> >> Hello, on another machine I have
> >> MAC OSX server 10.4.9,
> >> PPC,
> >> Server version: Apache/1.3.33 (Darwin)
> >> mod_python-2.7.11
> >>
> >>
> >> like the server admin only uses apache 1.3.33, (pre-installeted)
> >> then I
> >> installed mod_python-2.7.11
> >>
> >> then error in httpd  is:
> >> [Mon Jun 18 10:43:02 2007] [warn] Loaded DSO
> >> /usr/libexec/httpd/mod_python.so uses plain Apache 1.3 API,
> >> this module might crash under EAPI! (please recompile it with -DEAPI)
> >>
> >> any idea how to recompile it with -DEAPI?
> >> which program has to be recompiled with -deapi ? the httpd or the
> >> program
> >> mod_python ?
> >>
> >> thanks a lot
> >>
> >> Alberto
> >>
> >>
> >> root# httpd
> >> [Mon Jun 18 10:46:59 2007] [warn] Loaded DSO
> >> /usr/libexec/httpd/mod_python.so uses plain Apache 1.3 API,
> >> this module might crash under EAPI! (please recompile it with -DEAPI)
> >> Processing config directory: /etc/httpd/sites/*.conf
> >>  Processing config file:
> >> /etc/httpd/sites/0000_10.129.0.37_80_www.NN.com.conf
> >>  Processing config file:
> >> /etc/httpd/sites/0004_10.129.0.37_80_www.YY.com.mx.conf
> >>  Processing config file:
> >> /etc/httpd/sites/virtual_host_global.conf
> >>
> >> root# CFLAGS="-DEAPI" ./configure --with-apxs=/usr/sbin/apxs
> >> loading cache ./config.cache
> >> checking for gcc... (cached) gcc
> >> checking whether the C compiler (gcc -DEAPI ) works... yes
> >> checking whether the C compiler (gcc -DEAPI ) is a cross-
> >> compiler... no
> >> checking whether we are using GNU C... (cached) yes
> >> checking whether gcc accepts -g... (cached) yes
> >> checking for ranlib... (cached) ranlib
> >> checking for ar... (cached) ar
> >> checking for a BSD compatible install... (cached) /usr/bin/install -c
> >> checking whether make sets ${MAKE}... (cached) yes
> >> checking for main in -lm... (cached) yes
> >> checking for working const... (cached) yes
> >> checking your blood pressure... a bit high, but we can proceed
> >> checking whether apxs is available
> >> checking for --with-apxs... /usr/sbin/apxs executable, good
> >> checking for Apache libexec directory... /usr/libexec/httpd
> >> checking for Apache include directory... -I/usr/include/httpd
> >> checking for --with-apache... no
> >> configure: warning: **** No apache sources specified, static
> >> compilation
> >> will not be available.
> >> configure: warning: **** You can use --with-apache to specify
> >> where your
> >> Apache sources are.
> >> checking for --with-python... no
> >> checking for python... (cached)
> >> /Library/Frameworks/Python.framework/Versions/Current/bin/python
> >> checking Python version... 2.5
> >> checking whether Python is compiled with thread support... no
> >> threads, good
> >> checking Python install prefix...
> >> /Library/Frameworks/Python.framework/Versions/2.5
> >> checking what libraries Python was linked with...
> >> /Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/
> >> config/libpython2.5.a
> >>   -ldl
> >> checking linker flags used to link Python...
> >> checking where Python include files are...
> >> -I/Library/Frameworks/Python.framework/Versions/2.5/include/python2.5
> >> checking for mkdep... (cached) /usr/bin/mkdep
> >> creating ./config.status
> >> creating Makefile
> >> creating src/Makefile
> >> creating src/libpython.module
> >> creating Doc/Makefile
> >> analyzing dependencies
> >>
> >>
> >> root# make CFLAGS=-deapi
> >>
> >>  root# make install
> >>
> >> Performing DSO installation.
> >>
> >> /usr/bin/install -c src/mod_python.so /usr/libexec/httpd
> >> /usr/bin/install -c -d
> >> /Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/
> >> site-packages/mod_python
> >> python
> >> /Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/
> >> compileall.py
> >> /Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/
> >> site-packages/mod_python
> >> Listing
> >> /Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/
> >> site-packages/mod_python
> >> ...
> >> Compiling
> >> /Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/
> >> site-packages/mod_python/__init__.py
> >> ...
> >> Compiling
> >> /Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/
> >> site-packages/mod_python/apache.py
> >> ...
> >> Compiling
> >> /Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/
> >> site-packages/mod_python/cgihandler.py
> >> ...
> >> Compiling
> >> /Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/
> >> site-packages/mod_python/httpdapi.py
> >> ...
> >> Compiling
> >> /Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/
> >> site-packages/mod_python/publisher.py
> >> ...
> >> Compiling
> >> /Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/
> >> site-packages/mod_python/util.py
> >> ...
> >> Compiling
> >> /Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/
> >> site-packages/mod_python/zhandler.py
> >> ...
> >>
> >> Now don't forget to edit your main config and add
> >>     LoadModule python_module
> >> /usr/libexec/httpd/mod_python.so
> >> and if your configuration uses ClearModuleList, then also
> >>     AddModule mod_python.c
> >>
> >> root#httpd
> >> [Mon Jun 18 10:52:46 2007] [warn] Loaded DSO
> >> /usr/libexec/httpd/mod_python.so uses plain Apache 1.3 API,
> >> this module might crash under EAPI! (please recompile it with -DEAPI)
> >> Processing config directory: /etc/httpd/sites/*.conf
> >>  Processing config file:
> >> /etc/httpd/sites/0000_10.129.0.37_80_www.NN.com.conf
> >>  Processing config file:
> >> /etc/httpd/sites/0004_10.129.0.37_80_www.YY.com.mx.conf
> >>  Processing config file:
> >> /etc/httpd/sites/virtual_host_global.conf
> >>
> >>
> >>  root# httpd -V
> >> Server version: Apache/1.3.33 (Darwin)
> >> Server built:   Mar 20 2005 15:08:27
> >> Server's Module Magic Number: 19990320:16
> >> Server compiled with....
> >>  -D EAPI
> >>  -D HAVE_MMAP
> >>  -D USE_MMAP_SCOREBOARD
> >>  -D USE_MMAP_FILES
> >>  -D HAVE_FCNTL_SERIALIZED_ACCEPT
> >>  -D HAVE_FLOCK_SERIALIZED_ACCEPT
> >>  -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT
> >>  -D DYNAMIC_MODULE_LIMIT=64
> >>  -D HARD_SERVER_LIMIT=2048
> >>  -D HTTPD_ROOT="/usr"
> >>  -D SUEXEC_BIN="/usr/sbin/suexec"
> >>  -D DEFAULT_PIDLOG="/var/run/httpd.pid"
> >>  -D DEFAULT_SCOREBOARD="/var/run/httpd.scoreboard"
> >>  -D DEFAULT_LOCKFILE="/var/run/httpd.lock"
> >>  -D DEFAULT_ERRORLOG="/var/log/httpd/error_log"
> >>  -D TYPES_CONFIG_FILE="/etc/httpd/mime.types"
> >>  -D SERVER_CONFIG_FILE="/etc/httpd/httpd.conf"
> >>  -D ACCESS_CONFIG_FILE="/etc/httpd/access.conf"
> >>  -D RESOURCE_CONFIG_FILE="/etc/httpd/srm.conf"
> >>
> >>
> >>
> >> _______________________________________________
> >> Mod_python mailing list
> >> Mod_python@modpython.org
> >> http://mailman.modpython.org/mailman/listinfo/mod_python
> >>
> >>
> >
>
>
From graham.dumpleton at gmail.com  Wed Jun 20 20:02:46 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Wed Jun 20 20:02:53 2007
Subject: [mod_python] [SPAM] mod_python.so is so garbled
In-Reply-To: <6E584857-821A-498F-871B-2EB878B50969@avepublishing.com>
References: <996BCD81-9551-4F64-81D8-1BDD470BBDE4@avepublishing.com>
	<88e286470706172216w5dce0a7au46195c1445ae6480@mail.gmail.com>
	<0A3A38CF-EE26-4FCE-A051-8AD3E21A528E@avepublishing.com>
	<88e286470706172234v1e7aed10jc5d80678fc116eec@mail.gmail.com>
	<D4963AB2-12C5-4137-8BBD-24F4A6A181B3@avepublishing.com>
	<88e286470706181520w42000882x8fdf407ee3a1886b@mail.gmail.com>
	<6E584857-821A-498F-871B-2EB878B50969@avepublishing.com>
Message-ID: <88e286470706201702n492b074dmae032e92b361c0e9@mail.gmail.com>

On 21/06/07, mario curiel <mario@avepublishing.com> wrote:
> Hi,
>
> I found that the package that I downloaded from serverlogistics was
> for PPC and not for Intel,
> As it was so mixed in the mac, I   formatted the disk , reinstalled
> the OS and I am starting to install the apache2,
> now I have to find how to tell the machine to use the apache2 and not
> the apache1.3 preinstalled, but maybe it is another post.

Use the --with-apxs option:

  ./configure --with-apxs=/some/path/apache2/bin/apxs

Graham

> On 18/06/2007, at 05:20 PM, Graham Dumpleton wrote:
>
> > Lets try something else then. Run 'file' on your mod_python.so and
> > httpd executable.
> >
> > kundalini:~ grahamd$ file /usr/local/apache-2.0/modules/mod_python.so
> > /usr/local/apache-2.0/modules/mod_python.so: Mach-O bundle ppc
> > kundalini:~ grahamd$ file /usr/local/apache-2.0/bin/httpd
> > /usr/local/apache-2.0/bin/httpd: Mach-O executable ppc
> >
> > Being on an Intel Mac, want to make sure that both are actually Intel
> > binaries and you aren't somehow using an PPC Apache in emulation with
> > a Intel mod_python.so or something similar.
> >
> > Also run 'otool' on each:
> >
> > kundalini:~ grahamd$ otool -L /usr/local/apache-2.0/modules/
> > mod_python.so
> > /usr/local/apache-2.0/modules/mod_python.so:
> >        /usr/lib/libSystem.B.dylib (compatibility version 1.0.0,
> > current version 88.1.6)
> >        /System/Library/Frameworks/Python.framework/Versions/2.3/Python
> > (compatibility version 2.3.0, current version 2.3.5)
> >        /System/Library/Frameworks/CoreServices.framework/Versions/A/
> > CoreServices
> > (compatibility version 1.0.0, current version 18.0.0)
> >        /System/Library/Frameworks/Foundation.framework/Versions/C/
> > Foundation
> > (compatibility version 300.0.0, current version 567.27.0)
> > kundalini:~ grahamd$ otool -L /usr/local/apache-2.0/bin/httpd
> > /usr/local/apache-2.0/bin/httpd:
> >        /usr/local/apache-2.0/lib/libaprutil-0.0.dylib (compatibility
> > version 10.0.0, current version 10.12.0)
> >        /usr/local/apache-2.0/lib/libexpat.0.dylib (compatibility
> > version 2.0.0, current version 2.0.0)
> >        /usr/lib/libiconv.2.dylib (compatibility version 5.0.0,
> > current version 5.0.0)
> >        /usr/local/apache-2.0/lib/libapr-0.0.dylib (compatibility
> > version 10.0.0, current version 10.12.0)
> >        /usr/lib/libresolv.9.dylib (compatibility version 1.0.0,
> > current version 369.5.0)
> >        /usr/lib/libSystem.B.dylib (compatibility version 1.0.0,
> > current version 88.1.6)
> >
> > Even doing a 'ls -las' with each may help.
> >
> > kundalini:~ grahamd$ ls -las /usr/local/apache-2.0/modules/
> > mod_python.so
> > 808 -rwxr-xr-x   1 grahamd  grahamd  410220 Nov 10  2006
> > /usr/local/apache-2.0/modules/mod_python.so
> > kundalini:~ grahamd$ ls -las /usr/local/apache-2.0/bin/httpd
> > 3200 -rwxr-xr-x   1 grahamd  grahamd  1636540 Jul 31  2006
> > /usr/local/apache-2.0/bin/httpd
> >
> > Post the results you get.
> >
> > Graham
> >
> > On 19/06/07, mario curiel <mario@avepublishing.com> wrote:
> >> Hello,
> >>
> >> thanks, I run the strings line  but there is no AP22, or AP2 line,
> >> does it mean something?
> >> > AP_CONN_UNKNOWN
> >> > AP_CONN_CLOSE
> >> > AP_CONN_KEEPALIVE
> >> > APR_NOFILE
> >> > APR_REG
> >> > APR_DIR
> >> > APR_CHR
> >> > APR_BLK
> >> > APR_PIPE
> >> > APR_LNK
> >> > APR_SOCK
> >> > APR_UNKFILE
> >>
> >> thanks a lot
> >>
> >> Alberto
> >>
> >>
> >> On 18/06/2007, at 12:34 AM, Graham Dumpleton wrote:
> >>
> >> > On 18/06/07, mario curiel <mario@avepublishing.com> wrote:
> >> >> sorry, it was my mistake when I was writing this mail,
> >> >> the line 54 in the httpd.conf file is:
> >> >>
> >> >> LoadModule python_module /System/Library/Apache2/Modules/
> >> >> mod_python.so
> >> >>
> >> >> and not
> >> >> >> LoadModule python-module /System/Library/Apache2/Modules/
> >> >> >> mod_python.so
> >> >>
> >> >>
> >> >> ok, thanks,  I removed the line: AddModule mod_python.c
> >> >>
> >> >> but the error continues, when I enter httpd, of apachectl
> >> >
> >> > The other reason this error can occur is that the mod_python.so you
> >> > are using wasn't actually compiled for the version of Apache you
> >> are
> >> > trying to run it with. Check your compilation output to make
> >> sure the
> >> > -I flags are getting headers file from correct location for that
> >> > version of Apache and that the header files in that location are in
> >> > fact for that Apache binary version. Also check that where the
> >> > mod_python.so file gets installed is where you are picking it up
> >> from
> >> > with configuration you are using.
> >> >
> >> > You can run:
> >> >
> >> > strings /usr/local/apache-2.2/modules/mod_python.so | grep AP
> >> >
> >> > on the mod_python.so that Apache is loading and you should get
> >> > something like:
> >> >
> >> > AP_CONN_UNKNOWN
> >> > AP_CONN_CLOSE
> >> > AP_CONN_KEEPALIVE
> >> > APR_NOFILE
> >> > APR_REG
> >> > APR_DIR
> >> > APR_CHR
> >> > APR_BLK
> >> > APR_PIPE
> >> > APR_LNK
> >> > APR_SOCK
> >> > APR_UNKFILE
> >> > AP22
> >> >
> >> > That last line says mine was compiled for Apache 2.2. If it said
> >> AP20
> >> > then would have been compiled for Apache 2.0 instead.
> >> >
> >> >> >> Syntax error on line 54 of /Local/Library/Webserver/
> >> Configuration/
> >> >> >> httpd.conf: API module structure ?python_module? in file /
> >> System/
> >> >> >> Library/Apache/Modules/mod_python.so is so garbled - perhaps
> >> >> this is
> >> >> >> not an Apache module DSO?
> >> >>
> >> >> any idea?
> >> >>
> >> >> thanks a lot
> >> >>
> >> >> Alberto
> >> >>
> >> >>
> >> >> On 18/06/2007, at 12:16 AM, Graham Dumpleton wrote:
> >> >>
> >> >> > See comments below.
> >> >> >
> >> >> > On 18/06/07, mario curiel <mario@avepublishing.com> wrote:
> >> >> >> I got the error in apachectl -k start:
> >> >> >>
> >> >> >> httpd: Syntax error on line 54 of /Local/Library/Webserver/
> >> >> >> Configuration/httpd.conf: API module structure ?python_module
> >> ? in
> >> >> >> file /System/Library/Apache/Modules/mod_python.so is so
> >> garbled -
> >> >> >> perhaps this is not an Apache module DSO?
> >> >> >>
> >> >> >> In the computer has Mac OSX 10.4.9,
> >> >> >> MAC Pro with intel processors,
> >> >> >> python 2.5.1
> >> >> >> apache sever 2.2.4 (unix)
> >> >> >>
> >> >> >> a)installation of mod_python-3.3.1:
> >> >> >>
> >> >> >> -configure --with-apxs=/Library/Apache2/bin/apxs --with-fex=/
> >> >> usr/bin/
> >> >> >> flex
> >> >> >> make
> >> >> >> make install
> >> >> >>
> >> >> >>
> >> >> >> also I tried with
> >> >> >>
> >> >> >> b)
> >> >> >> make install_dso
> >> >> >> make install_py_lib
> >> >> >>
> >> >> >> in both cases (a and b) the last line of the install is the
> >> >> >> installation of the mod_python-3-3.1/py2.5.egg-info:
> >> >> >> writing /Library/Frameworks/Python.framework/verons/2.5/lib/
> >> >> >> python2.5/
> >> >> >> site-packages/mod_python-3-3.1/py2.5.egg-info
> >> >> >>
> >> >> >>
> >> >> >> I added the lines to the httpd.conf:
> >> >> >> the lines 54-56 :
> >> >> >>
> >> >> >> LoadModule python-module /System/Library/Apache2/Modules/
> >> >> >> mod_python.so
> >> >> >
> >> >> > This line is wrong. Should be 'python_module' not 'python-
> >> module'.
> >> >> >
> >> >> >> AddModule mod_python.c
> >> >> >
> >> >> > This line is not needed with Apache 2.
> >> >> >
> >> >> >> then I run apachectl -k start and the error appears:
> >> >> >>
> >> >> >> Syntax error on line 54 of /Local/Library/Webserver/
> >> Configuration/
> >> >> >> httpd.conf: API module structure ?python_module? in file /
> >> System/
> >> >> >> Library/Apache/Modules/mod_python.so is so garbled - perhaps
> >> >> this is
> >> >> >> not an Apache module DSO?
> >> >> >>
> >> >> >>
> >> >> >> how to correct it?
> >> >> >>
> >> >> >> thanks a lot
> >> >> >>
> >> >> >> Alberto
> >> >> >> _______________________________________________
> >> >> >> Mod_python mailing list
> >> >> >> Mod_python@modpython.org
> >> >> >> http://mailman.modpython.org/mailman/listinfo/mod_python
> >> >> >>
> >> >> >
> >> >>
> >> >>
> >> >
> >>
> >>
> >
>
>

From graham.dumpleton at gmail.com  Thu Jun 21 19:03:12 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu Jun 21 19:03:20 2007
Subject: [mod_python] psp import issue
In-Reply-To: <227f6fed0706211552h4b3e3b6ew3c74c2fde506a193@mail.gmail.com>
References: <227f6fed0706191519s2ca6ab82s9050032e373a8222@mail.gmail.com>
	<88e286470706191631i4e5e9af0vcd1b78eebc89df74@mail.gmail.com>
	<227f6fed0706211552h4b3e3b6ew3c74c2fde506a193@mail.gmail.com>
Message-ID: <88e286470706211603u60d53198ifb0775fb8357b8e6@mail.gmail.com>

On 22/06/07, maker joe <makerjoe@gmail.com> wrote:
> hi graham
> how insecure is the following code
>
> exec "from %s import * " % 'test'
>
> if this is insecure what would be a secure alternative to get imported
> vars/funcs at local namespace?

In this case 'test' is a literal string. If it wasn't a literal string
but somehow derived from user input it would be very dangerous.

Anyway, you don't need to do that. Use:

  module = apache.import_module(module_name)

and then reference via module rather than trying to do import '*' into
local namespace.

See documentation for import_module() in:

  http://www.modpython.org/live/current/doc-html/pyapi-apmeth.html

BTW, never call modules 'test' as Python provides a standard module
called that and thus you can get yourself in a knot when it somehow
picks up the standard one and not yours.

Graham

> thank you
> joseluis
>
> On 6/19/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> > Issue noted at:
> >
> >   https://issues.apache.org/jira/browse/MODPYTHON-220
> >
> > You should be able to use:
> >
> >   somemodule = apache.import_module("somemodule")
> >
> > instead.
> >
> > Graham
> >
> > On 20/06/07, maker joe <makerjoe@gmail.com> wrote:
> > > hi
> > > how can i import a module from the current directory on a psp file
> > > eg
> > > test.psp
> > > <%
> > > import somemodule
> > > %>
> > > somemodule.py is at the same directory as test.psp
> > >
> > > the same works importing from a file.py
> > > im using publisher and psp hanlers
> > > python 2.5 modputhon 3.31
> > >
> > > thanks
> > > joseluis
> > > _______________________________________________
> > > Mod_python mailing list
> > > Mod_python@modpython.org
> > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > >
> >
>
From graham.dumpleton at gmail.com  Thu Jun 21 20:03:28 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu Jun 21 20:03:34 2007
Subject: [mod_python] psp import issue
In-Reply-To: <227f6fed0706211646j12d81e13m583c96550bc20dcd@mail.gmail.com>
References: <227f6fed0706191519s2ca6ab82s9050032e373a8222@mail.gmail.com>
	<88e286470706191631i4e5e9af0vcd1b78eebc89df74@mail.gmail.com>
	<227f6fed0706211552h4b3e3b6ew3c74c2fde506a193@mail.gmail.com>
	<88e286470706211603u60d53198ifb0775fb8357b8e6@mail.gmail.com>
	<227f6fed0706211646j12d81e13m583c96550bc20dcd@mail.gmail.com>
Message-ID: <88e286470706211703i1bc3701nc10597fb9b081121@mail.gmail.com>

On 22/06/07, maker joe <makerjoe@gmail.com> wrote:
> many thanks for your suggestions
> but let me explain myself more carefully
>
> you said:
> and then reference via module rather than trying to do import '*' into
> local namespace
>
> how can i avoid using the reference via module and have
> module.vars/defs as local varsdefs as if i use "from module import * ?

All your problems will be solved when the bug I referenced in the
first place is fixed. Ie., you will be able to use 'from module import
*' for a module in the same directory as your PSP page.

If you can't wait that long, do not put your modules in the same
directory as your .psp files, put them in a directory which is outside
of your document tree. Then use PythonPath directive to add that
external directory to the standard module search path. By doing that
the mod_python module importer will be skipped and 'from module import
*' will work for you.

Note, do not add the document directory itself to PythonPath as you
shouldn't overlap mod_python module path and standard Python module
path.

Also note though that by putting them in a directory outside of the
document tree and thereby using the standard Python module importer,
those modules will not be candidates for automatic module reloading.
Thus, whenever you make a change to them, you will need to restart
Apache for the change to be picked up.

The only other hack I can suggest is to do something like:

  module = apache.import_module(module_name)
  globals().update(module.__dict__)

Graham

> On 6/21/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> > On 22/06/07, maker joe <makerjoe@gmail.com> wrote:
> > > hi graham
> > > how insecure is the following code
> > >
> > > exec "from %s import * " % 'test'
> > >
> > > if this is insecure what would be a secure alternative to get imported
> > > vars/funcs at local namespace?
> >
> > In this case 'test' is a literal string. If it wasn't a literal string
> > but somehow derived from user input it would be very dangerous.
> >
> > Anyway, you don't need to do that. Use:
> >
> >   module = apache.import_module(module_name)
> >
> > and then reference via module rather than trying to do import '*' into
> > local namespace.
> >
> > See documentation for import_module() in:
> >
> >   http://www.modpython.org/live/current/doc-html/pyapi-apmeth.html
> >
> > BTW, never call modules 'test' as Python provides a standard module
> > called that and thus you can get yourself in a knot when it somehow
> > picks up the standard one and not yours.
> >
> > Graham
> >
> > > thank you
> > > joseluis
> > >
> > > On 6/19/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> > > > Issue noted at:
> > > >
> > > >   https://issues.apache.org/jira/browse/MODPYTHON-220
> > > >
> > > > You should be able to use:
> > > >
> > > >   somemodule = apache.import_module("somemodule")
> > > >
> > > > instead.
> > > >
> > > > Graham
> > > >
> > > > On 20/06/07, maker joe <makerjoe@gmail.com> wrote:
> > > > > hi
> > > > > how can i import a module from the current directory on a psp file
> > > > > eg
> > > > > test.psp
> > > > > <%
> > > > > import somemodule
> > > > > %>
> > > > > somemodule.py is at the same directory as test.psp
> > > > >
> > > > > the same works importing from a file.py
> > > > > im using publisher and psp hanlers
> > > > > python 2.5 modputhon 3.31
> > > > >
> > > > > thanks
> > > > > joseluis
> > > > > _______________________________________________
> > > > > Mod_python mailing list
> > > > > Mod_python@modpython.org
> > > > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > > > >
> > > >
> > >
> >
>
From graham.dumpleton at gmail.com  Thu Jun 21 20:45:53 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu Jun 21 20:45:59 2007
Subject: [mod_python] psp import issue
In-Reply-To: <227f6fed0706211729m7583e6e7y56f7db63e7cba058@mail.gmail.com>
References: <227f6fed0706191519s2ca6ab82s9050032e373a8222@mail.gmail.com>
	<88e286470706191631i4e5e9af0vcd1b78eebc89df74@mail.gmail.com>
	<227f6fed0706211552h4b3e3b6ew3c74c2fde506a193@mail.gmail.com>
	<88e286470706211603u60d53198ifb0775fb8357b8e6@mail.gmail.com>
	<227f6fed0706211646j12d81e13m583c96550bc20dcd@mail.gmail.com>
	<88e286470706211703i1bc3701nc10597fb9b081121@mail.gmail.com>
	<227f6fed0706211729m7583e6e7y56f7db63e7cba058@mail.gmail.com>
Message-ID: <88e286470706211745g59cea45cj67edc99dc26139e3@mail.gmail.com>

On 22/06/07, maker joe <makerjoe@gmail.com> wrote:
> great!!!!! your suggeted hack worked

There is also now a patch attached to:

  https://issues.apache.org/jira/browse/MODPYTHON-220

which fixes the problem in mod_python if you want to apply it. Look at
man page for 'patch' program if you don't know how to do this.

> btw
> do you know how to setup publisher/psp to replace:
>
> req.write('something') by print 'something'  eg (sys.stdout=rec)

Use:

  print >> req, "something"

To be able to say just:

  print "something"

needs more elaborate techniques. The web.py package allows this but it
requires special thread keyed version of sys.stdout.

> and
> req.form['varx']  by _varx

Don't recommend pushing form fields in local name space as doesn't
make it as obvious that it is a form field and there would be a
tendency not to perform checks to make sure the field you are looking
for actually exists. Also, it will all possibly blow up if someone
supplied a field you weren't expecting which replaced some important
data or clashed with a keyword.

If you really must do something like that though, you might adapt the
following code from mod_python.util.apply_fs_data(). Replace 'fs' with
req.form and replace args with locals().

    # add form data to args
    for field in fs.list:
        if field.filename:
            val = field
        else:
            val = field.value
        args.setdefault(field.name, []).append(val)

    # replace lists with single values
    for arg in args:
        if ((type(args[arg]) is ListType) and
            (len(args[arg]) == 1)):
            args[arg] = args[arg][0]

> like in karrigell

Having too much magic is not always good. Karrigell severely limits
its deployment options because of how it is implemented. Not as bad as
Karrigell, but web.py also pays for allowing 'print' to work to
generate response content in that it can cause conflicts when multiple
applications are being hosted. You can see a bit of discussion about
the problems these packages have when used with Apache at:

  http://code.google.com/p/modwsgi/wiki/IntegrationWithKarrigell
  http://code.google.com/p/modwsgi/wiki/IntegrationWithWebPy

This documents are about mod_wsgi, but similar issues exist if
mod_python were being used.

PS. Can you use reply-all so messages go back to list.

Graham

> cheers
>
>
> On 6/21/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> > On 22/06/07, maker joe <makerjoe@gmail.com> wrote:
> > > many thanks for your suggestions
> > > but let me explain myself more carefully
> > >
> > > you said:
> > > and then reference via module rather than trying to do import '*' into
> > > local namespace
> > >
> > > how can i avoid using the reference via module and have
> > > module.vars/defs as local varsdefs as if i use "from module import * ?
> >
> > All your problems will be solved when the bug I referenced in the
> > first place is fixed. Ie., you will be able to use 'from module import
> > *' for a module in the same directory as your PSP page.
> >
> > If you can't wait that long, do not put your modules in the same
> > directory as your .psp files, put them in a directory which is outside
> > of your document tree. Then use PythonPath directive to add that
> > external directory to the standard module search path. By doing that
> > the mod_python module importer will be skipped and 'from module import
> > *' will work for you.
> >
> > Note, do not add the document directory itself to PythonPath as you
> > shouldn't overlap mod_python module path and standard Python module
> > path.
> >
> > Also note though that by putting them in a directory outside of the
> > document tree and thereby using the standard Python module importer,
> > those modules will not be candidates for automatic module reloading.
> > Thus, whenever you make a change to them, you will need to restart
> > Apache for the change to be picked up.
> >
> > The only other hack I can suggest is to do something like:
> >
> >  module = apache.import_module(module_name)
> >  globals().update(module.__dict__)
> >
> > Graham
> >
> > > On 6/21/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> > > > On 22/06/07, maker joe <makerjoe@gmail.com> wrote:
> > > > > hi graham
> > > > > how insecure is the following code
> > > > >
> > > > > exec "from %s import * " % 'test'
> > > > >
> > > > > if this is insecure what would be a secure alternative to get imported
> > > > > vars/funcs at local namespace?
> > > >
> > > > In this case 'test' is a literal string. If it wasn't a literal string
> > > > but somehow derived from user input it would be very dangerous.
> > > >
> > > > Anyway, you don't need to do that. Use:
> > > >
> > > >   module = apache.import_module(module_name)
> > > >
> > > > and then reference via module rather than trying to do import '*' into
> > > > local namespace.
> > > >
> > > > See documentation for import_module() in:
> > > >
> > > >   http://www.modpython.org/live/current/doc-html/pyapi-apmeth.html
> > > >
> > > > BTW, never call modules 'test' as Python provides a standard module
> > > > called that and thus you can get yourself in a knot when it somehow
> > > > picks up the standard one and not yours.
> > > >
> > > > Graham
> > > >
> > > > > thank you
> > > > > joseluis
> > > > >
> > > > > On 6/19/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> > > > > > Issue noted at:
> > > > > >
> > > > > >   https://issues.apache.org/jira/browse/MODPYTHON-220
> > > > > >
> > > > > > You should be able to use:
> > > > > >
> > > > > >   somemodule = apache.import_module("somemodule")
> > > > > >
> > > > > > instead.
> > > > > >
> > > > > > Graham
> > > > > >
> > > > > > On 20/06/07, maker joe <makerjoe@gmail.com> wrote:
> > > > > > > hi
> > > > > > > how can i import a module from the current directory on a psp file
> > > > > > > eg
> > > > > > > test.psp
> > > > > > > <%
> > > > > > > import somemodule
> > > > > > > %>
> > > > > > > somemodule.py is at the same directory as test.psp
> > > > > > >
> > > > > > > the same works importing from a file.py
> > > > > > > im using publisher and psp hanlers
> > > > > > > python 2.5 modputhon 3.31
> > > > > > >
> > > > > > > thanks
> > > > > > > joseluis
> > > > > > > _______________________________________________
> > > > > > > Mod_python mailing list
> > > > > > > Mod_python@modpython.org
> > > > > > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > > > > > >
> > > > > >
> > > > >
> > > >
> > >
> >
>
From graham.dumpleton at gmail.com  Thu Jun 21 20:57:23 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu Jun 21 20:57:29 2007
Subject: [mod_python] psp import issue
In-Reply-To: <88e286470706211745g59cea45cj67edc99dc26139e3@mail.gmail.com>
References: <227f6fed0706191519s2ca6ab82s9050032e373a8222@mail.gmail.com>
	<88e286470706191631i4e5e9af0vcd1b78eebc89df74@mail.gmail.com>
	<227f6fed0706211552h4b3e3b6ew3c74c2fde506a193@mail.gmail.com>
	<88e286470706211603u60d53198ifb0775fb8357b8e6@mail.gmail.com>
	<227f6fed0706211646j12d81e13m583c96550bc20dcd@mail.gmail.com>
	<88e286470706211703i1bc3701nc10597fb9b081121@mail.gmail.com>
	<227f6fed0706211729m7583e6e7y56f7db63e7cba058@mail.gmail.com>
	<88e286470706211745g59cea45cj67edc99dc26139e3@mail.gmail.com>
Message-ID: <88e286470706211757i1e067430jdb23b6a1f35d3bee@mail.gmail.com>

On 22/06/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> > and
> > req.form['varx']  by _varx
>
> Don't recommend pushing form fields in local name space as doesn't
> make it as obvious that it is a form field and there would be a
> tendency not to perform checks to make sure the field you are looking
> for actually exists. Also, it will all possibly blow up if someone
> supplied a field you weren't expecting which replaced some important
> data or clashed with a keyword.
>
> If you really must do something like that though, you might adapt the
> following code from mod_python.util.apply_fs_data(). Replace 'fs' with
> req.form and replace args with locals().
>
>     # add form data to args
>     for field in fs.list:
>         if field.filename:
>             val = field
>         else:
>             val = field.value
>         args.setdefault(field.name, []).append(val)
>
>     # replace lists with single values
>     for arg in args:
>         if ((type(args[arg]) is ListType) and
>             (len(args[arg]) == 1)):
>             args[arg] = args[arg][0]

BTW, if using publisher, a quicker way of doing this would be:

  def func(req, arg1, args, **args):
    locals().update(args)
    ...

As I said though, this is dangerous as someone outside your web site
can directly modify data your function uses to execute or cause your
handler to crash in bad ways.

For example, with publisher function:

  def index(req, **args):
    locals().update(args)
    req.content_type = 'text/plain'
    return 'mod_python.publisher', req.filename

If URL of:

  http://localhost:8002/~grahamd/publisher/index.py?req=xxx

is used, I get an error saying:

  AttributeError: 'mp_request' object has no attribute 'append'

This is because I was able to replace the request object argument with
another value.

Same problem will occur if using the longer example I showed before.

Hopefully you will now be convinced this is a bad bad idea.

Graham
From makerjoe at gmail.com  Thu Jun 21 20:58:43 2007
From: makerjoe at gmail.com (maker joe)
Date: Thu Jun 21 20:58:50 2007
Subject: [mod_python] get post to a class
Message-ID: <227f6fed0706211758m6b56e767j983b7caf589d4859@mail.gmail.com>

hi graham

is it possible to get/post to a class?

my.py
---------
class A:
    def go(self,req):
         req.write('hello'+%s)%name

http://localhost/my.py/A/go?name=joe

joseluis
From graham.dumpleton at gmail.com  Thu Jun 21 21:10:06 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu Jun 21 21:10:12 2007
Subject: [mod_python] get post to a class
In-Reply-To: <227f6fed0706211758m6b56e767j983b7caf589d4859@mail.gmail.com>
References: <227f6fed0706211758m6b56e767j983b7caf589d4859@mail.gmail.com>
Message-ID: <88e286470706211810k2009cacg6b67ee7f5a3f5ae4@mail.gmail.com>

On 22/06/07, maker joe <makerjoe@gmail.com> wrote:
> hi graham
>
> is it possible to get/post to a class?
>
> my.py
> ---------
> class A:
>     def go(self,req):
>          req.write('hello'+%s)%name
>
> http://localhost/my.py/A/go?name=joe

Classes will not auto instantiate.

If your intention is to be able to create an instance of A per
request, use something like:

  class Instance:

    def __init__(self, type, **kwargs):
        self.__type = type
        self.__kwargs = kwargs

    def __call__(self, **args):
        assert(type(self.__type) in [types.ClassType, types.TypeType])
        return self.__type(**self.__kwargs)(**args)

    class A:
        def __call__(self, req):
            req.write('hello'+%s)%name

    go = Instance(A)

URL would then be:

   http://localhost/my.py/go?name=joe

If the class has a constructor, use keyword arguments to Instance() to
pass any arguments:

    class A:
        def __init__(self, arg1, arg2):
            ...
        def __call__(self, req):
            req.write('hello'+%s)%name

    go = Instance(A, arg1='value', arg2='value')

This presumes you are using publisher.

Graham
From makerjoe at gmail.com  Thu Jun 21 21:19:13 2007
From: makerjoe at gmail.com (maker joe)
Date: Thu Jun 21 21:19:18 2007
Subject: [mod_python] psp import issue
In-Reply-To: <88e286470706211757i1e067430jdb23b6a1f35d3bee@mail.gmail.com>
References: <227f6fed0706191519s2ca6ab82s9050032e373a8222@mail.gmail.com>
	<88e286470706191631i4e5e9af0vcd1b78eebc89df74@mail.gmail.com>
	<227f6fed0706211552h4b3e3b6ew3c74c2fde506a193@mail.gmail.com>
	<88e286470706211603u60d53198ifb0775fb8357b8e6@mail.gmail.com>
	<227f6fed0706211646j12d81e13m583c96550bc20dcd@mail.gmail.com>
	<88e286470706211703i1bc3701nc10597fb9b081121@mail.gmail.com>
	<227f6fed0706211729m7583e6e7y56f7db63e7cba058@mail.gmail.com>
	<88e286470706211745g59cea45cj67edc99dc26139e3@mail.gmail.com>
	<88e286470706211757i1e067430jdb23b6a1f35d3bee@mail.gmail.com>
Message-ID: <227f6fed0706211819k10f98a94qa4e80a5391033063@mail.gmail.com>

sure you convinced me

but why not ?
    for k in req.form:
        exec ("_"+k+"="+"req.form[k]")
        print k,_test
cheers


On 6/21/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> On 22/06/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> > > and
> > > req.form['varx']  by _varx
> >
> > Don't recommend pushing form fields in local name space as doesn't
> > make it as obvious that it is a form field and there would be a
> > tendency not to perform checks to make sure the field you are looking
> > for actually exists. Also, it will all possibly blow up if someone
> > supplied a field you weren't expecting which replaced some important
> > data or clashed with a keyword.
> >
> > If you really must do something like that though, you might adapt the
> > following code from mod_python.util.apply_fs_data(). Replace 'fs' with
> > req.form and replace args with locals().
> >
> >     # add form data to args
> >     for field in fs.list:
> >         if field.filename:
> >             val = field
> >         else:
> >             val = field.value
> >         args.setdefault(field.name, []).append(val)
> >
> >     # replace lists with single values
> >     for arg in args:
> >         if ((type(args[arg]) is ListType) and
> >             (len(args[arg]) == 1)):
> >             args[arg] = args[arg][0]
>
> BTW, if using publisher, a quicker way of doing this would be:
>
>   def func(req, arg1, args, **args):
>     locals().update(args)
>     ...
>
> As I said though, this is dangerous as someone outside your web site
> can directly modify data your function uses to execute or cause your
> handler to crash in bad ways.
>
> For example, with publisher function:
>
>   def index(req, **args):
>     locals().update(args)
>     req.content_type = 'text/plain'
>     return 'mod_python.publisher', req.filename
>
> If URL of:
>
>   http://localhost:8002/~grahamd/publisher/index.py?req=xxx
>
> is used, I get an error saying:
>
>   AttributeError: 'mp_request' object has no attribute 'append'
>
> This is because I was able to replace the request object argument with
> another value.
>
> Same problem will occur if using the longer example I showed before.
>
> Hopefully you will now be convinced this is a bad bad idea.
>
> Graham
>
From graham.dumpleton at gmail.com  Thu Jun 21 21:28:39 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu Jun 21 21:28:45 2007
Subject: [mod_python] psp import issue
In-Reply-To: <227f6fed0706211819k10f98a94qa4e80a5391033063@mail.gmail.com>
References: <227f6fed0706191519s2ca6ab82s9050032e373a8222@mail.gmail.com>
	<88e286470706191631i4e5e9af0vcd1b78eebc89df74@mail.gmail.com>
	<227f6fed0706211552h4b3e3b6ew3c74c2fde506a193@mail.gmail.com>
	<88e286470706211603u60d53198ifb0775fb8357b8e6@mail.gmail.com>
	<227f6fed0706211646j12d81e13m583c96550bc20dcd@mail.gmail.com>
	<88e286470706211703i1bc3701nc10597fb9b081121@mail.gmail.com>
	<227f6fed0706211729m7583e6e7y56f7db63e7cba058@mail.gmail.com>
	<88e286470706211745g59cea45cj67edc99dc26139e3@mail.gmail.com>
	<88e286470706211757i1e067430jdb23b6a1f35d3bee@mail.gmail.com>
	<227f6fed0706211819k10f98a94qa4e80a5391033063@mail.gmail.com>
Message-ID: <88e286470706211828p790325a3med8e7a6911e76819@mail.gmail.com>

On 22/06/07, maker joe <makerjoe@gmail.com> wrote:
> sure you convinced me
>
> but why not ?
>     for k in req.form:
>         exec ("_"+k+"="+"req.form[k]")
>         print k,_test

Using a prefix is one way of avoiding the problem, but don't use exec
as there is no need to. Use:

  locals()["_%s"+%k] = req.form[k]

Graham

> On 6/21/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> > On 22/06/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> > > > and
> > > > req.form['varx']  by _varx
> > >
> > > Don't recommend pushing form fields in local name space as doesn't
> > > make it as obvious that it is a form field and there would be a
> > > tendency not to perform checks to make sure the field you are looking
> > > for actually exists. Also, it will all possibly blow up if someone
> > > supplied a field you weren't expecting which replaced some important
> > > data or clashed with a keyword.
> > >
> > > If you really must do something like that though, you might adapt the
> > > following code from mod_python.util.apply_fs_data(). Replace 'fs' with
> > > req.form and replace args with locals().
> > >
> > >     # add form data to args
> > >     for field in fs.list:
> > >         if field.filename:
> > >             val = field
> > >         else:
> > >             val = field.value
> > >         args.setdefault(field.name, []).append(val)
> > >
> > >     # replace lists with single values
> > >     for arg in args:
> > >         if ((type(args[arg]) is ListType) and
> > >             (len(args[arg]) == 1)):
> > >             args[arg] = args[arg][0]
> >
> > BTW, if using publisher, a quicker way of doing this would be:
> >
> >   def func(req, arg1, args, **args):
> >     locals().update(args)
> >     ...
> >
> > As I said though, this is dangerous as someone outside your web site
> > can directly modify data your function uses to execute or cause your
> > handler to crash in bad ways.
> >
> > For example, with publisher function:
> >
> >   def index(req, **args):
> >     locals().update(args)
> >     req.content_type = 'text/plain'
> >     return 'mod_python.publisher', req.filename
> >
> > If URL of:
> >
> >   http://localhost:8002/~grahamd/publisher/index.py?req=xxx
> >
> > is used, I get an error saying:
> >
> >   AttributeError: 'mp_request' object has no attribute 'append'
> >
> > This is because I was able to replace the request object argument with
> > another value.
> >
> > Same problem will occur if using the longer example I showed before.
> >
> > Hopefully you will now be convinced this is a bad bad idea.
> >
> > Graham
> >
>
From makerjoe at gmail.com  Thu Jun 21 21:35:05 2007
From: makerjoe at gmail.com (maker joe)
Date: Thu Jun 21 21:35:11 2007
Subject: [mod_python] get post to a class
In-Reply-To: <88e286470706211810k2009cacg6b67ee7f5a3f5ae4@mail.gmail.com>
References: <227f6fed0706211758m6b56e767j983b7caf589d4859@mail.gmail.com>
	<88e286470706211810k2009cacg6b67ee7f5a3f5ae4@mail.gmail.com>
Message-ID: <227f6fed0706211835t5b556b74y9e60ba74d4abdf4b@mail.gmail.com>

perhaps a little bit simpler would be

go.py
-------
import myclasses
c=dispatch()
c.message(req)

myclasses.py
--------------------
class dispatch:
    def message(self,req)
         req.write('hello %s'%req.form['name'])

http://localhost/my.py/go?name=joe

bye
joseluis


On 6/21/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> On 22/06/07, maker joe <makerjoe@gmail.com> wrote:
> > hi graham
> >
> > is it possible to get/post to a class?
> >
> > my.py
> > ---------
> > class A:
> >     def go(self,req):
> >          req.write('hello'+%s)%name
> >
> > http://localhost/my.py/A/go?name=joe
>
> Classes will not auto instantiate.
>
> If your intention is to be able to create an instance of A per
> request, use something like:
>
>   class Instance:
>
>     def __init__(self, type, **kwargs):
>         self.__type = type
>         self.__kwargs = kwargs
>
>     def __call__(self, **args):
>         assert(type(self.__type) in [types.ClassType, types.TypeType])
>         return self.__type(**self.__kwargs)(**args)
>
>     class A:
>         def __call__(self, req):
>             req.write('hello'+%s)%name
>
>     go = Instance(A)
>
> URL would then be:
>
>    http://localhost/my.py/go?name=joe
>
> If the class has a constructor, use keyword arguments to Instance() to
> pass any arguments:
>
>     class A:
>         def __init__(self, arg1, arg2):
>             ...
>         def __call__(self, req):
>             req.write('hello'+%s)%name
>
>     go = Instance(A, arg1='value', arg2='value')
>
> This presumes you are using publisher.
>
> Graham
>
From makerjoe at gmail.com  Thu Jun 21 21:37:51 2007
From: makerjoe at gmail.com (maker joe)
Date: Thu Jun 21 21:37:58 2007
Subject: [mod_python] psp import issue
In-Reply-To: <88e286470706211828p790325a3med8e7a6911e76819@mail.gmail.com>
References: <227f6fed0706191519s2ca6ab82s9050032e373a8222@mail.gmail.com>
	<227f6fed0706211552h4b3e3b6ew3c74c2fde506a193@mail.gmail.com>
	<88e286470706211603u60d53198ifb0775fb8357b8e6@mail.gmail.com>
	<227f6fed0706211646j12d81e13m583c96550bc20dcd@mail.gmail.com>
	<88e286470706211703i1bc3701nc10597fb9b081121@mail.gmail.com>
	<227f6fed0706211729m7583e6e7y56f7db63e7cba058@mail.gmail.com>
	<88e286470706211745g59cea45cj67edc99dc26139e3@mail.gmail.com>
	<88e286470706211757i1e067430jdb23b6a1f35d3bee@mail.gmail.com>
	<227f6fed0706211819k10f98a94qa4e80a5391033063@mail.gmail.com>
	<88e286470706211828p790325a3med8e7a6911e76819@mail.gmail.com>
Message-ID: <227f6fed0706211837u64161118i69767cc39133bc96@mail.gmail.com>

again thanks for your support

On 6/21/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> On 22/06/07, maker joe <makerjoe@gmail.com> wrote:
> > sure you convinced me
> >
> > but why not ?
> >     for k in req.form:
> >         exec ("_"+k+"="+"req.form[k]")
> >         print k,_test
>
> Using a prefix is one way of avoiding the problem, but don't use exec
> as there is no need to. Use:
>
>   locals()["_%s"+%k] = req.form[k]
>
> Graham
>
> > On 6/21/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> > > On 22/06/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> > > > > and
> > > > > req.form['varx']  by _varx
> > > >
> > > > Don't recommend pushing form fields in local name space as doesn't
> > > > make it as obvious that it is a form field and there would be a
> > > > tendency not to perform checks to make sure the field you are looking
> > > > for actually exists. Also, it will all possibly blow up if someone
> > > > supplied a field you weren't expecting which replaced some important
> > > > data or clashed with a keyword.
> > > >
> > > > If you really must do something like that though, you might adapt the
> > > > following code from mod_python.util.apply_fs_data(). Replace 'fs' with
> > > > req.form and replace args with locals().
> > > >
> > > >     # add form data to args
> > > >     for field in fs.list:
> > > >         if field.filename:
> > > >             val = field
> > > >         else:
> > > >             val = field.value
> > > >         args.setdefault(field.name, []).append(val)
> > > >
> > > >     # replace lists with single values
> > > >     for arg in args:
> > > >         if ((type(args[arg]) is ListType) and
> > > >             (len(args[arg]) == 1)):
> > > >             args[arg] = args[arg][0]
> > >
> > > BTW, if using publisher, a quicker way of doing this would be:
> > >
> > >   def func(req, arg1, args, **args):
> > >     locals().update(args)
> > >     ...
> > >
> > > As I said though, this is dangerous as someone outside your web site
> > > can directly modify data your function uses to execute or cause your
> > > handler to crash in bad ways.
> > >
> > > For example, with publisher function:
> > >
> > >   def index(req, **args):
> > >     locals().update(args)
> > >     req.content_type = 'text/plain'
> > >     return 'mod_python.publisher', req.filename
> > >
> > > If URL of:
> > >
> > >   http://localhost:8002/~grahamd/publisher/index.py?req=xxx
> > >
> > > is used, I get an error saying:
> > >
> > >   AttributeError: 'mp_request' object has no attribute 'append'
> > >
> > > This is because I was able to replace the request object argument with
> > > another value.
> > >
> > > Same problem will occur if using the longer example I showed before.
> > >
> > > Hopefully you will now be convinced this is a bad bad idea.
> > >
> > > Graham
> > >
> >
>
From graham.dumpleton at gmail.com  Thu Jun 21 21:52:22 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu Jun 21 21:52:28 2007
Subject: [mod_python] get post to a class
In-Reply-To: <227f6fed0706211835t5b556b74y9e60ba74d4abdf4b@mail.gmail.com>
References: <227f6fed0706211758m6b56e767j983b7caf589d4859@mail.gmail.com>
	<88e286470706211810k2009cacg6b67ee7f5a3f5ae4@mail.gmail.com>
	<227f6fed0706211835t5b556b74y9e60ba74d4abdf4b@mail.gmail.com>
Message-ID: <88e286470706211852v5c18bb01r45819945a319b80@mail.gmail.com>

On 22/06/07, maker joe <makerjoe@gmail.com> wrote:
> perhaps a little bit simpler would be
>
> go.py
> -------
> import myclasses
> c=dispatch()
> c.message(req)
>
> myclasses.py
> --------------------
> class dispatch:
>     def message(self,req)
>          req.write('hello %s'%req.form['name'])
>
> http://localhost/my.py/go?name=joe

I don't see how that will work at all. At least not if you are using
publisher. If you have instead written your own handler which performs
its own URL dispatch then maybe it may work, but I don't know how your
dispatcher works.

If I try and read into your code as to what you perhaps meant, there
is a big difference in that with the approach I was suggested, there
would be a separate instance of the class per request. In your code,
by creating the instance at global scope within the module there will
be one instance for the life of the process and all requests will be
handled within that once instance. The consequences of using a single
instance are that class attributes can't be used for transient data
for a single request where one wants to use that as a means of
communicating data between member functions.

What you really need to do is explain what behaviour you want. One
class instance to be used for all requests, or one per request. For
all I know, all you were perhaps after was to know how to make a URL
traverse into objects, but your URL examples haven't been suggestive
of that.

So, maybe you should explain in english what you expect to happen.



Graham

> On 6/21/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> > On 22/06/07, maker joe <makerjoe@gmail.com> wrote:
> > > hi graham
> > >
> > > is it possible to get/post to a class?
> > >
> > > my.py
> > > ---------
> > > class A:
> > >     def go(self,req):
> > >          req.write('hello'+%s)%name
> > >
> > > http://localhost/my.py/A/go?name=joe
> >
> > Classes will not auto instantiate.
> >
> > If your intention is to be able to create an instance of A per
> > request, use something like:
> >
> >   class Instance:
> >
> >     def __init__(self, type, **kwargs):
> >         self.__type = type
> >         self.__kwargs = kwargs
> >
> >     def __call__(self, **args):
> >         assert(type(self.__type) in [types.ClassType, types.TypeType])
> >         return self.__type(**self.__kwargs)(**args)
> >
> >     class A:
> >         def __call__(self, req):
> >             req.write('hello'+%s)%name
> >
> >     go = Instance(A)
> >
> > URL would then be:
> >
> >    http://localhost/my.py/go?name=joe
> >
> > If the class has a constructor, use keyword arguments to Instance() to
> > pass any arguments:
> >
> >     class A:
> >         def __init__(self, arg1, arg2):
> >             ...
> >         def __call__(self, req):
> >             req.write('hello'+%s)%name
> >
> >     go = Instance(A, arg1='value', arg2='value')
> >
> > This presumes you are using publisher.
> >
> > Graham
> >
>
From makerjoe at gmail.com  Fri Jun 22 02:38:40 2007
From: makerjoe at gmail.com (maker joe)
Date: Fri Jun 22 02:38:49 2007
Subject: [mod_python] get post to a class
In-Reply-To: <88e286470706211852v5c18bb01r45819945a319b80@mail.gmail.com>
References: <227f6fed0706211758m6b56e767j983b7caf589d4859@mail.gmail.com>
	<88e286470706211810k2009cacg6b67ee7f5a3f5ae4@mail.gmail.com>
	<227f6fed0706211835t5b556b74y9e60ba74d4abdf4b@mail.gmail.com>
	<88e286470706211852v5c18bb01r45819945a319b80@mail.gmail.com>
Message-ID: <227f6fed0706212338x6bad0f5dw59e9d0cf28061bfb@mail.gmail.com>

hi graham
you said:
> I don't see how that will work at all. At least not if you are using
> publisher.

im using publisher and it works, so now im confused
but

for
 So, maybe you should explain in english what you expect to happen.
>

anyway all these question were about using modpython to develope a
module driven application (not generator)  were the system gets
distinct behaviours as per what module has to be imported from data
modified on a master database (mysql),  and nothing else

thank you in advance for all your input
joseluis


On 6/21/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> On 22/06/07, maker joe <makerjoe@gmail.com> wrote:
> > perhaps a little bit simpler would be
> >
> > go.py
> > -------
> > import myclasses
> > c=dispatch()
> > c.message(req)
> >
> > myclasses.py
> > --------------------
> > class dispatch:
> >     def message(self,req)
> >          req.write('hello %s'%req.form['name'])
> >
> > http://localhost/my.py/go?name=joe
>
> I don't see how that will work at all. At least not if you are using
> publisher. If you have instead written your own handler which performs
> its own URL dispatch then maybe it may work, but I don't know how your
> dispatcher works.
>
> If I try and read into your code as to what you perhaps meant, there
> is a big difference in that with the approach I was suggested, there
> would be a separate instance of the class per request. In your code,
> by creating the instance at global scope within the module there will
> be one instance for the life of the process and all requests will be
> handled within that once instance. The consequences of using a single
> instance are that class attributes can't be used for transient data
> for a single request where one wants to use that as a means of
> communicating data between member functions.
>
> What you really need to do is explain what behaviour you want. One
> class instance to be used for all requests, or one per request. For
> all I know, all you were perhaps after was to know how to make a URL
> traverse into objects, but your URL examples haven't been suggestive
> of that.
>
> So, maybe you should explain in english what you expect to happen.
>
>
>
> Graham
>
> > On 6/21/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> > > On 22/06/07, maker joe <makerjoe@gmail.com> wrote:
> > > > hi graham
> > > >
> > > > is it possible to get/post to a class?
> > > >
> > > > my.py
> > > > ---------
> > > > class A:
> > > >     def go(self,req):
> > > >          req.write('hello'+%s)%name
> > > >
> > > > http://localhost/my.py/A/go?name=joe
> > >
> > > Classes will not auto instantiate.
> > >
> > > If your intention is to be able to create an instance of A per
> > > request, use something like:
> > >
> > >   class Instance:
> > >
> > >     def __init__(self, type, **kwargs):
> > >         self.__type = type
> > >         self.__kwargs = kwargs
> > >
> > >     def __call__(self, **args):
> > >         assert(type(self.__type) in [types.ClassType, types.TypeType])
> > >         return self.__type(**self.__kwargs)(**args)
> > >
> > >     class A:
> > >         def __call__(self, req):
> > >             req.write('hello'+%s)%name
> > >
> > >     go = Instance(A)
> > >
> > > URL would then be:
> > >
> > >    http://localhost/my.py/go?name=joe
> > >
> > > If the class has a constructor, use keyword arguments to Instance() to
> > > pass any arguments:
> > >
> > >     class A:
> > >         def __init__(self, arg1, arg2):
> > >             ...
> > >         def __call__(self, req):
> > >             req.write('hello'+%s)%name
> > >
> > >     go = Instance(A, arg1='value', arg2='value')
> > >
> > > This presumes you are using publisher.
> > >
> > > Graham
> > >
> >
>
From makerjoe at gmail.com  Fri Jun 22 02:50:35 2007
From: makerjoe at gmail.com (maker joe)
Date: Fri Jun 22 02:50:41 2007
Subject: [mod_python] psp import issue
In-Reply-To: <88e286470706211828p790325a3med8e7a6911e76819@mail.gmail.com>
References: <227f6fed0706191519s2ca6ab82s9050032e373a8222@mail.gmail.com>
	<227f6fed0706211552h4b3e3b6ew3c74c2fde506a193@mail.gmail.com>
	<88e286470706211603u60d53198ifb0775fb8357b8e6@mail.gmail.com>
	<227f6fed0706211646j12d81e13m583c96550bc20dcd@mail.gmail.com>
	<88e286470706211703i1bc3701nc10597fb9b081121@mail.gmail.com>
	<227f6fed0706211729m7583e6e7y56f7db63e7cba058@mail.gmail.com>
	<88e286470706211745g59cea45cj67edc99dc26139e3@mail.gmail.com>
	<88e286470706211757i1e067430jdb23b6a1f35d3bee@mail.gmail.com>
	<227f6fed0706211819k10f98a94qa4e80a5391033063@mail.gmail.com>
	<88e286470706211828p790325a3med8e7a6911e76819@mail.gmail.com>
Message-ID: <227f6fed0706212350h6912f0f5h8507be7186a3536d@mail.gmail.com>

hi graham

there is a mistake on
locals()["_%s"+%k] = req.form[k]

should be
locals()["_%s"+k] = req.form[k]

kind regards
joseluis

On 6/21/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> On 22/06/07, maker joe <makerjoe@gmail.com> wrote:
> > sure you convinced me
> >
> > but why not ?
> >     for k in req.form:
> >         exec ("_"+k+"="+"req.form[k]")
> >         print k,_test
>
> Using a prefix is one way of avoiding the problem, but don't use exec
> as there is no need to. Use:
>
>   locals()["_%s"+%k] = req.form[k]
>
> Graham
>
> > On 6/21/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> > > On 22/06/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> > > > > and
> > > > > req.form['varx']  by _varx
> > > >
> > > > Don't recommend pushing form fields in local name space as doesn't
> > > > make it as obvious that it is a form field and there would be a
> > > > tendency not to perform checks to make sure the field you are looking
> > > > for actually exists. Also, it will all possibly blow up if someone
> > > > supplied a field you weren't expecting which replaced some important
> > > > data or clashed with a keyword.
> > > >
> > > > If you really must do something like that though, you might adapt the
> > > > following code from mod_python.util.apply_fs_data(). Replace 'fs' with
> > > > req.form and replace args with locals().
> > > >
> > > >     # add form data to args
> > > >     for field in fs.list:
> > > >         if field.filename:
> > > >             val = field
> > > >         else:
> > > >             val = field.value
> > > >         args.setdefault(field.name, []).append(val)
> > > >
> > > >     # replace lists with single values
> > > >     for arg in args:
> > > >         if ((type(args[arg]) is ListType) and
> > > >             (len(args[arg]) == 1)):
> > > >             args[arg] = args[arg][0]
> > >
> > > BTW, if using publisher, a quicker way of doing this would be:
> > >
> > >   def func(req, arg1, args, **args):
> > >     locals().update(args)
> > >     ...
> > >
> > > As I said though, this is dangerous as someone outside your web site
> > > can directly modify data your function uses to execute or cause your
> > > handler to crash in bad ways.
> > >
> > > For example, with publisher function:
> > >
> > >   def index(req, **args):
> > >     locals().update(args)
> > >     req.content_type = 'text/plain'
> > >     return 'mod_python.publisher', req.filename
> > >
> > > If URL of:
> > >
> > >   http://localhost:8002/~grahamd/publisher/index.py?req=xxx
> > >
> > > is used, I get an error saying:
> > >
> > >   AttributeError: 'mp_request' object has no attribute 'append'
> > >
> > > This is because I was able to replace the request object argument with
> > > another value.
> > >
> > > Same problem will occur if using the longer example I showed before.
> > >
> > > Hopefully you will now be convinced this is a bad bad idea.
> > >
> > > Graham
> > >
> >
>
From graham.dumpleton at gmail.com  Fri Jun 22 03:03:05 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Fri Jun 22 03:03:12 2007
Subject: [mod_python] psp import issue
In-Reply-To: <227f6fed0706212350h6912f0f5h8507be7186a3536d@mail.gmail.com>
References: <227f6fed0706191519s2ca6ab82s9050032e373a8222@mail.gmail.com>
	<88e286470706211603u60d53198ifb0775fb8357b8e6@mail.gmail.com>
	<227f6fed0706211646j12d81e13m583c96550bc20dcd@mail.gmail.com>
	<88e286470706211703i1bc3701nc10597fb9b081121@mail.gmail.com>
	<227f6fed0706211729m7583e6e7y56f7db63e7cba058@mail.gmail.com>
	<88e286470706211745g59cea45cj67edc99dc26139e3@mail.gmail.com>
	<88e286470706211757i1e067430jdb23b6a1f35d3bee@mail.gmail.com>
	<227f6fed0706211819k10f98a94qa4e80a5391033063@mail.gmail.com>
	<88e286470706211828p790325a3med8e7a6911e76819@mail.gmail.com>
	<227f6fed0706212350h6912f0f5h8507be7186a3536d@mail.gmail.com>
Message-ID: <88e286470706220003i65dfa85ap3f65fd67d3808885@mail.gmail.com>

On 22/06/07, maker joe <makerjoe@gmail.com> wrote:
> hi graham
>
> there is a mistake on
> locals()["_%s"+%k] = req.form[k]
>
> should be
> locals()["_%s"+k] = req.form[k]

Actually, it should have been:

  locals()["_%s"%k] = req.form[k]

as was trying to use mod operator on the string in preference to
addition of string so that auto conversion of string would happen.

Did this as for some reason, maybe old versions of mod_python, I have
see a None key come through. If this did occur the addition of strings
would fail as adding string with None, where as mod operator would
have converted None object to None value in string and not died. Yes
it could wipe out other field if one was called None, so by rights if
this is still an issue should use:

  if k:
    locals()["_%s"%k] = req.form[k]

Graham

> kind regards
> joseluis
>
> On 6/21/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> > On 22/06/07, maker joe <makerjoe@gmail.com> wrote:
> > > sure you convinced me
> > >
> > > but why not ?
> > >     for k in req.form:
> > >         exec ("_"+k+"="+"req.form[k]")
> > >         print k,_test
> >
> > Using a prefix is one way of avoiding the problem, but don't use exec
> > as there is no need to. Use:
> >
> >   locals()["_%s"+%k] = req.form[k]
> >
> > Graham
> >
> > > On 6/21/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> > > > On 22/06/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> > > > > > and
> > > > > > req.form['varx']  by _varx
> > > > >
> > > > > Don't recommend pushing form fields in local name space as doesn't
> > > > > make it as obvious that it is a form field and there would be a
> > > > > tendency not to perform checks to make sure the field you are looking
> > > > > for actually exists. Also, it will all possibly blow up if someone
> > > > > supplied a field you weren't expecting which replaced some important
> > > > > data or clashed with a keyword.
> > > > >
> > > > > If you really must do something like that though, you might adapt the
> > > > > following code from mod_python.util.apply_fs_data(). Replace 'fs' with
> > > > > req.form and replace args with locals().
> > > > >
> > > > >     # add form data to args
> > > > >     for field in fs.list:
> > > > >         if field.filename:
> > > > >             val = field
> > > > >         else:
> > > > >             val = field.value
> > > > >         args.setdefault(field.name, []).append(val)
> > > > >
> > > > >     # replace lists with single values
> > > > >     for arg in args:
> > > > >         if ((type(args[arg]) is ListType) and
> > > > >             (len(args[arg]) == 1)):
> > > > >             args[arg] = args[arg][0]
> > > >
> > > > BTW, if using publisher, a quicker way of doing this would be:
> > > >
> > > >   def func(req, arg1, args, **args):
> > > >     locals().update(args)
> > > >     ...
> > > >
> > > > As I said though, this is dangerous as someone outside your web site
> > > > can directly modify data your function uses to execute or cause your
> > > > handler to crash in bad ways.
> > > >
> > > > For example, with publisher function:
> > > >
> > > >   def index(req, **args):
> > > >     locals().update(args)
> > > >     req.content_type = 'text/plain'
> > > >     return 'mod_python.publisher', req.filename
> > > >
> > > > If URL of:
> > > >
> > > >   http://localhost:8002/~grahamd/publisher/index.py?req=xxx
> > > >
> > > > is used, I get an error saying:
> > > >
> > > >   AttributeError: 'mp_request' object has no attribute 'append'
> > > >
> > > > This is because I was able to replace the request object argument with
> > > > another value.
> > > >
> > > > Same problem will occur if using the longer example I showed before.
> > > >
> > > > Hopefully you will now be convinced this is a bad bad idea.
> > > >
> > > > Graham
> > > >
> > >
> >
>
From makerjoe at gmail.com  Fri Jun 22 03:10:28 2007
From: makerjoe at gmail.com (maker joe)
Date: Fri Jun 22 03:10:34 2007
Subject: [mod_python] psp import issue
In-Reply-To: <88e286470706220003i65dfa85ap3f65fd67d3808885@mail.gmail.com>
References: <227f6fed0706191519s2ca6ab82s9050032e373a8222@mail.gmail.com>
	<227f6fed0706211646j12d81e13m583c96550bc20dcd@mail.gmail.com>
	<88e286470706211703i1bc3701nc10597fb9b081121@mail.gmail.com>
	<227f6fed0706211729m7583e6e7y56f7db63e7cba058@mail.gmail.com>
	<88e286470706211745g59cea45cj67edc99dc26139e3@mail.gmail.com>
	<88e286470706211757i1e067430jdb23b6a1f35d3bee@mail.gmail.com>
	<227f6fed0706211819k10f98a94qa4e80a5391033063@mail.gmail.com>
	<88e286470706211828p790325a3med8e7a6911e76819@mail.gmail.com>
	<227f6fed0706212350h6912f0f5h8507be7186a3536d@mail.gmail.com>
	<88e286470706220003i65dfa85ap3f65fd67d3808885@mail.gmail.com>
Message-ID: <227f6fed0706220010h1749c763yf1164e09ee168fe0@mail.gmail.com>

right
it was my mistake composing the message, instead of deleting the plus
sign i deleted the mod sign. sorry

On 6/22/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> On 22/06/07, maker joe <makerjoe@gmail.com> wrote:
> > hi graham
> >
> > there is a mistake on
> > locals()["_%s"+%k] = req.form[k]
> >
> > should be
> > locals()["_%s"+k] = req.form[k]
>
> Actually, it should have been:
>
>   locals()["_%s"%k] = req.form[k]
>
> as was trying to use mod operator on the string in preference to
> addition of string so that auto conversion of string would happen.
>
> Did this as for some reason, maybe old versions of mod_python, I have
> see a None key come through. If this did occur the addition of strings
> would fail as adding string with None, where as mod operator would
> have converted None object to None value in string and not died. Yes
> it could wipe out other field if one was called None, so by rights if
> this is still an issue should use:
>
>   if k:
>     locals()["_%s"%k] = req.form[k]
>
> Graham
>
> > kind regards
> > joseluis
> >
> > On 6/21/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> > > On 22/06/07, maker joe <makerjoe@gmail.com> wrote:
> > > > sure you convinced me
> > > >
> > > > but why not ?
> > > >     for k in req.form:
> > > >         exec ("_"+k+"="+"req.form[k]")
> > > >         print k,_test
> > >
> > > Using a prefix is one way of avoiding the problem, but don't use exec
> > > as there is no need to. Use:
> > >
> > >   locals()["_%s"+%k] = req.form[k]
> > >
> > > Graham
> > >
> > > > On 6/21/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> > > > > On 22/06/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> > > > > > > and
> > > > > > > req.form['varx']  by _varx
> > > > > >
> > > > > > Don't recommend pushing form fields in local name space as doesn't
> > > > > > make it as obvious that it is a form field and there would be a
> > > > > > tendency not to perform checks to make sure the field you are looking
> > > > > > for actually exists. Also, it will all possibly blow up if someone
> > > > > > supplied a field you weren't expecting which replaced some important
> > > > > > data or clashed with a keyword.
> > > > > >
> > > > > > If you really must do something like that though, you might adapt the
> > > > > > following code from mod_python.util.apply_fs_data(). Replace 'fs' with
> > > > > > req.form and replace args with locals().
> > > > > >
> > > > > >     # add form data to args
> > > > > >     for field in fs.list:
> > > > > >         if field.filename:
> > > > > >             val = field
> > > > > >         else:
> > > > > >             val = field.value
> > > > > >         args.setdefault(field.name, []).append(val)
> > > > > >
> > > > > >     # replace lists with single values
> > > > > >     for arg in args:
> > > > > >         if ((type(args[arg]) is ListType) and
> > > > > >             (len(args[arg]) == 1)):
> > > > > >             args[arg] = args[arg][0]
> > > > >
> > > > > BTW, if using publisher, a quicker way of doing this would be:
> > > > >
> > > > >   def func(req, arg1, args, **args):
> > > > >     locals().update(args)
> > > > >     ...
> > > > >
> > > > > As I said though, this is dangerous as someone outside your web site
> > > > > can directly modify data your function uses to execute or cause your
> > > > > handler to crash in bad ways.
> > > > >
> > > > > For example, with publisher function:
> > > > >
> > > > >   def index(req, **args):
> > > > >     locals().update(args)
> > > > >     req.content_type = 'text/plain'
> > > > >     return 'mod_python.publisher', req.filename
> > > > >
> > > > > If URL of:
> > > > >
> > > > >   http://localhost:8002/~grahamd/publisher/index.py?req=xxx
> > > > >
> > > > > is used, I get an error saying:
> > > > >
> > > > >   AttributeError: 'mp_request' object has no attribute 'append'
> > > > >
> > > > > This is because I was able to replace the request object argument with
> > > > > another value.
> > > > >
> > > > > Same problem will occur if using the longer example I showed before.
> > > > >
> > > > > Hopefully you will now be convinced this is a bad bad idea.
> > > > >
> > > > > Graham
> > > > >
> > > >
> > >
> >
>
From me at robhaswell.co.uk  Fri Jun 22 07:05:49 2007
From: me at robhaswell.co.uk (Robin Haswell)
Date: Fri Jun 22 07:05:56 2007
Subject: [mod_python] Output filters for large files
Message-ID: <467BAD0D.70507@robhaswell.co.uk>

Hi there

I'm having issues writing an output filter that can handle large files.
My filter's primary purpose is to count the length of the output. Could
someone assist me please?

The code I have works very well except when a large file is passed
through it, at which point it eats up memory, probably equal to the size
of the file.

Any assistance would be much appreciated.

Here is my filter so far:

def outputfilter(filter):

    s = filter.read(4096)
    bytes = 0
    while s:
        filter.write(str(s))
        bytes += len(s)
        s = filter.read(4096)

    if s is None:
        filter.close()


Thanks in advance,

-Rob Haswell
From steino at ccri.net  Fri Jun 22 11:35:00 2007
From: steino at ccri.net (Olaf Stein)
Date: Fri Jun 22 11:35:50 2007
Subject: [mod_python] Import problem
Message-ID: <C2A16464.132F%steino@ccri.net>

Hi all,

I am running into this really weird problem:
I am on a mac, apache 2.2, mod_python 3.3.1

I recently upgraded the python version from 2.3.5 to 2.5.1, recompiled
apache and mod_python. This resulted in import errors in my application
(like the one shown below, replacing 2.3 with 2.5).

As I could not figure out what happened I uninstalled 2.5, recompiled apache
and mod_python with 2.3.5 (basically the setup that was running nicely for a
good while) and now I get the same error.

Does anyone have any advice, this is driving me nuts.
Thanks in advance
Olaf


----------------
MOD_PYTHON ERROR

ProcessId:      11732
Interpreter:    'resw87031esw0h.columbuschildrens.net'

ServerName:     'resw87031esw0h.columbuschildrens.net'
DocumentRoot:   '/usr/local/apache/htdocs'

URI:            '/apps/cqcb/enter'
Location:       None
Directory:      '/usr/local/apache/htdocs/apps/'
Filename:       '/usr/local/apache/htdocs/apps/cqcb.py'
PathInfo:       '/enter'

Phase:          'PythonHandler'
Handler:        'mod_python.publisher'

Traceback (most recent call last):

  File 
"/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site
-packages/mod_python/importer.py", line 1537, in HandlerDispatch
    default=default_handler, arg=req, silent=hlist.silent)

  File 
"/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site
-packages/mod_python/importer.py", line 1229, in _process_target
    result = _execute_target(config, req, object, arg)

  File 
"/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site
-packages/mod_python/importer.py", line 1128, in _execute_target
    result = object(arg)

  File 
"/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site
-packages/mod_python/publisher.py", line 204, in handler
    module = page_cache[req]

  File 
"/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site
-packages/mod_python/importer.py", line 1059, in __getitem__
    return import_module(req.filename)

  File 
"/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site
-packages/mod_python/importer.py", line 296, in import_module
    log, import_path)

  File 
"/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site
-packages/mod_python/importer.py", line 680, in import_module
    execfile(file, module.__dict__)

  File "/usr/local/apache/htdocs/apps/cqcb.py", line 25, in ?
    from simpla.mod_simpla import *

ImportError: No module named simpla.mod_simpla


MODULE CACHE DETAILS

Accessed:       Fri Jun 22 11:29:34 2007
Generation:     0

_mp_f2e427d7eaa5f917da937317ce568d43 {
  FileName:     '/usr/local/apache/htdocs/apps/cqcb.py'
  Instance:     1 [IMPORT]
  Generation:   0 [ERROR]
  Modified:     Fri Jun 22 10:55:36 2007
}



------------------------------

From jpg at jgassociates.ca  Fri Jun 22 12:00:54 2007
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Fri Jun 22 11:59:31 2007
Subject: [mod_python] Import problem
In-Reply-To: <C2A16464.132F%steino@ccri.net>
References: <C2A16464.132F%steino@ccri.net>
Message-ID: <467BF236.3050703@jgassociates.ca>

Olaf Stein wrote:
> Hi all,
> 
> I am running into this really weird problem:
> I am on a mac, apache 2.2, mod_python 3.3.1
> 
> I recently upgraded the python version from 2.3.5 to 2.5.1, recompiled
> apache and mod_python. This resulted in import errors in my application
> (like the one shown below, replacing 2.3 with 2.5).
> 
> As I could not figure out what happened I uninstalled 2.5, recompiled apache
> and mod_python with 2.3.5 (basically the setup that was running nicely for a
> good while) and now I get the same error.
> 
> Does anyone have any advice, this is driving me nuts.
> Thanks in advance
> Olaf
> 
> 
> ----------------
> MOD_PYTHON ERROR
> 
> ProcessId:      11732
> Interpreter:    'resw87031esw0h.columbuschildrens.net'
> 
> ServerName:     'resw87031esw0h.columbuschildrens.net'
> DocumentRoot:   '/usr/local/apache/htdocs'
> 
> URI:            '/apps/cqcb/enter'
> Location:       None
> Directory:      '/usr/local/apache/htdocs/apps/'
> Filename:       '/usr/local/apache/htdocs/apps/cqcb.py'
> PathInfo:       '/enter'
> 
> Phase:          'PythonHandler'
> Handler:        'mod_python.publisher'
> 
> Traceback (most recent call last):
> 
>   File 
> "/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site
> -packages/mod_python/importer.py", line 1537, in HandlerDispatch
>     default=default_handler, arg=req, silent=hlist.silent)
> 
>   File 
> "/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site
> -packages/mod_python/importer.py", line 1229, in _process_target
>     result = _execute_target(config, req, object, arg)
> 
>   File 
> "/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site
> -packages/mod_python/importer.py", line 1128, in _execute_target
>     result = object(arg)
> 
>   File 
> "/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site
> -packages/mod_python/publisher.py", line 204, in handler
>     module = page_cache[req]
> 
>   File 
> "/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site
> -packages/mod_python/importer.py", line 1059, in __getitem__
>     return import_module(req.filename)
> 
>   File 
> "/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site
> -packages/mod_python/importer.py", line 296, in import_module
>     log, import_path)
> 
>   File 
> "/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site
> -packages/mod_python/importer.py", line 680, in import_module
>     execfile(file, module.__dict__)
> 
>   File "/usr/local/apache/htdocs/apps/cqcb.py", line 25, in ?
>     from simpla.mod_simpla import *
> 
> ImportError: No module named simpla.mod_simpla
> 

Where is the simpla module located? It does exist, right? ;)

Jim


From steino at ccri.net  Fri Jun 22 13:39:17 2007
From: steino at ccri.net (Olaf Stein)
Date: Fri Jun 22 13:40:22 2007
Subject: [mod_python] Import problem
In-Reply-To: <467BF236.3050703@jgassociates.ca>
Message-ID: <C2A18185.39B3%steino@ccri.net>

In the folders where cqcb.py is located there is a folder simpla, with a
file called mod_simpla.py

This same code used to work that's why this is weird


On 6/22/07 12:00 PM, "Jim Gallacher" <jpg@jgassociates.ca> wrote:

> Olaf Stein wrote:
>> Hi all,
>> 
>> I am running into this really weird problem:
>> I am on a mac, apache 2.2, mod_python 3.3.1
>> 
>> I recently upgraded the python version from 2.3.5 to 2.5.1, recompiled
>> apache and mod_python. This resulted in import errors in my application
>> (like the one shown below, replacing 2.3 with 2.5).
>> 
>> As I could not figure out what happened I uninstalled 2.5, recompiled apache
>> and mod_python with 2.3.5 (basically the setup that was running nicely for a
>> good while) and now I get the same error.
>> 
>> Does anyone have any advice, this is driving me nuts.
>> Thanks in advance
>> Olaf
>> 
>> 
>> ----------------
>> MOD_PYTHON ERROR
>> 
>> ProcessId:      11732
>> Interpreter:    'resw87031esw0h.columbuschildrens.net'
>> 
>> ServerName:     'resw87031esw0h.columbuschildrens.net'
>> DocumentRoot:   '/usr/local/apache/htdocs'
>> 
>> URI:            '/apps/cqcb/enter'
>> Location:       None
>> Directory:      '/usr/local/apache/htdocs/apps/'
>> Filename:       '/usr/local/apache/htdocs/apps/cqcb.py'
>> PathInfo:       '/enter'
>> 
>> Phase:          'PythonHandler'
>> Handler:        'mod_python.publisher'
>> 
>> Traceback (most recent call last):
>> 
>>   File 
>> "/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site
>> -packages/mod_python/importer.py", line 1537, in HandlerDispatch
>>     default=default_handler, arg=req, silent=hlist.silent)
>> 
>>   File 
>> "/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site
>> -packages/mod_python/importer.py", line 1229, in _process_target
>>     result = _execute_target(config, req, object, arg)
>> 
>>   File 
>> "/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site
>> -packages/mod_python/importer.py", line 1128, in _execute_target
>>     result = object(arg)
>> 
>>   File 
>> "/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site
>> -packages/mod_python/publisher.py", line 204, in handler
>>     module = page_cache[req]
>> 
>>   File 
>> "/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site
>> -packages/mod_python/importer.py", line 1059, in __getitem__
>>     return import_module(req.filename)
>> 
>>   File 
>> "/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site
>> -packages/mod_python/importer.py", line 296, in import_module
>>     log, import_path)
>> 
>>   File 
>> "/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site
>> -packages/mod_python/importer.py", line 680, in import_module
>>     execfile(file, module.__dict__)
>> 
>>   File "/usr/local/apache/htdocs/apps/cqcb.py", line 25, in ?
>>     from simpla.mod_simpla import *
>> 
>> ImportError: No module named simpla.mod_simpla
>> 
> 
> Where is the simpla module located? It does exist, right? ;)
> 
> Jim
> 
> 





-------------------------
Olaf Stein
DBA
Center for Quantitative and Computational Biology
Columbus Children's Research Institute
700 Children's Drive
phone: 1-614-355-5685
cell: 1-614-843-0432
email: steino@ccri.net

From graham.dumpleton at gmail.com  Fri Jun 22 18:42:31 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Fri Jun 22 18:42:37 2007
Subject: [mod_python] Import problem
In-Reply-To: <C2A18185.39B3%steino@ccri.net>
References: <467BF236.3050703@jgassociates.ca> <C2A18185.39B3%steino@ccri.net>
Message-ID: <88e286470706221542m15f201a1r87934401a8e625b4@mail.gmail.com>

Did you upgrade to mod_python 3.3.1 from an older version at the same time?

There was one incompatible change going to mod_python 3.3.1 from older
versions. This was where the handler directory is no longer put into
sys.path. This doesn't cause any problems if using file based modules
in the same directory, but does if you have a Python package in the
same directory.

Further information can be had by reading the documentation for
apache.import_module() in:

  http://www.modpython.org/live/current/doc-html/pyapi-apmeth.html

If that stuff in the directory is a true Python package with
__init__.py having side affects, then only choice is to move the
directory to outside of the document tree and then use PythonPath
directive to specify where it is located. Other alternative is to
treat your directory as a pseudo package as described in the
documentation.

Anyway, read the documentation and come back if you have more
questions or need something explained.

Graham

On 23/06/07, Olaf Stein <steino@ccri.net> wrote:
> In the folders where cqcb.py is located there is a folder simpla, with a
> file called mod_simpla.py
>
> This same code used to work that's why this is weird
>
>
> On 6/22/07 12:00 PM, "Jim Gallacher" <jpg@jgassociates.ca> wrote:
>
> > Olaf Stein wrote:
> >> Hi all,
> >>
> >> I am running into this really weird problem:
> >> I am on a mac, apache 2.2, mod_python 3.3.1
> >>
> >> I recently upgraded the python version from 2.3.5 to 2.5.1, recompiled
> >> apache and mod_python. This resulted in import errors in my application
> >> (like the one shown below, replacing 2.3 with 2.5).
> >>
> >> As I could not figure out what happened I uninstalled 2.5, recompiled apache
> >> and mod_python with 2.3.5 (basically the setup that was running nicely for a
> >> good while) and now I get the same error.
> >>
> >> Does anyone have any advice, this is driving me nuts.
> >> Thanks in advance
> >> Olaf
> >>
> >>
> >> ----------------
> >> MOD_PYTHON ERROR
> >>
> >> ProcessId:      11732
> >> Interpreter:    'resw87031esw0h.columbuschildrens.net'
> >>
> >> ServerName:     'resw87031esw0h.columbuschildrens.net'
> >> DocumentRoot:   '/usr/local/apache/htdocs'
> >>
> >> URI:            '/apps/cqcb/enter'
> >> Location:       None
> >> Directory:      '/usr/local/apache/htdocs/apps/'
> >> Filename:       '/usr/local/apache/htdocs/apps/cqcb.py'
> >> PathInfo:       '/enter'
> >>
> >> Phase:          'PythonHandler'
> >> Handler:        'mod_python.publisher'
> >>
> >> Traceback (most recent call last):
> >>
> >>   File
> >> "/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site
> >> -packages/mod_python/importer.py", line 1537, in HandlerDispatch
> >>     default=default_handler, arg=req, silent=hlist.silent)
> >>
> >>   File
> >> "/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site
> >> -packages/mod_python/importer.py", line 1229, in _process_target
> >>     result = _execute_target(config, req, object, arg)
> >>
> >>   File
> >> "/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site
> >> -packages/mod_python/importer.py", line 1128, in _execute_target
> >>     result = object(arg)
> >>
> >>   File
> >> "/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site
> >> -packages/mod_python/publisher.py", line 204, in handler
> >>     module = page_cache[req]
> >>
> >>   File
> >> "/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site
> >> -packages/mod_python/importer.py", line 1059, in __getitem__
> >>     return import_module(req.filename)
> >>
> >>   File
> >> "/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site
> >> -packages/mod_python/importer.py", line 296, in import_module
> >>     log, import_path)
> >>
> >>   File
> >> "/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site
> >> -packages/mod_python/importer.py", line 680, in import_module
> >>     execfile(file, module.__dict__)
> >>
> >>   File "/usr/local/apache/htdocs/apps/cqcb.py", line 25, in ?
> >>     from simpla.mod_simpla import *
> >>
> >> ImportError: No module named simpla.mod_simpla
> >>
> >
> > Where is the simpla module located? It does exist, right? ;)
> >
> > Jim
> >
> >
>
>
>
>
>
> -------------------------
> Olaf Stein
> DBA
> Center for Quantitative and Computational Biology
> Columbus Children's Research Institute
> 700 Children's Drive
> phone: 1-614-355-5685
> cell: 1-614-843-0432
> email: steino@ccri.net
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From graham.dumpleton at gmail.com  Sat Jun 23 07:24:28 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sat Jun 23 07:24:33 2007
Subject: [mod_python] Output filters for large files
In-Reply-To: <467BAD0D.70507@robhaswell.co.uk>
References: <467BAD0D.70507@robhaswell.co.uk>
Message-ID: <88e286470706230424q6d92e976gf3ef6b0be05f671d@mail.gmail.com>

On 22/06/07, Robin Haswell <me@robhaswell.co.uk> wrote:
> Hi there
>
> I'm having issues writing an output filter that can handle large files.
> My filter's primary purpose is to count the length of the output. Could
> someone assist me please?
>
> The code I have works very well except when a large file is passed
> through it, at which point it eats up memory, probably equal to the size
> of the file.
>
> Any assistance would be much appreciated.
>
> Here is my filter so far:
>
> def outputfilter(filter):
>
>     s = filter.read(4096)
>     bytes = 0
>     while s:
>         filter.write(str(s))
>         bytes += len(s)
>         s = filter.read(4096)
>
>     if s is None:
>         filter.close()

One generally would not provide a size argument to filter.read(),
instead one would let Apache provide the data in the natural size that
was written out by a handler or as read in from a file.

By doing what you are doing you would be forcing Apache to break up
data or have to accumulate it so as to give it in the size you want.
The result of that would be an increase in the amount of memory which
would be used as you are seeing.

Also note that your output filter can be called more than once, so you
have to store your byte count in the request object to preserve it
between calls.

Thus:

def outputfilter1(filter):

    if not hasattr(filter.req, 'mybytecount'):
        filter.req.mybytecount = 0

    s = filter.read()
    while s:
        filter.req.mybytecount += len(s)
        filter.write(s)
        s = filter.read()

    if s is None:
        filter.close()
        # ... do something with byte count

    return apache.OK

BTW, why are you wanting to do this? The request object already has a
bytes_sent attribute which Apache updates as data is written and will
when all is done have the final content length in it. What you want to
do with the value will determine the mechanism used to register a
handler which will give you access to it after everything is done.

Graham
From graham.dumpleton at gmail.com  Sat Jun 23 07:38:36 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sat Jun 23 07:38:42 2007
Subject: [mod_python] UnicodeDecodeError with
	util.FieldStorage(req).Field.value
In-Reply-To: <200706201923.46099.ah@hatzis.de>
References: <200706201923.46099.ah@hatzis.de>
Message-ID: <88e286470706230438p405af1eds1629f027287199@mail.gmail.com>

Making a guess here, but even though your form tries to require that
posted form data is UTF-8 it probably isn't and is instead passing it
through as ISO-8859-1 or some other European character set. Am then
guessing that that character maps to the special UTF-8 marker
character for indicating a multibyte character.

Try this in Python:

>>> s.decode("iso-8859-1").encode('utf-8')
'\xc3\x83'

See how it ends up as a multibyte character where the marker is itself
\xc3. Also:

>>> print s.decode("iso-8859-1").encode('utf-8')
?

Is that the character you are expecting to see.

I'm not in any way an expert on Unicode though, so could be quite wrong.

Graham

On 21/06/07, Anastasios Hatzis <ah@hatzis.de> wrote:
> Hi,
>
> I'm struggling with UnicodeDecodeError when trying to append
> util.FieldStorage(req).Field.value with umlaut into a variable of type
> unicode.
>
> <SNIP>
> <%
> # file: test.psp
>
> from mod_python import Session, util
> req.assbackwards
>
> req.content_type = 'text/html; charset=UTF-8'
> %>
> <!--SOME HTML HEAD STUFF HERE-->
>
> <form action="/test.psp" method="post" enctype="text/plain"
> accept-charset="UTF-8">
> <!-- form calls this very same file -->
> <input name="name" type="text" size="30" maxlength="50" />
> <input type="submit" value="Submit" />
> </form>
>
> <%
> req.write('<p>Write values to HTML</p>') # Works fine!
> store = util.FieldStorage(req)
> for param in store.list:
>     req.write(param.value)
> %>
> <b><%=param.name%></b>:<%=param.value%>:<%=type(param.value)%><br />
> <%
>
> req.write('<p>Append all values to the variable msg</p>')
> msg = u''
> for param in store.list:
>     msg += param.name + ': ' + param.value + '\r\n' # UnicodeDecodeError!
> %>
> <!--SOME HTML FOOT STUFF HERE-->
>
> </SNIP>
>
>
> So, when calling this page the HTML output for first section is rendered with
> umlaut (?, ?, ...). Value is <type 'str'> ... well, why not, as long as it is
> UTF-8...
>
> But as soon as the script tries to append param.value to the unicode
> variable "msg" I'm getting this error:
>
> UnicodeDecodeError: 'ascii' codec can't decode byte 0xc3 in position 26:
> ordinal not in range(128)
>
>
> I do not understand why I'm getting this error. How does 'ascii' come into
> this? How do I know which encoding is really applied (in param.value and in
> msg)?
>
> I'm blind, hum?
>
> Anastasios
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
>

From gzlist at googlemail.com  Sat Jun 23 14:13:32 2007
From: gzlist at googlemail.com (Martin)
Date: Sat Jun 23 14:13:39 2007
Subject: [mod_python] UnicodeDecodeError with
	util.FieldStorage(req).Field.value
In-Reply-To: <200706201923.46099.ah@hatzis.de>
References: <200706201923.46099.ah@hatzis.de>
Message-ID: <d80792120706231113v402284b0jbfb106953cba4503@mail.gmail.com>

Have seen that Graham has responded now, but a few things need clarifying.

On 20/06/07, Anastasios Hatzis <ah@hatzis.de> wrote:
> So, when calling this page the HTML output for first section is rendered with
> umlaut (?, ?, ...). Value is <type 'str'> ... well, why not, as long as it is
> UTF-8...

Important to remember that the utf-8 encoding is not python 'unicode'
- to get a utf-8 byte-string into a unicode object, you must decode
it.

> I do not understand why I'm getting this error. How does 'ascii' come into
> this?

Do sys.getdefaultencoding() from within mod_python on your server, you
should see that is 'ascii'. This is the right thing - unless you
specify an explict codec, python will use the 'lowest common
denominator' codec (that only deals with the range(0,128) and throws
an exception otherwise) rather than risk silent corruption.

So, let's re-create your problem in the console:

>>> import unicodedata
>>> unicodedata.name(u"\u00e4")
'LATIN SMALL LETTER A WITH DIAERESIS'
>>> u"\u00e4".encode('utf8')
'\xc3\xa4'
>>> u"something" + _
Traceback (most recent call last):
  File "<stdin>", line 1, in ?
UnicodeDecodeError: 'ascii' codec can't decode byte 0xc3 in position 0: ordinal
not in range(128)

Whenever you try to treat string objects as unicode objects or visa
versa, python has to implictly encode or decode something. Generally
you want to be explict about which you are using, and not mix them
together. For instance, you might get bytes from the wire, decode, do
program logic on unicode, encode to file.

> How do I know which encoding is really applied (in param.value and in
> msg)?

This is the fun bit - you don't. If the page the form the data is
coming from is a specific encoding, the form will generally be posted
with the same encoding - but you can't rely on this. One thing not to
do is trust that byte strings you are given are in some encoding, and
then put them straight in output page/file/database.

So, while I don't know the specifics of the PSP handler, you should in
general rather than doing:
> msg = u''
> for param in store.list:
>     msg += param.name + ': ' + param.value + '\r\n' # UnicodeDecodeError!

Instead do something like:
buf = []
for param in store.list:
    buf.extend([param.name, ': ', param.value, '\r\n']) # operating on bytes
try:
    msg = "".join(buf).decode('utf-8') # creating msg as a unicode object
except UnicodeDecodeError:
    # really need to send a nice message back to the poster of the form
    # telling them to fix their encoding, but this will do instead
    raise apache.SERVER_RETURN(apache.HTTP_BAD_REQUEST)

And then if you need to put msg in the output page, you'd do
msg.encode('utf-8') before writing it out.

Martin

From ziapannocchia at gmail.com  Sat Jun 23 16:34:43 2007
From: ziapannocchia at gmail.com (ziapannocchia@gmail.com)
Date: Sat Jun 23 16:34:56 2007
Subject: [mod_python] object type. why it not works?
Message-ID: <ca4f20450706231334n476ff40bge2cc018c29955745@mail.gmail.com>

I have a selfmade apache server, and I'm writing  a little web
application with mod python.

Using this def:

def testPython(contenuto):
  test="test"
  return type(test)

I obtain this error:

Mod_python error: "PythonHandler mod_python.publisher"

Traceback (most recent call last):

  File "/usr/lib64/python2.4/site-packages/mod_python/apache.py", line
299, in HandlerDispatch
    result = object(req)

  File "/usr/lib64/python2.4/site-packages/mod_python/publisher.py",
line 213, in handler
    published = publish_object(req, object)

  File "/usr/lib64/python2.4/site-packages/mod_python/publisher.py",
line 412, in publish_object
    return publish_object(req,util.apply_fs_data(object, req.form, req=req))

  File "/usr/lib64/python2.4/site-packages/mod_python/publisher.py",
line 412, in publish_object
    return publish_object(req,util.apply_fs_data(object, req.form, req=req))

  File "/usr/lib64/python2.4/site-packages/mod_python/util.py", line
401, in apply_fs_data
    fc = object.__init__.im_func.func_code

AttributeError: 'wrapper_descriptor' object has no attribute 'im_func'

Instead, on command line, the same istruction works well:

cloc3@s939 /home/cloc3 $ python
Python 2.4.4 (#1, May 18 2007, 08:25:49)
[GCC 4.1.2 (Gentoo 4.1.2)] on linux2
Type "help", "copyright", "credits" or "license" for more information.
>>> test="test"
>>> type(test)
<type 'str'>


What may be wrong?
From jeffh at dundeemt.com  Sun Jun 24 01:11:46 2007
From: jeffh at dundeemt.com (Jeff Hinrichs - DM&T)
Date: Sun Jun 24 01:11:53 2007
Subject: [mod_python] object type. why it not works?
In-Reply-To: <ca4f20450706231334n476ff40bge2cc018c29955745@mail.gmail.com>
References: <ca4f20450706231334n476ff40bge2cc018c29955745@mail.gmail.com>
Message-ID: <5aaed53f0706232211q5ae25488qd87f8d1aa6eb8ae4@mail.gmail.com>

On 6/23/07, ziapannocchia@gmail.com <ziapannocchia@gmail.com> wrote:
> I have a selfmade apache server, and I'm writing  a little web
> application with mod python.
>
> Using this def:
>
> def testPython(contenuto):
>   test="test"
>   return type(test)
>
> I obtain this error:
>
> Mod_python error: "PythonHandler mod_python.publisher"
>
> Traceback (most recent call last):
>
>   File "/usr/lib64/python2.4/site-packages/mod_python/apache.py", line
> 299, in HandlerDispatch
>     result = object(req)
>
>   File "/usr/lib64/python2.4/site-packages/mod_python/publisher.py",
> line 213, in handler
>     published = publish_object(req, object)
>
>   File "/usr/lib64/python2.4/site-packages/mod_python/publisher.py",
> line 412, in publish_object
>     return publish_object(req,util.apply_fs_data(object, req.form, req=req))
>
>   File "/usr/lib64/python2.4/site-packages/mod_python/publisher.py",
> line 412, in publish_object
>     return publish_object(req,util.apply_fs_data(object, req.form, req=req))
>
>   File "/usr/lib64/python2.4/site-packages/mod_python/util.py", line
> 401, in apply_fs_data
>     fc = object.__init__.im_func.func_code
>
> AttributeError: 'wrapper_descriptor' object has no attribute 'im_func'
>
> Instead, on command line, the same istruction works well:
>
> cloc3@s939 /home/cloc3 $ python
> Python 2.4.4 (#1, May 18 2007, 08:25:49)
> [GCC 4.1.2 (Gentoo 4.1.2)] on linux2
> Type "help", "copyright", "credits" or "license" for more information.
> >>> test="test"
> >>> type(test)
> <type 'str'>
>
>
> What may be wrong?

Publisher wants to return a string -- and you are attempting to return
an object, http://docs.python.org/lib/bltin-type-objects.html

try, return test  --or-- return str(type(test))

-jeff
From ziapannocchia at gmail.com  Sun Jun 24 09:27:52 2007
From: ziapannocchia at gmail.com (ziapannocchia@gmail.com)
Date: Sun Jun 24 09:27:59 2007
Subject: [mod_python] object type. why it not works?
In-Reply-To: <5aaed53f0706232211q5ae25488qd87f8d1aa6eb8ae4@mail.gmail.com>
References: <ca4f20450706231334n476ff40bge2cc018c29955745@mail.gmail.com>
	<5aaed53f0706232211q5ae25488qd87f8d1aa6eb8ae4@mail.gmail.com>
Message-ID: <ca4f20450706240627w2ea4649ex39705092ec22483a@mail.gmail.com>

2007/6/24, Jeff Hinrichs - DM&T <jeffh@dundeemt.com>:
> On 6/23/07, ziapannocchia@gmail.com <ziapannocchia@gmail.com> wrote:
>>...
>
> Publisher wants to return a string -- and you are attempting to return
> an object, http://docs.python.org/lib/bltin-type-objects.html
>
> try, return test  --or-- return str(type(test))
>
> -jeff
>
Thank.
 return str(type(test)).strip("<>")
solves for me.
From gulopine at gamemusic.org  Sun Jun 24 12:24:18 2007
From: gulopine at gamemusic.org (Marty Alchin)
Date: Sun Jun 24 12:24:26 2007
Subject: [mod_python] ImportError: No module named linecache
Message-ID: <7e8d40920706240924x5abc4cafr3f2a06cfabf87520@mail.gmail.com>

Hello all,

This is my first time venturing into the world of mod_python, and I'm
having a bit of trouble getting it working. I'm trying to use it with
Django and with Trac, but both have the same problem, so it seems like
it's something with my mod_python setup in general.

Apache starts fine, but when I try to view either of the sites I set
up with mod_python, I get a generic Internal Server Error, with the
following in error_log:

[Sun Jun 24 10:55:16 2007] [error] make_obcallback: could not import
mod_python.apache.\n
Traceback (most recent call last):
  File "/usr/local/lib/python2.4/site-packages/mod_python/apache.py",
line 21, in ?
    import traceback
  File "/usr/local/lib/python2.4/traceback.py", line 3, in ?
    import linecache
ImportError: No module named linecache
[Sun Jun 24 10:55:16 2007] [error] make_obcallback: Python path being
used "['/usr/local/lib/python2.4/site-packages/setuptools-0.6c1-py2.4.egg',
'/usr/local/lib/python2.4/site-packages/Django-0.95-py2.4.egg',
'/usr/local/lib/python24.zip', '/usr/local/lib/python2.4',
'/usr/local/lib/python2.4/plat-linux2',
'/usr/local/lib/python2.4/lib-tk',
'/usr/local/lib/python2.4/lib-dynload',
'/usr/local/lib/python2.4/site-packages']".
[Sun Jun 24 10:55:16 2007] [error] get_interpreter: no interpreter
callback found.

But when I load up python interactively, it works just fine, loading
both traceback and linecache individually:

>>> import traceback
>>> import linecache
>>>

I tried the post-install troubleshooting step[1] to provide additional
information, but accessing that URL results in the same error listed
above.

As this is my first foray into mod_python, I can't quite figure out
what I'm doing wrong. Below is as much background information as I
could think to include.

Apache:
# /usr/local/apache2/bin/httpd -v
Server version: Apache/2.2.2
Server built:   May 12 2007 21:31:02

Mod_python:
>>> import mod_python
>>> mod_python.version
'3.3.1'

Python:
# python -V
Python 2.4.3

VirtualHost config:
<VirtualHost *:80>
ServerName dev.mysite.com
PythonPath "['/path/to/project'] + sys.path"
SetHandler python-program
PythonHandler django.core.handlers.modpython
SetEnv DJANGO_SETTINGS_MODULE mysite.settings
PythonDebug On

<Location /trac>
SetHandler mod_python
PythonHandler trac.web.modpython_frontend
PythonOption TracEnv /path/to/env
PythonOption TracUriRoot /trac
</Location>
</VirtualHost>

-Gul

[1] http://www.modpython.org/live/mod_python-3.3.1/doc-html/inst-trouble.html
From jpg at jgassociates.ca  Sun Jun 24 12:52:50 2007
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Sun Jun 24 12:51:26 2007
Subject: [mod_python] ImportError: No module named linecache
In-Reply-To: <7e8d40920706240924x5abc4cafr3f2a06cfabf87520@mail.gmail.com>
References: <7e8d40920706240924x5abc4cafr3f2a06cfabf87520@mail.gmail.com>
Message-ID: <467EA162.9030703@jgassociates.ca>

Hi Marty,

Any chance you have multiple versions of python installed?

If so make sure the correct python is listed first in your PATH in the 
context of the user that runs apache.

Jim

Marty Alchin wrote:
> Hello all,
> 
> This is my first time venturing into the world of mod_python, and I'm
> having a bit of trouble getting it working. I'm trying to use it with
> Django and with Trac, but both have the same problem, so it seems like
> it's something with my mod_python setup in general.
> 
> Apache starts fine, but when I try to view either of the sites I set
> up with mod_python, I get a generic Internal Server Error, with the
> following in error_log:
> 
> [Sun Jun 24 10:55:16 2007] [error] make_obcallback: could not import
> mod_python.apache.\n
> Traceback (most recent call last):
>  File "/usr/local/lib/python2.4/site-packages/mod_python/apache.py",
> line 21, in ?
>    import traceback
>  File "/usr/local/lib/python2.4/traceback.py", line 3, in ?
>    import linecache
> ImportError: No module named linecache
> [Sun Jun 24 10:55:16 2007] [error] make_obcallback: Python path being
> used "['/usr/local/lib/python2.4/site-packages/setuptools-0.6c1-py2.4.egg',
> '/usr/local/lib/python2.4/site-packages/Django-0.95-py2.4.egg',
> '/usr/local/lib/python24.zip', '/usr/local/lib/python2.4',
> '/usr/local/lib/python2.4/plat-linux2',
> '/usr/local/lib/python2.4/lib-tk',
> '/usr/local/lib/python2.4/lib-dynload',
> '/usr/local/lib/python2.4/site-packages']".
> [Sun Jun 24 10:55:16 2007] [error] get_interpreter: no interpreter
> callback found.
> 
> But when I load up python interactively, it works just fine, loading
> both traceback and linecache individually:
> 
>>>> import traceback
>>>> import linecache
>>>>
> 
> I tried the post-install troubleshooting step[1] to provide additional
> information, but accessing that URL results in the same error listed
> above.
> 
> As this is my first foray into mod_python, I can't quite figure out
> what I'm doing wrong. Below is as much background information as I
> could think to include.
> 
> Apache:
> # /usr/local/apache2/bin/httpd -v
> Server version: Apache/2.2.2
> Server built:   May 12 2007 21:31:02
> 
> Mod_python:
>>>> import mod_python
>>>> mod_python.version
> '3.3.1'
> 
> Python:
> # python -V
> Python 2.4.3
> 
> VirtualHost config:
> <VirtualHost *:80>
> ServerName dev.mysite.com
> PythonPath "['/path/to/project'] + sys.path"
> SetHandler python-program
> PythonHandler django.core.handlers.modpython
> SetEnv DJANGO_SETTINGS_MODULE mysite.settings
> PythonDebug On
> 
> <Location /trac>
> SetHandler mod_python
> PythonHandler trac.web.modpython_frontend
> PythonOption TracEnv /path/to/env
> PythonOption TracUriRoot /trac
> </Location>
> </VirtualHost>
> 
> -Gul
> 
> [1] 
> http://www.modpython.org/live/mod_python-3.3.1/doc-html/inst-trouble.html
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 

From graham.dumpleton at gmail.com  Sun Jun 24 19:35:26 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sun Jun 24 19:35:32 2007
Subject: [mod_python] object type. why it not works?
In-Reply-To: <5aaed53f0706232211q5ae25488qd87f8d1aa6eb8ae4@mail.gmail.com>
References: <ca4f20450706231334n476ff40bge2cc018c29955745@mail.gmail.com>
	<5aaed53f0706232211q5ae25488qd87f8d1aa6eb8ae4@mail.gmail.com>
Message-ID: <88e286470706241635p4f7abb12ue4499fd97b0f9075@mail.gmail.com>

On 24/06/07, Jeff Hinrichs - DM&T <jeffh@dundeemt.com> wrote:
> On 6/23/07, ziapannocchia@gmail.com <ziapannocchia@gmail.com> wrote:
> > I have a selfmade apache server, and I'm writing  a little web
> > application with mod python.
> >
> > Using this def:
> >
> > def testPython(contenuto):
> >   test="test"
> >   return type(test)
> >
> > I obtain this error:
> >
> > Mod_python error: "PythonHandler mod_python.publisher"
> >
> > Traceback (most recent call last):
> >
> >   File "/usr/lib64/python2.4/site-packages/mod_python/apache.py", line
> > 299, in HandlerDispatch
> >     result = object(req)
> >
> >   File "/usr/lib64/python2.4/site-packages/mod_python/publisher.py",
> > line 213, in handler
> >     published = publish_object(req, object)
> >
> >   File "/usr/lib64/python2.4/site-packages/mod_python/publisher.py",
> > line 412, in publish_object
> >     return publish_object(req,util.apply_fs_data(object, req.form, req=req))
> >
> >   File "/usr/lib64/python2.4/site-packages/mod_python/publisher.py",
> > line 412, in publish_object
> >     return publish_object(req,util.apply_fs_data(object, req.form, req=req))
> >
> >   File "/usr/lib64/python2.4/site-packages/mod_python/util.py", line
> > 401, in apply_fs_data
> >     fc = object.__init__.im_func.func_code
> >
> > AttributeError: 'wrapper_descriptor' object has no attribute 'im_func'
> >
> > Instead, on command line, the same istruction works well:
> >
> > cloc3@s939 /home/cloc3 $ python
> > Python 2.4.4 (#1, May 18 2007, 08:25:49)
> > [GCC 4.1.2 (Gentoo 4.1.2)] on linux2
> > Type "help", "copyright", "credits" or "license" for more information.
> > >>> test="test"
> > >>> type(test)
> > <type 'str'>
> >
> >
> > What may be wrong?
>
> Publisher wants to return a string -- and you are attempting to return
> an object, http://docs.python.org/lib/bltin-type-objects.html
>
> try, return test  --or-- return str(type(test))

Actually, you are supposed to be able  to return anything from a
published function which can be converted to a string. Thus one can
return integers, dictionaries, lists, or custom data types provided
they defined a __str__() method.

Now, there is actually a problem here and it derives from fact that
publisher does something that I didn't even realise. Question is
whether it is an inadvertent feature added by accident or whether it
was intentional.

The problem is with the function:

def publish_object(req, object):
    if callable(object):

        # To publish callables, we call them an recursively publish the result
        # of the call (as done by util.apply_fs_data)

        req.form = util.FieldStorage(req, keep_blank_values=1)
        return publish_object(req,util.apply_fs_data(object, req.form, req=req))

    else:
       ...

The intent of this function is that it is called with the object which
the URL got matched to. If the target wasn't callable then resulted
would be that it gets converted to a string and written back as
response.

If the target was callable, then util.apply_fs_data() is called to
actually make the call against the target object. The result of this
is then passed back into publish_object() in a second call to have the
resulted converted to a string and written back as response.

Problem is that in calling publish_object() a second time, if the
result of calling util.apply_fs_data() was itself a callable, then a
subsequent attempt will be made to call that.

At this point I am going to assume that this wasn't intentional, and
if it was then it has a bug for other reasons besides what is being
seen. Namely, it creates an instance of util.FieldStorage on every
call and assigns it to req.form. This means that form data would get
wiped on a recursive call to a second callable object. If the feature
was intentional, then it should check to see if req.form exists and
use it rather than creating util.FieldStorage.

So, there are a few issues here that need to be sorted out.

1. Should publisher invoke a callable object returned by a function.

2. If answer to 1 is yes, then how form data is managed needs to be fixed.

3. If answer to 1 is yes, then before recursively calling a callable
then publisher should apply its rule set to ensure it isn't calling an
object type it isn't supposed to.

In respect of 3, if one has:

  index = type("test")

then accessing index will result in Forbidden response as rule set
denies access, not so with the recursive call though.

Anyone got any opinions on whether publisher should do 1?

Graham
From graham.dumpleton at gmail.com  Sun Jun 24 19:49:19 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sun Jun 24 19:49:24 2007
Subject: [mod_python] ImportError: No module named linecache
In-Reply-To: <467EA162.9030703@jgassociates.ca>
References: <7e8d40920706240924x5abc4cafr3f2a06cfabf87520@mail.gmail.com>
	<467EA162.9030703@jgassociates.ca>
Message-ID: <88e286470706241649ua4f1b3fucdefe277fba81fed@mail.gmail.com>

If you do have multiple Python versions, read:

  https://issues.apache.org/jira/browse/MODPYTHON-225

Also run the command line python executable for the version you expect
to be able to use and go:

  import mod_python

If it doesn't find the module, then Python component parts of
mod_python not installed for that version.

Graham

On 25/06/07, Jim Gallacher <jpg@jgassociates.ca> wrote:
> Hi Marty,
>
> Any chance you have multiple versions of python installed?
>
> If so make sure the correct python is listed first in your PATH in the
> context of the user that runs apache.
>
> Jim
>
> Marty Alchin wrote:
> > Hello all,
> >
> > This is my first time venturing into the world of mod_python, and I'm
> > having a bit of trouble getting it working. I'm trying to use it with
> > Django and with Trac, but both have the same problem, so it seems like
> > it's something with my mod_python setup in general.
> >
> > Apache starts fine, but when I try to view either of the sites I set
> > up with mod_python, I get a generic Internal Server Error, with the
> > following in error_log:
> >
> > [Sun Jun 24 10:55:16 2007] [error] make_obcallback: could not import
> > mod_python.apache.\n
> > Traceback (most recent call last):
> >  File "/usr/local/lib/python2.4/site-packages/mod_python/apache.py",
> > line 21, in ?
> >    import traceback
> >  File "/usr/local/lib/python2.4/traceback.py", line 3, in ?
> >    import linecache
> > ImportError: No module named linecache
> > [Sun Jun 24 10:55:16 2007] [error] make_obcallback: Python path being
> > used "['/usr/local/lib/python2.4/site-packages/setuptools-0.6c1-py2.4.egg',
> > '/usr/local/lib/python2.4/site-packages/Django-0.95-py2.4.egg',
> > '/usr/local/lib/python24.zip', '/usr/local/lib/python2.4',
> > '/usr/local/lib/python2.4/plat-linux2',
> > '/usr/local/lib/python2.4/lib-tk',
> > '/usr/local/lib/python2.4/lib-dynload',
> > '/usr/local/lib/python2.4/site-packages']".
> > [Sun Jun 24 10:55:16 2007] [error] get_interpreter: no interpreter
> > callback found.
> >
> > But when I load up python interactively, it works just fine, loading
> > both traceback and linecache individually:
> >
> >>>> import traceback
> >>>> import linecache
> >>>>
> >
> > I tried the post-install troubleshooting step[1] to provide additional
> > information, but accessing that URL results in the same error listed
> > above.
> >
> > As this is my first foray into mod_python, I can't quite figure out
> > what I'm doing wrong. Below is as much background information as I
> > could think to include.
> >
> > Apache:
> > # /usr/local/apache2/bin/httpd -v
> > Server version: Apache/2.2.2
> > Server built:   May 12 2007 21:31:02
> >
> > Mod_python:
> >>>> import mod_python
> >>>> mod_python.version
> > '3.3.1'
> >
> > Python:
> > # python -V
> > Python 2.4.3
> >
> > VirtualHost config:
> > <VirtualHost *:80>
> > ServerName dev.mysite.com
> > PythonPath "['/path/to/project'] + sys.path"
> > SetHandler python-program
> > PythonHandler django.core.handlers.modpython
> > SetEnv DJANGO_SETTINGS_MODULE mysite.settings
> > PythonDebug On
> >
> > <Location /trac>
> > SetHandler mod_python
> > PythonHandler trac.web.modpython_frontend
> > PythonOption TracEnv /path/to/env
> > PythonOption TracUriRoot /trac
> > </Location>
> > </VirtualHost>
> >
> > -Gul
> >
> > [1]
> > http://www.modpython.org/live/mod_python-3.3.1/doc-html/inst-trouble.html
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From graham.dumpleton at gmail.com  Sun Jun 24 22:35:12 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sun Jun 24 22:35:20 2007
Subject: [mod_python] ImportError: No module named linecache
In-Reply-To: <7e8d40920706241920pd8c5078u868960c109222fac@mail.gmail.com>
References: <7e8d40920706240924x5abc4cafr3f2a06cfabf87520@mail.gmail.com>
	<467EA162.9030703@jgassociates.ca>
	<88e286470706241649ua4f1b3fucdefe277fba81fed@mail.gmail.com>
	<7e8d40920706241920pd8c5078u868960c109222fac@mail.gmail.com>
Message-ID: <88e286470706241935p6cb734y28efbf0c475ec137@mail.gmail.com>

On 25/06/07, Marty Alchin <gulopine@gamemusic.org> wrote:
> On 6/24/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> >   https://issues.apache.org/jira/browse/MODPYTHON-225
>
> It looks like that's mostly for situations where mod_python is being
> run in a different version of Python than it was compiled for, is that
> right?

No as you can't run it with a different version than what it was
compiled for. At least not a different major/minor version number.

It relates to where Python is installed in non standard location like
/usr/local/bin but python found in path of Apache is in /usr/bin.

> If that's the case, how can I tell which one mod_python was
> compiled against?

If you have compile from source and wanted to use something other than
the default, you should have used --with-python option to configure.

> As for specifying PATH directly for Apache, I tried the following, and
> it didn't seem to make a difference, but if mod_python was compiled
> against the wrong Python, I expect this wouldn't make any difference.
>
> # env PATH=/usr/local/lib/python2.4:$PATH /usr/local/apache2/bin/httpd -k start

Use:

  env PATH=/usr/local/bin:$PATH /usr/local/apache2/bin/httpd -k start

You need to add bin directory not lib directory to PATH.

> > Also run the command line python executable for the version you expect
> > to be able to use and go:
> >
> >   import mod_python
>
> # sudo -u apache python
> Python 2.4.3 (#1, May 12 2007, 21:38:42)
> [GCC 3.4.6 20060404 (Red Hat 3.4.6-3)] on linux2
> Type "help", "copyright", "credits" or "license" for more information.
> >>> import mod_python
> >>>
>
> That's the preferred user, as well as the preferred version of Python,
> and it imports just fine. Of course, "from mod_python import apache"
> fails, but with the expected _apache ImportError, so that seems fine.

What about linecache. Forgot to ask that.

Is it possible that that module (.py or .pyc)  in Python installation
is not readable to the Apache user.

> Might I have to recompile mod_python and specify the intended Python
> installation?

If you didn't explicitly compile it for the version you want to be
used then perhaps. Use --with-python option as mentioned before.

PS, please use reply-all to keep discussion on list.

Graham
From jeffh at dundeemt.com  Sun Jun 24 23:05:09 2007
From: jeffh at dundeemt.com (Jeff Hinrichs - DM&T)
Date: Sun Jun 24 23:05:15 2007
Subject: [mod_python] object type. why it not works?
In-Reply-To: <88e286470706241635p4f7abb12ue4499fd97b0f9075@mail.gmail.com>
References: <ca4f20450706231334n476ff40bge2cc018c29955745@mail.gmail.com>
	<5aaed53f0706232211q5ae25488qd87f8d1aa6eb8ae4@mail.gmail.com>
	<88e286470706241635p4f7abb12ue4499fd97b0f9075@mail.gmail.com>
Message-ID: <5aaed53f0706242005q392736d6tcc99488c23b30688@mail.gmail.com>

On 6/24/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> On 24/06/07, Jeff Hinrichs - DM&T <jeffh@dundeemt.com> wrote:
> > On 6/23/07, ziapannocchia@gmail.com <ziapannocchia@gmail.com> wrote:
> > > I have a selfmade apache server, and I'm writing  a little web
> > > application with mod python.
> > >
> > > Using this def:
> > >
> > > def testPython(contenuto):
> > >   test="test"
> > >   return type(test)
> > >
> > > I obtain this error:
> > >
> > > Mod_python error: "PythonHandler mod_python.publisher"
> > >
> > > Traceback (most recent call last):
> > >
> > >   File "/usr/lib64/python2.4/site-packages/mod_python/apache.py", line
> > > 299, in HandlerDispatch
> > >     result = object(req)
> > >
> > >   File "/usr/lib64/python2.4/site-packages/mod_python/publisher.py",
> > > line 213, in handler
> > >     published = publish_object(req, object)
> > >
> > >   File "/usr/lib64/python2.4/site-packages/mod_python/publisher.py",
> > > line 412, in publish_object
> > >     return publish_object(req,util.apply_fs_data(object, req.form, req=req))
> > >
> > >   File "/usr/lib64/python2.4/site-packages/mod_python/publisher.py",
> > > line 412, in publish_object
> > >     return publish_object(req,util.apply_fs_data(object, req.form, req=req))
> > >
> > >   File "/usr/lib64/python2.4/site-packages/mod_python/util.py", line
> > > 401, in apply_fs_data
> > >     fc = object.__init__.im_func.func_code
> > >
> > > AttributeError: 'wrapper_descriptor' object has no attribute 'im_func'
> > >
> > > Instead, on command line, the same istruction works well:
> > >
> > > cloc3@s939 /home/cloc3 $ python
> > > Python 2.4.4 (#1, May 18 2007, 08:25:49)
> > > [GCC 4.1.2 (Gentoo 4.1.2)] on linux2
> > > Type "help", "copyright", "credits" or "license" for more information.
> > > >>> test="test"
> > > >>> type(test)
> > > <type 'str'>
> > >
> > >
> > > What may be wrong?
> >
> > Publisher wants to return a string -- and you are attempting to return
> > an object, http://docs.python.org/lib/bltin-type-objects.html
> >
> > try, return test  --or-- return str(type(test))
>
> Actually, you are supposed to be able  to return anything from a
> published function which can be converted to a string. Thus one can
> return integers, dictionaries, lists, or custom data types provided
> they defined a __str__() method.
>
> Now, there is actually a problem here and it derives from fact that
> publisher does something that I didn't even realise. Question is
> whether it is an inadvertent feature added by accident or whether it
> was intentional.
>
> The problem is with the function:
>
> def publish_object(req, object):
>     if callable(object):
>
>         # To publish callables, we call them an recursively publish the result
>         # of the call (as done by util.apply_fs_data)
>
>         req.form = util.FieldStorage(req, keep_blank_values=1)
>         return publish_object(req,util.apply_fs_data(object, req.form, req=req))
>
>     else:
>        ...
>
> The intent of this function is that it is called with the object which
> the URL got matched to. If the target wasn't callable then resulted
> would be that it gets converted to a string and written back as
> response.
>
> If the target was callable, then util.apply_fs_data() is called to
> actually make the call against the target object. The result of this
> is then passed back into publish_object() in a second call to have the
> resulted converted to a string and written back as response.
>
> Problem is that in calling publish_object() a second time, if the
> result of calling util.apply_fs_data() was itself a callable, then a
> subsequent attempt will be made to call that.
>
> At this point I am going to assume that this wasn't intentional, and
> if it was then it has a bug for other reasons besides what is being
> seen. Namely, it creates an instance of util.FieldStorage on every
> call and assigns it to req.form. This means that form data would get
> wiped on a recursive call to a second callable object. If the feature
> was intentional, then it should check to see if req.form exists and
> use it rather than creating util.FieldStorage.
>
> So, there are a few issues here that need to be sorted out.
>
> 1. Should publisher invoke a callable object returned by a function.
>
> 2. If answer to 1 is yes, then how form data is managed needs to be fixed.
>
> 3. If answer to 1 is yes, then before recursively calling a callable
> then publisher should apply its rule set to ensure it isn't calling an
> object type it isn't supposed to.
>
> In respect of 3, if one has:
>
>   index = type("test")
>
> then accessing index will result in Forbidden response as rule set
> denies access, not so with the recursive call though.
>
> Anyone got any opinions on whether publisher should do 1?
>
> Graham
>

Graham,

If it is a bug, it's been around for some time (at least 3.1).  I
don't have a problem with it expecting the return variable to be
flattenable to a string.  However, vampire works as you intended -- I
believe.

vampire returns
  <type 'str'>

for:
class Callable:

    def test(self,req):

        t = "test"

        return type(t)



callable = Callable()


So, I would vote for 1, because it was how publisher was intended
before this unnoticed "bug" was found.  Personally, I'm in favor of
replacing publisher with vampire -- why hasn't that happened? vampire
does everything publisher does, in my experience, and then does the
other things I need/want.

Ziapannocchia -- you should check the vampire module out.
http://www.dscpl.com.au/projects/vampire/  Not to dump on publisher -
but vampire offers some real advantages over the stock publisher.
Graham did a bang up job on it. (Thanks Graham)

-Jeff
From graham.dumpleton at gmail.com  Mon Jun 25 01:06:34 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon Jun 25 01:06:39 2007
Subject: [mod_python] object type. why it not works?
In-Reply-To: <5aaed53f0706242005q392736d6tcc99488c23b30688@mail.gmail.com>
References: <ca4f20450706231334n476ff40bge2cc018c29955745@mail.gmail.com>
	<5aaed53f0706232211q5ae25488qd87f8d1aa6eb8ae4@mail.gmail.com>
	<88e286470706241635p4f7abb12ue4499fd97b0f9075@mail.gmail.com>
	<5aaed53f0706242005q392736d6tcc99488c23b30688@mail.gmail.com>
Message-ID: <88e286470706242206g5cbd3574p6c4b73d6ab213478@mail.gmail.com>

> Personally, I'm in favor of
> replacing publisher with vampire -- why hasn't that happened? vampire
> does everything publisher does, in my experience, and then does the
> other things I need/want.
>
> Ziapannocchia -- you should check the vampire module out.
> http://www.dscpl.com.au/projects/vampire/  Not to dump on publisher -
> but vampire offers some real advantages over the stock publisher.
> Graham did a bang up job on it. (Thanks Graham)

Putting a publisher like handler in Vampire was born out of the
frustration of having to answer too many questions around the fact
that the mod_python 2.7.10 version of publisher didn't work the same
as the mod_python 3.1.4 version. These differences were in part
because of feature additions, but also because of bugs. Luckily
mod_python 2.7.10 seems to finally be dying out as people get rid of
Apache 1.3.

Now although I cleaned up certain things in the Vampire publisher I
couldn't go as far as I would have liked as then it wouldn't have been
compatible. I would really liked to have addressed the whole trailing
slash problem in publisher whereby it is too easy for relative paths
to get wholly screwed up because of there being multiple URLs that can
map to a resource. But then, I know some people think publisher not
being strictly correct a good thing.

With all my work on mod_wsgi I'm not sure where Vampire stands at the
moment. Although Vampire works with mod_python 3.3, it still actually
ignores the new mod_python importer. I'm not sure whether I'll address
that, or whether down the track sometime I would instead take Vampire
or parts of it and rehost it as either a WSGI application, or on top
of some mod_python like extension of mod_wsgi that I have in mind
where Apache APIs get wrapped by SWIG instead of being hand crafted as
in mod_python.

It is hard to know what to do and whether I am already possibly been
seen as being a heretic for doing mod_wsgi and thus moving away from
mod_python. This will only get worse when I start work on some
companion modules for mod_wsgi I have in mind which would be a more
direct competitor to mod_python. One wouldn't necessarily be able to
make it totally compatible, but it wouldn't be too hard to provide a
mod_python like API for basic handlers and publisher on top of what I
intend creating.

In some respects I am progressing down a path I once discussed on the
mod_python developers list captured in:

  http://www.modpython.org/pipermail/mod_python/2006-December/022841.html
  http://www.modpython.org/pipermail/mod_python/2006-December/022881.html

although my ideas have changed a little bit know. I have chosen though
for now to progress this outside of the ASF as my own project.

BTW, for anyone interested, the code for mod_wsgi is all complete. Am
now trying to create more documentation, although what is there
already isn't that inconsequential. Aiming for an actual 1.0 release
towards middle of July. If at all interested mod_wsgi can be found at
www.modwsgi.org. If curious as to where I intend going with mod_wsgi
after that, probably wouldn't been too hard to get me talking about
it, but not sure here is the most appropriate place. Thus might be
better to take such a conversation over to the mod_wsgi list.

Graham
From gulopine at gamemusic.org  Mon Jun 25 07:23:51 2007
From: gulopine at gamemusic.org (Marty Alchin)
Date: Mon Jun 25 07:23:59 2007
Subject: [mod_python] ImportError: No module named linecache
In-Reply-To: <88e286470706241935p6cb734y28efbf0c475ec137@mail.gmail.com>
References: <7e8d40920706240924x5abc4cafr3f2a06cfabf87520@mail.gmail.com>
	<467EA162.9030703@jgassociates.ca>
	<88e286470706241649ua4f1b3fucdefe277fba81fed@mail.gmail.com>
	<7e8d40920706241920pd8c5078u868960c109222fac@mail.gmail.com>
	<88e286470706241935p6cb734y28efbf0c475ec137@mail.gmail.com>
Message-ID: <7e8d40920706250423i1becbcd9v3463c6dda6e4d737@mail.gmail.com>

On 6/24/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> > As for specifying PATH directly for Apache, I tried the following, and
> > it didn't seem to make a difference, but if mod_python was compiled
> > against the wrong Python, I expect this wouldn't make any difference.
> >
> > # env PATH=/usr/local/lib/python2.4:$PATH /usr/local/apache2/bin/httpd -k start
>
> Use:
>
>   env PATH=/usr/local/bin:$PATH /usr/local/apache2/bin/httpd -k start
>
> You need to add bin directory not lib directory to PATH.

Unfortunately, that seems to have no impact.

> > > Also run the command line python executable for the version you expect
> > > to be able to use and go:
> > >
> > >   import mod_python
> >
> > # sudo -u apache python
> > Python 2.4.3 (#1, May 12 2007, 21:38:42)
> > [GCC 3.4.6 20060404 (Red Hat 3.4.6-3)] on linux2
> > Type "help", "copyright", "credits" or "license" for more information.
> > >>> import mod_python
> > >>>
> >
> > That's the preferred user, as well as the preferred version of Python,
> > and it imports just fine. Of course, "from mod_python import apache"
> > fails, but with the expected _apache ImportError, so that seems fine.
>
> What about linecache. Forgot to ask that.
>
> Is it possible that that module (.py or .pyc)  in Python installation
> is not readable to the Apache user.

Since I hadn't been replying to the whole list, you missed my reply to
Jim regarding that:

# sudo -u apache python
Python 2.4.3 (#1, May 12 2007, 21:38:42)
[GCC 3.4.6 20060404 (Red Hat 3.4.6-3)] on linux2
Type "help", "copyright", "credits" or "license" for more information.
>>> import traceback
>>> import linecache
>>>

Everything imports fine in this case.

> > Might I have to recompile mod_python and specify the intended Python
> > installation?
>
> If you didn't explicitly compile it for the version you want to be
> used then perhaps. Use --with-python option as mentioned before.

I'll give that a shot and report back. Thanks for the help.

> PS, please use reply-all to keep discussion on list.

Whoops, sorry about that! I'm used to lists that put the list's email
in the reply-to, so I didn't even think to check the headers before
replying.

-Gul
From ah at hatzis.de  Mon Jun 25 09:47:55 2007
From: ah at hatzis.de (Anastasios Hatzis)
Date: Mon Jun 25 09:48:11 2007
Subject: [mod_python] UnicodeDecodeError with
	util.FieldStorage(req).Field.value
In-Reply-To: <d80792120706231113v402284b0jbfb106953cba4503@mail.gmail.com>
References: <200706201923.46099.ah@hatzis.de>
	<d80792120706231113v402284b0jbfb106953cba4503@mail.gmail.com>
Message-ID: <200706251548.00235.ah@hatzis.de>

On Saturday 23 June 2007, Martin wrote:
> Have seen that Graham has responded now, but a few things need clarifying.
>
> On 20/06/07, Anastasios Hatzis <ah@hatzis.de> wrote:

[...]

Graham, Martin

Thank you for your help. Charsets and encoding is definitely the most 
difficult thing for me in programming. In case of Python I always expect 
encode() to the opposite of what it is actually doing and vice versa. :/

However, the following worked for me:

        email_body = u'\r\n'
        for param in store.list:
            email_body += unicode(param.name, 'utf-8') + ': ' + \                 
			      unicode(param.value, 'utf-8') + '\r\n'

Again, thank you.

Anastasios
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 307 bytes
Desc: not available
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070625/64c12890/attachment.bin
From gulopine at gamemusic.org  Mon Jun 25 10:45:45 2007
From: gulopine at gamemusic.org (Marty Alchin)
Date: Mon Jun 25 10:45:51 2007
Subject: [mod_python] ImportError: No module named linecache
In-Reply-To: <7e8d40920706250423i1becbcd9v3463c6dda6e4d737@mail.gmail.com>
References: <7e8d40920706240924x5abc4cafr3f2a06cfabf87520@mail.gmail.com>
	<467EA162.9030703@jgassociates.ca>
	<88e286470706241649ua4f1b3fucdefe277fba81fed@mail.gmail.com>
	<7e8d40920706241920pd8c5078u868960c109222fac@mail.gmail.com>
	<88e286470706241935p6cb734y28efbf0c475ec137@mail.gmail.com>
	<7e8d40920706250423i1becbcd9v3463c6dda6e4d737@mail.gmail.com>
Message-ID: <7e8d40920706250745w10289e02ndb1441a857f2f2c3@mail.gmail.com>

On 6/25/07, Marty Alchin <gulopine@gamemusic.org> wrote:
> > > Might I have to recompile mod_python and specify the intended Python
> > > installation?
> >
> > If you didn't explicitly compile it for the version you want to be
> > used then perhaps. Use --with-python option as mentioned before.
>
> I'll give that a shot and report back. Thanks for the help.

Well, I just did that this morning, making sure it was compiled
against the right version at the right location, and I still get the
same error. The really strange thing to me is that it can find
traceback, but not linecache, even though they're at the same
location.

I even tried using PythonImport to try to force loading linecache in
advance, but all that accomplished was to generate the ImportError
each time a new process starts, as well as on each mod_python request.

-Gul
From ziapannocchia at gmail.com  Mon Jun 25 16:46:37 2007
From: ziapannocchia at gmail.com (ziapannocchia@gmail.com)
Date: Mon Jun 25 16:46:46 2007
Subject: [mod_python] object type. why it not works?
In-Reply-To: <5aaed53f0706242005q392736d6tcc99488c23b30688@mail.gmail.com>
References: <ca4f20450706231334n476ff40bge2cc018c29955745@mail.gmail.com>
	<5aaed53f0706232211q5ae25488qd87f8d1aa6eb8ae4@mail.gmail.com>
	<88e286470706241635p4f7abb12ue4499fd97b0f9075@mail.gmail.com>
	<5aaed53f0706242005q392736d6tcc99488c23b30688@mail.gmail.com>
Message-ID: <ca4f20450706251346q11405bfcyf7bfb2bbe08e0d2b@mail.gmail.com>

2007/6/25, Jeff Hinrichs - DM&T <jeffh@dundeemt.com>:

> Ziapannocchia -- you should check the vampire module out.
> http://www.dscpl.com.au/projects/vampire/  Not to dump on publisher -
> but vampire offers some real advantages over the stock publisher.
> Graham did a bang up job on it. (Thanks Graham)
>
> -Jeff
>
thank a lot.
for the moment, my goal is to learn python and web applications, and
the choice between one or the other publisher doe's not matter for me,
beacause I'm just a noob. If something is not perfect, it's a problem
of mine, not of the publisher.

Anyway, I'm happy for this interesting discussion, even if it is too
much over my limits, and I've just follow your links.
From graham.dumpleton at gmail.com  Mon Jun 25 18:25:40 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon Jun 25 18:25:47 2007
Subject: [mod_python] ImportError: No module named linecache
In-Reply-To: <7e8d40920706250745w10289e02ndb1441a857f2f2c3@mail.gmail.com>
References: <7e8d40920706240924x5abc4cafr3f2a06cfabf87520@mail.gmail.com>
	<467EA162.9030703@jgassociates.ca>
	<88e286470706241649ua4f1b3fucdefe277fba81fed@mail.gmail.com>
	<7e8d40920706241920pd8c5078u868960c109222fac@mail.gmail.com>
	<88e286470706241935p6cb734y28efbf0c475ec137@mail.gmail.com>
	<7e8d40920706250423i1becbcd9v3463c6dda6e4d737@mail.gmail.com>
	<7e8d40920706250745w10289e02ndb1441a857f2f2c3@mail.gmail.com>
Message-ID: <88e286470706251525x425f7aaj1a000f00d86b47c9@mail.gmail.com>

On 26/06/07, Marty Alchin <gulopine@gamemusic.org> wrote:
> On 6/25/07, Marty Alchin <gulopine@gamemusic.org> wrote:
> > > > Might I have to recompile mod_python and specify the intended Python
> > > > installation?
> > >
> > > If you didn't explicitly compile it for the version you want to be
> > > used then perhaps. Use --with-python option as mentioned before.
> >
> > I'll give that a shot and report back. Thanks for the help.
>
> Well, I just did that this morning, making sure it was compiled
> against the right version at the right location, and I still get the
> same error. The really strange thing to me is that it can find
> traceback, but not linecache, even though they're at the same
> location.
>
> I even tried using PythonImport to try to force loading linecache in
> advance, but all that accomplished was to generate the ImportError
> each time a new process starts, as well as on each mod_python request.

Your only choice it would seem is to start instrumenting the
mod_python code with debug, ie., write out to log using
_apache.log_error() at appropriate spots. You may have to move _apache
import to first in the mod_python.apache file so you can access it and
write debug between the various imports or where ever else required.
Suggest that you try dumping out value of __file__ in modules to
determine where modules are coming from so you know they are coming
from where you think they should. Also dump out values of sys.path.
Check permissions on every directory and file in sys.path etc etc.

Graham
From gulopine at gamemusic.org  Mon Jun 25 21:20:21 2007
From: gulopine at gamemusic.org (Marty Alchin)
Date: Mon Jun 25 21:20:27 2007
Subject: [mod_python] ImportError: No module named linecache
In-Reply-To: <88e286470706251525x425f7aaj1a000f00d86b47c9@mail.gmail.com>
References: <7e8d40920706240924x5abc4cafr3f2a06cfabf87520@mail.gmail.com>
	<467EA162.9030703@jgassociates.ca>
	<88e286470706241649ua4f1b3fucdefe277fba81fed@mail.gmail.com>
	<7e8d40920706241920pd8c5078u868960c109222fac@mail.gmail.com>
	<88e286470706241935p6cb734y28efbf0c475ec137@mail.gmail.com>
	<7e8d40920706250423i1becbcd9v3463c6dda6e4d737@mail.gmail.com>
	<7e8d40920706250745w10289e02ndb1441a857f2f2c3@mail.gmail.com>
	<88e286470706251525x425f7aaj1a000f00d86b47c9@mail.gmail.com>
Message-ID: <7e8d40920706251820v602b9028j6130b8ddfedeffc5@mail.gmail.com>

On 6/25/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> Your only choice it would seem is to start instrumenting the
> mod_python code with debug, ie., write out to log using
> _apache.log_error() at appropriate spots. You may have to move _apache
> import to first in the mod_python.apache file so you can access it and
> write debug between the various imports or where ever else required.
> Suggest that you try dumping out value of __file__ in modules to
> determine where modules are coming from so you know they are coming
> from where you think they should. Also dump out values of sys.path.

Well, I decided to try this out, and I seem to be even more confused
than before. After editing mod_python's apache.py, the same error came
up, with the same line numbers, and without my debugging information.
Initially I thought it was just blindly using the pyc or pyo files
without recompiling from source, so I moved both of them to have a
non-Python location, and it's still using the file as it originally
shipped.

Am I missing something here? Does this somehow get compiled in somewhere else?

-Gul
From graham.dumpleton at gmail.com  Mon Jun 25 21:32:17 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon Jun 25 21:32:22 2007
Subject: [mod_python] ImportError: No module named linecache
In-Reply-To: <7e8d40920706251820v602b9028j6130b8ddfedeffc5@mail.gmail.com>
References: <7e8d40920706240924x5abc4cafr3f2a06cfabf87520@mail.gmail.com>
	<467EA162.9030703@jgassociates.ca>
	<88e286470706241649ua4f1b3fucdefe277fba81fed@mail.gmail.com>
	<7e8d40920706241920pd8c5078u868960c109222fac@mail.gmail.com>
	<88e286470706241935p6cb734y28efbf0c475ec137@mail.gmail.com>
	<7e8d40920706250423i1becbcd9v3463c6dda6e4d737@mail.gmail.com>
	<7e8d40920706250745w10289e02ndb1441a857f2f2c3@mail.gmail.com>
	<88e286470706251525x425f7aaj1a000f00d86b47c9@mail.gmail.com>
	<7e8d40920706251820v602b9028j6130b8ddfedeffc5@mail.gmail.com>
Message-ID: <88e286470706251832l301a18c7qd30a5a1a250ed577@mail.gmail.com>

On 26/06/07, Marty Alchin <gulopine@gamemusic.org> wrote:
> On 6/25/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> > Your only choice it would seem is to start instrumenting the
> > mod_python code with debug, ie., write out to log using
> > _apache.log_error() at appropriate spots. You may have to move _apache
> > import to first in the mod_python.apache file so you can access it and
> > write debug between the various imports or where ever else required.
> > Suggest that you try dumping out value of __file__ in modules to
> > determine where modules are coming from so you know they are coming
> > from where you think they should. Also dump out values of sys.path.
>
> Well, I decided to try this out, and I seem to be even more confused
> than before. After editing mod_python's apache.py, the same error came
> up, with the same line numbers, and without my debugging information.
> Initially I thought it was just blindly using the pyc or pyo files
> without recompiling from source, so I moved both of them to have a
> non-Python location, and it's still using the file as it originally
> shipped.
>
> Am I missing something here? Does this somehow get compiled in somewhere else?

Are you installing that version then doing a full stop/start (not a
restart or graceful) of Apache.

Can you rebuild mod_python against the standard OS supplied version of
Python in /usr/bin and ignore your version in /usr/local/bin and see
if that works. Ensure that /usr/local/bin is not in PATH of Apache.
Half the time these strange sorts of problems are because of using a
Python not installed in standard location, so would be good to see if
it works with the one in the standard location or not.

Graham
From steino at ccri.net  Tue Jun 26 10:59:23 2007
From: steino at ccri.net (Olaf Stein)
Date: Tue Jun 26 11:00:07 2007
Subject: [mod_python] Import problem
In-Reply-To: <88e286470706221542m15f201a1r87934401a8e625b4@mail.gmail.com>
Message-ID: <C2A6A20B.3A4B%steino@ccri.net>

Graham

Thanks for your reply but I do not think this is my problem.
I have the same code running on a production server,also using mod_python
3.3.1. I am also pretty sure that on the system where I have the error, the
previosuly installed version was 3.3.1, so nothing really changed.

Could this be related to the way I configure apache before compiling?

Thanks
Olaf


On 6/22/07 6:42 PM, "Graham Dumpleton" <graham.dumpleton@gmail.com> wrote:

> Did you upgrade to mod_python 3.3.1 from an older version at the same time?
> 
> There was one incompatible change going to mod_python 3.3.1 from older
> versions. This was where the handler directory is no longer put into
> sys.path. This doesn't cause any problems if using file based modules
> in the same directory, but does if you have a Python package in the
> same directory.
> 
> Further information can be had by reading the documentation for
> apache.import_module() in:
> 
>   http://www.modpython.org/live/current/doc-html/pyapi-apmeth.html
> 
> If that stuff in the directory is a true Python package with
> __init__.py having side affects, then only choice is to move the
> directory to outside of the document tree and then use PythonPath
> directive to specify where it is located. Other alternative is to
> treat your directory as a pseudo package as described in the
> documentation.
> 
> Anyway, read the documentation and come back if you have more
> questions or need something explained.
> 
> Graham
> 
> On 23/06/07, Olaf Stein <steino@ccri.net> wrote:
>> In the folders where cqcb.py is located there is a folder simpla, with a
>> file called mod_simpla.py
>> 
>> This same code used to work that's why this is weird
>> 
>> 
>> On 6/22/07 12:00 PM, "Jim Gallacher" <jpg@jgassociates.ca> wrote:
>> 
>>> Olaf Stein wrote:
>>>> Hi all,
>>>> 
>>>> I am running into this really weird problem:
>>>> I am on a mac, apache 2.2, mod_python 3.3.1
>>>> 
>>>> I recently upgraded the python version from 2.3.5 to 2.5.1, recompiled
>>>> apache and mod_python. This resulted in import errors in my application
>>>> (like the one shown below, replacing 2.3 with 2.5).
>>>> 
>>>> As I could not figure out what happened I uninstalled 2.5, recompiled
>>>> apache
>>>> and mod_python with 2.3.5 (basically the setup that was running nicely for
>>>> a
>>>> good while) and now I get the same error.
>>>> 
>>>> Does anyone have any advice, this is driving me nuts.
>>>> Thanks in advance
>>>> Olaf
>>>> 
>>>> 
>>>> ----------------
>>>> MOD_PYTHON ERROR
>>>> 
>>>> ProcessId:      11732
>>>> Interpreter:    'resw87031esw0h.columbuschildrens.net'
>>>> 
>>>> ServerName:     'resw87031esw0h.columbuschildrens.net'
>>>> DocumentRoot:   '/usr/local/apache/htdocs'
>>>> 
>>>> URI:            '/apps/cqcb/enter'
>>>> Location:       None
>>>> Directory:      '/usr/local/apache/htdocs/apps/'
>>>> Filename:       '/usr/local/apache/htdocs/apps/cqcb.py'
>>>> PathInfo:       '/enter'
>>>> 
>>>> Phase:          'PythonHandler'
>>>> Handler:        'mod_python.publisher'
>>>> 
>>>> Traceback (most recent call last):
>>>> 
>>>>   File
>>>> 
"/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/sit>>>>
e
>>>> -packages/mod_python/importer.py", line 1537, in HandlerDispatch
>>>>     default=default_handler, arg=req, silent=hlist.silent)
>>>> 
>>>>   File
>>>> 
"/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/sit>>>>
e
>>>> -packages/mod_python/importer.py", line 1229, in _process_target
>>>>     result = _execute_target(config, req, object, arg)
>>>> 
>>>>   File
>>>> 
"/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/sit>>>>
e
>>>> -packages/mod_python/importer.py", line 1128, in _execute_target
>>>>     result = object(arg)
>>>> 
>>>>   File
>>>> 
"/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/sit>>>>
e
>>>> -packages/mod_python/publisher.py", line 204, in handler
>>>>     module = page_cache[req]
>>>> 
>>>>   File
>>>> 
"/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/sit>>>>
e
>>>> -packages/mod_python/importer.py", line 1059, in __getitem__
>>>>     return import_module(req.filename)
>>>> 
>>>>   File
>>>> 
"/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/sit>>>>
e
>>>> -packages/mod_python/importer.py", line 296, in import_module
>>>>     log, import_path)
>>>> 
>>>>   File
>>>> 
"/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/sit>>>>
e
>>>> -packages/mod_python/importer.py", line 680, in import_module
>>>>     execfile(file, module.__dict__)
>>>> 
>>>>   File "/usr/local/apache/htdocs/apps/cqcb.py", line 25, in ?
>>>>     from simpla.mod_simpla import *
>>>> 
>>>> ImportError: No module named simpla.mod_simpla
>>>> 
>>> 
>>> Where is the simpla module located? It does exist, right? ;)
>>> 
>>> Jim
>>> 
>>> 
>> 
>> 
>> 
>> 
>> 
>> -------------------------
>> Olaf Stein
>> DBA
>> Center for Quantitative and Computational Biology
>> Columbus Children's Research Institute
>> 700 Children's Drive
>> phone: 1-614-355-5685
>> cell: 1-614-843-0432
>> email: steino@ccri.net
>> 
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>> 





-------------------------
Olaf Stein
DBA
Center for Quantitative and Computational Biology
Columbus Children's Research Institute
700 Children's Drive
phone: 1-614-355-5685
cell: 1-614-843-0432
email: steino@ccri.net

From steino at ccri.net  Tue Jun 26 11:56:23 2007
From: steino at ccri.net (Olaf Stein)
Date: Tue Jun 26 11:57:01 2007
Subject: FW: [mod_python] Import problem
In-Reply-To: <C2A6A20B.3A4B%steino@ccri.net>
Message-ID: <C2A6AF67.3A4F%steino@ccri.net>

I got it to work by using apache.import_module()

Still weird though ...





------ Forwarded Message
From: Olaf Stein <steino@ccri.net>
Date: Tue, 26 Jun 2007 10:59:23 -0400
To: <mod_python@modpython.org>
Cc: <mod_python@modpython.org>
Conversation: [mod_python] Import problem
Subject: Re: [mod_python] Import problem

Graham

Thanks for your reply but I do not think this is my problem.
I have the same code running on a production server,also using mod_python
3.3.1. I am also pretty sure that on the system where I have the error, the
previosuly installed version was 3.3.1, so nothing really changed.

Could this be related to the way I configure apache before compiling?

Thanks
Olaf


On 6/22/07 6:42 PM, "Graham Dumpleton" <graham.dumpleton@gmail.com> wrote:

> Did you upgrade to mod_python 3.3.1 from an older version at the same time?
> 
> There was one incompatible change going to mod_python 3.3.1 from older
> versions. This was where the handler directory is no longer put into
> sys.path. This doesn't cause any problems if using file based modules
> in the same directory, but does if you have a Python package in the
> same directory.
> 
> Further information can be had by reading the documentation for
> apache.import_module() in:
> 
>   http://www.modpython.org/live/current/doc-html/pyapi-apmeth.html
> 
> If that stuff in the directory is a true Python package with
> __init__.py having side affects, then only choice is to move the
> directory to outside of the document tree and then use PythonPath
> directive to specify where it is located. Other alternative is to
> treat your directory as a pseudo package as described in the
> documentation.
> 
> Anyway, read the documentation and come back if you have more
> questions or need something explained.
> 
> Graham
> 
> On 23/06/07, Olaf Stein <steino@ccri.net> wrote:
>> In the folders where cqcb.py is located there is a folder simpla, with a
>> file called mod_simpla.py
>> 
>> This same code used to work that's why this is weird
>> 
>> 
>> On 6/22/07 12:00 PM, "Jim Gallacher" <jpg@jgassociates.ca> wrote:
>> 
>>> Olaf Stein wrote:
>>>> Hi all,
>>>> 
>>>> I am running into this really weird problem:
>>>> I am on a mac, apache 2.2, mod_python 3.3.1
>>>> 
>>>> I recently upgraded the python version from 2.3.5 to 2.5.1, recompiled
>>>> apache and mod_python. This resulted in import errors in my application
>>>> (like the one shown below, replacing 2.3 with 2.5).
>>>> 
>>>> As I could not figure out what happened I uninstalled 2.5, recompiled
>>>> apache
>>>> and mod_python with 2.3.5 (basically the setup that was running nicely for
>>>> a
>>>> good while) and now I get the same error.
>>>> 
>>>> Does anyone have any advice, this is driving me nuts.
>>>> Thanks in advance
>>>> Olaf
>>>> 
>>>> 
>>>> ----------------
>>>> MOD_PYTHON ERROR
>>>> 
>>>> ProcessId:      11732
>>>> Interpreter:    'resw87031esw0h.columbuschildrens.net'
>>>> 
>>>> ServerName:     'resw87031esw0h.columbuschildrens.net'
>>>> DocumentRoot:   '/usr/local/apache/htdocs'
>>>> 
>>>> URI:            '/apps/cqcb/enter'
>>>> Location:       None
>>>> Directory:      '/usr/local/apache/htdocs/apps/'
>>>> Filename:       '/usr/local/apache/htdocs/apps/cqcb.py'
>>>> PathInfo:       '/enter'
>>>> 
>>>> Phase:          'PythonHandler'
>>>> Handler:        'mod_python.publisher'
>>>> 
>>>> Traceback (most recent call last):
>>>> 
>>>>   File
>>>> 
"/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/sit>
>>>
e
>>>> -packages/mod_python/importer.py", line 1537, in HandlerDispatch
>>>>     default=default_handler, arg=req, silent=hlist.silent)
>>>> 
>>>>   File
>>>> 
"/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/sit>
>>>
e
>>>> -packages/mod_python/importer.py", line 1229, in _process_target
>>>>     result = _execute_target(config, req, object, arg)
>>>> 
>>>>   File
>>>> 
"/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/sit>
>>>
e
>>>> -packages/mod_python/importer.py", line 1128, in _execute_target
>>>>     result = object(arg)
>>>> 
>>>>   File
>>>> 
"/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/sit>
>>>
e
>>>> -packages/mod_python/publisher.py", line 204, in handler
>>>>     module = page_cache[req]
>>>> 
>>>>   File
>>>> 
"/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/sit>
>>>
e
>>>> -packages/mod_python/importer.py", line 1059, in __getitem__
>>>>     return import_module(req.filename)
>>>> 
>>>>   File
>>>> 
"/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/sit>
>>>
e
>>>> -packages/mod_python/importer.py", line 296, in import_module
>>>>     log, import_path)
>>>> 
>>>>   File
>>>> 
"/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/sit>
>>>
e
>>>> -packages/mod_python/importer.py", line 680, in import_module
>>>>     execfile(file, module.__dict__)
>>>> 
>>>>   File "/usr/local/apache/htdocs/apps/cqcb.py", line 25, in ?
>>>>     from simpla.mod_simpla import *
>>>> 
>>>> ImportError: No module named simpla.mod_simpla
>>>> 
>>> 
>>> Where is the simpla module located? It does exist, right? ;)
>>> 
>>> Jim
>>> 
>>> 
>> 
>> 
>> 
>> 
>> 
>> -------------------------
>> Olaf Stein
>> DBA
>> Center for Quantitative and Computational Biology
>> Columbus Children's Research Institute
>> 700 Children's Drive
>> phone: 1-614-355-5685
>> cell: 1-614-843-0432
>> email: steino@ccri.net
>> 
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>> 





-------------------------
Olaf Stein
DBA
Center for Quantitative and Computational Biology
Columbus Children's Research Institute
700 Children's Drive
phone: 1-614-355-5685
cell: 1-614-843-0432
email: steino@ccri.net

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://mailman.modpython.org/mailman/listinfo/mod_python

------ End of Forwarded Message

From aaron.robinson at mojoworld.com  Wed Jun 27 07:28:03 2007
From: aaron.robinson at mojoworld.com (Aaron Robinson)
Date: Wed Jun 27 07:29:29 2007
Subject: [mod_python] Checking a PSP-generated response before starting to
	send it..?
Message-ID: <0JKA007GFL8PWT10@smtp3.clear.net.nz>

Hi all,

 

I'm running Apache 2.2.4 on Win32 with mod_python 3.3.1 and Python 2.5.1.

I'm completely new to Apache (and hence mod_python), but am reasonably
proficient with python itself.

 

I'm working on a web service where all content is generated on the fly, and
am wanting to use PSP to facilitate this.

Making as much use as possible of "304: Not Modified" is extremely important
to this project to reduce bandwidth, which is difficult as I have to
generate the content before I know whether it's different ("been modified")
from the last time I sent it or not..

 

I previously used a mechanism (not using Apache) where I would generate the
response, then take a hash of it and if it matched the hash of the last
response I sent, I would instead send a "304: Not Modified".

My problem is that when using PSP.run(), the response has already been sent
by the time it's finished being generated, so I have no opportunity to step
in and examine the response to see if sending a 304 is possible.

 

I'm needing an across-the-board mechanism for dealing with this - I thought
of serializing the "vars" dictionary before passing it in and taking a hash
of that for comparison, but this is hardly full-proof, as it would
(incorrectly) lead to responding with a 304 even with different "session"
information, or, in the slightly odd case that the PSP file made use of
random.random(), etc.

 

Just a thought: Is there a more general mechanism that can detect identical
content to a previous response on the way out and replace it with a 304?

 

Thanks in advance,

Aaron.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070627/0b492507/attachment.html
From gzlist at googlemail.com  Wed Jun 27 11:15:43 2007
From: gzlist at googlemail.com (Martin)
Date: Wed Jun 27 11:15:49 2007
Subject: [mod_python] UnicodeDecodeError with
	util.FieldStorage(req).Field.value
In-Reply-To: <200706251548.00235.ah@hatzis.de>
References: <200706201923.46099.ah@hatzis.de>
	<d80792120706231113v402284b0jbfb106953cba4503@mail.gmail.com>
	<200706251548.00235.ah@hatzis.de>
Message-ID: <d80792120706270815t4de58887r78dbf1aa31679be9@mail.gmail.com>

On 25/06/07, Anastasios Hatzis <ah@hatzis.de> wrote:
>
> Graham, Martin
>
> Thank you for your help. Charsets and encoding is definitely the most
> difficult thing for me in programming. In case of Python I always expect
> encode() to the opposite of what it is actually doing and vice versa. :/
>
> However, the following worked for me:
>
>         email_body = u'\r\n'
>         for param in store.list:
>             email_body += unicode(param.name, 'utf-8') + ': ' + \
>                               unicode(param.value, 'utf-8') + '\r\n'

You've missed two important things there.

The main one being that the calls to unicode() can throw, and anyone
who posted a form that wasn't perfect utf-8 will get a blank 500
Internal Server Error rather than any indication of what was wrong.
You're also still relying on implicit string<->unicode conversion
there, which makes the intention of the line less clear.

Second, style point really, is that using + for building up
strings/unicode is a bad habit as you pay a not-insignificant
performance penalty with sufficiently large input.

Martin
From aseem at metaweb.com  Wed Jun 27 13:24:13 2007
From: aseem at metaweb.com (Aseem Mohanty)
Date: Wed Jun 27 13:24:20 2007
Subject: [mod_python] mod_python + mod_authz_host w/o mod_auth_digest causes
 ~1Mb leak per apache graceful restart
Message-ID: <46829D3D.2000601@metaweb.com>

This may sound quite exotic but here it is:

In a vanilla apache2.2.x configuration if I only load mod_authz_host and none of
the other mod_auth* modules, every graceful restart causes ~1Mb leak in the
parent process. This is with mod_python loaded. Without mod_python the memory 
profile remains unchanged.

Steps to reproduce:
Gentoo:
1. In /etc/apache2/httpd.conf comment out all "LoadModule auth*" directives except
LoadModule authz_host_module modules/mod_authz_host.so

Ubuntu Feisty (repos):
1. In /etc/apache2/mods-enabled rename auth*.load files except authz_host.load
to auth*.load.not

Ubuntu Feisty (httpd built from source):
1. In conf/httpd.conf comment out all "LoadModule auth*" directives except
LoadModule authz_host_module modules/mod_authz_host.so

2. Start apache
3. Track apache parent process: top -d1 -p $(pgrep -o apache/httpd)
4. Hit apache instances with graceful restarts:
for i in $(seq 150); do echo $i; kill -USR1 $(pgrep -o apache/httpd); sleep 2; done

In this case the parent will leak ~1Mb per restart. If however in each of the
configurations mod_auth_digest.so is also loaded the leak is only about 150-200K
or so per graceful restart. This is on a server with 0 load. In my case it
caused apache instances that were restarted every 55 minutes to grow up to 300Mb
in a week.

Tested on:
1. Ubuntu Feisty (built from source httpd-2.2.4, mod_python-3.3.1):
./configure --prefix=/opt --enable-modules=all --enable-mods-shared=all 
--enable-so --with-included-apr
Server version: Apache/2.2.4 (Unix)
Server built:   Jun 27 2007 09:34:16
Server's Module Magic Number: 20051115:4
Server loaded:  APR 1.2.8, APR-Util 1.2.8
Compiled using: APR 1.2.8, APR-Util 1.2.8
Architecture:   32-bit
Server MPM:     Prefork
   threaded:     no
     forked:     yes (variable process count)
Server compiled with....
  -D APACHE_MPM_DIR="server/mpm/prefork"
  -D APR_HAS_SENDFILE
  -D APR_HAS_MMAP
  -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)
  -D APR_USE_SYSVSEM_SERIALIZE
  -D APR_USE_PTHREAD_SERIALIZE
  -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT
  -D APR_HAS_OTHER_CHILD
  -D AP_HAVE_RELIABLE_PIPED_LOGS
  -D DYNAMIC_MODULE_LIMIT=128
  -D HTTPD_ROOT="/opt/share/apache2"
  -D SUEXEC_BIN="/opt/share/apache2/bin/suexec"
  -D DEFAULT_PIDLOG="logs/httpd.pid"
  -D DEFAULT_SCOREBOARD="logs/apache_runtime_status"
  -D DEFAULT_LOCKFILE="logs/accept.lock"
  -D DEFAULT_ERRORLOG="logs/error_log"
  -D AP_TYPES_CONFIG_FILE="conf/mime.types"
  -D SERVER_CONFIG_FILE="conf/httpd.conf"


2. gentoo (64 bit dual proc AMD):
Linux host1 2.6.16-gentoo-r9 #7 SMP Fri Mar 16 17:35:26 UTC 2007 x86_64 AMD
Opteron(tm) Processor 248 AuthenticAMD GNU/Linux

Server version: Apache/2.2.4 (Unix)
Server built:   Jun 26 2007 19:29:33
Server's Module Magic Number: 20051115:4
Server loaded:  APR 1.2.8, APR-Util 1.2.8
Compiled using: APR 1.2.8, APR-Util 1.2.8
Architecture:   64-bit
Server MPM:     Prefork
   threaded:     no
     forked:     yes (variable process count)
Server compiled with....
  -D APACHE_MPM_DIR="server/mpm/prefork"
  -D APR_HAS_SENDFILE
  -D APR_HAS_MMAP
  -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)
  -D APR_USE_SYSVSEM_SERIALIZE
  -D APR_USE_PTHREAD_SERIALIZE
  -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT
  -D APR_HAS_OTHER_CHILD
  -D AP_HAVE_RELIABLE_PIPED_LOGS
  -D DYNAMIC_MODULE_LIMIT=128
  -D HTTPD_ROOT="/usr"
  -D SUEXEC_BIN="/usr/sbin/suexec"
  -D DEFAULT_PIDLOG="/var/run/httpd.pid"
  -D DEFAULT_SCOREBOARD="logs/apache_runtime_status"
  -D DEFAULT_LOCKFILE="/var/run/accept.lock"
  -D DEFAULT_ERRORLOG="logs/error_log"
  -D AP_TYPES_CONFIG_FILE="/etc/apache2/mime.types"
  -D SERVER_CONFIG_FILE="/etc/apache2/httpd.conf"

3. Ubuntu Feisty (32 bit Intel core duo - ubuntu repos):
Linux host2 2.6.20-16-generic #2 SMP Thu Jun 7 20:19:32 UTC 2007 i686 GNU/Linux

Server version: Apache/2.2.3
Server built:   Jan 15 2007 18:14:50
Server's Module Magic Number: 20051115:3
Server loaded:  APR 1.2.7, APR-Util 1.2.7
Compiled using: APR 1.2.7, APR-Util 1.2.7
Architecture:   32-bit
Server MPM:     Prefork
   threaded:     no
     forked:     yes (variable process count)
Server compiled with....
  -D APACHE_MPM_DIR="server/mpm/prefork"
  -D APR_HAS_SENDFILE
  -D APR_HAS_MMAP
  -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)
  -D APR_USE_SYSVSEM_SERIALIZE
  -D APR_USE_PTHREAD_SERIALIZE
  -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT
  -D APR_HAS_OTHER_CHILD
  -D AP_HAVE_RELIABLE_PIPED_LOGS
  -D DYNAMIC_MODULE_LIMIT=128
  -D HTTPD_ROOT=""
  -D SUEXEC_BIN="/usr/lib/apache2/suexec"
  -D DEFAULT_PIDLOG="/var/run/apache2.pid"
  -D DEFAULT_SCOREBOARD="logs/apache_runtime_status"
  -D DEFAULT_LOCKFILE="/var/run/apache2/accept.lock"
  -D DEFAULT_ERRORLOG="logs/error_log"
  -D AP_TYPES_CONFIG_FILE="/etc/apache2/mime.types"
  -D SERVER_CONFIG_FILE="/etc/apache2/apache2.conf"

Bug or just an unexpected apache configuration?? I actually filed a bug against 
apache core (http://issues.apache.org/bugzilla/show_bug.cgi?id=42749) initially 
not realizing that it could be a combination of factors that was causing it and 
not just soe module not being loaded.

Thanks.
AM
From listas at flavioribeiro.com  Wed Jun 27 15:22:29 2007
From: listas at flavioribeiro.com (=?ISO-8859-1?Q?Fl=E1vio_Ribeiro?=)
Date: Wed Jun 27 15:22:39 2007
Subject: [mod_python] One more UnicodeDecodeError
Message-ID: <873b128e0706271222j2a68f67es43665f7d066f6932@mail.gmail.com>

Hi everyone,

Im new to mod_python psp development and im facing my first problem. I've
already saw some articles on the web but still doesnt fix my code.
Im trying to store some data in a mysql database using mysqldb plus
mod_python and when i put some text with accents (?, ?, ?, ...) into a form
input i receive an error:

File "/usr/lib/python2.4/site-packages/MySQLdb/cursors.py", line 146, in execute
    query = query.encode(charset)

UnicodeDecodeError: 'ascii' codec can't decode byte 0xc3 in position
52: ordinal not in range(128)


Im using:
Python 2.4.4c1
mod_python/3.2.8
>>> MySQLdb.version_info
(1, 2, 1, 'final', 2)

-- 
Fl?vio Ribeiro
listas@flavioribeiro.com
www.flavioribeiro.com
(83) 9981.4441
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070627/4d815ae5/attachment.html
From gzlist at googlemail.com  Wed Jun 27 16:04:26 2007
From: gzlist at googlemail.com (Martin)
Date: Wed Jun 27 16:04:33 2007
Subject: [mod_python] One more UnicodeDecodeError
In-Reply-To: <873b128e0706271222j2a68f67es43665f7d066f6932@mail.gmail.com>
References: <873b128e0706271222j2a68f67es43665f7d066f6932@mail.gmail.com>
Message-ID: <d80792120706271304h428b444dm87ad469cd6f1fa5e@mail.gmail.com>

On 27/06/07, Fl?vio Ribeiro <listas@flavioribeiro.com> wrote:
> Hi everyone,
>
> Im new to mod_python psp development and im facing my first problem. I've
> already saw some articles on the web but still doesnt fix my code.
> Im trying to store some data in a mysql database using mysqldb plus
> mod_python and when i put some text with accents (?, ?, ?, ...) into a form
> input i receive an error:
>
> File "/usr/lib/python2.4/site-packages/MySQLdb/cursors.py",
> line 146, in execute
>  query = query.encode(charset)
>
> UnicodeDecodeError: 'ascii' codec can't decode byte 0xc3 in position 52:
> ordinal not in range(128)

You may find a recent thread on a similar topic useful:
http://www.modpython.org/pipermail/mod_python/2007-June/023904.html

In your particular case it seems (though you have not given the full
traceback) that you passed a byte string to MySQLdb when it was
expecting unicode. Therefore it's trying to decode the string using
the default encoding (ascii) before encoding it again.

You should check the MySQLdb documentation to make sure you are
calling with the correct parameters, provide the right charset for
your db if required, and decode any strings you get from forms as
suggested in the other thread.

Martin

From jpg at jgassociates.ca  Wed Jun 27 16:20:30 2007
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Wed Jun 27 16:20:33 2007
Subject: [mod_python] mod_python + mod_authz_host w/o mod_auth_digest
	causes ~1Mb leak per apache graceful restart
In-Reply-To: <46829D3D.2000601@metaweb.com>
References: <46829D3D.2000601@metaweb.com>
Message-ID: <4682C68E.20302@jgassociates.ca>

Aseem Mohanty wrote:
> This may sound quite exotic 


Why yes, it does? Interaction between these modules resulting in a 
memory leak sure sounds weird. Did you try it with *only* mod_python 
loaded? (ie, without mod_authz_host)

Jim

> but here it is:
> 
> In a vanilla apache2.2.x configuration if I only load mod_authz_host and 
> none of
> the other mod_auth* modules, every graceful restart causes ~1Mb leak in the
> parent process. This is with mod_python loaded. Without mod_python the 
> memory profile remains unchanged.
> 
> Steps to reproduce:
> Gentoo:
> 1. In /etc/apache2/httpd.conf comment out all "LoadModule auth*" 
> directives except
> LoadModule authz_host_module modules/mod_authz_host.so
> 
> Ubuntu Feisty (repos):
> 1. In /etc/apache2/mods-enabled rename auth*.load files except 
> authz_host.load
> to auth*.load.not
> 
> Ubuntu Feisty (httpd built from source):
> 1. In conf/httpd.conf comment out all "LoadModule auth*" directives except
> LoadModule authz_host_module modules/mod_authz_host.so
> 
> 2. Start apache
> 3. Track apache parent process: top -d1 -p $(pgrep -o apache/httpd)
> 4. Hit apache instances with graceful restarts:
> for i in $(seq 150); do echo $i; kill -USR1 $(pgrep -o apache/httpd); 
> sleep 2; done
> 
> In this case the parent will leak ~1Mb per restart. If however in each 
> of the
> configurations mod_auth_digest.so is also loaded the leak is only about 
> 150-200K
> or so per graceful restart. This is on a server with 0 load. In my case it
> caused apache instances that were restarted every 55 minutes to grow up 
> to 300Mb
> in a week.
> 
> Tested on:
> 1. Ubuntu Feisty (built from source httpd-2.2.4, mod_python-3.3.1):
> ./configure --prefix=/opt --enable-modules=all --enable-mods-shared=all 
> --enable-so --with-included-apr
> Server version: Apache/2.2.4 (Unix)
> Server built:   Jun 27 2007 09:34:16
> Server's Module Magic Number: 20051115:4
> Server loaded:  APR 1.2.8, APR-Util 1.2.8
> Compiled using: APR 1.2.8, APR-Util 1.2.8
> Architecture:   32-bit
> Server MPM:     Prefork
>   threaded:     no
>     forked:     yes (variable process count)
> Server compiled with....
>  -D APACHE_MPM_DIR="server/mpm/prefork"
>  -D APR_HAS_SENDFILE
>  -D APR_HAS_MMAP
>  -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)
>  -D APR_USE_SYSVSEM_SERIALIZE
>  -D APR_USE_PTHREAD_SERIALIZE
>  -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT
>  -D APR_HAS_OTHER_CHILD
>  -D AP_HAVE_RELIABLE_PIPED_LOGS
>  -D DYNAMIC_MODULE_LIMIT=128
>  -D HTTPD_ROOT="/opt/share/apache2"
>  -D SUEXEC_BIN="/opt/share/apache2/bin/suexec"
>  -D DEFAULT_PIDLOG="logs/httpd.pid"
>  -D DEFAULT_SCOREBOARD="logs/apache_runtime_status"
>  -D DEFAULT_LOCKFILE="logs/accept.lock"
>  -D DEFAULT_ERRORLOG="logs/error_log"
>  -D AP_TYPES_CONFIG_FILE="conf/mime.types"
>  -D SERVER_CONFIG_FILE="conf/httpd.conf"
> 
> 
> 2. gentoo (64 bit dual proc AMD):
> Linux host1 2.6.16-gentoo-r9 #7 SMP Fri Mar 16 17:35:26 UTC 2007 x86_64 AMD
> Opteron(tm) Processor 248 AuthenticAMD GNU/Linux
> 
> Server version: Apache/2.2.4 (Unix)
> Server built:   Jun 26 2007 19:29:33
> Server's Module Magic Number: 20051115:4
> Server loaded:  APR 1.2.8, APR-Util 1.2.8
> Compiled using: APR 1.2.8, APR-Util 1.2.8
> Architecture:   64-bit
> Server MPM:     Prefork
>   threaded:     no
>     forked:     yes (variable process count)
> Server compiled with....
>  -D APACHE_MPM_DIR="server/mpm/prefork"
>  -D APR_HAS_SENDFILE
>  -D APR_HAS_MMAP
>  -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)
>  -D APR_USE_SYSVSEM_SERIALIZE
>  -D APR_USE_PTHREAD_SERIALIZE
>  -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT
>  -D APR_HAS_OTHER_CHILD
>  -D AP_HAVE_RELIABLE_PIPED_LOGS
>  -D DYNAMIC_MODULE_LIMIT=128
>  -D HTTPD_ROOT="/usr"
>  -D SUEXEC_BIN="/usr/sbin/suexec"
>  -D DEFAULT_PIDLOG="/var/run/httpd.pid"
>  -D DEFAULT_SCOREBOARD="logs/apache_runtime_status"
>  -D DEFAULT_LOCKFILE="/var/run/accept.lock"
>  -D DEFAULT_ERRORLOG="logs/error_log"
>  -D AP_TYPES_CONFIG_FILE="/etc/apache2/mime.types"
>  -D SERVER_CONFIG_FILE="/etc/apache2/httpd.conf"
> 
> 3. Ubuntu Feisty (32 bit Intel core duo - ubuntu repos):
> Linux host2 2.6.20-16-generic #2 SMP Thu Jun 7 20:19:32 UTC 2007 i686 
> GNU/Linux
> 
> Server version: Apache/2.2.3
> Server built:   Jan 15 2007 18:14:50
> Server's Module Magic Number: 20051115:3
> Server loaded:  APR 1.2.7, APR-Util 1.2.7
> Compiled using: APR 1.2.7, APR-Util 1.2.7
> Architecture:   32-bit
> Server MPM:     Prefork
>   threaded:     no
>     forked:     yes (variable process count)
> Server compiled with....
>  -D APACHE_MPM_DIR="server/mpm/prefork"
>  -D APR_HAS_SENDFILE
>  -D APR_HAS_MMAP
>  -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)
>  -D APR_USE_SYSVSEM_SERIALIZE
>  -D APR_USE_PTHREAD_SERIALIZE
>  -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT
>  -D APR_HAS_OTHER_CHILD
>  -D AP_HAVE_RELIABLE_PIPED_LOGS
>  -D DYNAMIC_MODULE_LIMIT=128
>  -D HTTPD_ROOT=""
>  -D SUEXEC_BIN="/usr/lib/apache2/suexec"
>  -D DEFAULT_PIDLOG="/var/run/apache2.pid"
>  -D DEFAULT_SCOREBOARD="logs/apache_runtime_status"
>  -D DEFAULT_LOCKFILE="/var/run/apache2/accept.lock"
>  -D DEFAULT_ERRORLOG="logs/error_log"
>  -D AP_TYPES_CONFIG_FILE="/etc/apache2/mime.types"
>  -D SERVER_CONFIG_FILE="/etc/apache2/apache2.conf"
> 
> Bug or just an unexpected apache configuration?? I actually filed a bug 
> against apache core 
> (http://issues.apache.org/bugzilla/show_bug.cgi?id=42749) initially not 
> realizing that it could be a combination of factors that was causing it 
> and not just soe module not being loaded.
> 
> Thanks.
> AM
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 

From aseem at metaweb.com  Wed Jun 27 18:45:27 2007
From: aseem at metaweb.com (Aseem Mohanty)
Date: Wed Jun 27 18:45:33 2007
Subject: [mod_python] mod_python + mod_authz_host w/o mod_auth_digest
	causes ~1Mb leak per apache graceful restart
In-Reply-To: <4682C68E.20302@jgassociates.ca>
References: <46829D3D.2000601@metaweb.com> <4682C68E.20302@jgassociates.ca>
Message-ID: <4682E887.3010205@metaweb.com>

Yes, hence the exotic phraseology. Results for the various combinations are below:

1. mod_python only, no mod_auth* modules:		    leaks
2. mod_auth_digest only, no other mod_auth*, no mod_python: does not leak
3. mod_authz_host only, no other mod_auth*, no mod_python:  does not leak
4. mod_python + mod_authz_host, no mod_auth_digest: 	    leaks
5. mod_python + mod_auth_digest, no mod_authz_host:         leaks < (1) or (4)
6. mod_python + mod_auth_digest + mod_authz_host:	    does not leak

NOTE: 'does not leak' implies ~50-100K leakage per graceful restart
       (5) leaks ~500-600K per graceful restart
       zero load on server

As far as I can tell there is definitely some sinister interaction going on 
between these three modules. Unfortunately not being conversant with apache 
module development, I cannot really say what.

Thanks.
AM


Jim Gallacher wrote:
> Aseem Mohanty wrote:
>> This may sound quite exotic 
> 
> 
> Why yes, it does? Interaction between these modules resulting in a 
> memory leak sure sounds weird. Did you try it with *only* mod_python 
> loaded? (ie, without mod_authz_host)
> 
> Jim
> 
>> but here it is:
>>
>> In a vanilla apache2.2.x configuration if I only load mod_authz_host 
>> and none of
>> the other mod_auth* modules, every graceful restart causes ~1Mb leak 
>> in the
>> parent process. This is with mod_python loaded. Without mod_python the 
>> memory profile remains unchanged.
>>
>> Steps to reproduce:
>> Gentoo:
>> 1. In /etc/apache2/httpd.conf comment out all "LoadModule auth*" 
>> directives except
>> LoadModule authz_host_module modules/mod_authz_host.so
>>
>> Ubuntu Feisty (repos):
>> 1. In /etc/apache2/mods-enabled rename auth*.load files except 
>> authz_host.load
>> to auth*.load.not
>>
>> Ubuntu Feisty (httpd built from source):
>> 1. In conf/httpd.conf comment out all "LoadModule auth*" directives 
>> except
>> LoadModule authz_host_module modules/mod_authz_host.so
>>
>> 2. Start apache
>> 3. Track apache parent process: top -d1 -p $(pgrep -o apache/httpd)
>> 4. Hit apache instances with graceful restarts:
>> for i in $(seq 150); do echo $i; kill -USR1 $(pgrep -o apache/httpd); 
>> sleep 2; done
>>
>> In this case the parent will leak ~1Mb per restart. If however in each 
>> of the
>> configurations mod_auth_digest.so is also loaded the leak is only 
>> about 150-200K
>> or so per graceful restart. This is on a server with 0 load. In my 
>> case it
>> caused apache instances that were restarted every 55 minutes to grow 
>> up to 300Mb
>> in a week.
>>
>> Tested on:
>> 1. Ubuntu Feisty (built from source httpd-2.2.4, mod_python-3.3.1):
>> ./configure --prefix=/opt --enable-modules=all 
>> --enable-mods-shared=all --enable-so --with-included-apr
>> Server version: Apache/2.2.4 (Unix)
>> Server built:   Jun 27 2007 09:34:16
>> Server's Module Magic Number: 20051115:4
>> Server loaded:  APR 1.2.8, APR-Util 1.2.8
>> Compiled using: APR 1.2.8, APR-Util 1.2.8
>> Architecture:   32-bit
>> Server MPM:     Prefork
>>   threaded:     no
>>     forked:     yes (variable process count)
>> Server compiled with....
>>  -D APACHE_MPM_DIR="server/mpm/prefork"
>>  -D APR_HAS_SENDFILE
>>  -D APR_HAS_MMAP
>>  -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)
>>  -D APR_USE_SYSVSEM_SERIALIZE
>>  -D APR_USE_PTHREAD_SERIALIZE
>>  -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT
>>  -D APR_HAS_OTHER_CHILD
>>  -D AP_HAVE_RELIABLE_PIPED_LOGS
>>  -D DYNAMIC_MODULE_LIMIT=128
>>  -D HTTPD_ROOT="/opt/share/apache2"
>>  -D SUEXEC_BIN="/opt/share/apache2/bin/suexec"
>>  -D DEFAULT_PIDLOG="logs/httpd.pid"
>>  -D DEFAULT_SCOREBOARD="logs/apache_runtime_status"
>>  -D DEFAULT_LOCKFILE="logs/accept.lock"
>>  -D DEFAULT_ERRORLOG="logs/error_log"
>>  -D AP_TYPES_CONFIG_FILE="conf/mime.types"
>>  -D SERVER_CONFIG_FILE="conf/httpd.conf"
>>
>>
>> 2. gentoo (64 bit dual proc AMD):
>> Linux host1 2.6.16-gentoo-r9 #7 SMP Fri Mar 16 17:35:26 UTC 2007 
>> x86_64 AMD
>> Opteron(tm) Processor 248 AuthenticAMD GNU/Linux
>>
>> Server version: Apache/2.2.4 (Unix)
>> Server built:   Jun 26 2007 19:29:33
>> Server's Module Magic Number: 20051115:4
>> Server loaded:  APR 1.2.8, APR-Util 1.2.8
>> Compiled using: APR 1.2.8, APR-Util 1.2.8
>> Architecture:   64-bit
>> Server MPM:     Prefork
>>   threaded:     no
>>     forked:     yes (variable process count)
>> Server compiled with....
>>  -D APACHE_MPM_DIR="server/mpm/prefork"
>>  -D APR_HAS_SENDFILE
>>  -D APR_HAS_MMAP
>>  -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)
>>  -D APR_USE_SYSVSEM_SERIALIZE
>>  -D APR_USE_PTHREAD_SERIALIZE
>>  -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT
>>  -D APR_HAS_OTHER_CHILD
>>  -D AP_HAVE_RELIABLE_PIPED_LOGS
>>  -D DYNAMIC_MODULE_LIMIT=128
>>  -D HTTPD_ROOT="/usr"
>>  -D SUEXEC_BIN="/usr/sbin/suexec"
>>  -D DEFAULT_PIDLOG="/var/run/httpd.pid"
>>  -D DEFAULT_SCOREBOARD="logs/apache_runtime_status"
>>  -D DEFAULT_LOCKFILE="/var/run/accept.lock"
>>  -D DEFAULT_ERRORLOG="logs/error_log"
>>  -D AP_TYPES_CONFIG_FILE="/etc/apache2/mime.types"
>>  -D SERVER_CONFIG_FILE="/etc/apache2/httpd.conf"
>>
>> 3. Ubuntu Feisty (32 bit Intel core duo - ubuntu repos):
>> Linux host2 2.6.20-16-generic #2 SMP Thu Jun 7 20:19:32 UTC 2007 i686 
>> GNU/Linux
>>
>> Server version: Apache/2.2.3
>> Server built:   Jan 15 2007 18:14:50
>> Server's Module Magic Number: 20051115:3
>> Server loaded:  APR 1.2.7, APR-Util 1.2.7
>> Compiled using: APR 1.2.7, APR-Util 1.2.7
>> Architecture:   32-bit
>> Server MPM:     Prefork
>>   threaded:     no
>>     forked:     yes (variable process count)
>> Server compiled with....
>>  -D APACHE_MPM_DIR="server/mpm/prefork"
>>  -D APR_HAS_SENDFILE
>>  -D APR_HAS_MMAP
>>  -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)
>>  -D APR_USE_SYSVSEM_SERIALIZE
>>  -D APR_USE_PTHREAD_SERIALIZE
>>  -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT
>>  -D APR_HAS_OTHER_CHILD
>>  -D AP_HAVE_RELIABLE_PIPED_LOGS
>>  -D DYNAMIC_MODULE_LIMIT=128
>>  -D HTTPD_ROOT=""
>>  -D SUEXEC_BIN="/usr/lib/apache2/suexec"
>>  -D DEFAULT_PIDLOG="/var/run/apache2.pid"
>>  -D DEFAULT_SCOREBOARD="logs/apache_runtime_status"
>>  -D DEFAULT_LOCKFILE="/var/run/apache2/accept.lock"
>>  -D DEFAULT_ERRORLOG="logs/error_log"
>>  -D AP_TYPES_CONFIG_FILE="/etc/apache2/mime.types"
>>  -D SERVER_CONFIG_FILE="/etc/apache2/apache2.conf"
>>
>> Bug or just an unexpected apache configuration?? I actually filed a 
>> bug against apache core 
>> (http://issues.apache.org/bugzilla/show_bug.cgi?id=42749) initially 
>> not realizing that it could be a combination of factors that was 
>> causing it and not just soe module not being loaded.
>>
>> Thanks.
>> AM
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>
> 
From graham.dumpleton at gmail.com  Wed Jun 27 19:15:22 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Wed Jun 27 19:15:27 2007
Subject: [mod_python] mod_python + mod_authz_host w/o mod_auth_digest
	causes ~1Mb leak per apache graceful restart
In-Reply-To: <4682E887.3010205@metaweb.com>
References: <46829D3D.2000601@metaweb.com> <4682C68E.20302@jgassociates.ca>
	<4682E887.3010205@metaweb.com>
Message-ID: <88e286470706271615u7b03c422qba7250c4d325ea28@mail.gmail.com>

Is the version of mod_python you are using one you compiled yourself,
or one from Ubuntu packages?

Is the version of Python you are using one you compiled yourself, or
one from Ubuntu packages?

What is the size of mod_python.so? Does it use a shared Python library
or static? Use 'ldd' on mod_python.so to see dependencies.

Graham

On 28/06/07, Aseem Mohanty <aseem@metaweb.com> wrote:
> Yes, hence the exotic phraseology. Results for the various combinations are below:
>
> 1. mod_python only, no mod_auth* modules:                   leaks
> 2. mod_auth_digest only, no other mod_auth*, no mod_python: does not leak
> 3. mod_authz_host only, no other mod_auth*, no mod_python:  does not leak
> 4. mod_python + mod_authz_host, no mod_auth_digest:         leaks
> 5. mod_python + mod_auth_digest, no mod_authz_host:         leaks < (1) or (4)
> 6. mod_python + mod_auth_digest + mod_authz_host:           does not leak
>
> NOTE: 'does not leak' implies ~50-100K leakage per graceful restart
>        (5) leaks ~500-600K per graceful restart
>        zero load on server
>
> As far as I can tell there is definitely some sinister interaction going on
> between these three modules. Unfortunately not being conversant with apache
> module development, I cannot really say what.
>
> Thanks.
> AM
>
>
> Jim Gallacher wrote:
> > Aseem Mohanty wrote:
> >> This may sound quite exotic
> >
> >
> > Why yes, it does? Interaction between these modules resulting in a
> > memory leak sure sounds weird. Did you try it with *only* mod_python
> > loaded? (ie, without mod_authz_host)
> >
> > Jim
> >
> >> but here it is:
> >>
> >> In a vanilla apache2.2.x configuration if I only load mod_authz_host
> >> and none of
> >> the other mod_auth* modules, every graceful restart causes ~1Mb leak
> >> in the
> >> parent process. This is with mod_python loaded. Without mod_python the
> >> memory profile remains unchanged.
> >>
> >> Steps to reproduce:
> >> Gentoo:
> >> 1. In /etc/apache2/httpd.conf comment out all "LoadModule auth*"
> >> directives except
> >> LoadModule authz_host_module modules/mod_authz_host.so
> >>
> >> Ubuntu Feisty (repos):
> >> 1. In /etc/apache2/mods-enabled rename auth*.load files except
> >> authz_host.load
> >> to auth*.load.not
> >>
> >> Ubuntu Feisty (httpd built from source):
> >> 1. In conf/httpd.conf comment out all "LoadModule auth*" directives
> >> except
> >> LoadModule authz_host_module modules/mod_authz_host.so
> >>
> >> 2. Start apache
> >> 3. Track apache parent process: top -d1 -p $(pgrep -o apache/httpd)
> >> 4. Hit apache instances with graceful restarts:
> >> for i in $(seq 150); do echo $i; kill -USR1 $(pgrep -o apache/httpd);
> >> sleep 2; done
> >>
> >> In this case the parent will leak ~1Mb per restart. If however in each
> >> of the
> >> configurations mod_auth_digest.so is also loaded the leak is only
> >> about 150-200K
> >> or so per graceful restart. This is on a server with 0 load. In my
> >> case it
> >> caused apache instances that were restarted every 55 minutes to grow
> >> up to 300Mb
> >> in a week.
> >>
> >> Tested on:
> >> 1. Ubuntu Feisty (built from source httpd-2.2.4, mod_python-3.3.1):
> >> ./configure --prefix=/opt --enable-modules=all
> >> --enable-mods-shared=all --enable-so --with-included-apr
> >> Server version: Apache/2.2.4 (Unix)
> >> Server built:   Jun 27 2007 09:34:16
> >> Server's Module Magic Number: 20051115:4
> >> Server loaded:  APR 1.2.8, APR-Util 1.2.8
> >> Compiled using: APR 1.2.8, APR-Util 1.2.8
> >> Architecture:   32-bit
> >> Server MPM:     Prefork
> >>   threaded:     no
> >>     forked:     yes (variable process count)
> >> Server compiled with....
> >>  -D APACHE_MPM_DIR="server/mpm/prefork"
> >>  -D APR_HAS_SENDFILE
> >>  -D APR_HAS_MMAP
> >>  -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)
> >>  -D APR_USE_SYSVSEM_SERIALIZE
> >>  -D APR_USE_PTHREAD_SERIALIZE
> >>  -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT
> >>  -D APR_HAS_OTHER_CHILD
> >>  -D AP_HAVE_RELIABLE_PIPED_LOGS
> >>  -D DYNAMIC_MODULE_LIMIT=128
> >>  -D HTTPD_ROOT="/opt/share/apache2"
> >>  -D SUEXEC_BIN="/opt/share/apache2/bin/suexec"
> >>  -D DEFAULT_PIDLOG="logs/httpd.pid"
> >>  -D DEFAULT_SCOREBOARD="logs/apache_runtime_status"
> >>  -D DEFAULT_LOCKFILE="logs/accept.lock"
> >>  -D DEFAULT_ERRORLOG="logs/error_log"
> >>  -D AP_TYPES_CONFIG_FILE="conf/mime.types"
> >>  -D SERVER_CONFIG_FILE="conf/httpd.conf"
> >>
> >>
> >> 2. gentoo (64 bit dual proc AMD):
> >> Linux host1 2.6.16-gentoo-r9 #7 SMP Fri Mar 16 17:35:26 UTC 2007
> >> x86_64 AMD
> >> Opteron(tm) Processor 248 AuthenticAMD GNU/Linux
> >>
> >> Server version: Apache/2.2.4 (Unix)
> >> Server built:   Jun 26 2007 19:29:33
> >> Server's Module Magic Number: 20051115:4
> >> Server loaded:  APR 1.2.8, APR-Util 1.2.8
> >> Compiled using: APR 1.2.8, APR-Util 1.2.8
> >> Architecture:   64-bit
> >> Server MPM:     Prefork
> >>   threaded:     no
> >>     forked:     yes (variable process count)
> >> Server compiled with....
> >>  -D APACHE_MPM_DIR="server/mpm/prefork"
> >>  -D APR_HAS_SENDFILE
> >>  -D APR_HAS_MMAP
> >>  -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)
> >>  -D APR_USE_SYSVSEM_SERIALIZE
> >>  -D APR_USE_PTHREAD_SERIALIZE
> >>  -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT
> >>  -D APR_HAS_OTHER_CHILD
> >>  -D AP_HAVE_RELIABLE_PIPED_LOGS
> >>  -D DYNAMIC_MODULE_LIMIT=128
> >>  -D HTTPD_ROOT="/usr"
> >>  -D SUEXEC_BIN="/usr/sbin/suexec"
> >>  -D DEFAULT_PIDLOG="/var/run/httpd.pid"
> >>  -D DEFAULT_SCOREBOARD="logs/apache_runtime_status"
> >>  -D DEFAULT_LOCKFILE="/var/run/accept.lock"
> >>  -D DEFAULT_ERRORLOG="logs/error_log"
> >>  -D AP_TYPES_CONFIG_FILE="/etc/apache2/mime.types"
> >>  -D SERVER_CONFIG_FILE="/etc/apache2/httpd.conf"
> >>
> >> 3. Ubuntu Feisty (32 bit Intel core duo - ubuntu repos):
> >> Linux host2 2.6.20-16-generic #2 SMP Thu Jun 7 20:19:32 UTC 2007 i686
> >> GNU/Linux
> >>
> >> Server version: Apache/2.2.3
> >> Server built:   Jan 15 2007 18:14:50
> >> Server's Module Magic Number: 20051115:3
> >> Server loaded:  APR 1.2.7, APR-Util 1.2.7
> >> Compiled using: APR 1.2.7, APR-Util 1.2.7
> >> Architecture:   32-bit
> >> Server MPM:     Prefork
> >>   threaded:     no
> >>     forked:     yes (variable process count)
> >> Server compiled with....
> >>  -D APACHE_MPM_DIR="server/mpm/prefork"
> >>  -D APR_HAS_SENDFILE
> >>  -D APR_HAS_MMAP
> >>  -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)
> >>  -D APR_USE_SYSVSEM_SERIALIZE
> >>  -D APR_USE_PTHREAD_SERIALIZE
> >>  -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT
> >>  -D APR_HAS_OTHER_CHILD
> >>  -D AP_HAVE_RELIABLE_PIPED_LOGS
> >>  -D DYNAMIC_MODULE_LIMIT=128
> >>  -D HTTPD_ROOT=""
> >>  -D SUEXEC_BIN="/usr/lib/apache2/suexec"
> >>  -D DEFAULT_PIDLOG="/var/run/apache2.pid"
> >>  -D DEFAULT_SCOREBOARD="logs/apache_runtime_status"
> >>  -D DEFAULT_LOCKFILE="/var/run/apache2/accept.lock"
> >>  -D DEFAULT_ERRORLOG="logs/error_log"
> >>  -D AP_TYPES_CONFIG_FILE="/etc/apache2/mime.types"
> >>  -D SERVER_CONFIG_FILE="/etc/apache2/apache2.conf"
> >>
> >> Bug or just an unexpected apache configuration?? I actually filed a
> >> bug against apache core
> >> (http://issues.apache.org/bugzilla/show_bug.cgi?id=42749) initially
> >> not realizing that it could be a combination of factors that was
> >> causing it and not just soe module not being loaded.
> >>
> >> Thanks.
> >> AM
> >> _______________________________________________
> >> Mod_python mailing list
> >> Mod_python@modpython.org
> >> http://mailman.modpython.org/mailman/listinfo/mod_python
> >>
> >
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From aseem at metaweb.com  Wed Jun 27 20:28:24 2007
From: aseem at metaweb.com (Aseem Mohanty)
Date: Wed Jun 27 20:28:35 2007
Subject: [mod_python] mod_python + mod_authz_host w/o mod_auth_digest
	causes ~1Mb leak per apache graceful restart
In-Reply-To: <88e286470706271615u7b03c422qba7250c4d325ea28@mail.gmail.com>
References: <46829D3D.2000601@metaweb.com> <4682C68E.20302@jgassociates.ca>	
	<4682E887.3010205@metaweb.com>
	<88e286470706271615u7b03c422qba7250c4d325ea28@mail.gmail.com>
Message-ID: <468300A8.5020701@metaweb.com>

Graham Dumpleton wrote:
> Is the version of mod_python you are using one you compiled yourself,
> or one from Ubuntu packages?

I have used both and it does not seem to matter. When compiling from source, I 
did the following:
./configure --prefix=/opt --with-apxs=/opt/share/apache2/bin/apxs
make install_dso
to use the apache build from source. Apache was build with the following config:
./configure --prefix=/opt --enable-modules=all --enable-mods-shared=all 
--enable-so --with-included-apr

> 
> Is the version of Python you are using one you compiled yourself, or
> one from Ubuntu packages?

Python-2.5.1 is the one from the ubuntu packages.05:22 PM $ python
Python 2.5.1 (r251:54863, May  2 2007, 16:56:35)
[GCC 4.1.2 (Ubuntu 4.1.2-0ubuntu4)] on linux2
Type "help", "copyright", "credits" or "license" for more information.

> 
> What is the size of mod_python.so? Does it use a shared Python library
> or static? Use 'ldd' on mod_python.so to see dependencies.

mod_python from ubuntu packages:
v 3.2.10
05:24 PM $ ll mod_python.so
-rw-r--r-- 1 root root 99K 2007-01-16 04:44 mod_python.so
05:24 PM $ ldd mod_python.so
         linux-gate.so.1 =>  (0xffffe000)
         libpython2.5.so.1.0 => /usr/lib/libpython2.5.so.1.0 (0xb7e4f000)
         libpthread.so.0 => /lib/tls/i686/cmov/libpthread.so.0 (0xb7e38000)
         libdl.so.2 => /lib/tls/i686/cmov/libdl.so.2 (0xb7e33000)
         libutil.so.1 => /lib/tls/i686/cmov/libutil.so.1 (0xb7e2f000)
         libm.so.6 => /lib/tls/i686/cmov/libm.so.6 (0xb7e08000)
         libc.so.6 => /lib/tls/i686/cmov/libc.so.6 (0xb7cc7000)
         /lib/ld-linux.so.2 (0x80000000)

mod_python built from source:
v 3.3.1
05:25 PM $ ll mod_python.so
-rwxr-xr-x 1 aseem aseem 343K 2007-06-27 09:50 mod_python.so*
aseem @ narada: /opt/share/apache2/modules
05:25 PM $ ldd mod_python.so
         linux-gate.so.1 =>  (0xffffe000)
         libpython2.5.so.1.0 => /usr/lib/libpython2.5.so.1.0 (0xb7e30000)
         libpthread.so.0 => /lib/tls/i686/cmov/libpthread.so.0 (0xb7e19000)
         libdl.so.2 => /lib/tls/i686/cmov/libdl.so.2 (0xb7e14000)
         libutil.so.1 => /lib/tls/i686/cmov/libutil.so.1 (0xb7e10000)
         libm.so.6 => /lib/tls/i686/cmov/libm.so.6 (0xb7de9000)
         libc.so.6 => /lib/tls/i686/cmov/libc.so.6 (0xb7ca8000)
         /lib/ld-linux.so.2 (0x80000000)

In both cases they do seem to use shared python libs.

Thanks.
AM

> 
> Graham
> 
> On 28/06/07, Aseem Mohanty <aseem@metaweb.com> wrote:
>> Yes, hence the exotic phraseology. Results for the various 
>> combinations are below:
>>
>> 1. mod_python only, no mod_auth* modules:                   leaks
>> 2. mod_auth_digest only, no other mod_auth*, no mod_python: does not leak
>> 3. mod_authz_host only, no other mod_auth*, no mod_python:  does not leak
>> 4. mod_python + mod_authz_host, no mod_auth_digest:         leaks
>> 5. mod_python + mod_auth_digest, no mod_authz_host:         leaks < 
>> (1) or (4)
>> 6. mod_python + mod_auth_digest + mod_authz_host:           does not leak
>>
>> NOTE: 'does not leak' implies ~50-100K leakage per graceful restart
>>        (5) leaks ~500-600K per graceful restart
>>        zero load on server
>>
>> As far as I can tell there is definitely some sinister interaction 
>> going on
>> between these three modules. Unfortunately not being conversant with 
>> apache
>> module development, I cannot really say what.
>>
>> Thanks.
>> AM
>>
>>
>> Jim Gallacher wrote:
>> > Aseem Mohanty wrote:
>> >> This may sound quite exotic
>> >
>> >
>> > Why yes, it does? Interaction between these modules resulting in a
>> > memory leak sure sounds weird. Did you try it with *only* mod_python
>> > loaded? (ie, without mod_authz_host)
>> >
>> > Jim
>> >
>> >> but here it is:
>> >>
>> >> In a vanilla apache2.2.x configuration if I only load mod_authz_host
>> >> and none of
>> >> the other mod_auth* modules, every graceful restart causes ~1Mb leak
>> >> in the
>> >> parent process. This is with mod_python loaded. Without mod_python the
>> >> memory profile remains unchanged.
>> >>
>> >> Steps to reproduce:
>> >> Gentoo:
>> >> 1. In /etc/apache2/httpd.conf comment out all "LoadModule auth*"
>> >> directives except
>> >> LoadModule authz_host_module modules/mod_authz_host.so
>> >>
>> >> Ubuntu Feisty (repos):
>> >> 1. In /etc/apache2/mods-enabled rename auth*.load files except
>> >> authz_host.load
>> >> to auth*.load.not
>> >>
>> >> Ubuntu Feisty (httpd built from source):
>> >> 1. In conf/httpd.conf comment out all "LoadModule auth*" directives
>> >> except
>> >> LoadModule authz_host_module modules/mod_authz_host.so
>> >>
>> >> 2. Start apache
>> >> 3. Track apache parent process: top -d1 -p $(pgrep -o apache/httpd)
>> >> 4. Hit apache instances with graceful restarts:
>> >> for i in $(seq 150); do echo $i; kill -USR1 $(pgrep -o apache/httpd);
>> >> sleep 2; done
>> >>
>> >> In this case the parent will leak ~1Mb per restart. If however in each
>> >> of the
>> >> configurations mod_auth_digest.so is also loaded the leak is only
>> >> about 150-200K
>> >> or so per graceful restart. This is on a server with 0 load. In my
>> >> case it
>> >> caused apache instances that were restarted every 55 minutes to grow
>> >> up to 300Mb
>> >> in a week.
>> >>
>> >> Tested on:
>> >> 1. Ubuntu Feisty (built from source httpd-2.2.4, mod_python-3.3.1):
>> >> ./configure --prefix=/opt --enable-modules=all
>> >> --enable-mods-shared=all --enable-so --with-included-apr
>> >> Server version: Apache/2.2.4 (Unix)
>> >> Server built:   Jun 27 2007 09:34:16
>> >> Server's Module Magic Number: 20051115:4
>> >> Server loaded:  APR 1.2.8, APR-Util 1.2.8
>> >> Compiled using: APR 1.2.8, APR-Util 1.2.8
>> >> Architecture:   32-bit
>> >> Server MPM:     Prefork
>> >>   threaded:     no
>> >>     forked:     yes (variable process count)
>> >> Server compiled with....
>> >>  -D APACHE_MPM_DIR="server/mpm/prefork"
>> >>  -D APR_HAS_SENDFILE
>> >>  -D APR_HAS_MMAP
>> >>  -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)
>> >>  -D APR_USE_SYSVSEM_SERIALIZE
>> >>  -D APR_USE_PTHREAD_SERIALIZE
>> >>  -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT
>> >>  -D APR_HAS_OTHER_CHILD
>> >>  -D AP_HAVE_RELIABLE_PIPED_LOGS
>> >>  -D DYNAMIC_MODULE_LIMIT=128
>> >>  -D HTTPD_ROOT="/opt/share/apache2"
>> >>  -D SUEXEC_BIN="/opt/share/apache2/bin/suexec"
>> >>  -D DEFAULT_PIDLOG="logs/httpd.pid"
>> >>  -D DEFAULT_SCOREBOARD="logs/apache_runtime_status"
>> >>  -D DEFAULT_LOCKFILE="logs/accept.lock"
>> >>  -D DEFAULT_ERRORLOG="logs/error_log"
>> >>  -D AP_TYPES_CONFIG_FILE="conf/mime.types"
>> >>  -D SERVER_CONFIG_FILE="conf/httpd.conf"
>> >>
>> >>
>> >> 2. gentoo (64 bit dual proc AMD):
>> >> Linux host1 2.6.16-gentoo-r9 #7 SMP Fri Mar 16 17:35:26 UTC 2007
>> >> x86_64 AMD
>> >> Opteron(tm) Processor 248 AuthenticAMD GNU/Linux
>> >>
>> >> Server version: Apache/2.2.4 (Unix)
>> >> Server built:   Jun 26 2007 19:29:33
>> >> Server's Module Magic Number: 20051115:4
>> >> Server loaded:  APR 1.2.8, APR-Util 1.2.8
>> >> Compiled using: APR 1.2.8, APR-Util 1.2.8
>> >> Architecture:   64-bit
>> >> Server MPM:     Prefork
>> >>   threaded:     no
>> >>     forked:     yes (variable process count)
>> >> Server compiled with....
>> >>  -D APACHE_MPM_DIR="server/mpm/prefork"
>> >>  -D APR_HAS_SENDFILE
>> >>  -D APR_HAS_MMAP
>> >>  -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)
>> >>  -D APR_USE_SYSVSEM_SERIALIZE
>> >>  -D APR_USE_PTHREAD_SERIALIZE
>> >>  -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT
>> >>  -D APR_HAS_OTHER_CHILD
>> >>  -D AP_HAVE_RELIABLE_PIPED_LOGS
>> >>  -D DYNAMIC_MODULE_LIMIT=128
>> >>  -D HTTPD_ROOT="/usr"
>> >>  -D SUEXEC_BIN="/usr/sbin/suexec"
>> >>  -D DEFAULT_PIDLOG="/var/run/httpd.pid"
>> >>  -D DEFAULT_SCOREBOARD="logs/apache_runtime_status"
>> >>  -D DEFAULT_LOCKFILE="/var/run/accept.lock"
>> >>  -D DEFAULT_ERRORLOG="logs/error_log"
>> >>  -D AP_TYPES_CONFIG_FILE="/etc/apache2/mime.types"
>> >>  -D SERVER_CONFIG_FILE="/etc/apache2/httpd.conf"
>> >>
>> >> 3. Ubuntu Feisty (32 bit Intel core duo - ubuntu repos):
>> >> Linux host2 2.6.20-16-generic #2 SMP Thu Jun 7 20:19:32 UTC 2007 i686
>> >> GNU/Linux
>> >>
>> >> Server version: Apache/2.2.3
>> >> Server built:   Jan 15 2007 18:14:50
>> >> Server's Module Magic Number: 20051115:3
>> >> Server loaded:  APR 1.2.7, APR-Util 1.2.7
>> >> Compiled using: APR 1.2.7, APR-Util 1.2.7
>> >> Architecture:   32-bit
>> >> Server MPM:     Prefork
>> >>   threaded:     no
>> >>     forked:     yes (variable process count)
>> >> Server compiled with....
>> >>  -D APACHE_MPM_DIR="server/mpm/prefork"
>> >>  -D APR_HAS_SENDFILE
>> >>  -D APR_HAS_MMAP
>> >>  -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)
>> >>  -D APR_USE_SYSVSEM_SERIALIZE
>> >>  -D APR_USE_PTHREAD_SERIALIZE
>> >>  -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT
>> >>  -D APR_HAS_OTHER_CHILD
>> >>  -D AP_HAVE_RELIABLE_PIPED_LOGS
>> >>  -D DYNAMIC_MODULE_LIMIT=128
>> >>  -D HTTPD_ROOT=""
>> >>  -D SUEXEC_BIN="/usr/lib/apache2/suexec"
>> >>  -D DEFAULT_PIDLOG="/var/run/apache2.pid"
>> >>  -D DEFAULT_SCOREBOARD="logs/apache_runtime_status"
>> >>  -D DEFAULT_LOCKFILE="/var/run/apache2/accept.lock"
>> >>  -D DEFAULT_ERRORLOG="logs/error_log"
>> >>  -D AP_TYPES_CONFIG_FILE="/etc/apache2/mime.types"
>> >>  -D SERVER_CONFIG_FILE="/etc/apache2/apache2.conf"
>> >>
>> >> Bug or just an unexpected apache configuration?? I actually filed a
>> >> bug against apache core
>> >> (http://issues.apache.org/bugzilla/show_bug.cgi?id=42749) initially
>> >> not realizing that it could be a combination of factors that was
>> >> causing it and not just soe module not being loaded.
>> >>
>> >> Thanks.
>> >> AM
>> >> _______________________________________________
>> >> Mod_python mailing list
>> >> Mod_python@modpython.org
>> >> http://mailman.modpython.org/mailman/listinfo/mod_python
>> >>
>> >
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>
From jpg at jgassociates.ca  Thu Jun 28 17:27:20 2007
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Thu Jun 28 17:23:14 2007
Subject: [mod_python] mod_python + mod_authz_host w/o mod_auth_digest
	causes ~1Mb leak per apache graceful restart
In-Reply-To: <468300A8.5020701@metaweb.com>
References: <46829D3D.2000601@metaweb.com>
	<4682C68E.20302@jgassociates.ca>		<4682E887.3010205@metaweb.com>	<88e286470706271615u7b03c422qba7250c4d325ea28@mail.gmail.com>
	<468300A8.5020701@metaweb.com>
Message-ID: <468427B8.6070507@jgassociates.ca>

I've confirmed that mod_python leaks on graceful restart, but I don't 
see the dependency on the auth* modules. Apache always seems to leak 
when mod_python is loaded, regardless of the other modules. My test 
setup is a little different: On Debian with apache 2.2.3, mpm-worker, 
mod_python 3.3.1 running within VMWare.

My gut tells me that this may be related to 
http://issues.apache.org/jira/browse/MODPYTHON-109.

This issue also reminds me of 
http://issues.apache.org/jira/browse/MODPYTHON-195.

I think at this point we should log this in JIRA and move the discussion 
over to python-dev.

The obvious (but suboptimal) temporary solution for Aseem is to avoid 
using graceful restart.

Jim

Aseem Mohanty wrote:
> Graham Dumpleton wrote:
>> Is the version of mod_python you are using one you compiled yourself,
>> or one from Ubuntu packages?
> 
> I have used both and it does not seem to matter. When compiling from 
> source, I did the following:
> ./configure --prefix=/opt --with-apxs=/opt/share/apache2/bin/apxs
> make install_dso
> to use the apache build from source. Apache was build with the following 
> config:
> ./configure --prefix=/opt --enable-modules=all --enable-mods-shared=all 
> --enable-so --with-included-apr
> 
>>
>> Is the version of Python you are using one you compiled yourself, or
>> one from Ubuntu packages?
> 
> Python-2.5.1 is the one from the ubuntu packages.05:22 PM $ python
> Python 2.5.1 (r251:54863, May  2 2007, 16:56:35)
> [GCC 4.1.2 (Ubuntu 4.1.2-0ubuntu4)] on linux2
> Type "help", "copyright", "credits" or "license" for more information.
> 
>>
>> What is the size of mod_python.so? Does it use a shared Python library
>> or static? Use 'ldd' on mod_python.so to see dependencies.
> 
> mod_python from ubuntu packages:
> v 3.2.10
> 05:24 PM $ ll mod_python.so
> -rw-r--r-- 1 root root 99K 2007-01-16 04:44 mod_python.so
> 05:24 PM $ ldd mod_python.so
>         linux-gate.so.1 =>  (0xffffe000)
>         libpython2.5.so.1.0 => /usr/lib/libpython2.5.so.1.0 (0xb7e4f000)
>         libpthread.so.0 => /lib/tls/i686/cmov/libpthread.so.0 (0xb7e38000)
>         libdl.so.2 => /lib/tls/i686/cmov/libdl.so.2 (0xb7e33000)
>         libutil.so.1 => /lib/tls/i686/cmov/libutil.so.1 (0xb7e2f000)
>         libm.so.6 => /lib/tls/i686/cmov/libm.so.6 (0xb7e08000)
>         libc.so.6 => /lib/tls/i686/cmov/libc.so.6 (0xb7cc7000)
>         /lib/ld-linux.so.2 (0x80000000)
> 
> mod_python built from source:
> v 3.3.1
> 05:25 PM $ ll mod_python.so
> -rwxr-xr-x 1 aseem aseem 343K 2007-06-27 09:50 mod_python.so*
> aseem @ narada: /opt/share/apache2/modules
> 05:25 PM $ ldd mod_python.so
>         linux-gate.so.1 =>  (0xffffe000)
>         libpython2.5.so.1.0 => /usr/lib/libpython2.5.so.1.0 (0xb7e30000)
>         libpthread.so.0 => /lib/tls/i686/cmov/libpthread.so.0 (0xb7e19000)
>         libdl.so.2 => /lib/tls/i686/cmov/libdl.so.2 (0xb7e14000)
>         libutil.so.1 => /lib/tls/i686/cmov/libutil.so.1 (0xb7e10000)
>         libm.so.6 => /lib/tls/i686/cmov/libm.so.6 (0xb7de9000)
>         libc.so.6 => /lib/tls/i686/cmov/libc.so.6 (0xb7ca8000)
>         /lib/ld-linux.so.2 (0x80000000)
> 
> In both cases they do seem to use shared python libs.
> 
> Thanks.
> AM
> 
>>
>> Graham
>>
>> On 28/06/07, Aseem Mohanty <aseem@metaweb.com> wrote:
>>> Yes, hence the exotic phraseology. Results for the various 
>>> combinations are below:
>>>
>>> 1. mod_python only, no mod_auth* modules:                   leaks
>>> 2. mod_auth_digest only, no other mod_auth*, no mod_python: does not 
>>> leak
>>> 3. mod_authz_host only, no other mod_auth*, no mod_python:  does not 
>>> leak
>>> 4. mod_python + mod_authz_host, no mod_auth_digest:         leaks
>>> 5. mod_python + mod_auth_digest, no mod_authz_host:         leaks < 
>>> (1) or (4)
>>> 6. mod_python + mod_auth_digest + mod_authz_host:           does not 
>>> leak
>>>
>>> NOTE: 'does not leak' implies ~50-100K leakage per graceful restart
>>>        (5) leaks ~500-600K per graceful restart
>>>        zero load on server
>>>
>>> As far as I can tell there is definitely some sinister interaction 
>>> going on
>>> between these three modules. Unfortunately not being conversant with 
>>> apache
>>> module development, I cannot really say what.
>>>
>>> Thanks.
>>> AM
>>>
>>>
>>> Jim Gallacher wrote:
>>> > Aseem Mohanty wrote:
>>> >> This may sound quite exotic
>>> >
>>> >
>>> > Why yes, it does? Interaction between these modules resulting in a
>>> > memory leak sure sounds weird. Did you try it with *only* mod_python
>>> > loaded? (ie, without mod_authz_host)
>>> >
>>> > Jim
>>> >
>>> >> but here it is:
>>> >>
>>> >> In a vanilla apache2.2.x configuration if I only load mod_authz_host
>>> >> and none of
>>> >> the other mod_auth* modules, every graceful restart causes ~1Mb leak
>>> >> in the
>>> >> parent process. This is with mod_python loaded. Without mod_python 
>>> the
>>> >> memory profile remains unchanged.
>>> >>
>>> >> Steps to reproduce:
>>> >> Gentoo:
>>> >> 1. In /etc/apache2/httpd.conf comment out all "LoadModule auth*"
>>> >> directives except
>>> >> LoadModule authz_host_module modules/mod_authz_host.so
>>> >>
>>> >> Ubuntu Feisty (repos):
>>> >> 1. In /etc/apache2/mods-enabled rename auth*.load files except
>>> >> authz_host.load
>>> >> to auth*.load.not
>>> >>
>>> >> Ubuntu Feisty (httpd built from source):
>>> >> 1. In conf/httpd.conf comment out all "LoadModule auth*" directives
>>> >> except
>>> >> LoadModule authz_host_module modules/mod_authz_host.so
>>> >>
>>> >> 2. Start apache
>>> >> 3. Track apache parent process: top -d1 -p $(pgrep -o apache/httpd)
>>> >> 4. Hit apache instances with graceful restarts:
>>> >> for i in $(seq 150); do echo $i; kill -USR1 $(pgrep -o apache/httpd);
>>> >> sleep 2; done
>>> >>
>>> >> In this case the parent will leak ~1Mb per restart. If however in 
>>> each
>>> >> of the
>>> >> configurations mod_auth_digest.so is also loaded the leak is only
>>> >> about 150-200K
>>> >> or so per graceful restart. This is on a server with 0 load. In my
>>> >> case it
>>> >> caused apache instances that were restarted every 55 minutes to grow
>>> >> up to 300Mb
>>> >> in a week.
>>> >>
>>> >> Tested on:
>>> >> 1. Ubuntu Feisty (built from source httpd-2.2.4, mod_python-3.3.1):
>>> >> ./configure --prefix=/opt --enable-modules=all
>>> >> --enable-mods-shared=all --enable-so --with-included-apr
>>> >> Server version: Apache/2.2.4 (Unix)
>>> >> Server built:   Jun 27 2007 09:34:16
>>> >> Server's Module Magic Number: 20051115:4
>>> >> Server loaded:  APR 1.2.8, APR-Util 1.2.8
>>> >> Compiled using: APR 1.2.8, APR-Util 1.2.8
>>> >> Architecture:   32-bit
>>> >> Server MPM:     Prefork
>>> >>   threaded:     no
>>> >>     forked:     yes (variable process count)
>>> >> Server compiled with....
>>> >>  -D APACHE_MPM_DIR="server/mpm/prefork"
>>> >>  -D APR_HAS_SENDFILE
>>> >>  -D APR_HAS_MMAP
>>> >>  -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)
>>> >>  -D APR_USE_SYSVSEM_SERIALIZE
>>> >>  -D APR_USE_PTHREAD_SERIALIZE
>>> >>  -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT
>>> >>  -D APR_HAS_OTHER_CHILD
>>> >>  -D AP_HAVE_RELIABLE_PIPED_LOGS
>>> >>  -D DYNAMIC_MODULE_LIMIT=128
>>> >>  -D HTTPD_ROOT="/opt/share/apache2"
>>> >>  -D SUEXEC_BIN="/opt/share/apache2/bin/suexec"
>>> >>  -D DEFAULT_PIDLOG="logs/httpd.pid"
>>> >>  -D DEFAULT_SCOREBOARD="logs/apache_runtime_status"
>>> >>  -D DEFAULT_LOCKFILE="logs/accept.lock"
>>> >>  -D DEFAULT_ERRORLOG="logs/error_log"
>>> >>  -D AP_TYPES_CONFIG_FILE="conf/mime.types"
>>> >>  -D SERVER_CONFIG_FILE="conf/httpd.conf"
>>> >>
>>> >>
>>> >> 2. gentoo (64 bit dual proc AMD):
>>> >> Linux host1 2.6.16-gentoo-r9 #7 SMP Fri Mar 16 17:35:26 UTC 2007
>>> >> x86_64 AMD
>>> >> Opteron(tm) Processor 248 AuthenticAMD GNU/Linux
>>> >>
>>> >> Server version: Apache/2.2.4 (Unix)
>>> >> Server built:   Jun 26 2007 19:29:33
>>> >> Server's Module Magic Number: 20051115:4
>>> >> Server loaded:  APR 1.2.8, APR-Util 1.2.8
>>> >> Compiled using: APR 1.2.8, APR-Util 1.2.8
>>> >> Architecture:   64-bit
>>> >> Server MPM:     Prefork
>>> >>   threaded:     no
>>> >>     forked:     yes (variable process count)
>>> >> Server compiled with....
>>> >>  -D APACHE_MPM_DIR="server/mpm/prefork"
>>> >>  -D APR_HAS_SENDFILE
>>> >>  -D APR_HAS_MMAP
>>> >>  -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)
>>> >>  -D APR_USE_SYSVSEM_SERIALIZE
>>> >>  -D APR_USE_PTHREAD_SERIALIZE
>>> >>  -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT
>>> >>  -D APR_HAS_OTHER_CHILD
>>> >>  -D AP_HAVE_RELIABLE_PIPED_LOGS
>>> >>  -D DYNAMIC_MODULE_LIMIT=128
>>> >>  -D HTTPD_ROOT="/usr"
>>> >>  -D SUEXEC_BIN="/usr/sbin/suexec"
>>> >>  -D DEFAULT_PIDLOG="/var/run/httpd.pid"
>>> >>  -D DEFAULT_SCOREBOARD="logs/apache_runtime_status"
>>> >>  -D DEFAULT_LOCKFILE="/var/run/accept.lock"
>>> >>  -D DEFAULT_ERRORLOG="logs/error_log"
>>> >>  -D AP_TYPES_CONFIG_FILE="/etc/apache2/mime.types"
>>> >>  -D SERVER_CONFIG_FILE="/etc/apache2/httpd.conf"
>>> >>
>>> >> 3. Ubuntu Feisty (32 bit Intel core duo - ubuntu repos):
>>> >> Linux host2 2.6.20-16-generic #2 SMP Thu Jun 7 20:19:32 UTC 2007 i686
>>> >> GNU/Linux
>>> >>
>>> >> Server version: Apache/2.2.3
>>> >> Server built:   Jan 15 2007 18:14:50
>>> >> Server's Module Magic Number: 20051115:3
>>> >> Server loaded:  APR 1.2.7, APR-Util 1.2.7
>>> >> Compiled using: APR 1.2.7, APR-Util 1.2.7
>>> >> Architecture:   32-bit
>>> >> Server MPM:     Prefork
>>> >>   threaded:     no
>>> >>     forked:     yes (variable process count)
>>> >> Server compiled with....
>>> >>  -D APACHE_MPM_DIR="server/mpm/prefork"
>>> >>  -D APR_HAS_SENDFILE
>>> >>  -D APR_HAS_MMAP
>>> >>  -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)
>>> >>  -D APR_USE_SYSVSEM_SERIALIZE
>>> >>  -D APR_USE_PTHREAD_SERIALIZE
>>> >>  -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT
>>> >>  -D APR_HAS_OTHER_CHILD
>>> >>  -D AP_HAVE_RELIABLE_PIPED_LOGS
>>> >>  -D DYNAMIC_MODULE_LIMIT=128
>>> >>  -D HTTPD_ROOT=""
>>> >>  -D SUEXEC_BIN="/usr/lib/apache2/suexec"
>>> >>  -D DEFAULT_PIDLOG="/var/run/apache2.pid"
>>> >>  -D DEFAULT_SCOREBOARD="logs/apache_runtime_status"
>>> >>  -D DEFAULT_LOCKFILE="/var/run/apache2/accept.lock"
>>> >>  -D DEFAULT_ERRORLOG="logs/error_log"
>>> >>  -D AP_TYPES_CONFIG_FILE="/etc/apache2/mime.types"
>>> >>  -D SERVER_CONFIG_FILE="/etc/apache2/apache2.conf"
>>> >>
>>> >> Bug or just an unexpected apache configuration?? I actually filed a
>>> >> bug against apache core
>>> >> (http://issues.apache.org/bugzilla/show_bug.cgi?id=42749) initially
>>> >> not realizing that it could be a combination of factors that was
>>> >> causing it and not just soe module not being loaded.
>>> >>
>>> >> Thanks.
>>> >> AM
>>> >> _______________________________________________
>>> >> Mod_python mailing list
>>> >> Mod_python@modpython.org
>>> >> http://mailman.modpython.org/mailman/listinfo/mod_python
>>> >>
>>> >
>>> _______________________________________________
>>> Mod_python mailing list
>>> Mod_python@modpython.org
>>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 

From aseem at metaweb.com  Thu Jun 28 17:40:16 2007
From: aseem at metaweb.com (Aseem Mohanty)
Date: Thu Jun 28 17:40:26 2007
Subject: [mod_python] mod_python + mod_authz_host w/o mod_auth_digest
	causes ~1Mb leak per apache graceful restart
In-Reply-To: <468427B8.6070507@jgassociates.ca>
References: <46829D3D.2000601@metaweb.com>
	<4682C68E.20302@jgassociates.ca>		<4682E887.3010205@metaweb.com>	<88e286470706271615u7b03c422qba7250c4d325ea28@mail.gmail.com>
	<468300A8.5020701@metaweb.com> <468427B8.6070507@jgassociates.ca>
Message-ID: <46842AC0.9070000@metaweb.com>

Jim Gallacher wrote:
> I've confirmed that mod_python leaks on graceful restart, but I don't 
> see the dependency on the auth* modules. Apache always seems to leak 
> when mod_python is loaded, regardless of the other modules. My test 
> setup is a little different: On Debian with apache 2.2.3, mpm-worker, 
> mod_python 3.3.1 running within VMWare.

Hmm. The reason I felt that the dependency existed was the difference in the 
size of the leak when the two mod_auth* modules were loaded. In addition, the 
use of mod_authz_host alone did not leak at all, which led me to this 
conclusion. I will try out your config and see if the leak size remains the same 
as just using mod_python only.

> 
> My gut tells me that this may be related to 
> http://issues.apache.org/jira/browse/MODPYTHON-109.
> 
> This issue also reminds me of 
> http://issues.apache.org/jira/browse/MODPYTHON-195.
> 
> I think at this point we should log this in JIRA and move the discussion 
> over to python-dev.
> 
> The obvious (but suboptimal) temporary solution for Aseem is to avoid 
> using graceful restart.

They sure look like good candidates, so should I be looking at mod_wsgi in 
daemon mode (we are serving WSGI apps via an adapter). The reason I ask is that 
we need the graceful restarts and cannot really do without it for now.

Thanks.
AM

> 
> Jim
> 
> Aseem Mohanty wrote:
>> Graham Dumpleton wrote:
>>> Is the version of mod_python you are using one you compiled yourself,
>>> or one from Ubuntu packages?
>>
>> I have used both and it does not seem to matter. When compiling from 
>> source, I did the following:
>> ./configure --prefix=/opt --with-apxs=/opt/share/apache2/bin/apxs
>> make install_dso
>> to use the apache build from source. Apache was build with the 
>> following config:
>> ./configure --prefix=/opt --enable-modules=all 
>> --enable-mods-shared=all --enable-so --with-included-apr
>>
>>>
>>> Is the version of Python you are using one you compiled yourself, or
>>> one from Ubuntu packages?
>>
>> Python-2.5.1 is the one from the ubuntu packages.05:22 PM $ python
>> Python 2.5.1 (r251:54863, May  2 2007, 16:56:35)
>> [GCC 4.1.2 (Ubuntu 4.1.2-0ubuntu4)] on linux2
>> Type "help", "copyright", "credits" or "license" for more information.
>>
>>>
>>> What is the size of mod_python.so? Does it use a shared Python library
>>> or static? Use 'ldd' on mod_python.so to see dependencies.
>>
>> mod_python from ubuntu packages:
>> v 3.2.10
>> 05:24 PM $ ll mod_python.so
>> -rw-r--r-- 1 root root 99K 2007-01-16 04:44 mod_python.so
>> 05:24 PM $ ldd mod_python.so
>>         linux-gate.so.1 =>  (0xffffe000)
>>         libpython2.5.so.1.0 => /usr/lib/libpython2.5.so.1.0 (0xb7e4f000)
>>         libpthread.so.0 => /lib/tls/i686/cmov/libpthread.so.0 
>> (0xb7e38000)
>>         libdl.so.2 => /lib/tls/i686/cmov/libdl.so.2 (0xb7e33000)
>>         libutil.so.1 => /lib/tls/i686/cmov/libutil.so.1 (0xb7e2f000)
>>         libm.so.6 => /lib/tls/i686/cmov/libm.so.6 (0xb7e08000)
>>         libc.so.6 => /lib/tls/i686/cmov/libc.so.6 (0xb7cc7000)
>>         /lib/ld-linux.so.2 (0x80000000)
>>
>> mod_python built from source:
>> v 3.3.1
>> 05:25 PM $ ll mod_python.so
>> -rwxr-xr-x 1 aseem aseem 343K 2007-06-27 09:50 mod_python.so*
>> aseem @ narada: /opt/share/apache2/modules
>> 05:25 PM $ ldd mod_python.so
>>         linux-gate.so.1 =>  (0xffffe000)
>>         libpython2.5.so.1.0 => /usr/lib/libpython2.5.so.1.0 (0xb7e30000)
>>         libpthread.so.0 => /lib/tls/i686/cmov/libpthread.so.0 
>> (0xb7e19000)
>>         libdl.so.2 => /lib/tls/i686/cmov/libdl.so.2 (0xb7e14000)
>>         libutil.so.1 => /lib/tls/i686/cmov/libutil.so.1 (0xb7e10000)
>>         libm.so.6 => /lib/tls/i686/cmov/libm.so.6 (0xb7de9000)
>>         libc.so.6 => /lib/tls/i686/cmov/libc.so.6 (0xb7ca8000)
>>         /lib/ld-linux.so.2 (0x80000000)
>>
>> In both cases they do seem to use shared python libs.
>>
>> Thanks.
>> AM
>>
>>>
>>> Graham
>>>
>>> On 28/06/07, Aseem Mohanty <aseem@metaweb.com> wrote:
>>>> Yes, hence the exotic phraseology. Results for the various 
>>>> combinations are below:
>>>>
>>>> 1. mod_python only, no mod_auth* modules:                   leaks
>>>> 2. mod_auth_digest only, no other mod_auth*, no mod_python: does not 
>>>> leak
>>>> 3. mod_authz_host only, no other mod_auth*, no mod_python:  does not 
>>>> leak
>>>> 4. mod_python + mod_authz_host, no mod_auth_digest:         leaks
>>>> 5. mod_python + mod_auth_digest, no mod_authz_host:         leaks < 
>>>> (1) or (4)
>>>> 6. mod_python + mod_auth_digest + mod_authz_host:           does not 
>>>> leak
>>>>
>>>> NOTE: 'does not leak' implies ~50-100K leakage per graceful restart
>>>>        (5) leaks ~500-600K per graceful restart
>>>>        zero load on server
>>>>
>>>> As far as I can tell there is definitely some sinister interaction 
>>>> going on
>>>> between these three modules. Unfortunately not being conversant with 
>>>> apache
>>>> module development, I cannot really say what.
>>>>
>>>> Thanks.
>>>> AM
>>>>
>>>>
>>>> Jim Gallacher wrote:
>>>> > Aseem Mohanty wrote:
>>>> >> This may sound quite exotic
>>>> >
>>>> >
>>>> > Why yes, it does? Interaction between these modules resulting in a
>>>> > memory leak sure sounds weird. Did you try it with *only* mod_python
>>>> > loaded? (ie, without mod_authz_host)
>>>> >
>>>> > Jim
>>>> >
>>>> >> but here it is:
>>>> >>
>>>> >> In a vanilla apache2.2.x configuration if I only load mod_authz_host
>>>> >> and none of
>>>> >> the other mod_auth* modules, every graceful restart causes ~1Mb leak
>>>> >> in the
>>>> >> parent process. This is with mod_python loaded. Without 
>>>> mod_python the
>>>> >> memory profile remains unchanged.
>>>> >>
>>>> >> Steps to reproduce:
>>>> >> Gentoo:
>>>> >> 1. In /etc/apache2/httpd.conf comment out all "LoadModule auth*"
>>>> >> directives except
>>>> >> LoadModule authz_host_module modules/mod_authz_host.so
>>>> >>
>>>> >> Ubuntu Feisty (repos):
>>>> >> 1. In /etc/apache2/mods-enabled rename auth*.load files except
>>>> >> authz_host.load
>>>> >> to auth*.load.not
>>>> >>
>>>> >> Ubuntu Feisty (httpd built from source):
>>>> >> 1. In conf/httpd.conf comment out all "LoadModule auth*" directives
>>>> >> except
>>>> >> LoadModule authz_host_module modules/mod_authz_host.so
>>>> >>
>>>> >> 2. Start apache
>>>> >> 3. Track apache parent process: top -d1 -p $(pgrep -o apache/httpd)
>>>> >> 4. Hit apache instances with graceful restarts:
>>>> >> for i in $(seq 150); do echo $i; kill -USR1 $(pgrep -o 
>>>> apache/httpd);
>>>> >> sleep 2; done
>>>> >>
>>>> >> In this case the parent will leak ~1Mb per restart. If however in 
>>>> each
>>>> >> of the
>>>> >> configurations mod_auth_digest.so is also loaded the leak is only
>>>> >> about 150-200K
>>>> >> or so per graceful restart. This is on a server with 0 load. In my
>>>> >> case it
>>>> >> caused apache instances that were restarted every 55 minutes to grow
>>>> >> up to 300Mb
>>>> >> in a week.
>>>> >>
>>>> >> Tested on:
>>>> >> 1. Ubuntu Feisty (built from source httpd-2.2.4, mod_python-3.3.1):
>>>> >> ./configure --prefix=/opt --enable-modules=all
>>>> >> --enable-mods-shared=all --enable-so --with-included-apr
>>>> >> Server version: Apache/2.2.4 (Unix)
>>>> >> Server built:   Jun 27 2007 09:34:16
>>>> >> Server's Module Magic Number: 20051115:4
>>>> >> Server loaded:  APR 1.2.8, APR-Util 1.2.8
>>>> >> Compiled using: APR 1.2.8, APR-Util 1.2.8
>>>> >> Architecture:   32-bit
>>>> >> Server MPM:     Prefork
>>>> >>   threaded:     no
>>>> >>     forked:     yes (variable process count)
>>>> >> Server compiled with....
>>>> >>  -D APACHE_MPM_DIR="server/mpm/prefork"
>>>> >>  -D APR_HAS_SENDFILE
>>>> >>  -D APR_HAS_MMAP
>>>> >>  -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)
>>>> >>  -D APR_USE_SYSVSEM_SERIALIZE
>>>> >>  -D APR_USE_PTHREAD_SERIALIZE
>>>> >>  -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT
>>>> >>  -D APR_HAS_OTHER_CHILD
>>>> >>  -D AP_HAVE_RELIABLE_PIPED_LOGS
>>>> >>  -D DYNAMIC_MODULE_LIMIT=128
>>>> >>  -D HTTPD_ROOT="/opt/share/apache2"
>>>> >>  -D SUEXEC_BIN="/opt/share/apache2/bin/suexec"
>>>> >>  -D DEFAULT_PIDLOG="logs/httpd.pid"
>>>> >>  -D DEFAULT_SCOREBOARD="logs/apache_runtime_status"
>>>> >>  -D DEFAULT_LOCKFILE="logs/accept.lock"
>>>> >>  -D DEFAULT_ERRORLOG="logs/error_log"
>>>> >>  -D AP_TYPES_CONFIG_FILE="conf/mime.types"
>>>> >>  -D SERVER_CONFIG_FILE="conf/httpd.conf"
>>>> >>
>>>> >>
>>>> >> 2. gentoo (64 bit dual proc AMD):
>>>> >> Linux host1 2.6.16-gentoo-r9 #7 SMP Fri Mar 16 17:35:26 UTC 2007
>>>> >> x86_64 AMD
>>>> >> Opteron(tm) Processor 248 AuthenticAMD GNU/Linux
>>>> >>
>>>> >> Server version: Apache/2.2.4 (Unix)
>>>> >> Server built:   Jun 26 2007 19:29:33
>>>> >> Server's Module Magic Number: 20051115:4
>>>> >> Server loaded:  APR 1.2.8, APR-Util 1.2.8
>>>> >> Compiled using: APR 1.2.8, APR-Util 1.2.8
>>>> >> Architecture:   64-bit
>>>> >> Server MPM:     Prefork
>>>> >>   threaded:     no
>>>> >>     forked:     yes (variable process count)
>>>> >> Server compiled with....
>>>> >>  -D APACHE_MPM_DIR="server/mpm/prefork"
>>>> >>  -D APR_HAS_SENDFILE
>>>> >>  -D APR_HAS_MMAP
>>>> >>  -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)
>>>> >>  -D APR_USE_SYSVSEM_SERIALIZE
>>>> >>  -D APR_USE_PTHREAD_SERIALIZE
>>>> >>  -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT
>>>> >>  -D APR_HAS_OTHER_CHILD
>>>> >>  -D AP_HAVE_RELIABLE_PIPED_LOGS
>>>> >>  -D DYNAMIC_MODULE_LIMIT=128
>>>> >>  -D HTTPD_ROOT="/usr"
>>>> >>  -D SUEXEC_BIN="/usr/sbin/suexec"
>>>> >>  -D DEFAULT_PIDLOG="/var/run/httpd.pid"
>>>> >>  -D DEFAULT_SCOREBOARD="logs/apache_runtime_status"
>>>> >>  -D DEFAULT_LOCKFILE="/var/run/accept.lock"
>>>> >>  -D DEFAULT_ERRORLOG="logs/error_log"
>>>> >>  -D AP_TYPES_CONFIG_FILE="/etc/apache2/mime.types"
>>>> >>  -D SERVER_CONFIG_FILE="/etc/apache2/httpd.conf"
>>>> >>
>>>> >> 3. Ubuntu Feisty (32 bit Intel core duo - ubuntu repos):
>>>> >> Linux host2 2.6.20-16-generic #2 SMP Thu Jun 7 20:19:32 UTC 2007 
>>>> i686
>>>> >> GNU/Linux
>>>> >>
>>>> >> Server version: Apache/2.2.3
>>>> >> Server built:   Jan 15 2007 18:14:50
>>>> >> Server's Module Magic Number: 20051115:3
>>>> >> Server loaded:  APR 1.2.7, APR-Util 1.2.7
>>>> >> Compiled using: APR 1.2.7, APR-Util 1.2.7
>>>> >> Architecture:   32-bit
>>>> >> Server MPM:     Prefork
>>>> >>   threaded:     no
>>>> >>     forked:     yes (variable process count)
>>>> >> Server compiled with....
>>>> >>  -D APACHE_MPM_DIR="server/mpm/prefork"
>>>> >>  -D APR_HAS_SENDFILE
>>>> >>  -D APR_HAS_MMAP
>>>> >>  -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)
>>>> >>  -D APR_USE_SYSVSEM_SERIALIZE
>>>> >>  -D APR_USE_PTHREAD_SERIALIZE
>>>> >>  -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT
>>>> >>  -D APR_HAS_OTHER_CHILD
>>>> >>  -D AP_HAVE_RELIABLE_PIPED_LOGS
>>>> >>  -D DYNAMIC_MODULE_LIMIT=128
>>>> >>  -D HTTPD_ROOT=""
>>>> >>  -D SUEXEC_BIN="/usr/lib/apache2/suexec"
>>>> >>  -D DEFAULT_PIDLOG="/var/run/apache2.pid"
>>>> >>  -D DEFAULT_SCOREBOARD="logs/apache_runtime_status"
>>>> >>  -D DEFAULT_LOCKFILE="/var/run/apache2/accept.lock"
>>>> >>  -D DEFAULT_ERRORLOG="logs/error_log"
>>>> >>  -D AP_TYPES_CONFIG_FILE="/etc/apache2/mime.types"
>>>> >>  -D SERVER_CONFIG_FILE="/etc/apache2/apache2.conf"
>>>> >>
>>>> >> Bug or just an unexpected apache configuration?? I actually filed a
>>>> >> bug against apache core
>>>> >> (http://issues.apache.org/bugzilla/show_bug.cgi?id=42749) initially
>>>> >> not realizing that it could be a combination of factors that was
>>>> >> causing it and not just soe module not being loaded.
>>>> >>
>>>> >> Thanks.
>>>> >> AM
>>>> >> _______________________________________________
>>>> >> Mod_python mailing list
>>>> >> Mod_python@modpython.org
>>>> >> http://mailman.modpython.org/mailman/listinfo/mod_python
>>>> >>
>>>> >
>>>> _______________________________________________
>>>> Mod_python mailing list
>>>> Mod_python@modpython.org
>>>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>>>
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>
> 
From graham.dumpleton at gmail.com  Thu Jun 28 18:12:56 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu Jun 28 18:13:03 2007
Subject: [mod_python] mod_python + mod_authz_host w/o mod_auth_digest
	causes ~1Mb leak per apache graceful restart
In-Reply-To: <46842AC0.9070000@metaweb.com>
References: <46829D3D.2000601@metaweb.com> <4682C68E.20302@jgassociates.ca>
	<4682E887.3010205@metaweb.com>
	<88e286470706271615u7b03c422qba7250c4d325ea28@mail.gmail.com>
	<468300A8.5020701@metaweb.com> <468427B8.6070507@jgassociates.ca>
	<46842AC0.9070000@metaweb.com>
Message-ID: <88e286470706281512o2714d5a9vda7e06f41240ac05@mail.gmail.com>

On 29/06/07, Aseem Mohanty <aseem@metaweb.com> wrote:
> They sure look like good candidates, so should I be looking at mod_wsgi in
> daemon mode (we are serving WSGI apps via an adapter). The reason I ask is that
> we need the graceful restarts and cannot really do without it for now.

Maybe not. When I look at it, mod_wsgi is also leaking on 'graceful'
and 'restart' as well. If these leaks are from Python itself not
cleaning things up properly, not sure what I am going to do. Unlike
mod_python I actually Py_Finalize() the interpreter in the main
process so that everything is properly reset back to a clean slate, so
I may actually be more susceptible to it than mod_python.

I'll investigate the mod_wsgi problem and maybe that will throw some
light on why mod_python also has problems.

Graham
From graham.dumpleton at gmail.com  Thu Jun 28 18:21:40 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu Jun 28 18:21:46 2007
Subject: [mod_python] mod_python + mod_authz_host w/o mod_auth_digest
	causes ~1Mb leak per apache graceful restart
In-Reply-To: <88e286470706281512o2714d5a9vda7e06f41240ac05@mail.gmail.com>
References: <46829D3D.2000601@metaweb.com> <4682C68E.20302@jgassociates.ca>
	<4682E887.3010205@metaweb.com>
	<88e286470706271615u7b03c422qba7250c4d325ea28@mail.gmail.com>
	<468300A8.5020701@metaweb.com> <468427B8.6070507@jgassociates.ca>
	<46842AC0.9070000@metaweb.com>
	<88e286470706281512o2714d5a9vda7e06f41240ac05@mail.gmail.com>
Message-ID: <88e286470706281521k20b7c485x1811c29af734fa56@mail.gmail.com>

On 29/06/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> On 29/06/07, Aseem Mohanty <aseem@metaweb.com> wrote:
> > They sure look like good candidates, so should I be looking at mod_wsgi in
> > daemon mode (we are serving WSGI apps via an adapter). The reason I ask is that
> > we need the graceful restarts and cannot really do without it for now.
>
> Maybe not. When I look at it, mod_wsgi is also leaking on 'graceful'
> and 'restart' as well. If these leaks are from Python itself not
> cleaning things up properly, not sure what I am going to do. Unlike
> mod_python I actually Py_Finalize() the interpreter in the main
> process so that everything is properly reset back to a clean slate, so
> I may actually be more susceptible to it than mod_python.
>
> I'll investigate the mod_wsgi problem and maybe that will throw some
> light on why mod_python also has problems.

FWIW, my Apache leaks on 'graceful' even without mod_wsgi loaded, just
doesn't leak as much. :-(

Graham
From aaron.robinson at mojoworld.com  Thu Jun 28 18:30:59 2007
From: aaron.robinson at mojoworld.com (Aaron Robinson)
Date: Thu Jun 28 18:32:17 2007
Subject: [mod_python] Checking a PSP-generated response before starting to
	send it..?
In-Reply-To: <0JKA007GFL8PWT10@smtp3.clear.net.nz>
Message-ID: <0JKD0095PALGDR30@smtp4.clear.net.nz>

For lack of any feedback on this, I've come up with 1/2 a solution
(possibly), but would still very much appreciate *any* input..

 

I've written a output filter which read()'s all the input it gets, then
stores it in an attribute it creates on filter.req (and write()'s nothing),
then when it reads None (end of stream) it can compare the total page to the
last sent page and either write() the whole page (unmodified) or change the
'Last-Modified' date to the previous date + change the response code to a
304...  problem is that I don't know if it's possible for an output filter
to change the response code..

 

Any ideas on how to make an output filter change the response code, or
whether there are any holes in this plan - or preferably if there's a way to
avoid this completely?

 

Thanks,

Aaron.

 

  _____  

From: mod_python-bounces@modpython.org
[mailto:mod_python-bounces@modpython.org] On Behalf Of Aaron Robinson
Sent: Wednesday, 27 June 2007 11:28 p.m.
To: mod_python@modpython.org
Subject: [mod_python] Checking a PSP-generated response before starting to
send it..?

 

Hi all,

 

I'm running Apache 2.2.4 on Win32 with mod_python 3.3.1 and Python 2.5.1.

I'm completely new to Apache (and hence mod_python), but am reasonably
proficient with python itself.

 

I'm working on a web service where all content is generated on the fly, and
am wanting to use PSP to facilitate this.

Making as much use as possible of "304: Not Modified" is extremely important
to this project to reduce bandwidth, which is difficult as I have to
generate the content before I know whether it's different ("been modified")
from the last time I sent it or not..

 

I previously used a mechanism (not using Apache) where I would generate the
response, then take a hash of it and if it matched the hash of the last
response I sent, I would instead send a "304: Not Modified".

My problem is that when using PSP.run(), the response has already been sent
by the time it's finished being generated, so I have no opportunity to step
in and examine the response to see if sending a 304 is possible.

 

I'm needing an across-the-board mechanism for dealing with this - I thought
of serializing the "vars" dictionary before passing it in and taking a hash
of that for comparison, but this is hardly full-proof, as it would
(incorrectly) lead to responding with a 304 even with different "session"
information, or, in the slightly odd case that the PSP file made use of
random.random(), etc.

 

Just a thought: Is there a more general mechanism that can detect identical
content to a previous response on the way out and replace it with a 304?

 

Thanks in advance,

Aaron.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070629/c0ebb402/attachment.html
From graham.dumpleton at gmail.com  Thu Jun 28 18:44:29 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu Jun 28 18:44:35 2007
Subject: [mod_python] Checking a PSP-generated response before starting to
	send it..?
In-Reply-To: <0JKD0095PALGDR30@smtp4.clear.net.nz>
References: <0JKA007GFL8PWT10@smtp3.clear.net.nz>
	<0JKD0095PALGDR30@smtp4.clear.net.nz>
Message-ID: <88e286470706281544of11ad95lef3ec585201a96b3@mail.gmail.com>

On 29/06/07, Aaron Robinson <aaron.robinson@mojoworld.com> wrote:
>
>
>
>
> For lack of any feedback on this, I've come up with 1/2 a solution
> (possibly), but would still very much appreciate *any* input..
>
>
>
> I've written a output filter which read()'s all the input it gets, then
> stores it in an attribute it creates on filter.req (and write()'s nothing),
> then when it reads None (end of stream) it can compare the total page to the
> last sent page and either write() the whole page (unmodified) or change the
> 'Last-Modified' date to the previous date + change the response code to a
> 304...  problem is that I don't know if it's possible for an output filter
> to change the response code..
>
>
>
> Any ideas on how to make an output filter change the response code, or
> whether there are any holes in this plan - or preferably if there's a way to
> avoid this completely?

Can't be done.

I'm a bit busy to respond in detail on this at the moment, but do a
search through the mailing list archives using the search box on
www.modpython.org for 'publisher PSP'. This should pick up messages
which talk about using PSP from publisher, thus giving you more
control. There has also been past discussions on how to make PSP
output to a string so one can process output like you want. Look for
'PSP request wrapper'.

Graham

> Thanks,
>
> Aaron.
>
>
>
>  ________________________________
>
>
> From: mod_python-bounces@modpython.org
> [mailto:mod_python-bounces@modpython.org] On Behalf Of
> Aaron Robinson
>  Sent: Wednesday, 27 June 2007 11:28 p.m.
>  To: mod_python@modpython.org
>  Subject: [mod_python] Checking a PSP-generated response before starting to
> send it..?
>
>
>
>
> Hi all,
>
>
>
> I'm running Apache 2.2.4 on Win32 with mod_python 3.3.1 and Python 2.5.1.
>
> I'm completely new to Apache (and hence mod_python), but am reasonably
> proficient with python itself.
>
>
>
> I'm working on a web service where all content is generated on the fly, and
> am wanting to use PSP to facilitate this.
>
> Making as much use as possible of "304: Not Modified" is extremely important
> to this project to reduce bandwidth, which is difficult as I have to
> generate the content before I know whether it's different ("been modified")
> from the last time I sent it or not..
>
>
>
> I previously used a mechanism (not using Apache) where I would generate the
> response, then take a hash of it and if it matched the hash of the last
> response I sent, I would instead send a "304: Not Modified".
>
> My problem is that when using PSP.run(), the response has already been sent
> by the time it's finished being generated, so I have no opportunity to step
> in and examine the response to see if sending a 304 is possible.
>
>
>
> I'm needing an across-the-board mechanism for dealing with this - I thought
> of serializing the "vars" dictionary before passing it in and taking a hash
> of that for comparison, but this is hardly full-proof, as it would
> (incorrectly) lead to responding with a 304 even with different "session"
> information, or, in the slightly odd case that the PSP file made use of
> random.random(), etc.
>
>
>
> Just a thought: Is there a more general mechanism that can detect identical
> content to a previous response on the way out and replace it with a 304?
>
>
>
> Thanks in advance,
>
> Aaron.
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
From graham.dumpleton at gmail.com  Thu Jun 28 20:15:48 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu Jun 28 20:15:55 2007
Subject: [mod_python] mod_python + mod_authz_host w/o mod_auth_digest
	causes ~1Mb leak per apache graceful restart
In-Reply-To: <88e286470706281512o2714d5a9vda7e06f41240ac05@mail.gmail.com>
References: <46829D3D.2000601@metaweb.com> <4682C68E.20302@jgassociates.ca>
	<4682E887.3010205@metaweb.com>
	<88e286470706271615u7b03c422qba7250c4d325ea28@mail.gmail.com>
	<468300A8.5020701@metaweb.com> <468427B8.6070507@jgassociates.ca>
	<46842AC0.9070000@metaweb.com>
	<88e286470706281512o2714d5a9vda7e06f41240ac05@mail.gmail.com>
Message-ID: <88e286470706281715x486cfc9eu85615d5704828b8c@mail.gmail.com>

On 29/06/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> On 29/06/07, Aseem Mohanty <aseem@metaweb.com> wrote:
> > They sure look like good candidates, so should I be looking at mod_wsgi in
> > daemon mode (we are serving WSGI apps via an adapter). The reason I ask is that
> > we need the graceful restarts and cannot really do without it for now.
>
> Maybe not. When I look at it, mod_wsgi is also leaking on 'graceful'
> and 'restart' as well. If these leaks are from Python itself not
> cleaning things up properly, not sure what I am going to do. Unlike
> mod_python I actually Py_Finalize() the interpreter in the main
> process so that everything is properly reset back to a clean slate, so
> I may actually be more susceptible to it than mod_python.
>
> I'll investigate the mod_wsgi problem and maybe that will throw some
> light on why mod_python also has problems.

Its okay to try mod_wsgi now if you want to see whether you get memory
leaks there as well. Just make sure you update from repository if you
already had it checked out. Obviously, don't load mod_python at the
same time.

The change I made in mod_wsgi was to comment out trigger for recycling
Python interpreter in main Apache process. This was only being done
for Apache 2.X and not Apache 1.3, so I know not doing it doesn't
cause a problem. I do still see very minor leaks, but the same ones I
get without mod_wsgi.

I'll try now and see what happens with mod_wsgi when I add the auth
modules you are talking about. If that is okay with mod_wsgi, can try
with mod_python and see if I can work out what the differences are.

Graham
From graham.dumpleton at gmail.com  Fri Jun 29 02:31:06 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Fri Jun 29 02:31:15 2007
Subject: [mod_python] Checking a PSP-generated response before starting to
	send it..?
In-Reply-To: <88e286470706281544of11ad95lef3ec585201a96b3@mail.gmail.com>
References: <0JKA007GFL8PWT10@smtp3.clear.net.nz>
	<0JKD0095PALGDR30@smtp4.clear.net.nz>
	<88e286470706281544of11ad95lef3ec585201a96b3@mail.gmail.com>
Message-ID: <88e286470706282331t6a2f8e0ajd4e54e0a6999271d@mail.gmail.com>

Hmmm, those search terms may not have helped much. Try:

  http://www.modpython.org/pipermail/mod_python/2005-May/018230.html

instead.

Have also logged an issued for adding proper way of doing this since
it does come up occasionally.

  https://issues.apache.org/jira/browse/MODPYTHON-236

Graham

On 29/06/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> On 29/06/07, Aaron Robinson <aaron.robinson@mojoworld.com> wrote:
> >
> >
> >
> >
> > For lack of any feedback on this, I've come up with 1/2 a solution
> > (possibly), but would still very much appreciate *any* input..
> >
> >
> >
> > I've written a output filter which read()'s all the input it gets, then
> > stores it in an attribute it creates on filter.req (and write()'s nothing),
> > then when it reads None (end of stream) it can compare the total page to the
> > last sent page and either write() the whole page (unmodified) or change the
> > 'Last-Modified' date to the previous date + change the response code to a
> > 304...  problem is that I don't know if it's possible for an output filter
> > to change the response code..
> >
> >
> >
> > Any ideas on how to make an output filter change the response code, or
> > whether there are any holes in this plan - or preferably if there's a way to
> > avoid this completely?
>
> Can't be done.
>
> I'm a bit busy to respond in detail on this at the moment, but do a
> search through the mailing list archives using the search box on
> www.modpython.org for 'publisher PSP'. This should pick up messages
> which talk about using PSP from publisher, thus giving you more
> control. There has also been past discussions on how to make PSP
> output to a string so one can process output like you want. Look for
> 'PSP request wrapper'.
>
> Graham
>
> > Thanks,
> >
> > Aaron.
> >
> >
> >
> >  ________________________________
> >
> >
> > From: mod_python-bounces@modpython.org
> > [mailto:mod_python-bounces@modpython.org] On Behalf Of
> > Aaron Robinson
> >  Sent: Wednesday, 27 June 2007 11:28 p.m.
> >  To: mod_python@modpython.org
> >  Subject: [mod_python] Checking a PSP-generated response before starting to
> > send it..?
> >
> >
> >
> >
> > Hi all,
> >
> >
> >
> > I'm running Apache 2.2.4 on Win32 with mod_python 3.3.1 and Python 2.5.1.
> >
> > I'm completely new to Apache (and hence mod_python), but am reasonably
> > proficient with python itself.
> >
> >
> >
> > I'm working on a web service where all content is generated on the fly, and
> > am wanting to use PSP to facilitate this.
> >
> > Making as much use as possible of "304: Not Modified" is extremely important
> > to this project to reduce bandwidth, which is difficult as I have to
> > generate the content before I know whether it's different ("been modified")
> > from the last time I sent it or not..
> >
> >
> >
> > I previously used a mechanism (not using Apache) where I would generate the
> > response, then take a hash of it and if it matched the hash of the last
> > response I sent, I would instead send a "304: Not Modified".
> >
> > My problem is that when using PSP.run(), the response has already been sent
> > by the time it's finished being generated, so I have no opportunity to step
> > in and examine the response to see if sending a 304 is possible.
> >
> >
> >
> > I'm needing an across-the-board mechanism for dealing with this - I thought
> > of serializing the "vars" dictionary before passing it in and taking a hash
> > of that for comparison, but this is hardly full-proof, as it would
> > (incorrectly) lead to responding with a 304 even with different "session"
> > information, or, in the slightly odd case that the PSP file made use of
> > random.random(), etc.
> >
> >
> >
> > Just a thought: Is there a more general mechanism that can detect identical
> > content to a previous response on the way out and replace it with a 304?
> >
> >
> >
> > Thanks in advance,
> >
> > Aaron.
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
> >
>
From aaron.robinson at mojoworld.com  Fri Jun 29 04:17:36 2007
From: aaron.robinson at mojoworld.com (Aaron Robinson)
Date: Fri Jun 29 04:19:12 2007
Subject: [mod_python] Checking a PSP-generated response before starting to
	send it..?
In-Reply-To: <88e286470706282331t6a2f8e0ajd4e54e0a6999271d@mail.gmail.com>
Message-ID: <0JKE00J371R6JV10@smtp4.clear.net.nz>

Hi Graham,

Thanks for your responses - I did find some interesting emails based on the
search terms you mentioned; many of them elaborating on hacks I'd pondered
on but dismissed as being too "hacky" - as I'm not familiar with mod_python
I didn't want to settle for a hack when there was a better way, but it was
taking me a while to come to the realization that there wasn't one..

The hack I'm toying with at the moment seems very simple and with only one
limitation, being that you can't directly reference "req" in the PSP code,
although I believe you can use "psp.req" to get the desired effect if
needed..
Here it is:


	class WriteThingy(StringIO.StringIO):
		def write(self, string, flush=1):
	      	StringIO.StringIO.write(self, string)

	vars['req'] = WriteThingy()
	template.run(vars)
	html = vars['req'].getvalue()


The only problem I have with this is that it's written after scrutinizing
the internals of the .run() method, and based on knowledge of exactly which
order things happen in, which could change with future versions.

Please let me know if you can see any holes in this..

Thanks for putting in the feature request - I think it's a completely worthy
feature, and if implemented, I think there would be more room for further
enhancements in future...


<WARNING: Going off on a tangent ahead..>


Here's another little something that I'm wondering whether is possible or
not in PSP... Below is a sample of my own little scripting language - works
the same way as PSP but it's all written the long way rather than evaluating
python code. It's got a few advantages over PSP from what I can tell, but
I'm willing to throw this one away to get the increased speed of PSP -
anyway, here goes:


	<div>
		^if iFromUID == iUID^
			<b>You</b>
		^else^
			<b>^escape(sFromAlias)^</b>
		^endif^
		^*TRIM*^:
	</div>



Now the result ends up on the screen as either "You :" or "Bob :" (or
whatever sFromAlias was)..  It's actually supposed to be "You:" or "Bob:"
(ie: without the space) but because html renderers turn strings of
whitespace into a single space, I added the *TRIM* directive, which
basically just removes whitespace to the left and right of where it's placed
to achieve this while still retaining readable code..

Any way you know of to achieve this with PSP?
What made me think of it is that it'd be simple to add if the PSP class
manipulated the result as a string rather then writing it out directly..

Thanks for your help,
Aaron.



-----Original Message-----
From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com] 
Sent: Friday, 29 June 2007 6:31 p.m.
To: Aaron Robinson
Cc: mod_python@modpython.org
Subject: Re: [mod_python] Checking a PSP-generated response before starting
to send it..?

Hmmm, those search terms may not have helped much. Try:

  http://www.modpython.org/pipermail/mod_python/2005-May/018230.html

instead.

Have also logged an issued for adding proper way of doing this since
it does come up occasionally.

  https://issues.apache.org/jira/browse/MODPYTHON-236

Graham

On 29/06/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> On 29/06/07, Aaron Robinson <aaron.robinson@mojoworld.com> wrote:
> >
> >
> >
> >
> > For lack of any feedback on this, I've come up with 1/2 a solution
> > (possibly), but would still very much appreciate *any* input..
> >
> >
> >
> > I've written a output filter which read()'s all the input it gets, then
> > stores it in an attribute it creates on filter.req (and write()'s
nothing),
> > then when it reads None (end of stream) it can compare the total page to
the
> > last sent page and either write() the whole page (unmodified) or change
the
> > 'Last-Modified' date to the previous date + change the response code to
a
> > 304...  problem is that I don't know if it's possible for an output
filter
> > to change the response code..
> >
> >
> >
> > Any ideas on how to make an output filter change the response code, or
> > whether there are any holes in this plan - or preferably if there's a
way to
> > avoid this completely?
>
> Can't be done.
>
> I'm a bit busy to respond in detail on this at the moment, but do a
> search through the mailing list archives using the search box on
> www.modpython.org for 'publisher PSP'. This should pick up messages
> which talk about using PSP from publisher, thus giving you more
> control. There has also been past discussions on how to make PSP
> output to a string so one can process output like you want. Look for
> 'PSP request wrapper'.
>
> Graham
>
> > Thanks,
> >
> > Aaron.
> >
> >
> >
> >  ________________________________
> >
> >
> > From: mod_python-bounces@modpython.org
> > [mailto:mod_python-bounces@modpython.org] On Behalf Of
> > Aaron Robinson
> >  Sent: Wednesday, 27 June 2007 11:28 p.m.
> >  To: mod_python@modpython.org
> >  Subject: [mod_python] Checking a PSP-generated response before starting
to
> > send it..?
> >
> >
> >
> >
> > Hi all,
> >
> >
> >
> > I'm running Apache 2.2.4 on Win32 with mod_python 3.3.1 and Python
2.5.1.
> >
> > I'm completely new to Apache (and hence mod_python), but am reasonably
> > proficient with python itself.
> >
> >
> >
> > I'm working on a web service where all content is generated on the fly,
and
> > am wanting to use PSP to facilitate this.
> >
> > Making as much use as possible of "304: Not Modified" is extremely
important
> > to this project to reduce bandwidth, which is difficult as I have to
> > generate the content before I know whether it's different ("been
modified")
> > from the last time I sent it or not..
> >
> >
> >
> > I previously used a mechanism (not using Apache) where I would generate
the
> > response, then take a hash of it and if it matched the hash of the last
> > response I sent, I would instead send a "304: Not Modified".
> >
> > My problem is that when using PSP.run(), the response has already been
sent
> > by the time it's finished being generated, so I have no opportunity to
step
> > in and examine the response to see if sending a 304 is possible.
> >
> >
> >
> > I'm needing an across-the-board mechanism for dealing with this - I
thought
> > of serializing the "vars" dictionary before passing it in and taking a
hash
> > of that for comparison, but this is hardly full-proof, as it would
> > (incorrectly) lead to responding with a 304 even with different
"session"
> > information, or, in the slightly odd case that the PSP file made use of
> > random.random(), etc.
> >
> >
> >
> > Just a thought: Is there a more general mechanism that can detect
identical
> > content to a previous response on the way out and replace it with a 304?
> >
> >
> >
> > Thanks in advance,
> >
> > Aaron.
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
> >
>

From ziapannocchia at gmail.com  Fri Jun 29 06:39:50 2007
From: ziapannocchia at gmail.com (ziapannocchia@gmail.com)
Date: Fri Jun 29 06:39:57 2007
Subject: [mod_python] something about re.findall output
Message-ID: <ca4f20450706290339w1883ebc2necc3066181c484f0@mail.gmail.com>

>>> re.findall("[^a-z]",'?')
['\xc3', '\xa7']
>>> re.findall("[^a-zA]",'?')
['\xc3', '\xa7']
>>> re.findall("[^a-z?]",'?')
['\xa7']

Why?

From graham.dumpleton at gmail.com  Fri Jun 29 07:03:42 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Fri Jun 29 07:03:48 2007
Subject: [mod_python] something about re.findall output
In-Reply-To: <ca4f20450706290339w1883ebc2necc3066181c484f0@mail.gmail.com>
References: <ca4f20450706290339w1883ebc2necc3066181c484f0@mail.gmail.com>
Message-ID: <88e286470706290403g61177787m6ee1b39401a41b5c@mail.gmail.com>

This is not a general Python mailing list, but is dedicated to
mod_python, the Python module for Apache. If you are lucky, someone
may respond, but you are better off posting at:

  http://groups.google.com/group/comp.lang.python/topics?hl=en

instead.

Graham

On 29/06/07, ziapannocchia@gmail.com <ziapannocchia@gmail.com> wrote:
> >>> re.findall("[^a-z]",'?')
> ['\xc3', '\xa7']
> >>> re.findall("[^a-zA]",'?')
> ['\xc3', '\xa7']
> >>> re.findall("[^a-z?]",'?')
> ['\xa7']
>
> Why?
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>

From ziapannocchia at gmail.com  Fri Jun 29 08:36:43 2007
From: ziapannocchia at gmail.com (ziapannocchia@gmail.com)
Date: Fri Jun 29 08:36:53 2007
Subject: [mod_python] something about re.findall output
In-Reply-To: <88e286470706290403g61177787m6ee1b39401a41b5c@mail.gmail.com>
References: <ca4f20450706290339w1883ebc2necc3066181c484f0@mail.gmail.com>
	<88e286470706290403g61177787m6ee1b39401a41b5c@mail.gmail.com>
Message-ID: <ca4f20450706290536r5747cb93y6875d8d182355cdb@mail.gmail.com>

2007/6/29, Graham Dumpleton <graham.dumpleton@gmail.com>:
> This is not a general Python mailing list ...
thank. I found lucky here:
http://stuff.vandervossen.net/archive/weblog/2003/07/unicode_in_python

>>> path='[^?]'.decode('utf8')
>>> string='?'.decode('utf8')
>>> re.findall(path,string)
[u'\xe7']

sorry for the wrong posting.

From listas at flavioribeiro.com  Fri Jun 29 14:34:07 2007
From: listas at flavioribeiro.com (=?ISO-8859-1?Q?Fl=E1vio_Ribeiro?=)
Date: Fri Jun 29 14:34:17 2007
Subject: [mod_python] One more UnicodeDecodeError
In-Reply-To: <d80792120706271304h428b444dm87ad469cd6f1fa5e@mail.gmail.com>
References: <873b128e0706271222j2a68f67es43665f7d066f6932@mail.gmail.com>
	<d80792120706271304h428b444dm87ad469cd6f1fa5e@mail.gmail.com>
Message-ID: <873b128e0706291134y54552ddbg7b6339c0465f3fc4@mail.gmail.com>

Here, the full traceback:

Mod_python error: "PythonHandler mod_python.psp"

Traceback (most recent call last):

  File "/usr/lib/python2.4/site-packages/mod_python/apache.py", line
299, in HandlerDispatch
    result = object(req)

  File "/usr/lib/python2.4/site-packages/mod_python/psp.py", line 302,
in handler
    p.run()

  File "/usr/lib/python2.4/site-packages/mod_python/psp.py", line 213, in run
    exec code in global_scope

  File "/home/glossario/cadastro.psp", line 36, in ?
    cadastro = cadastro.cadastra(form['nome'],form['descricao'],fname,form['legenda'],form['fonte'])

  File "/home/glossario/engine.py", line 59, in cadastra
    self.cursor.execute('INSERT BancoDeNomes VALUES (' + self.cadastro + ')')

  File "/usr/lib/python2.4/site-packages/MySQLdb/cursors.py", line
146, in execute
    query = query.encode(charset)

UnicodeDecodeError: 'ascii' codec can't decode byte 0xc3 in position
31: ordinal not in range(128)



2007/6/27, Martin <gzlist@googlemail.com>:
>
> On 27/06/07, Fl?vio Ribeiro <listas@flavioribeiro.com> wrote:
> > Hi everyone,
> >
> > Im new to mod_python psp development and im facing my first problem.
> I've
> > already saw some articles on the web but still doesnt fix my code.
> > Im trying to store some data in a mysql database using mysqldb plus
> > mod_python and when i put some text with accents (?, ?, ?, ...) into a
> form
> > input i receive an error:
> >
> > File "/usr/lib/python2.4/site-packages/MySQLdb/cursors.py",
> > line 146, in execute
> >  query = query.encode(charset)
> >
> > UnicodeDecodeError: 'ascii' codec can't decode byte 0xc3 in position 52:
> > ordinal not in range(128)
>
> You may find a recent thread on a similar topic useful:
> http://www.modpython.org/pipermail/mod_python/2007-June/023904.html
>
> In your particular case it seems (though you have not given the full
> traceback) that you passed a byte string to MySQLdb when it was
> expecting unicode. Therefore it's trying to decode the string using
> the default encoding (ascii) before encoding it again.
>
> You should check the MySQLdb documentation to make sure you are
> calling with the correct parameters, provide the right charset for
> your db if required, and decode any strings you get from forms as
> suggested in the other thread.
>
> Martin
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>



-- 
Fl?vio Ribeiro
listas@flavioribeiro.com
www.flavioribeiro.com
(83) 9981.4441
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070629/fbb42785/attachment.html
From aseem at metaweb.com  Fri Jun 29 14:40:44 2007
From: aseem at metaweb.com (Aseem Mohanty)
Date: Fri Jun 29 14:40:58 2007
Subject: [mod_python] mod_python + mod_authz_host w/o mod_auth_digest
	causes ~1Mb leak per apache graceful restart
In-Reply-To: <88e286470706281715x486cfc9eu85615d5704828b8c@mail.gmail.com>
References: <46829D3D.2000601@metaweb.com> <4682C68E.20302@jgassociates.ca>	
	<4682E887.3010205@metaweb.com>	
	<88e286470706271615u7b03c422qba7250c4d325ea28@mail.gmail.com>	
	<468300A8.5020701@metaweb.com> <468427B8.6070507@jgassociates.ca>	
	<46842AC0.9070000@metaweb.com>	
	<88e286470706281512o2714d5a9vda7e06f41240ac05@mail.gmail.com>
	<88e286470706281715x486cfc9eu85615d5704828b8c@mail.gmail.com>
Message-ID: <4685522C.6020701@metaweb.com>

With the help of a slightly modified version of Jim's script (thanks!) I ran 
some tests with various combinations of mod_python/wsgi/auth_digest/authz_host. 
It turns out that (as Jim mentioned in a previous email) that mod_authz_host is 
a red herring. However mod_auth_digest _definitely_ seems to mitigate the 
effects of the leak caused by mod_python.

OTOH mod_wsgi behaves exactly the same as mod_python in terms memory leakage and 
interaction with mod_auth_digest. Summary statistics of the tests are provided 
below. Detailed logs and script and my initial httpd.conf file are attached.

Test environment:
11:31 AM $ uname -a
Linux host1 2.6.20-16-generic #2 SMP Thu Jun 7 20:19:32 UTC 2007 i686 GNU/Linux
Ubuntu Feisty

11:33 AM $ python
Python 2.5.1 (r251:54863, May  2 2007, 16:56:35)
[GCC 4.1.2 (Ubuntu 4.1.2-0ubuntu4)] on linux2
Type "help", "copyright", "credits" or "license" for more information.
 >>>

apache 2.2.4 (downloaded yesterday) built from source with:
(built from source httpd-2.2.4, mod_python-3.3.1):
./configure --prefix=/opt --enable-modules=all --enable-mods-shared=all 
--enable-so --with-included-apr

mod_python 3.3.1 built from source with:
./configure --prefix=/opt --with-apxs=/opt/share/apache2/bin/apxs
make install_dso

mod_wsgi (svn-trunk) built from source with:
./configure --prefix=/opt --with-apxs=/opt/share/apache2/bin/apxs

ldd for both modules:
11:37 AM $ ldd mod_python.so
         linux-gate.so.1 =>  (0xffffe000)
         libpython2.5.so.1.0 => /usr/lib/libpython2.5.so.1.0 (0xb7df6000)
         libpthread.so.0 => /lib/tls/i686/cmov/libpthread.so.0 (0xb7ddf000)
         libdl.so.2 => /lib/tls/i686/cmov/libdl.so.2 (0xb7dda000)
         libutil.so.1 => /lib/tls/i686/cmov/libutil.so.1 (0xb7dd6000)
         libm.so.6 => /lib/tls/i686/cmov/libm.so.6 (0xb7daf000)
         libc.so.6 => /lib/tls/i686/cmov/libc.so.6 (0xb7c6e000)
         /lib/ld-linux.so.2 (0x80000000)
11:37 AM $ ldd mod_wsgi.so
         linux-gate.so.1 =>  (0xffffe000)
         libpython2.5.so.1.0 => /usr/lib/libpython2.5.so.1.0 (0xb7dd0000)
         libpthread.so.0 => /lib/tls/i686/cmov/libpthread.so.0 (0xb7db9000)
         libdl.so.2 => /lib/tls/i686/cmov/libdl.so.2 (0xb7db4000)
         libutil.so.1 => /lib/tls/i686/cmov/libutil.so.1 (0xb7db0000)
         libc.so.6 => /lib/tls/i686/cmov/libc.so.6 (0xb7c6f000)
         libm.so.6 => /lib/tls/i686/cmov/libm.so.6 (0xb7c48000)
         /lib/ld-linux.so.2 (0x80000000)

Modules	Loaded		Res Mem Start		Res Mem End
------------------------------------------------------------
None of the 4 loaded	2336			2424
============================================================
mod_python		5028			72M
------------------------------------------------------------
mod_python		5044			72M
mod_authz_host
------------------------------------------------------------
mod_python		5052			30M
mod_auth_digest
------------------------------------------------------------
mod_python		5056			28M
mod_authz_host
mod_auth_digest
============================================================
mod_wsgi		4984			72M
------------------------------------------------------------
mod_wsgi		5000			72M
mod_authz_host
------------------------------------------------------------
mod_wsgi		5024			22M
mod_auth_digest
------------------------------------------------------------
mod_wsgi		5020			30M
mod_authz_host
mod_auth_digest
============================================================

For now I am content with adding the LoadModule directive for mod_auth_digest 
since it a pretty good workaround with an almost non-existent overhead.

Thanks.
AM

Graham Dumpleton wrote:
> On 29/06/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
>> On 29/06/07, Aseem Mohanty <aseem@metaweb.com> wrote:
>> > They sure look like good candidates, so should I be looking at 
>> mod_wsgi in
>> > daemon mode (we are serving WSGI apps via an adapter). The reason I 
>> ask is that
>> > we need the graceful restarts and cannot really do without it for now.
>>
>> Maybe not. When I look at it, mod_wsgi is also leaking on 'graceful'
>> and 'restart' as well. If these leaks are from Python itself not
>> cleaning things up properly, not sure what I am going to do. Unlike
>> mod_python I actually Py_Finalize() the interpreter in the main
>> process so that everything is properly reset back to a clean slate, so
>> I may actually be more susceptible to it than mod_python.
>>
>> I'll investigate the mod_wsgi problem and maybe that will throw some
>> light on why mod_python also has problems.
> 
> Its okay to try mod_wsgi now if you want to see whether you get memory
> leaks there as well. Just make sure you update from repository if you
> already had it checked out. Obviously, don't load mod_python at the
> same time.
> 
> The change I made in mod_wsgi was to comment out trigger for recycling
> Python interpreter in main Apache process. This was only being done
> for Apache 2.X and not Apache 1.3, so I know not doing it doesn't
> cause a problem. I do still see very minor leaks, but the same ones I
> get without mod_wsgi.
> 
> I'll try now and see what happens with mod_wsgi when I add the auth
> modules you are talking about. If that is okay with mod_wsgi, can try
> with mod_python and see if I can work out what the differences are.
> 
> Graham
-------------- next part --------------
A non-text attachment was scrubbed...
Name: logs+script.tgz
Type: application/x-compressed-tar
Size: 10213 bytes
Desc: not available
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070629/310a9da0/logsscript-0001.bin
-------------- next part --------------
#
# This is the main Apache HTTP server configuration file.  It contains the
# configuration directives that give the server its instructions.
# See <URL:http://httpd.apache.org/docs/2.2> for detailed information.
# In particular, see 
# <URL:http://httpd.apache.org/docs/2.2/mod/directives.html>
# for a discussion of each configuration directive.
#
# Do NOT simply read the instructions in here without understanding
# what they do.  They're here only as hints or reminders.  If you are unsure
# consult the online docs. You have been warned.  
#
# Configuration and logfile names: If the filenames you specify for many
# of the server's control files begin with "/" (or "drive:/" for Win32), the
# server will use that explicit path.  If the filenames do *not* begin
# with "/", the value of ServerRoot is prepended -- so "logs/foo.log"
# with ServerRoot set to "/opt/share/apache2" will be interpreted by the
# server as "/opt/share/apache2/logs/foo.log".

#
# ServerRoot: The top of the directory tree under which the server's
# configuration, error, and log files are kept.
#
# Do not add a slash at the end of the directory path.  If you point
# ServerRoot at a non-local disk, be sure to point the LockFile directive
# at a local disk.  If you wish to share the same ServerRoot for multiple
# httpd daemons, you will need to change at least LockFile and PidFile.
#
ServerRoot "/opt/share/apache2"

#
# Listen: Allows you to bind Apache to specific IP addresses and/or
# ports, instead of the default. See also the <VirtualHost>
# directive.
#
# Change this to Listen on specific IP addresses as shown below to 
# prevent Apache from glomming onto all bound IP addresses.
#
#Listen 12.34.56.78:80
Listen 8080

#
# Dynamic Shared Object (DSO) Support
#
# To be able to use the functionality of a module which was built as a DSO you
# have to place corresponding `LoadModule' lines at this location so the
# directives contained in it are actually available _before_ they are used.
# Statically compiled modules (those listed by `httpd -l') do not need
# to be loaded here.
#
# Example:
# LoadModule foo_module modules/mod_foo.so
#
#LoadModule authn_file_module modules/mod_authn_file.so
#LoadModule authn_dbm_module modules/mod_authn_dbm.so
#LoadModule authn_anon_module modules/mod_authn_anon.so
#LoadModule authn_dbd_module modules/mod_authn_dbd.so
#LoadModule authn_default_module modules/mod_authn_default.so
#LoadModule authz_groupfile_module modules/mod_authz_groupfile.so
#LoadModule authz_user_module modules/mod_authz_user.so
#LoadModule authz_dbm_module modules/mod_authz_dbm.so
#LoadModule authz_owner_module modules/mod_authz_owner.so
#LoadModule authz_default_module modules/mod_authz_default.so
#LoadModule auth_basic_module modules/mod_auth_basic.so
#LoadModule authz_host_module modules/mod_authz_host.so
#LoadModule auth_digest_module modules/mod_auth_digest.so

LoadModule dbd_module modules/mod_dbd.so
LoadModule dumpio_module modules/mod_dumpio.so
LoadModule ext_filter_module modules/mod_ext_filter.so
LoadModule include_module modules/mod_include.so
LoadModule filter_module modules/mod_filter.so
LoadModule deflate_module modules/mod_deflate.so
LoadModule log_config_module modules/mod_log_config.so
LoadModule log_forensic_module modules/mod_log_forensic.so
LoadModule logio_module modules/mod_logio.so
LoadModule env_module modules/mod_env.so
LoadModule mime_magic_module modules/mod_mime_magic.so
LoadModule cern_meta_module modules/mod_cern_meta.so
LoadModule expires_module modules/mod_expires.so
LoadModule headers_module modules/mod_headers.so
LoadModule ident_module modules/mod_ident.so
LoadModule usertrack_module modules/mod_usertrack.so
LoadModule unique_id_module modules/mod_unique_id.so
LoadModule setenvif_module modules/mod_setenvif.so
LoadModule version_module modules/mod_version.so
LoadModule mime_module modules/mod_mime.so
LoadModule dav_module modules/mod_dav.so
LoadModule status_module modules/mod_status.so
LoadModule autoindex_module modules/mod_autoindex.so
LoadModule asis_module modules/mod_asis.so
LoadModule info_module modules/mod_info.so
LoadModule cgi_module modules/mod_cgi.so
LoadModule dav_fs_module modules/mod_dav_fs.so
LoadModule vhost_alias_module modules/mod_vhost_alias.so
LoadModule negotiation_module modules/mod_negotiation.so
LoadModule dir_module modules/mod_dir.so
LoadModule imagemap_module modules/mod_imagemap.so
LoadModule actions_module modules/mod_actions.so
LoadModule speling_module modules/mod_speling.so
LoadModule userdir_module modules/mod_userdir.so
LoadModule alias_module modules/mod_alias.so
LoadModule rewrite_module modules/mod_rewrite.so

#LoadModule python_module      modules/mod_python.so
#LoadModule wsgi_module        modules/mod_wsgi.so

<IfModule !mpm_netware_module>
#
# If you wish httpd to run as a different user or group, you must run
# httpd as root initially and it will switch.  
#
# User/Group: The name (or #number) of the user/group to run httpd as.
# It is usually good practice to create a dedicated user and group for
# running httpd, as with most system services.
#
User daemon
Group daemon
</IfModule>

# 'Main' server configuration
#
# The directives in this section set up the values used by the 'main'
# server, which responds to any requests that aren't handled by a
# <VirtualHost> definition.  These values also provide defaults for
# any <VirtualHost> containers you may define later in the file.
#
# All of these directives may appear inside <VirtualHost> containers,
# in which case these default settings will be overridden for the
# virtual host being defined.
#

#
# ServerAdmin: Your address, where problems with the server should be
# e-mailed.  This address appears on some server-generated pages, such
# as error documents.  e.g. admin@your-domain.com
#
ServerAdmin you@example.com

#
# ServerName gives the name and port that the server uses to identify itself.
# This can often be determined automatically, but we recommend you specify
# it explicitly to prevent problems during startup.
#
# If your host doesn't have a registered DNS name, enter its IP address here.
#
#ServerName www.example.com:80

#
# DocumentRoot: The directory out of which you will serve your
# documents. By default, all requests are taken from this directory, but
# symbolic links and aliases may be used to point to other locations.
#
DocumentRoot "/opt/share/apache2/htdocs"

#
# Each directory to which Apache has access can be configured with respect
# to which services and features are allowed and/or disabled in that
# directory (and its subdirectories). 
#
# First, we configure the "default" to be a very restrictive set of 
# features.  
#
<Directory />
    Options FollowSymLinks
    AllowOverride None
    #Order deny,allow
    #Deny from all
</Directory>

#
# Note that from this point forward you must specifically allow
# particular features to be enabled - so if something's not working as
# you might expect, make sure that you have specifically enabled it
# below.
#

#
# This should be changed to whatever you set DocumentRoot to.
#
<Directory "/opt/share/apache2/htdocs">
    #
    # Possible values for the Options directive are "None", "All",
    # or any combination of:
    #   Indexes Includes FollowSymLinks SymLinksifOwnerMatch ExecCGI MultiViews
    #
    # Note that "MultiViews" must be named *explicitly* --- "Options All"
    # doesn't give it to you.
    #
    # The Options directive is both complicated and important.  Please see
    # http://httpd.apache.org/docs/2.2/mod/core.html#options
    # for more information.
    #
    Options Indexes FollowSymLinks

    #
    # AllowOverride controls what directives may be placed in .htaccess files.
    # It can be "All", "None", or any combination of the keywords:
    #   Options FileInfo AuthConfig Limit
    #
    AllowOverride None

    #
    # Controls who can get stuff from this server.
    #
    #Order allow,deny
    #Allow from all

</Directory>

#
# DirectoryIndex: sets the file that Apache will serve if a directory
# is requested.
#
<IfModule dir_module>
    DirectoryIndex index.html
</IfModule>

#
# The following lines prevent .htaccess and .htpasswd files from being 
# viewed by Web clients. 
#
<FilesMatch "^\.ht">
    #Order allow,deny
    #Deny from all
    Satisfy All
</FilesMatch>

#
# ErrorLog: The location of the error log file.
# If you do not specify an ErrorLog directive within a <VirtualHost>
# container, error messages relating to that virtual host will be
# logged here.  If you *do* define an error logfile for a <VirtualHost>
# container, that host's errors will be logged there and not here.
#
ErrorLog logs/error_log

#
# LogLevel: Control the number of messages logged to the error_log.
# Possible values include: debug, info, notice, warn, error, crit,
# alert, emerg.
#
LogLevel warn

<IfModule log_config_module>
    #
    # The following directives define some format nicknames for use with
    # a CustomLog directive (see below).
    #
    LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" combined
    LogFormat "%h %l %u %t \"%r\" %>s %b" common

    <IfModule logio_module>
      # You need to enable mod_logio.c to use %I and %O
      LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\" %I %O" combinedio
    </IfModule>

    #
    # The location and format of the access logfile (Common Logfile Format).
    # If you do not define any access logfiles within a <VirtualHost>
    # container, they will be logged here.  Contrariwise, if you *do*
    # define per-<VirtualHost> access logfiles, transactions will be
    # logged therein and *not* in this file.
    #
    CustomLog logs/access_log common

    #
    # If you prefer a logfile with access, agent, and referer information
    # (Combined Logfile Format) you can use the following directive.
    #
    #CustomLog logs/access_log combined
</IfModule>

<IfModule alias_module>
    #
    # Redirect: Allows you to tell clients about documents that used to 
    # exist in your server's namespace, but do not anymore. The client 
    # will make a new request for the document at its new location.
    # Example:
    # Redirect permanent /foo http://www.example.com/bar

    #
    # Alias: Maps web paths into filesystem paths and is used to
    # access content that does not live under the DocumentRoot.
    # Example:
    # Alias /webpath /full/filesystem/path
    #
    # If you include a trailing / on /webpath then the server will
    # require it to be present in the URL.  You will also likely
    # need to provide a <Directory> section to allow access to
    # the filesystem path.

    #
    # ScriptAlias: This controls which directories contain server scripts. 
    # ScriptAliases are essentially the same as Aliases, except that
    # documents in the target directory are treated as applications and
    # run by the server when requested rather than as documents sent to the
    # client.  The same rules about trailing "/" apply to ScriptAlias
    # directives as to Alias.
    #
    ScriptAlias /cgi-bin/ "/opt/share/apache2/cgi-bin/"

</IfModule>

<IfModule cgid_module>
    #
    # ScriptSock: On threaded servers, designate the path to the UNIX
    # socket used to communicate with the CGI daemon of mod_cgid.
    #
    #Scriptsock logs/cgisock
</IfModule>

#
# "/opt/share/apache2/cgi-bin" should be changed to whatever your ScriptAliased
# CGI directory exists, if you have that configured.
#
<Directory "/opt/share/apache2/cgi-bin">
    AllowOverride None
    Options None
    #Order allow,deny
    #Allow from all
</Directory>

#
# DefaultType: the default MIME type the server will use for a document
# if it cannot otherwise determine one, such as from filename extensions.
# If your server contains mostly text or HTML documents, "text/plain" is
# a good value.  If most of your content is binary, such as applications
# or images, you may want to use "application/octet-stream" instead to
# keep browsers from trying to display binary files as though they are
# text.
#
DefaultType text/plain

<IfModule mime_module>
    #
    # TypesConfig points to the file containing the list of mappings from
    # filename extension to MIME-type.
    #
    TypesConfig conf/mime.types

    #
    # AddType allows you to add to or override the MIME configuration
    # file specified in TypesConfig for specific file types.
    #
    #AddType application/x-gzip .tgz
    #
    # AddEncoding allows you to have certain browsers uncompress
    # information on the fly. Note: Not all browsers support this.
    #
    #AddEncoding x-compress .Z
    #AddEncoding x-gzip .gz .tgz
    #
    # If the AddEncoding directives above are commented-out, then you
    # probably should define those extensions to indicate media types:
    #
    AddType application/x-compress .Z
    AddType application/x-gzip .gz .tgz

    #
    # AddHandler allows you to map certain file extensions to "handlers":
    # actions unrelated to filetype. These can be either built into the server
    # or added with the Action directive (see below)
    #
    # To use CGI scripts outside of ScriptAliased directories:
    # (You will also need to add "ExecCGI" to the "Options" directive.)
    #
    #AddHandler cgi-script .cgi

    # For type maps (negotiated resources):
    #AddHandler type-map var

    #
    # Filters allow you to process content before it is sent to the client.
    #
    # To parse .shtml files for server-side includes (SSI):
    # (You will also need to add "Includes" to the "Options" directive.)
    #
    #AddType text/html .shtml
    #AddOutputFilter INCLUDES .shtml
</IfModule>

#
# The mod_mime_magic module allows the server to use various hints from the
# contents of the file itself to determine its type.  The MIMEMagicFile
# directive tells the module where the hint definitions are located.
#
#MIMEMagicFile conf/magic

#
# Customizable error responses come in three flavors:
# 1) plain text 2) local redirects 3) external redirects
#
# Some examples:
#ErrorDocument 500 "The server made a boo boo."
#ErrorDocument 404 /missing.html
#ErrorDocument 404 "/cgi-bin/missing_handler.pl"
#ErrorDocument 402 http://www.example.com/subscription_info.html
#

#
# EnableMMAP and EnableSendfile: On systems that support it, 
# memory-mapping or the sendfile syscall is used to deliver
# files.  This usually improves server performance, but must
# be turned off when serving from networked-mounted 
# filesystems or if support for these functions is otherwise
# broken on your system.
#
#EnableMMAP off
#EnableSendfile off

# Supplemental configuration
#
# The configuration files in the conf/extra/ directory can be 
# included to add extra features or to modify the default configuration of 
# the server, or you may simply copy their contents here and change as 
# necessary.

# Server-pool management (MPM specific)
#Include conf/extra/httpd-mpm.conf

# Multi-language error messages
#Include conf/extra/httpd-multilang-errordoc.conf

# Fancy directory listings
#Include conf/extra/httpd-autoindex.conf

# Language settings
#Include conf/extra/httpd-languages.conf

# User home directories
#Include conf/extra/httpd-userdir.conf

# Real-time info on requests and configuration
#Include conf/extra/httpd-info.conf

# Virtual hosts
#Include conf/extra/httpd-vhosts.conf

# Local access to the Apache HTTP Server Manual
#Include conf/extra/httpd-manual.conf

# Distributed authoring and versioning (WebDAV)
#Include conf/extra/httpd-dav.conf

# Various default settings
#Include conf/extra/httpd-default.conf

# Secure (SSL/TLS) connections
#Include conf/extra/httpd-ssl.conf
#
# Note: The following must must be present to support
#       starting without SSL on platforms with no /dev/random equivalent
#       but a statically compiled-in mod_ssl.
#
<IfModule ssl_module>
SSLRandomSeed startup builtin
SSLRandomSeed connect builtin
</IfModule>
From mdennis at merfer.net  Fri Jun 29 16:41:26 2007
From: mdennis at merfer.net (Matthew Dennis)
Date: Fri Jun 29 16:41:35 2007
Subject: [mod_python] streaming tar and/or zip files?
Message-ID: <e94d85500706291341g177ca66j694567652f252de9@mail.gmail.com>

This may not be the appropriate list, my apologies if that is indeed the
case...

I need to push from mod_python a file archive of sorts.  Any of tar,
tar.gzor zip will work (I'm also open to other suggestions).  The
requirement is
that I can package several other "files" into it, compressed or not.  I have
no disk to write to and finite memory to deal with but the "files" I'm
outputting are quite large (much larger than can fit in memory), thus I need
to stream them directly out.  The reason I put "files" in quotes is because
they are not really files, but dynamic content that is generated on the
fly.  ZipOutputStream from Java is a example of what I'm talking about if
anyone is familiar with it, as are other such streams.  I don't know the
size of the content until after it is all generated so there is no way to
populate a TarInfo object with the size et cetera and make my dynamic
content look like a file (which it doesn't seem I can do anyway as
gettarinfo() tries to call .fileno() which doesn't exist on any file like
object I would create).

In other words, something like:

output = TarFileStream(someFileObj)

output.addEntry("file_1.txt")
out.write( /*some dynamically generated content */ )
out.write( /*some dynamically generated content */ )
out.write( /*some dynamically generated content */ )

output.addEntry("file_2.txt")
out.write( /*some dynamically generated content */ )
out.write( /*some dynamically generated content */ )
out.write( /*some dynamically generated content */ )

...

output.addEntry("file_N.txt")
out.write( /*some dynamically generated content */ )
out.write( /*some dynamically generated content */ )
out.write( /*some dynamically generated content */ )

output.close()
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070629/b7a4ea17/attachment.html
From graham.dumpleton at gmail.com  Fri Jun 29 22:11:10 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Fri Jun 29 22:11:18 2007
Subject: [mod_python] streaming tar and/or zip files?
In-Reply-To: <e94d85500706291341g177ca66j694567652f252de9@mail.gmail.com>
References: <e94d85500706291341g177ca66j694567652f252de9@mail.gmail.com>
Message-ID: <88e286470706291911p597eaa24p445e244dc6e62a06@mail.gmail.com>

Go to www.modpython.org and type 'zip' into the search box. This will
yield some past discussion on this. I can't remember offhand what the
outcome of the discssion was last time and whether a satisfactory
solution was found or not.

Graham

On 30/06/07, Matthew Dennis <mdennis@merfer.net> wrote:
> This may not be the appropriate list, my apologies if that is indeed the
> case...
>
> I need to push from mod_python a file archive of sorts.  Any of tar, tar.gz
> or zip will work (I'm also open to other suggestions).  The requirement is
> that I can package several other "files" into it, compressed or not.  I have
> no disk to write to and finite memory to deal with but the "files" I'm
> outputting are quite large (much larger than can fit in memory), thus I need
> to stream them directly out.  The reason I put "files" in quotes is because
> they are not really files, but dynamic content that is generated on the fly.
>  ZipOutputStream from Java is a example of what I'm talking about if anyone
> is familiar with it, as are other such streams.  I don't know the size of
> the content until after it is all generated so there is no way to populate a
> TarInfo object with the size et cetera and make my dynamic content look like
> a file (which it doesn't seem I can do anyway as gettarinfo() tries to call
> .fileno() which doesn't exist on any file like object I would create).
>
> In other words, something like:
>
> output = TarFileStream(someFileObj)
>
> output.addEntry("file_1.txt")
> out.write( /*some dynamically generated content */ )
>  out.write( /*some dynamically generated content */ )
>  out.write( /*some dynamically generated content */ )
>
> output.addEntry("file_2.txt")
>  out.write( /*some dynamically generated content */ )
>  out.write( /*some dynamically generated content */ )
>  out.write( /*some dynamically generated content */ )
>
> ...
>
> output.addEntry("file_N.txt")
> out.write( /*some dynamically generated content */ )
>  out.write( /*some dynamically generated content */ )
>  out.write( /*some dynamically generated content */ )
>
> output.close()
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
From anthony_raj at persistent.co.in  Sat Jun 30 12:12:48 2007
From: anthony_raj at persistent.co.in (Anthony Raj)
Date: Sat Jun 30 12:12:59 2007
Subject: [mod_python] mod_python on FreeBSD 6.1 gives Syntax error
 - mod_python.so: unsupported file layout 
Message-ID: <20070630214248.BJQ07976@mail6.persistent.co.in>

Hi Folks,

Have come to the community with a new issue with regard to installing mod_python on FreeBSD.

Eariler had installed apache/mod_python on
Suse 10 / 64 Arch.
- Apache 2.2.4
- mod_python 3.3.1
- apr 1.2.8
- apr-util 1.2.8

problems -
The issue with mod_python being installed in to locations.
Managed to get it working on this setup sucessfully.
---

Now I've installed the same configuration on
Free BSD 6.1 32 Arch.
>>>>
FreeBSD perputo3.inetu.net 6.1-RELEASE-p3 FreeBSD 6.1-RELEASE-p3 #107: Mon Nov  6 20:31:10 EST 2006     root@turnip.inetu.org:/usr/obj/usr/src/sys/INU6  i386
>>>>

Installation was completed successfully for all the above modules.

But after adding the required configuration line -
>>>
LoadModule python_module modules/mod_python.so
>>>

And restarting apache , it throws the following error
>>>>
/usr/local/apache-ast>./bin/apachectl start
httpd: Syntax error on line 54 of /usr/local/apache-ast/conf/httpd.conf: Cannot load /usr/local/apache-ast/modules/mod_python.so into server: /usr/local/apache-ast/modules/mod_python.so: unsupported file layout

>>>>

The required mod_python.so appears to be installed in
/usr/local/apache-ast/modules directory.

>>>>
/usr/local/apache-ast>ls -l modules/
total 1738
-rw-r--r--  1 root  wheel     8951 Jun 29 10:19 httpd.exp
-rwxr-xr-x  1 root  wheel  1739997 Jun 29 10:50 mod_python.so

>>>>

Have also added the following lines in the config file -
>>>>
<Directory "/usr/local/apache-ast/htdocs">
      AddHandler mod_python .py
      PythonHandler mod_python.publisher
      PythonDebug On
</Directory>

>>>>

Any one knows if there is any bug with mod_python installation on FreeBSD 6.1. Please let me know in case you there is anything that is missing in the install steps.

Or is there any port of mod_python for Free BSD that needs to be used here.

Please let me know your advice on the same.

cheers,
Anthony 

DISCLAIMER
==========
This e-mail may contain privileged and confidential information which is the property of Persistent Systems Pvt. Ltd. It is intended only for the use of the individual or entity to which it is addressed. If you are not the intended recipient, you are not authorized to read, retain, copy, print, distribute or use this message. If you have received this communication in error, please notify the sender and delete all copies of this message. Persistent Systems Pvt. Ltd. does not accept any liability for virus infected mails.
From graham.dumpleton at gmail.com  Sat Jun 30 21:33:52 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sat Jun 30 21:34:07 2007
Subject: [mod_python] mod_python on FreeBSD 6.1 gives Syntax error -
	mod_python.so: unsupported file layout
In-Reply-To: <20070630214248.BJQ07976@mail6.persistent.co.in>
References: <20070630214248.BJQ07976@mail6.persistent.co.in>
Message-ID: <88e286470706301833wbef8c28w95735075c8b06d7f@mail.gmail.com>

Usually these problems are caused through using the mod_python.so with
a version of Apache which is different to the version of Apache that
mod_python was compiled against. This can especially occur where you
have a standard OS installation of Apache but you try and use an
alternate version under /usr/local/ or elsewhere.

What options did you use with 'configure' when you ran it? Did the
compile line correctly pick up includes and libraries from the version
under /usr/local?

Graham

On 01/07/07, Anthony Raj <anthony_raj@persistent.co.in> wrote:
> Hi Folks,
>
> Have come to the community with a new issue with regard to installing mod_python on FreeBSD.
>
> Eariler had installed apache/mod_python on
> Suse 10 / 64 Arch.
> - Apache 2.2.4
> - mod_python 3.3.1
> - apr 1.2.8
> - apr-util 1.2.8
>
> problems -
> The issue with mod_python being installed in to locations.
> Managed to get it working on this setup sucessfully.
> ---
>
> Now I've installed the same configuration on
> Free BSD 6.1 32 Arch.
> >>>>
> FreeBSD perputo3.inetu.net 6.1-RELEASE-p3 FreeBSD 6.1-RELEASE-p3 #107: Mon Nov  6 20:31:10 EST 2006     root@turnip.inetu.org:/usr/obj/usr/src/sys/INU6  i386
> >>>>
>
> Installation was completed successfully for all the above modules.
>
> But after adding the required configuration line -
> >>>
> LoadModule python_module modules/mod_python.so
> >>>
>
> And restarting apache , it throws the following error
> >>>>
> /usr/local/apache-ast>./bin/apachectl start
> httpd: Syntax error on line 54 of /usr/local/apache-ast/conf/httpd.conf: Cannot load /usr/local/apache-ast/modules/mod_python.so into server: /usr/local/apache-ast/modules/mod_python.so: unsupported file layout
>
> >>>>
>
> The required mod_python.so appears to be installed in
> /usr/local/apache-ast/modules directory.
>
> >>>>
> /usr/local/apache-ast>ls -l modules/
> total 1738
> -rw-r--r--  1 root  wheel     8951 Jun 29 10:19 httpd.exp
> -rwxr-xr-x  1 root  wheel  1739997 Jun 29 10:50 mod_python.so
>
> >>>>
>
> Have also added the following lines in the config file -
> >>>>
> <Directory "/usr/local/apache-ast/htdocs">
>       AddHandler mod_python .py
>       PythonHandler mod_python.publisher
>       PythonDebug On
> </Directory>
>
> >>>>
>
> Any one knows if there is any bug with mod_python installation on FreeBSD 6.1. Please let me know in case you there is anything that is missing in the install steps.
>
> Or is there any port of mod_python for Free BSD that needs to be used here.
>
> Please let me know your advice on the same.
>
> cheers,
> Anthony
>
> DISCLAIMER
> ==========
> This e-mail may contain privileged and confidential information which is the property of Persistent Systems Pvt. Ltd. It is intended only for the use of the individual or entity to which it is addressed. If you are not the intended recipient, you are not authorized to read, retain, copy, print, distribute or use this message. If you have received this communication in error, please notify the sender and delete all copies of this message. Persistent Systems Pvt. Ltd. does not accept any liability for virus infected mails.
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
