<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] refreshing status-page / long-running process
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20refreshing%20status-page%20/%20long-running%20process&In-Reply-To=1860192612%40web.de">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026259.html">
   <LINK REL="Next"  HREF="026261.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] refreshing status-page / long-running process</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20refreshing%20status-page%20/%20long-running%20process&In-Reply-To=1860192612%40web.de"
       TITLE="[mod_python] refreshing status-page / long-running process">graham.dumpleton at gmail.com
       </A><BR>
    <I>Thu Jul 16 07:13:45 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="026259.html">[mod_python] refreshing status-page / long-running process
</A></li>
        <LI>Next message: <A HREF="026261.html">[mod_python] Question about write method of mp_request objects
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26260">[ date ]</a>
              <a href="thread.html#26260">[ thread ]</a>
              <a href="subject.html#26260">[ subject ]</a>
              <a href="author.html#26260">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>2009/7/16  &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">shashy at web.de</A>&gt;:
&gt;<i> Hi all,
</I>&gt;<i> I'm on my way of setting up a web server using mod_python. The user fills out a form, the data is passed to a Python script, the result is presented to the user, done -- sounds pretty simple.
</I>&gt;<i> In the first version, I used &lt;form action=&quot;run.py&quot; ...&gt;. In the run.py script I get the parameters
</I>&gt;<i> def index(req):
</I>&gt;<i> &#160;params = req.form
</I>&gt;<i>
</I>&gt;<i> and write something like
</I>&gt;<i> req.content_type = &quot;text/html&quot;
</I>&gt;<i> &#160;req.write('''&lt;html&gt;
</I>&gt;<i> &#160;&lt;head&gt;&lt;title&gt;Your request is being processed.&lt;/title&gt;
</I>&gt;<i> &#160;...'''
</I>&gt;<i>
</I>&gt;<i> After some preprocessing the data is finally passed to the actual pipeline:
</I>&gt;<i> &#160; &#160;pipe = apache.import_module(pipeline.py&quot;)
</I>&gt;<i> &#160; &#160;pipe.runme(some,params,here, req)
</I>&gt;<i>
</I>&gt;<i> This script sends status messages to req in between all the calculations it has to do. In the end the user gets a link to his result directory and the run.py script finishes with return.
</I>&gt;<i>
</I>&gt;<i> That worked fine for the start, but it seems a bit awkward that the page is loading during the whole time the process needs to finish (~10 min). Mac's Safari by default has a time-out after 1 min, then it stops loading, so I had to come up with something different.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> The next idea was to use a system call appending an ampersand -&gt; not to wait for the process to finish:
</I>&gt;<i> &#160;os.system(&quot;python pipeline.py %s/ &amp;&quot; % jobdir)
</I>&gt;<i> With the downside, that I have to turn all the Python list and dict objects into text or use the pickle module to pack them and load them again in the script. Also I cannot send status messages from the long-running process.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> After that I tried to use os.fork() but ended up with a lot of processes that where not finished properly and high CPU usage.
</I>&gt;<i>
</I>&gt;<i> I read something about double-fork/detaching/daemonizing, but did not entirely get it and think there must be a simpler way to do it.
</I>&gt;<i>
</I>&gt;<i> It's quite common to have a page refreshing every 10 seconds, checking for new results or status messages, while the time-consuming job is running. But I could not find a simple tutorial how to do that with mod_python. Can someone help me out? I'd be very happy. Sorry, if I wrote too much...
</I>&gt;<i>
</I>&gt;<i> I read some similar (but not quite) questions, but all suggestions on them seem to have their own problems. But it were mostly old threads and maybe something happened in the last years, so there is a safe and feasible way to do it.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> -- One last 'bonus' question, if the user decides (based on the intermediate results that are presented to him) that he does not want to wait for the analysis, he might leave the page or start over with a new analysis using different parameters. Is it possible to stop the running script then?
</I>
Push the work to a backend server using an XML-RPC interface. The
request should just queue the work and return immediately. A separate
thread within backend server would then process requests from the
queue. For status, you make subsequent XML-RPC requests to gauge
status. Subsequent requests could cancel an in progress job if you
provide a way of signalling a worker thread that it should stop.

Graham

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026259.html">[mod_python] refreshing status-page / long-running process
</A></li>
	<LI>Next message: <A HREF="026261.html">[mod_python] Question about write method of mp_request objects
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26260">[ date ]</a>
              <a href="thread.html#26260">[ thread ]</a>
              <a href="subject.html#26260">[ subject ]</a>
              <a href="author.html#26260">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
