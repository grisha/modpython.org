<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Include file without writing output
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Include%20file%20without%20writing%20output&In-Reply-To=4A4B62DC.6030204%40web.de">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026249.html">
   <LINK REL="Next"  HREF="026250.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Include file without writing output</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Include%20file%20without%20writing%20output&In-Reply-To=4A4B62DC.6030204%40web.de"
       TITLE="[mod_python] Include file without writing output">graham.dumpleton at gmail.com
       </A><BR>
    <I>Wed Jul  1 19:23:53 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="026249.html">[mod_python] Include file without writing output
</A></li>
        <LI>Next message: <A HREF="026250.html">[mod_python] Apache/mod_python with python-ldap implementation
	question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26251">[ date ]</a>
              <a href="thread.html#26251">[ thread ]</a>
              <a href="subject.html#26251">[ subject ]</a>
              <a href="author.html#26251">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Put the common stuff in a standard Python module as a variable and
import that module into PSP and then reference variable containing
common stuff from PSP code.

That or look at using traditional Apache server side include (SSI).

Avoid writing your output filter, it is much overkill.

Graham

2009/7/1 Andreas Sommer &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">AndiDog at web.de</A>&gt;:
&gt;<i> The only &quot;simple&quot; solution is the following output filter:
</I>&gt;<i>
</I>&gt;<i> def outputfilter(filter):
</I>&gt;<i> &#160; str = filter.read()
</I>&gt;<i> &#160; filter.write(str.lstrip())
</I>&gt;<i> &#160; filter.close()
</I>&gt;<i>
</I>&gt;<i> Can't that be done easier, i.e. without Apache configuration?
</I>&gt;<i>
</I>&gt;<i> Andreas Sommer wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I want to include a common &quot;header&quot; file in each of my PSP files (which
</I>&gt;&gt;<i> should produce XML), for example
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &lt;%@ include file=&quot;common.inc&quot; %&gt;&lt;%
</I>&gt;&gt;<i> req.content_type = &quot;text/xml&quot;
</I>&gt;&gt;<i> # output some XML code here
</I>&gt;&gt;<i> %&gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The &quot;common.inc&quot; file begins with &lt;% and ends with %&gt;, but because editors
</I>&gt;&gt;<i> automatically add a newline, it ends with a newline character.
</I>&gt;&gt;<i> My problem is that the XML output follows after the newline character, but
</I>&gt;&gt;<i> *must* be at the very beginning of the output - just try opening such a XML
</I>&gt;&gt;<i> file in Firefox and it will give you an error &quot;XML or text declaration not
</I>&gt;&gt;<i> at start of entity&quot;. Removing the newline character causes mod_python to
</I>&gt;&gt;<i> throw an error.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I tried to work around that problem by including the common file like
</I>&gt;&gt;<i> this:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> PSP(req, &quot;common.inc&quot;).run()
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ...but that gives me the following error:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> MOD_PYTHON ERROR
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ProcessId: &#160; &#160; &#160;2787
</I>&gt;&gt;<i> Interpreter: &#160; &#160;'127.0.1.1'
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ServerName: &#160; &#160; '127.0.1.1'
</I>&gt;&gt;<i> DocumentRoot: &#160; '/var/www/'
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> URI: &#160; &#160; &#160; &#160; &#160; &#160;'/login.psp'
</I>&gt;&gt;<i> Location: &#160; &#160; &#160; None
</I>&gt;&gt;<i> Directory: &#160; &#160; &#160;'/var/www/'
</I>&gt;&gt;<i> Filename: &#160; &#160; &#160; '/var/www/login.psp'
</I>&gt;&gt;<i> PathInfo: &#160; &#160; &#160; ''
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Phase: &#160; &#160; &#160; &#160; &#160;'PythonHandler'
</I>&gt;&gt;<i> Handler: &#160; &#160; &#160; &#160;'mod_python.psp'
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Traceback (most recent call last):
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &#160;File &quot;/usr/lib/python2.5/site-packages/mod_python/importer.py&quot;, line
</I>&gt;&gt;<i> 1537, in HandlerDispatch
</I>&gt;&gt;<i> &#160; default=default_handler, arg=req, silent=hlist.silent)
</I>&gt;&gt;<i> &#160;File &quot;/usr/lib/python2.5/site-packages/mod_python/importer.py&quot;, line
</I>&gt;&gt;<i> 1229, in _process_target
</I>&gt;&gt;<i> &#160; result = _execute_target(config, req, object, arg)
</I>&gt;&gt;<i> &#160;File &quot;/usr/lib/python2.5/site-packages/mod_python/importer.py&quot;, line
</I>&gt;&gt;<i> 1128, in _execute_target
</I>&gt;&gt;<i> &#160; result = object(arg)
</I>&gt;&gt;<i> &#160;File &quot;/usr/lib/python2.5/site-packages/mod_python/psp.py&quot;, line 337, in
</I>&gt;&gt;<i> handler
</I>&gt;&gt;<i> &#160; p.run()
</I>&gt;&gt;<i> &#160;File &quot;/usr/lib/python2.5/site-packages/mod_python/psp.py&quot;, line 243, in
</I>&gt;&gt;<i> run
</I>&gt;&gt;<i> &#160; exec code in global_scope
</I>&gt;&gt;<i> &#160;File &quot;/var/www/login.psp&quot;, line 2, in &lt;module&gt;
</I>&gt;&gt;<i> &#160; PSP(req, filename = &quot;common.inc&quot;)
</I>&gt;&gt;<i> &#160;File &quot;/usr/lib/python2.5/site-packages/mod_python/psp.py&quot;, line 119, in
</I>&gt;&gt;<i> __init__
</I>&gt;&gt;<i> &#160; self.load_from_file()
</I>&gt;&gt;<i> &#160;File &quot;/usr/lib/python2.5/site-packages/mod_python/psp.py&quot;, line 185, in
</I>&gt;&gt;<i> load_from_file
</I>&gt;&gt;<i> &#160; code = self.cfile_get(filename, mtime)
</I>&gt;&gt;<i> &#160;File &quot;/usr/lib/python2.5/site-packages/mod_python/psp.py&quot;, line 169, in
</I>&gt;&gt;<i> cfile_get
</I>&gt;&gt;<i> &#160; return str2code(open(cname).read())
</I>&gt;&gt;<i> &#160;File &quot;/usr/lib/python2.5/site-packages/mod_python/psp.py&quot;, line 57, in
</I>&gt;&gt;<i> str2code
</I>&gt;&gt;<i> &#160; return new.code(*marshal.loads(s))
</I>&gt;&gt;<i> MemoryError
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Using the absolute path /var/www/common.inc doesn't work either. Any
</I>&gt;&gt;<i> suggestions how to work around this problem??
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> Mod_python mailing list
</I>&gt;&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i>
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026249.html">[mod_python] Include file without writing output
</A></li>
	<LI>Next message: <A HREF="026250.html">[mod_python] Apache/mod_python with python-ldap implementation
	question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26251">[ date ]</a>
              <a href="thread.html#26251">[ thread ]</a>
              <a href="subject.html#26251">[ subject ]</a>
              <a href="author.html#26251">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
