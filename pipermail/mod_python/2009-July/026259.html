<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] refreshing status-page / long-running process
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20refreshing%20status-page%20/%20long-running%20process&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026258.html">
   <LINK REL="Next"  HREF="026260.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] refreshing status-page / long-running process</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>shashy at web.de</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20refreshing%20status-page%20/%20long-running%20process&In-Reply-To="
       TITLE="[mod_python] refreshing status-page / long-running process">shashy at web.de
       </A><BR>
    <I>Thu Jul 16 07:02:48 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="026258.html">[mod_python] python apache help
</A></li>
        <LI>Next message: <A HREF="026260.html">[mod_python] refreshing status-page / long-running process
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26259">[ date ]</a>
              <a href="thread.html#26259">[ thread ]</a>
              <a href="subject.html#26259">[ subject ]</a>
              <a href="author.html#26259">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi all,
I'm on my way of setting up a web server using mod_python. The user fills out a form, the data is passed to a Python script, the result is presented to the user, done -- sounds pretty simple.
In the first version, I used &lt;form action=&quot;run.py&quot; ...&gt;. In the run.py script I get the parameters 
def index(req):
  params = req.form

and write something like
req.content_type = &quot;text/html&quot;
  req.write('''&lt;html&gt;
  &lt;head&gt;&lt;title&gt;Your request is being processed.&lt;/title&gt;
  ...'''

After some preprocessing the data is finally passed to the actual pipeline:
    pipe = apache.import_module(pipeline.py&quot;)
    pipe.runme(some,params,here, req)

This script sends status messages to req in between all the calculations it has to do. In the end the user gets a link to his result directory and the run.py script finishes with return.

That worked fine for the start, but it seems a bit awkward that the page is loading during the whole time the process needs to finish (~10 min). Mac's Safari by default has a time-out after 1 min, then it stops loading, so I had to come up with something different.


The next idea was to use a system call appending an ampersand -&gt; not to wait for the process to finish:
  os.system(&quot;python pipeline.py %s/ &amp;&quot; % jobdir)
With the downside, that I have to turn all the Python list and dict objects into text or use the pickle module to pack them and load them again in the script. Also I cannot send status messages from the long-running process.


After that I tried to use os.fork() but ended up with a lot of processes that where not finished properly and high CPU usage. 

I read something about double-fork/detaching/daemonizing, but did not entirely get it and think there must be a simpler way to do it.

It's quite common to have a page refreshing every 10 seconds, checking for new results or status messages, while the time-consuming job is running. But I could not find a simple tutorial how to do that with mod_python. Can someone help me out? I'd be very happy. Sorry, if I wrote too much...

I read some similar (but not quite) questions, but all suggestions on them seem to have their own problems. But it were mostly old threads and maybe something happened in the last years, so there is a safe and feasible way to do it.


-- One last 'bonus' question, if the user decides (based on the intermediate results that are presented to him) that he does not want to wait for the analysis, he might leave the page or start over with a new analysis using different parameters. Is it possible to stop the running script then? 


Thanks for sharing your time and wisdom.

Best regards,

Anne
________________________________________________________________
Neu: WEB.DE Doppel-FLAT mit Internet-Flatrate + Telefon-Flatrate
f&#252;r nur 19,99 Euro/mtl.!* <A HREF="http://produkte.web.de/go/02/">http://produkte.web.de/go/02/</A>


</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026258.html">[mod_python] python apache help
</A></li>
	<LI>Next message: <A HREF="026260.html">[mod_python] refreshing status-page / long-running process
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26259">[ date ]</a>
              <a href="thread.html#26259">[ thread ]</a>
              <a href="subject.html#26259">[ subject ]</a>
              <a href="author.html#26259">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
