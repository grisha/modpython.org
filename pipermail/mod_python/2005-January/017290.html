<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] pythonpath
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20pythonpath&In-Reply-To=200501311557.40282.lroubeyrie%40limair.asso.fr">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017287.html">
   <LINK REL="Next"  HREF="017292.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] pythonpath</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Jorey Bump</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20pythonpath&In-Reply-To=200501311557.40282.lroubeyrie%40limair.asso.fr"
       TITLE="[mod_python] pythonpath">list at joreybump.com
       </A><BR>
    <I>Mon Jan 31 10:42:21 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="017287.html">[mod_python] pythonpath
</A></li>
        <LI>Next message: <A HREF="017292.html">[mod_python] pythonpath
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17290">[ date ]</a>
              <a href="thread.html#17290">[ thread ]</a>
              <a href="subject.html#17290">[ subject ]</a>
              <a href="author.html#17290">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Lionel Roubeyrie wrote:
&gt;<i> Hi,
</I>&gt;<i> Le Lundi 31 Janvier 2005 15:12, Jorey Bump a &#233;crit :
</I>&gt;<i> 
</I>&gt;&gt;<i>You didn't provide enough details. Show us:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>1. How you've configured mod_python (in httpd.conf or .htaccess)
</I>&gt;<i> 
</I>&gt;<i> in httpd.conf of Apache2:
</I>&gt;<i> Alias /cartairweb /topdir/webdir
</I>&gt;<i> Directory /topdir/webdir&gt;
</I>&gt;<i>         Order allow,deny
</I>&gt;<i>         Allow from all
</I>&gt;<i>         Options Indexes Includes FollowSymLinks MultiViews
</I>&gt;<i>         AddHandler mod_python .py
</I>&gt;<i>         PythonHandler mod_python.publisher
</I>&gt;<i> #       PythonPath &quot;sys.path+['/topdir']&quot;
</I>&gt;<i>         PythonDebug On
</I>&gt;<i> &lt;/Directory&gt;
</I>&gt;<i> 
</I>&gt;&gt;<i>2. How and where you've set the PYTHONPATH
</I>&gt;<i> 
</I>&gt;<i> Like in the previous lines, or using a more Goliath' like method calling 
</I>&gt;<i> setEnviron() :
</I>&gt;<i> ####################################
</I>&gt;<i> def getParentDir():
</I>&gt;<i>     currentfile = os.path.abspath(__file__)
</I>&gt;<i>     currentdir = os.path.split(currentfile)[0]
</I>&gt;<i>     parentdir = os.path.split(currentdir)[0]
</I>&gt;<i>     return parentdir
</I>&gt;<i> def setEnviron():
</I>&gt;<i>     parentdir = getParentDir()
</I>&gt;<i>     if parentdir not in sys.path : sys.path.append(parentdir)
</I>&gt;<i>     os.environ['PYTHONPATH']=parentdir
</I>&gt;<i> ####################################
</I>&gt;<i> In all case, I have to change the current working directory to where the web 
</I>&gt;<i> pages are.
</I>&gt;<i> 
</I>&gt;&gt;<i>3. The relevant parts of your importing module
</I>&gt;<i> 
</I>&gt;<i> In fact, the error comes when I import the desired module (cartair) located in 
</I>&gt;<i> the topdirectory:
</I>&gt;<i> ####################################
</I>&gt;<i> import os, utils
</I>&gt;<i> import cartair
</I>&gt;<i> utils.setCurrentWkDir()
</I>&gt;<i> utils.setEnviron()
</I>&gt;<i>     
</I>&gt;<i> def index(req, executer='0', section='PREVAIR', date_calcul='', date_prevu='', 
</I>&gt;<i> code_modele='', polluant='', niveau='', squelette=''):
</I>&gt;<i>     result = ''
</I>&gt;<i>     conf= cartair.CartairConf()
</I>&gt;<i>     date = cartair.Cdate()
</I>&gt;<i>     try:
</I>&gt;<i>         if (code_modele == '') or (code_modele == None): 
</I>&gt;<i> code_modele=conf.get(section, 'code_modele')
</I>&gt;<i> ...
</I>&gt;<i> ####################################
</I>&gt;<i> 
</I>&gt;&gt;<i>4. The URL you are using
</I>&gt;<i> 
</I>&gt;<i> <A HREF="http://localhost/cartairweb/">http://localhost/cartairweb/</A>
</I>&gt;<i> 
</I>&gt;&gt;<i>5. The relevant error entries in apache's error log
</I>&gt;<i> 
</I>&gt;<i> no real error
</I>&gt;<i> 
</I>&gt;&gt;<i>Don't bother with /etc/profile or .bashrc. Also, include a function in
</I>&gt;&gt;<i>your module to display the path, so you can confirm it's being set.
</I>&gt;<i> 
</I>&gt;<i> Sometimes yes, sometimes no ...
</I>
Okay, in order to avoid some the quirks of Publisher, let's give the 
module a unique name, like foo.py. Rename the index function to 
something else (I'll use &quot;start&quot; as an example). Avoid using the Alias 
while you're troubleshooting, and don't set the PythonPath for now. This 
gives us an URL like this:

  <A HREF="http://localhost/topdir/webdir/foo/start">http://localhost/topdir/webdir/foo/start</A>

Assuming cartair.py is in /topdir/webdir, it should be imported 
properly, because the directory in which mod_python is defined is 
prepended to the path (unless PythonPath is set).

You didn't mention the name of your published module, but it looks like 
you're calling it index.py. That's a bad habit you should break. 
Although it's offered as a convenience, it creates problems because 
newbies treat it like index.html and don't understand that you can only 
have one index.py per interpreter, regardless of the location. Published 
modules are imported into the root namespace and will cause collisions 
if all published module names are not unique. This can cause the erratic 
behaviour you describe. Used properly, it can allow you to use a module 
as the root of your site, but it's really just smoke and mirrors. To put 
it in a somewhat gross oversimplification, Publisher allows you to have 
only one index.py in your site.



</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017287.html">[mod_python] pythonpath
</A></li>
	<LI>Next message: <A HREF="017292.html">[mod_python] pythonpath
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17290">[ date ]</a>
              <a href="thread.html#17290">[ thread ]</a>
              <a href="subject.html#17290">[ subject ]</a>
              <a href="author.html#17290">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
