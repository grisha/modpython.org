<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] PythonOption access
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20PythonOption%20access&In-Reply-To=1106268883.24610%40dscpl.user.openhosting.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017175.html">
   <LINK REL="Next"  HREF="017178.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] PythonOption access</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Bo Lorentsen</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20PythonOption%20access&In-Reply-To=1106268883.24610%40dscpl.user.openhosting.com"
       TITLE="[mod_python] PythonOption access">bl at netgroup.dk
       </A><BR>
    <I>Fri Jan 21 02:05:31 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="017175.html">[mod_python] PythonOption access
</A></li>
        <LI>Next message: <A HREF="017178.html">[mod_python] PythonOption access
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17176">[ date ]</a>
              <a href="thread.html#17176">[ thread ]</a>
              <a href="subject.html#17176">[ subject ]</a>
              <a href="author.html#17176">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Graham Dumpleton wrote:

&gt;<i>Having a bit more of a think about this, it wouldn't be too hard for me to
</I>&gt;<i>implement a relatively clean mechanism which would allow access to the
</I>&gt;<i>request object when loading a module, in the Vampire package I provide.
</I>&gt;<i>  
</I>&gt;<i>
</I>First, thanks for all the input ...

I am not aware of what the &quot;Vampire&quot; module are, one of Your projects ?

&gt;<i>If the import function took an optional &quot;req&quot; object, I could place this
</I>&gt;<i>into the empty module prior to running execfile() and then remove
</I>&gt;<i>it afterwards. Ie.,
</I>&gt;<i>
</I>&gt;<i>        module = imp.new_module(label)
</I>&gt;<i>        module.__file__ = file
</I>&gt;<i>        module.__req__ = req
</I>&gt;<i>        execfile(file,module.__dict__)
</I>&gt;<i>        del module.__dict__[&quot;__req__&quot;]
</I>&gt;<i>  
</I>&gt;<i>
</I>So this is performed in the &quot;python module loader&quot;, i guess ?

I am using the PythonHandler directly myself, and I guess this is more 
&quot;low level&quot;, so control at this level are not possible ?

&gt;<i>That way the &quot;req&quot; object could be available just for the period of the
</I>&gt;<i>initialisation phase of an import. You probably wouldn't want to
</I>&gt;<i>cache the req object as it applies to a specific request as the cached
</I>&gt;<i>module would outlive it. You also wouldn't want to be relying on
</I>&gt;<i>information specific to a request. You could access the PythonOption
</I>&gt;<i>values, although you may want to avoid values set in .htaccess files
</I>&gt;<i>and go for ones you know are set in the httpd.conf file.
</I>&gt;<i>  
</I>&gt;<i>
</I>Hmm, I know what You mean, but on the other hand ... I don't use one 
python script for more than one URL, and if I am, the script still 
remains in the same physical path in relation to the web server, anyway. 
Or are we talking about two different things ?

&gt;<i>Anyway, in the end, this would allow you to do something like the
</I>&gt;<i>following in a content handler.
</I>&gt;<i>
</I>&gt;<i>  from mod_python import apache
</I>&gt;<i>
</I>&gt;<i>  if __req__ != None:
</I>&gt;<i>    options = __req__.get_options()
</I>&gt;<i>    if options.has_key(&quot;debug&quot;) and options[&quot;debug&quot;]:
</I>&gt;<i>      apache.log_error(...)
</I>&gt;<i>  
</I>&gt;<i>
</I>Only ... I dislike the &quot;if&quot; :-)

I hoped for something like :

   from mod_python import apache

   pram = apache.get_option( 'custom_param' )

   ...

This is without the &quot;if&quot; as the only problem left will be that 
&quot;custom_param&quot; don't exist. I think the &quot;__req__&quot; object is a bad idea, 
as this is not a request situation, but module initialization. We know 
where the script is (and the .htaccess file), but no request have been 
send (well it has, but we need not to know about this in the &quot;global&quot; 
context !).

Anyway, this is how I dream about it :-)

&gt;<i>Is this the sort of thing you were wanting, or have I misunderstood?
</I>&gt;<i>  
</I>&gt;<i>
</I>Yeps, with some corrections :-)

&gt;<i>Overall I am not sure that this is a good idea or not. It has both good
</I>&gt;<i>points and bad points.
</I>&gt;<i>  
</I>&gt;<i>
</I>I think I know what you mean. It is a &quot;nice to have&quot; thing and I already 
have a work around for this. But in my search for perfection :-)

&gt;<i>Maybe it shouldn't use an actual req object, but a new object which
</I>&gt;<i>incorporates some of what req provides, dropping stuff that may be
</I>&gt;<i>more specific to a particular request.
</I>&gt;<i>
</I>Thats my point :-)

&gt;<i>Thus you might provide some
</I>&gt;<i>information about the server and python options, although not sure
</I>&gt;<i>how you deal with the issue of .htaccess level options being different
</I>&gt;<i>based on URL used for original request.
</I>&gt;<i>  
</I>&gt;<i>
</I>Well there is tho kinds of URL's there is physical and abstract (as I 
understand it). Physical URL ends up mapped onto a physical path on the 
disk (by apache), and therefor know where to load a .htaccess file (and 
the document), but an abstract ends up in a PythonHandler, that takes 
care of the rest.

The abstract URL handler will only be able to load the .htaccess file in 
the dir where it lives, but no config change depends on the URL, as long 
as it ends up in our handler.

Hmm, hope this makes sense. Anyway, I don't see any problems regarding 
configuration and different URL's, but I may be missing somthing.

&gt;<i>Anyway, worth thinking about some more.
</I>&gt;<i>  
</I>&gt;<i>
</I>Nice.

Anyway, python is a fantastic web script if you like your code to be 
readable :-)

/BL

</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017175.html">[mod_python] PythonOption access
</A></li>
	<LI>Next message: <A HREF="017178.html">[mod_python] PythonOption access
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17176">[ date ]</a>
              <a href="thread.html#17176">[ thread ]</a>
              <a href="subject.html#17176">[ subject ]</a>
              <a href="author.html#17176">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
