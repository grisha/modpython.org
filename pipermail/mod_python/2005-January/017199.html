<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] psp_site example doesn't work
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20psp_site%20example%20doesn%27t%20work&In-Reply-To=41F50248.1020703%40joreybump.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017198.html">
   <LINK REL="Next"  HREF="017200.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] psp_site example doesn't work</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Nicolas Lehuen</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20psp_site%20example%20doesn%27t%20work&In-Reply-To=41F50248.1020703%40joreybump.com"
       TITLE="[mod_python] psp_site example doesn't work">nicolas.lehuen at gmail.com
       </A><BR>
    <I>Mon Jan 24 10:28:47 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="017198.html">[mod_python] psp_site example doesn't work
</A></li>
        <LI>Next message: <A HREF="017200.html">[mod_python] psp_site example doesn't work
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17199">[ date ]</a>
              <a href="thread.html#17199">[ thread ]</a>
              <a href="subject.html#17199">[ subject ]</a>
              <a href="author.html#17199">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, 24 Jan 2005 09:12:24 -0500, Jorey Bump &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">list at joreybump.com</A>&gt; wrote:
&gt;<i> Nicolas Lehuen wrote:
</I>&gt;<i> &gt; On Sun, 23 Jan 2005 18:38:43 -0500, Graham Dumpleton
</I>&gt;<i> &gt; &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">grahamd at dscpl.com.au</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> &gt;&gt;Package such as mpservlets and Vampire implement their own module
</I>&gt;<i> &gt;&gt;importing mechanisms in order to avoid this problem. Ie., with those
</I>&gt;<i> &gt;&gt;packages it is safe to have Python code files which are named the same
</I>&gt;<i> &gt;&gt;appearing in different directories managed by mod_python running
</I>&gt;<i> &gt;&gt;under the same interpreter.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; We had a discussion a few months ago about this issue, and I still
</I>&gt;<i> &gt; think it's a bug. Like Daniel Popovitch with mpservlets and you with
</I>&gt;<i> &gt; Vampire, I had to implement my own import mechanism to work around the
</I>&gt;<i> &gt; bug. I think it's time to fix it... I'll add a bug report and see what
</I>&gt;<i> &gt; we can do about it.
</I>&gt;<i> 
</I>&gt;<i> I guess I'm on record as considering this to be normal Python behaviour,
</I>&gt;<i> and not a bug. Talk of modifying Publisher's current import mechanism
</I>&gt;<i> threatens the significant investment I have in the applications I've
</I>&gt;<i> already developed. I'd rather see Publisher left alone, as other
</I>&gt;<i> frameworks are maturing that address this issue.
</I>&gt;<i> 
</I>&gt;<i> We should be clear about what we are talking about:
</I>&gt;<i> 
</I>&gt;<i> Issue:
</I>&gt;<i> 
</I>&gt;<i> An interpreter imports a module's name into the namespace independent of
</I>&gt;<i> its location in the filesystem.
</I>&gt;<i> 
</I>&gt;<i> Pros:
</I>&gt;<i> 
</I>&gt;<i> - This is consistent with normal Python behaviour, where an interpreter
</I>&gt;<i> loads modules from the current directory or PYTHONPATH. [1]
</I>&gt;<i> 
</I>&gt;<i> - There is no ambiguity about imports, and no need to rewrite code when
</I>&gt;<i> moving the module to another location.
</I>&gt;<i> 
</I>&gt;<i> - The Python language documentation serves as a good resource, as native
</I>&gt;<i> behaviours are not contradicted. [2]
</I>&gt;<i> 
</I>&gt;<i> - General purpose code needs *very* little modification to run under
</I>&gt;<i> mod_python.publisher.
</I>&gt;<i> 
</I>&gt;<i> - The default Python behaviour of caching imported modules can be used
</I>&gt;<i> to great leverage, and plays a significant role in the performance boost
</I>&gt;<i> offered by mod_python. [3]
</I>&gt;<i> 
</I>&gt;<i> - With careful planning, per-interpreter package repositories can be
</I>&gt;<i> created.
</I>&gt;<i> 
</I>&gt;<i> Cons:
</I>&gt;<i> 
</I>&gt;<i> - This consistently trips up newbies, who are expecting PHP-like
</I>&gt;<i> behaviour from their web applications.
</I>&gt;<i> 
</I>&gt;<i> - Within an interpreter (a VirtualHost, for example), such care must be
</I>&gt;<i> taken to create unique module names that porting an application or
</I>&gt;<i> working in a team environment is significantly more fragile than in
</I>&gt;<i> other web technologies, where it usually suffices to throw the code in
</I>&gt;<i> its own directory.
</I>&gt;<i> 
</I>&gt;<i> - Although a lot of issues can be addressed in .htaccess files, so much
</I>&gt;<i> configuration occurs at the apache level that it is difficult to use
</I>&gt;<i> mod_python effectively without apache admin privileges. [4]
</I>&gt;<i> 
</I>&gt;<i> - The Multi-Processing Modules (MPMs) in apache 2 may have a unique
</I>&gt;<i> effect on an application. After throwing in the different platforms,
</I>&gt;<i> Python versions, and developer styles, it can be very hard to reach a
</I>&gt;<i> consensus on whether an issue even exists.
</I>&gt;<i> 
</I>&gt;<i> Possible solution:
</I>&gt;<i> 
</I>&gt;<i> Automatically package module based on the file path.
</I>&gt;<i> 
</I>&gt;<i> Pros:
</I>&gt;<i> 
</I>&gt;<i> - Hopefully, this would provide better separation of modules in namespace.
</I>&gt;<i> 
</I>&gt;<i> Cons:
</I>&gt;<i> 
</I>&gt;<i> - Serious potential to break existing Publisher applications.
</I>&gt;<i> 
</I>&gt;<i> - The same module might be loaded into a separate namespace for
</I>&gt;<i> different applications, eliminating the advantage of module caching. [5]
</I>&gt;<i> 
</I>&gt;<i> - This encourages the reuse of module names (such as index.py), which is
</I>&gt;<i> considered a bad programming practice in Python. [1]
</I>&gt;<i> 
</I>&gt;<i> - If the code assumes and uses a package name based on its location, it
</I>&gt;<i> will need to be rewritten if it is moved.
</I>&gt;<i> 
</I>&gt;<i> - The possibility that autopackaging will arbitrarily create a namespace
</I>&gt;<i> clash with a standard module is unacceptably high, especially where
</I>&gt;<i> third party packages are installed.
</I>&gt;<i> 
</I>&gt;<i> - It severely limits the ability to test portions of the code from the
</I>&gt;<i> command line, because it adds an element of unpredictability to the
</I>&gt;<i> module search path.
</I>&gt;<i> 
</I>&gt;<i> - Seasoned Python programmers might consider mod_python.publisher to be
</I>&gt;<i> &quot;broken&quot; because it doesn't conform to Python standards. [6]
</I>&gt;<i> 
</I>&gt;<i> [1] For a clear description of Python's module search path, see:
</I>&gt;<i> <A HREF="http://www.python.org/doc/current/tut/node8.html#SECTION008110000000000000000">http://www.python.org/doc/current/tut/node8.html#SECTION008110000000000000000</A>
</I>&gt;<i> 
</I>&gt;<i> [2] The documentation for mod_python is sparse because it simply embeds
</I>&gt;<i> an interpreter in apache. See the Python documentation for programming
</I>&gt;<i> issues: <A HREF="http://www.python.org/doc/current/index.html">http://www.python.org/doc/current/index.html</A>
</I>&gt;<i> 
</I>&gt;<i> [3] This seems to be the main complaint levied against mod_python, in
</I>&gt;<i> one form or the other. I consider it one of it's greatest strengths. For
</I>&gt;<i> example, it allows me to import database handling code from a module
</I>&gt;<i> once for that interpreter, allowing multiple applications to share the
</I>&gt;<i> connection -- a poor man's database pool, if you will.
</I>&gt;<i> 
</I>&gt;<i> [4] The same can be said about php.ini, but noone ever needs to restart
</I>&gt;<i> apache to develop PHP applications.
</I>&gt;<i> 
</I>&gt;<i> [5] What is the solution to the problems caused by module caching? It
</I>&gt;<i> doesn't make much sense to force mod_python to act like it's spawning a
</I>&gt;<i> new interpreter for every request. Run the app as a CGI instead of using
</I>&gt;<i> mod_python.
</I>&gt;<i> 
</I>&gt;<i> [6] The strength of Publisher is that it leverages the advantages of
</I>&gt;<i> Python with very little overhead, simply adding a number of conveniences
</I>&gt;<i> specific to web application development. mod_python.psp is a much better
</I>&gt;<i> area to radically depart from this paradigm, as it is expected to
</I>&gt;<i> provide PHP-like behaviour.
</I>
Sorry, I don't have much time, so for now I'll give a short answer : I
agree that importing modules should be consistent between the standard
Python way (the import keyword) and the apache.import_module way.

The problem is that mod_python.publisher does not follow the standard
Python way in that it imports published modules as root-level modules.
It's as if mod_python.publisher changed sys.path for each and every
published module. This is not the standard Python way, and the source
for many errors.

Note that the current package system in Python is way, way smarter
than mod_python.publisher : in a package, you can import fellow
modules by giving their local names. It's not recommended by
pychecker, but it works. The smart part is that if I have this :

/
     package1.py
/subdir
     __init__.py
     package1.py
     package2.py

Then whatever I do, /subdir/package1.py is imported as subdir.package1
and does not collide with /package1.py. mod_python.publisher is not as
smart, this is very confusing and surprising, nearly everybody
complains about this and hence, I think this should be filed as a bug.

So maybe apache.import_module should not be modified (except for
performance, but that's another issue which is already in the bugs
database), but mod_python.publisher sure has to be changed.

As far as I'm concerned, this bug was sufficient to have me implement
a publisher which works the way I want ; Daniel Popovitch and Graham
Dumpleton did the same with different designs. If each and every
developer develops his own publisher, it may be time to think about
changing the built-in one.

Regards,
Nicolas
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017198.html">[mod_python] psp_site example doesn't work
</A></li>
	<LI>Next message: <A HREF="017200.html">[mod_python] psp_site example doesn't work
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17199">[ date ]</a>
              <a href="thread.html#17199">[ thread ]</a>
              <a href="subject.html#17199">[ subject ]</a>
              <a href="author.html#17199">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
