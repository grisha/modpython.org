<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] PythonOption access
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20PythonOption%20access&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017174.html">
   <LINK REL="Next"  HREF="017176.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] PythonOption access</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20PythonOption%20access&In-Reply-To="
       TITLE="[mod_python] PythonOption access">grahamd at dscpl.com.au
       </A><BR>
    <I>Thu Jan 20 19:54:43 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="017174.html">[mod_python] PythonOption access
</A></li>
        <LI>Next message: <A HREF="017176.html">[mod_python] PythonOption access
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17175">[ date ]</a>
              <a href="thread.html#17175">[ thread ]</a>
              <a href="subject.html#17175">[ subject ]</a>
              <a href="author.html#17175">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Bo Lorentsen wrote ..
&gt;<i> Will it be possible to access PythonOptions like log_error in a more 
</I>&gt;<i> global context (log_error is a function on the apache module), so that
</I>&gt;<i> global values can get there init value on module init and NOT on the 
</I>&gt;<i> first incomming request ? I have some code that work around this, but 
</I>&gt;<i> its not pretty, and I like things to be so, and I don't understand why
</I>&gt;<i> it has to be a method on the request module.
</I>&gt;<i> 
</I>&gt;<i> Is this completely impossible ?
</I>
Having a bit more of a think about this, it wouldn't be too hard for me to
implement a relatively clean mechanism which would allow access to the
request object when loading a module, in the Vampire package I provide.

In Vampire, it uses its own module caching and import system and thus I
have more control over this process. At the moment the prototype for the
module import function is &quot;importModule(name,path)&quot;. That is, the input
arguments are the name of the module, and the specific directory in which
that module is expected to be located.

The module importing mechanism in Vampire doesn't use the &quot;imp&quot;
module and instead uses &quot;execfile()&quot;. As such, the code already creates
a module object into which the code file is executed in order to achieve
the same affect as an import. Ie.,

        module = imp.new_module(label)
        module.__file__ = file
        execfile(file,module.__dict__)

If the import function took an optional &quot;req&quot; object, I could place this
into the empty module prior to running execfile() and then remove
it afterwards. Ie.,

        module = imp.new_module(label)
        module.__file__ = file
        module.__req__ = req
        execfile(file,module.__dict__)
        del module.__dict__[&quot;__req__&quot;]

The only other change would be where the code uses the import
function to load in content handlers, it would need to pass req.

That way the &quot;req&quot; object could be available just for the period of the
initialisation phase of an import. You probably wouldn't want to
cache the req object as it applies to a specific request as the cached
module would outlive it. You also wouldn't want to be relying on
information specific to a request. You could access the PythonOption
values, although you may want to avoid values set in .htaccess files
and go for ones you know are set in the httpd.conf file.

Anyway, in the end, this would allow you to do something like the
following in a content handler.

  from mod_python import apache

  if __req__ != None:
    options = __req__.get_options()
    if options.has_key(&quot;debug&quot;) and options[&quot;debug&quot;]:
      apache.log_error(...)

Is this the sort of thing you were wanting, or have I misunderstood?

Overall I am not sure that this is a good idea or not. It has both good
points and bad points.

Maybe it shouldn't use an actual req object, but a new object which
incorporates some of what req provides, dropping stuff that may be
more specific to a particular request. Thus you might provide some
information about the server and python options, although not sure
how you deal with the issue of .htaccess level options being different
based on URL used for original request.

Anyway, worth thinking about some more.

Graham

</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017174.html">[mod_python] PythonOption access
</A></li>
	<LI>Next message: <A HREF="017176.html">[mod_python] PythonOption access
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17175">[ date ]</a>
              <a href="thread.html#17175">[ thread ]</a>
              <a href="subject.html#17175">[ subject ]</a>
              <a href="author.html#17175">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
