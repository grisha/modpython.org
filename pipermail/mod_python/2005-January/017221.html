<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Catalog of mod_python.publisher problems.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Catalog%20of%20mod_python.publisher%20problems.&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017219.html">
   <LINK REL="Next"  HREF="017222.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Catalog of mod_python.publisher problems.</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Catalog%20of%20mod_python.publisher%20problems.&In-Reply-To="
       TITLE="[mod_python] Catalog of mod_python.publisher problems.">grahamd at dscpl.com.au
       </A><BR>
    <I>Tue Jan 25 00:14:42 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="017219.html">[mod_python] psp_site example doesn't work
</A></li>
        <LI>Next message: <A HREF="017222.html">[mod_python] Catalog of mod_python.publisher problems.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17221">[ date ]</a>
              <a href="thread.html#17221">[ thread ]</a>
              <a href="subject.html#17221">[ subject ]</a>
              <a href="author.html#17221">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Jorey Bump wrote ..
&gt;<i> Create 2 modules, in the same directory, named master.py and slave.py:
</I>&gt;<i> 
</I>&gt;<i> master.py:
</I>&gt;<i> 
</I>&gt;<i>   import slave
</I>&gt;<i> 
</I>&gt;<i>   def hello(req):
</I>&gt;<i>       return slave.hello
</I>&gt;<i> 
</I>&gt;<i> slave.py:
</I>&gt;<i> 
</I>&gt;<i>   hello = &quot;Hello, world!&quot;
</I>&gt;<i> 
</I>&gt;<i> Access <A HREF="http://host/master/hello">http://host/master/hello</A> and &quot;Hello, world!&quot; appears in the 
</I>&gt;<i> browser. Now move the files into a subdirectory and access 
</I>&gt;<i> <A HREF="http://host/subdir/master/hello.">http://host/subdir/master/hello.</A> It throws up an error:
</I>&gt;<i> 
</I>&gt;<i>   ImportError: No module named slave
</I>&gt;<i> 
</I>&gt;<i> What happened? It originally appeared as though a module could import 
</I>&gt;<i> adjacent modules, but this failed in a subdirectory. The reason is that
</I>&gt;<i> the original directory was where the interpreter was defined (with no 
</I>&gt;<i> PythonPath), and so was prepended to the module search path. It doesn't
</I>&gt;<i> matter where master.py is (as long as it accessible by the defined 
</I>&gt;<i> interpreter), but slave.py  must be in sys.path if it is to be imported
</I>&gt;<i> by a published module.
</I>&gt;<i> 
</I>&gt;<i> This falls under the &quot;perceived problem&quot; category, in that it's not a 
</I>&gt;<i> bug, but sure looks like one at first. My own practice for coping with
</I>&gt;<i> this is to set a PythonPath directive, appending a directory outside the
</I>&gt;<i> DocumentRoot from which I can reliably import modules and packages 
</I>&gt;<i> specific to that interpreter or VirtualHost.
</I>
As I gave as response to a recent question, this is possibly better solved
by writing:

  import os
  from mod_python import apache
  directory = os.path.dirname(__file__)

  slave = apache.import_module(&quot;slave&quot;,[directory])
 
  def hello(req):
      return slave.hello

Everyone has their own personal opinions on how best to use mod_python.
As to my own two cents worth, although mod_python uses Python, the
environment which it is running under isn't like running Python from the
command line. One is using it in the context of a web server and what
people tend to expect in doing stuff with web servers is that they can use
the same resource name in different locations of the URL namespace.

Because people are using mod_python/Python specifically to build web
applications, I believe that this expectation about using the same
resource names in multiple places is an overriding factor and any design
should accomodate this practice.

Thus, I would suggest that best practice would be:

1. Only use the &quot;import&quot; statement to import modules which have been
provided with Python, are installed into the &quot;site-packages&quot; directory
or are clearly seperated out into a directory distinct from the document
hierarchy. In this later case PythonPath should be used to denote where
that directory is.

2. That sys.path should not ever include any directory which is a part of
the document hierarchy. Unfortunately the way handlers are setup this
is done by default. This can be avoided though by setting PythonPath
explicity at the same point PythonHandler is defined. If PythonPath isn't
being defined anyway to add in extra external directories containing
application specific modules, then PythonPath should be set to &quot;sys.path&quot;
to ensure the document directory isn't added.

3. Always use apache.import_module() to import relative code files which
are contained within the document hierarchy. Because of (2) above, one
wouldn't be able to rely on sys.path though, so one should calculate the
exact directory that a code files resides in. This can be done by using
__file__ as described above. The directory would then be supplied to the
import module method to ensure that only that directory is searched.

In other words, a clear distinction is drawn. If it is outside the document
hierarchy, then &quot;import&quot; must be used with sys.path defining the search
path. Because &quot;import&quot; is used, modules outside of document hierarchy
must be uniquely named.

Inside the document heirarchy always use import_module() and always
define the exact directory you want something loaded from. Within the
document hierarchy, rather than calling them modules, they should be
seen as code files and duplicates should be allowed in different
directories.

All that now would need to be done is to fix import_module() so that it
copes properly with loading from the document hierarchy code files
with the same name in different directories. This isn't actually that hard
to do, but at the moment we seemed to be bogged down in arguing
about whether it is right or not.

Graham
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017219.html">[mod_python] psp_site example doesn't work
</A></li>
	<LI>Next message: <A HREF="017222.html">[mod_python] Catalog of mod_python.publisher problems.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17221">[ date ]</a>
              <a href="thread.html#17221">[ thread ]</a>
              <a href="subject.html#17221">[ subject ]</a>
              <a href="author.html#17221">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
