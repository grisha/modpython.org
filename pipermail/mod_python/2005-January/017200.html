<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] psp_site example doesn't work
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20psp_site%20example%20doesn%27t%20work&In-Reply-To=c298f2d705012407284ef8ab40%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017199.html">
   <LINK REL="Next"  HREF="017203.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] psp_site example doesn't work</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Nicolas Lehuen</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20psp_site%20example%20doesn%27t%20work&In-Reply-To=c298f2d705012407284ef8ab40%40mail.gmail.com"
       TITLE="[mod_python] psp_site example doesn't work">nicolas.lehuen at gmail.com
       </A><BR>
    <I>Mon Jan 24 10:30:47 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="017199.html">[mod_python] psp_site example doesn't work
</A></li>
        <LI>Next message: <A HREF="017203.html">[mod_python] psp_site example doesn't work
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17200">[ date ]</a>
              <a href="thread.html#17200">[ thread ]</a>
              <a href="subject.html#17200">[ subject ]</a>
              <a href="author.html#17200">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, 24 Jan 2005 16:28:47 +0100, Nicolas Lehuen
&lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">nicolas.lehuen at gmail.com</A>&gt; wrote:
&gt;<i> On Mon, 24 Jan 2005 09:12:24 -0500, Jorey Bump &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">list at joreybump.com</A>&gt; wrote:
</I>&gt;<i> &gt; Nicolas Lehuen wrote:
</I>&gt;<i> &gt; &gt; On Sun, 23 Jan 2005 18:38:43 -0500, Graham Dumpleton
</I>&gt;<i> &gt; &gt; &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">grahamd at dscpl.com.au</A>&gt; wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt;&gt;Package such as mpservlets and Vampire implement their own module
</I>&gt;<i> &gt; &gt;&gt;importing mechanisms in order to avoid this problem. Ie., with those
</I>&gt;<i> &gt; &gt;&gt;packages it is safe to have Python code files which are named the same
</I>&gt;<i> &gt; &gt;&gt;appearing in different directories managed by mod_python running
</I>&gt;<i> &gt; &gt;&gt;under the same interpreter.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; We had a discussion a few months ago about this issue, and I still
</I>&gt;<i> &gt; &gt; think it's a bug. Like Daniel Popovitch with mpservlets and you with
</I>&gt;<i> &gt; &gt; Vampire, I had to implement my own import mechanism to work around the
</I>&gt;<i> &gt; &gt; bug. I think it's time to fix it... I'll add a bug report and see what
</I>&gt;<i> &gt; &gt; we can do about it.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I guess I'm on record as considering this to be normal Python behaviour,
</I>&gt;<i> &gt; and not a bug. Talk of modifying Publisher's current import mechanism
</I>&gt;<i> &gt; threatens the significant investment I have in the applications I've
</I>&gt;<i> &gt; already developed. I'd rather see Publisher left alone, as other
</I>&gt;<i> &gt; frameworks are maturing that address this issue.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; We should be clear about what we are talking about:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Issue:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; An interpreter imports a module's name into the namespace independent of
</I>&gt;<i> &gt; its location in the filesystem.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Pros:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; - This is consistent with normal Python behaviour, where an interpreter
</I>&gt;<i> &gt; loads modules from the current directory or PYTHONPATH. [1]
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; - There is no ambiguity about imports, and no need to rewrite code when
</I>&gt;<i> &gt; moving the module to another location.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; - The Python language documentation serves as a good resource, as native
</I>&gt;<i> &gt; behaviours are not contradicted. [2]
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; - General purpose code needs *very* little modification to run under
</I>&gt;<i> &gt; mod_python.publisher.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; - The default Python behaviour of caching imported modules can be used
</I>&gt;<i> &gt; to great leverage, and plays a significant role in the performance boost
</I>&gt;<i> &gt; offered by mod_python. [3]
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; - With careful planning, per-interpreter package repositories can be
</I>&gt;<i> &gt; created.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Cons:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; - This consistently trips up newbies, who are expecting PHP-like
</I>&gt;<i> &gt; behaviour from their web applications.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; - Within an interpreter (a VirtualHost, for example), such care must be
</I>&gt;<i> &gt; taken to create unique module names that porting an application or
</I>&gt;<i> &gt; working in a team environment is significantly more fragile than in
</I>&gt;<i> &gt; other web technologies, where it usually suffices to throw the code in
</I>&gt;<i> &gt; its own directory.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; - Although a lot of issues can be addressed in .htaccess files, so much
</I>&gt;<i> &gt; configuration occurs at the apache level that it is difficult to use
</I>&gt;<i> &gt; mod_python effectively without apache admin privileges. [4]
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; - The Multi-Processing Modules (MPMs) in apache 2 may have a unique
</I>&gt;<i> &gt; effect on an application. After throwing in the different platforms,
</I>&gt;<i> &gt; Python versions, and developer styles, it can be very hard to reach a
</I>&gt;<i> &gt; consensus on whether an issue even exists.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Possible solution:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Automatically package module based on the file path.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Pros:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; - Hopefully, this would provide better separation of modules in namespace.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Cons:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; - Serious potential to break existing Publisher applications.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; - The same module might be loaded into a separate namespace for
</I>&gt;<i> &gt; different applications, eliminating the advantage of module caching. [5]
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; - This encourages the reuse of module names (such as index.py), which is
</I>&gt;<i> &gt; considered a bad programming practice in Python. [1]
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; - If the code assumes and uses a package name based on its location, it
</I>&gt;<i> &gt; will need to be rewritten if it is moved.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; - The possibility that autopackaging will arbitrarily create a namespace
</I>&gt;<i> &gt; clash with a standard module is unacceptably high, especially where
</I>&gt;<i> &gt; third party packages are installed.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; - It severely limits the ability to test portions of the code from the
</I>&gt;<i> &gt; command line, because it adds an element of unpredictability to the
</I>&gt;<i> &gt; module search path.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; - Seasoned Python programmers might consider mod_python.publisher to be
</I>&gt;<i> &gt; &quot;broken&quot; because it doesn't conform to Python standards. [6]
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; [1] For a clear description of Python's module search path, see:
</I>&gt;<i> &gt; <A HREF="http://www.python.org/doc/current/tut/node8.html#SECTION008110000000000000000">http://www.python.org/doc/current/tut/node8.html#SECTION008110000000000000000</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; [2] The documentation for mod_python is sparse because it simply embeds
</I>&gt;<i> &gt; an interpreter in apache. See the Python documentation for programming
</I>&gt;<i> &gt; issues: <A HREF="http://www.python.org/doc/current/index.html">http://www.python.org/doc/current/index.html</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; [3] This seems to be the main complaint levied against mod_python, in
</I>&gt;<i> &gt; one form or the other. I consider it one of it's greatest strengths. For
</I>&gt;<i> &gt; example, it allows me to import database handling code from a module
</I>&gt;<i> &gt; once for that interpreter, allowing multiple applications to share the
</I>&gt;<i> &gt; connection -- a poor man's database pool, if you will.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; [4] The same can be said about php.ini, but noone ever needs to restart
</I>&gt;<i> &gt; apache to develop PHP applications.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; [5] What is the solution to the problems caused by module caching? It
</I>&gt;<i> &gt; doesn't make much sense to force mod_python to act like it's spawning a
</I>&gt;<i> &gt; new interpreter for every request. Run the app as a CGI instead of using
</I>&gt;<i> &gt; mod_python.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; [6] The strength of Publisher is that it leverages the advantages of
</I>&gt;<i> &gt; Python with very little overhead, simply adding a number of conveniences
</I>&gt;<i> &gt; specific to web application development. mod_python.psp is a much better
</I>&gt;<i> &gt; area to radically depart from this paradigm, as it is expected to
</I>&gt;<i> &gt; provide PHP-like behaviour.
</I>&gt;<i> 
</I>&gt;<i> Sorry, I don't have much time, so for now I'll give a short answer : I
</I>&gt;<i> agree that importing modules should be consistent between the standard
</I>&gt;<i> Python way (the import keyword) and the apache.import_module way.
</I>&gt;<i> 
</I>&gt;<i> The problem is that mod_python.publisher does not follow the standard
</I>&gt;<i> Python way in that it imports published modules as root-level modules.
</I>&gt;<i> It's as if mod_python.publisher changed sys.path for each and every
</I>&gt;<i> published module. This is not the standard Python way, and the source
</I>&gt;<i> for many errors.
</I>&gt;<i> 
</I>&gt;<i> Note that the current package system in Python is way, way smarter
</I>&gt;<i> than mod_python.publisher : in a package, you can import fellow
</I>&gt;<i> modules by giving their local names. It's not recommended by
</I>&gt;<i> pychecker, but it works. The smart part is that if I have this :
</I>&gt;<i> 
</I>&gt;<i> /
</I>&gt;<i>      package1.py
</I>&gt;<i> /subdir
</I>&gt;<i>      __init__.py
</I>&gt;<i>      package1.py
</I>&gt;<i>      package2.py
</I>&gt;<i> 
</I>&gt;<i> Then whatever I do, /subdir/package1.py is imported as subdir.package1
</I>&gt;<i> and does not collide with /package1.py. mod_python.publisher is not as
</I>&gt;<i> smart, this is very confusing and surprising, nearly everybody
</I>&gt;<i> complains about this and hence, I think this should be filed as a bug.
</I>&gt;<i> 
</I>&gt;<i> So maybe apache.import_module should not be modified (except for
</I>&gt;<i> performance, but that's another issue which is already in the bugs
</I>&gt;<i> database), but mod_python.publisher sure has to be changed.
</I>&gt;<i> 
</I>&gt;<i> As far as I'm concerned, this bug was sufficient to have me implement
</I>&gt;<i> a publisher which works the way I want ; Daniel Popovitch and Graham
</I>&gt;<i> Dumpleton did the same with different designs. If each and every
</I>&gt;<i> developer develops his own publisher, it may be time to think about
</I>&gt;<i> changing the built-in one.
</I>&gt;<i> 
</I>&gt;<i> Regards,
</I>&gt;<i> Nicolas
</I>&gt;<i> 
</I>
Or it could be the sign that mod_python.publisher should be completely
erased from the project, since it poses much more problems than it
solves. Maybe we should include both mpservlets and Vampire in
mod_python, and forget about the default publisher (except maybe for
compatibility issues).

Regards,
Nicolas
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017199.html">[mod_python] psp_site example doesn't work
</A></li>
	<LI>Next message: <A HREF="017203.html">[mod_python] psp_site example doesn't work
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17200">[ date ]</a>
              <a href="thread.html#17200">[ thread ]</a>
              <a href="subject.html#17200">[ subject ]</a>
              <a href="author.html#17200">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
