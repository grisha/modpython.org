<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Sessions again...
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Sessions%20again...&In-Reply-To=000d01c61d4a%249075c320%24f8dbebc9%40luis">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020034.html">
   <LINK REL="Next"  HREF="020031.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Sessions again...</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Jim Gallacher</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Sessions%20again...&In-Reply-To=000d01c61d4a%249075c320%24f8dbebc9%40luis"
       TITLE="[mod_python] Sessions again...">jpg at jgassociates.ca
       </A><BR>
    <I>Thu Jan 19 19:17:59 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="020034.html">[mod_python] Sessions again...
</A></li>
        <LI>Next message: <A HREF="020031.html">[mod_python] How do you use mod_python?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20038">[ date ]</a>
              <a href="thread.html#20038">[ thread ]</a>
              <a href="subject.html#20038">[ subject ]</a>
              <a href="author.html#20038">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Luis M. Gonzalez wrote:
&gt;<i> Ok, Jim, I'll clarify the problem:
</I>&gt;<i> Both scripts initiate their sessions the same way and with the same name:
</I>&gt;<i> 
</I>&gt;<i> Script nr.1:
</I>&gt;<i> 
</I>&gt;<i>    s= Session.Session(req)
</I>&gt;<i>    if s.is_new():
</I>&gt;<i>       s['items'] = {}
</I>&gt;<i> 
</I>&gt;<i> Script nr.2:
</I>&gt;<i> 
</I>&gt;<i>    s= Session.Session(req)
</I>&gt;<i>    if s.is_new():
</I>&gt;<i>       s['counter'] = 0
</I>&gt;<i> 
</I>&gt;<i> I did it this way because I asume that for using both scripts in the 
</I>&gt;<i> same site, I should have only one session started.
</I>
You are correct, but as you've discovered the order that the scripts are 
called by the client will effect which initialization routine will be 
executed. This is one of the things that can make using sessions tricky.

&gt;<i> (Note that I also tried starting different sessions for each script, 
</I>&gt;<i> with different names, but the problem persists).
</I>
The name is not relevant. The thing that counts is the value of the 
pysid cookie which is set in the browser. It is this cookie that 
determines which session will be instantiated when Session.Session is 
called. A new session is created if there is no cookie, otherwise the 
corresponding session data is pulled from the persistent store.

&gt;<i> Actually, I already fixed this problem (with a wacky work-around 
</I>&gt;<i> though...).
</I>&gt;<i> In each script, I created the session variable corresponding to the 
</I>&gt;<i> other script, as follows:
</I>&gt;<i> 
</I>&gt;<i> Script nr.1:
</I>&gt;<i> 
</I>&gt;<i>    s = Session.Session(req)
</I>&gt;<i>    if s.is_new():
</I>&gt;<i>        s['counter'] = 0
</I>&gt;<i>        s['items']= {} # workaround to avoid trouble with cart script
</I>&gt;<i> 
</I>&gt;<i> Script nr.2:
</I>&gt;<i> 
</I>&gt;<i>    s = Session.Session(req)
</I>&gt;<i>    if s.is_new():
</I>&gt;<i>        s['items']= {}
</I>&gt;<i>        s['counter'] = 0 # workaround to avoid trouble with recset script
</I>&gt;<i> 
</I>&gt;<i> Well, this fixed the problem in this case, but i don't think this 
</I>&gt;<i> woraround fits into mod_python's best practices...
</I>
It may look ugly, but it's not totally wacky. The problem is that it 
will make maintainence more difficult as you are coupling 2 scripts that 
may not be related. If you want to make changes in script #2 12 months 
from now, will you remember why you have s['items'] = {} in there when 
it's not used anywhere else in that particular script? You might be 
better off using some combination of is_new and hasattr.

nr.1:
if not hasattr(s, 'counter') or s.is_new():
     do_nr1_session_init(s)

nr.2:
if not hasattr(s, 'items') or s.is_new():
     do_nr2_session_init(s)

If you really do want distinct session objects for each script you'll 
need to investigate some of the options Graham presented in another 
email in this thread.

Jim
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020034.html">[mod_python] Sessions again...
</A></li>
	<LI>Next message: <A HREF="020031.html">[mod_python] How do you use mod_python?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20038">[ date ]</a>
              <a href="thread.html#20038">[ thread ]</a>
              <a href="subject.html#20038">[ subject ]</a>
              <a href="author.html#20038">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
