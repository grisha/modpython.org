<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Re: child process XXXX still did not exit,
	sending a SIGTERM
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Re%3A%20child%20process%20XXXX%20still%20did%20not%20exit%2C%0A%09sending%20a%20SIGTERM&In-Reply-To=8393fff0601032050m72581f41j7ed22a0c437cb651%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019857.html">
   <LINK REL="Next"  HREF="019858.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Re: child process XXXX still did not exit,
	sending a SIGTERM</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Martin Blais</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Re%3A%20child%20process%20XXXX%20still%20did%20not%20exit%2C%0A%09sending%20a%20SIGTERM&In-Reply-To=8393fff0601032050m72581f41j7ed22a0c437cb651%40mail.gmail.com"
       TITLE="[mod_python] Re: child process XXXX still did not exit,
	sending a SIGTERM">blais at furius.ca
       </A><BR>
    <I>Wed Jan  4 00:25:05 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="019857.html">[mod_python] Re: child process XXXX still did not exit,
	sending a SIGTERM
</A></li>
        <LI>Next message: <A HREF="019858.html">[mod_python] Re: child process XXXX still did not exit,
	sending a SIGTERM
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19862">[ date ]</a>
              <a href="thread.html#19862">[ thread ]</a>
              <a href="subject.html#19862">[ subject ]</a>
              <a href="author.html#19862">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 1/3/06, Martin Blais &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">blais at furius.ca</A>&gt; wrote:
&gt;<i> My main problem is getting more info at that point, because even if I
</I>&gt;<i> attach a gdb to the cihld process, apache insists on sending it
</I>&gt;<i> SIGKILL 10 seconds later.  I just had an idea on the way to dinner,
</I>&gt;<i> that I could &quot;simulate&quot; finalisation by calling python_finalize from
</I>&gt;<i> the handler by returning a special signal number, just for this
</I>&gt;<i> purpose.
</I>
FWIW, I just implemented this easily: I add a hook in python_handler
to call the finalization code and then exit.  Then I bound a resource
in my web app that return the magic code (442).  So what I do is start
apache, fetch some resources which always trigger the problem, then
fetch the special resource, and watch the finalization code be run and
the child exits.

I was hoping for it to hang, so that I could attach a debugger on it
and inspect my Python child to see what the bugger was doing, but
guess what... when called from the handler, the finalization code
always succeeds!  Go figure.  Is this useful information?


Patch below:

--- mod_python.c        2006-01-03 19:17:44.000000000 -0500
+++ mod_python.orig.c   2006-01-03 11:44:56.000000000 -0500
@@ -1122,14 +1122,6 @@
         else {
             result = PyInt_AsLong(resultobject);

-            /* Fake finalization, just to test and attach a debugger to it. */
-            if ( result == 442 ) {
-              Py_XDECREF(resultobject);
-
-              python_finalize(NULL);
-              exit(0);
-            }
-
             /* authen handlers need one more thing
              * if authentication failed and this handler is not
              * authoritative, let the others handle it

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019857.html">[mod_python] Re: child process XXXX still did not exit,
	sending a SIGTERM
</A></li>
	<LI>Next message: <A HREF="019858.html">[mod_python] Re: child process XXXX still did not exit,
	sending a SIGTERM
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19862">[ date ]</a>
              <a href="thread.html#19862">[ thread ]</a>
              <a href="subject.html#19862">[ subject ]</a>
              <a href="author.html#19862">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
