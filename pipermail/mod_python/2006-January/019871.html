<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Session Management for the beginner
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Session%20Management%20for%20the%20beginner&In-Reply-To=43BBDF7E.7050107%40qlf.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019869.html">
   <LINK REL="Next"  HREF="019874.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Session Management for the beginner</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Jim Gallacher</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Session%20Management%20for%20the%20beginner&In-Reply-To=43BBDF7E.7050107%40qlf.com"
       TITLE="[mod_python] Session Management for the beginner">jpg at jgassociates.ca
       </A><BR>
    <I>Wed Jan  4 12:24:57 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="019869.html">[mod_python] Session Management for the beginner
</A></li>
        <LI>Next message: <A HREF="019874.html">[mod_python] Session Management for the beginner
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19871">[ date ]</a>
              <a href="thread.html#19871">[ thread ]</a>
              <a href="subject.html#19871">[ subject ]</a>
              <a href="author.html#19871">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Jim Steil wrote:
&gt;<i> Hi, I'm new to mod_python and apache in general, and am confused about 
</I>&gt;<i> how to implement session management.  I'm using the Publisher handler 
</I>&gt;<i> and PSP templates.
</I>&gt;<i> 
</I>&gt;<i> Here is the relevant portion of my http.conf file:
</I>&gt;<i> 
</I>&gt;<i> &lt;Directory &quot;c:/program files/apache group/apache2/htdocs/motion&quot;&gt;
</I>&gt;<i>      AddHandler mod_python .py
</I>&gt;<i>      PythonHandler mod_python.publisher
</I>&gt;<i>      PythonAuthenHandler myAuthScript
</I>&gt;<i>      PythonDebug On
</I>&gt;<i>      AuthType Basic
</I>&gt;<i>      AuthName &quot;Restricted Area&quot;
</I>&gt;<i>      require valid-user
</I>&gt;<i> &lt;/Directory&gt;
</I>&gt;<i> 
</I>&gt;<i> ...and here is my python module:
</I>&gt;<i> 
</I>&gt;<i> from mod_python import psp
</I>&gt;<i> 
</I>&gt;<i> import time
</I>&gt;<i> import mx.ODBC
</I>&gt;<i> import mx.ODBC.Windows
</I>&gt;<i> 
</I>&gt;<i> def secUserList(req, page='', sortSeq=''):
</I>&gt;<i>    if page:
</I>&gt;<i>        startPage = int(page)
</I>&gt;<i>    else:
</I>&gt;<i>        startPage = 1
</I>&gt;<i>      pageLength = 20
</I>&gt;<i>      sql = 'call secUser_list(\'' + sortSeq + '\', ' + repr(startPage) + 
</I>&gt;<i> ', ' + repr(pageLength) + ')'
</I>&gt;<i>    db = mx.ODBC.Windows.DriverConnect('DSN=motion;UID=userid;PWD=password')
</I>&gt;<i>    c = db.cursor()
</I>&gt;<i>    c.execute(sql)
</I>&gt;<i>      htmlText = ''
</I>&gt;<i>    for secUserId, firstName, lastName, logonName, email in c.fetchall():
</I>&gt;<i>        htmlText = htmlText + '&lt;tr 
</I>&gt;<i> onmouseover=&quot;style.backgroundColor=\'#FFF0AF\'; style.cursor=\'hand\';&quot; 
</I>&gt;<i> onclick=&quot;location.href=\'secUserProfile?secUserId=' + &quot;%i&quot; % secUserId + 
</I>&gt;<i> '\'&quot; onmouseout=&quot;style.backgroundColor=\'#ffffff\';&quot;&gt;&lt;td&gt;' + firstName + 
</I>&gt;<i> '&lt;/td&gt;&lt;td&gt;' + lastName + '&lt;/td&gt;&lt;td&gt;' + logonName + '&lt;/td&gt;&lt;td&gt;' + email + 
</I>&gt;<i> '&lt;/td&gt;&lt;/tr&gt;\n'
</I>&gt;<i>          previousPage = 1
</I>&gt;<i>    if startPage &gt; 1:
</I>&gt;<i>        previousPage = startPage - 1
</I>&gt;<i>      nextPage = startPage + 1
</I>&gt;<i>    c.close()
</I>&gt;<i>    db.close()
</I>&gt;<i>      parmDict = {'title':'User List', 'rowHtml':htmlText, 
</I>&gt;<i> 'previousPage':previousPage, 'nextPage':nextPage, 'startPage':startPage}
</I>&gt;<i>      template = psp.PSP(req, filename='secUserList.html')
</I>&gt;<i>    template.run(vars = parmDict)
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> My question is;  How do I implement the session?
</I>
from mod_python import Session

   Where do I put the
&gt;<i> code?  
</I>
Most likely in your handler, (secUserList?) but it can go where ever you 
  want to access the session data. Make sure you only create one session 
object per request though. If you need to pass it around to other 
functions in a single request then stuff it into your request object.

def secUserList(req):

     # creating the session instance will either load an existing session
     # or create a new one
     req.sess = Session.Session()
     if req.sess.is_new():
         req.sess['visits'] = 0

     req.write('you have visited this page %d times' %
                  req.sess['visits'])

     doSomeOtherStuff(req)
     req.sess['visits'] += 1

     # You must save the session to make it persistent
     req.sess.save()

def doSomeOtherStuff(req):
     req.sess['stuff'] = 'wonderful'


&gt;<i> I want to be able to store my database login credentials in the 
</I>&gt;<i> session object.  I'm guessing I'm missing something really obvious, but 
</I>&gt;<i> can't seem to get my head around it.  
</I>
Don't think so hard. ;) It really is as simple as it looks.

&gt;<i> Any help or pointers to good 
</I>&gt;<i> examples would really be appreciated.
</I>
Just think of the session object as a persistent dictionary. The correct 
dictionary to load for a request is determined by a cookie which is 
automatically set for you when you create the session.

Jim
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019869.html">[mod_python] Session Management for the beginner
</A></li>
	<LI>Next message: <A HREF="019874.html">[mod_python] Session Management for the beginner
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19871">[ date ]</a>
              <a href="thread.html#19871">[ thread ]</a>
              <a href="subject.html#19871">[ subject ]</a>
              <a href="author.html#19871">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
