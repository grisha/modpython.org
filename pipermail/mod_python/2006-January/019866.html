<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Re: child process XXXX still did not exit,
	sending a SIGTERM
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Re%3A%20child%20process%20XXXX%20still%20did%20not%20exit%2C%0A%09sending%20a%20SIGTERM&In-Reply-To=096aeb5e6def26f49b3952c888cc1b0e%40dscpl.com.au">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019865.html">
   <LINK REL="Next"  HREF="019870.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Re: child process XXXX still did not exit,
	sending a SIGTERM</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Re%3A%20child%20process%20XXXX%20still%20did%20not%20exit%2C%0A%09sending%20a%20SIGTERM&In-Reply-To=096aeb5e6def26f49b3952c888cc1b0e%40dscpl.com.au"
       TITLE="[mod_python] Re: child process XXXX still did not exit,
	sending a SIGTERM">grahamd at dscpl.com.au
       </A><BR>
    <I>Wed Jan  4 06:10:10 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="019865.html">[mod_python] Re: child process XXXX still did not exit,
	sending a SIGTERM
</A></li>
        <LI>Next message: <A HREF="019870.html">[mod_python] Re: child process XXXX still did not exit,
	sending a SIGTERM
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19866">[ date ]</a>
              <a href="thread.html#19866">[ thread ]</a>
              <a href="subject.html#19866">[ subject ]</a>
              <a href="author.html#19866">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On 04/01/2006, at 9:29 PM, Graham Dumpleton wrote:
&gt;<i> My immediate question is why does Py_Finalize() even need to be called
</I>&gt;<i> within the context of the child process if it is simply being killed 
</I>&gt;<i> off
</I>&gt;<i> anyway. I know that for the Apache main process if doing a restart that
</I>&gt;<i> Py_Finalize() needs to be called as the same process is kept around,
</I>&gt;<i> but for a child process I don't see the point except maybe to flush
</I>&gt;<i> out stderr/stdout which aren't typically used in mod_python anyway.
</I>&gt;<i>
</I>&gt;<i> Time now to work out why python_finalize() needs to be called. Maybe
</I>&gt;<i> it can't simply not do anything when called in the context of the child
</I>&gt;<i> process.
</I>
That should have been &quot;can simply&quot; not &quot;can't simply&quot;.

Anyway, one could put:

     if (child_init_pool)
         return APR_SUCCESS;

at the start of python_finalize() and that would at least avoid any 
problems
with the signal handler trying to do complicated stuff like call into 
Python
and cause a deadlock.

Even with this, it isn't going to avoid all problems as you can't 
totally
eliminate the possible need for the Apache to forcibly kill the child
process. There simply could be reasons that the signal handler couldn't
run due to signals being blocked for example. For some reason I seem to
be seeing just this case in my test example on Mac OS X and I haven't 
yet
worked out why the python_finalize() function isn't being run, 
suggesting
that the signal handler isn't even being called.

Can you at least try the above little addition to python_finalize() and
see if it makes any difference in your specific case.

Graham

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019865.html">[mod_python] Re: child process XXXX still did not exit,
	sending a SIGTERM
</A></li>
	<LI>Next message: <A HREF="019870.html">[mod_python] Re: child process XXXX still did not exit,
	sending a SIGTERM
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19866">[ date ]</a>
              <a href="thread.html#19866">[ thread ]</a>
              <a href="subject.html#19866">[ subject ]</a>
              <a href="author.html#19866">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
