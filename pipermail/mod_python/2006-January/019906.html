<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Re: streaming zipped data with publisher
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Re%3A%20streaming%20zipped%20data%20with%20publisher&In-Reply-To=5f56302b0601090236lef5bbacv3ed4ca700181f9c1%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019905.html">
   <LINK REL="Next"  HREF="019907.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Re: streaming zipped data with publisher</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Mike Looijmans</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Re%3A%20streaming%20zipped%20data%20with%20publisher&In-Reply-To=5f56302b0601090236lef5bbacv3ed4ca700181f9c1%40mail.gmail.com"
       TITLE="[mod_python] Re: streaming zipped data with publisher">nlv11281 at natlab.research.philips.com
       </A><BR>
    <I>Mon Jan  9 06:01:21 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="019905.html">[mod_python] Re: streaming zipped data with publisher
</A></li>
        <LI>Next message: <A HREF="019907.html">[mod_python] Re: streaming zipped data with publisher
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19906">[ date ]</a>
              <a href="thread.html#19906">[ thread ]</a>
              <a href="subject.html#19906">[ subject ]</a>
              <a href="author.html#19906">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> As Graham pointed out, I wasn't talking about zipping everything I
</I>&gt;<i> send to the clients, only zipping a file once in a while when users
</I>&gt;<i> request an archive of a bunch of files. And, more importantly, I don't
</I>&gt;<i> want to store the zip file, but create it upon request, send it, and
</I>&gt;<i> delete it.
</I>&gt;<i> 
</I>&gt;<i> It seems this StringIO solution is best. Only I'm not sure how I
</I>&gt;<i> return the 'data' (in your example) since I'm using the publisher
</I>&gt;<i> handler. As far as I understand, perhaps I'm wrong here, the publisher
</I>&gt;<i> handler does all header stuff by itself, but in this case I need to
</I>&gt;<i> set content length, content type, etc, so how does this go with
</I>&gt;<i> publisher?
</I>
I bet you can get away with the following:

req.add_header('Content-Type', 'application/octet-stream')
myzip = zipfile.ZipFile(req,&quot;w&quot;)
##   ... build up zip
myzip.close()

(req is the request object from publisher)

ZipFile will just output the data directly to the client now. Publisher 
will (hopefully) chunk-encode it.

No temp files, and no memory hog (which StringIO might do...)

An alternative to chunked encoding (but less 'nice' since the client 
cannot determine whether the transfer was aborted or not) is to add 
&quot;Connection: Close&quot; to the headers (effectively using HTTP/1.0 protocol).

--
Mike Looijmans
Philips Natlab / Topic Automation


</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019905.html">[mod_python] Re: streaming zipped data with publisher
</A></li>
	<LI>Next message: <A HREF="019907.html">[mod_python] Re: streaming zipped data with publisher
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19906">[ date ]</a>
              <a href="thread.html#19906">[ thread ]</a>
              <a href="subject.html#19906">[ subject ]</a>
              <a href="author.html#19906">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
