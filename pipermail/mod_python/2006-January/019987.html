<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Sessions (Aaaarggghhhh!!)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Sessions%20%28Aaaarggghhhh%21%21%29&In-Reply-To=000c01c61b03%247e41c850%24f8dbebc9%40luis">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019986.html">
   <LINK REL="Next"  HREF="019988.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Sessions (Aaaarggghhhh!!)</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Jim Gallacher</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Sessions%20%28Aaaarggghhhh%21%21%29&In-Reply-To=000c01c61b03%247e41c850%24f8dbebc9%40luis"
       TITLE="[mod_python] Sessions (Aaaarggghhhh!!)">jpg at jgassociates.ca
       </A><BR>
    <I>Mon Jan 16 22:20:36 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="019986.html">[mod_python] Sessions (Aaaarggghhhh!!)
</A></li>
        <LI>Next message: <A HREF="019988.html">[mod_python] moin moin setup.py cannot be executed
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19987">[ date ]</a>
              <a href="thread.html#19987">[ thread ]</a>
              <a href="subject.html#19987">[ subject ]</a>
              <a href="author.html#19987">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Luis M. Gonzalez wrote:
&gt;<i> Hi Folks!
</I>&gt;<i> 
</I>&gt;<i> I'm needing some help with this problem...
</I>&gt;<i> I just started playing with mod_python yesterday, and after pulling my hair with installation problems and configurations,
</I>&gt;<i> I managed to get it working and I also could write some basic little apps.
</I>&gt;<i> 
</I>&gt;<i> Right now, I'm almost finished with a simple shopping cart, wich is an instance of class &quot;cart&quot; and contains, obviously, items with their prices and quantities.
</I>&gt;<i> It performs the usual actions, such add item, update quantity, etc.
</I>&gt;<i> The problem is that when I perform any of these actions, the cart is created again, and the previous information gets lost.
</I>&gt;<i> It seems that there's a problem with my session handling, but I can't figure out what's wrong...
</I>&gt;<i> 
</I>&gt;<i> This is how I create the session for my shopping cart:
</I>&gt;<i> 
</I>&gt;<i> s = Session.Session(req)
</I>&gt;<i> 
</I>&gt;<i> s = Session.Session(req)
</I>
I assume this is a copy and paste error, but if it's not... do *not* 
create 2 session objects in the same request. Session locking (which is 
on by default) will result in a deadlock.

&gt;<i> if not hasattr(s,'x'):
</I>&gt;<i>     s['x']= cart()
</I>
You can also use s.is_new() to determine if this is a new session which 
may require some sort of initialization code for your cart.

Sessions are saved as pickles, and you are likely to run into problems 
trying to save an instance of your class in the session. It's best to 
stick to simple types like strings, integers and so on (including lists 
and dicts).

&gt;<i>     s.save() 
</I>&gt;<i> 
</I>&gt;<i>  and this is the code that handles the operations:
</I>&gt;<i> 
</I>&gt;<i> if form['action']=='upqty':
</I>&gt;<i>     try:
</I>&gt;<i>         if int(form['qty'])==0:
</I>&gt;<i>             del s['x'].items[form['item']]
</I>&gt;<i>             s.save()
</I>&gt;<i>         else:
</I>&gt;<i>             s['x'].upqty(form['item'],int(form['qty']))
</I>&gt;<i>             s.save()
</I>&gt;<i>         s['x'].pp()
</I>&gt;<i>         
</I>&gt;<i>     except:
</I>&gt;<i>         print 'Bad entry. Try again...with numbers'
</I>&gt;<i> elif form['action']=='ad':
</I>&gt;<i>     try:
</I>&gt;<i>         if form['item']=='':
</I>&gt;<i>      print 'no item to add'
</I>&gt;<i>         else:
</I>&gt;<i>      s['x'].ad(form['item'],float(form['price']),int(form['qty']))
</I>&gt;<i>             s.save()
</I>&gt;<i>          s['x'].pp()
</I>&gt;<i>             
</I>&gt;<i>     except:
</I>&gt;<i>  print 'Bad entry. Try again...with numbers'
</I>&gt;<i> s.save()   
</I>

You will likely have better luck if you just save a list of your cart 
data in the session.

items = [{'item':form['item'], 'qty':form['qty']}, {.. more items ..}, ]
s['cart_items'] = items
s.save()

As an aside doing all those saves is going to kill your performance as 
each save requires pickling the data and writing it to disk (unless you 
are using MemorySession and apache mpm-threaded on windows). Just do one 
save at the end of your code block.

Jim



</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019986.html">[mod_python] Sessions (Aaaarggghhhh!!)
</A></li>
	<LI>Next message: <A HREF="019988.html">[mod_python] moin moin setup.py cannot be executed
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19987">[ date ]</a>
              <a href="thread.html#19987">[ thread ]</a>
              <a href="subject.html#19987">[ subject ]</a>
              <a href="author.html#19987">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
