<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] kid template decorator [prev: Current Working
	Directory not set?]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20kid%20template%20decorator%20%5Bprev%3A%20Current%20Working%0A%09Directory%20not%20set%3F%5D&In-Reply-To=c298f2d70601280150o3a4004b1i%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020142.html">
   <LINK REL="Next"  HREF="020152.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] kid template decorator [prev: Current Working
	Directory not set?]</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Nicolas Lehuen</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20kid%20template%20decorator%20%5Bprev%3A%20Current%20Working%0A%09Directory%20not%20set%3F%5D&In-Reply-To=c298f2d70601280150o3a4004b1i%40mail.gmail.com"
       TITLE="[mod_python] kid template decorator [prev: Current Working
	Directory not set?]">nicolas.lehuen at gmail.com
       </A><BR>
    <I>Sat Jan 28 04:50:41 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="020142.html">[mod_python] Current Working Directory not set?
</A></li>
        <LI>Next message: <A HREF="020152.html">[mod_python] kid template decorator [prev: Current Working
	Directory not set?]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20151">[ date ]</a>
              <a href="thread.html#20151">[ thread ]</a>
              <a href="subject.html#20151">[ subject ]</a>
              <a href="author.html#20151">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I'm using something similar with a custom-made templating system
(which looks a bit like Velocity).

I have used req.filename rather than __file__ to get the path of the
file requested, because the decorator function is stored in a separate
library module, which means that __file__ always return the path to
the library module and not the path to the published module.

One could also use stack inspection to get the proper path but
req.filename is quite reliable as far as the publisher is concerned.

Just a small detail : you can test whether a path is absolute or
relative thanks to os.path.isabs, so you can only provide one path
parameter and let Python decide of its relativeness.

Regards,
Nicolas

2006/1/28, Sean Jamieson &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">sean at barriescene.com</A>&gt;:
&gt;<i> OK, so here is my decorator solution:
</I>&gt;<i>
</I>&gt;<i> # @template decorator
</I>&gt;<i> def template( relpath = 'templates', template=None, abspath=None ):
</I>&gt;<i>     def decor( func ):
</I>&gt;<i>         if abspath:
</I>&gt;<i>             path = abspath
</I>&gt;<i>         else:
</I>&gt;<i>             path = os.path.join( os.path.dirname( __file__ ), relpath )
</I>&gt;<i>         if template:
</I>&gt;<i>             path = os.path.join( path, template )
</I>&gt;<i>         else:
</I>&gt;<i>             path = os.path.join( path, '%s_%s.kid' %
</I>&gt;<i> (func.__module__.split('.')[-1], func.func_name) )
</I>&gt;<i>         def template_wrapper( *args, **kwargs ):
</I>&gt;<i>             kwargs['req'].content_type = 'text/html'
</I>&gt;<i>             values = func( *args, **kwargs )
</I>&gt;<i>             return Template( file=path, **values )
</I>&gt;<i>         # just so debug output makes sense
</I>&gt;<i>         template_wrapper.func_name = '%s(%s)' % (
</I>&gt;<i> template_wrapper.func_name, func.func_name )
</I>&gt;<i>         return template_wrapper
</I>&gt;<i>     return decor
</I>&gt;<i>
</I>&gt;<i> @template()
</I>&gt;<i> def index( req ):
</I>&gt;<i>     title = 'some title'
</I>&gt;<i>     message = 'Keep it simple, stupid.'
</I>&gt;<i>     return vars()
</I>&gt;<i>
</I>&gt;<i> ... or something like that...
</I>&gt;<i>
</I>&gt;<i> Comments?
</I>&gt;<i>
</I>&gt;<i> Sean
</I>
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020142.html">[mod_python] Current Working Directory not set?
</A></li>
	<LI>Next message: <A HREF="020152.html">[mod_python] kid template decorator [prev: Current Working
	Directory not set?]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20151">[ date ]</a>
              <a href="thread.html#20151">[ thread ]</a>
              <a href="subject.html#20151">[ subject ]</a>
              <a href="author.html#20151">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
