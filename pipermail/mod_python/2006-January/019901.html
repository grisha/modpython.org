<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] streaming zipped data with publisher]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20streaming%20zipped%20data%20with%20publisher%5D&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019903.html">
   <LINK REL="Next"  HREF="019902.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] streaming zipped data with publisher]</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Mike Looijmans</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20streaming%20zipped%20data%20with%20publisher%5D&In-Reply-To="
       TITLE="[mod_python] streaming zipped data with publisher]">nlv11281 at natlab.research.philips.com
       </A><BR>
    <I>Mon Jan  9 04:51:53 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="019903.html">[mod_python] reg sql query
</A></li>
        <LI>Next message: <A HREF="019902.html">[mod_python] thank you for solving - reg sql query ( now working
	fine)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19901">[ date ]</a>
              <a href="thread.html#19901">[ thread ]</a>
              <a href="subject.html#19901">[ subject ]</a>
              <a href="author.html#19901">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Daniel Nogradi wrote:
&gt;<i> Is it possible to &quot;stream&quot; zipped data using the publisher handler?
</I>
Sure. I'm streaming multi-gigabyte TAR archives to/from tape and other
storage this way.

The ZIPfile and TARfile units are quite alike.

In my case, using a temporary file is not an option - the archives may
span multiple 400GB (no, that's not a typo) tapes.

When streaming out the data, set the 'Transfer-Encoding' header to
&quot;chunked&quot;. This is neccesary because you don't know forehand how much
data you'll be sending. Output the data in chunks, by writing the (hex)
size of the chunk, followed by \r\n and the data, followed by \r\n.

This code snippet copies data from the 'stream' to 'wfile' using chunked
  encoding:

             while 1:
                 data = stream.read()
                 if not data:
                     break
                 # chunk header is &lt;hex-size&gt;\r\n
                 l = len(data)
                 wfile.write(&quot;%x\r\n&quot; % l)
                 # output data
                 wfile.write(data)
                 # chunk footer
                 wfile.write(&quot;\r\n&quot;)
             # write chunk terminator
             wfile.write(&quot;0\r\n\r\n&quot;)

All that's left to do is grab the output from the Zipfile writer and
send it to the chunk encoder. You can probably directly replace
zipfile.write().

Mike.


-- 
Mike Looijmans
Philips Natlab / Topic Automation

</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019903.html">[mod_python] reg sql query
</A></li>
	<LI>Next message: <A HREF="019902.html">[mod_python] thank you for solving - reg sql query ( now working
	fine)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19901">[ date ]</a>
              <a href="thread.html#19901">[ thread ]</a>
              <a href="subject.html#19901">[ subject ]</a>
              <a href="author.html#19901">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
