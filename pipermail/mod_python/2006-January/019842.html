<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Re: child process XXXX still did not exit,
	sending a SIGTERM
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Re%3A%20child%20process%20XXXX%20still%20did%20not%20exit%2C%0A%09sending%20a%20SIGTERM&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019847.html">
   <LINK REL="Next"  HREF="019843.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Re: child process XXXX still did not exit,
	sending a SIGTERM</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Re%3A%20child%20process%20XXXX%20still%20did%20not%20exit%2C%0A%09sending%20a%20SIGTERM&In-Reply-To="
       TITLE="[mod_python] Re: child process XXXX still did not exit,
	sending a SIGTERM">grahamd at dscpl.com.au
       </A><BR>
    <I>Mon Jan  2 16:20:39 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="019847.html">[mod_python] Thanks for solving = for loop doubt 
</A></li>
        <LI>Next message: <A HREF="019843.html">[mod_python] Re: child process XXXX still did not exit,
	sending a SIGTERM
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19842">[ date ]</a>
              <a href="thread.html#19842">[ thread ]</a>
              <a href="subject.html#19842">[ subject ]</a>
              <a href="author.html#19842">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Instead of using &quot;apachectl restart&quot;, try using &quot;apachectl graceful&quot; to see
if that makes any difference.

You may also want to adjust GracefulShutdownTimeout for this case to
only allow a certain time for child processes to shutdown.

  <A HREF="http://httpd.apache.org/docs/2.2/mod/mpm_common.html#gracefulshutdowntimeout">http://httpd.apache.org/docs/2.2/mod/mpm_common.html#gracefulshutdowntimeout</A>

By fiddling with this, you may be able to see if given time that the child
processes do actually shutdown, or whether they actually hang. If they
hang, then you may be able to attach using gdb to the child process and
work out where it is hanging.

It may just be a case that with Python loaded it takes longer to shutdown
than Apache expects it to and so it abruptly kills it. I haven't been able
to find any directive for specifying a shutdown timeout for &quot;restart&quot; which
it waits before it kills the child processes.

Graham

Martin Blais wrote ..
&gt;<i> On 1/2/06, Martin Blais &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">blais at furius.ca</A>&gt; wrote:
</I>&gt;<i> &gt; Before someone asks, I did not get seg faults in my log, so that's not
</I>&gt;<i> &gt; the problem.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On closer inspection though, I do have a few SSL error messages like
</I>&gt;<i> these:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; [Mon Jan 02 15:07:30 2006] [info] (70014)End of file found: SSL
</I>&gt;<i> &gt; handshake interrupted by system [Hint: Stop button pressed in
</I>&gt;<i> &gt; browser?!]
</I>&gt;<i> &gt; [Mon Jan 02 15:07:30 2006] [info] Connection to child 0 closed with
</I>&gt;<i> &gt; abortive shutdown(server furius.dyndns.biz:443, client 127.0.0.1)
</I>&gt;<i> &gt; [Mon Jan 02 15:07:31 2006] [info] Connection to child 9 established
</I>&gt;<i> &gt; (server furius.dyndns.biz:443, client 127.0.0.1)
</I>&gt;<i> &gt; [Mon Jan 02 15:07:31 2006] [info] Seeding PRNG with 136 bytes of entropy
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ... the number of which does not match the number of zombie children
</I>&gt;<i> &gt; (does not mean that it's not the problem though).
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Any information/tips welcome.
</I>&gt;<i> 
</I>&gt;<i> It's not the SSL errors, I just reproduced the zombie child error
</I>&gt;<i> without getting the SSL errors (it's my automated test code that
</I>&gt;<i> somehow creates the SSL problems, fiddling a lot with the browser does
</I>&gt;<i> not cause SSL errors, but will result in children not wanting to die).
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On 1/2/06, Martin Blais &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">blais at furius.ca</A>&gt; wrote:
</I>&gt;<i> &gt; &gt; Hi
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; I'm getting messages like this in my apache2 log when I stop it after
</I>&gt;<i> &gt; &gt; running requests to a mod_python-based web app:
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; ==&gt; /var/log/apache2/error_log &lt;==
</I>&gt;<i> &gt; &gt; [Mon Jan 02 13:04:12 2006] [warn] child process 21806 still did not
</I>&gt;<i> &gt; &gt; exit, sending a SIGTERM
</I>&gt;<i> &gt; &gt; [Mon Jan 02 13:04:12 2006] [warn] child process 21768 still did not
</I>&gt;<i> &gt; &gt; exit, sending a SIGTERM
</I>&gt;<i> &gt; &gt; [Mon Jan 02 13:04:12 2006] [warn] child process 21792 still did not
</I>&gt;<i> &gt; &gt; exit, sending a SIGTERM
</I>&gt;<i> &gt; &gt; [Mon Jan 02 13:04:14 2006] [warn] child process 21806 still did not
</I>&gt;<i> &gt; &gt; exit, sending a SIGTERM
</I>&gt;<i> &gt; &gt; [Mon Jan 02 13:04:14 2006] [warn] child process 21768 still did not
</I>&gt;<i> &gt; &gt; exit, sending a SIGTERM
</I>&gt;<i> &gt; &gt; [Mon Jan 02 13:04:14 2006] [warn] child process 21792 still did not
</I>&gt;<i> &gt; &gt; exit, sending a SIGTERM
</I>&gt;<i> &gt; &gt; [Mon Jan 02 13:04:16 2006] [warn] child process 21806 still did not
</I>&gt;<i> &gt; &gt; exit, sending a SIGTERM
</I>&gt;<i> &gt; &gt; [Mon Jan 02 13:04:16 2006] [warn] child process 21768 still did not
</I>&gt;<i> &gt; &gt; exit, sending a SIGTERM
</I>&gt;<i> &gt; &gt; [Mon Jan 02 13:04:16 2006] [warn] child process 21792 still did not
</I>&gt;<i> &gt; &gt; exit, sending a SIGTERM
</I>&gt;<i> &gt; &gt; [Mon Jan 02 13:04:18 2006] [error] child process 21806 still did not
</I>&gt;<i> &gt; &gt; exit, sending a SIGKILL
</I>&gt;<i> &gt; &gt; [Mon Jan 02 13:04:18 2006] [error] child process 21768 still did not
</I>&gt;<i> &gt; &gt; exit, sending a SIGKILL
</I>&gt;<i> &gt; &gt; [Mon Jan 02 13:04:18 2006] [error] child process 21792 still did not
</I>&gt;<i> &gt; &gt; exit, sending a SIGKILL
</I>&gt;<i> &gt; &gt; [Mon Jan 02 13:04:19 2006] [info] removed PID file
</I>&gt;<i> &gt; &gt; /var/run/apache2.pid (pid=21754)
</I>&gt;<i> &gt; &gt; [Mon Jan 02 13:04:19 2006] [notice] caught SIGTERM, shutting down
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; I've been tracking the problem, and on exit, the cleanup function (in
</I>&gt;<i> &gt; &gt; Python) that I registered with the mod_python server does get called,
</I>&gt;<i> &gt; &gt; and exits.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; I saw somewhere that recompiling expat, and then all the rest (in my
</I>&gt;<i> &gt; &gt; case, python-2.4.2, apache2, mod_python-3.1.4, psycopg2) might fix
</I>&gt;<i> the
</I>&gt;<i> &gt; &gt; issue (it would be due to a library incompatibility).  I did this,
</I>&gt;<i> and
</I>&gt;<i> &gt; &gt; the problem still occurs.  I also tried using mod_python-3.2.5b and
</I>&gt;<i> &gt; &gt; the problem persists.  This is all running on Linux (Gentoo).
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Any clue on how to debug this issue further?  I'm currently trying
</I>&gt;<i> to
</I>&gt;<i> &gt; &gt; run gdb on a non-daemon apache2, or trying to attach to a running
</I>&gt;<i> &gt; &gt; child.  The problem is a bit tricky to fix, since it does not happen
</I>&gt;<i> &gt; &gt; always -- but always happens at least after I run a lot of requests
</I>&gt;<i> &gt; &gt; e.g. my automated test suite for my web app.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Any hints would be appreciated.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; cheers,
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I></PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019847.html">[mod_python] Thanks for solving = for loop doubt 
</A></li>
	<LI>Next message: <A HREF="019843.html">[mod_python] Re: child process XXXX still did not exit,
	sending a SIGTERM
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19842">[ date ]</a>
              <a href="thread.html#19842">[ thread ]</a>
              <a href="subject.html#19842">[ subject ]</a>
              <a href="author.html#19842">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
