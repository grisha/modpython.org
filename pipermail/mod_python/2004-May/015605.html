<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Creating a thread-safe handler
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Creating%20a%20thread-safe%20handler&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015604.html">
   <LINK REL="Next"  HREF="015606.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Creating a thread-safe handler</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Geert Jansen</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Creating%20a%20thread-safe%20handler&In-Reply-To="
       TITLE="[mod_python] Creating a thread-safe handler">geert at boskant.nl
       </A><BR>
    <I>Sat May 15 13:16:46 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="015604.html">[mod_python] Protecting Web apps from to many simultaneous
	clicks/Hacking
</A></li>
        <LI>Next message: <A HREF="015606.html">[mod_python] Re: Creating a thread-safe handler
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15605">[ date ]</a>
              <a href="thread.html#15605">[ thread ]</a>
              <a href="subject.html#15605">[ subject ]</a>
              <a href="author.html#15605">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I am trying to make my mod_python application thread safe so it can be
run on Windows. Not everything is completely clear to me yet, so
hopefully someone can help me out.

Python threads run in the same sub-interpreter, so you need some kind of
synchronization when handling global objects. A threading.Lock can help
here. However, how can such a lock be safely created? The lock itself
must be a global object as well.

For example:

def my_handler(req):
    global lock
    try:
        lock.acquire()
    except NameError:
        lock = Lock()   # XXX: not thread safe!
        lock.acquire()  # Lock could be created by another thread
   # do thread-unsafe stuff here
   lock.unlock()

A solution seems to be to use PythonImport to pre-import the handler
module. Because that's run when a child is started, I assume no threads
have been created yet and a global Lock can be safely set up. But this
seems a hack. Any ideas?

Thanks,
Geert Jansen

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015604.html">[mod_python] Protecting Web apps from to many simultaneous
	clicks/Hacking
</A></li>
	<LI>Next message: <A HREF="015606.html">[mod_python] Re: Creating a thread-safe handler
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15605">[ date ]</a>
              <a href="thread.html#15605">[ thread ]</a>
              <a href="subject.html#15605">[ subject ]</a>
              <a href="author.html#15605">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
