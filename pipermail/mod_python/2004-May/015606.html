<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Re: Creating a thread-safe handler
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Re%3A%20Creating%20a%20thread-safe%20handler&In-Reply-To=000001c43a65%24ba6eada0%246406a8c0%40greetop">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015605.html">
   <LINK REL="Next"  HREF="015609.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Re: Creating a thread-safe handler</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Stian S&#248;iland</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Re%3A%20Creating%20a%20thread-safe%20handler&In-Reply-To=000001c43a65%24ba6eada0%246406a8c0%40greetop"
       TITLE="[mod_python] Re: Creating a thread-safe handler">stian at soiland.no
       </A><BR>
    <I>Sat May 15 15:29:24 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="015605.html">[mod_python] Creating a thread-safe handler
</A></li>
        <LI>Next message: <A HREF="015609.html">[mod_python] PSP strcache error
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15606">[ date ]</a>
              <a href="thread.html#15606">[ thread ]</a>
              <a href="subject.html#15606">[ subject ]</a>
              <a href="author.html#15606">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2004-05-15 12:16:46, Geert Jansen wrote:

&gt;<i> def my_handler(req):
</I>&gt;<i>     global lock
</I>&gt;<i>     try:
</I>&gt;<i>         lock.acquire()
</I>&gt;<i>     except NameError:
</I>&gt;<i>         lock = Lock()   # XXX: not thread safe!
</I>&gt;<i>         lock.acquire()  # Lock could be created by another thread
</I>&gt;<i>    # do thread-unsafe stuff here
</I>&gt;<i>    lock.unlock()
</I>
A module import is threadsafe[1], so the simple thing to do is:

lock = Lock()
def my_handler(req):
    lock.acquire()
    ...
    lock.unlock()
     

     
.. [1] <A HREF="http://www.python.org/doc/current/lib/module-imp.html">http://www.python.org/doc/current/lib/module-imp.html</A>

    lock_held(  )   
    
    Return True if the import lock is currently held, else False. On platforms
    without threads, always return False. 

    On platforms with threads, a thread executing an import holds an internal
    lock until the import is complete. This lock blocks other threads
    from doing an import until the original import completes, which in
    turn prevents other threads from seeing incomplete module objects
    constructed by the original thread while in the process of
    completing its import (and the imports, if any, triggered by that).     

-- 
Stian S&#248;iland               Work toward win-win situation. Win-lose
Trondheim, Norway           is where you win and the other lose.
<A HREF="http://www.soiland.no/">http://www.soiland.no/</A>      Lose-lose and lose-win are left as an
                            exercise to the reader.  [Limoncelli/Hogan]
                            Og dette er en ekstra linje 

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015605.html">[mod_python] Creating a thread-safe handler
</A></li>
	<LI>Next message: <A HREF="015609.html">[mod_python] PSP strcache error
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15606">[ date ]</a>
              <a href="thread.html#15606">[ thread ]</a>
              <a href="subject.html#15606">[ subject ]</a>
              <a href="author.html#15606">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
