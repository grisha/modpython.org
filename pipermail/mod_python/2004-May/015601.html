<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Protecting Web apps from to many simultaneous
	clicks/Hacking
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Protecting%20Web%20apps%20from%20to%20many%20simultaneous%0A%09clicks/Hacking&In-Reply-To=1084502387.26128.59.camel%40ping.apnic.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015620.html">
   <LINK REL="Next"  HREF="015602.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Protecting Web apps from to many simultaneous
	clicks/Hacking</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Gregory (Grisha) Trubetskoy</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Protecting%20Web%20apps%20from%20to%20many%20simultaneous%0A%09clicks/Hacking&In-Reply-To=1084502387.26128.59.camel%40ping.apnic.net"
       TITLE="[mod_python] Protecting Web apps from to many simultaneous
	clicks/Hacking">grisha at modpython.org
       </A><BR>
    <I>Fri May 14 10:56:33 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="015620.html">[mod_python] Protecting Web apps from to many simultaneous
	clicks/Hacking
</A></li>
        <LI>Next message: <A HREF="015602.html">[mod_python] Protecting Web apps from to many simultaneous
	clicks/Hacking
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15601">[ date ]</a>
              <a href="thread.html#15601">[ thread ]</a>
              <a href="subject.html#15601">[ subject ]</a>
              <a href="author.html#15601">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

On Fri, 14 May 2004, Byron Ellacott wrote:

&gt;<i> &gt; 1	sess=Session.Session(req, None, cookieSecret)
</I>&gt;<i> &gt; 2	if not sess.has_key('REQUESTS'):
</I>&gt;<i> &gt; 3		sess['REQUESTS']=1
</I>&gt;<i> &gt; 4		sess.save()
</I>&gt;<i> &gt; 5	else:
</I>&gt;<i> &gt; 6		sess['REQUESTS']+=1
</I>&gt;<i> &gt; 7		sess.save()
</I>&gt;<i> &gt; 8		while sess['REQUESTS']&gt;1:
</I>&gt;<i> &gt; 9			sleep(1)
</I>&gt;<i> &gt; 10	sess['REQUESTS']-=1
</I>&gt;<i> &gt; 11	sess.save()
</I>&gt;<i>
</I>&gt;<i> I've added line numbers to help the discussion.  So, you create a
</I>&gt;<i> session object at line 1.  This is when the locking should already have
</I>&gt;<i> occurred.  In lines 2-4, you introduce a race condition: if a second
</I>&gt;<i> process preempts your request after line 2, but before line 4, that
</I>&gt;<i> process will also get False from sess.has_key('REQUESTS').  This means
</I>&gt;<i> two separate processes will reach line 3 thinking they have exclusive
</I>&gt;<i> access to the session.  A similar race condition exists between lines 6
</I>&gt;<i> and 7.
</I>
With session locking on (which would be true in the code above), once one
process reaches 2, no other process will be able to get past 1 until the
first request is over. So there is no race condition, unless I'm missing
something.

Also, since it isn't obvious, sess.save() does not release the lock. The
lock can be released explicitely with unlock(), or it would be released
for you in the request cleanup phase.

Grisha
</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015620.html">[mod_python] Protecting Web apps from to many simultaneous
	clicks/Hacking
</A></li>
	<LI>Next message: <A HREF="015602.html">[mod_python] Protecting Web apps from to many simultaneous
	clicks/Hacking
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15601">[ date ]</a>
              <a href="thread.html#15601">[ thread ]</a>
              <a href="subject.html#15601">[ subject ]</a>
              <a href="author.html#15601">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
