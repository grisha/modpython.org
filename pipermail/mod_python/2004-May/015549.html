<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] upload file?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20upload%20file%3F&In-Reply-To=20040507133528.GK17838%40mki-btc.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015534.html">
   <LINK REL="Next"  HREF="015536.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] upload file?</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>John Mudd</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20upload%20file%3F&In-Reply-To=20040507133528.GK17838%40mki-btc.com"
       TITLE="[mod_python] upload file?">JohnMudd at mindspring.com
       </A><BR>
    <I>Sat May  8 18:04:42 EST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="015534.html">[mod_python] upload file?
</A></li>
        <LI>Next message: <A HREF="015536.html">[mod_python] upload file?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15549">[ date ]</a>
              <a href="thread.html#15549">[ thread ]</a>
              <a href="subject.html#15549">[ subject ]</a>
              <a href="author.html#15549">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Yep, this works great.  Just what I was looking for!  But, just as soon
as I got it working, I started changing it.  

I noticed that if I don't specify an &quot;action=&quot; term for the Form that
the response comes right back to the index() function.  I actually like
that for two reason.  First it lets me use one set of exception handling
code for my entire application.  I don't have to wrap multiple
functions.  Second it means the code to return the next web page only
has to be called from one place whether a form is being processed or
not.  Anyway, I'm pretty happy with the result.  I especially like how
my code has been simplified while adding the ability to upload files.  

The only thing I lost was the ability to use cgitb.  Now it reports the
location where I call the cgitb method.  Oh, well.

I'm not sure if that will make sense.  Here's what my sample app looks
like now for what it's worth.

John


P.S.  If life was fair I'd be sending you a pile of cash now.  You
solved my problem while other people were telling me to visit the local
library. Well, maybe just this once, life can be almost fair.  Where can
I send the money?  PayPal?





httpd.conf
------------------------------------------------------------
&lt;Directory /home/mudd/pkgs/Apache2/htdocs/javaSignAuto&gt;
    SetHandler mod_python
    PythonHandler mod_python.publisher
    PythonDebug On
&lt;/Directory&gt;
-------------------------------------------------------------



index.py
----------------------------------------------------------
import sys, os, time, string
from mod_python   import util
import HTMLgen as H

def dbg(msg):
  log = open('/tmp/jsa.log', 'a')
  log.write(msg + '\n')
  log.close()

def index(req):
  try:
    dbg('-'*80)

    if req.args:
      dbg('util.parse_qsl(req.args)=%s' % `util.parse_qsl(req.args)`)

    # Did the user just respond to a form?
    if req.form.has_key('upload'):
      value = req.form['inputJar']
      dbg('value.name=%s' % `value.name`)
      dbg('value.filename=%s' % `value.filename`)
      dbg('len(value.value)=%s' % `len(value.value)`)

    # Build a new page.
    doc = H.SeriesDocument(None, title='Products')
    submit = H.Input(type='submit', name = 'upload', value='AddProduct')
    f = H.Form(submit=submit, enctype='multipart/form-data')
    i = H.Input(name='inputJar', type='file')
    f.append(i, H.BR())
    doc.append(f)

    return str(doc)
  except:
    # Rollback transactions, etc.
    pass
----------------------------------------------------------





Generated HTML (just for reference, normally I just use the HTML, not
read it)
-------------------------------------------------------------------------
&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 3.2//EN&quot;&gt;
&lt;html&gt;

&lt;!-- This file generated using Python HTMLgen module. --&gt;
&lt;head&gt;
  &lt;meta NAME=&quot;GENERATOR&quot; CONTENT=&quot;HTMLgen 2.2.2&quot;&gt;
        &lt;title&gt;Products&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;img src=&quot;/image/banner.gif&quot; height=&quot;30&quot; width=&quot;472&quot; alt=&quot;banner.gif&quot; border=&quot;0&quot;&gt;&lt;br&gt;
&lt;span style=&quot;width: 60px&quot;&gt;&lt;/span&gt; 
&lt;img src=&quot;../image/blank.gif&quot; height=&quot;19&quot; width=&quot;71&quot; alt=&quot;blank.gif&quot;&gt; 
&lt;img src=&quot;../image/blank.gif&quot; height=&quot;19&quot; width=&quot;71&quot; alt=&quot;blank.gif&quot;&gt; 
&lt;img src=&quot;../image/blank.gif&quot; height=&quot;19&quot; width=&quot;71&quot; alt=&quot;blank.gif&quot;&gt; 
&lt;h3&gt;Products&lt;/h3&gt;
&lt;hr&gt;


&lt;form METHOD=&quot;POST&quot; ENCTYPE=&quot;multipart/form-data&quot;&gt;

&lt;input TYPE=&quot;file&quot; NAME=&quot;inputJar&quot;&gt;&lt;br&gt;
&lt;input TYPE=&quot;submit&quot; NAME=&quot;upload&quot; VALUE=&quot;Add Product&quot;&gt;
&lt;/form&gt;


&lt;p&gt;&lt;hr&gt;
&lt;span style=&quot;width: 60px&quot;&gt;&lt;/span&gt; 
&lt;img src=&quot;../image/blank.gif&quot; height=&quot;19&quot; width=&quot;71&quot; alt=&quot;blank.gif&quot;&gt; 
&lt;img src=&quot;../image/blank.gif&quot; height=&quot;19&quot; width=&quot;71&quot; alt=&quot;blank.gif&quot;&gt; 
&lt;img src=&quot;../image/blank.gif&quot; height=&quot;19&quot; width=&quot;71&quot; alt=&quot;blank.gif&quot;&gt; 
&lt;br&gt;&lt;img src=&quot;/image/logo.gif&quot; height=&quot;35&quot; width=&quot;36&quot; alt=&quot;logo.gif&quot; align=&quot;bottom&quot;&gt;
&lt;font SIZE=&quot;-1&quot;&gt;&lt;p&gt;Copyright &amp;#169 Micky Mouse&lt;br&gt;All Rights Reserved&lt;br&gt;

Comments to author: &lt;a HREF=&quot;mailto:&amp;#109;i&amp;#99;k&amp;#121;@&amp;#100;i&amp;#115;n&amp;#101;y&amp;#46;c&amp;#111;m&quot;&gt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">micky at disney.com</A>&lt;/a&gt;&lt;br&gt;
Generated: Sat May 8, 2004 &lt;br&gt;&lt;hr&gt;
&lt;/font&gt;
&lt;/body&gt; &lt;/html&gt;
---------------------------------------------------------------------------


On Fri, 2004-05-07 at 09:35, Volodya wrote:
&gt;<i> On Fri, May 07, 2004 at 08:14:02AM -0400, John Mudd wrote:
</I>&gt;<i> &gt; I'm still trying to upload a file.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; I reduced my mod_python code to a small example and attached it.  It
</I>&gt;<i> &gt; uses HTMLgen to generate the HTML.  I've listed the HTML and the trace
</I>&gt;<i> &gt; output below.  The name of the file I'm trying to upload is
</I>&gt;<i> &gt; 'zopeIntro.txt'.  I'm using Apache/2.0.49 (Unix) mod_python/3.1.3
</I>&gt;<i> &gt; Python/2.3.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; I'm hoping this will make whatever mistake I'm making easier to see. 
</I>&gt;<i> &gt; Any suggestions?
</I>&gt;<i> &gt; 
</I>&gt;<i> 
</I>&gt;<i> Here is simple example of working file uploads (using publisher
</I>&gt;<i> handler).
</I>&gt;<i> 
</I>&gt;<i> Tested on FreeBSD 4.9 (i've also tested similar code on win32 several weeks ago):
</I>&gt;<i>   Apache 2.0.48,
</I>&gt;<i>   mod_python 3.1.3 (+ mentioned patch by David Fraser),
</I>&gt;<i>   Python 2.3.3
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> = 8&lt; ======== .htaccess =========================
</I>&gt;<i> SetHandler mod_python
</I>&gt;<i> PythonHandler mod_python.publisher
</I>&gt;<i> PythonDebug On
</I>&gt;<i> = &gt;8 ============================================
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> = 8&lt; ======== index.py ==========================
</I>&gt;<i> html = &quot;&quot;&quot;
</I>&gt;<i> &lt;html&gt;&lt;body&gt;
</I>&gt;<i> &lt;form action=&quot;upload&quot; method=&quot;POST&quot; enctype=&quot;multipart/form-data&quot;&gt;
</I>&gt;<i>   &lt;input type=&quot;file&quot; name=&quot;fileupload&quot;/&gt;
</I>&gt;<i>   &lt;input type=&quot;submit&quot; value=&quot;Upload!&quot;&gt;
</I>&gt;<i> &lt;/form&gt;
</I>&gt;<i> &lt;/body&gt;&lt;/html&gt;
</I>&gt;<i> &quot;&quot;&quot;
</I>&gt;<i> 
</I>&gt;<i> def index(req):
</I>&gt;<i>     return html
</I>&gt;<i> 
</I>&gt;<i> def upload(req):
</I>&gt;<i>     fp = req.form['fileupload'].file
</I>&gt;<i>     return type(fp)
</I>&gt;<i>     
</I>&gt;<i> = &gt;8 ============================================
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Output:
</I>&gt;<i> 
</I>&gt;<i> &lt;type 'file'&gt;
</I>&gt;<i> 
</I>&gt;<i> Hope this help.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>
</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015534.html">[mod_python] upload file?
</A></li>
	<LI>Next message: <A HREF="015536.html">[mod_python] upload file?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15549">[ date ]</a>
              <a href="thread.html#15549">[ thread ]</a>
              <a href="subject.html#15549">[ subject ]</a>
              <a href="author.html#15549">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
