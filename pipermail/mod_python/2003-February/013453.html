<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] CGI handler and multithreading: Can i have multiplesys.stdout objects?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20CGI%20handler%20and%20multithreading%3A%20Can%20i%20have%20multiplesys.stdout%20objects%3F&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013452.html">
   <LINK REL="Next"  HREF="013454.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] CGI handler and multithreading: Can i have multiplesys.stdout objects?</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Mike Looijmans</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20CGI%20handler%20and%20multithreading%3A%20Can%20i%20have%20multiplesys.stdout%20objects%3F&In-Reply-To="
       TITLE="[mod_python] CGI handler and multithreading: Can i have multiplesys.stdout objects?">mike.looijmans at asml.com
       </A><BR>
    <I>Fri Feb 28 08:38:54 EST 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="013452.html">[mod_python] CGI handler and multithreading: Can i have multiple
 sys.stdout objects?
</A></li>
        <LI>Next message: <A HREF="013454.html">[mod_python] CGI handler and multithreading: Can i have multiplesys.stdout objects?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13453">[ date ]</a>
              <a href="thread.html#13453">[ thread ]</a>
              <a href="subject.html#13453">[ subject ]</a>
              <a href="author.html#13453">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i>Your best bet is the prefork MPM. Remember that the 10M per child is
</I>&gt;<i>actually a lot less because pages for executables are shared between
</I>&gt;<i>processes on (most) UNIXes, certainly on Solaris they are. I find it hard
</I>&gt;<i>to believe that it is slower than regular CGI - it should be at least
</I>&gt;<i>several times faster, though not nearly as efficient as using the
</I>&gt;<i>publisher or a native handler.
</I>

The trouble with performance is in our clients' access patterns. Basically, at
8:00 the whole world comes falling dowon on the machine and everybody wants to
use it, accessing it many times each second. The rest of the day it's rather
quiet. What appears to happen is that the apache child processes get their
data segments swapped out during the quiet day to make room for other stuff
that is running on the same machine. Then in the morning, that must all be
swapped back and the first requests are incredibly slow. I noticed that the
'startup' effect almost vanished when i migrated from apache 1.3 to 2.0
(worker mpm). I think that's because the worker system can keep 20 child
threads ready for action whereas the preforked processes tend to fall into
coma. Also, the CGI scripts are run in a separate process by the server, which
seems to reduce the overhead compared to the prefork way of starting the CGI.
Apache 2.0 with prefork behaved similar to that.

&gt;<i>The ultimate solution is not use CGI of course :-)
</I>

That is the intention, ultimately...

I think I have to dive into the code and start working. Probably, the best way
for me to set things up is to modify all the scripts to write to a &quot;file like&quot;
object and get their data from a FieldStorage instance. So they'd all have a
'main' like:

handlercode(output, form, database):
    ....
    output.write('&lt;P&gt;Hello world&lt;/P&gt;')
    ....

And then call it from either a CGI wrapper:

    module = __import__(scriptname)
    module.handlercode(sys.stdout, cgi.FieldStorage(), db_connect())


Or cal it from a mod python handler:

    module = __import__(scriptname)
    module.handlercode(req, utils.FieldStorage(), recycle_db_connection())


And weed out all the CGI environment calls (e.g. SERVER_NAME) and replace them
with some object to handle that transparently too.



</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013452.html">[mod_python] CGI handler and multithreading: Can i have multiple
 sys.stdout objects?
</A></li>
	<LI>Next message: <A HREF="013454.html">[mod_python] CGI handler and multithreading: Can i have multiplesys.stdout objects?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13453">[ date ]</a>
              <a href="thread.html#13453">[ thread ]</a>
              <a href="subject.html#13453">[ subject ]</a>
              <a href="author.html#13453">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
