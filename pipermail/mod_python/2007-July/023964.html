<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] mod_python 3.3.1 memory leak?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20mod_python%203.3.1%20memory%20leak%3F&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023990.html">
   <LINK REL="Next"  HREF="023966.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] mod_python 3.3.1 memory leak?</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>yubing</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20mod_python%203.3.1%20memory%20leak%3F&In-Reply-To="
       TITLE="[mod_python] mod_python 3.3.1 memory leak?">trueice at gmail.com
       </A><BR>
    <I>Tue Jul  3 02:03:21 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="023990.html">[mod_python] streaming tar and/or zip files?
</A></li>
        <LI>Next message: <A HREF="023966.html">[mod_python] Re: mod_python 3.3.1 memory leak?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23964">[ date ]</a>
              <a href="thread.html#23964">[ thread ]</a>
              <a href="subject.html#23964">[ subject ]</a>
              <a href="author.html#23964">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Our project has a live HTTP video streamer written in python, which keeps
pumping a stream out to the client.
The HTTP serving module is a simple mod_python request handler running on
Apache 2.2.4 with mod_python 3.3.1 (Python 2.5.1).
The stream is read out of our streaming server via TCP socket, and the
python script just do some simple processing like header building, each
allocated buffer is del-ed after being used.

The problem is:
We observed that after its running serveral hours, its memory occupation
grows up to serveral hundreds of megabytes and keeps growing in 4k-8k
increment every 1-2 seconds.

Below is a simple testing scriptlet, the memory leaking issue is not so
serious as our live serving module, but you can still observe 4k memory
growing every serveral seconds.

Could anyone help me to figure out the root cause of this issue?

--------------------------
import time

def pump_file(req):
    while(True):
        fp = open(&quot;/dev/zero&quot;, &quot;r&quot;)
        buf = fp.read(4096)
        try:
            req.write(buf)
            del buf
            time.sleep(0.1)
        except:
            fp.close()
            break

---------------------------------------


-- 
truly yours
ice
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070703/b4d482ad/attachment.html">http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070703/b4d482ad/attachment.html</A>
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023990.html">[mod_python] streaming tar and/or zip files?
</A></li>
	<LI>Next message: <A HREF="023966.html">[mod_python] Re: mod_python 3.3.1 memory leak?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23964">[ date ]</a>
              <a href="thread.html#23964">[ thread ]</a>
              <a href="subject.html#23964">[ subject ]</a>
              <a href="author.html#23964">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
