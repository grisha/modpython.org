<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] streaming tar and/or zip files?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20streaming%20tar%20and/or%20zip%20files%3F&In-Reply-To=4689DFD7.60902%40natlab.research.philips.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023963.html">
   <LINK REL="Next"  HREF="023990.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] streaming tar and/or zip files?</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Matthew Dennis</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20streaming%20tar%20and/or%20zip%20files%3F&In-Reply-To=4689DFD7.60902%40natlab.research.philips.com"
       TITLE="[mod_python] streaming tar and/or zip files?">mdennis at merfer.net
       </A><BR>
    <I>Thu Jul  5 15:59:03 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="023963.html">[mod_python] streaming tar and/or zip files?
</A></li>
        <LI>Next message: <A HREF="023990.html">[mod_python] streaming tar and/or zip files?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23988">[ date ]</a>
              <a href="thread.html#23988">[ thread ]</a>
              <a href="subject.html#23988">[ subject ]</a>
              <a href="author.html#23988">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Can you please give an example because I don't see a way to do it from
looking at the docs.  It looks like there are only two methods for getting
data into the stream: add() or addfile() and both require the data being
sent to be in actual files, neither appear to let me stream data to them.  I
can't use add() because it expects the name of an actual file to add.  I
can't use addfile() because the fileobj that is passed in requires
TarInfo.size to be set to the number of bytes to be read and even if that
wasn't the case, it tries to make calls using the name of the file (which
again doesn't exist).


On 7/3/07, Mike Looijmans &lt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">nlv11281 at natlab.research.philips.com</A>&gt; wrote:
&gt;<i>
</I>&gt;<i> The &quot;tarfile&quot; built-in Python module can do as you ask, and also do
</I>&gt;<i> compression (gzip or bzip2). ZIP
</I>&gt;<i> cannot be &quot;streamed&quot;, it has a sort of directory table inside to which it
</I>&gt;<i> jumps up and down.
</I>&gt;<i>
</I>&gt;<i> You can just open a tarfile object with the req object as file output.
</I>&gt;<i>
</I>&gt;<i> Setting content-type to &quot;application/x-tar&quot; or something similar will help
</I>&gt;<i> your client figuring out
</I>&gt;<i> what to do with the file.
</I>&gt;<i>
</I>&gt;<i> I've used the tarfile module with archives over 800GB in size, without
</I>&gt;<i> problems.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Mike Looijmans
</I>&gt;<i> Philips Natlab / Topic Automation
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Matthew Dennis wrote:
</I>&gt;<i> &gt; This may not be the appropriate list, my apologies if that is indeed the
</I>&gt;<i>
</I>&gt;<i> &gt; case...
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I need to push from mod_python a file archive of sorts.  Any of tar,
</I>&gt;<i> &gt; tar.gz or zip will work (I'm also open to other suggestions).  The
</I>&gt;<i> &gt; requirement is that I can package several other &quot;files&quot; into it,
</I>&gt;<i> &gt; compressed or not.  I have no disk to write to and finite memory to deal
</I>&gt;<i> &gt; with but the &quot;files&quot; I'm outputting are quite large (much larger than
</I>&gt;<i> &gt; can fit in memory), thus I need to stream them directly out.  The reason
</I>&gt;<i>
</I>&gt;<i> &gt; I put &quot;files&quot; in quotes is because they are not really files, but
</I>&gt;<i> &gt; dynamic content that is generated on the fly.  ZipOutputStream from Java
</I>&gt;<i> &gt; is a example of what I'm talking about if anyone is familiar with it, as
</I>&gt;<i>
</I>&gt;<i> &gt; are other such streams.  I don't know the size of the content until
</I>&gt;<i> &gt; after it is all generated so there is no way to populate a TarInfo
</I>&gt;<i> &gt; object with the size et cetera and make my dynamic content look like a
</I>&gt;<i> &gt; file (which it doesn't seem I can do anyway as gettarinfo() tries to
</I>&gt;<i> &gt; call .fileno() which doesn't exist on any file like object I would
</I>&gt;<i> create).
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; In other words, something like:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; output = TarFileStream(someFileObj)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; output.addEntry(&quot;file_1.txt&quot;)
</I>&gt;<i> &gt; out.write( /*some dynamically generated content */ )
</I>&gt;<i> &gt; out.write( /*some dynamically generated content */ )
</I>&gt;<i> &gt; out.write( /*some dynamically generated content */ )
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; output.addEntry(&quot;file_2.txt&quot;)
</I>&gt;<i> &gt; out.write( /*some dynamically generated content */ )
</I>&gt;<i> &gt; out.write( /*some dynamically generated content */ )
</I>&gt;<i> &gt; out.write( /*some dynamically generated content */ )
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ...
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; output.addEntry(&quot;file_N.txt&quot;)
</I>&gt;<i> &gt; out.write( /*some dynamically generated content */ )
</I>&gt;<i> &gt; out.write( /*some dynamically generated content */ )
</I>&gt;<i> &gt; out.write( /*some dynamically generated content */ )
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; output.close()
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ------------------------------------------------------------------------
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; Mod_python mailing list
</I>&gt;<i> &gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> &gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070705/3bb3cbc5/attachment.html">http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070705/3bb3cbc5/attachment.html</A>
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023963.html">[mod_python] streaming tar and/or zip files?
</A></li>
	<LI>Next message: <A HREF="023990.html">[mod_python] streaming tar and/or zip files?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23988">[ date ]</a>
              <a href="thread.html#23988">[ thread ]</a>
              <a href="subject.html#23988">[ subject ]</a>
              <a href="author.html#23988">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
