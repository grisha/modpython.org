<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] PythonAuthenHandler issues
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20PythonAuthenHandler%20issues&In-Reply-To=46A3E436.708%40sankatygroup.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024054.html">
   <LINK REL="Next"  HREF="024056.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] PythonAuthenHandler issues</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20PythonAuthenHandler%20issues&In-Reply-To=46A3E436.708%40sankatygroup.com"
       TITLE="[mod_python] PythonAuthenHandler issues">graham.dumpleton at gmail.com
       </A><BR>
    <I>Sun Jul 22 20:30:12 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="024054.html">[mod_python] PythonAuthenHandler issues
</A></li>
        <LI>Next message: <A HREF="024056.html">[mod_python] PythonAuthenHandler issues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24055">[ date ]</a>
              <a href="thread.html#24055">[ thread ]</a>
              <a href="subject.html#24055">[ subject ]</a>
              <a href="author.html#24055">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The reason it doesn't work is technically because the
authentication/authorisation phases have been pushed into a single
authentication handler when it should be split between a separate
authentication and authorisation handlers.

To be more specific, the authentication handler should only do
something if req.auth_type() returns the type of authentication type
it is meant to handle, it should then only be checking that the
login/password is correct and if it is setting req.user to be the
username and setting req.ap_auth_type to the authentication type
scheme. The latter can usually just be set to the value returned from
calling req.auth_type(). Setting req.user and req.ap_auth_type is
technically required to indicate to latter phases that authentication
was successful.

A separate authorisation handler should then process req.requires()
but if it doesn't find any requires values pertinent to it, it should
return apache.DECLINED. By returning apache.DECLINED it allows the
builting authorisation handler to still run and honour vaue such as
'valid-user'.

In short, it fails because you aren't supplying a authorisation
handler and as a result it is still running the default authorisation
handler which fails because there is no group file for it to run.

That it is all wrong is not your fault as the Django example is wrong
in the first place and technically it isn't possible to do it
completely correctly unless using mod_python 3.3 or later.

So, suggest you first split out authentication into its own handler
and get it working. Post that here and I will tell you the bits that
may be missing to make it completely correct. Then we can move onto
separate authorisation handler.

BTW, I assume you are using mod_python 3.3.1?

Graham

On 23/07/07, Brad Anderson &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">brad at sankatygroup.com</A>&gt; wrote:
&gt;<i> Jim Gallacher wrote:
</I>&gt;<i> &gt; Hi Brad,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; It's been awhile since I've messed with aaa, but I may have a spark of
</I>&gt;<i> &gt; an idea.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Brad Anderson wrote:
</I>&gt;<i> &gt;&gt; Hi,
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; I'm trying to tie into Django's auth subsystem for http authn/authz in
</I>&gt;<i> &gt;&gt; front of Subversion, as seen here:
</I>&gt;<i> &gt;&gt; <A HREF="http://www.djangoproject.com/documentation/apache_auth/">http://www.djangoproject.com/documentation/apache_auth/</A>
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; So, my Apache 2.0.59 conf looks like this (with some mod_macro voodoo):
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; #####################################################################
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; &lt;Macro ProjectClosed $PROJ&gt;
</I>&gt;<i> &gt;&gt;  &lt;Location /projects/$PROJ&gt;
</I>&gt;<i> &gt;&gt;   DAV svn
</I>&gt;<i> &gt;&gt;   SVNPath /var/svn/$PROJ
</I>&gt;<i> &gt;&gt;   AuthType Basic
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Try changing your AuthType to something else. Heck, you could even use:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; AuthType somethingelse
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; but you'll likely want something a little clearer - dsource-auth might
</I>&gt;<i> &gt; be a good choice. You can retrieve this string in your handler with
</I>&gt;<i> &gt; req.auth_type(). Likewise req.auth_name() will get you the AuthName
</I>&gt;<i> &gt; setting.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; As I recall the AuthType Basic will cause the default authentication
</I>&gt;<i> &gt; mechanism to fire, and that's the thing that is generating the &quot;couldn't
</I>&gt;<i> &gt; check access.  No groups file?&quot; verbiage in your log.
</I>&gt;<i>
</I>&gt;<i> Changed AuthType to dsource-auth, and no dice.
</I>&gt;<i>
</I>&gt;<i> I received this when trying 'svn up':
</I>&gt;<i> &gt; svn up
</I>&gt;<i> svn: PROPFIND request failed on '/projects/test'
</I>&gt;<i> svn: PROPFIND of '/projects/test': 401 Authorization Required
</I>&gt;<i> (<A HREF="http://local.svn.dsource.org">http://local.svn.dsource.org</A>)
</I>&gt;<i>
</I>&gt;<i> and nothing was written in error_log, making me think the handler was
</I>&gt;<i> bypassed completely.  :(
</I>&gt;<i>
</I>&gt;<i> BA
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i>
</I></PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024054.html">[mod_python] PythonAuthenHandler issues
</A></li>
	<LI>Next message: <A HREF="024056.html">[mod_python] PythonAuthenHandler issues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24055">[ date ]</a>
              <a href="thread.html#24055">[ thread ]</a>
              <a href="subject.html#24055">[ subject ]</a>
              <a href="author.html#24055">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
