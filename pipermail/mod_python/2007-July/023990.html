<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] streaming tar and/or zip files?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20streaming%20tar%20and/or%20zip%20files%3F&In-Reply-To=e94d85500707051259r6a759b76jf5faf24ae23e221d%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023988.html">
   <LINK REL="Next"  HREF="023964.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] streaming tar and/or zip files?</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Mike Looijmans</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20streaming%20tar%20and/or%20zip%20files%3F&In-Reply-To=e94d85500707051259r6a759b76jf5faf24ae23e221d%40mail.gmail.com"
       TITLE="[mod_python] streaming tar and/or zip files?">nlv11281 at natlab.research.philips.com
       </A><BR>
    <I>Fri Jul  6 01:21:59 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="023988.html">[mod_python] streaming tar and/or zip files?
</A></li>
        <LI>Next message: <A HREF="023964.html">[mod_python] mod_python 3.3.1 memory leak?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23990">[ date ]</a>
              <a href="thread.html#23990">[ thread ]</a>
              <a href="subject.html#23990">[ subject ]</a>
              <a href="author.html#23990">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Yes, you have to set the number of bytes to be written, because the tar file header absolutely must 
contain that information. You can't cheat there. If you don't know the file size in advance, i think 
you're stuck with either inventing your own archive format, picking some other method of sending the 
data, or explaining some more of what you are trying to accomplish so that we may help you with that.

Mike Looijmans
Philips Natlab / Topic Automation


Matthew Dennis wrote:
&gt;<i> Can you please give an example because I don't see a way to do it from 
</I>&gt;<i> looking at the docs.  It looks like there are only two methods for 
</I>&gt;<i> getting data into the stream: add() or addfile() and both require the 
</I>&gt;<i> data being sent to be in actual files, neither appear to let me stream 
</I>&gt;<i> data to them.  I can't use add() because it expects the name of an 
</I>&gt;<i> actual file to add.  I can't use addfile() because the fileobj that is 
</I>&gt;<i> passed in requires TarInfo.size to be set to the number of bytes to be 
</I>&gt;<i> read and even if that wasn't the case, it tries to make calls using the 
</I>&gt;<i> name of the file (which again doesn't exist).
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On 7/3/07, *Mike Looijmans* &lt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">nlv11281 at natlab.research.philips.com</A> 
</I>&gt;<i> &lt;mailto:<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">nlv11281 at natlab.research.philips.com</A>&gt;&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i>     The &quot;tarfile&quot; built-in Python module can do as you ask, and also do
</I>&gt;<i>     compression (gzip or bzip2). ZIP
</I>&gt;<i>     cannot be &quot;streamed&quot;, it has a sort of directory table inside to
</I>&gt;<i>     which it jumps up and down.
</I>&gt;<i> 
</I>&gt;<i>     You can just open a tarfile object with the req object as file output.
</I>&gt;<i> 
</I>&gt;<i>     Setting content-type to &quot;application/x-tar&quot; or something similar
</I>&gt;<i>     will help your client figuring out
</I>&gt;<i>     what to do with the file.
</I>&gt;<i> 
</I>&gt;<i>     I've used the tarfile module with archives over 800GB in size,
</I>&gt;<i>     without problems.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     Mike Looijmans
</I>&gt;<i>     Philips Natlab / Topic Automation
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     Matthew Dennis wrote:
</I>&gt;<i>      &gt; This may not be the appropriate list, my apologies if that is
</I>&gt;<i>     indeed the
</I>&gt;<i>      &gt; case...
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; I need to push from mod_python a file archive of sorts.  Any of tar,
</I>&gt;<i>      &gt; tar.gz or zip will work (I'm also open to other suggestions).  The
</I>&gt;<i>      &gt; requirement is that I can package several other &quot;files&quot; into it,
</I>&gt;<i>      &gt; compressed or not.  I have no disk to write to and finite memory
</I>&gt;<i>     to deal
</I>&gt;<i>      &gt; with but the &quot;files&quot; I'm outputting are quite large (much larger than
</I>&gt;<i>      &gt; can fit in memory), thus I need to stream them directly out.  The
</I>&gt;<i>     reason
</I>&gt;<i>      &gt; I put &quot;files&quot; in quotes is because they are not really files, but
</I>&gt;<i>      &gt; dynamic content that is generated on the fly.  ZipOutputStream
</I>&gt;<i>     from Java
</I>&gt;<i>      &gt; is a example of what I'm talking about if anyone is familiar with
</I>&gt;<i>     it, as
</I>&gt;<i>      &gt; are other such streams.  I don't know the size of the content until
</I>&gt;<i>      &gt; after it is all generated so there is no way to populate a TarInfo
</I>&gt;<i>      &gt; object with the size et cetera and make my dynamic content look
</I>&gt;<i>     like a
</I>&gt;<i>      &gt; file (which it doesn't seem I can do anyway as gettarinfo() tries to
</I>&gt;<i>      &gt; call .fileno() which doesn't exist on any file like object I
</I>&gt;<i>     would create).
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; In other words, something like:
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; output = TarFileStream(someFileObj)
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; output.addEntry(&quot;file_1.txt&quot;)
</I>&gt;<i>      &gt; out.write( /*some dynamically generated content */ )
</I>&gt;<i>      &gt; out.write( /*some dynamically generated content */ )
</I>&gt;<i>      &gt; out.write( /*some dynamically generated content */ )
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; output.addEntry(&quot;file_2.txt&quot;)
</I>&gt;<i>      &gt; out.write( /*some dynamically generated content */ )
</I>&gt;<i>      &gt; out.write( /*some dynamically generated content */ )
</I>&gt;<i>      &gt; out.write( /*some dynamically generated content */ )
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; ...
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; output.addEntry(&quot;file_N.txt&quot;)
</I>&gt;<i>      &gt; out.write( /*some dynamically generated content */ )
</I>&gt;<i>      &gt; out.write( /*some dynamically generated content */ )
</I>&gt;<i>      &gt; out.write( /*some dynamically generated content */ )
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; output.close()
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt;
</I>&gt;<i>     ------------------------------------------------------------------------
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; _______________________________________________
</I>&gt;<i>      &gt; Mod_python mailing list
</I>&gt;<i>      &gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A> &lt;mailto:<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>&gt;
</I>&gt;<i>      &gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i>     &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023988.html">[mod_python] streaming tar and/or zip files?
</A></li>
	<LI>Next message: <A HREF="023964.html">[mod_python] mod_python 3.3.1 memory leak?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23990">[ date ]</a>
              <a href="thread.html#23990">[ thread ]</a>
              <a href="subject.html#23990">[ subject ]</a>
              <a href="author.html#23990">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
