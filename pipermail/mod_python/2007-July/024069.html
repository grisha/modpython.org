<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Re: QUERY_STRING and running a cgi script under
	mod_python
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Re%3A%20QUERY_STRING%20and%20running%20a%20cgi%20script%20under%0A%09mod_python&In-Reply-To=88e286470707231518q630f3b1ap85ced9de60f3fa32%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024068.html">
   <LINK REL="Next"  HREF="024070.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Re: QUERY_STRING and running a cgi script under
	mod_python</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Gambit</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Re%3A%20QUERY_STRING%20and%20running%20a%20cgi%20script%20under%0A%09mod_python&In-Reply-To=88e286470707231518q630f3b1ap85ced9de60f3fa32%40mail.gmail.com"
       TITLE="[mod_python] Re: QUERY_STRING and running a cgi script under
	mod_python">gambit at alpenjodel.de
       </A><BR>
    <I>Mon Jul 23 21:57:29 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="024068.html">[mod_python] QUERY_STRING and running a cgi script under
	mod_python
</A></li>
        <LI>Next message: <A HREF="024070.html">[mod_python] Newbie or not Newbie, that is the question!
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24069">[ date ]</a>
              <a href="thread.html#24069">[ thread ]</a>
              <a href="subject.html#24069">[ subject ]</a>
              <a href="author.html#24069">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks for the reply.

It's an old cgi script someone else wrote. I rewrote it to use 
mod_python style req.form parameters and it works now, so this is mostly 
an academic discussion.

Yes, I'm pretty sure I'm under mod_python, I won't post the server 
configuration here as this server is managed trough the Plesk control 
panel which means the configuration is split in many complex files all 
over the place (I didn't modify anything in this server so this is its 
default mod_python configuration), but this works on the same file:

import mod_python

def index(req):
     req.content_type = &quot;text/plain&quot;
     return &quot;Hello World!&quot;

This is the kind of offending code I was talking about:

import cgi
import os

form = cgi.FieldStorage()
if form.has_key(&quot;dir&quot;):
     root_dir = form[&quot;dir&quot;].value
     if os.path.commonprefix([document_root, root_dir]) != document_root:
         print 'Invalid dir'
         sys.exit(1)
else:
     root_dir = document_root


Here the dir parameter comes from a get. Under plain old cgi 
form.has_key(&quot;dir&quot;) is true but not so under mod_python.

Another test:

import cgi
cgi.test()


If called as <A HREF="http://my.server/script.py?foo=bar">http://my.server/script.py?foo=bar</A> I get an empty &quot;Form 
Contents&quot; section but the QUERY_STRING variable is foo=bar as expected.

Under CGI &quot;Form Contents&quot; is:

foo: &lt;type 'instance'&gt;
     MiniFieldStorage('foo', 'bar')

I found this to be weird. mod_python makes available both get and post 
variables from req.form and so does cgi.FieldStorage() unless the latter 
it's being run under mod_python in which case post variables are 
available but not get...

Of course one can rewrite the script to use req.form or 
util.FieldStorage() but an unmodified python cgi script won't work as 
expected... I always thought one of the goals of mod_python was to 
provide an upgrade path for cgi scripts but it seems many cgi scripts 
won't work out of the box with it.

Thanks,


</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024068.html">[mod_python] QUERY_STRING and running a cgi script under
	mod_python
</A></li>
	<LI>Next message: <A HREF="024070.html">[mod_python] Newbie or not Newbie, that is the question!
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24069">[ date ]</a>
              <a href="thread.html#24069">[ thread ]</a>
              <a href="subject.html#24069">[ subject ]</a>
              <a href="author.html#24069">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
