<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Re: [mod_python] Using Templates]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5BRe%3A%20%5Bmod_python%5D%20Using%20Templates%5D&In-Reply-To=1184757191.27298.3.camel%40245-73.202-68.tampabay.res.rr.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024041.html">
   <LINK REL="Next"  HREF="024043.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Re: [mod_python] Using Templates]</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Jim Gallacher</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5BRe%3A%20%5Bmod_python%5D%20Using%20Templates%5D&In-Reply-To=1184757191.27298.3.camel%40245-73.202-68.tampabay.res.rr.com"
       TITLE="[Re: [mod_python] Using Templates]">jpg at jgassociates.ca
       </A><BR>
    <I>Wed Jul 18 15:31:50 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="024041.html">[Re: [mod_python] Using Templates]
</A></li>
        <LI>Next message: <A HREF="024043.html">[mod_python] How to get the html code in a string when using psp ? 
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24045">[ date ]</a>
              <a href="thread.html#24045">[ thread ]</a>
              <a href="subject.html#24045">[ subject ]</a>
              <a href="author.html#24045">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>ron banks wrote:
&gt;<i> Jim,
</I>&gt;<i> 
</I>&gt;<i> Any advice on this? Thanks again.
</I>
As I recall you are doing the AJAXy thing to update the calendar in the 
browser, correct? Are you rolling your own or using one of the toolkits 
like prototype, rico (which is built on top of prototype), dojo or whatever?

The AJAX toolkits can make this sort of thing really easy at the cost of 
making the initial page load a little slower while the toolkit is 
fetched. (And of course it'll mean you'll need to wade through another 
set of docs for the toolkit).

In any case you likely don't want to generate a completely new page for 
the update, and redirect really isn't what you want. Just have your 
javascript GET the html fragment (for example) and update the document 
element using innerHTML with whatever the url returns. Some toolkits 
handle this transparently. You just register the element id and send the 
request the the url. The toolkit updates the element with the returned html.

The html fragment (or perhaps json or xml data) would be generated by a 
new mod_python script or psp template, which only returns the 
information you require to update the html element in the browser. If 
you structure your code correctly this same template would be called to 
assist in creating the original page so that you don't duplicate the 
code in 2 places.

I hope this helps to get you going.

Jim


&gt;<i> 
</I>&gt;<i> -------- Forwarded Message --------
</I>&gt;<i> From: ron banks &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">rebcoair at cfl.rr.com</A>&gt;
</I>&gt;<i> Reply-To: <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">rebcoair at cfl.rr.com</A>
</I>&gt;<i> To: Jim Gallacher &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">jpg at jgassociates.ca</A>&gt;
</I>&gt;<i> Cc: mod_python Mailing List &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python at modpython.org</A>&gt;
</I>&gt;<i> Subject: Re: [mod_python] Using Templates
</I>&gt;<i> Date: Sat, 14 Jul 2007 21:03:59 -0400
</I>&gt;<i> 
</I>&gt;<i> Jim,
</I>&gt;<i> 
</I>&gt;<i> Sorry Jim, our company had a series of hardware failures taking out our
</I>&gt;<i> phone systems that required attention. Had to put this on hold for 24
</I>&gt;<i> hrs. Got to make a living while experimenting on other things, right?
</I>&gt;<i> 
</I>&gt;<i> Ok, it certainly is easier to debug when you get running code. I'll
</I>&gt;<i> claim ignorance on the dead lock in the session calls. After your tip
</I>&gt;<i> and seeing that in the documentation it was easy to find and correct the
</I>&gt;<i> offending code. The template calls are now working, thanks, and in the
</I>&gt;<i> long run this will be a much cleaner method for what I am doing with the
</I>&gt;<i> separation of code and content.
</I>&gt;<i> 
</I>&gt;<i> That leaves the one problem remaining with reloading or redirecting the
</I>&gt;<i> new page with the new date information. The function that I am using to
</I>&gt;<i> update the session works and yes I do a session.save() at the end. I
</I>&gt;<i> have a page where I can check the session values and they are updated
</I>&gt;<i> each time so that's not the problem. What is the best method in my
</I>&gt;<i> situation to use to load the page again using the new session variable
</I>&gt;<i> from mod_python?
</I>&gt;<i> 
</I>&gt;<i> On Thu, 2007-07-12 at 11:07 -0400, Jim Gallacher wrote: 
</I>&gt;&gt;<i> ron banks wrote:
</I>&gt;&gt;&gt;<i> Graham,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Thanks for the reply. I do realize that the '=' is wrong. When removed
</I>&gt;&gt;&gt;<i> the browser just hangs without reporting errors.
</I>&gt;&gt;<i> It occurs to me that you may have a session deadlock. Do you use the 
</I>&gt;&gt;<i> &quot;session&quot; variable name anywhere in any of your psp templates, or is it 
</I>&gt;&gt;<i> just in setStrDate?
</I>&gt;<i> 
</I>&gt;&gt;<i> The rule is that you should only create one session instance per 
</I>&gt;&gt;<i> request. When a session instance is created it is locked for the 
</I>&gt;&gt;<i> duration of the request to protect your data. If you attempt to create a 
</I>&gt;&gt;<i> second instance the request will appear to hang as the 2nd session waits 
</I>&gt;&gt;<i> for the lock to be released, which of course never happens.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> There is some &quot;magic&quot; in psp where it will create a session instance if 
</I>&gt;&gt;<i> it finds a variable named &quot;session&quot; anywhere in the template. It will 
</I>&gt;&gt;<i> check to see if it can find req.session first, so if you need to create 
</I>&gt;&gt;<i> a session outside of psp make sure you assign it to req.session. This is 
</I>&gt;&gt;<i> probably a good habit to get into even if you aren't using the psp handler.
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> What I am not getting
</I>&gt;&gt;&gt;<i> is how to properly set the 'strDate' variable in:
</I>&gt;&gt;<i> Actually, I think you are setting it properly. ;)
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> ----------------Month.tmpl------------------
</I>&gt;&gt;&gt;<i> &lt;%=loadMonth(req, strDate)%&gt;
</I>&gt;&gt;&gt;<i>                   ^^^^^^^
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> with this function:
</I>&gt;&gt;&gt;<i> ---------------setStrDate-------------------
</I>&gt;&gt;&gt;<i> def setStrDate(req):
</I>&gt;&gt;&gt;<i> 	session = Session.Session(req)
</I>&gt;&gt;&gt;<i> 	if session.is_new():
</I>&gt;&gt;&gt;<i> 		strDate = &quot;&quot;
</I>&gt;&gt;&gt;<i> 	else:
</I>&gt;&gt;&gt;<i> 		strDate = getSessionVariable(session, 'currDate')
</I>&gt;&gt;&gt;<i> 	req.content_type = 'text/html'
</I>&gt;&gt;&gt;<i> 	tmpl = psp.PSP(req, filename='Month.tmpl')
</I>&gt;&gt;&gt;<i> 	tmpl.run(vars = {'strDate': strDate})
</I>&gt;&gt;&gt;<i> 	return &quot;&quot;
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> called from:
</I>&gt;&gt;&gt;<i> ----------------Month.psp------------------
</I>&gt;&gt;&gt;<i> &lt;%
</I>&gt;&gt;&gt;<i> from mod_python import apache, psp
</I>&gt;&gt;&gt;<i> from loadCalendar import setStrDate
</I>&gt;&gt;&gt;<i> %&gt;
</I>&gt;&gt;&gt;<i> &lt;%=setStrDate(req)%&gt;
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> How should this be done? This is a first experiment for me utilizing
</I>&gt;&gt;&gt;<i> templates. What I am trying to do is to set a session variable
</I>&gt;&gt;&gt;<i> 'currDate' with a new date through ajax methods and load a page with the
</I>&gt;&gt;&gt;<i> same loadMonth function which builds a calendar populated with records
</I>&gt;&gt;&gt;<i> from a database backend. I have worked out almost everything else and
</I>&gt;&gt;&gt;<i> have only a couple of problems before I can move forward.
</I>&gt;&gt;<i> You're on the right track. I would suggest that you simplify 
</I>&gt;&gt;<i> setStrDate() so that it only does one thing. You might also consider 
</I>&gt;&gt;<i> renaming it to getStrDate as that seems to be it's function. Move the 
</I>&gt;&gt;<i> things not related to the date to another function. It'll make your 
</I>&gt;&gt;<i> program logic easier to understand. It might not see like a big deal 
</I>&gt;&gt;<i> right now, but if need to come back and modify the code 6 months from 
</I>&gt;&gt;<i> now you'll thank me. ;)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Your code might look more like this:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ---------------getStrDate-------------------
</I>&gt;&gt;<i> def getStrDate(req):
</I>&gt;&gt;<i> 	if not hasattr(req, 'session'):
</I>&gt;&gt;<i> 		req.session = Session.Session(req)
</I>&gt;&gt;<i> 	if req.session.is_new():
</I>&gt;&gt;<i>   		strDate = &quot;&quot;
</I>&gt;&gt;<i>   	else:
</I>&gt;&gt;<i>   		strDate = getSessionVariable(req.session, 'currDate')
</I>&gt;&gt;<i>   	return strDate
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ----------------Month.tmpl------------------
</I>&gt;&gt;<i> &lt;%
</I>&gt;&gt;<i> loadMonth(req, strDate)
</I>&gt;&gt;<i> %&gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ----------------Month.psp------------------
</I>&gt;&gt;<i> &lt;%
</I>&gt;&gt;<i> from mod_python import apache, psp
</I>&gt;&gt;<i> from loadCalendar import getStrDate
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> strDate = getStrDate(req)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> tmpl = psp.PSP(req, filename='Month.tmpl')
</I>&gt;&gt;<i> tmpl.run(vars = {'strDate': strDate})
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> %&gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I either need to figure out how to utilize a template system as
</I>&gt;&gt;&gt;<i> described which I think might be preferable in this situation or
</I>&gt;&gt;&gt;<i> possibly reload the same page letting the loadMonth function pick up the
</I>&gt;&gt;&gt;<i> changed session variable and building the page based on the new date.
</I>&gt;&gt;&gt;<i> I'm not sure how to reload the page. Should I use some type of redirect
</I>&gt;&gt;&gt;<i> from the server side or javascript from the client side? I have only
</I>&gt;&gt;&gt;<i> started to experiment with these methods. I can't seem to get the
</I>&gt;&gt;&gt;<i> redirect to do anything yet.  With the javascript reload the session
</I>&gt;&gt;&gt;<i> variable seems to go away.
</I>&gt;&gt;<i> This may be related to the way you are using sessions. Once we've 
</I>&gt;&gt;<i> determined if you have a deadlock we can deal with this issue.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Do you save the session anywhere, or are you depending on psp? Psp will 
</I>&gt;&gt;<i> only save the session if it finds the &quot;session&quot; variable name in your 
</I>&gt;&gt;<i> template. Otherwise you'll need to save it explicitly somewhere with 
</I>&gt;&gt;<i> session.save().
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Is this because of the new request or
</I>&gt;&gt;&gt;<i> something? Maybe a better method is to control session information in
</I>&gt;&gt;&gt;<i> the database and just use javascript. I don't know what differences in
</I>&gt;&gt;&gt;<i> speed would be. What do you think?
</I>&gt;&gt;<i> Use the mod_python session machinery until you've got it working. Adding 
</I>&gt;&gt;<i> another layer of complexity won't help at this point.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> As I mull this over I'm convinced you're problem lies with the way you 
</I>&gt;&gt;<i> are using sessions, and not with psp templates.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Jim
</I>&gt;&gt;<i>
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i> 
</I>
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024041.html">[Re: [mod_python] Using Templates]
</A></li>
	<LI>Next message: <A HREF="024043.html">[mod_python] How to get the html code in a string when using psp ? 
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24045">[ date ]</a>
              <a href="thread.html#24045">[ thread ]</a>
              <a href="subject.html#24045">[ subject ]</a>
              <a href="author.html#24045">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
