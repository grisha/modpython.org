<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Re: [mod_python] Using Templates]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5BRe%3A%20%5Bmod_python%5D%20Using%20Templates%5D&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024047.html">
   <LINK REL="Next"  HREF="024045.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Re: [mod_python] Using Templates]</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>ron banks</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5BRe%3A%20%5Bmod_python%5D%20Using%20Templates%5D&In-Reply-To="
       TITLE="[Re: [mod_python] Using Templates]">rebcoair at cfl.rr.com
       </A><BR>
    <I>Wed Jul 18 07:13:11 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="024047.html">[mod_python] (no subject)
</A></li>
        <LI>Next message: <A HREF="024045.html">[Re: [mod_python] Using Templates]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24041">[ date ]</a>
              <a href="thread.html#24041">[ thread ]</a>
              <a href="subject.html#24041">[ subject ]</a>
              <a href="author.html#24041">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Jim,

Any advice on this? Thanks again.

-------- Forwarded Message --------
From: ron banks &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">rebcoair at cfl.rr.com</A>&gt;
Reply-To: <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">rebcoair at cfl.rr.com</A>
To: Jim Gallacher &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">jpg at jgassociates.ca</A>&gt;
Cc: mod_python Mailing List &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python at modpython.org</A>&gt;
Subject: Re: [mod_python] Using Templates
Date: Sat, 14 Jul 2007 21:03:59 -0400

Jim,

Sorry Jim, our company had a series of hardware failures taking out our
phone systems that required attention. Had to put this on hold for 24
hrs. Got to make a living while experimenting on other things, right?

Ok, it certainly is easier to debug when you get running code. I'll
claim ignorance on the dead lock in the session calls. After your tip
and seeing that in the documentation it was easy to find and correct the
offending code. The template calls are now working, thanks, and in the
long run this will be a much cleaner method for what I am doing with the
separation of code and content.

That leaves the one problem remaining with reloading or redirecting the
new page with the new date information. The function that I am using to
update the session works and yes I do a session.save() at the end. I
have a page where I can check the session values and they are updated
each time so that's not the problem. What is the best method in my
situation to use to load the page again using the new session variable
from mod_python?

On Thu, 2007-07-12 at 11:07 -0400, Jim Gallacher wrote: 
&gt;<i> ron banks wrote:
</I>&gt;<i> &gt; Graham,
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Thanks for the reply. I do realize that the '=' is wrong. When removed
</I>&gt;<i> &gt; the browser just hangs without reporting errors.
</I>&gt;<i> 
</I>&gt;<i> It occurs to me that you may have a session deadlock. Do you use the 
</I>&gt;<i> &quot;session&quot; variable name anywhere in any of your psp templates, or is it 
</I>&gt;<i> just in setStrDate?
</I>
&gt;<i> The rule is that you should only create one session instance per 
</I>&gt;<i> request. When a session instance is created it is locked for the 
</I>&gt;<i> duration of the request to protect your data. If you attempt to create a 
</I>&gt;<i> second instance the request will appear to hang as the 2nd session waits 
</I>&gt;<i> for the lock to be released, which of course never happens.
</I>&gt;<i> 
</I>&gt;<i> There is some &quot;magic&quot; in psp where it will create a session instance if 
</I>&gt;<i> it finds a variable named &quot;session&quot; anywhere in the template. It will 
</I>&gt;<i> check to see if it can find req.session first, so if you need to create 
</I>&gt;<i> a session outside of psp make sure you assign it to req.session. This is 
</I>&gt;<i> probably a good habit to get into even if you aren't using the psp handler.
</I>&gt;<i> 
</I>&gt;<i> &gt; What I am not getting
</I>&gt;<i> &gt; is how to properly set the 'strDate' variable in:
</I>&gt;<i> 
</I>&gt;<i> Actually, I think you are setting it properly. ;)
</I>&gt;<i> 
</I>&gt;<i> &gt; ----------------Month.tmpl------------------
</I>&gt;<i> &gt; &lt;%=loadMonth(req, strDate)%&gt;
</I>&gt;<i> &gt;                   ^^^^^^^
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; with this function:
</I>&gt;<i> &gt; ---------------setStrDate-------------------
</I>&gt;<i> &gt; def setStrDate(req):
</I>&gt;<i> &gt; 	session = Session.Session(req)
</I>&gt;<i> &gt; 	if session.is_new():
</I>&gt;<i> &gt; 		strDate = &quot;&quot;
</I>&gt;<i> &gt; 	else:
</I>&gt;<i> &gt; 		strDate = getSessionVariable(session, 'currDate')
</I>&gt;<i> &gt; 	req.content_type = 'text/html'
</I>&gt;<i> &gt; 	tmpl = psp.PSP(req, filename='Month.tmpl')
</I>&gt;<i> &gt; 	tmpl.run(vars = {'strDate': strDate})
</I>&gt;<i> &gt; 	return &quot;&quot;
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; called from:
</I>&gt;<i> &gt; ----------------Month.psp------------------
</I>&gt;<i> &gt; &lt;%
</I>&gt;<i> &gt; from mod_python import apache, psp
</I>&gt;<i> &gt; from loadCalendar import setStrDate
</I>&gt;<i> &gt; %&gt;
</I>&gt;<i> &gt; &lt;%=setStrDate(req)%&gt;
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; How should this be done? This is a first experiment for me utilizing
</I>&gt;<i> &gt; templates. What I am trying to do is to set a session variable
</I>&gt;<i> &gt; 'currDate' with a new date through ajax methods and load a page with the
</I>&gt;<i> &gt; same loadMonth function which builds a calendar populated with records
</I>&gt;<i> &gt; from a database backend. I have worked out almost everything else and
</I>&gt;<i> &gt; have only a couple of problems before I can move forward.
</I>&gt;<i> 
</I>&gt;<i> You're on the right track. I would suggest that you simplify 
</I>&gt;<i> setStrDate() so that it only does one thing. You might also consider 
</I>&gt;<i> renaming it to getStrDate as that seems to be it's function. Move the 
</I>&gt;<i> things not related to the date to another function. It'll make your 
</I>&gt;<i> program logic easier to understand. It might not see like a big deal 
</I>&gt;<i> right now, but if need to come back and modify the code 6 months from 
</I>&gt;<i> now you'll thank me. ;)
</I>&gt;<i> 
</I>&gt;<i> Your code might look more like this:
</I>&gt;<i> 
</I>&gt;<i> ---------------getStrDate-------------------
</I>&gt;<i> def getStrDate(req):
</I>&gt;<i> 	if not hasattr(req, 'session'):
</I>&gt;<i> 		req.session = Session.Session(req)
</I>&gt;<i> 	if req.session.is_new():
</I>&gt;<i>   		strDate = &quot;&quot;
</I>&gt;<i>   	else:
</I>&gt;<i>   		strDate = getSessionVariable(req.session, 'currDate')
</I>&gt;<i>   	return strDate
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> ----------------Month.tmpl------------------
</I>&gt;<i> &lt;%
</I>&gt;<i> loadMonth(req, strDate)
</I>&gt;<i> %&gt;
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> ----------------Month.psp------------------
</I>&gt;<i> &lt;%
</I>&gt;<i> from mod_python import apache, psp
</I>&gt;<i> from loadCalendar import getStrDate
</I>&gt;<i> 
</I>&gt;<i> strDate = getStrDate(req)
</I>&gt;<i> 
</I>&gt;<i> tmpl = psp.PSP(req, filename='Month.tmpl')
</I>&gt;<i> tmpl.run(vars = {'strDate': strDate})
</I>&gt;<i> 
</I>&gt;<i> %&gt;
</I>&gt;<i> 
</I>&gt;<i> &gt; I either need to figure out how to utilize a template system as
</I>&gt;<i> &gt; described which I think might be preferable in this situation or
</I>&gt;<i> &gt; possibly reload the same page letting the loadMonth function pick up the
</I>&gt;<i> &gt; changed session variable and building the page based on the new date.
</I>&gt;<i> &gt; I'm not sure how to reload the page. Should I use some type of redirect
</I>&gt;<i> &gt; from the server side or javascript from the client side? I have only
</I>&gt;<i> &gt; started to experiment with these methods. I can't seem to get the
</I>&gt;<i> &gt; redirect to do anything yet.  With the javascript reload the session
</I>&gt;<i> &gt; variable seems to go away.
</I>&gt;<i> 
</I>&gt;<i> This may be related to the way you are using sessions. Once we've 
</I>&gt;<i> determined if you have a deadlock we can deal with this issue.
</I>&gt;<i> 
</I>&gt;<i> Do you save the session anywhere, or are you depending on psp? Psp will 
</I>&gt;<i> only save the session if it finds the &quot;session&quot; variable name in your 
</I>&gt;<i> template. Otherwise you'll need to save it explicitly somewhere with 
</I>&gt;<i> session.save().
</I>&gt;<i> 
</I>&gt;<i> &gt; Is this because of the new request or
</I>&gt;<i> &gt; something? Maybe a better method is to control session information in
</I>&gt;<i> &gt; the database and just use javascript. I don't know what differences in
</I>&gt;<i> &gt; speed would be. What do you think?
</I>&gt;<i> 
</I>&gt;<i> Use the mod_python session machinery until you've got it working. Adding 
</I>&gt;<i> another layer of complexity won't help at this point.
</I>&gt;<i> 
</I>&gt;<i> As I mull this over I'm convinced you're problem lies with the way you 
</I>&gt;<i> are using sessions, and not with psp templates.
</I>&gt;<i> 
</I>&gt;<i> Jim
</I>&gt;<i> 
</I>
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024047.html">[mod_python] (no subject)
</A></li>
	<LI>Next message: <A HREF="024045.html">[Re: [mod_python] Using Templates]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24041">[ date ]</a>
              <a href="thread.html#24041">[ thread ]</a>
              <a href="subject.html#24041">[ subject ]</a>
              <a href="author.html#24041">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
