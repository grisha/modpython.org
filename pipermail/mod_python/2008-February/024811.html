<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Import error on multiple interpreters
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Import%20error%20on%20multiple%20interpreters&In-Reply-To=ed756d900802040809k69c48d9al243c0c77c8012985%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024805.html">
   <LINK REL="Next"  HREF="024815.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Import error on multiple interpreters</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Import%20error%20on%20multiple%20interpreters&In-Reply-To=ed756d900802040809k69c48d9al243c0c77c8012985%40mail.gmail.com"
       TITLE="[mod_python] Import error on multiple interpreters">graham.dumpleton at gmail.com
       </A><BR>
    <I>Mon Feb  4 17:27:20 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="024805.html">[mod_python] Import error on multiple interpreters
</A></li>
        <LI>Next message: <A HREF="024815.html">[mod_python] Import error on multiple interpreters
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24811">[ date ]</a>
              <a href="thread.html#24811">[ thread ]</a>
              <a href="subject.html#24811">[ subject ]</a>
              <a href="author.html#24811">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>What settings do you have in your configuration for:

  PythonPath ...
  PythonOption mod_python.importer.path ...

The module importer doesn't add paths automatically to sys.path and
uses its own path which is in part based on the request context. The
locations it can look in can therefore vary based on where your
handler code is located which the request mapped to. As such, you may
need to explicitly set the module importer path option if a specific
directory must always be checked.

The other option is that if you are relying on being able to import
from a module installed on sys.path, ie., standard module, a module
which only exists somewhere on mod_python module path. You can't do
this, when using 'import' in a standard Python module, it will only
look for stuff on sys.path.

Answer these questions, but also make sure you have read up on
import_module function in:

  <A HREF="http://www.modpython.org/live/current/doc-html/pyapi-apmeth.html">http://www.modpython.org/live/current/doc-html/pyapi-apmeth.html</A>

if you haven't done so already.

Graham

On 05/02/2008, Tom Wells &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">drshade at gmail.com</A>&gt; wrote:
&gt;<i> Hi Everyone
</I>&gt;<i>
</I>&gt;<i> I have been bumbling along with mod_python for about a month using
</I>&gt;<i> mod_python as the apache hooks for integrating into a larger single-sign-on
</I>&gt;<i> solution, so far so good. However I'm hitting my head against a weird issue,
</I>&gt;<i> and can't seem to find any reference to related issues on this list, nor the
</I>&gt;<i> FAQ, so here goes:
</I>&gt;<i>
</I>&gt;<i> I'm supporting multiple apache virtual hosts, and separating them by running
</I>&gt;<i> each in a different python interpretor (using PythonInterpreter &lt;site_name&gt;
</I>&gt;<i> within the VirtualHost configuration for each site.
</I>&gt;<i>
</I>&gt;<i> I hook into apache via PythonAuthenHandler and PythonAuthzHandler (as my app
</I>&gt;<i> is only concerned with authentication and authorization) and make web
</I>&gt;<i> service calls using ZSI and some cryptographic routines using ncrypt (Python
</I>&gt;<i> OpenSSL wrapper) before allowing or disallowing access to the particular
</I>&gt;<i> resource.
</I>&gt;<i>
</I>&gt;<i> So the above works nicely, but while testing I occasionally get the
</I>&gt;<i> following error (not on startup, but after a few requests):
</I>&gt;<i> [Mon Feb 04 17:41:57 2008] [notice] mod_python (pid=26429,
</I>&gt;<i> interpreter='ssofilter_interpreter_mobile'): Importing
</I>&gt;<i> module '/home/tom/dev/auth/ssofilter-apache-2.2/ssofilter.py'
</I>&gt;<i>  [Mon Feb 04 17:41:57 2008] [notice] mod_python (pid=26429,
</I>&gt;<i> interpreter='ssofilter_interpreter_mobile'): Importing
</I>&gt;<i> module '/home/tom/dev/auth/ssofilter-apache-2.2/webserver.py'
</I>&gt;<i> [Mon Feb 04 17:41:57 2008] [notice] mod_python (pid=26429,
</I>&gt;<i> interpreter='ssofilter_interpreter_mobile'): Importing
</I>&gt;<i> module '/home/tom/dev/auth/ssofilter-apache-2.2/cache.py'
</I>&gt;<i>  [Mon Feb 04 17:41:57 2008] [notice] mod_python (pid=26429,
</I>&gt;<i> interpreter='ssofilter_interpreter_mobile'): Importing
</I>&gt;<i> module '/home/tom/dev/auth/ssofilter-apache-2.2/authserver.py'
</I>&gt;<i> [Mon Feb 04 17:41:57 2008] [notice] mod_python (pid=26429,
</I>&gt;<i> interpreter='ssofilter_interpreter_mobile'): Importing
</I>&gt;<i> module '/home/tom/dev/auth/ssofilter-apache-2.2/ausService_services.py'
</I>&gt;<i>  [Mon Feb 04 17:41:57 2008] [notice] mod_python (pid=26429,
</I>&gt;<i> interpreter='ssofilter_interpreter_mobile'): Importing
</I>&gt;<i> module
</I>&gt;<i> '/home/tom/dev/auth/ssofilter-apache-2.2/ausService_services_types.py'
</I>&gt;<i> [Mon Feb 04 17:41:57 2008] [notice] mod_python (pid=26429,
</I>&gt;<i> interpreter='ssofilter_interpreter_mobile'): Importing
</I>&gt;<i> module '/home/tom/dev/auth/ssofilter-apache-2.2/utils.py'
</I>&gt;<i>  [Mon Feb 04 17:41:57 2008] [notice] mod_python (pid=26429,
</I>&gt;<i> interpreter='ssofilter_interpreter_mobile'): Importing
</I>&gt;<i> module '/home/tom/dev/auth/ssofilter-apache-2.2/cryptography.py'
</I>&gt;<i> [Mon Feb 04 17:41:57 2008] [error] [client 192.168.16.42] mod_python
</I>&gt;<i> (pid=26429, interpreter='ssofilter_interpreter_mobile',
</I>&gt;<i> phase='PythonAuthenHandler', handler='ssofilter'): Application error
</I>&gt;<i>  [Mon Feb 04 17:41:57 2008] [error] [client 192.168.16.42] ServerName:
</I>&gt;<i> 'mobile.domain.co.za'
</I>&gt;<i> [Mon Feb 04 17:41:57 2008] [error] [client 192.168.16.42] DocumentRoot:
</I>&gt;<i> '/home/tom/dev/auth/mobileweb'
</I>&gt;<i>  [Mon Feb 04 17:41:57 2008] [error] [client 192.168.16.42] URI: '/'
</I>&gt;<i> [Mon Feb 04 17:41:57 2008] [error] [client 192.168.16.42] Location: '/'
</I>&gt;<i>  [Mon Feb 04 17:41:57 2008] [error] [client 192.168.16.42] Directory: None
</I>&gt;<i> [Mon Feb 04 17:41:57 2008] [error] [client 192.168.16.42] Filename:
</I>&gt;<i> '/home/tom/dev/auth/mobileweb/'
</I>&gt;<i>  [Mon Feb 04 17:41:57 2008] [error] [client 192.168.16.42] PathInfo: ''
</I>&gt;<i> [Mon Feb 04 17:41:57 2008] [error] [client 192.168.16.42] Traceback (most
</I>&gt;<i> recent call last):
</I>&gt;<i>  [Mon Feb 04 17:41:57 2008] [error] [client 192.168.16.42]   File
</I>&gt;<i> &quot;/usr/lib/python2.5/site-packages/mod_python/importer.py&quot;,
</I>&gt;<i> line 1537, in HandlerDispatch\n    default=default_handler, arg=req,
</I>&gt;<i> ilent=hlist.silent)
</I>&gt;<i>  [Mon Feb 04 17:41:57 2008] [error] [client 192.168.16.42]   File
</I>&gt;<i> &quot;/usr/lib/python2.5/site-packages/mod_python/importer.py&quot;,
</I>&gt;<i> line 1202, in _process_target\n    module = import_module(module_name,
</I>&gt;<i> path=path)
</I>&gt;<i>  [Mon Feb 04 17:41:57 2008] [error] [client 192.168.16.42]   File
</I>&gt;<i> &quot;/usr/lib/python2.5/site-packages/mod_python/importer.py&quot;,
</I>&gt;<i> line 296, in import_module\n    log, import_path)
</I>&gt;<i>  [Mon Feb 04 17:41:57 2008] [error] [client 192.168.16.42]   File
</I>&gt;<i> &quot;/usr/lib/python2.5/site-packages/mod_python/importer.py&quot;,
</I>&gt;<i> line 680, in import_module\n    execfile(file, module.__dict__)
</I>&gt;<i>  [Mon Feb 04 17:41:57 2008] [error] [client 192.168.16.42]   File
</I>&gt;<i> &quot;/home/tom/dev/auth/ssofilter-apache-2.2/ssofilter.py&quot;, line 10, in
</I>&gt;<i> &lt;module&gt;\n    cryptography = apache.import_module('cryptography')
</I>&gt;<i>  [Mon Feb 04 17:41:57 2008] [error] [client 192.168.16.42]   File
</I>&gt;<i> &quot;/usr/lib/python2.5/site-packages/mod_python/importer.py&quot;,
</I>&gt;<i> line 296, in import_module\n    log, import_path)
</I>&gt;<i>  [Mon Feb 04 17:41:57 2008] [error] [client 192.168.16.42]   File
</I>&gt;<i> &quot;/usr/lib/python2.5/site-packages/mod_python/importer.py&quot;,
</I>&gt;<i> line 680, in import_module\n    execfile(file, module.__dict__)
</I>&gt;<i>  [Mon Feb 04 17:41:57 2008] [error] [client 192.168.16.42]   File
</I>&gt;<i> &quot;/home/tom/dev/auth/ssofilter-apache-2.2/cryptography.py&quot;, line 4, in
</I>&gt;<i> &lt;module&gt;\n    cipher = apache.import_module('ncrypt.cipher')
</I>&gt;<i>  [Mon Feb 04 17:41:57 2008] [error] [client 192.168.16.42]   File
</I>&gt;<i> &quot;/usr/lib/python2.5/site-packages/mod_python/importer.py&quot;,
</I>&gt;<i> line 304, in import_module\n    return __import__(module_name, {}, {},
</I>&gt;<i> ['*'])
</I>&gt;<i>  [Mon Feb 04 17:41:57 2008] [error] [client 192.168.16.42]   File
</I>&gt;<i> &quot;/var/lib/python-support/python2.5/ncrypt/cipher.py&quot;, line
</I>&gt;<i> 1, in &lt;module&gt;\n    from _ncrypt.cipher import *
</I>&gt;<i>  [Mon Feb 04 17:41:57 2008] [error] [client 192.168.16.42] ImportError: No
</I>&gt;<i> module named cipher
</I>&gt;<i>
</I>&gt;<i> Now you may think I'm posting this to the wrong list looking at the
</I>&gt;<i> stacktrace, but I'm convinced it's mod_python related. While testing the
</I>&gt;<i> first few requests go through fine (and ncrypt is imported correctly), but
</I>&gt;<i> it seems like the error occurs when apache has decided to create a new
</I>&gt;<i> thread (or spawn a new process, difficult to tell) that the error occurs
</I>&gt;<i> (the log entries containing &quot;Importing Module&quot; are spat out by mod_python,
</I>&gt;<i> as I use the apache.import_module() function for performing all my imports).
</I>&gt;<i>
</I>&gt;<i> A hint is if I make all my sites run under one single python interpreter (by
</I>&gt;<i> giving them the same name) I don't experience the problem, but I'd prefer
</I>&gt;<i> not to run under this configuration as I'd need to do a whole lot more work
</I>&gt;<i> to ensure that data remains separated per site.
</I>&gt;<i>
</I>&gt;<i> Any comments, suggestions would be greatly appreciated!
</I>&gt;<i>
</I>&gt;<i> Thanks,
</I>&gt;<i> Tom
</I>&gt;<i>
</I>&gt;<i> PS&gt; Running mod_python 3.3.1-2, running on ubuntu 7.10 in apache
</I>&gt;<i> 2.2.4-3build1. My apache runtime configuration looks something like:
</I>&gt;<i>  [Mon Feb 04 17:40:10 2008] [notice] Apache Configuration:
</I>&gt;<i> [Mon Feb 04 17:40:10 2008] [notice]  AP_MPMQ_MAX_DAEMON_USED     -&gt; 2 [Max #
</I>&gt;<i> of daemons used so far]
</I>&gt;<i> [Mon Feb 04 17:40:10 2008] [notice]  AP_MPMQ_IS_THREADED         -&gt; 1
</I>&gt;<i> [0=Unsupported, 1=Static, 2=Dynamic]
</I>&gt;<i>  [Mon Feb 04 17:40:10 2008] [notice]  AP_MPMQ_IS_FORKED           -&gt; 2
</I>&gt;<i> [0=Unsupported, 1=Static, 2=Dynamic]
</I>&gt;<i> [Mon Feb 04 17:40:10 2008] [notice]  AP_MPMQ_HARD_LIMIT_DAEMONS  -&gt; 16 [The
</I>&gt;<i> compiled max # daemons]
</I>&gt;<i> [Mon Feb 04 17:40:10 2008] [notice]  AP_MPMQ_HARD_LIMIT_THREADS  -&gt; 64 [The
</I>&gt;<i> compiled max # threads]
</I>&gt;<i>  [Mon Feb 04 17:40:10 2008] [notice]  AP_MPMQ_MAX_THREADS         -&gt; 25 [#
</I>&gt;<i> of threads/child by config]
</I>&gt;<i> [Mon Feb 04 17:40:10 2008] [notice]  AP_MPMQ_MIN_SPARE_DAEMONS   -&gt; 0 [Min #
</I>&gt;<i> of spare daemons]
</I>&gt;<i> [Mon Feb 04 17:40:10 2008] [notice]  AP_MPMQ_MIN_SPARE_THREADS   -&gt; 25 [Min
</I>&gt;<i> # of spare threads]
</I>&gt;<i>  [Mon Feb 04 17:40:10 2008] [notice]  AP_MPMQ_MAX_SPARE_DAEMONS   -&gt; 0 [Max
</I>&gt;<i> # of spare daemons]
</I>&gt;<i> [Mon Feb 04 17:40:10 2008] [notice]  AP_MPMQ_MAX_SPARE_THREADS   -&gt; 75 [Max
</I>&gt;<i> # of spare threads]
</I>&gt;<i> [Mon Feb 04 17:40:10 2008] [notice]  AP_MPMQ_MAX_REQUESTS_DAEMON -&gt; 10 [Max
</I>&gt;<i> # of requests per daemon]
</I>&gt;<i>  [Mon Feb 04 17:40:10 2008] [notice]  AP_MPMQ_MAX_DAEMONS         -&gt; 6 [Max
</I>&gt;<i> # of daemons by config]
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i>
</I>&gt;<i>
</I></PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024805.html">[mod_python] Import error on multiple interpreters
</A></li>
	<LI>Next message: <A HREF="024815.html">[mod_python] Import error on multiple interpreters
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24811">[ date ]</a>
              <a href="thread.html#24811">[ thread ]</a>
              <a href="subject.html#24811">[ subject ]</a>
              <a href="author.html#24811">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
