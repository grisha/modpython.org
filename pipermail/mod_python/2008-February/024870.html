<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] mod_python.Importer.path; set dynamically
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20mod_python.Importer.path%3B%20set%20dynamically&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024838.html">
   <LINK REL="Next"  HREF="024795.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] mod_python.Importer.path; set dynamically</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Martijn Moeling</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20mod_python.Importer.path%3B%20set%20dynamically&In-Reply-To="
       TITLE="[mod_python] mod_python.Importer.path; set dynamically">martijn at xs4us.nu
       </A><BR>
    <I>Fri Feb 22 07:42:39 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="024838.html">[mod_python] mod_python.Importer.path; set dynamically
</A></li>
        <LI>Next message: <A HREF="024795.html">[mod_python] Physical paths ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24870">[ date ]</a>
              <a href="thread.html#24870">[ thread ]</a>
              <a href="subject.html#24870">[ subject ]</a>
              <a href="author.html#24870">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Graham,
 
Sorry for the delay I have been extremely busy on some other stuff.
 
&gt;<i>                 modules=filesInUserDirectory(req.session.user)
</I>&gt;<i>            for module in modules:
</I>&gt;<i>                         module.append( apache.import_module(module)
</I>&gt;<i>                 return module.index(req,*args,**kwargs) # return apache.OK?
</I>&gt;<i>    ......... (some code)
</I>&gt;<i>         return apache.OK
</I>&gt;<i>
</I>
As you can see the line &quot;modules=filesInUserDirectory(req.session.user)&quot; loads a tuple with modules in the userdirectory to import over the stable versions.
 
Then I have to iterate to see which ones I nee to import, please note that this is explanational code not actual code, I'm designing not implementing.
 
what does the line: &quot;return module.index(req,*args,**kwargs) # return apache.OK?&quot; do, and what if I return Apache.OK, I do not understand (or find explanation of the &quot;return module.index(req,*args,**kwargs)&quot; part.

It seems to me that in this way I cannot load more than one module and I should (re)load all modules in the userdir.....

 

Martijn


 

________________________________

Van: Graham Dumpleton [mailto:<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">graham.dumpleton at gmail.com</A>]
Verzonden: wo 13.02.2008 0:40
Aan: Martijn Moeling
CC: <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python at modpython.org</A>
Onderwerp: Re: [mod_python] mod_python.Importer.path; set dynamically



On 12/02/2008, Martijn Moeling &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">martijn at xs4us.nu</A>&gt; wrote:
&gt;<i> Graham,
</I>&gt;<i>
</I>&gt;<i> Thank you, I did not mess around with it yet, I am planning a
</I>&gt;<i> versioning system to be added to my webbased development platform.
</I>&gt;<i> I am still having some trouble with my webdav module, I have to taccle
</I>&gt;<i> that one first.
</I>&gt;<i>
</I>&gt;<i> Your help is usefull one question though:
</I>&gt;<i>
</I>&gt;<i> say the inporterpath is set to:
</I>&gt;<i>
</I>&gt;<i> &quot;.../python_modules/me:.../python_modules&quot;
</I>&gt;<i>
</I>&gt;<i> in the apacheconfig the importerpath is set to .../python_modules
</I>&gt;<i>
</I>&gt;<i> in both directories stays:
</I>&gt;<i>
</I>&gt;<i> modulex.py ( in the me directory is the lates version)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> in my handler module:
</I>&gt;<i>
</I>&gt;<i> import modulex
</I>&gt;<i>
</I>&gt;<i> de handler(req):
</I>&gt;<i>         ....... (some code)
</I>&gt;<i>         if req.debug and req.session.loggedIn:
</I>&gt;<i>                 req.options['mod_python.path'] = &quot;.../me:../&quot;
</I>&gt;<i>                 importedModules=[]
</I>&gt;<i>                 modules=filesInUserDirectory(req.session.user)
</I>&gt;<i>            for module in modules:
</I>&gt;<i>                         module.append( apache.import_module(module)
</I>&gt;<i>                 return module.index(req,*args,**kwargs) # return apache.OK?
</I>&gt;<i>    ......... (some code)
</I>&gt;<i>         return apache.OK
</I>&gt;<i>
</I>&gt;<i> what happens to the interpreter for the next requests? which &quot;modulex&quot;
</I>&gt;<i> is used ? The are supposed to get the &quot;stable&quot; one from .../
</I>&gt;<i> python_modules/
</I>
Yes. Should always get the one from path specified in Apache
configuration. The dynamic change is only going to apply to those
imports done from handler or as a side effect of running the handler.

&gt;<i> I don't understand what the return line does, what happens if I return
</I>&gt;<i> apache.OK in this case?
</I>
Huh.

At least I am a bit confused by your question as the code:

          for module in modules:
                       module.append( apache.import_module(module)
               return module.index(req,*args,**kwargs) # return apache.OK?
  ......... (some code)

doesn't make much sense to me. Don't understand why you are trying to
iterate over a list of modules to import.

Graham

&gt;<i> Martijn
</I>&gt;<i>
</I>&gt;<i> On Feb 5, 2008, at 11:12 AM, Graham Dumpleton wrote:
</I>&gt;<i>
</I>&gt;<i> &gt; Sorry for the delay.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; To make things work transparently across a lot of modules, for both
</I>&gt;<i> &gt; import_module() and 'import' where possible, what you can do is modify
</I>&gt;<i> &gt; the value of option 'mod_python.importer.path' dynamically from code.
</I>&gt;<i> &gt; This can be done from memory using:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; req.options['mod_python.importer.path'] = &quot;....&quot;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; You obviously can query this first if you need to somehow manipulate
</I>&gt;<i> &gt; it to add stuff.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; All you then need is a level of indirection. Has to be from inside of
</I>&gt;<i> &gt; handler, can't be at global scope. So,
</I>&gt;<i> &gt; /var/www/python_modules/index.py might do:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; def index(req, *args, **kwargs):
</I>&gt;<i> &gt; req.options['mod_python.importer.path'] = \
</I>&gt;<i> &gt;  '/var/www/python_modules/%s:/var/www/python_modules' % req.user
</I>&gt;<i> &gt; module = apache.import_module('index-core')
</I>&gt;<i> &gt; return module.index(req, *args, **kwargs)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; If there is only one level of module imports, you could also do just:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; def index(req, *args, **kwargs):
</I>&gt;<i> &gt; module = apache.import_module('index-core', \
</I>&gt;<i> &gt;  path=['/var/www/python_modules/%s:/var/www/python_modules' %
</I>&gt;<i> &gt; req.user]))
</I>&gt;<i> &gt; return module.index(req, *args, **kwargs)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; but think that if subdirectory uses 'import', then it might not look
</I>&gt;<i> &gt; in all the directories. Can't remember how it works now.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Anyway the suggestion is look at changing req.options if you haven't
</I>&gt;<i> &gt; already.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Graham
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On 01/02/2008, Martijn Moeling &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">martijn at xs4us.nu</A>&gt; wrote:
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Graham,
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; As you might remember I added a MySQLdb section to session.
</I>&gt;<i> &gt;&gt; (to be able to save sessions across computers)
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; In my system a lot of additional data is added to the req object,
</I>&gt;<i> &gt;&gt; which is
</I>&gt;<i> &gt;&gt; passed
</I>&gt;<i> &gt;&gt; around. in my case it is req.Session.user.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; (I do not use http based auth, since this is in conflict with my
</I>&gt;<i> &gt;&gt; web based
</I>&gt;<i> &gt;&gt; desktop)
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; nevertheless, i can change your &quot;example code&quot; to my needs, consider
</I>&gt;<i> &gt;&gt; req.user as the distinguisher for ease of thinking.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Martijn
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; -----Original Message-----
</I>&gt;<i> &gt;&gt; From: Graham Dumpleton [mailto:<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">graham.dumpleton at gmail.com</A>]
</I>&gt;<i> &gt;&gt; Sent: Thu 31.01.2008 23:03
</I>&gt;<i> &gt;&gt; To: Martijn Moeling
</I>&gt;<i> &gt;&gt; Cc: <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python at modpython.org</A>
</I>&gt;<i> &gt;&gt; Subject: Re: [mod_python] mod_python.Importer.path; set dynamically
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; On 01/02/2008, Martijn Moeling &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">martijn at xs4us.nu</A>&gt; wrote:
</I>&gt;<i> &gt;&gt;&gt; Hi!
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; I am an extensive mod_python user and my system needs something
</I>&gt;<i> &gt;&gt;&gt; special.
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; Consider the following:
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; in httpd.conf I have :
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; PythonOption mod_python.importer.path [&quot;/var/www/python_modules&quot;]
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; /var/www/html/index.py is linked to ../python_modules/index.py
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; the python_modules directory has subdirectories, like; developer1,
</I>&gt;<i> &gt;&gt;&gt; developer2
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; the python_modules contains stable modules and developerX holds
</I>&gt;<i> &gt;&gt; development
</I>&gt;<i> &gt;&gt;&gt; versions.
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; I have load balancing with multiple frond-ends (apache/MP) and one
</I>&gt;<i> &gt;&gt; backend
</I>&gt;<i> &gt;&gt;&gt; (MySQL).
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; I would like to dynamically change the mod_python.importer.path so
</I>&gt;<i> &gt;&gt;&gt; that
</I>&gt;<i> &gt;&gt;&gt; developer1 runs code in the corresponding subdir if the module
</I>&gt;<i> &gt;&gt;&gt; exists,
</I>&gt;<i> &gt;&gt;&gt; else fall back to the python_modules directory.
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; Any tips, suggestions, remarks?
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; What is the distinguisher used to know which developer it is? Are you
</I>&gt;<i> &gt;&gt; using something like Basic authentication and so could distinguish
</I>&gt;<i> &gt;&gt; based on req.user?
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; If you tell me what the distinguisher is, probably have an idea.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Graham
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i>
</I>&gt;<i>
</I>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080222/e02452ae/attachment.html">http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080222/e02452ae/attachment.html</A>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024838.html">[mod_python] mod_python.Importer.path; set dynamically
</A></li>
	<LI>Next message: <A HREF="024795.html">[mod_python] Physical paths ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24870">[ date ]</a>
              <a href="thread.html#24870">[ thread ]</a>
              <a href="subject.html#24870">[ subject ]</a>
              <a href="author.html#24870">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
