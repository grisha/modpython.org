<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] mod_python.Importer.path; set dynamically
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20mod_python.Importer.path%3B%20set%20dynamically&In-Reply-To=B6C73A5E30565245BB6D32B5F5DF7A52172BA3%40sense.emmastraat.pijnacker">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024794.html">
   <LINK REL="Next"  HREF="024836.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] mod_python.Importer.path; set dynamically</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20mod_python.Importer.path%3B%20set%20dynamically&In-Reply-To=B6C73A5E30565245BB6D32B5F5DF7A52172BA3%40sense.emmastraat.pijnacker"
       TITLE="[mod_python] mod_python.Importer.path; set dynamically">graham.dumpleton at gmail.com
       </A><BR>
    <I>Tue Feb  5 05:12:17 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="024794.html">[mod_python] mod_python.Importer.path; set dynamically
</A></li>
        <LI>Next message: <A HREF="024836.html">[mod_python] mod_python.Importer.path; set dynamically
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24812">[ date ]</a>
              <a href="thread.html#24812">[ thread ]</a>
              <a href="subject.html#24812">[ subject ]</a>
              <a href="author.html#24812">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Sorry for the delay.

To make things work transparently across a lot of modules, for both
import_module() and 'import' where possible, what you can do is modify
the value of option 'mod_python.importer.path' dynamically from code.
This can be done from memory using:

  req.options['mod_python.importer.path'] = &quot;....&quot;

You obviously can query this first if you need to somehow manipulate
it to add stuff.

All you then need is a level of indirection. Has to be from inside of
handler, can't be at global scope. So,
/var/www/python_modules/index.py might do:

  def index(req, *args, **kwargs):
    req.options['mod_python.importer.path'] = \
        '/var/www/python_modules/%s:/var/www/python_modules' % req.user
    module = apache.import_module('index-core')
    return module.index(req, *args, **kwargs)

If there is only one level of module imports, you could also do just:

  def index(req, *args, **kwargs):
    module = apache.import_module('index-core', \
        path=['/var/www/python_modules/%s:/var/www/python_modules' % req.user]))
    return module.index(req, *args, **kwargs)

but think that if subdirectory uses 'import', then it might not look
in all the directories. Can't remember how it works now.

Anyway the suggestion is look at changing req.options if you haven't already.

Graham

On 01/02/2008, Martijn Moeling &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">martijn at xs4us.nu</A>&gt; wrote:
&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Graham,
</I>&gt;<i>
</I>&gt;<i>  As you might remember I added a MySQLdb section to session.
</I>&gt;<i>  (to be able to save sessions across computers)
</I>&gt;<i>
</I>&gt;<i>  In my system a lot of additional data is added to the req object, which is
</I>&gt;<i> passed
</I>&gt;<i>  around. in my case it is req.Session.user.
</I>&gt;<i>
</I>&gt;<i>  (I do not use http based auth, since this is in conflict with my web based
</I>&gt;<i> desktop)
</I>&gt;<i>
</I>&gt;<i>  nevertheless, i can change your &quot;example code&quot; to my needs, consider
</I>&gt;<i> req.user as the distinguisher for ease of thinking.
</I>&gt;<i>
</I>&gt;<i>  Martijn
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>  -----Original Message-----
</I>&gt;<i>  From: Graham Dumpleton [mailto:<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">graham.dumpleton at gmail.com</A>]
</I>&gt;<i>  Sent: Thu 31.01.2008 23:03
</I>&gt;<i>  To: Martijn Moeling
</I>&gt;<i>  Cc: <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python at modpython.org</A>
</I>&gt;<i>  Subject: Re: [mod_python] mod_python.Importer.path; set dynamically
</I>&gt;<i>
</I>&gt;<i>  On 01/02/2008, Martijn Moeling &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">martijn at xs4us.nu</A>&gt; wrote:
</I>&gt;<i>  &gt; Hi!
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  I am an extensive mod_python user and my system needs something special.
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  Consider the following:
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  in httpd.conf I have :
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  PythonOption mod_python.importer.path [&quot;/var/www/python_modules&quot;]
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  /var/www/html/index.py is linked to ../python_modules/index.py
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  the python_modules directory has subdirectories, like; developer1,
</I>&gt;<i>  &gt; developer2
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  the python_modules contains stable modules and developerX holds
</I>&gt;<i> development
</I>&gt;<i>  &gt; versions.
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  I have load balancing with multiple frond-ends (apache/MP) and one
</I>&gt;<i> backend
</I>&gt;<i>  &gt; (MySQL).
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  I would like to dynamically change the mod_python.importer.path so that
</I>&gt;<i>  &gt; developer1 runs code in the corresponding subdir if the module exists,
</I>&gt;<i>  &gt;  else fall back to the python_modules directory.
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  Any tips, suggestions, remarks?
</I>&gt;<i>
</I>&gt;<i>  What is the distinguisher used to know which developer it is? Are you
</I>&gt;<i>  using something like Basic authentication and so could distinguish
</I>&gt;<i>  based on req.user?
</I>&gt;<i>
</I>&gt;<i>  If you tell me what the distinguisher is, probably have an idea.
</I>&gt;<i>
</I>&gt;<i>  Graham
</I>&gt;<i>
</I>&gt;<i>
</I></PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024794.html">[mod_python] mod_python.Importer.path; set dynamically
</A></li>
	<LI>Next message: <A HREF="024836.html">[mod_python] mod_python.Importer.path; set dynamically
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24812">[ date ]</a>
              <a href="thread.html#24812">[ thread ]</a>
              <a href="subject.html#24812">[ subject ]</a>
              <a href="author.html#24812">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
