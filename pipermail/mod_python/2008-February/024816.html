<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Physical paths ?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Physical%20paths%20%3F&In-Reply-To=88e286470802050220q31382c0cocf83599fbe4748a7%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024813.html">
   <LINK REL="Next"  HREF="024817.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Physical paths ?</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>S.R.Pard&#225;</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Physical%20paths%20%3F&In-Reply-To=88e286470802050220q31382c0cocf83599fbe4748a7%40mail.gmail.com"
       TITLE="[mod_python] Physical paths ?">linux at qbox.es
       </A><BR>
    <I>Tue Feb  5 11:22:04 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="024813.html">[mod_python] Physical paths ?
</A></li>
        <LI>Next message: <A HREF="024817.html">[mod_python] Physical paths ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24816">[ date ]</a>
              <a href="thread.html#24816">[ thread ]</a>
              <a href="subject.html#24816">[ subject ]</a>
              <a href="author.html#24816">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
El mar, 05-02-2008 a las 21:20 +1100, Graham Dumpleton escribi&#243;:
&gt;<i> Sorry for the delay.
</I>&gt;<i> 
</I>
Not at all.

&gt;<i> Since you are using .psp files, then you must be using AddHandler. As
</I>&gt;<i> a result the following should work to give you the name of the
</I>&gt;<i> directory corresponding to the Directory container in Apache
</I>&gt;<i> configuration, or .htaccess file, that you defined PythonHandler in.
</I>&gt;<i> 
</I>&gt;<i>         root = req.hlist.directory
</I>&gt;<i>         parent = req.hlist.parent
</I>&gt;<i>         while parent is not None:
</I>&gt;<i>             root = parent.directory
</I>&gt;<i>             parent = parent.parent
</I>&gt;<i> 
</I>

Thank you, 

That's a good answer to the question of the Pyshical Root Path of an
Application, because my app is an Apache Directory.

In my case, parent is None. Because not stacked handlers &#191;isn't it?.
So req.hlist.directory has the root. 
But I understand I should use the complete code.

Thank You Again.



&gt;<i> In other words, if in main Apache configuration you have:
</I>&gt;<i> 
</I>&gt;<i>   Alias /MyApp/ /home/user/MyApp/
</I>&gt;<i> 
</I>&gt;<i>   &lt;Directory /home/user/MyApp&gt;
</I>&gt;<i>   AddHandler mod_python .psp
</I>&gt;<i>   PythonHandler mod_python.psp | .psp
</I>&gt;<i>   ...
</I>&gt;<i>   &lt;/Directory&gt;
</I>&gt;<i> 
</I>&gt;<i> The 'root' should end up being '/home/user/MyApp'.
</I>&gt;<i> 
</I>&gt;<i> This only works where PythonHandler in a Directory container or .htaccess file.
</I>&gt;<i> 
</I>&gt;<i> You must be using mod_python 3.3.1.
</I>&gt;<i> 
</I>&gt;<i> Graham
</I>&gt;<i> 
</I>&gt;<i> On 03/02/2008, Graham Dumpleton &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">graham.dumpleton at gmail.com</A>&gt; wrote:
</I>&gt;<i> &gt; Please keep your replies on the list.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; FYI. That code was setting req.application_root so you could use it as
</I>&gt;<i> &gt; a reference, not trying to use it.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Do:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;   PythonHandler somemodulenameinrootofpspfilesdirectory .psp
</I>&gt;<i> &gt;   PythonHandler mod_python.psp .psp
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; In somemodulenameinrootofpspfilesdirectory.py have:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;   import os
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;   def handler(req):
</I>&gt;<i> &gt;     req.application_root = os.path,dirname(__file__)
</I>&gt;<i> &gt;     return apache.OK
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Read the documentation about stacked mod_python handlers to see how this works.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Have no time to read all this new mail now, maybe someone else will help.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Graham
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ---------- Forwarded message ----------
</I>&gt;<i> &gt; From: S.R.Pard&#225; &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">linux at qbox.es</A>&gt;
</I>&gt;<i> &gt; Date: 2 Feb 2008 21:26
</I>&gt;<i> &gt; Subject: Re: [mod_python] Physical paths ?
</I>&gt;<i> &gt; To: Graham Dumpleton &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">graham.dumpleton at gmail.com</A>&gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Thank You.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I'm using: PythonHandler mod_python.psp and req.application_root doesn't
</I>&gt;<i> &gt; exist.
</I>&gt;<i> &gt; But __file__ is '/usr/lib/python2.5/site-packages/mod_python/psp.pyc' in
</I>&gt;<i> &gt; the psp page, so it doen't seem related to the root of my app pages
</I>&gt;<i> &gt; where I wnt to save.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Anyway, I will try to explain it better, so it can help any other person
</I>&gt;<i> &gt; in the future looking for info like this.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Basically, I want the mod_python psp application, allow content upload
</I>&gt;<i> &gt; from the user client:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; That's done in:         <A HREF="http://SERVER/MyApp/config/upload.psp">http://SERVER/MyApp/config/upload.psp</A>
</I>&gt;<i> &gt; (and that page is in /home/user/MyApp/config/index.psp)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; And I want to save the user file to a directory accesible later at:
</I>&gt;<i> &gt;         <A HREF="http://SERVER/MyApp/images/users/USER_FILE">http://SERVER/MyApp/images/users/USER_FILE</A>
</I>&gt;<i> &gt; (that page would be in /home/user/MyApp/images/users)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; So the upload.psp save the file received from form at that images
</I>&gt;<i> &gt; directory (instead of the form directory).
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I wanted that the code from upload psp will pass a relative path from
</I>&gt;<i> &gt; the root of the App (/MyApp) to the module that saves the file, that is
</I>&gt;<i> &gt; something like:
</I>&gt;<i> &gt;         save_file(USER_FILE,&quot;images/users/&quot;, req)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I needed the save_file to obtain the physical path to the URL:
</I>&gt;<i> &gt;         '//SERVER' + '/MyApp/' + 'images/users/'
</I>&gt;<i> &gt;         (server + application_root + destiny_folder)
</I>&gt;<i> &gt; that is, the physical path to save the file:
</I>&gt;<i> &gt;         '/home/user/MyApp/config/index.psp'
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Of course, I didn't wanted the function to use a constant to the root of
</I>&gt;<i> &gt; the application '/home/user/MyApp' (at code time) to allow to the
</I>&gt;<i> &gt; application to be independent from the installation directory.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I know req.filename give me the physical path to
</I>&gt;<i> &gt; <A HREF="http://SERVER/MyApp/config/upload.psp">http://SERVER/MyApp/config/upload.psp</A>
</I>&gt;<i> &gt; that is:
</I>&gt;<i> &gt; /home/user/MyApp/config/upload.psp
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; so I could save to '/home/user/MyApp/config/' without problem. And the
</I>&gt;<i> &gt; same in some subdirectory like '/home/user/MyApp/config/images/users/'.
</I>&gt;<i> &gt; I know.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; But, I had an images directory in '/home/user/MyApp/images/', and maybe
</I>&gt;<i> &gt; I like the things in the hard way. And decide to save to that directory
</I>&gt;<i> &gt; of images (don't ask me why).
</I>&gt;<i> &gt; I know that ... application root is at '..' relative to the physical
</I>&gt;<i> &gt; directory of the page ('/home/user/MyApp/config/').
</I>&gt;<i> &gt; But I really like the things in the hard way and I wanted the save
</I>&gt;<i> &gt; function to be usable from any other pages in other directories, and I
</I>&gt;<i> &gt; don't wanted to send a constant relative path to the app root (remember
</I>&gt;<i> &gt; '/home/user/MyApp/') from every page to the save function (because, I
</I>&gt;<i> &gt; want app to be independent of the installation directory, and I don't
</I>&gt;<i> &gt; want to worry about the constant relative paths if I move the pages).
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; So, the code I'm using now, take the physical path of the page, and the
</I>&gt;<i> &gt; uri of the page , and the application root (uri), to obtain the physical
</I>&gt;<i> &gt; path of the application.
</I>&gt;<i> &gt; And from that , I can take the pyshical path of any subdirectory
</I>&gt;<i> &gt; relative to root (only if no subdirectory with alias are involved, of
</I>&gt;<i> &gt; course).
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ######
</I>&gt;<i> &gt; def physicalAppRoot(req):
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;   rootApp = req.get_options()['mod_python.session.application_path']
</I>&gt;<i> &gt;   pageDir, pageName = os.path.split(req.parsed_uri[6])
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;   if pageDir.startswith(rootApp):
</I>&gt;<i> &gt;      appPageDir = pageDir[len(rootApp):]
</I>&gt;<i> &gt;   else:
</I>&gt;<i> &gt;      appPageDir = pageDir
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;   physPath = os.path.dirname(req.filename)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;   i = physPath.rfind(appPageDir)
</I>&gt;<i> &gt;   physAppRoot = physPath[:i]+os.path.sep
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;   return physAppRoot
</I>&gt;<i> &gt; ######
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The application path is an apache's directory alias, so option
</I>&gt;<i> &gt; application_path is indicated in the config (like you said me Graham, to
</I>&gt;<i> &gt; set different paths for cookies from various applications, and that
</I>&gt;<i> &gt; worked great for me).
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; That's work for me but, really all I wanted was some function like:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;         physicalPath(uri = 'images/users/')
</I>&gt;<i> &gt; or
</I>&gt;<i> &gt;         physicalPath(uri = '/MyApp/images/users/')
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; that give me:  '/home/user/MyApp/images/users/'
</I>&gt;<i> &gt; for an apache mod_python application installed in /home/user/MyApp,
</I>&gt;<i> &gt; accessible at '<A HREF="http://server/MyApp'">http://server/MyApp'</A> (because an alias would be set at
</I>&gt;<i> &gt; apache 'alias /MyApp/ &quot;/home/user/MyApp&quot;').
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Sorry, if I can explain it better. Maybe I'm doing a silly thing,
</I>&gt;<i> &gt; because an apache function available at mod_python does exctly this, but
</I>&gt;<i> &gt; I didn't found it.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Thank You,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;         S.R.Pard&#225;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; El s&#225;b, 02-02-2008 a las 08:36 +1100, Graham Dumpleton escribi&#243;:
</I>&gt;<i> &gt; &gt; I think I only partly understand what you want. Anyway, work out what
</I>&gt;<i> &gt; &gt; the following would do if done in your mod_python handler.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;   import os
</I>&gt;<i> &gt; &gt;   req.application_root = os.path.dirname(__file__)
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Graham
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; On 01/02/2008, S.R.Pard&#225; &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">linux at qbox.es</A>&gt; wrote:
</I>&gt;<i> &gt; &gt; &gt; Hi,
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; Now, thank you to your help,  my applicattion is capable of receive
</I>&gt;<i> &gt; &gt; &gt; image files from users using forms.
</I>&gt;<i> &gt; &gt; &gt; And app store them into a physical path of the server.
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; It's possible to save from the app to an uri folder ?
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; Can I know the physical path of one uri ?
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; I can save easily to a subfolder of the pyhsical path obtained by
</I>&gt;<i> &gt; &gt; &gt; req.filename relative to the page visited, and that can work without
</I>&gt;<i> &gt; &gt; &gt; problem.
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; But I would like the module (the module that implements the form
</I>&gt;<i> &gt; &gt; &gt; proccesing) receive the relative route relative to the root of the
</I>&gt;<i> &gt; &gt; &gt; application path, so module will not need to know the physical structure
</I>&gt;<i> &gt; &gt; &gt; of directories, and can save to a route not descendent of the directory
</I>&gt;<i> &gt; &gt; &gt; of my own page.
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; ... And in my app, the root of the app is a directory alias. outside of
</I>&gt;<i> &gt; &gt; &gt; the apache document_root '/var/www'
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; That's it
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;         DocumentRoot    /             /var/www
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;         Alias           MyApp         /home/user/MyApp/
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;         /MyApp/index.psp   .......... /home/user/MyApp/index.psp
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;         /MyApp/config/upload.psp  ... /home/user/MyApp/config/index.psp
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;         /MyApp/images/  ............. /home/user/MyApp/images/
</I>&gt;<i> &gt; &gt; &gt;         /MyApp/images/users/    ..... /home/user/MyApp/images/users/
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; And I want to obtain from code executed in
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;         http:/MyApp/config/upload.psp
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; the physical path of root of the application:
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; so I can't sent to a function in form.py:
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;         app_root = ???    # function that returns '/home/user/MyApp/'
</I>&gt;<i> &gt; &gt; &gt;         imgs_folder = 'images/users/'
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;         process(form, directory_to_save = app_root+imgs_folder)
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; So, the code is independent of the installation directory and the app
</I>&gt;<i> &gt; &gt; &gt; path.
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; Another thing ... if images would be an alias, &#191; could I know the path ?
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; Thank You again.
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;         S.R.Parda
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; _______________________________________________
</I>&gt;<i> &gt; &gt; &gt; Mod_python mailing list
</I>&gt;<i> &gt; &gt; &gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> &gt; &gt; &gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt;
</I>
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024813.html">[mod_python] Physical paths ?
</A></li>
	<LI>Next message: <A HREF="024817.html">[mod_python] Physical paths ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24816">[ date ]</a>
              <a href="thread.html#24816">[ thread ]</a>
              <a href="subject.html#24816">[ subject ]</a>
              <a href="author.html#24816">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
