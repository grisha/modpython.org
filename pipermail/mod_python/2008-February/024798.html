<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> Fwd: [mod_python] Physical paths ?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=Fwd%3A%20%5Bmod_python%5D%20Physical%20paths%20%3F&In-Reply-To=1201947998.7084.72.camel%40ThorUx">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024799.html">
   <LINK REL="Next"  HREF="024813.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>Fwd: [mod_python] Physical paths ?</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=Fwd%3A%20%5Bmod_python%5D%20Physical%20paths%20%3F&In-Reply-To=1201947998.7084.72.camel%40ThorUx"
       TITLE="Fwd: [mod_python] Physical paths ?">graham.dumpleton at gmail.com
       </A><BR>
    <I>Sat Feb  2 16:04:20 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="024799.html">[mod_python] Problem getting the Publisher handler to return
	nothing
</A></li>
        <LI>Next message: <A HREF="024813.html">[mod_python] Physical paths ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24798">[ date ]</a>
              <a href="thread.html#24798">[ thread ]</a>
              <a href="subject.html#24798">[ subject ]</a>
              <a href="author.html#24798">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Please keep your replies on the list.

FYI. That code was setting req.application_root so you could use it as
a reference, not trying to use it.

Do:

  PythonHandler somemodulenameinrootofpspfilesdirectory .psp
  PythonHandler mod_python.psp .psp

In somemodulenameinrootofpspfilesdirectory.py have:

  import os

  def handler(req):
    req.application_root = os.path,dirname(__file__)
    return apache.OK

Read the documentation about stacked mod_python handlers to see how this works.

Have no time to read all this new mail now, maybe someone else will help.

Graham

---------- Forwarded message ----------
From: S.R.Pard&#225; &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">linux at qbox.es</A>&gt;
Date: 2 Feb 2008 21:26
Subject: Re: [mod_python] Physical paths ?
To: Graham Dumpleton &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">graham.dumpleton at gmail.com</A>&gt;


Thank You.

I'm using: PythonHandler mod_python.psp and req.application_root doesn't
exist.
But __file__ is '/usr/lib/python2.5/site-packages/mod_python/psp.pyc' in
the psp page, so it doen't seem related to the root of my app pages
where I wnt to save.



Anyway, I will try to explain it better, so it can help any other person
in the future looking for info like this.

Basically, I want the mod_python psp application, allow content upload
from the user client:

That's done in:         <A HREF="http://SERVER/MyApp/config/upload.psp">http://SERVER/MyApp/config/upload.psp</A>
(and that page is in /home/user/MyApp/config/index.psp)

And I want to save the user file to a directory accesible later at:
        <A HREF="http://SERVER/MyApp/images/users/USER_FILE">http://SERVER/MyApp/images/users/USER_FILE</A>
(that page would be in /home/user/MyApp/images/users)

So the upload.psp save the file received from form at that images
directory (instead of the form directory).



I wanted that the code from upload psp will pass a relative path from
the root of the App (/MyApp) to the module that saves the file, that is
something like:
        save_file(USER_FILE,&quot;images/users/&quot;, req)

I needed the save_file to obtain the physical path to the URL:
        '//SERVER' + '/MyApp/' + 'images/users/'
        (server + application_root + destiny_folder)
that is, the physical path to save the file:
        '/home/user/MyApp/config/index.psp'

Of course, I didn't wanted the function to use a constant to the root of
the application '/home/user/MyApp' (at code time) to allow to the
application to be independent from the installation directory.



I know req.filename give me the physical path to
<A HREF="http://SERVER/MyApp/config/upload.psp">http://SERVER/MyApp/config/upload.psp</A>
that is:
/home/user/MyApp/config/upload.psp

so I could save to '/home/user/MyApp/config/' without problem. And the
same in some subdirectory like '/home/user/MyApp/config/images/users/'.
I know.

But, I had an images directory in '/home/user/MyApp/images/', and maybe
I like the things in the hard way. And decide to save to that directory
of images (don't ask me why).
I know that ... application root is at '..' relative to the physical
directory of the page ('/home/user/MyApp/config/').
But I really like the things in the hard way and I wanted the save
function to be usable from any other pages in other directories, and I
don't wanted to send a constant relative path to the app root (remember
'/home/user/MyApp/') from every page to the save function (because, I
want app to be independent of the installation directory, and I don't
want to worry about the constant relative paths if I move the pages).


So, the code I'm using now, take the physical path of the page, and the
uri of the page , and the application root (uri), to obtain the physical
path of the application.
And from that , I can take the pyshical path of any subdirectory
relative to root (only if no subdirectory with alias are involved, of
course).

######
def physicalAppRoot(req):

  rootApp = req.get_options()['mod_python.session.application_path']
  pageDir, pageName = os.path.split(req.parsed_uri[6])

  if pageDir.startswith(rootApp):
     appPageDir = pageDir[len(rootApp):]
  else:
     appPageDir = pageDir

  physPath = os.path.dirname(req.filename)

  i = physPath.rfind(appPageDir)
  physAppRoot = physPath[:i]+os.path.sep

  return physAppRoot
######


The application path is an apache's directory alias, so option
application_path is indicated in the config (like you said me Graham, to
set different paths for cookies from various applications, and that
worked great for me).



That's work for me but, really all I wanted was some function like:

        physicalPath(uri = 'images/users/')
or
        physicalPath(uri = '/MyApp/images/users/')

that give me:  '/home/user/MyApp/images/users/'
for an apache mod_python application installed in /home/user/MyApp,
accessible at '<A HREF="http://server/MyApp'">http://server/MyApp'</A> (because an alias would be set at
apache 'alias /MyApp/ &quot;/home/user/MyApp&quot;').



Sorry, if I can explain it better. Maybe I'm doing a silly thing,
because an apache function available at mod_python does exctly this, but
I didn't found it.



Thank You,


        S.R.Pard&#225;



El s&#225;b, 02-02-2008 a las 08:36 +1100, Graham Dumpleton escribi&#243;:
&gt;<i> I think I only partly understand what you want. Anyway, work out what
</I>&gt;<i> the following would do if done in your mod_python handler.
</I>&gt;<i>
</I>&gt;<i>   import os
</I>&gt;<i>   req.application_root = os.path.dirname(__file__)
</I>&gt;<i>
</I>&gt;<i> Graham
</I>&gt;<i>
</I>&gt;<i> On 01/02/2008, S.R.Pard&#225; &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">linux at qbox.es</A>&gt; wrote:
</I>&gt;<i> &gt; Hi,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Now, thank you to your help,  my applicattion is capable of receive
</I>&gt;<i> &gt; image files from users using forms.
</I>&gt;<i> &gt; And app store them into a physical path of the server.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; It's possible to save from the app to an uri folder ?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Can I know the physical path of one uri ?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I can save easily to a subfolder of the pyhsical path obtained by
</I>&gt;<i> &gt; req.filename relative to the page visited, and that can work without
</I>&gt;<i> &gt; problem.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; But I would like the module (the module that implements the form
</I>&gt;<i> &gt; proccesing) receive the relative route relative to the root of the
</I>&gt;<i> &gt; application path, so module will not need to know the physical structure
</I>&gt;<i> &gt; of directories, and can save to a route not descendent of the directory
</I>&gt;<i> &gt; of my own page.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ... And in my app, the root of the app is a directory alias. outside of
</I>&gt;<i> &gt; the apache document_root '/var/www'
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; That's it
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;         DocumentRoot    /             /var/www
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;         Alias           MyApp         /home/user/MyApp/
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;         /MyApp/index.psp   .......... /home/user/MyApp/index.psp
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;         /MyApp/config/upload.psp  ... /home/user/MyApp/config/index.psp
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;         /MyApp/images/  ............. /home/user/MyApp/images/
</I>&gt;<i> &gt;         /MyApp/images/users/    ..... /home/user/MyApp/images/users/
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; And I want to obtain from code executed in
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;         http:/MyApp/config/upload.psp
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; the physical path of root of the application:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; so I can't sent to a function in form.py:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;         app_root = ???    # function that returns '/home/user/MyApp/'
</I>&gt;<i> &gt;         imgs_folder = 'images/users/'
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;         process(form, directory_to_save = app_root+imgs_folder)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; So, the code is independent of the installation directory and the app
</I>&gt;<i> &gt; path.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Another thing ... if images would be an alias, &#191; could I know the path ?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Thank You again.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;         S.R.Parda
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; Mod_python mailing list
</I>&gt;<i> &gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> &gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i> &gt;
</I>
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024799.html">[mod_python] Problem getting the Publisher handler to return
	nothing
</A></li>
	<LI>Next message: <A HREF="024813.html">[mod_python] Physical paths ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24798">[ date ]</a>
              <a href="thread.html#24798">[ thread ]</a>
              <a href="subject.html#24798">[ subject ]</a>
              <a href="author.html#24798">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
