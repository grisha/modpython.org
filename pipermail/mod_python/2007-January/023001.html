<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Several handlers
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Several%20handlers&In-Reply-To=45A90A22.15187.C1ABA3B%40export.hope.cz">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022999.html">
   <LINK REL="Next"  HREF="023002.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Several handlers</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Several%20handlers&In-Reply-To=45A90A22.15187.C1ABA3B%40export.hope.cz"
       TITLE="[mod_python] Several handlers">grahamd at dscpl.com.au
       </A><BR>
    <I>Sat Jan 13 21:37:55 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="022999.html">[mod_python] Several handlers
</A></li>
        <LI>Next message: <A HREF="023002.html">[mod_python] Starting a background process with mod_python?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23001">[ date ]</a>
              <a href="thread.html#23001">[ thread ]</a>
              <a href="subject.html#23001">[ subject ]</a>
              <a href="author.html#23001">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On 14/01/2007, at 2:34 AM, <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">export at hope.cz</A> wrote:

&gt;<i> Graham,
</I>&gt;<i> Thank you for your help.
</I>&gt;<i> Now Apache can find my inputinput filter.
</I>&gt;<i> Here it is:
</I>&gt;<i> ################
</I>&gt;<i> from mod_python import apache
</I>&gt;<i> import os, shutil
</I>&gt;<i>
</I>&gt;<i> def log(text):
</I>&gt;<i>     f = open('C:/Python23/Lib/site-packages/django/core/handlers/ 
</I>&gt;<i> log', 'a')
</I>&gt;<i>     f.write(text)
</I>&gt;<i>     f.write('\n')
</I>&gt;<i>     f.close()
</I>&gt;<i>
</I>&gt;<i> def inputfilter(filter):
</I>&gt;<i>     if filter.req.method != 'POST':
</I>&gt;<i>         filter.disable()
</I>
Normally 'filter.pass_on()' would be used here, not 'filter.disable()'.

&gt;<i>         return
</I>&gt;<i>     f=open('C:/Python23/Lib/site-packages/django/core/handlers/ 
</I>&gt;<i> filter.log','ab')
</I>&gt;<i>     log('first read')
</I>
You would be better of using Apache's own logging mechanism instead
of your own. Thus instead use:

   filter.req.log_error('first read')

The messages will then appear in the Apache error log whatever that  
may be
on Windows.

&gt;<i>     s = filter.read()
</I>&gt;<i>     while s:
</I>&gt;<i>         log('writing (%s)' % len(s))
</I>&gt;<i>         f.write(s)
</I>&gt;<i>         f.flush()
</I>&gt;<i>         filter.write(s)
</I>&gt;<i>         log('loop read')
</I>&gt;<i>         filter.flush()
</I>
It is not necessary to explicitly flush the filter. Leave this out  
until you have
a reason for really doing it.

&gt;<i>         s = filter.read()
</I>&gt;<i>     if s is None:
</I>&gt;<i>         log('closing')
</I>&gt;<i>         filter.close()
</I>&gt;<i>         raise &quot;error&quot;
</I>
Huh!!!!  Your raising an exception here. Do you really mean to do  
that? This
would always result in the client getting back an error. The  
following 'f.close()'
would never be called, so you would be at the mercy of the garbage  
collector
as far as the file being closed. If for some reason that isn't being  
done straight
away it could cause resources to run out.

&gt;<i>       f.close()
</I>&gt;<i> ################
</I>&gt;<i> But I would expect that it will read some data, write to a file and  
</I>&gt;<i> release the memory and
</I>&gt;<i> again.
</I>&gt;<i> But it does NOT. As it reads more and more data more and more  
</I>&gt;<i> memory is used - no
</I>&gt;<i> memory is released. As a result, python program  crashes because of  
</I>&gt;<i> little memory available.
</I>&gt;<i> Am I right if I suppose that the memory allocation should not  
</I>&gt;<i> increase during reading data?
</I>&gt;<i> Or am I wrong?
</I>&gt;<i> Thank you again for help
</I>
Fix up the things noted first and use Apache's logging facility  
instead of
your own and see if there is a difference.


Graham
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022999.html">[mod_python] Several handlers
</A></li>
	<LI>Next message: <A HREF="023002.html">[mod_python] Starting a background process with mod_python?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23001">[ date ]</a>
              <a href="thread.html#23001">[ thread ]</a>
              <a href="subject.html#23001">[ subject ]</a>
              <a href="author.html#23001">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
