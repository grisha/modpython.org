<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] in modpython ,how to restrict the upload file size?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20in%20modpython%20%2Chow%20to%20restrict%20the%20upload%20file%20size%3F&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023139.html">
   <LINK REL="Next"  HREF="023136.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] in modpython ,how to restrict the upload file size?</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Clodoaldo</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20in%20modpython%20%2Chow%20to%20restrict%20the%20upload%20file%20size%3F&In-Reply-To="
       TITLE="[mod_python] in modpython ,how to restrict the upload file size?">clodoaldo.pinto.neto at gmail.com
       </A><BR>
    <I>Wed Jan 31 12:10:59 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="023139.html">[mod_python] wsgi support?
</A></li>
        <LI>Next message: <A HREF="023136.html">[mod_python] How to set utf-8 charset from mod_python?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23135">[ date ]</a>
              <a href="thread.html#23135">[ thread ]</a>
              <a href="subject.html#23135">[ subject ]</a>
              <a href="author.html#23135">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Jorey Bump Wed Sep 20 08:18:40 EDT 2006
&gt;<i>yjfuk wrote:
</I>&gt;&gt;<i> in modpython ,how to restrict the upload file size?
</I>
&gt;<i>I prefer to do this in the apache config, so it applies to all applications:
</I>
&gt;<i># limit size of uploads
</I>&gt;<i># 3MB
</I>&gt;<i>LimitRequestBody 3072000
</I>
I'm using modpython 3.3 and publisher.

I'm trying to use the LimitRequestBody directive and it works to
prevent the uploding of big files.

The problem I'm having is that although an error is logged by Apache,
a 200 response is sent to the browser. It looks like my publisher
module is not called after Apache catches the file upload error or it
is called and somehow a 20 bytes body is sent with a 200 code. I can't
see those 20 bytes in the browser, the html source is blank.

I would like my publisher module to be called so I can handle the
error and send an appropriate page to the client. Is it possible with
the publisher?

[Wed Jan 31 15:59:47 2007] [error] [client 10.1.1.101] Requested
content-length of 1482946 is larger than the configured limit of
50000, referer: <A HREF="http://carroarodo.s0/upload_fotos">http://carroarodo.s0/upload_fotos</A>

10.1.1.101 - - [31/Jan/2007:15:59:47 +0000] &quot;POST /upload_fotos
HTTP/1.1&quot; 200 20 &quot;<A HREF="http://carroarodo.s0/upload_fotos&quot;">http://carroarodo.s0/upload_fotos&quot;</A> &quot;Mozilla/5.0
(X11; U; Linux i686; en-US; rv:1.8.0.9) Gecko/20061221
Fedora/1.5.0.9-1.fc5 Firefox/1.5.0.9&quot;

&lt;VirtualHost 10.1.1.103:80&gt;
    ServerName carroarodo.s0
    ServerAdmin <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">admin at carroarodo.com</A>
    DocumentRoot /var/www/html/carroarodo.com
    ErrorLog logs/carroarodo.s0-error_log
    CustomLog logs/carroarodo.s0-access_log combined
    LimitRequestBody 50000
    PythonDebug On
    &lt;Directory /var/www/html/carroarodo.com&gt;
       SetHandler mod_python
       PythonHandler ~/_publisher.py
       PythonOption mod_python.importer.path &quot;['~/mod']&quot;
    &lt;/Directory&gt;
    &lt;Directory /var/www/html/carroarodo.com/mod&gt;
       Order Allow,Deny
       Deny from all
    &lt;/Directory&gt;
    &lt;Directory /var/www/html/carroarodo.com/pub/fotos&gt;
       ExpiresActive On
       ExpiresDefault &quot;access plus 0 hours&quot;
    &lt;/Directory&gt;
    Options -Indexes
    &lt;Files ~ &quot;\.(gif|jpg|png|css|js)$&quot;&gt;
       SetHandler default-handler
    &lt;/Files&gt;
&lt;/VirtualHost&gt;

$ cat _publisher.py
from mod_python import publisher

def handler(req):
   req.add_output_filter('DEFLATE')
   return publisher.handler(req)

Regards,
-- 
Clodoaldo Pinto Neto
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023139.html">[mod_python] wsgi support?
</A></li>
	<LI>Next message: <A HREF="023136.html">[mod_python] How to set utf-8 charset from mod_python?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23135">[ date ]</a>
              <a href="thread.html#23135">[ thread ]</a>
              <a href="subject.html#23135">[ subject ]</a>
              <a href="author.html#23135">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
