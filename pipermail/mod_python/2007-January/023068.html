<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Memory error
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Memory%20error&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023131.html">
   <LINK REL="Next"  HREF="023072.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Memory error</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Memory%20error&In-Reply-To="
       TITLE="[mod_python] Memory error">grahamd at dscpl.com.au
       </A><BR>
    <I>Mon Jan 22 16:28:23 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="023131.html">[mod_python] Memory error
</A></li>
        <LI>Next message: <A HREF="023072.html">[mod_python] Memory error
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23068">[ date ]</a>
              <a href="thread.html#23068">[ thread ]</a>
              <a href="subject.html#23068">[ subject ]</a>
              <a href="author.html#23068">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">export at hope.cz</A> wrote ..
&gt;<i> I spent some time to write an input filter hoping  that an input filter
</I>&gt;<i> will
</I>&gt;<i> help me upload large files without memory errors.
</I>&gt;<i> But it does NOT help.
</I>&gt;<i> When I checked Apache error log today I saw:
</I>&gt;<i> MemoryError, referer: <A HREF="http://127.0.0.1/mod/mptest.py?17644">http://127.0.0.1/mod/mptest.py?17644</A>
</I>&gt;<i> 
</I>&gt;<i> ( mptest.py is handler I use for uploading .)
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>  I use
</I>&gt;<i> Apache 2.2.4
</I>&gt;<i> Mod_python 3.3.0.b
</I>&gt;<i> Python 2.3.5
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Input filter looks like this
</I>&gt;<i> 
</I>&gt;<i> def inputfilter(filter):
</I>&gt;<i> 	if filter.req.method != 'POST':
</I>&gt;<i> 		filter.pass_on()
</I>&gt;<i> 		return
</I>&gt;<i> 	f=open('uploadedfile','ab')
</I>
Where the file will be placed is unpredictable. You should use an
absolute path to the file. You should also be using some unique
name for the actual file else concurrent uploads will interfere with
each other. The name you use for the file should be passed through
to your request handler by setting an attribute in filter.req, ie.,

  filter.req.uploadfilename = &quot;someuniquename&quot;
 	
&gt;<i> 	s = filter.read()
</I>&gt;<i> 	while s:
</I>&gt;<i> 		f.write(s)
</I>&gt;<i> 		f.flush()
</I>&gt;<i> 		filter.write(s)
</I>&gt;<i> 		filter.flush()
</I>
If you are wanting the data to be written to a file but not take up
memory in Apache as well, you shouldn't be also writing the data
onto the filter object as by doing so it isn't being discarded and
your process will run out of memory.

&gt;<i> 		s = filter.read()
</I>&gt;<i> 	if s is None:
</I>&gt;<i> 		filter.close()
</I>&gt;<i> 		f.close()
</I>&gt;<i> 
</I>&gt;<i> Can anyone help? Will input filter really help or not?
</I>&gt;<i> Does anyone have any experience with uploading large files( 100 MB and
</I>&gt;<i> higher)?
</I>
I can't remember if it was you again or someone else has been asking about
input filters and large file uploads, but I have already pointed out Tramline
in a post recently, which can be used as a working example of how to do this
sort of stuff. The only difference in Tramline was that the final request was
being proxied through to a backend, so it was setting the filename in a header
rather than an attribute of the request object. The URL for Tramline again is:

  <A HREF="http://www.infrae.com/products/tramline">http://www.infrae.com/products/tramline</A>

Graham
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023131.html">[mod_python] Memory error
</A></li>
	<LI>Next message: <A HREF="023072.html">[mod_python] Memory error
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23068">[ date ]</a>
              <a href="thread.html#23068">[ thread ]</a>
              <a href="subject.html#23068">[ subject ]</a>
              <a href="author.html#23068">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
