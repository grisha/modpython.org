<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] strange behaviour with compressed response
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20strange%20behaviour%20with%20compressed%20response&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022916.html">
   <LINK REL="Next"  HREF="022921.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] strange behaviour with compressed response</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20strange%20behaviour%20with%20compressed%20response&In-Reply-To="
       TITLE="[mod_python] strange behaviour with compressed response">grahamd at dscpl.com.au
       </A><BR>
    <I>Wed Jan  3 16:05:59 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="022916.html">[mod_python] strange behaviour with compressed response
</A></li>
        <LI>Next message: <A HREF="022921.html">[mod_python] session and psp.redirect
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22920">[ date ]</a>
              <a href="thread.html#22920">[ thread ]</a>
              <a href="subject.html#22920">[ subject ]</a>
              <a href="author.html#22920">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Jim Gallacher wrote ..
&gt;<i> m.banaouas wrote:
</I>&gt;<i> &gt; Hi,
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt;  &gt;req.sendfile('c:/apache/htdocs/myfile.xml')
</I>&gt;<i> &gt; In my real case, the response contain &quot;dynamic&quot; data built with database
</I>&gt;<i> &gt; extracted rows.
</I>&gt;<i> &gt; So it's may be not the best thing to do (storing it first in a file).
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt;  &gt;       SetOutputFilter DEFLATE
</I>&gt;<i> &gt; Now, it works finally! even without this directive.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; In fact the right question would be:
</I>&gt;<i> &gt; &quot;what is the difference between req.write(bla) and return bla ?&quot;
</I>&gt;<i> 
</I>&gt;<i> Very little. When you return something using mod_python.publisher, it 
</I>&gt;<i> still calls req.write() internally.
</I>&gt;<i> 
</I>&gt;<i> Perhaps the biggest difference is that mod_python.publisher calls 
</I>&gt;<i> req.write with flush=0, whereas the default is flush=1.
</I>&gt;<i> 
</I>&gt;<i> This could have implications concerning the setting of the 
</I>&gt;<i> Content-Length header versus use of Transfer-Encoding: chunked. (I'm not
</I>&gt;<i> 100% sure about that, but I have the idea that by not immediately 
</I>&gt;<i> flushing to the client Apache may be able to set the Content-Length header).
</I>
Correct. One can use:

  req.add_output_filter('CONTENT_LENGTH')

and provided all writes have flush=0, Apache will be able to set the
content length output header for you automatically.

Obviously, in doing this, all the content is buffered up within Apache
so doing it on very large files would not be a good idea.

The AddOutputFilter directive can also be used in the Apache
configuration to add this output filter to the processing chain.

Graham

&gt;<i> On the other hand, your client is using HTTP/1.0 which may introduce 
</I>&gt;<i> other complications. (IIRC HTTP/1.0 does not support Transfer-Encoding)
</I>&gt;<i> 
</I>&gt;<i>   &gt; Firefox browser is certainly http-tolerant and can manage some
</I>&gt;<i> &gt; &quot;imperfect&quot; http dialogs.
</I>&gt;<i> &gt; Of course, the problem I meet could be caused by bad implementation in
</I>&gt;<i> &gt; MyHttpClient side.
</I>&gt;<i> &gt; But the same comp in the sames conditions fails when response is 
</I>&gt;<i> &gt; &quot;written&quot; and works fine when the response is &quot;returned&quot;, bizare non
</I>&gt;<i> ?
</I>&gt;<i> 
</I>&gt;<i> I suspect it may be some implementation detail in your client.
</I>&gt;<i> 
</I>&gt;<i> Jim
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I></PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022916.html">[mod_python] strange behaviour with compressed response
</A></li>
	<LI>Next message: <A HREF="022921.html">[mod_python] session and psp.redirect
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22920">[ date ]</a>
              <a href="thread.html#22920">[ thread ]</a>
              <a href="subject.html#22920">[ subject ]</a>
              <a href="author.html#22920">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
