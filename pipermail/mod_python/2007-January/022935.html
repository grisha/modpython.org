<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Application session
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Application%20session&In-Reply-To=20070107034935.35e44f46%40localhost">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022934.html">
   <LINK REL="Next"  HREF="022936.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Application session</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Application%20session&In-Reply-To=20070107034935.35e44f46%40localhost"
       TITLE="[mod_python] Application session">grahamd at dscpl.com.au
       </A><BR>
    <I>Sun Jan  7 00:46:13 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="022934.html">[mod_python] Application session
</A></li>
        <LI>Next message: <A HREF="022936.html">[mod_python] Application session
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22935">[ date ]</a>
              <a href="thread.html#22935">[ thread ]</a>
              <a href="subject.html#22935">[ subject ]</a>
              <a href="author.html#22935">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Have forwarded this back to the list. Please keep followups there.

Depending on what you are doing, you might want to look at memcached
for Python as a way of sharing memory between Apache child processes.
Alternatively, look at XML-RPC as a way to connect to a long lived back
end process which contains the true application.

For even more complicated systems, can also suggest messaging system
based solutions for communicating with a back end system. These have
the benefit of not requiring a separate socket connection for each  
request
like XML-RPC does. Down the track, if interested in these, let me know.

Graham

On 07/01/2007, at 1:49 PM, Michael Rasmussen wrote:

&gt;<i> -----BEGIN PGP SIGNED MESSAGE-----
</I>&gt;<i> Hash: SHA1
</I>&gt;<i>
</I>&gt;<i> Hi Graham,
</I>&gt;<i>
</I>&gt;<i> I might have solve my problems. Your article helped a lot.
</I>&gt;<i> Read my solution a clarification of my problem below.
</I>&gt;<i>
</I>&gt;<i> On Sat, 6 Jan 2007 11:38:14 +1100
</I>&gt;<i> Graham Dumpleton &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">grahamd at dscpl.com.au</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> You might then perhaps explain better what you are talking about.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> In short, any module that is imported within the context of a Python
</I>&gt;&gt;<i> interpreter instance is usable by any handler executing within that
</I>&gt;&gt;<i> Python interpreter instance in that process. This is totally
</I>&gt;&gt;<i> unrelated to
</I>&gt;&gt;<i> user sessions created as a result of some form based/login mechanism.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> What isn't clear is whether when you say 'sessions' you are talking
</I>&gt;&gt;<i> about user sessions or merely concurrent executing request handlers.
</I>&gt;&gt;<i>
</I>&gt;<i> The picture:
</I>&gt;<i>
</I>&gt;<i> I have an application which provides admin users the ability to add
</I>&gt;<i> extensions into the runtime. These extensions must be available to all
</I>&gt;<i> users as soon as they are instantiated without the users needs for
</I>&gt;<i> restarting their sessions. The extensions must also be persistent in
</I>&gt;<i> the runtime until either the application/apache is restarted or they
</I>&gt;<i> deactivated by the admin users. Had the application been programmed in
</I>&gt;<i> Java - JSP/Servlets, such extensions would have be stored in the
</I>&gt;<i> application session: &lt;jsp:useBean id=&quot;applicationBean&quot;
</I>&gt;<i> class=&quot;some.Bean&quot; scope=&quot;application&quot; /&gt;. This means that for any user
</I>&gt;<i> session currently and later on can access the bean and its members. In
</I>&gt;<i> Java/JSP you operate with four different kinds of scope: page,  
</I>&gt;<i> request,
</I>&gt;<i> session and application. the first three are all related to the same
</I>&gt;<i> user session in the said application while the last one is related to
</I>&gt;<i> the application instance and the by nature related to all users of the
</I>&gt;<i> application. Studying your article proved to me that mod_python does
</I>&gt;<i> not provide application scope directly?
</I>&gt;<i>
</I>&gt;<i> My application is running in apache under GNU/Linux so it is  
</I>&gt;<i> restricted
</I>&gt;<i> to the problems described in your article - prefork and worker. By the
</I>&gt;<i> way does this problem also apply to MPM worker?
</I>&gt;<i>
</I>&gt;<i> What I have found out is this:
</I>&gt;<i> I thought I could create a class implementing the singleton pattern  
</I>&gt;<i> and
</I>&gt;<i> store an instance of the class to the request object but even if a
</I>&gt;<i> directory/virtual host only designates one python handler one cannot
</I>&gt;<i> rely on that all instances will share the same python
</I>&gt;<i> runtime/pythonHandler due to apache's forking nature so this was a
</I>&gt;<i> dead-end.
</I>&gt;<i>
</I>&gt;<i> So my final solution was to create the said singleton class and in  
</I>&gt;<i> this
</I>&gt;<i> class save private attributes with instance information of the object
</I>&gt;<i> store in dictionaries and then use cPickle to store and load the
</I>&gt;<i> object's state. Since I cannot control when an instance of the
</I>&gt;<i> singleton class is unloaded from the session I was forced to save the
</I>&gt;<i> state of the object every time the object's state change.
</I>&gt;<i>
</I>&gt;<i> If anybody is interested you can find my solution below
</I>&gt;<i>
</I>&gt;<i> &quot;&quot;&quot;
</I>&gt;<i> IPCop Module Loader.
</I>&gt;<i>
</I>&gt;<i> This module is licensed under GPL and is part of the UI to IPCop.
</I>&gt;<i> Read online documentation &lt;<A HREF="http://www.ipcop.org">http://www.ipcop.org</A>&gt;.
</I>&gt;<i>
</I>&gt;<i> Copyright: 2006, Michael Rasmussen &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mir at datanom.net</A>&gt;
</I>&gt;<i>
</I>&gt;<i> Last maintainer: 2006-08-21 18:57 +0200 Michael Rasmussen
</I>&gt;<i> &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mir at datanom.net</A>&gt;
</I>&gt;<i>
</I>&gt;<i> Previous maintainers:
</I>&gt;<i>
</I>&gt;<i> If you find any bugs or have any comments please send an email to
</I>&gt;<i> Michael Rasmussen &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mir at datanom.net</A>&gt;
</I>&gt;<i> &quot;&quot;&quot;
</I>&gt;<i>
</I>&gt;<i> VERSION = &quot;0.1&quot;
</I>&gt;<i>
</I>&gt;<i> import os, sys, new, cPickle, anydbm, tempfile, ModuleImporter
</I>&gt;<i>
</I>&gt;<i> class ModuleLoaderException(Exception):
</I>&gt;<i>     def __init__(self, msg):
</I>&gt;<i>         self.value = msg
</I>&gt;<i>
</I>&gt;<i>     def __str__(self):
</I>&gt;<i>         return repr(self.value)
</I>&gt;<i>
</I>&gt;<i> class ModuleLoader:
</I>&gt;<i>     &quot;&quot;&quot;
</I>&gt;<i>         Available modules contains reference to
</I>&gt;<i>         registered modules.
</I>&gt;<i>         Key: ModuleId
</I>&gt;<i>         Item: Reference to a module
</I>&gt;<i>     &quot;&quot;&quot;
</I>&gt;<i>
</I>&gt;<i>     __instance = None
</I>&gt;<i>
</I>&gt;<i>     def __init__(self):
</I>&gt;<i>         if ModuleLoader.__instance is None :
</I>&gt;<i>             ModuleLoader.__instance = ModuleLoader.__singleton()
</I>&gt;<i>         self.__dict__['_ModuleLoader__instance'] =
</I>&gt;<i> ModuleLoader.__instance def __getattr__(self, attr):
</I>&gt;<i>         return getattr(self.__instance, attr)
</I>&gt;<i>
</I>&gt;<i>     def __setattr__(self, attr, value):
</I>&gt;<i>         return setattr(self.__instance, attr, value)
</I>&gt;<i>
</I>&gt;<i>     class __singleton:
</I>&gt;<i>
</I>&gt;<i>         def __init__(self):
</I>&gt;<i>             dbmIn = anydbm.open(tempfile.gettempdir() +
</I>&gt;<i> 		&quot;/ipcop_modules.dbm&quot;, &quot;c&quot;)
</I>&gt;<i> 	    try:
</I>&gt;<i>                 self.__availableModules =
</I>&gt;<i>                     cPickle.loads(dbmIn[&quot;availableModules&quot;])
</I>&gt;<i>             except KeyError:
</I>&gt;<i>                 self.__availableModules = {}
</I>&gt;<i>             try:
</I>&gt;<i>                 self.__activeModules =
</I>&gt;<i>                     cPickle.loads(dbmIn[&quot;activeModules&quot;])
</I>&gt;<i>             except KeyError:
</I>&gt;<i>                 self.__activeModules = {}
</I>&gt;<i>             dbmIn.close()
</I>&gt;<i>
</I>&gt;<i>         def getModulesList(self):
</I>&gt;<i>             try:
</I>&gt;<i>                 return self.__availableModules
</I>&gt;<i>             except AttributeError:
</I>&gt;<i>                 return {}
</I>&gt;<i>
</I>&gt;<i>         def setModulesList(self, list):
</I>&gt;<i>             self.__availableModules = list
</I>&gt;<i>             dbmOut = anydbm.open(tempfile.gettempdir() +
</I>&gt;<i>                 &quot;/ipcop_modules.dbm&quot;, &quot;c&quot;)
</I>&gt;<i>             dbmOut[&quot;availableModules&quot;] =
</I>&gt;<i>                 cPickle.dumps(self.getModulesList(), 1)
</I>&gt;<i>             dbmOut.close()
</I>&gt;<i>
</I>&gt;<i>         def setAvailableModule(self, name, desc):
</I>&gt;<i>             self.__availableModules[name] = desc
</I>&gt;<i>             dbmOut = anydbm.open(tempfile.gettempdir() +
</I>&gt;<i>                 &quot;/ipcop_modules.dbm&quot;, &quot;c&quot;)
</I>&gt;<i>             dbmOut[&quot;availableModules&quot;] =
</I>&gt;<i>                 cPickle.dumps(self.getModulesList(), 1)
</I>&gt;<i>             dbmOut.close()
</I>&gt;<i>
</I>&gt;<i>         def register(self, module, path = None):
</I>&gt;<i>             try:
</I>&gt;<i>                 if path != None:
</I>&gt;<i>                     if (path.find(&quot;.&quot;) != -1):
</I>&gt;<i>                         raise ModuleLoaderException(&quot;Illegal character
</I>&gt;<i> in path&quot;)
</I>&gt;<i>                     if (not path.startswith(&quot;/&quot;)):
</I>&gt;<i>                         if (os.getcwd() != '/'):
</I>&gt;<i>                             path = os.getcwd() + &quot;/&quot; + path
</I>&gt;<i>                         else:
</I>&gt;<i>                             path = &quot;/&quot; + path
</I>&gt;<i>                     if (path in sys.path):
</I>&gt;<i>                         pass
</I>&gt;<i>                     else:
</I>&gt;<i>                         sys.path.append(path)
</I>&gt;<i>                 mod = ModuleImporter.get_mod(module)
</I>&gt;<i>                 try:
</I>&gt;<i>                     modules = getattr(mod,&quot;__all__&quot;)
</I>&gt;<i>                     for m in modules:
</I>&gt;<i>                         self.register(module + &quot;.&quot; + m)
</I>&gt;<i>                 except AttributeError:
</I>&gt;<i>                     lastDot = module.rfind(u&quot;.&quot;)
</I>&gt;<i>                     module = module[lastDot + 1:]
</I>&gt;<i>                     self.setAvailableModule(module, getattr(mod,
</I>&gt;<i> &quot;__name__&quot;))
</I>&gt;<i>                     ModuleImporter.del_mod(getattr(mod, &quot;__name__&quot;))
</I>&gt;<i>             except Exception, ex:
</I>&gt;<i>                 raise ModuleLoaderException(&quot;Loading module: %s&quot; % ex)
</I>&gt;<i>
</I>&gt;<i>         def unregister(self, module):
</I>&gt;<i>             &quot;&quot;&quot; unregister &quot;&quot;&quot;
</I>&gt;<i>             t = self.getModulesList()
</I>&gt;<i>             del t[module]
</I>&gt;<i>             self.setModulesList(t)
</I>&gt;<i>             dbmOut = anydbm.open(tempfile.gettempdir() +
</I>&gt;<i> &quot;/ipcop_modules.dbm&quot;, &quot;c&quot;)
</I>&gt;<i>             dbmOut[&quot;availableModules&quot;] =
</I>&gt;<i> cPickle.dumps(self.getModulesList(), 1)
</I>&gt;<i>             dbmOut.close()
</I>&gt;<i>             ModuleImporter.del_mod(getattr(module, &quot;__name__&quot;))
</I>&gt;<i>
</I>&gt;<i> - --
</I>&gt;<i> Hilsen/Regards
</I>&gt;<i> Michael Rasmussen
</I>&gt;<i>
</I>&gt;<i> Get my public GnuPG keys:
</I>&gt;<i> michael &lt;at&gt; rasmussen &lt;dot&gt; cc
</I>&gt;<i> <A HREF="http://keyserver.veridis.com:11371/pks/lookup?op=get&amp;search=0xD3C9A00E">http://keyserver.veridis.com:11371/pks/lookup?op=get&amp;search=0xD3C9A00E</A>
</I>&gt;<i> mir &lt;at&gt; datanom &lt;dot&gt; net
</I>&gt;<i> <A HREF="http://keyserver.veridis.com:11371/pks/lookup?op=get&amp;search=0xE501F51C">http://keyserver.veridis.com:11371/pks/lookup?op=get&amp;search=0xE501F51C</A>
</I>&gt;<i> mir &lt;at&gt; miras &lt;dot&gt; org
</I>&gt;<i> <A HREF="http://keyserver.veridis.com:11371/pks/lookup?op=get&amp;search=0xE3E80917">http://keyserver.veridis.com:11371/pks/lookup?op=get&amp;search=0xE3E80917</A>
</I>&gt;<i> - --------------------------------------------------------------
</I>&gt;<i> It's all in the mind, ya know.
</I>&gt;<i> -----BEGIN PGP SIGNATURE-----
</I>&gt;<i> Version: GnuPG v1.4.6 (GNU/Linux)
</I>&gt;<i>
</I>&gt;<i> iD8DBQFFoF+/VErYVePoCRcRAtV3AKCiqlVRGu+l8KVno28zxC/6tkl4cgCfQU4L
</I>&gt;<i> 5Rb3VaXrFtWehT7S5Al+2nk=
</I>&gt;<i> =io+9
</I>&gt;<i> -----END PGP SIGNATURE-----
</I></PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022934.html">[mod_python] Application session
</A></li>
	<LI>Next message: <A HREF="022936.html">[mod_python] Application session
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22935">[ date ]</a>
              <a href="thread.html#22935">[ thread ]</a>
              <a href="subject.html#22935">[ subject ]</a>
              <a href="author.html#22935">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
