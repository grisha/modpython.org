<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] how to define publisher when page not found
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20how%20to%20define%20publisher%20when%20page%20not%20found&In-Reply-To=51F7D9A7-8FA0-41C7-8563-6C64BCCDF579%40dscpl.com.au">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023013.html">
   <LINK REL="Next"  HREF="023010.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] how to define publisher when page not found</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Maksim Kasimov</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20how%20to%20define%20publisher%20when%20page%20not%20found&In-Reply-To=51F7D9A7-8FA0-41C7-8563-6C64BCCDF579%40dscpl.com.au"
       TITLE="[mod_python] how to define publisher when page not found">maksim.kasimov at gmail.com
       </A><BR>
    <I>Tue Jan 16 07:14:44 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="023013.html">[mod_python] how to define publisher when page not found
</A></li>
        <LI>Next message: <A HREF="023010.html">[mod_python] Decoding POST requests
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23014">[ date ]</a>
              <a href="thread.html#23014">[ thread ]</a>
              <a href="subject.html#23014">[ subject ]</a>
              <a href="author.html#23014">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 1/16/07, Graham Dumpleton &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">grahamd at dscpl.com.au</A>&gt; wrote:
&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 16/01/2007, at 9:07 PM, Maksim Kasimov wrote:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 1/15/07, Graham Dumpleton &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">grahamd at dscpl.com.au</A>&gt; wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Maksim Kasimov wrote ..
</I>&gt;<i> &gt; &gt; hi,
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; in apache conf file i use:
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;     &lt;Directory &quot;/mypath/mydir&quot;&gt;
</I>&gt;<i> &gt; &gt;         SetHandler python-program
</I>&gt;<i> &gt; &gt;         PythonHandler mod_python.publisher
</I>&gt;<i> &gt; &gt;     &lt;/Directory&gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; there is file:
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; in file  /mypath/mydir/index.py there some functions:
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; def index(req):
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;     return &quot;index&quot;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; def free(req):
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;     return 'free'
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; def not_found(req):
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;     # some computation
</I>&gt;<i> &gt; &gt;     return 'page not found'
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; and every thing is just fine and works as expected:
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;        for <A HREF="http://myhostname.org/mydir/free">http://myhostname.org/mydir/free</A> i can see &quot;free&quot;
</I>&gt;<i> &gt; &gt;        for <A HREF="http://myhostname.org/mydir/">http://myhostname.org/mydir/</A> i can see &quot;index&quot;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; my question is: How to get output of &quot;not_found&quot; function for any
</I>&gt;<i> &gt; other
</I>&gt;<i> &gt; &gt; uri,
</I>&gt;<i> &gt; &gt; such as &quot; <A HREF="http://myhostname.org/mydir/hello&quot;">http://myhostname.org/mydir/hello&quot;</A> ?
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; many thanks for any advice.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Use the Apache ErrorDocument directive, specifying the URL to the
</I>&gt;<i> &gt; not_found
</I>&gt;<i> &gt; function as the argument.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Graham
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i> it is very inconveniently because:
</I>&gt;<i>     1) in the directory &quot;mydir&quot; there can be a lot of *.py scripts (not
</I>&gt;<i> only index.py), and i need to specify some default handler for each of
</I>&gt;<i> module in the directory.
</I>&gt;<i>     2) it makes superfluous redirections
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> But if it is only for not found errors, it wouldn't occur much so why
</I>&gt;<i> would
</I>&gt;<i> it matter.
</I>&gt;<i>
</I>&gt;<i> So my question is still opened.
</I>&gt;<i>
</I>&gt;<i> To provide this, temporary, i've changed resolve_object function in
</I>&gt;<i> publisher.py from mod_python in that way:
</I>&gt;<i>
</I>&gt;<i>         try:
</I>&gt;<i>             #obj = getattr(obj, obj_str)
</I>&gt;<i>             obj = getattr(obj, obj_str, getattr(obj, '_default'))
</I>&gt;<i>         except AttributeError:
</I>&gt;<i>             raise apache.SERVER_RETURN, apache.HTTP_NOT_FOUND
</I>&gt;<i>
</I>&gt;<i> than, i will define _default function in my /mypath/mydir/index.py or any
</I>&gt;<i> other modules in mydir.
</I>&gt;<i>
</I>&gt;<i> i think it is very wrong to change standart libraries, but i did not found
</I>&gt;<i> the way, how to redifine this behavior in my index.py file.
</I>&gt;<i>
</I>&gt;<i> is it possible to define some function in my module, to make it return
</I>&gt;<i> default attribute for getattr function?
</I>&gt;<i> or may be, if i dare, to expect such changes as above in future releases
</I>&gt;<i> of mod_python?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> It is unlikely you will see such a feature in future versions of
</I>&gt;<i> mod_python.
</I>&gt;<i> I also question why you would want to do that anyway, ie., have a separate
</I>&gt;<i> not found page for every file resource. Care to explain what you thing you
</I>&gt;<i> get from it? Maybe you shouldn't be using mod_python.publisher but should
</I>&gt;<i> be writing a custom dispatcher of your own.
</I>&gt;<i>
</I>&gt;<i> BTW, you could always do the following:
</I>&gt;<i>
</I>&gt;<i>   SetHandler mypublisherwrapper
</I>&gt;<i>
</I>&gt;<i> Then in handler() of mypublisherwrapper do something like (untested):
</I>&gt;<i>
</I>&gt;<i>   from mod_python import apache, publisher
</I>&gt;<i>
</I>&gt;<i>   def handler(req):
</I>&gt;<i>     try:
</I>&gt;<i>       result = publisher.handler(req)
</I>&gt;<i>     except SERVER_RETURN, value:
</I>&gt;<i>             try:
</I>&gt;<i>                 if len(value.args) == 2:
</I>&gt;<i>                     raise
</I>&gt;<i>                 else:
</I>&gt;<i>                     result = value.args[0]
</I>&gt;<i>
</I>&gt;<i>      if result == apache.HTTP_NOT_FOUND:
</I>&gt;<i>         req.filename = req.filename + '/err404'
</I>&gt;<i>         req.path_info = ''
</I>&gt;<i>         result = publisher.handler(req)
</I>&gt;<i>
</I>&gt;<i>     return result
</I>&gt;<i>
</I>&gt;<i> although I wouldn't recommend it.
</I>&gt;<i>
</I>&gt;<i> Anyway, please explain why as there is probably a better way of doing it
</I>&gt;<i> butnot knowing what you are trying to achieve makes it very hard to
</I>&gt;<i> suggest
</I>&gt;<i> anything.
</I>&gt;<i> Graham
</I>&gt;<i>
</I>
Hi Graham, i'm very pleased to get your answer, thank you!

&gt;<i>I also question why you would want to do that anyway, ie., have a separate
</I>&gt;<i>not found page for every file resource. Care to explain what you thing you
</I>&gt;<i>get from it?
</I>
take it as &quot;default attribute&quot;, not as &quot;not found page&quot;, but defining
default attribute is a native thing (at least for pythonic applications).
And having ability to define or not define default attribute, in case of
mod_python.publisher, is also not a bad thing, just make it more flexible.
Isn't it?
But any way, i do not  insist.

As we all know, there not only web related projects that uses Apache
web-server and can use mod_python.publisher - there are a lot of things
based on http-protocol.
For example i'm planning to port my Wireles Village project based on
pythonic web-server to Apache, and there many of such things that exists at
the moment and can appears in future.

For web case: all users of my site are mobile operators subscribers, they
download various content from my site (melodies, pictures and so on). For a
different mobile operators, there are different requirements: page design,
error messages format, error message text and many other parameters, it can
be wml, xhtml or html format ... and some times some operator can change its
own requirements (as i can see it happens many times) and so on.
in my turn, i can have a lot of related projects, they must have different
logic, or just a design or use different technology to download (such as
drm-technology)

For various project it is convinient to have different directories, and i
can make some modules with names related to some operator.

One project can have different parts: web/wap-based part, and some
http-based part (Wireless Village + gate to another messengers, SyncML or
smth else)

My case is not unique.


&gt;<i>Maybe you shouldn't be using mod_python.publisher but should
</I>&gt;<i>be writing a custom dispatcher of your own.
</I>
it is looks like a discovering a bicycle again and again. But exactly that
change i've suggest before, do not make some unexpected things for those
developers that uses mod_python.publisher but did not define _default
function.



-- 
Maksim Kasimov
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070116/da4297ae/attachment-0001.html">http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070116/da4297ae/attachment-0001.html</A>
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023013.html">[mod_python] how to define publisher when page not found
</A></li>
	<LI>Next message: <A HREF="023010.html">[mod_python] Decoding POST requests
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23014">[ date ]</a>
              <a href="thread.html#23014">[ thread ]</a>
              <a href="subject.html#23014">[ subject ]</a>
              <a href="author.html#23014">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
