<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] how to run multiple subinterpreters from mod_python
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20how%20to%20run%20multiple%20subinterpreters%20from%20mod_python&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023077.html">
   <LINK REL="Next"  HREF="023082.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] how to run multiple subinterpreters from mod_python</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20how%20to%20run%20multiple%20subinterpreters%20from%20mod_python&In-Reply-To="
       TITLE="[mod_python] how to run multiple subinterpreters from mod_python">grahamd at dscpl.com.au
       </A><BR>
    <I>Tue Jan 23 17:18:14 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="023077.html">[mod_python] ANNOUNCE: Mod_python 3.2.10
</A></li>
        <LI>Next message: <A HREF="023082.html">[mod_python] how to run multiple subinterpreters from mod_python
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23079">[ date ]</a>
              <a href="thread.html#23079">[ thread ]</a>
              <a href="subject.html#23079">[ subject ]</a>
              <a href="author.html#23079">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Suresh Lakshmanan wrote ..
&gt;<i> Hi,
</I>&gt;<i> Is it possible for mod_python to create new subinterpreter when requests
</I>&gt;<i> arrive? I was thinking that mod_python has a configurable pool of python
</I>&gt;<i> interpreters
</I>&gt;<i> and it will delegate a request to an interpreter from the pool.
</I>&gt;<i> 
</I>&gt;<i> But, it looks like this is not the case.
</I>
Correct, that is not the case. You are misunderstand what the subinterpreters
are there for.

&gt;<i> Only one subinterpreter is only
</I>&gt;<i> created for a virtual host or directory config according to documentation.
</I>
More or less, yes. Each sub interpreter is named and is tied to some part of
the URL namespace. The default is that there will be a sub interpreter for
each virtual host, but this can be overridden by various directives. 

&gt;<i> This is
</I>&gt;<i> creating problems because the other requests have to wait for a long time
</I>&gt;<i> and i get 503 from apache.
</I>
The way Python sub interpreters are used, it is highly unlikely that a 503
response is going to be because of them. It may be how you have Apache
configured, but to know you will have to state what platform you are using
and if on UNIX whether you have compiled Apache with the prefork MPM
or worker MPM. You also should post what you Apache configuration is
that controls the number of Apache sub processes and/or threads within
a process.

&gt;<i> It will be useful if i have multiple
</I>&gt;<i> subinterpreters
</I>&gt;<i> to which apache can assign requests arbitrarily. I do not maintain state
</I>&gt;<i> in
</I>&gt;<i> any of the interpreters.
</I>
This will not make any difference, what matters is how many Apache child
process are allowed to be created when using prefork MPM, or how many
child processes and/or threads with a process that Apache is allowed to
create when using a multithreaded MPM.

If using prefork MPM and you have restricted the number of Apache child
processes to a small fixed number, then if you get more requests than
that arrive, there will be no processes available to handle the request. If
you are using a multithreaded MPM, then a small number of threads across
all processes will limit how many requests can be handled concurrently.

Creating extra Python subinterpreters only gives you separation of data,
it doesn't provide any additional concurrency abilities. You seem not to
understand this point.

&gt;<i> iow, how do i scale this to a large number of users. how do i introduce
</I>&gt;<i> parallel processing of requests for the same virtual host/directory. at
</I>&gt;<i> the
</I>&gt;<i> moment it looks
</I>&gt;<i> like its single threaded.
</I>
If you use prefork, then only one request in each child process can be
handled at a time, but then you should be running with adequate child
processes so that isn't a problem. If using a multithreaded MPM, then there
already can be multiple requests handled at the same time and these
can be handled even within the same Python subinterpreter.

&gt;<i> definitely there should be a way as this is a common problem... can someone
</I>&gt;<i> please point me to the solution.
</I>
You probably need to research more about the different MPM models for
Apache. For starters, read:

  <A HREF="http://www.dscpl.com.au/wiki/ModPython/Articles/TheProcessInterpreterModel">http://www.dscpl.com.au/wiki/ModPython/Articles/TheProcessInterpreterModel</A>

You might then see what you can find in documentation about Apache referenced on:

  <A HREF="http://wiki.apache.org/mod_python/">http://wiki.apache.org/mod_python/</A>

On first guess I would say how you have configured Apache is limiting things.

If you are using a multithreaded MPM, then you might have a third party module
for Python you are using which doesn't release the Python GIL around a long
running operation being performed in C code. Thus, what extra Python modules
are you using?


Graham
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023077.html">[mod_python] ANNOUNCE: Mod_python 3.2.10
</A></li>
	<LI>Next message: <A HREF="023082.html">[mod_python] how to run multiple subinterpreters from mod_python
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23079">[ date ]</a>
              <a href="thread.html#23079">[ thread ]</a>
              <a href="subject.html#23079">[ subject ]</a>
              <a href="author.html#23079">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
