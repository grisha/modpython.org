<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Redirect does not work for URIs when including GET
	arguments
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Redirect%20does%20not%20work%20for%20URIs%20when%20including%20GET%0A%09arguments&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026208.html">
   <LINK REL="Next"  HREF="026210.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Redirect does not work for URIs when including GET
	arguments</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>mog</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Redirect%20does%20not%20work%20for%20URIs%20when%20including%20GET%0A%09arguments&In-Reply-To="
       TITLE="[mod_python] Redirect does not work for URIs when including GET
	arguments">lists at elasticmind.net
       </A><BR>
    <I>Sun May 10 19:02:06 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="026208.html">[mod_python] [SPAM] Tag Heuer watches wholesale all year long!
</A></li>
        <LI>Next message: <A HREF="026210.html">[mod_python] [SPAM] One of a kind IWC reps
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26209">[ date ]</a>
              <a href="thread.html#26209">[ thread ]</a>
              <a href="subject.html#26209">[ subject ]</a>
              <a href="author.html#26209">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Greetings,

Hope you are well. I'm working on an application that has a number of 
pages that require users to log in. To make this nice and easy for the 
users, when they hit a page that needs authentication, I'd like the page 
to just call the function that handles all the login code and template 
rendering transparently, and then just redirect them back to the 
original URI they gave - so that from a user's point of view, the URI 
doesn't change.

The program kinda works like this:

# User goes to /mypage
def index(req):
    if not hasattr(req, &quot;websess&quot;):
        req.websess = Session.DbmSession(req, timeout=1200)
    req.websess.save()

    ... sets some variables like title and stuff ...

    if user isn't logged in:
        from myapp.login import index as login_page
        return login_page(req, req.uri, 'template.html', title)
    else user must be loggedin:
        pull some data from the database and render the page using a 
templete
        return ...template...


# login_page() function called by '/mypage'
def index(req, refer_uri=None, refer_tmpl=None, refer_title=None):
    if not hasattr(req, &quot;websess&quot;):
        req.websess = Session.DbmSession(req, timeout=1200)
    req.websess.save()

    ... render a template containing a login form...
    ... user clicks the Login submit button after entering the username 
and password in the form...
    ... The html form action causes the referrer page (/mypage) to be 
reloaded...
    ... User is not logged in so process repeats with /login/index being 
called again having req data passed to it...
    ... /login/index checks the users login details and accepts the 
login request ...

    if user login is accepted:
        req.websess.unlock()
        # redirect back to /mypage since login was successful.
        req.internal_redirect(refer_uri)


I didn't want to post a load of code that wasn't relevant, but I hope 
the pseudo code helps a little bit to explain what I was trying to achieve.

This method works fine when the URI has no GET arguments, for example; 
if the user wants to go to the /mypage URI directly - it's fine. 
However, if the URI does have arguments, like /mypage?id=18, then the 
application keeps displaying the login page all the time and doesn't 
process the login correctly - or at least it seems.

All the login stuff is done using POST, but the URI arguments for the 
/mypage code is done using GET. Since this is what apparently causes it 
to break, I'm assuming there must be something wrong here, but I'm not 
sure. Perhaps there is a better way of doing this, or if I want to use 
GET arguments as well, I need to go about solving this problem a 
different way?

Any help or advice would be greatly appreciated. Thanks you in advance 
for your time and consideration.
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026208.html">[mod_python] [SPAM] Tag Heuer watches wholesale all year long!
</A></li>
	<LI>Next message: <A HREF="026210.html">[mod_python] [SPAM] One of a kind IWC reps
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26209">[ date ]</a>
              <a href="thread.html#26209">[ thread ]</a>
              <a href="subject.html#26209">[ subject ]</a>
              <a href="author.html#26209">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
