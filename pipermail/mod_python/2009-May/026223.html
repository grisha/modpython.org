<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Multiple Interpreters mod_python optimization
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Multiple%20Interpreters%20mod_python%20optimization&In-Reply-To=b11cb9ab7f6cd0b572c4493aa0a7b3bf%40skolesys.dk">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026222.html">
   <LINK REL="Next"  HREF="026224.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Multiple Interpreters mod_python optimization</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Multiple%20Interpreters%20mod_python%20optimization&In-Reply-To=b11cb9ab7f6cd0b572c4493aa0a7b3bf%40skolesys.dk"
       TITLE="[mod_python] Multiple Interpreters mod_python optimization">graham.dumpleton at gmail.com
       </A><BR>
    <I>Sat May 16 07:11:56 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="026222.html">[mod_python] Multiple Interpreters mod_python optimization
</A></li>
        <LI>Next message: <A HREF="026224.html">[mod_python] Dependency Resolving
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26223">[ date ]</a>
              <a href="thread.html#26223">[ thread ]</a>
              <a href="subject.html#26223">[ subject ]</a>
              <a href="author.html#26223">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'd be doing a really thorough check of your Apache configuration
files to double check that you don't have MaxRequestPerChild set in an
unlikely spot somewhere with it set to 1. You may have done this to
force source code reloading on every request and forgotten about it.

Beyond that, I would start dumping out os.getppid() and verify that
the parent process is actually the main Apache parent/monitor process
for the instance you are seeing run by 'ps'.

Also use the 'mod_python.apache.mpm_query()' function to find out
value of AP_MPMQ_MAX_REQUESTS_DAEMON. See:

  <A HREF="http://www.modpython.org/live/current/doc-html/pyapi-apmeth.html">http://www.modpython.org/live/current/doc-html/pyapi-apmeth.html</A>

Also diligently check your Apache error log files for instances of
Segmentation Fault messages. Plus also pay close attention to those
messages from mod_python about when source code is being reloaded,
ie., into what process (pid) and what sub interpreter.

Graham

2009/5/15 zsi &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">zsi at skolesys.dk</A>&gt;:
&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Fri, 15 May 2009 21:40:46 +1000, Graham Dumpleton
</I>&gt;<i> &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">graham.dumpleton at gmail.com</A>&gt; wrote:
</I>&gt;&gt;<i> 2009/5/15 zsi &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">zsi at skolesys.dk</A>&gt;:
</I>&gt;&gt;&gt;<i> On Fri, 15 May 2009 20:35:59 +1000, Graham Dumpleton
</I>&gt;&gt;&gt;<i> &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">graham.dumpleton at gmail.com</A>&gt; wrote:
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> BTW, the process IDs in your 'ps' output don't even match what your
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> Python code is producing. Looks like you aren't even talking to the
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> same Apache instance.
</I>&gt;&gt;&gt;&gt;&gt;<i> I wasn't expecting them to match. The process id's from the python
</I>&gt;<i> code
</I>&gt;&gt;&gt;&gt;&gt;<i> are the interpreter's pid not the apaches. What I wanted to show by
</I>&gt;&gt;&gt;&gt;&gt;<i> that was that it is stille the same apache processes (8 of them) but
</I>&gt;&gt;&gt;&gt;&gt;<i> I have 18 different interpreter process ID's. So it is not because I
</I>&gt;&gt;&gt;&gt;&gt;<i> hit a new apache process every time.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Did you read the document I told you to read about process/interpreter
</I>&gt;&gt;&gt;&gt;<i> model of Apache/mod_python? As well as the blog entry?
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> The Python sub interpreters run in the Apache child processes. Thus
</I>&gt;&gt;&gt;&gt;<i> the process IDs from your Python code must have some overlap with the
</I>&gt;&gt;&gt;&gt;<i> Apache processes you listed.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Apache/mod_python does not create special Python interpreter processes.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Yes, I read it and it makes it even more odd that I get a new pid
</I>&gt;&gt;<i> everytime
</I>&gt;&gt;&gt;<i> I call os.getpid(), that doesn't match the apache processes.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Have you run 'ps' to find out what processes are using those pids and
</I>&gt;&gt;<i> whether they exist after the requests are done.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> If need be, put a time.sleep() call after you log the pid to give you
</I>&gt;&gt;<i> time to do the 'ps', just in case they are transient as a result of
</I>&gt;&gt;<i> Apache configuration, or because they are crashing at end of request.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Also ensure you have set:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &#160; PythonDebug On
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> to enabled stuff in Apache error logs about mod_python loading of files.
</I>&gt;<i>
</I>&gt;<i> That was a very good idea, and you are right it is apache processes, just
</I>&gt;<i> not the ones started initially by the main apache process. So I guess the
</I>&gt;<i> question is what I did wrong in the apache configuration since new apache
</I>&gt;<i> servers are spawned each time a request comes in - and terminated right
</I>&gt;<i> away. Of course I know this will happen as the load increases (if I don't
</I>&gt;<i> change the Min/MaxSpareServers) but why doesn't it use the ones already
</I>&gt;<i> there before starting new ones?
</I>&gt;<i>
</I>&gt;<i> May 15 14:08:55 capa-server capa: REQUESTINFO: ps aux|grep pid &#160; = capa
</I>&gt;<i> 8981 &#160;0.0 &#160;2.3 &#160;20288 11972 ? S 14:08 0:00 /usr/sbin/apache2 -k start
</I>&gt;<i> May 15 14:08:55 capa-server capa: REQUESTINFO: Interpreter Name &#160;=
</I>&gt;<i> /srv/capa/www/0.9/sessionservice/
</I>&gt;<i> May 15 14:08:55 capa-server capa: REQUESTINFO: os.getpid() &#160; &#160; &#160; = 8982
</I>&gt;<i> May 15 14:08:55 capa-server capa: REQUESTINFO: ps aux|grep pid &#160; = capa
</I>&gt;<i> 8982 66.0 &#160;2.2 &#160;20288 11844 ? S 14:08 0:00 /usr/sbin/apache2 -k start
</I>&gt;<i> May 15 14:08:56 capa-server capa: REQUESTINFO: Interpreter Name &#160;=
</I>&gt;<i> /srv/capa/www/0.9/sessionservice/
</I>&gt;<i> May 15 14:08:56 capa-server capa: REQUESTINFO: os.getpid() &#160; &#160; &#160; = 8987
</I>&gt;<i> May 15 14:08:56 capa-server capa: REQUESTINFO: ps aux|grep pid &#160; = capa
</I>&gt;<i> 8987 78.0 &#160;2.5 &#160;20808 13028 ? S 14:08 0:00 /usr/sbin/apache2 -k start
</I>&gt;<i> May 15 14:08:57 capa-server capa: REQUESTINFO: Interpreter Name &#160;=
</I>&gt;<i> /srv/capa/www/0.9/sessionservice/
</I>&gt;<i> May 15 14:08:57 capa-server capa: REQUESTINFO: os.getpid() &#160; &#160; &#160; = 8997
</I>&gt;<i> May 15 14:08:57 capa-server capa: REQUESTINFO: ps aux|grep pid &#160; = capa
</I>&gt;<i> 8997 74.0 &#160;2.3 &#160;20288 11972 ? S 14:08 0:00 /usr/sbin/apache2 -k start
</I>&gt;<i>
</I>&gt;<i> Best regards
</I>&gt;<i> Jakob Simon-Gaarde
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i>
</I>
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026222.html">[mod_python] Multiple Interpreters mod_python optimization
</A></li>
	<LI>Next message: <A HREF="026224.html">[mod_python] Dependency Resolving
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26223">[ date ]</a>
              <a href="thread.html#26223">[ thread ]</a>
              <a href="subject.html#26223">[ subject ]</a>
              <a href="author.html#26223">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
