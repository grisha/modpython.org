<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Re: Apache and mod_python memory usage
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Re%3A%20Apache%20and%20mod_python%20memory%20usage&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023180.html">
   <LINK REL="Next"  HREF="023183.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Re: Apache and mod_python memory usage</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Re%3A%20Apache%20and%20mod_python%20memory%20usage&In-Reply-To="
       TITLE="[mod_python] Re: Apache and mod_python memory usage">grahamd at dscpl.com.au
       </A><BR>
    <I>Fri Feb 16 05:27:02 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="023180.html">[mod_python] Re: Apache and mod_python memory usage
</A></li>
        <LI>Next message: <A HREF="023183.html">[mod_python] how use sessions in modpython2.7?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23182">[ date ]</a>
              <a href="thread.html#23182">[ thread ]</a>
              <a href="subject.html#23182">[ subject ]</a>
              <a href="author.html#23182">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>How big is your mod_python.so module for Apache? If Python was not built
so as to create a shared library for itself when mod_python.so is built it may
include the actual Python library itself. It is possible this shows as memory
used by process as opposed to shared memory if shared library was used.
On Mac OS X where equivalent of shared library used, Apache only consumes
a few MB of memory upon startup (from memory, can't confirm right now).
How it works on other platforms not exactly sure. If on UNIX like systems, can
run:

  ldd mod_python.so

and it will indicate whether using Python as shared library.

Graham

Eugene Morozov wrote ..
&gt;<i> -----BEGIN PGP SIGNED MESSAGE-----
</I>&gt;<i> Hash: SHA1
</I>&gt;<i> 
</I>&gt;<i> Hello,
</I>&gt;<i> No, this figure is the initial starting size and it doesn't grow at all
</I>&gt;<i> with time. We currently have two virtual hosts running. I don't think
</I>&gt;<i> it's really a problem, just wanted to know if such initial memory
</I>&gt;<i> consumption is normal or not. Can anyone else post their figures?
</I>&gt;<i> Eugene
</I>&gt;<i> 
</I>&gt;<i> Graham Dumpleton &#208;&#191;&#208;&#184;&#209;&#136;&#208;&#181;&#209;&#130;:
</I>&gt;<i> &gt; Eugene Morozov wrote ..
</I>&gt;<i> &gt;&gt; -----BEGIN PGP SIGNED MESSAGE-----
</I>&gt;<i> &gt;&gt; Hash: SHA1
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Hello,
</I>&gt;<i> &gt;&gt; We're using apache and mod_python for running Pylons-based CMS. We're
</I>&gt;<i> a
</I>&gt;<i> &gt;&gt; little bit concerned with memory usage. With mod_python
</I>&gt;<i> &gt;&gt; apache2-mpm-worker consumes a lot of memory:
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; PID USER PR NI VIRT RES SHR S %CPU %MEM TIME+ COMMAND
</I>&gt;<i> &gt;&gt; 23787 www-data 20 0 366m 48m 4104 S 0.0 12.5 0:09.23 apache2
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; 48Mb is a bit too big even for apache. And why it needs 366Mb of virtual
</I>&gt;<i> &gt;&gt; memory?
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; If I disable mod_python these values are cut significantly (to 266Mb
</I>&gt;<i> &gt;&gt; virtual and 21Mb RSS, which is still much, it seems).
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Not that it's a huge problem now, but I'm curious why so much memory
</I>&gt;<i> is
</I>&gt;<i> &gt;&gt; consumed.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; What are the figures immediately after Apache has started and before
</I>&gt;<i> any requests
</I>&gt;<i> &gt; have been handled by mod_python? When determining this, ensure that not
</I>&gt;<i> &gt; PythonImport directives are being applied to preload/execute any Python
</I>&gt;<i> code.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; This figure will be the initial starting size with only the main Python
</I>&gt;<i> interpreter
</I>&gt;<i> &gt; instance created. Beyond that, the size will grow based on what your
</I>&gt;<i> own Python
</I>&gt;<i> &gt; code is doing, how many additional Python interpreter instances are created
</I>&gt;<i> or
</I>&gt;<i> &gt; possibly due to memory leaks.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; As far as memory leaks in mod_python go, ensure that you are using the
</I>&gt;<i> latest
</I>&gt;<i> &gt; version of mod_python, ie., 3.3. There are memory leaks in older versions
</I>&gt;<i> which
</I>&gt;<i> &gt; depending on what your code is doing may be getting triggered.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; As to Python interpreter instances, how many virtual hosts are you running
</I>&gt;<i> on
</I>&gt;<i> &gt; the server under which mod_python requests are being handled? Also, are
</I>&gt;<i> you
</I>&gt;<i> &gt; using any of PythonInterpPerDirectory or PythonInterpPerDirective or
</I>&gt;<i> &gt; PythonInterpreter directives? If you are using these and depending on
</I>&gt;<i> how
</I>&gt;<i> &gt; you use them, you could be unnecessarily creating additional Python interpreter
</I>&gt;<i> &gt; instances which may be unnecessarily consuming additional memory.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Finally, does this figure keep going up and up over time which may indicate
</I>&gt;<i> &gt; memory leaks in mod_python or your own Python code?
</I>&gt;<i> &gt; 
</I>&gt;<i> 
</I>&gt;<i> -----BEGIN PGP SIGNATURE-----
</I>&gt;<i> Version: GnuPG v1.4.3 (GNU/Linux)
</I>&gt;<i> Comment: Using GnuPG with Mozilla - <A HREF="http://enigmail.mozdev.org">http://enigmail.mozdev.org</A>
</I>&gt;<i> 
</I>&gt;<i> iD8DBQFF1Tkak5VH2F5tiW4RAku7AKDRVyEqXh3JFyj3SCbJ40P+yirzEwCgs65e
</I>&gt;<i> jDg69zy25rbK6lb/Jt8G36c=
</I>&gt;<i> =23AR
</I>&gt;<i> -----END PGP SIGNATURE-----
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I></PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023180.html">[mod_python] Re: Apache and mod_python memory usage
</A></li>
	<LI>Next message: <A HREF="023183.html">[mod_python] how use sessions in modpython2.7?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23182">[ date ]</a>
              <a href="thread.html#23182">[ thread ]</a>
              <a href="subject.html#23182">[ subject ]</a>
              <a href="author.html#23182">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
