<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] IE rediretcts don't change URL with auth handler?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20IE%20rediretcts%20don%27t%20change%20URL%20with%20auth%20handler%3F&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023145.html">
   <LINK REL="Next"  HREF="023148.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] IE rediretcts don't change URL with auth handler?</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Jordan Baker</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20IE%20rediretcts%20don%27t%20change%20URL%20with%20auth%20handler%3F&In-Reply-To="
       TITLE="[mod_python] IE rediretcts don't change URL with auth handler?">jbb at contradix.com
       </A><BR>
    <I>Thu Feb  1 10:09:12 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="023145.html">[mod_python] wsgi support?
</A></li>
        <LI>Next message: <A HREF="023148.html">[mod_python] Install mod_python for Apache 1.3.37
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23147">[ date ]</a>
              <a href="thread.html#23147">[ thread ]</a>
              <a href="subject.html#23147">[ subject ]</a>
              <a href="author.html#23147">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

Summary of problem: IE doesn't change the URL after getting a 302 
Redirect the second time through my auth handler.

I've got an auth handler which as many do checks various security 
parameters and if they are not met redirects the browser to an 
authentication page.

Basically the request flow looks like this:

- User requests a page ie. <A HREF="http://mysite.com/subfolder">http://mysite.com/subfolder</A>

- The authen handler will redirect them to a auth page if they aren't
   already authenticated:   <A HREF="http://mysite.com/auth?came_from=/subfolder">http://mysite.com/auth?came_from=/subfolder</A>

The problems begin after the user tries to use the back button after 
logging out of the application.

The user hits the back button to return to the site they just logged out 
of, hits the refresh button and lo! Whereas Firefox redirects the user 
to the proper /auth URL under IE the user sees the login page however 
the URL stays the same.

This seems to be a common enough problem based on web research but I 
wasn't able to find a definitive solution and was hoping somewhere in 
this forum might have found it.

The code for my authen handler follows in case it is helpful for diagnosis.

TIA,

-jordan.


def authenhandler(req):
   req.user = '' # needed to avoid an error from mod_python when 
req.user is NULL?
   if not has_valid_proxy_cookies(req, req.unparsed_uri):
     req.log_error(&quot;not authorized to use proxy, redirecting to login 
page&quot;, apache.APLOG_NOTICE)
     # redirect to login
     sess = get_session(req)
     # pass along some key information to the auth handler
     sess['backend'] = get_backend(req)
     sess['key_host'] = get_key_host(req)
     sess['key_path'] = get_key_path(req)
     sess.save()

     try:
       util.redirect(req, &quot;/auth?came_from=%s&quot; % (req.unparsed_uri))
     except apache.SERVER_RETURN:
       pass

     return apache.HTTP_UNAUTHORIZED

   req.log_error(&quot;valid cookie found, renewing&quot;)
   issue_cookie(req, get_key_host(req), get_key_path(req))
   return apache.OK

</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023145.html">[mod_python] wsgi support?
</A></li>
	<LI>Next message: <A HREF="023148.html">[mod_python] Install mod_python for Apache 1.3.37
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23147">[ date ]</a>
              <a href="thread.html#23147">[ thread ]</a>
              <a href="subject.html#23147">[ subject ]</a>
              <a href="author.html#23147">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
