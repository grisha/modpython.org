<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Session confusion
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Session%20confusion&In-Reply-To=45E473FA.4030207%40aptima.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023213.html">
   <LINK REL="Next"  HREF="023214.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Session confusion</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Jim Gallacher</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Session%20confusion&In-Reply-To=45E473FA.4030207%40aptima.com"
       TITLE="[mod_python] Session confusion">jpg at jgassociates.ca
       </A><BR>
    <I>Tue Feb 27 14:26:07 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="023213.html">[mod_python] Session confusion
</A></li>
        <LI>Next message: <A HREF="023214.html">[mod_python] Session confusion
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23212">[ date ]</a>
              <a href="thread.html#23212">[ thread ]</a>
              <a href="subject.html#23212">[ subject ]</a>
              <a href="author.html#23212">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>David Kramer wrote:
&gt;<i> Hi.  I'm pretty new to mod_python.  I'm porting a mod_python program 
</I>&gt;<i> from Windows to Linux, and ran into the problem I posted a week or so 
</I>&gt;<i> ago, where under Windows, all the variables automatically persisted (due 
</I>&gt;<i> to Apache being one process under Windows), and the program was written 
</I>&gt;<i> to expect that.  I'm trying to store and recall the data using a 
</I>&gt;<i> session, but I'm having some strange problems, and some questions.
</I>&gt;<i> 
</I>&gt;<i> The biggest problem is that on occasion, when I call
</I>&gt;<i>    sess = Session.Session(req)
</I>&gt;<i> the program just halts and never returns from that line.  No errors in 
</I>&gt;<i> /var/log/htttpd/error_log, and the page times out.  What can cause that?
</I>
To protect the integrity of your session data, the sessions are locked 
for the duration of the request. Usually when you get a deadlock it is 
the result of creating 2 (or more) session instances within the same 
request. For example, the following bit of code would deadlock:

def handler(req):
     sess = Session.Session(req)
     stuff(req)
     return apache.OK

def stuff(req):
     sess = Session.Session(req)
     req.write('stuff called')


In the above code, the first session instance locks the session. The 2nd 
  call to Session in stuff() blocks as the session is already locked, 
resulting in your deadlock.

The usual recommendation is to make sure you only create one session 
instance per request, and pass that object around as an attribute of the 
request object. For example the above code would look like this:

def handler(req):
     req.session = Session.Session(req)
     stuff(req)
     return apache.OK

def stuff(req):
     sess = req.session
     req.write('stuff called')

&gt;<i>  I can often get the program working again by deleting any cookies 
</I>&gt;<i> created by it, then restarting Apache, but that's not exactly 
</I>&gt;<i> production-ready.
</I>&gt;<i> 
</I>&gt;<i> I wrote a small test program that tries to create an instance of a small 
</I>&gt;<i> class and store that in the session data, and that seems to work (though 
</I>&gt;<i> I've never worked in a web evironment where you could store objects in 
</I>&gt;<i> cookies without somehow serializing them yourself).
</I>
You are not storing the data in a cookie. Only the session id is set in 
the cookie. The session data is stored on the server. Various backend 
stores are available, depending on your mod_python version and your OS. 
Regardless of the store used, the data is a python cPickle.

&gt;<i>  Is that really the 
</I>&gt;<i> case?  Is there some rule about what can be stored in sessions and what 
</I>&gt;<i> cannot?
</I>
For various reasons it's best to restrict your session data to simple 
types such as lists, tuples, dictionaries, strings, integers, etc.

&gt;<i> Is there a way for me to see the contents of session data on the server? 
</I>&gt;<i>  I tried following the code in the Session module, but I'm not sure 
</I>&gt;<i> where or in what format the data is stored.  I'm guessing &quot;dbm&quot; is a 
</I>&gt;<i> Berkeley database that gets stored in a file somewhere, so I should be 
</I>&gt;<i> able to query it somehow.
</I>
Yes it is a dbm file, with the session id as the key. For mod_python 3.1 
the default location, as I recall, is /tmp/mp_sess.dbm

&gt;<i>  I read somewhere that the stored data is 
</I>&gt;<i> pickled, 
</I>
True.

&gt;<i> so I'll have to write a Python program to display it, which 
</I>&gt;<i> shouldn't be a problem.
</I>
Also true.

db = dbm.open('/tmp/mp_sess.dbm', 'r')
sess = db[session_id]

&gt;<i> Lastly, I found the Session documentation &quot;rather lacking&quot; at
</I>&gt;<i> <A HREF="http://www.modpython.org/live/current/doc-html/pyapi-sess.html">http://www.modpython.org/live/current/doc-html/pyapi-sess.html</A>
</I>&gt;<i> Are there any mod_python tutorials or examples or other docs that could 
</I>&gt;<i> help me?  I would love to RTFM, but I think I need a better FM.
</I>
Some people have been chipping away at some additional pages that you 
may find useful:
<A HREF="http://wiki.apache.org/mod_python/CategoryExamples">http://wiki.apache.org/mod_python/CategoryExamples</A>

Jim

</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023213.html">[mod_python] Session confusion
</A></li>
	<LI>Next message: <A HREF="023214.html">[mod_python] Session confusion
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23212">[ date ]</a>
              <a href="thread.html#23212">[ thread ]</a>
              <a href="subject.html#23212">[ subject ]</a>
              <a href="author.html#23212">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
