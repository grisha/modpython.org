<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Apache and mod_python memory usage
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Apache%20and%20mod_python%20memory%20usage&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023181.html">
   <LINK REL="Next"  HREF="023180.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Apache and mod_python memory usage</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Apache%20and%20mod_python%20memory%20usage&In-Reply-To="
       TITLE="[mod_python] Apache and mod_python memory usage">grahamd at dscpl.com.au
       </A><BR>
    <I>Thu Feb 15 21:35:02 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="023181.html">[mod_python] ANNOUNCE: Mod_python 3.3.1
</A></li>
        <LI>Next message: <A HREF="023180.html">[mod_python] Re: Apache and mod_python memory usage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23179">[ date ]</a>
              <a href="thread.html#23179">[ thread ]</a>
              <a href="subject.html#23179">[ subject ]</a>
              <a href="author.html#23179">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Eugene Morozov wrote ..
&gt;<i> -----BEGIN PGP SIGNED MESSAGE-----
</I>&gt;<i> Hash: SHA1
</I>&gt;<i> 
</I>&gt;<i> Hello,
</I>&gt;<i> We're using apache and mod_python for running Pylons-based CMS. We're a
</I>&gt;<i> little bit concerned with memory usage. With mod_python
</I>&gt;<i> apache2-mpm-worker consumes a lot of memory:
</I>&gt;<i> 
</I>&gt;<i> PID USER PR NI VIRT RES SHR S %CPU %MEM TIME+ COMMAND
</I>&gt;<i> 23787 www-data 20 0 366m 48m 4104 S 0.0 12.5 0:09.23 apache2
</I>&gt;<i> 
</I>&gt;<i> 48Mb is a bit too big even for apache. And why it needs 366Mb of virtual
</I>&gt;<i> memory?
</I>&gt;<i> 
</I>&gt;<i> If I disable mod_python these values are cut significantly (to 266Mb
</I>&gt;<i> virtual and 21Mb RSS, which is still much, it seems).
</I>&gt;<i> 
</I>&gt;<i> Not that it's a huge problem now, but I'm curious why so much memory is
</I>&gt;<i> consumed.
</I>
What are the figures immediately after Apache has started and before any requests
have been handled by mod_python? When determining this, ensure that not
PythonImport directives are being applied to preload/execute any Python code.

This figure will be the initial starting size with only the main Python interpreter
instance created. Beyond that, the size will grow based on what your own Python
code is doing, how many additional Python interpreter instances are created or
possibly due to memory leaks.

As far as memory leaks in mod_python go, ensure that you are using the latest
version of mod_python, ie., 3.3. There are memory leaks in older versions which
depending on what your code is doing may be getting triggered.

As to Python interpreter instances, how many virtual hosts are you running on
the server under which mod_python requests are being handled? Also, are you
using any of PythonInterpPerDirectory or PythonInterpPerDirective or
PythonInterpreter directives? If you are using these and depending on how
you use them, you could be unnecessarily creating additional Python interpreter
instances which may be unnecessarily consuming additional memory.

Finally, does this figure keep going up and up over time which may indicate
memory leaks in mod_python or your own Python code?

Graham

PS. I finally have net access again. Been trying to get an ADSL connection going
where I am staying for most of the week. Finally came down to fact that ISP didn't
tell me or state anywhere on their sparse documentation what the correct
@something was that had to be placed after the ADSL login ID. Only after I asked
them a second time did they give me the correct value. Even though back on net,
access still restricted. Luckily list has been quiet anyway. :-)

</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023181.html">[mod_python] ANNOUNCE: Mod_python 3.3.1
</A></li>
	<LI>Next message: <A HREF="023180.html">[mod_python] Re: Apache and mod_python memory usage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23179">[ date ]</a>
              <a href="thread.html#23179">[ thread ]</a>
              <a href="subject.html#23179">[ subject ]</a>
              <a href="author.html#23179">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
