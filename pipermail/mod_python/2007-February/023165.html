<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] PythonPath and importer in 3.3
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20PythonPath%20and%20importer%20in%203.3&In-Reply-To=DA7557B9-35E3-43C6-B1EB-4DC709F88780%40ixopusada.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023164.html">
   <LINK REL="Next"  HREF="023166.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] PythonPath and importer in 3.3</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Jim Gallacher</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20PythonPath%20and%20importer%20in%203.3&In-Reply-To=DA7557B9-35E3-43C6-B1EB-4DC709F88780%40ixopusada.com"
       TITLE="[mod_python] PythonPath and importer in 3.3">jpg at jgassociates.ca
       </A><BR>
    <I>Tue Feb  6 12:29:30 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="023164.html">[mod_python] PythonPath and importer in 3.3
</A></li>
        <LI>Next message: <A HREF="023166.html">[mod_python] PythonPath and importer in 3.3
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23165">[ date ]</a>
              <a href="thread.html#23165">[ thread ]</a>
              <a href="subject.html#23165">[ subject ]</a>
              <a href="author.html#23165">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Dirk van Oosterbosch, IR labs wrote:
&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> I am not sure if this the right list to ask, since 3.3 is still in beta, 
</I>&gt;<i> but after reading the documentation about PythonPath and import_module 
</I>&gt;<i> I'm running into problems as I try to follow the directions expressed in 
</I>&gt;<i> the documentation.
</I>
3.3 is out of beta and will be released as 3.3.1. There are no changes 
from 3.3.0b except the version strings. We're just waiting for Grisha to 
make the official announcement.

Graham is the guy that really understands the new importer, but he is 
heading off on holiday (or may in fact already be gone). In the worst 
case scenario you can revert to the 3.2.10 importer behaviour by using 
the following directive:

PythonOption mod_python.legacy.importer *

Hopefully we can muddle through before Graham gets back, but at least 
you won't be completely stuck.

I have no time to investigate right now but I'll try to take a look tonight.

Jim

&gt;<i> First off, let me state that when I upgraded to mod_python 3.3, I was 
</I>&gt;<i> happily surprised that everything just worked like before, with only 
</I>&gt;<i> changes visible in the log file. However, as I tried to fix something 
</I>&gt;<i> (PythonPath and importing modules) which didn't seem to cause problems, 
</I>&gt;<i> things broke down and I can't get them to work according to the docs.
</I>&gt;<i> &quot;Why trying to fix it then, when there was no problem?&quot;, you ask. Good 
</I>&gt;<i> question ;-)
</I>&gt;<i> 
</I>&gt;<i> My initial setup was like this:
</I>&gt;<i> in httpd.conf:
</I>&gt;<i> ====================
</I>&gt;<i> &lt;IfModule mod_python.c&gt;
</I>&gt;<i>     PythonPath &quot;sys.path + ['/Users/me/Sites/www/python/']&quot;
</I>&gt;<i>     PythonTransHandler translate
</I>&gt;<i> ...
</I>&gt;<i> 
</I>&gt;<i> in the .htaccess file in .../www/python/:
</I>&gt;<i> ====================
</I>&gt;<i> AddHandler mod_python .py
</I>&gt;<i> PythonHandler main
</I>&gt;<i> 
</I>&gt;<i> Then in main.py (the main handler which is called for every request):
</I>&gt;<i> ====================
</I>&gt;<i> # for loading a Cheetah template
</I>&gt;<i> templatesFolderLocation = &quot;/Users/me/Sites/www/python/templates&quot;
</I>&gt;<i> if templatesFolderLocation not in sys.path:
</I>&gt;<i>     sys.path.append(templatesFolderLocation)
</I>&gt;<i> ...
</I>&gt;<i> modulename = 'page'
</I>&gt;<i> ...
</I>&gt;<i> try:
</I>&gt;<i>     module = __import__(modulename, globals(), locals(), [modulename])
</I>&gt;<i> except ImportError:
</I>&gt;<i>     ...
</I>&gt;<i> templateClass = getattr(module, name)
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> As said, this code works. Though it is not very nice and clean, and I 
</I>&gt;<i> understood I had to go this way, while I was waiting for mod_python 3.3. 
</I>&gt;<i> Now I got python 3.3 and I read the documentation about 
</I>&gt;<i> apache.import_module() and about PythonPath, and I want to change the 
</I>&gt;<i> code so it will make proper use of the new importer.
</I>&gt;<i> 
</I>&gt;<i> The first thing I noticed in the docs is that the PythonPath shouldn't 
</I>&gt;<i> contain paths which are in the document tree.
</I>&gt;<i> <A HREF="http://www.modpython.org/live/mod_python-3.3.0b/doc-html/app-changes-from-3.2.10.html">http://www.modpython.org/live/mod_python-3.3.0b/doc-html/app-changes-from-3.2.10.html</A> 
</I>&gt;<i> :
</I>&gt;&gt;<i> The PythonPath directive MUST not be used to point at directories 
</I>&gt;&gt;<i> within the document tree.
</I>&gt;<i> 
</I>&gt;<i> So I changed the PythonPath line in httpd.conf into
</I>&gt;<i>     PythonOption mod_python.importer.path 
</I>&gt;<i> &quot;['/Users/dirk/Sites/www/python']&quot;
</I>&gt;<i> 
</I>&gt;<i> But &#8211;as somewhat expected&#8211; this breaks the Cheetah module importing code.
</I>&gt;<i> I tried to change it according to the docs
</I>&gt;<i> (these 
</I>&gt;<i> <A HREF="http://www.modpython.org/live/mod_python-3.3.0b/doc-html/pyapi-apmeth.html">http://www.modpython.org/live/mod_python-3.3.0b/doc-html/pyapi-apmeth.html</A> 
</I>&gt;<i> )
</I>&gt;<i> 
</I>&gt;<i> So now the code in main.py looks like this:
</I>&gt;<i> ====================
</I>&gt;<i> # for loading a Cheetah template
</I>&gt;<i> templatesFolderLocation = &quot;/Users/me/Sites/www/python/templates&quot;
</I>&gt;<i> # not appending to sys.path anymore
</I>&gt;<i> ...
</I>&gt;<i> modulename = 'page'
</I>&gt;<i> ...
</I>&gt;<i> try:
</I>&gt;<i>     module = apache.import_module(modulename, 
</I>&gt;<i> path=[templatesFolderLocation])
</I>&gt;<i> except ImportError:
</I>&gt;<i>     ... # importing the module fails here!
</I>&gt;<i> templateClass = getattr(module, name)
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> The reason for the failing import seems to be the inheritance system of 
</I>&gt;<i> the templates. Inside the chain of Cheetah modules that are inheriting 
</I>&gt;<i> eachother, there is a pure python module (framework.py), residing in 
</I>&gt;<i> /www/python (not in /www/python/templates/ !) which tries to import a 
</I>&gt;<i> module from /www/python/templates/ through this line:
</I>&gt;<i>     from baseTemplate import baseTemplate
</I>&gt;<i> I believe this fails and is the origin of my new problem.
</I>&gt;<i> 
</I>&gt;<i> I thought the module search path, which I supplied with the path= 
</I>&gt;<i> argument in import_module() was copied forward to all subsequent 
</I>&gt;<i> imports, but it seems this does not work for me.
</I>&gt;<i> 
</I>&gt;<i> Now I would be happy to add the templates directory to the python path 
</I>&gt;<i> again, but as I understood this is not the proper new mod_python way.
</I>&gt;<i> However I am reluctant to change the importing mechanism in framework.py 
</I>&gt;<i> and make framework dependant on mod_python's apache, since I also want 
</I>&gt;<i> to be able to test the cheetah part of my system outside of apache.
</I>&gt;<i> 
</I>&gt;<i> I hope I am missing something obvious. What would be the most clean and 
</I>&gt;<i> proper way to solve this issue?
</I>&gt;<i> 
</I>&gt;<i> Thanks!
</I>&gt;<i> dirk
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> -----------------------------
</I>&gt;<i> Dirk van Oosterbosch
</I>&gt;<i> de Wittenstraat 225
</I>&gt;<i> 1052 AT Amsterdam
</I>&gt;<i> the Netherlands
</I>&gt;<i> 
</I>&gt;<i> <A HREF="http://labs.ixopusada.com">http://labs.ixopusada.com</A>
</I>&gt;<i> -----------------------------
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> ------------------------------------------------------------------------
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023164.html">[mod_python] PythonPath and importer in 3.3
</A></li>
	<LI>Next message: <A HREF="023166.html">[mod_python] PythonPath and importer in 3.3
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23165">[ date ]</a>
              <a href="thread.html#23165">[ thread ]</a>
              <a href="subject.html#23165">[ subject ]</a>
              <a href="author.html#23165">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
