<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Enhancements for better content negotiation
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Enhancements%20for%20better%20content%20negotiation&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020186.html">
   <LINK REL="Next"  HREF="020187.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Enhancements for better content negotiation</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Deron Meranda</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Enhancements%20for%20better%20content%20negotiation&In-Reply-To="
       TITLE="[mod_python] Enhancements for better content negotiation">deron.meranda at gmail.com
       </A><BR>
    <I>Thu Feb  2 17:30:52 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="020186.html">[mod_python] undefined symbol: apr_table_compress ??
</A></li>
        <LI>Next message: <A HREF="020187.html">[mod_python] Module importer issues list updated.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20185">[ date ]</a>
              <a href="thread.html#20185">[ thread ]</a>
              <a href="subject.html#20185">[ subject ]</a>
              <a href="author.html#20185">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I have a bunch of code I was thinking of contributing to mod_python,
but would like some opinions before doing so (because I don't
know if this is the best place)...

Basically I wrote some utility functions which can be used to
assist with content negotiation; such as parsing the various
Accept-* headers *correctly*.  I am in fact using these in production
systems now because I do quite a bit of content negotiation.

I often see a bunch of example code (or even production code)
which does something like,

  if req.headers_in['Accept'].find('image/xyz') &gt;= 0:

That is really broken per RFC 2616 (HTTP 1.1)!   It totally ignores the
quality factors and other rules (see sections 14.1 - 14.4).  For example
if the Accept header sent was &quot;image/xyz;q=0&quot;, then in fact this
is the user agent saying to NEVER send image/xyz!

I think this sloppy way of testing is because the syntax and rules
for accept headers is actually fairly complex.  So this is a perfect
opportunity for reusable functions which assist with this (much like
the apache.parse_qs function).

Essentially I have functions that:

 1. Parse and sort any Accept-* header according to the RFC's BNF
 2. Negotiate the best content type
 3. Negotiate the best language
 4. Negotiate the best encoding
 5. Negotiate the best charset

It also knows how to handle wildcards, hierarchical language tags,
charset name aliases, etc.  And you can tell it to ignore the &quot;super&quot;
wildcards like */* too.

As a quick example you can do something like

  acc = req.headers_in['Accept']
  ct = acceptable_content_type( acc, ['text/html','application/xhtml+xml'] )

and it will tell you which of the two formats the browser supports/prefers,
if either, according to all the complex rules in the RFC.

I have some preliminary questions:

* Is this something that seems useful to others?

* Is mod_python util a preferable place to consider putting these,
or maybe this should perhaps go to something larger like
WSGI or some other Web-SIG project?
--
Deron Meranda

</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020186.html">[mod_python] undefined symbol: apr_table_compress ??
</A></li>
	<LI>Next message: <A HREF="020187.html">[mod_python] Module importer issues list updated.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20185">[ date ]</a>
              <a href="thread.html#20185">[ thread ]</a>
              <a href="subject.html#20185">[ subject ]</a>
              <a href="author.html#20185">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
