<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> SSL-data access from verious handlers.  was:	Re:[mod_python]
	problem w/ authen handler
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=SSL-data%20access%20from%20verious%20handlers.%20%20was%3A%09Re%3A%5Bmod_python%5D%0A%09problem%20w/%20authen%20handler&In-Reply-To=5.2.1.1.0.20060217152642.03d7f250%40mail.comune.grosseto.it">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020340.html">
   <LINK REL="Next"  HREF="020342.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>SSL-data access from verious handlers.  was:	Re:[mod_python]
	problem w/ authen handler</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Jim Gallacher</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=SSL-data%20access%20from%20verious%20handlers.%20%20was%3A%09Re%3A%5Bmod_python%5D%0A%09problem%20w/%20authen%20handler&In-Reply-To=5.2.1.1.0.20060217152642.03d7f250%40mail.comune.grosseto.it"
       TITLE="SSL-data access from verious handlers.  was:	Re:[mod_python]
	problem w/ authen handler">jpg at jgassociates.ca
       </A><BR>
    <I>Fri Feb 17 10:31:07 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="020340.html">SSL-data access from verious handlers.  was:
	Re:[mod_python] problem w/ authen handler
</A></li>
        <LI>Next message: <A HREF="020342.html">[mod_python] PSP TypeError: cannot concatenate 'str' and 
	'instance' objects
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20341">[ date ]</a>
              <a href="thread.html#20341">[ thread ]</a>
              <a href="subject.html#20341">[ subject ]</a>
              <a href="author.html#20341">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Bud,

I think it might be appropriate to move this discussion to the 
python-dev mailing list, as you are digging into the mod_python 
internals for a new feature which has not yet been implemented.

To subscribe send an email to <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">python-dev-subscribe at httpd.apache.org</A>
<A HREF="http://people.apache.org/~jgallacher/mod_python/website-test/lists.html#mp-dev">http://people.apache.org/~jgallacher/mod_python/website-test/lists.html#mp-dev</A>

Jim

Bud P. Bruegger wrote:
&gt;<i> Graham Dumpleton wrote ..
</I>&gt;<i>  &gt; The macros supposedly try and make it type safe, so haven't quite worked
</I>&gt;<i>  &gt; out how you are meant to use them yet. In part it looks like compile 
</I>&gt;<i> time
</I>&gt;<i>  &gt; binding is required, which would be an issue with Python. What you might
</I>&gt;<i>  &gt; be able to do though is write a little C based Python module which did
</I>&gt;<i>  &gt; the lookup and calling of &quot;ssl_var_lookup()&quot; for you by going direct to
</I>&gt;<i>  &gt; the Apache runtime library calls. May work. :-)
</I>&gt;<i> 
</I>&gt;<i> See if you can get the attached code (2 files) to work for you. You will 
</I>&gt;<i> need to
</I>&gt;<i> modify the setup.py to point to appropriate include and library 
</I>&gt;<i> directories and
</I>&gt;<i> correct name for APR libraries on your platform.
</I>&gt;<i> 
</I>&gt;<i> The code all compiles, but since I don't have mod_ssl setup I get back 
</I>&gt;<i> nothing.
</I>&gt;<i> The first argument to each method must be the request object. It will 
</I>&gt;<i> crash if
</I>&gt;<i> it isn't as haven't been able to have check in code that it is in fact a 
</I>&gt;<i> request
</I>&gt;<i> object because undefined as am not linking against mod_python .so.
</I>&gt;<i> 
</I>&gt;<i> The handler I was using was as follows, but you should be able to adapt it.
</I>&gt;<i> 
</I>&gt;<i> import _mp_mod_ssl
</I>&gt;<i> import vampire
</I>&gt;<i> 
</I>&gt;<i> class _Object:
</I>&gt;<i> 
</I>&gt;<i>   def is_https(self,req):
</I>&gt;<i>     return _mp_mod_ssl.is_https(req)
</I>&gt;<i> 
</I>&gt;<i>   def var_lookup(self,req,name):
</I>&gt;<i>     return _mp_mod_ssl.var_lookup(req,name)
</I>&gt;<i> 
</I>&gt;<i> handler = vampire.Publisher(_Object())
</I>&gt;<i> 
</I>&gt;<i> Let me know how you go. Is an interesting problem which is why I decided
</I>&gt;<i> to play with it when I should have been doing real work. :-)
</I>&gt;<i> 
</I>&gt;<i> Graham
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> ------------------------------------------------------------------------------------------------- 
</I>&gt;<i> 
</I>&gt;<i> Ing. Bud P. Bruegger, Ph.D.                 +39-0564-488577 (voice),  
</I>&gt;<i> -21139 (fax)
</I>&gt;<i> Servizio Elaborazione Dati                    e-mail:  
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">bud at comune.grosseto.it</A>
</I>&gt;<i> Comune di Grosseto                            jabber:  <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">bud at jabber.no</A>
</I>&gt;<i> Via Ginori, 43                                      
</I>&gt;<i> <A HREF="http://www.comune.grosseto.it/cie/">http://www.comune.grosseto.it/cie/</A>
</I>&gt;<i> 58100 Grosseto (Tuscany, Italy)           
</I>&gt;<i> <A HREF="http://www.comune.grosseto.it/interopEID/">http://www.comune.grosseto.it/interopEID/</A>
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> ------------------------------------------------------------------------
</I>&gt;<i> 
</I>&gt;<i> #include &lt;Python.h&gt;
</I>&gt;<i> 
</I>&gt;<i> #include &lt;apr.h&gt;
</I>&gt;<i> #include &lt;mod_python.h&gt;
</I>&gt;<i> 
</I>&gt;<i> typedef int (*ssl_is_https_t)(conn_rec*);
</I>&gt;<i> 
</I>&gt;<i> static PyObject* is_https(PyObject* module, PyObject* args)
</I>&gt;<i> {
</I>&gt;<i>   requestobject* request_object = 0;
</I>&gt;<i>   ssl_is_https_t ssl_is_https = 0;
</I>&gt;<i>   int result = 0;
</I>&gt;<i> 
</I>&gt;<i>   if (!PyArg_ParseTuple(args,&quot;O&quot;,&amp;request_object))
</I>&gt;<i>     return 0;
</I>&gt;<i> 
</I>&gt;<i> #if 0
</I>&gt;<i>   /* How to ensure symbol is resolved. */
</I>&gt;<i>   if (!MpRequest_Check(request_object))
</I>&gt;<i>     PyErr_SetString(PyExc_TypeError,&quot;not a request object&quot;);
</I>&gt;<i> #endif
</I>&gt;<i> 
</I>&gt;<i>   ssl_is_https = (ssl_is_https_t)apr_dynamic_fn_retrieve(&quot;ssl_is_https&quot;);
</I>&gt;<i> 
</I>&gt;<i>   if (ssl_is_https == 0)
</I>&gt;<i>     return Py_BuildValue(&quot;i&quot;,0);
</I>&gt;<i> 
</I>&gt;<i>   result = ssl_is_https(request_object-&gt;request_rec-&gt;connection);
</I>&gt;<i> 
</I>&gt;<i>   return Py_BuildValue(&quot;i&quot;,result);
</I>&gt;<i> }
</I>&gt;<i> 
</I>&gt;<i> typedef char* (*ssl_var_lookup_t)(apr_pool_t*,
</I>&gt;<i>  server_rec*, conn_rec*, request_rec*, char*);
</I>&gt;<i> 
</I>&gt;<i> static PyObject* var_lookup(PyObject* module, PyObject* args)
</I>&gt;<i> {
</I>&gt;<i>   requestobject* request_object = 0;
</I>&gt;<i>   char* variable_name = 0;
</I>&gt;<i>   ssl_var_lookup_t ssl_var_lookup = 0;
</I>&gt;<i>   char* variable_value = 0;
</I>&gt;<i>   PyObject* result = 0;
</I>&gt;<i> 
</I>&gt;<i>   if (!PyArg_ParseTuple(args,&quot;Os&quot;,&amp;request_object,&amp;variable_name))
</I>&gt;<i>     return 0;
</I>&gt;<i> 
</I>&gt;<i> #if 0
</I>&gt;<i>   /* How to ensure symbol is resolved. */
</I>&gt;<i>   if (!MpRequest_Check(request_object))
</I>&gt;<i>     PyErr_SetString(PyExc_TypeError,&quot;not a request object&quot;);
</I>&gt;<i> #endif
</I>&gt;<i> 
</I>&gt;<i>   ssl_var_lookup = (ssl_var_lookup_t)apr_dynamic_fn_retrieve(&quot;ssl_var_lookup&quot;);
</I>&gt;<i> 
</I>&gt;<i>   if (ssl_var_lookup == 0)
</I>&gt;<i>   {
</I>&gt;<i>     Py_XINCREF(Py_None);
</I>&gt;<i>       
</I>&gt;<i>     return Py_None;
</I>&gt;<i>   }
</I>&gt;<i> 
</I>&gt;<i>   variable_value = ssl_var_lookup(
</I>&gt;<i>    request_object-&gt;request_rec-&gt;pool,
</I>&gt;<i>    request_object-&gt;request_rec-&gt;server,
</I>&gt;<i>    request_object-&gt;request_rec-&gt;connection,
</I>&gt;<i>    request_object-&gt;request_rec,
</I>&gt;<i>    variable_name);
</I>&gt;<i> 
</I>&gt;<i>   result = Py_BuildValue(&quot;s&quot;,variable_value);
</I>&gt;<i> 
</I>&gt;<i>   free(variable_value);
</I>&gt;<i> 
</I>&gt;<i>   return result;
</I>&gt;<i> }
</I>&gt;<i> 
</I>&gt;<i> static struct PyMethodDef mp_mod_ssl_methods[] = {
</I>&gt;<i>   { &quot;is_https&quot;, is_https, 1 },
</I>&gt;<i>   { &quot;var_lookup&quot;, var_lookup, 1 },
</I>&gt;<i>   { NULL, NULL },
</I>&gt;<i> };
</I>&gt;<i> 
</I>&gt;<i> void init_mp_mod_ssl(void)
</I>&gt;<i> {
</I>&gt;<i>   PyObject* module;
</I>&gt;<i> 
</I>&gt;<i>   module = Py_InitModule(&quot;_mp_mod_ssl&quot;,mp_mod_ssl_methods);
</I>&gt;<i> 
</I>&gt;<i>   if (module == 0)
</I>&gt;<i>     Py_FatalError(&quot;can't initialise module _mp_mod_ssl&quot;);
</I>&gt;<i> }
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> ------------------------------------------------------------------------
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>
</PRE>






















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020340.html">SSL-data access from verious handlers.  was:
	Re:[mod_python] problem w/ authen handler
</A></li>
	<LI>Next message: <A HREF="020342.html">[mod_python] PSP TypeError: cannot concatenate 'str' and 
	'instance' objects
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20341">[ date ]</a>
              <a href="thread.html#20341">[ thread ]</a>
              <a href="subject.html#20341">[ subject ]</a>
              <a href="author.html#20341">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
