<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Publisher Weirdness
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Publisher%20Weirdness&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020456.html">
   <LINK REL="Next"  HREF="020466.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Publisher Weirdness</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Publisher%20Weirdness&In-Reply-To="
       TITLE="[mod_python] Publisher Weirdness">grahamd at dscpl.com.au
       </A><BR>
    <I>Mon Feb 27 16:28:23 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="020456.html">[mod_python] Publisher Weirdness
</A></li>
        <LI>Next message: <A HREF="020466.html">[mod_python] Publisher Weirdness
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20461">[ date ]</a>
              <a href="thread.html#20461">[ thread ]</a>
              <a href="subject.html#20461">[ subject ]</a>
              <a href="author.html#20461">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>marinus van aswegen wrote ..
&gt;<i> Hi Graham
</I>&gt;<i> 
</I>&gt;<i> I thought that my session line will not just create the session but will
</I>&gt;<i> access the session for that request?
</I>
No it doesn't.

What you will need to do is to use a scheme whereby you cache the
first created session object for later access. The common convention
for this is to save it as &quot;req.session&quot;.

def _get_session(req):
  if not hasattr(req,&quot;session&quot;):
    req.session = Session.Session(req, secret = config.cookie_passwd)
    ... perform any first time initialisation etc.
  return req.session

def _validate_session(req):
    session = _get_session(req)
    ....

def test(req):
  _validate_session(req)
  session = req.session
  ...

BTW, ensure you put an underscore before these utility functions
else they will be directly accessible to remote users with the right
URL. The underscore will hide them.

PS, please try and keep replies on the mailing list by using &quot;Reply All&quot;
and not just &quot;Reply&quot;.

Graham

&gt;<i> On 2/27/06, Graham Dumpleton &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">grahamd at dscpl.com.au</A>&gt; wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On 27/02/2006, at 7:36 PM, marinus van aswegen wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; def validate_session(req):
</I>&gt;<i> &gt; &gt;     &quot;&quot;&quot;
</I>&gt;<i> &gt; &gt;     this function must be called prior to all function to
</I>&gt;<i> &gt; &gt;     ensure that the user is autenticated
</I>&gt;<i> &gt; &gt;     &quot;&quot;&quot;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;     # get the session for this request
</I>&gt;<i> &gt; &gt;     session = Session.Session(req, secret = config.cookie_passwd)
</I>&gt;<i> &gt; &gt;      .....
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; def test(req):
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;     validate_session(req)
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;     session = Session.Session(req, secret = config.cookie_passwd)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Here is your first problem. The validate_session() function has already
</I>&gt;<i> &gt; created a session object. Creating the second here for the same request
</I>&gt;<i> &gt; will cause a deadlock.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; There are various other things which could be done better, but will just
</I>&gt;<i> &gt; point out this obvious thing for now.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Graham
</I>&gt;<i> &gt;
</I></PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020456.html">[mod_python] Publisher Weirdness
</A></li>
	<LI>Next message: <A HREF="020466.html">[mod_python] Publisher Weirdness
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20461">[ date ]</a>
              <a href="thread.html#20461">[ thread ]</a>
              <a href="subject.html#20461">[ subject ]</a>
              <a href="author.html#20461">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
