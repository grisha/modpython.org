<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Re: forks, daemons, and other beasts
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Re%3A%20forks%2C%20daemons%2C%20and%20other%20beasts&In-Reply-To=0D2130C2-3B07-46E7-8610-FDFEC0E62029%40dscpl.com.au">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020244.html">
   <LINK REL="Next"  HREF="020246.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Re: forks, daemons, and other beasts</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Daniel Nogradi</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Re%3A%20forks%2C%20daemons%2C%20and%20other%20beasts&In-Reply-To=0D2130C2-3B07-46E7-8610-FDFEC0E62029%40dscpl.com.au"
       TITLE="[mod_python] Re: forks, daemons, and other beasts">nogradi at gmail.com
       </A><BR>
    <I>Sun Feb 12 06:03:47 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="020244.html">[mod_python] Re: forks, daemons, and other beasts
</A></li>
        <LI>Next message: <A HREF="020246.html">[mod_python] Re: forks, daemons, and other beasts
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20245">[ date ]</a>
              <a href="thread.html#20245">[ thread ]</a>
              <a href="subject.html#20245">[ subject ]</a>
              <a href="author.html#20245">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> &gt;&gt;&gt;&gt; The documentation for thread says that
</I>&gt;<i> &gt;&gt;&gt;&gt; When the main thread exits, it is system defined whether the other
</I>&gt;<i> &gt;&gt;&gt;&gt; threads survive. On SGI IRIX using the native thread
</I>&gt;<i> &gt;&gt;&gt;&gt; implementation,
</I>&gt;<i> &gt;&gt;&gt;&gt; they survive. On most other systems, they are killed without
</I>&gt;<i> &gt;&gt;&gt;&gt; executing
</I>&gt;<i> &gt;&gt;&gt;&gt; try ... finally clauses or executing object destructors.
</I>&gt;<i> &gt;&gt;&gt;&gt; I tested this and indeed whatever is called with
</I>&gt;<i> &gt;&gt;&gt;&gt; thread.start_new_thread it will die if execution reaches the end of
</I>&gt;<i> &gt;&gt;&gt;&gt; the original program.
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; This may be completely off, but how about sending the
</I>&gt;<i> &gt;&gt;&gt; notification, closing the connection to the client, then
</I>&gt;<i> &gt;&gt;&gt; unzipping in the same thread?
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; I doubt the client socket connection would be closed off if one
</I>&gt;<i> &gt;&gt; did that
</I>&gt;<i> &gt;&gt; and if no content length was specified, the client browser would
</I>&gt;<i> &gt;&gt; probably
</I>&gt;<i> &gt;&gt; hang waiting for socket connection to close and thus would not
</I>&gt;<i> &gt;&gt; necessarily
</I>&gt;<i> &gt;&gt; render what it had already received. In other words, the content
</I>&gt;<i> &gt;&gt; handler
</I>&gt;<i> &gt;&gt; has to return for socket connection to get closed off. That is
</I>&gt;<i> &gt;&gt; also presuming
</I>&gt;<i> &gt;&gt; that keep alive is not enabled.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Graham
</I>&gt;<i> &gt; I think you might've misunderstood what I meant, or else I said it
</I>&gt;<i> &gt; wrong. I'm talking about sending some data along, then manually
</I>&gt;<i> &gt; doing whatever the mod_python equivalent of shutdown(socket,
</I>&gt;<i> &gt; SHUT_RDWR) is, then performing what you need to do (in this case
</I>&gt;<i> &gt; unzipping). AFAIK, this guarantees that the connection is closed by
</I>&gt;<i> &gt; sending FIN, rather than the alternative, simply closing it (which
</I>&gt;<i> &gt; will leave the connection hanging if the fd is open in any other
</I>&gt;<i> &gt; threads or processes).
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Another possibility is dumping the zip file into an incoming
</I>&gt;<i> &gt; directory, then having a cron job or scheduled task periodically
</I>&gt;<i> &gt; unzip any files in that directory. I don't know if this would work
</I>&gt;<i> &gt; for your application, though.
</I>&gt;<i>
</I>&gt;<i> I knew what you meant. It simply isn't possible in mod_python/Apache
</I>&gt;<i> to say
</I>&gt;<i> shutdown the socket connection. There are potentially various layers
</I>&gt;<i> of Apache
</I>&gt;<i> filters and other stuff between the mod_python handler and the socket
</I>&gt;<i> and
</I>&gt;<i> mod_python doesn't have a direct handle on the socket that it can
</I>&gt;<i> manipulate.
</I>&gt;<i> Thus, in the context of mod_python, it isn't that simple.
</I>
One more thought: it seems that if MaxRequestsPerChild is 1, then
anything threaded from the script handling the request will die when
the script ends, but if MaxRequestsPerChild is N &gt; 1, then it doesn't
die, so everything seems to be okay. But what if the request is
exactly the Nth for that particular child, then it will be the same as
before, and the thread will die, won't it?

</PRE>



















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020244.html">[mod_python] Re: forks, daemons, and other beasts
</A></li>
	<LI>Next message: <A HREF="020246.html">[mod_python] Re: forks, daemons, and other beasts
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20245">[ date ]</a>
              <a href="thread.html#20245">[ thread ]</a>
              <a href="subject.html#20245">[ subject ]</a>
              <a href="author.html#20245">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
