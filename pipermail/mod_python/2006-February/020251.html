<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Re: forks, daemons and other beasts
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Re%3A%20forks%2C%20daemons%20and%20other%20beasts&In-Reply-To=43F03CE8.2060000%40natlab.research.philips.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020248.html">
   <LINK REL="Next"  HREF="020255.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Re: forks, daemons and other beasts</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Daniel Nogradi</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Re%3A%20forks%2C%20daemons%20and%20other%20beasts&In-Reply-To=43F03CE8.2060000%40natlab.research.philips.com"
       TITLE="[mod_python] Re: forks, daemons and other beasts">nogradi at gmail.com
       </A><BR>
    <I>Mon Feb 13 15:44:52 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="020248.html">[mod_python] Re: forks, daemons and other beasts
</A></li>
        <LI>Next message: <A HREF="020255.html">[mod_python] Re: forks, daemons and other beasts
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20251">[ date ]</a>
              <a href="thread.html#20251">[ thread ]</a>
              <a href="subject.html#20251">[ subject ]</a>
              <a href="author.html#20251">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> (Uh... Just one observation: They UPLOAD a ZIP file, and you expect the 
</I>&gt;<i> unpacking to take longer than that?)
</I>
The unpacking itself doesn't take that long, but until the unpacked files reach their final destination (directories, databases, etc) will take quite some time as they have to be processed in some way. But I agree, uploading takes much longer, but I would like to make the waiting time for the users as short as possible, and in principle the unpacking/processing/etc can be done after they receive an acknowledgement page.

&gt;<i> You might consider using the latest mod_python 3.2.7 modification that 
</I>&gt;<i> supports file &quot;streaming&quot;. You can unpack the ZIP while it's being 
</I>&gt;<i> uploaded. This also prevents using TEMP space. And when the upload is 
</I>&gt;<i> ready, the files are there as well. I tested this method for uploading 
</I>&gt;<i> multi-gigabyte TAR files.
</I>&gt;<i> 
</I>&gt;<i> The trick is to add a file callback to the FieldStorage object. I have 
</I>&gt;<i> attached a sample upload PSP script that just counts bytes. I'll leave 
</I>&gt;<i> it up to your imagination to feed the data into a ZipFile object.
</I>&gt;<i> 
</I>&gt;<i> Attempting to fork extra threads or processes from within an Apache 
</I>&gt;<i> instance will bring you lots of troubles - and you never know what 
</I>&gt;<i> happens in future versions.
</I>&gt;<i> 
</I>&gt;<i> --
</I>&gt;<i> Mike Looijmans
</I>&gt;<i> 
</I>&gt;<i> 
</I>
Thanks a lot for the code, I didn't even think about such an approach, this would be the best of course.


&gt;<i> For example, if you have this script, /tmp/foo.py:
</I>&gt;<i> 
</I>&gt;<i>     ############################################################
</I>&gt;<i>     # /tmp/foo.py
</I>&gt;<i> 
</I>&gt;<i>     import signal
</I>&gt;<i>     import time
</I>&gt;<i> 
</I>&gt;<i>     # ignore the TERM signal, so if apache kills the child process
</I>&gt;<i>     # that forked me I won't die.
</I>&gt;<i>     signal.signal(signal.SIGTERM, signal.SIG_IGN)
</I>&gt;<i> 
</I>&gt;<i>     # Your Code Here!
</I>&gt;<i>     # for this demo we'll sleep, so you have time to stop apache and
</I>&gt;<i>     # see this is still running
</I>&gt;<i>     time.sleep(30)
</I>&gt;<i> 
</I>&gt;<i>     # some output to prove we ran
</I>&gt;<i>     print &quot;hello, world&quot;
</I>&gt;<i> 
</I>&gt;<i>     #
</I>&gt;<i>     ############################################################
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Then in your handler:
</I>&gt;<i> 
</I>&gt;<i>     os.system('python /tmp/foo.py &gt;&amp; /tmp/foo.log &amp;')
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Daniel Popowich
</I>&gt;<i> ---------------
</I>&gt;<i> <A HREF="http://home.comcast.net/~d.popowich/mpservlets/">http://home.comcast.net/~d.popowich/mpservlets/</A>
</I>

I'm not sure I understand this. AFAIK both os.spawn* and os.system start a brand new process, with the only difference being how command line arguments are handled. Or not?

</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020248.html">[mod_python] Re: forks, daemons and other beasts
</A></li>
	<LI>Next message: <A HREF="020255.html">[mod_python] Re: forks, daemons and other beasts
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20251">[ date ]</a>
              <a href="thread.html#20251">[ thread ]</a>
              <a href="subject.html#20251">[ subject ]</a>
              <a href="author.html#20251">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
