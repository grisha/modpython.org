<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] post request and the minimalistic handler
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20post%20request%20and%20the%20minimalistic%20handler&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020402.html">
   <LINK REL="Next"  HREF="020358.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] post request and the minimalistic handler</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Daniel Nogradi</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20post%20request%20and%20the%20minimalistic%20handler&In-Reply-To="
       TITLE="[mod_python] post request and the minimalistic handler">nogradi at gmail.com
       </A><BR>
    <I>Sun Feb 19 12:13:24 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="020402.html">[mod_python] Re: Mike's psp upload
</A></li>
        <LI>Next message: <A HREF="020358.html">[mod_python] post request and the minimalistic handler
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20357">[ date ]</a>
              <a href="thread.html#20357">[ thread ]</a>
              <a href="subject.html#20357">[ subject ]</a>
              <a href="author.html#20357">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I try to figure out exactly how an actual request gets converted into
an mp_request object, especially if its content-type is
multpart/form-data containing an uploaded file.

As a first step (with the zeroth step being reading the source of
publisher.py and util.py) I wanted to see what happens if the
minimalistic handler mentioned in the docs receives a POST requests
sent from a file upload form such as

&lt;html&gt;&lt;body&gt;
&lt;form enctype=&quot;multipart/form-data&quot; method=&quot;post&quot;
action=&quot;<A HREF="http://server/testhandler/x&quot;">http://server/testhandler/x&quot;</A>&gt;
&lt;input type=&quot;file&quot; name=&quot;upload_this&quot;&gt;
&lt;input type=&quot;submit&quot; name=&quot;go&quot; value=&quot;Click this&quot;&gt;
&lt;/form&gt;
&lt;/body&gt;&lt;/html&gt;

and apache is given the following:

&lt;Directory /var/www/html/testhandler&gt;
    SetHandler python-program
    PythonHandler mod_python.myhandler
    LimitRequestBody 0
&lt;/Directory&gt;

and the request handler myhandler.py is:

from mod_python import apache

def handler( req ):
     req.content_type = &quot;text/html&quot;
     req.write( &quot;hello&quot; )
     return apache.OK

I would assume that no matter what kind of request comes in to the
hierarchy under /testhandler the response from the server should be
'hello' under all circumstances. With GET requests everything is okay,
the response is

HTTP/1.1 200 OK
Date: Sun, 19 Feb 2006 17:11:54 GMT
Server: Apache/2.0.53 (Fedora)
Connection: close
Transfer-Encoding: chunked
Content-Type: text/html; charset=UTF-8

5
hello
0

which gets displayed nicely by Firefox as 'hello'.

The trouble starts when POST request are coming in for example through
the html form above. After sending the form Firefox says 'The document
contains no data' in a warning window (actually it displays 'hello'
once or twice, but 99% of the time it just shows the warning). However
after checking the log files of apache it turns out that everything
went okay with the request, a 200 code was sent and the length of the
response is also correctly shown to be 5. So it seems that from the
point of view of the server everything went fine, but somehow Firefox
never gets (or it thinks it doesn't get) the 200 code and the response
containing 'hello'.

In order to see if it was really a Firefox issue I put together the
POST request by hand and sent it to the server with netcat and
everything went as expected, the output was the same as above.

So it seems it is a Firefox issue, but I'm a bit surprised that such a
simple example would not work with Firefox. Am I expecting something
that I shouldn't?

</PRE>


















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020402.html">[mod_python] Re: Mike's psp upload
</A></li>
	<LI>Next message: <A HREF="020358.html">[mod_python] post request and the minimalistic handler
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20357">[ date ]</a>
              <a href="thread.html#20357">[ thread ]</a>
              <a href="subject.html#20357">[ subject ]</a>
              <a href="author.html#20357">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
