<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Re: more callable__auth__
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Re%3A%20more%20callable__auth__&In-Reply-To=20060225002807.10711.qmail%40web81204.mail.mud.yahoo.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020438.html">
   <LINK REL="Next"  HREF="020437.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Re: more callable__auth__</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Re%3A%20more%20callable__auth__&In-Reply-To=20060225002807.10711.qmail%40web81204.mail.mud.yahoo.com"
       TITLE="[mod_python] Re: more callable__auth__">grahamd at dscpl.com.au
       </A><BR>
    <I>Fri Feb 24 19:59:01 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="020438.html">[mod_python] [ANNOUNCE] Mod_python 3.2.8 (security)
</A></li>
        <LI>Next message: <A HREF="020437.html">[mod_python] Re: more callable__auth__
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20436">[ date ]</a>
              <a href="thread.html#20436">[ thread ]</a>
              <a href="subject.html#20436">[ subject ]</a>
              <a href="author.html#20436">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Please keep followups on mailing list. :-(

On 25/02/2006, at 11:28 AM, Robert Thomas Davis wrote:

&gt;<i> Graham
</I>&gt;<i>
</I>&gt;<i> ...finally got everything up and running with the new
</I>&gt;<i> version :)  Now I get a NameError exception on the
</I>&gt;<i> call to validate_user (which, at least, is a step in
</I>&gt;<i> the right direction)!!
</I>&gt;<i>
</I>&gt;<i> Do you have any suggestions as to what would be a
</I>&gt;<i> better way to structure this so I don't encounter that
</I>&gt;<i> issue?  Basically what I am trying to accomplish is
</I>&gt;<i> the following...
</I>&gt;<i>
</I>&gt;<i> There will be more defs in index.py (like the devices
</I>&gt;<i> def) whose contents I want to protect.  I want to
</I>&gt;<i> ensure that the user will have to enter their
</I>&gt;<i> user/passwd anytime attempts are made to access these
</I>&gt;<i> functions (unless the current session is still valid
</I>&gt;<i> of course).  After reading that article you references
</I>&gt;<i> it seems I would need to move the validate_user
</I>&gt;<i> function to an outside module and then import it
</I>&gt;<i> inside the def __auth__()??
</I>
Personally I wouldn't use the mod_python.publisher authentication,
but that is a topic for another time.

If you must use the mod_python.publisher support for basic  
authentication,
then use a wrapper class to do it. If you have Python 2.4, you could  
even
use decorators for the purpose to make it a really clean solution.

Basic code is:

   from mod_python import apache

   class Restricted:
     def __init__(self,method,realm=&quot;Restricted Access&quot;):
       self.__call__ = method
       self.__auth_realm__ = realm
     def __auth__(self,req,user,password):
       apache.log_error(&quot;__auth__&quot;)
       return user == &quot;mickey&quot; and password == &quot;mouse&quot;

   def index(req):
     return &quot;index&quot;

   def page1(req):
     return &quot;page1&quot;

   def page2(req):
     return &quot;page2&quot;

   page2 = Restricted(page2)

The &quot;Restricted&quot; class acts as a wrapper around the published function.
The auth functions are actually in the wrapper class. Because the  
wrapper
class is at global scope, you don't have the problem with nested  
functions
that you are seeing.

I don't have Python 2.4, so can't give you a solution which uses  
decorators,
but I am sure that someone else on the mailing list who has and  
understands
decorators could provide so code pretty quick. The ideas with decorators
is you should be able to setup the code so all you need to do is  
something
like:

   def index(req):
     return &quot;index&quot;

   def page1(req):
     return &quot;page1&quot;

   @restricted
   def page2(req):
     return &quot;page2&quot;

The decorator would do the magic of wrapping the function for you  
automatically.
To me this would be a really clean solution, although possibly  
restricted to use
of functions.

Anyone want to step up and provide a decorator solution for this?

&gt;<i> Also, do any RPMs exist for these more recent versions
</I>&gt;<i> of mod_python OR is there a documented procedure for
</I>&gt;<i> building a mod_python RPM from the recent releases?
</I>
I imagine someone will put together an RPM for 3.2.7/3.2.8
at some stage. This is usually done by someone attached to
the maintainers of the Linux distribution and not the mod_python
folks though.

Graham

&gt;<i> --- Graham Dumpleton &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">grahamd at dscpl.com.au</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Robert Thomas Davis wrote ..
</I>&gt;&gt;&gt;<i> Graham
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Sorry...your replies were be sent to the &quot;bulk&quot;
</I>&gt;&gt;&gt;<i> folder...glad I checked it before just deleting
</I>&gt;&gt;<i> all!
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I am using mod_python 3.1.3 with apache 2.0.53 on
</I>&gt;&gt;&gt;<i> Fedora Core 3.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Any chance you can upgrade to mod_python 3.2.7? I
</I>&gt;&gt;<i> really can't find
</I>&gt;&gt;<i> any problem with the basic structure of what you are
</I>&gt;&gt;<i> doing, but there
</I>&gt;&gt;<i> have been fixes to publisher in 3.2.7 that may mean
</I>&gt;&gt;<i> I am not seeing
</I>&gt;&gt;<i> the problem.
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> The url I use to access the &quot;devices&quot; page (the
</I>&gt;&gt;<i> one I
</I>&gt;&gt;&gt;<i> would like to protect) is
</I>&gt;&gt;<i> <A HREF="http://localhost/devices.">http://localhost/devices.</A>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I do agree about having the info on the mailing
</I>&gt;&gt;<i> list
</I>&gt;&gt;&gt;<i> so others could learn from it; maybe we can post
</I>&gt;&gt;<i> the
</I>&gt;&gt;&gt;<i> results.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The ongoing discussion is also useful, as the actual
</I>&gt;&gt;<i> debugging process
</I>&gt;&gt;<i> itself can be just as useful as the final result.
</I>&gt;&gt;<i> Thus, use reply-all.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Graham
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Thanks,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> --- Graham Dumpleton &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">grahamd at dscpl.com.au</A>&gt; wrote:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> BTW, I can't seem to find that you have ever
</I>&gt;&gt;<i> said
</I>&gt;&gt;&gt;&gt;<i> exactly which version
</I>&gt;&gt;&gt;&gt;<i> of mod_python you are using. Are you using the
</I>&gt;&gt;&gt;&gt;<i> latest version?
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Graham
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Graham Dumpleton wrote ..
</I>&gt;&gt;&gt;&gt;&gt;<i> Still generally prefer it to be on the mailing
</I>&gt;&gt;&gt;&gt;<i> list as other people can
</I>&gt;&gt;&gt;&gt;&gt;<i> learn from it and it is in the mailing list
</I>&gt;&gt;&gt;&gt;<i> archive as well, so people
</I>&gt;&gt;&gt;&gt;&gt;<i> down the track may find it as well and it may
</I>&gt;&gt;&gt;&gt;<i> solve a problem for
</I>&gt;&gt;&gt;&gt;&gt;<i> them also.
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> One more question. What URLs are you using to
</I>&gt;&gt;&gt;&gt;<i> access the resources
</I>&gt;&gt;&gt;&gt;&gt;<i> so I can relate that properly to the Apache
</I>&gt;&gt;&gt;&gt;<i> configuration and the
</I>&gt;&gt;&gt;&gt;&gt;<i> published functions in the file?
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> Graham
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> Robert Thomas Davis wrote ..
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> Hell graham
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> I really appreciate your help with
</I>&gt;&gt;<i> this...and
</I>&gt;&gt;&gt;&gt;<i> since
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> you have been the only one responding I
</I>&gt;&gt;<i> thought
</I>&gt;&gt;&gt;&gt;<i> I
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> might as well just mail you the files in
</I>&gt;&gt;&gt;&gt;<i> question
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> (index.py and httpd.conf, attached as a
</I>&gt;&gt;<i> .tgz)
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> The file index.py would normally live in the
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> directory:
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> /usr/local/lap/http/
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> Based on your last reply I am wondering if
</I>&gt;&gt;<i> it is
</I>&gt;&gt;&gt;&gt;<i> my
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> httpd.conf file that is setup incorrectly (i
</I>&gt;&gt;<i> do
</I>&gt;&gt;&gt;&gt;<i> not
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> get the 500 error at all).  When the
</I>&gt;&gt;<i> enclosed
</I>&gt;&gt;&gt;&gt;<i> code
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> gets executed it appears as though it skips
</I>&gt;&gt;&gt;&gt;<i> right over
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> the nested __auth__ fuction.  However, if
</I>&gt;&gt;<i> that
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> function is moved to the module scope
</I>&gt;&gt;<i> (index.py)
</I>&gt;&gt;&gt;&gt;<i> it
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> always gets called and subsequently calls
</I>&gt;&gt;<i> the
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> validate_users function.
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> Again...your help is much appreciated.
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> Rob
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;&gt;&gt;<i> Mod_python mailing list
</I>&gt;&gt;&gt;&gt;&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020438.html">[mod_python] [ANNOUNCE] Mod_python 3.2.8 (security)
</A></li>
	<LI>Next message: <A HREF="020437.html">[mod_python] Re: more callable__auth__
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20436">[ date ]</a>
              <a href="thread.html#20436">[ thread ]</a>
              <a href="subject.html#20436">[ subject ]</a>
              <a href="author.html#20436">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
