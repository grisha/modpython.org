<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Problem keeping persistent object in memory (global)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Problem%20keeping%20persistent%20object%20in%20memory%20%28global%29&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018289.html">
   <LINK REL="Next"  HREF="018294.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Problem keeping persistent object in memory (global)</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>S&#233;bastien Arnaud</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Problem%20keeping%20persistent%20object%20in%20memory%20%28global%29&In-Reply-To="
       TITLE="[mod_python] Problem keeping persistent object in memory (global)">arnaudsj at mac.com
       </A><BR>
    <I>Mon Jun  6 12:13:50 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="018289.html">[mod_python] mod_python and threading.Thread doesn't start
</A></li>
        <LI>Next message: <A HREF="018294.html">[mod_python] Problem keeping persistent object in memory (global)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18291">[ date ]</a>
              <a href="thread.html#18291">[ thread ]</a>
              <a href="subject.html#18291">[ subject ]</a>
              <a href="author.html#18291">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I have attempted to write my own little framework (&quot;heracles&quot; I named  
it;) to develop applications faster using mod_python and it is coming  
along great. Mainly I am using the framework to keep handy a bunch of  
little utils functions/objects I have written along the years while  
working with mod_python, such as a pool of connections for DB  
connections, XML/XSLT rendering, Cheetah template rendering, etc...

I am hitting the wall on a very stupid problem that I thought I had  
working. I can't get an object declared as global to remain in memory...
Under Apache Pre-fork MPM model, this I understand, but under the MPM  
Worker model, where I specify to start 10 threads in one process, I  
kind of don't get it... Maybe some of you will be able to spot what I  
am doing wrong.

Basically, what I am trying to do is to keep the object mySitePool in  
memory since each Site object (heracles.site) has everything needed  
by a thread to process a request. At the first request the mySitePool  
object should get initialized, but for any other requests it should  
be simply the matter of retrieving one Site object via the Queueing  
mechanism to process one request. Right now the problem is that I am  
able to see for each request one entry in the apache log file that  
the mySitePool is being initialized...

Thank you in advance for any pointers or solutions you may have!

Apache2 config (MPM worker):
---------------------------
&lt;IfModule worker.c&gt;
StartServers         1
MaxClients          10
MinSpareThreads     10
MaxSpareThreads      0
ThreadsPerChild     10
MaxRequestsPerChild  0
&lt;/IfModule&gt;


Apache2 mod_python (.htaccess):
-------------------------------
PythonInterpPerDirective On

PythonOption &quot;SiteName&quot; &quot;Heracles Test site&quot;
PythonOption &quot;SiteDescription&quot; &quot;Testing the framework!&quot;
PythonOption &quot;SiteVirtualPath&quot; &quot;/heracles/&quot;
PythonOption &quot;SiteViewPath&quot; &quot;/xxx/webapp/views/&quot;
PythonOption &quot;MySQLhost&quot; &quot;xxx&quot;
PythonOption &quot;MySQLuid&quot; &quot;arnaudsj&quot;
PythonOption &quot;MySQLpwd&quot; &quot;xxx&quot;
PythonOption &quot;MySQLdb&quot; &quot;test&quot;

SetHandler python-program
PythonHandler heracles.site::handler

PythonDebug On
PythonAutoReload On


heracles.site.py:
-----------------
[...]
def handler(req):
     &quot;&quot;&quot;
     Standard mod_python handler code for Heracles Web Application  
Framework
     The SitePool is initialized based on Apache MPM setting
     &quot;&quot;&quot;
     global mySitePool
     try:
         mySite = mySitePool.get()
     except NameError:
         req.log_error(&quot;Initializing Heracles WAF at %s with %s thread 
(s)&quot; % (req.document_root(), apache.mpm_query(6)))
         mySitePool = Pool(Constructor(Site, req), apache.mpm_query(6))
         mySite = mySitePool.get()
     return mySite(req)
     mySitePool.put(mySite)
[...]


Cheers,

S&#233;bastien





</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018289.html">[mod_python] mod_python and threading.Thread doesn't start
</A></li>
	<LI>Next message: <A HREF="018294.html">[mod_python] Problem keeping persistent object in memory (global)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18291">[ date ]</a>
              <a href="thread.html#18291">[ thread ]</a>
              <a href="subject.html#18291">[ subject ]</a>
              <a href="author.html#18291">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
