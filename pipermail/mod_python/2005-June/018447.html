<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] mod_python and execfile
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20mod_python%20and%20execfile&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018461.html">
   <LINK REL="Next"  HREF="018448.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] mod_python and execfile</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20mod_python%20and%20execfile&In-Reply-To="
       TITLE="[mod_python] mod_python and execfile">grahamd at dscpl.com.au
       </A><BR>
    <I>Mon Jun 20 18:23:32 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="018461.html">[mod_python] Is external redirect supposed to send a cookie
	(mpservlets)?
</A></li>
        <LI>Next message: <A HREF="018448.html">[mod_python] Is external redirect supposed to send a
	cookie(mpservlets)?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18447">[ date ]</a>
              <a href="thread.html#18447">[ thread ]</a>
              <a href="subject.html#18447">[ subject ]</a>
              <a href="author.html#18447">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>If what you are trying to do is come up with your own mechanism for 
dispatching different URLs against different handlers in different files,
you should probably start by researching how mod_python.cgihandler,
mod_python.publisher, mpservlets and Vampire work as they all provide
this basic feature in various ways

You will find mod_python.publisher and mod_python.cgihandler as a
part of mod_python itself. As to mpservlets and Vampire, you can
find them at:

  <A HREF="http://home.comcast.net/~d.popowich/mpservlets/">http://home.comcast.net/~d.popowich/mpservlets/</A>
  <A HREF="http://www.dscpl.com.au/projects/vampire">http://www.dscpl.com.au/projects/vampire</A>

A quick way of doing it (untested) would be:

  from mod_python import apache
  import os

  def handler(req):
      directory = os.path.dirname(req.filename)
      name = os.path.splitext(os.path.split(req.filename)[1])[0]
      module = apache.import_module(name,path=[directory])
      return module.main(req)

Then in the script file:

  def main(req):
     req.content_type = &quot;text/plain&quot;
     req.send_http_header()
     req.write('Hello there!')
     return apache.OK

This will not necessarily work in all situations as it doesn't do all
the checks it should. You would be better off using one of the
other dispatchers available unless your plan is to learn by writing
your own.

Graham

amit wrote ..
&gt;<i> Hello Grisha,
</I>&gt;<i> 
</I>&gt;<i>     def main():
</I>&gt;<i>         req.write('Hello there!')
</I>&gt;<i> 
</I>&gt;<i>     if __name__=='__main__':
</I>&gt;<i>         import test_mod              # test_mod.py is the name of the script
</I>&gt;<i>         ret = test_mod.main()
</I>&gt;<i>         sys.exit(ret)
</I>&gt;<i> 
</I>&gt;<i> Nothing happend.
</I>&gt;<i> I guessed that __name__ under mod_python might behave differently so I
</I>&gt;<i> changed the '==' to '!=' and got the following traceback:
</I>&gt;<i> 
</I>&gt;<i> 	Mod_python error: &quot;PythonHandler pythonframe&quot;
</I>&gt;<i> 
</I>&gt;<i> 	Traceback (most recent call last):
</I>&gt;<i> 
</I>&gt;<i> 	  File &quot;F:\Python23\Lib\site-packages\mod_python\apache.py&quot;, line 299,
</I>&gt;<i> in HandlerDispatch
</I>&gt;<i> 	    result = object(req)
</I>&gt;<i> 
</I>&gt;<i> 	  File &quot;C:/Program Files/Apache Group/Apache2/cgi-bin/mod_python/\pythonframe.py&quot;,
</I>&gt;<i> line 91, in handler
</I>&gt;<i> 	    execfile(req.filename, {'req':req})
</I>&gt;<i> 
</I>&gt;<i> 	  File &quot;C:/Program Files/Apache Group/Apache2/cgi-bin/mod_python/test_mod.py&quot;,
</I>&gt;<i> line 6, in ?
</I>&gt;<i> 	    ret = test_mod.main()
</I>&gt;<i> 
</I>&gt;<i> 	  File &quot;C:/Program Files/Apache Group/Apache2/cgi-bin/mod_python/\test_mod.py&quot;,
</I>&gt;<i> line 2, in main
</I>&gt;<i> 	    req.write('Hello there!')
</I>&gt;<i> 
</I>&gt;<i> 	NameError: global name 'req' is not defined
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Amit
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> I tried using the usual method to call main()
</I>&gt;<i> Gregory (Grisha) Trubetskoy wrote:
</I>&gt;<i> 
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; What calls the main() function below?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Grisha
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On Mon, 20 Jun 2005, amit wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;&gt; Hello,
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;   I am using mod_pyton to write a collection of scripts. And I am 
</I>&gt;<i> &gt;&gt; facing the following problem:
</I>&gt;<i> &gt;&gt; I use the handler to execute a script. And I try to pass the req 
</I>&gt;<i> &gt;&gt; object to it:
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; def handler(req):
</I>&gt;<i> &gt;&gt;    execfile(req.filename, {'req':req})
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; in the script I have the following code:
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; def main():
</I>&gt;<i> &gt;&gt;   req.write('Hello there!')
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; I know that the script is executed but I don't get the 'hello there!'
</I>&gt;<i> &gt;&gt; message in my browser. Can anyone help?
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Thanks
</I>&gt;<i> &gt;&gt;   Amit
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; _______________________________________________
</I>&gt;<i> &gt;&gt; Mod_python mailing list
</I>&gt;<i> &gt;&gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> &gt;&gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I></PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018461.html">[mod_python] Is external redirect supposed to send a cookie
	(mpservlets)?
</A></li>
	<LI>Next message: <A HREF="018448.html">[mod_python] Is external redirect supposed to send a
	cookie(mpservlets)?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18447">[ date ]</a>
              <a href="thread.html#18447">[ thread ]</a>
              <a href="subject.html#18447">[ subject ]</a>
              <a href="author.html#18447">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
