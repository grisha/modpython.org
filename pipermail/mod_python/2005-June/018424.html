<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Threading and apache.import_module
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Threading%20and%20apache.import_module&In-Reply-To=1119220444.6882%40dscpl.user.openhosting.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018423.html">
   <LINK REL="Next"  HREF="018422.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Threading and apache.import_module</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Nicolas Lehuen</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Threading%20and%20apache.import_module&In-Reply-To=1119220444.6882%40dscpl.user.openhosting.com"
       TITLE="[mod_python] Threading and apache.import_module">nicolas.lehuen at gmail.com
       </A><BR>
    <I>Mon Jun 20 02:11:38 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="018423.html">[mod_python] Threading and apache.import_module
</A></li>
        <LI>Next message: <A HREF="018422.html">[mod_python] Threading and apache.import_module
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18424">[ date ]</a>
              <a href="thread.html#18424">[ thread ]</a>
              <a href="subject.html#18424">[ subject ]</a>
              <a href="author.html#18424">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>2005/6/20, Graham Dumpleton &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">grahamd at dscpl.com.au</A>&gt;:
&gt;<i> michael bayer wrote ..
</I>&gt;<i> &gt; I just searched around for this, and hey youre right, it does.
</I>&gt;<i> &gt; Myghty imports &quot;in-memory&quot; modules in a similar way (i.e. via
</I>&gt;<i> &gt; imp.new_module + exec)....but I hadnt thought of just bypassing
</I>&gt;<i> &gt; sys.modules altogether.  A &quot;request-level&quot; module really doesnt need
</I>&gt;<i> &gt; to be generally importable so that now makes sense.
</I>&gt;<i> 
</I>&gt;<i> Unfortunately, if you want an alternate module import system to support
</I>&gt;<i> packages in a useful way, you don't have a choice but to still place loaded
</I>&gt;<i> modules into sys.modules. The key though is knowing that it isn't actually
</I>&gt;<i> necessary to name the module with its true module name. It can instead
</I>&gt;<i> be an arbitrary name based on the path name to the &quot;.py&quot; file. The name
</I>&gt;<i> can't be too long though as you run up against name length restrictions
</I>&gt;<i> in Python. Something like a md5 hexdigest of the full pathname generally
</I>&gt;<i> works okay. That said, the only problem with trying to support packages
</I>&gt;<i> is that dependency management can become hellish. It isn't enough to
</I>&gt;<i> simply reload the single file in a package which has changed, you must
</I>&gt;<i> reload the whole package because of the interdependencies that can exist
</I>&gt;<i> between the modules in the package. Also, if only one file in the package
</I>&gt;<i> is changed, anything dependent on any part of the module will need to
</I>&gt;<i> be reloaded at the next opportunity.
</I>
Regarding the naming of the package, don't give a module the same name
as its filename, that is to say with slashes and dots. It seems that
this breaks some behaviour of the Python import system, that is to say
that some imports that are performed in the dynamically loaded module
misteriously fail. I use a re.sub(r'\W+','_',filename) and everything
is OK. That being said, I didn't know about name length restrictions
so I have to correct my code to cope with this issue.

&gt;<i> &gt; I would most like to find a way to do this while also taking
</I>&gt;<i> &gt; advantage of .pyc files (seems like, create .pyc file if it doesnt
</I>&gt;<i> &gt; exist, else if it exists, read four bytes + one long value, then use
</I>&gt;<i> &gt; marshal.load() to create a code object, then exec that).
</I>&gt;<i> 
</I>&gt;<i> I would advise against trying to accomodate &quot;.pyc&quot; files. If you were to
</I>&gt;<i> do this you will in practice have to monitor the timestamps on both the
</I>&gt;<i> &quot;.py&quot; and &quot;.pyc&quot; files and contend with issues such as what to do when
</I>&gt;<i> the &quot;.pyc&quot; file is removed but the &quot;.py&quot; still exists but you were originally
</I>&gt;<i> loaded from the &quot;.pyc&quot; file. Similarly, what do you do if you are loaded
</I>&gt;<i> from the &quot;.pyc&quot; file and the &quot;.py&quot; file is removed. Does this imply that
</I>&gt;<i> the user is intending the page to now no longer be available. Another
</I>&gt;<i> cases is what do you do if you are loaded from the &quot;.pyc&quot; file and the
</I>&gt;<i> &quot;.py&quot; file modification time is changed to be older than what it was before.
</I>&gt;<i> Do you take this as meaning that an older file has been restored and
</I>&gt;<i> that should be used instead. As you can see you have to make various
</I>&gt;<i> assumptions and in some respects hope for the best. Although it can
</I>&gt;<i> be made to work in a reasonably sensible way, I found it complicates
</I>&gt;<i> the code unnecessarily and not worth the trouble, especially when
</I>&gt;<i> Apache generally runs as a user where &quot;.pyc&quot; files can't be created in
</I>&gt;<i> the first place.
</I>&gt;<i> 
</I>&gt;<i> Graham
</I>&gt;<i> 
</I>&gt;<i>
</I>
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018423.html">[mod_python] Threading and apache.import_module
</A></li>
	<LI>Next message: <A HREF="018422.html">[mod_python] Threading and apache.import_module
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18424">[ date ]</a>
              <a href="thread.html#18424">[ thread ]</a>
              <a href="subject.html#18424">[ subject ]</a>
              <a href="author.html#18424">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
