<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] This is just friggin' weird...
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20This%20is%20just%20friggin%27%20weird...&In-Reply-To=42BBFE5D.8040308%40sympatico.ca">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018490.html">
   <LINK REL="Next"  HREF="018496.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] This is just friggin' weird...</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20This%20is%20just%20friggin%27%20weird...&In-Reply-To=42BBFE5D.8040308%40sympatico.ca"
       TITLE="[mod_python] This is just friggin' weird...">grahamd at dscpl.com.au
       </A><BR>
    <I>Fri Jun 24 08:58:02 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="018490.html">[mod_python] This is just friggin' weird...
</A></li>
        <LI>Next message: <A HREF="018496.html">[mod_python] session and psp (Was This is just friggin' weird...)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18492">[ date ]</a>
              <a href="thread.html#18492">[ thread ]</a>
              <a href="subject.html#18492">[ subject ]</a>
              <a href="author.html#18492">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On 24/06/2005, at 10:36 PM, Jim Gallacher wrote:
&gt;<i> And misses these issues:
</I>&gt;<i> 3. Should the session automatically be saved in psp run()?
</I>&gt;<i>    Yes: - it's the current behavoiur
</I>&gt;<i>         - using sessions with psp pages is transparent
</I>&gt;<i>         - the user does not need to remember to do this
</I>&gt;<i>    No:  - the code monkey has less control over their application
</I>&gt;<i>         - ?
</I>&gt;<i>    Maybe we just need a attribute in the session to enable/disable 
</I>&gt;<i> saving? Default would be to save the session.
</I>&gt;<i>
</I>&gt;<i> 4. Should the session be unlocked in psp run()?
</I>&gt;<i>    Yes: - it's the current behavoiur
</I>&gt;<i>    No:  - since we are now passing around the session instance with 
</I>&gt;<i> the request, the session will be unlocked when the request is 
</I>&gt;<i> completed.
</I>
Am not suggesting that the behaviour of PSP object be changed for where 
it
is triggered from mod_python.psp, that would stay the same to ensure
compatibility. Am thinking more about the situation where someone is
using PSP object explicitly from a publisher handler to render HTML.

As it stands at the moment, if publisher code created a session object
and the PSP page accesses &quot;session&quot;, you will get a deadlock. This means
that in practice no one is doing this at the moment. Thus, one could 
have:

         session = None
         session_created = False
         if &quot;session&quot; in code.co_names:
             if not hasattr(req,&quot;session&quot;) or req.session is None:
                 session_created = True
             session = req.get_session()

         ....

                 if session is not None and session_created:
                     session.save()

         finally:
             if session is not None and session_created:
                     session.unlock()

In other words, if created by PSP object, still save it and unlock it.
If created externally, assume that code that triggered creation of it
will also ensure it is saved as well and unlock if appropriate.

Only problem with this is that req.get_session() hides the real session
object and there isn't a way to tell if it has already been created.
Ie., above assumes that &quot;session&quot; attribute stores the Session object
instance or provides access to it which doesn't current occur.

Thus, you might want to consider adding to request_rec_mbrs a hook for
getting access to the session object so one can tell if it has already 
been
created, or have a member function that can be called to query whether
session exists yet.

Graham

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018490.html">[mod_python] This is just friggin' weird...
</A></li>
	<LI>Next message: <A HREF="018496.html">[mod_python] session and psp (Was This is just friggin' weird...)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18492">[ date ]</a>
              <a href="thread.html#18492">[ thread ]</a>
              <a href="subject.html#18492">[ subject ]</a>
              <a href="author.html#18492">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
