<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] mod_python claims it cannot find a module
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20mod_python%20claims%20it%20cannot%20find%20a%20module&In-Reply-To=1120521905.24685%40dscpl.user.openhosting.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018591.html">
   <LINK REL="Next"  HREF="018596.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] mod_python claims it cannot find a module</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Nicolas Lehuen</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20mod_python%20claims%20it%20cannot%20find%20a%20module&In-Reply-To=1120521905.24685%40dscpl.user.openhosting.com"
       TITLE="[mod_python] mod_python claims it cannot find a module">nicolas.lehuen at gmail.com
       </A><BR>
    <I>Tue Jul  5 02:11:27 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="018591.html">[mod_python] mod_python claims it cannot find a module
</A></li>
        <LI>Next message: <A HREF="018596.html">[mod_python] mod_python claims it cannot find a module
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18594">[ date ]</a>
              <a href="thread.html#18594">[ thread ]</a>
              <a href="subject.html#18594">[ subject ]</a>
              <a href="author.html#18594">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks Graham, this was getting a little bit tricky for me...

AFAIK the publisher doesn't try to import index.py if importing the 
requested file fails. However, at one point I'm testing whether the 
requested file exists or not like this :

####################### The publisher handler himself 
########################## 

def handler(req):

 req.allow_methods([&quot;GET&quot;, &quot;POST&quot;, &quot;HEAD&quot;])
 if req.method not in [&quot;GET&quot;, &quot;POST&quot;, &quot;HEAD&quot;]:
 raise apache.SERVER_RETURN, apache.HTTP_METHOD_NOT_ALLOWED

 # if the file exists, req.finfo is not None
 if req.finfo:
 
 # The file exists, so we have a request of the form :
 # /directory/[module][/func_path]
 
 # we check whether there is a file name or not
 path, filename = split(req.filename)
 if not filename:
 
 # if not, we look for index.py
 req.filename = join(path, 'index.py')

 # Now we build the function path
 if not req.path_info or req.path_info=='/':

 # we don't have a path info, or it's just a slash,
 # so we'll call index
 func_path = 'index'

 else:

 # we have a path_info, so we use it, removing the first slash
 func_path = req.path_info[1:]
 
 else:
 
 # First we check if there is a Python module with that name
 # just by adding a .py extension
 if isfile(req.filename+'.py'):

 req.filename += '.py'
 
 # Now we build the function path
 if not req.path_info or req.path_info=='/':
 
 # we don't have a path info, or it's just a slash,
 # so we'll call index
 func_path = 'index'
 
 else:
 
 # we have a path_info, so we use it, removing the first slash
 func_path = req.path_info[1:]
 else:

 # The file does not exist, so it seems we are in the
 # case of a request in the form :
 # /directory/func_path
 
 # we'll just insert the module name index.py in the middle
 path, func_path = split(req.filename)
 req.filename = join(path, 'index.py')
 
 # I don't know if it's still possible to have a path_info
 # but if we have one, we append it to the filename which
 # is considered as a path_info.
 if req.path_info:
 func_path = func_path + req.path_info

What I suspect in Martin's case is that req.finfo returns None because of 
the global scope of his PythonHandler configuration, or something like that. 
Therefore, the publisher ends up executing the last branch which splits the 
requested file name into directory + func_path and adds index.py to the 
directory. I'll try to reproduce this behaviour and let you know about this.

Regards,
Nicolas

2005/7/5, Graham Dumpleton &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">grahamd at dscpl.com.au</A>&gt;:
&gt;<i> 
</I>&gt;<i> =?windows-1252?Q?Martin_MOKREJ=8A?= wrote ..
</I>&gt;<i> &gt; &gt; Because of problems with mixing &quot;import&quot; with the mod_python module
</I>&gt;<i> &gt; &gt; loader, you are actually better of using:
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; from mod_python import apache
</I>&gt;<i> &gt; &gt; import os
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; directory = os.path.dirname(__file__)
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; web_settings = apache.import_module(&quot;web_settings&quot;,path=[directory])
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Here you are explicitly telling it which directory to get the module
</I>&gt;<i> &gt; &gt; from and avoid all problems with things not being found in the Python
</I>&gt;<i> &gt; &gt; module search path. You should only use this for loading in your own
</I>&gt;<i> &gt; &gt; modules though, not standard Python modules.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Graham, how can I fork the code so that for normal &quot;console&quot; use it 
</I>&gt;<i> would
</I>&gt;<i> &gt; do
</I>&gt;<i> &gt; normal import and that when running under mod_apache it would run this
</I>&gt;<i> &gt; trick?
</I>&gt;<i> &gt; I use the modules also for command-line tests and some utilities.
</I>&gt;<i> &gt; What variable should I look for in __dict__.keys()? ;-)
</I>&gt;<i> 
</I>&gt;<i> You could use:
</I>&gt;<i> 
</I>&gt;<i> try:
</I>&gt;<i> from mod_python import apache
</I>&gt;<i> directory = os.path.dirname(__file__)
</I>&gt;<i> web_settings = apache.import_module(&quot;web_settings&quot;,path=[directory])
</I>&gt;<i> except:
</I>&gt;<i> import web_settings
</I>&gt;<i> 
</I>&gt;<i> The import of &quot;apache&quot; from a command line script will fail and thus
</I>&gt;<i> it will fall through to normal &quot;import&quot; statement for importing 
</I>&gt;<i> web_settings.
</I>&gt;<i> 
</I>&gt;<i> There are cleaner ways, but it gets quite complicated and the mod_python
</I>&gt;<i> module importing system as implemented by apache.import_module() has
</I>&gt;<i> some problems at the moment which makes it even worse. This all might
</I>&gt;<i> get solved in a future version of mod_python and at that point the cleaner
</I>&gt;<i> way may be available.
</I>&gt;<i> 
</I>&gt;<i> Graham
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050705/df9d4d95/attachment.html">http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050705/df9d4d95/attachment.html</A>
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018591.html">[mod_python] mod_python claims it cannot find a module
</A></li>
	<LI>Next message: <A HREF="018596.html">[mod_python] mod_python claims it cannot find a module
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18594">[ date ]</a>
              <a href="thread.html#18594">[ thread ]</a>
              <a href="subject.html#18594">[ subject ]</a>
              <a href="author.html#18594">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
