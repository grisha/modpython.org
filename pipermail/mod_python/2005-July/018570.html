<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] [Vampire] Module partially loaded?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20%5BVampire%5D%20Module%20partially%20loaded%3F&In-Reply-To=20050630215213.GA2190%40laperouse.internatif.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018569.html">
   <LINK REL="Next"  HREF="018571.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] [Vampire] Module partially loaded?</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20%5BVampire%5D%20Module%20partially%20loaded%3F&In-Reply-To=20050630215213.GA2190%40laperouse.internatif.org"
       TITLE="[mod_python] [Vampire] Module partially loaded?">grahamd at dscpl.com.au
       </A><BR>
    <I>Fri Jul  1 06:24:34 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="018569.html">[mod_python] Fwd: Mod_python compiled with one python but uses other
</A></li>
        <LI>Next message: <A HREF="018571.html">[mod_python] [Vampire] Module partially loaded?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18570">[ date ]</a>
              <a href="thread.html#18570">[ thread ]</a>
              <a href="subject.html#18570">[ subject ]</a>
              <a href="author.html#18570">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On 01/07/2005, at 7:52 AM, Stephane Bortzmeyer wrote:

&gt;<i> I have a Python module which defines several functions and also
</I>&gt;<i> includes a bit a code is executed when the module is imported:
</I>&gt;<i>
</I>&gt;<i> do_something()
</I>&gt;<i>
</I>&gt;<i> def function1():
</I>&gt;<i>    ...
</I>&gt;<i>
</I>&gt;<i> If do_something() fails (it connects to a database and the database
</I>&gt;<i> server may be down), the rest of the module is not executed, function1
</I>&gt;<i> is not defined but the module stays loaded: further requests just get
</I>&gt;<i> a message that there is no function1 defined.
</I>&gt;<i>
</I>&gt;<i> Restarting Apache is the only solution to get rid of the partly loaded
</I>&gt;<i> module.
</I>&gt;<i>
</I>&gt;<i> It seems a bug to me: if the module cannot be fully loaded because the
</I>&gt;<i> initialization code fails, the module should not be loaded at all, so
</I>&gt;<i> that further attempts have a chance to succeed.
</I>
I'll do some checking, but modules are imported using:

         # Perform the actual import of the module.

         try:
           execfile(file,module.__dict__)

         except:
           # Importation of module has failed for some
           # reason. If this is the very first import of
           # the module, need to discard the cache entry
           # entirely else a subsequent attempt to load
           # the module will wrongly think it was
           # successfully loaded already.

           if cache.module is None:
             del self._cache[label]

           raise

Thus, an exception on import is explicitly detected but only
for the purpose of ensuring that if this is the first time
that the module is being imported that the cache is cleared
of the partially constructed entry. If this isn't done then on
next import attempt it may think it has been loaded and
module reference will be None.

In either case, the error is propagated and the failed module
should be thrown away.

Is the module the error occurs in being explicitly loaded
using vampire.importModule() or using the &quot;import&quot; statement
and relying on the import hook to call vampire.importModule()
for you? Also, does it happen on the first loading of the
module or has the module been changed and is it on a reload?

Graham

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018569.html">[mod_python] Fwd: Mod_python compiled with one python but uses other
</A></li>
	<LI>Next message: <A HREF="018571.html">[mod_python] [Vampire] Module partially loaded?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18570">[ date ]</a>
              <a href="thread.html#18570">[ thread ]</a>
              <a href="subject.html#18570">[ subject ]</a>
              <a href="author.html#18570">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
