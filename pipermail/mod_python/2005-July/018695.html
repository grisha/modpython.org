<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Getting an Old Session
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Getting%20an%20Old%20Session&In-Reply-To=42D5AAED.5090305%40sympatico.ca">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018694.html">
   <LINK REL="Next"  HREF="018690.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Getting an Old Session</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Jeremy Kohansimeh</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Getting%20an%20Old%20Session&In-Reply-To=42D5AAED.5090305%40sympatico.ca"
       TITLE="[mod_python] Getting an Old Session">jkohans at gmail.com
       </A><BR>
    <I>Wed Jul 13 20:30:15 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="018694.html">[mod_python] Getting an Old Session
</A></li>
        <LI>Next message: <A HREF="018690.html">[mod_python] Directory wildcard handling
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18695">[ date ]</a>
              <a href="thread.html#18695">[ thread ]</a>
              <a href="subject.html#18695">[ subject ]</a>
              <a href="author.html#18695">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I should have mentioned that this is done and it is done before any HTML is 
written to the browser. So, there should not be the problem of having saved 
the session after some HTML has been written to the browser, which would 
prevent the cookie from being set.

Jeremy

On 7/13/05, Jim Gallacher &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">jg.lists at sympatico.ca</A>&gt; wrote:
&gt;<i> 
</I>&gt;<i> Jeremy Kohansimeh wrote:
</I>&gt;<i> &gt; Hello,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I have a problem where I am not able to reinstate an old Session. On
</I>&gt;<i> &gt; initial login I record the session id and then check that the pysid
</I>&gt;<i> &gt; cookie has been set appropriately in my browser, which it has. But, on
</I>&gt;<i> &gt; a subsequent call when I try to reinstate the same session, I get a new
</I>&gt;<i> &gt; one back that no longer has any of the items I have saved. I have been
</I>&gt;<i> &gt; using the following code for diagnostics:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; def handler(req, **kw):
</I>&gt;<i> &gt; &quot;&quot;&quot;handles initial requests&quot;&quot;&quot;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; # used for debugging
</I>&gt;<i> &gt; f = open( '/home/jeremyk/public_html/data/foo.log', 'a+')
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; cookies = Cookie.get_cookies( req)
</I>&gt;<i> &gt; if cookies.has_key( 'pysid'):
</I>&gt;<i> &gt; pysid = cookies[ 'pysid'].value
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; f.write( 'pysid is ' + pysid + '\n')
</I>&gt;<i> &gt; req.sess = Session.Session( req, sid=pysid)
</I>&gt;<i> &gt; else:
</I>&gt;<i> &gt; req.sess = Session.Session( req)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; #req.sess = Session.Session( req)
</I>&gt;<i> &gt; req.sess.set_timeout( 20 * 60)
</I>&gt;<i> &gt; id = req.sess.id()
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; if not req.sess.is_new():
</I>&gt;<i> &gt; f.write( 'old session: ' + id + '\n')
</I>&gt;<i> &gt; else:
</I>&gt;<i> &gt; f.write( 'new session: ' + id + '\n')
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; f.close()
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; return segment.dispatchToHandler( req)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I know that I do not need to specify the sid attribute of Session for an
</I>&gt;<i> &gt; old session to be reinstated (this can be determined from the request
</I>&gt;<i> &gt; object), but it wasn't working when I did it that way either. Something
</I>&gt;<i> &gt; that seems very strange to me is that the pysid value I get back from
</I>&gt;<i> &gt; here does not match the cookie that has been set in my browser. As you
</I>&gt;<i> &gt; can see, I set the timeout to 20 minutes, which is much longer than the
</I>&gt;<i> &gt; time inbetween the 2 calls. Is there anything else I should try?
</I>&gt;<i> &gt;
</I>&gt;<i> 
</I>&gt;<i> In your example code you never save the session data. When you create a
</I>&gt;<i> session instance with an explicit sid, Session tries to load the
</I>&gt;<i> corresponding session. If that session does not exist a new session id
</I>&gt;<i> is created, and thus you see a new pysid on each request.
</I>&gt;<i> 
</I>&gt;<i> You need req.sess.save() somewhere in your code.
</I>&gt;<i> 
</I>&gt;<i> Regards,
</I>&gt;<i> Jim
</I>&gt;<i> 
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050713/72b44f32/attachment-0001.html">http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050713/72b44f32/attachment-0001.html</A>
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018694.html">[mod_python] Getting an Old Session
</A></li>
	<LI>Next message: <A HREF="018690.html">[mod_python] Directory wildcard handling
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18695">[ date ]</a>
              <a href="thread.html#18695">[ thread ]</a>
              <a href="subject.html#18695">[ subject ]</a>
              <a href="author.html#18695">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
