<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] global var on 2.7
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20global%20var%20on%202.7&In-Reply-To=e2219c8a0507100940193d2d53%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018651.html">
   <LINK REL="Next"  HREF="018653.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] global var on 2.7</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20global%20var%20on%202.7&In-Reply-To=e2219c8a0507100940193d2d53%40mail.gmail.com"
       TITLE="[mod_python] global var on 2.7">grahamd at dscpl.com.au
       </A><BR>
    <I>Sun Jul 10 18:16:03 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="018651.html">[mod_python] global var on 2.7
</A></li>
        <LI>Next message: <A HREF="018653.html">[mod_python] global var on 2.7
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18652">[ date ]</a>
              <a href="thread.html#18652">[ thread ]</a>
              <a href="subject.html#18652">[ subject ]</a>
              <a href="author.html#18652">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
&gt;&gt;<i> I'd do this, probably:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # CacheBigdic.py
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> bigdic = looong_and_painful_process()
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # publishedmodulewithuniquename.py
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> import CacheBigdic
</I>&gt;&gt;<i> def index(req):
</I>&gt;&gt;<i>     ...
</I>&gt;&gt;<i>     use(CacheBigdic.bigdic)
</I>&gt;&gt;<i>     ...
</I>
This way of doing things can be problematic and may not be advisable.

The problem is that since the long and painful process is done at time
of import (while the thread holds the global import lock) in a threaded
MPM, you will block every request in the process which might want to
import a module. Thus, if it took ten seconds, in the worse case when
Apache process is just started, all requests could be stalled for ten
seconds.

You are much better off doing it the first time you need it as you
were doing. Doing it only the first time it is required also enables
you to more easily return an error response if it fails. Subsequent
requests which try again automatically to initiate the action.

If you do create it the first time it is required like this though,
in a multithreaded MPM, you will need to use a thread lock to prevent
more than one thread trying to create it the first time at the same
time.

&gt;&gt;<i> If you find errors appearing in your apache log under heavy load, you
</I>&gt;&gt;<i> may need to alter CacheBigdic.py:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> try:
</I>&gt;&gt;<i>     bigdic = looong_and_painful_process()
</I>&gt;&gt;<i> except TheErrorYouSee:
</I>&gt;&gt;<i>     bigdic = looong_and_painful_process()
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> It looks redundant, but it's needed because the module is cached. In 
</I>&gt;&gt;<i> any
</I>&gt;&gt;<i> case, it's important to protect yourself if your bigdic gets you in 
</I>&gt;&gt;<i> trouble.
</I>
And if it fails the second time as well? At some point you would have
to give up and the only way to reinitiate the action is to reload the
module with no means of returning an customised error response as to
what went wrong. Thus doing it at the time of the request is again
preferable to do it at the time of import.

Graham

</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018651.html">[mod_python] global var on 2.7
</A></li>
	<LI>Next message: <A HREF="018653.html">[mod_python] global var on 2.7
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18652">[ date ]</a>
              <a href="thread.html#18652">[ thread ]</a>
              <a href="subject.html#18652">[ subject ]</a>
              <a href="author.html#18652">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
