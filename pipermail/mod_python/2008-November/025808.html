<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Mod-Python / MySQL client libs causing apache to
	seg-fault
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Mod-Python%20/%20MySQL%20client%20libs%20causing%20apache%20to%0A%09seg-fault&In-Reply-To=fb502710811281435l10a55aefp34c7d3212c87aaab%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025807.html">
   <LINK REL="Next"  HREF="025809.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Mod-Python / MySQL client libs causing apache to
	seg-fault</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Mod-Python%20/%20MySQL%20client%20libs%20causing%20apache%20to%0A%09seg-fault&In-Reply-To=fb502710811281435l10a55aefp34c7d3212c87aaab%40mail.gmail.com"
       TITLE="[mod_python] Mod-Python / MySQL client libs causing apache to
	seg-fault">graham.dumpleton at gmail.com
       </A><BR>
    <I>Fri Nov 28 17:41:55 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="025807.html">[mod_python] Mod-Python / MySQL client libs causing apache to
	seg-fault
</A></li>
        <LI>Next message: <A HREF="025809.html">[mod_python] Mod-Python / MySQL client libs causing apache to
	seg-fault
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25808">[ date ]</a>
              <a href="thread.html#25808">[ thread ]</a>
              <a href="subject.html#25808">[ subject ]</a>
              <a href="author.html#25808">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Would be wise to ensure using recent MySQL client libraries and Python
wrappers if need be, as there are some dodgy versions that have been
known to cause problems under mod_python.

Other than that, since you seemed to have checked PHP conflict
problems, only thing can mention is to make sure you don't have any
other Apache modules installed with use MySQL such as a
mod_auth_mysql.

Graham

2008/11/29 Luke Burden &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">luke at demonware.net</A>&gt;:
&gt;<i> Hi Graham,
</I>&gt;<i>
</I>&gt;<i> I'm a developer for a internally facing web application, which uses
</I>&gt;<i> apache + mod_python + mysql.
</I>&gt;<i> As the application is being increasingly used, I've noticed several
</I>&gt;<i> errors occurring sporadically, but regularly enough to be cause for
</I>&gt;<i> concern.  Concern morphed into alarm when I found I could reproduce
</I>&gt;<i> the problems by quickly and repeatedly refreshing a page that causes a
</I>&gt;<i> number of queries to be executed!
</I>&gt;<i>
</I>&gt;<i> The problem manifests itself in either bad behavior from the python
</I>&gt;<i> MySQLDb module:
</I>&gt;<i>
</I>&gt;<i> InterfaceError: (0, '')
</I>&gt;<i> OperationalError: (2013, 'Lost connection to MySQL server during query')
</I>&gt;<i> ProgrammingError: (2014, &quot;Commands out of sync; you can't run this
</I>&gt;<i> command now&quot;) (&lt;- might be unrelated)
</I>&gt;<i> .. and NoneType result sets where the data is basically not there,
</I>&gt;<i> when it should be.
</I>&gt;<i>
</I>&gt;<i> Or in apache seg-faulting:
</I>&gt;<i>
</I>&gt;<i> [Fri Nov 28 21:34:42 2008] [notice] mod_python: Creating 8 session
</I>&gt;<i> mutexes based on 6 max processes and 25 max threads.
</I>&gt;<i> [Fri Nov 28 21:34:42 2008] [notice] mod_python: using mutex_directory /tmp
</I>&gt;<i> [Fri Nov 28 21:34:42 2008] [notice] Apache/2.2.4 (Ubuntu)
</I>&gt;<i> mod_python/3.3.1 Python/2.5.1 configured -- resuming normal operations
</I>&gt;<i> [Fri Nov 28 21:35:03 2008] [error] [client 192.168.179.1] File does
</I>&gt;<i> not exist: /var/www/favicon.ico
</I>&gt;<i> [Fri Nov 28 21:35:04 2008] [error] [client 192.168.179.1] File does
</I>&gt;<i> not exist: /var/www/favicon.ico
</I>&gt;<i> [Fri Nov 28 21:35:06 2008] [error] [client 192.168.179.1] File does
</I>&gt;<i> not exist: /var/www/favicon.ico
</I>&gt;<i> [Fri Nov 28 21:35:06 2008] [error] [client 192.168.179.1] File does
</I>&gt;<i> not exist: /var/www/favicon.ico
</I>&gt;<i> [Fri Nov 28 21:35:07 2008] [notice] child pid 17523 exit signal
</I>&gt;<i> Segmentation fault (11)
</I>&gt;<i> [Fri Nov 28 21:35:07 2008] [error] [client 192.168.179.1] File does
</I>&gt;<i> not exist: /var/www/favicon.ico
</I>&gt;<i> [Fri Nov 28 21:35:07 2008] [error] [client 192.168.179.1] File does
</I>&gt;<i> not exist: /var/www/favicon.ico
</I>&gt;<i> [Fri Nov 28 21:35:08 2008] [error] [client 192.168.179.1] File does
</I>&gt;<i> not exist: /var/www/favicon.ico
</I>&gt;<i> [Fri Nov 28 21:35:15 2008] [notice] child pid 17525 exit signal
</I>&gt;<i> Segmentation fault (11)
</I>&gt;<i> [Fri Nov 28 21:35:15 2008] [notice] child pid 17579 exit signal
</I>&gt;<i> Segmentation fault (11)
</I>&gt;<i> [Fri Nov 28 21:35:16 2008] [error] [client 192.168.179.1] File does
</I>&gt;<i> not exist: /var/www/favicon.ico
</I>&gt;<i> [Fri Nov 28 21:35:17 2008] [notice] child pid 17607 exit signal
</I>&gt;<i> Segmentation fault (11)
</I>&gt;<i> [Fri Nov 28 21:35:19 2008] [error] [client 192.168.179.1] File does
</I>&gt;<i> not exist: /var/www/favicon.ico
</I>&gt;<i> ... etc ...
</I>&gt;<i>
</I>&gt;<i> A closer look at one of the segmentation faults:
</I>&gt;<i>
</I>&gt;<i> *** glibc detected *** /usr/sbin/apache2: double free or corruption (!prev):
</I>&gt;<i> 0x000000000212a1c0 ***
</I>&gt;<i> ======= Backtrace: =========
</I>&gt;<i> /lib/libc.so.6[0x2b6915ed7b0a]
</I>&gt;<i> /lib/libc.so.6(cfree+0x8c)[0x2b6915edb6fc]
</I>&gt;<i> /usr/lib/libmysqlclient_r.so.15(vio_delete+0x19)[0x2aaaadef6ff9]
</I>&gt;<i> /usr/lib/libmysqlclient_r.so.15(end_server+0x2f)[0x2aaaadef2eff]
</I>&gt;<i> /usr/lib/libmysqlclient_r.so.15(cli_safe_read+0x2b)[0x2aaaadef305b]
</I>&gt;<i> /usr/lib/libmysqlclient_r.so.15(cli_advanced_command+0x195)[0x2aaaadef5675]
</I>&gt;<i> /usr/lib/libmysqlclient_r.so.15(mysql_ping+0x31)[0x2aaaadec71a1]
</I>&gt;<i> /var/lib/python-support/python2.5/_mysql.so[0x2aaaadc5e7e6]
</I>&gt;<i> /usr/lib/libpython2.5.so.1.0(PyEval_EvalFrameEx+0x6335)[0x2b691a2ccd15]
</I>&gt;<i> /usr/lib/libpython2.5.so.1.0(PyEval_EvalCodeEx+0x836)[0x2b691a2cdb06]
</I>&gt;<i> /usr/lib/libpython2.5.so.1.0(PyEval_EvalFrameEx+0x553d)[0x2b691a2cbf1d]
</I>&gt;<i> /usr/lib/libpython2.5.so.1.0(PyEval_EvalFrameEx+0x6564)[0x2b691a2ccf44]
</I>&gt;<i> /usr/lib/libpython2.5.so.1.0(PyEval_EvalFrameEx+0x6564)[0x2b691a2ccf44]
</I>&gt;<i> /usr/lib/libpython2.5.so.1.0(PyEval_EvalCodeEx+0x836)[0x2b691a2cdb06]
</I>&gt;<i> /usr/lib/libpython2.5.so.1.0(PyEval_EvalFrameEx+0x553d)[0x2b691a2cbf1d]
</I>&gt;<i> /usr/lib/libpython2.5.so.1.0(PyEval_EvalCodeEx+0x836)[0x2b691a2cdb06]
</I>&gt;<i> /usr/lib/libpython2.5.so.1.0(PyEval_EvalFrameEx+0x553d)[0x2b691a2cbf1d]
</I>&gt;<i> /usr/lib/libpython2.5.so.1.0(PyEval_EvalFrameEx+0x6564)[0x2b691a2ccf44]
</I>&gt;<i> /usr/lib/libpython2.5.so.1.0(PyEval_EvalCodeEx+0x836)[0x2b691a2cdb06]
</I>&gt;<i> /usr/lib/libpython2.5.so.1.0[0x2b691a26dc5e]
</I>&gt;<i> /usr/lib/libpython2.5.so.1.0(PyObject_Call+0x13)[0x2b691a24c323]
</I>&gt;<i> /usr/lib/libpython2.5.so.1.0[0x2b691a253aad]
</I>&gt;<i> /usr/lib/libpython2.5.so.1.0(PyObject_Call+0x13)[0x2b691a24c323]
</I>&gt;<i> /usr/lib/libpython2.5.so.1.0[0x2b691a24c547]
</I>&gt;<i> /usr/lib/libpython2.5.so.1.0(PyObject_CallMethod+0xc0)[0x2b691a24e610]
</I>&gt;<i> /usr/lib/apache2/modules/mod_python.so[0x2b6919ff91bc]
</I>&gt;<i> /usr/lib/apache2/modules/mod_python.so[0x2b6919ffb687]
</I>&gt;<i> /usr/sbin/apache2(ap_run_handler+0x7a)[0x437c4a]
</I>&gt;<i> /usr/sbin/apache2(ap_invoke_handler+0x7c)[0x43affc]
</I>&gt;<i> /usr/sbin/apache2(ap_process_request+0x178)[0x447248]
</I>&gt;<i> /usr/sbin/apache2[0x44468c]
</I>&gt;<i> /usr/sbin/apache2(ap_run_process_connection+0x72)[0x43ec22]
</I>&gt;<i> /usr/sbin/apache2[0x44b696]
</I>&gt;<i> /lib/libpthread.so.0[0x2b6915a4d317]
</I>&gt;<i> /lib/libc.so.6(clone+0x6d)[0x2b6915f39d5d]
</I>&gt;<i> ======= Memory map: ========
</I>&gt;<i> [Fri Nov 28 02:52:57 2008] [notice] child pid 28387 exit signal Aborted (6)
</I>&gt;<i>
</I>&gt;<i> Seems to clearly point the finger at the mysql client library.
</I>&gt;<i>
</I>&gt;<i> Google shows a few similar looking cases, usually solved by removing
</I>&gt;<i> PHP, which in this case is not installed.  Nor is expat XML parser
</I>&gt;<i> used.  Nor mhash.so. :)
</I>&gt;<i>
</I>&gt;<i> The problem occurs on both Ubuntu 7.10, and 8.04 installs using the
</I>&gt;<i> default packages for apache, python, mod python, mysql.  From the 7.10
</I>&gt;<i> instance:
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">luke at luke-ubuntu</A>:~$ dpkg -l | grep mysql
</I>&gt;<i> ii  libdbd-mysql-perl                          4.004-2
</I>&gt;<i>            A Perl5 database interface to the MySQL data
</I>&gt;<i> ii  libmysqlclient15off                        5.0.45-1ubuntu3.3
</I>&gt;<i>            MySQL database client library
</I>&gt;<i> ii  mysql-client-5.0                           5.0.45-1ubuntu3.3
</I>&gt;<i>            MySQL database client binaries
</I>&gt;<i> ii  mysql-common                               5.0.45-1ubuntu3.3
</I>&gt;<i>            MySQL database common files
</I>&gt;<i> ii  mysql-server                               5.0.45-1ubuntu3.3
</I>&gt;<i>            MySQL database server (meta package dependin
</I>&gt;<i> ii  mysql-server-5.0                           5.0.45-1ubuntu3.3
</I>&gt;<i>            MySQL database server binaries
</I>&gt;<i> ii  python-mysqldb                             1.2.2-3ubuntu1
</I>&gt;<i>            A Python interface to MySQL
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">luke at luke-ubuntu</A>:~$ dpkg -l | grep mod-python
</I>&gt;<i> ii  libapache2-mod-python                      3.3.1-2
</I>&gt;<i>            Apache 2 module that embeds Python within th
</I>&gt;<i>
</I>&gt;<i> All running on Python 2.5.
</I>&gt;<i>
</I>&gt;<i> I'm thinking of getting the source and building the libmysqlclient
</I>&gt;<i> myself now, but I'm hoping you've got some wise suggestions for me.
</I>&gt;<i>
</I>&gt;<i> Thanks very much for your time!
</I>&gt;<i>
</I>&gt;<i> Regards,
</I>&gt;<i>
</I>&gt;<i> Luke
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i>
</I></PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025807.html">[mod_python] Mod-Python / MySQL client libs causing apache to
	seg-fault
</A></li>
	<LI>Next message: <A HREF="025809.html">[mod_python] Mod-Python / MySQL client libs causing apache to
	seg-fault
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25808">[ date ]</a>
              <a href="thread.html#25808">[ thread ]</a>
              <a href="subject.html#25808">[ subject ]</a>
              <a href="author.html#25808">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
