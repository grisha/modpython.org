<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] How to initialize a variable using PythonImport and
	access it from a Handler?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20How%20to%20initialize%20a%20variable%20using%20PythonImport%20and%0A%09access%20it%20from%20a%20Handler%3F&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017981.html">
   <LINK REL="Next"  HREF="017983.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] How to initialize a variable using PythonImport and
	access it from a Handler?</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20How%20to%20initialize%20a%20variable%20using%20PythonImport%20and%0A%09access%20it%20from%20a%20Handler%3F&In-Reply-To="
       TITLE="[mod_python] How to initialize a variable using PythonImport and
	access it from a Handler?">grahamd at dscpl.com.au
       </A><BR>
    <I>Mon May  2 18:32:52 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="017981.html">[mod_python] How to initialize a variable using PythonImport and
	access it from a Handler?
</A></li>
        <LI>Next message: <A HREF="017983.html">[mod_python] How to initialize a variable using PythonImport and
	access it from a Handler?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17982">[ date ]</a>
              <a href="thread.html#17982">[ thread ]</a>
              <a href="subject.html#17982">[ subject ]</a>
              <a href="author.html#17982">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>For what purpose are you using Twisted? Are you starting up an
instance of the Twisted event system in a separate thread from
the PythonImport?

The only thing I can think of is that what ever you are doing is
blocking for some reason waiting for something that Twisted
is trying to finish, but that perhaps Twisted is itself blocked and
only getting unblocked when the process receives a signal at
shutdown, thus allowing your request handler to actually finish.

How are you handling thread locking and communication of
data between your request handler and Twisted? I am presuming
that since you are possibly creating a Twisted event system
loop as separate thread from PythonImport that you aren't
registering a server cleanup method to properly shutdown
Twisted on Apache shutdown. This would mean that Apache
ends up always having to forcibly kill off Apache subprocesses
because Twisted thread isn't going to die properly.

Anyway, put debug in your request handler which logs to
req.log_error() so as to see if the request handler is blocking
in your call to get the cached results, or somehow later on.

BTW, I know of another framework which can be integrated with
mod_python and allows communications to backend systems using
messaging with request/reply and publish/subscribe mechanism
and has its own event system as well, if you are interested. :-)

Graham

jarrod roberson wrote ..
&gt;<i> thanks that PythonInterpreter directive did it, I can access the object
</I>&gt;<i> and 
</I>&gt;<i> call methods on it but they never return any data until you stop the server
</I>&gt;<i> then it flushes the data out to the browser.
</I>&gt;<i> 
</I>&gt;<i> can you see any reason that the following code might hang like that and
</I>&gt;<i> never return?
</I>&gt;<i> 
</I>&gt;<i> from mod_python import apache
</I>&gt;<i> 
</I>&gt;<i> from myapp import cac
</I>&gt;<i> from twisted.names import dns
</I>&gt;<i> 
</I>&gt;<i> def handler(req):
</I>&gt;<i> req.content_type = &quot;text/plain&quot;
</I>&gt;<i> for answer in cac.getCachedResults(None, None, None):
</I>&gt;<i> req.write(str(answer))
</I>&gt;<i> req.write('\r\n')
</I>&gt;<i> return apache.OK
</I></PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017981.html">[mod_python] How to initialize a variable using PythonImport and
	access it from a Handler?
</A></li>
	<LI>Next message: <A HREF="017983.html">[mod_python] How to initialize a variable using PythonImport and
	access it from a Handler?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17982">[ date ]</a>
              <a href="thread.html#17982">[ thread ]</a>
              <a href="subject.html#17982">[ subject ]</a>
              <a href="author.html#17982">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
