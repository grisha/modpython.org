<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] os.system() call does not work within mod_python
	script
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20os.system%28%29%20call%20does%20not%20work%20within%20mod_python%0A%09script&In-Reply-To=42872B9F.6050401%40aon.at">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018096.html">
   <LINK REL="Next"  HREF="018099.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] os.system() call does not work within mod_python
	script</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Wouter van Marle</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20os.system%28%29%20call%20does%20not%20work%20within%20mod_python%0A%09script&In-Reply-To=42872B9F.6050401%40aon.at"
       TITLE="[mod_python] os.system() call does not work within mod_python
	script">wouter at squirrel-systems.com
       </A><BR>
    <I>Sun May 15 10:22:15 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="018096.html">[mod_python] os.system() call does not work within mod_python
	script
</A></li>
        <LI>Next message: <A HREF="018099.html">[mod_python] os.system() call does not work within mod_python
	script
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18097">[ date ]</a>
              <a href="thread.html#18097">[ thread ]</a>
              <a href="subject.html#18097">[ subject ]</a>
              <a href="author.html#18097">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi all,

Arno, very interesting this issue, I'm going to remember it as I may
need it myself. Sounds useful.

One concern: are there any security risks involved here? It is not just
because that Apache runs as such a special unprivileged user. You
basically appear to open a door out of that sandbox. It is generally not
that hard to recognise Python is being used (e.g. urls ending in .py,
comments in the html source, .psp extensions).

Any comments, anyone?

Wouter.

On Sun, 2005-05-15 at 12:59 +0200, Arno Wilhelm wrote:
&gt;<i> Hello,
</I>&gt;<i> 
</I>&gt;<i> thanks for your help.
</I>&gt;<i> 
</I>&gt;<i> I have resolved the issue now. User apache is not allowed to issue (almost) any 
</I>&gt;<i> command. I had to load the suexec module that uses the command suexec2 in order 
</I>&gt;<i> to get that to work!
</I>&gt;<i> 
</I>&gt;<i> The only command that worked without the suexec_module was the echo command:
</I>&gt;<i> system( &quot;/bin/echo Hello_mod_python &gt;&gt; /tmp/dummy.log 2&gt;&amp;1&quot; )
</I>&gt;<i> 
</I>&gt;<i> Any other command from within a mod_python script did not show any results, 
</I>&gt;<i> except an empty /tmp/dummy file (but not even an error message) at all!
</I>&gt;<i> 
</I>&gt;<i> When I load the suexec_module in apache2.conf like this:
</I>&gt;<i> 
</I>&gt;<i> LoadModule suexec_module      modules/mod_suexec.so
</I>&gt;<i> SuexecUserGroup root root
</I>&gt;<i> 
</I>&gt;<i> apache2 seems to issue the command with the help of the suexec2 utility:
</I>&gt;<i> 
</I>&gt;<i> # suexec2 -V
</I>&gt;<i>   -D AP_DOC_ROOT=&quot;/var/www&quot;
</I>&gt;<i>   -D AP_GID_MIN=100
</I>&gt;<i>   -D AP_HTTPD_USER=&quot;apache&quot;
</I>&gt;<i>   -D AP_LOG_EXEC=&quot;/var/log/apache2/suexec_log&quot;
</I>&gt;<i>   -D AP_SAFE_PATH=&quot;/usr/local/bin:/usr/bin:/bin&quot;
</I>&gt;<i>   -D AP_SUEXEC_UMASK=077
</I>&gt;<i>   -D AP_UID_MIN=1000
</I>&gt;<i>   -D AP_USERDIR_SUFFIX=&quot;public_html&quot;
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> See also this website for more details:
</I>&gt;<i> <A HREF="http://blog.develix.com/archives/33-Configuring-Apache-and-PHP-to-use-mod_suexec.html">http://blog.develix.com/archives/33-Configuring-Apache-and-PHP-to-use-mod_suexec.html</A>
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Thanks and greetings,
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> quirxi
</I>&gt;<i> 
</I>&gt;<i> Graham Dumpleton wrote:
</I>&gt;<i> &gt; On 15/05/2005, at 8:08 AM, Arno Wilhelm wrote:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt;&gt; Hello,
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; I have got a proble for which I cannot find a proper solution:
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Whenever a user on his browser hits a certain page (served by 
</I>&gt;<i> &gt;&gt; mod_python) the mod_python should send a SIGUSR signal to a certain 
</I>&gt;<i> &gt;&gt; process in order to force a update on him like this
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; # os.system( &quot;kill -s SIGUSR1 26199&quot; )
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Whenever I make this call from within a python script it works. But 
</I>&gt;<i> &gt;&gt; whenever I try to build it into the mod_python script that is handled 
</I>&gt;<i> &gt;&gt; by apache it does not work. After that I have experimented with other 
</I>&gt;<i> &gt;&gt; os.system calls from within mod_python scripts and all of them seem to 
</I>&gt;<i> &gt;&gt; be ignored somehow.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Could someone here possibly shed some light on this issue, since I am 
</I>&gt;<i> &gt;&gt; on the end of my knowledge.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; A few things to consider.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 1. Set full pathnames to the programs in the command.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; The PATH setup for Apache may not be that useful. It may reference
</I>&gt;<i> &gt; some standard locations, but not much. Thus, if you expect program
</I>&gt;<i> &gt; to be found by searching PATH, it may not work.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 2. Don't rely on the current working directory to be anything specific.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Normally current working directory would be '/' and nothing to to do
</I>&gt;<i> &gt; with where any Python request handler will be. Any references to files
</I>&gt;<i> &gt; should always be as absolute paths.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 3. Apache usually runs as user &quot;nobody&quot; or some other special user.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Because Apache runs as a special user, it often will not have the
</I>&gt;<i> &gt; necessary privileges to be able to write to directories or send signals
</I>&gt;<i> &gt; to processes running as another user.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 4. Log output of scripts to a directory in &quot;/tmp&quot;.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; As a way of working out problems, send the output of any commands to
</I>&gt;<i> &gt; a log file in &quot;/tmp&quot;. Ie., run your command as:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt;   os.system( &quot;kill -s SIGUSR1 26199 &gt;&gt; /tmp/dummy.log 2&gt;&amp;1&quot; )
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; This will allow you to see any errors. With the way that Apache works,
</I>&gt;<i> &gt; you might not otherwise see errors generated by a call to os.system()
</I>&gt;<i> &gt; until Apache is shutdown and certain buffers are flushed out.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Graham
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i> 
</I>&gt;<i> 
</I>
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018096.html">[mod_python] os.system() call does not work within mod_python
	script
</A></li>
	<LI>Next message: <A HREF="018099.html">[mod_python] os.system() call does not work within mod_python
	script
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18097">[ date ]</a>
              <a href="thread.html#18097">[ thread ]</a>
              <a href="subject.html#18097">[ subject ]</a>
              <a href="author.html#18097">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
