<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] feature request: psp templating returns html codeto
	calling script, not to browser.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20feature%20request%3A%20psp%20templating%20returns%20html%20codeto%0A%09calling%20script%2C%20not%20to%20browser.&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018129.html">
   <LINK REL="Next"  HREF="018133.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] feature request: psp templating returns html codeto
	calling script, not to browser.</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20feature%20request%3A%20psp%20templating%20returns%20html%20codeto%0A%09calling%20script%2C%20not%20to%20browser.&In-Reply-To="
       TITLE="[mod_python] feature request: psp templating returns html codeto
	calling script, not to browser.">grahamd at dscpl.com.au
       </A><BR>
    <I>Thu May 19 01:52:40 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="018129.html">[mod_python] feature request: psp templating returns html code
	to calling script, not to browser.
</A></li>
        <LI>Next message: <A HREF="018133.html">[mod_python] feature request: psp templating returns html code
	to calling script, not to browser.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18130">[ date ]</a>
              <a href="thread.html#18130">[ thread ]</a>
              <a href="subject.html#18130">[ subject ]</a>
              <a href="author.html#18130">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Wouter van Marle wrote ..
&gt;<i> def get_source(filename):
</I>&gt;<i>     dir, fname = os.path.split(filename)
</I>&gt;<i>     dir += &quot;/&quot;
</I>&gt;<i>     pycode = _psp.parse(fname, dir).splitlines()
</I>&gt;<i>     pycode = [s.rstrip() for s in pycode]
</I>&gt;<i>     for line in pycode:
</I>&gt;<i>         left = line.replace(&quot;\t&quot;, &quot; &quot;*4)
</I>&gt;<i>         result += left+&quot;\n&quot;
</I>&gt;<i>     return result
</I>
This may only work for an indenting style where tabs are used. At least
the substitution of tabs with 4 spaces looks dangerous to me in that it
could screen up indenting of code. You would also be changing tabs
that may be present in literal strings. Why did you feel you needed to
do these changes.

&gt;<i> def get_html(filename, vars={}):
</I>&gt;<i>     code = get_source(filename)
</I>&gt;<i>     lines = code.splitlines()
</I>&gt;<i>     code = 'html = &quot;&quot;\n'
</I>&gt;<i>     for l in lines:
</I>&gt;<i>         l = l.replace(&quot;req.write(&quot;, &quot;html +=&quot;).replace(&quot;,0)&quot;, &quot;&quot;)
</I>&gt;<i>         code += l+&quot;\n&quot;
</I>&gt;<i>     global_scope = globals().copy()
</I>&gt;<i>     global_scope.update(vars)
</I>&gt;<i>     html = &quot;&quot;
</I>&gt;<i>     l = locals()
</I>&gt;<i>     try:
</I>&gt;<i>         exec code in global_scope, l
</I>&gt;<i>     except:
</I>&gt;<i>         et, ev, etb = sys.exc_info()
</I>&gt;<i>         raise et, ev, etb
</I>&gt;<i>     return l[&quot;html&quot;]
</I>
Actually modifying the source code seems a bit messy to me. You could
still use the &quot;req&quot; wrapper class hack I suggested before, or if you know
the PSP page never actually references the &quot;req&quot; object explicitly, you
could pass an instance of StringIO into it and call it &quot;req&quot; and it should just
work. This would avoid having to pass in locals(). For the purposes of
what you are doing, there is probably no point even copying globals as
it may not give you anything you need anyway. You could almost just
use &quot;exec code in vars&quot;.

def get_html(filename, vars={}):
     code = get_source(filename)
     vars = vars.copy()
     vars[&quot;req&quot;] = StringIO.StringIO()
     try:
         exec code in vars
     except:
         et, ev, etb = sys.exc_info()
         raise et, ev, etb
     return vars[&quot;req&quot;].getvalue()


Graham
</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018129.html">[mod_python] feature request: psp templating returns html code
	to calling script, not to browser.
</A></li>
	<LI>Next message: <A HREF="018133.html">[mod_python] feature request: psp templating returns html code
	to calling script, not to browser.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18130">[ date ]</a>
              <a href="thread.html#18130">[ thread ]</a>
              <a href="subject.html#18130">[ subject ]</a>
              <a href="author.html#18130">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
