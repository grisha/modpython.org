<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] telling mod_python to exit its children
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20telling%20mod_python%20to%20exit%20its%20children&In-Reply-To=0a704cc5a251a4835b95ce2f12864760%40dscpl.com.au">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018150.html">
   <LINK REL="Next"  HREF="018152.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] telling mod_python to exit its children</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Martin Blais</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20telling%20mod_python%20to%20exit%20its%20children&In-Reply-To=0a704cc5a251a4835b95ce2f12864760%40dscpl.com.au"
       TITLE="[mod_python] telling mod_python to exit its children">martin.blais at gmail.com
       </A><BR>
    <I>Sun May 22 09:13:07 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="018150.html">[mod_python] telling mod_python to exit its children
</A></li>
        <LI>Next message: <A HREF="018152.html">[mod_python] telling mod_python to exit its children
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18151">[ date ]</a>
              <a href="thread.html#18151">[ thread ]</a>
              <a href="subject.html#18151">[ subject ]</a>
              <a href="author.html#18151">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>hi graham

thanks for the pointers.  it seems from your description that Vampire
is doing the same as i am with my reloader module.  from the details
you mention, it seems you're also running against the similar
weirdness.  i'll check it out soon.  however all i can hope to find
there is a less buggy version of the approach i'm already trying.

but what i'm trying to do now, is different, is to bypass all that,
really.  i want to find out how to communicate to mod_python to exit
all its current pool of children (perhaps not all at the same time,
but at least to mark them as &quot;not runnable&quot;).  it's a trivial approach
to that problem, which will certainly work well in all cases (in a
non-threaded apache).

if it's not in there already, i will probably add that feature,
because it would be a much cleaner and easier way to implement this
automatic reload, and it would work with all frameworks, and perhaps
it could even find other uses.

cheers,




On 5/21/05, Graham Dumpleton &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">grahamd at dscpl.com.au</A>&gt; wrote:
&gt;<i> Are you using basic content handlers or are you using a package on
</I>&gt;<i> top of them such as mod_python.publisher, mod_python.psp or any
</I>&gt;<i> third party packages for templating such as Cheetah etc?
</I>&gt;<i> 
</I>&gt;<i> Depending on what you are using it may be able to be refactored to
</I>&gt;<i> work on top of Vampire which has a quite well developed module
</I>&gt;<i> importing and reloading system which doesn't suffer the sorts of
</I>&gt;<i> problems that a lot of such systems do. When used appropriately,
</I>&gt;<i> Vampire is able to detect when a child sub import at multiple
</I>&gt;<i> levels below the actual request handler has changed and reload
</I>&gt;<i> automatically the request handler and anything below it down to
</I>&gt;<i> the level of the modified module.
</I>&gt;<i> 
</I>&gt;<i> By reloads being automatic in this way, you avoid having to set
</I>&gt;<i> special flags or cookies to trigger reloads or work out how to
</I>&gt;<i> shutdown specific Apache processes.
</I>&gt;<i> 
</I>&gt;<i> The only known area of problems so far, which will occur with any
</I>&gt;<i> reloading scheme, is where caching of class type objects is done
</I>&gt;<i> for later type comparison. This is a problem because of the fact
</I>&gt;<i> that the actual class definition in the original module can be
</I>&gt;<i> replaced and so a cached type object will no longer be valid. With
</I>&gt;<i> care this can be avoided though.
</I>&gt;<i> 
</I>&gt;<i> You might therefore have a quick glance at Vampire to see how it
</I>&gt;<i> matches with the underlying way you implement handlers. If your
</I>&gt;<i> handlers can easily be rehosted on top of Vampire then it may be
</I>&gt;<i> a way forward. Even if it doesn't look straight forward let me
</I>&gt;<i> know and we can look at it further as Vampire is generally flexible
</I>&gt;<i> enough to do things that on first pass don't look possible to
</I>&gt;<i> someone not familiar with it.
</I>&gt;<i> 
</I>&gt;<i> Be warned that documentation on the module reloading is minimal
</I>&gt;<i> at this point. There is a little bit in the overview with more
</I>&gt;<i> in the changes file.
</I>&gt;<i> 
</I>&gt;<i> Vampire is located at:
</I>&gt;<i> 
</I>&gt;<i>    <A HREF="http://www.dscpl.com.au/projects/vampire">http://www.dscpl.com.au/projects/vampire</A>
</I>&gt;<i> 
</I>&gt;<i> If you are truly interested in giving it a go, happy to direct
</I>&gt;<i> you.
</I>&gt;<i> 
</I>&gt;<i> Graham
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On 21/05/2005, at 11:52 PM, Martin Blais wrote:
</I>&gt;<i> 
</I>&gt;<i> &gt; hi
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; i've been working on a web app framework, and one of the
</I>&gt;<i> &gt; essential features that i need to work well is to be able to
</I>&gt;<i> &gt; simply save a new source file (while in debugging mode, set by a
</I>&gt;<i> &gt; flag in my config file) and for all the modules to be
</I>&gt;<i> &gt; appropriately reloaded (there is no way i would restart apache
</I>&gt;<i> &gt; everytime i change the code...).  i'm using lots of 3rd party
</I>&gt;<i> &gt; libraries and my code is spread out in many packages and modules,
</I>&gt;<i> &gt; so i found that the trivial reload approaches do not work well.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; so thinking i was a smart cookie i've been fiddling quite a bit
</I>&gt;<i> &gt; and solved a lot of the problems and it pretty much works (but it
</I>&gt;<i> &gt; wasn't as easy as i thought), except for that occasional rare
</I>&gt;<i> &gt; case where something strange still happens (due to some residual
</I>&gt;<i> &gt; global state in the modules i didn't unload or what-not).  now i
</I>&gt;<i> &gt; could spend more time on that bug, but i've already spent a
</I>&gt;<i> &gt; considerable amount of time with this, and the solution is not
</I>&gt;<i> &gt; very clean anyway (fiddling with the sys.modules by hand...) and
</I>&gt;<i> &gt; i'm getting the feeling that taking a lower-level approach might
</I>&gt;<i> &gt; just be cleaner and easier.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Some questions:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 1. in a handler, is there a way to tell apache to exit the child
</I>&gt;<i> &gt;    currently handling the request and to rerun the request it
</I>&gt;<i> &gt;    another/a new child?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 2. or is there a way to tell apache to exit all its pool of
</I>&gt;<i> &gt;    children, so that new request only get handled by new/fresh
</I>&gt;<i> &gt;    child processes?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I saw REQ_EXIT in apache.py, but it doesn't appear anywhere else
</I>&gt;<i> &gt; in the code, and is marked legacy.  Also, according to the
</I>&gt;<i> &gt; documentation, returning DECLINED doesn't appear to indicate that
</I>&gt;<i> &gt; apache will retry the same handler on a different child, but
</I>&gt;<i> &gt; I may be reading wrong.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; any pointers appreciated.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; cheers,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; Mod_python mailing list
</I>&gt;<i> &gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> &gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i> 
</I>&gt;<i>
</I>
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018150.html">[mod_python] telling mod_python to exit its children
</A></li>
	<LI>Next message: <A HREF="018152.html">[mod_python] telling mod_python to exit its children
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18151">[ date ]</a>
              <a href="thread.html#18151">[ thread ]</a>
              <a href="subject.html#18151">[ subject ]</a>
              <a href="author.html#18151">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
