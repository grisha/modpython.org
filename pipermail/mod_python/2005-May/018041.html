<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] mod_python session trouble
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20mod_python%20session%20trouble&In-Reply-To=1115708001.408.38.camel%40cm61-10-50-104.hkcable.com.hk">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018037.html">
   <LINK REL="Next"  HREF="018043.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] mod_python session trouble</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Wouter van Marle</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20mod_python%20session%20trouble&In-Reply-To=1115708001.408.38.camel%40cm61-10-50-104.hkcable.com.hk"
       TITLE="[mod_python] mod_python session trouble">wouter at squirrel-systems.com
       </A><BR>
    <I>Tue May 10 06:33:53 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="018037.html">[mod_python] mod_python session trouble
</A></li>
        <LI>Next message: <A HREF="018043.html">[mod_python] mod_python session trouble
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18041">[ date ]</a>
              <a href="thread.html#18041">[ thread ]</a>
              <a href="subject.html#18041">[ subject ]</a>
              <a href="author.html#18041">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Update on my own message:
I have changed the structure a bit, sess has now become req.session, so
I can pass around the session together with the request object easily.
The locking problem has been solved by calling req.session.unlock()
every time after saving the session, however this causes the server to
start a new session for each request, and that's not the idea, as then
info gets lost.
Also I've noticed that writing and reading back of cookies does not work
properly. I'm trying to write a cookie, and when reading it back in case
of a new session I get the old data again. But that's for another
question.

Any advice is highly appreciated!

Wouter.

On Tue, 2005-05-10 at 14:53 +0800, Wouter van Marle wrote:

&gt;<i> On Tue, 2005-05-10 at 02:01 -0400, Jim Gallacher wrote:
</I>&gt;<i> &gt; This looks like a problem with session locking, which is the default 
</I>&gt;<i> &gt; when creating a session. Are you creating more than one session object 
</I>&gt;<i> &gt; in a request? If so you'll end up with a deadlock. For example the 
</I>&gt;<i> &gt; following code will deadlock as it is really just accessing the same 
</I>&gt;<i> &gt; session data:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; sess1 = Session.Session(req)
</I>&gt;<i> &gt; sess2 - Session.Session(req)
</I>&gt;<i> 
</I>&gt;<i> This is really close to what I am doing. I've to shorten my code a lot
</I>&gt;<i> to get it posted here, but basically this happens:
</I>&gt;<i> 
</I>&gt;<i> def home(req):
</I>&gt;<i>     sess = Session.Session(req)
</I>&gt;<i>     if sess.is_new():
</I>&gt;<i>         # get settings from cookies (using Cookie)
</I>&gt;<i>     # page built up, using sess[&quot;language&quot;] for the language setting.
</I>&gt;<i>     sess.save()    
</I>&gt;<i>     return apache.OK
</I>&gt;<i> 
</I>&gt;<i> def english(req)
</I>&gt;<i>     sess = Session.Session(req)
</I>&gt;<i>     sess[&quot;language&quot;] = &quot;en&quot;
</I>&gt;<i>     sess.save()
</I>&gt;<i>     home(req) # to redraw the main page
</I>&gt;<i> 
</I>&gt;<i> And same for other languages as well.
</I>&gt;<i> The page uses a little PSP to easily set some variables, no code in the
</I>&gt;<i> pages. It appears to hang on the Session.Session(req) call in the
</I>&gt;<i> english routine.
</I>&gt;<i> The english routine is called through a hyperlink off the main page (a
</I>&gt;<i> href main.py/english).
</I>&gt;<i> 
</I>&gt;<i> Wouter.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i> 
</I>&gt;<i> 
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050510/d7682875/attachment-0001.html">http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050510/d7682875/attachment-0001.html</A>
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018037.html">[mod_python] mod_python session trouble
</A></li>
	<LI>Next message: <A HREF="018043.html">[mod_python] mod_python session trouble
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18041">[ date ]</a>
              <a href="thread.html#18041">[ thread ]</a>
              <a href="subject.html#18041">[ subject ]</a>
              <a href="author.html#18041">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
