<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] mod_python session trouble
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20mod_python%20session%20trouble&In-Reply-To=1115736404.408.141.camel%40cm61-10-50-104.hkcable.com.hk">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018045.html">
   <LINK REL="Next"  HREF="018047.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] mod_python session trouble</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Jim Gallacher</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20mod_python%20session%20trouble&In-Reply-To=1115736404.408.141.camel%40cm61-10-50-104.hkcable.com.hk"
       TITLE="[mod_python] mod_python session trouble">jg.lists at sympatico.ca
       </A><BR>
    <I>Tue May 10 11:44:14 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="018045.html">[mod_python] mod_python session trouble
</A></li>
        <LI>Next message: <A HREF="018047.html">[mod_python] mod_python session trouble
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18046">[ date ]</a>
              <a href="thread.html#18046">[ thread ]</a>
              <a href="subject.html#18046">[ subject ]</a>
              <a href="author.html#18046">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Wouter van Marle wrote:
&gt;<i> Thank you all for the advices, I'm going to try it tomorrow. At least it 
</I>&gt;<i> gives me something to try out, and a bit better understanding of the 
</I>&gt;<i> process. Unfortunately the documentation is pretty sparse there.
</I>
I'm working on improving the documentation, so these kinds of 
discussions are useful to me as well.

&gt;<i> Some more comments below on why reading a separate cookie:
</I>&gt;<i> 
</I>&gt;&gt;<i>call sess.save() before the end of your request as saving is not 
</I>&gt;&gt;<i>automatic. The other way you may get a new session for each request is 
</I>&gt;&gt;<i>if you start writing the response before the session is created. The 
</I>&gt;&gt;<i>session must be able to set a cookie in the response sent to the 
</I>&gt;&gt;<i>browser, and this is not possible if you've already started to send your 
</I>&gt;&gt;<i>reply.
</I>&gt;&gt;<i>
</I>&gt;<i> 
</I>&gt;<i> So I should call sess.save() before doing any psp run() or req.write(), 
</I>&gt;<i> right? That is now not the case (I do the save at the very end of the 
</I>&gt;<i> routine - after sending the page).
</I>
No, it doesn't matter when you call sess.save(). The important step is 
in the creation of the session instance. The session cookie in the 
response header is set when the session instance is created. You must do 
this before sending any part of the page. For example:

def good_requesthandler(req):
     # session handling will work
     req.content_type = &quot;text/plain&quot;

     # Create the session and implicitly set the session cookie
     # in the response header
     sess = Session.Session(req)

     # First call to req.write() sends the response headers
     # to the browser, which includes the session cookie, and
     # then writes the string.
     req.write(&quot;Hello World!&quot;)
     req.write(&quot;Goodbye world!&quot;)

     # Save the session data on the server
     sess.save()
     return apache.OK


def bad_requesthandler(req):
     # session handling will not work
     req.content_type = &quot;text/plain&quot;

     # First call to req.write() sends the response headers to
     # the browser and then writes the string.
     req.write(&quot;Hello World!&quot;)

     # Creating the session instance generates a cookie, but
     # the response headers have already been sent as a result of
     # the previous req.write() call, so the the browser will never
     # receive the cookie.
     sess = Session.Session(req)
     req.write(&quot;Goodbye world!&quot;)

     # Save the session data on the server. The data is saved, but the
     # browser never received the cookie, so it really is not relevant.
     # As far as the browser is concerned the session data is gone.
     sess.save()
     return apache.OK

&gt;&gt;<i>I'm a little unclear why you are reading and writing the cookies, 
</I>&gt;&gt;<i>assuming you mean the session cookie. 
</I>&gt;&gt;<i>
</I>&gt;<i> 
</I>&gt;<i> I think of using a separate cookie for persistent information (currently 
</I>&gt;<i> set to 90 day expiry) against session which includes login info and is 
</I>&gt;<i> to keep the user logged with a timeout of say 30 minutes. At the 
</I>&gt;<i> beginning of the session (new session) I want to read that persistent 
</I>&gt;<i> information to provide a somewhat personalised site. Currently that is 
</I>&gt;<i> only the language and the username if known, though in future that may 
</I>&gt;<i> be more.
</I>
Ok. Then the problem you described with reading and writing cookies in 
an earlier message is unrelated to the session handling code. But the 
same idea applies. Make sure you set your cookie before any req.write() 
attempts.

Regards,
Jim
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018045.html">[mod_python] mod_python session trouble
</A></li>
	<LI>Next message: <A HREF="018047.html">[mod_python] mod_python session trouble
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18046">[ date ]</a>
              <a href="thread.html#18046">[ thread ]</a>
              <a href="subject.html#18046">[ subject ]</a>
              <a href="author.html#18046">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
