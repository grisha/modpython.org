<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] problem w/ authen handler
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20problem%20w/%20authen%20handler&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018135.html">
   <LINK REL="Next"  HREF="018140.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] problem w/ authen handler</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Bud P. Bruegger</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20problem%20w/%20authen%20handler&In-Reply-To="
       TITLE="[mod_python] problem w/ authen handler">bud at comune.grosseto.it
       </A><BR>
    <I>Thu May 19 10:27:12 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="018135.html">[mod_python] feature request: psp templating returns html codeto
	calling script, not to browser.
</A></li>
        <LI>Next message: <A HREF="018140.html">[mod_python] problem w/ authen handler
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18139">[ date ]</a>
              <a href="thread.html#18139">[ thread ]</a>
              <a href="subject.html#18139">[ subject ]</a>
              <a href="author.html#18139">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm a beginner and hope someone can straighten me out.

I am trying to write a simple handler that clicks in after mod-ssl has 
requested a certificate from the client.  Depending on the type of client 
token (European eID cards), I'd like the handler to look at the client's 
subject DN derive (by string manipulation or by lookup) a nationally unique 
ID for the card holder.

Sounds simple enough--but I can't get it to work.  I tried both, the authen 
and the authz handlers.  But neither from mod-ssl's +fakeBasicAuth nor from 
the handlers req.user = 'xxx' do I get a REMOTE_USER env variable 
set.  Also the test evironment variable that I try to set in the 
authen/authz handler doesn't have effect.

Does this possibly mean that the authen/authz handlers are not called at 
all in my configuration?  Should I use a different handler and which?  Or 
did I simply mess up something else?

Any help is highly appreciated!

cheers
-b

here the details of what I tried:

&lt;VirtualHost *:443&gt;
         SSLCertificateFile /etc/apache2/ssl/apache.pem
       # no client cert verification for Demo:
         SSLVerifyClient optional_no_ca
       # SSLCACertificatePath /etc/apache2/ssl/trusted/
       # SSLVerifyDepth 3
         LogLevel debug
         SSLEngine on
         DocumentRoot /var/www/

     &lt;Directory /var/www/sc&gt;
         SSLRequireSSL
         SSLOptions +StdEnvVars +ExportCertData +FakeBasicAuth +StrictRequire
         SetHandler mod_python
         PythonHandler test
         PythonAuthzHandler test
         PythonDebug On
     &lt;/Directory&gt;

&lt;/VirtualHost&gt;

and test.py:

from mod_python import apache

def authzhandler(req):
     req.add_common_vars()
     req.subprocess_env['insideAuthH']='valueSetFromAuthH'
     req.user='pippo'
     #return apache.HTTP_UNAUTHORIZED
     return apache.OK

def handler(req):
     req.add_common_vars()
     req.subprocess_env['pytest']='itWorksFromPublisher'
     req.content_type = &quot;text/plain&quot;
     req.write(&quot;Environment Variables\n----------------------\n\n&quot;)
     for item in req.subprocess_env.items():
         req.write(&quot;%s: %s\n&quot; % item)
     req.write(&quot;\n\n&quot;)
     return apache.OK



-------------------------------------------------------------------------------------------------
Ing. Bud P. Bruegger, Ph.D.                 +39-0564-488577 
(voice),  -21139 (fax)
Servizio Elaborazione Dati                    e-mail:  <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">bud at comune.grosseto.it</A>
Comune di 
Grosseto                            <A HREF="http://www.comune.grosseto.it/cie/">http://www.comune.grosseto.it/cie/</A>
Via Ginori, 
43                                      <A HREF="http://OpenPortalGuard.sf.net">http://OpenPortalGuard.sf.net</A>
58100 Grosseto (Tuscany, Italy)           jabber:  <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">bud at amessage.info</A>

Free Software in Public Administration:  not just a good idea, but a necessity

Perfection is attained, not when there is nothing more to be added, but 
when there is nothing more to be taken away -- Antoine de Saint-Exupery 

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018135.html">[mod_python] feature request: psp templating returns html codeto
	calling script, not to browser.
</A></li>
	<LI>Next message: <A HREF="018140.html">[mod_python] problem w/ authen handler
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18139">[ date ]</a>
              <a href="thread.html#18139">[ thread ]</a>
              <a href="subject.html#18139">[ subject ]</a>
              <a href="author.html#18139">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
