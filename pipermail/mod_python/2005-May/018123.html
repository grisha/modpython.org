<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] PSP Response
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20PSP%20Response&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018138.html">
   <LINK REL="Next"  HREF="018124.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] PSP Response</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20PSP%20Response&In-Reply-To="
       TITLE="[mod_python] PSP Response">grahamd at dscpl.com.au
       </A><BR>
    <I>Wed May 18 19:18:50 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="018138.html">[mod_python] How to get mod_python's running version?
</A></li>
        <LI>Next message: <A HREF="018124.html">[mod_python] psp module
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18123">[ date ]</a>
              <a href="thread.html#18123">[ thread ]</a>
              <a href="subject.html#18123">[ subject ]</a>
              <a href="author.html#18123">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The session object isn't created within this function. Are you able
to describe or post the handler/publisher which calls this function
and where the session is created? Bit hard to tell at this point with
out knowing what else is being done besides what is in this function.

Jeremy Kohansimeh wrote ..
&gt;<i> Hey Graham,
</I>&gt;<i> 
</I>&gt;<i> Thanks for your response. I made the following change to my code, but I
</I>&gt;<i> am 
</I>&gt;<i> still unable to prevent the page from hanging sometimes:
</I>&gt;<i> 
</I>&gt;<i> &lt;code&gt;
</I>&gt;<i> def genGraphWAnnotsHTMLResponse( req, frames):
</I>&gt;<i> &quot;&quot;&quot;generates HTML response for request to graph&quot;&quot;&quot;
</I>&gt;<i> 
</I>&gt;<i> sess = req.sess
</I>&gt;<i> seg_facade = sess.seg_facade
</I>&gt;<i> 
</I>&gt;<i> column_header, data = genSegmentAnnotsHTML( frames, sess.chrom_num, 
</I>&gt;<i> seg_facade)
</I>&gt;<i> 
</I>&gt;<i> vars = { 'p_extend' : seg_facade.p_extend, \
</I>&gt;<i> 'p_break' : seg_facade.p_break, \
</I>&gt;<i> 'plot_image' : os.path.join( '../../images', sess.original_image), \
</I>&gt;<i> 'session_id' : sess.id(), \
</I>&gt;<i> 'cols' : column_header.__str__(), \
</I>&gt;<i> 'data' : data.__str__() }
</I>&gt;<i> 
</I>&gt;<i> return psp.PSP( req, filename=ZOOM_WANNOTS_TMPL, vars=vars)
</I>&gt;<i> &lt;/code&gt;
</I>&gt;<i> 
</I>&gt;<i> I have made one other, possibly important, observation. The page will not
</I>&gt;<i> hang the first time a session in created, but will subsequent times when
</I>&gt;<i> it 
</I>&gt;<i> is referenced. I can tell this, because if I get rid of the pysid cookie
</I>&gt;<i> after a session has been created, which forces the creation of a new 
</I>&gt;<i> session, the page works fine.
</I>&gt;<i> 
</I>&gt;<i> Do you have any suggestions? Thanks for your help.
</I>&gt;<i> 
</I>&gt;<i> Best Regards,
</I>&gt;<i> Jeremy Kohansimeh
</I>&gt;<i> 
</I>&gt;<i> On 5/17/05, Graham Dumpleton &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">grahamd at dscpl.com.au</A>&gt; wrote:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Jeremy Kohansimeh wrote ..
</I>&gt;<i> &gt; &gt; Hello,
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; The following fragment of code will sometimes return a response and
</I>&gt;<i> &gt; other
</I>&gt;<i> &gt; &gt; times just hang:
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; &lt;code&gt;
</I>&gt;<i> &gt; &gt; def genGraphWAnnotsHTMLResponse( req, frames):
</I>&gt;<i> &gt; &gt; &quot;&quot;&quot;generates HTML response for request to graph&quot;&quot;&quot;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; session = req.session
</I>&gt;<i> &gt; &gt; seg_facade = session.seg_facade
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; column_header, data = genSegmentAnnotsHTML( frames, session.chrom_num,
</I>&gt;<i> &gt; &gt; seg_facade)
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; vars = { 'p_extend' : seg_facade.p_extend, \
</I>&gt;<i> &gt; &gt; 'p_break' : seg_facade.p_break, \
</I>&gt;<i> &gt; &gt; 'plot_image' : os.path.join( '../../images', session.original_image),
</I>&gt;<i> \
</I>&gt;<i> &gt; &gt; 'session' : session.id(), \
</I>&gt;<i> &gt; &gt; 'cols' : column_header.__str__(), \
</I>&gt;<i> &gt; &gt; 'data' : data.__str__() }
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; return psp.PSP( req, filename=ZOOM_WANNOTS_TMPL, vars=vars)
</I>&gt;<i> &gt; &gt; &lt;/code&gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; The path from the handler to here appears to be working fine. I did
</I>&gt;<i> some
</I>&gt;<i> &gt; &gt; debugging and can tell that the problem is somewhere in the psp.PSPcall.
</I>&gt;<i> &gt; &gt; I
</I>&gt;<i> &gt; &gt; think it may have something to do with the interpreter, but that is
</I>&gt;<i> just
</I>&gt;<i> &gt; &gt; a
</I>&gt;<i> &gt; &gt; wild guess. Has anyone had similar issues?
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; One problem you can hit with this code, and for which there has
</I>&gt;<i> &gt; been a little discussion about over the last few days in the dev
</I>&gt;<i> &gt; area, is that the following code will hang if your PSP page tries
</I>&gt;<i> &gt; to reference the &quot;session&quot; object. The problem is that the PSP
</I>&gt;<i> &gt; class ignores the fact of whether or not you may have created
</I>&gt;<i> &gt; your own session object and will create its own if &quot;session&quot; is
</I>&gt;<i> &gt; referenced from the PSP page, with the session object it thus
</I>&gt;<i> &gt; creates being stored as &quot;session&quot; with the execution environment
</I>&gt;<i> &gt; of PSP so as to be accessible from your page.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Now you actually set &quot;session&quot; in your vars to the session ID
</I>&gt;<i> &gt; which if you try to access in the page will trigger the creation
</I>&gt;<i> &gt; of the second session object, although your session ID setting
</I>&gt;<i> &gt; will override PSPs attempt to set &quot;session&quot; to the session object
</I>&gt;<i> &gt; it creates. Either way, the attempt to create a second session
</I>&gt;<i> &gt; object for the same request can result in a deadlock.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; I would suggest you try not using the &quot;session&quot; variable in
</I>&gt;<i> &gt; your vars, but use &quot;my_session_id&quot; for the session ID and if
</I>&gt;<i> &gt; you do need access to the session object you create in
</I>&gt;<i> &gt; PSP, set it as the &quot;my_session&quot; variable. Ie., avoid using
</I>&gt;<i> &gt; &quot;session&quot; name as that triggers the deadlock where you have
</I>&gt;<i> &gt; already created the session object.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; The suggestion being dicussed in dev area is that the PSP
</I>&gt;<i> &gt; code check for the existance of &quot;req.session&quot; and if it
</I>&gt;<i> &gt; exists and PSP page tries to access &quot;session&quot;, that session be set
</I>&gt;<i> &gt; to &quot;req.session&quot; rather than creating a new session object.
</I>&gt;<i> &gt; If this change were made for future version of mod_python,
</I>&gt;<i> &gt; you wouldn't need to set &quot;session&quot; in the vars as PSP will
</I>&gt;<i> &gt; do it automatically for you. In your page you could then say
</I>&gt;<i> &gt; &quot;session.id()&quot; to get the session ID.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Would this explain your problems and does avoiding using
</I>&gt;<i> &gt; &quot;session&quot; variable name in vars fix the problem?
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Graham
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt;
</I></PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018138.html">[mod_python] How to get mod_python's running version?
</A></li>
	<LI>Next message: <A HREF="018124.html">[mod_python] psp module
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18123">[ date ]</a>
              <a href="thread.html#18123">[ thread ]</a>
              <a href="subject.html#18123">[ subject ]</a>
              <a href="author.html#18123">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
