<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] telling mod_python to exit its children
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20telling%20mod_python%20to%20exit%20its%20children&In-Reply-To=8393fff050521065276555fc1%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018149.html">
   <LINK REL="Next"  HREF="018151.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] telling mod_python to exit its children</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20telling%20mod_python%20to%20exit%20its%20children&In-Reply-To=8393fff050521065276555fc1%40mail.gmail.com"
       TITLE="[mod_python] telling mod_python to exit its children">grahamd at dscpl.com.au
       </A><BR>
    <I>Sat May 21 18:33:37 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="018149.html">[mod_python] telling mod_python to exit its children
</A></li>
        <LI>Next message: <A HREF="018151.html">[mod_python] telling mod_python to exit its children
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18150">[ date ]</a>
              <a href="thread.html#18150">[ thread ]</a>
              <a href="subject.html#18150">[ subject ]</a>
              <a href="author.html#18150">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Are you using basic content handlers or are you using a package on
top of them such as mod_python.publisher, mod_python.psp or any
third party packages for templating such as Cheetah etc?

Depending on what you are using it may be able to be refactored to
work on top of Vampire which has a quite well developed module
importing and reloading system which doesn't suffer the sorts of
problems that a lot of such systems do. When used appropriately,
Vampire is able to detect when a child sub import at multiple
levels below the actual request handler has changed and reload
automatically the request handler and anything below it down to
the level of the modified module.

By reloads being automatic in this way, you avoid having to set
special flags or cookies to trigger reloads or work out how to
shutdown specific Apache processes.

The only known area of problems so far, which will occur with any
reloading scheme, is where caching of class type objects is done
for later type comparison. This is a problem because of the fact
that the actual class definition in the original module can be
replaced and so a cached type object will no longer be valid. With
care this can be avoided though.

You might therefore have a quick glance at Vampire to see how it
matches with the underlying way you implement handlers. If your
handlers can easily be rehosted on top of Vampire then it may be
a way forward. Even if it doesn't look straight forward let me
know and we can look at it further as Vampire is generally flexible
enough to do things that on first pass don't look possible to
someone not familiar with it.

Be warned that documentation on the module reloading is minimal
at this point. There is a little bit in the overview with more
in the changes file.

Vampire is located at:

   <A HREF="http://www.dscpl.com.au/projects/vampire">http://www.dscpl.com.au/projects/vampire</A>

If you are truly interested in giving it a go, happy to direct
you.

Graham


On 21/05/2005, at 11:52 PM, Martin Blais wrote:

&gt;<i> hi
</I>&gt;<i>
</I>&gt;<i> i've been working on a web app framework, and one of the
</I>&gt;<i> essential features that i need to work well is to be able to
</I>&gt;<i> simply save a new source file (while in debugging mode, set by a
</I>&gt;<i> flag in my config file) and for all the modules to be
</I>&gt;<i> appropriately reloaded (there is no way i would restart apache
</I>&gt;<i> everytime i change the code...).  i'm using lots of 3rd party
</I>&gt;<i> libraries and my code is spread out in many packages and modules,
</I>&gt;<i> so i found that the trivial reload approaches do not work well.
</I>&gt;<i>
</I>&gt;<i> so thinking i was a smart cookie i've been fiddling quite a bit
</I>&gt;<i> and solved a lot of the problems and it pretty much works (but it
</I>&gt;<i> wasn't as easy as i thought), except for that occasional rare
</I>&gt;<i> case where something strange still happens (due to some residual
</I>&gt;<i> global state in the modules i didn't unload or what-not).  now i
</I>&gt;<i> could spend more time on that bug, but i've already spent a
</I>&gt;<i> considerable amount of time with this, and the solution is not
</I>&gt;<i> very clean anyway (fiddling with the sys.modules by hand...) and
</I>&gt;<i> i'm getting the feeling that taking a lower-level approach might
</I>&gt;<i> just be cleaner and easier.
</I>&gt;<i>
</I>&gt;<i> Some questions:
</I>&gt;<i>
</I>&gt;<i> 1. in a handler, is there a way to tell apache to exit the child
</I>&gt;<i>    currently handling the request and to rerun the request it
</I>&gt;<i>    another/a new child?
</I>&gt;<i>
</I>&gt;<i> 2. or is there a way to tell apache to exit all its pool of
</I>&gt;<i>    children, so that new request only get handled by new/fresh
</I>&gt;<i>    child processes?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I saw REQ_EXIT in apache.py, but it doesn't appear anywhere else
</I>&gt;<i> in the code, and is marked legacy.  Also, according to the
</I>&gt;<i> documentation, returning DECLINED doesn't appear to indicate that
</I>&gt;<i> apache will retry the same handler on a different child, but
</I>&gt;<i> I may be reading wrong.
</I>&gt;<i>
</I>&gt;<i> any pointers appreciated.
</I>&gt;<i>
</I>&gt;<i> cheers,
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018149.html">[mod_python] telling mod_python to exit its children
</A></li>
	<LI>Next message: <A HREF="018151.html">[mod_python] telling mod_python to exit its children
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18150">[ date ]</a>
              <a href="thread.html#18150">[ thread ]</a>
              <a href="subject.html#18150">[ subject ]</a>
              <a href="author.html#18150">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
