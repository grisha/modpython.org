<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] mod_python modifies time zone of Apache child
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20mod_python%20modifies%20time%20zone%20of%20Apache%20child&In-Reply-To=1249570861.2988.65.camel%40pc520-4.centersystems.at">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026295.html">
   <LINK REL="Next"  HREF="026297.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] mod_python modifies time zone of Apache child</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20mod_python%20modifies%20time%20zone%20of%20Apache%20child&In-Reply-To=1249570861.2988.65.camel%40pc520-4.centersystems.at"
       TITLE="[mod_python] mod_python modifies time zone of Apache child">graham.dumpleton at gmail.com
       </A><BR>
    <I>Thu Aug  6 19:33:08 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="026295.html">[mod_python] mod_python modifies time zone of Apache child
</A></li>
        <LI>Next message: <A HREF="026297.html">[mod_python] Problem compiling mod_python
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26296">[ date ]</a>
              <a href="thread.html#26296">[ thread ]</a>
              <a href="subject.html#26296">[ subject ]</a>
              <a href="author.html#26296">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>2009/8/7 Stephan Paukner &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">paux at paukner.cc</A>&gt;:
&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> I use Apache2 in MPM prefork mode. I noticed that if a specific Apache
</I>&gt;<i> child process handles a request to a roundup(.sf.net) tracker instance
</I>&gt;<i> via mod_python, the child's time zone is set to UTC, permanently. If any
</I>&gt;<i> other HTTP client gets to reuse that specific Apache child, the request
</I>&gt;<i> is still handled in UTC. This leads to times jumping between UTC and the
</I>&gt;<i> local timezone e.g. in a PHP-based calendar on the same site, depending
</I>&gt;<i> on the involved Apache child processes, what is quite annoying.
</I>&gt;<i>
</I>&gt;<i> If I request the following URL sequence after an Apache restart:
</I>&gt;<i> &#160; &#160;<A HREF="https://ourhostname/server-status">https://ourhostname/server-status</A>
</I>&gt;<i> &#160; &#160;<A HREF="https://ourhostname/tracker/">https://ourhostname/tracker/</A>
</I>&gt;<i> &#160; &#160;<A HREF="https://ourhostname/server-status">https://ourhostname/server-status</A>
</I>&gt;<i> then the &quot;Current Time&quot; indicated in the server-status shows e.g.
</I>&gt;<i> &quot;03:13:37 CEST&quot; (our local timezone) before and &quot;01:13:37 UTC&quot;
</I>&gt;<i> afterwards, because all three requests are obviously served by the same
</I>&gt;<i> Apache child. These jumping times also show up in the Apache logs.
</I>&gt;<i>
</I>&gt;<i> This doesn't happen if I directly access the tracker via
</I>&gt;<i> &#160; &#160;<A HREF="http://ourhostname:8080/tracker/">http://ourhostname:8080/tracker/</A>
</I>&gt;<i>
</I>&gt;<i> I tried adding
</I>&gt;<i> &#160; &#160;SetEnv TZ Europe/Vienna
</I>&gt;<i> at various places in our virtual host, but AFAIK these settings are only
</I>&gt;<i> read at the creation of a child process, not repeatedly. I don't know
</I>&gt;<i> how to set the timezone globally for all python instances on that host;
</I>&gt;<i> I set TZ in /etc/environment. I've set up the mod_python.testhandler
</I>&gt;<i> like suggested in the Troubleshooting section, and /mpinfo indeed shows
</I>&gt;<i> &quot;TZ&quot; with value &quot;Europe/Vienna&quot;, but I can't see any time information in
</I>&gt;<i> that output.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> All packages are from Debian amd64 Lenny. mod_python bindings for
</I>&gt;<i> roundup are just as suggested
</I>&gt;<i> in /usr/share/doc/roundup/examples/roundup_apache.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Any suggestions on how to explore this further? Do you need more config
</I>&gt;<i> info?
</I>
The PHP and Python applications run in the same process and TZ is a
process global setting so it is obvious that this will occur. Similar
issues will occur with locale and language settings.

The only answer is you can't run them in the same process which for
mod_php/mod_python means you cannot run them on the same Apache
instance.

Your only options are to bump PHP out to separate fastcgi process, or
use mod_wsgi instead of mod_python and use mod_wsgi daemon mode to
delegate the Python web application out to a separate process.

Graham

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026295.html">[mod_python] mod_python modifies time zone of Apache child
</A></li>
	<LI>Next message: <A HREF="026297.html">[mod_python] Problem compiling mod_python
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26296">[ date ]</a>
              <a href="thread.html#26296">[ thread ]</a>
              <a href="subject.html#26296">[ subject ]</a>
              <a href="author.html#26296">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
