<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Re:mod_python and connection to database. (Rodion)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Re%3Amod_python%20and%20connection%20to%20database.%20%28Rodion%29&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024330.html">
   <LINK REL="Next"  HREF="024331.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Re:mod_python and connection to database. (Rodion)</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Thimios Katsoulis</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Re%3Amod_python%20and%20connection%20to%20database.%20%28Rodion%29&In-Reply-To="
       TITLE="[mod_python] Re:mod_python and connection to database. (Rodion)">thkatsou at yahoo.gr
       </A><BR>
    <I>Sat Oct 13 11:06:36 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="024330.html">[mod_python] Mod_python multiple apache mod_python interpreters
	communication
</A></li>
        <LI>Next message: <A HREF="024331.html">[mod_python] Re:mod_python and connection to database. (Rodion)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24329">[ date ]</a>
              <a href="thread.html#24329">[ thread ]</a>
              <a href="subject.html#24329">[ subject ]</a>
              <a href="author.html#24329">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello.

Sorry for my poor english. Here is my mod_python code. This is a simple 
URL shorter:

from mod_python import apache, util
import psycopg2 as psycopg

def handler(req):
     req.content_type = &quot;text/plain&quot;
     url_id = req.args
     connection = psycopg.connect(&quot;dbname=my_db&quot;)
     cursor = connection.cursor()
     cursor.execute(&quot;&quot;&quot;SELECT myurl FROM urls WHERE myid=%s&quot;&quot;&quot;,(url_id))
     original_url = cursor.fetchone()[0]
     connection.close()
     util.redirect(req,original_url)
     req.status = apache.DONE
     return apache.DONE

This programme connects database everytime, but I want(need) force him 
to connect it continously

This script connects database everytime (psycopg.connect(&quot;dbname=my_db&quot;) 
, but I nedd force to stay conneceted with it continously. It is 
possible to make that in mod_python ? I have mod_python 3.2.10

Thanks in advance.
rdn
---------------

Yes mod_python can maintain global variables per interpreter, so you can open once the connection 
and all subsequent requests will use the opened connection.
You have to declare your connection variable as global e.g. :

    
    def getConn(self):        
        
        try:
            if _conn == None:
                self.openConn()
           
                
        except NameError:
            self.openConn()
        return _conn
    
    def openConn(self):
        
        global _conn
        _conn = connect(self.ConnStr)


So when you want to access it you call self.getConn().
The _conn global variable will instantiate once for each mod_python apache process.
You can include some apache.log_error calls in the code above to watch 
for yourself when the  _conn varible gets instantiated and when it is retreived as global.
Please take notice from what I have observed that while you maintain open connections to DB (postgresql too in my case)
you cannot change structure of the tables etc in the DB..
Of course if you are using modules and not objects you have to alter  the code to  support (removing self ..) modules.
 







      
___________________________________________________________ 
&#935;&#961;&#951;&#963;&#953;&#956;&#959;&#960;&#959;&#953;&#949;&#943;&#964;&#949; Yahoo!; 
&#914;&#945;&#961;&#949;&#952;&#942;&#954;&#945;&#964;&#949; &#964;&#945; &#949;&#957;&#959;&#967;&#955;&#951;&#964;&#953;&#954;&#940; &#956;&#951;&#957;&#973;&#956;&#945;&#964;&#945; (spam); &#932;&#959; Yahoo! Mail 
&#948;&#953;&#945;&#952;&#941;&#964;&#949;&#953; &#964;&#951;&#957; &#954;&#945;&#955;&#973;&#964;&#949;&#961;&#951; &#948;&#965;&#957;&#945;&#964;&#942; &#960;&#961;&#959;&#963;&#964;&#945;&#963;&#943;&#945; &#954;&#945;&#964;&#940; &#964;&#969;&#957; &#949;&#957;&#959;&#967;&#955;&#951;&#964;&#953;&#954;&#974;&#957; 
&#956;&#951;&#957;&#965;&#956;&#940;&#964;&#969;&#957; <A HREF="http://login.yahoo.com/config/mail?.intl=gr">http://login.yahoo.com/config/mail?.intl=gr</A> 



</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024330.html">[mod_python] Mod_python multiple apache mod_python interpreters
	communication
</A></li>
	<LI>Next message: <A HREF="024331.html">[mod_python] Re:mod_python and connection to database. (Rodion)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24329">[ date ]</a>
              <a href="thread.html#24329">[ thread ]</a>
              <a href="subject.html#24329">[ subject ]</a>
              <a href="author.html#24329">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
