<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] mod_python or apache scalability?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20mod_python%20or%20apache%20scalability%3F&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024265.html">
   <LINK REL="Next"  HREF="024269.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] mod_python or apache scalability?</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Alec Matusis</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20mod_python%20or%20apache%20scalability%3F&In-Reply-To="
       TITLE="[mod_python] mod_python or apache scalability?">matusis at matusis.com
       </A><BR>
    <I>Mon Oct  1 05:12:26 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="024265.html">[mod_python] Concurrence and virtual host interpreter python
</A></li>
        <LI>Next message: <A HREF="024269.html">[mod_python] mod_python or apache scalability?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24267">[ date ]</a>
              <a href="thread.html#24267">[ thread ]</a>
              <a href="subject.html#24267">[ subject ]</a>
              <a href="author.html#24267">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I am sorry in advance if this turns out to be an apache-related issue, but
when I posted this on apache list, it has been suggested that it might be an
application issue, so I am reposting it here.


We are running a busy mod_python/3.1.4 Python/2.4.1 server on 2.6.9 kernel,
that suddenly becomes very slow- requests either time out, or it takes
10-20sec to serve a 1K thumbnail. 
It is somewhat correlated with load spikes, but not perfectly (by looking at
the bandwidth graph, it never happens during the low bandwidth periods at
night, but it does not coincide with peaks of b/w) 

When we initially encountered an apache overload, it was always accompanied
with 

[error] server reached MaxClients setting, consider raising the MaxClients
setting 

in the apache error log. We also got 

kernel: possible SYN flooding on port 80. Sending cookies. 

in /var/log/messages system log. 

After that I raised MaxClients from 200 to 300. The problem initially
disappeared, but after our bandwidth grew a bit more, we got this behavior
again. 
Now apache crashes (becomes very slow) silently, with no warning in apache
error logs at all (although we still get SYN flood message in the system
log) 
When apache is this 'slow' regime, /server-status still shows available
slots, i.e. MaxClients is not reached. 

This is the relevant part of httpd.conf: 

ServerLimit 300 
# we are using prefork MPM 
StartServers 10 
MinSpareServers 5 
MaxSpareServers 20 
MaxClients 300 
MaxRequestsPerChild 10000 
MaxMemFree 2500 

The server has 4GB of physical RAM and 4GB of swap. During these apache
&#147;slowdowns&quot;, the swap size is still 0 and vmstat shows no swapping at all. 
I suspect the problem may be in 

MaxMemFree 2500 

but then I would expect some kind of&#160;&#160;&#147;out of memory&#148; errors in the logs? 

I am posting it on this list since I have not gotten a response in the users
list, and I think it's a bug for two reasons: 

1) When apache is in this slow &quot;degraded&quot; regime, I would expect a log
message in the apache error log, with an explanation why. 

3) If this is related to resource exhaustion, I would expect the server to
recover from this regime by itself when the load subsides, but this is not
the case. Only apachectl start/stop recovers the server.



</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024265.html">[mod_python] Concurrence and virtual host interpreter python
</A></li>
	<LI>Next message: <A HREF="024269.html">[mod_python] mod_python or apache scalability?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24267">[ date ]</a>
              <a href="thread.html#24267">[ thread ]</a>
              <a href="subject.html#24267">[ subject ]</a>
              <a href="author.html#24267">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
