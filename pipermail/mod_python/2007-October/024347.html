<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Large File Upload Issues
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Large%20File%20Upload%20Issues&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024346.html">
   <LINK REL="Next"  HREF="024348.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Large File Upload Issues</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Kurt Nordstrom</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Large%20File%20Upload%20Issues&In-Reply-To="
       TITLE="[mod_python] Large File Upload Issues">knordstrom at library.unt.edu
       </A><BR>
    <I>Thu Oct 18 18:38:24 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="024346.html">[mod_python] Re: mod_python + vista
</A></li>
        <LI>Next message: <A HREF="024348.html">[mod_python] Large File Upload Issues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24347">[ date ]</a>
              <a href="thread.html#24347">[ thread ]</a>
              <a href="subject.html#24347">[ subject ]</a>
              <a href="author.html#24347">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>We're working on a webapp that will need to receive, from its clients, 
fairly large files (it's an archival storage system).  The logical way 
to do this seems to be to use http PUT, with appropriate code on the 
server side to store the file to the proper place.

Borrowing and modifying some code posted back in '05 to this list by a 
Jeremy Jones, I have been playing with this:

from mod_python import apache

import os

def handler(request):
    #request.content_type = &quot;text/plain&quot;
    content_length = int(request.headers_in[&quot;Content-Length&quot;])
    outPath = &quot;/home/webtmp/upload_out.dat&quot;
    outFile = open(outPath, &quot;w&quot;)
    conn = request.connection
    i = 0
    buf = &quot;&quot;
    while i &lt; content_length:
        c = conn.read(1)
        if c == &quot;&quot;:
            break
        buf = buf + c
        if len(buf) &gt;= 102400:           
            outFile.write(buf)
            outFile.flush()
            buf = &quot;&quot;
        i += 1
    if len(buf):
        outFile.write(buf)
        outFile.flush()
    outFile.close()
    talkBack = &quot;Recieved %s bytes\n&quot; % os.stat(outPath).st_size
    request.set_content_length(len(talkBack))
    request.write(talkBack)
    return apache.OK

Basically it reads bytes one at a time from the connection and puts them 
in a buffer, writing it to a file in 100k chunks (I'll probably up this, 
once it actually works the way I want it to).

This seems to be working fine...up to a point.  For some reason, it 
seems to stall out on files that are larger than 95 Megs in size.  It 
just freezes, no activity from client or server, until I kill the client 
(I'm using curl -T to PUT files on the system).

Any thoughts on what might be causing this?  I've already checked the 
apache config for timeout and request size limitations, which are well 
beyond anything that might cause this to be a problem.

-- 
===
Kurt Nordstrom
Programmer
University of North Texas Libraries
Digital Projects Unit
(940) 891-6747

</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024346.html">[mod_python] Re: mod_python + vista
</A></li>
	<LI>Next message: <A HREF="024348.html">[mod_python] Large File Upload Issues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24347">[ date ]</a>
              <a href="thread.html#24347">[ thread ]</a>
              <a href="subject.html#24347">[ subject ]</a>
              <a href="author.html#24347">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
