From Dominique.Holzwarth at ch.delarue.com  Tue Apr  1 05:09:15 2008
From: Dominique.Holzwarth at ch.delarue.com (Dominique.Holzwarth@ch.delarue.com)
Date: Tue Apr  1 05:11:02 2008
Subject: [mod_python] Mod_python & cPickle / saving Instances
Message-ID: <5213E58D85BC414998FA553C701E386C0EDD010400@SGBD012511.dlrmail.ad.delarue.com>

Hey Guys

I was just playing around with the cPickle module to save some instance objects into binary files and 'offline' (normal python interpreter on local machine) it all works fine. However, when I try to do the same things under apache with mod_python I get a mod_python specific error...

Here are my testing files:

Pickletest.py
*******************************************************************************************************************
from mod_python import apache
from mod_python import Session
import cPickle, pickle

myModule = apache.import_module('~/test/dummyclass.py')

secretText = "hallo"

def index(req):
    req.session = Session.FileSession(req, secret=secretText)
    if req.session.is_new():
        myInstance = myModule.myClass()
        myInstance.hit()
        hits = str(myInstance.hitCounter)
        myOtherInstance = myModule.myOtherClass()
        myOtherInstance.hit()
        randNum = str(myOtherInstance.randomNumber)
        file = open('C:\\Program Files\\Apache Software Foundation\\Apache2.2\\test\\myInstances.pkl','wb')
        cPickle.dump((myInstance, myOtherInstance), file)
        file.close()
        req.session.save()
        return "Hits: "+hits+" Random Number: "+randNum
    else:
        file = open('C:\\Program Files\\Apache Software Foundation\\Apache2.2\\test\\myInstances.pkl','rb')
        (myInstance, myOtherInstance) = cPickle.load(file)
        file.close()
        myInstance.hit()
        myOtherInstance.hit()
        hits = str(myInstance.hitCounter)
        randNumber = str(myOtherInstance.randomNumber)
        req.session['myInstances'] = (myInstance, myOtherInstance)
        file = open('C:\\Program Files\\Apache Software Foundation\\Apache2.2\\test\\myInstances.pkl','wb')
        cPickle.dump((myInstance, myOtherInstance), file)
        file.close()
        req.session.save()
        return "Hits: "+hits+" Random Number: "+randNum+" old session"
*******************************************************************************************************************

This script does nothing more than saving / loading instance objects and displaying some sort of 'hit counter'

Dummyclass.py
*******************************************************************************************************************
import random

class myClass:
    def __init__(self):
        self.attribute = 1
        self.text = "hello world"
        self.hitCounter = 0

    def hit(self):
        self.hitCounter += 1

class myOtherClass:
    def __init__(self):
        self.otherAttribute = 2
        self.otherText = "goodbye world"
        self.randomNumber = 0

    def hit(self):
        self.randomNumber = random.randint(0, 1000)
*******************************************************************************************************************
Defines some useless classes, of which instance objects should be stored :-)

The script manages to write the *.pkl file which looks like this:

myInstances.pkl
*******************************************************************************************************************
((i_mp_bee88a136571a696398a0eb82b06eeb3
myClass
p1
(dp2
S'attribute'
p3
I1
sS'hitCounter'
p4
I1
sS'text'
p5
S'hello world'
p6
sb(i_mp_bee88a136571a696398a0eb82b06eeb3
myOtherClass
p7
(dp8
S'otherText'
p9
S'goodbye world'
p10
sS'otherAttribute'
p11
I2
sS'randomNumber'
p12
I105
sbt.
*******************************************************************************************************************

As I understand the pickle-algorithm this file looks as intended except for the i_mp_bee88a136571a696398a0eb82b06eeb3 which normaly would be the name of the module. Obviously the module name is converted into some mod_python GUID thingy...

The error message i get is the following:

MOD_PYTHON ERROR

ProcessId:      3784
Interpreter:    'xx'

ServerName:     'xx'
DocumentRoot:   'C:/Program Files/Apache Software Foundation/Apache2.2/htdocs'

URI:            '/python/test/pickletest.py'
Location:       None
Directory:      'C:/Program Files/Apache Software Foundation/Apache2.2/htdocs/python/'
Filename:       'C:\\Program Files\\Apache Software Foundation\\Apache2.2\\htdocs\\python\\test\\pickletest.py'
PathInfo:       ''

Phase:          'PythonHandler'
Handler:        'mod_python.publisher'

Traceback (most recent call last):

  File "C:\Program Files\Python25\lib\site-packages\mod_python\importer.py", line 1537, in HandlerDispatch
    default=default_handler, arg=req, silent=hlist.silent)

  File "C:\Program Files\Python25\lib\site-packages\mod_python\importer.py", line 1229, in _process_target
    result = _execute_target(config, req, object, arg)

  File "C:\Program Files\Python25\lib\site-packages\mod_python\importer.py", line 1128, in _execute_target
    result = object(arg)

  File "C:\Program Files\Python25\lib\site-packages\mod_python\publisher.py", line 213, in handler
    published = publish_object(req, object)

  File "C:\Program Files\Python25\lib\site-packages\mod_python\publisher.py", line 425, in publish_object
    return publish_object(req,util.apply_fs_data(object, req.form, req=req))

  File "C:\Program Files\Python25\lib\site-packages\mod_python\util.py", line 554, in apply_fs_data
    return object(**args)

  File "C:\Program Files\Apache Software Foundation\Apache2.2\htdocs\python\test\pickletest.py", line 25, in index
    (myInstance, myOtherInstance) = cPickle.load(file)

ImportError: No module named _mp_bee88a136571a696398a0eb82b06eeb3


MODULE CACHE DETAILS

Accessed:       Tue Apr 01 11:05:33 2008
Generation:     26

_mp_bee88a136571a696398a0eb82b06eeb3 {
  FileName:     'C:\\Program Files\\Apache Software Foundation\\Apache2.2\\htdocs\\python\\test\\dummyclass.py'
  Instance:     1
  Generation:   13
  Modified:     Tue Apr 01 09:59:54 2008
  Imported:     Tue Apr 01 10:05:22 2008
}

_mp_754c5030ce462c9ea7741cb6f66d6cc1 {
  FileName:     'C:\\Program Files\\Apache Software Foundation\\Apache2.2\\htdocs\\python\\test\\pickletest.py'
  Instance:     13
  Generation:   26
  Modified:     Tue Apr 01 10:56:58 2008
  Imported:     Tue Apr 01 10:57:10 2008
  Children:     'C:\\Program Files\\Apache Software Foundation\\Apache2.2\\htdocs\\python\\test\\dummyclass.py'
}

Is there a way how to use cPickle AND mod_python together? I also tried to use the session mechanism instead of the pickle mechanism to store instance objects in a binary file but that doesn't seem to work either (if I do a req.session['myInstances'] = (myInstance, myOtherInstance) then the session doesn't seem to be saved properly and thus, everytime I hit on browser-reload a new session is generated...)

Would be really great if someone could help me with this!

Greetings Dominique


From graham.dumpleton at gmail.com  Tue Apr  1 05:57:06 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue Apr  1 05:57:13 2008
Subject: [mod_python] Mod_python & cPickle / saving Instances
In-Reply-To: <5213E58D85BC414998FA553C701E386C0EDD010400@SGBD012511.dlrmail.ad.delarue.com>
References: <5213E58D85BC414998FA553C701E386C0EDD010400@SGBD012511.dlrmail.ad.delarue.com>
Message-ID: <88e286470804010257k193e2d6csfdc9c0fd3a3eddc3@mail.gmail.com>

Read:

  http://www.dscpl.com.au/wiki/ModPython/Articles/IssuesWithSessionObjects

Graham

On 01/04/2008, Dominique.Holzwarth@ch.delarue.com
<Dominique.Holzwarth@ch.delarue.com> wrote:
> Hey Guys
>
>  I was just playing around with the cPickle module to save some instance objects into binary files and 'offline' (normal python interpreter on local machine) it all works fine. However, when I try to do the same things under apache with mod_python I get a mod_python specific error...
>
>  Here are my testing files:
>
>  Pickletest.py
>  *******************************************************************************************************************
>  from mod_python import apache
>  from mod_python import Session
>  import cPickle, pickle
>
>  myModule = apache.import_module('~/test/dummyclass.py')
>
>  secretText = "hallo"
>
>  def index(req):
>     req.session = Session.FileSession(req, secret=secretText)
>     if req.session.is_new():
>         myInstance = myModule.myClass()
>         myInstance.hit()
>         hits = str(myInstance.hitCounter)
>         myOtherInstance = myModule.myOtherClass()
>         myOtherInstance.hit()
>         randNum = str(myOtherInstance.randomNumber)
>         file = open('C:\\Program Files\\Apache Software Foundation\\Apache2.2\\test\\myInstances.pkl','wb')
>         cPickle.dump((myInstance, myOtherInstance), file)
>         file.close()
>         req.session.save()
>         return "Hits: "+hits+" Random Number: "+randNum
>     else:
>         file = open('C:\\Program Files\\Apache Software Foundation\\Apache2.2\\test\\myInstances.pkl','rb')
>         (myInstance, myOtherInstance) = cPickle.load(file)
>         file.close()
>         myInstance.hit()
>         myOtherInstance.hit()
>         hits = str(myInstance.hitCounter)
>         randNumber = str(myOtherInstance.randomNumber)
>         req.session['myInstances'] = (myInstance, myOtherInstance)
>         file = open('C:\\Program Files\\Apache Software Foundation\\Apache2.2\\test\\myInstances.pkl','wb')
>         cPickle.dump((myInstance, myOtherInstance), file)
>         file.close()
>         req.session.save()
>         return "Hits: "+hits+" Random Number: "+randNum+" old session"
>  *******************************************************************************************************************
>
>  This script does nothing more than saving / loading instance objects and displaying some sort of 'hit counter'
>
>  Dummyclass.py
>  *******************************************************************************************************************
>  import random
>
>  class myClass:
>     def __init__(self):
>         self.attribute = 1
>         self.text = "hello world"
>         self.hitCounter = 0
>
>     def hit(self):
>         self.hitCounter += 1
>
>  class myOtherClass:
>     def __init__(self):
>         self.otherAttribute = 2
>         self.otherText = "goodbye world"
>         self.randomNumber = 0
>
>     def hit(self):
>         self.randomNumber = random.randint(0, 1000)
>  *******************************************************************************************************************
>  Defines some useless classes, of which instance objects should be stored :-)
>
>  The script manages to write the *.pkl file which looks like this:
>
>  myInstances.pkl
>  *******************************************************************************************************************
>  ((i_mp_bee88a136571a696398a0eb82b06eeb3
>  myClass
>  p1
>  (dp2
>  S'attribute'
>  p3
>  I1
>  sS'hitCounter'
>  p4
>  I1
>  sS'text'
>  p5
>  S'hello world'
>  p6
>  sb(i_mp_bee88a136571a696398a0eb82b06eeb3
>  myOtherClass
>  p7
>  (dp8
>  S'otherText'
>  p9
>  S'goodbye world'
>  p10
>  sS'otherAttribute'
>  p11
>  I2
>  sS'randomNumber'
>  p12
>  I105
>  sbt.
>  *******************************************************************************************************************
>
>  As I understand the pickle-algorithm this file looks as intended except for the i_mp_bee88a136571a696398a0eb82b06eeb3 which normaly would be the name of the module. Obviously the module name is converted into some mod_python GUID thingy...
>
>  The error message i get is the following:
>
>  MOD_PYTHON ERROR
>
>  ProcessId:      3784
>  Interpreter:    'xx'
>
>  ServerName:     'xx'
>  DocumentRoot:   'C:/Program Files/Apache Software Foundation/Apache2.2/htdocs'
>
>  URI:            '/python/test/pickletest.py'
>  Location:       None
>  Directory:      'C:/Program Files/Apache Software Foundation/Apache2.2/htdocs/python/'
>  Filename:       'C:\\Program Files\\Apache Software Foundation\\Apache2.2\\htdocs\\python\\test\\pickletest.py'
>  PathInfo:       ''
>
>  Phase:          'PythonHandler'
>  Handler:        'mod_python.publisher'
>
>  Traceback (most recent call last):
>
>   File "C:\Program Files\Python25\lib\site-packages\mod_python\importer.py", line 1537, in HandlerDispatch
>     default=default_handler, arg=req, silent=hlist.silent)
>
>   File "C:\Program Files\Python25\lib\site-packages\mod_python\importer.py", line 1229, in _process_target
>     result = _execute_target(config, req, object, arg)
>
>   File "C:\Program Files\Python25\lib\site-packages\mod_python\importer.py", line 1128, in _execute_target
>     result = object(arg)
>
>   File "C:\Program Files\Python25\lib\site-packages\mod_python\publisher.py", line 213, in handler
>     published = publish_object(req, object)
>
>   File "C:\Program Files\Python25\lib\site-packages\mod_python\publisher.py", line 425, in publish_object
>     return publish_object(req,util.apply_fs_data(object, req.form, req=req))
>
>   File "C:\Program Files\Python25\lib\site-packages\mod_python\util.py", line 554, in apply_fs_data
>     return object(**args)
>
>   File "C:\Program Files\Apache Software Foundation\Apache2.2\htdocs\python\test\pickletest.py", line 25, in index
>     (myInstance, myOtherInstance) = cPickle.load(file)
>
>  ImportError: No module named _mp_bee88a136571a696398a0eb82b06eeb3
>
>
>  MODULE CACHE DETAILS
>
>  Accessed:       Tue Apr 01 11:05:33 2008
>  Generation:     26
>
>  _mp_bee88a136571a696398a0eb82b06eeb3 {
>   FileName:     'C:\\Program Files\\Apache Software Foundation\\Apache2.2\\htdocs\\python\\test\\dummyclass.py'
>   Instance:     1
>   Generation:   13
>   Modified:     Tue Apr 01 09:59:54 2008
>   Imported:     Tue Apr 01 10:05:22 2008
>  }
>
>  _mp_754c5030ce462c9ea7741cb6f66d6cc1 {
>   FileName:     'C:\\Program Files\\Apache Software Foundation\\Apache2.2\\htdocs\\python\\test\\pickletest.py'
>   Instance:     13
>   Generation:   26
>   Modified:     Tue Apr 01 10:56:58 2008
>   Imported:     Tue Apr 01 10:57:10 2008
>   Children:     'C:\\Program Files\\Apache Software Foundation\\Apache2.2\\htdocs\\python\\test\\dummyclass.py'
>  }
>
>  Is there a way how to use cPickle AND mod_python together? I also tried to use the session mechanism instead of the pickle mechanism to store instance objects in a binary file but that doesn't seem to work either (if I do a req.session['myInstances'] = (myInstance, myOtherInstance) then the session doesn't seem to be saved properly and thus, everytime I hit on browser-reload a new session is generated...)
>
>  Would be really great if someone could help me with this!
>
>  Greetings Dominique
>
>
>  _______________________________________________
>  Mod_python mailing list
>  Mod_python@modpython.org
>  http://mailman.modpython.org/mailman/listinfo/mod_python
>
From Dominique.Holzwarth at ch.delarue.com  Tue Apr  1 07:05:52 2008
From: Dominique.Holzwarth at ch.delarue.com (Dominique.Holzwarth@ch.delarue.com)
Date: Tue Apr  1 07:08:13 2008
Subject: [mod_python] Mod_python & cPickle / saving Instances
In-Reply-To: <88e286470804010257k193e2d6csfdc9c0fd3a3eddc3@mail.gmail.com>
Message-ID: <5213E58D85BC414998FA553C701E386C0EDD046B83@SGBD012511.dlrmail.ad.delarue.com>

Hello Graham

I've read your article and just want to clarify if I understood it the right way :-)
So basicly instance objects shouldn't (or rather can't) be stored in a session object (and also using pickle directly won't work) due to the new mod_python module importer?
Pickle would work tho, if I add my own modules to the PYTHONPATH (sys.modules thingy) so that they are loaded by the standard python module loader? Is that correct?

However, using the standard python module loader for own modules will cause some mod_python problems as stated in http://www.dscpl.com.au/wiki/ModPython/Articles/ModuleImportingIsBroken ?

If that's really the current state then I guess I have to do some redesign in order to not use instance object serialisation... :-/

Thanks for the quick answer,
Dominique

-----Original Message-----
From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
Sent: Dienstag, 1. April 2008 11:57
To: Holzwarth, Dominique (Berne Bauhaus)
Cc: mod_python@modpython.org
Subject: Re: [mod_python] Mod_python & cPickle / saving Instances

Read:

  http://www.dscpl.com.au/wiki/ModPython/Articles/IssuesWithSessionObjects

Graham

On 01/04/2008, Dominique.Holzwarth@ch.delarue.com
<Dominique.Holzwarth@ch.delarue.com> wrote:
> Hey Guys
>
>  I was just playing around with the cPickle module to save some instance objects into binary files and 'offline' (normal python interpreter on local machine) it all works fine. However, when I try to do the same things under apache with mod_python I get a mod_python specific error...
>
>  Here are my testing files:
>
>  Pickletest.py
>
> **********************************************************************
> *********************************************
>  from mod_python import apache
>  from mod_python import Session
>  import cPickle, pickle
>
>  myModule = apache.import_module('~/test/dummyclass.py')
>
>  secretText = "hallo"
>
>  def index(req):
>     req.session = Session.FileSession(req, secret=secretText)
>     if req.session.is_new():
>         myInstance = myModule.myClass()
>         myInstance.hit()
>         hits = str(myInstance.hitCounter)
>         myOtherInstance = myModule.myOtherClass()
>         myOtherInstance.hit()
>         randNum = str(myOtherInstance.randomNumber)
>         file = open('C:\\Program Files\\Apache Software Foundation\\Apache2.2\\test\\myInstances.pkl','wb')
>         cPickle.dump((myInstance, myOtherInstance), file)
>         file.close()
>         req.session.save()
>         return "Hits: "+hits+" Random Number: "+randNum
>     else:
>         file = open('C:\\Program Files\\Apache Software Foundation\\Apache2.2\\test\\myInstances.pkl','rb')
>         (myInstance, myOtherInstance) = cPickle.load(file)
>         file.close()
>         myInstance.hit()
>         myOtherInstance.hit()
>         hits = str(myInstance.hitCounter)
>         randNumber = str(myOtherInstance.randomNumber)
>         req.session['myInstances'] = (myInstance, myOtherInstance)
>         file = open('C:\\Program Files\\Apache Software Foundation\\Apache2.2\\test\\myInstances.pkl','wb')
>         cPickle.dump((myInstance, myOtherInstance), file)
>         file.close()
>         req.session.save()
>         return "Hits: "+hits+" Random Number: "+randNum+" old session"
>
> **********************************************************************
> *********************************************
>
>  This script does nothing more than saving / loading instance objects and displaying some sort of 'hit counter'
>
>  Dummyclass.py
>
> **********************************************************************
> *********************************************
>  import random
>
>  class myClass:
>     def __init__(self):
>         self.attribute = 1
>         self.text = "hello world"
>         self.hitCounter = 0
>
>     def hit(self):
>         self.hitCounter += 1
>
>  class myOtherClass:
>     def __init__(self):
>         self.otherAttribute = 2
>         self.otherText = "goodbye world"
>         self.randomNumber = 0
>
>     def hit(self):
>         self.randomNumber = random.randint(0, 1000)
>
> **********************************************************************
> *********************************************
>  Defines some useless classes, of which instance objects should be
> stored :-)
>
>  The script manages to write the *.pkl file which looks like this:
>
>  myInstances.pkl
>
> **********************************************************************
> *********************************************
>  ((i_mp_bee88a136571a696398a0eb82b06eeb3
>  myClass
>  p1
>  (dp2
>  S'attribute'
>  p3
>  I1
>  sS'hitCounter'
>  p4
>  I1
>  sS'text'
>  p5
>  S'hello world'
>  p6
>  sb(i_mp_bee88a136571a696398a0eb82b06eeb3
>  myOtherClass
>  p7
>  (dp8
>  S'otherText'
>  p9
>  S'goodbye world'
>  p10
>  sS'otherAttribute'
>  p11
>  I2
>  sS'randomNumber'
>  p12
>  I105
>  sbt.
>
> **********************************************************************
> *********************************************
>
>  As I understand the pickle-algorithm this file looks as intended except for the i_mp_bee88a136571a696398a0eb82b06eeb3 which normaly would be the name of the module. Obviously the module name is converted into some mod_python GUID thingy...
>
>  The error message i get is the following:
>
>  MOD_PYTHON ERROR
>
>  ProcessId:      3784
>  Interpreter:    'xx'
>
>  ServerName:     'xx'
>  DocumentRoot:   'C:/Program Files/Apache Software Foundation/Apache2.2/htdocs'
>
>  URI:            '/python/test/pickletest.py'
>  Location:       None
>  Directory:      'C:/Program Files/Apache Software Foundation/Apache2.2/htdocs/python/'
>  Filename:       'C:\\Program Files\\Apache Software Foundation\\Apache2.2\\htdocs\\python\\test\\pickletest.py'
>  PathInfo:       ''
>
>  Phase:          'PythonHandler'
>  Handler:        'mod_python.publisher'
>
>  Traceback (most recent call last):
>
>   File "C:\Program Files\Python25\lib\site-packages\mod_python\importer.py", line 1537, in HandlerDispatch
>     default=default_handler, arg=req, silent=hlist.silent)
>
>   File "C:\Program Files\Python25\lib\site-packages\mod_python\importer.py", line 1229, in _process_target
>     result = _execute_target(config, req, object, arg)
>
>   File "C:\Program Files\Python25\lib\site-packages\mod_python\importer.py", line 1128, in _execute_target
>     result = object(arg)
>
>   File "C:\Program Files\Python25\lib\site-packages\mod_python\publisher.py", line 213, in handler
>     published = publish_object(req, object)
>
>   File "C:\Program Files\Python25\lib\site-packages\mod_python\publisher.py", line 425, in publish_object
>     return publish_object(req,util.apply_fs_data(object, req.form,
> req=req))
>
>   File "C:\Program Files\Python25\lib\site-packages\mod_python\util.py", line 554, in apply_fs_data
>     return object(**args)
>
>   File "C:\Program Files\Apache Software Foundation\Apache2.2\htdocs\python\test\pickletest.py", line 25, in index
>     (myInstance, myOtherInstance) = cPickle.load(file)
>
>  ImportError: No module named _mp_bee88a136571a696398a0eb82b06eeb3
>
>
>  MODULE CACHE DETAILS
>
>  Accessed:       Tue Apr 01 11:05:33 2008
>  Generation:     26
>
>  _mp_bee88a136571a696398a0eb82b06eeb3 {
>   FileName:     'C:\\Program Files\\Apache Software Foundation\\Apache2.2\\htdocs\\python\\test\\dummyclass.py'
>   Instance:     1
>   Generation:   13
>   Modified:     Tue Apr 01 09:59:54 2008
>   Imported:     Tue Apr 01 10:05:22 2008
>  }
>
>  _mp_754c5030ce462c9ea7741cb6f66d6cc1 {
>   FileName:     'C:\\Program Files\\Apache Software Foundation\\Apache2.2\\htdocs\\python\\test\\pickletest.py'
>   Instance:     13
>   Generation:   26
>   Modified:     Tue Apr 01 10:56:58 2008
>   Imported:     Tue Apr 01 10:57:10 2008
>   Children:     'C:\\Program Files\\Apache Software Foundation\\Apache2.2\\htdocs\\python\\test\\dummyclass.py'
>  }
>
>  Is there a way how to use cPickle AND mod_python together? I also
> tried to use the session mechanism instead of the pickle mechanism to
> store instance objects in a binary file but that doesn't seem to work
> either (if I do a req.session['myInstances'] = (myInstance,
> myOtherInstance) then the session doesn't seem to be saved properly
> and thus, everytime I hit on browser-reload a new session is
> generated...)
>
>  Would be really great if someone could help me with this!
>
>  Greetings Dominique
>
>
>  _______________________________________________
>  Mod_python mailing list
>  Mod_python@modpython.org
>  http://mailman.modpython.org/mailman/listinfo/mod_python
>



From graham.dumpleton at gmail.com  Tue Apr  1 07:26:09 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue Apr  1 07:26:14 2008
Subject: [mod_python] Mod_python & cPickle / saving Instances
In-Reply-To: <5213E58D85BC414998FA553C701E386C0EDD046B83@SGBD012511.dlrmail.ad.delarue.com>
References: <88e286470804010257k193e2d6csfdc9c0fd3a3eddc3@mail.gmail.com>
	<5213E58D85BC414998FA553C701E386C0EDD046B83@SGBD012511.dlrmail.ad.delarue.com>
Message-ID: <88e286470804010426t5da4785fjb2956c5cf66a82f3@mail.gmail.com>

On 01/04/2008, Dominique.Holzwarth@ch.delarue.com
<Dominique.Holzwarth@ch.delarue.com> wrote:
> Hello Graham
>
>  I've read your article and just want to clarify if I understood it the right way :-)
>  So basicly instance objects shouldn't (or rather can't) be stored in a session object (and also using pickle directly won't work) due to the new mod_python module importer?

Complex user defined types from code files which are candidates for
mod_python module reloading can't be used.

>  Pickle would work tho, if I add my own modules to the PYTHONPATH (sys.modules thingy) so that they are loaded by the standard python module loader? Is that correct?

Correct. Those in normal Python modules picked up from sys.path can be used.

In general though recommend only using basic Python types,
dictionaries, lists etc. This is though just to avoid potential for
problem, not that there is still a problem. Just make sure stuff you
want to pickle is in modules on sys.path.

>  However, using the standard python module loader for own modules will cause some mod_python problems as stated in http://www.dscpl.com.au/wiki/ModPython/Articles/ModuleImportingIsBroken ?

Which things in particular are you talking about? The problems in that
document refer to pre mod_python 3.3.1. I can't think of any specific
issues with use of standard modules that would cause a problem for you
in mod_python 3.3.1.

Graham

>  If that's really the current state then I guess I have to do some redesign in order to not use instance object serialisation... :-/
>
>  Thanks for the quick answer,
>  Dominique
>
>
>  -----Original Message-----
>  From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
>  Sent: Dienstag, 1. April 2008 11:57
>  To: Holzwarth, Dominique (Berne Bauhaus)
>  Cc: mod_python@modpython.org
>  Subject: Re: [mod_python] Mod_python & cPickle / saving Instances
>
>  Read:
>
>   http://www.dscpl.com.au/wiki/ModPython/Articles/IssuesWithSessionObjects
>
>  Graham
>
>  On 01/04/2008, Dominique.Holzwarth@ch.delarue.com
>  <Dominique.Holzwarth@ch.delarue.com> wrote:
>  > Hey Guys
>  >
>  >  I was just playing around with the cPickle module to save some instance objects into binary files and 'offline' (normal python interpreter on local machine) it all works fine. However, when I try to do the same things under apache with mod_python I get a mod_python specific error...
>  >
>  >  Here are my testing files:
>  >
>  >  Pickletest.py
>  >
>  > **********************************************************************
>  > *********************************************
>  >  from mod_python import apache
>  >  from mod_python import Session
>  >  import cPickle, pickle
>  >
>  >  myModule = apache.import_module('~/test/dummyclass.py')
>  >
>  >  secretText = "hallo"
>  >
>  >  def index(req):
>  >     req.session = Session.FileSession(req, secret=secretText)
>  >     if req.session.is_new():
>  >         myInstance = myModule.myClass()
>  >         myInstance.hit()
>  >         hits = str(myInstance.hitCounter)
>  >         myOtherInstance = myModule.myOtherClass()
>  >         myOtherInstance.hit()
>  >         randNum = str(myOtherInstance.randomNumber)
>  >         file = open('C:\\Program Files\\Apache Software Foundation\\Apache2.2\\test\\myInstances.pkl','wb')
>  >         cPickle.dump((myInstance, myOtherInstance), file)
>  >         file.close()
>  >         req.session.save()
>  >         return "Hits: "+hits+" Random Number: "+randNum
>  >     else:
>  >         file = open('C:\\Program Files\\Apache Software Foundation\\Apache2.2\\test\\myInstances.pkl','rb')
>  >         (myInstance, myOtherInstance) = cPickle.load(file)
>  >         file.close()
>  >         myInstance.hit()
>  >         myOtherInstance.hit()
>  >         hits = str(myInstance.hitCounter)
>  >         randNumber = str(myOtherInstance.randomNumber)
>  >         req.session['myInstances'] = (myInstance, myOtherInstance)
>  >         file = open('C:\\Program Files\\Apache Software Foundation\\Apache2.2\\test\\myInstances.pkl','wb')
>  >         cPickle.dump((myInstance, myOtherInstance), file)
>  >         file.close()
>  >         req.session.save()
>  >         return "Hits: "+hits+" Random Number: "+randNum+" old session"
>  >
>  > **********************************************************************
>  > *********************************************
>  >
>  >  This script does nothing more than saving / loading instance objects and displaying some sort of 'hit counter'
>  >
>  >  Dummyclass.py
>  >
>  > **********************************************************************
>  > *********************************************
>  >  import random
>  >
>  >  class myClass:
>  >     def __init__(self):
>  >         self.attribute = 1
>  >         self.text = "hello world"
>  >         self.hitCounter = 0
>  >
>  >     def hit(self):
>  >         self.hitCounter += 1
>  >
>  >  class myOtherClass:
>  >     def __init__(self):
>  >         self.otherAttribute = 2
>  >         self.otherText = "goodbye world"
>  >         self.randomNumber = 0
>  >
>  >     def hit(self):
>  >         self.randomNumber = random.randint(0, 1000)
>  >
>  > **********************************************************************
>  > *********************************************
>  >  Defines some useless classes, of which instance objects should be
>  > stored :-)
>  >
>  >  The script manages to write the *.pkl file which looks like this:
>  >
>  >  myInstances.pkl
>  >
>  > **********************************************************************
>  > *********************************************
>  >  ((i_mp_bee88a136571a696398a0eb82b06eeb3
>  >  myClass
>  >  p1
>  >  (dp2
>  >  S'attribute'
>  >  p3
>  >  I1
>  >  sS'hitCounter'
>  >  p4
>  >  I1
>  >  sS'text'
>  >  p5
>  >  S'hello world'
>  >  p6
>  >  sb(i_mp_bee88a136571a696398a0eb82b06eeb3
>  >  myOtherClass
>  >  p7
>  >  (dp8
>  >  S'otherText'
>  >  p9
>  >  S'goodbye world'
>  >  p10
>  >  sS'otherAttribute'
>  >  p11
>  >  I2
>  >  sS'randomNumber'
>  >  p12
>  >  I105
>  >  sbt.
>  >
>  > **********************************************************************
>  > *********************************************
>  >
>  >  As I understand the pickle-algorithm this file looks as intended except for the i_mp_bee88a136571a696398a0eb82b06eeb3 which normaly would be the name of the module. Obviously the module name is converted into some mod_python GUID thingy...
>  >
>  >  The error message i get is the following:
>  >
>  >  MOD_PYTHON ERROR
>  >
>  >  ProcessId:      3784
>  >  Interpreter:    'xx'
>  >
>  >  ServerName:     'xx'
>  >  DocumentRoot:   'C:/Program Files/Apache Software Foundation/Apache2.2/htdocs'
>  >
>  >  URI:            '/python/test/pickletest.py'
>  >  Location:       None
>  >  Directory:      'C:/Program Files/Apache Software Foundation/Apache2.2/htdocs/python/'
>  >  Filename:       'C:\\Program Files\\Apache Software Foundation\\Apache2.2\\htdocs\\python\\test\\pickletest.py'
>  >  PathInfo:       ''
>  >
>  >  Phase:          'PythonHandler'
>  >  Handler:        'mod_python.publisher'
>  >
>  >  Traceback (most recent call last):
>  >
>  >   File "C:\Program Files\Python25\lib\site-packages\mod_python\importer.py", line 1537, in HandlerDispatch
>  >     default=default_handler, arg=req, silent=hlist.silent)
>  >
>  >   File "C:\Program Files\Python25\lib\site-packages\mod_python\importer.py", line 1229, in _process_target
>  >     result = _execute_target(config, req, object, arg)
>  >
>  >   File "C:\Program Files\Python25\lib\site-packages\mod_python\importer.py", line 1128, in _execute_target
>  >     result = object(arg)
>  >
>  >   File "C:\Program Files\Python25\lib\site-packages\mod_python\publisher.py", line 213, in handler
>  >     published = publish_object(req, object)
>  >
>  >   File "C:\Program Files\Python25\lib\site-packages\mod_python\publisher.py", line 425, in publish_object
>  >     return publish_object(req,util.apply_fs_data(object, req.form,
>  > req=req))
>  >
>  >   File "C:\Program Files\Python25\lib\site-packages\mod_python\util.py", line 554, in apply_fs_data
>  >     return object(**args)
>  >
>  >   File "C:\Program Files\Apache Software Foundation\Apache2.2\htdocs\python\test\pickletest.py", line 25, in index
>  >     (myInstance, myOtherInstance) = cPickle.load(file)
>  >
>  >  ImportError: No module named _mp_bee88a136571a696398a0eb82b06eeb3
>  >
>  >
>  >  MODULE CACHE DETAILS
>  >
>  >  Accessed:       Tue Apr 01 11:05:33 2008
>  >  Generation:     26
>  >
>  >  _mp_bee88a136571a696398a0eb82b06eeb3 {
>  >   FileName:     'C:\\Program Files\\Apache Software Foundation\\Apache2.2\\htdocs\\python\\test\\dummyclass.py'
>  >   Instance:     1
>  >   Generation:   13
>  >   Modified:     Tue Apr 01 09:59:54 2008
>  >   Imported:     Tue Apr 01 10:05:22 2008
>  >  }
>  >
>  >  _mp_754c5030ce462c9ea7741cb6f66d6cc1 {
>  >   FileName:     'C:\\Program Files\\Apache Software Foundation\\Apache2.2\\htdocs\\python\\test\\pickletest.py'
>  >   Instance:     13
>  >   Generation:   26
>  >   Modified:     Tue Apr 01 10:56:58 2008
>  >   Imported:     Tue Apr 01 10:57:10 2008
>  >   Children:     'C:\\Program Files\\Apache Software Foundation\\Apache2.2\\htdocs\\python\\test\\dummyclass.py'
>  >  }
>  >
>  >  Is there a way how to use cPickle AND mod_python together? I also
>  > tried to use the session mechanism instead of the pickle mechanism to
>  > store instance objects in a binary file but that doesn't seem to work
>  > either (if I do a req.session['myInstances'] = (myInstance,
>  > myOtherInstance) then the session doesn't seem to be saved properly
>  > and thus, everytime I hit on browser-reload a new session is
>  > generated...)
>  >
>  >  Would be really great if someone could help me with this!
>  >
>  >  Greetings Dominique
>  >
>  >
>  >  _______________________________________________
>  >  Mod_python mailing list
>  >  Mod_python@modpython.org
>  >  http://mailman.modpython.org/mailman/listinfo/mod_python
>  >
>
>
>
From Dominique.Holzwarth at ch.delarue.com  Tue Apr  1 08:54:49 2008
From: Dominique.Holzwarth at ch.delarue.com (Dominique.Holzwarth@ch.delarue.com)
Date: Tue Apr  1 08:56:14 2008
Subject: [mod_python] Mod_python & cPickle / saving Instances
In-Reply-To: <88e286470804010426t5da4785fjb2956c5cf66a82f3@mail.gmail.com>
Message-ID: <5213E58D85BC414998FA553C701E386C0EDD046C9D@SGBD012511.dlrmail.ad.delarue.com>

>  Pickle would work tho, if I add my own modules to the PYTHONPATH (sys.modules thingy) so that they are loaded by the standard python module loader? Is that correct?

Correct. Those in normal Python modules picked up from sys.path can be used.

In general though recommend only using basic Python types, dictionaries, lists etc. This is though just to avoid potential for problem, not that there is still a problem. Just make sure stuff you want to pickle is in modules on sys.path.

>  However, using the standard python module loader for own modules will cause some mod_python problems as stated in http://www.dscpl.com.au/wiki/ModPython/Articles/ModuleImportingIsBroken ?

Which things in particular are you talking about? The problems in that document refer to pre mod_python 3.3.1. I can't think of any specific issues with use of standard modules that would cause a problem for you in mod_python 3.3.1.

--> I didn't mean standard python modules. I meant my _own_ modules and was talking about what effects it has when I add them to sys.path so that the 'standard python module loader' will do the import, rather than the mod_python 'loader'.

The thing is: As I understood it, if I just add my own modules to the sys.path they will be imported by 'standard python' (other than 'mod_python') and thus pickling would work. However, with the new mod_python import mechanism, my own modules shouldn't be added to sys.path as this mixing of paths could cause problems to mod_python or so...
At least that's what I have read in: http://www.modpython.org/pipermail/mod_python/2006-November/022726.html (and in there, you posted the above article :-))

Dominique


From graham.dumpleton at gmail.com  Tue Apr  1 18:08:54 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue Apr  1 18:08:58 2008
Subject: [mod_python] Mod_python & cPickle / saving Instances
In-Reply-To: <5213E58D85BC414998FA553C701E386C0EDD046C9D@SGBD012511.dlrmail.ad.delarue.com>
References: <88e286470804010426t5da4785fjb2956c5cf66a82f3@mail.gmail.com>
	<5213E58D85BC414998FA553C701E386C0EDD046C9D@SGBD012511.dlrmail.ad.delarue.com>
Message-ID: <88e286470804011508s1cab64e1l5ba8048611c4bafb@mail.gmail.com>

On 01/04/2008, Dominique.Holzwarth@ch.delarue.com
<Dominique.Holzwarth@ch.delarue.com> wrote:
> >  Pickle would work tho, if I add my own modules to the PYTHONPATH (sys.modules thingy) so that they are loaded by the standard python module loader? Is that correct?
>
>  Correct. Those in normal Python modules picked up from sys.path can be used.
>
>  In general though recommend only using basic Python types, dictionaries, lists etc. This is though just to avoid potential for problem, not that there is still a problem. Just make sure stuff you want to pickle is in modules on sys.path.
>
>  >  However, using the standard python module loader for own modules will cause some mod_python problems as stated in http://www.dscpl.com.au/wiki/ModPython/Articles/ModuleImportingIsBroken ?
>
>  Which things in particular are you talking about? The problems in that document refer to pre mod_python 3.3.1. I can't think of any specific issues with use of standard modules that would cause a problem for you in mod_python 3.3.1.
>
>
> --> I didn't mean standard python modules. I meant my _own_ modules and was talking about what effects it has when I add them to sys.path so that the 'standard python module loader' will do the import, rather than the mod_python 'loader'.
>
>  The thing is: As I understood it, if I just add my own modules to the sys.path they will be imported by 'standard python' (other than 'mod_python') and thus pickling would work. However, with the new mod_python import mechanism, my own modules shouldn't be added to sys.path as this mixing of paths could cause problems to mod_python or so...
>  At least that's what I have read in: http://www.modpython.org/pipermail/mod_python/2006-November/022726.html (and in there, you posted the above article :-))

No, you misunderstand. You can quite happily add additional
directories to sys.path using PythonPath directory, with those
directories holding your own modules. Alternatively, install your
modules in site wide site-packages directive. What any warning would
have been about is not adding any directories which fall into your
document tree, or which you have added to mod_python.importer.path to
sys.path. That is, the set of directories in each shouldn't overlap
otherwise you have the possibility of dual import copies.

Graham
From matusis at yahoo.com  Thu Apr  3 04:17:07 2008
From: matusis at yahoo.com (Alec Matusis)
Date: Thu Apr  3 04:17:18 2008
Subject: [mod_python] scalability question?
Message-ID: <01d001c89563$1b9b4280$52d1c780$@com>

I just installed a second webserver machine. About 1/3 of all http requests
are now routed to this new webserver, which has identical configuration to
the first webserver.
Both webservers connect to a single DB server. 

On the new webserver I am intermittently getting the following error:
OperationalError: (2003, "Can't connect to MySQL server on '10.18.3.0' (4)")

What puzzles me is that the old webserver did not have this error under 70%
higher request rate (at 600 req/sec), before some of the load was removed
from it. Mod_python/python installation is identical on both boxes, and they
are running exactly identical scripts. TCP stack also seems to be configured
identically.
When I got a bunch of these errors, I did notice about 15000 connections to
the database in TIME_WAIT state on this problematic new webserver. The new
machine is a bit slower (2x2.66GHz xeon vs 2x3.0GHz on the old one), but
would this small difference cause such a problem?

The script that connects to the DB is:

def load(self):
       .....
        dbc = MySQLdb.connect(host=config.db_host, db=config.db,
user=config.db_user, passwd=config.db_passwd )
        dbc.autocommit(True)
        c = dbc.cursor()
        r = c.execute( query)
        if r == 0: #not sure what the key error is supposed to be but it is
being caught
            raise ProfileError

        rvalues = c.fetchone()
        c.close()
        dbc.close()
	  ....
  

I am very puzzled what may cause this...


From graham.dumpleton at gmail.com  Thu Apr  3 07:13:03 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu Apr  3 07:13:06 2008
Subject: [mod_python] scalability question?
In-Reply-To: <01d001c89563$1b9b4280$52d1c780$@com>
References: <01d001c89563$1b9b4280$52d1c780$@com>
Message-ID: <88e286470804030413v6f4910d4pd371573af8efb6c1@mail.gmail.com>

What Apache MPM is each server compiled with, prefork or worker MPM?

Graham

On 03/04/2008, Alec Matusis <matusis@yahoo.com> wrote:
> I just installed a second webserver machine. About 1/3 of all http requests
>  are now routed to this new webserver, which has identical configuration to
>  the first webserver.
>  Both webservers connect to a single DB server.
>
>  On the new webserver I am intermittently getting the following error:
>  OperationalError: (2003, "Can't connect to MySQL server on '10.18.3.0' (4)")
>
>  What puzzles me is that the old webserver did not have this error under 70%
>  higher request rate (at 600 req/sec), before some of the load was removed
>  from it. Mod_python/python installation is identical on both boxes, and they
>  are running exactly identical scripts. TCP stack also seems to be configured
>  identically.
>  When I got a bunch of these errors, I did notice about 15000 connections to
>  the database in TIME_WAIT state on this problematic new webserver. The new
>  machine is a bit slower (2x2.66GHz xeon vs 2x3.0GHz on the old one), but
>  would this small difference cause such a problem?
>
>  The script that connects to the DB is:
>
>  def load(self):
>        .....
>         dbc = MySQLdb.connect(host=config.db_host, db=config.db,
>  user=config.db_user, passwd=config.db_passwd )
>         dbc.autocommit(True)
>         c = dbc.cursor()
>         r = c.execute( query)
>         if r == 0: #not sure what the key error is supposed to be but it is
>  being caught
>             raise ProfileError
>
>         rvalues = c.fetchone()
>         c.close()
>         dbc.close()
>           ....
>
>
>  I am very puzzled what may cause this...
>
>
>  _______________________________________________
>  Mod_python mailing list
>  Mod_python@modpython.org
>  http://mailman.modpython.org/mailman/listinfo/mod_python
>
From matusis at yahoo.com  Thu Apr  3 15:05:46 2008
From: matusis at yahoo.com (Alec Matusis)
Date: Thu Apr  3 15:06:02 2008
Subject: [mod_python] scalability question?
In-Reply-To: <88e286470804030413v6f4910d4pd371573af8efb6c1@mail.gmail.com>
References: <01d001c89563$1b9b4280$52d1c780$@com>
	<88e286470804030413v6f4910d4pd371573af8efb6c1@mail.gmail.com>
Message-ID: <02b501c895bd$ba5e29f0$2f1a7dd0$@com>

Worker MPM, but identical on both machines.

> -----Original Message-----
> From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> Sent: Thursday, April 03, 2008 4:13 AM
> To: Alec Matusis
> Cc: mod_python@modpython.org
> Subject: Re: [mod_python] scalability question?
> 
> What Apache MPM is each server compiled with, prefork or worker MPM?
> 
> Graham
> 
> On 03/04/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > I just installed a second webserver machine. About 1/3 of all http
> requests
> >  are now routed to this new webserver, which has identical
> configuration to
> >  the first webserver.
> >  Both webservers connect to a single DB server.
> >
> >  On the new webserver I am intermittently getting the following
> error:
> >  OperationalError: (2003, "Can't connect to MySQL server on
> '10.18.3.0' (4)")
> >
> >  What puzzles me is that the old webserver did not have this error
> under 70%
> >  higher request rate (at 600 req/sec), before some of the load was
> removed
> >  from it. Mod_python/python installation is identical on both boxes,
> and they
> >  are running exactly identical scripts. TCP stack also seems to be
> configured
> >  identically.
> >  When I got a bunch of these errors, I did notice about 15000
> connections to
> >  the database in TIME_WAIT state on this problematic new webserver.
> The new
> >  machine is a bit slower (2x2.66GHz xeon vs 2x3.0GHz on the old one),
> but
> >  would this small difference cause such a problem?
> >
> >  The script that connects to the DB is:
> >
> >  def load(self):
> >        .....
> >         dbc = MySQLdb.connect(host=config.db_host, db=config.db,
> >  user=config.db_user, passwd=config.db_passwd )
> >         dbc.autocommit(True)
> >         c = dbc.cursor()
> >         r = c.execute( query)
> >         if r == 0: #not sure what the key error is supposed to be but
> it is
> >  being caught
> >             raise ProfileError
> >
> >         rvalues = c.fetchone()
> >         c.close()
> >         dbc.close()
> >           ....
> >
> >
> >  I am very puzzled what may cause this...
> >
> >
> >  _______________________________________________
> >  Mod_python mailing list
> >  Mod_python@modpython.org
> >  http://mailman.modpython.org/mailman/listinfo/mod_python
> >


From Dominique.Holzwarth at ch.delarue.com  Fri Apr  4 09:49:13 2008
From: Dominique.Holzwarth at ch.delarue.com (Dominique.Holzwarth@ch.delarue.com)
Date: Fri Apr  4 09:51:27 2008
Subject: [mod_python] Multiple submissions from the same user
Message-ID: <5213E58D85BC414998FA553C701E386C0EDD07485C@SGBD012511.dlrmail.ad.delarue.com>

Hello everyone

Does anyone know how I can configure apache and/or mod_python in a way, so that multiple requests from the same user are 'ignored' (python scripts not executed) if the answer of the first request wasn't completely sent to the browser yet?

I just stumbled over that problem while testing my web application which has a form with several "submit" buttons and when I click one of them - or different ones - very quick after each other ('spam clicking') then my scripts don't like that at all and gracefully die :-)

As a quick work-around I was thinking about simply disabling the submit buttons with javascript and the "onsubmit" event handler but as we all know javascript ain't THAT reliable so I was wondering if it's possible to control that problem on the server side.

Another, but similar question I have:
How can I configure apache / mod_python to allow only ONE active session per user at a time? At the moment I can login with same user/pw unlimited times which also ain't really good for my application =)

Greetings,
Dominique


From gzlist at googlemail.com  Fri Apr  4 11:40:08 2008
From: gzlist at googlemail.com (Martin (gzlist))
Date: Fri Apr  4 11:40:13 2008
Subject: [mod_python] Multiple submissions from the same user
In-Reply-To: <5213E58D85BC414998FA553C701E386C0EDD07485C@SGBD012511.dlrmail.ad.delarue.com>
References: <5213E58D85BC414998FA553C701E386C0EDD07485C@SGBD012511.dlrmail.ad.delarue.com>
Message-ID: <d80792120804040840m640c8454ke42555566503f2b4@mail.gmail.com>

On 04/04/2008, <Dominique.Holzwarth@ch.delarue.com> wrote:
> Hello everyone
>
>  Does anyone know how I can configure apache and/or mod_python in a way, so that multiple requests from the same user are 'ignored' (python scripts not executed) if the answer of the first request wasn't completely sent to the browser yet?
>
>  I just stumbled over that problem while testing my web application which has a form with several "submit" buttons and when I click one of them - or different ones - very quick after each other ('spam clicking') then my scripts don't like that at all and gracefully die :-)

The solution is to stop the scripts dying? If for instance, it needs
to write to a file user/{username} then running it twice at the same
time will cause the second instance should either fall over or block
till the first finishes, but the first should be unaffected either
way. If that's not already the case, you need to have an explicit
locking mechanism:

def do_action_for(user):
    with lock = lock_for(user):
        dangerous_stuff_for(user)

Once that's in place, you can fix your problem by blocking on the
lock, then once the lock is acquired, checking to see if the action is
already done, and returning the result straight away:

def do_action_for(user):
    with lock = lock_for(user):
        result_filename = result_file_for(user)
        if not os.exists(result_filename):
            file(result_filename, "w").write(dangerous_stuff_for(user))
        fast_redirect_to(result_filename)

If you're cunning, you can combine the lock and result cache mechanism.

>  As a quick work-around I was thinking about simply disabling the submit buttons with javascript and the "onsubmit" event handler but as we all know javascript ain't THAT reliable so I was wondering if it's possible to control that problem on the server side.

Client side scripting really isn't the answer to a server program bug.
Website users will do unexpected things whatever: like trying to
delete the same item twice because they get back-button confused.
Trying to take away their back button then is not the solution, you
need to make sure you're coping with odd input.

>  Another, but similar question I have:
>  How can I configure apache / mod_python to allow only ONE active session per user at a time? At the moment I can login with same user/pw unlimited times which also ain't really good for my application =)

With sessions, this is generally legal, but should invalidate the old
session. Slightly annoying when you're testing with two browsers at
once, as they log each other out, but the convention. You can do this
by checking to see if the user already has a session in the database
before handing out a new one, and removing it if they do.

Martin
From joefazee at gmail.com  Fri Apr  4 22:42:40 2008
From: joefazee at gmail.com (A. Joseph)
Date: Fri Apr  4 22:42:43 2008
Subject: [mod_python] Installing mod_python with Apache 2.2 /Python 2.5
Message-ID: <ea09b3700804041942i4621a01btf54c7167b4de39c7@mail.gmail.com>

Please can I get a link to the necessary file?  I have been trying
everything but if I load the .py file it will show the source code on the
browser window.



Help
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080405/ababbff5/attachment.html
From lychen1109 at gmail.com  Sat Apr  5 06:45:03 2008
From: lychen1109 at gmail.com (Luyi Chen)
Date: Sat Apr  5 06:45:08 2008
Subject: [mod_python] old libexpat shared library
Message-ID: <8608ca750804050345m64c42592nd796e8d20f75d560@mail.gmail.com>

Hi,

I am trying to make mod_python working on Apache 2.2.6, ubuntu dapper
6.06. But I was hit by the problem of wrong expat library issue, as
stated by Graham Dumpleton, on this page
http://www.dscpl.com.au/wiki/ModPython/Articles/ExpatCausingApacheCrash

I am using a custom compiled Apache2 in /usr/local/apache2, so I
checked version of libexpat with the following line,

ldd /usr/local/apache2/bin/httpd

in the result there're two lines
 libexpat.so.0 => /usr/local/apache2/lib/libexpat.so.0 (0x00002b4f4e1c5000)
 libexpat.so.1 => /usr/lib/libexpat.so.1 (0x00002b4f4e2e7000)

The one in /usr/local/apache2/lib is an old version 1.95.2, while the
one in /usr/lib is 1.95.8, which is identical to the version of
libexpat used by python.

How do I tell Apache to use the new version of libexpat only?

Luyi
From clodoaldo.pinto.neto at gmail.com  Sat Apr  5 08:34:00 2008
From: clodoaldo.pinto.neto at gmail.com (Clodoaldo)
Date: Sat Apr  5 08:34:03 2008
Subject: [mod_python] Installing mod_python with Apache 2.2 /Python 2.5
In-Reply-To: <ea09b3700804041942i4621a01btf54c7167b4de39c7@mail.gmail.com>
References: <ea09b3700804041942i4621a01btf54c7167b4de39c7@mail.gmail.com>
Message-ID: <a595de7a0804050534x590e09edn8540573fa5c94439@mail.gmail.com>

If think that with level of detail you gave you will not get an
answer. Show Apache configuration and apache's access and error logs.
Which OS?

Regards, Clodoaldo P?nto Neto

2008/4/4, A. Joseph <joefazee@gmail.com>:
>
>
> Please can I get a link to the necessary file?  I have been trying
> everything but if I load the .py file it will show the source code on the
> browser window.
>
>
>
> Help
> _______________________________________________
>  Mod_python mailing list
>  Mod_python@modpython.org
>  http://mailman.modpython.org/mailman/listinfo/mod_python
>
>

From Dominique.Holzwarth at ch.delarue.com  Sat Apr  5 10:31:05 2008
From: Dominique.Holzwarth at ch.delarue.com (Dominique.Holzwarth@ch.delarue.com)
Date: Sat Apr  5 10:32:43 2008
Subject: AW: [mod_python] Multiple submissions from the same user
In-Reply-To: <d80792120804040840m640c8454ke42555566503f2b4@mail.gmail.com>
References: <5213E58D85BC414998FA553C701E386C0EDD07485C@SGBD012511.dlrmail.ad.delarue.com>,
	<d80792120804040840m640c8454ke42555566503f2b4@mail.gmail.com>
Message-ID: <5213E58D85BC414998FA553C701E386C0EDD07FF05@SGBD012511.dlrmail.ad.delarue.com>

Your idea with locking might be a point in general, however it's not really want I to be honest. Think about a form that has a "show" button which sends a request to the server to get same data and display it to the user (as new html answer). Then what I'd like to have is that the user just can't hit that show button like 1000x in 1 sec so that a new request is started before a previous one is actually transferred back to the user.
As it makes no sense to "spam click" that show button (just as an example) it also makes no sense to me to blow up my scripts just do handle that case.
So what I was wondering about was if there's some sort of mechanism within apache or mod_python itself to simply ignore requests from the same user when a request for that user is still being processed.
I know you can limit stuff like "maxClient" and "ThreadsPerChild" and "maxThreads" which is somehow related to how requests are being processed. But I have to admit that I dont really understand it to the fullest, so thats why I was asking here... ;-)

Greetings
Dominique
________________________________________
Von: Martin (gzlist) [gzlist@googlemail.com]
Gesendet: Freitag, 4. April 2008 17:40
An: Holzwarth, Dominique (Berne Bauhaus)
Cc: mod_python@modpython.org
Betreff: Re: [mod_python] Multiple submissions from the same user

On 04/04/2008, <Dominique.Holzwarth@ch.delarue.com> wrote:
> Hello everyone
>
>  Does anyone know how I can configure apache and/or mod_python in a way, so that multiple requests from the same user are 'ignored' (python scripts not executed) if the answer of the first request wasn't completely sent to the browser yet?
>
>  I just stumbled over that problem while testing my web application which has a form with several "submit" buttons and when I click one of them - or different ones - very quick after each other ('spam clicking') then my scripts don't like that at all and gracefully die :-)

The solution is to stop the scripts dying? If for instance, it needs
to write to a file user/{username} then running it twice at the same
time will cause the second instance should either fall over or block
till the first finishes, but the first should be unaffected either
way. If that's not already the case, you need to have an explicit
locking mechanism:

def do_action_for(user):
    with lock = lock_for(user):
        dangerous_stuff_for(user)

Once that's in place, you can fix your problem by blocking on the
lock, then once the lock is acquired, checking to see if the action is
already done, and returning the result straight away:

def do_action_for(user):
    with lock = lock_for(user):
        result_filename = result_file_for(user)
        if not os.exists(result_filename):
            file(result_filename, "w").write(dangerous_stuff_for(user))
        fast_redirect_to(result_filename)

If you're cunning, you can combine the lock and result cache mechanism.

>  As a quick work-around I was thinking about simply disabling the submit buttons with javascript and the "onsubmit" event handler but as we all know javascript ain't THAT reliable so I was wondering if it's possible to control that problem on the server side.

Client side scripting really isn't the answer to a server program bug.
Website users will do unexpected things whatever: like trying to
delete the same item twice because they get back-button confused.
Trying to take away their back button then is not the solution, you
need to make sure you're coping with odd input.

>  Another, but similar question I have:
>  How can I configure apache / mod_python to allow only ONE active session per user at a time? At the moment I can login with same user/pw unlimited times which also ain't really good for my application =)

With sessions, this is generally legal, but should invalidate the old
session. Slightly annoying when you're testing with two browsers at
once, as they log each other out, but the convention. You can do this
by checking to see if the user already has a session in the database
before handing out a new one, and removing it if they do.

Martin


From sean at monkeysnatchbanana.com  Sat Apr  5 17:46:44 2008
From: sean at monkeysnatchbanana.com (Sean Allen)
Date: Sat Apr  5 17:46:53 2008
Subject: AW: [mod_python] Multiple submissions from the same user
In-Reply-To: <5213E58D85BC414998FA553C701E386C0EDD07FF05@SGBD012511.dlrmail.ad.delarue.com>
References: <5213E58D85BC414998FA553C701E386C0EDD07485C@SGBD012511.dlrmail.ad.delarue.com>,
	<d80792120804040840m640c8454ke42555566503f2b4@mail.gmail.com>
	<5213E58D85BC414998FA553C701E386C0EDD07FF05@SGBD012511.dlrmail.ad.delarue.com>
Message-ID: <22C5861B-5BBB-418D-8033-CBC651F5AE62@monkeysnatchbanana.com>


On Apr 5, 2008, at 10:31 AM, <Dominique.Holzwarth@ch.delarue.com> <Dominique.Holzwarth@ch.delarue.com 
 > wrote:
> Your idea with locking might be a point in general, however it's not  
> really want I to be honest. Think about a form that has a "show"  
> button which sends a request to the server to get same data and  
> display it to the user (as new html answer). Then what I'd like to  
> have is that the user just can't hit that show button like 1000x in  
> 1 sec so that a new request is started before a previous one is  
> actually transferred back to the user.
> As it makes no sense to "spam click" that show button (just as an  
> example) it also makes no sense to me to blow up my scripts just do  
> handle that case.
> So what I was wondering about was if there's some sort of mechanism  
> within apache or mod_python itself to simply ignore requests from  
> the same user when a request for that user is still being processed.
> I know you can limit stuff like "maxClient" and "ThreadsPerChild"  
> and "maxThreads" which is somehow related to how requests are being  
> processed. But I have to admit that I dont really understand it to  
> the fullest, so thats why I was asking here... ;-)

This is a bug in your code.

If you can't handle 2 requests coming in from same session w/o  
crashing, that is a bug in your code.
Saying you dont like the solution isnt really going to help you. You  
are basically asking for a crutch
to support buggy code. Even if there was a crutch to give, it is still  
just a crutch.

You are going to have to do some form of locking. The solution of  
doing it right there in the code
as suggested is going to be the least painful way to deal with it. If  
you consider that blowing up
your code, well, then yes, you do need to blow up your code. Code that  
dies when it gets
unexpected input is bad code.

As to this:

'So what I was wondering about was if there's some sort of mechanism  
within apache or mod_python itself to simply ignore requests from the  
same user '

User is an application level term. It means nothing to something like  
mod_python, mod_perl or any other lower level tool. mod_python exists  
inside an apache process, that process and mod_python are concerned  
with connections, stateless connections I might add, not with users. 
From clodoaldo.pinto.neto at gmail.com  Sat Apr  5 19:05:45 2008
From: clodoaldo.pinto.neto at gmail.com (Clodoaldo)
Date: Sat Apr  5 19:05:50 2008
Subject: [mod_python] mod_python errors
Message-ID: <a595de7a0804051605u59b528fcj90f1f2eb3ff4be90@mail.gmail.com>

Three errors have been happening in an application using mod_python.

Configuration:
Fedora Core 6. This server does not have mod_wsgi installed.
# uname -a
Linux myserver.net 2.6.22.14-72.fc6 #1 SMP Wed Nov 21 14:10:25 EST
2007 x86_64 x86_64 x86_64 GNU/Linux

Python 2.4.4
# ldd /usr/lib64/libpython2.4.so
        libpthread.so.0 => /lib64/libpthread.so.0 (0x0000003751e00000)
        libdl.so.2 => /lib64/libdl.so.2 (0x00000032d1000000)
        libutil.so.1 => /lib64/libutil.so.1 (0x00000032d8800000)
        libm.so.6 => /lib64/libm.so.6 (0x00000032d1400000)
        libc.so.6 => /lib64/libc.so.6 (0x00000032d0c00000)
        /lib64/ld-linux-x86-64.so.2 (0x0000555555554000)

mod_python 3.3.0b
# ldd /usr/lib64/httpd/modules/mod_python.so
        libpthread.so.0 => /lib64/libpthread.so.0 (0x00002aaaaae07000)
        libdl.so.2 => /lib64/libdl.so.2 (0x00002aaaab021000)
        libutil.so.1 => /lib64/libutil.so.1 (0x00002aaaab225000)
        libm.so.6 => /lib64/libm.so.6 (0x00002aaaab429000)
        libc.so.6 => /lib64/libc.so.6 (0x00002aaaab6ac000)
        /lib64/ld-linux-x86-64.so.2 (0x0000555555554000)

[Sat Apr 05 01:32:13 2008] [notice] Digest: generating secret for
digest authentication ...
[Sat Apr 05 01:32:13 2008] [notice] Digest: done
[Sat Apr 05 01:32:13 2008] [notice] mod_python: Creating 8 session
mutexes based on 256 max processes and 0 max threads.
[Sat Apr 05 01:32:13 2008] [notice] mod_python: using mutex_directory /tmp
[Sat Apr 05 01:32:13 2008] [notice] Apache/2.2.6 (Unix) DAV/2
PHP/5.1.6 mod_python/3.3.0b Python/2.4.4 mod_ssl/2.2.6 OpenSSL/0.9.8b
mod_perl/2.0.2 Perl/v5.8.8 configured -- resuming normal operations

# httpd -V
Server version: Apache/2.2.6 (Unix)
Server built:   Sep 18 2007 11:25:59
Server's Module Magic Number: 20051115:5
Server loaded:  APR 1.2.7, APR-Util 1.2.8
Compiled using: APR 1.2.7, APR-Util 1.2.8
Architecture:   64-bit
Server MPM:     Prefork
  threaded:     no
    forked:     yes (variable process count)
Server compiled with....
 -D APACHE_MPM_DIR="server/mpm/prefork"
 -D APR_HAS_SENDFILE
 -D APR_HAS_MMAP
 -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)
 -D APR_USE_SYSVSEM_SERIALIZE
 -D APR_USE_PTHREAD_SERIALIZE
 -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT
 -D APR_HAS_OTHER_CHILD
 -D AP_HAVE_RELIABLE_PIPED_LOGS
 -D DYNAMIC_MODULE_LIMIT=128
 -D HTTPD_ROOT="/etc/httpd"
 -D SUEXEC_BIN="/usr/sbin/suexec"
 -D DEFAULT_PIDLOG="logs/httpd.pid"
 -D DEFAULT_SCOREBOARD="logs/apache_runtime_status"
 -D DEFAULT_LOCKFILE="logs/accept.lock"
 -D DEFAULT_ERRORLOG="logs/error_log"
 -D AP_TYPES_CONFIG_FILE="conf/mime.types"
 -D SERVER_CONFIG_FILE="conf/httpd.conf"

The first error is already described in this thread:
http://www.modpython.org/pipermail/mod_python/2007-June/023795.html

It is also commented in these threads:
http://groups.google.co.uk/group/webpy/browse_thread/thread/4c5f2c76b749eb4e
http://bytes.com/forum/thread40318.html

[Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174]
ServerName: 'example.com', referer:
http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fabricante_id=22&modelo_id=0
[Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174]
DocumentRoot: '/var/www/html/example.com', referer:
http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fabricante_id=22&modelo_id=0
[Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174] URI:
'/_pesquisa', referer:
http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fabricante_id=22&modelo_id=0
[Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174] Location:
None, referer: http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fabricante_id=22&modelo_id=0
[Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174] Directory:
'/var/www/html/example.com/', referer:
http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fabricante_id=22&modelo_id=0
[Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174] Filename:
'/var/www/html/example.com/_pesquisa.py', referer:
http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fabricante_id=22&modelo_id=0
[Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174] PathInfo:
'', referer: http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fabricante_id=22&modelo_id=0
[Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174] Traceback
(most recent call last):, referer:
http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fabricante_id=22&modelo_id=0
[Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174]   File
"/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
1537, in HandlerDispatch\n    default=default_handler, arg=req,
silent=hlist.silent), referer:
http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fabricante_id=22&modelo_id=0
[Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174]   File
"/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
1229, in _process_target\n    result = _execute_target(config, req,
object, arg), referer:
http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fabricante_id=22&modelo_id=0
[Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174]   File
"/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
1128, in _execute_target\n    result = object(arg), referer:
http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fabricante_id=22&modelo_id=0
[Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174]   File
"/home/carroarodo/mod/_publisher.py", line 5, in handler\n    return
publisher.handler(req), referer:
http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fabricante_id=22&modelo_id=0
[Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174]   File
"/usr/lib64/python2.4/site-packages/mod_python/publisher.py", line
213, in handler\n    published = publish_object(req, object), referer:
http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fabricante_id=22&modelo_id=0
[Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174]   File
"/usr/lib64/python2.4/site-packages/mod_python/publisher.py", line
424, in publish_object\n    req.form = util.FieldStorage(req,
keep_blank_values=1), referer:
http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fabricante_id=22&modelo_id=0
[Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174]   File
"/usr/lib64/python2.4/site-packages/mod_python/util.py", line 225, in
__init__\n    pairs = parse_qsl(req.read(clen), keep_blank_values),
referer: http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fabricante_id=22&modelo_id=0
[Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174]
SystemError: Objects/stringobject.c:3515: bad argument to internal
function, referer:
http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fabricante_id=22&modelo_id=0

The second is more frequent:

[Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196] mod_python
(pid=326, interpreter='example.com', phase='PythonHandler',
handler='/home/carroarodo/mod/_publisher.py'): Application error,
referer: http://example.com/
[Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196] ServerName:
'example.com', referer: http://example.com/
[Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196] DocumentRoot:
'/var/www/html/example.com', referer: http://example.com/
[Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196] URI:
'/_pesquisa', referer: http://example.com/
[Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196] Location:
None, referer: http://example.com/
[Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196] Directory:
'/var/www/html/example.com/', referer: http://example.com/
[Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196] Filename:
'/var/www/html/example.com/_pesquisa.py', referer: http://example.com/
[Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196] PathInfo: '',
referer: http://example.com/
[Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196] Traceback
(most recent call last):, referer: http://example.com/
[Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196]   File
"/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
1537, in HandlerDispatch\n    default=default_handler, arg=req,
silent=hlist.silent), referer: http://example.com/
[Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196]   File
"/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
1229, in _process_target\n    result = _execute_target(config, req,
object, arg), referer: http://example.com/
[Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196]   File
"/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
1128, in _execute_target\n    result = object(arg), referer:
http://example.com/
[Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196]   File
"/home/carroarodo/mod/_publisher.py", line 5, in handler\n    return
publisher.handler(req), referer: http://example.com/
[Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196]   File
"/usr/lib64/python2.4/site-packages/mod_python/publisher.py", line
213, in handler\n    published = publish_object(req, object), referer:
http://example.com/
[Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196]   File
"/usr/lib64/python2.4/site-packages/mod_python/publisher.py", line
424, in publish_object\n    req.form = util.FieldStorage(req,
keep_blank_values=1), referer: http://example.com/
[Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196]   File
"/usr/lib64/python2.4/site-packages/mod_python/util.py", line 225, in
__init__\n    pairs = parse_qsl(req.read(clen), keep_blank_values),
referer: http://example.com/
[Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196] IOError:
Client read error (Timeout?), referer: http://example.com/

This is the access log for the above error:

201.32.1.196 - - [05/Apr/2008:14:57:14 +0000] "POST /_pesquisa
HTTP/1.1" 200 643 "http://example.com/" "Mozilla/4.0 (compatible; MSIE
6.0; Windows NT 5.1; SV1; .NET CLR 1.1.4322)"
201.32.1.196 - - [05/Apr/2008:14:57:19 +0000] "GET
/?estado_sigla=RJ&localidade_id=0&bairro_id=0&fabricante_id=22&modelo_id=0
HTTP/1.1" 2
00 2773 "http://example.com/" "Mozilla/4.0 (compatible; MSIE 6.0;
Windows NT 5.1; SV1; .NET CLR 1.1.4322)"
201.32.1.196 - - [05/Apr/2008:14:57:21 +0000] "GET
/pub/fotos/0/a/c/0ac0b8a054571a0502f2653620544562769616d8.jpg
HTTP/1.1" 200 6801 "http
://example.com/?estado_sigla=RJ&localidade_id=0&bairro_id=0&fabricante_id=22&modelo_id=0"
"Mozilla/4.0 (compatible; MSIE 6.0; Windows
NT 5.1; SV1; .NET CLR 1.1.4322)"
201.32.1.196 - - [05/Apr/2008:14:56:19 +0000] "POST /_pesquisa
HTTP/1.1" 500 661 "http://example.com/" "Mozilla/4.0 (compatible; MSIE
6.0; Windows NT 5.1; SV1; .NET CLR 1.1.4322)"
201.32.1.196 - - [05/Apr/2008:14:57:57 +0000] "GET
/ce?i=934&h=sLH2ndocEZ_8EoGtvtsnNA HTTP/1.1" 200 1113 "-" "Mozilla/4.0
(compatible; MS
IE 6.0; Windows NT 5.1; SV1; .NET CLR 1.1.4322)"
201.32.1.196 - - [05/Apr/2008:14:58:01 +0000] "GET /login HTTP/1.1"
200 1499 "http://example.com/ce?i=934&h=sLP2ndot1Z_8EoGtvtsnNA" "M
ozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; .NET CLR 1.1.4322)"


And the third is quite strange:

[Sat Apr 05 20:58:11 2008] [error] [client 189.69.253.187] PathInfo:
'', referer: http://example.com/login
[Sat Apr 05 20:58:11 2008] [error] [client 189.69.253.187] Traceback
(most recent call last):, referer: http://example.com/login
[Sat Apr 05 20:58:11 2008] [error] [client 189.69.253.187]   File
"/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
1537, in HandlerDispatch\n    default=default_handler, arg=req,
silent=hlist.silent), referer: http://example.com/login
[Sat Apr 05 20:58:11 2008] [error] [client 189.69.253.187]   File
"/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
1229, in _process_target\n    result = _execute_target(config, req,
object, arg), referer: http://example.com/login
[Sat Apr 05 20:58:11 2008] [error] [client 189.69.253.187]   File
"/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
1128, in _execute_target\n    result = object(arg), referer:
http://example.com/login
[Sat Apr 05 20:58:11 2008] [error] [client 189.69.253.187]   File
"/home/carroarodo/mod/_publisher.py", line 5, in handler\n    return
publisher.handler(req), referer: http://example.com/login
[Sat Apr 05 20:58:11 2008] [error] [client 189.69.253.187]   File
"/usr/lib64/python2.4/site-packages/mod_python/publisher.py", line
213, in handler\n    published = publish_object(req, object), referer:
http://example.com/login
[Sat Apr 05 20:58:11 2008] [error] [client 189.69.253.187]   File
"/usr/lib64/python2.4/site-packages/mod_python/publisher.py", line
425, in publish_object\n    return
publish_object(req,util.apply_fs_data(object, req.form, req=req)),
referer: http://example.com/login
[Sat Apr 05 20:58:11 2008] [error] [client 189.69.253.187]   File
"/usr/lib64/python2.4/site-packages/mod_python/util.py", line 554, in
apply_fs_data\n    return object(**args), referer:
http://example.com/login
[Sat Apr 05 20:58:11 2008] [error] [client 189.69.253.187]   File
"/var/www/html/example.com/login.py", line 52, in index\n
_d['mensagem'] += \\, referer: http://example.com/login
[Sat Apr 05 20:58:11 2008] [error] [client 189.69.253.187] TypeError:
unsupported operand type(s) for +=: 'NoneType' and 'str', referer:
http://example.com/login

Access log:
189.27.86.85 - - [05/Apr/2008:20:58:08 +0000] "GET / HTTP/1.1" 200
5739 "http://example.com/" "Mozilla/4.0 (compatible; MSIE 6.0; Windows
NT 5.1; SV1; Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1) ;
FDM; .NET CLR 1.1.4322; .NET CLR 2.0.50727; .NET CLR 3.0.04506.648;
.NET CLR 3.5.21022)"

The line it complains about is this:

               _d['mensagem'] += \
                  '<br><br>Voc? j? leu o email enviado para %s ?'\

This line always work except in the above ocasion.

Regards, Clodoaldo Pinto Neto

From clodoaldo.pinto.neto at gmail.com  Sat Apr  5 20:52:56 2008
From: clodoaldo.pinto.neto at gmail.com (Clodoaldo)
Date: Sat Apr  5 20:52:59 2008
Subject: [mod_python] Re: mod_python errors
In-Reply-To: <a595de7a0804051605u59b528fcj90f1f2eb3ff4be90@mail.gmail.com>
References: <a595de7a0804051605u59b528fcj90f1f2eb3ff4be90@mail.gmail.com>
Message-ID: <a595de7a0804051752g23244995p9464db2bcbd8cc0f@mail.gmail.com>

2008/4/5, Clodoaldo <clodoaldo.pinto.neto@gmail.com>:
> Three errors have been happening in an application using mod_python.
>
>  Configuration:
>  Fedora Core 6. This server does not have mod_wsgi installed.
>  # uname -a
>  Linux myserver.net 2.6.22.14-72.fc6 #1 SMP Wed Nov 21 14:10:25 EST
>  2007 x86_64 x86_64 x86_64 GNU/Linux
>
>  Python 2.4.4
>  # ldd /usr/lib64/libpython2.4.so
>         libpthread.so.0 => /lib64/libpthread.so.0 (0x0000003751e00000)
>         libdl.so.2 => /lib64/libdl.so.2 (0x00000032d1000000)
>         libutil.so.1 => /lib64/libutil.so.1 (0x00000032d8800000)
>         libm.so.6 => /lib64/libm.so.6 (0x00000032d1400000)
>         libc.so.6 => /lib64/libc.so.6 (0x00000032d0c00000)
>         /lib64/ld-linux-x86-64.so.2 (0x0000555555554000)
>
>  mod_python 3.3.0b
>  # ldd /usr/lib64/httpd/modules/mod_python.so
>         libpthread.so.0 => /lib64/libpthread.so.0 (0x00002aaaaae07000)
>         libdl.so.2 => /lib64/libdl.so.2 (0x00002aaaab021000)
>         libutil.so.1 => /lib64/libutil.so.1 (0x00002aaaab225000)
>         libm.so.6 => /lib64/libm.so.6 (0x00002aaaab429000)
>         libc.so.6 => /lib64/libc.so.6 (0x00002aaaab6ac000)
>         /lib64/ld-linux-x86-64.so.2 (0x0000555555554000)
>
>  [Sat Apr 05 01:32:13 2008] [notice] Digest: generating secret for
>  digest authentication ...
>  [Sat Apr 05 01:32:13 2008] [notice] Digest: done
>  [Sat Apr 05 01:32:13 2008] [notice] mod_python: Creating 8 session
>  mutexes based on 256 max processes and 0 max threads.
>  [Sat Apr 05 01:32:13 2008] [notice] mod_python: using mutex_directory /tmp
>  [Sat Apr 05 01:32:13 2008] [notice] Apache/2.2.6 (Unix) DAV/2
>  PHP/5.1.6 mod_python/3.3.0b Python/2.4.4 mod_ssl/2.2.6 OpenSSL/0.9.8b
>  mod_perl/2.0.2 Perl/v5.8.8 configured -- resuming normal operations
>
>  # httpd -V
>  Server version: Apache/2.2.6 (Unix)
>  Server built:   Sep 18 2007 11:25:59
>  Server's Module Magic Number: 20051115:5
>  Server loaded:  APR 1.2.7, APR-Util 1.2.8
>  Compiled using: APR 1.2.7, APR-Util 1.2.8
>  Architecture:   64-bit
>  Server MPM:     Prefork
>   threaded:     no
>     forked:     yes (variable process count)
>  Server compiled with....
>   -D APACHE_MPM_DIR="server/mpm/prefork"
>   -D APR_HAS_SENDFILE
>   -D APR_HAS_MMAP
>   -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)
>   -D APR_USE_SYSVSEM_SERIALIZE
>   -D APR_USE_PTHREAD_SERIALIZE
>   -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT
>   -D APR_HAS_OTHER_CHILD
>   -D AP_HAVE_RELIABLE_PIPED_LOGS
>   -D DYNAMIC_MODULE_LIMIT=128
>   -D HTTPD_ROOT="/etc/httpd"
>   -D SUEXEC_BIN="/usr/sbin/suexec"
>   -D DEFAULT_PIDLOG="logs/httpd.pid"
>   -D DEFAULT_SCOREBOARD="logs/apache_runtime_status"
>   -D DEFAULT_LOCKFILE="logs/accept.lock"
>   -D DEFAULT_ERRORLOG="logs/error_log"
>   -D AP_TYPES_CONFIG_FILE="conf/mime.types"
>   -D SERVER_CONFIG_FILE="conf/httpd.conf"
>
>  The first error is already described in this thread:
>  http://www.modpython.org/pipermail/mod_python/2007-June/023795.html
>
>  It is also commented in these threads:
>  http://groups.google.co.uk/group/webpy/browse_thread/thread/4c5f2c76b749eb4e
>  http://bytes.com/forum/thread40318.html
>
>  [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174]
>  ServerName: 'example.com', referer:
>  http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fabricante_id=22&modelo_id=0
>  [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174]
>  DocumentRoot: '/var/www/html/example.com', referer:
>  http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fabricante_id=22&modelo_id=0
>  [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174] URI:
>  '/_pesquisa', referer:
>  http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fabricante_id=22&modelo_id=0
>  [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174] Location:
>  None, referer: http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fabricante_id=22&modelo_id=0
>  [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174] Directory:
>  '/var/www/html/example.com/', referer:
>  http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fabricante_id=22&modelo_id=0
>  [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174] Filename:
>  '/var/www/html/example.com/_pesquisa.py', referer:
>  http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fabricante_id=22&modelo_id=0
>  [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174] PathInfo:
>  '', referer: http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fabricante_id=22&modelo_id=0
>  [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174] Traceback
>  (most recent call last):, referer:
>  http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fabricante_id=22&modelo_id=0
>  [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174]   File
>  "/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
>  1537, in HandlerDispatch\n    default=default_handler, arg=req,
>  silent=hlist.silent), referer:
>  http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fabricante_id=22&modelo_id=0
>  [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174]   File
>  "/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
>  1229, in _process_target\n    result = _execute_target(config, req,
>  object, arg), referer:
>  http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fabricante_id=22&modelo_id=0
>  [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174]   File
>  "/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
>  1128, in _execute_target\n    result = object(arg), referer:
>  http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fabricante_id=22&modelo_id=0
>  [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174]   File
>  "/home/carroarodo/mod/_publisher.py", line 5, in handler\n    return
>  publisher.handler(req), referer:
>  http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fabricante_id=22&modelo_id=0
>  [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174]   File
>  "/usr/lib64/python2.4/site-packages/mod_python/publisher.py", line
>  213, in handler\n    published = publish_object(req, object), referer:
>  http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fabricante_id=22&modelo_id=0
>  [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174]   File
>  "/usr/lib64/python2.4/site-packages/mod_python/publisher.py", line
>  424, in publish_object\n    req.form = util.FieldStorage(req,
>  keep_blank_values=1), referer:
>  http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fabricante_id=22&modelo_id=0
>  [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174]   File
>  "/usr/lib64/python2.4/site-packages/mod_python/util.py", line 225, in
>  __init__\n    pairs = parse_qsl(req.read(clen), keep_blank_values),
>  referer: http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fabricante_id=22&modelo_id=0
>  [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174]
>  SystemError: Objects/stringobject.c:3515: bad argument to internal
>  function, referer:
>  http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fabricante_id=22&modelo_id=0
>
>  The second is more frequent:
>
>  [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196] mod_python
>  (pid=326, interpreter='example.com', phase='PythonHandler',
>  handler='/home/carroarodo/mod/_publisher.py'): Application error,
>  referer: http://example.com/
>  [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196] ServerName:
>  'example.com', referer: http://example.com/
>  [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196] DocumentRoot:
>  '/var/www/html/example.com', referer: http://example.com/
>  [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196] URI:
>  '/_pesquisa', referer: http://example.com/
>  [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196] Location:
>  None, referer: http://example.com/
>  [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196] Directory:
>  '/var/www/html/example.com/', referer: http://example.com/
>  [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196] Filename:
>  '/var/www/html/example.com/_pesquisa.py', referer: http://example.com/
>  [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196] PathInfo: '',
>  referer: http://example.com/
>  [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196] Traceback
>  (most recent call last):, referer: http://example.com/
>  [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196]   File
>  "/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
>  1537, in HandlerDispatch\n    default=default_handler, arg=req,
>  silent=hlist.silent), referer: http://example.com/
>  [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196]   File
>  "/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
>  1229, in _process_target\n    result = _execute_target(config, req,
>  object, arg), referer: http://example.com/
>  [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196]   File
>  "/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
>  1128, in _execute_target\n    result = object(arg), referer:
>  http://example.com/
>  [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196]   File
>  "/home/carroarodo/mod/_publisher.py", line 5, in handler\n    return
>  publisher.handler(req), referer: http://example.com/
>  [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196]   File
>  "/usr/lib64/python2.4/site-packages/mod_python/publisher.py", line
>  213, in handler\n    published = publish_object(req, object), referer:
>  http://example.com/
>  [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196]   File
>  "/usr/lib64/python2.4/site-packages/mod_python/publisher.py", line
>  424, in publish_object\n    req.form = util.FieldStorage(req,
>  keep_blank_values=1), referer: http://example.com/
>  [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196]   File
>  "/usr/lib64/python2.4/site-packages/mod_python/util.py", line 225, in
>  __init__\n    pairs = parse_qsl(req.read(clen), keep_blank_values),
>  referer: http://example.com/
>  [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196] IOError:
>  Client read error (Timeout?), referer: http://example.com/
>
>  This is the access log for the above error:
>
>  201.32.1.196 - - [05/Apr/2008:14:57:14 +0000] "POST /_pesquisa
>  HTTP/1.1" 200 643 "http://example.com/" "Mozilla/4.0 (compatible; MSIE
>  6.0; Windows NT 5.1; SV1; .NET CLR 1.1.4322)"
>  201.32.1.196 - - [05/Apr/2008:14:57:19 +0000] "GET
>  /?estado_sigla=RJ&localidade_id=0&bairro_id=0&fabricante_id=22&modelo_id=0
>  HTTP/1.1" 2
>  00 2773 "http://example.com/" "Mozilla/4.0 (compatible; MSIE 6.0;
>  Windows NT 5.1; SV1; .NET CLR 1.1.4322)"
>  201.32.1.196 - - [05/Apr/2008:14:57:21 +0000] "GET
>  /pub/fotos/0/a/c/0ac0b8a054571a0502f2653620544562769616d8.jpg
>  HTTP/1.1" 200 6801 "http
>  ://example.com/?estado_sigla=RJ&localidade_id=0&bairro_id=0&fabricante_id=22&modelo_id=0"
>  "Mozilla/4.0 (compatible; MSIE 6.0; Windows
>  NT 5.1; SV1; .NET CLR 1.1.4322)"
>  201.32.1.196 - - [05/Apr/2008:14:56:19 +0000] "POST /_pesquisa
>  HTTP/1.1" 500 661 "http://example.com/" "Mozilla/4.0 (compatible; MSIE
>  6.0; Windows NT 5.1; SV1; .NET CLR 1.1.4322)"
>  201.32.1.196 - - [05/Apr/2008:14:57:57 +0000] "GET
>  /ce?i=934&h=sLH2ndocEZ_8EoGtvtsnNA HTTP/1.1" 200 1113 "-" "Mozilla/4.0
>  (compatible; MS
>  IE 6.0; Windows NT 5.1; SV1; .NET CLR 1.1.4322)"
>  201.32.1.196 - - [05/Apr/2008:14:58:01 +0000] "GET /login HTTP/1.1"
>  200 1499 "http://example.com/ce?i=934&h=sLP2ndot1Z_8EoGtvtsnNA" "M
>  ozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; .NET CLR 1.1.4322)"
>
>
>  And the third is quite strange:
>
>  [Sat Apr 05 20:58:11 2008] [error] [client 189.69.253.187] PathInfo:
>  '', referer: http://example.com/login
>  [Sat Apr 05 20:58:11 2008] [error] [client 189.69.253.187] Traceback
>  (most recent call last):, referer: http://example.com/login
>  [Sat Apr 05 20:58:11 2008] [error] [client 189.69.253.187]   File
>  "/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
>  1537, in HandlerDispatch\n    default=default_handler, arg=req,
>  silent=hlist.silent), referer: http://example.com/login
>  [Sat Apr 05 20:58:11 2008] [error] [client 189.69.253.187]   File
>  "/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
>  1229, in _process_target\n    result = _execute_target(config, req,
>  object, arg), referer: http://example.com/login
>  [Sat Apr 05 20:58:11 2008] [error] [client 189.69.253.187]   File
>  "/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
>  1128, in _execute_target\n    result = object(arg), referer:
>  http://example.com/login
>  [Sat Apr 05 20:58:11 2008] [error] [client 189.69.253.187]   File
>  "/home/carroarodo/mod/_publisher.py", line 5, in handler\n    return
>  publisher.handler(req), referer: http://example.com/login
>  [Sat Apr 05 20:58:11 2008] [error] [client 189.69.253.187]   File
>  "/usr/lib64/python2.4/site-packages/mod_python/publisher.py", line
>  213, in handler\n    published = publish_object(req, object), referer:
>  http://example.com/login
>  [Sat Apr 05 20:58:11 2008] [error] [client 189.69.253.187]   File
>  "/usr/lib64/python2.4/site-packages/mod_python/publisher.py", line
>  425, in publish_object\n    return
>  publish_object(req,util.apply_fs_data(object, req.form, req=req)),
>  referer: http://example.com/login
>  [Sat Apr 05 20:58:11 2008] [error] [client 189.69.253.187]   File
>  "/usr/lib64/python2.4/site-packages/mod_python/util.py", line 554, in
>  apply_fs_data\n    return object(**args), referer:
>  http://example.com/login
>  [Sat Apr 05 20:58:11 2008] [error] [client 189.69.253.187]   File
>  "/var/www/html/example.com/login.py", line 52, in index\n
>  _d['mensagem'] += \\, referer: http://example.com/login
>  [Sat Apr 05 20:58:11 2008] [error] [client 189.69.253.187] TypeError:
>  unsupported operand type(s) for +=: 'NoneType' and 'str', referer:
>  http://example.com/login
>
>  Access log:
>  189.27.86.85 - - [05/Apr/2008:20:58:08 +0000] "GET / HTTP/1.1" 200
>  5739 "http://example.com/" "Mozilla/4.0 (compatible; MSIE 6.0; Windows
>  NT 5.1; SV1; Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1) ;
>  FDM; .NET CLR 1.1.4322; .NET CLR 2.0.50727; .NET CLR 3.0.04506.648;
>  .NET CLR 3.5.21022)"
>
>  The line it complains about is this:
>
>                _d['mensagem'] += \
>                   '<br><br>Voc? j? leu o email enviado para %s ?'\
>
>  This line always work except in the above ocasion.

This last one was a subtle bug of mine.

Regards, Clodoaldo

From graham.dumpleton at gmail.com  Sat Apr  5 21:35:14 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sat Apr  5 21:35:16 2008
Subject: [mod_python] mod_python errors
In-Reply-To: <a595de7a0804051605u59b528fcj90f1f2eb3ff4be90@mail.gmail.com>
References: <a595de7a0804051605u59b528fcj90f1f2eb3ff4be90@mail.gmail.com>
Message-ID: <88e286470804051835w7950e3d2wb1cc8403eb9c9833@mail.gmail.com>

See comments below.

2008/4/6 Clodoaldo <clodoaldo.pinto.neto@gmail.com>:
> Three errors have been happening in an application using mod_python.
>
>  Configuration:
>  Fedora Core 6. This server does not have mod_wsgi installed.
>  # uname -a
>  Linux myserver.net 2.6.22.14-72.fc6 #1 SMP Wed Nov 21 14:10:25 EST
>  2007 x86_64 x86_64 x86_64 GNU/Linux
>
>  Python 2.4.4
>  # ldd /usr/lib64/libpython2.4.so
>         libpthread.so.0 => /lib64/libpthread.so.0 (0x0000003751e00000)
>         libdl.so.2 => /lib64/libdl.so.2 (0x00000032d1000000)
>         libutil.so.1 => /lib64/libutil.so.1 (0x00000032d8800000)
>         libm.so.6 => /lib64/libm.so.6 (0x00000032d1400000)
>         libc.so.6 => /lib64/libc.so.6 (0x00000032d0c00000)
>         /lib64/ld-linux-x86-64.so.2 (0x0000555555554000)
>
>  mod_python 3.3.0b
>  # ldd /usr/lib64/httpd/modules/mod_python.so
>         libpthread.so.0 => /lib64/libpthread.so.0 (0x00002aaaaae07000)
>         libdl.so.2 => /lib64/libdl.so.2 (0x00002aaaab021000)
>         libutil.so.1 => /lib64/libutil.so.1 (0x00002aaaab225000)
>         libm.so.6 => /lib64/libm.so.6 (0x00002aaaab429000)
>         libc.so.6 => /lib64/libc.so.6 (0x00002aaaab6ac000)
>         /lib64/ld-linux-x86-64.so.2 (0x0000555555554000)
>
>  [Sat Apr 05 01:32:13 2008] [notice] Digest: generating secret for
>  digest authentication ...
>  [Sat Apr 05 01:32:13 2008] [notice] Digest: done
>  [Sat Apr 05 01:32:13 2008] [notice] mod_python: Creating 8 session
>  mutexes based on 256 max processes and 0 max threads.
>  [Sat Apr 05 01:32:13 2008] [notice] mod_python: using mutex_directory /tmp
>  [Sat Apr 05 01:32:13 2008] [notice] Apache/2.2.6 (Unix) DAV/2
>  PHP/5.1.6 mod_python/3.3.0b Python/2.4.4 mod_ssl/2.2.6 OpenSSL/0.9.8b
>  mod_perl/2.0.2 Perl/v5.8.8 configured -- resuming normal operations
>
>  # httpd -V
>  Server version: Apache/2.2.6 (Unix)
>  Server built:   Sep 18 2007 11:25:59
>  Server's Module Magic Number: 20051115:5
>  Server loaded:  APR 1.2.7, APR-Util 1.2.8
>  Compiled using: APR 1.2.7, APR-Util 1.2.8
>  Architecture:   64-bit
>  Server MPM:     Prefork
>   threaded:     no
>     forked:     yes (variable process count)
>  Server compiled with....
>   -D APACHE_MPM_DIR="server/mpm/prefork"
>   -D APR_HAS_SENDFILE
>   -D APR_HAS_MMAP
>   -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)
>   -D APR_USE_SYSVSEM_SERIALIZE
>   -D APR_USE_PTHREAD_SERIALIZE
>   -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT
>   -D APR_HAS_OTHER_CHILD
>   -D AP_HAVE_RELIABLE_PIPED_LOGS
>   -D DYNAMIC_MODULE_LIMIT=128
>   -D HTTPD_ROOT="/etc/httpd"
>   -D SUEXEC_BIN="/usr/sbin/suexec"
>   -D DEFAULT_PIDLOG="logs/httpd.pid"
>   -D DEFAULT_SCOREBOARD="logs/apache_runtime_status"
>   -D DEFAULT_LOCKFILE="logs/accept.lock"
>   -D DEFAULT_ERRORLOG="logs/error_log"
>   -D AP_TYPES_CONFIG_FILE="conf/mime.types"
>   -D SERVER_CONFIG_FILE="conf/httpd.conf"
>
>  The first error is already described in this thread:
>  http://www.modpython.org/pipermail/mod_python/2007-June/023795.html
>
>  It is also commented in these threads:
>  http://groups.google.co.uk/group/webpy/browse_thread/thread/4c5f2c76b749eb4e
>  http://bytes.com/forum/thread40318.html
>
>  [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174]
>  ServerName: 'example.com', referer:
>  http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fabricante_id=22&modelo_id=0
>  [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174]
>  DocumentRoot: '/var/www/html/example.com', referer:
>  http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fabricante_id=22&modelo_id=0
>  [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174] URI:
>  '/_pesquisa', referer:
>  http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fabricante_id=22&modelo_id=0
>  [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174] Location:
>  None, referer: http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fabricante_id=22&modelo_id=0
>  [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174] Directory:
>  '/var/www/html/example.com/', referer:
>  http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fabricante_id=22&modelo_id=0
>  [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174] Filename:
>  '/var/www/html/example.com/_pesquisa.py', referer:
>  http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fabricante_id=22&modelo_id=0
>  [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174] PathInfo:
>  '', referer: http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fabricante_id=22&modelo_id=0
>  [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174] Traceback
>  (most recent call last):, referer:
>  http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fabricante_id=22&modelo_id=0
>  [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174]   File
>  "/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
>  1537, in HandlerDispatch\n    default=default_handler, arg=req,
>  silent=hlist.silent), referer:
>  http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fabricante_id=22&modelo_id=0
>  [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174]   File
>  "/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
>  1229, in _process_target\n    result = _execute_target(config, req,
>  object, arg), referer:
>  http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fabricante_id=22&modelo_id=0
>  [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174]   File
>  "/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
>  1128, in _execute_target\n    result = object(arg), referer:
>  http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fabricante_id=22&modelo_id=0
>  [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174]   File
>  "/home/carroarodo/mod/_publisher.py", line 5, in handler\n    return
>  publisher.handler(req), referer:
>  http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fabricante_id=22&modelo_id=0
>  [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174]   File
>  "/usr/lib64/python2.4/site-packages/mod_python/publisher.py", line
>  213, in handler\n    published = publish_object(req, object), referer:
>  http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fabricante_id=22&modelo_id=0
>  [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174]   File
>  "/usr/lib64/python2.4/site-packages/mod_python/publisher.py", line
>  424, in publish_object\n    req.form = util.FieldStorage(req,
>  keep_blank_values=1), referer:
>  http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fabricante_id=22&modelo_id=0
>  [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174]   File
>  "/usr/lib64/python2.4/site-packages/mod_python/util.py", line 225, in
>  __init__\n    pairs = parse_qsl(req.read(clen), keep_blank_values),
>  referer: http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fabricante_id=22&modelo_id=0
>  [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174]
>  SystemError: Objects/stringobject.c:3515: bad argument to internal
>  function, referer:
>  http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fabricante_id=22&modelo_id=0

Bug deep in mod_python, exact cause unknown and pretty well impossible
to reproduce reliably. See:

  http://issues.apache.org/jira/browse/MODPYTHON-234

>  The second is more frequent:
>
>  [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196] mod_python
>  (pid=326, interpreter='example.com', phase='PythonHandler',
>  handler='/home/carroarodo/mod/_publisher.py'): Application error,
>  referer: http://example.com/
>  [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196] ServerName:
>  'example.com', referer: http://example.com/
>  [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196] DocumentRoot:
>  '/var/www/html/example.com', referer: http://example.com/
>  [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196] URI:
>  '/_pesquisa', referer: http://example.com/
>  [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196] Location:
>  None, referer: http://example.com/
>  [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196] Directory:
>  '/var/www/html/example.com/', referer: http://example.com/
>  [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196] Filename:
>  '/var/www/html/example.com/_pesquisa.py', referer: http://example.com/
>  [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196] PathInfo: '',
>  referer: http://example.com/
>  [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196] Traceback
>  (most recent call last):, referer: http://example.com/
>  [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196]   File
>  "/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
>  1537, in HandlerDispatch\n    default=default_handler, arg=req,
>  silent=hlist.silent), referer: http://example.com/
>  [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196]   File
>  "/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
>  1229, in _process_target\n    result = _execute_target(config, req,
>  object, arg), referer: http://example.com/
>  [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196]   File
>  "/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
>  1128, in _execute_target\n    result = object(arg), referer:
>  http://example.com/
>  [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196]   File
>  "/home/carroarodo/mod/_publisher.py", line 5, in handler\n    return
>  publisher.handler(req), referer: http://example.com/
>  [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196]   File
>  "/usr/lib64/python2.4/site-packages/mod_python/publisher.py", line
>  213, in handler\n    published = publish_object(req, object), referer:
>  http://example.com/
>  [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196]   File
>  "/usr/lib64/python2.4/site-packages/mod_python/publisher.py", line
>  424, in publish_object\n    req.form = util.FieldStorage(req,
>  keep_blank_values=1), referer: http://example.com/
>  [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196]   File
>  "/usr/lib64/python2.4/site-packages/mod_python/util.py", line 225, in
>  __init__\n    pairs = parse_qsl(req.read(clen), keep_blank_values),
>  referer: http://example.com/
>  [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196] IOError:
>  Client read error (Timeout?), referer: http://example.com/

Most likely because browser closed socket connection before all data
transmitted. Ie., they pressed reload button before page done.

Graham
From graham.dumpleton at gmail.com  Sat Apr  5 21:36:23 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sat Apr  5 21:36:26 2008
Subject: [mod_python] Installing mod_python with Apache 2.2 /Python 2.5
In-Reply-To: <ea09b3700804041942i4621a01btf54c7167b4de39c7@mail.gmail.com>
References: <ea09b3700804041942i4621a01btf54c7167b4de39c7@mail.gmail.com>
Message-ID: <88e286470804051836h614a2c34ub66b61a6ad34dea1@mail.gmail.com>

Go read:

  http://www.dscpl.com.au/wiki/ModPython/Articles/GettingModPythonWorking

In short, your Apache configuration is wrong. Get the example in that
documentation working and then go from there.

Graham

2008/4/5 A. Joseph <joefazee@gmail.com>:
>
>
> Please can I get a link to the necessary file?  I have been trying
> everything but if I load the .py file it will show the source code on the
> browser window.
>
>
>
> Help
> _______________________________________________
>  Mod_python mailing list
>  Mod_python@modpython.org
>  http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
From graham.dumpleton at gmail.com  Sun Apr  6 03:09:06 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sun Apr  6 03:09:09 2008
Subject: [mod_python] old libexpat shared library
In-Reply-To: <8608ca750804050345m64c42592nd796e8d20f75d560@mail.gmail.com>
References: <8608ca750804050345m64c42592nd796e8d20f75d560@mail.gmail.com>
Message-ID: <88e286470804060009x5852c5cbqc204891cc3c4b61a@mail.gmail.com>

2008/4/5 Luyi Chen <lychen1109@gmail.com>:
> Hi,
>
>  I am trying to make mod_python working on Apache 2.2.6, ubuntu dapper
>  6.06. But I was hit by the problem of wrong expat library issue, as
>  stated by Graham Dumpleton, on this page
>  http://www.dscpl.com.au/wiki/ModPython/Articles/ExpatCausingApacheCrash
>
>  I am using a custom compiled Apache2 in /usr/local/apache2, so I
>  checked version of libexpat with the following line,
>
>  ldd /usr/local/apache2/bin/httpd
>
>  in the result there're two lines
>   libexpat.so.0 => /usr/local/apache2/lib/libexpat.so.0 (0x00002b4f4e1c5000)
>   libexpat.so.1 => /usr/lib/libexpat.so.1 (0x00002b4f4e2e7000)

If you have this, then something is quite broken with your Apache
httpd to start with, before even mod_python is loaded.

What is the full 'ldd' output from running it against 'httpd'.

Also go through each of the .so file it is dependent upon and run
'ldd' on them as well and post all the results.

As far as I can tell, one of the .so files depended on by httpd is
itself dependent on libexpat (a different version), as I can't see
otherwise how you can get an executable dependent on two different
versions of a shared library.

Graham

>  The one in /usr/local/apache2/lib is an old version 1.95.2, while the
>  one in /usr/lib is 1.95.8, which is identical to the version of
>  libexpat used by python.
>
>  How do I tell Apache to use the new version of libexpat only?
>
>  Luyi
>  _______________________________________________
>  Mod_python mailing list
>  Mod_python@modpython.org
>  http://mailman.modpython.org/mailman/listinfo/mod_python
>
From lychen1109 at gmail.com  Sun Apr  6 04:37:10 2008
From: lychen1109 at gmail.com (Luyi Chen)
Date: Sun Apr  6 04:37:13 2008
Subject: [mod_python] old libexpat shared library
In-Reply-To: <88e286470804060009x5852c5cbqc204891cc3c4b61a@mail.gmail.com>
References: <8608ca750804050345m64c42592nd796e8d20f75d560@mail.gmail.com>
	<88e286470804060009x5852c5cbqc204891cc3c4b61a@mail.gmail.com>
Message-ID: <8608ca750804060137h15b3a27dje0b01f027ec48300@mail.gmail.com>

Thanks Graham,

Here's the info:

$ ldd /usr/local/apache2/bin/httpd
        libz.so.1 => /usr/lib/libz.so.1 (0x00002b02938de000)
        libm.so.6 => /lib/libm.so.6 (0x00002b02939f4000)
        libaprutil-1.so.0 => /usr/local/apache2/lib/libaprutil-1.so.0
(0x00002b0293b79000)
        libexpat.so.0 => /usr/local/apache2/lib/libexpat.so.0
(0x00002b0293c91000)
        libexpat.so.1 => /usr/lib/libexpat.so.1 (0x00002b0293db3000)
        libapr-1.so.0 => /usr/local/apache2/lib/libapr-1.so.0
(0x00002b0293ed6000)
        librt.so.1 => /lib/librt.so.1 (0x00002b0293ffe000)
        libcrypt.so.1 => /lib/libcrypt.so.1 (0x00002b0294107000)
        libpthread.so.0 => /lib/libpthread.so.0 (0x00002b029423a000)
        libdl.so.2 => /lib/libdl.so.2 (0x00002b029434f000)
        libc.so.6 => /lib/libc.so.6 (0x00002b0294452000)
        /lib64/ld-linux-x86-64.so.2 (0x00002b02937c7000)
$ ldd /usr/lib/libz.so.1
        libc.so.6 => /lib/libc.so.6 (0x00002b2764dc5000)
        /lib64/ld-linux-x86-64.so.2 (0x0000555555554000)
$ ldd /lib/libm.so.6
        libc.so.6 => /lib/libc.so.6 (0x00002b8bf9a3c000)
        /lib/ld-linux-x86-64.so.2 => /lib64/ld-linux-x86-64.so.2
(0x0000555555554000)
$ ldd /usr/local/apache2/lib/libaprutil-1.so.0
        libexpat.so.0 => /usr/local/apache2/lib/libexpat.so.0
(0x00002b61001d0000)
        libapr-1.so.0 => /usr/local/apache2/lib/libapr-1.so.0
(0x00002b61002f2000)
        librt.so.1 => /lib/librt.so.1 (0x00002b610041e000)
        libcrypt.so.1 => /lib/libcrypt.so.1 (0x00002b6100526000)
        libpthread.so.0 => /lib/libpthread.so.0 (0x00002b610065a000)
        libdl.so.2 => /lib/libdl.so.2 (0x00002b610076f000)
        libc.so.6 => /lib/libc.so.6 (0x00002b6100871000)
        /lib64/ld-linux-x86-64.so.2 (0x0000555555554000)
$ ldd /usr/local/apache2/lib/libexpat.so.0
        libc.so.6 => /lib/libc.so.6 (0x00002af851439000)
        /lib64/ld-linux-x86-64.so.2 (0x0000555555554000)
$ ldd /usr/lib/libexpat.so.1
        libc.so.6 => /lib/libc.so.6 (0x00002b96d0162000)
        /lib64/ld-linux-x86-64.so.2 (0x0000555555554000)
$ ldd /usr/local/apache2/lib/libapr-1.so.0
        librt.so.1 => /lib/librt.so.1 (0x00002ba649f41000)
        libcrypt.so.1 => /lib/libcrypt.so.1 (0x00002ba64a04a000)
        libpthread.so.0 => /lib/libpthread.so.0 (0x00002ba64a17d000)
        libdl.so.2 => /lib/libdl.so.2 (0x00002ba64a292000)
        libc.so.6 => /lib/libc.so.6 (0x00002ba64a395000)
        /lib64/ld-linux-x86-64.so.2 (0x0000555555554000)
$ ldd /lib/librt.so.1
        libc.so.6 => /lib/libc.so.6 (0x00002aab3a499000)
        libpthread.so.0 => /lib/libpthread.so.0 (0x00002aab3a6d3000)
        /lib/ld-linux-x86-64.so.2 => /lib64/ld-linux-x86-64.so.2
(0x0000555555554000)
$ ldd /lib/libcrypt.so.1
        libc.so.6 => /lib/libc.so.6 (0x00002ae20b9dd000)
        /lib/ld-linux-x86-64.so.2 => /lib64/ld-linux-x86-64.so.2
(0x0000555555554000)
$ ldd /lib/libpthread.so.0
        libc.so.6 => /lib/libc.so.6 (0x00002b15ada6d000)
        /lib/ld-linux-x86-64.so.2 => /lib64/ld-linux-x86-64.so.2
(0x0000555555554000)
$ ldd /lib/libdl.so.2
        libc.so.6 => /lib/libc.so.6 (0x00002b4f78de5000)
        /lib/ld-linux-x86-64.so.2 => /lib64/ld-linux-x86-64.so.2
(0x0000555555554000)
$ ldd /lib/libc.so.6
        /lib/ld-linux-x86-64.so.2 (0x00002b7744489000)

My own analysis is that apr-util depends on the old version of
libexpat. So I checked Apache installation doc, and found that I can
use --with-included-apr to force Apache use the bundled apr. Since my
os (Ubuntu 6.06) is an old version, I thought this is very likely to
be the cause.

I tried to recompile Apache with the --with-included-apr option,
here's my newest config.nice
#! /bin/sh
#
# Created by configure

"./configure" \
"--prefix=/usr/local/apache2" \
"--enable-proxy" \
"--enable-proxy-http" \
"--enable-proxy-balancer" \
"--enable-dav" \
"--enable-rewrite" \
"--enable-deflate" \
"--with-included-apr" \
"$@"


But it didn't solve the problem. The above information from ldd
command is actually after I recompiled Apache, which is unchanged.

The libexpat on my OS is the latest version, because I have runned this command:
apt-get install libexpat1
And it says it's already the newest version, which is 1.95.8-3
according to the ubuntu's pachage directory.

Luyi






On Sun, Apr 6, 2008 at 3:09 PM, Graham Dumpleton
<graham.dumpleton@gmail.com> wrote:
> 2008/4/5 Luyi Chen <lychen1109@gmail.com>:
>
> > Hi,
>  >
>  >  I am trying to make mod_python working on Apache 2.2.6, ubuntu dapper
>  >  6.06. But I was hit by the problem of wrong expat library issue, as
>  >  stated by Graham Dumpleton, on this page
>  >  http://www.dscpl.com.au/wiki/ModPython/Articles/ExpatCausingApacheCrash
>  >
>  >  I am using a custom compiled Apache2 in /usr/local/apache2, so I
>  >  checked version of libexpat with the following line,
>  >
>  >  ldd /usr/local/apache2/bin/httpd
>  >
>  >  in the result there're two lines
>  >   libexpat.so.0 => /usr/local/apache2/lib/libexpat.so.0 (0x00002b4f4e1c5000)
>  >   libexpat.so.1 => /usr/lib/libexpat.so.1 (0x00002b4f4e2e7000)
>
>  If you have this, then something is quite broken with your Apache
>  httpd to start with, before even mod_python is loaded.
>
>  What is the full 'ldd' output from running it against 'httpd'.
>
>  Also go through each of the .so file it is dependent upon and run
>  'ldd' on them as well and post all the results.
>
>  As far as I can tell, one of the .so files depended on by httpd is
>  itself dependent on libexpat (a different version), as I can't see
>  otherwise how you can get an executable dependent on two different
>  versions of a shared library.
>
>  Graham
>
>
>  >  The one in /usr/local/apache2/lib is an old version 1.95.2, while the
>  >  one in /usr/lib is 1.95.8, which is identical to the version of
>  >  libexpat used by python.
>  >
>  >  How do I tell Apache to use the new version of libexpat only?
>  >
>  >  Luyi
>  >  _______________________________________________
>  >  Mod_python mailing list
>  >  Mod_python@modpython.org
>  >  http://mailman.modpython.org/mailman/listinfo/mod_python
>  >
>
From graham.dumpleton at gmail.com  Sun Apr  6 06:14:25 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sun Apr  6 06:14:28 2008
Subject: [mod_python] old libexpat shared library
In-Reply-To: <8608ca750804060137h15b3a27dje0b01f027ec48300@mail.gmail.com>
References: <8608ca750804050345m64c42592nd796e8d20f75d560@mail.gmail.com>
	<88e286470804060009x5852c5cbqc204891cc3c4b61a@mail.gmail.com>
	<8608ca750804060137h15b3a27dje0b01f027ec48300@mail.gmail.com>
Message-ID: <88e286470804060314l33d4aabdrdbde793c7ebf341a@mail.gmail.com>

Try getting the following option passed through to configure of apr-util:

  --with-expat=/usr

Can't remember if top level Apache configure will pass it through automatically.

Think that is the correct directory to give as argument.

Graham

2008/4/6 Luyi Chen <lychen1109@gmail.com>:
> Thanks Graham,
>
>  Here's the info:
>
>  $ ldd /usr/local/apache2/bin/httpd
>         libz.so.1 => /usr/lib/libz.so.1 (0x00002b02938de000)
>         libm.so.6 => /lib/libm.so.6 (0x00002b02939f4000)
>         libaprutil-1.so.0 => /usr/local/apache2/lib/libaprutil-1.so.0
>  (0x00002b0293b79000)
>
>         libexpat.so.0 => /usr/local/apache2/lib/libexpat.so.0
>  (0x00002b0293c91000)
>         libexpat.so.1 => /usr/lib/libexpat.so.1 (0x00002b0293db3000)
>         libapr-1.so.0 => /usr/local/apache2/lib/libapr-1.so.0
>  (0x00002b0293ed6000)
>         librt.so.1 => /lib/librt.so.1 (0x00002b0293ffe000)
>         libcrypt.so.1 => /lib/libcrypt.so.1 (0x00002b0294107000)
>         libpthread.so.0 => /lib/libpthread.so.0 (0x00002b029423a000)
>         libdl.so.2 => /lib/libdl.so.2 (0x00002b029434f000)
>         libc.so.6 => /lib/libc.so.6 (0x00002b0294452000)
>         /lib64/ld-linux-x86-64.so.2 (0x00002b02937c7000)
>  $ ldd /usr/lib/libz.so.1
>         libc.so.6 => /lib/libc.so.6 (0x00002b2764dc5000)
>         /lib64/ld-linux-x86-64.so.2 (0x0000555555554000)
>  $ ldd /lib/libm.so.6
>         libc.so.6 => /lib/libc.so.6 (0x00002b8bf9a3c000)
>         /lib/ld-linux-x86-64.so.2 => /lib64/ld-linux-x86-64.so.2
>  (0x0000555555554000)
>  $ ldd /usr/local/apache2/lib/libaprutil-1.so.0
>
>         libexpat.so.0 => /usr/local/apache2/lib/libexpat.so.0
>  (0x00002b61001d0000)
>         libapr-1.so.0 => /usr/local/apache2/lib/libapr-1.so.0
>  (0x00002b61002f2000)
>         librt.so.1 => /lib/librt.so.1 (0x00002b610041e000)
>         libcrypt.so.1 => /lib/libcrypt.so.1 (0x00002b6100526000)
>         libpthread.so.0 => /lib/libpthread.so.0 (0x00002b610065a000)
>         libdl.so.2 => /lib/libdl.so.2 (0x00002b610076f000)
>         libc.so.6 => /lib/libc.so.6 (0x00002b6100871000)
>         /lib64/ld-linux-x86-64.so.2 (0x0000555555554000)
>  $ ldd /usr/local/apache2/lib/libexpat.so.0
>         libc.so.6 => /lib/libc.so.6 (0x00002af851439000)
>         /lib64/ld-linux-x86-64.so.2 (0x0000555555554000)
>  $ ldd /usr/lib/libexpat.so.1
>         libc.so.6 => /lib/libc.so.6 (0x00002b96d0162000)
>         /lib64/ld-linux-x86-64.so.2 (0x0000555555554000)
>  $ ldd /usr/local/apache2/lib/libapr-1.so.0
>         librt.so.1 => /lib/librt.so.1 (0x00002ba649f41000)
>         libcrypt.so.1 => /lib/libcrypt.so.1 (0x00002ba64a04a000)
>         libpthread.so.0 => /lib/libpthread.so.0 (0x00002ba64a17d000)
>         libdl.so.2 => /lib/libdl.so.2 (0x00002ba64a292000)
>         libc.so.6 => /lib/libc.so.6 (0x00002ba64a395000)
>         /lib64/ld-linux-x86-64.so.2 (0x0000555555554000)
>  $ ldd /lib/librt.so.1
>         libc.so.6 => /lib/libc.so.6 (0x00002aab3a499000)
>         libpthread.so.0 => /lib/libpthread.so.0 (0x00002aab3a6d3000)
>         /lib/ld-linux-x86-64.so.2 => /lib64/ld-linux-x86-64.so.2
>  (0x0000555555554000)
>  $ ldd /lib/libcrypt.so.1
>         libc.so.6 => /lib/libc.so.6 (0x00002ae20b9dd000)
>         /lib/ld-linux-x86-64.so.2 => /lib64/ld-linux-x86-64.so.2
>  (0x0000555555554000)
>  $ ldd /lib/libpthread.so.0
>         libc.so.6 => /lib/libc.so.6 (0x00002b15ada6d000)
>         /lib/ld-linux-x86-64.so.2 => /lib64/ld-linux-x86-64.so.2
>  (0x0000555555554000)
>  $ ldd /lib/libdl.so.2
>         libc.so.6 => /lib/libc.so.6 (0x00002b4f78de5000)
>         /lib/ld-linux-x86-64.so.2 => /lib64/ld-linux-x86-64.so.2
>  (0x0000555555554000)
>  $ ldd /lib/libc.so.6
>         /lib/ld-linux-x86-64.so.2 (0x00002b7744489000)
>
>  My own analysis is that apr-util depends on the old version of
>  libexpat. So I checked Apache installation doc, and found that I can
>  use --with-included-apr to force Apache use the bundled apr. Since my
>  os (Ubuntu 6.06) is an old version, I thought this is very likely to
>  be the cause.
>
>  I tried to recompile Apache with the --with-included-apr option,
>  here's my newest config.nice
>  #! /bin/sh
>  #
>  # Created by configure
>
>  "./configure" \
>  "--prefix=/usr/local/apache2" \
>  "--enable-proxy" \
>  "--enable-proxy-http" \
>  "--enable-proxy-balancer" \
>  "--enable-dav" \
>  "--enable-rewrite" \
>  "--enable-deflate" \
>  "--with-included-apr" \
>  "$@"
>
>
>  But it didn't solve the problem. The above information from ldd
>  command is actually after I recompiled Apache, which is unchanged.
>
>  The libexpat on my OS is the latest version, because I have runned this command:
>  apt-get install libexpat1
>  And it says it's already the newest version, which is 1.95.8-3
>  according to the ubuntu's pachage directory.
>
>  Luyi
>
>
>
>
>
>
>
>
>  On Sun, Apr 6, 2008 at 3:09 PM, Graham Dumpleton
>  <graham.dumpleton@gmail.com> wrote:
>  > 2008/4/5 Luyi Chen <lychen1109@gmail.com>:
>  >
>  > > Hi,
>  >  >
>  >  >  I am trying to make mod_python working on Apache 2.2.6, ubuntu dapper
>  >  >  6.06. But I was hit by the problem of wrong expat library issue, as
>  >  >  stated by Graham Dumpleton, on this page
>  >  >  http://www.dscpl.com.au/wiki/ModPython/Articles/ExpatCausingApacheCrash
>  >  >
>  >  >  I am using a custom compiled Apache2 in /usr/local/apache2, so I
>  >  >  checked version of libexpat with the following line,
>  >  >
>  >  >  ldd /usr/local/apache2/bin/httpd
>  >  >
>  >  >  in the result there're two lines
>  >  >   libexpat.so.0 => /usr/local/apache2/lib/libexpat.so.0 (0x00002b4f4e1c5000)
>  >  >   libexpat.so.1 => /usr/lib/libexpat.so.1 (0x00002b4f4e2e7000)
>  >
>  >  If you have this, then something is quite broken with your Apache
>  >  httpd to start with, before even mod_python is loaded.
>  >
>  >  What is the full 'ldd' output from running it against 'httpd'.
>  >
>  >  Also go through each of the .so file it is dependent upon and run
>  >  'ldd' on them as well and post all the results.
>  >
>  >  As far as I can tell, one of the .so files depended on by httpd is
>  >  itself dependent on libexpat (a different version), as I can't see
>  >  otherwise how you can get an executable dependent on two different
>  >  versions of a shared library.
>  >
>  >  Graham
>  >
>  >
>  >  >  The one in /usr/local/apache2/lib is an old version 1.95.2, while the
>  >  >  one in /usr/lib is 1.95.8, which is identical to the version of
>  >  >  libexpat used by python.
>  >  >
>  >  >  How do I tell Apache to use the new version of libexpat only?
>  >  >
>  >  >  Luyi
>  >  >  _______________________________________________
>  >  >  Mod_python mailing list
>  >  >  Mod_python@modpython.org
>  >  >  http://mailman.modpython.org/mailman/listinfo/mod_python
>  >  >
>  >
>
From lychen1109 at gmail.com  Sun Apr  6 12:19:05 2008
From: lychen1109 at gmail.com (Luyi Chen)
Date: Sun Apr  6 12:19:13 2008
Subject: [mod_python] old libexpat shared library
In-Reply-To: <88e286470804060314l33d4aabdrdbde793c7ebf341a@mail.gmail.com>
References: <8608ca750804050345m64c42592nd796e8d20f75d560@mail.gmail.com>
	<88e286470804060009x5852c5cbqc204891cc3c4b61a@mail.gmail.com>
	<8608ca750804060137h15b3a27dje0b01f027ec48300@mail.gmail.com>
	<88e286470804060314l33d4aabdrdbde793c7ebf341a@mail.gmail.com>
Message-ID: <8608ca750804060919j24aad6aao5d8771d5f0d6659d@mail.gmail.com>

Thanks Graham,

I am almost done, but still need one more step. Here's what I did:

1) I installed Apache2.2.6 included apr
2) When I tried to install the included version of apr-util, I got the
following error
libtool: install: error: cannot install `libaprutil-1.la' to a
directory not ending in /usr/local/apache2/lib

A little Googling shows someone else also meet the problem, but
without finding the reason.

3) So I downloaded apr-util-1.2.12 from Apache website, and installed
it without problem.
4) I compiled Apache again with options pointing to the formerly
installed apr and apr-util
5) Now, when I ldd httpd, I got the following info

        libz.so.1 => /usr/lib/libz.so.1 (0x00002aebe6011000)
        libm.so.6 => /lib/libm.so.6 (0x00002aebe6127000)
        libaprutil-1.so.0 =>
/usr/local/apr-util-httpd//lib/libaprutil-1.so.0 (0x00002aebe62ac000)
        libexpat.so.1 => /usr/lib/libexpat.so.1 (0x00002aebe63c4000)
        libapr-1.so.0 => /usr/local/apache2/lib/libapr-1.so.0
(0x00002aebe64e8000)
        librt.so.1 => /lib/librt.so.1 (0x00002aebe6610000)
        libcrypt.so.1 => /lib/libcrypt.so.1 (0x00002aebe6718000)
        libpthread.so.0 => /lib/libpthread.so.0 (0x00002aebe684c000)
        libdl.so.2 => /lib/libdl.so.2 (0x00002aebe6961000)
        libc.so.6 => /lib/libc.so.6 (0x00002aebe6a63000)
        /lib64/ld-linux-x86-64.so.2 (0x00002aebe5efa000)

This seems good, because the libexpat in my /usr/lib directory is the right one.

6) I restarted Apache
7) I checked runtime context of Apache, then I got this

$ ps aux | grep http | head -3
root      4757  0.0  3.9  47972 10212 ?        Ss   Apr04   0:00
/usr/local/apache2/bin/httpd -k restart
apache   29984  0.0  3.4  48104  8992 ?        S    23:31   0:00
/usr/local/apache2/bin/httpd -k restart
apache   29985  0.0  3.2  47972  8580 ?        S    23:31   0:00
/usr/local/apache2/bin/httpd -k restart

$ sudo /usr/sbin/lsof -p 4757 | grep expat
httpd   4757 root  mem    REG     8,1    397288 1183944
/usr/local/apache2/lib/libexpat.so.0.1.0
httpd   4757 root  mem    REG     8,1    143944 1115945
/usr/lib/libexpat.so.1.0.0

Here's the problem: the runtime Apache still loads two version of
libexpat. And the Segmentation fault error still hits me as expected.

After I recompiled Apache, the original libexpat.so.0.1.0 still sits
in Apache lib directory. According to the ldd httpd result, it's not
needed anymore.

My question is why does it still loaded? Does simply deleting them an
elegant way to solve it?

Luyi






On Sun, Apr 6, 2008 at 6:14 PM, Graham Dumpleton
<graham.dumpleton@gmail.com> wrote:
> Try getting the following option passed through to configure of apr-util:
>
>   --with-expat=/usr
>
>  Can't remember if top level Apache configure will pass it through automatically.
>
>  Think that is the correct directory to give as argument.
>
>  Graham
>
>  2008/4/6 Luyi Chen <lychen1109@gmail.com>:
>
>
> > Thanks Graham,
>  >
>  >  Here's the info:
>  >
>  >  $ ldd /usr/local/apache2/bin/httpd
>  >         libz.so.1 => /usr/lib/libz.so.1 (0x00002b02938de000)
>  >         libm.so.6 => /lib/libm.so.6 (0x00002b02939f4000)
>  >         libaprutil-1.so.0 => /usr/local/apache2/lib/libaprutil-1.so.0
>  >  (0x00002b0293b79000)
>  >
>  >         libexpat.so.0 => /usr/local/apache2/lib/libexpat.so.0
>  >  (0x00002b0293c91000)
>  >         libexpat.so.1 => /usr/lib/libexpat.so.1 (0x00002b0293db3000)
>  >         libapr-1.so.0 => /usr/local/apache2/lib/libapr-1.so.0
>  >  (0x00002b0293ed6000)
>  >         librt.so.1 => /lib/librt.so.1 (0x00002b0293ffe000)
>  >         libcrypt.so.1 => /lib/libcrypt.so.1 (0x00002b0294107000)
>  >         libpthread.so.0 => /lib/libpthread.so.0 (0x00002b029423a000)
>  >         libdl.so.2 => /lib/libdl.so.2 (0x00002b029434f000)
>  >         libc.so.6 => /lib/libc.so.6 (0x00002b0294452000)
>  >         /lib64/ld-linux-x86-64.so.2 (0x00002b02937c7000)
>  >  $ ldd /usr/lib/libz.so.1
>  >         libc.so.6 => /lib/libc.so.6 (0x00002b2764dc5000)
>  >         /lib64/ld-linux-x86-64.so.2 (0x0000555555554000)
>  >  $ ldd /lib/libm.so.6
>  >         libc.so.6 => /lib/libc.so.6 (0x00002b8bf9a3c000)
>  >         /lib/ld-linux-x86-64.so.2 => /lib64/ld-linux-x86-64.so.2
>  >  (0x0000555555554000)
>  >  $ ldd /usr/local/apache2/lib/libaprutil-1.so.0
>  >
>  >         libexpat.so.0 => /usr/local/apache2/lib/libexpat.so.0
>  >  (0x00002b61001d0000)
>  >         libapr-1.so.0 => /usr/local/apache2/lib/libapr-1.so.0
>  >  (0x00002b61002f2000)
>  >         librt.so.1 => /lib/librt.so.1 (0x00002b610041e000)
>  >         libcrypt.so.1 => /lib/libcrypt.so.1 (0x00002b6100526000)
>  >         libpthread.so.0 => /lib/libpthread.so.0 (0x00002b610065a000)
>  >         libdl.so.2 => /lib/libdl.so.2 (0x00002b610076f000)
>  >         libc.so.6 => /lib/libc.so.6 (0x00002b6100871000)
>  >         /lib64/ld-linux-x86-64.so.2 (0x0000555555554000)
>  >  $ ldd /usr/local/apache2/lib/libexpat.so.0
>  >         libc.so.6 => /lib/libc.so.6 (0x00002af851439000)
>  >         /lib64/ld-linux-x86-64.so.2 (0x0000555555554000)
>  >  $ ldd /usr/lib/libexpat.so.1
>  >         libc.so.6 => /lib/libc.so.6 (0x00002b96d0162000)
>  >         /lib64/ld-linux-x86-64.so.2 (0x0000555555554000)
>  >  $ ldd /usr/local/apache2/lib/libapr-1.so.0
>  >         librt.so.1 => /lib/librt.so.1 (0x00002ba649f41000)
>  >         libcrypt.so.1 => /lib/libcrypt.so.1 (0x00002ba64a04a000)
>  >         libpthread.so.0 => /lib/libpthread.so.0 (0x00002ba64a17d000)
>  >         libdl.so.2 => /lib/libdl.so.2 (0x00002ba64a292000)
>  >         libc.so.6 => /lib/libc.so.6 (0x00002ba64a395000)
>  >         /lib64/ld-linux-x86-64.so.2 (0x0000555555554000)
>  >  $ ldd /lib/librt.so.1
>  >         libc.so.6 => /lib/libc.so.6 (0x00002aab3a499000)
>  >         libpthread.so.0 => /lib/libpthread.so.0 (0x00002aab3a6d3000)
>  >         /lib/ld-linux-x86-64.so.2 => /lib64/ld-linux-x86-64.so.2
>  >  (0x0000555555554000)
>  >  $ ldd /lib/libcrypt.so.1
>  >         libc.so.6 => /lib/libc.so.6 (0x00002ae20b9dd000)
>  >         /lib/ld-linux-x86-64.so.2 => /lib64/ld-linux-x86-64.so.2
>  >  (0x0000555555554000)
>  >  $ ldd /lib/libpthread.so.0
>  >         libc.so.6 => /lib/libc.so.6 (0x00002b15ada6d000)
>  >         /lib/ld-linux-x86-64.so.2 => /lib64/ld-linux-x86-64.so.2
>  >  (0x0000555555554000)
>  >  $ ldd /lib/libdl.so.2
>  >         libc.so.6 => /lib/libc.so.6 (0x00002b4f78de5000)
>  >         /lib/ld-linux-x86-64.so.2 => /lib64/ld-linux-x86-64.so.2
>  >  (0x0000555555554000)
>  >  $ ldd /lib/libc.so.6
>  >         /lib/ld-linux-x86-64.so.2 (0x00002b7744489000)
>  >
>  >  My own analysis is that apr-util depends on the old version of
>  >  libexpat. So I checked Apache installation doc, and found that I can
>  >  use --with-included-apr to force Apache use the bundled apr. Since my
>  >  os (Ubuntu 6.06) is an old version, I thought this is very likely to
>  >  be the cause.
>  >
>  >  I tried to recompile Apache with the --with-included-apr option,
>  >  here's my newest config.nice
>  >  #! /bin/sh
>  >  #
>  >  # Created by configure
>  >
>  >  "./configure" \
>  >  "--prefix=/usr/local/apache2" \
>  >  "--enable-proxy" \
>  >  "--enable-proxy-http" \
>  >  "--enable-proxy-balancer" \
>  >  "--enable-dav" \
>  >  "--enable-rewrite" \
>  >  "--enable-deflate" \
>  >  "--with-included-apr" \
>  >  "$@"
>  >
>  >
>  >  But it didn't solve the problem. The above information from ldd
>  >  command is actually after I recompiled Apache, which is unchanged.
>  >
>  >  The libexpat on my OS is the latest version, because I have runned this command:
>  >  apt-get install libexpat1
>  >  And it says it's already the newest version, which is 1.95.8-3
>  >  according to the ubuntu's pachage directory.
>  >
>  >  Luyi
>  >
>  >
>  >
>  >
>  >
>  >
>  >
>  >
>  >  On Sun, Apr 6, 2008 at 3:09 PM, Graham Dumpleton
>  >  <graham.dumpleton@gmail.com> wrote:
>  >  > 2008/4/5 Luyi Chen <lychen1109@gmail.com>:
>  >  >
>  >  > > Hi,
>  >  >  >
>  >  >  >  I am trying to make mod_python working on Apache 2.2.6, ubuntu dapper
>  >  >  >  6.06. But I was hit by the problem of wrong expat library issue, as
>  >  >  >  stated by Graham Dumpleton, on this page
>  >  >  >  http://www.dscpl.com.au/wiki/ModPython/Articles/ExpatCausingApacheCrash
>  >  >  >
>  >  >  >  I am using a custom compiled Apache2 in /usr/local/apache2, so I
>  >  >  >  checked version of libexpat with the following line,
>  >  >  >
>  >  >  >  ldd /usr/local/apache2/bin/httpd
>  >  >  >
>  >  >  >  in the result there're two lines
>  >  >  >   libexpat.so.0 => /usr/local/apache2/lib/libexpat.so.0 (0x00002b4f4e1c5000)
>  >  >  >   libexpat.so.1 => /usr/lib/libexpat.so.1 (0x00002b4f4e2e7000)
>  >  >
>  >  >  If you have this, then something is quite broken with your Apache
>  >  >  httpd to start with, before even mod_python is loaded.
>  >  >
>  >  >  What is the full 'ldd' output from running it against 'httpd'.
>  >  >
>  >  >  Also go through each of the .so file it is dependent upon and run
>  >  >  'ldd' on them as well and post all the results.
>  >  >
>  >  >  As far as I can tell, one of the .so files depended on by httpd is
>  >  >  itself dependent on libexpat (a different version), as I can't see
>  >  >  otherwise how you can get an executable dependent on two different
>  >  >  versions of a shared library.
>  >  >
>  >  >  Graham
>  >  >
>  >  >
>  >  >  >  The one in /usr/local/apache2/lib is an old version 1.95.2, while the
>  >  >  >  one in /usr/lib is 1.95.8, which is identical to the version of
>  >  >  >  libexpat used by python.
>  >  >  >
>  >  >  >  How do I tell Apache to use the new version of libexpat only?
>  >  >  >
>  >  >  >  Luyi
>  >  >  >  _______________________________________________
>  >  >  >  Mod_python mailing list
>  >  >  >  Mod_python@modpython.org
>  >  >  >  http://mailman.modpython.org/mailman/listinfo/mod_python
>  >  >  >
>  >  >
>  >
>
From matusis at yahoo.com  Sun Apr  6 23:33:23 2008
From: matusis at yahoo.com (Alec Matusis)
Date: Sun Apr  6 23:34:02 2008
Subject: [mod_python] mod_python errors
In-Reply-To: <a595de7a0804051605u59b528fcj90f1f2eb3ff4be90@mail.gmail.com>
References: <a595de7a0804051605u59b528fcj90f1f2eb3ff4be90@mail.gmail.com>
Message-ID: <059201c89860$226277a0$672766e0$@com>

I have been getting the second error too
IOError:
> Client read error (Timeout?), referer: http://example.com/

I assumed that this happens when a user uploads a file, and their incoming connection is pretty slow. I used Fiddler and throttled down upload speeds to below dialup speed, and I could reproduce this error very well in that scenario.

> -----Original Message-----
> From: mod_python-bounces@modpython.org [mailto:mod_python-
> bounces@modpython.org] On Behalf Of Clodoaldo
> Sent: Saturday, April 05, 2008 4:06 PM
> To: mod_python@modpython.org list
> Subject: [mod_python] mod_python errors
> 
> Three errors have been happening in an application using mod_python.
> 
> Configuration:
> Fedora Core 6. This server does not have mod_wsgi installed.
> # uname -a
> Linux myserver.net 2.6.22.14-72.fc6 #1 SMP Wed Nov 21 14:10:25 EST
> 2007 x86_64 x86_64 x86_64 GNU/Linux
> 
> Python 2.4.4
> # ldd /usr/lib64/libpython2.4.so
>         libpthread.so.0 => /lib64/libpthread.so.0 (0x0000003751e00000)
>         libdl.so.2 => /lib64/libdl.so.2 (0x00000032d1000000)
>         libutil.so.1 => /lib64/libutil.so.1 (0x00000032d8800000)
>         libm.so.6 => /lib64/libm.so.6 (0x00000032d1400000)
>         libc.so.6 => /lib64/libc.so.6 (0x00000032d0c00000)
>         /lib64/ld-linux-x86-64.so.2 (0x0000555555554000)
> 
> mod_python 3.3.0b
> # ldd /usr/lib64/httpd/modules/mod_python.so
>         libpthread.so.0 => /lib64/libpthread.so.0 (0x00002aaaaae07000)
>         libdl.so.2 => /lib64/libdl.so.2 (0x00002aaaab021000)
>         libutil.so.1 => /lib64/libutil.so.1 (0x00002aaaab225000)
>         libm.so.6 => /lib64/libm.so.6 (0x00002aaaab429000)
>         libc.so.6 => /lib64/libc.so.6 (0x00002aaaab6ac000)
>         /lib64/ld-linux-x86-64.so.2 (0x0000555555554000)
> 
> [Sat Apr 05 01:32:13 2008] [notice] Digest: generating secret for
> digest authentication ...
> [Sat Apr 05 01:32:13 2008] [notice] Digest: done
> [Sat Apr 05 01:32:13 2008] [notice] mod_python: Creating 8 session
> mutexes based on 256 max processes and 0 max threads.
> [Sat Apr 05 01:32:13 2008] [notice] mod_python: using mutex_directory
> /tmp
> [Sat Apr 05 01:32:13 2008] [notice] Apache/2.2.6 (Unix) DAV/2
> PHP/5.1.6 mod_python/3.3.0b Python/2.4.4 mod_ssl/2.2.6 OpenSSL/0.9.8b
> mod_perl/2.0.2 Perl/v5.8.8 configured -- resuming normal operations
> 
> # httpd -V
> Server version: Apache/2.2.6 (Unix)
> Server built:   Sep 18 2007 11:25:59
> Server's Module Magic Number: 20051115:5
> Server loaded:  APR 1.2.7, APR-Util 1.2.8
> Compiled using: APR 1.2.7, APR-Util 1.2.8
> Architecture:   64-bit
> Server MPM:     Prefork
>   threaded:     no
>     forked:     yes (variable process count)
> Server compiled with....
>  -D APACHE_MPM_DIR="server/mpm/prefork"
>  -D APR_HAS_SENDFILE
>  -D APR_HAS_MMAP
>  -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)
>  -D APR_USE_SYSVSEM_SERIALIZE
>  -D APR_USE_PTHREAD_SERIALIZE
>  -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT
>  -D APR_HAS_OTHER_CHILD
>  -D AP_HAVE_RELIABLE_PIPED_LOGS
>  -D DYNAMIC_MODULE_LIMIT=128
>  -D HTTPD_ROOT="/etc/httpd"
>  -D SUEXEC_BIN="/usr/sbin/suexec"
>  -D DEFAULT_PIDLOG="logs/httpd.pid"
>  -D DEFAULT_SCOREBOARD="logs/apache_runtime_status"
>  -D DEFAULT_LOCKFILE="logs/accept.lock"
>  -D DEFAULT_ERRORLOG="logs/error_log"
>  -D AP_TYPES_CONFIG_FILE="conf/mime.types"
>  -D SERVER_CONFIG_FILE="conf/httpd.conf"
> 
> The first error is already described in this thread:
> http://www.modpython.org/pipermail/mod_python/2007-June/023795.html
> 
> It is also commented in these threads:
> http://groups.google.co.uk/group/webpy/browse_thread/thread/4c5f2c76b74
> 9eb4e
> http://bytes.com/forum/thread40318.html
> 
> [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174]
> ServerName: 'example.com', referer:
> http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fab
> ricante_id=22&modelo_id=0
> [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174]
> DocumentRoot: '/var/www/html/example.com', referer:
> http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fab
> ricante_id=22&modelo_id=0
> [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174] URI:
> '/_pesquisa', referer:
> http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fab
> ricante_id=22&modelo_id=0
> [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174] Location:
> None, referer:
> http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fab
> ricante_id=22&modelo_id=0
> [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174] Directory:
> '/var/www/html/example.com/', referer:
> http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fab
> ricante_id=22&modelo_id=0
> [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174] Filename:
> '/var/www/html/example.com/_pesquisa.py', referer:
> http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fab
> ricante_id=22&modelo_id=0
> [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174] PathInfo:
> '', referer:
> http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fab
> ricante_id=22&modelo_id=0
> [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174] Traceback
> (most recent call last):, referer:
> http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fab
> ricante_id=22&modelo_id=0
> [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174]   File
> "/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
> 1537, in HandlerDispatch\n    default=default_handler, arg=req,
> silent=hlist.silent), referer:
> http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fab
> ricante_id=22&modelo_id=0
> [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174]   File
> "/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
> 1229, in _process_target\n    result = _execute_target(config, req,
> object, arg), referer:
> http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fab
> ricante_id=22&modelo_id=0
> [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174]   File
> "/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
> 1128, in _execute_target\n    result = object(arg), referer:
> http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fab
> ricante_id=22&modelo_id=0
> [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174]   File
> "/home/carroarodo/mod/_publisher.py", line 5, in handler\n    return
> publisher.handler(req), referer:
> http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fab
> ricante_id=22&modelo_id=0
> [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174]   File
> "/usr/lib64/python2.4/site-packages/mod_python/publisher.py", line
> 213, in handler\n    published = publish_object(req, object), referer:
> http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fab
> ricante_id=22&modelo_id=0
> [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174]   File
> "/usr/lib64/python2.4/site-packages/mod_python/publisher.py", line
> 424, in publish_object\n    req.form = util.FieldStorage(req,
> keep_blank_values=1), referer:
> http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fab
> ricante_id=22&modelo_id=0
> [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174]   File
> "/usr/lib64/python2.4/site-packages/mod_python/util.py", line 225, in
> __init__\n    pairs = parse_qsl(req.read(clen), keep_blank_values),
> referer:
> http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fab
> ricante_id=22&modelo_id=0
> [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174]
> SystemError: Objects/stringobject.c:3515: bad argument to internal
> function, referer:
> http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fab
> ricante_id=22&modelo_id=0
> 
> The second is more frequent:
> 
> [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196] mod_python
> (pid=326, interpreter='example.com', phase='PythonHandler',
> handler='/home/carroarodo/mod/_publisher.py'): Application error,
> referer: http://example.com/
> [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196] ServerName:
> 'example.com', referer: http://example.com/
> [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196] DocumentRoot:
> '/var/www/html/example.com', referer: http://example.com/
> [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196] URI:
> '/_pesquisa', referer: http://example.com/
> [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196] Location:
> None, referer: http://example.com/
> [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196] Directory:
> '/var/www/html/example.com/', referer: http://example.com/
> [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196] Filename:
> '/var/www/html/example.com/_pesquisa.py', referer: http://example.com/
> [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196] PathInfo: '',
> referer: http://example.com/
> [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196] Traceback
> (most recent call last):, referer: http://example.com/
> [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196]   File
> "/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
> 1537, in HandlerDispatch\n    default=default_handler, arg=req,
> silent=hlist.silent), referer: http://example.com/
> [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196]   File
> "/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
> 1229, in _process_target\n    result = _execute_target(config, req,
> object, arg), referer: http://example.com/
> [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196]   File
> "/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
> 1128, in _execute_target\n    result = object(arg), referer:
> http://example.com/
> [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196]   File
> "/home/carroarodo/mod/_publisher.py", line 5, in handler\n    return
> publisher.handler(req), referer: http://example.com/
> [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196]   File
> "/usr/lib64/python2.4/site-packages/mod_python/publisher.py", line
> 213, in handler\n    published = publish_object(req, object), referer:
> http://example.com/
> [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196]   File
> "/usr/lib64/python2.4/site-packages/mod_python/publisher.py", line
> 424, in publish_object\n    req.form = util.FieldStorage(req,
> keep_blank_values=1), referer: http://example.com/
> [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196]   File
> "/usr/lib64/python2.4/site-packages/mod_python/util.py", line 225, in
> __init__\n    pairs = parse_qsl(req.read(clen), keep_blank_values),
> referer: http://example.com/
> [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196] IOError:
> Client read error (Timeout?), referer: http://example.com/
> 
> This is the access log for the above error:
> 
> 201.32.1.196 - - [05/Apr/2008:14:57:14 +0000] "POST /_pesquisa
> HTTP/1.1" 200 643 "http://example.com/" "Mozilla/4.0 (compatible; MSIE
> 6.0; Windows NT 5.1; SV1; .NET CLR 1.1.4322)"
> 201.32.1.196 - - [05/Apr/2008:14:57:19 +0000] "GET
> /?estado_sigla=RJ&localidade_id=0&bairro_id=0&fabricante_id=22&modelo_i
> d=0
> HTTP/1.1" 2
> 00 2773 "http://example.com/" "Mozilla/4.0 (compatible; MSIE 6.0;
> Windows NT 5.1; SV1; .NET CLR 1.1.4322)"
> 201.32.1.196 - - [05/Apr/2008:14:57:21 +0000] "GET
> /pub/fotos/0/a/c/0ac0b8a054571a0502f2653620544562769616d8.jpg
> HTTP/1.1" 200 6801 "http
> ://example.com/?estado_sigla=RJ&localidade_id=0&bairro_id=0&fabricante_
> id=22&modelo_id=0"
> "Mozilla/4.0 (compatible; MSIE 6.0; Windows
> NT 5.1; SV1; .NET CLR 1.1.4322)"
> 201.32.1.196 - - [05/Apr/2008:14:56:19 +0000] "POST /_pesquisa
> HTTP/1.1" 500 661 "http://example.com/" "Mozilla/4.0 (compatible; MSIE
> 6.0; Windows NT 5.1; SV1; .NET CLR 1.1.4322)"
> 201.32.1.196 - - [05/Apr/2008:14:57:57 +0000] "GET
> /ce?i=934&h=sLH2ndocEZ_8EoGtvtsnNA HTTP/1.1" 200 1113 "-" "Mozilla/4.0
> (compatible; MS
> IE 6.0; Windows NT 5.1; SV1; .NET CLR 1.1.4322)"
> 201.32.1.196 - - [05/Apr/2008:14:58:01 +0000] "GET /login HTTP/1.1"
> 200 1499 "http://example.com/ce?i=934&h=sLP2ndot1Z_8EoGtvtsnNA" "M
> ozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; .NET CLR
> 1.1.4322)"
> 
> 
> And the third is quite strange:
> 
> [Sat Apr 05 20:58:11 2008] [error] [client 189.69.253.187] PathInfo:
> '', referer: http://example.com/login
> [Sat Apr 05 20:58:11 2008] [error] [client 189.69.253.187] Traceback
> (most recent call last):, referer: http://example.com/login
> [Sat Apr 05 20:58:11 2008] [error] [client 189.69.253.187]   File
> "/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
> 1537, in HandlerDispatch\n    default=default_handler, arg=req,
> silent=hlist.silent), referer: http://example.com/login
> [Sat Apr 05 20:58:11 2008] [error] [client 189.69.253.187]   File
> "/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
> 1229, in _process_target\n    result = _execute_target(config, req,
> object, arg), referer: http://example.com/login
> [Sat Apr 05 20:58:11 2008] [error] [client 189.69.253.187]   File
> "/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
> 1128, in _execute_target\n    result = object(arg), referer:
> http://example.com/login
> [Sat Apr 05 20:58:11 2008] [error] [client 189.69.253.187]   File
> "/home/carroarodo/mod/_publisher.py", line 5, in handler\n    return
> publisher.handler(req), referer: http://example.com/login
> [Sat Apr 05 20:58:11 2008] [error] [client 189.69.253.187]   File
> "/usr/lib64/python2.4/site-packages/mod_python/publisher.py", line
> 213, in handler\n    published = publish_object(req, object), referer:
> http://example.com/login
> [Sat Apr 05 20:58:11 2008] [error] [client 189.69.253.187]   File
> "/usr/lib64/python2.4/site-packages/mod_python/publisher.py", line
> 425, in publish_object\n    return
> publish_object(req,util.apply_fs_data(object, req.form, req=req)),
> referer: http://example.com/login
> [Sat Apr 05 20:58:11 2008] [error] [client 189.69.253.187]   File
> "/usr/lib64/python2.4/site-packages/mod_python/util.py", line 554, in
> apply_fs_data\n    return object(**args), referer:
> http://example.com/login
> [Sat Apr 05 20:58:11 2008] [error] [client 189.69.253.187]   File
> "/var/www/html/example.com/login.py", line 52, in index\n
> _d['mensagem'] += \\, referer: http://example.com/login
> [Sat Apr 05 20:58:11 2008] [error] [client 189.69.253.187] TypeError:
> unsupported operand type(s) for +=: 'NoneType' and 'str', referer:
> http://example.com/login
> 
> Access log:
> 189.27.86.85 - - [05/Apr/2008:20:58:08 +0000] "GET / HTTP/1.1" 200
> 5739 "http://example.com/" "Mozilla/4.0 (compatible; MSIE 6.0; Windows
> NT 5.1; SV1; Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1) ;
> FDM; .NET CLR 1.1.4322; .NET CLR 2.0.50727; .NET CLR 3.0.04506.648;
> .NET CLR 3.5.21022)"
> 
> The line it complains about is this:
> 
>                _d['mensagem'] += \
>                   '<br><br>Voc? j? leu o email enviado para %s ?'\
> 
> This line always work except in the above ocasion.
> 
> Regards, Clodoaldo Pinto Neto
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python



From graham.dumpleton at gmail.com  Mon Apr  7 02:49:01 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon Apr  7 02:49:08 2008
Subject: [mod_python] old libexpat shared library
In-Reply-To: <8608ca750804060919j24aad6aao5d8771d5f0d6659d@mail.gmail.com>
References: <8608ca750804050345m64c42592nd796e8d20f75d560@mail.gmail.com>
	<88e286470804060009x5852c5cbqc204891cc3c4b61a@mail.gmail.com>
	<8608ca750804060137h15b3a27dje0b01f027ec48300@mail.gmail.com>
	<88e286470804060314l33d4aabdrdbde793c7ebf341a@mail.gmail.com>
	<8608ca750804060919j24aad6aao5d8771d5f0d6659d@mail.gmail.com>
Message-ID: <88e286470804062349k62ec86c1t3b2917e6bfd8d344@mail.gmail.com>

You would need to go through the same ldd debugging to work out why.

BTW, if nothing is using the wrong/bad versions of apache/expat/apr
installed under /usr/local, can you just remove them so you are doing
a clean build with their only being the single expat version
installed.

Also be aware that if you can get past the dual expat linkage problem,
if you use Python 2.5, what version of expat library is used doesn't
even matter as in Python 2.5 the names of contained expat library in
Python expat module and namespace prefixed anyway and there is no
clash.

Graham

2008/4/7 Luyi Chen <lychen1109@gmail.com>:
> Thanks Graham,
>
>  I am almost done, but still need one more step. Here's what I did:
>
>  1) I installed Apache2.2.6 included apr
>  2) When I tried to install the included version of apr-util, I got the
>  following error
>  libtool: install: error: cannot install `libaprutil-1.la' to a
>  directory not ending in /usr/local/apache2/lib
>
>  A little Googling shows someone else also meet the problem, but
>  without finding the reason.
>
>  3) So I downloaded apr-util-1.2.12 from Apache website, and installed
>  it without problem.
>  4) I compiled Apache again with options pointing to the formerly
>  installed apr and apr-util
>  5) Now, when I ldd httpd, I got the following info
>
>         libz.so.1 => /usr/lib/libz.so.1 (0x00002aebe6011000)
>         libm.so.6 => /lib/libm.so.6 (0x00002aebe6127000)
>         libaprutil-1.so.0 =>
>  /usr/local/apr-util-httpd//lib/libaprutil-1.so.0 (0x00002aebe62ac000)
>         libexpat.so.1 => /usr/lib/libexpat.so.1 (0x00002aebe63c4000)
>
>         libapr-1.so.0 => /usr/local/apache2/lib/libapr-1.so.0
>  (0x00002aebe64e8000)
>         librt.so.1 => /lib/librt.so.1 (0x00002aebe6610000)
>         libcrypt.so.1 => /lib/libcrypt.so.1 (0x00002aebe6718000)
>         libpthread.so.0 => /lib/libpthread.so.0 (0x00002aebe684c000)
>         libdl.so.2 => /lib/libdl.so.2 (0x00002aebe6961000)
>         libc.so.6 => /lib/libc.so.6 (0x00002aebe6a63000)
>         /lib64/ld-linux-x86-64.so.2 (0x00002aebe5efa000)
>
>  This seems good, because the libexpat in my /usr/lib directory is the right one.
>
>  6) I restarted Apache
>  7) I checked runtime context of Apache, then I got this
>
>  $ ps aux | grep http | head -3
>  root      4757  0.0  3.9  47972 10212 ?        Ss   Apr04   0:00
>  /usr/local/apache2/bin/httpd -k restart
>  apache   29984  0.0  3.4  48104  8992 ?        S    23:31   0:00
>  /usr/local/apache2/bin/httpd -k restart
>  apache   29985  0.0  3.2  47972  8580 ?        S    23:31   0:00
>  /usr/local/apache2/bin/httpd -k restart
>
>  $ sudo /usr/sbin/lsof -p 4757 | grep expat
>  httpd   4757 root  mem    REG     8,1    397288 1183944
>  /usr/local/apache2/lib/libexpat.so.0.1.0
>  httpd   4757 root  mem    REG     8,1    143944 1115945
>  /usr/lib/libexpat.so.1.0.0
>
>  Here's the problem: the runtime Apache still loads two version of
>  libexpat. And the Segmentation fault error still hits me as expected.
>
>  After I recompiled Apache, the original libexpat.so.0.1.0 still sits
>  in Apache lib directory. According to the ldd httpd result, it's not
>  needed anymore.
>
>  My question is why does it still loaded? Does simply deleting them an
>  elegant way to solve it?
>
>  Luyi
>
>
>
>
>
>
>  On Sun, Apr 6, 2008 at 6:14 PM, Graham Dumpleton
>
>
> <graham.dumpleton@gmail.com> wrote:
>  > Try getting the following option passed through to configure of apr-util:
>  >
>  >   --with-expat=/usr
>  >
>  >  Can't remember if top level Apache configure will pass it through automatically.
>  >
>  >  Think that is the correct directory to give as argument.
>  >
>  >  Graham
>  >
>  >  2008/4/6 Luyi Chen <lychen1109@gmail.com>:
>  >
>  >
>  > > Thanks Graham,
>  >  >
>  >  >  Here's the info:
>  >  >
>  >  >  $ ldd /usr/local/apache2/bin/httpd
>  >  >         libz.so.1 => /usr/lib/libz.so.1 (0x00002b02938de000)
>  >  >         libm.so.6 => /lib/libm.so.6 (0x00002b02939f4000)
>  >  >         libaprutil-1.so.0 => /usr/local/apache2/lib/libaprutil-1.so.0
>  >  >  (0x00002b0293b79000)
>  >  >
>  >  >         libexpat.so.0 => /usr/local/apache2/lib/libexpat.so.0
>  >  >  (0x00002b0293c91000)
>  >  >         libexpat.so.1 => /usr/lib/libexpat.so.1 (0x00002b0293db3000)
>  >  >         libapr-1.so.0 => /usr/local/apache2/lib/libapr-1.so.0
>  >  >  (0x00002b0293ed6000)
>  >  >         librt.so.1 => /lib/librt.so.1 (0x00002b0293ffe000)
>  >  >         libcrypt.so.1 => /lib/libcrypt.so.1 (0x00002b0294107000)
>  >  >         libpthread.so.0 => /lib/libpthread.so.0 (0x00002b029423a000)
>  >  >         libdl.so.2 => /lib/libdl.so.2 (0x00002b029434f000)
>  >  >         libc.so.6 => /lib/libc.so.6 (0x00002b0294452000)
>  >  >         /lib64/ld-linux-x86-64.so.2 (0x00002b02937c7000)
>  >  >  $ ldd /usr/lib/libz.so.1
>  >  >         libc.so.6 => /lib/libc.so.6 (0x00002b2764dc5000)
>  >  >         /lib64/ld-linux-x86-64.so.2 (0x0000555555554000)
>  >  >  $ ldd /lib/libm.so.6
>  >  >         libc.so.6 => /lib/libc.so.6 (0x00002b8bf9a3c000)
>  >  >         /lib/ld-linux-x86-64.so.2 => /lib64/ld-linux-x86-64.so.2
>  >  >  (0x0000555555554000)
>  >  >  $ ldd /usr/local/apache2/lib/libaprutil-1.so.0
>  >  >
>  >  >         libexpat.so.0 => /usr/local/apache2/lib/libexpat.so.0
>  >  >  (0x00002b61001d0000)
>  >  >         libapr-1.so.0 => /usr/local/apache2/lib/libapr-1.so.0
>  >  >  (0x00002b61002f2000)
>  >  >         librt.so.1 => /lib/librt.so.1 (0x00002b610041e000)
>  >  >         libcrypt.so.1 => /lib/libcrypt.so.1 (0x00002b6100526000)
>  >  >         libpthread.so.0 => /lib/libpthread.so.0 (0x00002b610065a000)
>  >  >         libdl.so.2 => /lib/libdl.so.2 (0x00002b610076f000)
>  >  >         libc.so.6 => /lib/libc.so.6 (0x00002b6100871000)
>  >  >         /lib64/ld-linux-x86-64.so.2 (0x0000555555554000)
>  >  >  $ ldd /usr/local/apache2/lib/libexpat.so.0
>  >  >         libc.so.6 => /lib/libc.so.6 (0x00002af851439000)
>  >  >         /lib64/ld-linux-x86-64.so.2 (0x0000555555554000)
>  >  >  $ ldd /usr/lib/libexpat.so.1
>  >  >         libc.so.6 => /lib/libc.so.6 (0x00002b96d0162000)
>  >  >         /lib64/ld-linux-x86-64.so.2 (0x0000555555554000)
>  >  >  $ ldd /usr/local/apache2/lib/libapr-1.so.0
>  >  >         librt.so.1 => /lib/librt.so.1 (0x00002ba649f41000)
>  >  >         libcrypt.so.1 => /lib/libcrypt.so.1 (0x00002ba64a04a000)
>  >  >         libpthread.so.0 => /lib/libpthread.so.0 (0x00002ba64a17d000)
>  >  >         libdl.so.2 => /lib/libdl.so.2 (0x00002ba64a292000)
>  >  >         libc.so.6 => /lib/libc.so.6 (0x00002ba64a395000)
>  >  >         /lib64/ld-linux-x86-64.so.2 (0x0000555555554000)
>  >  >  $ ldd /lib/librt.so.1
>  >  >         libc.so.6 => /lib/libc.so.6 (0x00002aab3a499000)
>  >  >         libpthread.so.0 => /lib/libpthread.so.0 (0x00002aab3a6d3000)
>  >  >         /lib/ld-linux-x86-64.so.2 => /lib64/ld-linux-x86-64.so.2
>  >  >  (0x0000555555554000)
>  >  >  $ ldd /lib/libcrypt.so.1
>  >  >         libc.so.6 => /lib/libc.so.6 (0x00002ae20b9dd000)
>  >  >         /lib/ld-linux-x86-64.so.2 => /lib64/ld-linux-x86-64.so.2
>  >  >  (0x0000555555554000)
>  >  >  $ ldd /lib/libpthread.so.0
>  >  >         libc.so.6 => /lib/libc.so.6 (0x00002b15ada6d000)
>  >  >         /lib/ld-linux-x86-64.so.2 => /lib64/ld-linux-x86-64.so.2
>  >  >  (0x0000555555554000)
>  >  >  $ ldd /lib/libdl.so.2
>  >  >         libc.so.6 => /lib/libc.so.6 (0x00002b4f78de5000)
>  >  >         /lib/ld-linux-x86-64.so.2 => /lib64/ld-linux-x86-64.so.2
>  >  >  (0x0000555555554000)
>  >  >  $ ldd /lib/libc.so.6
>  >  >         /lib/ld-linux-x86-64.so.2 (0x00002b7744489000)
>  >  >
>  >  >  My own analysis is that apr-util depends on the old version of
>  >  >  libexpat. So I checked Apache installation doc, and found that I can
>  >  >  use --with-included-apr to force Apache use the bundled apr. Since my
>  >  >  os (Ubuntu 6.06) is an old version, I thought this is very likely to
>  >  >  be the cause.
>  >  >
>  >  >  I tried to recompile Apache with the --with-included-apr option,
>  >  >  here's my newest config.nice
>  >  >  #! /bin/sh
>  >  >  #
>  >  >  # Created by configure
>  >  >
>  >  >  "./configure" \
>  >  >  "--prefix=/usr/local/apache2" \
>  >  >  "--enable-proxy" \
>  >  >  "--enable-proxy-http" \
>  >  >  "--enable-proxy-balancer" \
>  >  >  "--enable-dav" \
>  >  >  "--enable-rewrite" \
>  >  >  "--enable-deflate" \
>  >  >  "--with-included-apr" \
>  >  >  "$@"
>  >  >
>  >  >
>  >  >  But it didn't solve the problem. The above information from ldd
>  >  >  command is actually after I recompiled Apache, which is unchanged.
>  >  >
>  >  >  The libexpat on my OS is the latest version, because I have runned this command:
>  >  >  apt-get install libexpat1
>  >  >  And it says it's already the newest version, which is 1.95.8-3
>  >  >  according to the ubuntu's pachage directory.
>  >  >
>  >  >  Luyi
>  >  >
>  >  >
>  >  >
>  >  >
>  >  >
>  >  >
>  >  >
>  >  >
>  >  >  On Sun, Apr 6, 2008 at 3:09 PM, Graham Dumpleton
>  >  >  <graham.dumpleton@gmail.com> wrote:
>  >  >  > 2008/4/5 Luyi Chen <lychen1109@gmail.com>:
>  >  >  >
>  >  >  > > Hi,
>  >  >  >  >
>  >  >  >  >  I am trying to make mod_python working on Apache 2.2.6, ubuntu dapper
>  >  >  >  >  6.06. But I was hit by the problem of wrong expat library issue, as
>  >  >  >  >  stated by Graham Dumpleton, on this page
>  >  >  >  >  http://www.dscpl.com.au/wiki/ModPython/Articles/ExpatCausingApacheCrash
>  >  >  >  >
>  >  >  >  >  I am using a custom compiled Apache2 in /usr/local/apache2, so I
>  >  >  >  >  checked version of libexpat with the following line,
>  >  >  >  >
>  >  >  >  >  ldd /usr/local/apache2/bin/httpd
>  >  >  >  >
>  >  >  >  >  in the result there're two lines
>  >  >  >  >   libexpat.so.0 => /usr/local/apache2/lib/libexpat.so.0 (0x00002b4f4e1c5000)
>  >  >  >  >   libexpat.so.1 => /usr/lib/libexpat.so.1 (0x00002b4f4e2e7000)
>  >  >  >
>  >  >  >  If you have this, then something is quite broken with your Apache
>  >  >  >  httpd to start with, before even mod_python is loaded.
>  >  >  >
>  >  >  >  What is the full 'ldd' output from running it against 'httpd'.
>  >  >  >
>  >  >  >  Also go through each of the .so file it is dependent upon and run
>  >  >  >  'ldd' on them as well and post all the results.
>  >  >  >
>  >  >  >  As far as I can tell, one of the .so files depended on by httpd is
>  >  >  >  itself dependent on libexpat (a different version), as I can't see
>  >  >  >  otherwise how you can get an executable dependent on two different
>  >  >  >  versions of a shared library.
>  >  >  >
>  >  >  >  Graham
>  >  >  >
>  >  >  >
>  >  >  >  >  The one in /usr/local/apache2/lib is an old version 1.95.2, while the
>  >  >  >  >  one in /usr/lib is 1.95.8, which is identical to the version of
>  >  >  >  >  libexpat used by python.
>  >  >  >  >
>  >  >  >  >  How do I tell Apache to use the new version of libexpat only?
>  >  >  >  >
>  >  >  >  >  Luyi
>  >  >  >  >  _______________________________________________
>  >  >  >  >  Mod_python mailing list
>  >  >  >  >  Mod_python@modpython.org
>  >  >  >  >  http://mailman.modpython.org/mailman/listinfo/mod_python
>  >  >  >  >
>  >  >  >
>  >  >
>  >
>
From graham.dumpleton at gmail.com  Mon Apr  7 03:02:26 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon Apr  7 03:02:31 2008
Subject: [mod_python] mod_python errors
In-Reply-To: <059201c89860$226277a0$672766e0$@com>
References: <a595de7a0804051605u59b528fcj90f1f2eb3ff4be90@mail.gmail.com>
	<059201c89860$226277a0$672766e0$@com>
Message-ID: <88e286470804070002y34e79bdk74edbeaabc3ab5ff@mail.gmail.com>

2008/4/7 Alec Matusis <matusis@yahoo.com>:
> I have been getting the second error too
>
> IOError:
>  > Client read error (Timeout?), referer: http://example.com/
>
>  I assumed that this happens when a user uploads a file, and their incoming connection is pretty slow. I used Fiddler and throttled down upload speeds to below dialup speed, and I could reproduce this error very well in that scenario.

Not necessarily.

The problem is that mod_python uses Apache ap_get_client_block()
function to get more data from client. The return value of this is the
length of data rather than an error code. In fact the error code as to
why it failed is lost internal to the function. Thus the true reason
for the error can't be determined and why mod_python has a question
mark there.

More often than not it is because connection closed before all
expected data received. If there is a timeout on the connection, then
you should be able to tell by playing with the Apache Timeout
directive to change it and see how application behaves differently or
not. Since the default for Timeout is 300 seconds, wouldn't expect a
slow connection to trigger a timeout as the timeout applies to a
blocked connection, ie., waiting for data for that long, if a slow
connection you would still be receiving some data wouldn't you.

Graham

>  > -----Original Message-----
>  > From: mod_python-bounces@modpython.org [mailto:mod_python-
>  > bounces@modpython.org] On Behalf Of Clodoaldo
>  > Sent: Saturday, April 05, 2008 4:06 PM
>  > To: mod_python@modpython.org list
>  > Subject: [mod_python] mod_python errors
>  >
>  > Three errors have been happening in an application using mod_python.
>  >
>  > Configuration:
>  > Fedora Core 6. This server does not have mod_wsgi installed.
>  > # uname -a
>  > Linux myserver.net 2.6.22.14-72.fc6 #1 SMP Wed Nov 21 14:10:25 EST
>  > 2007 x86_64 x86_64 x86_64 GNU/Linux
>  >
>  > Python 2.4.4
>  > # ldd /usr/lib64/libpython2.4.so
>  >         libpthread.so.0 => /lib64/libpthread.so.0 (0x0000003751e00000)
>  >         libdl.so.2 => /lib64/libdl.so.2 (0x00000032d1000000)
>  >         libutil.so.1 => /lib64/libutil.so.1 (0x00000032d8800000)
>  >         libm.so.6 => /lib64/libm.so.6 (0x00000032d1400000)
>  >         libc.so.6 => /lib64/libc.so.6 (0x00000032d0c00000)
>  >         /lib64/ld-linux-x86-64.so.2 (0x0000555555554000)
>  >
>  > mod_python 3.3.0b
>  > # ldd /usr/lib64/httpd/modules/mod_python.so
>  >         libpthread.so.0 => /lib64/libpthread.so.0 (0x00002aaaaae07000)
>  >         libdl.so.2 => /lib64/libdl.so.2 (0x00002aaaab021000)
>  >         libutil.so.1 => /lib64/libutil.so.1 (0x00002aaaab225000)
>  >         libm.so.6 => /lib64/libm.so.6 (0x00002aaaab429000)
>  >         libc.so.6 => /lib64/libc.so.6 (0x00002aaaab6ac000)
>  >         /lib64/ld-linux-x86-64.so.2 (0x0000555555554000)
>  >
>  > [Sat Apr 05 01:32:13 2008] [notice] Digest: generating secret for
>  > digest authentication ...
>  > [Sat Apr 05 01:32:13 2008] [notice] Digest: done
>  > [Sat Apr 05 01:32:13 2008] [notice] mod_python: Creating 8 session
>  > mutexes based on 256 max processes and 0 max threads.
>  > [Sat Apr 05 01:32:13 2008] [notice] mod_python: using mutex_directory
>  > /tmp
>  > [Sat Apr 05 01:32:13 2008] [notice] Apache/2.2.6 (Unix) DAV/2
>  > PHP/5.1.6 mod_python/3.3.0b Python/2.4.4 mod_ssl/2.2.6 OpenSSL/0.9.8b
>  > mod_perl/2.0.2 Perl/v5.8.8 configured -- resuming normal operations
>  >
>  > # httpd -V
>  > Server version: Apache/2.2.6 (Unix)
>  > Server built:   Sep 18 2007 11:25:59
>  > Server's Module Magic Number: 20051115:5
>  > Server loaded:  APR 1.2.7, APR-Util 1.2.8
>  > Compiled using: APR 1.2.7, APR-Util 1.2.8
>  > Architecture:   64-bit
>  > Server MPM:     Prefork
>  >   threaded:     no
>  >     forked:     yes (variable process count)
>  > Server compiled with....
>  >  -D APACHE_MPM_DIR="server/mpm/prefork"
>  >  -D APR_HAS_SENDFILE
>  >  -D APR_HAS_MMAP
>  >  -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)
>  >  -D APR_USE_SYSVSEM_SERIALIZE
>  >  -D APR_USE_PTHREAD_SERIALIZE
>  >  -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT
>  >  -D APR_HAS_OTHER_CHILD
>  >  -D AP_HAVE_RELIABLE_PIPED_LOGS
>  >  -D DYNAMIC_MODULE_LIMIT=128
>  >  -D HTTPD_ROOT="/etc/httpd"
>  >  -D SUEXEC_BIN="/usr/sbin/suexec"
>  >  -D DEFAULT_PIDLOG="logs/httpd.pid"
>  >  -D DEFAULT_SCOREBOARD="logs/apache_runtime_status"
>  >  -D DEFAULT_LOCKFILE="logs/accept.lock"
>  >  -D DEFAULT_ERRORLOG="logs/error_log"
>  >  -D AP_TYPES_CONFIG_FILE="conf/mime.types"
>  >  -D SERVER_CONFIG_FILE="conf/httpd.conf"
>  >
>  > The first error is already described in this thread:
>  > http://www.modpython.org/pipermail/mod_python/2007-June/023795.html
>  >
>  > It is also commented in these threads:
>  > http://groups.google.co.uk/group/webpy/browse_thread/thread/4c5f2c76b74
>  > 9eb4e
>  > http://bytes.com/forum/thread40318.html
>  >
>  > [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174]
>  > ServerName: 'example.com', referer:
>  > http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fab
>  > ricante_id=22&modelo_id=0
>  > [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174]
>  > DocumentRoot: '/var/www/html/example.com', referer:
>  > http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fab
>  > ricante_id=22&modelo_id=0
>  > [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174] URI:
>  > '/_pesquisa', referer:
>  > http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fab
>  > ricante_id=22&modelo_id=0
>  > [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174] Location:
>  > None, referer:
>  > http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fab
>  > ricante_id=22&modelo_id=0
>  > [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174] Directory:
>  > '/var/www/html/example.com/', referer:
>  > http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fab
>  > ricante_id=22&modelo_id=0
>  > [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174] Filename:
>  > '/var/www/html/example.com/_pesquisa.py', referer:
>  > http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fab
>  > ricante_id=22&modelo_id=0
>  > [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174] PathInfo:
>  > '', referer:
>  > http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fab
>  > ricante_id=22&modelo_id=0
>  > [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174] Traceback
>  > (most recent call last):, referer:
>  > http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fab
>  > ricante_id=22&modelo_id=0
>  > [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174]   File
>  > "/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
>  > 1537, in HandlerDispatch\n    default=default_handler, arg=req,
>  > silent=hlist.silent), referer:
>  > http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fab
>  > ricante_id=22&modelo_id=0
>  > [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174]   File
>  > "/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
>  > 1229, in _process_target\n    result = _execute_target(config, req,
>  > object, arg), referer:
>  > http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fab
>  > ricante_id=22&modelo_id=0
>  > [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174]   File
>  > "/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
>  > 1128, in _execute_target\n    result = object(arg), referer:
>  > http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fab
>  > ricante_id=22&modelo_id=0
>  > [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174]   File
>  > "/home/carroarodo/mod/_publisher.py", line 5, in handler\n    return
>  > publisher.handler(req), referer:
>  > http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fab
>  > ricante_id=22&modelo_id=0
>  > [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174]   File
>  > "/usr/lib64/python2.4/site-packages/mod_python/publisher.py", line
>  > 213, in handler\n    published = publish_object(req, object), referer:
>  > http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fab
>  > ricante_id=22&modelo_id=0
>  > [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174]   File
>  > "/usr/lib64/python2.4/site-packages/mod_python/publisher.py", line
>  > 424, in publish_object\n    req.form = util.FieldStorage(req,
>  > keep_blank_values=1), referer:
>  > http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fab
>  > ricante_id=22&modelo_id=0
>  > [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174]   File
>  > "/usr/lib64/python2.4/site-packages/mod_python/util.py", line 225, in
>  > __init__\n    pairs = parse_qsl(req.read(clen), keep_blank_values),
>  > referer:
>  > http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fab
>  > ricante_id=22&modelo_id=0
>  > [Sat Apr 05 15:19:51 2008] [error] [client 200.147.229.174]
>  > SystemError: Objects/stringobject.c:3515: bad argument to internal
>  > function, referer:
>  > http://example.com/?estado_sigla=Brasil&localidade_id=0&bairro_id=0&fab
>  > ricante_id=22&modelo_id=0
>  >
>  > The second is more frequent:
>  >
>  > [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196] mod_python
>  > (pid=326, interpreter='example.com', phase='PythonHandler',
>  > handler='/home/carroarodo/mod/_publisher.py'): Application error,
>  > referer: http://example.com/
>  > [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196] ServerName:
>  > 'example.com', referer: http://example.com/
>  > [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196] DocumentRoot:
>  > '/var/www/html/example.com', referer: http://example.com/
>  > [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196] URI:
>  > '/_pesquisa', referer: http://example.com/
>  > [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196] Location:
>  > None, referer: http://example.com/
>  > [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196] Directory:
>  > '/var/www/html/example.com/', referer: http://example.com/
>  > [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196] Filename:
>  > '/var/www/html/example.com/_pesquisa.py', referer: http://example.com/
>  > [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196] PathInfo: '',
>  > referer: http://example.com/
>  > [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196] Traceback
>  > (most recent call last):, referer: http://example.com/
>  > [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196]   File
>  > "/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
>  > 1537, in HandlerDispatch\n    default=default_handler, arg=req,
>  > silent=hlist.silent), referer: http://example.com/
>  > [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196]   File
>  > "/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
>  > 1229, in _process_target\n    result = _execute_target(config, req,
>  > object, arg), referer: http://example.com/
>  > [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196]   File
>  > "/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
>  > 1128, in _execute_target\n    result = object(arg), referer:
>  > http://example.com/
>  > [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196]   File
>  > "/home/carroarodo/mod/_publisher.py", line 5, in handler\n    return
>  > publisher.handler(req), referer: http://example.com/
>  > [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196]   File
>  > "/usr/lib64/python2.4/site-packages/mod_python/publisher.py", line
>  > 213, in handler\n    published = publish_object(req, object), referer:
>  > http://example.com/
>  > [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196]   File
>  > "/usr/lib64/python2.4/site-packages/mod_python/publisher.py", line
>  > 424, in publish_object\n    req.form = util.FieldStorage(req,
>  > keep_blank_values=1), referer: http://example.com/
>  > [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196]   File
>  > "/usr/lib64/python2.4/site-packages/mod_python/util.py", line 225, in
>  > __init__\n    pairs = parse_qsl(req.read(clen), keep_blank_values),
>  > referer: http://example.com/
>  > [Sat Apr 05 14:57:49 2008] [error] [client 201.32.1.196] IOError:
>  > Client read error (Timeout?), referer: http://example.com/
>  >
>  > This is the access log for the above error:
>  >
>  > 201.32.1.196 - - [05/Apr/2008:14:57:14 +0000] "POST /_pesquisa
>  > HTTP/1.1" 200 643 "http://example.com/" "Mozilla/4.0 (compatible; MSIE
>  > 6.0; Windows NT 5.1; SV1; .NET CLR 1.1.4322)"
>  > 201.32.1.196 - - [05/Apr/2008:14:57:19 +0000] "GET
>  > /?estado_sigla=RJ&localidade_id=0&bairro_id=0&fabricante_id=22&modelo_i
>  > d=0
>  > HTTP/1.1" 2
>  > 00 2773 "http://example.com/" "Mozilla/4.0 (compatible; MSIE 6.0;
>  > Windows NT 5.1; SV1; .NET CLR 1.1.4322)"
>  > 201.32.1.196 - - [05/Apr/2008:14:57:21 +0000] "GET
>  > /pub/fotos/0/a/c/0ac0b8a054571a0502f2653620544562769616d8.jpg
>  > HTTP/1.1" 200 6801 "http
>  > ://example.com/?estado_sigla=RJ&localidade_id=0&bairro_id=0&fabricante_
>  > id=22&modelo_id=0"
>  > "Mozilla/4.0 (compatible; MSIE 6.0; Windows
>  > NT 5.1; SV1; .NET CLR 1.1.4322)"
>  > 201.32.1.196 - - [05/Apr/2008:14:56:19 +0000] "POST /_pesquisa
>  > HTTP/1.1" 500 661 "http://example.com/" "Mozilla/4.0 (compatible; MSIE
>  > 6.0; Windows NT 5.1; SV1; .NET CLR 1.1.4322)"
>  > 201.32.1.196 - - [05/Apr/2008:14:57:57 +0000] "GET
>  > /ce?i=934&h=sLH2ndocEZ_8EoGtvtsnNA HTTP/1.1" 200 1113 "-" "Mozilla/4.0
>  > (compatible; MS
>  > IE 6.0; Windows NT 5.1; SV1; .NET CLR 1.1.4322)"
>  > 201.32.1.196 - - [05/Apr/2008:14:58:01 +0000] "GET /login HTTP/1.1"
>  > 200 1499 "http://example.com/ce?i=934&h=sLP2ndot1Z_8EoGtvtsnNA" "M
>  > ozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; .NET CLR
>  > 1.1.4322)"
>  >
>  >
>  > And the third is quite strange:
>  >
>  > [Sat Apr 05 20:58:11 2008] [error] [client 189.69.253.187] PathInfo:
>  > '', referer: http://example.com/login
>  > [Sat Apr 05 20:58:11 2008] [error] [client 189.69.253.187] Traceback
>  > (most recent call last):, referer: http://example.com/login
>  > [Sat Apr 05 20:58:11 2008] [error] [client 189.69.253.187]   File
>  > "/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
>  > 1537, in HandlerDispatch\n    default=default_handler, arg=req,
>  > silent=hlist.silent), referer: http://example.com/login
>  > [Sat Apr 05 20:58:11 2008] [error] [client 189.69.253.187]   File
>  > "/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
>  > 1229, in _process_target\n    result = _execute_target(config, req,
>  > object, arg), referer: http://example.com/login
>  > [Sat Apr 05 20:58:11 2008] [error] [client 189.69.253.187]   File
>  > "/usr/lib64/python2.4/site-packages/mod_python/importer.py", line
>  > 1128, in _execute_target\n    result = object(arg), referer:
>  > http://example.com/login
>  > [Sat Apr 05 20:58:11 2008] [error] [client 189.69.253.187]   File
>  > "/home/carroarodo/mod/_publisher.py", line 5, in handler\n    return
>  > publisher.handler(req), referer: http://example.com/login
>  > [Sat Apr 05 20:58:11 2008] [error] [client 189.69.253.187]   File
>  > "/usr/lib64/python2.4/site-packages/mod_python/publisher.py", line
>  > 213, in handler\n    published = publish_object(req, object), referer:
>  > http://example.com/login
>  > [Sat Apr 05 20:58:11 2008] [error] [client 189.69.253.187]   File
>  > "/usr/lib64/python2.4/site-packages/mod_python/publisher.py", line
>  > 425, in publish_object\n    return
>  > publish_object(req,util.apply_fs_data(object, req.form, req=req)),
>  > referer: http://example.com/login
>  > [Sat Apr 05 20:58:11 2008] [error] [client 189.69.253.187]   File
>  > "/usr/lib64/python2.4/site-packages/mod_python/util.py", line 554, in
>  > apply_fs_data\n    return object(**args), referer:
>  > http://example.com/login
>  > [Sat Apr 05 20:58:11 2008] [error] [client 189.69.253.187]   File
>  > "/var/www/html/example.com/login.py", line 52, in index\n
>  > _d['mensagem'] += \\, referer: http://example.com/login
>  > [Sat Apr 05 20:58:11 2008] [error] [client 189.69.253.187] TypeError:
>  > unsupported operand type(s) for +=: 'NoneType' and 'str', referer:
>  > http://example.com/login
>  >
>  > Access log:
>  > 189.27.86.85 - - [05/Apr/2008:20:58:08 +0000] "GET / HTTP/1.1" 200
>  > 5739 "http://example.com/" "Mozilla/4.0 (compatible; MSIE 6.0; Windows
>  > NT 5.1; SV1; Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1) ;
>  > FDM; .NET CLR 1.1.4322; .NET CLR 2.0.50727; .NET CLR 3.0.04506.648;
>  > .NET CLR 3.5.21022)"
>  >
>  > The line it complains about is this:
>  >
>  >                _d['mensagem'] += \
>  >                   '<br><br>Voc? j? leu o email enviado para %s ?'\
>  >
>  > This line always work except in the above ocasion.
>  >
>  > Regards, Clodoaldo Pinto Neto
>  >
>  > _______________________________________________
>  > Mod_python mailing list
>  > Mod_python@modpython.org
>  > http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
>
>  _______________________________________________
>  Mod_python mailing list
>  Mod_python@modpython.org
>  http://mailman.modpython.org/mailman/listinfo/mod_python
>

From lychen1109 at gmail.com  Mon Apr  7 06:59:55 2008
From: lychen1109 at gmail.com (Luyi Chen)
Date: Mon Apr  7 07:00:03 2008
Subject: [mod_python] old libexpat shared library
In-Reply-To: <88e286470804062349k62ec86c1t3b2917e6bfd8d344@mail.gmail.com>
References: <8608ca750804050345m64c42592nd796e8d20f75d560@mail.gmail.com>
	<88e286470804060009x5852c5cbqc204891cc3c4b61a@mail.gmail.com>
	<8608ca750804060137h15b3a27dje0b01f027ec48300@mail.gmail.com>
	<88e286470804060314l33d4aabdrdbde793c7ebf341a@mail.gmail.com>
	<8608ca750804060919j24aad6aao5d8771d5f0d6659d@mail.gmail.com>
	<88e286470804062349k62ec86c1t3b2917e6bfd8d344@mail.gmail.com>
Message-ID: <8608ca750804070359i7b1ad566rb7ede28ccac52f7d@mail.gmail.com>

I have solved the problem. The solution is to remove the wrong
libexpat version from /usr/local/apache2/lib, then reinstall
apr/apr-util/apache.

Thanks Graham.

Luyi



On Mon, Apr 7, 2008 at 2:49 PM, Graham Dumpleton
<graham.dumpleton@gmail.com> wrote:
> You would need to go through the same ldd debugging to work out why.
>
>  BTW, if nothing is using the wrong/bad versions of apache/expat/apr
>  installed under /usr/local, can you just remove them so you are doing
>  a clean build with their only being the single expat version
>  installed.
>
>  Also be aware that if you can get past the dual expat linkage problem,
>  if you use Python 2.5, what version of expat library is used doesn't
>  even matter as in Python 2.5 the names of contained expat library in
>  Python expat module and namespace prefixed anyway and there is no
>  clash.
>
>  Graham
>
>  2008/4/7 Luyi Chen <lychen1109@gmail.com>:
>
>
> > Thanks Graham,
>  >
>  >  I am almost done, but still need one more step. Here's what I did:
>  >
>  >  1) I installed Apache2.2.6 included apr
>  >  2) When I tried to install the included version of apr-util, I got the
>  >  following error
>  >  libtool: install: error: cannot install `libaprutil-1.la' to a
>  >  directory not ending in /usr/local/apache2/lib
>  >
>  >  A little Googling shows someone else also meet the problem, but
>  >  without finding the reason.
>  >
>  >  3) So I downloaded apr-util-1.2.12 from Apache website, and installed
>  >  it without problem.
>  >  4) I compiled Apache again with options pointing to the formerly
>  >  installed apr and apr-util
>  >  5) Now, when I ldd httpd, I got the following info
>  >
>  >         libz.so.1 => /usr/lib/libz.so.1 (0x00002aebe6011000)
>  >         libm.so.6 => /lib/libm.so.6 (0x00002aebe6127000)
>  >         libaprutil-1.so.0 =>
>  >  /usr/local/apr-util-httpd//lib/libaprutil-1.so.0 (0x00002aebe62ac000)
>  >         libexpat.so.1 => /usr/lib/libexpat.so.1 (0x00002aebe63c4000)
>  >
>  >         libapr-1.so.0 => /usr/local/apache2/lib/libapr-1.so.0
>  >  (0x00002aebe64e8000)
>  >         librt.so.1 => /lib/librt.so.1 (0x00002aebe6610000)
>  >         libcrypt.so.1 => /lib/libcrypt.so.1 (0x00002aebe6718000)
>  >         libpthread.so.0 => /lib/libpthread.so.0 (0x00002aebe684c000)
>  >         libdl.so.2 => /lib/libdl.so.2 (0x00002aebe6961000)
>  >         libc.so.6 => /lib/libc.so.6 (0x00002aebe6a63000)
>  >         /lib64/ld-linux-x86-64.so.2 (0x00002aebe5efa000)
>  >
>  >  This seems good, because the libexpat in my /usr/lib directory is the right one.
>  >
>  >  6) I restarted Apache
>  >  7) I checked runtime context of Apache, then I got this
>  >
>  >  $ ps aux | grep http | head -3
>  >  root      4757  0.0  3.9  47972 10212 ?        Ss   Apr04   0:00
>  >  /usr/local/apache2/bin/httpd -k restart
>  >  apache   29984  0.0  3.4  48104  8992 ?        S    23:31   0:00
>  >  /usr/local/apache2/bin/httpd -k restart
>  >  apache   29985  0.0  3.2  47972  8580 ?        S    23:31   0:00
>  >  /usr/local/apache2/bin/httpd -k restart
>  >
>  >  $ sudo /usr/sbin/lsof -p 4757 | grep expat
>  >  httpd   4757 root  mem    REG     8,1    397288 1183944
>  >  /usr/local/apache2/lib/libexpat.so.0.1.0
>  >  httpd   4757 root  mem    REG     8,1    143944 1115945
>  >  /usr/lib/libexpat.so.1.0.0
>  >
>  >  Here's the problem: the runtime Apache still loads two version of
>  >  libexpat. And the Segmentation fault error still hits me as expected.
>  >
>  >  After I recompiled Apache, the original libexpat.so.0.1.0 still sits
>  >  in Apache lib directory. According to the ldd httpd result, it's not
>  >  needed anymore.
>  >
>  >  My question is why does it still loaded? Does simply deleting them an
>  >  elegant way to solve it?
>  >
>  >  Luyi
>  >
>  >
>  >
>  >
>  >
>  >
>  >  On Sun, Apr 6, 2008 at 6:14 PM, Graham Dumpleton
>  >
>  >
>  > <graham.dumpleton@gmail.com> wrote:
>  >  > Try getting the following option passed through to configure of apr-util:
>  >  >
>  >  >   --with-expat=/usr
>  >  >
>  >  >  Can't remember if top level Apache configure will pass it through automatically.
>  >  >
>  >  >  Think that is the correct directory to give as argument.
>  >  >
>  >  >  Graham
>  >  >
>  >  >  2008/4/6 Luyi Chen <lychen1109@gmail.com>:
>  >  >
>  >  >
>  >  > > Thanks Graham,
>  >  >  >
>  >  >  >  Here's the info:
>  >  >  >
>  >  >  >  $ ldd /usr/local/apache2/bin/httpd
>  >  >  >         libz.so.1 => /usr/lib/libz.so.1 (0x00002b02938de000)
>  >  >  >         libm.so.6 => /lib/libm.so.6 (0x00002b02939f4000)
>  >  >  >         libaprutil-1.so.0 => /usr/local/apache2/lib/libaprutil-1.so.0
>  >  >  >  (0x00002b0293b79000)
>  >  >  >
>  >  >  >         libexpat.so.0 => /usr/local/apache2/lib/libexpat.so.0
>  >  >  >  (0x00002b0293c91000)
>  >  >  >         libexpat.so.1 => /usr/lib/libexpat.so.1 (0x00002b0293db3000)
>  >  >  >         libapr-1.so.0 => /usr/local/apache2/lib/libapr-1.so.0
>  >  >  >  (0x00002b0293ed6000)
>  >  >  >         librt.so.1 => /lib/librt.so.1 (0x00002b0293ffe000)
>  >  >  >         libcrypt.so.1 => /lib/libcrypt.so.1 (0x00002b0294107000)
>  >  >  >         libpthread.so.0 => /lib/libpthread.so.0 (0x00002b029423a000)
>  >  >  >         libdl.so.2 => /lib/libdl.so.2 (0x00002b029434f000)
>  >  >  >         libc.so.6 => /lib/libc.so.6 (0x00002b0294452000)
>  >  >  >         /lib64/ld-linux-x86-64.so.2 (0x00002b02937c7000)
>  >  >  >  $ ldd /usr/lib/libz.so.1
>  >  >  >         libc.so.6 => /lib/libc.so.6 (0x00002b2764dc5000)
>  >  >  >         /lib64/ld-linux-x86-64.so.2 (0x0000555555554000)
>  >  >  >  $ ldd /lib/libm.so.6
>  >  >  >         libc.so.6 => /lib/libc.so.6 (0x00002b8bf9a3c000)
>  >  >  >         /lib/ld-linux-x86-64.so.2 => /lib64/ld-linux-x86-64.so.2
>  >  >  >  (0x0000555555554000)
>  >  >  >  $ ldd /usr/local/apache2/lib/libaprutil-1.so.0
>  >  >  >
>  >  >  >         libexpat.so.0 => /usr/local/apache2/lib/libexpat.so.0
>  >  >  >  (0x00002b61001d0000)
>  >  >  >         libapr-1.so.0 => /usr/local/apache2/lib/libapr-1.so.0
>  >  >  >  (0x00002b61002f2000)
>  >  >  >         librt.so.1 => /lib/librt.so.1 (0x00002b610041e000)
>  >  >  >         libcrypt.so.1 => /lib/libcrypt.so.1 (0x00002b6100526000)
>  >  >  >         libpthread.so.0 => /lib/libpthread.so.0 (0x00002b610065a000)
>  >  >  >         libdl.so.2 => /lib/libdl.so.2 (0x00002b610076f000)
>  >  >  >         libc.so.6 => /lib/libc.so.6 (0x00002b6100871000)
>  >  >  >         /lib64/ld-linux-x86-64.so.2 (0x0000555555554000)
>  >  >  >  $ ldd /usr/local/apache2/lib/libexpat.so.0
>  >  >  >         libc.so.6 => /lib/libc.so.6 (0x00002af851439000)
>  >  >  >         /lib64/ld-linux-x86-64.so.2 (0x0000555555554000)
>  >  >  >  $ ldd /usr/lib/libexpat.so.1
>  >  >  >         libc.so.6 => /lib/libc.so.6 (0x00002b96d0162000)
>  >  >  >         /lib64/ld-linux-x86-64.so.2 (0x0000555555554000)
>  >  >  >  $ ldd /usr/local/apache2/lib/libapr-1.so.0
>  >  >  >         librt.so.1 => /lib/librt.so.1 (0x00002ba649f41000)
>  >  >  >         libcrypt.so.1 => /lib/libcrypt.so.1 (0x00002ba64a04a000)
>  >  >  >         libpthread.so.0 => /lib/libpthread.so.0 (0x00002ba64a17d000)
>  >  >  >         libdl.so.2 => /lib/libdl.so.2 (0x00002ba64a292000)
>  >  >  >         libc.so.6 => /lib/libc.so.6 (0x00002ba64a395000)
>  >  >  >         /lib64/ld-linux-x86-64.so.2 (0x0000555555554000)
>  >  >  >  $ ldd /lib/librt.so.1
>  >  >  >         libc.so.6 => /lib/libc.so.6 (0x00002aab3a499000)
>  >  >  >         libpthread.so.0 => /lib/libpthread.so.0 (0x00002aab3a6d3000)
>  >  >  >         /lib/ld-linux-x86-64.so.2 => /lib64/ld-linux-x86-64.so.2
>  >  >  >  (0x0000555555554000)
>  >  >  >  $ ldd /lib/libcrypt.so.1
>  >  >  >         libc.so.6 => /lib/libc.so.6 (0x00002ae20b9dd000)
>  >  >  >         /lib/ld-linux-x86-64.so.2 => /lib64/ld-linux-x86-64.so.2
>  >  >  >  (0x0000555555554000)
>  >  >  >  $ ldd /lib/libpthread.so.0
>  >  >  >         libc.so.6 => /lib/libc.so.6 (0x00002b15ada6d000)
>  >  >  >         /lib/ld-linux-x86-64.so.2 => /lib64/ld-linux-x86-64.so.2
>  >  >  >  (0x0000555555554000)
>  >  >  >  $ ldd /lib/libdl.so.2
>  >  >  >         libc.so.6 => /lib/libc.so.6 (0x00002b4f78de5000)
>  >  >  >         /lib/ld-linux-x86-64.so.2 => /lib64/ld-linux-x86-64.so.2
>  >  >  >  (0x0000555555554000)
>  >  >  >  $ ldd /lib/libc.so.6
>  >  >  >         /lib/ld-linux-x86-64.so.2 (0x00002b7744489000)
>  >  >  >
>  >  >  >  My own analysis is that apr-util depends on the old version of
>  >  >  >  libexpat. So I checked Apache installation doc, and found that I can
>  >  >  >  use --with-included-apr to force Apache use the bundled apr. Since my
>  >  >  >  os (Ubuntu 6.06) is an old version, I thought this is very likely to
>  >  >  >  be the cause.
>  >  >  >
>  >  >  >  I tried to recompile Apache with the --with-included-apr option,
>  >  >  >  here's my newest config.nice
>  >  >  >  #! /bin/sh
>  >  >  >  #
>  >  >  >  # Created by configure
>  >  >  >
>  >  >  >  "./configure" \
>  >  >  >  "--prefix=/usr/local/apache2" \
>  >  >  >  "--enable-proxy" \
>  >  >  >  "--enable-proxy-http" \
>  >  >  >  "--enable-proxy-balancer" \
>  >  >  >  "--enable-dav" \
>  >  >  >  "--enable-rewrite" \
>  >  >  >  "--enable-deflate" \
>  >  >  >  "--with-included-apr" \
>  >  >  >  "$@"
>  >  >  >
>  >  >  >
>  >  >  >  But it didn't solve the problem. The above information from ldd
>  >  >  >  command is actually after I recompiled Apache, which is unchanged.
>  >  >  >
>  >  >  >  The libexpat on my OS is the latest version, because I have runned this command:
>  >  >  >  apt-get install libexpat1
>  >  >  >  And it says it's already the newest version, which is 1.95.8-3
>  >  >  >  according to the ubuntu's pachage directory.
>  >  >  >
>  >  >  >  Luyi
>  >  >  >
>  >  >  >
>  >  >  >
>  >  >  >
>  >  >  >
>  >  >  >
>  >  >  >
>  >  >  >
>  >  >  >  On Sun, Apr 6, 2008 at 3:09 PM, Graham Dumpleton
>  >  >  >  <graham.dumpleton@gmail.com> wrote:
>  >  >  >  > 2008/4/5 Luyi Chen <lychen1109@gmail.com>:
>  >  >  >  >
>  >  >  >  > > Hi,
>  >  >  >  >  >
>  >  >  >  >  >  I am trying to make mod_python working on Apache 2.2.6, ubuntu dapper
>  >  >  >  >  >  6.06. But I was hit by the problem of wrong expat library issue, as
>  >  >  >  >  >  stated by Graham Dumpleton, on this page
>  >  >  >  >  >  http://www.dscpl.com.au/wiki/ModPython/Articles/ExpatCausingApacheCrash
>  >  >  >  >  >
>  >  >  >  >  >  I am using a custom compiled Apache2 in /usr/local/apache2, so I
>  >  >  >  >  >  checked version of libexpat with the following line,
>  >  >  >  >  >
>  >  >  >  >  >  ldd /usr/local/apache2/bin/httpd
>  >  >  >  >  >
>  >  >  >  >  >  in the result there're two lines
>  >  >  >  >  >   libexpat.so.0 => /usr/local/apache2/lib/libexpat.so.0 (0x00002b4f4e1c5000)
>  >  >  >  >  >   libexpat.so.1 => /usr/lib/libexpat.so.1 (0x00002b4f4e2e7000)
>  >  >  >  >
>  >  >  >  >  If you have this, then something is quite broken with your Apache
>  >  >  >  >  httpd to start with, before even mod_python is loaded.
>  >  >  >  >
>  >  >  >  >  What is the full 'ldd' output from running it against 'httpd'.
>  >  >  >  >
>  >  >  >  >  Also go through each of the .so file it is dependent upon and run
>  >  >  >  >  'ldd' on them as well and post all the results.
>  >  >  >  >
>  >  >  >  >  As far as I can tell, one of the .so files depended on by httpd is
>  >  >  >  >  itself dependent on libexpat (a different version), as I can't see
>  >  >  >  >  otherwise how you can get an executable dependent on two different
>  >  >  >  >  versions of a shared library.
>  >  >  >  >
>  >  >  >  >  Graham
>  >  >  >  >
>  >  >  >  >
>  >  >  >  >  >  The one in /usr/local/apache2/lib is an old version 1.95.2, while the
>  >  >  >  >  >  one in /usr/lib is 1.95.8, which is identical to the version of
>  >  >  >  >  >  libexpat used by python.
>  >  >  >  >  >
>  >  >  >  >  >  How do I tell Apache to use the new version of libexpat only?
>  >  >  >  >  >
>  >  >  >  >  >  Luyi
>  >  >  >  >  >  _______________________________________________
>  >  >  >  >  >  Mod_python mailing list
>  >  >  >  >  >  Mod_python@modpython.org
>  >  >  >  >  >  http://mailman.modpython.org/mailman/listinfo/mod_python
>  >  >  >  >  >
>  >  >  >  >
>  >  >  >
>  >  >
>  >
>
From wdauchy at gmail.com  Mon Apr  7 09:00:44 2008
From: wdauchy at gmail.com (William Dauchy)
Date: Mon Apr  7 09:00:56 2008
Subject: [mod_python] open_basedir equivalent
Message-ID: <589723840804070600j3e78411fse8d450f695baf44c@mail.gmail.com>

Hello,

Is there any open_basedir (which is a rule for php) equivalent in
python to protect directories? (to make it not browsable by users)

Regards,

-- 
William Dauchy
From devans725 at hotmail.com  Mon Apr  7 16:57:33 2008
From: devans725 at hotmail.com (David Evans)
Date: Mon Apr  7 16:57:38 2008
Subject: [mod_python] Report Lab integration
Message-ID: <BAY123-W36169A767918DBFA38A45BF4F30@phx.gbl>


I found a thread regarding this but the links to the examples were broken.  I want to create a PDF based on user input and send it to the browser.  Any advice would be appreciated thank you.
_________________________________________________________________
More immediate than e-mail? Get instant access with Windows Live Messenger.
http://www.windowslive.com/messenger/overview.html?ocid=TXT_TAGLM_WL_Refresh_instantaccess_042008
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080407/6edd9b81/attachment.html
From graham.dumpleton at gmail.com  Mon Apr  7 18:46:27 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon Apr  7 18:46:34 2008
Subject: [mod_python] open_basedir equivalent
In-Reply-To: <589723840804070600j3e78411fse8d450f695baf44c@mail.gmail.com>
References: <589723840804070600j3e78411fse8d450f695baf44c@mail.gmail.com>
Message-ID: <88e286470804071546r1fc017bbh47e5121ce1d566d4@mail.gmail.com>

2008/4/7 William Dauchy <wdauchy@gmail.com>:
> Hello,
>
>  Is there any open_basedir (which is a rule for php) equivalent in
>  python to protect directories? (to make it not browsable by users)

No. Not with mod_python.

The closest you may get is to not use mod_python but use any WSGI
capable framework or toolkit. Then use mod_wsgi and specifically use
mod_wsgi daemon mode with a daemon process group per distinct user.
Then configure mod_wsgi to run that daemon process as that user. Then
use UNIX file system permissions to control access.

Graham
From graham.dumpleton at gmail.com  Mon Apr  7 18:49:02 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon Apr  7 18:49:08 2008
Subject: [mod_python] Report Lab integration
In-Reply-To: <BAY123-W36169A767918DBFA38A45BF4F30@phx.gbl>
References: <BAY123-W36169A767918DBFA38A45BF4F30@phx.gbl>
Message-ID: <88e286470804071549u550a1cb2t3f29e9ef3a289cba@mail.gmail.com>

2008/4/8 David Evans <devans725@hotmail.com>:
>
>  I found a thread regarding this but the links to the examples were broken.
> I want to create a PDF based on user input and send it to the browser.  Any
> advice would be appreciated thank you.

Where was the thread? If it was in mod_python mailing list archive and
you are talking about a broken link to attachment then we can tell you
want it should be.

All the same, if you point at the previous discussion it will possibly
tells us more about what you want to do than above. Using ReportLab
isn't that hard, so from above not real clear what the problem you are
having is.

Graham
From kyle.simpson at gmail.com  Mon Apr  7 23:15:41 2008
From: kyle.simpson at gmail.com (Kyle Simpson)
Date: Mon Apr  7 23:15:47 2008
Subject: [mod_python] wrong version?
Message-ID: <5fdbf8630804072015y2dec1870i88d7ea59b87e4bdd@mail.gmail.com>

Not sure what to make of this error.  I have apache 2.2.8, python 2.5.2 and
mod python 3.3.1.

Any ideas?


httpd: Syntax error on line 54 of /usr/local/apache28/conf/httpd.conf: API
module structure 'python_module' in file
/usr/local/apache28/modules/mod_python.so is garbled - expected signature
41503232 but saw 41503230 - perhaps this is not an Apache module DSO, or was
compiled for a different Apache version?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080407/ec4eb134/attachment.html
From graham.dumpleton at gmail.com  Tue Apr  8 00:22:57 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue Apr  8 00:23:02 2008
Subject: [mod_python] wrong version?
In-Reply-To: <5fdbf8630804072015y2dec1870i88d7ea59b87e4bdd@mail.gmail.com>
References: <5fdbf8630804072015y2dec1870i88d7ea59b87e4bdd@mail.gmail.com>
Message-ID: <88e286470804072122t4bcb0213u78613747580b0426@mail.gmail.com>

2008/4/8 Kyle Simpson <kyle.simpson@gmail.com>:
> Not sure what to make of this error.  I have apache 2.2.8, python 2.5.2 and
> mod python 3.3.1.
>
> Any ideas?
>
>
> httpd: Syntax error on line 54 of /usr/local/apache28/conf/httpd.conf: API
> module structure 'python_module' in file
> /usr/local/apache28/modules/mod_python.so is garbled - expected signature
> 41503232 but saw 41503230 - perhaps this is not an Apache module DSO, or was
> compiled for a different Apache version?

Exactly what it means.

Did you compile mod_python yourself for that version of Apache or did
you just install a binary package from somewhere for both?

I am assuming Apache has a concept of an internal ABI number. This is
changed whenever the ABI is changed. You may not be able to use a
precompiled module from an older version of Apache even if same
major/minor version, if this ABI has changed.

Graham
From kyle.simpson at gmail.com  Tue Apr  8 00:25:33 2008
From: kyle.simpson at gmail.com (Kyle Simpson)
Date: Tue Apr  8 00:25:39 2008
Subject: [mod_python] wrong version?
In-Reply-To: <88e286470804072122t4bcb0213u78613747580b0426@mail.gmail.com>
References: <5fdbf8630804072015y2dec1870i88d7ea59b87e4bdd@mail.gmail.com>
	<88e286470804072122t4bcb0213u78613747580b0426@mail.gmail.com>
Message-ID: <5fdbf8630804072125o866c39ck87a377d559d289f@mail.gmail.com>

Hi Graham,

Thanks for the quick reply.

I compiled all 3: python,apache,mod python.  Did not use binaries for any of
them.

On Tue, Apr 8, 2008 at 12:22 AM, Graham Dumpleton <
graham.dumpleton@gmail.com> wrote:

> 2008/4/8 Kyle Simpson <kyle.simpson@gmail.com>:
> > Not sure what to make of this error.  I have apache 2.2.8, python 2.5.2
> and
> > mod python 3.3.1.
> >
> > Any ideas?
> >
> >
> > httpd: Syntax error on line 54 of /usr/local/apache28/conf/httpd.conf:
> API
> > module structure 'python_module' in file
> > /usr/local/apache28/modules/mod_python.so is garbled - expected
> signature
> > 41503232 but saw 41503230 - perhaps this is not an Apache module DSO, or
> was
> > compiled for a different Apache version?
>
> Exactly what it means.
>
> Did you compile mod_python yourself for that version of Apache or did
> you just install a binary package from somewhere for both?
>
> I am assuming Apache has a concept of an internal ABI number. This is
> changed whenever the ABI is changed. You may not be able to use a
> precompiled module from an older version of Apache even if same
> major/minor version, if this ABI has changed.
>
> Graham
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080408/08cd6e9b/attachment.html
From graham.dumpleton at gmail.com  Tue Apr  8 00:30:49 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue Apr  8 00:30:55 2008
Subject: [mod_python] wrong version?
In-Reply-To: <5fdbf8630804072125o866c39ck87a377d559d289f@mail.gmail.com>
References: <5fdbf8630804072015y2dec1870i88d7ea59b87e4bdd@mail.gmail.com>
	<88e286470804072122t4bcb0213u78613747580b0426@mail.gmail.com>
	<5fdbf8630804072125o866c39ck87a377d559d289f@mail.gmail.com>
Message-ID: <88e286470804072130xfe4da44p29b3f1b40f5dc61e@mail.gmail.com>

What do you get when you run:

  ls -las /usr/local/apache28/modules/mod_python.so

and:

  file /usr/local/apache28/modules/mod_python.so

and:

  ldd /usr/local/apache28/modules/mod_python.so

Graham

2008/4/8 Kyle Simpson <kyle.simpson@gmail.com>:
> Hi Graham,
>
> Thanks for the quick reply.
>
> I compiled all 3: python,apache,mod python.  Did not use binaries for any of
> them.
>
>
>
> On Tue, Apr 8, 2008 at 12:22 AM, Graham Dumpleton
> <graham.dumpleton@gmail.com> wrote:
>
> > 2008/4/8 Kyle Simpson <kyle.simpson@gmail.com>:
> >
> >
> >
> > > Not sure what to make of this error.  I have apache 2.2.8, python 2.5.2
> and
> > > mod python 3.3.1.
> > >
> > > Any ideas?
> > >
> > >
> > > httpd: Syntax error on line 54 of /usr/local/apache28/conf/httpd.conf:
> API
> > > module structure 'python_module' in file
> > > /usr/local/apache28/modules/mod_python.so is garbled - expected
> signature
> > > 41503232 but saw 41503230 - perhaps this is not an Apache module DSO, or
> was
> > > compiled for a different Apache version?
> >
> > Exactly what it means.
> >
> > Did you compile mod_python yourself for that version of Apache or did
> > you just install a binary package from somewhere for both?
> >
> > I am assuming Apache has a concept of an internal ABI number. This is
> > changed whenever the ABI is changed. You may not be able to use a
> > precompiled module from an older version of Apache even if same
> > major/minor version, if this ABI has changed.
> >
> > Graham
> >
>
>
From kyle.simpson at gmail.com  Tue Apr  8 00:42:38 2008
From: kyle.simpson at gmail.com (Kyle Simpson)
Date: Tue Apr  8 00:42:46 2008
Subject: [mod_python] wrong version?
In-Reply-To: <88e286470804072130xfe4da44p29b3f1b40f5dc61e@mail.gmail.com>
References: <5fdbf8630804072015y2dec1870i88d7ea59b87e4bdd@mail.gmail.com>
	<88e286470804072122t4bcb0213u78613747580b0426@mail.gmail.com>
	<5fdbf8630804072125o866c39ck87a377d559d289f@mail.gmail.com>
	<88e286470804072130xfe4da44p29b3f1b40f5dc61e@mail.gmail.com>
Message-ID: <5fdbf8630804072142lb33ed89s35ef6fbafa1cee24@mail.gmail.com>

2857 -rwxr-xr-x    1 root     root      2911798 Apr  7 23:14
/usr/local/apache28/modules/mod_python.so

/usr/local/apache28/modules/mod_python.so: ELF 32-bit LSB shared object,
Intel 80386, version 1 (SYSV), not stripped

 libpthread.so.0 => /lib/libpthread.so.0 (0xb7e54000)
        libdl.so.2 => /lib/libdl.so.2 (0xb7e50000)
        libutil.so.1 => /lib/libutil.so.1 (0xb7e4d000)
        libm.so.6 => /lib/libm.so.6 (0xb7e2c000)
        libc.so.6 => /lib/libc.so.6 (0xb7d09000)
        /lib/ld-linux.so.2 => /lib/ld-linux.so.2 (0xb7fee000)


On Tue, Apr 8, 2008 at 12:30 AM, Graham Dumpleton <
graham.dumpleton@gmail.com> wrote:

> What do you get when you run:
>
>  ls -las /usr/local/apache28/modules/mod_python.so
>
> and:
>
>  file /usr/local/apache28/modules/mod_python.so
>
> and:
>
>  ldd /usr/local/apache28/modules/mod_python.so
>
> Graham
>
> 2008/4/8 Kyle Simpson <kyle.simpson@gmail.com>:
> > Hi Graham,
> >
> > Thanks for the quick reply.
> >
> > I compiled all 3: python,apache,mod python.  Did not use binaries for
> any of
> > them.
> >
> >
> >
> > On Tue, Apr 8, 2008 at 12:22 AM, Graham Dumpleton
> > <graham.dumpleton@gmail.com> wrote:
> >
> > > 2008/4/8 Kyle Simpson <kyle.simpson@gmail.com>:
> > >
> > >
> > >
> > > > Not sure what to make of this error.  I have apache 2.2.8, python
> 2.5.2
> > and
> > > > mod python 3.3.1.
> > > >
> > > > Any ideas?
> > > >
> > > >
> > > > httpd: Syntax error on line 54 of
> /usr/local/apache28/conf/httpd.conf:
> > API
> > > > module structure 'python_module' in file
> > > > /usr/local/apache28/modules/mod_python.so is garbled - expected
> > signature
> > > > 41503232 but saw 41503230 - perhaps this is not an Apache module
> DSO, or
> > was
> > > > compiled for a different Apache version?
> > >
> > > Exactly what it means.
> > >
> > > Did you compile mod_python yourself for that version of Apache or did
> > > you just install a binary package from somewhere for both?
> > >
> > > I am assuming Apache has a concept of an internal ABI number. This is
> > > changed whenever the ABI is changed. You may not be able to use a
> > > precompiled module from an older version of Apache even if same
> > > major/minor version, if this ABI has changed.
> > >
> > > Graham
> > >
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080408/0939b1c3/attachment-0001.html
From graham.dumpleton at gmail.com  Tue Apr  8 00:52:05 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue Apr  8 00:52:11 2008
Subject: [mod_python] wrong version?
In-Reply-To: <5fdbf8630804072142lb33ed89s35ef6fbafa1cee24@mail.gmail.com>
References: <5fdbf8630804072015y2dec1870i88d7ea59b87e4bdd@mail.gmail.com>
	<88e286470804072122t4bcb0213u78613747580b0426@mail.gmail.com>
	<5fdbf8630804072125o866c39ck87a377d559d289f@mail.gmail.com>
	<88e286470804072130xfe4da44p29b3f1b40f5dc61e@mail.gmail.com>
	<5fdbf8630804072142lb33ed89s35ef6fbafa1cee24@mail.gmail.com>
Message-ID: <88e286470804072152kc8f6617y7f2f2f37d0e3d688@mail.gmail.com>

Did you do a full stop and start of Apache, not just a restart/reload?

2008/4/8 Kyle Simpson <kyle.simpson@gmail.com>:
> 2857 -rwxr-xr-x    1 root     root      2911798 Apr  7 23:14
> /usr/local/apache28/modules/mod_python.so
>
> /usr/local/apache28/modules/mod_python.so: ELF 32-bit LSB shared object,
> Intel 80386, version 1 (SYSV), not stripped
>
>  libpthread.so.0 => /lib/libpthread.so.0 (0xb7e54000)
>         libdl.so.2 => /lib/libdl.so.2 (0xb7e50000)
>         libutil.so.1 => /lib/libutil.so.1 (0xb7e4d000)
>         libm.so.6 => /lib/libm.so.6 (0xb7e2c000)
>          libc.so.6 => /lib/libc.so.6 (0xb7d09000)
>         /lib/ld-linux.so.2 => /lib/ld-linux.so.2 (0xb7fee000)

This all indicates that your Python has not been installed with a
shared library and that Python is being linked statically into
mod_python.so. This is generally not a good as it bloats your Apache
processes by a couple of MB in size. It can also cause issues,
especially when upgrading from older to newer mod_python and/or
different version of Python. Thus why it is important to do a full
stop of Apache when replacing mod_python.so in this case.

For details of Python shared library issues, see:

  http://code.google.com/p/modwsgi/wiki/InstallationIssues

This is from mod_wsgi documentation, but same issues apply.

BTW, one more possibility is if you have multiple versions of Apache
installed when mod_python was compiled it used the wrong header files.
How did you install mod_python.so.

How many different versions of Apache do you have installed?

What options did you use to 'configure' when building mod_python?

Did you use the 'install' target to 'make' or copy it by hand?

If copied by hand, maybe it was compiled against wrong version of
Apache for which you copied it into. You may want tp pay very careful
attention to the -I flags to compiler when mod_python was compiled.

Graham

> On Tue, Apr 8, 2008 at 12:30 AM, Graham Dumpleton
> <graham.dumpleton@gmail.com> wrote:
>
> > What do you get when you run:
> >
> >  ls -las /usr/local/apache28/modules/mod_python.so
> >
> > and:
> >
> >
> >  file /usr/local/apache28/modules/mod_python.so
> >
> > and:
> >
> >  ldd /usr/local/apache28/modules/mod_python.so
> >
> > Graham
> >
> >
> >
> >
> > 2008/4/8 Kyle Simpson <kyle.simpson@gmail.com>:
> > > Hi Graham,
> > >
> > > Thanks for the quick reply.
> > >
> > > I compiled all 3: python,apache,mod python.  Did not use binaries for
> any of
> > > them.
> > >
> > >
> > >
> > > On Tue, Apr 8, 2008 at 12:22 AM, Graham Dumpleton
> > > <graham.dumpleton@gmail.com> wrote:
> > >
> > > > 2008/4/8 Kyle Simpson <kyle.simpson@gmail.com>:
> > > >
> > > >
> > > >
> > > > > Not sure what to make of this error.  I have apache 2.2.8, python
> 2.5.2
> > > and
> > > > > mod python 3.3.1.
> > > > >
> > > > > Any ideas?
> > > > >
> > > > >
> > > > > httpd: Syntax error on line 54 of
> /usr/local/apache28/conf/httpd.conf:
> > > API
> > > > > module structure 'python_module' in file
> > > > > /usr/local/apache28/modules/mod_python.so is garbled - expected
> > > signature
> > > > > 41503232 but saw 41503230 - perhaps this is not an Apache module
> DSO, or
> > > was
> > > > > compiled for a different Apache version?
> > > >
> > > > Exactly what it means.
> > > >
> > > > Did you compile mod_python yourself for that version of Apache or did
> > > > you just install a binary package from somewhere for both?
> > > >
> > > > I am assuming Apache has a concept of an internal ABI number. This is
> > > > changed whenever the ABI is changed. You may not be able to use a
> > > > precompiled module from an older version of Apache even if same
> > > > major/minor version, if this ABI has changed.
> > > >
> > > > Graham
> > > >
> > >
> > >
> >
>
>
From kyle.simpson at gmail.com  Tue Apr  8 01:46:39 2008
From: kyle.simpson at gmail.com (Kyle Simpson)
Date: Tue Apr  8 01:46:47 2008
Subject: [mod_python] wrong version?
In-Reply-To: <88e286470804072152kc8f6617y7f2f2f37d0e3d688@mail.gmail.com>
References: <5fdbf8630804072015y2dec1870i88d7ea59b87e4bdd@mail.gmail.com>
	<88e286470804072122t4bcb0213u78613747580b0426@mail.gmail.com>
	<5fdbf8630804072125o866c39ck87a377d559d289f@mail.gmail.com>
	<88e286470804072130xfe4da44p29b3f1b40f5dc61e@mail.gmail.com>
	<5fdbf8630804072142lb33ed89s35ef6fbafa1cee24@mail.gmail.com>
	<88e286470804072152kc8f6617y7f2f2f37d0e3d688@mail.gmail.com>
Message-ID: <5fdbf8630804072246m52218833yad5aa5c0d9aad218@mail.gmail.com>

After doing that, new error:

httpd: Syntax error on line 55 of /usr/local/apache28/conf/httpd.conf: API
module structure 'python_module' in file /usr/loc?

line 55 is:
55 LoadModule python_module modules/mod_python.so

I did reconfigure/compile to see if that helped, but here's the ls -la

2857 -rwxr-xr-x    1 root     root      2911798 Apr  8 01:35 mod_python.so

file
/usr/local/apache28/modules/mod_python.so: ELF 32-bit LSB shared object,
Intel 80386, version 1 (SYSV), not stripped

ldd
libpthread.so.0 => /lib/libpthread.so.0 (0x00111000)
        libdl.so.2 => /lib/libdl.so.2 (0x00826000)
        libutil.so.1 => /lib/libutil.so.1 (0x00162000)
        libm.so.6 => /lib/libm.so.6 (0x00ee8000)
        libc.so.6 => /lib/libc.so.6 (0x00832000)
        /lib/ld-linux.so.2 => /lib/ld-linux.so.2 (0x00411000)




On Tue, Apr 8, 2008 at 12:52 AM, Graham Dumpleton <
graham.dumpleton@gmail.com> wrote:

> Did you do a full stop and start of Apache, not just a restart/reload?
>
> 2008/4/8 Kyle Simpson <kyle.simpson@gmail.com>:
> > 2857 -rwxr-xr-x    1 root     root      2911798 Apr  7 23:14
> > /usr/local/apache28/modules/mod_python.so
> >
> > /usr/local/apache28/modules/mod_python.so: ELF 32-bit LSB shared object,
> > Intel 80386, version 1 (SYSV), not stripped
> >
> >  libpthread.so.0 => /lib/libpthread.so.0 (0xb7e54000)
> >         libdl.so.2 => /lib/libdl.so.2 (0xb7e50000)
> >         libutil.so.1 => /lib/libutil.so.1 (0xb7e4d000)
> >         libm.so.6 => /lib/libm.so.6 (0xb7e2c000)
> >          libc.so.6 => /lib/libc.so.6 (0xb7d09000)
> >         /lib/ld-linux.so.2 => /lib/ld-linux.so.2 (0xb7fee000)
>
> This all indicates that your Python has not been installed with a
> shared library and that Python is being linked statically into
> mod_python.so. This is generally not a good as it bloats your Apache
> processes by a couple of MB in size. It can also cause issues,
> especially when upgrading from older to newer mod_python and/or
> different version of Python. Thus why it is important to do a full
> stop of Apache when replacing mod_python.so in this case.
>
> For details of Python shared library issues, see:
>
>  http://code.google.com/p/modwsgi/wiki/InstallationIssues
>
> This is from mod_wsgi documentation, but same issues apply.
>
> BTW, one more possibility is if you have multiple versions of Apache
> installed when mod_python was compiled it used the wrong header files.
> How did you install mod_python.so.
>
> How many different versions of Apache do you have installed?
>
> What options did you use to 'configure' when building mod_python?
>
> Did you use the 'install' target to 'make' or copy it by hand?
>
> If copied by hand, maybe it was compiled against wrong version of
> Apache for which you copied it into. You may want tp pay very careful
> attention to the -I flags to compiler when mod_python was compiled.
>
> Graham
>
> > On Tue, Apr 8, 2008 at 12:30 AM, Graham Dumpleton
> > <graham.dumpleton@gmail.com> wrote:
> >
> > > What do you get when you run:
> > >
> > >  ls -las /usr/local/apache28/modules/mod_python.so
> > >
> > > and:
> > >
> > >
> > >  file /usr/local/apache28/modules/mod_python.so
> > >
> > > and:
> > >
> > >  ldd /usr/local/apache28/modules/mod_python.so
> > >
> > > Graham
> > >
> > >
> > >
> > >
> > > 2008/4/8 Kyle Simpson <kyle.simpson@gmail.com>:
> > > > Hi Graham,
> > > >
> > > > Thanks for the quick reply.
> > > >
> > > > I compiled all 3: python,apache,mod python.  Did not use binaries
> for
> > any of
> > > > them.
> > > >
> > > >
> > > >
> > > > On Tue, Apr 8, 2008 at 12:22 AM, Graham Dumpleton
> > > > <graham.dumpleton@gmail.com> wrote:
> > > >
> > > > > 2008/4/8 Kyle Simpson <kyle.simpson@gmail.com>:
> > > > >
> > > > >
> > > > >
> > > > > > Not sure what to make of this error.  I have apache 2.2.8,
> python
> > 2.5.2
> > > > and
> > > > > > mod python 3.3.1.
> > > > > >
> > > > > > Any ideas?
> > > > > >
> > > > > >
> > > > > > httpd: Syntax error on line 54 of
> > /usr/local/apache28/conf/httpd.conf:
> > > > API
> > > > > > module structure 'python_module' in file
> > > > > > /usr/local/apache28/modules/mod_python.so is garbled - expected
> > > > signature
> > > > > > 41503232 but saw 41503230 - perhaps this is not an Apache module
> > DSO, or
> > > > was
> > > > > > compiled for a different Apache version?
> > > > >
> > > > > Exactly what it means.
> > > > >
> > > > > Did you compile mod_python yourself for that version of Apache or
> did
> > > > > you just install a binary package from somewhere for both?
> > > > >
> > > > > I am assuming Apache has a concept of an internal ABI number. This
> is
> > > > > changed whenever the ABI is changed. You may not be able to use a
> > > > > precompiled module from an older version of Apache even if same
> > > > > major/minor version, if this ABI has changed.
> > > > >
> > > > > Graham
> > > > >
> > > >
> > > >
> > >
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080408/d414bae4/attachment.html
From graham.dumpleton at gmail.com  Tue Apr  8 01:49:40 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue Apr  8 01:49:47 2008
Subject: [mod_python] wrong version?
In-Reply-To: <5fdbf8630804072246m52218833yad5aa5c0d9aad218@mail.gmail.com>
References: <5fdbf8630804072015y2dec1870i88d7ea59b87e4bdd@mail.gmail.com>
	<88e286470804072122t4bcb0213u78613747580b0426@mail.gmail.com>
	<5fdbf8630804072125o866c39ck87a377d559d289f@mail.gmail.com>
	<88e286470804072130xfe4da44p29b3f1b40f5dc61e@mail.gmail.com>
	<5fdbf8630804072142lb33ed89s35ef6fbafa1cee24@mail.gmail.com>
	<88e286470804072152kc8f6617y7f2f2f37d0e3d688@mail.gmail.com>
	<5fdbf8630804072246m52218833yad5aa5c0d9aad218@mail.gmail.com>
Message-ID: <88e286470804072249m566531aodcb17080786364a1@mail.gmail.com>

What about my other questions:

How many different versions of Apache do you have installed?

What options did you use to 'configure' when building mod_python?

Did you use the 'install' target to 'make' or copy it by hand?

Do you also understand what I am talking about with the shared library
issue, not that it in itself should cause this problem.

Graham

2008/4/8 Kyle Simpson <kyle.simpson@gmail.com>:
> After doing that, new error:
>
> httpd: Syntax error on line 55 of /usr/local/apache28/conf/httpd.conf: API
> module structure 'python_module' in file /usr/loc?
>
> line 55 is:
> 55 LoadModule python_module modules/mod_python.so
>
> I did reconfigure/compile to see if that helped, but here's the ls -la
>
> 2857 -rwxr-xr-x    1 root     root      2911798 Apr  8 01:35 mod_python.so
>
> file
>
> /usr/local/apache28/modules/mod_python.so: ELF 32-bit LSB shared object,
> Intel 80386, version 1 (SYSV), not stripped
>
> ldd
> libpthread.so.0 => /lib/libpthread.so.0 (0x00111000)
>         libdl.so.2 => /lib/libdl.so.2 (0x00826000)
>         libutil.so.1 => /lib/libutil.so.1 (0x00162000)
>         libm.so.6 => /lib/libm.so.6 (0x00ee8000)
>          libc.so.6 => /lib/libc.so.6 (0x00832000)
>         /lib/ld-linux.so.2 => /lib/ld-linux.so.2 (0x00411000)
>
>
>
>
>
>
> On Tue, Apr 8, 2008 at 12:52 AM, Graham Dumpleton
> <graham.dumpleton@gmail.com> wrote:
>
> > Did you do a full stop and start of Apache, not just a restart/reload?
> >
> >
> > 2008/4/8 Kyle Simpson <kyle.simpson@gmail.com>:
> >
> > > 2857 -rwxr-xr-x    1 root     root      2911798 Apr  7 23:14
> > > /usr/local/apache28/modules/mod_python.so
> > >
> > > /usr/local/apache28/modules/mod_python.so: ELF 32-bit LSB shared object,
> > > Intel 80386, version 1 (SYSV), not stripped
> > >
> > >  libpthread.so.0 => /lib/libpthread.so.0 (0xb7e54000)
> > >         libdl.so.2 => /lib/libdl.so.2 (0xb7e50000)
> > >         libutil.so.1 => /lib/libutil.so.1 (0xb7e4d000)
> > >         libm.so.6 => /lib/libm.so.6 (0xb7e2c000)
> > >          libc.so.6 => /lib/libc.so.6 (0xb7d09000)
> > >         /lib/ld-linux.so.2 => /lib/ld-linux.so.2 (0xb7fee000)
> >
> > This all indicates that your Python has not been installed with a
> > shared library and that Python is being linked statically into
> > mod_python.so. This is generally not a good as it bloats your Apache
> > processes by a couple of MB in size. It can also cause issues,
> > especially when upgrading from older to newer mod_python and/or
> > different version of Python. Thus why it is important to do a full
> > stop of Apache when replacing mod_python.so in this case.
> >
> > For details of Python shared library issues, see:
> >
> >  http://code.google.com/p/modwsgi/wiki/InstallationIssues
> >
> > This is from mod_wsgi documentation, but same issues apply.
> >
> > BTW, one more possibility is if you have multiple versions of Apache
> > installed when mod_python was compiled it used the wrong header files.
> > How did you install mod_python.so.
> >
> > How many different versions of Apache do you have installed?
> >
> > What options did you use to 'configure' when building mod_python?
> >
> > Did you use the 'install' target to 'make' or copy it by hand?
> >
> > If copied by hand, maybe it was compiled against wrong version of
> > Apache for which you copied it into. You may want tp pay very careful
> > attention to the -I flags to compiler when mod_python was compiled.
> >
> > Graham
> >
> >
> >
> >
> > > On Tue, Apr 8, 2008 at 12:30 AM, Graham Dumpleton
> > > <graham.dumpleton@gmail.com> wrote:
> > >
> > > > What do you get when you run:
> > > >
> > > >  ls -las /usr/local/apache28/modules/mod_python.so
> > > >
> > > > and:
> > > >
> > > >
> > > >  file /usr/local/apache28/modules/mod_python.so
> > > >
> > > > and:
> > > >
> > > >  ldd /usr/local/apache28/modules/mod_python.so
> > > >
> > > > Graham
> > > >
> > > >
> > > >
> > > >
> > > > 2008/4/8 Kyle Simpson <kyle.simpson@gmail.com>:
> > > > > Hi Graham,
> > > > >
> > > > > Thanks for the quick reply.
> > > > >
> > > > > I compiled all 3: python,apache,mod python.  Did not use binaries
> for
> > > any of
> > > > > them.
> > > > >
> > > > >
> > > > >
> > > > > On Tue, Apr 8, 2008 at 12:22 AM, Graham Dumpleton
> > > > > <graham.dumpleton@gmail.com> wrote:
> > > > >
> > > > > > 2008/4/8 Kyle Simpson <kyle.simpson@gmail.com>:
> > > > > >
> > > > > >
> > > > > >
> > > > > > > Not sure what to make of this error.  I have apache 2.2.8,
> python
> > > 2.5.2
> > > > > and
> > > > > > > mod python 3.3.1.
> > > > > > >
> > > > > > > Any ideas?
> > > > > > >
> > > > > > >
> > > > > > > httpd: Syntax error on line 54 of
> > > /usr/local/apache28/conf/httpd.conf:
> > > > > API
> > > > > > > module structure 'python_module' in file
> > > > > > > /usr/local/apache28/modules/mod_python.so is garbled - expected
> > > > > signature
> > > > > > > 41503232 but saw 41503230 - perhaps this is not an Apache module
> > > DSO, or
> > > > > was
> > > > > > > compiled for a different Apache version?
> > > > > >
> > > > > > Exactly what it means.
> > > > > >
> > > > > > Did you compile mod_python yourself for that version of Apache or
> did
> > > > > > you just install a binary package from somewhere for both?
> > > > > >
> > > > > > I am assuming Apache has a concept of an internal ABI number. This
> is
> > > > > > changed whenever the ABI is changed. You may not be able to use a
> > > > > > precompiled module from an older version of Apache even if same
> > > > > > major/minor version, if this ABI has changed.
> > > > > >
> > > > > > Graham
> > > > > >
> > > > >
> > > > >
> > > >
> > >
> > >
> >
>
>
From kyle.simpson at gmail.com  Tue Apr  8 07:19:28 2008
From: kyle.simpson at gmail.com (Kyle Simpson)
Date: Tue Apr  8 07:19:35 2008
Subject: [mod_python] wrong version?
In-Reply-To: <88e286470804072249m566531aodcb17080786364a1@mail.gmail.com>
References: <5fdbf8630804072015y2dec1870i88d7ea59b87e4bdd@mail.gmail.com>
	<88e286470804072122t4bcb0213u78613747580b0426@mail.gmail.com>
	<5fdbf8630804072125o866c39ck87a377d559d289f@mail.gmail.com>
	<88e286470804072130xfe4da44p29b3f1b40f5dc61e@mail.gmail.com>
	<5fdbf8630804072142lb33ed89s35ef6fbafa1cee24@mail.gmail.com>
	<88e286470804072152kc8f6617y7f2f2f37d0e3d688@mail.gmail.com>
	<5fdbf8630804072246m52218833yad5aa5c0d9aad218@mail.gmail.com>
	<88e286470804072249m566531aodcb17080786364a1@mail.gmail.com>
Message-ID: <5fdbf8630804080419g6c970820me83061da374d8788@mail.gmail.com>

2 versions of apache

just ./configure --with-apxs=/usr/local/apache28/bin/apxs

I did make install

And no, I don't understand the shared library issue.  Unfortunately I'm
pretty much a noob, since any previous apache haven't required any modules.

Thanks for all the help.  Let me know if you have any other ideas.

On Tue, Apr 8, 2008 at 1:49 AM, Graham Dumpleton <graham.dumpleton@gmail.com>
wrote:

> What about my other questions:
>
> How many different versions of Apache do you have installed?
>
> What options did you use to 'configure' when building mod_python?
>
> Did you use the 'install' target to 'make' or copy it by hand?
>
> Do you also understand what I am talking about with the shared library
> issue, not that it in itself should cause this problem.
>
> Graham
>
> 2008/4/8 Kyle Simpson <kyle.simpson@gmail.com>:
> > After doing that, new error:
> >
> > httpd: Syntax error on line 55 of /usr/local/apache28/conf/httpd.conf:
> API
> > module structure 'python_module' in file /usr/loc?
> >
> > line 55 is:
> > 55 LoadModule python_module modules/mod_python.so
> >
> > I did reconfigure/compile to see if that helped, but here's the ls -la
> >
> > 2857 -rwxr-xr-x    1 root     root      2911798 Apr  8 01:35
> mod_python.so
> >
> > file
> >
> > /usr/local/apache28/modules/mod_python.so: ELF 32-bit LSB shared object,
> > Intel 80386, version 1 (SYSV), not stripped
> >
> > ldd
> > libpthread.so.0 => /lib/libpthread.so.0 (0x00111000)
> >         libdl.so.2 => /lib/libdl.so.2 (0x00826000)
> >         libutil.so.1 => /lib/libutil.so.1 (0x00162000)
> >         libm.so.6 => /lib/libm.so.6 (0x00ee8000)
> >          libc.so.6 => /lib/libc.so.6 (0x00832000)
> >         /lib/ld-linux.so.2 => /lib/ld-linux.so.2 (0x00411000)
> >
> >
> >
> >
> >
> >
> > On Tue, Apr 8, 2008 at 12:52 AM, Graham Dumpleton
> > <graham.dumpleton@gmail.com> wrote:
> >
> > > Did you do a full stop and start of Apache, not just a restart/reload?
> > >
> > >
> > > 2008/4/8 Kyle Simpson <kyle.simpson@gmail.com>:
> > >
> > > > 2857 -rwxr-xr-x    1 root     root      2911798 Apr  7 23:14
> > > > /usr/local/apache28/modules/mod_python.so
> > > >
> > > > /usr/local/apache28/modules/mod_python.so: ELF 32-bit LSB shared
> object,
> > > > Intel 80386, version 1 (SYSV), not stripped
> > > >
> > > >  libpthread.so.0 => /lib/libpthread.so.0 (0xb7e54000)
> > > >         libdl.so.2 => /lib/libdl.so.2 (0xb7e50000)
> > > >         libutil.so.1 => /lib/libutil.so.1 (0xb7e4d000)
> > > >         libm.so.6 => /lib/libm.so.6 (0xb7e2c000)
> > > >          libc.so.6 => /lib/libc.so.6 (0xb7d09000)
> > > >         /lib/ld-linux.so.2 => /lib/ld-linux.so.2 (0xb7fee000)
> > >
> > > This all indicates that your Python has not been installed with a
> > > shared library and that Python is being linked statically into
> > > mod_python.so. This is generally not a good as it bloats your Apache
> > > processes by a couple of MB in size. It can also cause issues,
> > > especially when upgrading from older to newer mod_python and/or
> > > different version of Python. Thus why it is important to do a full
> > > stop of Apache when replacing mod_python.so in this case.
> > >
> > > For details of Python shared library issues, see:
> > >
> > >  http://code.google.com/p/modwsgi/wiki/InstallationIssues
> > >
> > > This is from mod_wsgi documentation, but same issues apply.
> > >
> > > BTW, one more possibility is if you have multiple versions of Apache
> > > installed when mod_python was compiled it used the wrong header files.
> > > How did you install mod_python.so.
> > >
> > > How many different versions of Apache do you have installed?
> > >
> > > What options did you use to 'configure' when building mod_python?
> > >
> > > Did you use the 'install' target to 'make' or copy it by hand?
> > >
> > > If copied by hand, maybe it was compiled against wrong version of
> > > Apache for which you copied it into. You may want tp pay very careful
> > > attention to the -I flags to compiler when mod_python was compiled.
> > >
> > > Graham
> > >
> > >
> > >
> > >
> > > > On Tue, Apr 8, 2008 at 12:30 AM, Graham Dumpleton
> > > > <graham.dumpleton@gmail.com> wrote:
> > > >
> > > > > What do you get when you run:
> > > > >
> > > > >  ls -las /usr/local/apache28/modules/mod_python.so
> > > > >
> > > > > and:
> > > > >
> > > > >
> > > > >  file /usr/local/apache28/modules/mod_python.so
> > > > >
> > > > > and:
> > > > >
> > > > >  ldd /usr/local/apache28/modules/mod_python.so
> > > > >
> > > > > Graham
> > > > >
> > > > >
> > > > >
> > > > >
> > > > > 2008/4/8 Kyle Simpson <kyle.simpson@gmail.com>:
> > > > > > Hi Graham,
> > > > > >
> > > > > > Thanks for the quick reply.
> > > > > >
> > > > > > I compiled all 3: python,apache,mod python.  Did not use
> binaries
> > for
> > > > any of
> > > > > > them.
> > > > > >
> > > > > >
> > > > > >
> > > > > > On Tue, Apr 8, 2008 at 12:22 AM, Graham Dumpleton
> > > > > > <graham.dumpleton@gmail.com> wrote:
> > > > > >
> > > > > > > 2008/4/8 Kyle Simpson <kyle.simpson@gmail.com>:
> > > > > > >
> > > > > > >
> > > > > > >
> > > > > > > > Not sure what to make of this error.  I have apache 2.2.8,
> > python
> > > > 2.5.2
> > > > > > and
> > > > > > > > mod python 3.3.1.
> > > > > > > >
> > > > > > > > Any ideas?
> > > > > > > >
> > > > > > > >
> > > > > > > > httpd: Syntax error on line 54 of
> > > > /usr/local/apache28/conf/httpd.conf:
> > > > > > API
> > > > > > > > module structure 'python_module' in file
> > > > > > > > /usr/local/apache28/modules/mod_python.so is garbled -
> expected
> > > > > > signature
> > > > > > > > 41503232 but saw 41503230 - perhaps this is not an Apache
> module
> > > > DSO, or
> > > > > > was
> > > > > > > > compiled for a different Apache version?
> > > > > > >
> > > > > > > Exactly what it means.
> > > > > > >
> > > > > > > Did you compile mod_python yourself for that version of Apache
> or
> > did
> > > > > > > you just install a binary package from somewhere for both?
> > > > > > >
> > > > > > > I am assuming Apache has a concept of an internal ABI number.
> This
> > is
> > > > > > > changed whenever the ABI is changed. You may not be able to
> use a
> > > > > > > precompiled module from an older version of Apache even if
> same
> > > > > > > major/minor version, if this ABI has changed.
> > > > > > >
> > > > > > > Graham
> > > > > > >
> > > > > >
> > > > > >
> > > > >
> > > >
> > > >
> > >
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080408/b67d9a08/attachment.html
From joe at incomps.com  Tue Apr  8 12:12:38 2008
From: joe at incomps.com (Joseph Bernhardt)
Date: Tue Apr  8 12:12:47 2008
Subject: [mod_python] Importing modules in a new process.
Message-ID: <018901c89993$5e04bc30$1a0e3490$@com>

I have been having this problem for a while, but it has just recently gotten
to be enough of a bother that I thought I should figure out what's going on.
I have a simple application (myapp.py) as follows:

 

import my_module

import datetime

import sys

 

print "Hello World."

 

Which (of course) runs fine from the interpreter.  The problem is when I
start that application with the subprocess module via a separate application
through mod_python and a web request (initiate.py) as follows:

 

import subprocess

 

subprocess.Popen(['python myapp.py', shell=True)

 

When myapp.py is initiated through the Popen, it is unable to locate the
my_module module and fails.  When 'import my_module' is removed the
application completes fine, which leads me to believe it is a problem with
the my_module module.  Since I am able to run myapp.py fine from the
interpreter rather than remotely, I was assuming that there was a
permissions problem with the module.  Unfortunately, it still gave me the
same err with 777 permissions.  

 

Can anyone suggest where to go from here, please?  

 

Joseph Bernhardt 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080408/3f8c2f75/attachment.html
From clodoaldo.pinto.neto at gmail.com  Tue Apr  8 13:35:02 2008
From: clodoaldo.pinto.neto at gmail.com (Clodoaldo)
Date: Tue Apr  8 13:35:08 2008
Subject: [mod_python] Importing modules in a new process.
In-Reply-To: <018901c89993$5e04bc30$1a0e3490$@com>
References: <018901c89993$5e04bc30$1a0e3490$@com>
Message-ID: <a595de7a0804081035r6968ca65nb473f6d5161304b8@mail.gmail.com>

2008/4/8, Joseph Bernhardt <joe@incomps.com>:
>
>
>
>
> I have been having this problem for a while, but it has just recently gotten
> to be enough of a bother that I thought I should figure out what's going on.
>  I have a simple application (myapp.py) as follows:
>
>
>
> import my_module
>
> import datetime
>
> import sys
>
>
>
> print "Hello World."
>
>
>
> Which (of course) runs fine from the interpreter.  The problem is when I
> start that application with the subprocess module via a separate application
> through mod_python and a web request (initiate.py) as follows:
>
>
>
> import subprocess
>
>
>
> subprocess.Popen(['python myapp.py', shell=True)
>
>
>
> When myapp.py is initiated through the Popen, it is unable to locate the
> my_module module and fails.  When 'import my_module' is removed the
> application completes fine, which leads me to believe it is a problem with
> the my_module module.  Since I am able to run myapp.py fine from the
> interpreter rather than remotely, I was assuming that there was a
> permissions problem with the module.  Unfortunately, it still gave me the
> same err with 777 permissions.
>
>
>
> Can anyone suggest where to go from here, please?

What happens if you run this?:

import sys
path='/path/to/my/modules'

if path not in sys.path:
    sys.path.append(path)

import my_module
import datetime
import sys

print "Hello World."

Regards, Clodoaldo
From joe at incomps.com  Tue Apr  8 16:14:33 2008
From: joe at incomps.com (Joseph Bernhardt)
Date: Tue Apr  8 16:14:40 2008
Subject: [mod_python] Importing modules in a new process.
In-Reply-To: <a595de7a0804081035r6968ca65nb473f6d5161304b8@mail.gmail.com>
References: <018901c89993$5e04bc30$1a0e3490$@com>
	<a595de7a0804081035r6968ca65nb473f6d5161304b8@mail.gmail.com>
Message-ID: <000001c899b5$29466a30$7bd33e90$@com>

> 
> What happens if you run this?:
> 
> import sys
> path='/path/to/my/modules'
> 
> if path not in sys.path:
>     sys.path.append(path)
> 
> import my_module
> import datetime
> import sys
> 
> print "Hello World."
> 
> Regards, Clodoaldo

Thank you Clodoaldo!  This comment allowed me to figure out the primary source of my problem.  When starting a new python process via Popen, it is not only using an older version of python installed on the server, but is also using the module paths associated with that version!  I realize that this is no longer a mod_python problem, but I have been unable to post to the python-list or python-help forums through python.org (don't know why, but it keeps being returned as though my address has been blocked), so I was hoping you could tell me how to change the default python version on RHEL 2.6.9?  I have been searching all over and can't find how it is to be done!

Thanks again,

Joseph Bernhardt


From list at joreybump.com  Tue Apr  8 16:39:59 2008
From: list at joreybump.com (Jorey Bump)
Date: Tue Apr  8 16:40:05 2008
Subject: [mod_python] Importing modules in a new process.
In-Reply-To: <000001c899b5$29466a30$7bd33e90$@com>
References: <018901c89993$5e04bc30$1a0e3490$@com>	<a595de7a0804081035r6968ca65nb473f6d5161304b8@mail.gmail.com>
	<000001c899b5$29466a30$7bd33e90$@com>
Message-ID: <47FBD81F.1070801@joreybump.com>

Joseph Bernhardt wrote, at 04/08/2008 04:14 PM:

> When starting a new python process via
> Popen, it is not only using an older version of python installed on
> the server, but is also using the module paths associated with that
> version!  I realize that this is no longer a mod_python problem, but
> I have been unable to post to the python-list or python-help forums
> through python.org (don't know why, but it keeps being returned as
> though my address has been blocked), so I was hoping you could tell
> me how to change the default python version on RHEL 2.6.9?  I have
> been searching all over and can't find how it is to be done!

On most systems, python is just a symlink to another binary:

  $ which python
  /usr/bin/python
  $ ls -l /usr/bin/python
  lrwxrwxrwx 1 root root 9 2007-07-23 17:10 /usr/bin/python -> python2.5

For my example, I might do this (as root):

  rm /usr/bin/python
  ln -s /usr/local/bin/python3.0 /usr/bin/python

However, you probably shouldn't do this. Many distributions (and I think 
especially RHEL) provide system utilities written in python, and they 
target the version provided with the distribution. You could easily 
break your system or other applications that depend on python.

A better alternative would be to specify the full path to the desired 
version of python in your popen statement:

   subprocess.Popen(['/usr/local/bin/python3.0 myapp.py', shell=True)

This is not very portable, but that's what you get when you install 
multiple versions of python. Remember to change your code when you 
migrate it (or develop on a system where you can leave the defaults alone).

Of course, it's pretty strange to popen a python app in mod_python. Does 
it need to be a subprocess, as opposed to simply importing it and 
exposing a public API? The latter approach would be more beneficial in 
the long run.

From clodoaldo.pinto.neto at gmail.com  Tue Apr  8 16:41:22 2008
From: clodoaldo.pinto.neto at gmail.com (Clodoaldo)
Date: Tue Apr  8 16:41:27 2008
Subject: [mod_python] Importing modules in a new process.
In-Reply-To: <000001c899b5$29466a30$7bd33e90$@com>
References: <018901c89993$5e04bc30$1a0e3490$@com>
	<a595de7a0804081035r6968ca65nb473f6d5161304b8@mail.gmail.com>
	<000001c899b5$29466a30$7bd33e90$@com>
Message-ID: <a595de7a0804081341h638bd65eu8be743a77cabb508@mail.gmail.com>

2008/4/8, Joseph Bernhardt <joe@incomps.com>:
> >
>  > What happens if you run this?:
>  >
>  > import sys
>  > path='/path/to/my/modules'
>  >
>  > if path not in sys.path:
>  >     sys.path.append(path)
>  >
>  > import my_module
>  > import datetime
>  > import sys
>  >
>  > print "Hello World."
>  >
>  > Regards, Clodoaldo
>
>
> Thank you Clodoaldo!  This comment allowed me to figure out the primary source of my problem.  When starting a new python process via Popen, it is not only using an older version of python installed on the server, but is also using the module paths associated with that version!  I realize that this is no longer a mod_python problem, but I have been unable to post to the python-list or python-help forums through python.org (don't know why, but it keeps being returned as though my address has been blocked), so I was hoping you could tell me how to change the default python version on RHEL 2.6.9?  I have been searching all over and can't find how it is to be done!

The first thing that comes to my mind is to point the simlink
/usr/bin/python to the version you want. That could break everything
that depends on the old version.

Much safer is to make your script executable and put this line at the top of it:

#!/path/to/my/python/executable

Regards, Clodoaldo
From joe at incomps.com  Tue Apr  8 17:29:23 2008
From: joe at incomps.com (Joseph Bernhardt)
Date: Tue Apr  8 17:29:31 2008
Subject: [mod_python] Importing modules in a new process.
In-Reply-To: <47FBD81F.1070801@joreybump.com>
References: <018901c89993$5e04bc30$1a0e3490$@com>	<a595de7a0804081035r6968ca65nb473f6d5161304b8@mail.gmail.com>
	<000001c899b5$29466a30$7bd33e90$@com>
	<47FBD81F.1070801@joreybump.com>
Message-ID: <000101c899bf$9dd8bf10$d98a3d30$@com>

Thank you for the help Clodoaldo and Jorey!

It looks like the path /usr/bin/python is pointing to version 2.3 while the path /usr/local/bin/python is pointing to 2.5.  'python' itself would point to the latter while on the command line and would point to the former through Popen.  So, I just changed the initiation script to do a Popen which included the full path to version 2.5, which now works!

Obviously I have much to learn about the linux system.  Thanks for putting up with me!

Joe


From kyle.simpson at gmail.com  Tue Apr  8 17:34:15 2008
From: kyle.simpson at gmail.com (Kyle Simpson)
Date: Tue Apr  8 17:34:21 2008
Subject: [mod_python] wrong version?
In-Reply-To: <5fdbf8630804080419g6c970820me83061da374d8788@mail.gmail.com>
References: <5fdbf8630804072015y2dec1870i88d7ea59b87e4bdd@mail.gmail.com>
	<88e286470804072122t4bcb0213u78613747580b0426@mail.gmail.com>
	<5fdbf8630804072125o866c39ck87a377d559d289f@mail.gmail.com>
	<88e286470804072130xfe4da44p29b3f1b40f5dc61e@mail.gmail.com>
	<5fdbf8630804072142lb33ed89s35ef6fbafa1cee24@mail.gmail.com>
	<88e286470804072152kc8f6617y7f2f2f37d0e3d688@mail.gmail.com>
	<5fdbf8630804072246m52218833yad5aa5c0d9aad218@mail.gmail.com>
	<88e286470804072249m566531aodcb17080786364a1@mail.gmail.com>
	<5fdbf8630804080419g6c970820me83061da374d8788@mail.gmail.com>
Message-ID: <5fdbf8630804081434taf28ba4u616e81282682a59b@mail.gmail.com>

Any other ideas on this topic?

httpd: Syntax error on line 55 of /usr/local/apache28/conf/httpd.conf: API
module structure 'python_module' in file
/usr/local/apache28/modules/mod_python.so is garbled - expected signature
41503232 but saw 41503230 - perhaps this is not an Apache module DSO, or was
compiled for a different Apache version?

running on 2.6.9-023stab044.11-smp

apache 2.2.8 (second install, which was in /usr/local/apache28

python 2.5.2


Thanks,
Kyle

On Tue, Apr 8, 2008 at 7:19 AM, Kyle Simpson <kyle.simpson@gmail.com> wrote:

> 2 versions of apache
>
> just ./configure --with-apxs=/usr/local/apache28/bin/apxs
>
> I did make install
>
> And no, I don't understand the shared library issue.  Unfortunately I'm
> pretty much a noob, since any previous apache haven't required any modules.
>
> Thanks for all the help.  Let me know if you have any other ideas.
>
>
> On Tue, Apr 8, 2008 at 1:49 AM, Graham Dumpleton <
> graham.dumpleton@gmail.com> wrote:
>
> > What about my other questions:
> >
> > How many different versions of Apache do you have installed?
> >
> > What options did you use to 'configure' when building mod_python?
> >
> > Did you use the 'install' target to 'make' or copy it by hand?
> >
> > Do you also understand what I am talking about with the shared library
> > issue, not that it in itself should cause this problem.
> >
> > Graham
> >
> > 2008/4/8 Kyle Simpson <kyle.simpson@gmail.com>:
> > > After doing that, new error:
> > >
> > > httpd: Syntax error on line 55 of /usr/local/apache28/conf/httpd.conf:
> > API
> > > module structure 'python_module' in file /usr/loc?
> > >
> > > line 55 is:
> > > 55 LoadModule python_module modules/mod_python.so
> > >
> > > I did reconfigure/compile to see if that helped, but here's the ls -la
> > >
> > > 2857 -rwxr-xr-x    1 root     root      2911798 Apr  8 01:35
> > mod_python.so
> > >
> > > file
> > >
> > > /usr/local/apache28/modules/mod_python.so: ELF 32-bit LSB shared
> > object,
> > > Intel 80386, version 1 (SYSV), not stripped
> > >
> > > ldd
> > > libpthread.so.0 => /lib/libpthread.so.0 (0x00111000)
> > >         libdl.so.2 => /lib/libdl.so.2 (0x00826000)
> > >         libutil.so.1 => /lib/libutil.so.1 (0x00162000)
> > >         libm.so.6 => /lib/libm.so.6 (0x00ee8000)
> > >          libc.so.6 => /lib/libc.so.6 (0x00832000)
> > >         /lib/ld-linux.so.2 => /lib/ld-linux.so.2 (0x00411000)
> > >
> > >
> > >
> > >
> > >
> > >
> > > On Tue, Apr 8, 2008 at 12:52 AM, Graham Dumpleton
> > > <graham.dumpleton@gmail.com> wrote:
> > >
> > > > Did you do a full stop and start of Apache, not just a
> > restart/reload?
> > > >
> > > >
> > > > 2008/4/8 Kyle Simpson <kyle.simpson@gmail.com>:
> > > >
> > > > > 2857 -rwxr-xr-x    1 root     root      2911798 Apr  7 23:14
> > > > > /usr/local/apache28/modules/mod_python.so
> > > > >
> > > > > /usr/local/apache28/modules/mod_python.so: ELF 32-bit LSB shared
> > object,
> > > > > Intel 80386, version 1 (SYSV), not stripped
> > > > >
> > > > >  libpthread.so.0 => /lib/libpthread.so.0 (0xb7e54000)
> > > > >         libdl.so.2 => /lib/libdl.so.2 (0xb7e50000)
> > > > >         libutil.so.1 => /lib/libutil.so.1 (0xb7e4d000)
> > > > >         libm.so.6 => /lib/libm.so.6 (0xb7e2c000)
> > > > >          libc.so.6 => /lib/libc.so.6 (0xb7d09000)
> > > > >         /lib/ld-linux.so.2 => /lib/ld-linux.so.2 (0xb7fee000)
> > > >
> > > > This all indicates that your Python has not been installed with a
> > > > shared library and that Python is being linked statically into
> > > > mod_python.so. This is generally not a good as it bloats your Apache
> > > > processes by a couple of MB in size. It can also cause issues,
> > > > especially when upgrading from older to newer mod_python and/or
> > > > different version of Python. Thus why it is important to do a full
> > > > stop of Apache when replacing mod_python.so in this case.
> > > >
> > > > For details of Python shared library issues, see:
> > > >
> > > >  http://code.google.com/p/modwsgi/wiki/InstallationIssues
> > > >
> > > > This is from mod_wsgi documentation, but same issues apply.
> > > >
> > > > BTW, one more possibility is if you have multiple versions of Apache
> > > > installed when mod_python was compiled it used the wrong header
> > files.
> > > > How did you install mod_python.so.
> > > >
> > > > How many different versions of Apache do you have installed?
> > > >
> > > > What options did you use to 'configure' when building mod_python?
> > > >
> > > > Did you use the 'install' target to 'make' or copy it by hand?
> > > >
> > > > If copied by hand, maybe it was compiled against wrong version of
> > > > Apache for which you copied it into. You may want tp pay very
> > careful
> > > > attention to the -I flags to compiler when mod_python was compiled.
> > > >
> > > > Graham
> > > >
> > > >
> > > >
> > > >
> > > > > On Tue, Apr 8, 2008 at 12:30 AM, Graham Dumpleton
> > > > > <graham.dumpleton@gmail.com> wrote:
> > > > >
> > > > > > What do you get when you run:
> > > > > >
> > > > > >  ls -las /usr/local/apache28/modules/mod_python.so
> > > > > >
> > > > > > and:
> > > > > >
> > > > > >
> > > > > >  file /usr/local/apache28/modules/mod_python.so
> > > > > >
> > > > > > and:
> > > > > >
> > > > > >  ldd /usr/local/apache28/modules/mod_python.so
> > > > > >
> > > > > > Graham
> > > > > >
> > > > > >
> > > > > >
> > > > > >
> > > > > > 2008/4/8 Kyle Simpson <kyle.simpson@gmail.com>:
> > > > > > > Hi Graham,
> > > > > > >
> > > > > > > Thanks for the quick reply.
> > > > > > >
> > > > > > > I compiled all 3: python,apache,mod python.  Did not use
> > binaries
> > > for
> > > > > any of
> > > > > > > them.
> > > > > > >
> > > > > > >
> > > > > > >
> > > > > > > On Tue, Apr 8, 2008 at 12:22 AM, Graham Dumpleton
> > > > > > > <graham.dumpleton@gmail.com> wrote:
> > > > > > >
> > > > > > > > 2008/4/8 Kyle Simpson <kyle.simpson@gmail.com>:
> > > > > > > >
> > > > > > > >
> > > > > > > >
> > > > > > > > > Not sure what to make of this error.  I have apache 2.2.8,
> > > python
> > > > > 2.5.2
> > > > > > > and
> > > > > > > > > mod python 3.3.1.
> > > > > > > > >
> > > > > > > > > Any ideas?
> > > > > > > > >
> > > > > > > > >
> > > > > > > > > httpd: Syntax error on line 54 of
> > > > > /usr/local/apache28/conf/httpd.conf:
> > > > > > > API
> > > > > > > > > module structure 'python_module' in file
> > > > > > > > > /usr/local/apache28/modules/mod_python.so is garbled -
> > expected
> > > > > > > signature
> > > > > > > > > 41503232 but saw 41503230 - perhaps this is not an Apache
> > module
> > > > > DSO, or
> > > > > > > was
> > > > > > > > > compiled for a different Apache version?
> > > > > > > >
> > > > > > > > Exactly what it means.
> > > > > > > >
> > > > > > > > Did you compile mod_python yourself for that version of
> > Apache or
> > > did
> > > > > > > > you just install a binary package from somewhere for both?
> > > > > > > >
> > > > > > > > I am assuming Apache has a concept of an internal ABI
> > number. This
> > > is
> > > > > > > > changed whenever the ABI is changed. You may not be able to
> > use a
> > > > > > > > precompiled module from an older version of Apache even if
> > same
> > > > > > > > major/minor version, if this ABI has changed.
> > > > > > > >
> > > > > > > > Graham
> > > > > > > >
> > > > > > >
> > > > > > >
> > > > > >
> > > > >
> > > > >
> > > >
> > >
> > >
> >
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080408/95bbba55/attachment-0001.html
From graham.dumpleton at gmail.com  Tue Apr  8 20:17:13 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue Apr  8 20:17:18 2008
Subject: [mod_python] Report Lab integration
In-Reply-To: <BAY123-W7BEFB1726DA5CD9AD4F60F4F20@phx.gbl>
References: <BAY123-W36169A767918DBFA38A45BF4F30@phx.gbl>
	<88e286470804071549u550a1cb2t3f29e9ef3a289cba@mail.gmail.com>
	<BAY123-W7BEFB1726DA5CD9AD4F60F4F20@phx.gbl>
Message-ID: <88e286470804081717x4fc89c95occ88297a7c6427c5@mail.gmail.com>

2008/4/9 David Evans <devans725@hotmail.com>:
>
>  Hello,
>
>  I am speaking of the original post at the bottom:
>
>  http://www.modpython.org/pipermail/mod_python/2006-October/022340.html

But which links are broken? The link:

  http://www.dscpl.com.au/projects/vampire/source/examples/reportlab/reportlab-demo.py

still works fine.

PS. Please keep followups on mod_python mailing list.

Graham

> Thank you.
>
>  > Date: Tue, 8 Apr 2008 08:49:02 +1000
> > From: graham.dumpleton@gmail.com
> > To: devans725@hotmail.com
> > Subject: Re: [mod_python] Report Lab integration
> > CC: mod_python@modpython.org
>
>
> >
> > 2008/4/8 David Evans <devans725@hotmail.com>:
> > >
> > > I found a thread regarding this but the links to the examples were
> broken.
> > > I want to create a PDF based on user input and send it to the browser.
> Any
> > > advice would be appreciated thank you.
> >
> > Where was the thread? If it was in mod_python mailing list archive and
> > you are talking about a broken link to attachment then we can tell you
> > want it should be.
> >
> > All the same, if you point at the previous discussion it will possibly
> > tells us more about what you want to do than above. Using ReportLab
> > isn't that hard, so from above not real clear what the problem you are
> > having is.
> >
> > Graham
>
>
> ________________________________
> Get in touch in an instant. Get Windows Live Messenger now.
From graham.dumpleton at gmail.com  Tue Apr  8 20:28:04 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue Apr  8 20:28:10 2008
Subject: [mod_python] wrong version?
In-Reply-To: <5fdbf8630804081434taf28ba4u616e81282682a59b@mail.gmail.com>
References: <5fdbf8630804072015y2dec1870i88d7ea59b87e4bdd@mail.gmail.com>
	<88e286470804072122t4bcb0213u78613747580b0426@mail.gmail.com>
	<5fdbf8630804072125o866c39ck87a377d559d289f@mail.gmail.com>
	<88e286470804072130xfe4da44p29b3f1b40f5dc61e@mail.gmail.com>
	<5fdbf8630804072142lb33ed89s35ef6fbafa1cee24@mail.gmail.com>
	<88e286470804072152kc8f6617y7f2f2f37d0e3d688@mail.gmail.com>
	<5fdbf8630804072246m52218833yad5aa5c0d9aad218@mail.gmail.com>
	<88e286470804072249m566531aodcb17080786364a1@mail.gmail.com>
	<5fdbf8630804080419g6c970820me83061da374d8788@mail.gmail.com>
	<5fdbf8630804081434taf28ba4u616e81282682a59b@mail.gmail.com>
Message-ID: <88e286470804081728n7313bdc3xd8003baca7767ad7@mail.gmail.com>

2008/4/9 Kyle Simpson <kyle.simpson@gmail.com>:
> Any other ideas on this topic?

As I said before, the problem is that you are managing to either
install mod_python.so into the wrong installation or you have compiled
it against the header files for the wrong version of Apache.

The proof of this is that the magic number your mod_python.so has equates to:

  #define MODULE_MAGIC_COOKIE 0x41503230UL /* "AP20" */

whereas Apache is expecting:

  #define MODULE_MAGIC_COOKIE 0x41503232UL /* "AP22" */

Do you have header files installed in the following directory?

  /usr/local/apache28/include

Are those header files readable to the user that you are compiling mod_python?

Look in the header file 'ap_mmn.h' in that directory, what is the
value of MODULE_MAGIC_COOKIE?

Now go find where the header files for your other Apache installation
are located and find what its value of MODULE_MAGIC_COOKIE is? What
directory are those header files in?

To work out why it is picking up wrong header files, as I suggested
before, look at the -I flags used when compiler is run on mod_python
source code. For example on my system I get:

/usr/local/apache-2.2.4/bin/apxs
-I/Users/grahamd/Projects/mod_python-trunk/src/include
-I/System/Library/Frameworks/Python.framework/Versions/2.3/include/python2.3
-DNDEBUG -Wc,'-arch ppc' -c mod_python.c _apachemodule.c
requestobject.c tableobject.c util.c serverobject.c connobject.c
filterobject.c hlist.c hlistobject.c finfoobject.c -arch ppc
-Wl,-F/System/Library/Frameworks -framework Python -u __dummy -u
_PyMac_Error -framework System  -framework CoreServices -framework
Foundation -ldl

What do you get?

Graham

> httpd: Syntax error on line 55 of /usr/local/apache28/conf/httpd.conf: API
> module structure 'python_module' in file
> /usr/local/apache28/modules/mod_python.so is garbled - expected signature
> 41503232 but saw 41503230 - perhaps this is not an Apache module DSO, or was
> compiled for a different Apache version?
>
> running on 2.6.9-023stab044.11-smp
>
> apache 2.2.8 (second install, which was in /usr/local/apache28
>
> python 2.5.2
>
>
> Thanks,
> Kyle
>
>
>
> On Tue, Apr 8, 2008 at 7:19 AM, Kyle Simpson <kyle.simpson@gmail.com> wrote:
>
> > 2 versions of apache
> >
> > just ./configure --with-apxs=/usr/local/apache28/bin/apxs
> >
> > I did make install
> >
> > And no, I don't understand the shared library issue.  Unfortunately I'm
> pretty much a noob, since any previous apache haven't required any modules.
> >
> > Thanks for all the help.  Let me know if you have any other ideas.
> >
> >
> >
> >
> >
> > On Tue, Apr 8, 2008 at 1:49 AM, Graham Dumpleton
> <graham.dumpleton@gmail.com> wrote:
> >
> > > What about my other questions:
> > >
> > >
> > > How many different versions of Apache do you have installed?
> > >
> > > What options did you use to 'configure' when building mod_python?
> > >
> > > Did you use the 'install' target to 'make' or copy it by hand?
> > >
> > > Do you also understand what I am talking about with the shared library
> > > issue, not that it in itself should cause this problem.
> > >
> > >
> > >
> > >
> > > Graham
> > >
> > > 2008/4/8 Kyle Simpson <kyle.simpson@gmail.com>:
> > > > After doing that, new error:
> > > >
> > > > httpd: Syntax error on line 55 of /usr/local/apache28/conf/httpd.conf:
> API
> > > > module structure 'python_module' in file /usr/loc?
> > > >
> > > > line 55 is:
> > > > 55 LoadModule python_module modules/mod_python.so
> > > >
> > > > I did reconfigure/compile to see if that helped, but here's the ls -la
> > > >
> > > > 2857 -rwxr-xr-x    1 root     root      2911798 Apr  8 01:35
> mod_python.so
> > > >
> > > > file
> > > >
> > > > /usr/local/apache28/modules/mod_python.so: ELF 32-bit LSB shared
> object,
> > > > Intel 80386, version 1 (SYSV), not stripped
> > > >
> > > > ldd
> > > > libpthread.so.0 => /lib/libpthread.so.0 (0x00111000)
> > > >         libdl.so.2 => /lib/libdl.so.2 (0x00826000)
> > > >         libutil.so.1 => /lib/libutil.so.1 (0x00162000)
> > > >         libm.so.6 => /lib/libm.so.6 (0x00ee8000)
> > > >          libc.so.6 => /lib/libc.so.6 (0x00832000)
> > > >         /lib/ld-linux.so.2 => /lib/ld-linux.so.2 (0x00411000)
> > > >
> > > >
> > > >
> > > >
> > > >
> > > >
> > > > On Tue, Apr 8, 2008 at 12:52 AM, Graham Dumpleton
> > > > <graham.dumpleton@gmail.com> wrote:
> > > >
> > > > > Did you do a full stop and start of Apache, not just a
> restart/reload?
> > > > >
> > > > >
> > > > > 2008/4/8 Kyle Simpson <kyle.simpson@gmail.com>:
> > > > >
> > > > > > 2857 -rwxr-xr-x    1 root     root      2911798 Apr  7 23:14
> > > > > > /usr/local/apache28/modules/mod_python.so
> > > > > >
> > > > > > /usr/local/apache28/modules/mod_python.so: ELF 32-bit LSB shared
> object,
> > > > > > Intel 80386, version 1 (SYSV), not stripped
> > > > > >
> > > > > >  libpthread.so.0 => /lib/libpthread.so.0 (0xb7e54000)
> > > > > >         libdl.so.2 => /lib/libdl.so.2 (0xb7e50000)
> > > > > >         libutil.so.1 => /lib/libutil.so.1 (0xb7e4d000)
> > > > > >         libm.so.6 => /lib/libm.so.6 (0xb7e2c000)
> > > > > >          libc.so.6 => /lib/libc.so.6 (0xb7d09000)
> > > > > >         /lib/ld-linux.so.2 => /lib/ld-linux.so.2 (0xb7fee000)
> > > > >
> > > > > This all indicates that your Python has not been installed with a
> > > > > shared library and that Python is being linked statically into
> > > > > mod_python.so. This is generally not a good as it bloats your Apache
> > > > > processes by a couple of MB in size. It can also cause issues,
> > > > > especially when upgrading from older to newer mod_python and/or
> > > > > different version of Python. Thus why it is important to do a full
> > > > > stop of Apache when replacing mod_python.so in this case.
> > > > >
> > > > > For details of Python shared library issues, see:
> > > > >
> > > > >  http://code.google.com/p/modwsgi/wiki/InstallationIssues
> > > > >
> > > > > This is from mod_wsgi documentation, but same issues apply.
> > > > >
> > > > > BTW, one more possibility is if you have multiple versions of Apache
> > > > > installed when mod_python was compiled it used the wrong header
> files.
> > > > > How did you install mod_python.so.
> > > > >
> > > > > How many different versions of Apache do you have installed?
> > > > >
> > > > > What options did you use to 'configure' when building mod_python?
> > > > >
> > > > > Did you use the 'install' target to 'make' or copy it by hand?
> > > > >
> > > > > If copied by hand, maybe it was compiled against wrong version of
> > > > > Apache for which you copied it into. You may want tp pay very
> careful
> > > > > attention to the -I flags to compiler when mod_python was compiled.
> > > > >
> > > > > Graham
> > > > >
> > > > >
> > > > >
> > > > >
> > > > > > On Tue, Apr 8, 2008 at 12:30 AM, Graham Dumpleton
> > > > > > <graham.dumpleton@gmail.com> wrote:
> > > > > >
> > > > > > > What do you get when you run:
> > > > > > >
> > > > > > >  ls -las /usr/local/apache28/modules/mod_python.so
> > > > > > >
> > > > > > > and:
> > > > > > >
> > > > > > >
> > > > > > >  file /usr/local/apache28/modules/mod_python.so
> > > > > > >
> > > > > > > and:
> > > > > > >
> > > > > > >  ldd /usr/local/apache28/modules/mod_python.so
> > > > > > >
> > > > > > > Graham
> > > > > > >
> > > > > > >
> > > > > > >
> > > > > > >
> > > > > > > 2008/4/8 Kyle Simpson <kyle.simpson@gmail.com>:
> > > > > > > > Hi Graham,
> > > > > > > >
> > > > > > > > Thanks for the quick reply.
> > > > > > > >
> > > > > > > > I compiled all 3: python,apache,mod python.  Did not use
> binaries
> > > > for
> > > > > > any of
> > > > > > > > them.
> > > > > > > >
> > > > > > > >
> > > > > > > >
> > > > > > > > On Tue, Apr 8, 2008 at 12:22 AM, Graham Dumpleton
> > > > > > > > <graham.dumpleton@gmail.com> wrote:
> > > > > > > >
> > > > > > > > > 2008/4/8 Kyle Simpson <kyle.simpson@gmail.com>:
> > > > > > > > >
> > > > > > > > >
> > > > > > > > >
> > > > > > > > > > Not sure what to make of this error.  I have apache 2.2.8,
> > > > python
> > > > > > 2.5.2
> > > > > > > > and
> > > > > > > > > > mod python 3.3.1.
> > > > > > > > > >
> > > > > > > > > > Any ideas?
> > > > > > > > > >
> > > > > > > > > >
> > > > > > > > > > httpd: Syntax error on line 54 of
> > > > > > /usr/local/apache28/conf/httpd.conf:
> > > > > > > > API
> > > > > > > > > > module structure 'python_module' in file
> > > > > > > > > > /usr/local/apache28/modules/mod_python.so is garbled -
> expected
> > > > > > > > signature
> > > > > > > > > > 41503232 but saw 41503230 - perhaps this is not an Apache
> module
> > > > > > DSO, or
> > > > > > > > was
> > > > > > > > > > compiled for a different Apache version?
> > > > > > > > >
> > > > > > > > > Exactly what it means.
> > > > > > > > >
> > > > > > > > > Did you compile mod_python yourself for that version of
> Apache or
> > > > did
> > > > > > > > > you just install a binary package from somewhere for both?
> > > > > > > > >
> > > > > > > > > I am assuming Apache has a concept of an internal ABI
> number. This
> > > > is
> > > > > > > > > changed whenever the ABI is changed. You may not be able to
> use a
> > > > > > > > > precompiled module from an older version of Apache even if
> same
> > > > > > > > > major/minor version, if this ABI has changed.
> > > > > > > > >
> > > > > > > > > Graham
> > > > > > > > >
> > > > > > > >
> > > > > > > >
> > > > > > >
> > > > > >
> > > > > >
> > > > >
> > > >
> > > >
> > >
> >
> >
>
>
From tjd at sfu.ca  Tue Apr  8 22:06:28 2008
From: tjd at sfu.ca (Toby Donaldson)
Date: Tue Apr  8 22:06:34 2008
Subject: [mod_python] testing mod_python on Ubuntu
Message-ID: <a2f565170804081906g1b2bbe6bx37b023311d99765d@mail.gmail.com>

Hi,

I've gotten stuck testing mod_python on Ubuntu (Gutsy) on what I
assume some simple oversight on my part. I'm using the standard
packages from apt-get:

mod_python 3.3.1
python 2.5.1
apache 2.2.4

Following http://modpython.org/live/current/doc-html/inst-testing.html,
I've added this to http.conf:

    <Directory /mptest>
        AddHandler mod_python .py
        PythonHandler mptest
        PythonDebug On
    </Directory>

In the mptest directory, I have mptest.py with these contents:

from mod_python import apache

def handler(req):
      req.content_type = 'text/plain'
      req.write('mptest.py\n')
      return apache.OK

Yet every time I access mptest.py through the web, Firefox asks if I
want to view or save the file mptest.py. I've tried a number of
variations of this (re-starting Apache after each change), but it
always gives the same results.

I did get mod_python.testhanlder working.

Any advice on how to proceed?

Toby
-- 
Dr. Toby Donaldson
School of Computing Science
Simon Fraser University (Surrey)
From graham.dumpleton at gmail.com  Tue Apr  8 22:13:07 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue Apr  8 22:13:13 2008
Subject: [mod_python] testing mod_python on Ubuntu
In-Reply-To: <a2f565170804081906g1b2bbe6bx37b023311d99765d@mail.gmail.com>
References: <a2f565170804081906g1b2bbe6bx37b023311d99765d@mail.gmail.com>
Message-ID: <88e286470804081913o78b2a0f2ucce48e6cfa309e64@mail.gmail.com>

For starters, read:

  http://www.dscpl.com.au/wiki/ModPython/Articles/GettingModPythonWorking

and follow its debugging tips.

Graham

2008/4/9 Toby Donaldson <tjd@sfu.ca>:
> Hi,
>
>  I've gotten stuck testing mod_python on Ubuntu (Gutsy) on what I
>  assume some simple oversight on my part. I'm using the standard
>  packages from apt-get:
>
>  mod_python 3.3.1
>  python 2.5.1
>  apache 2.2.4
>
>  Following http://modpython.org/live/current/doc-html/inst-testing.html,
>  I've added this to http.conf:
>
>     <Directory /mptest>
>         AddHandler mod_python .py
>         PythonHandler mptest
>         PythonDebug On
>     </Directory>
>
>  In the mptest directory, I have mptest.py with these contents:
>
>  from mod_python import apache
>
>  def handler(req):
>       req.content_type = 'text/plain'
>       req.write('mptest.py\n')
>       return apache.OK
>
>  Yet every time I access mptest.py through the web, Firefox asks if I
>  want to view or save the file mptest.py. I've tried a number of
>  variations of this (re-starting Apache after each change), but it
>  always gives the same results.
>
>  I did get mod_python.testhanlder working.
>
>  Any advice on how to proceed?
>
>  Toby
>  --
>  Dr. Toby Donaldson
>  School of Computing Science
>  Simon Fraser University (Surrey)
>  _______________________________________________
>  Mod_python mailing list
>  Mod_python@modpython.org
>  http://mailman.modpython.org/mailman/listinfo/mod_python
>
From kyle.simpson at gmail.com  Tue Apr  8 22:30:04 2008
From: kyle.simpson at gmail.com (Kyle Simpson)
Date: Tue Apr  8 22:30:09 2008
Subject: [mod_python] wrong version?
In-Reply-To: <88e286470804081728n7313bdc3xd8003baca7767ad7@mail.gmail.com>
References: <5fdbf8630804072015y2dec1870i88d7ea59b87e4bdd@mail.gmail.com>
	<5fdbf8630804072125o866c39ck87a377d559d289f@mail.gmail.com>
	<88e286470804072130xfe4da44p29b3f1b40f5dc61e@mail.gmail.com>
	<5fdbf8630804072142lb33ed89s35ef6fbafa1cee24@mail.gmail.com>
	<88e286470804072152kc8f6617y7f2f2f37d0e3d688@mail.gmail.com>
	<5fdbf8630804072246m52218833yad5aa5c0d9aad218@mail.gmail.com>
	<88e286470804072249m566531aodcb17080786364a1@mail.gmail.com>
	<5fdbf8630804080419g6c970820me83061da374d8788@mail.gmail.com>
	<5fdbf8630804081434taf28ba4u616e81282682a59b@mail.gmail.com>
	<88e286470804081728n7313bdc3xd8003baca7767ad7@mail.gmail.com>
Message-ID: <5fdbf8630804081930u7ee1b119j8b8960befd9e319a@mail.gmail.com>

Yes there are header files in /usr/local/apache28/include

Value is: #define MODULE_MAGIC_COOKIE 0x41503232UL /* "AP22" */

In older version, it is:
#define MODULE_MAGIC_COOKIE 0x41503232UL /* "AP22" */

How do you determine the -l flags when the compiler is run?

Thanks.

On Tue, Apr 8, 2008 at 8:28 PM, Graham Dumpleton <graham.dumpleton@gmail.com>
wrote:

> 2008/4/9 Kyle Simpson <kyle.simpson@gmail.com>:
> > Any other ideas on this topic?
>
> As I said before, the problem is that you are managing to either
> install mod_python.so into the wrong installation or you have compiled
> it against the header files for the wrong version of Apache.
>
> The proof of this is that the magic number your mod_python.so has equates
> to:
>
>  #define MODULE_MAGIC_COOKIE 0x41503230UL /* "AP20" */
>
> whereas Apache is expecting:
>
>  #define MODULE_MAGIC_COOKIE 0x41503232UL /* "AP22" */
>
> Do you have header files installed in the following directory?
>
>  /usr/local/apache28/include
>
> Are those header files readable to the user that you are compiling
> mod_python?
>
> Look in the header file 'ap_mmn.h' in that directory, what is the
> value of MODULE_MAGIC_COOKIE?
>
> Now go find where the header files for your other Apache installation
> are located and find what its value of MODULE_MAGIC_COOKIE is? What
> directory are those header files in?
>
> To work out why it is picking up wrong header files, as I suggested
> before, look at the -I flags used when compiler is run on mod_python
> source code. For example on my system I get:
>
> /usr/local/apache-2.2.4/bin/apxs
> -I/Users/grahamd/Projects/mod_python-trunk/src/include
>
> -I/System/Library/Frameworks/Python.framework/Versions/2.3/include/python2.3
> -DNDEBUG -Wc,'-arch ppc' -c mod_python.c _apachemodule.c
> requestobject.c tableobject.c util.c serverobject.c connobject.c
> filterobject.c hlist.c hlistobject.c finfoobject.c -arch ppc
> -Wl,-F/System/Library/Frameworks -framework Python -u __dummy -u
> _PyMac_Error -framework System  -framework CoreServices -framework
> Foundation -ldl
>
> What do you get?
>
> Graham
>
> > httpd: Syntax error on line 55 of /usr/local/apache28/conf/httpd.conf:
> API
> > module structure 'python_module' in file
> > /usr/local/apache28/modules/mod_python.so is garbled - expected
> signature
> > 41503232 but saw 41503230 - perhaps this is not an Apache module DSO, or
> was
> > compiled for a different Apache version?
> >
> > running on 2.6.9-023stab044.11-smp
> >
> > apache 2.2.8 (second install, which was in /usr/local/apache28
> >
> > python 2.5.2
> >
> >
> > Thanks,
> > Kyle
> >
> >
> >
> > On Tue, Apr 8, 2008 at 7:19 AM, Kyle Simpson <kyle.simpson@gmail.com>
> wrote:
> >
> > > 2 versions of apache
> > >
> > > just ./configure --with-apxs=/usr/local/apache28/bin/apxs
> > >
> > > I did make install
> > >
> > > And no, I don't understand the shared library issue.  Unfortunately
> I'm
> > pretty much a noob, since any previous apache haven't required any
> modules.
> > >
> > > Thanks for all the help.  Let me know if you have any other ideas.
> > >
> > >
> > >
> > >
> > >
> > > On Tue, Apr 8, 2008 at 1:49 AM, Graham Dumpleton
> > <graham.dumpleton@gmail.com> wrote:
> > >
> > > > What about my other questions:
> > > >
> > > >
> > > > How many different versions of Apache do you have installed?
> > > >
> > > > What options did you use to 'configure' when building mod_python?
> > > >
> > > > Did you use the 'install' target to 'make' or copy it by hand?
> > > >
> > > > Do you also understand what I am talking about with the shared
> library
> > > > issue, not that it in itself should cause this problem.
> > > >
> > > >
> > > >
> > > >
> > > > Graham
> > > >
> > > > 2008/4/8 Kyle Simpson <kyle.simpson@gmail.com>:
> > > > > After doing that, new error:
> > > > >
> > > > > httpd: Syntax error on line 55 of
> /usr/local/apache28/conf/httpd.conf:
> > API
> > > > > module structure 'python_module' in file /usr/loc?
> > > > >
> > > > > line 55 is:
> > > > > 55 LoadModule python_module modules/mod_python.so
> > > > >
> > > > > I did reconfigure/compile to see if that helped, but here's the ls
> -la
> > > > >
> > > > > 2857 -rwxr-xr-x    1 root     root      2911798 Apr  8 01:35
> > mod_python.so
> > > > >
> > > > > file
> > > > >
> > > > > /usr/local/apache28/modules/mod_python.so: ELF 32-bit LSB shared
> > object,
> > > > > Intel 80386, version 1 (SYSV), not stripped
> > > > >
> > > > > ldd
> > > > > libpthread.so.0 => /lib/libpthread.so.0 (0x00111000)
> > > > >         libdl.so.2 => /lib/libdl.so.2 (0x00826000)
> > > > >         libutil.so.1 => /lib/libutil.so.1 (0x00162000)
> > > > >         libm.so.6 => /lib/libm.so.6 (0x00ee8000)
> > > > >          libc.so.6 => /lib/libc.so.6 (0x00832000)
> > > > >         /lib/ld-linux.so.2 => /lib/ld-linux.so.2 (0x00411000)
> > > > >
> > > > >
> > > > >
> > > > >
> > > > >
> > > > >
> > > > > On Tue, Apr 8, 2008 at 12:52 AM, Graham Dumpleton
> > > > > <graham.dumpleton@gmail.com> wrote:
> > > > >
> > > > > > Did you do a full stop and start of Apache, not just a
> > restart/reload?
> > > > > >
> > > > > >
> > > > > > 2008/4/8 Kyle Simpson <kyle.simpson@gmail.com>:
> > > > > >
> > > > > > > 2857 -rwxr-xr-x    1 root     root      2911798 Apr  7 23:14
> > > > > > > /usr/local/apache28/modules/mod_python.so
> > > > > > >
> > > > > > > /usr/local/apache28/modules/mod_python.so: ELF 32-bit LSB
> shared
> > object,
> > > > > > > Intel 80386, version 1 (SYSV), not stripped
> > > > > > >
> > > > > > >  libpthread.so.0 => /lib/libpthread.so.0 (0xb7e54000)
> > > > > > >         libdl.so.2 => /lib/libdl.so.2 (0xb7e50000)
> > > > > > >         libutil.so.1 => /lib/libutil.so.1 (0xb7e4d000)
> > > > > > >         libm.so.6 => /lib/libm.so.6 (0xb7e2c000)
> > > > > > >          libc.so.6 => /lib/libc.so.6 (0xb7d09000)
> > > > > > >         /lib/ld-linux.so.2 => /lib/ld-linux.so.2 (0xb7fee000)
> > > > > >
> > > > > > This all indicates that your Python has not been installed with
> a
> > > > > > shared library and that Python is being linked statically into
> > > > > > mod_python.so. This is generally not a good as it bloats your
> Apache
> > > > > > processes by a couple of MB in size. It can also cause issues,
> > > > > > especially when upgrading from older to newer mod_python and/or
> > > > > > different version of Python. Thus why it is important to do a
> full
> > > > > > stop of Apache when replacing mod_python.so in this case.
> > > > > >
> > > > > > For details of Python shared library issues, see:
> > > > > >
> > > > > >  http://code.google.com/p/modwsgi/wiki/InstallationIssues
> > > > > >
> > > > > > This is from mod_wsgi documentation, but same issues apply.
> > > > > >
> > > > > > BTW, one more possibility is if you have multiple versions of
> Apache
> > > > > > installed when mod_python was compiled it used the wrong header
> > files.
> > > > > > How did you install mod_python.so.
> > > > > >
> > > > > > How many different versions of Apache do you have installed?
> > > > > >
> > > > > > What options did you use to 'configure' when building
> mod_python?
> > > > > >
> > > > > > Did you use the 'install' target to 'make' or copy it by hand?
> > > > > >
> > > > > > If copied by hand, maybe it was compiled against wrong version
> of
> > > > > > Apache for which you copied it into. You may want tp pay very
> > careful
> > > > > > attention to the -I flags to compiler when mod_python was
> compiled.
> > > > > >
> > > > > > Graham
> > > > > >
> > > > > >
> > > > > >
> > > > > >
> > > > > > > On Tue, Apr 8, 2008 at 12:30 AM, Graham Dumpleton
> > > > > > > <graham.dumpleton@gmail.com> wrote:
> > > > > > >
> > > > > > > > What do you get when you run:
> > > > > > > >
> > > > > > > >  ls -las /usr/local/apache28/modules/mod_python.so
> > > > > > > >
> > > > > > > > and:
> > > > > > > >
> > > > > > > >
> > > > > > > >  file /usr/local/apache28/modules/mod_python.so
> > > > > > > >
> > > > > > > > and:
> > > > > > > >
> > > > > > > >  ldd /usr/local/apache28/modules/mod_python.so
> > > > > > > >
> > > > > > > > Graham
> > > > > > > >
> > > > > > > >
> > > > > > > >
> > > > > > > >
> > > > > > > > 2008/4/8 Kyle Simpson <kyle.simpson@gmail.com>:
> > > > > > > > > Hi Graham,
> > > > > > > > >
> > > > > > > > > Thanks for the quick reply.
> > > > > > > > >
> > > > > > > > > I compiled all 3: python,apache,mod python.  Did not use
> > binaries
> > > > > for
> > > > > > > any of
> > > > > > > > > them.
> > > > > > > > >
> > > > > > > > >
> > > > > > > > >
> > > > > > > > > On Tue, Apr 8, 2008 at 12:22 AM, Graham Dumpleton
> > > > > > > > > <graham.dumpleton@gmail.com> wrote:
> > > > > > > > >
> > > > > > > > > > 2008/4/8 Kyle Simpson <kyle.simpson@gmail.com>:
> > > > > > > > > >
> > > > > > > > > >
> > > > > > > > > >
> > > > > > > > > > > Not sure what to make of this error.  I have apache
> 2.2.8,
> > > > > python
> > > > > > > 2.5.2
> > > > > > > > > and
> > > > > > > > > > > mod python 3.3.1.
> > > > > > > > > > >
> > > > > > > > > > > Any ideas?
> > > > > > > > > > >
> > > > > > > > > > >
> > > > > > > > > > > httpd: Syntax error on line 54 of
> > > > > > > /usr/local/apache28/conf/httpd.conf:
> > > > > > > > > API
> > > > > > > > > > > module structure 'python_module' in file
> > > > > > > > > > > /usr/local/apache28/modules/mod_python.so is garbled -
> > expected
> > > > > > > > > signature
> > > > > > > > > > > 41503232 but saw 41503230 - perhaps this is not an
> Apache
> > module
> > > > > > > DSO, or
> > > > > > > > > was
> > > > > > > > > > > compiled for a different Apache version?
> > > > > > > > > >
> > > > > > > > > > Exactly what it means.
> > > > > > > > > >
> > > > > > > > > > Did you compile mod_python yourself for that version of
> > Apache or
> > > > > did
> > > > > > > > > > you just install a binary package from somewhere for
> both?
> > > > > > > > > >
> > > > > > > > > > I am assuming Apache has a concept of an internal ABI
> > number. This
> > > > > is
> > > > > > > > > > changed whenever the ABI is changed. You may not be able
> to
> > use a
> > > > > > > > > > precompiled module from an older version of Apache even
> if
> > same
> > > > > > > > > > major/minor version, if this ABI has changed.
> > > > > > > > > >
> > > > > > > > > > Graham
> > > > > > > > > >
> > > > > > > > >
> > > > > > > > >
> > > > > > > >
> > > > > > >
> > > > > > >
> > > > > >
> > > > >
> > > > >
> > > >
> > >
> > >
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080408/ae961f2b/attachment-0001.html
From graham.dumpleton at gmail.com  Tue Apr  8 22:35:17 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue Apr  8 22:35:22 2008
Subject: [mod_python] wrong version?
In-Reply-To: <5fdbf8630804081930u7ee1b119j8b8960befd9e319a@mail.gmail.com>
References: <5fdbf8630804072015y2dec1870i88d7ea59b87e4bdd@mail.gmail.com>
	<88e286470804072130xfe4da44p29b3f1b40f5dc61e@mail.gmail.com>
	<5fdbf8630804072142lb33ed89s35ef6fbafa1cee24@mail.gmail.com>
	<88e286470804072152kc8f6617y7f2f2f37d0e3d688@mail.gmail.com>
	<5fdbf8630804072246m52218833yad5aa5c0d9aad218@mail.gmail.com>
	<88e286470804072249m566531aodcb17080786364a1@mail.gmail.com>
	<5fdbf8630804080419g6c970820me83061da374d8788@mail.gmail.com>
	<5fdbf8630804081434taf28ba4u616e81282682a59b@mail.gmail.com>
	<88e286470804081728n7313bdc3xd8003baca7767ad7@mail.gmail.com>
	<5fdbf8630804081930u7ee1b119j8b8960befd9e319a@mail.gmail.com>
Message-ID: <88e286470804081935s67c043cfje0d7c2e33349a478@mail.gmail.com>

2008/4/9 Kyle Simpson <kyle.simpson@gmail.com>:
> Yes there are header files in /usr/local/apache28/include
>
> Value is: #define MODULE_MAGIC_COOKIE 0x41503232UL /* "AP22" */
>
> In older version, it is:
>
> #define MODULE_MAGIC_COOKIE 0x41503232UL /* "AP22" */

But that is the same, so how can it be an older version, unless it
differs only by patch level. The magic string it complains about is
for Apache 2.0 so you must have that installed somewhere.

> How do you determine the -l flags when the compiler is run?

I gave an example:

/usr/local/apache-2.2.4/bin/apxs
-I/Users/grahamd/Projects/mod_python-trunk/src/include
-I/System/Library/Frameworks/Python.framework/Versions/2.3/include/python2.3
-DNDEBUG -Wc,'-arch ppc' -c mod_python.c _apachemodule.c
requestobject.c tableobject.c util.c serverobject.c connobject.c
filterobject.c hlist.c hlistobject.c finfoobject.c -arch ppc
-Wl,-F/System/Library/Frameworks -framework Python -u __dummy -u
_PyMac_Error -framework System  -framework CoreServices -framework
Foundation -ldl

See the -I flags in there.

You will see this when you run 'make' to build mod_python. Find the
equivalent invocation of apxs to compile mod_python when you build it
and post that small subset of lines which shows the -I flags.

Graham

> Thanks.
>
>
>
> On Tue, Apr 8, 2008 at 8:28 PM, Graham Dumpleton
> <graham.dumpleton@gmail.com> wrote:
>
> > 2008/4/9 Kyle Simpson <kyle.simpson@gmail.com>:
> >
> > > Any other ideas on this topic?
> >
> > As I said before, the problem is that you are managing to either
> > install mod_python.so into the wrong installation or you have compiled
> > it against the header files for the wrong version of Apache.
> >
> > The proof of this is that the magic number your mod_python.so has equates
> to:
> >
> >  #define MODULE_MAGIC_COOKIE 0x41503230UL /* "AP20" */
> >
> > whereas Apache is expecting:
> >
> >  #define MODULE_MAGIC_COOKIE 0x41503232UL /* "AP22" */
> >
> > Do you have header files installed in the following directory?
> >
> >  /usr/local/apache28/include
> >
> > Are those header files readable to the user that you are compiling
> mod_python?
> >
> > Look in the header file 'ap_mmn.h' in that directory, what is the
> > value of MODULE_MAGIC_COOKIE?
> >
> > Now go find where the header files for your other Apache installation
> > are located and find what its value of MODULE_MAGIC_COOKIE is? What
> > directory are those header files in?
> >
> > To work out why it is picking up wrong header files, as I suggested
> > before, look at the -I flags used when compiler is run on mod_python
> > source code. For example on my system I get:
> >
> > /usr/local/apache-2.2.4/bin/apxs
> > -I/Users/grahamd/Projects/mod_python-trunk/src/include
> >
> -I/System/Library/Frameworks/Python.framework/Versions/2.3/include/python2.3
> > -DNDEBUG -Wc,'-arch ppc' -c mod_python.c _apachemodule.c
> > requestobject.c tableobject.c util.c serverobject.c connobject.c
> > filterobject.c hlist.c hlistobject.c finfoobject.c -arch ppc
> > -Wl,-F/System/Library/Frameworks -framework Python -u __dummy -u
> > _PyMac_Error -framework System  -framework CoreServices -framework
> > Foundation -ldl
> >
> > What do you get?
> >
> > Graham
> >
> >
> >
> >
> > > httpd: Syntax error on line 55 of /usr/local/apache28/conf/httpd.conf:
> API
> > > module structure 'python_module' in file
> > > /usr/local/apache28/modules/mod_python.so is garbled - expected
> signature
> > > 41503232 but saw 41503230 - perhaps this is not an Apache module DSO, or
> was
> > > compiled for a different Apache version?
> > >
> > > running on 2.6.9-023stab044.11-smp
> > >
> > > apache 2.2.8 (second install, which was in /usr/local/apache28
> > >
> > > python 2.5.2
> > >
> > >
> > > Thanks,
> > > Kyle
> > >
> > >
> > >
> > > On Tue, Apr 8, 2008 at 7:19 AM, Kyle Simpson <kyle.simpson@gmail.com>
> wrote:
> > >
> > > > 2 versions of apache
> > > >
> > > > just ./configure --with-apxs=/usr/local/apache28/bin/apxs
> > > >
> > > > I did make install
> > > >
> > > > And no, I don't understand the shared library issue.  Unfortunately
> I'm
> > > pretty much a noob, since any previous apache haven't required any
> modules.
> > > >
> > > > Thanks for all the help.  Let me know if you have any other ideas.
> > > >
> > > >
> > > >
> > > >
> > > >
> > > > On Tue, Apr 8, 2008 at 1:49 AM, Graham Dumpleton
> > > <graham.dumpleton@gmail.com> wrote:
> > > >
> > > > > What about my other questions:
> > > > >
> > > > >
> > > > > How many different versions of Apache do you have installed?
> > > > >
> > > > > What options did you use to 'configure' when building mod_python?
> > > > >
> > > > > Did you use the 'install' target to 'make' or copy it by hand?
> > > > >
> > > > > Do you also understand what I am talking about with the shared
> library
> > > > > issue, not that it in itself should cause this problem.
> > > > >
> > > > >
> > > > >
> > > > >
> > > > > Graham
> > > > >
> > > > > 2008/4/8 Kyle Simpson <kyle.simpson@gmail.com>:
> > > > > > After doing that, new error:
> > > > > >
> > > > > > httpd: Syntax error on line 55 of
> /usr/local/apache28/conf/httpd.conf:
> > > API
> > > > > > module structure 'python_module' in file /usr/loc?
> > > > > >
> > > > > > line 55 is:
> > > > > > 55 LoadModule python_module modules/mod_python.so
> > > > > >
> > > > > > I did reconfigure/compile to see if that helped, but here's the ls
> -la
> > > > > >
> > > > > > 2857 -rwxr-xr-x    1 root     root      2911798 Apr  8 01:35
> > > mod_python.so
> > > > > >
> > > > > > file
> > > > > >
> > > > > > /usr/local/apache28/modules/mod_python.so: ELF 32-bit LSB shared
> > > object,
> > > > > > Intel 80386, version 1 (SYSV), not stripped
> > > > > >
> > > > > > ldd
> > > > > > libpthread.so.0 => /lib/libpthread.so.0 (0x00111000)
> > > > > >         libdl.so.2 => /lib/libdl.so.2 (0x00826000)
> > > > > >         libutil.so.1 => /lib/libutil.so.1 (0x00162000)
> > > > > >         libm.so.6 => /lib/libm.so.6 (0x00ee8000)
> > > > > >          libc.so.6 => /lib/libc.so.6 (0x00832000)
> > > > > >         /lib/ld-linux.so.2 => /lib/ld-linux.so.2 (0x00411000)
> > > > > >
> > > > > >
> > > > > >
> > > > > >
> > > > > >
> > > > > >
> > > > > > On Tue, Apr 8, 2008 at 12:52 AM, Graham Dumpleton
> > > > > > <graham.dumpleton@gmail.com> wrote:
> > > > > >
> > > > > > > Did you do a full stop and start of Apache, not just a
> > > restart/reload?
> > > > > > >
> > > > > > >
> > > > > > > 2008/4/8 Kyle Simpson <kyle.simpson@gmail.com>:
> > > > > > >
> > > > > > > > 2857 -rwxr-xr-x    1 root     root      2911798 Apr  7 23:14
> > > > > > > > /usr/local/apache28/modules/mod_python.so
> > > > > > > >
> > > > > > > > /usr/local/apache28/modules/mod_python.so: ELF 32-bit LSB
> shared
> > > object,
> > > > > > > > Intel 80386, version 1 (SYSV), not stripped
> > > > > > > >
> > > > > > > >  libpthread.so.0 => /lib/libpthread.so.0 (0xb7e54000)
> > > > > > > >         libdl.so.2 => /lib/libdl.so.2 (0xb7e50000)
> > > > > > > >         libutil.so.1 => /lib/libutil.so.1 (0xb7e4d000)
> > > > > > > >         libm.so.6 => /lib/libm.so.6 (0xb7e2c000)
> > > > > > > >          libc.so.6 => /lib/libc.so.6 (0xb7d09000)
> > > > > > > >         /lib/ld-linux.so.2 => /lib/ld-linux.so.2 (0xb7fee000)
> > > > > > >
> > > > > > > This all indicates that your Python has not been installed with
> a
> > > > > > > shared library and that Python is being linked statically into
> > > > > > > mod_python.so. This is generally not a good as it bloats your
> Apache
> > > > > > > processes by a couple of MB in size. It can also cause issues,
> > > > > > > especially when upgrading from older to newer mod_python and/or
> > > > > > > different version of Python. Thus why it is important to do a
> full
> > > > > > > stop of Apache when replacing mod_python.so in this case.
> > > > > > >
> > > > > > > For details of Python shared library issues, see:
> > > > > > >
> > > > > > >  http://code.google.com/p/modwsgi/wiki/InstallationIssues
> > > > > > >
> > > > > > > This is from mod_wsgi documentation, but same issues apply.
> > > > > > >
> > > > > > > BTW, one more possibility is if you have multiple versions of
> Apache
> > > > > > > installed when mod_python was compiled it used the wrong header
> > > files.
> > > > > > > How did you install mod_python.so.
> > > > > > >
> > > > > > > How many different versions of Apache do you have installed?
> > > > > > >
> > > > > > > What options did you use to 'configure' when building
> mod_python?
> > > > > > >
> > > > > > > Did you use the 'install' target to 'make' or copy it by hand?
> > > > > > >
> > > > > > > If copied by hand, maybe it was compiled against wrong version
> of
> > > > > > > Apache for which you copied it into. You may want tp pay very
> > > careful
> > > > > > > attention to the -I flags to compiler when mod_python was
> compiled.
> > > > > > >
> > > > > > > Graham
> > > > > > >
> > > > > > >
> > > > > > >
> > > > > > >
> > > > > > > > On Tue, Apr 8, 2008 at 12:30 AM, Graham Dumpleton
> > > > > > > > <graham.dumpleton@gmail.com> wrote:
> > > > > > > >
> > > > > > > > > What do you get when you run:
> > > > > > > > >
> > > > > > > > >  ls -las /usr/local/apache28/modules/mod_python.so
> > > > > > > > >
> > > > > > > > > and:
> > > > > > > > >
> > > > > > > > >
> > > > > > > > >  file /usr/local/apache28/modules/mod_python.so
> > > > > > > > >
> > > > > > > > > and:
> > > > > > > > >
> > > > > > > > >  ldd /usr/local/apache28/modules/mod_python.so
> > > > > > > > >
> > > > > > > > > Graham
> > > > > > > > >
> > > > > > > > >
> > > > > > > > >
> > > > > > > > >
> > > > > > > > > 2008/4/8 Kyle Simpson <kyle.simpson@gmail.com>:
> > > > > > > > > > Hi Graham,
> > > > > > > > > >
> > > > > > > > > > Thanks for the quick reply.
> > > > > > > > > >
> > > > > > > > > > I compiled all 3: python,apache,mod python.  Did not use
> > > binaries
> > > > > > for
> > > > > > > > any of
> > > > > > > > > > them.
> > > > > > > > > >
> > > > > > > > > >
> > > > > > > > > >
> > > > > > > > > > On Tue, Apr 8, 2008 at 12:22 AM, Graham Dumpleton
> > > > > > > > > > <graham.dumpleton@gmail.com> wrote:
> > > > > > > > > >
> > > > > > > > > > > 2008/4/8 Kyle Simpson <kyle.simpson@gmail.com>:
> > > > > > > > > > >
> > > > > > > > > > >
> > > > > > > > > > >
> > > > > > > > > > > > Not sure what to make of this error.  I have apache
> 2.2.8,
> > > > > > python
> > > > > > > > 2.5.2
> > > > > > > > > > and
> > > > > > > > > > > > mod python 3.3.1.
> > > > > > > > > > > >
> > > > > > > > > > > > Any ideas?
> > > > > > > > > > > >
> > > > > > > > > > > >
> > > > > > > > > > > > httpd: Syntax error on line 54 of
> > > > > > > > /usr/local/apache28/conf/httpd.conf:
> > > > > > > > > > API
> > > > > > > > > > > > module structure 'python_module' in file
> > > > > > > > > > > > /usr/local/apache28/modules/mod_python.so is garbled -
> > > expected
> > > > > > > > > > signature
> > > > > > > > > > > > 41503232 but saw 41503230 - perhaps this is not an
> Apache
> > > module
> > > > > > > > DSO, or
> > > > > > > > > > was
> > > > > > > > > > > > compiled for a different Apache version?
> > > > > > > > > > >
> > > > > > > > > > > Exactly what it means.
> > > > > > > > > > >
> > > > > > > > > > > Did you compile mod_python yourself for that version of
> > > Apache or
> > > > > > did
> > > > > > > > > > > you just install a binary package from somewhere for
> both?
> > > > > > > > > > >
> > > > > > > > > > > I am assuming Apache has a concept of an internal ABI
> > > number. This
> > > > > > is
> > > > > > > > > > > changed whenever the ABI is changed. You may not be able
> to
> > > use a
> > > > > > > > > > > precompiled module from an older version of Apache even
> if
> > > same
> > > > > > > > > > > major/minor version, if this ABI has changed.
> > > > > > > > > > >
> > > > > > > > > > > Graham
> > > > > > > > > > >
> > > > > > > > > >
> > > > > > > > > >
> > > > > > > > >
> > > > > > > >
> > > > > > > >
> > > > > > >
> > > > > >
> > > > > >
> > > > >
> > > >
> > > >
> > >
> > >
> >
>
>
From kyle.simpson at gmail.com  Tue Apr  8 22:43:08 2008
From: kyle.simpson at gmail.com (Kyle Simpson)
Date: Tue Apr  8 22:43:13 2008
Subject: [mod_python] wrong version?
In-Reply-To: <88e286470804081935s67c043cfje0d7c2e33349a478@mail.gmail.com>
References: <5fdbf8630804072015y2dec1870i88d7ea59b87e4bdd@mail.gmail.com>
	<5fdbf8630804072142lb33ed89s35ef6fbafa1cee24@mail.gmail.com>
	<88e286470804072152kc8f6617y7f2f2f37d0e3d688@mail.gmail.com>
	<5fdbf8630804072246m52218833yad5aa5c0d9aad218@mail.gmail.com>
	<88e286470804072249m566531aodcb17080786364a1@mail.gmail.com>
	<5fdbf8630804080419g6c970820me83061da374d8788@mail.gmail.com>
	<5fdbf8630804081434taf28ba4u616e81282682a59b@mail.gmail.com>
	<88e286470804081728n7313bdc3xd8003baca7767ad7@mail.gmail.com>
	<5fdbf8630804081930u7ee1b119j8b8960befd9e319a@mail.gmail.com>
	<88e286470804081935s67c043cfje0d7c2e33349a478@mail.gmail.com>
Message-ID: <5fdbf8630804081943m8b5e3c3y454e600efddaec7d@mail.gmail.com>

Hi Graham

Thanks for all your help on this.

I started over from the tgz and did configure and make.

Turns out that everytime I did make and make install, it wasn't recompiling,
even though I had different options with ./configure (specifying which
apache)

DUH!

On Tue, Apr 8, 2008 at 10:35 PM, Graham Dumpleton <
graham.dumpleton@gmail.com> wrote:

> 2008/4/9 Kyle Simpson <kyle.simpson@gmail.com>:
> > Yes there are header files in /usr/local/apache28/include
> >
> > Value is: #define MODULE_MAGIC_COOKIE 0x41503232UL /* "AP22" */
> >
> > In older version, it is:
> >
> > #define MODULE_MAGIC_COOKIE 0x41503232UL /* "AP22" */
>
> But that is the same, so how can it be an older version, unless it
> differs only by patch level. The magic string it complains about is
> for Apache 2.0 so you must have that installed somewhere.
>
> > How do you determine the -l flags when the compiler is run?
>
> I gave an example:
>
> /usr/local/apache-2.2.4/bin/apxs
> -I/Users/grahamd/Projects/mod_python-trunk/src/include
>
> -I/System/Library/Frameworks/Python.framework/Versions/2.3/include/python2.3
> -DNDEBUG -Wc,'-arch ppc' -c mod_python.c _apachemodule.c
> requestobject.c tableobject.c util.c serverobject.c connobject.c
> filterobject.c hlist.c hlistobject.c finfoobject.c -arch ppc
> -Wl,-F/System/Library/Frameworks -framework Python -u __dummy -u
> _PyMac_Error -framework System  -framework CoreServices -framework
> Foundation -ldl
>
> See the -I flags in there.
>
> You will see this when you run 'make' to build mod_python. Find the
> equivalent invocation of apxs to compile mod_python when you build it
> and post that small subset of lines which shows the -I flags.
>
> Graham
>
> > Thanks.
> >
> >
> >
> > On Tue, Apr 8, 2008 at 8:28 PM, Graham Dumpleton
> > <graham.dumpleton@gmail.com> wrote:
> >
> > > 2008/4/9 Kyle Simpson <kyle.simpson@gmail.com>:
> > >
> > > > Any other ideas on this topic?
> > >
> > > As I said before, the problem is that you are managing to either
> > > install mod_python.so into the wrong installation or you have compiled
> > > it against the header files for the wrong version of Apache.
> > >
> > > The proof of this is that the magic number your mod_python.so has
> equates
> > to:
> > >
> > >  #define MODULE_MAGIC_COOKIE 0x41503230UL /* "AP20" */
> > >
> > > whereas Apache is expecting:
> > >
> > >  #define MODULE_MAGIC_COOKIE 0x41503232UL /* "AP22" */
> > >
> > > Do you have header files installed in the following directory?
> > >
> > >  /usr/local/apache28/include
> > >
> > > Are those header files readable to the user that you are compiling
> > mod_python?
> > >
> > > Look in the header file 'ap_mmn.h' in that directory, what is the
> > > value of MODULE_MAGIC_COOKIE?
> > >
> > > Now go find where the header files for your other Apache installation
> > > are located and find what its value of MODULE_MAGIC_COOKIE is? What
> > > directory are those header files in?
> > >
> > > To work out why it is picking up wrong header files, as I suggested
> > > before, look at the -I flags used when compiler is run on mod_python
> > > source code. For example on my system I get:
> > >
> > > /usr/local/apache-2.2.4/bin/apxs
> > > -I/Users/grahamd/Projects/mod_python-trunk/src/include
> > >
> >
> -I/System/Library/Frameworks/Python.framework/Versions/2.3/include/python2.3
> > > -DNDEBUG -Wc,'-arch ppc' -c mod_python.c _apachemodule.c
> > > requestobject.c tableobject.c util.c serverobject.c connobject.c
> > > filterobject.c hlist.c hlistobject.c finfoobject.c -arch ppc
> > > -Wl,-F/System/Library/Frameworks -framework Python -u __dummy -u
> > > _PyMac_Error -framework System  -framework CoreServices -framework
> > > Foundation -ldl
> > >
> > > What do you get?
> > >
> > > Graham
> > >
> > >
> > >
> > >
> > > > httpd: Syntax error on line 55 of
> /usr/local/apache28/conf/httpd.conf:
> > API
> > > > module structure 'python_module' in file
> > > > /usr/local/apache28/modules/mod_python.so is garbled - expected
> > signature
> > > > 41503232 but saw 41503230 - perhaps this is not an Apache module
> DSO, or
> > was
> > > > compiled for a different Apache version?
> > > >
> > > > running on 2.6.9-023stab044.11-smp
> > > >
> > > > apache 2.2.8 (second install, which was in /usr/local/apache28
> > > >
> > > > python 2.5.2
> > > >
> > > >
> > > > Thanks,
> > > > Kyle
> > > >
> > > >
> > > >
> > > > On Tue, Apr 8, 2008 at 7:19 AM, Kyle Simpson <kyle.simpson@gmail.com
> >
> > wrote:
> > > >
> > > > > 2 versions of apache
> > > > >
> > > > > just ./configure --with-apxs=/usr/local/apache28/bin/apxs
> > > > >
> > > > > I did make install
> > > > >
> > > > > And no, I don't understand the shared library issue.
>  Unfortunately
> > I'm
> > > > pretty much a noob, since any previous apache haven't required any
> > modules.
> > > > >
> > > > > Thanks for all the help.  Let me know if you have any other ideas.
> > > > >
> > > > >
> > > > >
> > > > >
> > > > >
> > > > > On Tue, Apr 8, 2008 at 1:49 AM, Graham Dumpleton
> > > > <graham.dumpleton@gmail.com> wrote:
> > > > >
> > > > > > What about my other questions:
> > > > > >
> > > > > >
> > > > > > How many different versions of Apache do you have installed?
> > > > > >
> > > > > > What options did you use to 'configure' when building
> mod_python?
> > > > > >
> > > > > > Did you use the 'install' target to 'make' or copy it by hand?
> > > > > >
> > > > > > Do you also understand what I am talking about with the shared
> > library
> > > > > > issue, not that it in itself should cause this problem.
> > > > > >
> > > > > >
> > > > > >
> > > > > >
> > > > > > Graham
> > > > > >
> > > > > > 2008/4/8 Kyle Simpson <kyle.simpson@gmail.com>:
> > > > > > > After doing that, new error:
> > > > > > >
> > > > > > > httpd: Syntax error on line 55 of
> > /usr/local/apache28/conf/httpd.conf:
> > > > API
> > > > > > > module structure 'python_module' in file /usr/loc?
> > > > > > >
> > > > > > > line 55 is:
> > > > > > > 55 LoadModule python_module modules/mod_python.so
> > > > > > >
> > > > > > > I did reconfigure/compile to see if that helped, but here's
> the ls
> > -la
> > > > > > >
> > > > > > > 2857 -rwxr-xr-x    1 root     root      2911798 Apr  8 01:35
> > > > mod_python.so
> > > > > > >
> > > > > > > file
> > > > > > >
> > > > > > > /usr/local/apache28/modules/mod_python.so: ELF 32-bit LSB
> shared
> > > > object,
> > > > > > > Intel 80386, version 1 (SYSV), not stripped
> > > > > > >
> > > > > > > ldd
> > > > > > > libpthread.so.0 => /lib/libpthread.so.0 (0x00111000)
> > > > > > >         libdl.so.2 => /lib/libdl.so.2 (0x00826000)
> > > > > > >         libutil.so.1 => /lib/libutil.so.1 (0x00162000)
> > > > > > >         libm.so.6 => /lib/libm.so.6 (0x00ee8000)
> > > > > > >          libc.so.6 => /lib/libc.so.6 (0x00832000)
> > > > > > >         /lib/ld-linux.so.2 => /lib/ld-linux.so.2 (0x00411000)
> > > > > > >
> > > > > > >
> > > > > > >
> > > > > > >
> > > > > > >
> > > > > > >
> > > > > > > On Tue, Apr 8, 2008 at 12:52 AM, Graham Dumpleton
> > > > > > > <graham.dumpleton@gmail.com> wrote:
> > > > > > >
> > > > > > > > Did you do a full stop and start of Apache, not just a
> > > > restart/reload?
> > > > > > > >
> > > > > > > >
> > > > > > > > 2008/4/8 Kyle Simpson <kyle.simpson@gmail.com>:
> > > > > > > >
> > > > > > > > > 2857 -rwxr-xr-x    1 root     root      2911798 Apr  7
> 23:14
> > > > > > > > > /usr/local/apache28/modules/mod_python.so
> > > > > > > > >
> > > > > > > > > /usr/local/apache28/modules/mod_python.so: ELF 32-bit LSB
> > shared
> > > > object,
> > > > > > > > > Intel 80386, version 1 (SYSV), not stripped
> > > > > > > > >
> > > > > > > > >  libpthread.so.0 => /lib/libpthread.so.0 (0xb7e54000)
> > > > > > > > >         libdl.so.2 => /lib/libdl.so.2 (0xb7e50000)
> > > > > > > > >         libutil.so.1 => /lib/libutil.so.1 (0xb7e4d000)
> > > > > > > > >         libm.so.6 => /lib/libm.so.6 (0xb7e2c000)
> > > > > > > > >          libc.so.6 => /lib/libc.so.6 (0xb7d09000)
> > > > > > > > >         /lib/ld-linux.so.2 => /lib/ld-linux.so.2
> (0xb7fee000)
> > > > > > > >
> > > > > > > > This all indicates that your Python has not been installed
> with
> > a
> > > > > > > > shared library and that Python is being linked statically
> into
> > > > > > > > mod_python.so. This is generally not a good as it bloats
> your
> > Apache
> > > > > > > > processes by a couple of MB in size. It can also cause
> issues,
> > > > > > > > especially when upgrading from older to newer mod_python
> and/or
> > > > > > > > different version of Python. Thus why it is important to do
> a
> > full
> > > > > > > > stop of Apache when replacing mod_python.so in this case.
> > > > > > > >
> > > > > > > > For details of Python shared library issues, see:
> > > > > > > >
> > > > > > > >  http://code.google.com/p/modwsgi/wiki/InstallationIssues
> > > > > > > >
> > > > > > > > This is from mod_wsgi documentation, but same issues apply.
> > > > > > > >
> > > > > > > > BTW, one more possibility is if you have multiple versions
> of
> > Apache
> > > > > > > > installed when mod_python was compiled it used the wrong
> header
> > > > files.
> > > > > > > > How did you install mod_python.so.
> > > > > > > >
> > > > > > > > How many different versions of Apache do you have installed?
> > > > > > > >
> > > > > > > > What options did you use to 'configure' when building
> > mod_python?
> > > > > > > >
> > > > > > > > Did you use the 'install' target to 'make' or copy it by
> hand?
> > > > > > > >
> > > > > > > > If copied by hand, maybe it was compiled against wrong
> version
> > of
> > > > > > > > Apache for which you copied it into. You may want tp pay
> very
> > > > careful
> > > > > > > > attention to the -I flags to compiler when mod_python was
> > compiled.
> > > > > > > >
> > > > > > > > Graham
> > > > > > > >
> > > > > > > >
> > > > > > > >
> > > > > > > >
> > > > > > > > > On Tue, Apr 8, 2008 at 12:30 AM, Graham Dumpleton
> > > > > > > > > <graham.dumpleton@gmail.com> wrote:
> > > > > > > > >
> > > > > > > > > > What do you get when you run:
> > > > > > > > > >
> > > > > > > > > >  ls -las /usr/local/apache28/modules/mod_python.so
> > > > > > > > > >
> > > > > > > > > > and:
> > > > > > > > > >
> > > > > > > > > >
> > > > > > > > > >  file /usr/local/apache28/modules/mod_python.so
> > > > > > > > > >
> > > > > > > > > > and:
> > > > > > > > > >
> > > > > > > > > >  ldd /usr/local/apache28/modules/mod_python.so
> > > > > > > > > >
> > > > > > > > > > Graham
> > > > > > > > > >
> > > > > > > > > >
> > > > > > > > > >
> > > > > > > > > >
> > > > > > > > > > 2008/4/8 Kyle Simpson <kyle.simpson@gmail.com>:
> > > > > > > > > > > Hi Graham,
> > > > > > > > > > >
> > > > > > > > > > > Thanks for the quick reply.
> > > > > > > > > > >
> > > > > > > > > > > I compiled all 3: python,apache,mod python.  Did not
> use
> > > > binaries
> > > > > > > for
> > > > > > > > > any of
> > > > > > > > > > > them.
> > > > > > > > > > >
> > > > > > > > > > >
> > > > > > > > > > >
> > > > > > > > > > > On Tue, Apr 8, 2008 at 12:22 AM, Graham Dumpleton
> > > > > > > > > > > <graham.dumpleton@gmail.com> wrote:
> > > > > > > > > > >
> > > > > > > > > > > > 2008/4/8 Kyle Simpson <kyle.simpson@gmail.com>:
> > > > > > > > > > > >
> > > > > > > > > > > >
> > > > > > > > > > > >
> > > > > > > > > > > > > Not sure what to make of this error.  I have
> apache
> > 2.2.8,
> > > > > > > python
> > > > > > > > > 2.5.2
> > > > > > > > > > > and
> > > > > > > > > > > > > mod python 3.3.1.
> > > > > > > > > > > > >
> > > > > > > > > > > > > Any ideas?
> > > > > > > > > > > > >
> > > > > > > > > > > > >
> > > > > > > > > > > > > httpd: Syntax error on line 54 of
> > > > > > > > > /usr/local/apache28/conf/httpd.conf:
> > > > > > > > > > > API
> > > > > > > > > > > > > module structure 'python_module' in file
> > > > > > > > > > > > > /usr/local/apache28/modules/mod_python.so is
> garbled -
> > > > expected
> > > > > > > > > > > signature
> > > > > > > > > > > > > 41503232 but saw 41503230 - perhaps this is not an
> > Apache
> > > > module
> > > > > > > > > DSO, or
> > > > > > > > > > > was
> > > > > > > > > > > > > compiled for a different Apache version?
> > > > > > > > > > > >
> > > > > > > > > > > > Exactly what it means.
> > > > > > > > > > > >
> > > > > > > > > > > > Did you compile mod_python yourself for that version
> of
> > > > Apache or
> > > > > > > did
> > > > > > > > > > > > you just install a binary package from somewhere for
> > both?
> > > > > > > > > > > >
> > > > > > > > > > > > I am assuming Apache has a concept of an internal
> ABI
> > > > number. This
> > > > > > > is
> > > > > > > > > > > > changed whenever the ABI is changed. You may not be
> able
> > to
> > > > use a
> > > > > > > > > > > > precompiled module from an older version of Apache
> even
> > if
> > > > same
> > > > > > > > > > > > major/minor version, if this ABI has changed.
> > > > > > > > > > > >
> > > > > > > > > > > > Graham
> > > > > > > > > > > >
> > > > > > > > > > >
> > > > > > > > > > >
> > > > > > > > > >
> > > > > > > > >
> > > > > > > > >
> > > > > > > >
> > > > > > >
> > > > > > >
> > > > > >
> > > > >
> > > > >
> > > >
> > > >
> > >
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080408/820ca4d2/attachment-0001.html
From graham.dumpleton at gmail.com  Wed Apr  9 00:36:35 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Wed Apr  9 00:36:41 2008
Subject: [mod_python] wrong version?
In-Reply-To: <5fdbf8630804081943m8b5e3c3y454e600efddaec7d@mail.gmail.com>
References: <5fdbf8630804072015y2dec1870i88d7ea59b87e4bdd@mail.gmail.com>
	<88e286470804072152kc8f6617y7f2f2f37d0e3d688@mail.gmail.com>
	<5fdbf8630804072246m52218833yad5aa5c0d9aad218@mail.gmail.com>
	<88e286470804072249m566531aodcb17080786364a1@mail.gmail.com>
	<5fdbf8630804080419g6c970820me83061da374d8788@mail.gmail.com>
	<5fdbf8630804081434taf28ba4u616e81282682a59b@mail.gmail.com>
	<88e286470804081728n7313bdc3xd8003baca7767ad7@mail.gmail.com>
	<5fdbf8630804081930u7ee1b119j8b8960befd9e319a@mail.gmail.com>
	<88e286470804081935s67c043cfje0d7c2e33349a478@mail.gmail.com>
	<5fdbf8630804081943m8b5e3c3y454e600efddaec7d@mail.gmail.com>
Message-ID: <88e286470804082136xfe4a32anef26347bb11c3a00@mail.gmail.com>

2008/4/9 Kyle Simpson <kyle.simpson@gmail.com>:
> Hi Graham
>
> Thanks for all your help on this.
>
> I started over from the tgz and did configure and make.
>
> Turns out that everytime I did make and make install, it wasn't recompiling,
> even though I had different options with ./configure (specifying which
> apache)

I was wandering if that might be the problem and if you still weren't
having joy was going to make sure you did a:

  make distclean

so as to return it back to how it would have been when you downloaded
it, and for you then to start over. Going back to freshly unpacked tar
file would achieve same thing.

You could also use:

  make clean

This will remove compiled output, but leave result of having running
configure in place so as to avoid running it again.

Graham

> DUH!
>
>
>
> On Tue, Apr 8, 2008 at 10:35 PM, Graham Dumpleton
> <graham.dumpleton@gmail.com> wrote:
> >
> > 2008/4/9 Kyle Simpson <kyle.simpson@gmail.com>:
> >
> > > Yes there are header files in /usr/local/apache28/include
> > >
> > > Value is: #define MODULE_MAGIC_COOKIE 0x41503232UL /* "AP22" */
> > >
> > > In older version, it is:
> > >
> > > #define MODULE_MAGIC_COOKIE 0x41503232UL /* "AP22" */
> >
> > But that is the same, so how can it be an older version, unless it
> > differs only by patch level. The magic string it complains about is
> > for Apache 2.0 so you must have that installed somewhere.
> >
> >
> > > How do you determine the -l flags when the compiler is run?
> >
> > I gave an example:
> >
> >
> > /usr/local/apache-2.2.4/bin/apxs
> > -I/Users/grahamd/Projects/mod_python-trunk/src/include
> >
> -I/System/Library/Frameworks/Python.framework/Versions/2.3/include/python2.3
> > -DNDEBUG -Wc,'-arch ppc' -c mod_python.c _apachemodule.c
> > requestobject.c tableobject.c util.c serverobject.c connobject.c
> > filterobject.c hlist.c hlistobject.c finfoobject.c -arch ppc
> > -Wl,-F/System/Library/Frameworks -framework Python -u __dummy -u
> > _PyMac_Error -framework System  -framework CoreServices -framework
> > Foundation -ldl
> >
> > See the -I flags in there.
> >
> > You will see this when you run 'make' to build mod_python. Find the
> > equivalent invocation of apxs to compile mod_python when you build it
> > and post that small subset of lines which shows the -I flags.
> >
> > Graham
> >
> >
> >
> >
> > > Thanks.
> > >
> > >
> > >
> > > On Tue, Apr 8, 2008 at 8:28 PM, Graham Dumpleton
> > > <graham.dumpleton@gmail.com> wrote:
> > >
> > > > 2008/4/9 Kyle Simpson <kyle.simpson@gmail.com>:
> > > >
> > > > > Any other ideas on this topic?
> > > >
> > > > As I said before, the problem is that you are managing to either
> > > > install mod_python.so into the wrong installation or you have compiled
> > > > it against the header files for the wrong version of Apache.
> > > >
> > > > The proof of this is that the magic number your mod_python.so has
> equates
> > > to:
> > > >
> > > >  #define MODULE_MAGIC_COOKIE 0x41503230UL /* "AP20" */
> > > >
> > > > whereas Apache is expecting:
> > > >
> > > >  #define MODULE_MAGIC_COOKIE 0x41503232UL /* "AP22" */
> > > >
> > > > Do you have header files installed in the following directory?
> > > >
> > > >  /usr/local/apache28/include
> > > >
> > > > Are those header files readable to the user that you are compiling
> > > mod_python?
> > > >
> > > > Look in the header file 'ap_mmn.h' in that directory, what is the
> > > > value of MODULE_MAGIC_COOKIE?
> > > >
> > > > Now go find where the header files for your other Apache installation
> > > > are located and find what its value of MODULE_MAGIC_COOKIE is? What
> > > > directory are those header files in?
> > > >
> > > > To work out why it is picking up wrong header files, as I suggested
> > > > before, look at the -I flags used when compiler is run on mod_python
> > > > source code. For example on my system I get:
> > > >
> > > > /usr/local/apache-2.2.4/bin/apxs
> > > > -I/Users/grahamd/Projects/mod_python-trunk/src/include
> > > >
> > >
> -I/System/Library/Frameworks/Python.framework/Versions/2.3/include/python2.3
> > > > -DNDEBUG -Wc,'-arch ppc' -c mod_python.c _apachemodule.c
> > > > requestobject.c tableobject.c util.c serverobject.c connobject.c
> > > > filterobject.c hlist.c hlistobject.c finfoobject.c -arch ppc
> > > > -Wl,-F/System/Library/Frameworks -framework Python -u __dummy -u
> > > > _PyMac_Error -framework System  -framework CoreServices -framework
> > > > Foundation -ldl
> > > >
> > > > What do you get?
> > > >
> > > > Graham
> > > >
> > > >
> > > >
> > > >
> > > > > httpd: Syntax error on line 55 of
> /usr/local/apache28/conf/httpd.conf:
> > > API
> > > > > module structure 'python_module' in file
> > > > > /usr/local/apache28/modules/mod_python.so is garbled - expected
> > > signature
> > > > > 41503232 but saw 41503230 - perhaps this is not an Apache module
> DSO, or
> > > was
> > > > > compiled for a different Apache version?
> > > > >
> > > > > running on 2.6.9-023stab044.11-smp
> > > > >
> > > > > apache 2.2.8 (second install, which was in /usr/local/apache28
> > > > >
> > > > > python 2.5.2
> > > > >
> > > > >
> > > > > Thanks,
> > > > > Kyle
> > > > >
> > > > >
> > > > >
> > > > > On Tue, Apr 8, 2008 at 7:19 AM, Kyle Simpson
> <kyle.simpson@gmail.com>
> > > wrote:
> > > > >
> > > > > > 2 versions of apache
> > > > > >
> > > > > > just ./configure --with-apxs=/usr/local/apache28/bin/apxs
> > > > > >
> > > > > > I did make install
> > > > > >
> > > > > > And no, I don't understand the shared library issue.
> Unfortunately
> > > I'm
> > > > > pretty much a noob, since any previous apache haven't required any
> > > modules.
> > > > > >
> > > > > > Thanks for all the help.  Let me know if you have any other ideas.
> > > > > >
> > > > > >
> > > > > >
> > > > > >
> > > > > >
> > > > > > On Tue, Apr 8, 2008 at 1:49 AM, Graham Dumpleton
> > > > > <graham.dumpleton@gmail.com> wrote:
> > > > > >
> > > > > > > What about my other questions:
> > > > > > >
> > > > > > >
> > > > > > > How many different versions of Apache do you have installed?
> > > > > > >
> > > > > > > What options did you use to 'configure' when building
> mod_python?
> > > > > > >
> > > > > > > Did you use the 'install' target to 'make' or copy it by hand?
> > > > > > >
> > > > > > > Do you also understand what I am talking about with the shared
> > > library
> > > > > > > issue, not that it in itself should cause this problem.
> > > > > > >
> > > > > > >
> > > > > > >
> > > > > > >
> > > > > > > Graham
> > > > > > >
> > > > > > > 2008/4/8 Kyle Simpson <kyle.simpson@gmail.com>:
> > > > > > > > After doing that, new error:
> > > > > > > >
> > > > > > > > httpd: Syntax error on line 55 of
> > > /usr/local/apache28/conf/httpd.conf:
> > > > > API
> > > > > > > > module structure 'python_module' in file /usr/loc?
> > > > > > > >
> > > > > > > > line 55 is:
> > > > > > > > 55 LoadModule python_module modules/mod_python.so
> > > > > > > >
> > > > > > > > I did reconfigure/compile to see if that helped, but here's
> the ls
> > > -la
> > > > > > > >
> > > > > > > > 2857 -rwxr-xr-x    1 root     root      2911798 Apr  8 01:35
> > > > > mod_python.so
> > > > > > > >
> > > > > > > > file
> > > > > > > >
> > > > > > > > /usr/local/apache28/modules/mod_python.so: ELF 32-bit LSB
> shared
> > > > > object,
> > > > > > > > Intel 80386, version 1 (SYSV), not stripped
> > > > > > > >
> > > > > > > > ldd
> > > > > > > > libpthread.so.0 => /lib/libpthread.so.0 (0x00111000)
> > > > > > > >         libdl.so.2 => /lib/libdl.so.2 (0x00826000)
> > > > > > > >         libutil.so.1 => /lib/libutil.so.1 (0x00162000)
> > > > > > > >         libm.so.6 => /lib/libm.so.6 (0x00ee8000)
> > > > > > > >          libc.so.6 => /lib/libc.so.6 (0x00832000)
> > > > > > > >         /lib/ld-linux.so.2 => /lib/ld-linux.so.2 (0x00411000)
> > > > > > > >
> > > > > > > >
> > > > > > > >
> > > > > > > >
> > > > > > > >
> > > > > > > >
> > > > > > > > On Tue, Apr 8, 2008 at 12:52 AM, Graham Dumpleton
> > > > > > > > <graham.dumpleton@gmail.com> wrote:
> > > > > > > >
> > > > > > > > > Did you do a full stop and start of Apache, not just a
> > > > > restart/reload?
> > > > > > > > >
> > > > > > > > >
> > > > > > > > > 2008/4/8 Kyle Simpson <kyle.simpson@gmail.com>:
> > > > > > > > >
> > > > > > > > > > 2857 -rwxr-xr-x    1 root     root      2911798 Apr  7
> 23:14
> > > > > > > > > > /usr/local/apache28/modules/mod_python.so
> > > > > > > > > >
> > > > > > > > > > /usr/local/apache28/modules/mod_python.so: ELF 32-bit LSB
> > > shared
> > > > > object,
> > > > > > > > > > Intel 80386, version 1 (SYSV), not stripped
> > > > > > > > > >
> > > > > > > > > >  libpthread.so.0 => /lib/libpthread.so.0 (0xb7e54000)
> > > > > > > > > >         libdl.so.2 => /lib/libdl.so.2 (0xb7e50000)
> > > > > > > > > >         libutil.so.1 => /lib/libutil.so.1 (0xb7e4d000)
> > > > > > > > > >         libm.so.6 => /lib/libm.so.6 (0xb7e2c000)
> > > > > > > > > >          libc.so.6 => /lib/libc.so.6 (0xb7d09000)
> > > > > > > > > >         /lib/ld-linux.so.2 => /lib/ld-linux.so.2
> (0xb7fee000)
> > > > > > > > >
> > > > > > > > > This all indicates that your Python has not been installed
> with
> > > a
> > > > > > > > > shared library and that Python is being linked statically
> into
> > > > > > > > > mod_python.so. This is generally not a good as it bloats
> your
> > > Apache
> > > > > > > > > processes by a couple of MB in size. It can also cause
> issues,
> > > > > > > > > especially when upgrading from older to newer mod_python
> and/or
> > > > > > > > > different version of Python. Thus why it is important to do
> a
> > > full
> > > > > > > > > stop of Apache when replacing mod_python.so in this case.
> > > > > > > > >
> > > > > > > > > For details of Python shared library issues, see:
> > > > > > > > >
> > > > > > > > >  http://code.google.com/p/modwsgi/wiki/InstallationIssues
> > > > > > > > >
> > > > > > > > > This is from mod_wsgi documentation, but same issues apply.
> > > > > > > > >
> > > > > > > > > BTW, one more possibility is if you have multiple versions
> of
> > > Apache
> > > > > > > > > installed when mod_python was compiled it used the wrong
> header
> > > > > files.
> > > > > > > > > How did you install mod_python.so.
> > > > > > > > >
> > > > > > > > > How many different versions of Apache do you have installed?
> > > > > > > > >
> > > > > > > > > What options did you use to 'configure' when building
> > > mod_python?
> > > > > > > > >
> > > > > > > > > Did you use the 'install' target to 'make' or copy it by
> hand?
> > > > > > > > >
> > > > > > > > > If copied by hand, maybe it was compiled against wrong
> version
> > > of
> > > > > > > > > Apache for which you copied it into. You may want tp pay
> very
> > > > > careful
> > > > > > > > > attention to the -I flags to compiler when mod_python was
> > > compiled.
> > > > > > > > >
> > > > > > > > > Graham
> > > > > > > > >
> > > > > > > > >
> > > > > > > > >
> > > > > > > > >
> > > > > > > > > > On Tue, Apr 8, 2008 at 12:30 AM, Graham Dumpleton
> > > > > > > > > > <graham.dumpleton@gmail.com> wrote:
> > > > > > > > > >
> > > > > > > > > > > What do you get when you run:
> > > > > > > > > > >
> > > > > > > > > > >  ls -las /usr/local/apache28/modules/mod_python.so
> > > > > > > > > > >
> > > > > > > > > > > and:
> > > > > > > > > > >
> > > > > > > > > > >
> > > > > > > > > > >  file /usr/local/apache28/modules/mod_python.so
> > > > > > > > > > >
> > > > > > > > > > > and:
> > > > > > > > > > >
> > > > > > > > > > >  ldd /usr/local/apache28/modules/mod_python.so
> > > > > > > > > > >
> > > > > > > > > > > Graham
> > > > > > > > > > >
> > > > > > > > > > >
> > > > > > > > > > >
> > > > > > > > > > >
> > > > > > > > > > > 2008/4/8 Kyle Simpson <kyle.simpson@gmail.com>:
> > > > > > > > > > > > Hi Graham,
> > > > > > > > > > > >
> > > > > > > > > > > > Thanks for the quick reply.
> > > > > > > > > > > >
> > > > > > > > > > > > I compiled all 3: python,apache,mod python.  Did not
> use
> > > > > binaries
> > > > > > > > for
> > > > > > > > > > any of
> > > > > > > > > > > > them.
> > > > > > > > > > > >
> > > > > > > > > > > >
> > > > > > > > > > > >
> > > > > > > > > > > > On Tue, Apr 8, 2008 at 12:22 AM, Graham Dumpleton
> > > > > > > > > > > > <graham.dumpleton@gmail.com> wrote:
> > > > > > > > > > > >
> > > > > > > > > > > > > 2008/4/8 Kyle Simpson <kyle.simpson@gmail.com>:
> > > > > > > > > > > > >
> > > > > > > > > > > > >
> > > > > > > > > > > > >
> > > > > > > > > > > > > > Not sure what to make of this error.  I have
> apache
> > > 2.2.8,
> > > > > > > > python
> > > > > > > > > > 2.5.2
> > > > > > > > > > > > and
> > > > > > > > > > > > > > mod python 3.3.1.
> > > > > > > > > > > > > >
> > > > > > > > > > > > > > Any ideas?
> > > > > > > > > > > > > >
> > > > > > > > > > > > > >
> > > > > > > > > > > > > > httpd: Syntax error on line 54 of
> > > > > > > > > > /usr/local/apache28/conf/httpd.conf:
> > > > > > > > > > > > API
> > > > > > > > > > > > > > module structure 'python_module' in file
> > > > > > > > > > > > > > /usr/local/apache28/modules/mod_python.so is
> garbled -
> > > > > expected
> > > > > > > > > > > > signature
> > > > > > > > > > > > > > 41503232 but saw 41503230 - perhaps this is not an
> > > Apache
> > > > > module
> > > > > > > > > > DSO, or
> > > > > > > > > > > > was
> > > > > > > > > > > > > > compiled for a different Apache version?
> > > > > > > > > > > > >
> > > > > > > > > > > > > Exactly what it means.
> > > > > > > > > > > > >
> > > > > > > > > > > > > Did you compile mod_python yourself for that version
> of
> > > > > Apache or
> > > > > > > > did
> > > > > > > > > > > > > you just install a binary package from somewhere for
> > > both?
> > > > > > > > > > > > >
> > > > > > > > > > > > > I am assuming Apache has a concept of an internal
> ABI
> > > > > number. This
> > > > > > > > is
> > > > > > > > > > > > > changed whenever the ABI is changed. You may not be
> able
> > > to
> > > > > use a
> > > > > > > > > > > > > precompiled module from an older version of Apache
> even
> > > if
> > > > > same
> > > > > > > > > > > > > major/minor version, if this ABI has changed.
> > > > > > > > > > > > >
> > > > > > > > > > > > > Graham
> > > > > > > > > > > > >
> > > > > > > > > > > >
> > > > > > > > > > > >
> > > > > > > > > > >
> > > > > > > > > >
> > > > > > > > > >
> > > > > > > > >
> > > > > > > >
> > > > > > > >
> > > > > > >
> > > > > >
> > > > > >
> > > > >
> > > > >
> > > >
> > >
> > >
> >
>
>
From jimge at rodentia.net  Wed Apr  9 01:02:19 2008
From: jimge at rodentia.net (Jim Geist)
Date: Wed Apr  9 01:02:27 2008
Subject: [mod_python] Trying to get new importer working
Message-ID: <974768F9-295A-40D4-8530-359297A36221@rodentia.net>

Hi all -

I am trying to convert my project over from using sys.path to use the  
new importer and I'm having some issues. In my apache config I have this

<Location /test>
     SetHandler mod_python
     PythonOption mod_python.importer.path "['/home/jimge/app']"
     PythonHandler entry
     PythonDebug On
</Location>

/home/jimge/app/entry.py contains (well, more code, but it boils down  
to)

from mod_python import apache
def handler(req):	
     req.write("hello, world!\n")
     return apache.OK

When I was using PythonPath to set up sys.path everything worked. With  
this setup I get an ImportError exception that entry cannot be found.

Anyone have any hints?

Thanks!

-- Jim
From graham.dumpleton at gmail.com  Wed Apr  9 01:11:10 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Wed Apr  9 01:11:15 2008
Subject: [mod_python] Trying to get new importer working
In-Reply-To: <974768F9-295A-40D4-8530-359297A36221@rodentia.net>
References: <974768F9-295A-40D4-8530-359297A36221@rodentia.net>
Message-ID: <88e286470804082211v750d4efakd29d983eb1f8e926@mail.gmail.com>

2008/4/9 Jim Geist <jimge@rodentia.net>:
> Hi all -
>
>  I am trying to convert my project over from using sys.path to use the new
> importer and I'm having some issues. In my apache config I have this
>
>  <Location /test>
>     SetHandler mod_python
>     PythonOption mod_python.importer.path "['/home/jimge/app']"
>     PythonHandler entry
>     PythonDebug On
>  </Location>
>
>  /home/jimge/app/entry.py contains (well, more code, but it boils down to)
>
>  from mod_python import apache
>  def handler(req):
>     req.write("hello, world!\n")
>     return apache.OK
>
>  When I was using PythonPath to set up sys.path everything worked. With this
> setup I get an ImportError exception that entry cannot be found.
>
>  Anyone have any hints?

Please post the complete Python exception message and any other logged
messages associated with it form the Apache error log and/or web page.
It will save us guessing.

Graham
From jimge at rodentia.net  Wed Apr  9 01:24:02 2008
From: jimge at rodentia.net (Jim Geist)
Date: Wed Apr  9 01:24:10 2008
Subject: [mod_python] Trying to get new importer working
In-Reply-To: <88e286470804082211v750d4efakd29d983eb1f8e926@mail.gmail.com>
References: <974768F9-295A-40D4-8530-359297A36221@rodentia.net>
	<88e286470804082211v750d4efakd29d983eb1f8e926@mail.gmail.com>
Message-ID: <7B1D0C66-C25E-43BA-8EB3-436AA5AA37AF@rodentia.net>

On Apr 8, 2008, at 10:11 PM, Graham Dumpleton wrote:

> 2008/4/9 Jim Geist <jimge@rodentia.net>:
>> Hi all -
>>
>> I am trying to convert my project over from using sys.path to use  
>> the new
>> importer and I'm having some issues. In my apache config I have this
>>
>> <Location /test>
>>    SetHandler mod_python
>>    PythonOption mod_python.importer.path "['/home/jimge/app']"
>>    PythonHandler entry
>>    PythonDebug On
>> </Location>
>>
>> /home/jimge/app/entry.py contains (well, more code, but it boils  
>> down to)
>>
>> from mod_python import apache
>> def handler(req):
>>    req.write("hello, world!\n")
>>    return apache.OK
>>
>> When I was using PythonPath to set up sys.path everything worked.  
>> With this
>> setup I get an ImportError exception that entry cannot be found.
>>
>> Anyone have any hints?
>
> Please post the complete Python exception message and any other logged
> messages associated with it form the Apache error log and/or web page.
> It will save us guessing.
>
> Graham

Sure. Here's the traceback from the browser:

Mod_python error: "PythonHandler entry"

Traceback (most recent call last):

   File "/usr/lib/python2.5/site-packages/mod_python/apache.py", line  
287, in HandlerDispatch
     log=debug)

   File "/usr/lib/python2.5/site-packages/mod_python/apache.py", line  
461, in import_module
     f, p, d = imp.find_module(parts[i], path)

ImportError: No module named entry

In the Apache error log:

[Wed Apr 02 05:26:09 2008] [notice] mod_python: (Re)importing module  
'entry'
[Wed Apr 02 05:26:09 2008] [error] [client 10.211.55.2] PythonHandler  
entry: Traceback (most recent call last):
[Wed Apr 02 05:26:09 2008] [error] [client 10.211.55.2] PythonHandler  
entry:   File "/usr/lib/python2.5/site-packages/mod_python/apache.py",  
line 287, in HandlerDispatch\n    log=debug)
[Wed Apr 02 05:26:09 2008] [error] [client 10.211.55.2] PythonHandler  
entry:   File "/usr/lib/python2.5/site-packages/mod_python/apache.py",  
line 461, in import_module\n    f, p, d = imp.find_module(parts[i],  
path)
[Wed Apr 02 05:26:09 2008] [error] [client 10.211.55.2] PythonHandler  
entry: ImportError: No module named entry

-- Jim


From graham.dumpleton at gmail.com  Wed Apr  9 01:29:51 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Wed Apr  9 01:29:56 2008
Subject: [mod_python] Trying to get new importer working
In-Reply-To: <7B1D0C66-C25E-43BA-8EB3-436AA5AA37AF@rodentia.net>
References: <974768F9-295A-40D4-8530-359297A36221@rodentia.net>
	<88e286470804082211v750d4efakd29d983eb1f8e926@mail.gmail.com>
	<7B1D0C66-C25E-43BA-8EB3-436AA5AA37AF@rodentia.net>
Message-ID: <88e286470804082229o1c586fa7reaa57682b84416b@mail.gmail.com>

You aren't using mod_python 3.3.1 but some older version.

Graham

2008/4/9 Jim Geist <jimge@rodentia.net>:
>
> On Apr 8, 2008, at 10:11 PM, Graham Dumpleton wrote:
>
>
> > 2008/4/9 Jim Geist <jimge@rodentia.net>:
> >
> > > Hi all -
> > >
> > > I am trying to convert my project over from using sys.path to use the
> new
> > > importer and I'm having some issues. In my apache config I have this
> > >
> > > <Location /test>
> > >   SetHandler mod_python
> > >   PythonOption mod_python.importer.path "['/home/jimge/app']"
> > >   PythonHandler entry
> > >   PythonDebug On
> > > </Location>
> > >
> > > /home/jimge/app/entry.py contains (well, more code, but it boils down
> to)
> > >
> > > from mod_python import apache
> > > def handler(req):
> > >   req.write("hello, world!\n")
> > >   return apache.OK
> > >
> > > When I was using PythonPath to set up sys.path everything worked. With
> this
> > > setup I get an ImportError exception that entry cannot be found.
> > >
> > > Anyone have any hints?
> > >
> >
> > Please post the complete Python exception message and any other logged
> > messages associated with it form the Apache error log and/or web page.
> > It will save us guessing.
> >
> > Graham
> >
>
>  Sure. Here's the traceback from the browser:
>
>  Mod_python error: "PythonHandler entry"
>
>  Traceback (most recent call last):
>
>   File "/usr/lib/python2.5/site-packages/mod_python/apache.py", line 287, in
> HandlerDispatch
>     log=debug)
>
>   File "/usr/lib/python2.5/site-packages/mod_python/apache.py", line 461, in
> import_module
>     f, p, d = imp.find_module(parts[i], path)
>
>  ImportError: No module named entry
>
>  In the Apache error log:
>
>  [Wed Apr 02 05:26:09 2008] [notice] mod_python: (Re)importing module
> 'entry'
>  [Wed Apr 02 05:26:09 2008] [error] [client 10.211.55.2] PythonHandler
> entry: Traceback (most recent call last):
>  [Wed Apr 02 05:26:09 2008] [error] [client 10.211.55.2] PythonHandler
> entry:   File "/usr/lib/python2.5/site-packages/mod_python/apache.py", line
> 287, in HandlerDispatch\n    log=debug)
>  [Wed Apr 02 05:26:09 2008] [error] [client 10.211.55.2] PythonHandler
> entry:   File "/usr/lib/python2.5/site-packages/mod_python/apache.py", line
> 461, in import_module\n    f, p, d = imp.find_module(parts[i], path)
>  [Wed Apr 02 05:26:09 2008] [error] [client 10.211.55.2] PythonHandler
> entry: ImportError: No module named entry
>
>
>
>  -- Jim
>
>
>  _______________________________________________
>  Mod_python mailing list
>  Mod_python@modpython.org
>  http://mailman.modpython.org/mailman/listinfo/mod_python
>
From jimge at rodentia.net  Wed Apr  9 01:41:44 2008
From: jimge at rodentia.net (Jim Geist)
Date: Wed Apr  9 01:41:52 2008
Subject: [mod_python] Trying to get new importer working
In-Reply-To: <88e286470804082229o1c586fa7reaa57682b84416b@mail.gmail.com>
References: <974768F9-295A-40D4-8530-359297A36221@rodentia.net>
	<88e286470804082211v750d4efakd29d983eb1f8e926@mail.gmail.com>
	<7B1D0C66-C25E-43BA-8EB3-436AA5AA37AF@rodentia.net>
	<88e286470804082229o1c586fa7reaa57682b84416b@mail.gmail.com>
Message-ID: <6B25119F-DA45-4A66-87D5-1C617AB0C736@rodentia.net>

Yes this is 3.2. I thought I read that the new importer was in any 3.x  
version, is that incorrect?

Thanks!

On Apr 8, 2008, at 10:29 PM, Graham Dumpleton wrote:

> You aren't using mod_python 3.3.1 but some older version.
>
> Graham
>
> 2008/4/9 Jim Geist <jimge@rodentia.net>:
>>
>> On Apr 8, 2008, at 10:11 PM, Graham Dumpleton wrote:
>>
>>
>>> 2008/4/9 Jim Geist <jimge@rodentia.net>:
>>>
>>>> Hi all -
>>>>
>>>> I am trying to convert my project over from using sys.path to use  
>>>> the
>> new
>>>> importer and I'm having some issues. In my apache config I have  
>>>> this
>>>>
>>>> <Location /test>
>>>>  SetHandler mod_python
>>>>  PythonOption mod_python.importer.path "['/home/jimge/app']"
>>>>  PythonHandler entry
>>>>  PythonDebug On
>>>> </Location>
>>>>
>>>> /home/jimge/app/entry.py contains (well, more code, but it boils  
>>>> down
>> to)
>>>>
>>>> from mod_python import apache
>>>> def handler(req):
>>>>  req.write("hello, world!\n")
>>>>  return apache.OK
>>>>
>>>> When I was using PythonPath to set up sys.path everything worked.  
>>>> With
>> this
>>>> setup I get an ImportError exception that entry cannot be found.
>>>>
>>>> Anyone have any hints?
>>>>
>>>
>>> Please post the complete Python exception message and any other  
>>> logged
>>> messages associated with it form the Apache error log and/or web  
>>> page.
>>> It will save us guessing.
>>>
>>> Graham
>>>
>>
>> Sure. Here's the traceback from the browser:
>>
>> Mod_python error: "PythonHandler entry"
>>
>> Traceback (most recent call last):
>>
>>  File "/usr/lib/python2.5/site-packages/mod_python/apache.py", line  
>> 287, in
>> HandlerDispatch
>>    log=debug)
>>
>>  File "/usr/lib/python2.5/site-packages/mod_python/apache.py", line  
>> 461, in
>> import_module
>>    f, p, d = imp.find_module(parts[i], path)
>>
>> ImportError: No module named entry
>>
>> In the Apache error log:
>>
>> [Wed Apr 02 05:26:09 2008] [notice] mod_python: (Re)importing module
>> 'entry'
>> [Wed Apr 02 05:26:09 2008] [error] [client 10.211.55.2] PythonHandler
>> entry: Traceback (most recent call last):
>> [Wed Apr 02 05:26:09 2008] [error] [client 10.211.55.2] PythonHandler
>> entry:   File "/usr/lib/python2.5/site-packages/mod_python/ 
>> apache.py", line
>> 287, in HandlerDispatch\n    log=debug)
>> [Wed Apr 02 05:26:09 2008] [error] [client 10.211.55.2] PythonHandler
>> entry:   File "/usr/lib/python2.5/site-packages/mod_python/ 
>> apache.py", line
>> 461, in import_module\n    f, p, d = imp.find_module(parts[i], path)
>> [Wed Apr 02 05:26:09 2008] [error] [client 10.211.55.2] PythonHandler
>> entry: ImportError: No module named entry
>>
>>
>>
>> -- Jim
>>
>>
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>

From graham.dumpleton at gmail.com  Wed Apr  9 01:51:35 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Wed Apr  9 01:51:44 2008
Subject: [mod_python] Trying to get new importer working
In-Reply-To: <6B25119F-DA45-4A66-87D5-1C617AB0C736@rodentia.net>
References: <974768F9-295A-40D4-8530-359297A36221@rodentia.net>
	<88e286470804082211v750d4efakd29d983eb1f8e926@mail.gmail.com>
	<7B1D0C66-C25E-43BA-8EB3-436AA5AA37AF@rodentia.net>
	<88e286470804082229o1c586fa7reaa57682b84416b@mail.gmail.com>
	<6B25119F-DA45-4A66-87D5-1C617AB0C736@rodentia.net>
Message-ID: <88e286470804082251h7ebf4609kfd39ea0b52750d4d@mail.gmail.com>

See:

  http://www.modpython.org/live/current/doc-html/app-changes-from-3.2.10.html

In particular:

  (MODPYTHON-143)

The heading means these are the changes made since 3.2.10, which in
this case means 3.3 versions.

In some respects the heading could be clearer as to what it means.

But then, in:

  http://www.modpython.org/live/current/doc-html/pyapi-apmeth.html

It quite clearly says it was only introduced in 3.3. And that
documentation for import_module() function is effectively the new
importer documentation.

Graham

2008/4/9 Jim Geist <jimge@rodentia.net>:
> Yes this is 3.2. I thought I read that the new importer was in any 3.x
> version, is that incorrect?
>
>  Thanks!
>
>
>
>  On Apr 8, 2008, at 10:29 PM, Graham Dumpleton wrote:
>
>
> > You aren't using mod_python 3.3.1 but some older version.
> >
> > Graham
> >
> > 2008/4/9 Jim Geist <jimge@rodentia.net>:
> >
> > >
> > > On Apr 8, 2008, at 10:11 PM, Graham Dumpleton wrote:
> > >
> > >
> > >
> > > > 2008/4/9 Jim Geist <jimge@rodentia.net>:
> > > >
> > > >
> > > > > Hi all -
> > > > >
> > > > > I am trying to convert my project over from using sys.path to use
> the
> > > > >
> > > >
> > > new
> > >
> > > >
> > > > > importer and I'm having some issues. In my apache config I have this
> > > > >
> > > > > <Location /test>
> > > > >  SetHandler mod_python
> > > > >  PythonOption mod_python.importer.path "['/home/jimge/app']"
> > > > >  PythonHandler entry
> > > > >  PythonDebug On
> > > > > </Location>
> > > > >
> > > > > /home/jimge/app/entry.py contains (well, more code, but it boils
> down
> > > > >
> > > >
> > > to)
> > >
> > > >
> > > > >
> > > > > from mod_python import apache
> > > > > def handler(req):
> > > > >  req.write("hello, world!\n")
> > > > >  return apache.OK
> > > > >
> > > > > When I was using PythonPath to set up sys.path everything worked.
> With
> > > > >
> > > >
> > > this
> > >
> > > >
> > > > > setup I get an ImportError exception that entry cannot be found.
> > > > >
> > > > > Anyone have any hints?
> > > > >
> > > > >
> > > >
> > > > Please post the complete Python exception message and any other logged
> > > > messages associated with it form the Apache error log and/or web page.
> > > > It will save us guessing.
> > > >
> > > > Graham
> > > >
> > > >
> > >
> > > Sure. Here's the traceback from the browser:
> > >
> > > Mod_python error: "PythonHandler entry"
> > >
> > > Traceback (most recent call last):
> > >
> > >  File "/usr/lib/python2.5/site-packages/mod_python/apache.py", line 287,
> in
> > > HandlerDispatch
> > >   log=debug)
> > >
> > >  File "/usr/lib/python2.5/site-packages/mod_python/apache.py", line 461,
> in
> > > import_module
> > >   f, p, d = imp.find_module(parts[i], path)
> > >
> > > ImportError: No module named entry
> > >
> > > In the Apache error log:
> > >
> > > [Wed Apr 02 05:26:09 2008] [notice] mod_python: (Re)importing module
> > > 'entry'
> > > [Wed Apr 02 05:26:09 2008] [error] [client 10.211.55.2] PythonHandler
> > > entry: Traceback (most recent call last):
> > > [Wed Apr 02 05:26:09 2008] [error] [client 10.211.55.2] PythonHandler
> > > entry:   File "/usr/lib/python2.5/site-packages/mod_python/apache.py",
> line
> > > 287, in HandlerDispatch\n    log=debug)
> > > [Wed Apr 02 05:26:09 2008] [error] [client 10.211.55.2] PythonHandler
> > > entry:   File "/usr/lib/python2.5/site-packages/mod_python/apache.py",
> line
> > > 461, in import_module\n    f, p, d = imp.find_module(parts[i], path)
> > > [Wed Apr 02 05:26:09 2008] [error] [client 10.211.55.2] PythonHandler
> > > entry: ImportError: No module named entry
> > >
> > >
> > >
> > > -- Jim
> > >
> > >
> > > _______________________________________________
> > > Mod_python mailing list
> > > Mod_python@modpython.org
> > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > >
> > >
> >
>
>  _______________________________________________
>  Mod_python mailing list
>  Mod_python@modpython.org
>  http://mailman.modpython.org/mailman/listinfo/mod_python
>
From jimge at rodentia.net  Wed Apr  9 23:00:17 2008
From: jimge at rodentia.net (Jim Geist)
Date: Wed Apr  9 23:00:26 2008
Subject: [mod_python] Trying to get new importer working
In-Reply-To: <88e286470804082251h7ebf4609kfd39ea0b52750d4d@mail.gmail.com>
References: <974768F9-295A-40D4-8530-359297A36221@rodentia.net>
	<88e286470804082211v750d4efakd29d983eb1f8e926@mail.gmail.com>
	<7B1D0C66-C25E-43BA-8EB3-436AA5AA37AF@rodentia.net>
	<88e286470804082229o1c586fa7reaa57682b84416b@mail.gmail.com>
	<6B25119F-DA45-4A66-87D5-1C617AB0C736@rodentia.net>
	<88e286470804082251h7ebf4609kfd39ea0b52750d4d@mail.gmail.com>
Message-ID: <4E4AA1E1-91AF-4704-BD00-BD1EDEA70F84@rodentia.net>

Upgrading to 3.3.1 fixed my problem, thanks!!

-- Jim  

On Apr 8, 2008, at 10:51 PM, Graham Dumpleton wrote:

> See:
>
>  http://www.modpython.org/live/current/doc-html/app-changes-from-3.2.10.html
>
> In particular:
>
>  (MODPYTHON-143)
>
> The heading means these are the changes made since 3.2.10, which in
> this case means 3.3 versions.
>
> In some respects the heading could be clearer as to what it means.
>
> But then, in:
>
>  http://www.modpython.org/live/current/doc-html/pyapi-apmeth.html
>
> It quite clearly says it was only introduced in 3.3. And that
> documentation for import_module() function is effectively the new
> importer documentation.
>
> Graham
>
> 2008/4/9 Jim Geist <jimge@rodentia.net>:
>> Yes this is 3.2. I thought I read that the new importer was in any  
>> 3.x
>> version, is that incorrect?
>>
>> Thanks!
>>
>>
>>
>> On Apr 8, 2008, at 10:29 PM, Graham Dumpleton wrote:
>>
>>
>>> You aren't using mod_python 3.3.1 but some older version.
>>>
>>> Graham
>>>
>>> 2008/4/9 Jim Geist <jimge@rodentia.net>:
>>>
>>>>
>>>> On Apr 8, 2008, at 10:11 PM, Graham Dumpleton wrote:
>>>>
>>>>
>>>>
>>>>> 2008/4/9 Jim Geist <jimge@rodentia.net>:
>>>>>
>>>>>
>>>>>> Hi all -
>>>>>>
>>>>>> I am trying to convert my project over from using sys.path to use
>> the
>>>>>>
>>>>>
>>>> new
>>>>
>>>>>
>>>>>> importer and I'm having some issues. In my apache config I have  
>>>>>> this
>>>>>>
>>>>>> <Location /test>
>>>>>> SetHandler mod_python
>>>>>> PythonOption mod_python.importer.path "['/home/jimge/app']"
>>>>>> PythonHandler entry
>>>>>> PythonDebug On
>>>>>> </Location>
>>>>>>
>>>>>> /home/jimge/app/entry.py contains (well, more code, but it boils
>> down
>>>>>>
>>>>>
>>>> to)
>>>>
>>>>>
>>>>>>
>>>>>> from mod_python import apache
>>>>>> def handler(req):
>>>>>> req.write("hello, world!\n")
>>>>>> return apache.OK
>>>>>>
>>>>>> When I was using PythonPath to set up sys.path everything worked.
>> With
>>>>>>
>>>>>
>>>> this
>>>>
>>>>>
>>>>>> setup I get an ImportError exception that entry cannot be found.
>>>>>>
>>>>>> Anyone have any hints?
>>>>>>
>>>>>>
>>>>>
>>>>> Please post the complete Python exception message and any other  
>>>>> logged
>>>>> messages associated with it form the Apache error log and/or web  
>>>>> page.
>>>>> It will save us guessing.
>>>>>
>>>>> Graham
>>>>>
>>>>>
>>>>
>>>> Sure. Here's the traceback from the browser:
>>>>
>>>> Mod_python error: "PythonHandler entry"
>>>>
>>>> Traceback (most recent call last):
>>>>
>>>> File "/usr/lib/python2.5/site-packages/mod_python/apache.py",  
>>>> line 287,
>> in
>>>> HandlerDispatch
>>>>  log=debug)
>>>>
>>>> File "/usr/lib/python2.5/site-packages/mod_python/apache.py",  
>>>> line 461,
>> in
>>>> import_module
>>>>  f, p, d = imp.find_module(parts[i], path)
>>>>
>>>> ImportError: No module named entry
>>>>
>>>> In the Apache error log:
>>>>
>>>> [Wed Apr 02 05:26:09 2008] [notice] mod_python: (Re)importing  
>>>> module
>>>> 'entry'
>>>> [Wed Apr 02 05:26:09 2008] [error] [client 10.211.55.2]  
>>>> PythonHandler
>>>> entry: Traceback (most recent call last):
>>>> [Wed Apr 02 05:26:09 2008] [error] [client 10.211.55.2]  
>>>> PythonHandler
>>>> entry:   File "/usr/lib/python2.5/site-packages/mod_python/ 
>>>> apache.py",
>> line
>>>> 287, in HandlerDispatch\n    log=debug)
>>>> [Wed Apr 02 05:26:09 2008] [error] [client 10.211.55.2]  
>>>> PythonHandler
>>>> entry:   File "/usr/lib/python2.5/site-packages/mod_python/ 
>>>> apache.py",
>> line
>>>> 461, in import_module\n    f, p, d = imp.find_module(parts[i],  
>>>> path)
>>>> [Wed Apr 02 05:26:09 2008] [error] [client 10.211.55.2]  
>>>> PythonHandler
>>>> entry: ImportError: No module named entry
>>>>
>>>>
>>>>
>>>> -- Jim
>>>>
>>>>
>>>> _______________________________________________
>>>> Mod_python mailing list
>>>> Mod_python@modpython.org
>>>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>>>
>>>>
>>>
>>
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>

From mail-lists at peachnet.com  Thu Apr 10 10:40:30 2008
From: mail-lists at peachnet.com (mail-lists)
Date: Thu Apr 10 10:40:30 2008
Subject: [mod_python] Newbie Question
Message-ID: <47FE26DE.7060703@peachnet.com>

Hello,

I have a quick question and it might be very silly:

How do I pass variables between pages short of building a query string 
into the URL? Is there a way to set variables in the request object?

What I'm trying to do is the following:

user fills out a form
form calls saveform function
input is validated
if not valid input return to the form with user values filled out.

So far the only way I manage to do this is with a query string. I am 
just wondering if there's a more elegant way to do this?


Thank you
From clodoaldo.pinto.neto at gmail.com  Thu Apr 10 11:36:24 2008
From: clodoaldo.pinto.neto at gmail.com (Clodoaldo)
Date: Thu Apr 10 11:36:29 2008
Subject: [mod_python] Newbie Question
In-Reply-To: <47FE26DE.7060703@peachnet.com>
References: <47FE26DE.7060703@peachnet.com>
Message-ID: <a595de7a0804100836l1b58abc2yc68230a013a8c483@mail.gmail.com>

2008/4/10, mail-lists <mail-lists@peachnet.com>:
> Hello,
>
>  I have a quick question and it might be very silly:
>
>  How do I pass variables between pages short of building a query string into
> the URL? Is there a way to set variables in the request object?
>
>  What I'm trying to do is the following:
>
>  user fills out a form
>  form calls saveform function
>  input is validated
>  if not valid input return to the form with user values filled out.
>
>  So far the only way I manage to do this is with a query string. I am just
> wondering if there's a more elegant way to do this?

In instead of GET use POST. Or is there something I'm missing?

Regards, Clodoaldo
From harrelson at gmail.com  Thu Apr 10 12:57:26 2008
From: harrelson at gmail.com (Culley Harrelson)
Date: Thu Apr 10 12:57:35 2008
Subject: [mod_python] need help solving some performance issues
Message-ID: <20080410165726.GA99314@pcbsd>

I manage a mod_python application that was built about 4 years ago and has
not changed much since.  It uses clearsilver templates and interacts with
postgresql via psychopg.  The database is on a second machine and the
mod_python machine (FreeBSD) has no other major applications.  

The application is much more popular than it was when it was built and I am
now encountering some performance problems.  Specifically the CPU seems to be
the bottleneck.  The machine has 2 gigs of ram and a single processor.  Ram
doesn't seem to be a problem.  When examining top output, I see that every
once in a while a process comes along and sucks down 10%-20% of the cpu.  A
handful of these processes can (and regularly do) consume the whole CPU.

I don't really know how to go about optimizing the CPU usage of my
application.  Any suggestions are extremely welcome.  

Currently my plan is to throw hardware at problem.  The traditional way to
expand would be to add an additional webserver and do DNS round robin, or
something like that.  Unfortunately this would cause database problems for
me.  Top of my todo list is to swap out psycopg and use sqlrelay but I don't
have enough time to do this quickly.  So... I am now considering switching to
a dual cpu system.  I would keep apache in prefork mode-- I have read that
this works fine on systems with 2 processors.

Which leads me to my main question.  Is this a valid approach?  Assuming the
CPU is the only bottleneck will this double my capacity?

All comments, advice, opinions are welcome and appreciated.

ch
From sean at monkeysnatchbanana.com  Thu Apr 10 13:51:14 2008
From: sean at monkeysnatchbanana.com (Sean Allen)
Date: Thu Apr 10 13:51:25 2008
Subject: [mod_python] need help solving some performance issues
In-Reply-To: <20080410165726.GA99314@pcbsd>
References: <20080410165726.GA99314@pcbsd>
Message-ID: <437E739E-8390-4C95-AFC1-5FEF8B974C69@monkeysnatchbanana.com>

>
> The application is much more popular than it was when it was built  
> and I am
> now encountering some performance problems.  Specifically the CPU  
> seems to be
> the bottleneck.  The machine has 2 gigs of ram and a single  
> processor.  Ram
> doesn't seem to be a problem.  When examining top output, I see that  
> every
> once in a while a process comes along and sucks down 10%-20% of the  
> cpu.  A
> handful of these processes can (and regularly do) consume the whole  
> CPU.

This could be a really dumb question but... are end users seeing these  
performance problems?

From sean at monkeysnatchbanana.com  Thu Apr 10 13:53:29 2008
From: sean at monkeysnatchbanana.com (Sean Allen)
Date: Thu Apr 10 13:53:40 2008
Subject: [mod_python] Newbie Question
In-Reply-To: <47FE26DE.7060703@peachnet.com>
References: <47FE26DE.7060703@peachnet.com>
Message-ID: <3E632451-81BB-4BA5-80A6-A1931E2E2425@monkeysnatchbanana.com>


On Apr 10, 2008, at 10:40 AM, mail-lists wrote:
> Hello,
>
> I have a quick question and it might be very silly:
>
> How do I pass variables between pages short of building a query  
> string into the URL? Is there a way to set variables in the request  
> object?
>
> What I'm trying to do is the following:
>
> user fills out a form
> form calls saveform function

when? via an onSubmit handler?

>
> input is validated

where is the input validated? in 'saveform' that is a javascript  
function?

>
> if not valid input return to the form with user values filled out.
>

what exactly is 'return' here?
from a server side script? from a javascript validation routine?

From harrelson at gmail.com  Thu Apr 10 14:11:20 2008
From: harrelson at gmail.com (Culley Harrelson)
Date: Thu Apr 10 14:11:29 2008
Subject: [mod_python] need help solving some performance issues
In-Reply-To: <437E739E-8390-4C95-AFC1-5FEF8B974C69@monkeysnatchbanana.com>
References: <20080410165726.GA99314@pcbsd>
	<437E739E-8390-4C95-AFC1-5FEF8B974C69@monkeysnatchbanana.com>
Message-ID: <20080410181120.GD21749@pcbsd>

On Thu, 10 Apr 2008, Sean Allen wrote:

>> 
>> The application is much more popular than it was when it was built and I 
>> am
>> now encountering some performance problems.  Specifically the CPU seems to 
>> be
>> the bottleneck.  The machine has 2 gigs of ram and a single processor.  
>> Ram
>> doesn't seem to be a problem.  When examining top output, I see that every
>> once in a while a process comes along and sucks down 10%-20% of the cpu.  
>> A
>> handful of these processes can (and regularly do) consume the whole CPU.
> 
> This could be a really dumb question but... are end users seeing these 
> performance problems?

Yes definitely.  I certainly notice.  On the bad days the site brings in less
money.
From sean at monkeysnatchbanana.com  Thu Apr 10 14:16:27 2008
From: sean at monkeysnatchbanana.com (Sean Allen)
Date: Thu Apr 10 14:16:35 2008
Subject: [mod_python] need help solving some performance issues
In-Reply-To: <20080410181120.GD21749@pcbsd>
References: <20080410165726.GA99314@pcbsd>
	<437E739E-8390-4C95-AFC1-5FEF8B974C69@monkeysnatchbanana.com>
	<20080410181120.GD21749@pcbsd>
Message-ID: <07D8D817-E6F2-4AC5-83F5-E04B092816C6@monkeysnatchbanana.com>


On Apr 10, 2008, at 2:11 PM, Culley Harrelson wrote:
> On Thu, 10 Apr 2008, Sean Allen wrote:
>
>>>
>>> The application is much more popular than it was when it was built  
>>> and I
>>> am
>>> now encountering some performance problems.  Specifically the CPU  
>>> seems to
>>> be
>>> the bottleneck.  The machine has 2 gigs of ram and a single  
>>> processor.
>>> Ram
>>> doesn't seem to be a problem.  When examining top output, I see  
>>> that every
>>> once in a while a process comes along and sucks down 10%-20% of  
>>> the cpu.
>>> A
>>> handful of these processes can (and regularly do) consume the  
>>> whole CPU.
>>
>> This could be a really dumb question but... are end users seeing  
>> these
>> performance problems?
>
> Yes definitely.  I certainly notice.  On the bad days the site  
> brings in less
> money.

Do you know what those processes are doing when they suck up the cpu?

Is it something that you could offload to another machine?

Obviously throwing more hardware at the problem can work but it sounds  
like
your setup right now doesnt allow for a ton of movement you can do in  
that area.

Re-working the entire thing is one option but you might try to skate by
before doing that by seeing if you can move just the problem areas.
From evert.rol at gmail.com  Thu Apr 10 14:20:39 2008
From: evert.rol at gmail.com (Evert Rol)
Date: Thu Apr 10 14:20:53 2008
Subject: [mod_python] Setting the python executable
Message-ID: <269DDBF6-71C9-4902-8358-865CF785682B@gmail.com>

   Hi all,

I'm having a hard time telling Apache (or mod_python) to tell which  
python executable to use.
The thing is, I don't have a root access, so I'm running the Apache  
server and python 2.5 under my user account. Both have also been  
installed this way, ie, they are in my in the directory tree of my  
user account.
To avoid interference with the older system python (2.3), I just call  
python with the full path (I try to avoid changing my path, since some  
of these scripts run as cron jobs, bypassing a lot of setup files).
Bit of debugging (eg, print sys.executable in a mod_python script)  
showed, however, that mod_python is still happily using the system  
python, not my locally installed. That goes fine up to a certain  
point, but it does of course crash in the end. I had compiled  
mod_python with the --with-python and --with-apxs options, but looks  
like that doesn't help here.
After some further searching around, I came across the Action  
directive for Apache; still didn't work, although that may be simply  
because I did that incorrectly.

For the record, I'm using mod_python for Django, maing things  
potentially more convoluted.
Here's what my latest attempt at getting this to work (still failing  
after plenty of Apache restarts):

Action thepython-program /home/evert/sw/bin/python2.5
# Django directory
<Location "/testing/">
     SetHandler thepython-program
     PythonHandler django.core.handlers.modpython
     SetEnv DJANGO_SETTINGS_MODULE mysite.settings
     PythonDebug On
</Location>


I'm beginning to run out of ideas (& Google search terms). Does anyone  
have any pointers?

   Evert

From ccbean at gmail.com  Thu Apr 10 14:32:18 2008
From: ccbean at gmail.com (Colin Bean)
Date: Thu Apr 10 14:32:24 2008
Subject: [mod_python] need help solving some performance issues
In-Reply-To: <20080410165726.GA99314@pcbsd>
References: <20080410165726.GA99314@pcbsd>
Message-ID: <29a6ca010804101132j34de4bc4g7bcb86b68feab0fa@mail.gmail.com>

On Thu, Apr 10, 2008 at 9:57 AM, Culley Harrelson <harrelson@gmail.com> wrote:
> I manage a mod_python application that was built about 4 years ago and has
>  not changed much since.  It uses clearsilver templates and interacts with
>  postgresql via psychopg.  The database is on a second machine and the
>  mod_python machine (FreeBSD) has no other major applications.
>
>  The application is much more popular than it was when it was built and I am
>  now encountering some performance problems.  Specifically the CPU seems to be
>  the bottleneck.  The machine has 2 gigs of ram and a single processor.  Ram
>  doesn't seem to be a problem.  When examining top output, I see that every
>  once in a while a process comes along and sucks down 10%-20% of the cpu.  A
>  handful of these processes can (and regularly do) consume the whole CPU.
>
>  I don't really know how to go about optimizing the CPU usage of my
>  application.  Any suggestions are extremely welcome.
>


Have you profiled your code at all?  Might help to track down problem areas...


>  Currently my plan is to throw hardware at problem.  The traditional way to
>  expand would be to add an additional webserver and do DNS round robin, or
>  something like that.  Unfortunately this would cause database problems for
>  me.  Top of my todo list is to swap out psycopg and use sqlrelay but I don't
>  have enough time to do this quickly.  So... I am now considering switching to
>  a dual cpu system.  I would keep apache in prefork mode-- I have read that
>  this works fine on systems with 2 processors.
>

Could you be more specific about the database problems you're
anticipating?  Are you worried about the database server being able to
scale as well?


You might also want to look at caching solutions, especially if you
have plenty of RAM :)  You could probably roll your own with Memcached
without too much trouble, and this could potentially ease the load on
the CPU quite a bit.

Colin
From harrelson at gmail.com  Thu Apr 10 14:42:30 2008
From: harrelson at gmail.com (Culley Harrelson)
Date: Thu Apr 10 14:42:38 2008
Subject: [mod_python] need help solving some performance issues
In-Reply-To: <07D8D817-E6F2-4AC5-83F5-E04B092816C6@monkeysnatchbanana.com>
References: <20080410165726.GA99314@pcbsd>
	<437E739E-8390-4C95-AFC1-5FEF8B974C69@monkeysnatchbanana.com>
	<20080410181120.GD21749@pcbsd>
	<07D8D817-E6F2-4AC5-83F5-E04B092816C6@monkeysnatchbanana.com>
Message-ID: <20080410184230.GE21749@pcbsd>

> 
> Do you know what those processes are doing when they suck up the cpu?
> 
> Is it something that you could offload to another machine?
> 
> Obviously throwing more hardware at the problem can work but it sounds like
> your setup right now doesnt allow for a ton of movement you can do in that 
> area.
> 
> Re-working the entire thing is one option but you might try to skate by
> before doing that by seeing if you can move just the problem areas.

So far my technique for finding out what these processes are doing is to
observe top, copy the pid of a problem and then quickly switch over to apache
server-status output, refresh and look for the pid.  I wish I knew a better
way...

The results of this un-scientific technique do not point to a particular area
of the site.  I do know that there are 3 directory-type scripts that get
hammered by the search engines.  The site has over 400,000 records in google
and all of these pages are dynamically generated by these scripts.

I suppose I could just do some mod_proxy stuff to redirect some of these...
Not a bad idea if I could do it without affecting google rank (i.e. no visible
redirecting).  But this is still adding additional hardware.  If adding a
dual cpu system would buy me the same performance boost I could end of life
the current machine and my monthly fees would be less than 2 single cpu
machines.  Not that the fees are a big concern-- mostly I am interested in
the simplest setup.  1 machine and no mod_proxy seems simpler.

I have no experience with dual cpu machines though-- this is part of my
concern.  I manage 6 production FreeBSD servers but they are all single cpu
systems.  If apache is in prefork mode 2 cpus is just extra processing power
right?!?

ch
From harrelson at gmail.com  Thu Apr 10 14:53:12 2008
From: harrelson at gmail.com (Culley Harrelson)
Date: Thu Apr 10 14:53:22 2008
Subject: [mod_python] need help solving some performance issues
In-Reply-To: <29a6ca010804101132j34de4bc4g7bcb86b68feab0fa@mail.gmail.com>
References: <20080410165726.GA99314@pcbsd>
	<29a6ca010804101132j34de4bc4g7bcb86b68feab0fa@mail.gmail.com>
Message-ID: <20080410185312.GF21749@pcbsd>

On Thu, 10 Apr 2008, Colin Bean wrote:

> 
> Have you profiled your code at all?  Might help to track down problem areas...
> 

No I haven't.  Is there a way to profile it in the context of
mod_python?  A lot of what is happening is manipulating clearsilver datasets.

> 
> >  Currently my plan is to throw hardware at problem.  The traditional way to
> >  expand would be to add an additional webserver and do DNS round robin, or
> >  something like that.  Unfortunately this would cause database problems for
> >  me.  Top of my todo list is to swap out psycopg and use sqlrelay but I don't
> >  have enough time to do this quickly.  So... I am now considering switching to
> >  a dual cpu system.  I would keep apache in prefork mode-- I have read that
> >  this works fine on systems with 2 processors.
> >
> 
> Could you be more specific about the database problems you're
> anticipating?  Are you worried about the database server being able to
> scale as well?
> 

Right now I do not have connection pooling-- one process, one database
connection.  If I add a second web server I am going to run out of database
processes.  My postgresql server is on FreeBSD and increasing the available
processes for postgresql on FreeBSD is a major pain.

The database is doing fine-- hardly any load at all.  All the problems seem
to be in the application realm.  Connection pooling is definitely needed.

> 
> You might also want to look at caching solutions, especially if you
> have plenty of RAM :)  You could probably roll your own with Memcached
> without too much trouble, and this could potentially ease the load on
> the CPU quite a bit.

The database load doesn't seem to be really a big problem.  There are hundred
of thousands of pages, each translated into 6 languages.  I tinkered around
with mod_cache a bit but it couldn't handle it.

You are right-- trying to profile it is probably the first order of business.

Fyi the site in question is:

http://www.flashcardexchange.com/

From joe at incomps.com  Thu Apr 10 15:02:46 2008
From: joe at incomps.com (Joseph Bernhardt)
Date: Thu Apr 10 15:03:04 2008
Subject: [mod_python] need help solving some performance issues
In-Reply-To: <20080410184230.GE21749@pcbsd>
References: <20080410165726.GA99314@pcbsd>	<437E739E-8390-4C95-AFC1-5FEF8B974C69@monkeysnatchbanana.com>	<20080410181120.GD21749@pcbsd>	<07D8D817-E6F2-4AC5-83F5-E04B092816C6@monkeysnatchbanana.com>
	<20080410184230.GE21749@pcbsd>
Message-ID: <008301c89b3d$772605b0$65721110$@com>

> The results of this un-scientific technique do not point to a
> particular area
> of the site.  I do know that there are 3 directory-type scripts that
> get
> hammered by the search engines.  The site has over 400,000 records in
> google
> and all of these pages are dynamically generated by these scripts.

Have you considered a static cache of these dynamically generated pages as
to not have a small number of scripts handling millions of requests for
thousands of individual pages, whereas the cache generation would be
performed by these scripts on a timed basis?   This would virtually
eliminate any page load issues your visitors may be experiencing.  Or, does
the page data need to accurate for time?


From mail-lists at peachnet.com  Thu Apr 10 15:08:51 2008
From: mail-lists at peachnet.com (mail-lists)
Date: Thu Apr 10 15:08:48 2008
Subject: [mod_python] Newbie Question
In-Reply-To: <3E632451-81BB-4BA5-80A6-A1931E2E2425@monkeysnatchbanana.com>
References: <47FE26DE.7060703@peachnet.com>
	<3E632451-81BB-4BA5-80A6-A1931E2E2425@monkeysnatchbanana.com>
Message-ID: <47FE65C3.2090103@peachnet.com>

Sean Allen wrote:
> 
> On Apr 10, 2008, at 10:40 AM, mail-lists wrote:
>> Hello,
>>
>> I have a quick question and it might be very silly:
>>
>> How do I pass variables between pages short of building a query string 
>> into the URL? Is there a way to set variables in the request object?
>>
>> What I'm trying to do is the following:
>>
>> user fills out a form
>> form calls saveform function
> 
> when? via an onSubmit handler?

no, no JavaScript at all, sorry. I guess I wasn't  very clear. Form 
action=saveform which is a python function ( def saveform(req) )
> 
>>
>> input is validated
> 
> where is the input validated? in 'saveform' that is a javascript function?

input is validated in saveform.
> 
>>
>> if not valid input return to the form with user values filled out.
>>
> 
> what exactly is 'return' here?
> from a server side script? from a javascript validation routine?
> 
return is a util.redirect back to the form.

My question is how do I pass request variables BACK to the form short of 
  using a query string.

ie. is it possible to do something like the following:

req_data=util.FieldStorage(req)
req_data["form_item"]="ThisisastringIwanttopopulatetheformwith"

I've tried this obviously but it doesn't work. I'm not sure if something 
like this SHOULD work because I don't quite understand whether or not 
the request object persists across the redirect.

I hope I'm asking this in the right way :)


Thank you










From ccbean at gmail.com  Thu Apr 10 15:10:39 2008
From: ccbean at gmail.com (Colin Bean)
Date: Thu Apr 10 15:10:44 2008
Subject: [mod_python] need help solving some performance issues
In-Reply-To: <20080410185312.GF21749@pcbsd>
References: <20080410165726.GA99314@pcbsd>
	<29a6ca010804101132j34de4bc4g7bcb86b68feab0fa@mail.gmail.com>
	<20080410185312.GF21749@pcbsd>
Message-ID: <29a6ca010804101210i5e60412dm6983b31bd915f4ed@mail.gmail.com>

On Thu, Apr 10, 2008 at 11:53 AM, Culley Harrelson <harrelson@gmail.com> wrote:
> On Thu, 10 Apr 2008, Colin Bean wrote:
>
>  >
>  > Have you profiled your code at all?  Might help to track down problem areas...
>  >
>
>  No I haven't.  Is there a way to profile it in the context of
>  mod_python?  A lot of what is happening is manipulating clearsilver datasets.
>

Here's some information on profiling with Publisher:
http://www.modpython.org/pipermail/mod_python/2007-September/024237.html

Basically, whatever handler you're using, you can write a
ProfileHandler which wraps your original handler in some profiling
code.  I did this a while ago with the built in profile module and a
custom handler.  Hopefully you have a development server where you can
set this up, and perhaps hammer it with some load testing tools.

>  >
>  >
>  > You might also want to look at caching solutions, especially if you
>  > have plenty of RAM :)  You could probably roll your own with Memcached
>  > without too much trouble, and this could potentially ease the load on
>  > the CPU quite a bit.
>
>  The database load doesn't seem to be really a big problem.  There are hundred
>  of thousands of pages, each translated into 6 languages.  I tinkered around
>  with mod_cache a bit but it couldn't handle it.
>

Was thinking more of caching your rendered templates (as whole pages
or fragments), if you can make this workable with user permissions,
etc.  That would save your server from rendering them from scratch on
every page hit.  This is especially good if your content is something
that doesn't change often (like flash cards :) ).

Colin
From ccbean at gmail.com  Thu Apr 10 15:16:12 2008
From: ccbean at gmail.com (Colin Bean)
Date: Thu Apr 10 15:16:17 2008
Subject: [mod_python] Newbie Question
In-Reply-To: <47FE65C3.2090103@peachnet.com>
References: <47FE26DE.7060703@peachnet.com>
	<3E632451-81BB-4BA5-80A6-A1931E2E2425@monkeysnatchbanana.com>
	<47FE65C3.2090103@peachnet.com>
Message-ID: <29a6ca010804101216q54a5bf2aqfa5c790c280dfe55@mail.gmail.com>

Are you looking for sessions (
http://modpython.org/live/current/doc-html/pyapi-sess.html )?  That's
really the only way to persist your object across redirects...

Colin

On Thu, Apr 10, 2008 at 12:08 PM, mail-lists <mail-lists@peachnet.com> wrote:
> Sean Allen wrote:
>
> >
> > On Apr 10, 2008, at 10:40 AM, mail-lists wrote:
> >
> > > Hello,
> > >
> > > I have a quick question and it might be very silly:
> > >
> > > How do I pass variables between pages short of building a query string
> into the URL? Is there a way to set variables in the request object?
> > >
> > > What I'm trying to do is the following:
> > >
> > > user fills out a form
> > > form calls saveform function
> > >
> >
> > when? via an onSubmit handler?
> >
>
>  no, no JavaScript at all, sorry. I guess I wasn't  very clear. Form
> action=saveform which is a python function ( def saveform(req) )
>
>
> >
> >
> > >
> > > input is validated
> > >
> >
> > where is the input validated? in 'saveform' that is a javascript function?
> >
>
>  input is validated in saveform.
>
>
> >
> >
> > >
> > > if not valid input return to the form with user values filled out.
> > >
> > >
> >
> > what exactly is 'return' here?
> > from a server side script? from a javascript validation routine?
> >
> >
>  return is a util.redirect back to the form.
>
>  My question is how do I pass request variables BACK to the form short of
> using a query string.
>
>  ie. is it possible to do something like the following:
>
>  req_data=util.FieldStorage(req)
>  req_data["form_item"]="ThisisastringIwanttopopulatetheformwith"
>
>  I've tried this obviously but it doesn't work. I'm not sure if something
> like this SHOULD work because I don't quite understand whether or not the
> request object persists across the redirect.
>
>  I hope I'm asking this in the right way :)
>
>
>  Thank you
>
>
>
>
>
>
>
>
>
>
>
>
>  _______________________________________________
>  Mod_python mailing list
>  Mod_python@modpython.org
>  http://mailman.modpython.org/mailman/listinfo/mod_python
>
From clodoaldo.pinto.neto at gmail.com  Thu Apr 10 15:29:04 2008
From: clodoaldo.pinto.neto at gmail.com (Clodoaldo)
Date: Thu Apr 10 15:29:09 2008
Subject: [mod_python] Newbie Question
In-Reply-To: <47FE65C3.2090103@peachnet.com>
References: <47FE26DE.7060703@peachnet.com>
	<3E632451-81BB-4BA5-80A6-A1931E2E2425@monkeysnatchbanana.com>
	<47FE65C3.2090103@peachnet.com>
Message-ID: <a595de7a0804101229u4af88d8bta5d975fc8e6dcf65@mail.gmail.com>

2008/4/10, mail-lists <mail-lists@peachnet.com>:
> Sean Allen wrote:
>
> >
> > On Apr 10, 2008, at 10:40 AM, mail-lists wrote:
> >
> > > Hello,
> > >
> > > I have a quick question and it might be very silly:
> > >
> > > How do I pass variables between pages short of building a query string
> into the URL? Is there a way to set variables in the request object?
> > >
> > > What I'm trying to do is the following:
> > >
> > > user fills out a form
> > > form calls saveform function
> > >
> >
> > when? via an onSubmit handler?
> >
>
>  no, no JavaScript at all, sorry. I guess I wasn't  very clear. Form
> action=saveform which is a python function ( def saveform(req) )
>
> >
> >
> > >
> > > input is validated
> > >
> >
> > where is the input validated? in 'saveform' that is a javascript function?
> >
>
>  input is validated in saveform.
>
> >
> >
> > >
> > > if not valid input return to the form with user values filled out.
> > >
> > >
> >
> > what exactly is 'return' here?
> > from a server side script? from a javascript validation routine?
> >
> >
>  return is a util.redirect back to the form.

Why redirect? Why don't you just put saveform in the same page of the
form and then return the form page now with the values of the inputs
filled.

>  My question is how do I pass request variables BACK to the form short of
> using a query string.
>
>  ie. is it possible to do something like the following:
>
>  req_data=util.FieldStorage(req)
> req_data["form_item"]="ThisisastringIwanttopopulatetheformwith"
>
>  I've tried this obviously but it doesn't work. I'm not sure if something
> like this SHOULD work because I don't quite understand whether or not the
> request object persists across the redirect.
>
>  I hope I'm asking this in the right way :)
>
>
>  Thank you
>
>
>
>
>
>
>
>
>
>
>
>  _______________________________________________
>  Mod_python mailing list
>  Mod_python@modpython.org
>  http://mailman.modpython.org/mailman/listinfo/mod_python
>
From mail-lists at peachnet.com  Thu Apr 10 15:51:17 2008
From: mail-lists at peachnet.com (mail-lists)
Date: Thu Apr 10 15:51:29 2008
Subject: [mod_python] Newbie Question
In-Reply-To: <29a6ca010804101216q54a5bf2aqfa5c790c280dfe55@mail.gmail.com>
References: <47FE26DE.7060703@peachnet.com>	
	<3E632451-81BB-4BA5-80A6-A1931E2E2425@monkeysnatchbanana.com>	
	<47FE65C3.2090103@peachnet.com>
	<29a6ca010804101216q54a5bf2aqfa5c790c280dfe55@mail.gmail.com>
Message-ID: <47FE6FB5.6020709@peachnet.com>

Colin Bean wrote:
> Are you looking for sessions (
> http://modpython.org/live/current/doc-html/pyapi-sess.html )?  That's
> really the only way to persist your object across redirects...

No, I don't think that's what I want to do.

I just really want to do the same thing as a form does except on the 
server side ie. I want to set attributes in the FieldStorage class.

I'm going to hazard a guess here and say that my concept of this is 
wrong and I cannot modify the request object the way I think I can.
Maybe I can write out what I'm doing:

##############################

def addcustomer(req):

	html = """A bunch of html that displays among other things the
                   following form:
                     <form action=savecustomer method="get">
                       <input type="text" name="customer_name">
                       <input type="submit">""""

	return html


def savecustomer(req):

	req_data=util.FieldStorage(req)

	customer_name=req_data["customer_name"].value
	valid = myvalidatefunction(customer_name)
	
	if ! valid:
	   #HOW DO I SET THE ITEM IN THE FIELDSTORAGE CLASS HERE
	   util.redirect(req, "addcustomer")


#############################

I don't know if that makes it any clearer or not.
	

Thanks for all the help on this!
From clodoaldo.pinto.neto at gmail.com  Thu Apr 10 16:37:50 2008
From: clodoaldo.pinto.neto at gmail.com (Clodoaldo)
Date: Thu Apr 10 16:37:57 2008
Subject: [mod_python] Newbie Question
In-Reply-To: <47FE6FB5.6020709@peachnet.com>
References: <47FE26DE.7060703@peachnet.com>
	<3E632451-81BB-4BA5-80A6-A1931E2E2425@monkeysnatchbanana.com>
	<47FE65C3.2090103@peachnet.com>
	<29a6ca010804101216q54a5bf2aqfa5c790c280dfe55@mail.gmail.com>
	<47FE6FB5.6020709@peachnet.com>
Message-ID: <a595de7a0804101337o1e0da112m516f2e012c90862c@mail.gmail.com>

2008/4/10, mail-lists <mail-lists@peachnet.com>:
> Colin Bean wrote:
>
> > Are you looking for sessions (
> >
> http://modpython.org/live/current/doc-html/pyapi-sess.html
> )?  That's
> > really the only way to persist your object across redirects...
> >
>
>  No, I don't think that's what I want to do.
>
>  I just really want to do the same thing as a form does except on the server
> side ie. I want to set attributes in the FieldStorage class.
>
>  I'm going to hazard a guess here and say that my concept of this is wrong
> and I cannot modify the request object the way I think I can.
>  Maybe I can write out what I'm doing:
>
>  ##############################

  def addcustomer(req, custormer_name):

         html = """A bunch of html that displays among other things the
                   following form:
                     <form action=savecustomer method="get">
                       <input type="text" name="customer_name" value="%s">
                       <input type="submit">"""" % customer_name

         return html


  def savecustomer(req):

         customer_name = req.form.getfirst('customer_name', '')

         valid = myvalidatefunction(customer_name)

         if ! valid:
            addcustomer(req, 'custome_name')


Regards, Clodoaldo
From graham.dumpleton at gmail.com  Thu Apr 10 18:37:37 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu Apr 10 18:37:43 2008
Subject: [mod_python] Setting the python executable
In-Reply-To: <269DDBF6-71C9-4902-8358-865CF785682B@gmail.com>
References: <269DDBF6-71C9-4902-8358-865CF785682B@gmail.com>
Message-ID: <88e286470804101537l47e1a848y8603db6de340abb0@mail.gmail.com>

2008/4/11 Evert Rol <evert.rol@gmail.com>:
>   Hi all,
>
>  I'm having a hard time telling Apache (or mod_python) to tell which python
> executable to use.
>  The thing is, I don't have a root access, so I'm running the Apache server
> and python 2.5 under my user account. Both have also been installed this
> way, ie, they are in my in the directory tree of my user account.
>  To avoid interference with the older system python (2.3), I just call
> python with the full path (I try to avoid changing my path, since some of
> these scripts run as cron jobs, bypassing a lot of setup files).
>  Bit of debugging (eg, print sys.executable in a mod_python script) showed,
> however, that mod_python is still happily using the system python, not my
> locally installed. That goes fine up to a certain point, but it does of
> course crash in the end. I had compiled mod_python with the --with-python
> and --with-apxs options, but looks like that doesn't help here.
>  After some further searching around, I came across the Action directive for
> Apache; still didn't work, although that may be simply because I did that
> incorrectly.
>
>  For the record, I'm using mod_python for Django, maing things potentially
> more convoluted.
>  Here's what my latest attempt at getting this to work (still failing after
> plenty of Apache restarts):
>
>  Action thepython-program /home/evert/sw/bin/python2.5
>  # Django directory
>  <Location "/testing/">
>     SetHandler thepython-program
>     PythonHandler django.core.handlers.modpython
>     SetEnv DJANGO_SETTINGS_MODULE mysite.settings
>     PythonDebug On
>  </Location>
>
>
>  I'm beginning to run out of ideas (& Google search terms). Does anyone have
> any pointers?

The mod_python module embeds the Python interpreter and so it can only
use the version you compiled it against, Your attempts therefore to
use Action are fruitless in that respect, but also because that isn't
what the Action directive is for.

Please clarify which version of mod_python you are using and which
version of Python it was actually compiled against. If using
mod_python 3.3.1 you should see warning/error messages in Apache error
log on startup when the version of Python that it was compiled against
was in a non standard location on path of Apache user and thus
couldn't be found. This though would generally result in complete
failure, yet you suggest it works for a bit and fails which suggests
that mod_python isn't compiled against version of Python you want and
it is your Python code which is incompatible with the version of
Python that mod_python was compiled for.

Also see:

  https://issues.apache.org/jira/browse/MODPYTHON-225

Graham
From graham.dumpleton at gmail.com  Thu Apr 10 18:47:39 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu Apr 10 18:47:48 2008
Subject: [mod_python] need help solving some performance issues
In-Reply-To: <20080410184230.GE21749@pcbsd>
References: <20080410165726.GA99314@pcbsd>
	<437E739E-8390-4C95-AFC1-5FEF8B974C69@monkeysnatchbanana.com>
	<20080410181120.GD21749@pcbsd>
	<07D8D817-E6F2-4AC5-83F5-E04B092816C6@monkeysnatchbanana.com>
	<20080410184230.GE21749@pcbsd>
Message-ID: <88e286470804101547p462f1db0va9d20e91cd1203f3@mail.gmail.com>

2008/4/11 Culley Harrelson <harrelson@gmail.com>:
>
>  I have no experience with dual cpu machines though-- this is part of my
>  concern.  I manage 6 production FreeBSD servers but they are all single cpu
>  systems.  If apache is in prefork mode 2 cpus is just extra processing power
>  right?!?

Even if you were using worker MPM and multithreaded applications,
multiple CPUs or cores will help with Apache, because it would still
be running as a multiprocess application and a lot of stuff happens in
C code also which is capable of being spread across multiple CPUs or
cores.

For Apache on UNIX boxes at least, the Python GIL is not the big
problem that the many people make it out to be. See:

  http://blog.dscpl.com.au/2007/09/parallel-python-discussion-and-modwsgi.html
  http://blog.dscpl.com.au/2007/07/web-hosting-landscape-and-modwsgi.html

Graham
From matusis at yahoo.com  Thu Apr 10 22:03:42 2008
From: matusis at yahoo.com (Alec Matusis)
Date: Thu Apr 10 22:04:00 2008
Subject: [mod_python] need help solving some performance issues
In-Reply-To: <88e286470804101547p462f1db0va9d20e91cd1203f3@mail.gmail.com>
References: <20080410165726.GA99314@pcbsd>	<437E739E-8390-4C95-AFC1-5FEF8B974C69@monkeysnatchbanana.com>	<20080410181120.GD21749@pcbsd>	<07D8D817-E6F2-4AC5-83F5-E04B092816C6@monkeysnatchbanana.com>	<20080410184230.GE21749@pcbsd>
	<88e286470804101547p462f1db0va9d20e91cd1203f3@mail.gmail.com>
Message-ID: <009701c89b78$44ecce90$cec66bb0$@com>

>From my experience, with worker MPM not only multiple cores helps, but I
think larger L2 cache helps a lot.
I suspect it has to do with context switching- perhaps data from several
threads can be kept in L2.

I have two almost identical servers serving same requests (load balancing),
first with 2x 2.66GHz Xeons with 512KB L2 , and second with 2x 3.0GHz Xeons
with 1MB L2. The performance of the second server is much better than what I
would expect from 2.66/3.0 GHz ratio.

> -----Original Message-----
> From: mod_python-bounces@modpython.org [mailto:mod_python-
> bounces@modpython.org] On Behalf Of Graham Dumpleton
> Sent: Thursday, April 10, 2008 3:48 PM
> To: Culley Harrelson
> Cc: mod_python@modpython.org
> Subject: Re: [mod_python] need help solving some performance issues
> 
> 2008/4/11 Culley Harrelson <harrelson@gmail.com>:
> >
> >  I have no experience with dual cpu machines though-- this is part of
> my
> >  concern.  I manage 6 production FreeBSD servers but they are all
> single cpu
> >  systems.  If apache is in prefork mode 2 cpus is just extra
> processing power
> >  right?!?
> 
> Even if you were using worker MPM and multithreaded applications,
> multiple CPUs or cores will help with Apache, because it would still
> be running as a multiprocess application and a lot of stuff happens in
> C code also which is capable of being spread across multiple CPUs or
> cores.
> 
> For Apache on UNIX boxes at least, the Python GIL is not the big
> problem that the many people make it out to be. See:
> 
>   http://blog.dscpl.com.au/2007/09/parallel-python-discussion-and-
> modwsgi.html
>   http://blog.dscpl.com.au/2007/07/web-hosting-landscape-and-
> modwsgi.html
> 
> Graham
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python


From graham.dumpleton at gmail.com  Thu Apr 10 22:28:57 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu Apr 10 22:29:02 2008
Subject: [mod_python] need help solving some performance issues
In-Reply-To: <009701c89b78$44ecce90$cec66bb0$@com>
References: <20080410165726.GA99314@pcbsd>
	<437E739E-8390-4C95-AFC1-5FEF8B974C69@monkeysnatchbanana.com>
	<20080410181120.GD21749@pcbsd>
	<07D8D817-E6F2-4AC5-83F5-E04B092816C6@monkeysnatchbanana.com>
	<20080410184230.GE21749@pcbsd>
	<88e286470804101547p462f1db0va9d20e91cd1203f3@mail.gmail.com>
	<009701c89b78$44ecce90$cec66bb0$@com>
Message-ID: <88e286470804101928s10a883cpf2c69aeb7e947214@mail.gmail.com>

Larger CPU caches will always help, even with prefork. It is more to
do with how much stuff can be kept in near memory vs having to go to
standard memory. Unfortunately a high level language like Python cant
really utilise CPU caches as well as they could be as C/C++ where
direct control of layout of data in memory is possible.

Graham

2008/4/11 Alec Matusis <matusis@yahoo.com>:
> From my experience, with worker MPM not only multiple cores helps, but I
>  think larger L2 cache helps a lot.
>  I suspect it has to do with context switching- perhaps data from several
>  threads can be kept in L2.
>
>  I have two almost identical servers serving same requests (load balancing),
>  first with 2x 2.66GHz Xeons with 512KB L2 , and second with 2x 3.0GHz Xeons
>  with 1MB L2. The performance of the second server is much better than what I
>  would expect from 2.66/3.0 GHz ratio.
>
>
>
>  > -----Original Message-----
>  > From: mod_python-bounces@modpython.org [mailto:mod_python-
>  > bounces@modpython.org] On Behalf Of Graham Dumpleton
>  > Sent: Thursday, April 10, 2008 3:48 PM
>  > To: Culley Harrelson
>  > Cc: mod_python@modpython.org
>  > Subject: Re: [mod_python] need help solving some performance issues
>  >
>  > 2008/4/11 Culley Harrelson <harrelson@gmail.com>:
>  > >
>  > >  I have no experience with dual cpu machines though-- this is part of
>  > my
>  > >  concern.  I manage 6 production FreeBSD servers but they are all
>  > single cpu
>  > >  systems.  If apache is in prefork mode 2 cpus is just extra
>  > processing power
>  > >  right?!?
>  >
>  > Even if you were using worker MPM and multithreaded applications,
>  > multiple CPUs or cores will help with Apache, because it would still
>  > be running as a multiprocess application and a lot of stuff happens in
>  > C code also which is capable of being spread across multiple CPUs or
>  > cores.
>  >
>  > For Apache on UNIX boxes at least, the Python GIL is not the big
>  > problem that the many people make it out to be. See:
>  >
>  >   http://blog.dscpl.com.au/2007/09/parallel-python-discussion-and-
>  > modwsgi.html
>  >   http://blog.dscpl.com.au/2007/07/web-hosting-landscape-and-
>  > modwsgi.html
>  >
>  > Graham
>
>
> > _______________________________________________
>  > Mod_python mailing list
>  > Mod_python@modpython.org
>  > http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
>
From rahul.warhekar at edisphere.com  Fri Apr 11 00:56:01 2008
From: rahul.warhekar at edisphere.com (rahul.warhekar@edisphere.com)
Date: Fri Apr 11 00:57:20 2008
Subject: [mod_python] accessing c++ functions from mod_python pages
Message-ID: <33045.59.90.39.43.1207889761.squirrel@www.edisphere.com>

hi all,

I am having problem in executing my c++ functions through .psp pages.
I have to run one of my application using written in c++ through
python.
Please help me if u have any kind of solution to this.

From graham.dumpleton at gmail.com  Fri Apr 11 01:04:56 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Fri Apr 11 01:05:03 2008
Subject: [mod_python] accessing c++ functions from mod_python pages
In-Reply-To: <33045.59.90.39.43.1207889761.squirrel@www.edisphere.com>
References: <33045.59.90.39.43.1207889761.squirrel@www.edisphere.com>
Message-ID: <88e286470804102204n637de6deybb20a2aaa045602b@mail.gmail.com>

2008/4/11  <rahul.warhekar@edisphere.com>:
> hi all,
>
>  I am having problem in executing my c++ functions through .psp pages.
>  I have to run one of my application using written in c++ through
>  python.
>  Please help me if u have any kind of solution to this.

You don't give us enough information. What exactly are you trying to
do and what is the actual problem?

Are you trying to use Python extension modules written in C/C++, or
are you simply trying to find a way to execute a standalone program
which happens to be implemented in C/C++.

Explain and give examples, plus error messages or anything else you have.

Graham
From evert.rol at gmail.com  Fri Apr 11 04:14:42 2008
From: evert.rol at gmail.com (Evert Rol)
Date: Fri Apr 11 04:15:08 2008
Subject: [mod_python] Setting the python executable
In-Reply-To: <88e286470804101537l47e1a848y8603db6de340abb0@mail.gmail.com>
References: <269DDBF6-71C9-4902-8358-865CF785682B@gmail.com>
	<88e286470804101537l47e1a848y8603db6de340abb0@mail.gmail.com>
Message-ID: <DDFA4E5B-21F7-4DF6-9F01-0B07B5BD9131@gmail.com>

>> I'm having a hard time telling Apache (or mod_python) to tell which  
>> python
>> executable to use.
>> The thing is, I don't have a root access, so I'm running the Apache  
>> server
>> and python 2.5 under my user account. Both have also been installed  
>> this
>> way, ie, they are in my in the directory tree of my user account.
>> To avoid interference with the older system python (2.3), I just call
>> python with the full path (I try to avoid changing my path, since  
>> some of
>> these scripts run as cron jobs, bypassing a lot of setup files).
>> Bit of debugging (eg, print sys.executable in a mod_python script)  
>> showed,
>> however, that mod_python is still happily using the system python,  
>> not my
>> locally installed. That goes fine up to a certain point, but it  
>> does of
>> course crash in the end. I had compiled mod_python with the --with- 
>> python
>> and --with-apxs options, but looks like that doesn't help here.
>> After some further searching around, I came across the Action  
>> directive for
>> Apache; still didn't work, although that may be simply because I  
>> did that
>> incorrectly.
>>
>> For the record, I'm using mod_python for Django, maing things  
>> potentially
>> more convoluted.
>> Here's what my latest attempt at getting this to work (still  
>> failing after
>> plenty of Apache restarts):
>>
>> Action thepython-program /home/evert/sw/bin/python2.5
>> # Django directory
>> <Location "/testing/">
>>    SetHandler thepython-program
>>    PythonHandler django.core.handlers.modpython
>>    SetEnv DJANGO_SETTINGS_MODULE mysite.settings
>>    PythonDebug On
>> </Location>
>>
>>
>> I'm beginning to run out of ideas (& Google search terms). Does  
>> anyone have
>> any pointers?
>
> The mod_python module embeds the Python interpreter and so it can only
> use the version you compiled it against, Your attempts therefore to
> use Action are fruitless in that respect, but also because that isn't
> what the Action directive is for.
>
> Please clarify which version of mod_python you are using and which
> version of Python it was actually compiled against. If using
> mod_python 3.3.1 you should see warning/error messages in Apache error
> log on startup when the version of Python that it was compiled against
> was in a non standard location on path of Apache user and thus
> couldn't be found. This though would generally result in complete
> failure, yet you suggest it works for a bit and fails which suggests
> that mod_python isn't compiled against version of Python you want and
> it is your Python code which is incompatible with the version of
> Python that mod_python was compiled for.

It is 3.3.1, with Python 2.5; the system python at /usr/bin/python is  
2.3. I cannot recall having seen any warning messages in the logs on  
finding the incorrect Python version. And I have absolutely no idea  
why parts of it seemed to work, and then it decided to crash. Looks  
like that had to do with sqlite from within Python, so it could be  
running into sqlite library incompatibilities (I don't know if 2.5 &  
2.3 handle those differently; does 2.3 using the system library, while  
2.5 has it built-in and therefore uses a different version?).
I did manage to solve it with setting the PATH, which, as said, isn't  
my preferred option.

>  https://issues.apache.org/jira/browse/MODPYTHON-225

Yep, that pretty much sums it up. Both the problem I'm having and the  
solution I wanted to achieve (set Apache directive to pick up the  
correct Python, instead of setting PATH). Looks like I just hadn't put  
the right search terms into Google.
I guess I have to make do with it for now.

   Evert

From graham.dumpleton at gmail.com  Fri Apr 11 04:51:17 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Fri Apr 11 04:51:23 2008
Subject: [mod_python] Setting the python executable
In-Reply-To: <DDFA4E5B-21F7-4DF6-9F01-0B07B5BD9131@gmail.com>
References: <269DDBF6-71C9-4902-8358-865CF785682B@gmail.com>
	<88e286470804101537l47e1a848y8603db6de340abb0@mail.gmail.com>
	<DDFA4E5B-21F7-4DF6-9F01-0B07B5BD9131@gmail.com>
Message-ID: <88e286470804110151v7c4028a7gea9a51346cd8534@mail.gmail.com>

2008/4/11 Evert Rol <evert.rol@gmail.com>:
>
>
> >
> > > I'm having a hard time telling Apache (or mod_python) to tell which
> python
> > > executable to use.
> > > The thing is, I don't have a root access, so I'm running the Apache
> server
> > > and python 2.5 under my user account. Both have also been installed this
> > > way, ie, they are in my in the directory tree of my user account.
> > > To avoid interference with the older system python (2.3), I just call
> > > python with the full path (I try to avoid changing my path, since some
> of
> > > these scripts run as cron jobs, bypassing a lot of setup files).
> > > Bit of debugging (eg, print sys.executable in a mod_python script)
> showed,
> > > however, that mod_python is still happily using the system python, not
> my
> > > locally installed. That goes fine up to a certain point, but it does of
> > > course crash in the end. I had compiled mod_python with the
> --with-python
> > > and --with-apxs options, but looks like that doesn't help here.
> > > After some further searching around, I came across the Action directive
> for
> > > Apache; still didn't work, although that may be simply because I did
> that
> > > incorrectly.
> > >
> > > For the record, I'm using mod_python for Django, maing things
> potentially
> > > more convoluted.
> > > Here's what my latest attempt at getting this to work (still failing
> after
> > > plenty of Apache restarts):
> > >
> > > Action thepython-program /home/evert/sw/bin/python2.5
> > > # Django directory
> > > <Location "/testing/">
> > >   SetHandler thepython-program
> > >   PythonHandler django.core.handlers.modpython
> > >   SetEnv DJANGO_SETTINGS_MODULE mysite.settings
> > >   PythonDebug On
> > > </Location>
> > >
> > >
> > > I'm beginning to run out of ideas (& Google search terms). Does anyone
> have
> > > any pointers?
> > >
> >
> > The mod_python module embeds the Python interpreter and so it can only
> > use the version you compiled it against, Your attempts therefore to
> > use Action are fruitless in that respect, but also because that isn't
> > what the Action directive is for.
> >
> > Please clarify which version of mod_python you are using and which
> > version of Python it was actually compiled against. If using
> > mod_python 3.3.1 you should see warning/error messages in Apache error
> > log on startup when the version of Python that it was compiled against
> > was in a non standard location on path of Apache user and thus
> > couldn't be found. This though would generally result in complete
> > failure, yet you suggest it works for a bit and fails which suggests
> > that mod_python isn't compiled against version of Python you want and
> > it is your Python code which is incompatible with the version of
> > Python that mod_python was compiled for.
> >
>
>  It is 3.3.1, with Python 2.5; the system python at /usr/bin/python is 2.3.
> I cannot recall having seen any warning messages in the logs on finding the
> incorrect Python version. And I have absolutely no idea why parts of it
> seemed to work, and then it decided to crash. Looks like that had to do with
> sqlite from within Python, so it could be running into sqlite library
> incompatibilities (I don't know if 2.5 & 2.3 handle those differently; does
> 2.3 using the system library, while 2.5 has it built-in and therefore uses a
> different version?).
>  I did manage to solve it with setting the PATH, which, as said, isn't my
> preferred option.
>
>
>
> >  https://issues.apache.org/jira/browse/MODPYTHON-225
> >
>
>  Yep, that pretty much sums it up. Both the problem I'm having and the
> solution I wanted to achieve (set Apache directive to pick up the correct
> Python, instead of setting PATH). Looks like I just hadn't put the right
> search terms into Google.
>  I guess I have to make do with it for now.

Or if you only need it for hosting a WSGI application like Django, use
mod_wsgi instead. When using mod_wsgi you can override Python install
prefix for this sort of problem in Apache configuration. See section
'Multiple Python Versions' in:

  http://code.google.com/p/modwsgi/wiki/InstallationIssues

Graham
From evert.rol at gmail.com  Fri Apr 11 05:40:20 2008
From: evert.rol at gmail.com (Evert Rol)
Date: Fri Apr 11 05:40:33 2008
Subject: [mod_python] Setting the python executable
In-Reply-To: <88e286470804110151v7c4028a7gea9a51346cd8534@mail.gmail.com>
References: <269DDBF6-71C9-4902-8358-865CF785682B@gmail.com>
	<88e286470804101537l47e1a848y8603db6de340abb0@mail.gmail.com>
	<DDFA4E5B-21F7-4DF6-9F01-0B07B5BD9131@gmail.com>
	<88e286470804110151v7c4028a7gea9a51346cd8534@mail.gmail.com>
Message-ID: <65BCC27D-014F-4240-AEAE-15926CBBF1E7@gmail.com>

>>>
>>> https://issues.apache.org/jira/browse/MODPYTHON-225
>>>
>>
>> Yep, that pretty much sums it up. Both the problem I'm having and the
>> solution I wanted to achieve (set Apache directive to pick up the  
>> correct
>> Python, instead of setting PATH). Looks like I just hadn't put the  
>> right
>> search terms into Google.
>> I guess I have to make do with it for now.
>
> Or if you only need it for hosting a WSGI application like Django, use
> mod_wsgi instead. When using mod_wsgi you can override Python install
> prefix for this sort of problem in Apache configuration. See section
> 'Multiple Python Versions' in:
>
>  http://code.google.com/p/modwsgi/wiki/InstallationIssues

Well, I'm also running MoinMoin through mod_python (though I now  
should double check that that goes allright with my current setup).
But unless there's some clashing between mod_python & mod_wsgi, I  
wouldn't mind installing mod_wsgi for the Django part, while for the  
moment running MoinMoin through mod_python. I'll have a look at  
mod_wsgi then.


From graham.dumpleton at gmail.com  Fri Apr 11 06:44:14 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Fri Apr 11 06:44:20 2008
Subject: [mod_python] Setting the python executable
In-Reply-To: <65BCC27D-014F-4240-AEAE-15926CBBF1E7@gmail.com>
References: <269DDBF6-71C9-4902-8358-865CF785682B@gmail.com>
	<88e286470804101537l47e1a848y8603db6de340abb0@mail.gmail.com>
	<DDFA4E5B-21F7-4DF6-9F01-0B07B5BD9131@gmail.com>
	<88e286470804110151v7c4028a7gea9a51346cd8534@mail.gmail.com>
	<65BCC27D-014F-4240-AEAE-15926CBBF1E7@gmail.com>
Message-ID: <88e286470804110344k2eba919bj620ea146313389fd@mail.gmail.com>

MoinMoin works okay on mod_wsgi as well. Go look at MoinMoin documentation.

  http://code.google.com/p/modwsgi/wiki/IntegrationWithMoinMoin
  http://code.google.com/p/modwsgi/wiki/IntegrationWithDjango

You can install mod_python and mod_wsgi at same time, but important
that your Python version uses a shared library. The installation
issues document I pointed you to before talks about that.

Graham

2008/4/11 Evert Rol <evert.rol@gmail.com>:
>
> >
> > >
> > > >
> > > > https://issues.apache.org/jira/browse/MODPYTHON-225
> > > >
> > > >
> > >
> > > Yep, that pretty much sums it up. Both the problem I'm having and the
> > > solution I wanted to achieve (set Apache directive to pick up the
> correct
> > > Python, instead of setting PATH). Looks like I just hadn't put the right
> > > search terms into Google.
> > > I guess I have to make do with it for now.
> > >
> >
> > Or if you only need it for hosting a WSGI application like Django, use
> > mod_wsgi instead. When using mod_wsgi you can override Python install
> > prefix for this sort of problem in Apache configuration. See section
> > 'Multiple Python Versions' in:
> >
> >  http://code.google.com/p/modwsgi/wiki/InstallationIssues
> >
>
>  Well, I'm also running MoinMoin through mod_python (though I now should
> double check that that goes allright with my current setup).
>  But unless there's some clashing between mod_python & mod_wsgi, I wouldn't
> mind installing mod_wsgi for the Django part, while for the moment running
> MoinMoin through mod_python. I'll have a look at mod_wsgi then.
>
>
>
>
>  _______________________________________________
>  Mod_python mailing list
>  Mod_python@modpython.org
>  http://mailman.modpython.org/mailman/listinfo/mod_python
>
From graham.dumpleton at gmail.com  Fri Apr 11 06:53:12 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Fri Apr 11 06:53:19 2008
Subject: [mod_python] Setting the python executable
In-Reply-To: <88e286470804110344k2eba919bj620ea146313389fd@mail.gmail.com>
References: <269DDBF6-71C9-4902-8358-865CF785682B@gmail.com>
	<88e286470804101537l47e1a848y8603db6de340abb0@mail.gmail.com>
	<DDFA4E5B-21F7-4DF6-9F01-0B07B5BD9131@gmail.com>
	<88e286470804110151v7c4028a7gea9a51346cd8534@mail.gmail.com>
	<65BCC27D-014F-4240-AEAE-15926CBBF1E7@gmail.com>
	<88e286470804110344k2eba919bj620ea146313389fd@mail.gmail.com>
Message-ID: <88e286470804110353r3e032753h6627eeb170406014@mail.gmail.com>

2008/4/11 Graham Dumpleton <graham.dumpleton@gmail.com>:
> MoinMoin works okay on mod_wsgi as well. Go look at MoinMoin documentation.
>
>   http://code.google.com/p/modwsgi/wiki/IntegrationWithMoinMoin
>   http://code.google.com/p/modwsgi/wiki/IntegrationWithDjango
>
>  You can install mod_python and mod_wsgi at same time, but important
>  that your Python version uses a shared library. The installation
>  issues document I pointed you to before talks about that.

Actually, if you load mod_python and mod_wsgi at same time, you cant
use the WSGIPythonHome directive which is documented. This is because
mod_python takes precedence and since it doesn't do the correct thing,
it will still not work.

Thus, if wanting to use WSGIPythonHome, can only use mod_wsgi, not
both together.

Graham

>  Graham
>
>
>  2008/4/11 Evert Rol <evert.rol@gmail.com>:
>  >
>  > >
>  > > >
>  > > > >
>
>
> > > > > https://issues.apache.org/jira/browse/MODPYTHON-225
>  > > > >
>  > > > >
>  > > >
>  > > > Yep, that pretty much sums it up. Both the problem I'm having and the
>  > > > solution I wanted to achieve (set Apache directive to pick up the
>  > correct
>  > > > Python, instead of setting PATH). Looks like I just hadn't put the right
>  > > > search terms into Google.
>  > > > I guess I have to make do with it for now.
>  > > >
>  > >
>  > > Or if you only need it for hosting a WSGI application like Django, use
>  > > mod_wsgi instead. When using mod_wsgi you can override Python install
>  > > prefix for this sort of problem in Apache configuration. See section
>  > > 'Multiple Python Versions' in:
>  > >
>  > >  http://code.google.com/p/modwsgi/wiki/InstallationIssues
>  > >
>  >
>  >  Well, I'm also running MoinMoin through mod_python (though I now should
>  > double check that that goes allright with my current setup).
>  >  But unless there's some clashing between mod_python & mod_wsgi, I wouldn't
>  > mind installing mod_wsgi for the Django part, while for the moment running
>  > MoinMoin through mod_python. I'll have a look at mod_wsgi then.
>  >
>  >
>  >
>  >
>  >  _______________________________________________
>  >  Mod_python mailing list
>  >  Mod_python@modpython.org
>  >  http://mailman.modpython.org/mailman/listinfo/mod_python
>  >
>
From sean at monkeysnatchbanana.com  Fri Apr 11 09:00:24 2008
From: sean at monkeysnatchbanana.com (Sean Allen)
Date: Fri Apr 11 09:00:33 2008
Subject: [mod_python] need help solving some performance issues
In-Reply-To: <20080410185312.GF21749@pcbsd>
References: <20080410165726.GA99314@pcbsd>
	<29a6ca010804101132j34de4bc4g7bcb86b68feab0fa@mail.gmail.com>
	<20080410185312.GF21749@pcbsd>
Message-ID: <5E86B996-AC47-47DF-AA5F-8FB4161538B5@monkeysnatchbanana.com>


On Apr 10, 2008, at 2:53 PM, Culley Harrelson wrote:
>>
>> You might also want to look at caching solutions, especially if you
>> have plenty of RAM :)  You could probably roll your own with  
>> Memcached
>> without too much trouble, and this could potentially ease the load on
>> the CPU quite a bit.
>
> The database load doesn't seem to be really a big problem.  There  
> are hundred
> of thousands of pages, each translated into 6 languages.  I tinkered  
> around
> with mod_cache a bit but it couldn't handle it.
>

As a better way to tackle that.

We have a mod_perl based application ( that is being transfered to  
mod_python )
and during high load period we found with profiling that there was no  
area
that we could improve it was just the entire process was taking too  
long and
to many reuqests were backing up and eventually either two many apache
processes were launched and swapping and thrashing started or we had  
timeouts.

this on code that took far less than 1 second from start to end. the  
code in question
was mostly dynamically generating html, we spend about 60 minutes  
rewriting the code
to store the final output for each different dynamic request in  
memcache and configuring
out front end nginx server to do the following:

check for file
check in memcache
check with application

the 2nd step was the new part and we havent had a peep since then.  
server load ( debian linux )
hasnt crossed much beyond .5 since then and is usually below .3

as a bonus, our client side response time went down because the front  
end static server is competing
less with the dynamic server for cpu time.

From sean at monkeysnatchbanana.com  Fri Apr 11 09:07:57 2008
From: sean at monkeysnatchbanana.com (Sean Allen)
Date: Fri Apr 11 09:08:15 2008
Subject: [mod_python] Newbie Question
In-Reply-To: <a595de7a0804101337o1e0da112m516f2e012c90862c@mail.gmail.com>
References: <47FE26DE.7060703@peachnet.com>
	<3E632451-81BB-4BA5-80A6-A1931E2E2425@monkeysnatchbanana.com>
	<47FE65C3.2090103@peachnet.com>
	<29a6ca010804101216q54a5bf2aqfa5c790c280dfe55@mail.gmail.com>
	<47FE6FB5.6020709@peachnet.com>
	<a595de7a0804101337o1e0da112m516f2e012c90862c@mail.gmail.com>
Message-ID: <11C0A5DC-E02C-4F10-8CA1-7DB190BE7A69@monkeysnatchbanana.com>

>>
>         if ! valid:
>            addcustomer(req, 'custome_name')

This can become an issue if you are concerned about what your url is.

For example if you do a mapping so that the url from save is:

/myapp/save

then that addcustomer return would appear as

/myapp/save

instead of your normal

/myapp/enter

type situation.

if the url is a concern in your application ( some it is, some it isnt )
then a redirect of some sort is what you want. you could either
parse query string in js on client ( arg ) or have your initial display
code work more like:

def addcustomer(req):

         req_data=util.FieldStorage(req)

         # now use req_data values to supply value="" elements to  
inputs below.
         # so addcustomer can be add/edit customer. multi-use instead  
of single.
         # afterall add is just a edit edge case
	html = """A bunch of html that displays among other things the
                  following form:
                    <form action=savecustomer method="get">
                      <input type="text" name="customer_name" value="">
                      <input type="submit">""""

	return html
From Wayne.Collier at noaa.gov  Fri Apr 11 11:58:47 2008
From: Wayne.Collier at noaa.gov (wayne collier)
Date: Fri Apr 11 11:58:52 2008
Subject: [mod_python] Problem with connection to Oracle via
	Apache/mod_python/cx_Oracle
Message-ID: <47FF8AB7.9E1E943F@noaa.gov>

Hello all. I am having a heck of time getting a connection to a remote
Oracle server from web application.
>From my lInux prompt I am able to connect to the database with cx_Oracle
with no probelm. However, when similar code is executed
throught the web app (apache+mod_python+cx_Oracle) I keep getting
DatabaseError: ORA-12541: TNS:no listener.

Does this has anything to do with the permissions of the apache process
on Oracle files? I have been able to set and read LD_LIBRARY_PATH,
ORACLE_HOME and TNS_ADMIN within the web app code. As far as I know, my
TNS_NAMES file is the same one used by root and web users. Is a such
good assumption?

Any help would be greatly appreciated!



-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080411/82cc8642/attachment-0001.html
From s.kuzmenko at gmail.com  Sun Apr 13 21:54:36 2008
From: s.kuzmenko at gmail.com (Sergiy Kuzmenko)
Date: Sun Apr 13 21:54:45 2008
Subject: [mod_python] importing from package under mod_python.publisher
Message-ID: <e34a76360804131854m337a76aamf0f424f1ff1056cf@mail.gmail.com>

Hi everybody,

Question about importing from package under mod_python.publisher.

Consider the following directory structure:

py
    foo
        __init__.py
        bar.py
    boo.py
    test.py

Let's say we have the following in test.py:

 import boo
 import foo.bar

When running test.py from command line this works fine. However, under
mod_python only "import boo" works and importing from a subdirectory
via "import foo.bar" produces ImportError: No module named foo.

This seems to be a deviation form the standard python's behaviour.

What is even more confusing that mod_python manual
(http://modpython.org/live/current/doc-html/tut-what-it-do.html)
states the following when describing the PythonHandler directive: "If
not already done, prepend the directory in which the PythonHandler
directive was found to sys.path".

When inspecting sys.path from a publisher defined like this:

<Directory /path/to/the/webroot/py>
 AddHandler mod_python .py
 PythonHandler publisher
 PythonDebug On
</Directory>

/path/to/the/webroot/py is actually not the system path!

Thanks
Sergiy
From graham.dumpleton at gmail.com  Sun Apr 13 22:12:42 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sun Apr 13 22:12:49 2008
Subject: [mod_python] importing from package under mod_python.publisher
In-Reply-To: <e34a76360804131854m337a76aamf0f424f1ff1056cf@mail.gmail.com>
References: <e34a76360804131854m337a76aamf0f424f1ff1056cf@mail.gmail.com>
Message-ID: <88e286470804131912o77c2d54n7d40fe8af86d71df@mail.gmail.com>

2008/4/14 Sergiy Kuzmenko <s.kuzmenko@gmail.com>:
> Hi everybody,
>
>  Question about importing from package under mod_python.publisher.
>
>  Consider the following directory structure:
>
>  py
>     foo
>         __init__.py
>         bar.py
>     boo.py
>     test.py
>
>  Let's say we have the following in test.py:
>
>   import boo
>   import foo.bar
>
>  When running test.py from command line this works fine. However, under
>  mod_python only "import boo" works and importing from a subdirectory
>  via "import foo.bar" produces ImportError: No module named foo.
>
>  This seems to be a deviation form the standard python's behaviour.
>
>  What is even more confusing that mod_python manual
>  (http://modpython.org/live/current/doc-html/tut-what-it-do.html)
>  states the following when describing the PythonHandler directive: "If
>  not already done, prepend the directory in which the PythonHandler
>  directive was found to sys.path".

The documentation is no longer accurate then. It would be helpful if
you can create an issue at:

  https://issues.apache.org/jira/browse/MODPYTHON

pointing out this part of documentation and that it may be wrong.

>  When inspecting sys.path from a publisher defined like this:
>
>  <Directory /path/to/the/webroot/py>
>   AddHandler mod_python .py
>   PythonHandler publisher
>   PythonDebug On
>  </Directory>
>
>  /path/to/the/webroot/py is actually not the system path!

Read documentation for import_module() in:

  http://www.modpython.org/live/current/doc-html/pyapi-apmeth.html

This is what is used my mod_python module importer. It was rewritten
for mod_python 3.3.1 and one way in which it is different is that
directories are not added to sys.path for handler directory now. As a
consequence of this and how module importer path and sys.path are kept
separate, you can't/shouldn't go installing Python packages in the
document tree for your application.

The simple answer therefore is to place your Python package outside of
the document tree and extend sys.path directly or by using PythonPath
to refer to that other directory location.

Graham
From s.kuzmenko at gmail.com  Sun Apr 13 22:41:12 2008
From: s.kuzmenko at gmail.com (Sergiy Kuzmenko)
Date: Sun Apr 13 22:41:18 2008
Subject: [mod_python] importing from package under mod_python.publisher
In-Reply-To: <88e286470804131912o77c2d54n7d40fe8af86d71df@mail.gmail.com>
References: <e34a76360804131854m337a76aamf0f424f1ff1056cf@mail.gmail.com>
	<88e286470804131912o77c2d54n7d40fe8af86d71df@mail.gmail.com>
Message-ID: <e34a76360804131941p78bf6f28q2fe38da54363e496@mail.gmail.com>

Thank you Graham.
I have created a new issues.

Sergiy

On Sun, Apr 13, 2008 at 10:12 PM, Graham Dumpleton
<graham.dumpleton@gmail.com> wrote:
> 2008/4/14 Sergiy Kuzmenko <s.kuzmenko@gmail.com>:
>
> > Hi everybody,
>  >
>  >  Question about importing from package under mod_python.publisher.
>  >
>  >  Consider the following directory structure:
>  >
>  >  py
>  >     foo
>  >         __init__.py
>  >         bar.py
>  >     boo.py
>  >     test.py
>  >
>  >  Let's say we have the following in test.py:
>  >
>  >   import boo
>  >   import foo.bar
>  >
>  >  When running test.py from command line this works fine. However, under
>  >  mod_python only "import boo" works and importing from a subdirectory
>  >  via "import foo.bar" produces ImportError: No module named foo.
>  >
>  >  This seems to be a deviation form the standard python's behaviour.
>  >
>  >  What is even more confusing that mod_python manual
>  >  (http://modpython.org/live/current/doc-html/tut-what-it-do.html)
>  >  states the following when describing the PythonHandler directive: "If
>  >  not already done, prepend the directory in which the PythonHandler
>  >  directive was found to sys.path".
>
>  The documentation is no longer accurate then. It would be helpful if
>  you can create an issue at:
>
>   https://issues.apache.org/jira/browse/MODPYTHON
>
>  pointing out this part of documentation and that it may be wrong.
>
>
>  >  When inspecting sys.path from a publisher defined like this:
>  >
>  >  <Directory /path/to/the/webroot/py>
>  >   AddHandler mod_python .py
>  >   PythonHandler publisher
>  >   PythonDebug On
>  >  </Directory>
>  >
>  >  /path/to/the/webroot/py is actually not the system path!
>
>  Read documentation for import_module() in:
>
>   http://www.modpython.org/live/current/doc-html/pyapi-apmeth.html
>
>  This is what is used my mod_python module importer. It was rewritten
>  for mod_python 3.3.1 and one way in which it is different is that
>  directories are not added to sys.path for handler directory now. As a
>  consequence of this and how module importer path and sys.path are kept
>  separate, you can't/shouldn't go installing Python packages in the
>  document tree for your application.
>
>  The simple answer therefore is to place your Python package outside of
>  the document tree and extend sys.path directly or by using PythonPath
>  to refer to that other directory location.
>
>  Graham
>
From noodles at planetslackers.com  Mon Apr 14 22:15:31 2008
From: noodles at planetslackers.com (Nick Le Mouton)
Date: Mon Apr 14 22:15:47 2008
Subject: [mod_python] Python scripts are showing source code
Message-ID: <03a101c89e9e$94e18c50$0101010a@auckland.woolshed.com>

Hi all,

I'm new to python and mod_python and I'm trying to get a script to work on
my install of Apache.

I've installed mod_python and I can see that it's installed in the
error_log:

[Tue Apr 15 13:26:44 2008] [notice] Apache/2.2.8 (Unix) mod_ssl/2.2.8
OpenSSL/0.9.7a PHP/5.2.5 mod_python/3.3.1 Python/2.3.4 configured --
resuming normal operations

I have added LoadModule python_module modules/mod_python.so in httpd.conf

As well as AddHandler mod_python .py

The script I'm trying to run is in the cgi-bin for apache,
/usr/local/apache2/cgi-bin/, this is also setup with ScriptAlias as per the
default httpd.conf.

I'm running Apache 2.2.8 on Redhat Enterprise Linux 4. Apache is installed
from source, python and python-devel from rpm.

No matter what I do I still see the source code of the py file rather than
it running.

Can anyone help?
Thanks
Nick

From graham.dumpleton at gmail.com  Tue Apr 15 00:02:50 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue Apr 15 00:02:55 2008
Subject: [mod_python] Python scripts are showing source code
In-Reply-To: <03a101c89e9e$94e18c50$0101010a@auckland.woolshed.com>
References: <03a101c89e9e$94e18c50$0101010a@auckland.woolshed.com>
Message-ID: <88e286470804142102l30aa7646h28cf15724b1dd5a8@mail.gmail.com>

Try reading:

  http://www.dscpl.com.au/wiki/ModPython/Articles/GettingModPythonWorking

Graham

2008/4/15 Nick Le Mouton <noodles@planetslackers.com>:
> Hi all,
>
>  I'm new to python and mod_python and I'm trying to get a script to work on
>  my install of Apache.
>
>  I've installed mod_python and I can see that it's installed in the
>  error_log:
>
>  [Tue Apr 15 13:26:44 2008] [notice] Apache/2.2.8 (Unix) mod_ssl/2.2.8
>  OpenSSL/0.9.7a PHP/5.2.5 mod_python/3.3.1 Python/2.3.4 configured --
>  resuming normal operations
>
>  I have added LoadModule python_module modules/mod_python.so in httpd.conf
>
>  As well as AddHandler mod_python .py
>
>  The script I'm trying to run is in the cgi-bin for apache,
>  /usr/local/apache2/cgi-bin/, this is also setup with ScriptAlias as per the
>  default httpd.conf.
>
>  I'm running Apache 2.2.8 on Redhat Enterprise Linux 4. Apache is installed
>  from source, python and python-devel from rpm.
>
>  No matter what I do I still see the source code of the py file rather than
>  it running.
>
>  Can anyone help?
>  Thanks
>  Nick
>
>  _______________________________________________
>  Mod_python mailing list
>  Mod_python@modpython.org
>  http://mailman.modpython.org/mailman/listinfo/mod_python
>
From noodles at planetslackers.com  Tue Apr 15 01:40:14 2008
From: noodles at planetslackers.com (Nick Le Mouton)
Date: Tue Apr 15 01:40:20 2008
Subject: [mod_python] Python scripts are showing source code
In-Reply-To: <88e286470804142102l30aa7646h28cf15724b1dd5a8@mail.gmail.com>
References: <03a101c89e9e$94e18c50$0101010a@auckland.woolshed.com>
	<88e286470804142102l30aa7646h28cf15724b1dd5a8@mail.gmail.com>
Message-ID: <04c701c89ebb$2dd4e8a0$0100a8c0@spicy>

I've been reading that page and followed it to the letter apart from adding
the PythonHandler and PythonDebug.

I don't really see how I'd need either of these to run a single script.

Nick

-----Original Message-----
From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com] 
Sent: Tuesday, 15 April 2008 4:03 p.m.
To: Nick Le Mouton
Cc: mod_python@modpython.org
Subject: Re: [mod_python] Python scripts are showing source code

Try reading:

  http://www.dscpl.com.au/wiki/ModPython/Articles/GettingModPythonWorking

Graham

2008/4/15 Nick Le Mouton <noodles@planetslackers.com>:
> Hi all,
>
>  I'm new to python and mod_python and I'm trying to get a script to work
on
>  my install of Apache.
>
>  I've installed mod_python and I can see that it's installed in the
>  error_log:
>
>  [Tue Apr 15 13:26:44 2008] [notice] Apache/2.2.8 (Unix) mod_ssl/2.2.8
>  OpenSSL/0.9.7a PHP/5.2.5 mod_python/3.3.1 Python/2.3.4 configured --
>  resuming normal operations
>
>  I have added LoadModule python_module modules/mod_python.so in httpd.conf
>
>  As well as AddHandler mod_python .py
>
>  The script I'm trying to run is in the cgi-bin for apache,
>  /usr/local/apache2/cgi-bin/, this is also setup with ScriptAlias as per
the
>  default httpd.conf.
>
>  I'm running Apache 2.2.8 on Redhat Enterprise Linux 4. Apache is
installed
>  from source, python and python-devel from rpm.
>
>  No matter what I do I still see the source code of the py file rather
than
>  it running.
>
>  Can anyone help?
>  Thanks
>  Nick
>
>  _______________________________________________
>  Mod_python mailing list
>  Mod_python@modpython.org
>  http://mailman.modpython.org/mailman/listinfo/mod_python
>


From graham.dumpleton at gmail.com  Tue Apr 15 01:48:52 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue Apr 15 01:48:58 2008
Subject: [mod_python] Python scripts are showing source code
In-Reply-To: <04c701c89ebb$2dd4e8a0$0100a8c0@spicy>
References: <03a101c89e9e$94e18c50$0101010a@auckland.woolshed.com>
	<88e286470804142102l30aa7646h28cf15724b1dd5a8@mail.gmail.com>
	<04c701c89ebb$2dd4e8a0$0100a8c0@spicy>
Message-ID: <88e286470804142248s775138br7ea215aed1a657d6@mail.gmail.com>

2008/4/15 Nick Le Mouton <noodles@planetslackers.com>:
> I've been reading that page and followed it to the letter apart from adding
>  the PythonHandler and PythonDebug.
>
>  I don't really see how I'd need either of these to run a single script.

Basic mod_python handlers are not resource based like CGI. You
actually have to tell mod_python the name of a Python module
containing a content handler to execute. Thus PythonHandler directive
is very important. PythonDebug is useful because if something goes
wrong the error will show in the browser rather than you having to dig
through the Apache error logs to find it.

Thus, perhaps rather than make assumptions just follow the
instructions and get something working first to verify mod_python
works.

The closest thing then to the CGI resource model is to use
mod_python.publisher as PythonHandler. You then should however refer
to parts of mod_python documentation which talk about
mod_python.publisher as how you code the handler and other stuff in
the file is different.

Graham

>  Nick
>
>
>
>  -----Original Message-----
>  From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
>  Sent: Tuesday, 15 April 2008 4:03 p.m.
>  To: Nick Le Mouton
>  Cc: mod_python@modpython.org
>  Subject: Re: [mod_python] Python scripts are showing source code
>
>  Try reading:
>
>   http://www.dscpl.com.au/wiki/ModPython/Articles/GettingModPythonWorking
>
>  Graham
>
>  2008/4/15 Nick Le Mouton <noodles@planetslackers.com>:
>  > Hi all,
>  >
>  >  I'm new to python and mod_python and I'm trying to get a script to work
>  on
>  >  my install of Apache.
>  >
>  >  I've installed mod_python and I can see that it's installed in the
>  >  error_log:
>  >
>  >  [Tue Apr 15 13:26:44 2008] [notice] Apache/2.2.8 (Unix) mod_ssl/2.2.8
>  >  OpenSSL/0.9.7a PHP/5.2.5 mod_python/3.3.1 Python/2.3.4 configured --
>  >  resuming normal operations
>  >
>  >  I have added LoadModule python_module modules/mod_python.so in httpd.conf
>  >
>  >  As well as AddHandler mod_python .py
>  >
>  >  The script I'm trying to run is in the cgi-bin for apache,
>  >  /usr/local/apache2/cgi-bin/, this is also setup with ScriptAlias as per
>  the
>  >  default httpd.conf.
>  >
>  >  I'm running Apache 2.2.8 on Redhat Enterprise Linux 4. Apache is
>  installed
>  >  from source, python and python-devel from rpm.
>  >
>  >  No matter what I do I still see the source code of the py file rather
>  than
>  >  it running.
>  >
>  >  Can anyone help?
>  >  Thanks
>  >  Nick
>  >
>  >  _______________________________________________
>  >  Mod_python mailing list
>  >  Mod_python@modpython.org
>  >  http://mailman.modpython.org/mailman/listinfo/mod_python
>  >
>
>
>
From moore.joseph at gmail.com  Tue Apr 15 13:11:53 2008
From: moore.joseph at gmail.com (Joe Moore)
Date: Tue Apr 15 13:11:59 2008
Subject: [mod_python] Installation Problems on Macbook Pro x86_64
Message-ID: <4f1637ee0804151011m7155b9c9r23343a08b897a5a6@mail.gmail.com>

Hello,
I'm attempting to install mod_python on my Macbook pro running 10.5.2 and I
am so far unsuccessful. I have read the various posts dating from October
and have compiled mod_python for x86_64. This allowed compilation but Apache
would die with the with the following error:

4/15/08 12:55:18 PM org.apache.httpd[26291] httpd: Syntax error on line 116
of /private/etc/apache2/httpd.conf: Cannot load
/usr/libexec/apache2/mod_python.so into server:
dlopen(/usr/libexec/apache2/mod_python.so, 10): Symbol not found:
_PyObject_GenericGetAttr\n  Referenced from:
/usr/libexec/apache2/mod_python.so\n  Expected in: dynamic lookup\n

I then read a post regarding the two pythons problem
(/System/Library/Frameworks + /Library/Frameworks) I don't believe I
installed the second but somehow it's there.

I removed the python at /Library/Frameworks and recompiled. This seems to
have worked in the sense that Apache no longer dies but I also can't seem to
get mod_python working. All python files are served as plaintext.

The added line to my httpd.conf looks like this:

LoadModule python_module libexec/apache2/mod_python.so

and I stuck a .htaccess in a directory in the sites folder under my user
account that contains:

AddHandler mod_python .py
PythonHandler mptest
PythonDebug On

and a test file in that same directory:

from mod_python import apache
def handler(req):
        req.content_type = 'text/plain'
        req.write("hello world!")
        return apache.OK

...Still plaintext

I appreciate any help. I have spent waaay to many hours trying to get this
up and running. My disclaimer here is that I'm a bit of an idiot about
Apache and have just started picking up Python.

Thanks!
Joe
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080415/310db153/attachment.html
From Wayne.Collier at noaa.gov  Tue Apr 15 13:51:39 2008
From: Wayne.Collier at noaa.gov (wayne collier)
Date: Tue Apr 15 13:51:44 2008
Subject: [mod_python] Problem getting my web app to work with remote oracle
	server
Message-ID: <4804EB2B.50409@noaa.gov>

I'm having a frustrating time getting my web app to connect with a 
remote oracle server.
However, from the linux prompt I am able to run oracle commands to 
connect to database.
The error message I get are as follows:

Mod_python error: "PythonHandler mod_python.psp" Traceback (most recent 
call last):

File "apache.py", line 299, in HandlerDispatch result = object(req)
File "/usr/local/lib/python2.4/site-packages/mod_python/psp.py", line 
302, in handler p.run()
File "/usr/local/lib/python2.4/site-packages/mod_python/psp.py", line 
213, in run exec code in global_scope
File "/var/www/html/psp/modinfo.psp", line 58, in ? oracle = 
cx_Oracle.connect(myUid, myPwd, myDsn) *

DatabaseError: ORA-12541: TNS:no listener*

I suspect that it has something to do with the permission of the *apache 
user* defined in the *httpd.conf file*.
Also, I have set the ORACLE_HOME,LD_LIBRARY_PATH and TNS_ADMIN variable 
to load and be initialized on startup. But it does not work!!!


Can someone help me with this?


Wayne




My set up is as follows:

PYTHON 2.4.4c1 (#1, Nov 6 2006, 14:14:48)
operating system  [GCC 3.4.6 20060404 (Red Hat 3.4.6-3)]
 MOD_PYTHON 3.2.10
Apache version 2.0.52


-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080415/287c3b02/attachment.html
From graham.dumpleton at gmail.com  Tue Apr 15 18:16:04 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue Apr 15 18:16:10 2008
Subject: [mod_python] Installation Problems on Macbook Pro x86_64
In-Reply-To: <4f1637ee0804151011m7155b9c9r23343a08b897a5a6@mail.gmail.com>
References: <4f1637ee0804151011m7155b9c9r23343a08b897a5a6@mail.gmail.com>
Message-ID: <88e286470804151516g7e140470q27ae235304a20c48@mail.gmail.com>

2008/4/16 Joe Moore <moore.joseph@gmail.com>:
> Hello,
> I'm attempting to install mod_python on my Macbook pro running 10.5.2 and I
> am so far unsuccessful. I have read the various posts dating from October
> and have compiled mod_python for x86_64. This allowed compilation but Apache
> would die with the with the following error:
>
> 4/15/08 12:55:18 PM org.apache.httpd[26291] httpd: Syntax error on line 116
> of /private/etc/apache2/httpd.conf: Cannot load
> /usr/libexec/apache2/mod_python.so into server:
> dlopen(/usr/libexec/apache2/mod_python.so, 10): Symbol not found:
> _PyObject_GenericGetAttr\n  Referenced from:
> /usr/libexec/apache2/mod_python.so\n  Expected in: dynamic lookup\n
>
> I then read a post regarding the two pythons problem
> (/System/Library/Frameworks + /Library/Frameworks) I don't believe I
> installed the second but somehow it's there.
>
> I removed the python at /Library/Frameworks and recompiled. This seems to
> have worked in the sense that Apache no longer dies but I also can't seem to
> get mod_python working. All python files are served as plaintext.
>
> The added line to my httpd.conf looks like this:
>
> LoadModule python_module libexec/apache2/mod_python.so
>
> and I stuck a .htaccess in a directory in the sites folder under my user
> account that contains:
>
> AddHandler mod_python .py
> PythonHandler mptest
> PythonDebug On
>
> and a test file in that same directory:
>
> from mod_python import apache
> def handler(req):
>         req.content_type = 'text/plain'
>          req.write("hello world!")
>         return apache.OK
>
> ...Still plaintext
>
> I appreciate any help. I have spent waaay to many hours trying to get this
> up and running. My disclaimer here is that I'm a bit of an idiot about
> Apache and have just started picking up Python.

Did you find:

  http://www.dscpl.com.au/wiki/ModPython/Articles/GettingModPythonWorking

Take particular note of whether you have FileInfo override enabled for
the directory you have the .htaccess file in.

Introduce a syntax error into that .htaccess file, ie., add some crap
like 'XXX' and see if Apache gives back a 500 error. If it doesn't the
file isn't even being consulted and FileInfo probably needs to be
enabled.

Graham
From graham.dumpleton at gmail.com  Tue Apr 15 18:17:35 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue Apr 15 18:17:41 2008
Subject: [mod_python] Problem getting my web app to work with remote
	oracle server
In-Reply-To: <4804EB2B.50409@noaa.gov>
References: <4804EB2B.50409@noaa.gov>
Message-ID: <88e286470804151517h133e6cedi2cc4569ecbaa372e@mail.gmail.com>

2008/4/16 wayne collier <Wayne.Collier@noaa.gov>:
>
>  I'm having a frustrating time getting my web app to connect with a remote
> oracle server.
>  However, from the linux prompt I am able to run oracle commands to connect
> to database.
>  The error message I get are as follows:
>
>  Mod_python error: "PythonHandler mod_python.psp" Traceback (most recent
> call last):
>
>  File "apache.py", line 299, in HandlerDispatch result = object(req)
>  File "/usr/local/lib/python2.4/site-packages/mod_python/psp.py", line 302,
> in handler p.run()
>  File "/usr/local/lib/python2.4/site-packages/mod_python/psp.py", line 213,
> in run exec code in global_scope
>  File "/var/www/html/psp/modinfo.psp", line 58, in ? oracle =
> cx_Oracle.connect(myUid, myPwd, myDsn)
>
>  DatabaseError: ORA-12541: TNS:no listener
>
>  I suspect that it has something to do with the permission of the apache
> user defined in the httpd.conf file.
>  Also, I have set the ORACLE_HOME,LD_LIBRARY_PATH and TNS_ADMIN variable to
> load and be initialized on startup. But it does not work!!!

Exactly where have you set these?

Graham

>  Can someone help me with this?
>
>
>  Wayne
>
>
>
>
>  My set up is as follows:
>
>  PYTHON 2.4.4c1 (#1, Nov 6 2006, 14:14:48)
>  operating system  [GCC 3.4.6 20060404 (Red Hat 3.4.6-3)]
>   MOD_PYTHON 3.2.10
>  Apache version 2.0.52
>
>
>
> _______________________________________________
>  Mod_python mailing list
>  Mod_python@modpython.org
>  http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
From moore.joseph at gmail.com  Wed Apr 16 00:33:51 2008
From: moore.joseph at gmail.com (Joe Moore)
Date: Wed Apr 16 00:40:12 2008
Subject: [mod_python] Installation Problems on Macbook Pro x86_64
In-Reply-To: <88e286470804151516g7e140470q27ae235304a20c48@mail.gmail.com>
References: <4f1637ee0804151011m7155b9c9r23343a08b897a5a6@mail.gmail.com>
	<88e286470804151516g7e140470q27ae235304a20c48@mail.gmail.com>
Message-ID: <4f1637ee0804152133p621a2e7ft3d9b5cf8011378e6@mail.gmail.com>

Thanks so much Graham!
Great docs! I wish I had found them earlier. I just changed the Apache
directive for the directory to AllowOverride All and everything now seems to
be working. On to adding MySQL to the party.
-Joe

On Tue, Apr 15, 2008 at 6:16 PM, Graham Dumpleton <
graham.dumpleton@gmail.com> wrote:

> 2008/4/16 Joe Moore <moore.joseph@gmail.com>:
> > Hello,
> > I'm attempting to install mod_python on my Macbook pro running 10.5.2
> and I
> > am so far unsuccessful. I have read the various posts dating from
> October
> > and have compiled mod_python for x86_64. This allowed compilation but
> Apache
> > would die with the with the following error:
> >
> > 4/15/08 12:55:18 PM org.apache.httpd[26291] httpd: Syntax error on line
> 116
> > of /private/etc/apache2/httpd.conf: Cannot load
> > /usr/libexec/apache2/mod_python.so into server:
> > dlopen(/usr/libexec/apache2/mod_python.so, 10): Symbol not found:
> > _PyObject_GenericGetAttr\n  Referenced from:
> > /usr/libexec/apache2/mod_python.so\n  Expected in: dynamic lookup\n
> >
> > I then read a post regarding the two pythons problem
> > (/System/Library/Frameworks + /Library/Frameworks) I don't believe I
> > installed the second but somehow it's there.
> >
> > I removed the python at /Library/Frameworks and recompiled. This seems
> to
> > have worked in the sense that Apache no longer dies but I also can't
> seem to
> > get mod_python working. All python files are served as plaintext.
> >
> > The added line to my httpd.conf looks like this:
> >
> > LoadModule python_module libexec/apache2/mod_python.so
> >
> > and I stuck a .htaccess in a directory in the sites folder under my user
> > account that contains:
> >
> > AddHandler mod_python .py
> > PythonHandler mptest
> > PythonDebug On
> >
> > and a test file in that same directory:
> >
> > from mod_python import apache
> > def handler(req):
> >         req.content_type = 'text/plain'
> >          req.write("hello world!")
> >         return apache.OK
> >
> > ...Still plaintext
> >
> > I appreciate any help. I have spent waaay to many hours trying to get
> this
> > up and running. My disclaimer here is that I'm a bit of an idiot about
> > Apache and have just started picking up Python.
>
> Did you find:
>
>  http://www.dscpl.com.au/wiki/ModPython/Articles/GettingModPythonWorking
>
> Take particular note of whether you have FileInfo override enabled for
> the directory you have the .htaccess file in.
>
> Introduce a syntax error into that .htaccess file, ie., add some crap
> like 'XXX' and see if Apache gives back a 500 error. If it doesn't the
> file isn't even being consulted and FileInfo probably needs to be
> enabled.
>
> Graham
>



-- 
Whatever is credible has authority; whatever is imposed has power. --de
certeau
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080416/f74eb4a2/attachment.html
From graham.dumpleton at gmail.com  Wed Apr 16 00:52:40 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Wed Apr 16 00:52:53 2008
Subject: [mod_python] Installation Problems on Macbook Pro x86_64
In-Reply-To: <4f1637ee0804152133p621a2e7ft3d9b5cf8011378e6@mail.gmail.com>
References: <4f1637ee0804151011m7155b9c9r23343a08b897a5a6@mail.gmail.com>
	<88e286470804151516g7e140470q27ae235304a20c48@mail.gmail.com>
	<4f1637ee0804152133p621a2e7ft3d9b5cf8011378e6@mail.gmail.com>
Message-ID: <88e286470804152152k5485dd05m28125d961890cb2f@mail.gmail.com>

2008/4/16 Joe Moore <moore.joseph@gmail.com>:
> Thanks so much Graham!
> Great docs! I wish I had found them earlier. I just changed the Apache
> directive for the directory to AllowOverride All and everything now seems to
> be working. On to adding MySQL to the party.

Just be warned that getting MySQL wrappers for Python built to be 64
bit is apparently a bit of a nightmare. Hopefully the MySQL people
have come out with a recipe for doing it.

Otherwise, search the mod_python, mod_wsgi and comp.lang.python lists
for discussions about other peoples steps for getting it working.

If stuck, come back here and I'll try and find the post where someone
worked it all out.

Graham

> On Tue, Apr 15, 2008 at 6:16 PM, Graham Dumpleton
> <graham.dumpleton@gmail.com> wrote:
> > 2008/4/16 Joe Moore <moore.joseph@gmail.com>:
> >
> >
> >
> > > Hello,
> > > I'm attempting to install mod_python on my Macbook pro running 10.5.2
> and I
> > > am so far unsuccessful. I have read the various posts dating from
> October
> > > and have compiled mod_python for x86_64. This allowed compilation but
> Apache
> > > would die with the with the following error:
> > >
> > > 4/15/08 12:55:18 PM org.apache.httpd[26291] httpd: Syntax error on line
> 116
> > > of /private/etc/apache2/httpd.conf: Cannot load
> > > /usr/libexec/apache2/mod_python.so into server:
> > > dlopen(/usr/libexec/apache2/mod_python.so, 10): Symbol not found:
> > > _PyObject_GenericGetAttr\n  Referenced from:
> > > /usr/libexec/apache2/mod_python.so\n  Expected in: dynamic lookup\n
> > >
> > > I then read a post regarding the two pythons problem
> > > (/System/Library/Frameworks + /Library/Frameworks) I don't believe I
> > > installed the second but somehow it's there.
> > >
> > > I removed the python at /Library/Frameworks and recompiled. This seems
> to
> > > have worked in the sense that Apache no longer dies but I also can't
> seem to
> > > get mod_python working. All python files are served as plaintext.
> > >
> > > The added line to my httpd.conf looks like this:
> > >
> > > LoadModule python_module libexec/apache2/mod_python.so
> > >
> > > and I stuck a .htaccess in a directory in the sites folder under my user
> > > account that contains:
> > >
> > > AddHandler mod_python .py
> > > PythonHandler mptest
> > > PythonDebug On
> > >
> > > and a test file in that same directory:
> > >
> > > from mod_python import apache
> > > def handler(req):
> > >         req.content_type = 'text/plain'
> > >          req.write("hello world!")
> > >         return apache.OK
> > >
> > > ...Still plaintext
> > >
> > > I appreciate any help. I have spent waaay to many hours trying to get
> this
> > > up and running. My disclaimer here is that I'm a bit of an idiot about
> > > Apache and have just started picking up Python.
> >
> > Did you find:
> >
> >  http://www.dscpl.com.au/wiki/ModPython/Articles/GettingModPythonWorking
> >
> > Take particular note of whether you have FileInfo override enabled for
> > the directory you have the .htaccess file in.
> >
> > Introduce a syntax error into that .htaccess file, ie., add some crap
> > like 'XXX' and see if Apache gives back a 500 error. If it doesn't the
> > file isn't even being consulted and FileInfo probably needs to be
> > enabled.
> >
> > Graham
> >
>
>
>
> --
> Whatever is credible has authority; whatever is imposed has power. --de
> certeau
> _______________________________________________
>  Mod_python mailing list
>  Mod_python@modpython.org
>  http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
From rahul.warhekar at edisphere.com  Thu Apr 17 01:42:34 2008
From: rahul.warhekar at edisphere.com (rahul.warhekar@edisphere.com)
Date: Thu Apr 17 02:02:22 2008
Subject: [mod_python] Executing c++ functions through psp
Message-ID: <56158.59.90.39.43.1208410954.squirrel@www.edisphere.com>

hello all

I want to execute user defined function written in c++ using python server
pages.
i.e. give input to that function and exccept output from that function and
display that output on web page.

can any one help me with this?
please Help.



From graham.dumpleton at gmail.com  Thu Apr 17 03:59:36 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu Apr 17 03:59:50 2008
Subject: [mod_python] Executing c++ functions through psp
In-Reply-To: <56158.59.90.39.43.1208410954.squirrel@www.edisphere.com>
References: <56158.59.90.39.43.1208410954.squirrel@www.edisphere.com>
Message-ID: <88e286470804170059j289b0d15k93c3e6524ec72256@mail.gmail.com>

2008/4/17  <rahul.warhekar@edisphere.com>:
> hello all
>
>  I want to execute user defined function written in c++ using python server
>  pages.
>  i.e. give input to that function and exccept output from that function and
>  display that output on web page.
>
>  can any one help me with this?

You need to do what you would do if it was normal Python code. You
need to write a Python extension module. You can either do this
explicitly using Python C API:

  http://docs.python.org/ext/ext.html
  http://docs.python.org/api/api.html

or use tools such as SWIG:

  http://www.swig.org

or Python Boost library:

  http://www.boost.org/doc/libs/1_35_0/libs/python/doc/index.html

You also may be able to use ctypes module:

  http://docs.python.org/lib/module-ctypes.html

if you are lucky to map calls direct into DLL/shared library.

Since all this is independent of mod_python, perhaps better to ask
further questions on Python mailing list.

  http://groups.google.com/group/comp.lang.python/topics?lnk=lr

Graham
From rrymaszewski at contentforces.pl  Thu Apr 17 06:20:10 2008
From: rrymaszewski at contentforces.pl (=?UTF-8?Q?Rados=C5=82aw_Rymaszewski?=)
Date: Thu Apr 17 06:20:27 2008
Subject: [mod_python] Proxy + Tomcat filter problems
Message-ID: <4834c71e0804170320y765408d4r7c93efe9eb3f4545@mail.gmail.com>

Hello

I was trying to find out solution for my problem but there were no answers,
so I decided to write here.

We are using mod_python filters for our system

Infrastructure description:

INTERNET <---> APACHE 2.8.3 with mod_python 3.3.1 + output filters <-->
Apache proxy module <--> TOMCAT 5.5.2x

our filters concat chunked content from tomcat and write to client whole
changed content. It's important for us to get whole response from tomcat and
after it process.

problem is when filter.read() reach last byte (filter.read() == None) then
there is no possibility to overwrite request headers.

There is no such problem during reading content and when we serve static
pages from apache www server.

mod_python receive such headers

1 chunk

[Wed Apr 16 05:52:15 2008] [error] {'Via': '1.1 domain', 'Set-Cookie':
'JSESSIONID=sessionXXX; Path=/path', 'Date': 'Fri, 18 Apr 2008 19:47:06
GMT', 'Cache-Control': 'no-store', 'Cache-Control': 'no-cache', 'Expires':
'Thu, 01 Jan 1970 00:00:00 GMT', 'Pragma': 'No-cache', 'Server':
'Apache-Coyote'}

2 chunk

[Wed Apr 16 05:52:15 2008] [error] {'Content-Type': 'text/plain',
'Transfer-Encoding': 'chunked', 'Connection': 'Keep-Alive', 'Keep-Alive':
'timeout=15, max=100', 'Via': '1.1 domain', 'Set-Cookie':
'JSESSIONID=sessionXXX; Path=/path', 'Cache-Control': 'No-cache', 'Expires':
'0', 'Pragma': 'No-cache'}

3 chunk

[Wed Apr 16 05:52:15 2008] [error] {'Content-Type': 'text/plain',
'Transfer-Encoding': 'chunked', 'Connection': 'Keep-Alive', 'Keep-Alive':
'timeout=15, max=100', 'Via': '1.1 domain', 'Set-Cookie':
'JSESSIONID=sessionXXX; Path=/path', 'Cache-Control': 'No-cache', 'Expires':
'0', 'Pragma': 'No-cache'}

when I finish process on first or second chunk I can modify headers without
any problems. after third one there is no such possibility

Do You know what could be wrong ?

-- 
Rados?aw Rymaszewski
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080417/66e3a9fa/attachment.html
From graham.dumpleton at gmail.com  Thu Apr 17 08:16:09 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu Apr 17 08:16:19 2008
Subject: [mod_python] Proxy + Tomcat filter problems
In-Reply-To: <4834c71e0804170320y765408d4r7c93efe9eb3f4545@mail.gmail.com>
References: <4834c71e0804170320y765408d4r7c93efe9eb3f4545@mail.gmail.com>
Message-ID: <88e286470804170516o3d4ff0c5l4b2a2c9dc5bab180@mail.gmail.com>

2008/4/17 Rados?aw Rymaszewski <rrymaszewski@contentforces.pl>:
> Hello
>
> I was trying to find out solution for my problem but there were no answers,
> so I decided to write here.
>
> We are using mod_python filters for our system
>
> Infrastructure description:
>
> INTERNET <---> APACHE 2.8.3 with mod_python 3.3.1 + output filters <-->
> Apache proxy module <--> TOMCAT 5.5.2x
>
> our filters concat chunked content from tomcat and write to client whole
> changed content. It's important for us to get whole response from tomcat and
> after it process.
>
> problem is when filter.read() reach last byte (filter.read() == None) then
> there is no possibility to overwrite request headers.
>
> There is no such problem during reading content and when we serve static
> pages from apache www server.
>
> mod_python receive such headers
>
> 1 chunk
>
> [Wed Apr 16 05:52:15 2008] [error] {'Via': '1.1 domain', 'Set-Cookie':
> 'JSESSIONID=sessionXXX; Path=/path', 'Date': 'Fri, 18 Apr 2008 19:47:06
> GMT', 'Cache-Control': 'no-store', 'Cache-Control': 'no-cache', 'Expires':
> 'Thu, 01 Jan 1970 00:00:00 GMT', 'Pragma': 'No-cache', 'Server':
> 'Apache-Coyote'}
>
> 2 chunk
>
> [Wed Apr 16 05:52:15 2008] [error] {'Content-Type': 'text/plain',
> 'Transfer-Encoding': 'chunked', 'Connection': 'Keep-Alive', 'Keep-Alive':
> 'timeout=15, max=100', 'Via': '1.1 domain', 'Set-Cookie':
> 'JSESSIONID=sessionXXX; Path=/path', 'Cache-Control': 'No-cache', 'Expires':
> '0', 'Pragma': 'No-cache'}
>
> 3 chunk
>
>  [Wed Apr 16 05:52:15 2008] [error] {'Content-Type': 'text/plain',
> 'Transfer-Encoding': 'chunked', 'Connection': 'Keep-Alive', 'Keep-Alive':
> 'timeout=15, max=100', 'Via': '1.1 domain', 'Set-Cookie':
> 'JSESSIONID=sessionXXX; Path=/path', 'Cache-Control': 'No-cache', 'Expires':
> '0', 'Pragma': 'No-cache'}
>
> when I finish process on first or second chunk I can modify headers without
> any problems. after third one there is no such possibility
>
> Do You know what could be wrong ?

As soon as any filter following yours has caused any chunk of data to
be written back to client, it is too late to change headers. This is
because headers are sent before the data.

Thus, headers can only be reliably changed upon reading first chunk
and before it is written to next filter. Only other choice is to
buffer the whole content in your filter, fixup any headers based on
that content and then write the whole content.

Graham

From rrymaszewski at contentforces.pl  Thu Apr 17 11:02:20 2008
From: rrymaszewski at contentforces.pl (=?UTF-8?Q?Rados=C5=82aw_Rymaszewski?=)
Date: Thu Apr 17 11:02:40 2008
Subject: [mod_python] Proxy + Tomcat filter problems
In-Reply-To: <88e286470804170516o3d4ff0c5l4b2a2c9dc5bab180@mail.gmail.com>
References: <4834c71e0804170320y765408d4r7c93efe9eb3f4545@mail.gmail.com>
	<88e286470804170516o3d4ff0c5l4b2a2c9dc5bab180@mail.gmail.com>
Message-ID: <4834c71e0804170802o49911a26oc86a9a65dd483d50@mail.gmail.com>

2008/4/17 Graham Dumpleton <graham.dumpleton@gmail.com>:

> 2008/4/17 Rados?aw Rymaszewski <rrymaszewski@contentforces.pl>:
> > Hello
> >
> > I was trying to find out solution for my problem but there were no
> answers,
> > so I decided to write here.
> >
> > We are using mod_python filters for our system
> >
> > Infrastructure description:
> >
> > INTERNET <---> APACHE 2.8.3 with mod_python 3.3.1 + output filters <-->
> > Apache proxy module <--> TOMCAT 5.5.2x
> >
> > our filters concat chunked content from tomcat and write to client whole
> > changed content. It's important for us to get whole response from tomcat
> and
> > after it process.
> >
> > problem is when filter.read() reach last byte (filter.read() == None)
> then
> > there is no possibility to overwrite request headers.
> >
> > There is no such problem during reading content and when we serve static
> > pages from apache www server.
> >
> > mod_python receive such headers
> >
> > 1 chunk
> >
> > [Wed Apr 16 05:52:15 2008] [error] {'Via': '1.1 domain', 'Set-Cookie':
> > 'JSESSIONID=sessionXXX; Path=/path', 'Date': 'Fri, 18 Apr 2008 19:47:06
> > GMT', 'Cache-Control': 'no-store', 'Cache-Control': 'no-cache',
> 'Expires':
> > 'Thu, 01 Jan 1970 00:00:00 GMT', 'Pragma': 'No-cache', 'Server':
> > 'Apache-Coyote'}
> >
> > 2 chunk
> >
> > [Wed Apr 16 05:52:15 2008] [error] {'Content-Type': 'text/plain',
> > 'Transfer-Encoding': 'chunked', 'Connection': 'Keep-Alive',
> 'Keep-Alive':
> > 'timeout=15, max=100', 'Via': '1.1 domain', 'Set-Cookie':
> > 'JSESSIONID=sessionXXX; Path=/path', 'Cache-Control': 'No-cache',
> 'Expires':
> > '0', 'Pragma': 'No-cache'}
> >
> > 3 chunk
> >
> >  [Wed Apr 16 05:52:15 2008] [error] {'Content-Type': 'text/plain',
> > 'Transfer-Encoding': 'chunked', 'Connection': 'Keep-Alive',
> 'Keep-Alive':
> > 'timeout=15, max=100', 'Via': '1.1 domain', 'Set-Cookie':
> > 'JSESSIONID=sessionXXX; Path=/path', 'Cache-Control': 'No-cache',
> 'Expires':
> > '0', 'Pragma': 'No-cache'}
> >
> > when I finish process on first or second chunk I can modify headers
> without
> > any problems. after third one there is no such possibility
> >
> > Do You know what could be wrong ?
>
> As soon as any filter following yours has caused any chunk of data to
> be written back to client, it is too late to change headers. This is
> because headers are sent before the data.
>
> Thus, headers can only be reliably changed upon reading first chunk
> and before it is written to next filter. Only other choice is to
> buffer the whole content in your filter, fixup any headers based on
> that content and then write the whole content.


thank You for your reply.

Tomcat content is buffered as You see below.

Could You explain in which place in code below headers are send to client  ?
I thought that in same time when script execute filter.write(), because
client always get header from last chunk

                try:
                    buffer = filter.req.buffer
                except AttributeError:
                    filter.req.buffer = Buffer()
                    buffer = filter.req.buffer

                s=filter.read()
                while s:
                    buffer.append(s)
                    s=filter.read()

                if s is None:
                    filter.req.headers_out['content-type'] = "text/html;
charset=UTF-8"
                    filter.req.headers_out['content-length'] =
str(len(buffer.string))
                    filter.req.content_type = "text/html; charset=UTF-8"
                    filter.req.set_content_length(len(buffer.string))
                    data = buffer.string
                else:
                    return
          filter.write(data)
          filter.close()

br
--
Radoslaw Rymaszewski
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080417/70a90e8d/attachment-0001.html
From victorsubervi at gmail.com  Thu Apr 17 15:22:04 2008
From: victorsubervi at gmail.com (Victor Subervi)
Date: Thu Apr 17 15:22:08 2008
Subject: [mod_python] Problems w/ mod python
Message-ID: <4dc0cfea0804171222q6d927294o30e0ab4bbef90eb2@mail.gmail.com>

Hi:
I seem to have two problems related to mod python:
1) How do I import a file in the same folder as the script which is
importing? This does not work:

import x

2) I have the following code:

    try:
      cursor.execute(sql)
      print '?Exito en introducir!<br />'
      print '<i>Esta p?gina va a regresar a la p?gina principal del carrito
de compras en 10 segundos.</i>'
    except IntegrityError:
      print 'Lo siento, pero el ID que entraste est? usado actualmente por
otra entrada. Favor de dar para atr?z y escojer otro n?mero.'
    except OperationalError:
      print 'Lo siento, pero has a?adido un car?cter extra?o a un n?mero (o
en "ID", "precio", "rec?maras" o "ba?os". Favor de dar para atr?z y escojer
otro n?mero.'
    except:
      print 'Lo siento, pero hay un error. Favor de dar para atr?z y
averiguar donde est? el error, y reintentar.'
When I enter and ID that is not a number, it should trigger the
IntegrityError. Instead, I get this in the error log:

[Thu Apr 17 12:06:37 2008] [error] [client 190.166.0.245] PythonHandler
mod_python.cgihandler: NameError: global name 'IntegrityError' is not
defined, referer: http://livestocksling.com/bre/iud.py
When I enter a non-digit in a float, I should get an OperationalError.
Instead, I get more garbage:

[Thu Apr 17 12:10:38 2008] [error] [client 190.166.0.245] PythonHandler
mod_python.cgihandler: NameError: global name 'OperationalError' is not
defined, referer: http://livestocksling.com/bre/iud.py
What do?
TIA,
Victor
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080417/082191d6/attachment.html
From joe at incomps.com  Thu Apr 17 16:13:45 2008
From: joe at incomps.com (Joseph Bernhardt)
Date: Thu Apr 17 16:14:37 2008
Subject: [mod_python] Problems w/ mod python
Message-ID: <004a01c8a0c7$9d6d4820$d847d860$@com>

1) How do I import a file in the same folder as the script which is
importing? This does not work:

 

 

Is this directory in your module path?  sys.path

 

 

2) I have the following code:
 
    try:
      cursor.execute(sql)
      print '?Exito en introducir!<br />'
      print '<i>Esta p?gina va a regresar a la p?gina principal del carrito
de compras en 10 segundos.</i>'
    except IntegrityError:
      print 'Lo siento, pero el ID que entraste est? usado actualmente por
otra entrada. Favor de dar para atr?z y escojer otro n?mero.'
    except OperationalError:
      print 'Lo siento, pero has a?adido un car?cter extra?o a un n?mero (o
en "ID", "precio", "rec?maras" o "ba?os". Favor de dar para atr?z y escojer
otro n?mero.'
    except:
      print 'Lo siento, pero hay un error. Favor de dar para atr?z y
averiguar donde est? el error, y reintentar.'

When I enter and ID that is not a number, it should trigger the
IntegrityError. Instead, I get this in the error log:
 
[Thu Apr 17 12:06:37 2008] [error] [client 190.166.0.245] PythonHandler
mod_python.cgihandler: NameError: global name 'IntegrityError' is not
defined, referer: http://livestocksling.com/bre/iud.py 

When I enter a non-digit in a float, I should get an OperationalError.
Instead, I get more garbage:
 
[Thu Apr 17 12:10:38 2008] [error] [client 190.166.0.245] PythonHandler
mod_python.cgihandler: NameError: global name 'OperationalError' is not
defined, referer: http://livestocksling.com/bre/iud.py 

What do?

 

These exceptions are probably defined in your sql module.  Since I don?t
know which one that is, here is an example:

 

import MySQLdb

 

try:

              cursor.execute(sql)

except MySQLdb.IntegrityError:

              print ?oh shit!?

except MySQLdb.OperationalError:

              print ?holy hell!?

except:

              print ?too bad
?

 

The errors that you are receiving are not ?garbage?.  They are telling you
exactly what is happening.  

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080417/9626a49a/attachment.html
From graham.dumpleton at gmail.com  Thu Apr 17 17:02:06 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu Apr 17 17:02:23 2008
Subject: [mod_python] Problems w/ mod python
In-Reply-To: <004a01c8a0c7$9d6d4820$d847d860$@com>
References: <004a01c8a0c7$9d6d4820$d847d860$@com>
Message-ID: <88e286470804171402t7b331aedu6f32e996855cd0@mail.gmail.com>

2008/4/18 Joseph Bernhardt <joe@incomps.com>:
>
>
>
>
> 1) How do I import a file in the same folder as the script which is
> importing? This does not work:
>
> Is this directory in your module path?  sys.path

In mod_python 3.3.1 that is not necessarily the right answer. This is
because script files, such as those for mod_python.publisher are
loaded with mod_python module importer. This has its own concept of
path and you should not add one of those directories to sys.path and
create an overlap.

Either the OP's module is not readable to Apache user, or it is
actually a package, in which case it needs to be moved out of document
tree and then sys.path extended with directory it was put in.

See documentation for import_module() in:

  http://www.modpython.org/live/current/doc-html/pyapi-apmeth.html

Graham
From joe at incomps.com  Thu Apr 17 17:11:09 2008
From: joe at incomps.com (Joseph Bernhardt)
Date: Thu Apr 17 17:11:59 2008
Subject: [mod_python] Problems w/ mod python
In-Reply-To: <88e286470804171402t7b331aedu6f32e996855cd0@mail.gmail.com>
References: <004a01c8a0c7$9d6d4820$d847d860$@com>
	<88e286470804171402t7b331aedu6f32e996855cd0@mail.gmail.com>
Message-ID: <005501c8a0cf$a15a1910$e40e4b30$@com>

> 2008/4/18 Joseph Bernhardt <joe@incomps.com>:
> >
> >
> >
> >
> > 1) How do I import a file in the same folder as the script which is
> > importing? This does not work:
> >
> > Is this directory in your module path?  sys.path
> 
> In mod_python 3.3.1 that is not necessarily the right answer. This is
> because script files, such as those for mod_python.publisher are
> loaded with mod_python module importer. This has its own concept of
> path and you should not add one of those directories to sys.path and
> create an overlap.
> 
> Either the OP's module is not readable to Apache user, or it is
> actually a package, in which case it needs to be moved out of document
> tree and then sys.path extended with directory it was put in.
> 
> See documentation for import_module() in:
> 
>   http://www.modpython.org/live/current/doc-html/pyapi-apmeth.html
> 
> Graham

Well, can't say I didn't try.  ;)  Thanks for clarifying, Graham.

Joe

From graham.dumpleton at gmail.com  Thu Apr 17 19:23:41 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu Apr 17 19:23:55 2008
Subject: [mod_python] Problems w/ mod python
In-Reply-To: <005501c8a0cf$a15a1910$e40e4b30$@com>
References: <004a01c8a0c7$9d6d4820$d847d860$@com>
	<88e286470804171402t7b331aedu6f32e996855cd0@mail.gmail.com>
	<005501c8a0cf$a15a1910$e40e4b30$@com>
Message-ID: <88e286470804171623k91f1b47wa1217e35d0b8d35f@mail.gmail.com>

2008/4/18 Joseph Bernhardt <joe@incomps.com>:
>
> > 2008/4/18 Joseph Bernhardt <joe@incomps.com>:
>  > >
>  > >
>  > >
>  > >
>  > > 1) How do I import a file in the same folder as the script which is
>  > > importing? This does not work:
>  > >
>  > > Is this directory in your module path?  sys.path
>  >
>  > In mod_python 3.3.1 that is not necessarily the right answer. This is
>  > because script files, such as those for mod_python.publisher are
>  > loaded with mod_python module importer. This has its own concept of
>  > path and you should not add one of those directories to sys.path and
>  > create an overlap.
>  >
>  > Either the OP's module is not readable to Apache user, or it is
>  > actually a package, in which case it needs to be moved out of document
>  > tree and then sys.path extended with directory it was put in.
>  >
>  > See documentation for import_module() in:
>  >
>  >   http://www.modpython.org/live/current/doc-html/pyapi-apmeth.html
>  >
>  > Graham
>
>  Well, can't say I didn't try.  ;)  Thanks for clarifying, Graham.

And don't stop trying to help. Someone will need to take over from me
when I eventually vanish off this list. :-)

BTW, same applies if what is being imported is actually a C extension
module, ie., a .so file file. The mod_python module importer, for the
directories it manages, ignores both packages and C extension modules
and will only import single file based Python code modules.

Graham
From graham.dumpleton at gmail.com  Thu Apr 17 19:32:16 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu Apr 17 19:32:36 2008
Subject: [mod_python] Proxy + Tomcat filter problems
In-Reply-To: <4834c71e0804170802o49911a26oc86a9a65dd483d50@mail.gmail.com>
References: <4834c71e0804170320y765408d4r7c93efe9eb3f4545@mail.gmail.com>
	<88e286470804170516o3d4ff0c5l4b2a2c9dc5bab180@mail.gmail.com>
	<4834c71e0804170802o49911a26oc86a9a65dd483d50@mail.gmail.com>
Message-ID: <88e286470804171632t39018758ma6a8f4ed33706c25@mail.gmail.com>

To be honest, I didn't think that headers could be modified in a
mod_python output filter. This is because they are a resource type
output filter and as such I understood they are not the type of output
filter that gets called in the correct place to allow headers to be
called. The filter type which probably allows modifying of headers is
a protocol filter, but you can't create them with mod_python.

Thus, if you are seeing headers modified at all is probably by luck
and would be random. Since you said you were seeing changes, I had
assumed that maybe my understanding that one couldn't change response
headers in a mod_python output filter was wrong and thus why I
suggested what I did because if anything would work, that would.

My guess then is that you may be out of luck.

Graham

2008/4/18 Rados?aw Rymaszewski <rrymaszewski@contentforces.pl>:
>
>
>
> 2008/4/17 Graham Dumpleton <graham.dumpleton@gmail.com>:
>
>
> > 2008/4/17 Rados?aw Rymaszewski <rrymaszewski@contentforces.pl>:
> >
> >
> >
> > > Hello
> > >
> > > I was trying to find out solution for my problem but there were no
> answers,
> > > so I decided to write here.
> > >
> > > We are using mod_python filters for our system
> > >
> > > Infrastructure description:
> > >
> > > INTERNET <---> APACHE 2.8.3 with mod_python 3.3.1 + output filters <-->
> > > Apache proxy module <--> TOMCAT 5.5.2x
> > >
> > > our filters concat chunked content from tomcat and write to client whole
> > > changed content. It's important for us to get whole response from tomcat
> and
> > > after it process.
> > >
> > > problem is when filter.read() reach last byte (filter.read() == None)
> then
> > > there is no possibility to overwrite request headers.
> > >
> > > There is no such problem during reading content and when we serve static
> > > pages from apache www server.
> > >
> > > mod_python receive such headers
> > >
> > > 1 chunk
> > >
> > > [Wed Apr 16 05:52:15 2008] [error] {'Via': '1.1 domain', 'Set-Cookie':
> > > 'JSESSIONID=sessionXXX; Path=/path', 'Date': 'Fri, 18 Apr 2008 19:47:06
> > > GMT', 'Cache-Control': 'no-store', 'Cache-Control': 'no-cache',
> 'Expires':
> > > 'Thu, 01 Jan 1970 00:00:00 GMT', 'Pragma': 'No-cache', 'Server':
> > > 'Apache-Coyote'}
> > >
> > > 2 chunk
> > >
> > > [Wed Apr 16 05:52:15 2008] [error] {'Content-Type': 'text/plain',
> > > 'Transfer-Encoding': 'chunked', 'Connection': 'Keep-Alive',
> 'Keep-Alive':
> > > 'timeout=15, max=100', 'Via': '1.1 domain', 'Set-Cookie':
> > > 'JSESSIONID=sessionXXX; Path=/path', 'Cache-Control': 'No-cache',
> 'Expires':
> > > '0', 'Pragma': 'No-cache'}
> > >
> > > 3 chunk
> > >
> > >  [Wed Apr 16 05:52:15 2008] [error] {'Content-Type': 'text/plain',
> > > 'Transfer-Encoding': 'chunked', 'Connection': 'Keep-Alive',
> 'Keep-Alive':
> > > 'timeout=15, max=100', 'Via': '1.1 domain', 'Set-Cookie':
> > > 'JSESSIONID=sessionXXX; Path=/path', 'Cache-Control': 'No-cache',
> 'Expires':
> > > '0', 'Pragma': 'No-cache'}
> > >
> > > when I finish process on first or second chunk I can modify headers
> without
> > > any problems. after third one there is no such possibility
> > >
> > > Do You know what could be wrong ?
> >
> > As soon as any filter following yours has caused any chunk of data to
> > be written back to client, it is too late to change headers. This is
> > because headers are sent before the data.
> >
> > Thus, headers can only be reliably changed upon reading first chunk
> > and before it is written to next filter. Only other choice is to
> > buffer the whole content in your filter, fixup any headers based on
> > that content and then write the whole content.
>
> thank You for your reply.
>
> Tomcat content is buffered as You see below.
>
> Could You explain in which place in code below headers are send to client  ?
> I thought that in same time when script execute filter.write(), because
> client always get header from last chunk
>
>
>                  try:
>                      buffer = filter.req.buffer
>                  except AttributeError:
>                      filter.req.buffer = Buffer()
>                      buffer = filter.req.buffer
>
>                  s=filter.read()
>                  while s:
>                      buffer.append(s)
>                      s=filter.read()
>
>                  if s is None:
>                      filter.req.headers_out[
> 'content-type'] = "text/html; charset=UTF-8"
>                      filter.req.headers_out['content-length'] =
> str(len(buffer.string))
>                      filter.req.content_type = "text/html; charset=UTF-8"
>                      filter.req.set_content_length(len(buffer.string))
>                      data = buffer.string
>                  else:
>                      return
>            filter.write(data)
>            filter.close()
>
> br
> --
> Radoslaw Rymaszewski
>
>
>
> _______________________________________________
>  Mod_python mailing list
>  Mod_python@modpython.org
>  http://mailman.modpython.org/mailman/listinfo/mod_python
>
>

From victorsubervi at gmail.com  Fri Apr 18 08:49:31 2008
From: victorsubervi at gmail.com (Victor Subervi)
Date: Fri Apr 18 08:49:34 2008
Subject: [mod_python] Problems w/ mod python
In-Reply-To: <88e286470804171623k91f1b47wa1217e35d0b8d35f@mail.gmail.com>
References: <004a01c8a0c7$9d6d4820$d847d860$@com>
	<88e286470804171402t7b331aedu6f32e996855cd0@mail.gmail.com>
	<005501c8a0cf$a15a1910$e40e4b30$@com>
	<88e286470804171623k91f1b47wa1217e35d0b8d35f@mail.gmail.com>
Message-ID: <4dc0cfea0804180549j53dd400xeda2f67747ebad4b@mail.gmail.com>

On Thu, Apr 17, 2008 at 6:23 PM, Graham Dumpleton <
graham.dumpleton@gmail.com> wrote:

> 2008/4/18 Joseph Bernhardt <joe@incomps.com>:
> >
> > > 2008/4/18 Joseph Bernhardt <joe@incomps.com>:
> >  > >
> >  > >
> >  > >
> >  > >
> >  > > 1) How do I import a file in the same folder as the script which is
> >  > > importing? This does not work:
> >  > >
> >  > > Is this directory in your module path?  sys.path
>

This is what ended up working...

import sys,os
sys.path.append(os.getcwd())
from example import example
Concerning the problems with errors (IntegrityError, OperationalError), I
have indeed imported MySQLdb, but that does not resolve the problem. Other
ideas?
TIA,
Victor
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080418/c399e307/attachment.html
From graham.dumpleton at gmail.com  Sat Apr 19 00:11:09 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sat Apr 19 00:11:27 2008
Subject: [mod_python] Problems w/ mod python
In-Reply-To: <4dc0cfea0804180549j53dd400xeda2f67747ebad4b@mail.gmail.com>
References: <004a01c8a0c7$9d6d4820$d847d860$@com>
	<88e286470804171402t7b331aedu6f32e996855cd0@mail.gmail.com>
	<005501c8a0cf$a15a1910$e40e4b30$@com>
	<88e286470804171623k91f1b47wa1217e35d0b8d35f@mail.gmail.com>
	<4dc0cfea0804180549j53dd400xeda2f67747ebad4b@mail.gmail.com>
Message-ID: <88e286470804182111r779ff4bcv7d9a0c27cb2e8ed3@mail.gmail.com>

2008/4/18 Victor Subervi <victorsubervi@gmail.com>:
>
> On Thu, Apr 17, 2008 at 6:23 PM, Graham Dumpleton
> <graham.dumpleton@gmail.com> wrote:
>
> >
> > 2008/4/18 Joseph Bernhardt <joe@incomps.com>:
> > >
> > > > 2008/4/18 Joseph Bernhardt <joe@incomps.com>:
> > >  > >
> > >  > >
> > >  > >
> > >  > >
> > >  > > 1) How do I import a file in the same folder as the script which is
> > >  > > importing? This does not work:
> > >  > >
> > >  > > Is this directory in your module path?  sys.path
>
>
> This is what ended up working...
>
> import sys,os
> sys.path.append(os.getcwd())
> from example import example

That is wrong. You cannot rely on os.getcwd() value as under Apache it
could be anything, although would usually be '/' because Apache
generally sets current working directory to root of filesystem. So,
unless your code was elsewhere setting the current working directory,
can't see how that would work. If you are setting the current working
directory, be aware that you shouldn't do that either when using
Apache as it is a shared application environment and doubly would
cause problems if multithreading is also used.

If you need to work out a path relative to where a source file is, you
calculate it using:

  here = os.path.dirname(__file__)

You should not however add such a directory to sys.path if the source
code file was one which mod_python imported using its module importing
mechanism as you will then have an overlap and you could end up with
the same source file being imported multiple times under different
names.

Is 'example' actually a package? Have you tried moving it outside of
the document tree and then setting sys.path or using PythonPath like I
said in other email?

Graham

> Concerning the problems with errors (IntegrityError, OperationalError), I
> have indeed imported MySQLdb, but that does not resolve the problem. Other
> ideas?
From qhfgva at gmail.com  Sat Apr 19 19:05:11 2008
From: qhfgva at gmail.com (Dustin Lee)
Date: Sat Apr 19 19:05:24 2008
Subject: [mod_python] trying to build mod_python on mac os x 10.3
Message-ID: <b75caff40804191605r25a37faie923ccd10847f898@mail.gmail.com>

Here is what I run and the output I get.  It hangs indefinitely on the final
line.  Any suggestions, advice would be appreciated.

$ ./configure --with-apxs=/opt/apache2/bin/apxs --with-python
/Library/Framewor
ks/Python.framework/Versions/2.4/bin/python
configure: WARNING: you should use --build, --host, --target
configure: WARNING: invalid host type:
/Library/Frameworks/Python.framework/Versions/2.4/bin/python
checking for
/Library/Frameworks/Python.framework/Versions/2.4/bin/python-gcc... no
checking for gcc... gcc
checking for C compiler default output file name... a.out
checking whether the C compiler works... yes
checking whether we are cross compiling... no
checking for suffix of executables...
checking for suffix of object files... o
checking whether we are using the GNU C compiler... yes
checking whether gcc accepts -g... yes
checking for gcc option to accept ANSI C... none needed
checking for ar... ar
checking for a BSD-compatible install... /usr/bin/install -c
checking whether make sets $(MAKE)... yes
checking for main in -lm... yes
checking for an ANSI C-conforming const... yes
checking your blood pressure... a bit high, but we can proceed
configure: checking whether apxs is available...
checking for --with-apxs... /opt/apache2/bin/apxs executable, good
checking Apache version... 2.0.55
checking for Apache libexec directory... /opt/apache2/modules
checking for Apache include directory... -I/opt/apache2/include
checking for --with-python... yes
checking Python version...
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080419/be1886c9/attachment.html
From graham.dumpleton at gmail.com  Sat Apr 19 20:25:56 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sat Apr 19 20:26:04 2008
Subject: [mod_python] trying to build mod_python on mac os x 10.3
In-Reply-To: <b75caff40804191605r25a37faie923ccd10847f898@mail.gmail.com>
References: <b75caff40804191605r25a37faie923ccd10847f898@mail.gmail.com>
Message-ID: <88e286470804191725p41ebdc69r1a958fef01c61b70@mail.gmail.com>

And what is the problem we are supposed to be commenting on?

BTW, you missing '=' sign after --with-python option. Ie., you may not
be able to do it as two separate options.

Graham

2008/4/20 Dustin Lee <qhfgva@gmail.com>:
> Here is what I run and the output I get.  It hangs indefinitely on the final
> line.  Any suggestions, advice would be appreciated.
>
> $ ./configure --with-apxs=/opt/apache2/bin/apxs --with-python
> /Library/Framewor
> ks/Python.framework/Versions/2.4/bin/python
>  configure: WARNING: you should use --build, --host, --target
> configure: WARNING: invalid host type:
> /Library/Frameworks/Python.framework/Versions/2.4/bin/python
> checking for
> /Library/Frameworks/Python.framework/Versions/2.4/bin/python-gcc... no
>  checking for gcc... gcc
> checking for C compiler default output file name... a.out
> checking whether the C compiler works... yes
> checking whether we are cross compiling... no
> checking for suffix of executables...
>  checking for suffix of object files... o
> checking whether we are using the GNU C compiler... yes
> checking whether gcc accepts -g... yes
> checking for gcc option to accept ANSI C... none needed
> checking for ar... ar
>  checking for a BSD-compatible install... /usr/bin/install -c
> checking whether make sets $(MAKE)... yes
> checking for main in -lm... yes
> checking for an ANSI C-conforming const... yes
> checking your blood pressure... a bit high, but we can proceed
>  configure: checking whether apxs is available...
> checking for --with-apxs... /opt/apache2/bin/apxs executable, good
> checking Apache version... 2.0.55
> checking for Apache libexec directory... /opt/apache2/modules
>  checking for Apache include directory... -I/opt/apache2/include
> checking for --with-python... yes
> checking Python version...
>
>
>
> _______________________________________________
>  Mod_python mailing list
>  Mod_python@modpython.org
>  http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
From graham.dumpleton at gmail.com  Sat Apr 19 20:27:19 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sat Apr 19 20:27:23 2008
Subject: [mod_python] trying to build mod_python on mac os x 10.3
In-Reply-To: <88e286470804191725p41ebdc69r1a958fef01c61b70@mail.gmail.com>
References: <b75caff40804191605r25a37faie923ccd10847f898@mail.gmail.com>
	<88e286470804191725p41ebdc69r1a958fef01c61b70@mail.gmail.com>
Message-ID: <88e286470804191727x78fe94c0xdfe8cf915f3ae72a@mail.gmail.com>

Okay, read message properly now.

Can you use Python 2.3 which comes with OS instead. MacPorts Python
often gives problems.

Also try adding '=' like I said.

Graham

2008/4/20 Graham Dumpleton <graham.dumpleton@gmail.com>:
> And what is the problem we are supposed to be commenting on?
>
>  BTW, you missing '=' sign after --with-python option. Ie., you may not
>  be able to do it as two separate options.
>
>  Graham
>
>  2008/4/20 Dustin Lee <qhfgva@gmail.com>:
>
>
> > Here is what I run and the output I get.  It hangs indefinitely on the final
>  > line.  Any suggestions, advice would be appreciated.
>  >
>  > $ ./configure --with-apxs=/opt/apache2/bin/apxs --with-python
>  > /Library/Framewor
>  > ks/Python.framework/Versions/2.4/bin/python
>  >  configure: WARNING: you should use --build, --host, --target
>  > configure: WARNING: invalid host type:
>  > /Library/Frameworks/Python.framework/Versions/2.4/bin/python
>  > checking for
>  > /Library/Frameworks/Python.framework/Versions/2.4/bin/python-gcc... no
>  >  checking for gcc... gcc
>  > checking for C compiler default output file name... a.out
>  > checking whether the C compiler works... yes
>  > checking whether we are cross compiling... no
>  > checking for suffix of executables...
>  >  checking for suffix of object files... o
>  > checking whether we are using the GNU C compiler... yes
>  > checking whether gcc accepts -g... yes
>  > checking for gcc option to accept ANSI C... none needed
>  > checking for ar... ar
>  >  checking for a BSD-compatible install... /usr/bin/install -c
>  > checking whether make sets $(MAKE)... yes
>  > checking for main in -lm... yes
>  > checking for an ANSI C-conforming const... yes
>  > checking your blood pressure... a bit high, but we can proceed
>  >  configure: checking whether apxs is available...
>  > checking for --with-apxs... /opt/apache2/bin/apxs executable, good
>  > checking Apache version... 2.0.55
>  > checking for Apache libexec directory... /opt/apache2/modules
>  >  checking for Apache include directory... -I/opt/apache2/include
>  > checking for --with-python... yes
>  > checking Python version...
>  >
>  >
>  >
>  > _______________________________________________
>  >  Mod_python mailing list
>  >  Mod_python@modpython.org
>  >  http://mailman.modpython.org/mailman/listinfo/mod_python
>  >
>  >
>
From qhfgva at gmail.com  Mon Apr 21 01:04:05 2008
From: qhfgva at gmail.com (Dustin Lee)
Date: Mon Apr 21 01:04:19 2008
Subject: [mod_python] trying to build mod_python on mac os x 10.3
In-Reply-To: <88e286470804191727x78fe94c0xdfe8cf915f3ae72a@mail.gmail.com>
References: <b75caff40804191605r25a37faie923ccd10847f898@mail.gmail.com>
	<88e286470804191725p41ebdc69r1a958fef01c61b70@mail.gmail.com>
	<88e286470804191727x78fe94c0xdfe8cf915f3ae72a@mail.gmail.com>
Message-ID: <b75caff40804202204l4c09edb0p49d528e9caa9894c@mail.gmail.com>

Thanks, I added in the '=' and that got the configure to work.

On Sat, Apr 19, 2008 at 6:27 PM, Graham Dumpleton <
graham.dumpleton@gmail.com> wrote:

> Okay, read message properly now.
>
> Can you use Python 2.3 which comes with OS instead. MacPorts Python
> often gives problems.
>
> Also try adding '=' like I said.
>
> Graham
>
> 2008/4/20 Graham Dumpleton <graham.dumpleton@gmail.com>:
> > And what is the problem we are supposed to be commenting on?
> >
> >  BTW, you missing '=' sign after --with-python option. Ie., you may not
> >  be able to do it as two separate options.
> >
> >  Graham
> >
> >  2008/4/20 Dustin Lee <qhfgva@gmail.com>:
> >
> >
> > > Here is what I run and the output I get.  It hangs indefinitely on the
> final
> >  > line.  Any suggestions, advice would be appreciated.
> >  >
> >  > $ ./configure --with-apxs=/opt/apache2/bin/apxs --with-python
> >  > /Library/Framewor
> >  > ks/Python.framework/Versions/2.4/bin/python
> >  >  configure: WARNING: you should use --build, --host, --target
> >  > configure: WARNING: invalid host type:
> >  > /Library/Frameworks/Python.framework/Versions/2.4/bin/python
> >  > checking for
> >  > /Library/Frameworks/Python.framework/Versions/2.4/bin/python-gcc...
> no
> >  >  checking for gcc... gcc
> >  > checking for C compiler default output file name... a.out
> >  > checking whether the C compiler works... yes
> >  > checking whether we are cross compiling... no
> >  > checking for suffix of executables...
> >  >  checking for suffix of object files... o
> >  > checking whether we are using the GNU C compiler... yes
> >  > checking whether gcc accepts -g... yes
> >  > checking for gcc option to accept ANSI C... none needed
> >  > checking for ar... ar
> >  >  checking for a BSD-compatible install... /usr/bin/install -c
> >  > checking whether make sets $(MAKE)... yes
> >  > checking for main in -lm... yes
> >  > checking for an ANSI C-conforming const... yes
> >  > checking your blood pressure... a bit high, but we can proceed
> >  >  configure: checking whether apxs is available...
> >  > checking for --with-apxs... /opt/apache2/bin/apxs executable, good
> >  > checking Apache version... 2.0.55
> >  > checking for Apache libexec directory... /opt/apache2/modules
> >  >  checking for Apache include directory... -I/opt/apache2/include
> >  > checking for --with-python... yes
> >  > checking Python version...
> >  >
> >  >
> >  >
> >  > _______________________________________________
> >  >  Mod_python mailing list
> >  >  Mod_python@modpython.org
> >  >  http://mailman.modpython.org/mailman/listinfo/mod_python
> >  >
> >  >
> >
>



-- 
Dustin Lee
qhfgva=rot13(dustin)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080420/f6b51b6c/attachment.html
From gelios at gmail.com  Mon Apr 21 09:16:09 2008
From: gelios at gmail.com (Zhukov Pavel)
Date: Mon Apr 21 09:16:16 2008
Subject: [mod_python] max memory/time allocation
In-Reply-To: <448999300804210613h7368ddb8x4b8f2e455ffab53c@mail.gmail.com>
References: <448999300804210613h7368ddb8x4b8f2e455ffab53c@mail.gmail.com>
Message-ID: <448999300804210616l494cd6f1od049876f326898bf@mail.gmail.com>

is mod_python support something like max_memory/max_execution_time
 options like php?
From graham.dumpleton at gmail.com  Mon Apr 21 17:30:53 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon Apr 21 17:30:59 2008
Subject: [mod_python] max memory/time allocation
In-Reply-To: <448999300804210616l494cd6f1od049876f326898bf@mail.gmail.com>
References: <448999300804210613h7368ddb8x4b8f2e455ffab53c@mail.gmail.com>
	<448999300804210616l494cd6f1od049876f326898bf@mail.gmail.com>
Message-ID: <88e286470804211430h72bcec9dgaf6141520990a3a7@mail.gmail.com>

2008/4/21 Zhukov Pavel <gelios@gmail.com>:
> is mod_python support something like max_memory/max_execution_time
>   options like php?

No.
From graham.dumpleton at gmail.com  Mon Apr 21 19:06:43 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon Apr 21 19:06:49 2008
Subject: [mod_python] max memory/time allocation
In-Reply-To: <448999300804211453xa3f52bfh8d8aebffbeb9a4c4@mail.gmail.com>
References: <448999300804210613h7368ddb8x4b8f2e455ffab53c@mail.gmail.com>
	<448999300804210616l494cd6f1od049876f326898bf@mail.gmail.com>
	<88e286470804211430h72bcec9dgaf6141520990a3a7@mail.gmail.com>
	<448999300804211453xa3f52bfh8d8aebffbeb9a4c4@mail.gmail.com>
Message-ID: <88e286470804211606m68d7143t68b736a0c391a842@mail.gmail.com>

Please keep replies on the mailing list by using 'reply-all'.

2008/4/22 Zhukov Pavel <gelios@gmail.com>:
> so, what can i do to protect my server? only use python as cgi with
>  apache limitations?

Do be aware that the PHP options you mention are not likely to be
available in all ways that PHP can be hosted. Most likely the only
instance where they would be available is where PHP is run in a CGI
mode or single threaded FASTCGI process. This is because the shared
nature of  Apache child processes means you can't go arbitrarily go
killing off Apache child processes.

So, as of today, for Python the only option is to use CGI, possibly in
conjunction with the RLimitCPU and RLimitMEM directives.

The only other option, albeit not available today, is that if you use
mod_wsgi and its daemon mode, in the future it will be adding options
to allow memory and CPU usage to be limited. The memory limit will be
a hard limit and behaviour is undefined when it is reached. ie.,
memory allocations will start failing. For the CPU limit, a daemon
process restart will be triggered. More details of this future
mod_wsgi feature can be found at:

  http://code.google.com/p/modwsgi/issues/detail?id=21

Graham

>  On Tue, Apr 22, 2008 at 1:30 AM, Graham Dumpleton
>  <graham.dumpleton@gmail.com> wrote:
>  > 2008/4/21 Zhukov Pavel <gelios@gmail.com>:
>  >
>  > > is mod_python support something like max_memory/max_execution_time
>  >  >   options like php?
>  >
>  >  No.
>  >
>
From l.montecchiani at teamsystem.com  Wed Apr 23 11:28:22 2008
From: l.montecchiani at teamsystem.com (Luca Montecchiani)
Date: Wed Apr 23 11:28:10 2008
Subject: [mod_python] Best way to have an unique_id per request
Message-ID: <480F5596.9030705@teamsystem.com>

Hi all,
I'm in the process to improve the function we use to get an unique id 
each time we call it.
This is the current implementation, initially it was based only on 
req.request_time,
bad assumption because different request could have the same 
request_time value
and so I've added a random value that should limit this side effect.
I've also added a counter (req.uniqidprog) to support multiple calls 
inside the
same request.

def getuniqid(req,prefix=''):
    from random import random
    req.uniqidprog = req.uniqidprog + 1
    _tmpid = "%s%s%d%s" % ( prefix ,str(req.request_time), 
req.uniqidprog, str(random()) )
    return _tmpid.replace('.','')

Our production environment is :
Windows 32bit / Linux 32bit
Apache 2.2.8
Python 2.5.2
Modpython 3.3.1
Postgresql 8.2.7
Psycopg 2.0.7

This seem to works fine but I'm worried about its correctness and possible
collisions under heavy loads.

Can I use the Session._new_sid() function without worrying about lock/unlock
and other issues ? Something very simple like that :

def getuniqid(req,prefix=''):
    from mod_python import Session
    return "%s%s" % ( prefix ,  Session._new_sid(req) )

Googling a bit I've found a "mod_unique_id" apache module that could do the
job unfortunately it states that is not reliable on Windows environment 
:( and I
don't know how could impact on performance...

Thanks in advance,
luca

-- 
Luca Montecchiani
Software Di Base
TeamSystem S.p.a.
------------------------------------------------------------------------------------------
Informativa ai sensi del D. Lgs. 196-30/06/2003.
Il contenuto di questa e.mail e degli eventuali allegati, deve essere nella disponibilit?
del solo destinatario.  Se ricevete per errore questa e-mail siete pregati di informarci
(rispedendola al mittente) e di provvedere alla sua rimozione.
Possono essere presenti informazioni riservate e non corrette (parzialmente o totalmente).
Le e-mail in partenza e in arrivo possono essere oggetto di monitoraggio
da parte di Teamsystem spa.  Del contenuto ? responsabile il mittente della presente.
Chiunque venga in possesso non autorizzato di questa e-mail ? vincolato
dalla Legge a non leggerne il contenuto, a non copiarla, a non diffonderla e a non usarla.
Informiamo che per l' esercizio dei diritti di cui all'art. 7 del d.lgs.196/2003 ci si pu?
rivolgere al Titolare del trattamento Teamsystem S.r.l. via Gagarin 205 61100 PESARO
per posta o fax, indicando sulla busta o sul foglio la dicitura "Inerente alla Privacy",
o inviando una e-mail all' indirizzo privacy@teamsystem.com .
------------------------------------------------------------------------------------------

From graham.dumpleton at gmail.com  Wed Apr 23 17:55:00 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Wed Apr 23 17:55:08 2008
Subject: [mod_python] Best way to have an unique_id per request
In-Reply-To: <480F5596.9030705@teamsystem.com>
References: <480F5596.9030705@teamsystem.com>
Message-ID: <88e286470804231455u64b658fcme4c4ff81cf18fea8@mail.gmail.com>

You could try also mixing in:

  req.connection.id

This is unique for a request at any particular point in time for that
Apache process. Apache may reuse connection IDs though, so good to
also make use of current time and process ID.

Other things you could factor in to it are:

  req.connection.remote_ip

although if coming in through a proxy, this may not be true remote
client so not enough to uniquely identify client.

Graham

2008/4/24 Luca Montecchiani <l.montecchiani@teamsystem.com>:
> Hi all,
>  I'm in the process to improve the function we use to get an unique id each
> time we call it.
>  This is the current implementation, initially it was based only on
> req.request_time,
>  bad assumption because different request could have the same request_time
> value
>  and so I've added a random value that should limit this side effect.
>  I've also added a counter (req.uniqidprog) to support multiple calls inside
> the
>  same request.
>
>  def getuniqid(req,prefix=''):
>    from random import random
>    req.uniqidprog = req.uniqidprog + 1
>    _tmpid = "%s%s%d%s" % ( prefix ,str(req.request_time), req.uniqidprog,
> str(random()) )
>    return _tmpid.replace('.','')
>
>  Our production environment is :
>  Windows 32bit / Linux 32bit
>  Apache 2.2.8
>  Python 2.5.2
>  Modpython 3.3.1
>  Postgresql 8.2.7
>  Psycopg 2.0.7
>
>  This seem to works fine but I'm worried about its correctness and possible
>  collisions under heavy loads.
>
>  Can I use the Session._new_sid() function without worrying about
> lock/unlock
>  and other issues ? Something very simple like that :
>
>  def getuniqid(req,prefix=''):
>    from mod_python import Session
>    return "%s%s" % ( prefix ,  Session._new_sid(req) )
>
>  Googling a bit I've found a "mod_unique_id" apache module that could do the
>  job unfortunately it states that is not reliable on Windows environment :(
> and I
>  don't know how could impact on performance...
>
>  Thanks in advance,
>  luca
>
>  --
>  Luca Montecchiani
>  Software Di Base
>  TeamSystem S.p.a.
>
> ------------------------------------------------------------------------------------------
>  Informativa ai sensi del D. Lgs. 196-30/06/2003.
>  Il contenuto di questa e.mail e degli eventuali allegati, deve essere nella
> disponibilit?
>  del solo destinatario.  Se ricevete per errore questa e-mail siete pregati
> di informarci
>  (rispedendola al mittente) e di provvedere alla sua rimozione.
>  Possono essere presenti informazioni riservate e non corrette (parzialmente
> o totalmente).
>  Le e-mail in partenza e in arrivo possono essere oggetto di monitoraggio
>  da parte di Teamsystem spa.  Del contenuto ? responsabile il mittente della
> presente.
>  Chiunque venga in possesso non autorizzato di questa e-mail ? vincolato
>  dalla Legge a non leggerne il contenuto, a non copiarla, a non diffonderla
> e a non usarla.
>  Informiamo che per l' esercizio dei diritti di cui all'art. 7 del
> d.lgs.196/2003 ci si pu?
>  rivolgere al Titolare del trattamento Teamsystem S.r.l. via Gagarin 205
> 61100 PESARO
>  per posta o fax, indicando sulla busta o sul foglio la dicitura "Inerente
> alla Privacy",
>  o inviando una e-mail all' indirizzo privacy@teamsystem.com .
>
> ------------------------------------------------------------------------------------------
>
>  _______________________________________________
>  Mod_python mailing list
>  Mod_python@modpython.org
>  http://mailman.modpython.org/mailman/listinfo/mod_python
>

From jimge at rodentia.net  Thu Apr 24 01:05:07 2008
From: jimge at rodentia.net (Jim Geist)
Date: Thu Apr 24 01:05:16 2008
Subject: [mod_python] psp.redirect versus sessions: desired behavior?
Message-ID: <EBF3E2C9-E669-4B1C-A94F-CC7F9A0FD3CE@rodentia.net>

I was trying to figure out why my session data was getting lost, and I  
came across some interesting behavior. Code snippet:

	# processing POST data from a form
	if login_success():
		session["userid"] = userid
		psp.redirect("loggedin.psp")

in loggedin.psp

userid = session["userid"]		# Whoops! KeyError!

Under normal circumstances, the psp run method does a session save  
automatically, but it wasn't happening here. Digging through the  
source reveals that this is because redirect raises  
apache.SERVER_RETURN, and the run code doesn't call session.save() if  
the page raises any exceptions.

  I can see in the general case that an argument could be made for not  
saving session data in the exception case; if an exception makes it  
back into psp, then something has probably gone wrong with page  
processing. But in this case, doing the save seems like desired  
behavior, otherwise code like the above, which seems reasonable,  
silently has different behavior from the normal case. The fact that  
the save isn't done is a byproduct of redirect internally using an  
exception to implement its early exit behavior, which isn't obvious  
from the interface level.

So, feature or bug?

-- Jim
From l.montecchiani at teamsystem.com  Thu Apr 24 03:23:19 2008
From: l.montecchiani at teamsystem.com (Luca Montecchiani)
Date: Thu Apr 24 03:23:07 2008
Subject: [mod_python] Best way to have an unique_id per request
In-Reply-To: <88e286470804231455u64b658fcme4c4ff81cf18fea8@mail.gmail.com>
References: <480F5596.9030705@teamsystem.com>
	<88e286470804231455u64b658fcme4c4ff81cf18fea8@mail.gmail.com>
Message-ID: <48103567.2090102@teamsystem.com>

Hi  Graham,
so you implicit suggest to avoid  "Session._new_sid(req)" ?

I've already used req.connection.id and instead of req.connection.remote_ip
I've used the req.connection.remote_addr because there is also the
client port but I've noticed that this three values doesn't change
if I repeatedly refresh the page :( probably the tcp client stack cache 
the last free
used port for an immediate reuse... on windows I've to wait at least 6 
seconds
between a refresh to have different values :(

def _getunique(req):
    import os
    import thread
    req.uniqidprog = req.uniqidprog + 1
    _tmpid = "%d:%d:%s:%s:%d:%s:%d" % ( os.getpid(),
                                     thread.get_ident(),
                                     req.connection.remote_addr[0],
                                     req.connection.remote_addr[1],
                                     req.connection.id,
                                     req.request_time,
                                     req.uniqidprog )

    return _tmpid 

Any other suggestion ?
thanks

Graham Dumpleton ha scritto:
> You could try also mixing in:
>
>   req.connection.id
>
> This is unique for a request at any particular point in time for that
> Apache process. Apache may reuse connection IDs though, so good to
> also make use of current time and process ID.
>
> Other things you could factor in to it are:
>
>   req.connection.remote_ip
>
> although if coming in through a proxy, this may not be true remote
> client so not enough to uniquely identify client.
>
> Graham
>
> 2008/4/24 Luca Montecchiani <l.montecchiani@teamsystem.com>:
>   
>> Hi all,
>>  I'm in the process to improve the function we use to get an unique id each
>> time we call it.
>>  This is the current implementation, initially it was based only on
>> req.request_time,
>>  bad assumption because different request could have the same request_time
>> value
>>  and so I've added a random value that should limit this side effect.
>>  I've also added a counter (req.uniqidprog) to support multiple calls inside
>> the
>>  same request.
>>
>>  def getuniqid(req,prefix=''):
>>    from random import random
>>    req.uniqidprog = req.uniqidprog + 1
>>    _tmpid = "%s%s%d%s" % ( prefix ,str(req.request_time), req.uniqidprog,
>> str(random()) )
>>    return _tmpid.replace('.','')
>>
>>  Our production environment is :
>>  Windows 32bit / Linux 32bit
>>  Apache 2.2.8
>>  Python 2.5.2
>>  Modpython 3.3.1
>>  Postgresql 8.2.7
>>  Psycopg 2.0.7
>>
>>  This seem to works fine but I'm worried about its correctness and possible
>>  collisions under heavy loads.
>>
>>  Can I use the Session._new_sid() function without worrying about
>> lock/unlock
>>  and other issues ? Something very simple like that :
>>
>>  def getuniqid(req,prefix=''):
>>    from mod_python import Session
>>    return "%s%s" % ( prefix ,  Session._new_sid(req) )
>>
>>  Googling a bit I've found a "mod_unique_id" apache module that could do the
>>  job unfortunately it states that is not reliable on Windows environment :(
>> and I
>>  don't know how could impact on performance...
>>
>>  Thanks in advance,
>>  luca
>>
>>  --
>>  Luca Montecchiani
>>  Software Di Base
>>  TeamSystem S.p.a.
>>
>> ------------------------------------------------------------------------------------------
>>  Informativa ai sensi del D. Lgs. 196-30/06/2003.
>>  Il contenuto di questa e.mail e degli eventuali allegati, deve essere nella
>> disponibilit?
>>  del solo destinatario.  Se ricevete per errore questa e-mail siete pregati
>> di informarci
>>  (rispedendola al mittente) e di provvedere alla sua rimozione.
>>  Possono essere presenti informazioni riservate e non corrette (parzialmente
>> o totalmente).
>>  Le e-mail in partenza e in arrivo possono essere oggetto di monitoraggio
>>  da parte di Teamsystem spa.  Del contenuto ? responsabile il mittente della
>> presente.
>>  Chiunque venga in possesso non autorizzato di questa e-mail ? vincolato
>>  dalla Legge a non leggerne il contenuto, a non copiarla, a non diffonderla
>> e a non usarla.
>>  Informiamo che per l' esercizio dei diritti di cui all'art. 7 del
>> d.lgs.196/2003 ci si pu?
>>  rivolgere al Titolare del trattamento Teamsystem S.r.l. via Gagarin 205
>> 61100 PESARO
>>  per posta o fax, indicando sulla busta o sul foglio la dicitura "Inerente
>> alla Privacy",
>>  o inviando una e-mail all' indirizzo privacy@teamsystem.com .
>>
>> ------------------------------------------------------------------------------------------
>>
>>  _______________________________________________
>>  Mod_python mailing list
>>  Mod_python@modpython.org
>>  http://mailman.modpython.org/mailman/listinfo/mod_python
>>
>>     


-- 
Luca Montecchiani
Software Di Base
TeamSystem S.p.a.
------------------------------------------------------------------------------------------
Informativa ai sensi del D. Lgs. 196-30/06/2003.
Il contenuto di questa e.mail e degli eventuali allegati, deve essere nella disponibilit?
del solo destinatario.  Se ricevete per errore questa e-mail siete pregati di informarci
(rispedendola al mittente) e di provvedere alla sua rimozione.
Possono essere presenti informazioni riservate e non corrette (parzialmente o totalmente).
Le e-mail in partenza e in arrivo possono essere oggetto di monitoraggio
da parte di Teamsystem spa.  Del contenuto ? responsabile il mittente della presente.
Chiunque venga in possesso non autorizzato di questa e-mail ? vincolato
dalla Legge a non leggerne il contenuto, a non copiarla, a non diffonderla e a non usarla.
Informiamo che per l' esercizio dei diritti di cui all'art. 7 del d.lgs.196/2003 ci si pu?
rivolgere al Titolare del trattamento Teamsystem S.r.l. via Gagarin 205 61100 PESARO
per posta o fax, indicando sulla busta o sul foglio la dicitura "Inerente alla Privacy",
o inviando una e-mail all' indirizzo privacy@teamsystem.com .
------------------------------------------------------------------------------------------

From graham.dumpleton at gmail.com  Thu Apr 24 03:29:10 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu Apr 24 03:29:16 2008
Subject: [mod_python] Best way to have an unique_id per request
In-Reply-To: <48103567.2090102@teamsystem.com>
References: <480F5596.9030705@teamsystem.com>
	<88e286470804231455u64b658fcme4c4ff81cf18fea8@mail.gmail.com>
	<48103567.2090102@teamsystem.com>
Message-ID: <88e286470804240029s2ed1c940t4a184d64efd1adeb@mail.gmail.com>

2008/4/24 Luca Montecchiani <l.montecchiani@teamsystem.com>:
> Hi  Graham,
>  so you implicit suggest to avoid  "Session._new_sid(req)" ?

Don't know, just wasn't my first choice.

>  I've already used req.connection.id and instead of req.connection.remote_ip
>  I've used the req.connection.remote_addr because there is also the
>  client port but I've noticed that this three values doesn't change
>  if I repeatedly refresh the page :( probably the tcp client stack cache the
> last free
>  used port for an immediate reuse... on windows I've to wait at least 6
> seconds
>  between a refresh to have different values :(
>
>  def _getunique(req):
>    import os
>    import thread
>
>    req.uniqidprog = req.uniqidprog + 1
>    _tmpid = "%d:%d:%s:%s:%d:%s:%d" % ( os.getpid(),
>                                     thread.get_ident(),
>                                     req.connection.remote_addr[0],
>                                     req.connection.remote_addr[1],
>                                     req.connection.id,
>                                     req.request_time,
>                                     req.uniqidprog )
>
>    return _tmpid
>  Any other suggestion ?

Don't stick uniqidprog in req, it will always be 0 as a result. It
needs to be a global module variable which is thread protected.

  from threading import Lock
  lock = Lock()
  uniqidprog = 1

  def _getunique(req):
    lock.acquire()
    value = uniqidprog
    uniqidprog += 1
    lock.release()

    ... use

The req.connection.id would stay the same if keep alive is used and
connection maintained.

Graham
From l.montecchiani at teamsystem.com  Thu Apr 24 04:14:56 2008
From: l.montecchiani at teamsystem.com (Luca Montecchiani)
Date: Thu Apr 24 04:14:44 2008
Subject: [mod_python] Best way to have an unique_id per request
In-Reply-To: <88e286470804240029s2ed1c940t4a184d64efd1adeb@mail.gmail.com>
References: <480F5596.9030705@teamsystem.com>	
	<88e286470804231455u64b658fcme4c4ff81cf18fea8@mail.gmail.com>	
	<48103567.2090102@teamsystem.com>
	<88e286470804240029s2ed1c940t4a184d64efd1adeb@mail.gmail.com>
Message-ID: <48104180.1090709@teamsystem.com>

Graham Dumpleton ha scritto:

> Don't stick uniqidprog in req, it will always be 0 as a result. It
> needs to be a global module variable which is thread protected.
>
>   from threading import Lock
>   lock = Lock()
>   uniqidprog = 1
>
>   def _getunique(req):
>     lock.acquire()
>     value = uniqidprog
>     uniqidprog += 1
>     lock.release()
>
>     ... use
>   

In my own publisher I've many req.somevarname = somevalue
without worrying about locking simply because the docs suggest it :

"4.5.4 Request Object
The request object is a Python mapping to the Apache request rec 
structure. When a handler is invoked, it is
always passed a single argument - the request object.
You can dynamically assign attributes to it as a way to communicate 
between handlers."

> The req.connection.id would stay the same if keep alive is used and
> connection maintained.
>   
Ok this make sense and could be a problem.

I'm going to use the _new_sid() method for now
thanks for your time,
luca

-- 
Luca Montecchiani
Software Di Base
TeamSystem S.p.a.
------------------------------------------------------------------------------------------
Informativa ai sensi del D. Lgs. 196-30/06/2003.
Il contenuto di questa e.mail e degli eventuali allegati, deve essere nella disponibilit?
del solo destinatario.  Se ricevete per errore questa e-mail siete pregati di informarci
(rispedendola al mittente) e di provvedere alla sua rimozione.
Possono essere presenti informazioni riservate e non corrette (parzialmente o totalmente).
Le e-mail in partenza e in arrivo possono essere oggetto di monitoraggio
da parte di Teamsystem spa.  Del contenuto ? responsabile il mittente della presente.
Chiunque venga in possesso non autorizzato di questa e-mail ? vincolato
dalla Legge a non leggerne il contenuto, a non copiarla, a non diffonderla e a non usarla.
Informiamo che per l' esercizio dei diritti di cui all'art. 7 del d.lgs.196/2003 ci si pu?
rivolgere al Titolare del trattamento Teamsystem S.r.l. via Gagarin 205 61100 PESARO
per posta o fax, indicando sulla busta o sul foglio la dicitura "Inerente alla Privacy",
o inviando una e-mail all' indirizzo privacy@teamsystem.com .
------------------------------------------------------------------------------------------

From Dominique.Holzwarth at ch.delarue.com  Thu Apr 24 06:04:38 2008
From: Dominique.Holzwarth at ch.delarue.com (Dominique.Holzwarth@ch.delarue.com)
Date: Thu Apr 24 06:09:41 2008
Subject: [mod_python] Sendfile & request answer
Message-ID: <5213E58D85BC414998FA553C701E386C0EDD14B2E5@SGBD012511.dlrmail.ad.delarue.com>

Hi everyone!

I'm using the publisher handler for a web application that consist of a html page with a form. On a button click I'm sending a file to the client (so the client can open/save that file). But when I do the req.sendfile() I can't send a 'normal' request answer (a html page) to the client anymore using 'return "some html string"' or 'req.write("html string")'.

Is there any way to send a file to the user AND refresh the displayed html page?

Thanks for any help!
Dominique


From graham.dumpleton at gmail.com  Thu Apr 24 06:10:59 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu Apr 24 06:11:05 2008
Subject: [mod_python] Best way to have an unique_id per request
In-Reply-To: <48104180.1090709@teamsystem.com>
References: <480F5596.9030705@teamsystem.com>
	<88e286470804231455u64b658fcme4c4ff81cf18fea8@mail.gmail.com>
	<48103567.2090102@teamsystem.com>
	<88e286470804240029s2ed1c940t4a184d64efd1adeb@mail.gmail.com>
	<48104180.1090709@teamsystem.com>
Message-ID: <88e286470804240310q4145cc4dnea7b8ce5252c5fb0@mail.gmail.com>

2008/4/24 Luca Montecchiani <l.montecchiani@teamsystem.com>:
> Graham Dumpleton ha scritto:
>
>
>
> > Don't stick uniqidprog in req, it will always be 0 as a result. It
> > needs to be a global module variable which is thread protected.
> >
> >  from threading import Lock
> >  lock = Lock()
> >  uniqidprog = 1
> >
> >  def _getunique(req):
> >    lock.acquire()
> >    value = uniqidprog
> >    uniqidprog += 1
> >    lock.release()
> >
> >    ... use
> >
> >
>
>  In my own publisher I've many req.somevarname = somevalue
>  without worrying about locking simply because the docs suggest it :
>
>  "4.5.4 Request Object
>  The request object is a Python mapping to the Apache request rec structure.
> When a handler is invoked, it is
>  always passed a single argument - the request object.
>  You can dynamically assign attributes to it as a way to communicate between
> handlers."

Yes, but in this case you want the counter to be common to all request
handlers executing in that process over time, otherwise it is
pointless having it. When you assign to req object, it only exists for
that one request.

Maybe I am misunderstanding what you are wanting to do. :-)

Graham
From graham.dumpleton at gmail.com  Thu Apr 24 07:22:08 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu Apr 24 07:22:14 2008
Subject: [mod_python] Sendfile & request answer
In-Reply-To: <5213E58D85BC414998FA553C701E386C0EDD14B2E5@SGBD012511.dlrmail.ad.delarue.com>
References: <5213E58D85BC414998FA553C701E386C0EDD14B2E5@SGBD012511.dlrmail.ad.delarue.com>
Message-ID: <88e286470804240422m59412fe8w8db584323f96d84a@mail.gmail.com>

2008/4/24  <Dominique.Holzwarth@ch.delarue.com>:
> Hi everyone!
>
>  I'm using the publisher handler for a web application that consist of a html page with a form. On a button click I'm sending a file to the client (so the client can open/save that file). But when I do the req.sendfile() I can't send a 'normal' request answer (a html page) to the client anymore using 'return "some html string"' or 'req.write("html string")'.
>
>  Is there any way to send a file to the user AND refresh the displayed html page?

Within the one response, no.

At least this is the case if using req.sendfile(). The only way would
be by sending a multipart/mixed response, but then you would most
likely need a special client to be able to pull it apart which would
generally make it impractical.

Graham
From Dominique.Holzwarth at ch.delarue.com  Thu Apr 24 07:27:15 2008
From: Dominique.Holzwarth at ch.delarue.com (Dominique.Holzwarth@ch.delarue.com)
Date: Thu Apr 24 07:27:58 2008
Subject: [mod_python] Sendfile & request answer
In-Reply-To: <88e286470804240422m59412fe8w8db584323f96d84a@mail.gmail.com>
Message-ID: <5213E58D85BC414998FA553C701E386C0EDD14B3A5@SGBD012511.dlrmail.ad.delarue.com>

Well, is there a way to send out more than _one_ response? Like, sending the file first and right after sending the html page or so?

I've tried the 'internal_redirect' as in the manual there's written:

internal_redirect( new_uri)
Internally redirects the request to the new_uri. new_uri must be a string.
The httpd server handles internal redirection by creating a new request object and processing all request phases. Within an internal redirect, req.prev will contain a reference to a request object from which it was redirected.

So I thought by calling req.internal_redirect() after req.sendfile() I would get another request for which I could generate my html page answer. But that didn't seem to work... :-/

Dominique

-----Original Message-----
From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
Sent: Donnerstag, 24. April 2008 13:22
To: Holzwarth, Dominique (Berne Bauhaus)
Cc: mod_python@modpython.org
Subject: Re: [mod_python] Sendfile & request answer

2008/4/24  <Dominique.Holzwarth@ch.delarue.com>:
> Hi everyone!
>
>  I'm using the publisher handler for a web application that consist of a html page with a form. On a button click I'm sending a file to the client (so the client can open/save that file). But when I do the req.sendfile() I can't send a 'normal' request answer (a html page) to the client anymore using 'return "some html string"' or 'req.write("html string")'.
>
>  Is there any way to send a file to the user AND refresh the displayed html page?

Within the one response, no.

At least this is the case if using req.sendfile(). The only way would be by sending a multipart/mixed response, but then you would most likely need a special client to be able to pull it apart which would generally make it impractical.

Graham



From graham.dumpleton at gmail.com  Thu Apr 24 07:33:23 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu Apr 24 07:33:28 2008
Subject: [mod_python] Sendfile & request answer
In-Reply-To: <5213E58D85BC414998FA553C701E386C0EDD14B3A5@SGBD012511.dlrmail.ad.delarue.com>
References: <88e286470804240422m59412fe8w8db584323f96d84a@mail.gmail.com>
	<5213E58D85BC414998FA553C701E386C0EDD14B3A5@SGBD012511.dlrmail.ad.delarue.com>
Message-ID: <88e286470804240433x68de4a75n359b6779a747c26c@mail.gmail.com>

2008/4/24  <Dominique.Holzwarth@ch.delarue.com>:
> Well, is there a way to send out more than _one_ response? Like, sending the file first and right after sending the html page or so?

I told you already. You need to use a multipart/mixed response. This
is a single response but you use mime encapsulation to contain
multiple parts in the response. See:

  http://en.wikipedia.org/wiki/MIME

and the various RFCs linked of it.

>  I've tried the 'internal_redirect' as in the manual there's written:
>
>  internal_redirect( new_uri)
>  Internally redirects the request to the new_uri. new_uri must be a string.
>  The httpd server handles internal redirection by creating a new request object and processing all request phases. Within an internal redirect, req.prev will contain a reference to a request object from which it was redirected.
>
>  So I thought by calling req.internal_redirect() after req.sendfile() I would get another request for which I could generate my html page answer. But that didn't seem to work... :-/

And it will not. You can only generate one HTTP response from a
request thus why the only option is to handle it within the content.

Graham

>  Dominique
>
>
>
>  -----Original Message-----
>  From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
>  Sent: Donnerstag, 24. April 2008 13:22
>  To: Holzwarth, Dominique (Berne Bauhaus)
>  Cc: mod_python@modpython.org
>  Subject: Re: [mod_python] Sendfile & request answer
>
>  2008/4/24  <Dominique.Holzwarth@ch.delarue.com>:
>  > Hi everyone!
>  >
>  >  I'm using the publisher handler for a web application that consist of a html page with a form. On a button click I'm sending a file to the client (so the client can open/save that file). But when I do the req.sendfile() I can't send a 'normal' request answer (a html page) to the client anymore using 'return "some html string"' or 'req.write("html string")'.
>  >
>  >  Is there any way to send a file to the user AND refresh the displayed html page?
>
>  Within the one response, no.
>
>  At least this is the case if using req.sendfile(). The only way would be by sending a multipart/mixed response, but then you would most likely need a special client to be able to pull it apart which would generally make it impractical.
>
>  Graham
>
>
>
From clodoaldo.pinto.neto at gmail.com  Thu Apr 24 07:56:01 2008
From: clodoaldo.pinto.neto at gmail.com (Clodoaldo)
Date: Thu Apr 24 07:56:08 2008
Subject: [mod_python] Sendfile & request answer
In-Reply-To: <5213E58D85BC414998FA553C701E386C0EDD14B3A5@SGBD012511.dlrmail.ad.delarue.com>
References: <88e286470804240422m59412fe8w8db584323f96d84a@mail.gmail.com>
	<5213E58D85BC414998FA553C701E386C0EDD14B3A5@SGBD012511.dlrmail.ad.delarue.com>
Message-ID: <a595de7a0804240456v48067998yc73c4c3886415180@mail.gmail.com>

2008/4/24, Dominique.Holzwarth@ch.delarue.com
<Dominique.Holzwarth@ch.delarue.com>:
> Well, is there a way to send out more than _one_ response? Like, sending the file first and right after sending the html page or so?
>
>  I've tried the 'internal_redirect' as in the manual there's written:
>
>  internal_redirect( new_uri)
>  Internally redirects the request to the new_uri. new_uri must be a string.
>  The httpd server handles internal redirection by creating a new request object and processing all request phases. Within an internal redirect, req.prev will contain a reference to a request object from which it was redirected.
>
>  So I thought by calling req.internal_redirect() after req.sendfile() I would get another request for which I could generate my html page answer. But that didn't seem to work... :-/

I would consider the use of ajax although i don't know if it will
work. First request the file and then the page. I never did it but i
think it is worth the investigation.

Regards, Clodoaldo

>  -----Original Message-----
>  From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
>  Sent: Donnerstag, 24. April 2008 13:22
>  To: Holzwarth, Dominique (Berne Bauhaus)
>  Cc: mod_python@modpython.org
>  Subject: Re: [mod_python] Sendfile & request answer
>
>  2008/4/24  <Dominique.Holzwarth@ch.delarue.com>:
>  > Hi everyone!
>  >
>  >  I'm using the publisher handler for a web application that consist of a html page with a form. On a button click I'm sending a file to the client (so the client can open/save that file). But when I do the req.sendfile() I can't send a 'normal' request answer (a html page) to the client anymore using 'return "some html string"' or 'req.write("html string")'.
>  >
>  >  Is there any way to send a file to the user AND refresh the displayed html page?
>
>  Within the one response, no.
>
>  At least this is the case if using req.sendfile(). The only way would be by sending a multipart/mixed response, but then you would most likely need a special client to be able to pull it apart which would generally make it impractical.
>
>  Graham
>
>
>
>  _______________________________________________
>  Mod_python mailing list
>  Mod_python@modpython.org
>  http://mailman.modpython.org/mailman/listinfo/mod_python
>
From l.montecchiani at teamsystem.com  Thu Apr 24 08:43:45 2008
From: l.montecchiani at teamsystem.com (Luca Montecchiani)
Date: Thu Apr 24 08:43:29 2008
Subject: [mod_python] Best way to have an unique_id per request
In-Reply-To: <88e286470804240310q4145cc4dnea7b8ce5252c5fb0@mail.gmail.com>
References: <480F5596.9030705@teamsystem.com>	
	<88e286470804231455u64b658fcme4c4ff81cf18fea8@mail.gmail.com>	
	<48103567.2090102@teamsystem.com>	
	<88e286470804240029s2ed1c940t4a184d64efd1adeb@mail.gmail.com>	
	<48104180.1090709@teamsystem.com>
	<88e286470804240310q4145cc4dnea7b8ce5252c5fb0@mail.gmail.com>
Message-ID: <48108081.200@teamsystem.com>

Graham Dumpleton ha scritto:
> Yes, but in this case you want the counter to be common to all request
> handlers executing in that process over time, otherwise it is
> pointless having it. When you assign to req object, it only exists for
> that one request.
>
> Maybe I am misunderstanding what you are wanting to do. :-)
>   
Just a little bit :-)
The counter was per request to allow multiple getuniqiue() calls within it.

luca

-- 
Luca Montecchiani
Software Di Base
TeamSystem S.p.a.
------------------------------------------------------------------------------------------
Informativa ai sensi del D. Lgs. 196-30/06/2003.
Il contenuto di questa e.mail e degli eventuali allegati, deve essere nella disponibilit?
del solo destinatario.  Se ricevete per errore questa e-mail siete pregati di informarci
(rispedendola al mittente) e di provvedere alla sua rimozione.
Possono essere presenti informazioni riservate e non corrette (parzialmente o totalmente).
Le e-mail in partenza e in arrivo possono essere oggetto di monitoraggio
da parte di Teamsystem spa.  Del contenuto ? responsabile il mittente della presente.
Chiunque venga in possesso non autorizzato di questa e-mail ? vincolato
dalla Legge a non leggerne il contenuto, a non copiarla, a non diffonderla e a non usarla.
Informiamo che per l' esercizio dei diritti di cui all'art. 7 del d.lgs.196/2003 ci si pu?
rivolgere al Titolare del trattamento Teamsystem S.r.l. via Gagarin 205 61100 PESARO
per posta o fax, indicando sulla busta o sul foglio la dicitura "Inerente alla Privacy",
o inviando una e-mail all' indirizzo privacy@teamsystem.com .
------------------------------------------------------------------------------------------

From mikechambers at gmail.com  Fri Apr 25 18:45:33 2008
From: mikechambers at gmail.com (Mike Chambers)
Date: Fri Apr 25 18:45:41 2008
Subject: [mod_python] make not building mod_python.so
Message-ID: <48125F0D.5080106@gmail.com>

I am trying to install mod_python on my debian system, and have hit a 
roadblock.

mod_python : 3.3.1
Python : 2.5.2
apache : 2.2.8


./configure --with-apxs=/usr/local/apache2/bin/apxs
make
sudo make install

This all completes, but the mod_python.so is not created. Looking at the 
output from

make install

I see:

/usr/bin/install: cannot stat `src/mod_python.so': No such file or directory

I found one reference to this on the web, which suggested that it was 
due to an old version of libtool used by Apache. So, I updated libtool, 
and recompiled apache, but it is still not working.

I am including the complete make and make install output below.

Does anyone have any idea what might be going on? I have been trying to 
get this to compile for about 12 hours now (spread over a couple of 
days), and am not sure what to do at this point.

Thanks for any help...

mike


----------------------make output-----------------------------

make[1]: Entering directory `/home/mesh/tmp/mod_python-3.3.1/src'

Compiling for DSO.

/usr/local/apache2/bin/apxs 
-I/home/mesh/tmp/mod_python-3.3.1/src/include 
-I/usr/local/apache2/include -I/usr/local/include/python2.5 -c 
mod_python.c _apachemodule.c requestobject.c tableobject.c util.c 
serverobject.c connobject.c filterobject.c hlist.c hlistobject.c 
finfoobject.c -L/usr/local/lib/python2.5/config  -Xlinker 
-export-dynamic      -lm  -lpython2.5 -lpthread -ldl -lutil -lm
/usr/local/apache2/build/libtool --silent --mode=compile gcc -prefer-pic 
   -DLINUX=2 -D_REENTRANT -D_GNU_SOURCE -D_LARGEFILE64_SOURCE -g -O2 
-pthread -I/usr/local/apache2/include  -I/usr/local/apache2/include 
-I/usr/local/apache2/include 
-I/home/mesh/tmp/mod_python-3.3.1/src/include 
-I/usr/local/apache2/include -I/usr/local/include/python2.5  -c -o 
mod_python.lo mod_python.c && touch mod_python.slo
In file included from /usr/local/include/python2.5/Python.h:8,
                  from 
/home/mesh/tmp/mod_python-3.3.1/src/include/mod_python.h:80,
                  from mod_python.c:28:
/usr/local/include/python2.5/pyconfig.h:942:1: warning: 
"_POSIX_C_SOURCE" redefined
In file included from /usr/include/sys/types.h:27,
                  from /usr/local/apache2/include/apr.h:116,
                  from /usr/local/apache2/include/ap_config.h:25,
                  from /usr/local/apache2/include/httpd.h:43,
                  from 
/home/mesh/tmp/mod_python-3.3.1/src/include/mod_python.h:42,
                  from mod_python.c:28:
/usr/include/features.h:150:1: warning: this is the location of the 
previous definition
mod_python.c: In function `python_init':
mod_python.c:826: warning: initialization from incompatible pointer type
/usr/local/apache2/build/libtool --silent --mode=compile gcc -prefer-pic 
   -DLINUX=2 -D_REENTRANT -D_GNU_SOURCE -D_LARGEFILE64_SOURCE -g -O2 
-pthread -I/usr/local/apache2/include  -I/usr/local/apache2/include 
-I/usr/local/apache2/include 
-I/home/mesh/tmp/mod_python-3.3.1/src/include 
-I/usr/local/apache2/include -I/usr/local/include/python2.5  -c -o 
_apachemodule.lo _apachemodule.c && touch _apachemodule.slo
In file included from /usr/local/include/python2.5/Python.h:8,
                  from 
/home/mesh/tmp/mod_python-3.3.1/src/include/mod_python.h:80,
                  from _apachemodule.c:25:
/usr/local/include/python2.5/pyconfig.h:942:1: warning: 
"_POSIX_C_SOURCE" redefined
In file included from /usr/include/sys/types.h:27,
                  from /usr/local/apache2/include/apr.h:116,
                  from /usr/local/apache2/include/ap_config.h:25,
                  from /usr/local/apache2/include/httpd.h:43,
                  from 
/home/mesh/tmp/mod_python-3.3.1/src/include/mod_python.h:42,
                  from _apachemodule.c:25:
/usr/include/features.h:150:1: warning: this is the location of the 
previous definition
/usr/local/apache2/build/libtool --silent --mode=compile gcc -prefer-pic 
   -DLINUX=2 -D_REENTRANT -D_GNU_SOURCE -D_LARGEFILE64_SOURCE -g -O2 
-pthread -I/usr/local/apache2/include  -I/usr/local/apache2/include 
-I/usr/local/apache2/include 
-I/home/mesh/tmp/mod_python-3.3.1/src/include 
-I/usr/local/apache2/include -I/usr/local/include/python2.5  -c -o 
requestobject.lo requestobject.c && touch requestobject.slo
In file included from /usr/local/include/python2.5/Python.h:8,
                  from 
/home/mesh/tmp/mod_python-3.3.1/src/include/mod_python.h:80,
                  from requestobject.c:25:
/usr/local/include/python2.5/pyconfig.h:942:1: warning: 
"_POSIX_C_SOURCE" redefined
In file included from /usr/include/sys/types.h:27,
                  from /usr/local/apache2/include/apr.h:116,
                  from /usr/local/apache2/include/ap_config.h:25,
                  from /usr/local/apache2/include/httpd.h:43,
                  from 
/home/mesh/tmp/mod_python-3.3.1/src/include/mod_python.h:42,
                  from requestobject.c:25:
/usr/include/features.h:150:1: warning: this is the location of the 
previous definition
/usr/local/apache2/build/libtool --silent --mode=compile gcc -prefer-pic 
   -DLINUX=2 -D_REENTRANT -D_GNU_SOURCE -D_LARGEFILE64_SOURCE -g -O2 
-pthread -I/usr/local/apache2/include  -I/usr/local/apache2/include 
-I/usr/local/apache2/include 
-I/home/mesh/tmp/mod_python-3.3.1/src/include 
-I/usr/local/apache2/include -I/usr/local/include/python2.5  -c -o 
tableobject.lo tableobject.c && touch tableobject.slo
In file included from /usr/local/include/python2.5/Python.h:8,
                  from 
/home/mesh/tmp/mod_python-3.3.1/src/include/mod_python.h:80,
                  from tableobject.c:25:
/usr/local/include/python2.5/pyconfig.h:942:1: warning: 
"_POSIX_C_SOURCE" redefined
In file included from /usr/include/sys/types.h:27,
                  from /usr/local/apache2/include/apr.h:116,
                  from /usr/local/apache2/include/ap_config.h:25,
                  from /usr/local/apache2/include/httpd.h:43,
                  from 
/home/mesh/tmp/mod_python-3.3.1/src/include/mod_python.h:42,
                  from tableobject.c:25:
/usr/include/features.h:150:1: warning: this is the location of the 
previous definition
tableobject.c:1092: warning: initialization from incompatible pointer type
/usr/local/apache2/build/libtool --silent --mode=compile gcc -prefer-pic 
   -DLINUX=2 -D_REENTRANT -D_GNU_SOURCE -D_LARGEFILE64_SOURCE -g -O2 
-pthread -I/usr/local/apache2/include  -I/usr/local/apache2/include 
-I/usr/local/apache2/include 
-I/home/mesh/tmp/mod_python-3.3.1/src/include 
-I/usr/local/apache2/include -I/usr/local/include/python2.5  -c -o 
util.lo util.c && touch util.slo
In file included from /usr/local/include/python2.5/Python.h:8,
                  from 
/home/mesh/tmp/mod_python-3.3.1/src/include/mod_python.h:80,
                  from util.c:28:
/usr/local/include/python2.5/pyconfig.h:942:1: warning: 
"_POSIX_C_SOURCE" redefined
In file included from /usr/include/sys/types.h:27,
                  from /usr/local/apache2/include/apr.h:116,
                  from /usr/local/apache2/include/ap_config.h:25,
                  from /usr/local/apache2/include/httpd.h:43,
                  from 
/home/mesh/tmp/mod_python-3.3.1/src/include/mod_python.h:42,
                  from util.c:28:
/usr/include/features.h:150:1: warning: this is the location of the 
previous definition
/usr/local/apache2/build/libtool --silent --mode=compile gcc -prefer-pic 
   -DLINUX=2 -D_REENTRANT -D_GNU_SOURCE -D_LARGEFILE64_SOURCE -g -O2 
-pthread -I/usr/local/apache2/include  -I/usr/local/apache2/include 
-I/usr/local/apache2/include 
-I/home/mesh/tmp/mod_python-3.3.1/src/include 
-I/usr/local/apache2/include -I/usr/local/include/python2.5  -c -o 
serverobject.lo serverobject.c && touch serverobject.slo
In file included from /usr/local/include/python2.5/Python.h:8,
                  from 
/home/mesh/tmp/mod_python-3.3.1/src/include/mod_python.h:80,
                  from serverobject.c:25:
/usr/local/include/python2.5/pyconfig.h:942:1: warning: 
"_POSIX_C_SOURCE" redefined
In file included from /usr/include/sys/types.h:27,
                  from /usr/local/apache2/include/apr.h:116,
                  from /usr/local/apache2/include/ap_config.h:25,
                  from /usr/local/apache2/include/httpd.h:43,
                  from 
/home/mesh/tmp/mod_python-3.3.1/src/include/mod_python.h:42,
                  from serverobject.c:25:
/usr/include/features.h:150:1: warning: this is the location of the 
previous definition
serverobject.c:387: warning: initialization from incompatible pointer type
/usr/local/apache2/build/libtool --silent --mode=compile gcc -prefer-pic 
   -DLINUX=2 -D_REENTRANT -D_GNU_SOURCE -D_LARGEFILE64_SOURCE -g -O2 
-pthread -I/usr/local/apache2/include  -I/usr/local/apache2/include 
-I/usr/local/apache2/include 
-I/home/mesh/tmp/mod_python-3.3.1/src/include 
-I/usr/local/apache2/include -I/usr/local/include/python2.5  -c -o 
connobject.lo connobject.c && touch connobject.slo
In file included from /usr/local/include/python2.5/Python.h:8,
                  from 
/home/mesh/tmp/mod_python-3.3.1/src/include/mod_python.h:80,
                  from connobject.c:30:
/usr/local/include/python2.5/pyconfig.h:942:1: warning: 
"_POSIX_C_SOURCE" redefined
In file included from /usr/include/sys/types.h:27,
                  from /usr/local/apache2/include/apr.h:116,
                  from /usr/local/apache2/include/ap_config.h:25,
                  from /usr/local/apache2/include/httpd.h:43,
                  from 
/home/mesh/tmp/mod_python-3.3.1/src/include/mod_python.h:42,
                  from connobject.c:30:
/usr/include/features.h:150:1: warning: this is the location of the 
previous definition
/usr/local/apache2/build/libtool --silent --mode=compile gcc -prefer-pic 
   -DLINUX=2 -D_REENTRANT -D_GNU_SOURCE -D_LARGEFILE64_SOURCE -g -O2 
-pthread -I/usr/local/apache2/include  -I/usr/local/apache2/include 
-I/usr/local/apache2/include 
-I/home/mesh/tmp/mod_python-3.3.1/src/include 
-I/usr/local/apache2/include -I/usr/local/include/python2.5  -c -o 
filterobject.lo filterobject.c && touch filterobject.slo
In file included from /usr/local/include/python2.5/Python.h:8,
                  from 
/home/mesh/tmp/mod_python-3.3.1/src/include/mod_python.h:80,
                  from filterobject.c:28:
/usr/local/include/python2.5/pyconfig.h:942:1: warning: 
"_POSIX_C_SOURCE" redefined
In file included from /usr/include/sys/types.h:27,
                  from /usr/local/apache2/include/apr.h:116,
                  from /usr/local/apache2/include/ap_config.h:25,
                  from /usr/local/apache2/include/httpd.h:43,
                  from 
/home/mesh/tmp/mod_python-3.3.1/src/include/mod_python.h:42,
                  from filterobject.c:28:
/usr/include/features.h:150:1: warning: this is the location of the 
previous definition
/usr/local/apache2/build/libtool --silent --mode=compile gcc -prefer-pic 
   -DLINUX=2 -D_REENTRANT -D_GNU_SOURCE -D_LARGEFILE64_SOURCE -g -O2 
-pthread -I/usr/local/apache2/include  -I/usr/local/apache2/include 
-I/usr/local/apache2/include 
-I/home/mesh/tmp/mod_python-3.3.1/src/include 
-I/usr/local/apache2/include -I/usr/local/include/python2.5  -c -o 
hlist.lo hlist.c && touch hlist.slo
In file included from /usr/local/include/python2.5/Python.h:8,
                  from 
/home/mesh/tmp/mod_python-3.3.1/src/include/mod_python.h:80,
                  from hlist.c:28:
/usr/local/include/python2.5/pyconfig.h:942:1: warning: 
"_POSIX_C_SOURCE" redefined
In file included from /usr/include/sys/types.h:27,
                  from /usr/local/apache2/include/apr.h:116,
                  from /usr/local/apache2/include/ap_config.h:25,
                  from /usr/local/apache2/include/httpd.h:43,
                  from 
/home/mesh/tmp/mod_python-3.3.1/src/include/mod_python.h:42,
                  from hlist.c:28:
/usr/include/features.h:150:1: warning: this is the location of the 
previous definition
/usr/local/apache2/build/libtool --silent --mode=compile gcc -prefer-pic 
   -DLINUX=2 -D_REENTRANT -D_GNU_SOURCE -D_LARGEFILE64_SOURCE -g -O2 
-pthread -I/usr/local/apache2/include  -I/usr/local/apache2/include 
-I/usr/local/apache2/include 
-I/home/mesh/tmp/mod_python-3.3.1/src/include 
-I/usr/local/apache2/include -I/usr/local/include/python2.5  -c -o 
hlistobject.lo hlistobject.c && touch hlistobject.slo
In file included from /usr/local/include/python2.5/Python.h:8,
                  from 
/home/mesh/tmp/mod_python-3.3.1/src/include/mod_python.h:80,
                  from hlistobject.c:28:
/usr/local/include/python2.5/pyconfig.h:942:1: warning: 
"_POSIX_C_SOURCE" redefined
In file included from /usr/include/sys/types.h:27,
                  from /usr/local/apache2/include/apr.h:116,
                  from /usr/local/apache2/include/ap_config.h:25,
                  from /usr/local/apache2/include/httpd.h:43,
                  from 
/home/mesh/tmp/mod_python-3.3.1/src/include/mod_python.h:42,
                  from hlistobject.c:28:
/usr/include/features.h:150:1: warning: this is the location of the 
previous definition
/usr/local/apache2/build/libtool --silent --mode=compile gcc -prefer-pic 
   -DLINUX=2 -D_REENTRANT -D_GNU_SOURCE -D_LARGEFILE64_SOURCE -g -O2 
-pthread -I/usr/local/apache2/include  -I/usr/local/apache2/include 
-I/usr/local/apache2/include 
-I/home/mesh/tmp/mod_python-3.3.1/src/include 
-I/usr/local/apache2/include -I/usr/local/include/python2.5  -c -o 
finfoobject.lo finfoobject.c && touch finfoobject.slo
In file included from /usr/local/include/python2.5/Python.h:8,
                  from 
/home/mesh/tmp/mod_python-3.3.1/src/include/mod_python.h:80,
                  from finfoobject.c:25:
/usr/local/include/python2.5/pyconfig.h:942:1: warning: 
"_POSIX_C_SOURCE" redefined
In file included from /usr/include/sys/types.h:27,
                  from /usr/local/apache2/include/apr.h:116,
                  from /usr/local/apache2/include/ap_config.h:25,
                  from /usr/local/apache2/include/httpd.h:43,
                  from 
/home/mesh/tmp/mod_python-3.3.1/src/include/mod_python.h:42,
                  from finfoobject.c:25:
/usr/include/features.h:150:1: warning: this is the location of the 
previous definition
finfoobject.c:278: warning: `intargfunc' is deprecated (declared at 
/usr/local/include/python2.5/object.h:133)
/usr/local/apache2/build/libtool --silent --mode=link gcc -o 
mod_python.la  -rpath /usr/local/apache2/modules -module -avoid-version 
    finfoobject.lo hlistobject.lo hlist.lo filterobject.lo connobject.lo 
serverobject.lo util.lo tableobject.lo requestobject.lo _apachemodule.lo 
mod_python.lo -L/usr/local/lib/python2.5/config -Xlinker -export-dynamic 
-lm -lpython2.5 -lpthread -ldl -lutil -lm
make[1]: Leaving directory `/home/mesh/tmp/mod_python-3.3.1/src'
make[1]: Entering directory `/home/mesh/tmp/mod_python-3.3.1/dist'
make[2]: Entering directory `/home/mesh/tmp/mod_python-3.3.1/src'
make[2]: `psp_parser.c' is up to date.
make[2]: Leaving directory `/home/mesh/tmp/mod_python-3.3.1/src'
/usr/local/bin/python setup.py build
running build
running build_py
running build_ext
make[1]: Leaving directory `/home/mesh/tmp/mod_python-3.3.1/dist'

Now su and make install
   (or, if you only want to perform a partial install,
    you can use make install_dso and make install_py_lib)




----------------------make install output---------------------
/usr/local/apache2/build/libtool --silent --mode=compile gcc -prefer-pic 
   -DLINUX=2 -D_REENTRANT -D_GNU_SOURCE -D_LARGEFILE64_SOURCE -g -O2 
-pthread -I/usr/local/apache2/include  -I/usr/local/apache2/include 
-I/usr/local/apache2/include 
-I/home/mesh/tmp/mod_python-3.3.1/src/include 
-I/usr/local/apache2/include -I/usr/local/include/python2.5  -c -o 
mod_python.lo mod_python.c && touch mod_python.slo
In file included from /usr/local/include/python2.5/Python.h:8,
                  from 
/home/mesh/tmp/mod_python-3.3.1/src/include/mod_python.h:80,
                  from mod_python.c:28:
/usr/local/include/python2.5/pyconfig.h:942:1: warning: 
"_POSIX_C_SOURCE" redefined
In file included from /usr/include/sys/types.h:27,
                  from /usr/local/apache2/include/apr.h:116,
                  from /usr/local/apache2/include/ap_config.h:25,
                  from /usr/local/apache2/include/httpd.h:43,
                  from 
/home/mesh/tmp/mod_python-3.3.1/src/include/mod_python.h:42,
                  from mod_python.c:28:
/usr/include/features.h:150:1: warning: this is the location of the 
previous definition
mod_python.c: In function `python_init':
mod_python.c:826: warning: initialization from incompatible pointer type
/usr/local/apache2/build/libtool --silent --mode=compile gcc -prefer-pic 
   -DLINUX=2 -D_REENTRANT -D_GNU_SOURCE -D_LARGEFILE64_SOURCE -g -O2 
-pthread -I/usr/local/apache2/include  -I/usr/local/apache2/include 
-I/usr/local/apache2/include 
-I/home/mesh/tmp/mod_python-3.3.1/src/include 
-I/usr/local/apache2/include -I/usr/local/include/python2.5  -c -o 
_apachemodule.lo _apachemodule.c && touch _apachemodule.slo
In file included from /usr/local/include/python2.5/Python.h:8,
                  from 
/home/mesh/tmp/mod_python-3.3.1/src/include/mod_python.h:80,
                  from _apachemodule.c:25:
/usr/local/include/python2.5/pyconfig.h:942:1: warning: 
"_POSIX_C_SOURCE" redefined
In file included from /usr/include/sys/types.h:27,
                  from /usr/local/apache2/include/apr.h:116,
                  from /usr/local/apache2/include/ap_config.h:25,
                  from /usr/local/apache2/include/httpd.h:43,
                  from 
/home/mesh/tmp/mod_python-3.3.1/src/include/mod_python.h:42,
                  from _apachemodule.c:25:
/usr/include/features.h:150:1: warning: this is the location of the 
previous definition
/usr/local/apache2/build/libtool --silent --mode=compile gcc -prefer-pic 
   -DLINUX=2 -D_REENTRANT -D_GNU_SOURCE -D_LARGEFILE64_SOURCE -g -O2 
-pthread -I/usr/local/apache2/include  -I/usr/local/apache2/include 
-I/usr/local/apache2/include 
-I/home/mesh/tmp/mod_python-3.3.1/src/include 
-I/usr/local/apache2/include -I/usr/local/include/python2.5  -c -o 
requestobject.lo requestobject.c && touch requestobject.slo
In file included from /usr/local/include/python2.5/Python.h:8,
                  from 
/home/mesh/tmp/mod_python-3.3.1/src/include/mod_python.h:80,
                  from requestobject.c:25:
/usr/local/include/python2.5/pyconfig.h:942:1: warning: 
"_POSIX_C_SOURCE" redefined
In file included from /usr/include/sys/types.h:27,
                  from /usr/local/apache2/include/apr.h:116,
                  from /usr/local/apache2/include/ap_config.h:25,
                  from /usr/local/apache2/include/httpd.h:43,
                  from 
/home/mesh/tmp/mod_python-3.3.1/src/include/mod_python.h:42,
                  from requestobject.c:25:
/usr/include/features.h:150:1: warning: this is the location of the 
previous definition
/usr/local/apache2/build/libtool --silent --mode=compile gcc -prefer-pic 
   -DLINUX=2 -D_REENTRANT -D_GNU_SOURCE -D_LARGEFILE64_SOURCE -g -O2 
-pthread -I/usr/local/apache2/include  -I/usr/local/apache2/include 
-I/usr/local/apache2/include 
-I/home/mesh/tmp/mod_python-3.3.1/src/include 
-I/usr/local/apache2/include -I/usr/local/include/python2.5  -c -o 
tableobject.lo tableobject.c && touch tableobject.slo
In file included from /usr/local/include/python2.5/Python.h:8,
                  from 
/home/mesh/tmp/mod_python-3.3.1/src/include/mod_python.h:80,
                  from tableobject.c:25:
/usr/local/include/python2.5/pyconfig.h:942:1: warning: 
"_POSIX_C_SOURCE" redefined
In file included from /usr/include/sys/types.h:27,
                  from /usr/local/apache2/include/apr.h:116,
                  from /usr/local/apache2/include/ap_config.h:25,
                  from /usr/local/apache2/include/httpd.h:43,
                  from 
/home/mesh/tmp/mod_python-3.3.1/src/include/mod_python.h:42,
                  from tableobject.c:25:
/usr/include/features.h:150:1: warning: this is the location of the 
previous definition
tableobject.c:1092: warning: initialization from incompatible pointer type
/usr/local/apache2/build/libtool --silent --mode=compile gcc -prefer-pic 
   -DLINUX=2 -D_REENTRANT -D_GNU_SOURCE -D_LARGEFILE64_SOURCE -g -O2 
-pthread -I/usr/local/apache2/include  -I/usr/local/apache2/include 
-I/usr/local/apache2/include 
-I/home/mesh/tmp/mod_python-3.3.1/src/include 
-I/usr/local/apache2/include -I/usr/local/include/python2.5  -c -o 
util.lo util.c && touch util.slo
In file included from /usr/local/include/python2.5/Python.h:8,
                  from 
/home/mesh/tmp/mod_python-3.3.1/src/include/mod_python.h:80,
                  from util.c:28:
/usr/local/include/python2.5/pyconfig.h:942:1: warning: 
"_POSIX_C_SOURCE" redefined
In file included from /usr/include/sys/types.h:27,
                  from /usr/local/apache2/include/apr.h:116,
                  from /usr/local/apache2/include/ap_config.h:25,
                  from /usr/local/apache2/include/httpd.h:43,
                  from 
/home/mesh/tmp/mod_python-3.3.1/src/include/mod_python.h:42,
                  from util.c:28:
/usr/include/features.h:150:1: warning: this is the location of the 
previous definition
/usr/local/apache2/build/libtool --silent --mode=compile gcc -prefer-pic 
   -DLINUX=2 -D_REENTRANT -D_GNU_SOURCE -D_LARGEFILE64_SOURCE -g -O2 
-pthread -I/usr/local/apache2/include  -I/usr/local/apache2/include 
-I/usr/local/apache2/include 
-I/home/mesh/tmp/mod_python-3.3.1/src/include 
-I/usr/local/apache2/include -I/usr/local/include/python2.5  -c -o 
serverobject.lo serverobject.c && touch serverobject.slo
In file included from /usr/local/include/python2.5/Python.h:8,
                  from 
/home/mesh/tmp/mod_python-3.3.1/src/include/mod_python.h:80,
                  from serverobject.c:25:
/usr/local/include/python2.5/pyconfig.h:942:1: warning: 
"_POSIX_C_SOURCE" redefined
In file included from /usr/include/sys/types.h:27,
                  from /usr/local/apache2/include/apr.h:116,
                  from /usr/local/apache2/include/ap_config.h:25,
                  from /usr/local/apache2/include/httpd.h:43,
                  from 
/home/mesh/tmp/mod_python-3.3.1/src/include/mod_python.h:42,
                  from serverobject.c:25:
/usr/include/features.h:150:1: warning: this is the location of the 
previous definition
serverobject.c:387: warning: initialization from incompatible pointer type
/usr/local/apache2/build/libtool --silent --mode=compile gcc -prefer-pic 
   -DLINUX=2 -D_REENTRANT -D_GNU_SOURCE -D_LARGEFILE64_SOURCE -g -O2 
-pthread -I/usr/local/apache2/include  -I/usr/local/apache2/include 
-I/usr/local/apache2/include 
-I/home/mesh/tmp/mod_python-3.3.1/src/include 
-I/usr/local/apache2/include -I/usr/local/include/python2.5  -c -o 
connobject.lo connobject.c && touch connobject.slo
In file included from /usr/local/include/python2.5/Python.h:8,
                  from 
/home/mesh/tmp/mod_python-3.3.1/src/include/mod_python.h:80,
                  from connobject.c:30:
/usr/local/include/python2.5/pyconfig.h:942:1: warning: 
"_POSIX_C_SOURCE" redefined
In file included from /usr/include/sys/types.h:27,
                  from /usr/local/apache2/include/apr.h:116,
                  from /usr/local/apache2/include/ap_config.h:25,
                  from /usr/local/apache2/include/httpd.h:43,
                  from 
/home/mesh/tmp/mod_python-3.3.1/src/include/mod_python.h:42,
                  from connobject.c:30:
/usr/include/features.h:150:1: warning: this is the location of the 
previous definition
/usr/local/apache2/build/libtool --silent --mode=compile gcc -prefer-pic 
   -DLINUX=2 -D_REENTRANT -D_GNU_SOURCE -D_LARGEFILE64_SOURCE -g -O2 
-pthread -I/usr/local/apache2/include  -I/usr/local/apache2/include 
-I/usr/local/apache2/include 
-I/home/mesh/tmp/mod_python-3.3.1/src/include 
-I/usr/local/apache2/include -I/usr/local/include/python2.5  -c -o 
filterobject.lo filterobject.c && touch filterobject.slo
In file included from /usr/local/include/python2.5/Python.h:8,
                  from 
/home/mesh/tmp/mod_python-3.3.1/src/include/mod_python.h:80,
                  from filterobject.c:28:
/usr/local/include/python2.5/pyconfig.h:942:1: warning: 
"_POSIX_C_SOURCE" redefined
In file included from /usr/include/sys/types.h:27,
                  from /usr/local/apache2/include/apr.h:116,
                  from /usr/local/apache2/include/ap_config.h:25,
                  from /usr/local/apache2/include/httpd.h:43,
                  from 
/home/mesh/tmp/mod_python-3.3.1/src/include/mod_python.h:42,
                  from filterobject.c:28:
/usr/include/features.h:150:1: warning: this is the location of the 
previous definition
/usr/local/apache2/build/libtool --silent --mode=compile gcc -prefer-pic 
   -DLINUX=2 -D_REENTRANT -D_GNU_SOURCE -D_LARGEFILE64_SOURCE -g -O2 
-pthread -I/usr/local/apache2/include  -I/usr/local/apache2/include 
-I/usr/local/apache2/include 
-I/home/mesh/tmp/mod_python-3.3.1/src/include 
-I/usr/local/apache2/include -I/usr/local/include/python2.5  -c -o 
hlist.lo hlist.c && touch hlist.slo
In file included from /usr/local/include/python2.5/Python.h:8,
                  from 
/home/mesh/tmp/mod_python-3.3.1/src/include/mod_python.h:80,
                  from hlist.c:28:
/usr/local/include/python2.5/pyconfig.h:942:1: warning: 
"_POSIX_C_SOURCE" redefined
In file included from /usr/include/sys/types.h:27,
                  from /usr/local/apache2/include/apr.h:116,
                  from /usr/local/apache2/include/ap_config.h:25,
                  from /usr/local/apache2/include/httpd.h:43,
                  from 
/home/mesh/tmp/mod_python-3.3.1/src/include/mod_python.h:42,
                  from hlist.c:28:
/usr/include/features.h:150:1: warning: this is the location of the 
previous definition
/usr/local/apache2/build/libtool --silent --mode=compile gcc -prefer-pic 
   -DLINUX=2 -D_REENTRANT -D_GNU_SOURCE -D_LARGEFILE64_SOURCE -g -O2 
-pthread -I/usr/local/apache2/include  -I/usr/local/apache2/include 
-I/usr/local/apache2/include 
-I/home/mesh/tmp/mod_python-3.3.1/src/include 
-I/usr/local/apache2/include -I/usr/local/include/python2.5  -c -o 
hlistobject.lo hlistobject.c && touch hlistobject.slo
In file included from /usr/local/include/python2.5/Python.h:8,
                  from 
/home/mesh/tmp/mod_python-3.3.1/src/include/mod_python.h:80,
                  from hlistobject.c:28:
/usr/local/include/python2.5/pyconfig.h:942:1: warning: 
"_POSIX_C_SOURCE" redefined
In file included from /usr/include/sys/types.h:27,
                  from /usr/local/apache2/include/apr.h:116,
                  from /usr/local/apache2/include/ap_config.h:25,
                  from /usr/local/apache2/include/httpd.h:43,
                  from 
/home/mesh/tmp/mod_python-3.3.1/src/include/mod_python.h:42,
                  from hlistobject.c:28:
/usr/include/features.h:150:1: warning: this is the location of the 
previous definition
/usr/local/apache2/build/libtool --silent --mode=compile gcc -prefer-pic 
   -DLINUX=2 -D_REENTRANT -D_GNU_SOURCE -D_LARGEFILE64_SOURCE -g -O2 
-pthread -I/usr/local/apache2/include  -I/usr/local/apache2/include 
-I/usr/local/apache2/include 
-I/home/mesh/tmp/mod_python-3.3.1/src/include 
-I/usr/local/apache2/include -I/usr/local/include/python2.5  -c -o 
finfoobject.lo finfoobject.c && touch finfoobject.slo
In file included from /usr/local/include/python2.5/Python.h:8,
                  from 
/home/mesh/tmp/mod_python-3.3.1/src/include/mod_python.h:80,
                  from finfoobject.c:25:
/usr/local/include/python2.5/pyconfig.h:942:1: warning: 
"_POSIX_C_SOURCE" redefined
In file included from /usr/include/sys/types.h:27,
                  from /usr/local/apache2/include/apr.h:116,
                  from /usr/local/apache2/include/ap_config.h:25,
                  from /usr/local/apache2/include/httpd.h:43,
                  from 
/home/mesh/tmp/mod_python-3.3.1/src/include/mod_python.h:42,
                  from finfoobject.c:25:
/usr/include/features.h:150:1: warning: this is the location of the 
previous definition
finfoobject.c:278: warning: `intargfunc' is deprecated (declared at 
/usr/local/include/python2.5/object.h:133)
/usr/local/apache2/build/libtool --silent --mode=link gcc -o 
mod_python.la  -rpath /usr/local/apache2/modules -module -avoid-version 
    finfoobject.lo hlistobject.lo hlist.lo filterobject.lo connobject.lo 
serverobject.lo util.lo tableobject.lo requestobject.lo _apachemodule.lo 
mod_python.lo -L/usr/local/lib/python2.5/config -Xlinker -export-dynamic 
-lm -lpython2.5 -lpthread -ldl -lutil -lm
/usr/bin/install: cannot stat `src/mod_python.so': No such file or directory
make[1]: *** [install_dso] Error 1
From roberto at connexer.com  Fri Apr 25 19:07:15 2008
From: roberto at connexer.com (Roberto =?iso-8859-1?Q?C=2E_S=E1nchez?=)
Date: Fri Apr 25 19:07:21 2008
Subject: [mod_python] make not building mod_python.so
In-Reply-To: <48125F0D.5080106@gmail.com>
References: <48125F0D.5080106@gmail.com>
Message-ID: <20080425230715.GN1091@connexer.com>

On Fri, Apr 25, 2008 at 03:45:33PM -0700, Mike Chambers wrote:
> I am trying to install mod_python on my debian system, and have hit a 
> roadblock.
> 
> mod_python : 3.3.1
> Python : 2.5.2
> apache : 2.2.8
> 
> 
> ./configure --with-apxs=/usr/local/apache2/bin/apxs
> make
> sudo make install
> 
Why?  Why not use the Debian package?  Both Apache 2.2.8 and MP 3.3.1
are available in Sid (which I am guessing is what you are using based on
your Python version).

Regards,

-Roberto

-- 
Roberto C. S?nchez
http://people.connexer.com/~roberto
http://www.connexer.com
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: Digital signature
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080425/f6e3f2bf/attachment.bin
From mikechambers at gmail.com  Sat Apr 26 03:47:46 2008
From: mikechambers at gmail.com (Mike Chambers)
Date: Sat Apr 26 03:47:54 2008
Subject: [mod_python] make not building mod_python.so
In-Reply-To: <20080425230715.GN1091@connexer.com>
References: <48125F0D.5080106@gmail.com> <20080425230715.GN1091@connexer.com>
Message-ID: <4812DE22.5060705@gmail.com>

fyi, for future reference, there was some problem with the version of 
libtool included with apache 2.2.8

Once I updated it, then I was able to compile the mod.

More info here:

http://groups.google.com/group/modwsgi/browse_thread/thread/e18eb3868570bb3d?hl=en

mike

Roberto C. S?nchez wrote:
> On Fri, Apr 25, 2008 at 03:45:33PM -0700, Mike Chambers wrote:
>> I am trying to install mod_python on my debian system, and have hit a 
>> roadblock.
>>
>> mod_python : 3.3.1
>> Python : 2.5.2
>> apache : 2.2.8
>>
>>
>> ./configure --with-apxs=/usr/local/apache2/bin/apxs
>> make
>> sudo make install
>>
> Why?  Why not use the Debian package?  Both Apache 2.2.8 and MP 3.3.1
> are available in Sid (which I am guessing is what you are using based on
> your Python version).
> 
> Regards,
> 
> -Roberto
> 
From herbert.poul at gmail.com  Sun Apr 27 16:18:56 2008
From: herbert.poul at gmail.com (Herbert Poul)
Date: Sun Apr 27 16:19:06 2008
Subject: [mod_python] deadlock when using mod_python + simplified GIL - e.g.
	swig wrapper of xapian (MODPYTHON-217)
Message-ID: <9e6af55b0804271318l37664029jb9ec51d67fc6eccc@mail.gmail.com>

hi,

i stumbled across a problem which has been reported a year ago called
"Python 2.3 and simplified GIL state API still causes problems.":
http://issues.apache.org/jira/browse/MODPYTHON-217
and wondered if there are any plans to fix it or any known workarounds.

in short: i am trying to get the python wrapper of xapian (based on
swig, which in turn uses simplified GIL api) working in mod_python -
but every call to this C extension ends in a deadlock.

it seems this problem arises because of the combination of mod_python
using PyEval_AcquireLock and the SWIG wrapper using simplified GIL
(PyGILState_Ensure)

is this actually anything that needs fixing in mod_python, or in the
python wrapper/SWIG ?
i would appreciate any pointers. (i have already tried using
'PythonInterpreter main_interpreter' but it doesn't help)

thanks & cu,
  herbert

P.S.: i am using apache 2.2.4 / mod_python 3.3.1 / python 2.5.1 - see
attachment for the backtrace of the deadlock.
P.P.S.: there is also a bug report for xapian because of this:
http://trac.xapian.org/ticket/185
-------------- next part --------------
(gdb) bt
#0  0xb7d2d279 in sem_wait@GLIBC_2.0 () from /lib/libpthread.so.0
#1  0xb759c06e in PyThread_acquire_lock () from /usr/lib/libpython2.5.so.1.0
#2  0xb756ab87 in PyEval_RestoreThread () from /usr/lib/libpython2.5.so.1.0
#3  0xb7591886 in PyGILState_Ensure () from /usr/lib/libpython2.5.so.1.0
#4  0xb63b99c6 in _wrap_new_Database (self=0x0, args=0x91415cc) at modern/xapian_wrap.cc:909
#5  0xb752341d in PyCFunction_Call () from /usr/lib/libpython2.5.so.1.0
#6  0xb74ed7b7 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#7  0xb756ed1b in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#8  0xb7571fc4 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#9  0xb750f65a in PyClassMethod_New () from /usr/lib/libpython2.5.so.1.0
#10 0xb74ed7b7 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#11 0xb74f4fb5 in PyClass_IsSubclass () from /usr/lib/libpython2.5.so.1.0
#12 0xb74ed7b7 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#13 0xb7538bfe in _PyType_Lookup () from /usr/lib/libpython2.5.so.1.0
#14 0xb7537f85 in PyType_IsSubtype () from /usr/lib/libpython2.5.so.1.0
#15 0xb74ed7b7 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#16 0xb756c15c in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#17 0xb7571fc4 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#18 0xb7570433 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#19 0xb7571fc4 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#20 0xb7570433 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#21 0xb7571fc4 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#22 0xb750f730 in PyClassMethod_New () from /usr/lib/libpython2.5.so.1.0
#23 0xb74ed7b7 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#24 0xb756ed1b in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#25 0xb7570b00 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#26 0xb7571fc4 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#27 0xb750f65a in PyClassMethod_New () from /usr/lib/libpython2.5.so.1.0
#28 0xb74ed7b7 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#29 0xb74f4fb5 in PyClass_IsSubclass () from /usr/lib/libpython2.5.so.1.0
#30 0xb74ed7b7 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#31 0xb7538fb9 in _PyType_Lookup () from /usr/lib/libpython2.5.so.1.0
#32 0xb74ed7b7 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#33 0xb756c15c in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
---Type <return> to continue, or q <return> to quit---
#34 0xb7570b00 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#35 0xb7570b00 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#36 0xb7571fc4 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#37 0xb7570433 in PyEval_EvalFrameEx () from /usr/lib/libpython2.5.so.1.0
#38 0xb7571fc4 in PyEval_EvalCodeEx () from /usr/lib/libpython2.5.so.1.0
#39 0xb750f65a in PyClassMethod_New () from /usr/lib/libpython2.5.so.1.0
#40 0xb74ed7b7 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#41 0xb74f4fb5 in PyClass_IsSubclass () from /usr/lib/libpython2.5.so.1.0
#42 0xb74ed7b7 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#43 0xb74eda33 in PyObject_Call () from /usr/lib/libpython2.5.so.1.0
#44 0xb74efde2 in PyObject_CallMethod () from /usr/lib/libpython2.5.so.1.0
#45 0xb761b7e9 in python_handler () from /usr/lib/apache2/modules/mod_python.so
#46 0xb761dcb4 in PythonHandler () from /usr/lib/apache2/modules/mod_python.so
#47 0x08078ec9 in ap_run_handler ()
#48 0x0807c0d7 in ap_invoke_handler ()
#49 0x080891c8 in ap_process_request ()
#50 0x080864cb in ap_register_input_filter ()
#51 0x0807fe79 in ap_run_process_connection ()
#52 0x0808d0d0 in ap_graceful_stop_signalled ()
#53 0x0808d3c7 in ap_graceful_stop_signalled ()
#54 0x0808d484 in ap_graceful_stop_signalled ()
#55 0x0808df09 in ap_mpm_run ()
#56 0x08066c85 in main ()
From graham.dumpleton at gmail.com  Sun Apr 27 17:34:52 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sun Apr 27 17:34:58 2008
Subject: [mod_python] deadlock when using mod_python + simplified GIL -
	e.g. swig wrapper of xapian (MODPYTHON-217)
In-Reply-To: <9e6af55b0804271318l37664029jb9ec51d67fc6eccc@mail.gmail.com>
References: <9e6af55b0804271318l37664029jb9ec51d67fc6eccc@mail.gmail.com>
Message-ID: <88e286470804271434t70396a82j1a20eaa8d6c58b2c@mail.gmail.com>

2008/4/28 Herbert Poul <herbert.poul@gmail.com>:
> hi,
>
>  i stumbled across a problem which has been reported a year ago called
>  "Python 2.3 and simplified GIL state API still causes problems.":
>  http://issues.apache.org/jira/browse/MODPYTHON-217
>  and wondered if there are any plans to fix it or any known workarounds.
>
>  in short: i am trying to get the python wrapper of xapian (based on
>  swig, which in turn uses simplified GIL api) working in mod_python -
>  but every call to this C extension ends in a deadlock.
>
>  it seems this problem arises because of the combination of mod_python
>  using PyEval_AcquireLock and the SWIG wrapper using simplified GIL
>  (PyGILState_Ensure)
>
>  is this actually anything that needs fixing in mod_python, or in the
>  python wrapper/SWIG ?
>  i would appreciate any pointers. (i have already tried using
>  'PythonInterpreter main_interpreter' but it doesn't help)

Yes, mod_python needs fixing. It needs to detect when main interpreter
being used and use simplified GLI state API methods instead of
traditional thread state API.

Is your Python web application specifically written to mod_python API
or are you using some sort of web framework that uses WSGI as server
interface. If WSGI capable, you can use mod_wsgi instead, which
doesn't have this problem, although you still need to force web
application to run in main interpreter.

Graham
From emyr.thomas at gmail.com  Mon Apr 28 09:55:27 2008
From: emyr.thomas at gmail.com (Emyr Thomas)
Date: Mon Apr 28 10:15:10 2008
Subject: [mod_python] Re: Problem with mod_proxy + inputfilter + headers_in
References: <e79469d0704190821x12a0ffa9ve94e9d13e37898e6@mail.gmail.com>
	<88e286470704191453o5b0b3c08u77b14064c1f58950@mail.gmail.com>
Message-ID: <fv4l0s$5ee$1@ger.gmane.org>

Graham, out of interest, has this always been the case with mod_python, or 
was this behavious introduced in a particular release?

Thanks

--Emyr

"Graham Dumpleton" 
<graham.dumpleton@gmail.com> wrote in message 
news:88e286470704191453o5b0b3c08u77b14064c1f58950@mail.gmail.com...
> You can't use a mod_python input filter to modify incoming headers. If
> the changes to the headers aren't intended to influence the behaviour
> of what Apache does during access, authentication, authorisation and
> type checking phases, use a PythonFixupHandler to update any headers
> to then be used by the actual response handler.
>
> Note, provided you are using mod_python 3.3, you can actually use
> mod_python to trigger the proxying as well. See:
>
> http://issues.apache.org/jira/browse/MODPYTHON-141
>
> Graham
>
> On 20/04/07, indyone ;o) <indyone@gmail.com> 
> wrote:
>> Hi list,
>>
>> I'm trying to get the headers_in from the client, and after 
>> changing/adding
>> some headers i would like to pass them to the backend server.
>> I'm using Apache/2.0.55 (Win32) mod_python/3.1.3 Python/2.3.5
>> The problem is that the headers are sent to the backend unchanged when 
>> using
>> this simple input filter:
>>
>> def inputfilter(filter):
>>
>>     filter.req.headers_in['X-MyHeader'] = 'Test'
>>     if filter.req.main is not None:
>>         filter.pass_on()
>>         return
>>
>>     filter.req.log_error('Start %s' % filter.req.uri)
>>     s = filter.read()
>>     while s:
>>         filter.write(s)
>>         s = filter.read()
>>     if s is None:
>>         filter.close()
>>         filter.req.log_error('End %s' % filter.req.uri)
>>
>>     filter.req.log_error('%s' % filter.req.headers_in)
>>
>> and Apache logs:
>>
>> [Thu Apr 19 18:17:28 2007] [error] [client 127.0.0.1] Start /, referer:
>> http://localhost/
>> [Thu Apr 19 18:17:28 2007] [error] [client 127.0.0.1] End /, referer:
>> http://localhost/
>> [Thu Apr 19 18:17:28 2007] [error] [client 127.0.0.1] {'X-MyHeader': 
>> 'Test',
>> 'X-Forwarded-Server': 'luna', 'X-Forwarded-Host': 'localhost',
>> 'X-Forwarded-For': ' 127.0.0.1', 'Max-Forwards': '10', 'Cookie': 
>> 'wstyle=;
>> __ac="YWRtaW46bWF0cml4";
>> tree-s="eJzT0MgpMOQKVneEAKcAN19bda4CI67EkgJjLj0AegYHmA"',
>> 'Referer': ' http://localhost/', 'Accept-Charset':
>> 'ISO-8859-7,utf-8;q=0.7,*;q=0.7', 'Accept-Encoding': 'gzip,deflate',
>> 'Accept-Language': 'el,en-us;q=0.7 ,en;q=0.3', 'Accept':
>> 'text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5',
>> 'User-Agent': 'Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv: 
>> 1.8.0.8)
>> Gecko/20061030 SeaMonkey/1.0.6', 'Host': 'localhost'}, referer:
>> http://localhost/
>> ...(multiple times)...
>>
>> Which is right i think... But my backend server gets this request:
>>
>> GET
>> /VirtualHostBase/http/localhost:80/Editorial/VirtualHostRoot/
>> HTTP/1.1
>> Host: localhost:8081
>> User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.0.8)
>> Gecko/20061030 SeaMonkey/1.0.6
>> Accept:
>> text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5
>> Accept-Language: el,en-us;q=0.7,en;q=0.3
>> Accept-Encoding: gzip,deflate
>> Accept-Charset: ISO-8859-7,utf-8;q= 0.7,*;q=0.7
>> Referer: http://localhost/
>> Cookie: wstyle=; __ac="YWRtaW46bWF0cml4";
>> tree-s="eJzT0MgpMOQKVneEAKcAN19bda4CI67EkgJjLj0AegYHmA"
>> Max-Forwards: 10
>> X-Forwarded-For: 127.0.0.1
>> X-Forwarded-Host: localhost
>> X-Forwarded-Server: luna
>>
>> Thank you in advance,
>>
>> Ioannis Stavrinos
>>
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>
>> 



From jmcKamey at neatreceipts.com  Mon Apr 28 10:46:41 2008
From: jmcKamey at neatreceipts.com (Jon McKamey)
Date: Mon Apr 28 10:44:59 2008
Subject: [mod_python] Post of image data
Message-ID: <45E36921B695A14FA56A34F29424A1EC011F9D5F@Apollo.neatreceipts.local>

Hey folks,

I'm working on a project using mod_python, and for the most part I'm
pretty happy with it, it rocks.  However I'm having some problems
getting raw data via POST and a form.  The thread at
http://www.modpython.org/pipermail/mod_python/2007-December/024547.html
helped a lot, but I can't seem to get the last piece in place. 

 

If anyone can drop a simple example of an HTML page to go with the rest
of that example, it would be a huge help.  I'm sure there is something
simple with the HTML form ACTION or METHOD that I'm missing, but I just
can't get an example to work.  

 

Thanks in advance for the help

 

-jmck

 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080428/a995a404/attachment.html
From graham.dumpleton at gmail.com  Mon Apr 28 17:02:08 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon Apr 28 17:02:15 2008
Subject: [mod_python] Re: Problem with mod_proxy + inputfilter + headers_in
In-Reply-To: <fv4l0s$5ee$1@ger.gmane.org>
References: <e79469d0704190821x12a0ffa9ve94e9d13e37898e6@mail.gmail.com>
	<88e286470704191453o5b0b3c08u77b14064c1f58950@mail.gmail.com>
	<fv4l0s$5ee$1@ger.gmane.org>
Message-ID: <88e286470804281402r6c51f2ccxc5ac9ffb69c446d@mail.gmail.com>

2008/4/28 Emyr Thomas <emyr.thomas@gmail.com>:
> Graham, out of interest, has this always been the case with mod_python, or
>  was this behavious introduced in a particular release?

This is nothing to do with mod_python, it is how underlying Apache C
APIs work. It has always been this way. If you have seen it behave any
other way, it would have been by luck due to calling sequences and not
guaranteed.

Suggest you dig through:

 http://www.fmc-modeling.org/category/projects/apache/amp/Apache_Modeling_Project.html

to get a better understanding of how Apache works internally.

Graham

>  "Graham Dumpleton"
>  <graham.dumpleton@gmail.com> wrote in message
>  news:88e286470704191453o5b0b3c08u77b14064c1f58950@mail.gmail.com...
>
>
> > You can't use a mod_python input filter to modify incoming headers. If
>  > the changes to the headers aren't intended to influence the behaviour
>  > of what Apache does during access, authentication, authorisation and
>  > type checking phases, use a PythonFixupHandler to update any headers
>  > to then be used by the actual response handler.
>  >
>  > Note, provided you are using mod_python 3.3, you can actually use
>  > mod_python to trigger the proxying as well. See:
>  >
>  > http://issues.apache.org/jira/browse/MODPYTHON-141
>  >
>  > Graham
>  >
>  > On 20/04/07, indyone ;o) <indyone@gmail.com>
>  > wrote:
>  >> Hi list,
>  >>
>  >> I'm trying to get the headers_in from the client, and after
>  >> changing/adding
>  >> some headers i would like to pass them to the backend server.
>  >> I'm using Apache/2.0.55 (Win32) mod_python/3.1.3 Python/2.3.5
>  >> The problem is that the headers are sent to the backend unchanged when
>  >> using
>  >> this simple input filter:
>  >>
>  >> def inputfilter(filter):
>  >>
>  >>     filter.req.headers_in['X-MyHeader'] = 'Test'
>  >>     if filter.req.main is not None:
>  >>         filter.pass_on()
>  >>         return
>  >>
>  >>     filter.req.log_error('Start %s' % filter.req.uri)
>  >>     s = filter.read()
>  >>     while s:
>  >>         filter.write(s)
>  >>         s = filter.read()
>  >>     if s is None:
>  >>         filter.close()
>  >>         filter.req.log_error('End %s' % filter.req.uri)
>  >>
>  >>     filter.req.log_error('%s' % filter.req.headers_in)
>  >>
>  >> and Apache logs:
>  >>
>  >> [Thu Apr 19 18:17:28 2007] [error] [client 127.0.0.1] Start /, referer:
>  >> http://localhost/
>  >> [Thu Apr 19 18:17:28 2007] [error] [client 127.0.0.1] End /, referer:
>  >> http://localhost/
>  >> [Thu Apr 19 18:17:28 2007] [error] [client 127.0.0.1] {'X-MyHeader':
>  >> 'Test',
>  >> 'X-Forwarded-Server': 'luna', 'X-Forwarded-Host': 'localhost',
>  >> 'X-Forwarded-For': ' 127.0.0.1', 'Max-Forwards': '10', 'Cookie':
>  >> 'wstyle=;
>  >> __ac="YWRtaW46bWF0cml4";
>  >> tree-s="eJzT0MgpMOQKVneEAKcAN19bda4CI67EkgJjLj0AegYHmA"',
>  >> 'Referer': ' http://localhost/', 'Accept-Charset':
>  >> 'ISO-8859-7,utf-8;q=0.7,*;q=0.7', 'Accept-Encoding': 'gzip,deflate',
>  >> 'Accept-Language': 'el,en-us;q=0.7 ,en;q=0.3', 'Accept':
>  >> 'text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5',
>  >> 'User-Agent': 'Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:
>  >> 1.8.0.8)
>  >> Gecko/20061030 SeaMonkey/1.0.6', 'Host': 'localhost'}, referer:
>  >> http://localhost/
>  >> ...(multiple times)...
>  >>
>  >> Which is right i think... But my backend server gets this request:
>  >>
>  >> GET
>  >> /VirtualHostBase/http/localhost:80/Editorial/VirtualHostRoot/
>  >> HTTP/1.1
>  >> Host: localhost:8081
>  >> User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.0.8)
>  >> Gecko/20061030 SeaMonkey/1.0.6
>  >> Accept:
>  >> text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5
>  >> Accept-Language: el,en-us;q=0.7,en;q=0.3
>  >> Accept-Encoding: gzip,deflate
>  >> Accept-Charset: ISO-8859-7,utf-8;q= 0.7,*;q=0.7
>  >> Referer: http://localhost/
>  >> Cookie: wstyle=; __ac="YWRtaW46bWF0cml4";
>  >> tree-s="eJzT0MgpMOQKVneEAKcAN19bda4CI67EkgJjLj0AegYHmA"
>  >> Max-Forwards: 10
>  >> X-Forwarded-For: 127.0.0.1
>  >> X-Forwarded-Host: localhost
>  >> X-Forwarded-Server: luna
>  >>
>  >> Thank you in advance,
>  >>
>  >> Ioannis Stavrinos
>  >>
>  >> _______________________________________________
>  >> Mod_python mailing list
>  >> Mod_python@modpython.org
>  >> http://mailman.modpython.org/mailman/listinfo/mod_python
>  >>
>  >>
>
>
>
>  _______________________________________________
>  Mod_python mailing list
>  Mod_python@modpython.org
>  http://mailman.modpython.org/mailman/listinfo/mod_python
>
From graham.dumpleton at gmail.com  Mon Apr 28 17:09:36 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon Apr 28 17:09:41 2008
Subject: [mod_python] Re: Problem with mod_proxy + inputfilter + headers_in
In-Reply-To: <88e286470804281402r6c51f2ccxc5ac9ffb69c446d@mail.gmail.com>
References: <e79469d0704190821x12a0ffa9ve94e9d13e37898e6@mail.gmail.com>
	<88e286470704191453o5b0b3c08u77b14064c1f58950@mail.gmail.com>
	<fv4l0s$5ee$1@ger.gmane.org>
	<88e286470804281402r6c51f2ccxc5ac9ffb69c446d@mail.gmail.com>
Message-ID: <88e286470804281409g238ccec9vc142fba258e8105e@mail.gmail.com>

Sorry, one mistake I did make, was that you need earlier handler than
PythonFixupHandler if you want to affect access, authentication,
authorisation phases. Point is though that you can't do it in a
mod_python input filter as they only get triggered when content is
being read and after headers have been processed. There are input
filters that can process headers, but mod_python doesn't provide
access to writing them.

Graham

2008/4/29 Graham Dumpleton <graham.dumpleton@gmail.com>:
> 2008/4/28 Emyr Thomas <emyr.thomas@gmail.com>:
>
> > Graham, out of interest, has this always been the case with mod_python, or
>  >  was this behavious introduced in a particular release?
>
>  This is nothing to do with mod_python, it is how underlying Apache C
>  APIs work. It has always been this way. If you have seen it behave any
>  other way, it would have been by luck due to calling sequences and not
>  guaranteed.
>
>  Suggest you dig through:
>
>   http://www.fmc-modeling.org/category/projects/apache/amp/Apache_Modeling_Project.html
>
>  to get a better understanding of how Apache works internally.
>
>  Graham
>
>
>
>  >  "Graham Dumpleton"
>  >  <graham.dumpleton@gmail.com> wrote in message
>  >  news:88e286470704191453o5b0b3c08u77b14064c1f58950@mail.gmail.com...
>  >
>  >
>  > > You can't use a mod_python input filter to modify incoming headers. If
>  >  > the changes to the headers aren't intended to influence the behaviour
>  >  > of what Apache does during access, authentication, authorisation and
>  >  > type checking phases, use a PythonFixupHandler to update any headers
>  >  > to then be used by the actual response handler.
>  >  >
>  >  > Note, provided you are using mod_python 3.3, you can actually use
>  >  > mod_python to trigger the proxying as well. See:
>  >  >
>  >  > http://issues.apache.org/jira/browse/MODPYTHON-141
>  >  >
>  >  > Graham
>  >  >
>  >  > On 20/04/07, indyone ;o) <indyone@gmail.com>
>  >  > wrote:
>  >  >> Hi list,
>  >  >>
>  >  >> I'm trying to get the headers_in from the client, and after
>  >  >> changing/adding
>  >  >> some headers i would like to pass them to the backend server.
>  >  >> I'm using Apache/2.0.55 (Win32) mod_python/3.1.3 Python/2.3.5
>  >  >> The problem is that the headers are sent to the backend unchanged when
>  >  >> using
>  >  >> this simple input filter:
>  >  >>
>  >  >> def inputfilter(filter):
>  >  >>
>  >  >>     filter.req.headers_in['X-MyHeader'] = 'Test'
>  >  >>     if filter.req.main is not None:
>  >  >>         filter.pass_on()
>  >  >>         return
>  >  >>
>  >  >>     filter.req.log_error('Start %s' % filter.req.uri)
>  >  >>     s = filter.read()
>  >  >>     while s:
>  >  >>         filter.write(s)
>  >  >>         s = filter.read()
>  >  >>     if s is None:
>  >  >>         filter.close()
>  >  >>         filter.req.log_error('End %s' % filter.req.uri)
>  >  >>
>  >  >>     filter.req.log_error('%s' % filter.req.headers_in)
>  >  >>
>  >  >> and Apache logs:
>  >  >>
>  >  >> [Thu Apr 19 18:17:28 2007] [error] [client 127.0.0.1] Start /, referer:
>  >  >> http://localhost/
>  >  >> [Thu Apr 19 18:17:28 2007] [error] [client 127.0.0.1] End /, referer:
>  >  >> http://localhost/
>  >  >> [Thu Apr 19 18:17:28 2007] [error] [client 127.0.0.1] {'X-MyHeader':
>  >  >> 'Test',
>  >  >> 'X-Forwarded-Server': 'luna', 'X-Forwarded-Host': 'localhost',
>  >  >> 'X-Forwarded-For': ' 127.0.0.1', 'Max-Forwards': '10', 'Cookie':
>  >  >> 'wstyle=;
>  >  >> __ac="YWRtaW46bWF0cml4";
>  >  >> tree-s="eJzT0MgpMOQKVneEAKcAN19bda4CI67EkgJjLj0AegYHmA"',
>  >  >> 'Referer': ' http://localhost/', 'Accept-Charset':
>  >  >> 'ISO-8859-7,utf-8;q=0.7,*;q=0.7', 'Accept-Encoding': 'gzip,deflate',
>  >  >> 'Accept-Language': 'el,en-us;q=0.7 ,en;q=0.3', 'Accept':
>  >  >> 'text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5',
>  >  >> 'User-Agent': 'Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:
>  >  >> 1.8.0.8)
>  >  >> Gecko/20061030 SeaMonkey/1.0.6', 'Host': 'localhost'}, referer:
>  >  >> http://localhost/
>  >  >> ...(multiple times)...
>  >  >>
>  >  >> Which is right i think... But my backend server gets this request:
>  >  >>
>  >  >> GET
>  >  >> /VirtualHostBase/http/localhost:80/Editorial/VirtualHostRoot/
>  >  >> HTTP/1.1
>  >  >> Host: localhost:8081
>  >  >> User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.0.8)
>  >  >> Gecko/20061030 SeaMonkey/1.0.6
>  >  >> Accept:
>  >  >> text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5
>  >  >> Accept-Language: el,en-us;q=0.7,en;q=0.3
>  >  >> Accept-Encoding: gzip,deflate
>  >  >> Accept-Charset: ISO-8859-7,utf-8;q= 0.7,*;q=0.7
>  >  >> Referer: http://localhost/
>  >  >> Cookie: wstyle=; __ac="YWRtaW46bWF0cml4";
>  >  >> tree-s="eJzT0MgpMOQKVneEAKcAN19bda4CI67EkgJjLj0AegYHmA"
>  >  >> Max-Forwards: 10
>  >  >> X-Forwarded-For: 127.0.0.1
>  >  >> X-Forwarded-Host: localhost
>  >  >> X-Forwarded-Server: luna
>  >  >>
>  >  >> Thank you in advance,
>  >  >>
>  >  >> Ioannis Stavrinos
>  >  >>
>  >  >> _______________________________________________
>  >  >> Mod_python mailing list
>  >  >> Mod_python@modpython.org
>  >  >> http://mailman.modpython.org/mailman/listinfo/mod_python
>  >  >>
>  >  >>
>  >
>  >
>  >
>  >  _______________________________________________
>  >  Mod_python mailing list
>  >  Mod_python@modpython.org
>  >  http://mailman.modpython.org/mailman/listinfo/mod_python
>  >
>
From graham.dumpleton at gmail.com  Mon Apr 28 18:04:21 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon Apr 28 18:04:28 2008
Subject: [mod_python] Post of image data
In-Reply-To: <45E36921B695A14FA56A34F29424A1EC011F9D5F@Apollo.neatreceipts.local>
References: <45E36921B695A14FA56A34F29424A1EC011F9D5F@Apollo.neatreceipts.local>
Message-ID: <88e286470804281504k4183e8d7y77f71d6a7bd209b5@mail.gmail.com>

You don't say whether you are using raw mod_python handlers or
mod_python.publisher.

For mod_python.publisher, see:

  http://webpython.codepoint.net/mod_python_publisher_forms

Graham

2008/4/29 Jon McKamey <jmcKamey@neatreceipts.com>:
>
>
>
>
> Hey folks,
>
> I'm working on a project using mod_python, and for the most part I'm pretty
> happy with it, it rocks.  However I'm having some problems getting raw data
> via POST and a form.  The thread at
> http://www.modpython.org/pipermail/mod_python/2007-December/024547.html
> helped a lot, but I can't seem to get the last piece in place.
>
>
>
> If anyone can drop a simple example of an HTML page to go with the rest of
> that example, it would be a huge help.  I'm sure there is something simple
> with the HTML form ACTION or METHOD that I'm missing, but I just can't get
> an example to work.
>
>
>
> Thanks in advance for the help
>
>
>
> -jmck
>
>
>
>
> _______________________________________________
>  Mod_python mailing list
>  Mod_python@modpython.org
>  http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
From emyr.thomas at gmail.com  Tue Apr 29 05:15:37 2008
From: emyr.thomas at gmail.com (Emyr Thomas)
Date: Tue Apr 29 05:15:52 2008
Subject: [mod_python] Re: Problem with mod_proxy + inputfilter + headers_in
In-Reply-To: <88e286470804281409g238ccec9vc142fba258e8105e@mail.gmail.com>
References: <e79469d0704190821x12a0ffa9ve94e9d13e37898e6@mail.gmail.com>
	<88e286470704191453o5b0b3c08u77b14064c1f58950@mail.gmail.com>
	<fv4l0s$5ee$1@ger.gmane.org>
	<88e286470804281402r6c51f2ccxc5ac9ffb69c446d@mail.gmail.com>
	<88e286470804281409g238ccec9vc142fba258e8105e@mail.gmail.com>
Message-ID: <8fb874820804290215l71dcd9afjd39f86f683d4e34b@mail.gmail.com>

Thanks for the pointer to the docs Graham - those look very helpful.
I'll do my best to read them.

So in the case of tramline[1], the 'tramline' header which is being
set in the finalizeInput[2] method (which is called from a
PythonInputFilter) will never make it to the back end? This is indeed
the behaviour I am seeing. What would be the correct way to set this
header?

[1] http://codespeak.net/svn/rr/tramline/trunk/README.txt
[2] http://codespeak.net/svn/rr/tramline/trunk/src/tramline/core.py

Thank you so much for your help (and your patience!)

--Emyr

On Mon, Apr 28, 2008 at 10:09 PM, Graham Dumpleton
<graham.dumpleton@gmail.com> wrote:
> Sorry, one mistake I did make, was that you need earlier handler than
>  PythonFixupHandler if you want to affect access, authentication,
>  authorisation phases. Point is though that you can't do it in a
>  mod_python input filter as they only get triggered when content is
>  being read and after headers have been processed. There are input
>  filters that can process headers, but mod_python doesn't provide
>  access to writing them.
>
>  Graham
>
>  2008/4/29 Graham Dumpleton <graham.dumpleton@gmail.com>:
>
>
> > 2008/4/28 Emyr Thomas <emyr.thomas@gmail.com>:
>  >
>  > > Graham, out of interest, has this always been the case with mod_python, or
>  >  >  was this behavious introduced in a particular release?
>  >
>  >  This is nothing to do with mod_python, it is how underlying Apache C
>  >  APIs work. It has always been this way. If you have seen it behave any
>  >  other way, it would have been by luck due to calling sequences and not
>  >  guaranteed.
>  >
>  >  Suggest you dig through:
>  >
>  >   http://www.fmc-modeling.org/category/projects/apache/amp/Apache_Modeling_Project.html
>  >
>  >  to get a better understanding of how Apache works internally.
>  >
>  >  Graham
>  >
>  >
>  >
>  >  >  "Graham Dumpleton"
>  >  >  <graham.dumpleton@gmail.com> wrote in message
>  >  >  news:88e286470704191453o5b0b3c08u77b14064c1f58950@mail.gmail.com...
>  >  >
>  >  >
>  >  > > You can't use a mod_python input filter to modify incoming headers. If
>  >  >  > the changes to the headers aren't intended to influence the behaviour
>  >  >  > of what Apache does during access, authentication, authorisation and
>  >  >  > type checking phases, use a PythonFixupHandler to update any headers
>  >  >  > to then be used by the actual response handler.
>  >  >  >
>  >  >  > Note, provided you are using mod_python 3.3, you can actually use
>  >  >  > mod_python to trigger the proxying as well. See:
>  >  >  >
>  >  >  > http://issues.apache.org/jira/browse/MODPYTHON-141
>  >  >  >
>  >  >  > Graham
>  >  >  >
>  >  >  > On 20/04/07, indyone ;o) <indyone@gmail.com>
>  >  >  > wrote:
>  >  >  >> Hi list,
>  >  >  >>
>  >  >  >> I'm trying to get the headers_in from the client, and after
>  >  >  >> changing/adding
>  >  >  >> some headers i would like to pass them to the backend server.
>  >  >  >> I'm using Apache/2.0.55 (Win32) mod_python/3.1.3 Python/2.3.5
>  >  >  >> The problem is that the headers are sent to the backend unchanged when
>  >  >  >> using
>  >  >  >> this simple input filter:
>  >  >  >>
>  >  >  >> def inputfilter(filter):
>  >  >  >>
>  >  >  >>     filter.req.headers_in['X-MyHeader'] = 'Test'
>  >  >  >>     if filter.req.main is not None:
>  >  >  >>         filter.pass_on()
>  >  >  >>         return
>  >  >  >>
>  >  >  >>     filter.req.log_error('Start %s' % filter.req.uri)
>  >  >  >>     s = filter.read()
>  >  >  >>     while s:
>  >  >  >>         filter.write(s)
>  >  >  >>         s = filter.read()
>  >  >  >>     if s is None:
>  >  >  >>         filter.close()
>  >  >  >>         filter.req.log_error('End %s' % filter.req.uri)
>  >  >  >>
>  >  >  >>     filter.req.log_error('%s' % filter.req.headers_in)
>  >  >  >>
>  >  >  >> and Apache logs:
>  >  >  >>
>  >  >  >> [Thu Apr 19 18:17:28 2007] [error] [client 127.0.0.1] Start /, referer:
>  >  >  >> http://localhost/
>  >  >  >> [Thu Apr 19 18:17:28 2007] [error] [client 127.0.0.1] End /, referer:
>  >  >  >> http://localhost/
>  >  >  >> [Thu Apr 19 18:17:28 2007] [error] [client 127.0.0.1] {'X-MyHeader':
>  >  >  >> 'Test',
>  >  >  >> 'X-Forwarded-Server': 'luna', 'X-Forwarded-Host': 'localhost',
>  >  >  >> 'X-Forwarded-For': ' 127.0.0.1', 'Max-Forwards': '10', 'Cookie':
>  >  >  >> 'wstyle=;
>  >  >  >> __ac="YWRtaW46bWF0cml4";
>  >  >  >> tree-s="eJzT0MgpMOQKVneEAKcAN19bda4CI67EkgJjLj0AegYHmA"',
>  >  >  >> 'Referer': ' http://localhost/', 'Accept-Charset':
>  >  >  >> 'ISO-8859-7,utf-8;q=0.7,*;q=0.7', 'Accept-Encoding': 'gzip,deflate',
>  >  >  >> 'Accept-Language': 'el,en-us;q=0.7 ,en;q=0.3', 'Accept':
>  >  >  >> 'text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5',
>  >  >  >> 'User-Agent': 'Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:
>  >  >  >> 1.8.0.8)
>  >  >  >> Gecko/20061030 SeaMonkey/1.0.6', 'Host': 'localhost'}, referer:
>  >  >  >> http://localhost/
>  >  >  >> ...(multiple times)...
>  >  >  >>
>  >  >  >> Which is right i think... But my backend server gets this request:
>  >  >  >>
>  >  >  >> GET
>  >  >  >> /VirtualHostBase/http/localhost:80/Editorial/VirtualHostRoot/
>  >  >  >> HTTP/1.1
>  >  >  >> Host: localhost:8081
>  >  >  >> User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.0.8)
>  >  >  >> Gecko/20061030 SeaMonkey/1.0.6
>  >  >  >> Accept:
>  >  >  >> text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5
>  >  >  >> Accept-Language: el,en-us;q=0.7,en;q=0.3
>  >  >  >> Accept-Encoding: gzip,deflate
>  >  >  >> Accept-Charset: ISO-8859-7,utf-8;q= 0.7,*;q=0.7
>  >  >  >> Referer: http://localhost/
>  >  >  >> Cookie: wstyle=; __ac="YWRtaW46bWF0cml4";
>  >  >  >> tree-s="eJzT0MgpMOQKVneEAKcAN19bda4CI67EkgJjLj0AegYHmA"
>  >  >  >> Max-Forwards: 10
>  >  >  >> X-Forwarded-For: 127.0.0.1
>  >  >  >> X-Forwarded-Host: localhost
>  >  >  >> X-Forwarded-Server: luna
>  >  >  >>
>  >  >  >> Thank you in advance,
>  >  >  >>
>  >  >  >> Ioannis Stavrinos
>  >  >  >>
>  >  >  >> _______________________________________________
>  >  >  >> Mod_python mailing list
>  >  >  >> Mod_python@modpython.org
>  >  >  >> http://mailman.modpython.org/mailman/listinfo/mod_python
>  >  >  >>
>  >  >  >>
>  >  >
>  >  >
>  >  >
>  >  >  _______________________________________________
>  >  >  Mod_python mailing list
>  >  >  Mod_python@modpython.org
>  >  >  http://mailman.modpython.org/mailman/listinfo/mod_python
>  >  >
>  >
>
From graham.dumpleton at gmail.com  Tue Apr 29 06:26:02 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue Apr 29 06:26:08 2008
Subject: [mod_python] Re: Problem with mod_proxy + inputfilter + headers_in
In-Reply-To: <8fb874820804290215l71dcd9afjd39f86f683d4e34b@mail.gmail.com>
References: <e79469d0704190821x12a0ffa9ve94e9d13e37898e6@mail.gmail.com>
	<88e286470704191453o5b0b3c08u77b14064c1f58950@mail.gmail.com>
	<fv4l0s$5ee$1@ger.gmane.org>
	<88e286470804281402r6c51f2ccxc5ac9ffb69c446d@mail.gmail.com>
	<88e286470804281409g238ccec9vc142fba258e8105e@mail.gmail.com>
	<8fb874820804290215l71dcd9afjd39f86f683d4e34b@mail.gmail.com>
Message-ID: <88e286470804290326s691ebceas83223500c968bc29@mail.gmail.com>

2008/4/29 Emyr Thomas <emyr.thomas@gmail.com>:
> Thanks for the pointer to the docs Graham - those look very helpful.
>  I'll do my best to read them.
>
>  So in the case of tramline[1], the 'tramline' header which is being
>  set in the finalizeInput[2] method (which is called from a
>  PythonInputFilter) will never make it to the back end? This is indeed
>  the behaviour I am seeing.

If you have set things up to proxy the request after tramline has
capture the upload then probably no. If it was a mod_python handler
that was doing the read then it would be available after the read had
returned, but only to the mod_python handler.

>  What would be the correct way to set this
>  header?

Possibly not to use mod_python to implement it. I never understood why
tramline was even implemented in mod_python as mod_python input/output
filters aren't that efficient. You would be much better off doing it
as a special purpose C module for Apache, and most likely such a thing
does exist if one looked hard enough.

The only way one might do it with mod_python so that header is proxied
through, is to use a PythonFixupHandler to trigger the read of input
before the proxy handler is triggered in the response phase. That way
the header would exist and proxy handler may pass it through.

It has been a while since I looked at how tramline works, so this may
or may not work.

Graham

>  [1] http://codespeak.net/svn/rr/tramline/trunk/README.txt
>  [2] http://codespeak.net/svn/rr/tramline/trunk/src/tramline/core.py
>
>  Thank you so much for your help (and your patience!)
>
>  --Emyr
>
>
>
>  On Mon, Apr 28, 2008 at 10:09 PM, Graham Dumpleton
>  <graham.dumpleton@gmail.com> wrote:
>  > Sorry, one mistake I did make, was that you need earlier handler than
>  >  PythonFixupHandler if you want to affect access, authentication,
>  >  authorisation phases. Point is though that you can't do it in a
>  >  mod_python input filter as they only get triggered when content is
>  >  being read and after headers have been processed. There are input
>  >  filters that can process headers, but mod_python doesn't provide
>  >  access to writing them.
>  >
>  >  Graham
>  >
>  >  2008/4/29 Graham Dumpleton <graham.dumpleton@gmail.com>:
>  >
>  >
>  > > 2008/4/28 Emyr Thomas <emyr.thomas@gmail.com>:
>  >  >
>  >  > > Graham, out of interest, has this always been the case with mod_python, or
>  >  >  >  was this behavious introduced in a particular release?
>  >  >
>  >  >  This is nothing to do with mod_python, it is how underlying Apache C
>  >  >  APIs work. It has always been this way. If you have seen it behave any
>  >  >  other way, it would have been by luck due to calling sequences and not
>  >  >  guaranteed.
>  >  >
>  >  >  Suggest you dig through:
>  >  >
>  >  >   http://www.fmc-modeling.org/category/projects/apache/amp/Apache_Modeling_Project.html
>  >  >
>  >  >  to get a better understanding of how Apache works internally.
>  >  >
>  >  >  Graham
>  >  >
>  >  >
>  >  >
>  >  >  >  "Graham Dumpleton"
>  >  >  >  <graham.dumpleton@gmail.com> wrote in message
>  >  >  >  news:88e286470704191453o5b0b3c08u77b14064c1f58950@mail.gmail.com...
>  >  >  >
>  >  >  >
>  >  >  > > You can't use a mod_python input filter to modify incoming headers. If
>  >  >  >  > the changes to the headers aren't intended to influence the behaviour
>  >  >  >  > of what Apache does during access, authentication, authorisation and
>  >  >  >  > type checking phases, use a PythonFixupHandler to update any headers
>  >  >  >  > to then be used by the actual response handler.
>  >  >  >  >
>  >  >  >  > Note, provided you are using mod_python 3.3, you can actually use
>  >  >  >  > mod_python to trigger the proxying as well. See:
>  >  >  >  >
>  >  >  >  > http://issues.apache.org/jira/browse/MODPYTHON-141
>  >  >  >  >
>  >  >  >  > Graham
>  >  >  >  >
>  >  >  >  > On 20/04/07, indyone ;o) <indyone@gmail.com>
>  >  >  >  > wrote:
>  >  >  >  >> Hi list,
>  >  >  >  >>
>  >  >  >  >> I'm trying to get the headers_in from the client, and after
>  >  >  >  >> changing/adding
>  >  >  >  >> some headers i would like to pass them to the backend server.
>  >  >  >  >> I'm using Apache/2.0.55 (Win32) mod_python/3.1.3 Python/2.3.5
>  >  >  >  >> The problem is that the headers are sent to the backend unchanged when
>  >  >  >  >> using
>  >  >  >  >> this simple input filter:
>  >  >  >  >>
>  >  >  >  >> def inputfilter(filter):
>  >  >  >  >>
>  >  >  >  >>     filter.req.headers_in['X-MyHeader'] = 'Test'
>  >  >  >  >>     if filter.req.main is not None:
>  >  >  >  >>         filter.pass_on()
>  >  >  >  >>         return
>  >  >  >  >>
>  >  >  >  >>     filter.req.log_error('Start %s' % filter.req.uri)
>  >  >  >  >>     s = filter.read()
>  >  >  >  >>     while s:
>  >  >  >  >>         filter.write(s)
>  >  >  >  >>         s = filter.read()
>  >  >  >  >>     if s is None:
>  >  >  >  >>         filter.close()
>  >  >  >  >>         filter.req.log_error('End %s' % filter.req.uri)
>  >  >  >  >>
>  >  >  >  >>     filter.req.log_error('%s' % filter.req.headers_in)
>  >  >  >  >>
>  >  >  >  >> and Apache logs:
>  >  >  >  >>
>  >  >  >  >> [Thu Apr 19 18:17:28 2007] [error] [client 127.0.0.1] Start /, referer:
>  >  >  >  >> http://localhost/
>  >  >  >  >> [Thu Apr 19 18:17:28 2007] [error] [client 127.0.0.1] End /, referer:
>  >  >  >  >> http://localhost/
>  >  >  >  >> [Thu Apr 19 18:17:28 2007] [error] [client 127.0.0.1] {'X-MyHeader':
>  >  >  >  >> 'Test',
>  >  >  >  >> 'X-Forwarded-Server': 'luna', 'X-Forwarded-Host': 'localhost',
>  >  >  >  >> 'X-Forwarded-For': ' 127.0.0.1', 'Max-Forwards': '10', 'Cookie':
>  >  >  >  >> 'wstyle=;
>  >  >  >  >> __ac="YWRtaW46bWF0cml4";
>  >  >  >  >> tree-s="eJzT0MgpMOQKVneEAKcAN19bda4CI67EkgJjLj0AegYHmA"',
>  >  >  >  >> 'Referer': ' http://localhost/', 'Accept-Charset':
>  >  >  >  >> 'ISO-8859-7,utf-8;q=0.7,*;q=0.7', 'Accept-Encoding': 'gzip,deflate',
>  >  >  >  >> 'Accept-Language': 'el,en-us;q=0.7 ,en;q=0.3', 'Accept':
>  >  >  >  >> 'text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5',
>  >  >  >  >> 'User-Agent': 'Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:
>  >  >  >  >> 1.8.0.8)
>  >  >  >  >> Gecko/20061030 SeaMonkey/1.0.6', 'Host': 'localhost'}, referer:
>  >  >  >  >> http://localhost/
>  >  >  >  >> ...(multiple times)...
>  >  >  >  >>
>  >  >  >  >> Which is right i think... But my backend server gets this request:
>  >  >  >  >>
>  >  >  >  >> GET
>  >  >  >  >> /VirtualHostBase/http/localhost:80/Editorial/VirtualHostRoot/
>  >  >  >  >> HTTP/1.1
>  >  >  >  >> Host: localhost:8081
>  >  >  >  >> User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.0.8)
>  >  >  >  >> Gecko/20061030 SeaMonkey/1.0.6
>  >  >  >  >> Accept:
>  >  >  >  >> text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5
>  >  >  >  >> Accept-Language: el,en-us;q=0.7,en;q=0.3
>  >  >  >  >> Accept-Encoding: gzip,deflate
>  >  >  >  >> Accept-Charset: ISO-8859-7,utf-8;q= 0.7,*;q=0.7
>  >  >  >  >> Referer: http://localhost/
>  >  >  >  >> Cookie: wstyle=; __ac="YWRtaW46bWF0cml4";
>  >  >  >  >> tree-s="eJzT0MgpMOQKVneEAKcAN19bda4CI67EkgJjLj0AegYHmA"
>  >  >  >  >> Max-Forwards: 10
>  >  >  >  >> X-Forwarded-For: 127.0.0.1
>  >  >  >  >> X-Forwarded-Host: localhost
>  >  >  >  >> X-Forwarded-Server: luna
>  >  >  >  >>
>  >  >  >  >> Thank you in advance,
>  >  >  >  >>
>  >  >  >  >> Ioannis Stavrinos
>  >  >  >  >>
>  >  >  >  >> _______________________________________________
>  >  >  >  >> Mod_python mailing list
>  >  >  >  >> Mod_python@modpython.org
>  >  >  >  >> http://mailman.modpython.org/mailman/listinfo/mod_python
>  >  >  >  >>
>  >  >  >  >>
>  >  >  >
>  >  >  >
>  >  >  >
>  >  >  >  _______________________________________________
>  >  >  >  Mod_python mailing list
>  >  >  >  Mod_python@modpython.org
>  >  >  >  http://mailman.modpython.org/mailman/listinfo/mod_python
>  >  >  >
>  >  >
>  >
>
From graham.dumpleton at gmail.com  Tue Apr 29 17:36:06 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue Apr 29 17:36:13 2008
Subject: [mod_python] Problem getting my web app to work with remote
	oracle server
In-Reply-To: <48172EEE.2070501@noaa.gov>
References: <4804EB2B.50409@noaa.gov>
	<88e286470804151517h133e6cedi2cc4569ecbaa372e@mail.gmail.com>
	<48172EEE.2070501@noaa.gov>
Message-ID: <88e286470804291436q16393a7fj84220f0f5dc731e1@mail.gmail.com>

Please keep replies on list, have bounced this back to list so all can
see and perhaps comment.

2008/4/30 wayne collier <Wayne.Collier@noaa.gov>:
>
>  Hi Graham. I set these in /etc/init.d/httpd file. I have following set :
>
>  export LD_LIBRARY_PATH=/u01/app/oracle/product/10.2.0/client_1/lib:
>  TNS_ADMIN=/u01/app/oracle/product/10.2.0/client_1/network/admin ; export
> TNS_ADMIN
>  ORACLE_HOME=/u01/app/oracle/product/10.2.0/client_1;  export ORACLE_HOME
>
>
>
>
>
>
>
>
>
>
>
>  Graham Dumpleton wrote:
>  2008/4/16 wayne collier <Wayne.Collier@noaa.gov>:
>
>
>  I'm having a frustrating time getting my web app to connect with a remote
> oracle server.
>  However, from the linux prompt I am able to run oracle commands to connect
> to database.
>  The error message I get are as follows:
>
>  Mod_python error: "PythonHandler mod_python.psp" Traceback (most recent
> call last):
>
>  File "apache.py", line 299, in HandlerDispatch result = object(req)
>  File "/usr/local/lib/python2.4/site-packages/mod_python/psp.py", line 302,
> in handler p.run()
>  File "/usr/local/lib/python2.4/site-packages/mod_python/psp.py", line 213,
> in run exec code in global_scope
>  File "/var/www/html/psp/modinfo.psp", line 58, in ? oracle =
> cx_Oracle.connect(myUid, myPwd, myDsn)
>
>  DatabaseError: ORA-12541: TNS:no listener
>
>  I suspect that it has something to do with the permission of the apache
> user defined in the httpd.conf file.
>  Also, I have set the ORACLE_HOME,LD_LIBRARY_PATH and TNS_ADMIN variable to
> load and be initialized on startup. But it does not work!!!
>
>  Exactly where have you set these?
>
> Graham
>
>
>
>  Can someone help me with this?
>
>
>  Wayne
>
>
>
>
>  My set up is as follows:
>
>  PYTHON 2.4.4c1 (#1, Nov 6 2006, 14:14:48)
>  operating system [GCC 3.4.6 20060404 (Red Hat 3.4.6-3)]
>  MOD_PYTHON 3.2.10
>  Apache version 2.0.52
>
>
>
> _______________________________________________
>  Mod_python mailing list
>  Mod_python@modpython.org
>  http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
>
>  _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
>
>
From graham.dumpleton at gmail.com  Wed Apr 30 02:05:14 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Wed Apr 30 02:05:19 2008
Subject: [mod_python] Problem getting my web app to work with remote
	oracle server
In-Reply-To: <88e286470804291436q16393a7fj84220f0f5dc731e1@mail.gmail.com>
References: <4804EB2B.50409@noaa.gov>
	<88e286470804151517h133e6cedi2cc4569ecbaa372e@mail.gmail.com>
	<48172EEE.2070501@noaa.gov>
	<88e286470804291436q16393a7fj84220f0f5dc731e1@mail.gmail.com>
Message-ID: <88e286470804292305j75b56851meae02d344ae9c4f2@mail.gmail.com>

2008/4/30 Graham Dumpleton <graham.dumpleton@gmail.com>:
> Please keep replies on list, have bounced this back to list so all can
>  see and perhaps comment.
>
>  2008/4/30 wayne collier <Wayne.Collier@noaa.gov>:
>
>
> >
>  >  Hi Graham. I set these in /etc/init.d/httpd file. I have following set :
>  >
>  >  export LD_LIBRARY_PATH=/u01/app/oracle/product/10.2.0/client_1/lib:
>  >  TNS_ADMIN=/u01/app/oracle/product/10.2.0/client_1/network/admin ; export
>  > TNS_ADMIN
>  >  ORACLE_HOME=/u01/app/oracle/product/10.2.0/client_1;  export ORACLE_HOME

One hopes then that you always use init.d scripts to stop and start it
then, as using apachectl directly will not pick up those entries.

Next thing is, have you tried running your Python script from command
line but as user that Apache runs as rather than yourself. Code in
mod_python will run as that Apache user and so if it can't read files
in Oracle installation area, or that user otherwise doesn't have
permission to connect to Oracle in some way, you will have problems.

Graham

>  >
>  >
>  >
>  >
>  >
>  >
>  >
>  >
>  >
>  >
>  >  Graham Dumpleton wrote:
>  >  2008/4/16 wayne collier <Wayne.Collier@noaa.gov>:
>  >
>  >
>  >  I'm having a frustrating time getting my web app to connect with a remote
>  > oracle server.
>  >  However, from the linux prompt I am able to run oracle commands to connect
>  > to database.
>  >  The error message I get are as follows:
>  >
>  >  Mod_python error: "PythonHandler mod_python.psp" Traceback (most recent
>  > call last):
>  >
>  >  File "apache.py", line 299, in HandlerDispatch result = object(req)
>  >  File "/usr/local/lib/python2.4/site-packages/mod_python/psp.py", line 302,
>  > in handler p.run()
>  >  File "/usr/local/lib/python2.4/site-packages/mod_python/psp.py", line 213,
>  > in run exec code in global_scope
>  >  File "/var/www/html/psp/modinfo.psp", line 58, in ? oracle =
>  > cx_Oracle.connect(myUid, myPwd, myDsn)
>  >
>  >  DatabaseError: ORA-12541: TNS:no listener
>  >
>  >  I suspect that it has something to do with the permission of the apache
>  > user defined in the httpd.conf file.
>  >  Also, I have set the ORACLE_HOME,LD_LIBRARY_PATH and TNS_ADMIN variable to
>  > load and be initialized on startup. But it does not work!!!
>  >
>  >  Exactly where have you set these?
>  >
>  > Graham
>  >
>  >
>  >
>  >  Can someone help me with this?
>  >
>  >
>  >  Wayne
>  >
>  >
>  >
>  >
>  >  My set up is as follows:
>  >
>  >  PYTHON 2.4.4c1 (#1, Nov 6 2006, 14:14:48)
>  >  operating system [GCC 3.4.6 20060404 (Red Hat 3.4.6-3)]
>  >  MOD_PYTHON 3.2.10
>  >  Apache version 2.0.52
>  >
>  >
>  >
>  > _______________________________________________
>  >  Mod_python mailing list
>  >  Mod_python@modpython.org
>  >  http://mailman.modpython.org/mailman/listinfo/mod_python
>  >
>  >
>  >
>  >  _______________________________________________
>  > Mod_python mailing list
>  > Mod_python@modpython.org
>  > http://mailman.modpython.org/mailman/listinfo/mod_python
>  >
>  >
>  >
>  >
>
