<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] PythonImport - an example?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20PythonImport%20-%20an%20example%3F&In-Reply-To=200303210837.04952.jc%40cowgar.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006087.html">
   <LINK REL="Next"  HREF="006085.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] PythonImport - an example?</H1>
    <B>Gregory (Grisha) Trubetskoy</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20PythonImport%20-%20an%20example%3F&In-Reply-To=200303210837.04952.jc%40cowgar.com"
       TITLE="[mod_python] PythonImport - an example?">grisha at modpython.org
       </A><BR>
    <I>Fri Mar 21 10:36:36 EST 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="006087.html">[mod_python] PythonImport - an example?
</A></li>
        <LI>Next message: <A HREF="006085.html">[mod_python] MySQL DB connection sharing solution
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6090">[ date ]</a>
              <a href="thread.html#6090">[ thread ]</a>
              <a href="subject.html#6090">[ subject ]</a>
              <a href="author.html#6090">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<table border=0 width="100%"><tr><td>
<!--beginarticle-->
<PRE>Yes, but I would stay away from PythonImport unless you have no choice.

There's been some debate about this on the list before and it manly arises
from a misunderstanding of how things work. At first glance it seems like
a simple and obvious thing - initiate my db connections and load big data
dictionaries at server startup so that when those requests come in we're
ready to go.

But the problem is that Apache doesn't work this way. The context within
which a request runs comes into existence only after a request begins and
is a result of applying known server configuration directives (from config
and .htaccess files) to dynamic request parameters (e.g. host:  header
which dictates the virtual server to be used, and also the name of the
subinterpreter mod_python will use).

Consider also that there is no way to reliably predict ahead of time what
this request environment may look like since it is put together gradually
by handlers, which might be provided by any number of apache modules which
may choose to drastically change the request environment (e.g. rewrite a
bunch of headers). For example the virtual server and document root
information may not even be specified in the config file but is created
dynamically per-request if you're using something like mod_vhost.

But the server config file discussion during PythonImport is moot,
because, in fact, at the time when PythonImport executes (Apache child
initialization phase), Apache hasn't yet read the config file fully.

So you have to realize that PythonImport runs in this minimalistic bare
environment and needs a hint in the form of the subinterpreter name to be
useful, and sometimes getting it to work correctly can be a challenge, and
also keep in mind that using this directive isn't very portable because it
requires the interpreter name.

I personally favor not bothering with pre-initialization at all. The
downside is that the first hit to your side may take a little longer.
Another option that I've used quite successfully is to add a request to
some initialization url (using lynx or wget or whatever) into the server
start up script.

Grisha

On Fri, 21 Mar 2003, Jeremy Cowgar wrote:

&gt;<i> Can anyone give me an example of how the PythonImport directive/code works?
</I>&gt;<i>
</I>&gt;<i> I may be mistaken, but what I want to use it for is to establish my initial db
</I>&gt;<i> connections, load some classes, do some configuration, etc... Then in all my
</I>&gt;<i> hander's, I should have access to that information, correct?
</I>&gt;<i>
</I>&gt;<i> Thanks,
</I>&gt;<i>
</I>&gt;<i> Jeremy
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://www.modpython.org/mailman/listinfo/mod_python">http://www.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i>
</I>

</PRE>
<!--endarticle-->
</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006087.html">[mod_python] PythonImport - an example?
</A></li>
	<LI>Next message: <A HREF="006085.html">[mod_python] MySQL DB connection sharing solution
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6090">[ date ]</a>
              <a href="thread.html#6090">[ thread ]</a>
              <a href="subject.html#6090">[ subject ]</a>
              <a href="author.html#6090">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
