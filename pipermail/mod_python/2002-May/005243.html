<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] [patch] make autoreload more useful
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20%5Bpatch%5D%20make%20autoreload%20more%20useful&In-Reply-To=20020529124504.GG1280%40eleanor.internal.ywlcs.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005242.html">
   <LINK REL="Next"  HREF="005245.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] [patch] make autoreload more useful</H1>
    <B>Martin Pool</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20%5Bpatch%5D%20make%20autoreload%20more%20useful&In-Reply-To=20020529124504.GG1280%40eleanor.internal.ywlcs.org"
       TITLE="[mod_python] [patch] make autoreload more useful">mbp at samba.org
       </A><BR>
    <I>Thu May 30 10:38:51 EST 2002</I>
    <P><UL>
        <LI>Previous message: <A HREF="005242.html">[mod_python] [patch] make autoreload more useful
</A></li>
        <LI>Next message: <A HREF="005245.html">[mod_python] [patch] make autoreload more useful
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5243">[ date ]</a>
              <a href="thread.html#5243">[ thread ]</a>
              <a href="subject.html#5243">[ subject ]</a>
              <a href="author.html#5243">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<table border=0 width="100%"><tr><td>
<!--beginarticle-->
<PRE>On 29 May 2002, Dustin Mitchell &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">dustin at ywlcs.org</A>&gt; wrote:

&gt;<i> 1. I'm not sure how gc interacts with this, but there was a time when you
</I>&gt;<i> just couldn't get rid of a loaded module object.  All of the modules you
</I>&gt;<i> delete will still reference each other in some sort of cycle. If they're not
</I>&gt;<i> deleted you could very quickly end up with an enormous httpd process.
</I>
Here's a nickel; get a bigger computer :-)

&gt;<i> Even with gc, if there are any dangling references into one of the old
</I>&gt;<i> modules (an atexit function? somewhere the Python standard libraries cache a
</I>&gt;<i> reference?) then you're going to have a bloated httpd.
</I>
Using atexit functions within mod_python is pretty pointless, but your
general point about references held by system modules is correct.

If my code bloated that easily because of reloading modules then I
would be somewhat worried that something would cause it to happen
during production, and I'd feel I ought to investigate what was going
wrong.

You can always turn down MaxRequestsPerChild, or indeed turn off
autoreload.

I guess in general I believe that in development mode (as opposed to
release), correctness and developer productivity is more important
than performance.

In deployment mode, there shouldn't be any bloat because the .py files
won't change.  The cost is just stat'ing them each time, which is a
slight cost but not terrible.

&gt;<i> 2. One other difficulty: some modules actually *do* want to have global
</I>&gt;<i> state.  For example, a MySQL interface should be able to establish its
</I>&gt;<i> connection once and maintain that through many requests.  Perhaps there
</I>&gt;<i> should be a mechanism for a module to say &quot;don't remove me!&quot;, or at least
</I>&gt;<i> &quot;preserve the value of this variable&quot;.
</I>
As far as I can see, the only non-bogus use of persistence is
opportunistic caching.  Modules have to cope with losing their
persistent state because (a) requests are unpredictably spread across
Apache instances; (b) Apache can kill and restart children; (c)
relying on it is overly fragile; and (d) without a working reload
mechanism, the programmer will be completely restarting Apache at
intervals anyhow.

-- 
Martin 

</PRE>
<!--endarticle-->
</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005242.html">[mod_python] [patch] make autoreload more useful
</A></li>
	<LI>Next message: <A HREF="005245.html">[mod_python] [patch] make autoreload more useful
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5243">[ date ]</a>
              <a href="thread.html#5243">[ thread ]</a>
              <a href="subject.html#5243">[ subject ]</a>
              <a href="author.html#5243">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
