<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] [patch] make autoreload more useful
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20%5Bpatch%5D%20make%20autoreload%20more%20useful&In-Reply-To=20020529082436.GK25763%40samba.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008937.html">
   <LINK REL="Next"  HREF="008939.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
<table border=0 width="100%"><tr><td valign="top">
   <H1>[mod_python] [patch] make autoreload more useful</H1>
    <B>Dustin Mitchell</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20%5Bpatch%5D%20make%20autoreload%20more%20useful&In-Reply-To=20020529082436.GK25763%40samba.org"
       TITLE="[mod_python] [patch] make autoreload more useful">dustin at ywlcs.org
       </A><BR>
    <I>Wed May 29 07:45:05 EST 2002</I>
    <P><UL>
        <LI>Previous message: <A HREF="008937.html">[mod_python] [patch] make autoreload more useful
</A></li>
        <LI>Next message: <A HREF="008939.html">[mod_python] [patch] make autoreload more useful
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8938">[ date ]</a>
              <a href="thread.html#8938">[ thread ]</a>
              <a href="subject.html#8938">[ subject ]</a>
              <a href="author.html#8938">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, May 29, 2002 at 06:24:40PM +1000, Martin Pool wrote:

&gt;<i> +# The basic idea is that we want to delete everything from sys.modules
</I>&gt;<i> +# when the user's code changes, except for system modules.  This is
</I>&gt;<i> +# necessary because otherwise one module that has not changed may
</I>&gt;<i> +# still be holding references to code objects from a module that has
</I>&gt;<i> +# changed.  We have to actually delete them and start again rather
</I>&gt;<i> +# than using reload(), because otherwise the first one reloaded may
</I>&gt;<i> +# grab references from something that will be reloaded later on.
</I>
Two things:

1. I'm not sure how gc interacts with this, but there was a time when you
just couldn't get rid of a loaded module object.  All of the modules you
delete will still reference each other in some sort of cycle. If they're not
deleted you could very quickly end up with an enormous httpd process.

Even with gc, if there are any dangling references into one of the old
modules (an atexit function? somewhere the Python standard libraries cache a
reference?) then you're going to have a bloated httpd.

I wrote a reloader similar to this one, and my solution to this was to watch
the number of reloads, and call req.child_terminate() after a certain number
(I picked 10) or reloads.


2. One other difficulty: some modules actually *do* want to have global
state.  For example, a MySQL interface should be able to establish its
connection once and maintain that through many requests.  Perhaps there
should be a mechanism for a module to say &quot;don't remove me!&quot;, or at least
&quot;preserve the value of this variable&quot;.


Dustin

-- 

  Dustin Mitchell
  <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">dustin at ywlcs.org</A>
  <A HREF="http://people.cs.uchicago.edu/~dustin/">http://people.cs.uchicago.edu/~dustin/</A>

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008937.html">[mod_python] [patch] make autoreload more useful
</A></li>
	<LI>Next message: <A HREF="008939.html">[mod_python] [patch] make autoreload more useful
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8938">[ date ]</a>
              <a href="thread.html#8938">[ thread ]</a>
              <a href="subject.html#8938">[ subject ]</a>
              <a href="author.html#8938">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
