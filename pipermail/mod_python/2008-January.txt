From grisha at modpython.org  Tue Jan  1 06:31:00 2008
From: grisha at modpython.org (Denny Ratliff)
Date: Tue Jan  1 06:32:51 2008
Subject: [mod_python] [SPAM] Repl1ca watch is a perfect gift! nMg0
Message-ID: <bqzaxWNNMFgrisha@modpython.org>

New Year is knocking, 0rder precious repl1ca w4tches!
Brand new models of w4tches, purses & bags from 2008!
http://www.spoeeiij.com/

zZ5B9fOgqXz



From grisha at modpython.org  Tue Jan  1 21:31:40 2008
From: grisha at modpython.org (Georgette Shepherd)
Date: Tue Jan  1 21:33:25 2008
Subject: [mod_python] [SPAM] January promo on w4tches WfVu
Message-ID: <yqrqobKQHGCgrisha@modpython.org>

Winter is hitting and New Year is coming.
Do you need perfect gift? 0rder high qual1ty
repl1ca of w4tches, purses & bags from 2008!
http://www.spodiek.com/

nUpNCfaQC



From mdennis at merfer.net  Wed Jan  2 17:57:33 2008
From: mdennis at merfer.net (Matthew Dennis)
Date: Wed Jan  2 17:57:41 2008
Subject: [mod_python] apache.SERVER_RETURN and chunked encoding
Message-ID: <e94d85500801021457w1e7cdf4g4775d329d47c6800@mail.gmail.com>

I have a handler that streams large amounts of data.  Using chunked encoding
in necessary as the total size is not known upfront.  If there is an error
during the generation, I raise a apache.SERVER_RETURN (with
HTTP_PARTIAL_RESPONSE I believe).  The problem is that it looks like
mod_python and/or apache just appends some error html to the output stream
and continues with the chunked encoding like there was no error.  In other
words, some data chunks come from the server, then a chunk with the error
html in it, then the last chunk.  Thus, the client has no way of knowing
that the data is incomplete (not all of it was generated) and corrupt
(random html appended onto the end).  Am I just missing something, or is
this a bug?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080102/2d18ed60/attachment.html
From graham.dumpleton at gmail.com  Wed Jan  2 18:13:18 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Wed Jan  2 18:13:24 2008
Subject: [mod_python] apache.SERVER_RETURN and chunked encoding
In-Reply-To: <e94d85500801021457w1e7cdf4g4775d329d47c6800@mail.gmail.com>
References: <e94d85500801021457w1e7cdf4g4775d329d47c6800@mail.gmail.com>
Message-ID: <88e286470801021513r479cf170r974f39a6a8cbdc4f@mail.gmail.com>

On 03/01/2008, Matthew Dennis <mdennis@merfer.net> wrote:
> I have a handler that streams large amounts of data.  Using chunked encoding
> in necessary as the total size is not known upfront.  If there is an error
> during the generation, I raise a apache.SERVER_RETURN (with
> HTTP_PARTIAL_RESPONSE I believe).  The problem is that it looks like
> mod_python and/or apache just appends some error html to the output stream
> and continues with the chunked encoding like there was no error.  In other
> words, some data chunks come from the server, then a chunk with the error
> html in it, then the last chunk.  Thus, the client has no way of knowing
> that the data is incomplete (not all of it was generated) and corrupt
> (random html appended onto the end).  Am I just missing something, or is
> this a bug?

A HTTP status code can only be returned/raised before any data has
been sent as that information is at the beginning of the response. If
you are trying to raise the HTTP response status after data has been
sent then your code is wrong.

What do you think HTTP_PARTIAL_RESPONSE is meant to be used for? Maybe
you understanding is not complete, or you don't understand how HTTP
responses are put together.

Graham
From mdennis at merfer.net  Wed Jan  2 20:56:05 2008
From: mdennis at merfer.net (Matthew Dennis)
Date: Wed Jan  2 20:56:11 2008
Subject: [mod_python] apache.SERVER_RETURN and chunked encoding
In-Reply-To: <88e286470801021513r479cf170r974f39a6a8cbdc4f@mail.gmail.com>
References: <e94d85500801021457w1e7cdf4g4775d329d47c6800@mail.gmail.com>
	<88e286470801021513r479cf170r974f39a6a8cbdc4f@mail.gmail.com>
Message-ID: <e94d85500801021756n39a0272fga72709192790717@mail.gmail.com>

On 1/2/08, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
>
> On 03/01/2008, Matthew Dennis <mdennis@merfer.net> wrote:
> > I have a handler that streams large amounts of data.  Using chunked
> encoding
> > in necessary as the total size is not known upfront.  If there is an
> error
> > during the generation, I raise a apache.SERVER_RETURN (with
> > HTTP_PARTIAL_RESPONSE I believe).  The problem is that it looks like
> > mod_python and/or apache just appends some error html to the output
> stream
> > and continues with the chunked encoding like there was no error.  In
> other
> > words, some data chunks come from the server, then a chunk with the
> error
> > html in it, then the last chunk.  Thus, the client has no way of knowing
>
> > that the data is incomplete (not all of it was generated) and corrupt
> > (random html appended onto the end).  Am I just missing something, or is
> > this a bug?
>
> A HTTP status code can only be returned/raised before any data has
> been sent as that information is at the beginning of the response. If
> you are trying to raise the HTTP response status after data has been
> sent then your code is wrong.
>
> What do you think HTTP_PARTIAL_RESPONSE is meant to be used for? Maybe
> you understanding is not complete, or you don't understand how HTTP
> responses are put together.
>
> Graham
>

Sorry, it was INTERNAL_SERVER_ERROR.  I don't know where I got
PARTIAL_RESPONSE from, there is no such thing.  There is a PARTIAL_CONTENT
status, but it's not even an error (it's a 200 status for range requests)
In any case, I would not expect that raising apache.SERVER_RETURN to
continue processing the request as if nothing happened.  SERVER_RETURN
requires a status/error code to be passed in, but I wasn't actually
expecting the status code to be sent to the client.  I was trying to have
apache/mod_python signal the client that the generation failed.

Let me approach this from a different direction, as it sounds like my
understanding of raising SERVER_RETURN is wrong.  I thought raising
SERVER_RETURN was the correct way to inform apache and/or mod_python that an
error occurred and that the handler can not continue - is that incorrect?
I'm starting to assume from the name that my understanding is wrong...

The real question is if a handler is in the middle of sending a chunked
response, how does it inform apache and/or mod_python that it can not
continue?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080102/ed427620/attachment.html
From graham.dumpleton at gmail.com  Wed Jan  2 21:44:58 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Wed Jan  2 21:45:06 2008
Subject: [mod_python] apache.SERVER_RETURN and chunked encoding
In-Reply-To: <e94d85500801021756n39a0272fga72709192790717@mail.gmail.com>
References: <e94d85500801021457w1e7cdf4g4775d329d47c6800@mail.gmail.com>
	<88e286470801021513r479cf170r974f39a6a8cbdc4f@mail.gmail.com>
	<e94d85500801021756n39a0272fga72709192790717@mail.gmail.com>
Message-ID: <88e286470801021844o6f7288caha5c740ecfcfb8dcc@mail.gmail.com>

On 03/01/2008, Matthew Dennis <mdennis@merfer.net> wrote:
> On 1/2/08, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
>
> > On 03/01/2008, Matthew Dennis <mdennis@merfer.net> wrote:
> > > I have a handler that streams large amounts of data.  Using chunked
> encoding
> > > in necessary as the total size is not known upfront.  If there is an
> error
> > > during the generation, I raise a apache.SERVER_RETURN (with
> > > HTTP_PARTIAL_RESPONSE I believe).  The problem is that it looks like
> > > mod_python and/or apache just appends some error html to the output
> stream
> > > and continues with the chunked encoding like there was no error.  In
> other
> > > words, some data chunks come from the server, then a chunk with the
> error
> > > html in it, then the last chunk.  Thus, the client has no way of knowing
> > > that the data is incomplete (not all of it was generated) and corrupt
> > > (random html appended onto the end).  Am I just missing something, or is
> > > this a bug?
> >
> > A HTTP status code can only be returned/raised before any data has
> > been sent as that information is at the beginning of the response. If
> > you are trying to raise the HTTP response status after data has been
> > sent then your code is wrong.
> >
> > What do you think HTTP_PARTIAL_RESPONSE is meant to be used for? Maybe
> > you understanding is not complete, or you don't understand how HTTP
> > responses are put together.
> >
> > Graham
> >
>
> Sorry, it was INTERNAL_SERVER_ERROR.  I don't know where I got
> PARTIAL_RESPONSE from, there is no such thing.  There is a PARTIAL_CONTENT
> status, but it's not even an error (it's a 200 status for range requests)
> In any case, I would not expect that raising apache.SERVER_RETURN to
> continue processing the request as if nothing happened.  SERVER_RETURN
> requires a status/error code to be passed in, but I wasn't actually
> expecting the status code to be sent to the client.  I was trying to have
> apache/mod_python signal the client that the generation failed.
>
> Let me approach this from a different direction, as it sounds like my
> understanding of raising SERVER_RETURN is wrong.  I thought raising
> SERVER_RETURN was the correct way to inform apache and/or mod_python that an
> error occurred and that the handler can not continue - is that incorrect?
> I'm starting to assume from the name that my understanding is wrong...
>
> The real question is if a handler is in the middle of sending a chunked
> response, how does it inform apache and/or mod_python that it can not
> continue?

You can't return error status after having started writing data. All
you can do is close the connection and not send any more data.

To do that return apache.OK or raise it using SERVER_RETURN. Ie., from memory:

  raise apache.SERVER_RETURN, apache.OK

If you want some sort of error to be flagged, best you can do is log
something in the Apache error logs using req.log_error().

Graham
From rguha at indiana.edu  Thu Jan  3 22:56:54 2008
From: rguha at indiana.edu (Rajarshi Guha)
Date: Thu Jan  3 22:57:13 2008
Subject: [mod_python] providing REST style interfaces
Message-ID: <BE4BF201-B994-4D69-BCB8-84BAD5D15465@indiana.edu>

Hi, I'm trying to wrap my head around a REST style interface using  
mod_python. My understanding of REST so far is that URI's should not  
specify specific actions (as in /service.py?action=delete).

Thus I'd like to be able to handle a URL like

http://www.somehost.com/service.py/descriptor/CCCC

where CCCC is an argument to the service.

Is something like this possible in mod_python? If anybody could point  
me to some examples of REST interfaces built using mod_python, it  
would be much appreciated.

Thanks,

-------------------------------------------------------------------
Rajarshi Guha  <rguha@indiana.edu>
GPG Fingerprint: 0CCA 8EE2 2EEB 25E2 AB04  06F7 1BB9 E634 9B87 56EE
-------------------------------------------------------------------
Does Ramanujan know Polish?
                --  E.B. Ross


From johannes at nudgenudge.eu  Fri Jan  4 04:10:37 2008
From: johannes at nudgenudge.eu (Johannes Hoffart)
Date: Fri Jan  4 04:11:16 2008
Subject: [mod_python] Trouble on OSX - Leopard again
Message-ID: <90383F71-7927-4418-9468-20420BBF3C0C@nudgenudge.eu>

Hi,

I tried to install mod_python on osx and ran into the x86_64 trouble -  
I then followed the solution in this mailing list, which works nicely.  
There is one limitation, though, the _psp.so is still not x86_64:

file _psp.so
_psp.so: Mach-O universal binary with 2 architectures
_psp.so (for architecture i386):	Mach-O bundle i386
_psp.so (for architecture ppc7400):	Mach-O bundle ppc

The corresponding output in the make process shows that it is only  
compiled for those two archs, but I cannot find the right place in the  
Makefile to add x86_64. Apache loads fine, but throws this error upon  
accessing a .psp file:

ImportError: dlopen(/Library/Python/2.5/site-packages/mod_python/ 
_psp.so, 2): no suitable image found.  Did find:
	/Library/Python/2.5/site-packages/mod_python/_psp.so: no matching  
architecture in universal wrapper

I hope someone can point me in the right direction.
Thanks in advance!
Johannes Hoffart
From deron.meranda at gmail.com  Fri Jan  4 04:32:14 2008
From: deron.meranda at gmail.com (Deron Meranda)
Date: Fri Jan  4 04:32:20 2008
Subject: [mod_python] providing REST style interfaces
In-Reply-To: <BE4BF201-B994-4D69-BCB8-84BAD5D15465@indiana.edu>
References: <BE4BF201-B994-4D69-BCB8-84BAD5D15465@indiana.edu>
Message-ID: <5c06fa770801040132j22731c19t780d7ff5c91e75ef@mail.gmail.com>

On Jan 3, 2008 10:56 PM, Rajarshi Guha <rguha@indiana.edu> wrote:
> Hi, I'm trying to wrap my head around a REST style interface using
> mod_python.

REST and mod_python are for the most part unrelated.  But you can
certainly use mod_python in a REST style (meaning that mod_python
doesn't get in your way of doing REST).


> My understanding of REST so far is that URI's should not
> specify specific actions (as in /service.py?action=delete).

Correct.

The main point of REST is that your URLs identify resources (think
nouns).  You'll typically have lots and lots of URLs; a different URL
for each possible different thing or item.

An opposite style is SOA (which is basically a more complex
evolution of CGI), in which the URLs name services or functions
instead (think verbs).  SOAs usually have very few URLs, but
perhaps with lots and lots of "arguments".

REST exposes things but hides the actors.
SOA exposes the actors but hides the things.

With REST, what you want to do to the resource (the verb) is
specified by the HTTP method which is part of the request protocol...
it is never encoded into the URL.  The methods can be things like
GET, PUT, DELETE, etc.  The POST method is generally
frowned upon in a REST usage, but it can be valid in certain
cases.  The same URL is used regardless of method as long as
whatever you're doing is being done to the same resource.

The whole REST style can be more involved, but it generally is
much closer to the original web/HTTP architecture.  Things like
ETags and content negotiation can be big deals in REST; while they
are blissfully ignored in most SOA approaches.

Perhaps one of the most widely used non-trivial REST applications
on Apache is Subversion (via mod_dav_svn since it's written in C and
not python).


> Thus I'd like to be able to handle a URL like
> http://www.somehost.com/service.py/descriptor/CCCC
> where CCCC is an argument to the service.

No, don't think argument to a *service*....that's an SOA mindset.
Also you most certainly don't want something like "service.py"
being visible in the URL.  A better URL would just be
http://www.somehost.com/descriptor/CCCC

Think of /descriptor/CCCC instead as being a unique *name* for some
resource or object.  Remember, with REST there is no action or verb
implied by the URL; everything is just a name for things/nouns.


> Is something like this possible in mod_python?

Yes, REST is very doable.  Since mod_python is so low-level (as
contrasted with many web "frameworks"), it doesn't force you to use
any one particular style or architecture for your applications.


> If anybody could point
> me to some examples of REST interfaces built using mod_python, it
> would be much appreciated.

If you're just trying to understand REST concepts, start with

http://en.wikipedia.org/wiki/Representational_State_Transfer

but do be aware that more and more misinformation about REST
is starting to show up as the marketing types are grabbing on the
the term as a buzzword.  Sometimes SOA-style architectures are
being described as REST even when they are technically not so.
(the latest such mislabeled example being Amazon's SimpleDB)


A very simple "hello world" like REST-style handler could be structured
similar to the following (note this is not complete code and is not tested):
The important thing to notice is that when doing REST you are usually
going to be doing some sort of switch on the req.method value.

def handler( req ):
    # Extract the resource name (the CCCC portion of the URL):
    uripath = [p for p in req.uri.split('/') if p]
    if len(uripath) != 2 or uripath[0] != 'descriptor':
        raise apache.SERVER_RETURN, apache.HTTP_NOT_FOUND
    resource_name = uripath[-1]

    # Now figure out what we want to do to the resource
    if req.method == 'GET':
        try:
            content = resource_database[resource_name]
        except KeyError:
            raise apache.SERVER_RETURN, apache.HTTP_NOT_FOUND
        req.content_type = 'application/octet-stream'
        req.write( content )
    elif req.method == 'PUT':
         content = req.read()
         resource_database[resource_name] = content
    elif req.method == 'DELETE':
         del resource_database[resource_name]
    else:
        raise apache.SERVER_RETURN, apache.HTTP_METHOD_NOT_ALLOWED

    return apache.OK

-- 
Deron Meranda
From grisha at modpython.org  Fri Jan  4 09:39:02 2008
From: grisha at modpython.org (Deloris Archer)
Date: Fri Jan  4 09:39:19 2008
Subject: [mod_python] [SPAM] Repl1ca watch is a perfect gift! dBON
Message-ID: <wikqgdtOEZKIgrisha@modpython.org>

New Year is knocking, 0rder precious repl1ca w4tches!
Brand new models of w4tches, purses & bags from 2008!
http://www.beudyyte.com/

gSIgVM7aPA1g8



From syed.2736 at gmail.com  Fri Jan  4 11:11:36 2008
From: syed.2736 at gmail.com (syed rizvi)
Date: Fri Jan  4 11:11:43 2008
Subject: [mod_python] Unscribe
Message-ID: <673a3ee20801040811x4e4a069coe6931bf2a6224c62@mail.gmail.com>

Please remove my name from this mailing list.

Thanks

Syed
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080104/52e24b31/attachment.html
From clodoaldo.pinto.neto at gmail.com  Fri Jan  4 12:01:43 2008
From: clodoaldo.pinto.neto at gmail.com (Clodoaldo)
Date: Fri Jan  4 12:01:49 2008
Subject: [mod_python] Unscribe
In-Reply-To: <673a3ee20801040811x4e4a069coe6931bf2a6224c62@mail.gmail.com>
References: <673a3ee20801040811x4e4a069coe6931bf2a6224c62@mail.gmail.com>
Message-ID: <a595de7a0801040901k13d8cbd2l70fe39563a97e59a@mail.gmail.com>

2008/1/4, syed rizvi <syed.2736@gmail.com>:
> Please remove my name from this mailing list.

In this page you can unsubscribe:

http://mailman.modpython.org/mailman/options/mod_python

Regards, Clodoaldo Pinto Neto
From David.Bear at asu.edu  Fri Jan  4 13:11:19 2008
From: David.Bear at asu.edu (David Bear)
Date: Fri Jan  4 13:11:29 2008
Subject: [mod_python] providing REST style interfaces
In-Reply-To: <5c06fa770801040132j22731c19t780d7ff5c91e75ef@mail.gmail.com>
References: <BE4BF201-B994-4D69-BCB8-84BAD5D15465@indiana.edu>
	<5c06fa770801040132j22731c19t780d7ff5c91e75ef@mail.gmail.com>
Message-ID: <20080104181119.GA23853@asu.edu>

On Fri, Jan 04, 2008 at 04:32:14AM -0500, Deron Meranda wrote:
> 
> def handler( req ):
>     # Extract the resource name (the CCCC portion of the URL):
>     uripath = [p for p in req.uri.split('/') if p]
>     if len(uripath) != 2 or uripath[0] != 'descriptor':
>         raise apache.SERVER_RETURN, apache.HTTP_NOT_FOUND
>     resource_name = uripath[-1]
> 
>     # Now figure out what we want to do to the resource
>     if req.method == 'GET':
>         try:
>             content = resource_database[resource_name]
>         except KeyError:
>             raise apache.SERVER_RETURN, apache.HTTP_NOT_FOUND
>         req.content_type = 'application/octet-stream'
>         req.write( content )
>     elif req.method == 'PUT':
>          content = req.read()
>          resource_database[resource_name] = content
>     elif req.method == 'DELETE':
>          del resource_database[resource_name]
>     else:
>         raise apache.SERVER_RETURN, apache.HTTP_METHOD_NOT_ALLOWED
> 
>     return apache.OK
> 

WOW. Thanks. This is a great descriptions on REST and the most
understandable I've looked at. The code is the teacher.


-- 
David Bear
phone: 	602-496-0424
fax: 	602-496-0955
College of Public Programs/ASU
University Center Rm 622
411 N Central
Phoenix, AZ 85007-0685
 "Beware the IP portfolio, everyone will be suspect of trespassing"
From deron.meranda at gmail.com  Fri Jan  4 14:21:41 2008
From: deron.meranda at gmail.com (Deron Meranda)
Date: Fri Jan  4 14:21:56 2008
Subject: [mod_python] providing REST style interfaces
In-Reply-To: <20080104181119.GA23853@asu.edu>
References: <BE4BF201-B994-4D69-BCB8-84BAD5D15465@indiana.edu>
	<5c06fa770801040132j22731c19t780d7ff5c91e75ef@mail.gmail.com>
	<20080104181119.GA23853@asu.edu>
Message-ID: <5c06fa770801041121m2c8fd87cg238418302db50c36@mail.gmail.com>

On Jan 4, 2008 1:11 PM, David Bear <David.Bear@asu.edu> wrote:
> WOW. Thanks. This is a great descriptions on REST and the most
> understandable I've looked at. The code is the teacher.

Just be aware that my code snippet is intentionally simplisitic.
I'm trying to show the big picture ideas while leaving out many
important details.

When writting an application for real use you need to pay
attention to some other things.  In general, REST applications
are much closer to the HTTP protocol, so it is important to
become very familiar with the HTTP protocol.  Whereas SOA
services just use the bare minimum HTTP functionaility and use
it as nothing more than a message transport; REST actually tries
to use as much of the HTTP protocol functionality as possible
and in the way it was intended to be used.  Read the RFC 2616
    -- http://tools.ietf.org/html/rfc2616

First, you must be very aware of the different semantics of
all the different methods, such as the difference between a
POST and a PUT.  If you use them incorrectly it can cause all
kinds of weird problems with things like caching, proxying, etc.
You also need to be much more concious of what HTTP
result codes you return; e.g., 200, 404, 405, 304, etc.

One of the things I left out of my code is when returning
a 405 (METHOD NOT ALLOWED), you must also set
the Allow: header in the error response to be the list of
all the supported methods on that resource.  Example:

    req.err_headers_out['Allow'] = 'GET, PUT, DELETE'
    raise apache.SERVER_RETURN, apache.HTTP_METHOD_NOT_ALLOWED

You should also look for the presence of all request headers
that are like Accept-XXXX:  or  If-XXXX:.  Even if you don't
handle these complexities, you should many times return an error
such as a 406 (NOT ACCEPTABLE) if the client has requested
special semantics that you are not ready to deal with.

And a rich REST "application" could choose to implement
even more of the HTTP functionality.  The HTTP headers
(both on the request and the response) are where much of the
power comes.  It can get quite involved if you do everything,
but I've successfully done all of these using just mod_python,
so it's possible.

 * content negotiation (mulitple respresentations of the same resource)
      Using the same URL I can serve up data as HTML, JSON, or XML
 * etags (for version control, lost-update prevention, cache validation)
      Etags make up for REST being stateless
 * partial content/range requests (handling very large content)
      This is very tricky to do, but can be powerful for some things
 * content encodings and transforms
      The phyical content (bytes) may differ from the logical content
-- 
Deron Meranda
From graham.dumpleton at gmail.com  Fri Jan  4 19:07:10 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Fri Jan  4 19:07:21 2008
Subject: [mod_python] Trouble on OSX - Leopard again
In-Reply-To: <90383F71-7927-4418-9468-20420BBF3C0C@nudgenudge.eu>
References: <90383F71-7927-4418-9468-20420BBF3C0C@nudgenudge.eu>
Message-ID: <88e286470801041607v15516c5djff8723ce78caae3@mail.gmail.com>

On 04/01/2008, Johannes Hoffart <johannes@nudgenudge.eu> wrote:
> Hi,
>
> I tried to install mod_python on osx and ran into the x86_64 trouble -
> I then followed the solution in this mailing list, which works nicely.
> There is one limitation, though, the _psp.so is still not x86_64:
>
> file _psp.so
> _psp.so: Mach-O universal binary with 2 architectures
> _psp.so (for architecture i386):        Mach-O bundle i386
> _psp.so (for architecture ppc7400):     Mach-O bundle ppc
>
> The corresponding output in the make process shows that it is only
> compiled for those two archs, but I cannot find the right place in the
> Makefile to add x86_64. Apache loads fine, but throws this error upon
> accessing a .psp file:
>
> ImportError: dlopen(/Library/Python/2.5/site-packages/mod_python/
> _psp.so, 2): no suitable image found.  Did find:
>         /Library/Python/2.5/site-packages/mod_python/_psp.so: no matching
> architecture in universal wrapper
>
> I hope someone can point me in the right direction.

Modify dist/setup.py.in around:

class PSPExtension(Extension):
    """a class that helps build the PSP extension"""
    def __init__(self, source_dir, include_dirs):
        Extension.__init__(self, "mod_python._psp",
                               [os.path.join(source_dir, source_file)
for source_file in
                                    ("psp_string.c", "psp_parser.c",
"_pspmodule.c")],
                                include_dirs=include_dirs
                           )

Add the required additional flags into the Extension definition. You
probably want to use extra_compile_args and extra_link_args. See:

  http://www.python.org/doc/2.4.4/dist/describing-extensions.html

After changes, you will need to run configure again.

Graham
From johannes at nudgenudge.eu  Sat Jan  5 04:21:09 2008
From: johannes at nudgenudge.eu (Johannes Hoffart)
Date: Sat Jan  5 04:21:52 2008
Subject: [mod_python] Trouble on OSX - Leopard again
In-Reply-To: <88e286470801041607v15516c5djff8723ce78caae3@mail.gmail.com>
References: <90383F71-7927-4418-9468-20420BBF3C0C@nudgenudge.eu>
	<88e286470801041607v15516c5djff8723ce78caae3@mail.gmail.com>
Message-ID: <F9089D27-D6F4-415C-9126-59EFBE41C784@nudgenudge.eu>

Thanks for the pointer, I got it to work! If anyone has the same  
problem, just change the part Graham mentioned to look like this:

class PSPExtension(Extension):
     """a class that helps build the PSP extension"""
     def __init__(self, source_dir, include_dirs):
         Extension.__init__(self, "mod_python._psp",
                                [os.path.join(source_dir, source_file)  
for source_file in
                                     ("psp_string.c", "psp_parser.c",  
"_pspmodule.c")],
                                 include_dirs=include_dirs,
				extra_link_args=['-arch', 'x86_64'],
				extra_compile_args=['-arch', 'x86_64']
                            )

Johannes

> On 05/01/2008, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
>
> Modify dist/setup.py.in around:
>
> class PSPExtension(Extension):
>    """a class that helps build the PSP extension"""
>    def __init__(self, source_dir, include_dirs):
>        Extension.__init__(self, "mod_python._psp",
>                               [os.path.join(source_dir, source_file)
> for source_file in
>                                    ("psp_string.c", "psp_parser.c",
> "_pspmodule.c")],
>                                include_dirs=include_dirs
>                           )
>
> Add the required additional flags into the Extension definition. You
> probably want to use extra_compile_args and extra_link_args. See:
>
>  http://www.python.org/doc/2.4.4/dist/describing-extensions.html
>
> After changes, you will need to run configure again.
>
> Graham

> On 04/01/2008, Johannes Hoffart <johannes@nudgenudge.eu> wrote:
>>
> Hi,
>
> I tried to install mod_python on osx and ran into the x86_64 trouble -
> I then followed the solution in this mailing list, which works nicely.
> There is one limitation, though, the _psp.so is still not x86_64:
>
> file _psp.so
> _psp.so: Mach-O universal binary with 2 architectures
> _psp.so (for architecture i386):        Mach-O bundle i386
> _psp.so (for architecture ppc7400):     Mach-O bundle ppc
>
> The corresponding output in the make process shows that it is only
> compiled for those two archs, but I cannot find the right place in the
> Makefile to add x86_64. Apache loads fine, but throws this error upon
> accessing a .psp file:
>
> ImportError: dlopen(/Library/Python/2.5/site-packages/mod_python/
> _psp.so, 2): no suitable image found.  Did find:
>        /Library/Python/2.5/site-packages/mod_python/_psp.so: no  
> matching
> architecture in universal wrapper
>
> I hope someone can point me in the right direction.

From graham.dumpleton at gmail.com  Sat Jan  5 22:51:00 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sat Jan  5 22:51:07 2008
Subject: [mod_python] Re: mod_python on leopard
In-Reply-To: <75672269-08A5-4E66-B62F-5E3277F6060C@pasker.net>
References: <75672269-08A5-4E66-B62F-5E3277F6060C@pasker.net>
Message-ID: <88e286470801051951s655e959if2957d0ff2b5cc63@mail.gmail.com>

On 06/01/2008, Bob Pasker <bob@pasker.net> wrote:
> Hi Justin and Graham -- i just updated the mod_python bug you guys
> reported about building mod_python on OS X. I was wondering if you had
> found a workaround. thanks, bob
>
> http://issues.apache.org/jira/browse/MODPYTHON-186

That issue isn't quite the same as current MacOS X Leopard issues.
There seemed to be a specific problem with one version of gcc/XCode
provided by Apple not coping with the potentially bogus command line
options being passed it.

The Leopard problem is that the -arch flags aren't being passed to the
compiler so as to create a fat object file. The default of creating a
i386 object is not sufficient as Apache on Leopard runs as x86_64.

You will find this issue discussed in mod_python mailing list
archives. There are a couple of parts to it. The first is the building
of the Apache module, the second is the building of the psp support
module for Python. See both:

  http://www.modpython.org/pipermail/mod_python/2007-October/024394.html
  http://www.modpython.org/pipermail/mod_python/2008-January/024635.html

If you can't follow through these discussions and get it working and
only need WSGI hosting ability, maybe look at mod_wsgi 2.0 which
already builds out of the box for Leopard.

Graham
From graham.dumpleton at gmail.com  Sat Jan  5 23:58:57 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sat Jan  5 23:59:03 2008
Subject: [mod_python] Re: mod_python on leopard
In-Reply-To: <60417678-F5A1-4998-BE6A-EE1E82174983@pasker.net>
References: <75672269-08A5-4E66-B62F-5E3277F6060C@pasker.net>
	<88e286470801051951s655e959if2957d0ff2b5cc63@mail.gmail.com>
	<60417678-F5A1-4998-BE6A-EE1E82174983@pasker.net>
Message-ID: <88e286470801052058v4b868981ya57cf4193c6e9774@mail.gmail.com>

Get rid of the space in the directory name where you have the
mod_python source code. ie., 'python stuff'.

Graham

On 06/01/2008, Bob Pasker <bob@pasker.net> wrote:
> It looks like these are fat binary and 64-bit intel problems.
>
> Im building for ppc and a skinny ppc binary will work fine.
>
> --bob
>
> ---------
> Sent from my mobile
>
> On Jan 5, 2008, at 19:51, "Graham Dumpleton"
> <graham.dumpleton@gmail.com> wrote:
>
> > On 06/01/2008, Bob Pasker <bob@pasker.net> wrote:
> >> Hi Justin and Graham -- i just updated the mod_python bug you guys
> >> reported about building mod_python on OS X. I was wondering if you
> >> had
> >> found a workaround. thanks, bob
> >>
> >> http://issues.apache.org/jira/browse/MODPYTHON-186
> >
> > That issue isn't quite the same as current MacOS X Leopard issues.
> > There seemed to be a specific problem with one version of gcc/XCode
> > provided by Apple not coping with the potentially bogus command line
> > options being passed it.
> >
> > The Leopard problem is that the -arch flags aren't being passed to the
> > compiler so as to create a fat object file. The default of creating a
> > i386 object is not sufficient as Apache on Leopard runs as x86_64.
> >
> > You will find this issue discussed in mod_python mailing list
> > archives. There are a couple of parts to it. The first is the building
> > of the Apache module, the second is the building of the psp support
> > module for Python. See both:
> >
> >  http://www.modpython.org/pipermail/mod_python/2007-October/
> > 024394.html
> >  http://www.modpython.org/pipermail/mod_python/2008-January/
> > 024635.html
> >
> > If you can't follow through these discussions and get it working and
> > only need WSGI hosting ability, maybe look at mod_wsgi 2.0 which
> > already builds out of the box for Leopard.
> >
> > Graham
> >
>
From webb.sprague at gmail.com  Sun Jan  6 23:50:20 2008
From: webb.sprague at gmail.com (Webb Sprague)
Date: Sun Jan  6 23:50:24 2008
Subject: [mod_python] Exceptions in the mod_python handler?
Message-ID: <b11ea23c0801062050g2f0dfe70kccd7156feb0b48fc@mail.gmail.com>

Hi all,

I have a mod_python handler, called "lc.py", which has a bunch of
functions -- mapped to pages --  called things "index",
"process_request", etc.  Before defining those functions, I connect to
the database with psycopg2 and pass that connection handle to each
function/ page.

<Directory /var/www/localhost/htdocs/lcfit>
    SetHandler mod_python
    PythonHandler mod_python.publisher
    PythonDebug On
</Directory>

# This is lc.py in the lcfit directory
dbcon = pyscopg2.connect("blah")
def index(req, dbcon=dbcon):
      curs = dbcon.cursor()
      # etc

This works fine usually.  However,  when the connection fails I don't
know how to get apache to send some text to the user saying "call the
admin and tell him to restart postgres."  At the moment I get a nice
stack trace that I know how to read, but I would like to catch the
exception, print something less intimidating, and quit processing the
handler. If I can somehow mark it so that apache knows to reload lc.py
and attempt to reconnect the database the next time (hopefully after
postgres is restarted), that would be especially great (touching the
file?).

Is this a bad design?  I am probably misunderstanding the order in
which things are called (handlers, functions, modules, etc...), but I
don't want each page to connect() and close() on each call, and I
don't know where else to put the connection code except in the main
handler.

Thanks again!
From scarfboy at gmail.com  Mon Jan  7 13:37:23 2008
From: scarfboy at gmail.com (Bart)
Date: Mon Jan  7 13:37:30 2008
Subject: [mod_python] Exceptions in the mod_python handler?
In-Reply-To: <b11ea23c0801062050g2f0dfe70kccd7156feb0b48fc@mail.gmail.com>
References: <b11ea23c0801062050g2f0dfe70kccd7156feb0b48fc@mail.gmail.com>
Message-ID: <b71082d80801071037n39cfef90hd065707ce296fd78@mail.gmail.com>

On Jan 7, 2008 5:50 AM, Webb Sprague <webb.sprague@gmail.com> wrote:
> Hi all,
>
> I have a mod_python handler, called "lc.py", which has a bunch of
> functions -- mapped to pages --  called things "index",
> "process_request", etc.  Before defining those functions, I connect to
> the database with psycopg2 and pass that connection handle to each
> function/ page.
>
> <Directory /var/www/localhost/htdocs/lcfit>
>     SetHandler mod_python
>     PythonHandler mod_python.publisher
>     PythonDebug On
> </Directory>
>
> # This is lc.py in the lcfit directory
> dbcon = pyscopg2.connect("blah")
> def index(req, dbcon=dbcon):
>       curs = dbcon.cursor()
>       # etc
>
> This works fine usually.  However,  when the connection fails I don't
> know how to get apache to send some text to the user saying "call the
> admin and tell him to restart postgres."  At the moment I get a nice
> stack trace that I know how to read, but I would like to catch the
> exception, print something less intimidating, and quit processing the
> handler.

The stack trace comes from PythonDebug being On, as you probably know.
You can turn it off and raise an error that causes apache to generate its
generic error page (for the HTTP code), but this is probably no more
informative.
Since you'll probably want something app-specific, you'll probably want to
catch the error inside python and generate your own error page.

Exactly what and how depends on your wishes. I have an app in which
I should really hide the stack trace muck, but it's relatively rare as I
catch most errors inside handler code anyway, so I can probably get away
with a generic error handler for the few I forgot.
I'm thinking of doing so via a decorator, which is my pet method
of non-redundantly adding handler-wide things to multiple handlers.


> If I can somehow mark it so that apache knows to reload lc.py
> and attempt to reconnect the database the next time (hopefully after
> postgres is restarted), that would be especially great (touching the
> file?).
>
> Is this a bad design?  I am probably misunderstanding the order in
> which things are called (handlers, functions, modules, etc...), but I
> don't want each page to connect() and close() on each call, and I
> don't know where else to put the connection code except in the main
> handler.

Leaving connections open between page loads is technically possible,
but opens a world of worry and bordercases.
As I recall, psycopg does connection pooling anyway, so I'd suggest
reading up on how to use it.


Regards,
--Bart
From webb.sprague at gmail.com  Mon Jan  7 16:59:04 2008
From: webb.sprague at gmail.com (Webb Sprague)
Date: Mon Jan  7 16:59:10 2008
Subject: Fwd: [mod_python] Exceptions in the mod_python handler?
In-Reply-To: <b11ea23c0801071057r178306sacdf2abbef2f84d@mail.gmail.com>
References: <b11ea23c0801062050g2f0dfe70kccd7156feb0b48fc@mail.gmail.com>
	<b71082d80801071037n39cfef90hd065707ce296fd78@mail.gmail.com>
	<b11ea23c0801071057r178306sacdf2abbef2f84d@mail.gmail.com>
Message-ID: <b11ea23c0801071359k467103a7uc814d19ab9a17393@mail.gmail.com>

whoops - meant to send to list


---------- Forwarded message ----------
From: Webb Sprague <webb.sprague@gmail.com>
Date: Jan 7, 2008 10:57 AM
Subject: Re: [mod_python] Exceptions in the mod_python handler?
To: Bart <scarfboy@gmail.com>


> The stack trace comes from PythonDebug being On, as you probably know.
> You can turn it off and raise an error that causes apache to generate its
> generic error page (for the HTTP code), but this is probably no more
> informative.
> Since you'll probably want something app-specific, you'll probably want to
> catch the error inside python and generate your own error page.

Exactly -- within module scope of the page handler, how does one catch
an exception and print something to the user through the apache
socket?  I don't have a "req" because I am not within a function
(rather in module scope only), so I can't call req.write(), and
vanilla  print doesn't print to the apache socket.

So, unfortunately, my question remains.

> Leaving connections open between page loads is technically possible,
> but opens a world of worry and bordercases.
> As I recall, psycopg does connection pooling anyway, so I'd suggest
> reading up on how to use it.

I will investigate, but I don't think this is the answer, really.

-W
From grisha at modpython.org  Mon Jan  7 21:27:20 2008
From: grisha at modpython.org (Major Ortiz)
Date: Mon Jan  7 21:27:35 2008
Subject: [mod_python] [SPAM] New Year discount on w4tches pQ5e
Message-ID: <jowyzSFCFTZgrisha@modpython.org>

Newest 2008 repl1ca watch3s collection!
15% off in January and huge choose of repl1cas!
http://www.beudyyte.com/

c2a7lpPE1j0u4A



From grisha at modpython.org  Tue Jan  8 09:07:34 2008
From: grisha at modpython.org (Brooks Rainey)
Date: Tue Jan  8 09:07:39 2008
Subject: [mod_python] [SPAM] New Year discount on w4tches zPDZg
Message-ID: <pbyvyOOBRSgrisha@modpython.org>

New Year is knocking, 0rder precious repl1ca w4tches!
Brand new models of w4tches, purses & bags from 2008!
http://www.skoeiwoo.com/

0AP3pyXQeEq1WT



From jevgenijsr at gmail.com  Wed Jan  9 09:01:57 2008
From: jevgenijsr at gmail.com (Jevgenijs Rogovs)
Date: Wed Jan  9 09:02:05 2008
Subject: [mod_python] Performance improvements: dynamic linking?
Message-ID: <99ba07460801090601s698dd814kf35646b3c19cf7f8@mail.gmail.com>

Hello everyone,

I'm experiencing performance issues with Trac (http://trac.edgewall.org/) ,
which were nailed down to mod_python, so now I'm looking for ways to
increase its performance.  First of all, it looks like on the system in
question it is linked statically (judging by the size of mod_python.so being
4,991,304 bytes), but I'd like to build it for dynamic linking. The question
is - how do I do that? No matter what I try, the result seems to be the
same...

Here's the environment: RH Enterprise Release 3 (kernel 2.4.20-8), Apache
HTTPD 2.0.54, Python 2.5.1, mod_python 3.3.1.

Thanks in advance!

With best regards,
J.R.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080109/3de11240/attachment.html
From roberto at connexer.com  Wed Jan  9 10:25:03 2008
From: roberto at connexer.com (Roberto =?iso-8859-1?Q?C=2E_S=E1nchez?=)
Date: Wed Jan  9 10:25:09 2008
Subject: [mod_python] Performance improvements: dynamic linking?
In-Reply-To: <99ba07460801090601s698dd814kf35646b3c19cf7f8@mail.gmail.com>
References: <99ba07460801090601s698dd814kf35646b3c19cf7f8@mail.gmail.com>
Message-ID: <20080109152503.GA15205@connexer.com>

On Wed, Jan 09, 2008 at 03:01:57PM +0100, Jevgenijs Rogovs wrote:
> Hello everyone,
> 
> I'm experiencing performance issues with Trac (http://trac.edgewall.org/) ,
> which were nailed down to mod_python, so now I'm looking for ways to
> increase its performance.  First of all, it looks like on the system in
> question it is linked statically (judging by the size of mod_python.so being
> 4,991,304 bytes), but I'd like to build it for dynamic linking. The question
> is - how do I do that? No matter what I try, the result seems to be the
> same...
> 
> Here's the environment: RH Enterprise Release 3 (kernel 2.4.20-8), Apache
> HTTPD 2.0.54, Python 2.5.1, mod_python 3.3.1.
> 
Judging by the version numbers, I am guessing that you are compiling
your own Python and mod_python.  Have you considered that it might be
that the library is just not stripped?  You can check by running this
command:

file /path/to/mod_python.so

It will tell you if it is statically linked or dynamically linked.
Additionally it will tell you if the debugging symbols have been
stripped.  If they have not, they could also take up a large amount of
space.

Regards,

-Roberto
-- 
Roberto C. S?nchez
http://people.connexer.com/~roberto
http://www.connexer.com
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: Digital signature
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080109/f3d04dee/attachment.bin
From jevgenijsr at gmail.com  Wed Jan  9 11:03:55 2008
From: jevgenijsr at gmail.com (Jevgenijs Rogovs)
Date: Wed Jan  9 11:04:00 2008
Subject: [SPAM] Re: [mod_python] Performance improvements: dynamic linking?
In-Reply-To: <20080109152503.GA15205@connexer.com>
References: <99ba07460801090601s698dd814kf35646b3c19cf7f8@mail.gmail.com>
	<20080109152503.GA15205@connexer.com>
Message-ID: <99ba07460801090803y59757486ved80293c7297692b@mail.gmail.com>

Roberto,

You were right, I built mod_python myself, and it is not stripped. Here's
the output of the file command:

ELF 32-bit LSB shared object, Intel 80386, version 1 (SYSV), not stripped

So, what do I do to strip those symbols? I am building by the book, i.e.

./configure --with-aspx=/path/to/aspx
make
make install

Should there be some additional switch added to the configure command, or?

Anyhow, thanks for your help!

With best regards,
J.R.

On Jan 9, 2008 4:25 PM, Roberto C. S?nchez <roberto@connexer.com> wrote:

> On Wed, Jan 09, 2008 at 03:01:57PM +0100, Jevgenijs Rogovs wrote:
> > Hello everyone,
> >
> > I'm experiencing performance issues with Trac (http://trac.edgewall.org/)
> ,
> > which were nailed down to mod_python, so now I'm looking for ways to
> > increase its performance.  First of all, it looks like on the system in
> > question it is linked statically (judging by the size of mod_python.so
> being
> > 4,991,304 bytes), but I'd like to build it for dynamic linking. The
> question
> > is - how do I do that? No matter what I try, the result seems to be the
> > same...
> >
> > Here's the environment: RH Enterprise Release 3 (kernel 2.4.20-8),
> Apache
> > HTTPD 2.0.54, Python 2.5.1, mod_python 3.3.1.
> >
> Judging by the version numbers, I am guessing that you are compiling
> your own Python and mod_python.  Have you considered that it might be
> that the library is just not stripped?  You can check by running this
> command:
>
> file /path/to/mod_python.so
>
> It will tell you if it is statically linked or dynamically linked.
> Additionally it will tell you if the debugging symbols have been
> stripped.  If they have not, they could also take up a large amount of
> space.
>
> Regards,
>
> -Roberto
> --
> Roberto C. S?nchez
> http://people.connexer.com/~roberto<http://people.connexer.com/%7Eroberto>
> http://www.connexer.com
>
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.6 (GNU/Linux)
>
> iD8DBQFHhOdP5SXWIKfIlGQRAjBOAJ4jyq5gEAP2h9BPP2IC1Ukea6PhmACfeSRB
> tKDlePepvRgukxEs62mGnmA=
> =C/Tq
> -----END PGP SIGNATURE-----
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080109/017e8ff7/attachment.html
From mateusz at ant.gliwice.pl  Wed Jan  9 11:18:51 2008
From: mateusz at ant.gliwice.pl (Mateusz Korniak)
Date: Wed Jan  9 11:20:56 2008
Subject: [mod_python] Performance improvements: dynamic linking?
In-Reply-To: <99ba07460801090803y59757486ved80293c7297692b@mail.gmail.com>
References: <99ba07460801090601s698dd814kf35646b3c19cf7f8@mail.gmail.com>
	<20080109152503.GA15205@connexer.com>
	<99ba07460801090803y59757486ved80293c7297692b@mail.gmail.com>
Message-ID: <200801091718.51678.mateusz@ant.gliwice.pl>

On Wednesday 09 of January 2008, Jevgenijs Rogovs wrote:
> You were right, I built mod_python myself, and it is not stripped. Here's
> the output of the file command:
>
> ELF 32-bit LSB shared object, Intel 80386, version 1 (SYSV), not stripped
>
> So, what do I do to strip those symbols? I am building by the book, i.e.
>
> ./configure --with-aspx=/path/to/aspx
> make

make dso ?

> make install
>
> Should there be some additional switch added to the configure command, or?

$ ls -la /usr/lib/apache/mod_python.so
-rwxr-xr-x 1 root root 90072 2006-11-17 12:34 /usr/lib/apache/mod_python.so
$ file /usr/lib/apache/mod_python.so
/usr/lib/apache/mod_python.so: ELF 32-bit LSB shared object, Intel 80386, 
version 1 (SYSV), stripped

It is taken from rpm from PLD .spec [1] file.

%build
%{__aclocal}
%{__autoconf}
%configure \
        --with-apxs=%{apxs}
%{__make} dso

Linking patch [2] seems to be used also ...

[1]:  http://cvs.pld-linux.org/cgi-bin/cvsweb.cgi/SPECS/apache-mod_python.spec
[2]:  $ cat ../SOURCES/apache-mod_python-ldflags.patch
--- mod_python-3.1.3/configure.in.ldflags
+++ mod_python-3.1.3/configure.in
@@ -225,7 +225,7 @@
     LDFLAGS="${LDFLAGS} -Wl,-framework,Python"
   fi
 else
-  LDFLAGS="${LDFLAGS} -L${PyLIBPL}"
+  #LDFLAGS="${LDFLAGS} -L${PyLIBPL}"
   AC_CHECK_LIB(python${PyVERSION}, Py_NewInterpreter,
              [ PyPYTHONLIBS="-lpython${PyVERSION}" ],
              [ LDFLAGS="$save_LDFLAGS"

Regards, HiH,
-- 
Mateusz Korniak
From jevgenijsr at gmail.com  Wed Jan  9 11:33:38 2008
From: jevgenijsr at gmail.com (Jevgenijs Rogovs)
Date: Wed Jan  9 11:33:41 2008
Subject: [mod_python] Performance improvements: dynamic linking?
In-Reply-To: <200801091718.51678.mateusz@ant.gliwice.pl>
References: <99ba07460801090601s698dd814kf35646b3c19cf7f8@mail.gmail.com>
	<20080109152503.GA15205@connexer.com>
	<99ba07460801090803y59757486ved80293c7297692b@mail.gmail.com>
	<200801091718.51678.mateusz@ant.gliwice.pl>
Message-ID: <99ba07460801090833u2fe2c18dr5b188b1ae9301c68@mail.gmail.com>

Mateusz,

Thanks, but unfortunately, "make dso" yields tha same huge >4MB
mod_python.so in the end... Any other ideas?

With best regards,
J.R.

On Jan 9, 2008 5:18 PM, Mateusz Korniak <mateusz@ant.gliwice.pl> wrote:

> On Wednesday 09 of January 2008, Jevgenijs Rogovs wrote:
> > You were right, I built mod_python myself, and it is not stripped.
> Here's
> > the output of the file command:
> >
> > ELF 32-bit LSB shared object, Intel 80386, version 1 (SYSV), not
> stripped
> >
> > So, what do I do to strip those symbols? I am building by the book, i.e.
> >
> > ./configure --with-aspx=/path/to/aspx
> > make
>
> make dso ?
>
> > make install
> >
> > Should there be some additional switch added to the configure command,
> or?
>
> $ ls -la /usr/lib/apache/mod_python.so
> -rwxr-xr-x 1 root root 90072 2006-11-17 12:34
> /usr/lib/apache/mod_python.so
> $ file /usr/lib/apache/mod_python.so
> /usr/lib/apache/mod_python.so: ELF 32-bit LSB shared object, Intel 80386,
> version 1 (SYSV), stripped
>
> It is taken from rpm from PLD .spec [1] file.
>
> %build
> %{__aclocal}
> %{__autoconf}
> %configure \
>        --with-apxs=%{apxs}
> %{__make} dso
>
> Linking patch [2] seems to be used also ...
>
> [1]:
> http://cvs.pld-linux.org/cgi-bin/cvsweb.cgi/SPECS/apache-mod_python.spec
> [2]:  $ cat ../SOURCES/apache-mod_python-ldflags.patch
> --- mod_python-3.1.3/configure.in.ldflags
> +++ mod_python-3.1.3/configure.in
> @@ -225,7 +225,7 @@
>     LDFLAGS="${LDFLAGS} -Wl,-framework,Python"
>   fi
>  else
> -  LDFLAGS="${LDFLAGS} -L${PyLIBPL}"
> +  #LDFLAGS="${LDFLAGS} -L${PyLIBPL}"
>   AC_CHECK_LIB(python${PyVERSION}, Py_NewInterpreter,
>              [ PyPYTHONLIBS="-lpython${PyVERSION}" ],
>              [ LDFLAGS="$save_LDFLAGS"
>
> Regards, HiH,
> --
> Mateusz Korniak
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080109/a9dcd8ac/attachment.html
From roberto at connexer.com  Wed Jan  9 13:17:14 2008
From: roberto at connexer.com (Roberto =?iso-8859-1?Q?C=2E_S=E1nchez?=)
Date: Wed Jan  9 13:17:20 2008
Subject: [mod_python] Performance improvements: dynamic linking?
In-Reply-To: <99ba07460801090803y59757486ved80293c7297692b@mail.gmail.com>
References: <99ba07460801090601s698dd814kf35646b3c19cf7f8@mail.gmail.com>
	<20080109152503.GA15205@connexer.com>
	<99ba07460801090803y59757486ved80293c7297692b@mail.gmail.com>
Message-ID: <20080109181714.GA16021@connexer.com>

On Wed, Jan 09, 2008 at 05:03:55PM +0100, Jevgenijs Rogovs wrote:
> Roberto,
> 
> You were right, I built mod_python myself, and it is not stripped. Here's
> the output of the file command:
> 
> ELF 32-bit LSB shared object, Intel 80386, version 1 (SYSV), not stripped
> 
> So, what do I do to strip those symbols? I am building by the book, i.e.
> 
> ./configure --with-aspx=/path/to/aspx
> make
> make install
> 

Could you post the output of your build process as gzipped attachments?

./configure --with-apxs=/path/to/apxs 2>&1 |tee ~/config.log
make 2>&1 |tee ~/make.log
make install 2>&1 |tee ~/install.log

Regards,

-Roberto

-- 
Roberto C. S?nchez
http://people.connexer.com/~roberto
http://www.connexer.com
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: Digital signature
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080109/97f64fa9/attachment.bin
From graham.dumpleton at gmail.com  Wed Jan  9 17:20:02 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Wed Jan  9 17:20:10 2008
Subject: [mod_python] Performance improvements: dynamic linking?
In-Reply-To: <99ba07460801090601s698dd814kf35646b3c19cf7f8@mail.gmail.com>
References: <99ba07460801090601s698dd814kf35646b3c19cf7f8@mail.gmail.com>
Message-ID: <88e286470801091420u67a19b07n37f2cb2d21a735f@mail.gmail.com>

On 10/01/2008, Jevgenijs Rogovs <jevgenijsr@gmail.com> wrote:
> Hello everyone,
>
> I'm experiencing performance issues with Trac (http://trac.edgewall.org/) ,
> which were nailed down to mod_python, so now I'm looking for ways to
> increase its performance.  First of all, it looks like on the system in
> question it is linked statically (judging by the size of mod_python.so being
> 4,991,304 bytes), but I'd like to build it for dynamic linking. The question
> is - how do I do that? No matter what I try, the result seems to be the
> same...
>
> Here's the environment: RH Enterprise Release 3 (kernel 2.4.20-8), Apache
> HTTPD 2.0.54, Python 2.5.1, mod_python 3.3.1.

The problem is that you didn't configure and install Python such that
it generated a shared library for Python. Nothing to do with
mod_python.

For details see section 'Lack Of Python Shared Library' of:

  http://code.google.com/p/modwsgi/wiki/InstallationIssues

This is for mod_wsgi (which performs better again than mod_python for
WSGI hosting), but still relevant.

So, fix your Python installation. That is all you should need to do.

Graham
From scarfboy at gmail.com  Wed Jan  9 19:05:53 2008
From: scarfboy at gmail.com (Bart)
Date: Wed Jan  9 19:05:59 2008
Subject: [mod_python] Exceptions in the mod_python handler?
In-Reply-To: <b11ea23c0801071057r178306sacdf2abbef2f84d@mail.gmail.com>
References: <b11ea23c0801062050g2f0dfe70kccd7156feb0b48fc@mail.gmail.com>
	<b71082d80801071037n39cfef90hd065707ce296fd78@mail.gmail.com>
	<b11ea23c0801071057r178306sacdf2abbef2f84d@mail.gmail.com>
Message-ID: <b71082d80801091605h3caa3bdak8960834324a42af8@mail.gmail.com>

On Jan 7, 2008 7:57 PM, Webb Sprague <webb.sprague@gmail.com> wrote:
> > The stack trace comes from PythonDebug being On, as you probably know.
> > You can turn it off and raise an error that causes apache to generate its
> > generic error page (for the HTTP code), but this is probably no more
> > informative.
> > Since you'll probably want something app-specific, you'll probably want to
> > catch the error inside python and generate your own error page.
>
> Exactly -- within module scope of the page handler, how does one catch
> an exception and print something to the user through the apache
> socket?  I don't have a "req" because I am not within a function
> (rather in module scope only), so I can't call req.write(), and
> vanilla  print doesn't print to the apache socket.
>
> So, unfortunately, my question remains.

Module scope is unrelated to a request. As I recall,
there is no official m_p way to add something around handlers,
exception handling or otherwise.

This is why I suggested a decorator. For things like mod_python,
it's an unobtrusive, non-code-redundant way to wrap handlers
in some code anyway.
(I e.g. add transparent unicode output the same way)


> > Leaving connections open between page loads is technically possible,
> > but opens a world of worry and bordercases.
> > As I recall, psycopg does connection pooling anyway, so I'd suggest
> > reading up on how to use it.
>
> I will investigate, but I don't think this is the answer, really.

Why not? What are your needs, and how does it not cover them?


--Bart
From graham.dumpleton at gmail.com  Wed Jan  9 19:27:11 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Wed Jan  9 19:27:30 2008
Subject: [mod_python] Exceptions in the mod_python handler?
In-Reply-To: <b11ea23c0801062050g2f0dfe70kccd7156feb0b48fc@mail.gmail.com>
References: <b11ea23c0801062050g2f0dfe70kccd7156feb0b48fc@mail.gmail.com>
Message-ID: <88e286470801091627v2f188476tf9f209f913f4c20f@mail.gmail.com>

On 07/01/2008, Webb Sprague <webb.sprague@gmail.com> wrote:
> Hi all,
>
> I have a mod_python handler, called "lc.py", which has a bunch of
> functions -- mapped to pages --  called things "index",
> "process_request", etc.  Before defining those functions, I connect to
> the database with psycopg2 and pass that connection handle to each
> function/ page.
>
> <Directory /var/www/localhost/htdocs/lcfit>
>     SetHandler mod_python
>     PythonHandler mod_python.publisher
>     PythonDebug On
> </Directory>
>
> # This is lc.py in the lcfit directory
> dbcon = pyscopg2.connect("blah")
> def index(req, dbcon=dbcon):
>       curs = dbcon.cursor()
>       # etc
>
> This works fine usually.  However,  when the connection fails I don't
> know how to get apache to send some text to the user saying "call the
> admin and tell him to restart postgres."  At the moment I get a nice
> stack trace that I know how to read, but I would like to catch the
> exception, print something less intimidating, and quit processing the
> handler. If I can somehow mark it so that apache knows to reload lc.py
> and attempt to reconnect the database the next time (hopefully after
> postgres is restarted), that would be especially great (touching the
> file?).
>
> Is this a bad design?

Yes it is bad design.

At least do something like:

  dbcon = None
  def getdbcon():
    if not dbcon:
        dbcon = pyscopg2.connect("blah")
    return dbcon

  def index(req, dbcon=dbcon):
       curs = getdbcon().cursor()

That way the exception is raised from within your handler.

Note that this code is not thread safe, so you should make it so if
using worker MPM with Apache. This would require at the minimum locks
around the check to see if the dbcon has already been created or not.

You may also have to deal with issues of module reloading as well, so
make sure you read documentation for import_module() in:

  http://www.modpython.org/live/current/doc-html/pyapi-apmeth.html

Especially look for section on __mp_clone__() hook function.

If you aren't using mod_python 3.3.1 then upgrade.

Depending on the database being used, it is easier and not much less
efficient to simply create the database connection for very request
that requires it. That will save you a lot of trouble.

Graham
From jevgenijsr at gmail.com  Thu Jan 10 08:24:06 2008
From: jevgenijsr at gmail.com (Jevgenijs Rogovs)
Date: Thu Jan 10 08:24:20 2008
Subject: [mod_python] Performance improvements: dynamic linking?
In-Reply-To: <88e286470801091420u67a19b07n37f2cb2d21a735f@mail.gmail.com>
References: <99ba07460801090601s698dd814kf35646b3c19cf7f8@mail.gmail.com>
	<88e286470801091420u67a19b07n37f2cb2d21a735f@mail.gmail.com>
Message-ID: <99ba07460801100524j263d507cyf776453eb33a5270@mail.gmail.com>

Graham,

Thanks for the great tip! Rebuilt Python with --enable-shared, rebuilt
mod_python - no problem at all. And it seems to have improved the overall
Trac performance slightly.

Thanks again!

With best regards,
J.R.

On Jan 9, 2008 11:20 PM, Graham Dumpleton <graham.dumpleton@gmail.com>
wrote:

> On 10/01/2008, Jevgenijs Rogovs <jevgenijsr@gmail.com> wrote:
> > Hello everyone,
> >
> > I'm experiencing performance issues with Trac (http://trac.edgewall.org/)
> ,
> > which were nailed down to mod_python, so now I'm looking for ways to
> > increase its performance.  First of all, it looks like on the system in
> > question it is linked statically (judging by the size of mod_python.so
> being
> > 4,991,304 bytes), but I'd like to build it for dynamic linking. The
> question
> > is - how do I do that? No matter what I try, the result seems to be the
> > same...
> >
> > Here's the environment: RH Enterprise Release 3 (kernel 2.4.20-8),
> Apache
> > HTTPD 2.0.54, Python 2.5.1, mod_python 3.3.1.
>
> The problem is that you didn't configure and install Python such that
> it generated a shared library for Python. Nothing to do with
> mod_python.
>
> For details see section 'Lack Of Python Shared Library' of:
>
>  http://code.google.com/p/modwsgi/wiki/InstallationIssues
>
> This is for mod_wsgi (which performs better again than mod_python for
> WSGI hosting), but still relevant.
>
> So, fix your Python installation. That is all you should need to do.
>
> Graham
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080110/2a4bbc5a/attachment.html
From syahreza.octadian at gmail.com  Fri Jan 11 02:40:12 2008
From: syahreza.octadian at gmail.com (syahreza octadian)
Date: Fri Jan 11 02:40:46 2008
Subject: [mod_python] Please help.......import gzip error
In-Reply-To: <b71082d80801091605h3caa3bdak8960834324a42af8@mail.gmail.com>
References: <b11ea23c0801062050g2f0dfe70kccd7156feb0b48fc@mail.gmail.com>
	<b71082d80801071037n39cfef90hd065707ce296fd78@mail.gmail.com>
	<b11ea23c0801071057r178306sacdf2abbef2f84d@mail.gmail.com>
	<b71082d80801091605h3caa3bdak8960834324a42af8@mail.gmail.com>
Message-ID: <1200037212.7667.2.camel@bukittunggul>

Dear all,

i'm new using python, and i have problem while import gzip? is anyone
can help me. i'm using sun os.

The error message like this:
bash-3.00$ python
Python 2.5 (r25:51908, Sep 20 2006, 03:46:40) 
[GCC 3.4.6] on sunos5
Type "help", "copyright", "credits" or "license" for more information.
>>> import gzip
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "/usr/local/lib/python2.5/gzip.py", line 9, in <module>
    import zlib
ImportError: ld.so.1: python: fatal: relocation error:
file /usr/local/lib/python2.5/lib-dynload/zlib.so: symbol inflateCopy:
referenced symbol not found



Thx
Syahreza Octadian

From graham.dumpleton at gmail.com  Fri Jan 11 04:29:41 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Fri Jan 11 04:29:50 2008
Subject: [mod_python] Please help.......import gzip error
In-Reply-To: <1200037212.7667.2.camel@bukittunggul>
References: <b11ea23c0801062050g2f0dfe70kccd7156feb0b48fc@mail.gmail.com>
	<b71082d80801071037n39cfef90hd065707ce296fd78@mail.gmail.com>
	<b11ea23c0801071057r178306sacdf2abbef2f84d@mail.gmail.com>
	<b71082d80801091605h3caa3bdak8960834324a42af8@mail.gmail.com>
	<1200037212.7667.2.camel@bukittunggul>
Message-ID: <88e286470801110129p442498e6x49bd34457ba16ce8@mail.gmail.com>

This group is about mod_python, not Python itself.

Ask instead for help on the main Python mailing list at:

  http://groups.google.com/group/comp.lang.python/topics?lnk=lr

Graham

On 11/01/2008, syahreza octadian <syahreza.octadian@gmail.com> wrote:
> Dear all,
>
> i'm new using python, and i have problem while import gzip? is anyone
> can help me. i'm using sun os.
>
> The error message like this:
> bash-3.00$ python
> Python 2.5 (r25:51908, Sep 20 2006, 03:46:40)
> [GCC 3.4.6] on sunos5
> Type "help", "copyright", "credits" or "license" for more information.
> >>> import gzip
> Traceback (most recent call last):
>   File "<stdin>", line 1, in <module>
>   File "/usr/local/lib/python2.5/gzip.py", line 9, in <module>
>     import zlib
> ImportError: ld.so.1: python: fatal: relocation error:
> file /usr/local/lib/python2.5/lib-dynload/zlib.so: symbol inflateCopy:
> referenced symbol not found
>
>
>
> Thx
> Syahreza Octadian
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From mcassiano at manord.com  Fri Jan 11 11:28:48 2008
From: mcassiano at manord.com (Cassiano, Marco)
Date: Fri Jan 11 11:28:56 2008
Subject: [mod_python] Mod_python and kerberos authentication (mod_auth_kerb)
Message-ID: <BC53C974C3B9E542BC0A9BD4C5B1168A03EB07A5@NEWMAIL.manord.com>

Hi all,
 
I've just configured our apache server (Linux RedHat) for kerberos authentication to allow our windows domain users to access it without having to reauthenticate.
Everything works fine for a plain html directory, so I'm pretty sure that the kerberos configuration for the apache server is working.
When I try to specify Kerberos authentication together with mod_python it's not working. I got the message : 
 
 

Bad Request


Your browser sent a request that this server could not understand.

 

My httpd configuration is :


Alias /login/ "/var/www/kerb/login/"


<Directory "/var/www/kerb/login">
##  AuthName "Kerberos Login"
  AuthType Kerberos
  KrbAuthRealm FOO.COM
  KrbServiceName HTTP/apache.foo.com@FOO.COM <mailto:HTTP/apache.foo.com@FOO.COM> 
  Krb5Keytab /etc/httpd/conf/apache.tab
  KrbMethodNegotiate on
  KrbMethodK5Passwd off
#  KrbSaveCredentials off
#  KrbVerifyKDC off
  Require valid-user

  Order Deny,Allow
  Deny from all
  Allow from foo.com
  Allow from 127.0.0.1

  SetHandler mod_python
  PythonHandler mod_python.publisher | .py
  PythonDebug on
  PythonOption ApplicationPath '/'

</Directory>


Thanks in advance for your advice

Marco Cassiano 
  
Manifatture del Nord srl 

Italy


 

---------------------------------------------------------------------------------------------

Il contenuto della presente comunicazione ? riservato e destinato esclusivamente ai destinatari indicati. Nel caso in cui sia ricevuto da persona diversa dal destinatario sono proibite la diffusione, la distribuzione e la copia. Nel caso riceveste la presente per errore, Vi preghiamo di informarci e di distruggerlo e/o cancellarlo dal Vostro computer, senza utilizzare i dati contenuti.

 

La presente comunicazione (comprensiva dei documenti allegati) non avr? valore di proposta contrattuale e/o accettazione di proposte provenienti dal destinatario, n? rinuncia o riconoscimento di diritti, debiti e/o crediti, n? sar? impegnativa, qualora non sia sottoscritto successivo accordo da chi pu? validamente obbligarci. Non deriver? alcuna responsabilit? precontrattuale a ns. carico, se la presente non sia seguita da contratto sottoscritto dalle parti.

---------------------------------------------------------------------------------------------

The contents of the present communication is strictly confidential and reserved solely to the referred addressees. In the event was received by person different from the addressee, it is forbidden the diffusion, distribution and copy. In the event you have received it mistakenly we ask you to inform us and to destroy and/or to delete it by your computer, without using the data herein contained.

 

The present message (eventual annexes inclusive) shall not be considered any contractual proposal and/or acceptance of offer coming from the addressee, nor waiver neither recognizance of rights, debts and/or credits, and it shall not be binding, when it is not executed a subsequent agreement by person who could lawfully represent us. No pre-contractual liability shall derive to us, when the present communication is not followed by any binding agreement between the parties.

---------------------------------------------------------------------------------------------

 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080111/5f294aaf/attachment.html
From graham.dumpleton at gmail.com  Fri Jan 11 16:24:15 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Fri Jan 11 16:24:35 2008
Subject: [mod_python] Mod_python and kerberos authentication
	(mod_auth_kerb)
In-Reply-To: <BC53C974C3B9E542BC0A9BD4C5B1168A03EB07A5@NEWMAIL.manord.com>
References: <BC53C974C3B9E542BC0A9BD4C5B1168A03EB07A5@NEWMAIL.manord.com>
Message-ID: <88e286470801111324j7212fbcbu90a8c19bcd4dc9e4@mail.gmail.com>

When using mod_python.publisher, you would get a Bad Request error if
the request wasn't either a GET or POST. What is the type of HTTP
request?

Graham

On 12/01/2008, Cassiano, Marco <mcassiano@manord.com> wrote:
>
>
> Hi all,
>
> I've just configured our apache server (Linux RedHat) for kerberos
> authentication to allow our windows domain users to access it without having
> to reauthenticate.
> Everything works fine for a plain html directory, so I'm pretty sure that
> the kerberos configuration for the apache server is working.
> When I try to specify Kerberos authentication together with mod_python it's
> not working. I got the message :
>
>
>
> Bad Request
>
> Your browser sent a request that this server could not understand.
>
>
>
> My httpd configuration is :
>
>
> Alias /login/ "/var/www/kerb/login/"
>
>
> <Directory "/var/www/kerb/login">
> ##  AuthName "Kerberos Login"
>   AuthType Kerberos
>   KrbAuthRealm FOO.COM
>   KrbServiceName HTTP/apache.foo.com@FOO.COM
>   Krb5Keytab /etc/httpd/conf/apache.tab
>   KrbMethodNegotiate on
>   KrbMethodK5Passwd off
> #  KrbSaveCredentials off
> #  KrbVerifyKDC off
>   Require valid-user
>
>   Order Deny,Allow
>   Deny from all
>   Allow from foo.com
>   Allow from 127.0.0.1
>
>   SetHandler mod_python
>   PythonHandler mod_python.publisher | .py
>   PythonDebug on
>   PythonOption ApplicationPath '/'
>
> </Directory>
>
>
> Thanks in advance for your advice
>
>
> Marco Cassiano
>
> Manifatture del Nord srl
>
> Italy
>
>
>
>
> ---------------------------------------------------------------------------------------------
>
> Il contenuto della presente comunicazione ? riservato e destinato
> esclusivamente ai destinatari indicati. Nel caso in cui sia ricevuto da
> persona diversa dal destinatario sono proibite la diffusione, la
> distribuzione e la copia. Nel caso riceveste la presente per errore, Vi
> preghiamo di informarci e di distruggerlo e/o cancellarlo dal Vostro
> computer, senza utilizzare i dati contenuti.
>
>
>
> La presente comunicazione (comprensiva dei documenti allegati) non avr?
> valore di proposta contrattuale e/o accettazione di proposte provenienti dal
> destinatario, n? rinuncia o riconoscimento di diritti, debiti e/o crediti,
> n? sar? impegnativa, qualora non sia sottoscritto successivo accordo da chi
> pu? validamente obbligarci. Non deriver? alcuna responsabilit?
> precontrattuale a ns. carico, se la presente non sia seguita da contratto
> sottoscritto dalle parti.
>
> ---------------------------------------------------------------------------------------------
>
> The contents of the present communication is strictly confidential and
> reserved solely to the referred addressees. In the event was received by
> person different from the addressee, it is forbidden the diffusion,
> distribution and copy. In the event you have received it mistakenly we ask
> you to inform us and to destroy and/or to delete it by your computer,
> without using the data herein contained.
>
>
>
> The present message (eventual annexes inclusive) shall not be considered any
> contractual proposal and/or acceptance of offer coming from the addressee,
> nor waiver neither recognizance of rights, debts and/or credits, and it
> shall not be binding, when it is not executed a subsequent agreement by
> person who could lawfully represent us. No pre-contractual liability shall
> derive to us, when the present communication is not followed by any binding
> agreement between the parties.
>
> ---------------------------------------------------------------------------------------------
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>

From rdacker at pacbell.net  Sat Jan 12 00:29:13 2008
From: rdacker at pacbell.net (dudley ackerman)
Date: Sat Jan 12 00:29:21 2008
Subject: [mod_python] leopard - no interpret 
Message-ID: <74174BDB-B2AB-422C-88B5-2DA1773E768F@pacbell.net>

text is dumped to web page instead of being interpreted.

using apple python and apache2 on leopard macbook pro:
mod_python/3.3.1 Python/2.5.1 configured
i built mod_python with -arch i386 and -arch x86-64 in the mod_python  
src/makefile - no problem.

in httpd.conf i have:
<Directory "/Library/Webserver/Documents">
     AddHandler mod_python .py
     PythonHandler mod_python.publisher
     PythonDebug On
</Directory>


my test script has:
from mod_python import apache

def hello(req):
   req.content_type = "text/plain"
   req.write("Hollow Earth")
   return

actually, when i try localhost/mptest.py/hello, i get 'file not found' -
going to localhost/mptest.py gives me the text dump of the file.

any suggestions?
From graham.dumpleton at gmail.com  Sat Jan 12 00:36:07 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sat Jan 12 00:36:14 2008
Subject: [mod_python] leopard - no interpret
In-Reply-To: <74174BDB-B2AB-422C-88B5-2DA1773E768F@pacbell.net>
References: <74174BDB-B2AB-422C-88B5-2DA1773E768F@pacbell.net>
Message-ID: <88e286470801112136v71270f3l86906a5cb6a280f6@mail.gmail.com>

Have you tried a basic mod_python handler first rather than trying to
get publisher working? See:

  http://www.dscpl.com.au/wiki/ModPython/Articles/GettingModPythonWorking

for suggested path to at least getting basic handler working first.

Graham

On 12/01/2008, dudley ackerman <rdacker@pacbell.net> wrote:
> text is dumped to web page instead of being interpreted.
>
> using apple python and apache2 on leopard macbook pro:
> mod_python/3.3.1 Python/2.5.1 configured
> i built mod_python with -arch i386 and -arch x86-64 in the mod_python
> src/makefile - no problem.
>
> in httpd.conf i have:
> <Directory "/Library/Webserver/Documents">
>      AddHandler mod_python .py
>      PythonHandler mod_python.publisher
>      PythonDebug On
> </Directory>
>
>
> my test script has:
> from mod_python import apache
>
> def hello(req):
>    req.content_type = "text/plain"
>    req.write("Hollow Earth")
>    return
>
> actually, when i try localhost/mptest.py/hello, i get 'file not found' -
> going to localhost/mptest.py gives me the text dump of the file.
>
> any suggestions?
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From rdacker at pacbell.net  Sat Jan 12 00:49:20 2008
From: rdacker at pacbell.net (dudley ackerman)
Date: Sat Jan 12 00:49:29 2008
Subject: [mod_python] leopard - no interpret
In-Reply-To: <88e286470801112136v71270f3l86906a5cb6a280f6@mail.gmail.com>
References: <74174BDB-B2AB-422C-88B5-2DA1773E768F@pacbell.net>
	<88e286470801112136v71270f3l86906a5cb6a280f6@mail.gmail.com>
Message-ID: <B8322189-85D4-4922-A30F-2D47AE4A442F@pacbell.net>


On Jan 11, 2008, at 9:36 PM, Graham Dumpleton wrote:

> Have you tried a basic mod_python handler first rather than trying to
> get publisher working? See:
>
>  http://www.dscpl.com.au/wiki/ModPython/Articles/GettingModPythonWorking
>
> for suggested path to at least getting basic handler working first.
>
> Graham

yes - i get the same behavior -- a text dump of the file
  - unless i end the url with a slash - then i get 'not found'.

> On 12/01/2008, dudley ackerman <rdacker@pacbell.net> wrote:
>> text is dumped to web page instead of being interpreted.
>>
>> using apple python and apache2 on leopard macbook pro:
>> mod_python/3.3.1 Python/2.5.1 configured
>> i built mod_python with -arch i386 and -arch x86-64 in the mod_python
>> src/makefile - no problem.
>>
>> in httpd.conf i have:
>> <Directory "/Library/Webserver/Documents">
>>     AddHandler mod_python .py
>>     PythonHandler mod_python.publisher
>>     PythonDebug On
>> </Directory>
>>
>>
>> my test script has:
>> from mod_python import apache
>>
>> def hello(req):
>>   req.content_type = "text/plain"
>>   req.write("Hollow Earth")
>>   return
>>
>> actually, when i try localhost/mptest.py/hello, i get 'file not  
>> found' -
>> going to localhost/mptest.py gives me the text dump of the file.
>>
>> any suggestions?
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>

From graham.dumpleton at gmail.com  Sat Jan 12 00:58:14 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sat Jan 12 00:58:21 2008
Subject: [mod_python] leopard - no interpret
In-Reply-To: <B8322189-85D4-4922-A30F-2D47AE4A442F@pacbell.net>
References: <74174BDB-B2AB-422C-88B5-2DA1773E768F@pacbell.net>
	<88e286470801112136v71270f3l86906a5cb6a280f6@mail.gmail.com>
	<B8322189-85D4-4922-A30F-2D47AE4A442F@pacbell.net>
Message-ID: <88e286470801112158w44b8daffr24ee8aa19d20dff1@mail.gmail.com>

On 12/01/2008, dudley ackerman <rdacker@pacbell.net> wrote:
>
> On Jan 11, 2008, at 9:36 PM, Graham Dumpleton wrote:
>
> > Have you tried a basic mod_python handler first rather than trying to
> > get publisher working? See:
> >
> >  http://www.dscpl.com.au/wiki/ModPython/Articles/GettingModPythonWorking
> >
> > for suggested path to at least getting basic handler working first.
> >
> > Graham
>
> yes - i get the same behavior -- a text dump of the file
>   - unless i end the url with a slash - then i get 'not found'.

Have you followed all the suggestions in that document in regard to
validating that mod_python is loaded by checking the Apache error
logs? Have you tried the .htaccess method described in that document?

Have you independently from that document tried setting up
mod_python.testhandler as described in mod_python documentation to
also confirm that the server you are talking to actually has
mod_python loaded?

Just work through that document step by step and when something
doesn't do what the document says should happen and you have tried all
the suggestions in that document, then come back and say exactly where
in the procedure in that document you got up to and explain what you
tried in order to debug it.

Graham

> > On 12/01/2008, dudley ackerman <rdacker@pacbell.net> wrote:
> >> text is dumped to web page instead of being interpreted.
> >>
> >> using apple python and apache2 on leopard macbook pro:
> >> mod_python/3.3.1 Python/2.5.1 configured
> >> i built mod_python with -arch i386 and -arch x86-64 in the mod_python
> >> src/makefile - no problem.
> >>
> >> in httpd.conf i have:
> >> <Directory "/Library/Webserver/Documents">
> >>     AddHandler mod_python .py
> >>     PythonHandler mod_python.publisher
> >>     PythonDebug On
> >> </Directory>
> >>
> >>
> >> my test script has:
> >> from mod_python import apache
> >>
> >> def hello(req):
> >>   req.content_type = "text/plain"
> >>   req.write("Hollow Earth")
> >>   return
> >>
> >> actually, when i try localhost/mptest.py/hello, i get 'file not
> >> found' -
> >> going to localhost/mptest.py gives me the text dump of the file.
> >>
> >> any suggestions?
> >> _______________________________________________
> >> Mod_python mailing list
> >> Mod_python@modpython.org
> >> http://mailman.modpython.org/mailman/listinfo/mod_python
> >>
>
>
From rdacker at pacbell.net  Sat Jan 12 01:19:30 2008
From: rdacker at pacbell.net (dudley ackerman)
Date: Sat Jan 12 01:19:36 2008
Subject: [mod_python] leopard - no interpret
In-Reply-To: <88e286470801112158w44b8daffr24ee8aa19d20dff1@mail.gmail.com>
References: <74174BDB-B2AB-422C-88B5-2DA1773E768F@pacbell.net>
	<88e286470801112136v71270f3l86906a5cb6a280f6@mail.gmail.com>
	<B8322189-85D4-4922-A30F-2D47AE4A442F@pacbell.net>
	<88e286470801112158w44b8daffr24ee8aa19d20dff1@mail.gmail.com>
Message-ID: <E3C87EF7-9858-4B51-9784-8710A3EE3B81@pacbell.net>


On Jan 11, 2008, at 9:58 PM, Graham Dumpleton wrote:

> On 12/01/2008, dudley ackerman <rdacker@pacbell.net> wrote:
>>
>> On Jan 11, 2008, at 9:36 PM, Graham Dumpleton wrote:
>>
>>> Have you tried a basic mod_python handler first rather than trying  
>>> to
>>> get publisher working? See:
>>>
>>> http://www.dscpl.com.au/wiki/ModPython/Articles/GettingModPythonWorking
>>>
>>> for suggested path to at least getting basic handler working first.
>>>
>>> Graham
>>
>> yes - i get the same behavior -- a text dump of the file
>>  - unless i end the url with a slash - then i get 'not found'.
>
> Have you followed all the suggestions in that document in regard to
> validating that mod_python is loaded by checking the Apache error
> logs? Have you tried the .htaccess method described in that document?
>
> Have you independently from that document tried setting up
> mod_python.testhandler as described in mod_python documentation to
> also confirm that the server you are talking to actually has
> mod_python loaded?
>
> Just work through that document step by step and when something
> doesn't do what the document says should happen and you have tried all
> the suggestions in that document, then come back and say exactly where
> in the procedure in that document you got up to and explain what you
> tried in order to debug it.
>
> Graham

before i begin the beguine, could anyone possibly mention if this  
symptom has every been seen?
and if so, is there a known cause for it?
and if so, is there a known cure?

>>> On 12/01/2008, dudley ackerman <rdacker@pacbell.net> wrote:
>>>> text is dumped to web page instead of being interpreted.
>>>>
>>>> using apple python and apache2 on leopard macbook pro:
>>>> mod_python/3.3.1 Python/2.5.1 configured
>>>> i built mod_python with -arch i386 and -arch x86-64 in the  
>>>> mod_python
>>>> src/makefile - no problem.
>>>>
>>>> in httpd.conf i have:
>>>> <Directory "/Library/Webserver/Documents">
>>>>    AddHandler mod_python .py
>>>>    PythonHandler mod_python.publisher
>>>>    PythonDebug On
>>>> </Directory>
>>>>
>>>>
>>>> my test script has:
>>>> from mod_python import apache
>>>>
>>>> def hello(req):
>>>>  req.content_type = "text/plain"
>>>>  req.write("Hollow Earth")
>>>>  return
>>>>
>>>> actually, when i try localhost/mptest.py/hello, i get 'file not
>>>> found' -
>>>> going to localhost/mptest.py gives me the text dump of the file.
>>>>
>>>> any suggestions?
>>>> _______________________________________________
>>>> Mod_python mailing list
>>>> Mod_python@modpython.org
>>>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>>>
>>
>>

From graham.dumpleton at gmail.com  Sat Jan 12 01:29:47 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sat Jan 12 01:29:56 2008
Subject: [mod_python] leopard - no interpret
In-Reply-To: <E3C87EF7-9858-4B51-9784-8710A3EE3B81@pacbell.net>
References: <74174BDB-B2AB-422C-88B5-2DA1773E768F@pacbell.net>
	<88e286470801112136v71270f3l86906a5cb6a280f6@mail.gmail.com>
	<B8322189-85D4-4922-A30F-2D47AE4A442F@pacbell.net>
	<88e286470801112158w44b8daffr24ee8aa19d20dff1@mail.gmail.com>
	<E3C87EF7-9858-4B51-9784-8710A3EE3B81@pacbell.net>
Message-ID: <88e286470801112229wc7c9185pd5186c9f4b9c1ee0@mail.gmail.com>

On 12/01/2008, dudley ackerman <rdacker@pacbell.net> wrote:
>
> On Jan 11, 2008, at 9:58 PM, Graham Dumpleton wrote:
>
> > On 12/01/2008, dudley ackerman <rdacker@pacbell.net> wrote:
> >>
> >> On Jan 11, 2008, at 9:36 PM, Graham Dumpleton wrote:
> >>
> >>> Have you tried a basic mod_python handler first rather than trying
> >>> to
> >>> get publisher working? See:
> >>>
> >>> http://www.dscpl.com.au/wiki/ModPython/Articles/GettingModPythonWorking
> >>>
> >>> for suggested path to at least getting basic handler working first.
> >>>
> >>> Graham
> >>
> >> yes - i get the same behavior -- a text dump of the file
> >>  - unless i end the url with a slash - then i get 'not found'.
> >
> > Have you followed all the suggestions in that document in regard to
> > validating that mod_python is loaded by checking the Apache error
> > logs? Have you tried the .htaccess method described in that document?
> >
> > Have you independently from that document tried setting up
> > mod_python.testhandler as described in mod_python documentation to
> > also confirm that the server you are talking to actually has
> > mod_python loaded?
> >
> > Just work through that document step by step and when something
> > doesn't do what the document says should happen and you have tried all
> > the suggestions in that document, then come back and say exactly where
> > in the procedure in that document you got up to and explain what you
> > tried in order to debug it.
> >
> > Graham
>
> before i begin the beguine, could anyone possibly mention if this
> symptom has every been seen?

Yes.

> and if so, is there a known cause for it?

Incorrect Apache configuration. Apache doesn't appear to know that it
should be treating the file with .py as special and routing it through
mod_python.

> and if so, is there a known cure?

Fix the configuration.

If the answer was more obvious then I would have said so. All we can
do is get you to follow a known series of steps to try and get
something working, otherwise we would need psychic powers to know what
is wrong.

Graham

> >>> On 12/01/2008, dudley ackerman <rdacker@pacbell.net> wrote:
> >>>> text is dumped to web page instead of being interpreted.
> >>>>
> >>>> using apple python and apache2 on leopard macbook pro:
> >>>> mod_python/3.3.1 Python/2.5.1 configured
> >>>> i built mod_python with -arch i386 and -arch x86-64 in the
> >>>> mod_python
> >>>> src/makefile - no problem.
> >>>>
> >>>> in httpd.conf i have:
> >>>> <Directory "/Library/Webserver/Documents">
> >>>>    AddHandler mod_python .py
> >>>>    PythonHandler mod_python.publisher
> >>>>    PythonDebug On
> >>>> </Directory>
> >>>>
> >>>>
> >>>> my test script has:
> >>>> from mod_python import apache
> >>>>
> >>>> def hello(req):
> >>>>  req.content_type = "text/plain"
> >>>>  req.write("Hollow Earth")
> >>>>  return
> >>>>
> >>>> actually, when i try localhost/mptest.py/hello, i get 'file not
> >>>> found' -
> >>>> going to localhost/mptest.py gives me the text dump of the file.
> >>>>
> >>>> any suggestions?
> >>>> _______________________________________________
> >>>> Mod_python mailing list
> >>>> Mod_python@modpython.org
> >>>> http://mailman.modpython.org/mailman/listinfo/mod_python
> >>>>
> >>
> >>
>
>
From rdacker at pacbell.net  Sat Jan 12 02:10:05 2008
From: rdacker at pacbell.net (dudley ackerman)
Date: Sat Jan 12 02:10:25 2008
Subject: [mod_python] leopard - no interpret
In-Reply-To: <88e286470801112229wc7c9185pd5186c9f4b9c1ee0@mail.gmail.com>
References: <74174BDB-B2AB-422C-88B5-2DA1773E768F@pacbell.net>
	<88e286470801112136v71270f3l86906a5cb6a280f6@mail.gmail.com>
	<B8322189-85D4-4922-A30F-2D47AE4A442F@pacbell.net>
	<88e286470801112158w44b8daffr24ee8aa19d20dff1@mail.gmail.com>
	<E3C87EF7-9858-4B51-9784-8710A3EE3B81@pacbell.net>
	<88e286470801112229wc7c9185pd5186c9f4b9c1ee0@mail.gmail.com>
Message-ID: <4F2E6731-A705-44DC-B3C5-2F58FE1B38D4@pacbell.net>


On Jan 11, 2008, at 10:29 PM, Graham Dumpleton wrote:

> On 12/01/2008, dudley ackerman <rdacker@pacbell.net> wrote:
>>
>> On Jan 11, 2008, at 9:58 PM, Graham Dumpleton wrote:
>>
>>> On 12/01/2008, dudley ackerman <rdacker@pacbell.net> wrote:
>>>>
>>>> On Jan 11, 2008, at 9:36 PM, Graham Dumpleton wrote:
>>>>
>>>>> Have you tried a basic mod_python handler first rather than trying
>>>>> to
>>>>> get publisher working? See:
>>>>>
>>>>> http://www.dscpl.com.au/wiki/ModPython/Articles/GettingModPythonWorking
>>>>>
>>>>> for suggested path to at least getting basic handler working  
>>>>> first.
>>>>>
>>>>> Graham
>>>>
>>>> yes - i get the same behavior -- a text dump of the file
>>>> - unless i end the url with a slash - then i get 'not found'.
>>>
>>> Have you followed all the suggestions in that document in regard to
>>> validating that mod_python is loaded by checking the Apache error
>>> logs? Have you tried the .htaccess method described in that  
>>> document?
>>>
>>> Have you independently from that document tried setting up
>>> mod_python.testhandler as described in mod_python documentation to
>>> also confirm that the server you are talking to actually has
>>> mod_python loaded?
>>>
>>> Just work through that document step by step and when something
>>> doesn't do what the document says should happen and you have tried  
>>> all
>>> the suggestions in that document, then come back and say exactly  
>>> where
>>> in the procedure in that document you got up to and explain what you
>>> tried in order to debug it.
>>>
>>> Graham
>>
>> before i begin the beguine, could anyone possibly mention if this
>> symptom has every been seen?
>
> Yes.
>
>> and if so, is there a known cause for it?
>
> Incorrect Apache configuration. Apache doesn't appear to know that it
> should be treating the file with .py as special and routing it through
> mod_python.
>
>> and if so, is there a known cure?
>
> Fix the configuration.
>
> If the answer was more obvious then I would have said so. All we can
> do is get you to follow a known series of steps to try and get
> something working, otherwise we would need psychic powers to know what
> is wrong.
>
> Graham

ok. after a restart, i don't see:
Tue Feb 01 16:09:32 2005] [notice] mod_python: (Re)importing module  
'mptest'

is there someplace in my httpd.conf i might look for the problem?


>>>>> On 12/01/2008, dudley ackerman <rdacker@pacbell.net> wrote:
>>>>>> text is dumped to web page instead of being interpreted.
>>>>>>
>>>>>> using apple python and apache2 on leopard macbook pro:
>>>>>> mod_python/3.3.1 Python/2.5.1 configured
>>>>>> i built mod_python with -arch i386 and -arch x86-64 in the
>>>>>> mod_python
>>>>>> src/makefile - no problem.
>>>>>>
>>>>>> in httpd.conf i have:
>>>>>> <Directory "/Library/Webserver/Documents">
>>>>>>   AddHandler mod_python .py
>>>>>>   PythonHandler mod_python.publisher
>>>>>>   PythonDebug On
>>>>>> </Directory>
>>>>>>
>>>>>>
>>>>>> my test script has:
>>>>>> from mod_python import apache
>>>>>>
>>>>>> def hello(req):
>>>>>> req.content_type = "text/plain"
>>>>>> req.write("Hollow Earth")
>>>>>> return
>>>>>>
>>>>>> actually, when i try localhost/mptest.py/hello, i get 'file not
>>>>>> found' -
>>>>>> going to localhost/mptest.py gives me the text dump of the file.
>>>>>>
>>>>>> any suggestions?
>>>>>> _______________________________________________
>>>>>> Mod_python mailing list
>>>>>> Mod_python@modpython.org
>>>>>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>>>>>
>>>>
>>>>
>>
>>

From graham.dumpleton at gmail.com  Sat Jan 12 02:46:37 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sat Jan 12 02:46:44 2008
Subject: [mod_python] leopard - no interpret
In-Reply-To: <4F2E6731-A705-44DC-B3C5-2F58FE1B38D4@pacbell.net>
References: <74174BDB-B2AB-422C-88B5-2DA1773E768F@pacbell.net>
	<88e286470801112136v71270f3l86906a5cb6a280f6@mail.gmail.com>
	<B8322189-85D4-4922-A30F-2D47AE4A442F@pacbell.net>
	<88e286470801112158w44b8daffr24ee8aa19d20dff1@mail.gmail.com>
	<E3C87EF7-9858-4B51-9784-8710A3EE3B81@pacbell.net>
	<88e286470801112229wc7c9185pd5186c9f4b9c1ee0@mail.gmail.com>
	<4F2E6731-A705-44DC-B3C5-2F58FE1B38D4@pacbell.net>
Message-ID: <88e286470801112346p2db00a0dr9170673930dfa42b@mail.gmail.com>

On 12/01/2008, dudley ackerman <rdacker@pacbell.net> wrote:
>
> On Jan 11, 2008, at 10:29 PM, Graham Dumpleton wrote:
>
> > On 12/01/2008, dudley ackerman <rdacker@pacbell.net> wrote:
> >>
> >> On Jan 11, 2008, at 9:58 PM, Graham Dumpleton wrote:
> >>
> >>> On 12/01/2008, dudley ackerman <rdacker@pacbell.net> wrote:
> >>>>
> >>>> On Jan 11, 2008, at 9:36 PM, Graham Dumpleton wrote:
> >>>>
> >>>>> Have you tried a basic mod_python handler first rather than trying
> >>>>> to
> >>>>> get publisher working? See:
> >>>>>
> >>>>> http://www.dscpl.com.au/wiki/ModPython/Articles/GettingModPythonWorking
> >>>>>
> >>>>> for suggested path to at least getting basic handler working
> >>>>> first.
> >>>>>
> >>>>> Graham
> >>>>
> >>>> yes - i get the same behavior -- a text dump of the file
> >>>> - unless i end the url with a slash - then i get 'not found'.
> >>>
> >>> Have you followed all the suggestions in that document in regard to
> >>> validating that mod_python is loaded by checking the Apache error
> >>> logs? Have you tried the .htaccess method described in that
> >>> document?
> >>>
> >>> Have you independently from that document tried setting up
> >>> mod_python.testhandler as described in mod_python documentation to
> >>> also confirm that the server you are talking to actually has
> >>> mod_python loaded?
> >>>
> >>> Just work through that document step by step and when something
> >>> doesn't do what the document says should happen and you have tried
> >>> all
> >>> the suggestions in that document, then come back and say exactly
> >>> where
> >>> in the procedure in that document you got up to and explain what you
> >>> tried in order to debug it.
> >>>
> >>> Graham
> >>
> >> before i begin the beguine, could anyone possibly mention if this
> >> symptom has every been seen?
> >
> > Yes.
> >
> >> and if so, is there a known cause for it?
> >
> > Incorrect Apache configuration. Apache doesn't appear to know that it
> > should be treating the file with .py as special and routing it through
> > mod_python.
> >
> >> and if so, is there a known cure?
> >
> > Fix the configuration.
> >
> > If the answer was more obvious then I would have said so. All we can
> > do is get you to follow a known series of steps to try and get
> > something working, otherwise we would need psychic powers to know what
> > is wrong.
> >
> > Graham
>
> ok. after a restart, i don't see:
> Tue Feb 01 16:09:32 2005] [notice] mod_python: (Re)importing module
> 'mptest'
>
> is there someplace in my httpd.conf i might look for the problem?

You will not see that immediately after a restart, you would only
expect to see mod_python mentioned in the server startup string. For
example:

[Tue Feb 01 16:08:21 2005] [notice] Apache/2.0.51 (Unix)
  mod_python/3.1.3 Python/2.3 configured -- resuming normal operations

Are you seeing that for a start?

The line about importing would only occur the first time that you make
a request against the URL which would target that file.

Let us know if you see the startup string. Also let us know if you are
actually following the .htaccess file method outlined or trying to do
it in the main Apache configuration.

Have you yet tried:

  SetHandler mod_python
  PythonHandler mod_python.testhandler

as explained in main mod_python documentation somewhere and made a
request against URL for which that was setup?

Graham

> >>>>> On 12/01/2008, dudley ackerman <rdacker@pacbell.net> wrote:
> >>>>>> text is dumped to web page instead of being interpreted.
> >>>>>>
> >>>>>> using apple python and apache2 on leopard macbook pro:
> >>>>>> mod_python/3.3.1 Python/2.5.1 configured
> >>>>>> i built mod_python with -arch i386 and -arch x86-64 in the
> >>>>>> mod_python
> >>>>>> src/makefile - no problem.
> >>>>>>
> >>>>>> in httpd.conf i have:
> >>>>>> <Directory "/Library/Webserver/Documents">
> >>>>>>   AddHandler mod_python .py
> >>>>>>   PythonHandler mod_python.publisher
> >>>>>>   PythonDebug On
> >>>>>> </Directory>
> >>>>>>
> >>>>>>
> >>>>>> my test script has:
> >>>>>> from mod_python import apache
> >>>>>>
> >>>>>> def hello(req):
> >>>>>> req.content_type = "text/plain"
> >>>>>> req.write("Hollow Earth")
> >>>>>> return
> >>>>>>
> >>>>>> actually, when i try localhost/mptest.py/hello, i get 'file not
> >>>>>> found' -
> >>>>>> going to localhost/mptest.py gives me the text dump of the file.
> >>>>>>
> >>>>>> any suggestions?
> >>>>>> _______________________________________________
> >>>>>> Mod_python mailing list
> >>>>>> Mod_python@modpython.org
> >>>>>> http://mailman.modpython.org/mailman/listinfo/mod_python
> >>>>>>
> >>>>
> >>>>
> >>
> >>
>
>
From rdacker at pacbell.net  Sat Jan 12 03:09:34 2008
From: rdacker at pacbell.net (dudley ackerman)
Date: Sat Jan 12 03:09:43 2008
Subject: [mod_python] leopard - no interpret
In-Reply-To: <88e286470801112346p2db00a0dr9170673930dfa42b@mail.gmail.com>
References: <74174BDB-B2AB-422C-88B5-2DA1773E768F@pacbell.net>
	<88e286470801112136v71270f3l86906a5cb6a280f6@mail.gmail.com>
	<B8322189-85D4-4922-A30F-2D47AE4A442F@pacbell.net>
	<88e286470801112158w44b8daffr24ee8aa19d20dff1@mail.gmail.com>
	<E3C87EF7-9858-4B51-9784-8710A3EE3B81@pacbell.net>
	<88e286470801112229wc7c9185pd5186c9f4b9c1ee0@mail.gmail.com>
	<4F2E6731-A705-44DC-B3C5-2F58FE1B38D4@pacbell.net>
	<88e286470801112346p2db00a0dr9170673930dfa42b@mail.gmail.com>
Message-ID: <E958809F-A462-4232-992F-6DD142E8D1B0@pacbell.net>


On Jan 11, 2008, at 11:46 PM, Graham Dumpleton wrote:

> On 12/01/2008, dudley ackerman <rdacker@pacbell.net> wrote:
>>
>> On Jan 11, 2008, at 10:29 PM, Graham Dumpleton wrote:
>>
>>> On 12/01/2008, dudley ackerman <rdacker@pacbell.net> wrote:
>>>>
>>>> On Jan 11, 2008, at 9:58 PM, Graham Dumpleton wrote:
>>>>
>>>>> On 12/01/2008, dudley ackerman <rdacker@pacbell.net> wrote:
>>>>>>
>>>>>> On Jan 11, 2008, at 9:36 PM, Graham Dumpleton wrote:
>>>>>>
>>>>>>> Have you tried a basic mod_python handler first rather than  
>>>>>>> trying
>>>>>>> to
>>>>>>> get publisher working? See:
>>>>>>>
>>>>>>> http://www.dscpl.com.au/wiki/ModPython/Articles/GettingModPythonWorking
>>>>>>>
>>>>>>> for suggested path to at least getting basic handler working
>>>>>>> first.
>>>>>>>
>>>>>>> Graham
>>>>>>
>>>>>> yes - i get the same behavior -- a text dump of the file
>>>>>> - unless i end the url with a slash - then i get 'not found'.
>>>>>
>>>>> Have you followed all the suggestions in that document in regard  
>>>>> to
>>>>> validating that mod_python is loaded by checking the Apache error
>>>>> logs? Have you tried the .htaccess method described in that
>>>>> document?
>>>>>
>>>>> Have you independently from that document tried setting up
>>>>> mod_python.testhandler as described in mod_python documentation to
>>>>> also confirm that the server you are talking to actually has
>>>>> mod_python loaded?
>>>>>
>>>>> Just work through that document step by step and when something
>>>>> doesn't do what the document says should happen and you have tried
>>>>> all
>>>>> the suggestions in that document, then come back and say exactly
>>>>> where
>>>>> in the procedure in that document you got up to and explain what  
>>>>> you
>>>>> tried in order to debug it.
>>>>>
>>>>> Graham

<snip>

i found my problem. sheesh...
i had a case error in the directory path -
it is WebServer in the path, not Webserver.
apache is case sensitive, even if osx isn't.

thank you for your responses ----
From mcassiano at manord.com  Mon Jan 14 05:10:10 2008
From: mcassiano at manord.com (Cassiano, Marco)
Date: Mon Jan 14 05:10:20 2008
Subject: [mod_python] Mod_python and kerberos authentication
	(mod_auth_kerb)
In-Reply-To: <88e286470801111324j7212fbcbu90a8c19bcd4dc9e4@mail.gmail.com>
References: <BC53C974C3B9E542BC0A9BD4C5B1168A03EB07A5@NEWMAIL.manord.com>
	<88e286470801111324j7212fbcbu90a8c19bcd4dc9e4@mail.gmail.com>
Message-ID: <BC53C974C3B9E542BC0A9BD4C5B1168A03EB07A9@NEWMAIL.manord.com>

Graham,

thank you for your answer.
I've made a very simple test script named domain_login.py. Here it is :

def check_user(req):
        return 'ok'

and I call it with the URL  http://apache.foo.com/login/domain_login.py/check_user

So, to answer your question, the request is a GET.
It is strange that if I put in the URL a wrong (non-existent) name, for example :

 http://apache.foo.com/login/domain_login.py/wrong_call

I got the same Bad Request error. So the problem seems to occur before the execution of the script.
In the apache error log I only see that the kerberos authentication was ok and then nothing else...


[Mon Jan 14 10:04:35 2008] [debug] src/mod_auth_kerb.c(1485): [client 192.168.1.25] kerb_authenticate_user entered with user (NULL) and auth_type Kerberos
[Mon Jan 14 10:04:35 2008] [debug] src/mod_auth_kerb.c(1485): [client 192.168.1.25] kerb_authenticate_user entered with user (NULL) and auth_type Kerberos
[Mon Jan 14 10:04:35 2008] [debug] src/mod_auth_kerb.c(1172): [client 192.168.1.25] Acquiring creds for HTTP/sviluppo.manord.com@MANORD.COM
[Mon Jan 14 10:04:35 2008] [debug] src/mod_auth_kerb.c(1316): [client 192.168.1.25] Verifying client data using SPNEGO GSS-API
[Mon Jan 14 10:04:35 2008] [debug] src/mod_auth_kerb.c(1332): [client 192.168.1.25] Verification returned code 0
[Mon Jan 14 10:04:35 2008] [debug] src/mod_auth_kerb.c(1350): [client 192.168.1.25] GSS-API token of length 151 bytes will be sent back

In the apache access.log I see two entries


192.168.1.25 - - [14/Jan/2008:10:56:04 +0100] "GET /login/domain_login1.py/check_user HTTP/1.1" 401 401 "-" "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.11) Gecko/20071127 Firefox/2.0.0.11"
192.168.1.25 - myuser@FOO.COM [14/Jan/2008:10:56:04 +0100] "GET /login/domain_login1.py/check_user HTTP/1.1" 404 231 "-" "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.11) Gecko/20071127 Firefox/2.0.0.11"


In the second line the windows domain user is correctly reported so it seems the kerberos authentication worked...


If I remove the kerberos authentication, the script works ok.
If I remove the mod_python handler from the directory and I ask for a plain html page the kerberos authentication works...

We also tried with mod_python.servlet (PythonHandler mod_python.servlet)
and the kerberos authentication works perfectly. The script is executed and we can retrieve the username in req.user.

So it seems a problem related to the publisher....



Thank you



Marco Cassiano 
  
Manifatture del Nord srl unipersonale
Gruppo MaxMara 

via Mazzacurati 6
42100 Reggio Emilia RE
ITALY 

Tel. +39 0522 358215 
Fax +39 0522 268715 
email : mcassiano@manord.com 
www.pennyblack.com 



The contents of the present communication is strictly confidential and reserved solely to the referred addressees. In the event was received by person different from the addressee, it is forbidden the diffusion, distribution and copy. In the event you have received it mistakenly we ask you to inform us and to destroy and/or to delete it by your computer, without using the data herein contained.

 

The present message (eventual annexes inclusive) shall not be considered any contractual proposal and/or acceptance of offer coming from the addressee, nor waiver neither recognizance of rights, debts and/or credits, and it shall not be binding, when it is not executed a subsequent agreement by person who could lawfully represent us. No pre-contractual liability shall derive to us, when the present communication is not followed by any binding agreement between the parties.



-----Original Message-----
From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com] 
Sent: Friday, January 11, 2008 10:24 PM
To: Cassiano, Marco
Cc: mod_python@modpython.org
Subject: Re: [mod_python] Mod_python and kerberos authentication (mod_auth_kerb)

When using mod_python.publisher, you would get a Bad Request error if
the request wasn't either a GET or POST. What is the type of HTTP
request?

Graham

On 12/01/2008, Cassiano, Marco <mcassiano@manord.com> wrote:
>
>
> Hi all,
>
> I've just configured our apache server (Linux RedHat) for kerberos
> authentication to allow our windows domain users to access it without having
> to reauthenticate.
> Everything works fine for a plain html directory, so I'm pretty sure that
> the kerberos configuration for the apache server is working.
> When I try to specify Kerberos authentication together with mod_python it's
> not working. I got the message :
>
>
>
> Bad Request
>
> Your browser sent a request that this server could not understand.
>
>
>
> My httpd configuration is :
>
>
> Alias /login/ "/var/www/kerb/login/"
>
>
> <Directory "/var/www/kerb/login">
> ##  AuthName "Kerberos Login"
>   AuthType Kerberos
>   KrbAuthRealm FOO.COM
>   KrbServiceName HTTP/apache.foo.com@FOO.COM
>   Krb5Keytab /etc/httpd/conf/apache.tab
>   KrbMethodNegotiate on
>   KrbMethodK5Passwd off
> #  KrbSaveCredentials off
> #  KrbVerifyKDC off
>   Require valid-user
>
>   Order Deny,Allow
>   Deny from all
>   Allow from foo.com
>   Allow from 127.0.0.1
>
>   SetHandler mod_python
>   PythonHandler mod_python.publisher | .py
>   PythonDebug on
>   PythonOption ApplicationPath '/'
>
> </Directory>
>
>
> Thanks in advance for your advice
>
>
> Marco Cassiano
>
> Manifatture del Nord srl
>
> Italy
>
>
>
>
> ---------------------------------------------------------------------------------------------
>
> Il contenuto della presente comunicazione ? riservato e destinato
> esclusivamente ai destinatari indicati. Nel caso in cui sia ricevuto da
> persona diversa dal destinatario sono proibite la diffusione, la
> distribuzione e la copia. Nel caso riceveste la presente per errore, Vi
> preghiamo di informarci e di distruggerlo e/o cancellarlo dal Vostro
> computer, senza utilizzare i dati contenuti.
>
>
>
> La presente comunicazione (comprensiva dei documenti allegati) non avr?
> valore di proposta contrattuale e/o accettazione di proposte provenienti dal
> destinatario, n? rinuncia o riconoscimento di diritti, debiti e/o crediti,
> n? sar? impegnativa, qualora non sia sottoscritto successivo accordo da chi
> pu? validamente obbligarci. Non deriver? alcuna responsabilit?
> precontrattuale a ns. carico, se la presente non sia seguita da contratto
> sottoscritto dalle parti.
>
> ---------------------------------------------------------------------------------------------
>
> The contents of the present communication is strictly confidential and
> reserved solely to the referred addressees. In the event was received by
> person different from the addressee, it is forbidden the diffusion,
> distribution and copy. In the event you have received it mistakenly we ask
> you to inform us and to destroy and/or to delete it by your computer,
> without using the data herein contained.
>
>
>
> The present message (eventual annexes inclusive) shall not be considered any
> contractual proposal and/or acceptance of offer coming from the addressee,
> nor waiver neither recognizance of rights, debts and/or credits, and it
> shall not be binding, when it is not executed a subsequent agreement by
> person who could lawfully represent us. No pre-contractual liability shall
> derive to us, when the present communication is not followed by any binding
> agreement between the parties.
>
> ---------------------------------------------------------------------------------------------
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>

From dlenwell at gmail.com  Mon Jan 14 15:05:37 2008
From: dlenwell at gmail.com (David Lenwell)
Date: Mon Jan 14 15:05:47 2008
Subject: [mod_python] problem with sessions
Message-ID: <ECC8B1CE-BC8B-49FA-AC70-46A17E77B963@GMAIL.COM>

I am trying to figure out how to make the session cookie from  
mod_python timeout 24 hours rather than when the browser closes.  
Documentation on this seems to be fuzzy .. Does anyone have an idea  
here?

Thanks in advance.

David 
From graham.dumpleton at gmail.com  Mon Jan 14 16:27:49 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon Jan 14 16:27:56 2008
Subject: [mod_python] Mod_python and kerberos authentication
	(mod_auth_kerb)
In-Reply-To: <BC53C974C3B9E542BC0A9BD4C5B1168A03EB07A9@NEWMAIL.manord.com>
References: <BC53C974C3B9E542BC0A9BD4C5B1168A03EB07A5@NEWMAIL.manord.com>
	<88e286470801111324j7212fbcbu90a8c19bcd4dc9e4@mail.gmail.com>
	<BC53C974C3B9E542BC0A9BD4C5B1168A03EB07A9@NEWMAIL.manord.com>
Message-ID: <88e286470801141327w67a8f8eeu3b0de63dc7684d41@mail.gmail.com>

No access to mod_python code right now to do any checking so only
thing I can suggest is to set handler to be mod_python.testhandler and
have a look at what it returns and see if you can see anything strange
about the request details that make it through. You might scrub what
it shows of any sensitive data and post it.

Graham

On 14/01/2008, Cassiano, Marco <mcassiano@manord.com> wrote:
> Graham,
>
> thank you for your answer.
> I've made a very simple test script named domain_login.py. Here it is :
>
> def check_user(req):
>         return 'ok'
>
> and I call it with the URL  http://apache.foo.com/login/domain_login.py/check_user
>
> So, to answer your question, the request is a GET.
> It is strange that if I put in the URL a wrong (non-existent) name, for example :
>
>  http://apache.foo.com/login/domain_login.py/wrong_call
>
> I got the same Bad Request error. So the problem seems to occur before the execution of the script.
> In the apache error log I only see that the kerberos authentication was ok and then nothing else...
>
>
> [Mon Jan 14 10:04:35 2008] [debug] src/mod_auth_kerb.c(1485): [client 192.168.1.25] kerb_authenticate_user entered with user (NULL) and auth_type Kerberos
> [Mon Jan 14 10:04:35 2008] [debug] src/mod_auth_kerb.c(1485): [client 192.168.1.25] kerb_authenticate_user entered with user (NULL) and auth_type Kerberos
> [Mon Jan 14 10:04:35 2008] [debug] src/mod_auth_kerb.c(1172): [client 192.168.1.25] Acquiring creds for HTTP/sviluppo.manord.com@MANORD.COM
> [Mon Jan 14 10:04:35 2008] [debug] src/mod_auth_kerb.c(1316): [client 192.168.1.25] Verifying client data using SPNEGO GSS-API
> [Mon Jan 14 10:04:35 2008] [debug] src/mod_auth_kerb.c(1332): [client 192.168.1.25] Verification returned code 0
> [Mon Jan 14 10:04:35 2008] [debug] src/mod_auth_kerb.c(1350): [client 192.168.1.25] GSS-API token of length 151 bytes will be sent back
>
> In the apache access.log I see two entries
>
>
> 192.168.1.25 - - [14/Jan/2008:10:56:04 +0100] "GET /login/domain_login1.py/check_user HTTP/1.1" 401 401 "-" "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.11) Gecko/20071127 Firefox/2.0.0.11"
> 192.168.1.25 - myuser@FOO.COM [14/Jan/2008:10:56:04 +0100] "GET /login/domain_login1.py/check_user HTTP/1.1" 404 231 "-" "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.11) Gecko/20071127 Firefox/2.0.0.11"
>
>
> In the second line the windows domain user is correctly reported so it seems the kerberos authentication worked...
>
>
> If I remove the kerberos authentication, the script works ok.
> If I remove the mod_python handler from the directory and I ask for a plain html page the kerberos authentication works...
>
> We also tried with mod_python.servlet (PythonHandler mod_python.servlet)
> and the kerberos authentication works perfectly. The script is executed and we can retrieve the username in req.user.
>
> So it seems a problem related to the publisher....
>
>
>
> Thank you
>
>
>
> Marco Cassiano
>
> Manifatture del Nord srl unipersonale
> Gruppo MaxMara
>
> via Mazzacurati 6
> 42100 Reggio Emilia RE
> ITALY
>
> Tel. +39 0522 358215
> Fax +39 0522 268715
> email : mcassiano@manord.com
> www.pennyblack.com
>
>
>
> The contents of the present communication is strictly confidential and reserved solely to the referred addressees. In the event was received by person different from the addressee, it is forbidden the diffusion, distribution and copy. In the event you have received it mistakenly we ask you to inform us and to destroy and/or to delete it by your computer, without using the data herein contained.
>
>
>
> The present message (eventual annexes inclusive) shall not be considered any contractual proposal and/or acceptance of offer coming from the addressee, nor waiver neither recognizance of rights, debts and/or credits, and it shall not be binding, when it is not executed a subsequent agreement by person who could lawfully represent us. No pre-contractual liability shall derive to us, when the present communication is not followed by any binding agreement between the parties.
>
>
>
> -----Original Message-----
> From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> Sent: Friday, January 11, 2008 10:24 PM
> To: Cassiano, Marco
> Cc: mod_python@modpython.org
> Subject: Re: [mod_python] Mod_python and kerberos authentication (mod_auth_kerb)
>
> When using mod_python.publisher, you would get a Bad Request error if
> the request wasn't either a GET or POST. What is the type of HTTP
> request?
>
> Graham
>
> On 12/01/2008, Cassiano, Marco <mcassiano@manord.com> wrote:
> >
> >
> > Hi all,
> >
> > I've just configured our apache server (Linux RedHat) for kerberos
> > authentication to allow our windows domain users to access it without having
> > to reauthenticate.
> > Everything works fine for a plain html directory, so I'm pretty sure that
> > the kerberos configuration for the apache server is working.
> > When I try to specify Kerberos authentication together with mod_python it's
> > not working. I got the message :
> >
> >
> >
> > Bad Request
> >
> > Your browser sent a request that this server could not understand.
> >
> >
> >
> > My httpd configuration is :
> >
> >
> > Alias /login/ "/var/www/kerb/login/"
> >
> >
> > <Directory "/var/www/kerb/login">
> > ##  AuthName "Kerberos Login"
> >   AuthType Kerberos
> >   KrbAuthRealm FOO.COM
> >   KrbServiceName HTTP/apache.foo.com@FOO.COM
> >   Krb5Keytab /etc/httpd/conf/apache.tab
> >   KrbMethodNegotiate on
> >   KrbMethodK5Passwd off
> > #  KrbSaveCredentials off
> > #  KrbVerifyKDC off
> >   Require valid-user
> >
> >   Order Deny,Allow
> >   Deny from all
> >   Allow from foo.com
> >   Allow from 127.0.0.1
> >
> >   SetHandler mod_python
> >   PythonHandler mod_python.publisher | .py
> >   PythonDebug on
> >   PythonOption ApplicationPath '/'
> >
> > </Directory>
> >
> >
> > Thanks in advance for your advice
> >
> >
> > Marco Cassiano
> >
> > Manifatture del Nord srl
> >
> > Italy
> >
> >
> >
> >
> > ---------------------------------------------------------------------------------------------
> >
> > Il contenuto della presente comunicazione ? riservato e destinato
> > esclusivamente ai destinatari indicati. Nel caso in cui sia ricevuto da
> > persona diversa dal destinatario sono proibite la diffusione, la
> > distribuzione e la copia. Nel caso riceveste la presente per errore, Vi
> > preghiamo di informarci e di distruggerlo e/o cancellarlo dal Vostro
> > computer, senza utilizzare i dati contenuti.
> >
> >
> >
> > La presente comunicazione (comprensiva dei documenti allegati) non avr?
> > valore di proposta contrattuale e/o accettazione di proposte provenienti dal
> > destinatario, n? rinuncia o riconoscimento di diritti, debiti e/o crediti,
> > n? sar? impegnativa, qualora non sia sottoscritto successivo accordo da chi
> > pu? validamente obbligarci. Non deriver? alcuna responsabilit?
> > precontrattuale a ns. carico, se la presente non sia seguita da contratto
> > sottoscritto dalle parti.
> >
> > ---------------------------------------------------------------------------------------------
> >
> > The contents of the present communication is strictly confidential and
> > reserved solely to the referred addressees. In the event was received by
> > person different from the addressee, it is forbidden the diffusion,
> > distribution and copy. In the event you have received it mistakenly we ask
> > you to inform us and to destroy and/or to delete it by your computer,
> > without using the data herein contained.
> >
> >
> >
> > The present message (eventual annexes inclusive) shall not be considered any
> > contractual proposal and/or acceptance of offer coming from the addressee,
> > nor waiver neither recognizance of rights, debts and/or credits, and it
> > shall not be binding, when it is not executed a subsequent agreement by
> > person who could lawfully represent us. No pre-contractual liability shall
> > derive to us, when the present communication is not followed by any binding
> > agreement between the parties.
> >
> > ---------------------------------------------------------------------------------------------
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
> >
>

From mcassiano at manord.com  Tue Jan 15 09:50:49 2008
From: mcassiano at manord.com (Cassiano, Marco)
Date: Tue Jan 15 09:51:00 2008
Subject: [mod_python] Mod_python and kerberos authentication
	(mod_auth_kerb)
In-Reply-To: <88e286470801141327w67a8f8eeu3b0de63dc7684d41@mail.gmail.com>
References: <BC53C974C3B9E542BC0A9BD4C5B1168A03EB07A5@NEWMAIL.manord.com>
	<88e286470801111324j7212fbcbu90a8c19bcd4dc9e4@mail.gmail.com>
	<BC53C974C3B9E542BC0A9BD4C5B1168A03EB07A9@NEWMAIL.manord.com>
	<88e286470801141327w67a8f8eeu3b0de63dc7684d41@mail.gmail.com>
Message-ID: <BC53C974C3B9E542BC0A9BD4C5B1168A03EB07B9@NEWMAIL.manord.com>

Graham,

here is the information from mod_python.testhandler.
The kerberos authentication worked fine with testhandler.
I can't see anything strange in the output....
Thank

marco


-----------------------------------------------------------------------------



General information
Apache version	Apache
Apache threaded MPM	No (single thread MPM)
Apache forked MPM	Yes, maximum 256 processes
Apache server root	/etc/httpd/
Apache document root	/var/www/html/site
Apache error log	/var/log/www/error.log (view last 100 lines)
Python sys.version	2.4.2 (#1, Jan 30 2006, 15:30:03) [GCC 3.2.3 20030502 (Red Hat Linux 3.2.3-53)]
Python sys.path	

/var/www/cgi/testkerb/
/usr/local/lib/python2.4/site-packages/setuptools-0.6c5-py2.4.egg
/usr/local/lib/python24.zip
/usr/local/lib/python2.4
/usr/local/lib/python2.4/plat-linux2
/usr/local/lib/python2.4/lib-tk
/usr/local/lib/python2.4/lib-dynload
/usr/local/lib/python2.4/site-packages
/usr/local/lib/python2.4/site-packages/PIL
/usr/local/lib/python2.4/site-packages/barcode
/usr/local/lib/python2.4/site-packages/MySQLdb
/usr/local/lib/python2.4/site-packages/_xmlplus
/usr/local/lib/python2.4/site-packages/reportlab

Python interpreter name	apache.foo.com
mod_python.publisher available	Yes
mod_python.psp available	Yes
Request input headers
Key	Value
Host	apache.foo.com
User-Agent	Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.11) Gecko/20071127 Firefox/2.0.0.11
Accept	text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5
Accept-Language	en-us,en;q=0.5
Accept-Encoding	gzip,deflate
Accept-Charset	ISO-8859-1,utf-8;q=0.7,*;q=0.7
Keep-Alive	300
Connection	keep-alive
Authorization	Negotiate Y....4
Request environment
Key	Value
SCRIPT_URL	/test/domain_login1.py/check_user
SCRIPT_URI	http://apache.foo.com/test/domain_login1.py/check_user
GATEWAY_INTERFACE	CGI/1.1
SERVER_PROTOCOL	HTTP/1.1
REQUEST_METHOD	GET
QUERY_STRING	
REQUEST_URI	/test/domain_login1.py/check_user
SCRIPT_NAME	/test/domain_login1.py
PATH_INFO	/check_user
PATH_TRANSLATED	/var/www/check_user
HTTP_HOST	apache.foo.com
HTTP_USER_AGENT	Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.11) Gecko/20071127 Firefox/2.0.0.11
HTTP_ACCEPT	text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5
HTTP_ACCEPT_LANGUAGE	en-us,en;q=0.5
HTTP_ACCEPT_ENCODING	gzip,deflate
HTTP_ACCEPT_CHARSET	ISO-8859-1,utf-8;q=0.7,*;q=0.7
HTTP_KEEP_ALIVE	300
HTTP_CONNECTION	keep-alive
PATH	/usr/local/bin:/sbin:/usr/sbin:/bin:/usr/bin:/usr/X11R6/bin
SERVER_SIGNATURE	
SERVER_SOFTWARE	Apache
SERVER_NAME	apache.foo.com
SERVER_ADDR	192.168.1.150
SERVER_PORT	80
REMOTE_ADDR	192.168.1.1
DOCUMENT_ROOT	/var/www/html/site
SERVER_ADMIN	admin@foo.com
SCRIPT_FILENAME	/var/www/cgi/testkerb/domain_login1.py
REMOTE_PORT	1681
REMOTE_USER	admin@@FOO.COM
AUTH_TYPE	Negotiate
Request configuration
Key	Value
PythonAutoReload	1
PythonDebug	1
Request options
Key	Value
ApplicationPath	/
SessionDbm	/var/www/html/sid/session.dbm
session_directory	/var/www/html/sid/session
Request notes
Key	Value
python_init_ran	1
mod_rewrite_rewritten	0
Server configuration
Key	Value
PythonAutoReload	1
PythonDebug	1
PythonPath	sys.path+['/var/www/cgi/common','/var/www/cgi/devel']
Server options
Key	Value
Server configuration tree

ServerTokens Prod
PidFile run/httpd.pid
Timeout 120
KeepAlive On
MaxKeepAliveRequests 3
KeepAliveTimeout 15
StartServers 8
MinSpareServers 5
MaxSpareServers 20
ServerLimit 256
MaxClients 256
MaxRequestsPerChild 50
Listen 0.0.0.0:80

    
        SetHandler default-handler
Alias /test/ "/var/www/cgi/testkerb/"

    AuthType Kerberos
    KrbAuthRealm FOO.COM
    KrbServiceName HTTP/apache.foo.com@FOO.COM
    Krb5Keytab /etc/httpd//conf/sviluppotab
    KrbMethodNegotiate on
    KrbMethodK5Passwd off
    Require valid-user
    Order Deny,Allow
    Deny from all
    Allow from 192.168.1
    Allow from 127.0.0.1
    SetHandler mod_python
    PythonHandler mod_python.testhandler | .py
    PythonAutoReload on
    PythonDebug on
    PythonOption ApplicationPath '/'
    PythonOption SessionDbm '/var/www/html/authdata/sid/session.dbm'
    PythonOption session_directory '/var/www/html/authdata/sid/session'

RewriteEngine on
RewriteCond %{REQUEST_METHOD} ^(TRACE|TRACK)
RewriteRule .* - [F]
ExtendedStatus On
User apache
Group apache
ServerAdmin admin@foo.com
ServerName apache.foo.com
UseCanonicalName Off
DocumentRoot "/var/www/html/site"

    Options None
    AllowOverride None
    Order Deny,Allow

UserDir disable root
DirectoryIndex index.html index.html.var
AccessFileName .htaccess

    Order allow,deny
    Deny from all
TypesConfig /etc/mime.types
DefaultType text/plain
HostnameLookups Off
ErrorLog /var/log/www/error.log
LogLevel debug
LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" combined
LogFormat "%h %l %u %t \"%r\" %>s %b" common
LogFormat "%{Referer}i -> %U" referer
LogFormat "%{User-agent}i" agent
CustomLog /var/log/www/access.log combined
ServerSignature Off
IndexOptions FancyIndexing VersionSort NameWidth=*
AddIconByEncoding (CMP,/icons/compressed.gif) x-compress x-gzip
AddIconByType (TXT,/icons/text.gif) text/*
AddIconByType (IMG,/icons/image2.gif) image/*
AddIconByType (SND,/icons/sound2.gif) audio/*
AddIconByType (VID,/icons/movie.gif) video/*
AddIcon /icons/binary.gif .bin .exe
AddIcon /icons/binhex.gif .hqx
AddIcon /icons/tar.gif .tar
AddIcon /icons/world2.gif .wrl .wrl.gz .vrml .vrm .iv
AddIcon /icons/compressed.gif .Z .z .tgz .gz .zip
AddIcon /icons/a.gif .ps .ai .eps
AddIcon /icons/layout.gif .html .shtml .htm .pdf
AddIcon /icons/text.gif .txt
AddIcon /icons/c.gif .c
AddIcon /icons/p.gif .pl .py
AddIcon /icons/f.gif .for
AddIcon /icons/dvi.gif .dvi
AddIcon /icons/uuencoded.gif .uu
AddIcon /icons/script.gif .conf .sh .shar .csh .ksh .tcl
AddIcon /icons/tex.gif .tex
AddIcon /icons/bomb.gif core
AddIcon /icons/back.gif ..
AddIcon /icons/hand.right.gif README
AddIcon /icons/folder.gif ^^DIRECTORY^^
AddIcon /icons/blank.gif ^^BLANKICON^^
DefaultIcon /icons/unknown.gif
ReadmeName README.html
HeaderName HEADER.html
IndexIgnore .??* *~ *# HEADER* README* RCS CVS *,v *,t
AddLanguage en .en
AddLanguage it .it
LanguagePriority en it
AddDefaultCharset ISO-8859-1
AddCharset ISO-8859-1  .iso8859-1  .latin1
AddCharset ISO-8859-2  .iso8859-2  .latin2 .cen
AddCharset ISO-8859-3  .iso8859-3  .latin3
AddCharset ISO-8859-4  .iso8859-4  .latin4
AddCharset UTF-8       .utf8
AddCharset utf-8       .utf8
AddType application/x-compress .Z
AddType application/x-gzip .gz .tgz
AddHandler imap-file map
AddHandler type-map var
AddType text/html .shtml
AddOutputFilter INCLUDES .shtml
Alias /error/ "/var/www/error/"

    AllowOverride None
    Options IncludesNoExec
    AddOutputFilter Includes html
    AddHandler type-map var
    Order allow,deny
    Allow from all
    LanguagePriority en es de fr
    ForceLanguagePriority Prefer Fallback
BrowserMatch "Mozilla/2" nokeepalive
BrowserMatch "MSIE 4\.0b2;" nokeepalive downgrade-1.0 force-response-1.0
BrowserMatch "RealPlayer 4\.0" force-response-1.0
BrowserMatch "Java/1\.0" force-response-1.0
BrowserMatch "JDK/1\.0" force-response-1.0
BrowserMatch "Microsoft Data Access Internet Publishing Provider" redirect-carefully
BrowserMatch "^WebDrive" redirect-carefully
BrowserMatch "^WebDAVFS/1.[012]" redirect-carefully
BrowserMatch "^gnome-vfs" redirect-carefully


Marco Cassiano 
  
Manifatture del Nord srl unipersonale
Gruppo MaxMara 

via Mazzacurati 6
42100 Reggio Emilia RE
ITALY 

Tel. +39 0522 358215 
Fax +39 0522 268715 
email : mcassiano@manord.com 
www.pennyblack.com 

 

---------------------------------------------------------------------------------------------

Il contenuto della presente comunicazione ? riservato e destinato esclusivamente ai destinatari indicati. Nel caso in cui sia ricevuto da persona diversa dal destinatario sono proibite la diffusione, la distribuzione e la copia. Nel caso riceveste la presente per errore, Vi preghiamo di informarci e di distruggerlo e/o cancellarlo dal Vostro computer, senza utilizzare i dati contenuti.

 

La presente comunicazione (comprensiva dei documenti allegati) non avr? valore di proposta contrattuale e/o accettazione di proposte provenienti dal destinatario, n? rinuncia o riconoscimento di diritti, debiti e/o crediti, n? sar? impegnativa, qualora non sia sottoscritto successivo accordo da chi pu? validamente obbligarci. Non deriver? alcuna responsabilit? precontrattuale a ns. carico, se la presente non sia seguita da contratto sottoscritto dalle parti.

---------------------------------------------------------------------------------------------

The contents of the present communication is strictly confidential and reserved solely to the referred addressees. In the event was received by person different from the addressee, it is forbidden the diffusion, distribution and copy. In the event you have received it mistakenly we ask you to inform us and to destroy and/or to delete it by your computer, without using the data herein contained.

 

The present message (eventual annexes inclusive) shall not be considered any contractual proposal and/or acceptance of offer coming from the addressee, nor waiver neither recognizance of rights, debts and/or credits, and it shall not be binding, when it is not executed a subsequent agreement by person who could lawfully represent us. No pre-contractual liability shall derive to us, when the present communication is not followed by any binding agreement between the parties.

---------------------------------------------------------------------------------------------


-----Original Message-----
From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com] 
Sent: Monday, January 14, 2008 10:28 PM
To: Cassiano, Marco
Cc: mod_python@modpython.org
Subject: Re: [mod_python] Mod_python and kerberos authentication (mod_auth_kerb)

No access to mod_python code right now to do any checking so only
thing I can suggest is to set handler to be mod_python.testhandler and
have a look at what it returns and see if you can see anything strange
about the request details that make it through. You might scrub what
it shows of any sensitive data and post it.

Graham

On 14/01/2008, Cassiano, Marco <mcassiano@manord.com> wrote:
> Graham,
>
> thank you for your answer.
> I've made a very simple test script named domain_login.py. Here it is :
>
> def check_user(req):
>         return 'ok'
>
> and I call it with the URL  http://apache.foo.com/login/domain_login.py/check_user
>
> So, to answer your question, the request is a GET.
> It is strange that if I put in the URL a wrong (non-existent) name, for example :
>
>  http://apache.foo.com/login/domain_login.py/wrong_call
>
> I got the same Bad Request error. So the problem seems to occur before the execution of the script.
> In the apache error log I only see that the kerberos authentication was ok and then nothing else...
>
>
> [Mon Jan 14 10:04:35 2008] [debug] src/mod_auth_kerb.c(1485): [client 192.168.1.25] kerb_authenticate_user entered with user (NULL) and auth_type Kerberos
> [Mon Jan 14 10:04:35 2008] [debug] src/mod_auth_kerb.c(1485): [client 192.168.1.25] kerb_authenticate_user entered with user (NULL) and auth_type Kerberos
> [Mon Jan 14 10:04:35 2008] [debug] src/mod_auth_kerb.c(1172): [client 192.168.1.25] Acquiring creds for HTTP/sviluppo.manord.com@MANORD.COM
> [Mon Jan 14 10:04:35 2008] [debug] src/mod_auth_kerb.c(1316): [client 192.168.1.25] Verifying client data using SPNEGO GSS-API
> [Mon Jan 14 10:04:35 2008] [debug] src/mod_auth_kerb.c(1332): [client 192.168.1.25] Verification returned code 0
> [Mon Jan 14 10:04:35 2008] [debug] src/mod_auth_kerb.c(1350): [client 192.168.1.25] GSS-API token of length 151 bytes will be sent back
>
> In the apache access.log I see two entries
>
>
> 192.168.1.25 - - [14/Jan/2008:10:56:04 +0100] "GET /login/domain_login1.py/check_user HTTP/1.1" 401 401 "-" "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.11) Gecko/20071127 Firefox/2.0.0.11"
> 192.168.1.25 - myuser@FOO.COM [14/Jan/2008:10:56:04 +0100] "GET /login/domain_login1.py/check_user HTTP/1.1" 404 231 "-" "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.11) Gecko/20071127 Firefox/2.0.0.11"
>
>
> In the second line the windows domain user is correctly reported so it seems the kerberos authentication worked...
>
>
> If I remove the kerberos authentication, the script works ok.
> If I remove the mod_python handler from the directory and I ask for a plain html page the kerberos authentication works...
>
> We also tried with mod_python.servlet (PythonHandler mod_python.servlet)
> and the kerberos authentication works perfectly. The script is executed and we can retrieve the username in req.user.
>
> So it seems a problem related to the publisher....
>
>
>
> Thank you
>
>
>
> Marco Cassiano
>
> Manifatture del Nord srl unipersonale
> Gruppo MaxMara
>
> via Mazzacurati 6
> 42100 Reggio Emilia RE
> ITALY
>
> Tel. +39 0522 358215
> Fax +39 0522 268715
> email : mcassiano@manord.com
> www.pennyblack.com
>
>
>
> The contents of the present communication is strictly confidential and reserved solely to the referred addressees. In the event was received by person different from the addressee, it is forbidden the diffusion, distribution and copy. In the event you have received it mistakenly we ask you to inform us and to destroy and/or to delete it by your computer, without using the data herein contained.
>
>
>
> The present message (eventual annexes inclusive) shall not be considered any contractual proposal and/or acceptance of offer coming from the addressee, nor waiver neither recognizance of rights, debts and/or credits, and it shall not be binding, when it is not executed a subsequent agreement by person who could lawfully represent us. No pre-contractual liability shall derive to us, when the present communication is not followed by any binding agreement between the parties.
>
>
>
> -----Original Message-----
> From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> Sent: Friday, January 11, 2008 10:24 PM
> To: Cassiano, Marco
> Cc: mod_python@modpython.org
> Subject: Re: [mod_python] Mod_python and kerberos authentication (mod_auth_kerb)
>
> When using mod_python.publisher, you would get a Bad Request error if
> the request wasn't either a GET or POST. What is the type of HTTP
> request?
>
> Graham
>
> On 12/01/2008, Cassiano, Marco <mcassiano@manord.com> wrote:
> >
> >
> > Hi all,
> >
> > I've just configured our apache server (Linux RedHat) for kerberos
> > authentication to allow our windows domain users to access it without having
> > to reauthenticate.
> > Everything works fine for a plain html directory, so I'm pretty sure that
> > the kerberos configuration for the apache server is working.
> > When I try to specify Kerberos authentication together with mod_python it's
> > not working. I got the message :
> >
> >
> >
> > Bad Request
> >
> > Your browser sent a request that this server could not understand.
> >
> >
> >
> > My httpd configuration is :
> >
> >
> > Alias /login/ "/var/www/kerb/login/"
> >
> >
> > <Directory "/var/www/kerb/login">
> > ##  AuthName "Kerberos Login"
> >   AuthType Kerberos
> >   KrbAuthRealm FOO.COM
> >   KrbServiceName HTTP/apache.foo.com@FOO.COM
> >   Krb5Keytab /etc/httpd/conf/apache.tab
> >   KrbMethodNegotiate on
> >   KrbMethodK5Passwd off
> > #  KrbSaveCredentials off
> > #  KrbVerifyKDC off
> >   Require valid-user
> >
> >   Order Deny,Allow
> >   Deny from all
> >   Allow from foo.com
> >   Allow from 127.0.0.1
> >
> >   SetHandler mod_python
> >   PythonHandler mod_python.publisher | .py
> >   PythonDebug on
> >   PythonOption ApplicationPath '/'
> >
> > </Directory>
> >
> >
> > Thanks in advance for your advice
> >
> >
> > Marco Cassiano
> >
> > Manifatture del Nord srl
> >
> > Italy
> >
> >
> >
> >
> > ---------------------------------------------------------------------------------------------
> >
> > Il contenuto della presente comunicazione ? riservato e destinato
> > esclusivamente ai destinatari indicati. Nel caso in cui sia ricevuto da
> > persona diversa dal destinatario sono proibite la diffusione, la
> > distribuzione e la copia. Nel caso riceveste la presente per errore, Vi
> > preghiamo di informarci e di distruggerlo e/o cancellarlo dal Vostro
> > computer, senza utilizzare i dati contenuti.
> >
> >
> >
> > La presente comunicazione (comprensiva dei documenti allegati) non avr?
> > valore di proposta contrattuale e/o accettazione di proposte provenienti dal
> > destinatario, n? rinuncia o riconoscimento di diritti, debiti e/o crediti,
> > n? sar? impegnativa, qualora non sia sottoscritto successivo accordo da chi
> > pu? validamente obbligarci. Non deriver? alcuna responsabilit?
> > precontrattuale a ns. carico, se la presente non sia seguita da contratto
> > sottoscritto dalle parti.
> >
> > ---------------------------------------------------------------------------------------------
> >
> > The contents of the present communication is strictly confidential and
> > reserved solely to the referred addressees. In the event was received by
> > person different from the addressee, it is forbidden the diffusion,
> > distribution and copy. In the event you have received it mistakenly we ask
> > you to inform us and to destroy and/or to delete it by your computer,
> > without using the data herein contained.
> >
> >
> >
> > The present message (eventual annexes inclusive) shall not be considered any
> > contractual proposal and/or acceptance of offer coming from the addressee,
> > nor waiver neither recognizance of rights, debts and/or credits, and it
> > shall not be binding, when it is not executed a subsequent agreement by
> > person who could lawfully represent us. No pre-contractual liability shall
> > derive to us, when the present communication is not followed by any binding
> > agreement between the parties.
> >
> > ---------------------------------------------------------------------------------------------
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
> >
>

From cguin at bbn.com  Tue Jan 15 14:26:58 2008
From: cguin at bbn.com (Chris Guin)
Date: Tue Jan 15 14:32:20 2008
Subject: [mod_python] A question about running 2 apps with mod_python
Message-ID: <7.0.0.16.2.20080115142131.027d4a88@bbn.com>

We've recently switched to using worker mpm instead of prefork, and 
things have mostly been going smoothly.  Our server is running 2 
Django applications, one of which is forum software.  Their URL 
spaces are entirely distinct, and each "Location" in httpd.conf has 
been set to use one of two different PythonInterpreters depending on 
the app it services.

We've noticed that regular accesses to the forum pages will randomly 
(about 50% of the time) call up the 404 page for the other 
application.  We've noticed no similar problems in the reverse 
direction (from the other app to the forums).  Refreshing the 404 
page eventually gets us to the forum.

The randomness of the error suggests to me that it has to do with 
which httpd.worker process or thread is picking up the request, but I 
can't explain what difference it would make.  Since we have switched 
to worker from prefork, I suspect this may be at fault somehow.

Any insight would be tremendously appreciated!

Chris Guin


From graham.dumpleton at gmail.com  Tue Jan 15 18:15:51 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue Jan 15 18:16:01 2008
Subject: [mod_python] A question about running 2 apps with mod_python
In-Reply-To: <7.0.0.16.2.20080115142131.027d4a88@bbn.com>
References: <7.0.0.16.2.20080115142131.027d4a88@bbn.com>
Message-ID: <88e286470801151515m11ff4437kfccc8e2234218361@mail.gmail.com>

Have you defined NameVirtualHost directive properly. Lack of this
directive when using multiple VirtualHost definitions is normally the
cause of such mixing of site pages.

Graham

On 16/01/2008, Chris Guin <cguin@bbn.com> wrote:
> We've recently switched to using worker mpm instead of prefork, and
> things have mostly been going smoothly.  Our server is running 2
> Django applications, one of which is forum software.  Their URL
> spaces are entirely distinct, and each "Location" in httpd.conf has
> been set to use one of two different PythonInterpreters depending on
> the app it services.
>
> We've noticed that regular accesses to the forum pages will randomly
> (about 50% of the time) call up the 404 page for the other
> application.  We've noticed no similar problems in the reverse
> direction (from the other app to the forums).  Refreshing the 404
> page eventually gets us to the forum.
>
> The randomness of the error suggests to me that it has to do with
> which httpd.worker process or thread is picking up the request, but I
> can't explain what difference it would make.  Since we have switched
> to worker from prefork, I suspect this may be at fault somehow.
>
> Any insight would be tremendously appreciated!
>
> Chris Guin
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From graham.dumpleton at gmail.com  Wed Jan 16 01:03:56 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Wed Jan 16 01:04:02 2008
Subject: [mod_python] Mod_python and kerberos authentication
	(mod_auth_kerb)
In-Reply-To: <BC53C974C3B9E542BC0A9BD4C5B1168A03EB07B9@NEWMAIL.manord.com>
References: <BC53C974C3B9E542BC0A9BD4C5B1168A03EB07A5@NEWMAIL.manord.com>
	<88e286470801111324j7212fbcbu90a8c19bcd4dc9e4@mail.gmail.com>
	<BC53C974C3B9E542BC0A9BD4C5B1168A03EB07A9@NEWMAIL.manord.com>
	<88e286470801141327w67a8f8eeu3b0de63dc7684d41@mail.gmail.com>
	<BC53C974C3B9E542BC0A9BD4C5B1168A03EB07B9@NEWMAIL.manord.com>
Message-ID: <88e286470801152203ic31d4e9i7f3c3de72654fbb0@mail.gmail.com>

I remember now.

See:

  http://issues.apache.org/jira/browse/MODPYTHON-47

Use same workaround as described in their for using Digest auth with publisher.

Graham

On 16/01/2008, Cassiano, Marco <mcassiano@manord.com> wrote:
> Graham,
>
> here is the information from mod_python.testhandler.
> The kerberos authentication worked fine with testhandler.
> I can't see anything strange in the output....
> Thank
>
> marco
>
>
> -----------------------------------------------------------------------------
>
>
>
> General information
> Apache version  Apache
> Apache threaded MPM     No (single thread MPM)
> Apache forked MPM       Yes, maximum 256 processes
> Apache server root      /etc/httpd/
> Apache document root    /var/www/html/site
> Apache error log        /var/log/www/error.log (view last 100 lines)
> Python sys.version      2.4.2 (#1, Jan 30 2006, 15:30:03) [GCC 3.2.3 20030502 (Red Hat Linux 3.2.3-53)]
> Python sys.path
>
> /var/www/cgi/testkerb/
> /usr/local/lib/python2.4/site-packages/setuptools-0.6c5-py2.4.egg
> /usr/local/lib/python24.zip
> /usr/local/lib/python2.4
> /usr/local/lib/python2.4/plat-linux2
> /usr/local/lib/python2.4/lib-tk
> /usr/local/lib/python2.4/lib-dynload
> /usr/local/lib/python2.4/site-packages
> /usr/local/lib/python2.4/site-packages/PIL
> /usr/local/lib/python2.4/site-packages/barcode
> /usr/local/lib/python2.4/site-packages/MySQLdb
> /usr/local/lib/python2.4/site-packages/_xmlplus
> /usr/local/lib/python2.4/site-packages/reportlab
>
> Python interpreter name apache.foo.com
> mod_python.publisher available  Yes
> mod_python.psp available        Yes
> Request input headers
> Key     Value
> Host    apache.foo.com
> User-Agent      Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.11) Gecko/20071127 Firefox/2.0.0.11
> Accept  text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5
> Accept-Language en-us,en;q=0.5
> Accept-Encoding gzip,deflate
> Accept-Charset  ISO-8859-1,utf-8;q=0.7,*;q=0.7
> Keep-Alive      300
> Connection      keep-alive
> Authorization   Negotiate Y....4
> Request environment
> Key     Value
> SCRIPT_URL      /test/domain_login1.py/check_user
> SCRIPT_URI      http://apache.foo.com/test/domain_login1.py/check_user
> GATEWAY_INTERFACE       CGI/1.1
> SERVER_PROTOCOL HTTP/1.1
> REQUEST_METHOD  GET
> QUERY_STRING
> REQUEST_URI     /test/domain_login1.py/check_user
> SCRIPT_NAME     /test/domain_login1.py
> PATH_INFO       /check_user
> PATH_TRANSLATED /var/www/check_user
> HTTP_HOST       apache.foo.com
> HTTP_USER_AGENT Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.11) Gecko/20071127 Firefox/2.0.0.11
> HTTP_ACCEPT     text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5
> HTTP_ACCEPT_LANGUAGE    en-us,en;q=0.5
> HTTP_ACCEPT_ENCODING    gzip,deflate
> HTTP_ACCEPT_CHARSET     ISO-8859-1,utf-8;q=0.7,*;q=0.7
> HTTP_KEEP_ALIVE 300
> HTTP_CONNECTION keep-alive
> PATH    /usr/local/bin:/sbin:/usr/sbin:/bin:/usr/bin:/usr/X11R6/bin
> SERVER_SIGNATURE
> SERVER_SOFTWARE Apache
> SERVER_NAME     apache.foo.com
> SERVER_ADDR     192.168.1.150
> SERVER_PORT     80
> REMOTE_ADDR     192.168.1.1
> DOCUMENT_ROOT   /var/www/html/site
> SERVER_ADMIN    admin@foo.com
> SCRIPT_FILENAME /var/www/cgi/testkerb/domain_login1.py
> REMOTE_PORT     1681
> REMOTE_USER     admin@@FOO.COM
> AUTH_TYPE       Negotiate
> Request configuration
> Key     Value
> PythonAutoReload        1
> PythonDebug     1
> Request options
> Key     Value
> ApplicationPath /
> SessionDbm      /var/www/html/sid/session.dbm
> session_directory       /var/www/html/sid/session
> Request notes
> Key     Value
> python_init_ran 1
> mod_rewrite_rewritten   0
> Server configuration
> Key     Value
> PythonAutoReload        1
> PythonDebug     1
> PythonPath      sys.path+['/var/www/cgi/common','/var/www/cgi/devel']
> Server options
> Key     Value
> Server configuration tree
>
> ServerTokens Prod
> PidFile run/httpd.pid
> Timeout 120
> KeepAlive On
> MaxKeepAliveRequests 3
> KeepAliveTimeout 15
> StartServers 8
> MinSpareServers 5
> MaxSpareServers 20
> ServerLimit 256
> MaxClients 256
> MaxRequestsPerChild 50
> Listen 0.0.0.0:80
>
>
>         SetHandler default-handler
> Alias /test/ "/var/www/cgi/testkerb/"
>
>     AuthType Kerberos
>     KrbAuthRealm FOO.COM
>     KrbServiceName HTTP/apache.foo.com@FOO.COM
>     Krb5Keytab /etc/httpd//conf/sviluppotab
>     KrbMethodNegotiate on
>     KrbMethodK5Passwd off
>     Require valid-user
>     Order Deny,Allow
>     Deny from all
>     Allow from 192.168.1
>     Allow from 127.0.0.1
>     SetHandler mod_python
>     PythonHandler mod_python.testhandler | .py
>     PythonAutoReload on
>     PythonDebug on
>     PythonOption ApplicationPath '/'
>     PythonOption SessionDbm '/var/www/html/authdata/sid/session.dbm'
>     PythonOption session_directory '/var/www/html/authdata/sid/session'
>
> RewriteEngine on
> RewriteCond %{REQUEST_METHOD} ^(TRACE|TRACK)
> RewriteRule .* - [F]
> ExtendedStatus On
> User apache
> Group apache
> ServerAdmin admin@foo.com
> ServerName apache.foo.com
> UseCanonicalName Off
> DocumentRoot "/var/www/html/site"
>
>     Options None
>     AllowOverride None
>     Order Deny,Allow
>
> UserDir disable root
> DirectoryIndex index.html index.html.var
> AccessFileName .htaccess
>
>     Order allow,deny
>     Deny from all
> TypesConfig /etc/mime.types
> DefaultType text/plain
> HostnameLookups Off
> ErrorLog /var/log/www/error.log
> LogLevel debug
> LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" combined
> LogFormat "%h %l %u %t \"%r\" %>s %b" common
> LogFormat "%{Referer}i -> %U" referer
> LogFormat "%{User-agent}i" agent
> CustomLog /var/log/www/access.log combined
> ServerSignature Off
> IndexOptions FancyIndexing VersionSort NameWidth=*
> AddIconByEncoding (CMP,/icons/compressed.gif) x-compress x-gzip
> AddIconByType (TXT,/icons/text.gif) text/*
> AddIconByType (IMG,/icons/image2.gif) image/*
> AddIconByType (SND,/icons/sound2.gif) audio/*
> AddIconByType (VID,/icons/movie.gif) video/*
> AddIcon /icons/binary.gif .bin .exe
> AddIcon /icons/binhex.gif .hqx
> AddIcon /icons/tar.gif .tar
> AddIcon /icons/world2.gif .wrl .wrl.gz .vrml .vrm .iv
> AddIcon /icons/compressed.gif .Z .z .tgz .gz .zip
> AddIcon /icons/a.gif .ps .ai .eps
> AddIcon /icons/layout.gif .html .shtml .htm .pdf
> AddIcon /icons/text.gif .txt
> AddIcon /icons/c.gif .c
> AddIcon /icons/p.gif .pl .py
> AddIcon /icons/f.gif .for
> AddIcon /icons/dvi.gif .dvi
> AddIcon /icons/uuencoded.gif .uu
> AddIcon /icons/script.gif .conf .sh .shar .csh .ksh .tcl
> AddIcon /icons/tex.gif .tex
> AddIcon /icons/bomb.gif core
> AddIcon /icons/back.gif ..
> AddIcon /icons/hand.right.gif README
> AddIcon /icons/folder.gif ^^DIRECTORY^^
> AddIcon /icons/blank.gif ^^BLANKICON^^
> DefaultIcon /icons/unknown.gif
> ReadmeName README.html
> HeaderName HEADER.html
> IndexIgnore .??* *~ *# HEADER* README* RCS CVS *,v *,t
> AddLanguage en .en
> AddLanguage it .it
> LanguagePriority en it
> AddDefaultCharset ISO-8859-1
> AddCharset ISO-8859-1  .iso8859-1  .latin1
> AddCharset ISO-8859-2  .iso8859-2  .latin2 .cen
> AddCharset ISO-8859-3  .iso8859-3  .latin3
> AddCharset ISO-8859-4  .iso8859-4  .latin4
> AddCharset UTF-8       .utf8
> AddCharset utf-8       .utf8
> AddType application/x-compress .Z
> AddType application/x-gzip .gz .tgz
> AddHandler imap-file map
> AddHandler type-map var
> AddType text/html .shtml
> AddOutputFilter INCLUDES .shtml
> Alias /error/ "/var/www/error/"
>
>     AllowOverride None
>     Options IncludesNoExec
>     AddOutputFilter Includes html
>     AddHandler type-map var
>     Order allow,deny
>     Allow from all
>     LanguagePriority en es de fr
>     ForceLanguagePriority Prefer Fallback
> BrowserMatch "Mozilla/2" nokeepalive
> BrowserMatch "MSIE 4\.0b2;" nokeepalive downgrade-1.0 force-response-1.0
> BrowserMatch "RealPlayer 4\.0" force-response-1.0
> BrowserMatch "Java/1\.0" force-response-1.0
> BrowserMatch "JDK/1\.0" force-response-1.0
> BrowserMatch "Microsoft Data Access Internet Publishing Provider" redirect-carefully
> BrowserMatch "^WebDrive" redirect-carefully
> BrowserMatch "^WebDAVFS/1.[012]" redirect-carefully
> BrowserMatch "^gnome-vfs" redirect-carefully
>
>
> Marco Cassiano
>
> Manifatture del Nord srl unipersonale
> Gruppo MaxMara
>
> via Mazzacurati 6
> 42100 Reggio Emilia RE
> ITALY
>
> Tel. +39 0522 358215
> Fax +39 0522 268715
> email : mcassiano@manord.com
> www.pennyblack.com
>
>
>
> ---------------------------------------------------------------------------------------------
>
> Il contenuto della presente comunicazione ? riservato e destinato esclusivamente ai destinatari indicati. Nel caso in cui sia ricevuto da persona diversa dal destinatario sono proibite la diffusione, la distribuzione e la copia. Nel caso riceveste la presente per errore, Vi preghiamo di informarci e di distruggerlo e/o cancellarlo dal Vostro computer, senza utilizzare i dati contenuti.
>
>
>
> La presente comunicazione (comprensiva dei documenti allegati) non avr? valore di proposta contrattuale e/o accettazione di proposte provenienti dal destinatario, n? rinuncia o riconoscimento di diritti, debiti e/o crediti, n? sar? impegnativa, qualora non sia sottoscritto successivo accordo da chi pu? validamente obbligarci. Non deriver? alcuna responsabilit? precontrattuale a ns. carico, se la presente non sia seguita da contratto sottoscritto dalle parti.
>
> ---------------------------------------------------------------------------------------------
>
> The contents of the present communication is strictly confidential and reserved solely to the referred addressees. In the event was received by person different from the addressee, it is forbidden the diffusion, distribution and copy. In the event you have received it mistakenly we ask you to inform us and to destroy and/or to delete it by your computer, without using the data herein contained.
>
>
>
> The present message (eventual annexes inclusive) shall not be considered any contractual proposal and/or acceptance of offer coming from the addressee, nor waiver neither recognizance of rights, debts and/or credits, and it shall not be binding, when it is not executed a subsequent agreement by person who could lawfully represent us. No pre-contractual liability shall derive to us, when the present communication is not followed by any binding agreement between the parties.
>
> ---------------------------------------------------------------------------------------------
>
>
> -----Original Message-----
> From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> Sent: Monday, January 14, 2008 10:28 PM
> To: Cassiano, Marco
> Cc: mod_python@modpython.org
> Subject: Re: [mod_python] Mod_python and kerberos authentication (mod_auth_kerb)
>
> No access to mod_python code right now to do any checking so only
> thing I can suggest is to set handler to be mod_python.testhandler and
> have a look at what it returns and see if you can see anything strange
> about the request details that make it through. You might scrub what
> it shows of any sensitive data and post it.
>
> Graham
>
> On 14/01/2008, Cassiano, Marco <mcassiano@manord.com> wrote:
> > Graham,
> >
> > thank you for your answer.
> > I've made a very simple test script named domain_login.py. Here it is :
> >
> > def check_user(req):
> >         return 'ok'
> >
> > and I call it with the URL  http://apache.foo.com/login/domain_login.py/check_user
> >
> > So, to answer your question, the request is a GET.
> > It is strange that if I put in the URL a wrong (non-existent) name, for example :
> >
> >  http://apache.foo.com/login/domain_login.py/wrong_call
> >
> > I got the same Bad Request error. So the problem seems to occur before the execution of the script.
> > In the apache error log I only see that the kerberos authentication was ok and then nothing else...
> >
> >
> > [Mon Jan 14 10:04:35 2008] [debug] src/mod_auth_kerb.c(1485): [client 192.168.1.25] kerb_authenticate_user entered with user (NULL) and auth_type Kerberos
> > [Mon Jan 14 10:04:35 2008] [debug] src/mod_auth_kerb.c(1485): [client 192.168.1.25] kerb_authenticate_user entered with user (NULL) and auth_type Kerberos
> > [Mon Jan 14 10:04:35 2008] [debug] src/mod_auth_kerb.c(1172): [client 192.168.1.25] Acquiring creds for HTTP/sviluppo.manord.com@MANORD.COM
> > [Mon Jan 14 10:04:35 2008] [debug] src/mod_auth_kerb.c(1316): [client 192.168.1.25] Verifying client data using SPNEGO GSS-API
> > [Mon Jan 14 10:04:35 2008] [debug] src/mod_auth_kerb.c(1332): [client 192.168.1.25] Verification returned code 0
> > [Mon Jan 14 10:04:35 2008] [debug] src/mod_auth_kerb.c(1350): [client 192.168.1.25] GSS-API token of length 151 bytes will be sent back
> >
> > In the apache access.log I see two entries
> >
> >
> > 192.168.1.25 - - [14/Jan/2008:10:56:04 +0100] "GET /login/domain_login1.py/check_user HTTP/1.1" 401 401 "-" "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.11) Gecko/20071127 Firefox/2.0.0.11"
> > 192.168.1.25 - myuser@FOO.COM [14/Jan/2008:10:56:04 +0100] "GET /login/domain_login1.py/check_user HTTP/1.1" 404 231 "-" "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.11) Gecko/20071127 Firefox/2.0.0.11"
> >
> >
> > In the second line the windows domain user is correctly reported so it seems the kerberos authentication worked...
> >
> >
> > If I remove the kerberos authentication, the script works ok.
> > If I remove the mod_python handler from the directory and I ask for a plain html page the kerberos authentication works...
> >
> > We also tried with mod_python.servlet (PythonHandler mod_python.servlet)
> > and the kerberos authentication works perfectly. The script is executed and we can retrieve the username in req.user.
> >
> > So it seems a problem related to the publisher....
> >
> >
> >
> > Thank you
> >
> >
> >
> > Marco Cassiano
> >
> > Manifatture del Nord srl unipersonale
> > Gruppo MaxMara
> >
> > via Mazzacurati 6
> > 42100 Reggio Emilia RE
> > ITALY
> >
> > Tel. +39 0522 358215
> > Fax +39 0522 268715
> > email : mcassiano@manord.com
> > www.pennyblack.com
> >
> >
> >
> > The contents of the present communication is strictly confidential and reserved solely to the referred addressees. In the event was received by person different from the addressee, it is forbidden the diffusion, distribution and copy. In the event you have received it mistakenly we ask you to inform us and to destroy and/or to delete it by your computer, without using the data herein contained.
> >
> >
> >
> > The present message (eventual annexes inclusive) shall not be considered any contractual proposal and/or acceptance of offer coming from the addressee, nor waiver neither recognizance of rights, debts and/or credits, and it shall not be binding, when it is not executed a subsequent agreement by person who could lawfully represent us. No pre-contractual liability shall derive to us, when the present communication is not followed by any binding agreement between the parties.
> >
> >
> >
> > -----Original Message-----
> > From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> > Sent: Friday, January 11, 2008 10:24 PM
> > To: Cassiano, Marco
> > Cc: mod_python@modpython.org
> > Subject: Re: [mod_python] Mod_python and kerberos authentication (mod_auth_kerb)
> >
> > When using mod_python.publisher, you would get a Bad Request error if
> > the request wasn't either a GET or POST. What is the type of HTTP
> > request?
> >
> > Graham
> >
> > On 12/01/2008, Cassiano, Marco <mcassiano@manord.com> wrote:
> > >
> > >
> > > Hi all,
> > >
> > > I've just configured our apache server (Linux RedHat) for kerberos
> > > authentication to allow our windows domain users to access it without having
> > > to reauthenticate.
> > > Everything works fine for a plain html directory, so I'm pretty sure that
> > > the kerberos configuration for the apache server is working.
> > > When I try to specify Kerberos authentication together with mod_python it's
> > > not working. I got the message :
> > >
> > >
> > >
> > > Bad Request
> > >
> > > Your browser sent a request that this server could not understand.
> > >
> > >
> > >
> > > My httpd configuration is :
> > >
> > >
> > > Alias /login/ "/var/www/kerb/login/"
> > >
> > >
> > > <Directory "/var/www/kerb/login">
> > > ##  AuthName "Kerberos Login"
> > >   AuthType Kerberos
> > >   KrbAuthRealm FOO.COM
> > >   KrbServiceName HTTP/apache.foo.com@FOO.COM
> > >   Krb5Keytab /etc/httpd/conf/apache.tab
> > >   KrbMethodNegotiate on
> > >   KrbMethodK5Passwd off
> > > #  KrbSaveCredentials off
> > > #  KrbVerifyKDC off
> > >   Require valid-user
> > >
> > >   Order Deny,Allow
> > >   Deny from all
> > >   Allow from foo.com
> > >   Allow from 127.0.0.1
> > >
> > >   SetHandler mod_python
> > >   PythonHandler mod_python.publisher | .py
> > >   PythonDebug on
> > >   PythonOption ApplicationPath '/'
> > >
> > > </Directory>
> > >
> > >
> > > Thanks in advance for your advice
> > >
> > >
> > > Marco Cassiano
> > >
> > > Manifatture del Nord srl
> > >
> > > Italy
> > >
> > >
> > >
> > >
> > > ---------------------------------------------------------------------------------------------
> > >
> > > Il contenuto della presente comunicazione ? riservato e destinato
> > > esclusivamente ai destinatari indicati. Nel caso in cui sia ricevuto da
> > > persona diversa dal destinatario sono proibite la diffusione, la
> > > distribuzione e la copia. Nel caso riceveste la presente per errore, Vi
> > > preghiamo di informarci e di distruggerlo e/o cancellarlo dal Vostro
> > > computer, senza utilizzare i dati contenuti.
> > >
> > >
> > >
> > > La presente comunicazione (comprensiva dei documenti allegati) non avr?
> > > valore di proposta contrattuale e/o accettazione di proposte provenienti dal
> > > destinatario, n? rinuncia o riconoscimento di diritti, debiti e/o crediti,
> > > n? sar? impegnativa, qualora non sia sottoscritto successivo accordo da chi
> > > pu? validamente obbligarci. Non deriver? alcuna responsabilit?
> > > precontrattuale a ns. carico, se la presente non sia seguita da contratto
> > > sottoscritto dalle parti.
> > >
> > > ---------------------------------------------------------------------------------------------
> > >
> > > The contents of the present communication is strictly confidential and
> > > reserved solely to the referred addressees. In the event was received by
> > > person different from the addressee, it is forbidden the diffusion,
> > > distribution and copy. In the event you have received it mistakenly we ask
> > > you to inform us and to destroy and/or to delete it by your computer,
> > > without using the data herein contained.
> > >
> > >
> > >
> > > The present message (eventual annexes inclusive) shall not be considered any
> > > contractual proposal and/or acceptance of offer coming from the addressee,
> > > nor waiver neither recognizance of rights, debts and/or credits, and it
> > > shall not be binding, when it is not executed a subsequent agreement by
> > > person who could lawfully represent us. No pre-contractual liability shall
> > > derive to us, when the present communication is not followed by any binding
> > > agreement between the parties.
> > >
> > > ---------------------------------------------------------------------------------------------
> > >
> > > _______________________________________________
> > > Mod_python mailing list
> > > Mod_python@modpython.org
> > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > >
> > >
> >
>

From happybrowndog at hotmail.com  Tue Jan 15 19:34:46 2008
From: happybrowndog at hotmail.com (happybrowndog)
Date: Wed Jan 16 03:30:15 2008
Subject: [mod_python] How do I do this - mimic a browser calling javascript
Message-ID: <fmjjfd$qnh$1@ger.gmane.org>

How do I do this?

I'm running mod_python.  The apache server is also a proxy for another 
web server.  In one of my mod_python scripts, I need to mimic a browser 
and call into the proxied web server... specifically, I need to make a 
javascript call.  I'm not concerned about the result of the call, other 
than to know it worked.  The javascript call in question is:

dojox.cometd.publish(?/channel?, json_object);

which requires includes of several javascript source files.

I looked into urllib and saw only things to do POST and GET, which is 
not suitable.



From scarfboy at gmail.com  Wed Jan 16 07:33:57 2008
From: scarfboy at gmail.com (Bart)
Date: Wed Jan 16 07:34:03 2008
Subject: [mod_python] How do I do this - mimic a browser calling javascript
In-Reply-To: <fmjjfd$qnh$1@ger.gmane.org>
References: <fmjjfd$qnh$1@ger.gmane.org>
Message-ID: <b71082d80801160433ie924d1cu85e0aced38c3ae49@mail.gmail.com>

On Jan 16, 2008 1:34 AM, happybrowndog <happybrowndog@hotmail.com> wrote:
> How do I do this?
>
> I'm running mod_python.  The apache server is also a proxy for another
> web server.  In one of my mod_python scripts, I need to mimic a browser
> and call into the proxied web server... specifically, I need to make a
> javascript call.  I'm not concerned about the result of the call, other
> than to know it worked.  The javascript call in question is:
>
> dojox.cometd.publish('/channel', json_object);
>
> which requires includes of several javascript source files.
>
> I looked into urllib and saw only things to do POST and GET, which is
> not suitable.

Well, AJAX *is* just POST or GET, if usually with a little code to make it
easier to do certain things. I don't use dojo, but it looks like most of what
you need here is to serialize that object, which is probably simple enough
to mimic with python code.

Given, of course, that you know exactly what the javascript version does,
(in terms of variable naming, possible wrapping and such).
Maybe the dojox docs will tell you, otherwise you can probably figure it out
with something like firebug, fiddler, or Tamper Data.


Regards,
--Bart
From inboundfilter at gmail.com  Wed Jan 16 15:14:11 2008
From: inboundfilter at gmail.com (j a)
Date: Wed Jan 16 15:14:30 2008
Subject: [mod_python] Connection Pools
Message-ID: <9da20ce20801161214y4930de24s7f06761602de28c4@mail.gmail.com>

The topic has been covered many times before, but I'm hoping someone
can clarify what to expect when using the technique described in this
thread: http://www.modpython.org/pipermail/mod_python/2005-October/019287.html

Specifically:
> Thus, it is preferable that resource allocation and the storage of the
> handle be done in a Python module that is not imported using the module
> loading system of mod_python but that "import" be used instead. Such a
> module should preferably not be in the document tree but elsewhere on
> the Python path. As described in the link above, use an access function
> in that module which returns, and creates as necessary, the resource
> handle.

That's basically what I'm doing, under Apache 2.2 with mpm_worker,
mod_python 3.3, Publisher handler, postgres, psycopg2. In my
implementation, the module has one top-level name for a
psycopg2.PersistentConnectionPool object, an init_pool() function to
set that object, a get_connection() function which returns a reference
to it, and a release(conn) function to return the connection to the
pool. Additionally, get_connection() will call init_pool() if the pool
object is None. The applications use only the get_connection() and
release(conn) functions. As far as I can tell, this is working fine.

What I'm unsure of:
1) How many pools could I potentially end up with? One pool per httpd
process, or per interpreter?

2) Are those pools and their connections available to all the threads
in a given process?

3) Will imports in the applications overwrite the pool object
initialized by prior calls to init_pool() or get_connection()? Related
to #2? Does module caching deal with this?

4) Will the pool(s)/connections be closed when Apache kills off a
process? Automatically? Will I need a specific cleanup function?
How/when would that be called()?

I've also read this whole thread:
http://www.modpython.org/pipermail/mod_python/2005-September/019092.html,
and this article: http://www.dscpl.com.au/articles/modpython-004.html,
both of which were helpful with how to deal with the connections, but
don't really talk about what I'm asking here.
From graham.dumpleton at gmail.com  Wed Jan 16 15:31:13 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Wed Jan 16 15:31:17 2008
Subject: [mod_python] Connection Pools
In-Reply-To: <9da20ce20801161214y4930de24s7f06761602de28c4@mail.gmail.com>
References: <9da20ce20801161214y4930de24s7f06761602de28c4@mail.gmail.com>
Message-ID: <88e286470801161231x56cbb8eci6e04b0b5aaff40a1@mail.gmail.com>

On 17/01/2008, j a <inboundfilter@gmail.com> wrote:
> The topic has been covered many times before, but I'm hoping someone
> can clarify what to expect when using the technique described in this
> thread: http://www.modpython.org/pipermail/mod_python/2005-October/019287.html
>
> Specifically:
> > Thus, it is preferable that resource allocation and the storage of the
> > handle be done in a Python module that is not imported using the module
> > loading system of mod_python but that "import" be used instead. Such a
> > module should preferably not be in the document tree but elsewhere on
> > the Python path. As described in the link above, use an access function
> > in that module which returns, and creates as necessary, the resource
> > handle.
>
> That's basically what I'm doing, under Apache 2.2 with mpm_worker,
> mod_python 3.3, Publisher handler, postgres, psycopg2. In my
> implementation, the module has one top-level name for a
> psycopg2.PersistentConnectionPool object, an init_pool() function to
> set that object, a get_connection() function which returns a reference
> to it, and a release(conn) function to return the connection to the
> pool. Additionally, get_connection() will call init_pool() if the pool
> object is None. The applications use only the get_connection() and
> release(conn) functions. As far as I can tell, this is working fine.
>
> What I'm unsure of:
> 1) How many pools could I potentially end up with? One pool per httpd
> process, or per interpreter?

One pool per interpreter per process.

Noting that default for mod_python is one interpreter for all requests
against a virtual host.

> 2) Are those pools and their connections available to all the threads
> in a given process?

No, only those in the same interpreter context.

> 3) Will imports in the applications overwrite the pool object
> initialized by prior calls to init_pool() or get_connection()? Related
> to #2? Does module caching deal with this?

Depends on whether the module is a candidate for module reloading or
not. See about __mp_clone__ hooks in import_module() documentation of:

  http://www.modpython.org/live/current/doc-html/pyapi-apmeth.html

The easiest thing to do is separate out the pool management code into
separate module which is import from Python module search path, and
thus not using mod_python specific module reloading mechanism and you
will not have that issue.

> 4) Will the pool(s)/connections be closed when Apache kills off a
> process? Automatically? Will I need a specific cleanup function?
> How/when would that be called()?

See register_cleanup() in same documentation.

Note that it is not reliably called given that process could crash or
not get shutdown properly.

Any atexit registered functions are not called in mod_python as
mod_python isn't implemented properly to ensure they are.

Graham

> I've also read this whole thread:
> http://www.modpython.org/pipermail/mod_python/2005-September/019092.html,
> and this article: http://www.dscpl.com.au/articles/modpython-004.html,
> both of which were helpful with how to deal with the connections, but
> don't really talk about what I'm asking here.
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From cguin at bbn.com  Wed Jan 16 17:09:34 2008
From: cguin at bbn.com (Chris Guin)
Date: Wed Jan 16 17:14:57 2008
Subject: [mod_python] A question about running 2 apps with
  mod_python
In-Reply-To: <88e286470801151515m11ff4437kfccc8e2234218361@mail.gmail.co
 m>
References: <7.0.0.16.2.20080115142131.027d4a88@bbn.com>
	<88e286470801151515m11ff4437kfccc8e2234218361@mail.gmail.com>
Message-ID: <7.0.0.16.2.20080116165955.0275ec58@bbn.com>

Thanks for the response!

My httpd.conf was not set up to use VirtualHosts at all - it simply 
uses different Location defintions, separated by distinct 
PythonInterpreter directives, to send URLs to the correct Django 
application.  Just to make sure there wasn't some arcane httpd 
feature that required the definition of at least 1 VirtualHost, I 
enclosed all my Location definitions in one VirtualHost and restarted 
httpd to no avail.  (httpd -S seemed to like my VirtualHost 
definition, so I know it is at least syntactically correct).

The problem is still largely random, but only seems to occur when 20 
or more users are logged in, and can sometimes be fixed by restarting 
httpd.  The Django documentation suggests that httpd.worker should 
not be used, but without giving any reason for it.  It may be that my 
problem is more Django related than mod_python related, so I'll see 
what if anyone on the boards over in Django land can help.

Thanks,
Chris Guin

At 06:15 PM 1/15/2008, you wrote:
>Have you defined NameVirtualHost directive properly. Lack of this
>directive when using multiple VirtualHost definitions is normally the
>cause of such mixing of site pages.
>
>Graham
>
>On 16/01/2008, Chris Guin <cguin@bbn.com> wrote:
> > We've recently switched to using worker mpm instead of prefork, and
> > things have mostly been going smoothly.  Our server is running 2
> > Django applications, one of which is forum software.  Their URL
> > spaces are entirely distinct, and each "Location" in httpd.conf has
> > been set to use one of two different PythonInterpreters depending on
> > the app it services.
> >
> > We've noticed that regular accesses to the forum pages will randomly
> > (about 50% of the time) call up the 404 page for the other
> > application.  We've noticed no similar problems in the reverse
> > direction (from the other app to the forums).  Refreshing the 404
> > page eventually gets us to the forum.
> >
> > The randomness of the error suggests to me that it has to do with
> > which httpd.worker process or thread is picking up the request, but I
> > can't explain what difference it would make.  Since we have switched
> > to worker from prefork, I suspect this may be at fault somehow.
> >
> > Any insight would be tremendously appreciated!
> >
> > Chris Guin
> >
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >


From graham.dumpleton at gmail.com  Wed Jan 16 19:52:13 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Wed Jan 16 19:52:20 2008
Subject: [mod_python] A question about running 2 apps with mod_python
In-Reply-To: <7.0.0.16.2.20080116165955.0275ec58@bbn.com>
References: <7.0.0.16.2.20080115142131.027d4a88@bbn.com>
	<88e286470801151515m11ff4437kfccc8e2234218361@mail.gmail.com>
	<7.0.0.16.2.20080116165955.0275ec58@bbn.com>
Message-ID: <88e286470801161652i3366bbd3l7bb9ff0e384c7162@mail.gmail.com>

On 17/01/2008, Chris Guin <cguin@bbn.com> wrote:
> Thanks for the response!
>
> My httpd.conf was not set up to use VirtualHosts at all - it simply
> uses different Location defintions, separated by distinct
> PythonInterpreter directives, to send URLs to the correct Django
> application.  Just to make sure there wasn't some arcane httpd
> feature that required the definition of at least 1 VirtualHost, I
> enclosed all my Location definitions in one VirtualHost and restarted
> httpd to no avail.  (httpd -S seemed to like my VirtualHost
> definition, so I know it is at least syntactically correct).
>
> The problem is still largely random, but only seems to occur when 20
> or more users are logged in, and can sometimes be fixed by restarting
> httpd.  The Django documentation suggests that httpd.worker should
> not be used, but without giving any reason for it.  It may be that my
> problem is more Django related than mod_python related, so I'll see
> what if anyone on the boards over in Django land can help.

Use of worker MPM shouldn't have anything to do with it.

Am a bit overloaded at the moment so don't have time to really dig
further, so only quick thing I can suggest is to use mod_wsgi instead
and delegate your separate applications to run in separate daemon
process groups using its daemon mode. Or, if one is more important
than the other, continue to run it in embedded mode and run the others
in daemon mode.

This way each application is in a separate set of processes and if it
is a problem with mod_python/Python in some way, it shouldn't occur
again because of the different way that mod_wsgi works. If it does
still occur, then it has to be an issue with your Apache configuration
or something to do with page caching in Apache, a proxy or the
browser, although nothing should cache 404 pages.

Graham

> Thanks,
> Chris Guin
>
> At 06:15 PM 1/15/2008, you wrote:
> >Have you defined NameVirtualHost directive properly. Lack of this
> >directive when using multiple VirtualHost definitions is normally the
> >cause of such mixing of site pages.
> >
> >Graham
> >
> >On 16/01/2008, Chris Guin <cguin@bbn.com> wrote:
> > > We've recently switched to using worker mpm instead of prefork, and
> > > things have mostly been going smoothly.  Our server is running 2
> > > Django applications, one of which is forum software.  Their URL
> > > spaces are entirely distinct, and each "Location" in httpd.conf has
> > > been set to use one of two different PythonInterpreters depending on
> > > the app it services.
> > >
> > > We've noticed that regular accesses to the forum pages will randomly
> > > (about 50% of the time) call up the 404 page for the other
> > > application.  We've noticed no similar problems in the reverse
> > > direction (from the other app to the forums).  Refreshing the 404
> > > page eventually gets us to the forum.
> > >
> > > The randomness of the error suggests to me that it has to do with
> > > which httpd.worker process or thread is picking up the request, but I
> > > can't explain what difference it would make.  Since we have switched
> > > to worker from prefork, I suspect this may be at fault somehow.
> > >
> > > Any insight would be tremendously appreciated!
> > >
> > > Chris Guin
> > >
> > >
> > > _______________________________________________
> > > Mod_python mailing list
> > > Mod_python@modpython.org
> > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > >
>
>
>
From dirac3000 at gmail.com  Thu Jan 17 11:52:16 2008
From: dirac3000 at gmail.com (dirac3000)
Date: Thu Jan 17 11:52:23 2008
Subject: [mod_python] File does not exist: /path/to/myscript.pyc/myfunc
Message-ID: <e74f89fd0801170852p556afa99n1371627e6ee609be@mail.gmail.com>

Hello,
I am using mod_python 2.7.11-2 and my script works only the first time
I try to run it, calling, for example
http://myserver/path/to/myscript/myfunc. The next time I see this kind
of error in the apache error log:

[error] [client <my ip address>] File does not exist:
/path/to/myscript.pyc/myfunc

I tried to delete the pyc file, and to remove the write privileges to
apache, and it worked (I suppose it always parses the .py this way).
Another solution that makes it work is to add a handler for the .pyc
extension, but don't know if this is the correct solution:

<Directory /path/to/myscript>
	AddHandler python-program .py
	AddHandler python-program .pyc
	PythonHandler mod_python.publisher
	PythonDebug On
</Directory>

Is this the correct setup or am I doing something wrong?
Any suggestion?
From mcassiano at manord.com  Thu Jan 17 12:08:27 2008
From: mcassiano at manord.com (Cassiano, Marco)
Date: Thu Jan 17 12:08:37 2008
Subject: [mod_python] Mod_python and kerberos authentication
	(mod_auth_kerb)
In-Reply-To: <88e286470801152203ic31d4e9i7f3c3de72654fbb0@mail.gmail.com>
References: <BC53C974C3B9E542BC0A9BD4C5B1168A03EB07A5@NEWMAIL.manord.com>
	<88e286470801111324j7212fbcbu90a8c19bcd4dc9e4@mail.gmail.com>
	<BC53C974C3B9E542BC0A9BD4C5B1168A03EB07A9@NEWMAIL.manord.com>
	<88e286470801141327w67a8f8eeu3b0de63dc7684d41@mail.gmail.com>
	<BC53C974C3B9E542BC0A9BD4C5B1168A03EB07B9@NEWMAIL.manord.com>
	<88e286470801152203ic31d4e9i7f3c3de72654fbb0@mail.gmail.com>
Message-ID: <BC53C974C3B9E542BC0A9BD4C5B1168A03EB07CB@NEWMAIL.manord.com>

Thank you Graham,

it was a bug fixed in v 3.3.1 (installed, tested and it works)
I was using v 3.2.10.


Marco Cassiano 
  


 

---------------------------------------------------------------------------------------------

Il contenuto della presente comunicazione ? riservato e destinato esclusivamente ai destinatari indicati. Nel caso in cui sia ricevuto da persona diversa dal destinatario sono proibite la diffusione, la distribuzione e la copia. Nel caso riceveste la presente per errore, Vi preghiamo di informarci e di distruggerlo e/o cancellarlo dal Vostro computer, senza utilizzare i dati contenuti.




-----Original Message-----
From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com] 
Sent: Wednesday, January 16, 2008 7:04 AM
To: Cassiano, Marco
Cc: mod_python@modpython.org
Subject: Re: [mod_python] Mod_python and kerberos authentication (mod_auth_kerb)

I remember now.

See:

  http://issues.apache.org/jira/browse/MODPYTHON-47

Use same workaround as described in their for using Digest auth with publisher.

Graham

On 16/01/2008, Cassiano, Marco <mcassiano@manord.com> wrote:
> Graham,
>
> here is the information from mod_python.testhandler.
> The kerberos authentication worked fine with testhandler.
> I can't see anything strange in the output....
> Thank
>
> marco
>
>
> -----------------------------------------------------------------------------
>
>
>
> General information
> Apache version  Apache
> Apache threaded MPM     No (single thread MPM)
> Apache forked MPM       Yes, maximum 256 processes
> Apache server root      /etc/httpd/
> Apache document root    /var/www/html/site
> Apache error log        /var/log/www/error.log (view last 100 lines)
> Python sys.version      2.4.2 (#1, Jan 30 2006, 15:30:03) [GCC 3.2.3 20030502 (Red Hat Linux 3.2.3-53)]
> Python sys.path
>
> /var/www/cgi/testkerb/
> /usr/local/lib/python2.4/site-packages/setuptools-0.6c5-py2.4.egg
> /usr/local/lib/python24.zip
> /usr/local/lib/python2.4
> /usr/local/lib/python2.4/plat-linux2
> /usr/local/lib/python2.4/lib-tk
> /usr/local/lib/python2.4/lib-dynload
> /usr/local/lib/python2.4/site-packages
> /usr/local/lib/python2.4/site-packages/PIL
> /usr/local/lib/python2.4/site-packages/barcode
> /usr/local/lib/python2.4/site-packages/MySQLdb
> /usr/local/lib/python2.4/site-packages/_xmlplus
> /usr/local/lib/python2.4/site-packages/reportlab
>
> Python interpreter name apache.foo.com
> mod_python.publisher available  Yes
> mod_python.psp available        Yes
> Request input headers
> Key     Value
> Host    apache.foo.com
> User-Agent      Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.11) Gecko/20071127 Firefox/2.0.0.11
> Accept  text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5
> Accept-Language en-us,en;q=0.5
> Accept-Encoding gzip,deflate
> Accept-Charset  ISO-8859-1,utf-8;q=0.7,*;q=0.7
> Keep-Alive      300
> Connection      keep-alive
> Authorization   Negotiate Y....4
> Request environment
> Key     Value
> SCRIPT_URL      /test/domain_login1.py/check_user
> SCRIPT_URI      http://apache.foo.com/test/domain_login1.py/check_user
> GATEWAY_INTERFACE       CGI/1.1
> SERVER_PROTOCOL HTTP/1.1
> REQUEST_METHOD  GET
> QUERY_STRING
> REQUEST_URI     /test/domain_login1.py/check_user
> SCRIPT_NAME     /test/domain_login1.py
> PATH_INFO       /check_user
> PATH_TRANSLATED /var/www/check_user
> HTTP_HOST       apache.foo.com
> HTTP_USER_AGENT Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.11) Gecko/20071127 Firefox/2.0.0.11
> HTTP_ACCEPT     text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5
> HTTP_ACCEPT_LANGUAGE    en-us,en;q=0.5
> HTTP_ACCEPT_ENCODING    gzip,deflate
> HTTP_ACCEPT_CHARSET     ISO-8859-1,utf-8;q=0.7,*;q=0.7
> HTTP_KEEP_ALIVE 300
> HTTP_CONNECTION keep-alive
> PATH    /usr/local/bin:/sbin:/usr/sbin:/bin:/usr/bin:/usr/X11R6/bin
> SERVER_SIGNATURE
> SERVER_SOFTWARE Apache
> SERVER_NAME     apache.foo.com
> SERVER_ADDR     192.168.1.150
> SERVER_PORT     80
> REMOTE_ADDR     192.168.1.1
> DOCUMENT_ROOT   /var/www/html/site
> SERVER_ADMIN    admin@foo.com
> SCRIPT_FILENAME /var/www/cgi/testkerb/domain_login1.py
> REMOTE_PORT     1681
> REMOTE_USER     admin@@FOO.COM
> AUTH_TYPE       Negotiate
> Request configuration
> Key     Value
> PythonAutoReload        1
> PythonDebug     1
> Request options
> Key     Value
> ApplicationPath /
> SessionDbm      /var/www/html/sid/session.dbm
> session_directory       /var/www/html/sid/session
> Request notes
> Key     Value
> python_init_ran 1
> mod_rewrite_rewritten   0
> Server configuration
> Key     Value
> PythonAutoReload        1
> PythonDebug     1
> PythonPath      sys.path+['/var/www/cgi/common','/var/www/cgi/devel']
> Server options
> Key     Value
> Server configuration tree
>
> ServerTokens Prod
> PidFile run/httpd.pid
> Timeout 120
> KeepAlive On
> MaxKeepAliveRequests 3
> KeepAliveTimeout 15
> StartServers 8
> MinSpareServers 5
> MaxSpareServers 20
> ServerLimit 256
> MaxClients 256
> MaxRequestsPerChild 50
> Listen 0.0.0.0:80
>
>
>         SetHandler default-handler
> Alias /test/ "/var/www/cgi/testkerb/"
>
>     AuthType Kerberos
>     KrbAuthRealm FOO.COM
>     KrbServiceName HTTP/apache.foo.com@FOO.COM
>     Krb5Keytab /etc/httpd//conf/sviluppotab
>     KrbMethodNegotiate on
>     KrbMethodK5Passwd off
>     Require valid-user
>     Order Deny,Allow
>     Deny from all
>     Allow from 192.168.1
>     Allow from 127.0.0.1
>     SetHandler mod_python
>     PythonHandler mod_python.testhandler | .py
>     PythonAutoReload on
>     PythonDebug on
>     PythonOption ApplicationPath '/'
>     PythonOption SessionDbm '/var/www/html/authdata/sid/session.dbm'
>     PythonOption session_directory '/var/www/html/authdata/sid/session'
>
> RewriteEngine on
> RewriteCond %{REQUEST_METHOD} ^(TRACE|TRACK)
> RewriteRule .* - [F]
> ExtendedStatus On
> User apache
> Group apache
> ServerAdmin admin@foo.com
> ServerName apache.foo.com
> UseCanonicalName Off
> DocumentRoot "/var/www/html/site"
>
>     Options None
>     AllowOverride None
>     Order Deny,Allow
>
> UserDir disable root
> DirectoryIndex index.html index.html.var
> AccessFileName .htaccess
>
>     Order allow,deny
>     Deny from all
> TypesConfig /etc/mime.types
> DefaultType text/plain
> HostnameLookups Off
> ErrorLog /var/log/www/error.log
> LogLevel debug
> LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" combined
> LogFormat "%h %l %u %t \"%r\" %>s %b" common
> LogFormat "%{Referer}i -> %U" referer
> LogFormat "%{User-agent}i" agent
> CustomLog /var/log/www/access.log combined
> ServerSignature Off
> IndexOptions FancyIndexing VersionSort NameWidth=*
> AddIconByEncoding (CMP,/icons/compressed.gif) x-compress x-gzip
> AddIconByType (TXT,/icons/text.gif) text/*
> AddIconByType (IMG,/icons/image2.gif) image/*
> AddIconByType (SND,/icons/sound2.gif) audio/*
> AddIconByType (VID,/icons/movie.gif) video/*
> AddIcon /icons/binary.gif .bin .exe
> AddIcon /icons/binhex.gif .hqx
> AddIcon /icons/tar.gif .tar
> AddIcon /icons/world2.gif .wrl .wrl.gz .vrml .vrm .iv
> AddIcon /icons/compressed.gif .Z .z .tgz .gz .zip
> AddIcon /icons/a.gif .ps .ai .eps
> AddIcon /icons/layout.gif .html .shtml .htm .pdf
> AddIcon /icons/text.gif .txt
> AddIcon /icons/c.gif .c
> AddIcon /icons/p.gif .pl .py
> AddIcon /icons/f.gif .for
> AddIcon /icons/dvi.gif .dvi
> AddIcon /icons/uuencoded.gif .uu
> AddIcon /icons/script.gif .conf .sh .shar .csh .ksh .tcl
> AddIcon /icons/tex.gif .tex
> AddIcon /icons/bomb.gif core
> AddIcon /icons/back.gif ..
> AddIcon /icons/hand.right.gif README
> AddIcon /icons/folder.gif ^^DIRECTORY^^
> AddIcon /icons/blank.gif ^^BLANKICON^^
> DefaultIcon /icons/unknown.gif
> ReadmeName README.html
> HeaderName HEADER.html
> IndexIgnore .??* *~ *# HEADER* README* RCS CVS *,v *,t
> AddLanguage en .en
> AddLanguage it .it
> LanguagePriority en it
> AddDefaultCharset ISO-8859-1
> AddCharset ISO-8859-1  .iso8859-1  .latin1
> AddCharset ISO-8859-2  .iso8859-2  .latin2 .cen
> AddCharset ISO-8859-3  .iso8859-3  .latin3
> AddCharset ISO-8859-4  .iso8859-4  .latin4
> AddCharset UTF-8       .utf8
> AddCharset utf-8       .utf8
> AddType application/x-compress .Z
> AddType application/x-gzip .gz .tgz
> AddHandler imap-file map
> AddHandler type-map var
> AddType text/html .shtml
> AddOutputFilter INCLUDES .shtml
> Alias /error/ "/var/www/error/"
>
>     AllowOverride None
>     Options IncludesNoExec
>     AddOutputFilter Includes html
>     AddHandler type-map var
>     Order allow,deny
>     Allow from all
>     LanguagePriority en es de fr
>     ForceLanguagePriority Prefer Fallback
> BrowserMatch "Mozilla/2" nokeepalive
> BrowserMatch "MSIE 4\.0b2;" nokeepalive downgrade-1.0 force-response-1.0
> BrowserMatch "RealPlayer 4\.0" force-response-1.0
> BrowserMatch "Java/1\.0" force-response-1.0
> BrowserMatch "JDK/1\.0" force-response-1.0
> BrowserMatch "Microsoft Data Access Internet Publishing Provider" redirect-carefully
> BrowserMatch "^WebDrive" redirect-carefully
> BrowserMatch "^WebDAVFS/1.[012]" redirect-carefully
> BrowserMatch "^gnome-vfs" redirect-carefully
>
>
> Marco Cassiano
>
> Manifatture del Nord srl unipersonale
> Gruppo MaxMara
>
> via Mazzacurati 6
> 42100 Reggio Emilia RE
> ITALY
>
> Tel. +39 0522 358215
> Fax +39 0522 268715
> email : mcassiano@manord.com
> www.pennyblack.com
>
>
>
> ---------------------------------------------------------------------------------------------
>
> Il contenuto della presente comunicazione ? riservato e destinato esclusivamente ai destinatari indicati. Nel caso in cui sia ricevuto da persona diversa dal destinatario sono proibite la diffusione, la distribuzione e la copia. Nel caso riceveste la presente per errore, Vi preghiamo di informarci e di distruggerlo e/o cancellarlo dal Vostro computer, senza utilizzare i dati contenuti.
>
>
>
> La presente comunicazione (comprensiva dei documenti allegati) non avr? valore di proposta contrattuale e/o accettazione di proposte provenienti dal destinatario, n? rinuncia o riconoscimento di diritti, debiti e/o crediti, n? sar? impegnativa, qualora non sia sottoscritto successivo accordo da chi pu? validamente obbligarci. Non deriver? alcuna responsabilit? precontrattuale a ns. carico, se la presente non sia seguita da contratto sottoscritto dalle parti.
>
> ---------------------------------------------------------------------------------------------
>
> The contents of the present communication is strictly confidential and reserved solely to the referred addressees. In the event was received by person different from the addressee, it is forbidden the diffusion, distribution and copy. In the event you have received it mistakenly we ask you to inform us and to destroy and/or to delete it by your computer, without using the data herein contained.
>
>
>
> The present message (eventual annexes inclusive) shall not be considered any contractual proposal and/or acceptance of offer coming from the addressee, nor waiver neither recognizance of rights, debts and/or credits, and it shall not be binding, when it is not executed a subsequent agreement by person who could lawfully represent us. No pre-contractual liability shall derive to us, when the present communication is not followed by any binding agreement between the parties.
>
> ---------------------------------------------------------------------------------------------
>
>
> -----Original Message-----
> From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> Sent: Monday, January 14, 2008 10:28 PM
> To: Cassiano, Marco
> Cc: mod_python@modpython.org
> Subject: Re: [mod_python] Mod_python and kerberos authentication (mod_auth_kerb)
>
> No access to mod_python code right now to do any checking so only
> thing I can suggest is to set handler to be mod_python.testhandler and
> have a look at what it returns and see if you can see anything strange
> about the request details that make it through. You might scrub what
> it shows of any sensitive data and post it.
>
> Graham
>
> On 14/01/2008, Cassiano, Marco <mcassiano@manord.com> wrote:
> > Graham,
> >
> > thank you for your answer.
> > I've made a very simple test script named domain_login.py. Here it is :
> >
> > def check_user(req):
> >         return 'ok'
> >
> > and I call it with the URL  http://apache.foo.com/login/domain_login.py/check_user
> >
> > So, to answer your question, the request is a GET.
> > It is strange that if I put in the URL a wrong (non-existent) name, for example :
> >
> >  http://apache.foo.com/login/domain_login.py/wrong_call
> >
> > I got the same Bad Request error. So the problem seems to occur before the execution of the script.
> > In the apache error log I only see that the kerberos authentication was ok and then nothing else...
> >
> >
> > [Mon Jan 14 10:04:35 2008] [debug] src/mod_auth_kerb.c(1485): [client 192.168.1.25] kerb_authenticate_user entered with user (NULL) and auth_type Kerberos
> > [Mon Jan 14 10:04:35 2008] [debug] src/mod_auth_kerb.c(1485): [client 192.168.1.25] kerb_authenticate_user entered with user (NULL) and auth_type Kerberos
> > [Mon Jan 14 10:04:35 2008] [debug] src/mod_auth_kerb.c(1172): [client 192.168.1.25] Acquiring creds for HTTP/sviluppo.manord.com@MANORD.COM
> > [Mon Jan 14 10:04:35 2008] [debug] src/mod_auth_kerb.c(1316): [client 192.168.1.25] Verifying client data using SPNEGO GSS-API
> > [Mon Jan 14 10:04:35 2008] [debug] src/mod_auth_kerb.c(1332): [client 192.168.1.25] Verification returned code 0
> > [Mon Jan 14 10:04:35 2008] [debug] src/mod_auth_kerb.c(1350): [client 192.168.1.25] GSS-API token of length 151 bytes will be sent back
> >
> > In the apache access.log I see two entries
> >
> >
> > 192.168.1.25 - - [14/Jan/2008:10:56:04 +0100] "GET /login/domain_login1.py/check_user HTTP/1.1" 401 401 "-" "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.11) Gecko/20071127 Firefox/2.0.0.11"
> > 192.168.1.25 - myuser@FOO.COM [14/Jan/2008:10:56:04 +0100] "GET /login/domain_login1.py/check_user HTTP/1.1" 404 231 "-" "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.11) Gecko/20071127 Firefox/2.0.0.11"
> >
> >
> > In the second line the windows domain user is correctly reported so it seems the kerberos authentication worked...
> >
> >
> > If I remove the kerberos authentication, the script works ok.
> > If I remove the mod_python handler from the directory and I ask for a plain html page the kerberos authentication works...
> >
> > We also tried with mod_python.servlet (PythonHandler mod_python.servlet)
> > and the kerberos authentication works perfectly. The script is executed and we can retrieve the username in req.user.
> >
> > So it seems a problem related to the publisher....
> >
> >
> >
> > Thank you
> >
> >
> >
> > Marco Cassiano
> >
> > Manifatture del Nord srl unipersonale
> > Gruppo MaxMara
> >
> > via Mazzacurati 6
> > 42100 Reggio Emilia RE
> > ITALY
> >
> > Tel. +39 0522 358215
> > Fax +39 0522 268715
> > email : mcassiano@manord.com
> > www.pennyblack.com
> >
> >
> >
> > The contents of the present communication is strictly confidential and reserved solely to the referred addressees. In the event was received by person different from the addressee, it is forbidden the diffusion, distribution and copy. In the event you have received it mistakenly we ask you to inform us and to destroy and/or to delete it by your computer, without using the data herein contained.
> >
> >
> >
> > The present message (eventual annexes inclusive) shall not be considered any contractual proposal and/or acceptance of offer coming from the addressee, nor waiver neither recognizance of rights, debts and/or credits, and it shall not be binding, when it is not executed a subsequent agreement by person who could lawfully represent us. No pre-contractual liability shall derive to us, when the present communication is not followed by any binding agreement between the parties.
> >
> >
> >
> > -----Original Message-----
> > From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> > Sent: Friday, January 11, 2008 10:24 PM
> > To: Cassiano, Marco
> > Cc: mod_python@modpython.org
> > Subject: Re: [mod_python] Mod_python and kerberos authentication (mod_auth_kerb)
> >
> > When using mod_python.publisher, you would get a Bad Request error if
> > the request wasn't either a GET or POST. What is the type of HTTP
> > request?
> >
> > Graham
> >
> > On 12/01/2008, Cassiano, Marco <mcassiano@manord.com> wrote:
> > >
> > >
> > > Hi all,
> > >
> > > I've just configured our apache server (Linux RedHat) for kerberos
> > > authentication to allow our windows domain users to access it without having
> > > to reauthenticate.
> > > Everything works fine for a plain html directory, so I'm pretty sure that
> > > the kerberos configuration for the apache server is working.
> > > When I try to specify Kerberos authentication together with mod_python it's
> > > not working. I got the message :
> > >
> > >
> > >
> > > Bad Request
> > >
> > > Your browser sent a request that this server could not understand.
> > >
> > >
> > >
> > > My httpd configuration is :
> > >
> > >
> > > Alias /login/ "/var/www/kerb/login/"
> > >
> > >
> > > <Directory "/var/www/kerb/login">
> > > ##  AuthName "Kerberos Login"
> > >   AuthType Kerberos
> > >   KrbAuthRealm FOO.COM
> > >   KrbServiceName HTTP/apache.foo.com@FOO.COM
> > >   Krb5Keytab /etc/httpd/conf/apache.tab
> > >   KrbMethodNegotiate on
> > >   KrbMethodK5Passwd off
> > > #  KrbSaveCredentials off
> > > #  KrbVerifyKDC off
> > >   Require valid-user
> > >
> > >   Order Deny,Allow
> > >   Deny from all
> > >   Allow from foo.com
> > >   Allow from 127.0.0.1
> > >
> > >   SetHandler mod_python
> > >   PythonHandler mod_python.publisher | .py
> > >   PythonDebug on
> > >   PythonOption ApplicationPath '/'
> > >
> > > </Directory>
> > >
> > >
> > > Thanks in advance for your advice
> > >
> > >
> > > Marco Cassiano
> > >
> > > Manifatture del Nord srl
> > >
> > > Italy
> > >
> > >
> > >
> > >
> > > ---------------------------------------------------------------------------------------------
> > >
> > > Il contenuto della presente comunicazione ? riservato e destinato
> > > esclusivamente ai destinatari indicati. Nel caso in cui sia ricevuto da
> > > persona diversa dal destinatario sono proibite la diffusione, la
> > > distribuzione e la copia. Nel caso riceveste la presente per errore, Vi
> > > preghiamo di informarci e di distruggerlo e/o cancellarlo dal Vostro
> > > computer, senza utilizzare i dati contenuti.
> > >
> > >
> > >
> > > La presente comunicazione (comprensiva dei documenti allegati) non avr?
> > > valore di proposta contrattuale e/o accettazione di proposte provenienti dal
> > > destinatario, n? rinuncia o riconoscimento di diritti, debiti e/o crediti,
> > > n? sar? impegnativa, qualora non sia sottoscritto successivo accordo da chi
> > > pu? validamente obbligarci. Non deriver? alcuna responsabilit?
> > > precontrattuale a ns. carico, se la presente non sia seguita da contratto
> > > sottoscritto dalle parti.
> > >
> > > ---------------------------------------------------------------------------------------------
> > >
> > > The contents of the present communication is strictly confidential and
> > > reserved solely to the referred addressees. In the event was received by
> > > person different from the addressee, it is forbidden the diffusion,
> > > distribution and copy. In the event you have received it mistakenly we ask
> > > you to inform us and to destroy and/or to delete it by your computer,
> > > without using the data herein contained.
> > >
> > >
> > >
> > > The present message (eventual annexes inclusive) shall not be considered any
> > > contractual proposal and/or acceptance of offer coming from the addressee,
> > > nor waiver neither recognizance of rights, debts and/or credits, and it
> > > shall not be binding, when it is not executed a subsequent agreement by
> > > person who could lawfully represent us. No pre-contractual liability shall
> > > derive to us, when the present communication is not followed by any binding
> > > agreement between the parties.
> > >
> > > ---------------------------------------------------------------------------------------------
> > >
> > > _______________________________________________
> > > Mod_python mailing list
> > > Mod_python@modpython.org
> > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > >
> > >
> >
>

From graham.dumpleton at gmail.com  Thu Jan 17 15:43:57 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu Jan 17 15:44:03 2008
Subject: [mod_python] File does not exist: /path/to/myscript.pyc/myfunc
In-Reply-To: <e74f89fd0801170852p556afa99n1371627e6ee609be@mail.gmail.com>
References: <e74f89fd0801170852p556afa99n1371627e6ee609be@mail.gmail.com>
Message-ID: <88e286470801171243j324dd41t856255d01f85effc@mail.gmail.com>

You could also just upgrade to mod_python 3.3.1 provided you are stuck
with Apache 1.3, then you will not have this problem at all.

Grahan

On 18/01/2008, dirac3000 <dirac3000@gmail.com> wrote:
> Hello,
> I am using mod_python 2.7.11-2 and my script works only the first time
> I try to run it, calling, for example
> http://myserver/path/to/myscript/myfunc. The next time I see this kind
> of error in the apache error log:
>
> [error] [client <my ip address>] File does not exist:
> /path/to/myscript.pyc/myfunc
>
> I tried to delete the pyc file, and to remove the write privileges to
> apache, and it worked (I suppose it always parses the .py this way).
> Another solution that makes it work is to add a handler for the .pyc
> extension, but don't know if this is the correct solution:
>
> <Directory /path/to/myscript>
>         AddHandler python-program .py
>         AddHandler python-program .pyc
>         PythonHandler mod_python.publisher
>         PythonDebug On
> </Directory>
>
> Is this the correct setup or am I doing something wrong?
> Any suggestion?
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From graham.dumpleton at gmail.com  Thu Jan 17 15:44:22 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu Jan 17 15:44:29 2008
Subject: [mod_python] File does not exist: /path/to/myscript.pyc/myfunc
In-Reply-To: <88e286470801171243j324dd41t856255d01f85effc@mail.gmail.com>
References: <e74f89fd0801170852p556afa99n1371627e6ee609be@mail.gmail.com>
	<88e286470801171243j324dd41t856255d01f85effc@mail.gmail.com>
Message-ID: <88e286470801171244g524bda00k53e2cabb96de06d9@mail.gmail.com>

s/are stuck/aren't stuck/

On 18/01/2008, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> You could also just upgrade to mod_python 3.3.1 provided you are stuck
> with Apache 1.3, then you will not have this problem at all.
>
> Grahan
>
> On 18/01/2008, dirac3000 <dirac3000@gmail.com> wrote:
> > Hello,
> > I am using mod_python 2.7.11-2 and my script works only the first time
> > I try to run it, calling, for example
> > http://myserver/path/to/myscript/myfunc. The next time I see this kind
> > of error in the apache error log:
> >
> > [error] [client <my ip address>] File does not exist:
> > /path/to/myscript.pyc/myfunc
> >
> > I tried to delete the pyc file, and to remove the write privileges to
> > apache, and it worked (I suppose it always parses the .py this way).
> > Another solution that makes it work is to add a handler for the .pyc
> > extension, but don't know if this is the correct solution:
> >
> > <Directory /path/to/myscript>
> >         AddHandler python-program .py
> >         AddHandler python-program .pyc
> >         PythonHandler mod_python.publisher
> >         PythonDebug On
> > </Directory>
> >
> > Is this the correct setup or am I doing something wrong?
> > Any suggestion?
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
>
From graham.dumpleton at gmail.com  Thu Jan 17 15:56:22 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu Jan 17 15:56:31 2008
Subject: Fwd: [mod_python] Connection Pools
In-Reply-To: <9da20ce20801171253u4350de13nb42e8f001ad6dd5d@mail.gmail.com>
References: <9da20ce20801161214y4930de24s7f06761602de28c4@mail.gmail.com>
	<88e286470801161231x56cbb8eci6e04b0b5aaff40a1@mail.gmail.com>
	<9da20ce20801170844k3e44353fgb3c9be1a74cda24d@mail.gmail.com>
	<88e286470801171241u3e140b4ma045885200f95dcc@mail.gmail.com>
	<9da20ce20801171253u4350de13nb42e8f001ad6dd5d@mail.gmail.com>
Message-ID: <88e286470801171256m4f660d40u9221bf239bcf1e62@mail.gmail.com>

Following missed the mailing list. Included in case anyone was
following this issue.

---------- Forwarded message ----------
From: j a <inboundfilter@gmail.com>
Date: 18 Jan 2008 07:53
Subject: Re: [mod_python] Connection Pools
To: Graham Dumpleton <graham.dumpleton@gmail.com>


Argh... just realized I did reply earlier, instead of reply all. Sorry
about that.

Thanks very much for your help, it definitely solidifies what I had
floating around in my head about how these things worked together.

-John

On Jan 17, 2008 3:41 PM, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> On 18/01/2008, j a <inboundfilter@gmail.com> wrote:
> > > > What I'm unsure of:
> > > > 1) How many pools could I potentially end up with? One pool per httpd
> > > > process, or per interpreter?
> > >
> > > One pool per interpreter...
> > OK, I understand that, but...
> >
> > > ... per process
> > >
> > > Noting that default for mod_python is one interpreter for all requests
> > > against a virtual host.
> >
> > I'm confused on this point. Section 4.1 in the doc says "...scripts in
> > the same virtual server execute in the same subinterpreter", which
> > makes sense until "...exists until the Apache process dies". So say I
> > have two virtual hosts, each with an app that instantiates a pool, and
> > two httpd processes (from the default mpm_worker config). Would I get
> > four interpreters (and four pools)?
>
> Yes. Each process would have a sub interpreter instance for each virtual host.
>
> See:
>
>   http://www.dscpl.com.au/wiki/ModPython/Articles/TheProcessInterpreterModel
>
> > > > 3) Will imports in the applications overwrite the pool object
> > > > initialized by prior calls to init_pool() or get_connection()? Related
> > > > to #2? Does module caching deal with this?
> > >
> > > Depends on whether the module is a candidate for module reloading or
> > > not. See about __mp_clone__ hooks in import_module() documentation of:
> > >
> > >   http://www.modpython.org/live/current/doc-html/pyapi-apmeth.html
> >
> > This would only be an issue in a dev environment, correct? With auto
> > reloading disabled in production, would I have to even worry about
> > this at all?
>
> Better to be safe than sorry. There is an unfixed bug in mod_python
> which can in certain race conditions cause the module to be reloaded
> even if reloading is off.
>
> > That section raises another question: without auto reloading, but
> > running under mpm_worker, do I still need to contend with thread
> > locks?
>
> That depends on your code and how you use global data.
>
> > > The easiest thing to do is separate out the pool management code into
> > > separate module which is import from Python module search path, and
> > > thus not using mod_python specific module reloading mechanism and you
> > > will not have that issue.
> >
> > I *think* this is what I'm doing. I have the pool management code (the
> > three functions I describer earlier) in a separate module
> > (pool_manager.py). Another module (data.py) imports that; it contains
> > functions for retrieving, updating, inserting specific data from/to
> > the database. The app imports that second module. (just trying to keep
> > the db stuff out of the app itself).
>
> But is depends on where the files live. If you are using publisher and
> in the same directory as index.py, then may be managed by mod_python.
>
> Print out __name__ in each loaded module. It if it is '_mp_??????', it
> is managed by mod_python and reloadable.
>
> > > > 4) Will the pool(s)/connections be closed when Apache kills off a
> > > > process? Automatically? Will I need a specific cleanup function?
> > > > How/when would that be called()?
> > >
> > > See register_cleanup() in same documentation.
> > >
> > > Note that it is not reliably called given that process could crash or
> > > not get shutdown properly.
> > >
> > > Any atexit registered functions are not called in mod_python as
> > > mod_python isn't implemented properly to ensure they are.
> >
> > I gave this a try a while back but I didn't have a way to test it. I'm
> > writing a small test app that makes a lot of requests for a URL (a
> > function in index.py) which opens/closes db connections. I'm hoping
> > all these requests will cause apache to kill off a process and start
> > up another, and to put some load across the threads under each
> > process.
>
> Set MaxRequestsPerChild directive in Apache to a small number as that
> will force processes to be recycled after that many requests.
>
> Graham
>
From yam at nerd.cx  Sat Jan 19 21:59:14 2008
From: yam at nerd.cx (William Witteman)
Date: Sat Jan 19 21:59:22 2008
Subject: [mod_python] Upload troubles in Debian
Message-ID: <20080120025914.GA31589@sillyrabbi.dyndns.org>

I have a server running Debian stable, and I am new to mod_python and
trying to get file uploads handled under the publisher handler.

Here's the test code:

#!/usr/bin/python

html = """
<html><body>
<form action="upload" method="POST" enctype="multipart/form-data">
  <input type="file" name="fileupload"/>
  <input type="submit" value="Upload!">
</form>
</body></html>
"""

def index(req):
    return html

def upload(req):
    fp = req.form['fileupload'].file
    return type(fp)


Here's the error:

Mod_python error: "PythonHandler mod_python.publisher"

Traceback (most recent call last):

  File "/usr/lib/python2.4/site-packages/mod_python/apache.py", line 299, in HandlerDispatch
    result = object(req)

  File "/usr/lib/python2.4/site-packages/mod_python/publisher.py", line 213, in handler
    published = publish_object(req, object)

  File "/usr/lib/python2.4/site-packages/mod_python/publisher.py", line 412, in publish_object
    return publish_object(req,util.apply_fs_data(object, req.form, req=req))

  File "/usr/lib/python2.4/site-packages/mod_python/publisher.py", line 412, in publish_object
    return publish_object(req,util.apply_fs_data(object, req.form, req=req))

  File "/usr/lib/python2.4/site-packages/mod_python/util.py", line 401, in apply_fs_data
    fc = object.__init__.im_func.func_code

AttributeError: 'wrapper_descriptor' object has no attribute 'im_func'

I'm not sure what to try next.  Any help would be appreciated.  Thanks.
-- 

yours,

William
From cyu021 at gmail.com  Sat Jan 19 22:42:41 2008
From: cyu021 at gmail.com (James Yu)
Date: Sat Jan 19 22:42:48 2008
Subject: [mod_python] how in include custom module in psp ?
Message-ID: <60bb95410801191942s129d2b41ibdbe6f5a2812897f@mail.gmail.com>

I just finished working on a skeleton of a web site.
Now I would like to put the codes in common into some functions.
I tried to put the function in a .py file and included the file in <%%>
block, but this doesn't work.

This is the example of how I did it (both test.py and web.psp are in the
same folder):
test.py:
def hello_world():
    return 'hello world'

web.psp:
<%
import test

a = test.hello_world()
%>

This turned out showing me the following msg:

AttributeError: 'module' object has no attribute 'hello_world'


Someone please gives me a hand on importing custom modules in mod_python
PSP.
-- 
This is a UTF-8 formatted mail
-----------------------------------------------
James C.-C.Yu
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080120/222d2831/attachment.html
From graham.dumpleton at gmail.com  Sun Jan 20 01:20:06 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sun Jan 20 01:20:09 2008
Subject: [mod_python] Upload troubles in Debian
In-Reply-To: <20080120025914.GA31589@sillyrabbi.dyndns.org>
References: <20080120025914.GA31589@sillyrabbi.dyndns.org>
Message-ID: <88e286470801192220w14f13ecbw59095a0bfd5e6fef@mail.gmail.com>

Use:

def upload(req):
   fp = req.form['fileupload'].file
   return str(type(fp))

Using latest version of mod_python is also suggested.

Graham

On 20/01/2008, William Witteman <yam@nerd.cx> wrote:
> I have a server running Debian stable, and I am new to mod_python and
> trying to get file uploads handled under the publisher handler.
>
> Here's the test code:
>
> #!/usr/bin/python
>
> html = """
> <html><body>
> <form action="upload" method="POST" enctype="multipart/form-data">
>   <input type="file" name="fileupload"/>
>   <input type="submit" value="Upload!">
> </form>
> </body></html>
> """
>
> def index(req):
>     return html
>
> def upload(req):
>     fp = req.form['fileupload'].file
>     return type(fp)
>
>
> Here's the error:
>
> Mod_python error: "PythonHandler mod_python.publisher"
>
> Traceback (most recent call last):
>
>   File "/usr/lib/python2.4/site-packages/mod_python/apache.py", line 299, in HandlerDispatch
>     result = object(req)
>
>   File "/usr/lib/python2.4/site-packages/mod_python/publisher.py", line 213, in handler
>     published = publish_object(req, object)
>
>   File "/usr/lib/python2.4/site-packages/mod_python/publisher.py", line 412, in publish_object
>     return publish_object(req,util.apply_fs_data(object, req.form, req=req))
>
>   File "/usr/lib/python2.4/site-packages/mod_python/publisher.py", line 412, in publish_object
>     return publish_object(req,util.apply_fs_data(object, req.form, req=req))
>
>   File "/usr/lib/python2.4/site-packages/mod_python/util.py", line 401, in apply_fs_data
>     fc = object.__init__.im_func.func_code
>
> AttributeError: 'wrapper_descriptor' object has no attribute 'im_func'
>
> I'm not sure what to try next.  Any help would be appreciated.  Thanks.
> --
>
> yours,
>
> William
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From graham.dumpleton at gmail.com  Sun Jan 20 01:22:14 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sun Jan 20 01:22:20 2008
Subject: [mod_python] how in include custom module in psp ?
In-Reply-To: <60bb95410801191942s129d2b41ibdbe6f5a2812897f@mail.gmail.com>
References: <60bb95410801191942s129d2b41ibdbe6f5a2812897f@mail.gmail.com>
Message-ID: <88e286470801192222t20c882fdwac093f530f440bf9@mail.gmail.com>

Do not call your module 'test' as there is a standard Python module of
the same name and you may be picking that up instead of your own.

Also possible you are being affected by:

  http://issues.apache.org/jira/browse/MODPYTHON-220

Graham

On 20/01/2008, James Yu <cyu021@gmail.com> wrote:
> I just finished working on a skeleton of a web site.
> Now I would like to put the codes in common into some functions.
> I tried to put the function in a .py file and included the file in <%%>
> block, but this doesn't work.
>
> This is the example of how I did it (both test.py and web.psp are in the
> same folder):
> test.py:
> def hello_world():
>     return 'hello world'
>
> web.psp:
> <%
> import test
>
> a = test.hello_world ()
> %>
>
> This turned out showing me the following msg:
> AttributeError: 'module' object has no attribute 'hello_world'
>
> Someone please gives me a hand on importing custom modules in mod_python
> PSP.
> --
> This is a UTF-8 formatted mail
> -----------------------------------------------
> James C.-C.Yu
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
From mattb at wageslavery.org  Mon Jan 21 03:49:57 2008
From: mattb at wageslavery.org (Matt Barnicle)
Date: Mon Jan 21 03:49:29 2008
Subject: [mod_python] can't seem to expire a cookie value
Message-ID: <53369.66.127.54.171.1200905397.squirrel@webmail.wageslavery.org>

hi everyone..  been working on this little nagging problem for about 3
hours now, not getting anywhere or finding anything on the net..  as i
understand it, if i want to effectively remove a cookie from the UA, there
is no way to do it, so u just have to set the expiry date to a time in the
past, right?  but any efforts i make seem to fail.  here is the code:

cookie = Cookie.Cookie('user_name', cookies['user_name'].value)
cookie.expires = int(time.time()) - 31536000 # minus 1 year from now
Cookie.add_cookie(self.req, cookie)

using mod_python 3.2.10

what gives?  i keep the user permanently logged in with a cookie value
until they click the log out link.  but because of this problem, i am
perpetually logged into my site because the cookie never expires.

thanks,

- m@

From matusis at yahoo.com  Mon Jan 21 05:24:38 2008
From: matusis at yahoo.com (Alec Matusis)
Date: Mon Jan 21 05:25:26 2008
Subject: [mod_python] strange behavior with mpm worker (inaccurate number of
	max processes?)
Message-ID: <0e0901c85c17$d4370d40$7ca527c0$@com>

We are using worker MPM

Our apache configuration is 

 

ServerLimit 40

ThreadLimit 70

 

StartServers          10

MaxClients            1600

MinSpareThreads       75

MaxSpareThreads       200

ThreadsPerChild       40

MaxRequestsPerChild   10000

 

When apache is restarted with 

#apachectl stop

#apachectl start

We get in the error log:

[notice] mod_python: Creating 32 session mutexes based on 40 max processes
and 40 max threads

[notice] Apache/2.2.6 (Unix) mod_python/3.3.1 Python/2.4.1 configured --
resuming normal operations

This is what we expect.

 

Now we restart apache this way: 

#apachectl restart

In the error log:

[notice] SIGHUP received.  Attempting to restart

 [notice] mod_python: Creating 32 session mutexes based on 11 max processes
and 40 max threads.

 [notice] mod_python: using mutex_directory /tmp 

 [notice] Apache/2.2.6 (Unix) mod_python/3.3.1 Python/2.4.1 configured --
resuming normal operations

 

Where does this number "11 max processes" come from? We do not have it
anywhere in the configuration.

 

 

We get

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080121/552e9eaf/attachment.html
From necmettin.begiter at gmail.com  Mon Jan 21 07:04:38 2008
From: necmettin.begiter at gmail.com (Necmettin Begiter)
Date: Mon Jan 21 07:04:46 2008
Subject: [mod_python] can't seem to expire a cookie value
In-Reply-To: <53369.66.127.54.171.1200905397.squirrel@webmail.wageslavery.org>
References: <53369.66.127.54.171.1200905397.squirrel@webmail.wageslavery.org>
Message-ID: <200801211404.38904.necmettin.begiter@gmail.com>

21 January 2008 Monday 10:49:57 tarihinde Matt Barnicle ?unlar? yazm??t?:
> understand it, if i want to effectively remove a cookie from the UA, there
> is no way to do it, so u just have to set the expiry date to a time in the
> past, right?  but any efforts i make seem to fail.  here is the code:
> 
> cookie = Cookie.Cookie('user_name', cookies['user_name'].value)
> cookie.expires = int(time.time()) - 31536000 # minus 1 year from now
> Cookie.add_cookie(self.req, cookie)

Might be a problem of using int(), examples in the mod_python documentation don't use int():

http://www.modpython.org/live/current/doc-html/pyapi-cookie-example.html

From mattb at wageslavery.org  Mon Jan 21 17:38:58 2008
From: mattb at wageslavery.org (Matt Barnicle)
Date: Mon Jan 21 17:38:26 2008
Subject: [mod_python] can't seem to expire a cookie value
Message-ID: <50446.67.122.209.91.1200955138.squirrel@webmail.wageslavery.org>

> 21 January 2008 Monday 10:49:57 tarihinde Matt Barnicle ??unlar??
yazm????t??:
>> understand it, if i want to effectively remove a cookie from the UA, there
>> is no way to do it, so u just have to set the expiry date to a time in the
>> past, right?  but any efforts i make seem to fail.  here is the code:
>>
>> cookie = Cookie.Cookie('user_name', cookies['user_name'].value)
cookie.expires = int(time.time()) - 31536000 # minus 1 year from now
Cookie.add_cookie(self.req, cookie)
>
> Might be a problem of using int(), examples in the mod_python
> documentation don't use int():
>
> http://www.modpython.org/live/current/doc-html/pyapi-cookie-example.html

i first tried it exactly like in the docs, then i tried int bc i know the
official way to do it is to use int seconds since GMT...  i also tried
splitting time.time() on the period, and taking the int value of the first
bit.  anyways it works ok when i log in then i check my cookies using
firefox web developer toolbar, it just doesn't seem to want to expire the
cookie when i use this method..

- m@



From graham.dumpleton at gmail.com  Mon Jan 21 18:13:15 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon Jan 21 18:13:22 2008
Subject: [mod_python] can't seem to expire a cookie value
In-Reply-To: <50446.67.122.209.91.1200955138.squirrel@webmail.wageslavery.org>
References: <50446.67.122.209.91.1200955138.squirrel@webmail.wageslavery.org>
Message-ID: <88e286470801211513g222d4d62m8e3285897ab5382c@mail.gmail.com>

Have you checked what the actual cookie header returned to the browser
is and verified that what is in it is what you expect? Post the value
of the header here so we can see it.

Use FireFox live headers extension to see value of header, or in your
mod_python code output to error log file the output of req.headers_out
or req.err_headers_out to see what it is.

Graham

On 22/01/2008, Matt Barnicle <mattb@wageslavery.org> wrote:
> > 21 January 2008 Monday 10:49:57 tarihinde Matt Barnicle ?unlar?
> yazm??t?:
> >> understand it, if i want to effectively remove a cookie from the UA, there
> >> is no way to do it, so u just have to set the expiry date to a time in the
> >> past, right?  but any efforts i make seem to fail.  here is the code:
> >>
> >> cookie = Cookie.Cookie('user_name', cookies['user_name'].value)
> cookie.expires = int(time.time()) - 31536000 # minus 1 year from now
> Cookie.add_cookie(self.req, cookie)
> >
> > Might be a problem of using int(), examples in the mod_python
> > documentation don't use int():
> >
> > http://www.modpython.org/live/current/doc-html/pyapi-cookie-example.html
>
> i first tried it exactly like in the docs, then i tried int bc i know the
> official way to do it is to use int seconds since GMT...  i also tried
> splitting time.time() on the period, and taking the int value of the first
> bit.  anyways it works ok when i log in then i check my cookies using
> firefox web developer toolbar, it just doesn't seem to want to expire the
> cookie when i use this method..
>
> - m@
>
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>

From mattb at wageslavery.org  Mon Jan 21 21:00:49 2008
From: mattb at wageslavery.org (Matt Barnicle)
Date: Mon Jan 21 21:00:16 2008
Subject: [mod_python] can't seem to expire a cookie value
In-Reply-To: <88e286470801211513g222d4d62m8e3285897ab5382c@mail.gmail.com>
References: <50446.67.122.209.91.1200955138.squirrel@webmail.wageslavery.org>
	<88e286470801211513g222d4d62m8e3285897ab5382c@mail.gmail.com>
Message-ID: <54151.76.197.59.196.1200967249.squirrel@webmail.wageslavery.org>

ok i installed the extension and captured some data..  here is what the
header looks like when i click the signout button:

Set-Cookie: user_name=matt; expires=Mon, 22-Jan-2007 01:54:01 GMT

then when i go back to the home page, my code reads the cookies to see if
the cookie called 'user_name' exists, and if so, logs me in and resets the
cookies:

if cookies.has_key('user_name'):
	cookie = Cookie.Cookie('user_name', user_name)
	cookie.expires = time.time() + 31536000
	Cookie.add_cookie(self.req, cookie)

i thought maybe i need to check the expiry date of the cookie, so i tried
that with the following code:

	self.req.write(str(cookies['user_name']) + '<br>\n')
	self.req.write('expires: ' + cookies['user_name'].expires + '<br>\n')

but that throws the following error:

	File "/usr/lib/python2.5/site-packages/mod_python/Cookie.py", line 93,
	in get_expires
		return self._expires

	AttributeError: _expires

- m@

> Have you checked what the actual cookie header returned to the browser
> is and verified that what is in it is what you expect? Post the value
> of the header here so we can see it.
>
> Use FireFox live headers extension to see value of header, or in your
> mod_python code output to error log file the output of req.headers_out
> or req.err_headers_out to see what it is.
>
> Graham
>
> On 22/01/2008, Matt Barnicle <mattb@wageslavery.org> wrote:
>> > 21 January 2008 Monday 10:49:57 tarihinde Matt Barnicle ?unlar?
>> yazm??t?:
>> >> understand it, if i want to effectively remove a cookie from the UA,
>> there
>> >> is no way to do it, so u just have to set the expiry date to a time
>> in the
>> >> past, right?  but any efforts i make seem to fail.  here is the code:
>> >>
>> >> cookie = Cookie.Cookie('user_name', cookies['user_name'].value)
>> cookie.expires = int(time.time()) - 31536000 # minus 1 year from now
>> Cookie.add_cookie(self.req, cookie)
>> >
>> > Might be a problem of using int(), examples in the mod_python
>> > documentation don't use int():
>> >
>> > http://www.modpython.org/live/current/doc-html/pyapi-cookie-example.html
>>
>> i first tried it exactly like in the docs, then i tried int bc i know
>> the
>> official way to do it is to use int seconds since GMT...  i also tried
>> splitting time.time() on the period, and taking the int value of the
>> first
>> bit.  anyways it works ok when i log in then i check my cookies using
>> firefox web developer toolbar, it just doesn't seem to want to expire
>> the
>> cookie when i use this method..
>>
>> - m@
>>
>>
>>
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>
>


From graham.dumpleton at gmail.com  Mon Jan 21 22:34:51 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon Jan 21 22:34:59 2008
Subject: [mod_python] can't seem to expire a cookie value
In-Reply-To: <54151.76.197.59.196.1200967249.squirrel@webmail.wageslavery.org>
References: <50446.67.122.209.91.1200955138.squirrel@webmail.wageslavery.org>
	<88e286470801211513g222d4d62m8e3285897ab5382c@mail.gmail.com>
	<54151.76.197.59.196.1200967249.squirrel@webmail.wageslavery.org>
Message-ID: <88e286470801211934j2a0f3ebfg96e5c30feede8fc7@mail.gmail.com>

What Cookie header gets sent by the browser on the request after you
have tried to expire it. Ie., dump out values of req.headers_in form
request handler to see what is passed in.

Graham

On 22/01/2008, Matt Barnicle <mattb@wageslavery.org> wrote:
> ok i installed the extension and captured some data..  here is what the
> header looks like when i click the signout button:
>
> Set-Cookie: user_name=matt; expires=Mon, 22-Jan-2007 01:54:01 GMT
>
> then when i go back to the home page, my code reads the cookies to see if
> the cookie called 'user_name' exists, and if so, logs me in and resets the
> cookies:
>
> if cookies.has_key('user_name'):
>         cookie = Cookie.Cookie('user_name', user_name)
>         cookie.expires = time.time() + 31536000
>         Cookie.add_cookie(self.req, cookie)
>
> i thought maybe i need to check the expiry date of the cookie, so i tried
> that with the following code:
>
>         self.req.write(str(cookies['user_name']) + '<br>\n')
>         self.req.write('expires: ' + cookies['user_name'].expires + '<br>\n')
>
> but that throws the following error:
>
>         File "/usr/lib/python2.5/site-packages/mod_python/Cookie.py", line 93,
>         in get_expires
>                 return self._expires
>
>         AttributeError: _expires
>
> - m@
>
> > Have you checked what the actual cookie header returned to the browser
> > is and verified that what is in it is what you expect? Post the value
> > of the header here so we can see it.
> >
> > Use FireFox live headers extension to see value of header, or in your
> > mod_python code output to error log file the output of req.headers_out
> > or req.err_headers_out to see what it is.
> >
> > Graham
> >
> > On 22/01/2008, Matt Barnicle <mattb@wageslavery.org> wrote:
> >> > 21 January 2008 Monday 10:49:57 tarihinde Matt Barnicle ?unlar?
> >> yazm??t?:
> >> >> understand it, if i want to effectively remove a cookie from the UA,
> >> there
> >> >> is no way to do it, so u just have to set the expiry date to a time
> >> in the
> >> >> past, right?  but any efforts i make seem to fail.  here is the code:
> >> >>
> >> >> cookie = Cookie.Cookie('user_name', cookies['user_name'].value)
> >> cookie.expires = int(time.time()) - 31536000 # minus 1 year from now
> >> Cookie.add_cookie(self.req, cookie)
> >> >
> >> > Might be a problem of using int(), examples in the mod_python
> >> > documentation don't use int():
> >> >
> >> > http://www.modpython.org/live/current/doc-html/pyapi-cookie-example.html
> >>
> >> i first tried it exactly like in the docs, then i tried int bc i know
> >> the
> >> official way to do it is to use int seconds since GMT...  i also tried
> >> splitting time.time() on the period, and taking the int value of the
> >> first
> >> bit.  anyways it works ok when i log in then i check my cookies using
> >> firefox web developer toolbar, it just doesn't seem to want to expire
> >> the
> >> cookie when i use this method..
> >>
> >> - m@
> >>
> >>
> >>
> >> _______________________________________________
> >> Mod_python mailing list
> >> Mod_python@modpython.org
> >> http://mailman.modpython.org/mailman/listinfo/mod_python
> >>
> >
>
>
>

From graham.dumpleton at gmail.com  Mon Jan 21 22:37:34 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon Jan 21 22:37:42 2008
Subject: [mod_python] strange behavior with mpm worker (inaccurate number
	of max processes?)
In-Reply-To: <0e0901c85c17$d4370d40$7ca527c0$@com>
References: <0e0901c85c17$d4370d40$7ca527c0$@com>
Message-ID: <88e286470801211937v732a64b2t1bc85ec5f59439df@mail.gmail.com>

Just ignore it if it seems wrong. It is quite possible mod_python does
it wrong, or does it in a way which isn't compatible with newer
versions of Apache. The code certainly has various warnings against
the code which make it look a little suspect.

    /* figure out maximum possible concurrent connections */
    /* MAX_DAEMON_USED seems to account for MaxClients, as opposed to
       MAX_DAEMONS, which is ServerLimit
    */
    ap_mpm_query(AP_MPMQ_IS_THREADED, &is_threaded);
    if (is_threaded != AP_MPMQ_NOT_SUPPORTED) {
        ap_mpm_query(AP_MPMQ_MAX_THREADS, &max_threads);
    }
    ap_mpm_query(AP_MPMQ_IS_FORKED, &is_forked);
    if (is_forked != AP_MPMQ_NOT_SUPPORTED) {
        /* XXX This looks strange, and it is. prefork.c seems to use
           MAX_DAEMON_USED the same way that worker.c uses
           MAX_DAEMONS (prefork is wrong IMO) */
        ap_mpm_query(AP_MPMQ_MAX_DAEMON_USED, &max_procs);
        if (max_procs == -1) {
            ap_mpm_query(AP_MPMQ_MAX_DAEMONS, &max_procs);
        }
    }
    max_clients = (((max_threads <= 0) ? 1 : max_threads) *
                   ((max_procs <= 0) ? 1 : max_procs));

Graham

On 21/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
>
>
>
>
> We are using worker MPM
>
> Our apache configuration is
>
>
>
> ServerLimit 40
>
> ThreadLimit 70
>
>
>
> StartServers          10
>
> MaxClients            1600
>
> MinSpareThreads       75
>
> MaxSpareThreads       200
>
> ThreadsPerChild       40
>
> MaxRequestsPerChild   10000
>
>
>
> When apache is restarted with
>
> #apachectl stop
>
> #apachectl start
>
> We get in the error log:
>
> [notice] mod_python: Creating 32 session mutexes based on 40 max processes
> and 40 max threads
>
> [notice] Apache/2.2.6 (Unix) mod_python/3.3.1 Python/2.4.1 configured --
> resuming normal operations
>
> This is what we expect.
>
>
>
> Now we restart apache this way:
>
> #apachectl restart
>
> In the error log:
>
> [notice] SIGHUP received.  Attempting to restart
>
>  [notice] mod_python: Creating 32 session mutexes based on 11 max processes
> and 40 max threads.
>
>  [notice] mod_python: using mutex_directory /tmp
>
>  [notice] Apache/2.2.6 (Unix) mod_python/3.3.1 Python/2.4.1 configured --
> resuming normal operations
>
>
>
> Where does this number "11 max processes" come from? We do not have it
> anywhere in the configuration.
>
>
>
>
>
> We get
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
From matusis at yahoo.com  Mon Jan 21 23:29:29 2008
From: matusis at yahoo.com (Alec Matusis)
Date: Mon Jan 21 23:30:04 2008
Subject: [mod_python] strange behavior with mpm worker (inaccurate number
	of max processes?)
In-Reply-To: <88e286470801211937v732a64b2t1bc85ec5f59439df@mail.gmail.com>
References: <0e0901c85c17$d4370d40$7ca527c0$@com>
	<88e286470801211937v732a64b2t1bc85ec5f59439df@mail.gmail.com>
Message-ID: <105401c85caf$61752b00$245f8100$@com>

> Just ignore it if it seems wrong. It is quite possible mod_python does
> it wrong

Am I correct in thinking that this bug will actually reduce the number of
available maxclients to mod_python (i.e. it's not just a logging error)?
We serve both scripts and static content from this apache server, so
hopefully this will at least not affect the settings for static content?

Incidentally, I think this random number "11 max processes" is the actual
number of processes that were alive when apache was restarted by cron. Since
we run that cron at night, the number of processes that we need during the
day is higher, so this could be a problem.

> -----Original Message-----
> From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> Sent: Monday, January 21, 2008 7:38 PM
> To: Alec Matusis
> Cc: mod_python@modpython.org
> Subject: Re: [mod_python] strange behavior with mpm worker (inaccurate
> number of max processes?)
> 
> Just ignore it if it seems wrong. It is quite possible mod_python does
> it wrong, or does it in a way which isn't compatible with newer
> versions of Apache. The code certainly has various warnings against
> the code which make it look a little suspect.
> 
>     /* figure out maximum possible concurrent connections */
>     /* MAX_DAEMON_USED seems to account for MaxClients, as opposed to
>        MAX_DAEMONS, which is ServerLimit
>     */
>     ap_mpm_query(AP_MPMQ_IS_THREADED, &is_threaded);
>     if (is_threaded != AP_MPMQ_NOT_SUPPORTED) {
>         ap_mpm_query(AP_MPMQ_MAX_THREADS, &max_threads);
>     }
>     ap_mpm_query(AP_MPMQ_IS_FORKED, &is_forked);
>     if (is_forked != AP_MPMQ_NOT_SUPPORTED) {
>         /* XXX This looks strange, and it is. prefork.c seems to use
>            MAX_DAEMON_USED the same way that worker.c uses
>            MAX_DAEMONS (prefork is wrong IMO) */
>         ap_mpm_query(AP_MPMQ_MAX_DAEMON_USED, &max_procs);
>         if (max_procs == -1) {
>             ap_mpm_query(AP_MPMQ_MAX_DAEMONS, &max_procs);
>         }
>     }
>     max_clients = (((max_threads <= 0) ? 1 : max_threads) *
>                    ((max_procs <= 0) ? 1 : max_procs));
> 
> Graham
> 
> On 21/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> >
> >
> >
> >
> > We are using worker MPM
> >
> > Our apache configuration is
> >
> >
> >
> > ServerLimit 40
> >
> > ThreadLimit 70
> >
> >
> >
> > StartServers          10
> >
> > MaxClients            1600
> >
> > MinSpareThreads       75
> >
> > MaxSpareThreads       200
> >
> > ThreadsPerChild       40
> >
> > MaxRequestsPerChild   10000
> >
> >
> >
> > When apache is restarted with
> >
> > #apachectl stop
> >
> > #apachectl start
> >
> > We get in the error log:
> >
> > [notice] mod_python: Creating 32 session mutexes based on 40 max
> processes
> > and 40 max threads
> >
> > [notice] Apache/2.2.6 (Unix) mod_python/3.3.1 Python/2.4.1 configured
> --
> > resuming normal operations
> >
> > This is what we expect.
> >
> >
> >
> > Now we restart apache this way:
> >
> > #apachectl restart
> >
> > In the error log:
> >
> > [notice] SIGHUP received.  Attempting to restart
> >
> >  [notice] mod_python: Creating 32 session mutexes based on 11 max
> processes
> > and 40 max threads.
> >
> >  [notice] mod_python: using mutex_directory /tmp
> >
> >  [notice] Apache/2.2.6 (Unix) mod_python/3.3.1 Python/2.4.1
> configured --
> > resuming normal operations
> >
> >
> >
> > Where does this number "11 max processes" come from? We do not have
> it
> > anywhere in the configuration.
> >
> >
> >
> >
> >
> > We get
> >
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
> >

From graham.dumpleton at gmail.com  Mon Jan 21 23:32:12 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon Jan 21 23:32:19 2008
Subject: [mod_python] strange behavior with mpm worker (inaccurate number
	of max processes?)
In-Reply-To: <105401c85caf$61752b00$245f8100$@com>
References: <0e0901c85c17$d4370d40$7ca527c0$@com>
	<88e286470801211937v732a64b2t1bc85ec5f59439df@mail.gmail.com>
	<105401c85caf$61752b00$245f8100$@com>
Message-ID: <88e286470801212032m6c91614m2be792f5b9f8708a@mail.gmail.com>

It is just logging messages and pretty meaningless. It doesn't affect
at all how mod_python works.

Whether it is a bug or nor I don't know, it just may be how Apache
reports things on a restart.

Graham

On 22/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > Just ignore it if it seems wrong. It is quite possible mod_python does
> > it wrong
>
> Am I correct in thinking that this bug will actually reduce the number of
> available maxclients to mod_python (i.e. it's not just a logging error)?
> We serve both scripts and static content from this apache server, so
> hopefully this will at least not affect the settings for static content?
>
> Incidentally, I think this random number "11 max processes" is the actual
> number of processes that were alive when apache was restarted by cron. Since
> we run that cron at night, the number of processes that we need during the
> day is higher, so this could be a problem.
>
> > -----Original Message-----
> > From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> > Sent: Monday, January 21, 2008 7:38 PM
> > To: Alec Matusis
> > Cc: mod_python@modpython.org
> > Subject: Re: [mod_python] strange behavior with mpm worker (inaccurate
> > number of max processes?)
> >
> > Just ignore it if it seems wrong. It is quite possible mod_python does
> > it wrong, or does it in a way which isn't compatible with newer
> > versions of Apache. The code certainly has various warnings against
> > the code which make it look a little suspect.
> >
> >     /* figure out maximum possible concurrent connections */
> >     /* MAX_DAEMON_USED seems to account for MaxClients, as opposed to
> >        MAX_DAEMONS, which is ServerLimit
> >     */
> >     ap_mpm_query(AP_MPMQ_IS_THREADED, &is_threaded);
> >     if (is_threaded != AP_MPMQ_NOT_SUPPORTED) {
> >         ap_mpm_query(AP_MPMQ_MAX_THREADS, &max_threads);
> >     }
> >     ap_mpm_query(AP_MPMQ_IS_FORKED, &is_forked);
> >     if (is_forked != AP_MPMQ_NOT_SUPPORTED) {
> >         /* XXX This looks strange, and it is. prefork.c seems to use
> >            MAX_DAEMON_USED the same way that worker.c uses
> >            MAX_DAEMONS (prefork is wrong IMO) */
> >         ap_mpm_query(AP_MPMQ_MAX_DAEMON_USED, &max_procs);
> >         if (max_procs == -1) {
> >             ap_mpm_query(AP_MPMQ_MAX_DAEMONS, &max_procs);
> >         }
> >     }
> >     max_clients = (((max_threads <= 0) ? 1 : max_threads) *
> >                    ((max_procs <= 0) ? 1 : max_procs));
> >
> > Graham
> >
> > On 21/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > >
> > >
> > >
> > >
> > > We are using worker MPM
> > >
> > > Our apache configuration is
> > >
> > >
> > >
> > > ServerLimit 40
> > >
> > > ThreadLimit 70
> > >
> > >
> > >
> > > StartServers          10
> > >
> > > MaxClients            1600
> > >
> > > MinSpareThreads       75
> > >
> > > MaxSpareThreads       200
> > >
> > > ThreadsPerChild       40
> > >
> > > MaxRequestsPerChild   10000
> > >
> > >
> > >
> > > When apache is restarted with
> > >
> > > #apachectl stop
> > >
> > > #apachectl start
> > >
> > > We get in the error log:
> > >
> > > [notice] mod_python: Creating 32 session mutexes based on 40 max
> > processes
> > > and 40 max threads
> > >
> > > [notice] Apache/2.2.6 (Unix) mod_python/3.3.1 Python/2.4.1 configured
> > --
> > > resuming normal operations
> > >
> > > This is what we expect.
> > >
> > >
> > >
> > > Now we restart apache this way:
> > >
> > > #apachectl restart
> > >
> > > In the error log:
> > >
> > > [notice] SIGHUP received.  Attempting to restart
> > >
> > >  [notice] mod_python: Creating 32 session mutexes based on 11 max
> > processes
> > > and 40 max threads.
> > >
> > >  [notice] mod_python: using mutex_directory /tmp
> > >
> > >  [notice] Apache/2.2.6 (Unix) mod_python/3.3.1 Python/2.4.1
> > configured --
> > > resuming normal operations
> > >
> > >
> > >
> > > Where does this number "11 max processes" come from? We do not have
> > it
> > > anywhere in the configuration.
> > >
> > >
> > >
> > >
> > >
> > > We get
> > >
> > >
> > > _______________________________________________
> > > Mod_python mailing list
> > > Mod_python@modpython.org
> > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > >
> > >
>
>
From matusis at yahoo.com  Tue Jan 22 00:13:15 2008
From: matusis at yahoo.com (Alec Matusis)
Date: Tue Jan 22 00:13:50 2008
Subject: [mod_python] remnant 'orphan' apache subprocesses
Message-ID: <107401c85cb5$7eb44b00$7c1ce100$@com>

I have been investigating a memory leak that occurs on  an apache server
since we switched to worker MPM.
I found that the source of it are apache subprocesses that lose track of
their parent and never exit:

root@web10 ~> ps -ef | grep httpd 
root     16197     1  0 02:00 ?        00:00:09
/usr/local/encap/httpd/bin/httpd -f /p2/web/conf/web10.conf -k start
nobody   17750     1  0 17:53 ?        00:00:00
/usr/local/encap/httpd/bin/httpd -f /p2/web/conf/web10.conf -k start
nobody    5112 16197  4 20:02 ?        00:00:16
/usr/local/encap/httpd/bin/httpd -f /p2/web/conf/web10.conf -k start
nobody    5159 16197  4 20:02 ?        00:00:15
/usr/local/encap/httpd/bin/httpd -f /p2/web/conf/web10.conf -k start
nobody    5300 16197  4 20:03 ?        00:00:14
/usr/local/encap/httpd/bin/httpd -f /p2/web/conf/web10.conf -k start


in this output, apache child pid 17750 has pid 1 as a parent, and it is one
of those ?zombie children?.
Pids 5112,  5159, 5300 were normal (parent is pid 16197), and they exited
after MaxRequestsPerChild was reached.

Does anybody have any advice on this? I cannot correlate this to anything,
there?s nothing interesting in the server error log.
These ?zombies? appear at a rate of 2-3 per day; this apache serves about
350 requests per second. 

This Apache configuration is 

ServerLimit 40
ThreadLimit 70

StartServers????????? 10
MaxClients??????????? 1600
MinSpareThreads?????? 75
MaxSpareThreads?????? 200
ThreadsPerChild?????? 40
MaxRequestsPerChild?? 10000





From graham.dumpleton at gmail.com  Tue Jan 22 00:22:00 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue Jan 22 00:22:06 2008
Subject: [mod_python] remnant 'orphan' apache subprocesses
In-Reply-To: <107401c85cb5$7eb44b00$7c1ce100$@com>
References: <107401c85cb5$7eb44b00$7c1ce100$@com>
Message-ID: <88e286470801212122u6d07141bwd1d4746abc638c30@mail.gmail.com>

What version of Apache are you using?

What Python web application are you running on top of mod_python, a
self built one or one that uses one of the larger web frameworks?

Does your application create sub processes in any way to perform
additional work?

Graham

On 22/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> I have been investigating a memory leak that occurs on  an apache server
> since we switched to worker MPM.
> I found that the source of it are apache subprocesses that lose track of
> their parent and never exit:
>
> root@web10 ~> ps -ef | grep httpd
> root     16197     1  0 02:00 ?        00:00:09
> /usr/local/encap/httpd/bin/httpd -f /p2/web/conf/web10.conf -k start
> nobody   17750     1  0 17:53 ?        00:00:00
> /usr/local/encap/httpd/bin/httpd -f /p2/web/conf/web10.conf -k start
> nobody    5112 16197  4 20:02 ?        00:00:16
> /usr/local/encap/httpd/bin/httpd -f /p2/web/conf/web10.conf -k start
> nobody    5159 16197  4 20:02 ?        00:00:15
> /usr/local/encap/httpd/bin/httpd -f /p2/web/conf/web10.conf -k start
> nobody    5300 16197  4 20:03 ?        00:00:14
> /usr/local/encap/httpd/bin/httpd -f /p2/web/conf/web10.conf -k start
>
>
> in this output, apache child pid 17750 has pid 1 as a parent, and it is one
> of those 'zombie children'.
> Pids 5112,  5159, 5300 were normal (parent is pid 16197), and they exited
> after MaxRequestsPerChild was reached.
>
> Does anybody have any advice on this? I cannot correlate this to anything,
> there's nothing interesting in the server error log.
> These 'zombies' appear at a rate of 2-3 per day; this apache serves about
> 350 requests per second.
>
> This Apache configuration is
>
> ServerLimit 40
> ThreadLimit 70
>
> StartServers 10
> MaxClients 1600
> MinSpareThreads 75
> MaxSpareThreads 200
> ThreadsPerChild 40
> MaxRequestsPerChild 10000
>
>
>
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From mattb at wageslavery.org  Tue Jan 22 00:32:45 2008
From: mattb at wageslavery.org (Matt Barnicle)
Date: Tue Jan 22 00:32:10 2008
Subject: [mod_python] can't seem to expire a cookie value
In-Reply-To: <88e286470801211934j2a0f3ebfg96e5c30feede8fc7@mail.gmail.com>
References: <50446.67.122.209.91.1200955138.squirrel@webmail.wageslavery.org>
	<88e286470801211513g222d4d62m8e3285897ab5382c@mail.gmail.com>
	<54151.76.197.59.196.1200967249.squirrel@webmail.wageslavery.org>
	<88e286470801211934j2a0f3ebfg96e5c30feede8fc7@mail.gmail.com>
Message-ID: <57217.69.111.192.251.1200979965.squirrel@webmail.wageslavery.org>

well now i've ditched my current effort and decided to take a different
tact and added another cookie var to maintain login state rather than
trying to expire user_name.  i just couldn't spend any more time on this
thing right now i've got a lot of pressing things to take care of...  in
my code updates i noticed the 'path' attribute..  when i sign out, the
sign out link is /user/signout, and it looks like it was adding those
cookie vars to the '/user' path, which i didn't understand at all
previously..  *sigh*  so i think that is the real problem here.  i didn't
investigate it bc like i said i had to move on and come up with another
solution..  thanks so much for your attention and help..

- m@

> What Cookie header gets sent by the browser on the request after you
> have tried to expire it. Ie., dump out values of req.headers_in form
> request handler to see what is passed in.
>
> Graham
>
> On 22/01/2008, Matt Barnicle <mattb@wageslavery.org> wrote:
>> ok i installed the extension and captured some data..  here is what the
>> header looks like when i click the signout button:
>>
>> Set-Cookie: user_name=matt; expires=Mon, 22-Jan-2007 01:54:01 GMT
>>
>> then when i go back to the home page, my code reads the cookies to see
>> if
>> the cookie called 'user_name' exists, and if so, logs me in and resets
>> the
>> cookies:
>>
>> if cookies.has_key('user_name'):
>>         cookie = Cookie.Cookie('user_name', user_name)
>>         cookie.expires = time.time() + 31536000
>>         Cookie.add_cookie(self.req, cookie)
>>
>> i thought maybe i need to check the expiry date of the cookie, so i
>> tried
>> that with the following code:
>>
>>         self.req.write(str(cookies['user_name']) + '<br>\n')
>>         self.req.write('expires: ' + cookies['user_name'].expires +
>> '<br>\n')
>>
>> but that throws the following error:
>>
>>         File "/usr/lib/python2.5/site-packages/mod_python/Cookie.py",
>> line 93,
>>         in get_expires
>>                 return self._expires
>>
>>         AttributeError: _expires
>>
>> - m@
>>
>> > Have you checked what the actual cookie header returned to the browser
>> > is and verified that what is in it is what you expect? Post the value
>> > of the header here so we can see it.
>> >
>> > Use FireFox live headers extension to see value of header, or in your
>> > mod_python code output to error log file the output of req.headers_out
>> > or req.err_headers_out to see what it is.
>> >
>> > Graham
>> >
>> > On 22/01/2008, Matt Barnicle <mattb@wageslavery.org> wrote:
>> >> > 21 January 2008 Monday 10:49:57 tarihinde Matt Barnicle ?unlar?
>> >> yazm??t?:
>> >> >> understand it, if i want to effectively remove a cookie from the
>> UA,
>> >> there
>> >> >> is no way to do it, so u just have to set the expiry date to a
>> time
>> >> in the
>> >> >> past, right?  but any efforts i make seem to fail.  here is the
>> code:
>> >> >>
>> >> >> cookie = Cookie.Cookie('user_name', cookies['user_name'].value)
>> >> cookie.expires = int(time.time()) - 31536000 # minus 1 year from now
>> >> Cookie.add_cookie(self.req, cookie)
>> >> >
>> >> > Might be a problem of using int(), examples in the mod_python
>> >> > documentation don't use int():
>> >> >
>> >> > http://www.modpython.org/live/current/doc-html/pyapi-cookie-example.html
>> >>
>> >> i first tried it exactly like in the docs, then i tried int bc i know
>> >> the
>> >> official way to do it is to use int seconds since GMT...  i also
>> tried
>> >> splitting time.time() on the period, and taking the int value of the
>> >> first
>> >> bit.  anyways it works ok when i log in then i check my cookies using
>> >> firefox web developer toolbar, it just doesn't seem to want to expire
>> >> the
>> >> cookie when i use this method..
>> >>
>> >> - m@
>> >>
>> >>
>> >>
>> >> _______________________________________________
>> >> Mod_python mailing list
>> >> Mod_python@modpython.org
>> >> http://mailman.modpython.org/mailman/listinfo/mod_python
>> >>
>> >
>>
>>
>>
>


From estrand at isomedia.com  Tue Jan 22 00:57:15 2008
From: estrand at isomedia.com (Eric Strand)
Date: Tue Jan 22 00:57:32 2008
Subject: [mod_python] can't seem to expire a cookie value
In-Reply-To: <57217.69.111.192.251.1200979965.squirrel@webmail.wageslavery.org>
References: <50446.67.122.209.91.1200955138.squirrel@webmail.wageslavery.org>	<88e286470801211513g222d4d62m8e3285897ab5382c@mail.gmail.com>	<54151.76.197.59.196.1200967249.squirrel@webmail.wageslavery.org>	<88e286470801211934j2a0f3ebfg96e5c30feede8fc7@mail.gmail.com>
	<57217.69.111.192.251.1200979965.squirrel@webmail.wageslavery.org>
Message-ID: <479585BB.5080307@isomedia.com>


I fear that your work around might run into the same trouble with the 
paths if you are setting the login state to not-logged-in from the same 
context in which you are trying to expire you current cookie.

You might try using:

   PythonOption ApplicationPath /

or for mod_python version 3.3:

   mod_python.session.application_path /

in your Apache config.

In my experience it keeps cookies from my site at the root level without 
any path information.

--Eric




Matt Barnicle wrote:
> well now i've ditched my current effort and decided to take a different
> tact and added another cookie var to maintain login state rather than
> trying to expire user_name.  i just couldn't spend any more time on this
> thing right now i've got a lot of pressing things to take care of...  in
> my code updates i noticed the 'path' attribute..  when i sign out, the
> sign out link is /user/signout, and it looks like it was adding those
> cookie vars to the '/user' path, which i didn't understand at all
> previously..  *sigh*  so i think that is the real problem here.  i didn't
> investigate it bc like i said i had to move on and come up with another
> solution..  thanks so much for your attention and help..
> 
> - m@
> 
>> What Cookie header gets sent by the browser on the request after you
>> have tried to expire it. Ie., dump out values of req.headers_in form
>> request handler to see what is passed in.
>>
>> Graham
>>
>> On 22/01/2008, Matt Barnicle <mattb@wageslavery.org> wrote:
>>> ok i installed the extension and captured some data..  here is what the
>>> header looks like when i click the signout button:
>>>
>>> Set-Cookie: user_name=matt; expires=Mon, 22-Jan-2007 01:54:01 GMT
>>>
>>> then when i go back to the home page, my code reads the cookies to see
>>> if
>>> the cookie called 'user_name' exists, and if so, logs me in and resets
>>> the
>>> cookies:
>>>
>>> if cookies.has_key('user_name'):
>>>         cookie = Cookie.Cookie('user_name', user_name)
>>>         cookie.expires = time.time() + 31536000
>>>         Cookie.add_cookie(self.req, cookie)
>>>
>>> i thought maybe i need to check the expiry date of the cookie, so i
>>> tried
>>> that with the following code:
>>>
>>>         self.req.write(str(cookies['user_name']) + '<br>\n')
>>>         self.req.write('expires: ' + cookies['user_name'].expires +
>>> '<br>\n')
>>>
>>> but that throws the following error:
>>>
>>>         File "/usr/lib/python2.5/site-packages/mod_python/Cookie.py",
>>> line 93,
>>>         in get_expires
>>>                 return self._expires
>>>
>>>         AttributeError: _expires
>>>
>>> - m@
>>>
>>>> Have you checked what the actual cookie header returned to the browser
>>>> is and verified that what is in it is what you expect? Post the value
>>>> of the header here so we can see it.
>>>>
>>>> Use FireFox live headers extension to see value of header, or in your
>>>> mod_python code output to error log file the output of req.headers_out
>>>> or req.err_headers_out to see what it is.
>>>>
>>>> Graham
>>>>
>>>> On 22/01/2008, Matt Barnicle <mattb@wageslavery.org> wrote:
>>>>>> 21 January 2008 Monday 10:49:57 tarihinde Matt Barnicle ?unlar?
>>>>> yazm??t?:
>>>>>>> understand it, if i want to effectively remove a cookie from the
>>> UA,
>>>>> there
>>>>>>> is no way to do it, so u just have to set the expiry date to a
>>> time
>>>>> in the
>>>>>>> past, right?  but any efforts i make seem to fail.  here is the
>>> code:
>>>>>>> cookie = Cookie.Cookie('user_name', cookies['user_name'].value)
>>>>> cookie.expires = int(time.time()) - 31536000 # minus 1 year from now
>>>>> Cookie.add_cookie(self.req, cookie)
>>>>>> Might be a problem of using int(), examples in the mod_python
>>>>>> documentation don't use int():
>>>>>>
>>>>>> http://www.modpython.org/live/current/doc-html/pyapi-cookie-example.html
>>>>> i first tried it exactly like in the docs, then i tried int bc i know
>>>>> the
>>>>> official way to do it is to use int seconds since GMT...  i also
>>> tried
>>>>> splitting time.time() on the period, and taking the int value of the
>>>>> first
>>>>> bit.  anyways it works ok when i log in then i check my cookies using
>>>>> firefox web developer toolbar, it just doesn't seem to want to expire
>>>>> the
>>>>> cookie when i use this method..
>>>>>
>>>>> - m@
>>>>>
>>>>>
>>>>>
>>>>> _______________________________________________
>>>>> Mod_python mailing list
>>>>> Mod_python@modpython.org
>>>>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>>>>
>>>
>>>
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 
From matusis at yahoo.com  Tue Jan 22 01:01:48 2008
From: matusis at yahoo.com (Alec Matusis)
Date: Tue Jan 22 01:02:23 2008
Subject: [mod_python] remnant 'orphan' apache subprocesses
In-Reply-To: <88e286470801212122u6d07141bwd1d4746abc638c30@mail.gmail.com>
References: <107401c85cb5$7eb44b00$7c1ce100$@com>
	<88e286470801212122u6d07141bwd1d4746abc638c30@mail.gmail.com>
Message-ID: <108b01c85cbc$46afc2f0$d40f48d0$@com>

> What version of Apache are you using?

2.2.6

> What Python web application are you running on top of mod_python, a
> self built one or one that uses one of the larger web frameworks?

Only self-built stuff, nothing complicated.

> Does your application create sub processes in any way to perform
> additional work?

No sub processes and no threads, except that we use MySQLdb module (which
might create threads?).

I noticed a warning in the error log:
/live/scripts/_pro.py:100: Warning: Rows matched: 1  Changed: 1  Warnings: 1
(this is a mysql warning), but I would not think this is relevant...


> -----Original Message-----
> From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> Sent: Monday, January 21, 2008 9:22 PM
> To: Alec Matusis
> Cc: mod_python@modpython.org
> Subject: Re: [mod_python] remnant 'orphan' apache subprocesses
> 
> What version of Apache are you using?
> 
> What Python web application are you running on top of mod_python, a
> self built one or one that uses one of the larger web frameworks?
> 
> Does your application create sub processes in any way to perform
> additional work?
> 
> Graham
> 
> On 22/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > I have been investigating a memory leak that occurs on  an apache
> server
> > since we switched to worker MPM.
> > I found that the source of it are apache subprocesses that lose track
> of
> > their parent and never exit:
> >
> > root@web10 ~> ps -ef | grep httpd
> > root     16197     1  0 02:00 ?        00:00:09
> > /usr/local/encap/httpd/bin/httpd -f /p2/web/conf/web10.conf -k start
> > nobody   17750     1  0 17:53 ?        00:00:00
> > /usr/local/encap/httpd/bin/httpd -f /p2/web/conf/web10.conf -k start
> > nobody    5112 16197  4 20:02 ?        00:00:16
> > /usr/local/encap/httpd/bin/httpd -f /p2/web/conf/web10.conf -k start
> > nobody    5159 16197  4 20:02 ?        00:00:15
> > /usr/local/encap/httpd/bin/httpd -f /p2/web/conf/web10.conf -k start
> > nobody    5300 16197  4 20:03 ?        00:00:14
> > /usr/local/encap/httpd/bin/httpd -f /p2/web/conf/web10.conf -k start
> >
> >
> > in this output, apache child pid 17750 has pid 1 as a parent, and it
> is one
> > of those 'zombie children'.
> > Pids 5112,  5159, 5300 were normal (parent is pid 16197), and they
> exited
> > after MaxRequestsPerChild was reached.
> >
> > Does anybody have any advice on this? I cannot correlate this to
> anything,
> > there's nothing interesting in the server error log.
> > These 'zombies' appear at a rate of 2-3 per day; this apache serves
> about
> > 350 requests per second.
> >
> > This Apache configuration is
> >
> > ServerLimit 40
> > ThreadLimit 70
> >
> > StartServers 10
> > MaxClients 1600
> > MinSpareThreads 75
> > MaxSpareThreads 200
> > ThreadsPerChild 40
> > MaxRequestsPerChild 10000
> >
> >
> >
> >
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >

From graham.dumpleton at gmail.com  Tue Jan 22 01:06:41 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue Jan 22 01:06:47 2008
Subject: [mod_python] remnant 'orphan' apache subprocesses
In-Reply-To: <108b01c85cbc$46afc2f0$d40f48d0$@com>
References: <107401c85cb5$7eb44b00$7c1ce100$@com>
	<88e286470801212122u6d07141bwd1d4746abc638c30@mail.gmail.com>
	<108b01c85cbc$46afc2f0$d40f48d0$@com>
Message-ID: <88e286470801212206j5981df10ocd4dc9b9cf13803b@mail.gmail.com>

Are CGI scripts used anywhere at all on your Apache web site?

On 22/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > What version of Apache are you using?
>
> 2.2.6
>
> > What Python web application are you running on top of mod_python, a
> > self built one or one that uses one of the larger web frameworks?
>
> Only self-built stuff, nothing complicated.
>
> > Does your application create sub processes in any way to perform
> > additional work?
>
> No sub processes and no threads, except that we use MySQLdb module (which
> might create threads?).
>
> I noticed a warning in the error log:
> /live/scripts/_pro.py:100: Warning: Rows matched: 1  Changed: 1  Warnings: 1
> (this is a mysql warning), but I would not think this is relevant...
>
>
> > -----Original Message-----
> > From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> > Sent: Monday, January 21, 2008 9:22 PM
> > To: Alec Matusis
> > Cc: mod_python@modpython.org
> > Subject: Re: [mod_python] remnant 'orphan' apache subprocesses
> >
> > What version of Apache are you using?
> >
> > What Python web application are you running on top of mod_python, a
> > self built one or one that uses one of the larger web frameworks?
> >
> > Does your application create sub processes in any way to perform
> > additional work?
> >
> > Graham
> >
> > On 22/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > I have been investigating a memory leak that occurs on  an apache
> > server
> > > since we switched to worker MPM.
> > > I found that the source of it are apache subprocesses that lose track
> > of
> > > their parent and never exit:
> > >
> > > root@web10 ~> ps -ef | grep httpd
> > > root     16197     1  0 02:00 ?        00:00:09
> > > /usr/local/encap/httpd/bin/httpd -f /p2/web/conf/web10.conf -k start
> > > nobody   17750     1  0 17:53 ?        00:00:00
> > > /usr/local/encap/httpd/bin/httpd -f /p2/web/conf/web10.conf -k start
> > > nobody    5112 16197  4 20:02 ?        00:00:16
> > > /usr/local/encap/httpd/bin/httpd -f /p2/web/conf/web10.conf -k start
> > > nobody    5159 16197  4 20:02 ?        00:00:15
> > > /usr/local/encap/httpd/bin/httpd -f /p2/web/conf/web10.conf -k start
> > > nobody    5300 16197  4 20:03 ?        00:00:14
> > > /usr/local/encap/httpd/bin/httpd -f /p2/web/conf/web10.conf -k start
> > >
> > >
> > > in this output, apache child pid 17750 has pid 1 as a parent, and it
> > is one
> > > of those 'zombie children'.
> > > Pids 5112,  5159, 5300 were normal (parent is pid 16197), and they
> > exited
> > > after MaxRequestsPerChild was reached.
> > >
> > > Does anybody have any advice on this? I cannot correlate this to
> > anything,
> > > there's nothing interesting in the server error log.
> > > These 'zombies' appear at a rate of 2-3 per day; this apache serves
> > about
> > > 350 requests per second.
> > >
> > > This Apache configuration is
> > >
> > > ServerLimit 40
> > > ThreadLimit 70
> > >
> > > StartServers 10
> > > MaxClients 1600
> > > MinSpareThreads 75
> > > MaxSpareThreads 200
> > > ThreadsPerChild 40
> > > MaxRequestsPerChild 10000
> > >
> > >
> > >
> > >
> > >
> > > _______________________________________________
> > > Mod_python mailing list
> > > Mod_python@modpython.org
> > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > >
>
>
From matusis at yahoo.com  Tue Jan 22 01:13:36 2008
From: matusis at yahoo.com (Alec Matusis)
Date: Tue Jan 22 01:14:12 2008
Subject: [mod_python] remnant 'orphan' apache subprocesses
In-Reply-To: <88e286470801212206j5981df10ocd4dc9b9cf13803b@mail.gmail.com>
References: <107401c85cb5$7eb44b00$7c1ce100$@com>	
	<88e286470801212122u6d07141bwd1d4746abc638c30@mail.gmail.com>	
	<108b01c85cbc$46afc2f0$d40f48d0$@com>
	<88e286470801212206j5981df10ocd4dc9b9cf13803b@mail.gmail.com>
Message-ID: <109001c85cbd$ed9af930$c8d0eb90$@com>

> Are CGI scripts used anywhere at all on your Apache web site?

No, only mod_python and serving static files.

> -----Original Message-----
> From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> Sent: Monday, January 21, 2008 10:07 PM
> To: Alec Matusis
> Cc: mod_python@modpython.org
> Subject: Re: [mod_python] remnant 'orphan' apache subprocesses
> 
> Are CGI scripts used anywhere at all on your Apache web site?
> 
> On 22/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > What version of Apache are you using?
> >
> > 2.2.6
> >
> > > What Python web application are you running on top of mod_python, a
> > > self built one or one that uses one of the larger web frameworks?
> >
> > Only self-built stuff, nothing complicated.
> >
> > > Does your application create sub processes in any way to perform
> > > additional work?
> >
> > No sub processes and no threads, except that we use MySQLdb module
> (which
> > might create threads?).
> >
> > I noticed a warning in the error log:
> > /live/scripts/_pro.py:100: Warning: Rows matched: 1  Changed: 1
> Warnings: 1
> > (this is a mysql warning), but I would not think this is relevant...
> >
> >
> > > -----Original Message-----
> > > From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> > > Sent: Monday, January 21, 2008 9:22 PM
> > > To: Alec Matusis
> > > Cc: mod_python@modpython.org
> > > Subject: Re: [mod_python] remnant 'orphan' apache subprocesses
> > >
> > > What version of Apache are you using?
> > >
> > > What Python web application are you running on top of mod_python, a
> > > self built one or one that uses one of the larger web frameworks?
> > >
> > > Does your application create sub processes in any way to perform
> > > additional work?
> > >
> > > Graham
> > >
> > > On 22/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > > I have been investigating a memory leak that occurs on  an apache
> > > server
> > > > since we switched to worker MPM.
> > > > I found that the source of it are apache subprocesses that lose
> track
> > > of
> > > > their parent and never exit:
> > > >
> > > > root@web10 ~> ps -ef | grep httpd
> > > > root     16197     1  0 02:00 ?        00:00:09
> > > > /usr/local/encap/httpd/bin/httpd -f /p2/web/conf/web10.conf -k
> start
> > > > nobody   17750     1  0 17:53 ?        00:00:00
> > > > /usr/local/encap/httpd/bin/httpd -f /p2/web/conf/web10.conf -k
> start
> > > > nobody    5112 16197  4 20:02 ?        00:00:16
> > > > /usr/local/encap/httpd/bin/httpd -f /p2/web/conf/web10.conf -k
> start
> > > > nobody    5159 16197  4 20:02 ?        00:00:15
> > > > /usr/local/encap/httpd/bin/httpd -f /p2/web/conf/web10.conf -k
> start
> > > > nobody    5300 16197  4 20:03 ?        00:00:14
> > > > /usr/local/encap/httpd/bin/httpd -f /p2/web/conf/web10.conf -k
> start
> > > >
> > > >
> > > > in this output, apache child pid 17750 has pid 1 as a parent, and
> it
> > > is one
> > > > of those 'zombie children'.
> > > > Pids 5112,  5159, 5300 were normal (parent is pid 16197), and
> they
> > > exited
> > > > after MaxRequestsPerChild was reached.
> > > >
> > > > Does anybody have any advice on this? I cannot correlate this to
> > > anything,
> > > > there's nothing interesting in the server error log.
> > > > These 'zombies' appear at a rate of 2-3 per day; this apache
> serves
> > > about
> > > > 350 requests per second.
> > > >
> > > > This Apache configuration is
> > > >
> > > > ServerLimit 40
> > > > ThreadLimit 70
> > > >
> > > > StartServers 10
> > > > MaxClients 1600
> > > > MinSpareThreads 75
> > > > MaxSpareThreads 200
> > > > ThreadsPerChild 40
> > > > MaxRequestsPerChild 10000
> > > >
> > > >
> > > >
> > > >
> > > >
> > > > _______________________________________________
> > > > Mod_python mailing list
> > > > Mod_python@modpython.org
> > > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > > >
> >
> >

From graham.dumpleton at gmail.com  Tue Jan 22 01:26:54 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue Jan 22 01:27:01 2008
Subject: [mod_python] remnant 'orphan' apache subprocesses
In-Reply-To: <109001c85cbd$ed9af930$c8d0eb90$@com>
References: <107401c85cb5$7eb44b00$7c1ce100$@com>
	<88e286470801212122u6d07141bwd1d4746abc638c30@mail.gmail.com>
	<108b01c85cbc$46afc2f0$d40f48d0$@com>
	<88e286470801212206j5981df10ocd4dc9b9cf13803b@mail.gmail.com>
	<109001c85cbd$ed9af930$c8d0eb90$@com>
Message-ID: <88e286470801212226g48f6cea7n8879ec21cb8ecae9@mail.gmail.com>

What do you get if you use a program like lsof or ofiles to work out
what open resources the zombie process may still be holding on to?

Are you absolutely sure that that zombie process is from the current
Apache instance and not perhaps an earlier instance of Apache?

Graham

On 22/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > Are CGI scripts used anywhere at all on your Apache web site?
>
> No, only mod_python and serving static files.
>
> > -----Original Message-----
> > From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> > Sent: Monday, January 21, 2008 10:07 PM
> > To: Alec Matusis
> > Cc: mod_python@modpython.org
> > Subject: Re: [mod_python] remnant 'orphan' apache subprocesses
> >
> > Are CGI scripts used anywhere at all on your Apache web site?
> >
> > On 22/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > > What version of Apache are you using?
> > >
> > > 2.2.6
> > >
> > > > What Python web application are you running on top of mod_python, a
> > > > self built one or one that uses one of the larger web frameworks?
> > >
> > > Only self-built stuff, nothing complicated.
> > >
> > > > Does your application create sub processes in any way to perform
> > > > additional work?
> > >
> > > No sub processes and no threads, except that we use MySQLdb module
> > (which
> > > might create threads?).
> > >
> > > I noticed a warning in the error log:
> > > /live/scripts/_pro.py:100: Warning: Rows matched: 1  Changed: 1
> > Warnings: 1
> > > (this is a mysql warning), but I would not think this is relevant...
> > >
> > >
> > > > -----Original Message-----
> > > > From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> > > > Sent: Monday, January 21, 2008 9:22 PM
> > > > To: Alec Matusis
> > > > Cc: mod_python@modpython.org
> > > > Subject: Re: [mod_python] remnant 'orphan' apache subprocesses
> > > >
> > > > What version of Apache are you using?
> > > >
> > > > What Python web application are you running on top of mod_python, a
> > > > self built one or one that uses one of the larger web frameworks?
> > > >
> > > > Does your application create sub processes in any way to perform
> > > > additional work?
> > > >
> > > > Graham
> > > >
> > > > On 22/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > > > I have been investigating a memory leak that occurs on  an apache
> > > > server
> > > > > since we switched to worker MPM.
> > > > > I found that the source of it are apache subprocesses that lose
> > track
> > > > of
> > > > > their parent and never exit:
> > > > >
> > > > > root@web10 ~> ps -ef | grep httpd
> > > > > root     16197     1  0 02:00 ?        00:00:09
> > > > > /usr/local/encap/httpd/bin/httpd -f /p2/web/conf/web10.conf -k
> > start
> > > > > nobody   17750     1  0 17:53 ?        00:00:00
> > > > > /usr/local/encap/httpd/bin/httpd -f /p2/web/conf/web10.conf -k
> > start
> > > > > nobody    5112 16197  4 20:02 ?        00:00:16
> > > > > /usr/local/encap/httpd/bin/httpd -f /p2/web/conf/web10.conf -k
> > start
> > > > > nobody    5159 16197  4 20:02 ?        00:00:15
> > > > > /usr/local/encap/httpd/bin/httpd -f /p2/web/conf/web10.conf -k
> > start
> > > > > nobody    5300 16197  4 20:03 ?        00:00:14
> > > > > /usr/local/encap/httpd/bin/httpd -f /p2/web/conf/web10.conf -k
> > start
> > > > >
> > > > >
> > > > > in this output, apache child pid 17750 has pid 1 as a parent, and
> > it
> > > > is one
> > > > > of those 'zombie children'.
> > > > > Pids 5112,  5159, 5300 were normal (parent is pid 16197), and
> > they
> > > > exited
> > > > > after MaxRequestsPerChild was reached.
> > > > >
> > > > > Does anybody have any advice on this? I cannot correlate this to
> > > > anything,
> > > > > there's nothing interesting in the server error log.
> > > > > These 'zombies' appear at a rate of 2-3 per day; this apache
> > serves
> > > > about
> > > > > 350 requests per second.
> > > > >
> > > > > This Apache configuration is
> > > > >
> > > > > ServerLimit 40
> > > > > ThreadLimit 70
> > > > >
> > > > > StartServers 10
> > > > > MaxClients 1600
> > > > > MinSpareThreads 75
> > > > > MaxSpareThreads 200
> > > > > ThreadsPerChild 40
> > > > > MaxRequestsPerChild 10000
> > > > >
> > > > >
> > > > >
> > > > >
> > > > >
> > > > > _______________________________________________
> > > > > Mod_python mailing list
> > > > > Mod_python@modpython.org
> > > > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > > > >
> > >
> > >
>
>
From matusis at yahoo.com  Tue Jan 22 01:36:53 2008
From: matusis at yahoo.com (Alec Matusis)
Date: Tue Jan 22 01:37:28 2008
Subject: [mod_python] remnant 'orphan' apache subprocesses
In-Reply-To: <88e286470801212226g48f6cea7n8879ec21cb8ecae9@mail.gmail.com>
References: <107401c85cb5$7eb44b00$7c1ce100$@com>	
	<88e286470801212122u6d07141bwd1d4746abc638c30@mail.gmail.com>	
	<108b01c85cbc$46afc2f0$d40f48d0$@com>	
	<88e286470801212206j5981df10ocd4dc9b9cf13803b@mail.gmail.com>	
	<109001c85cbd$ed9af930$c8d0eb90$@com>
	<88e286470801212226g48f6cea7n8879ec21cb8ecae9@mail.gmail.com>
Message-ID: <109701c85cc1$2d616420$88242c60$@com>

> Are you absolutely sure that that zombie process is from the current
> Apache instance and not perhaps an earlier instance of Apache?
>

Yes, zombie appeared after apache was restarted, and when apache was
stopped, I made sure there were no httpd processes.

> What do you get if you use a program like lsof or ofiles to work out
> what open resources the zombie process may still be holding on to?

I have killed all zombies with `kill -9` , so I will give you this
information when a new zombie appears.
It looks like zombies appear only during higher load periods.

> -----Original Message-----
> From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> Sent: Monday, January 21, 2008 10:27 PM
> To: Alec Matusis
> Cc: mod_python@modpython.org
> Subject: Re: [mod_python] remnant 'orphan' apache subprocesses
> 
> What do you get if you use a program like lsof or ofiles to work out
> what open resources the zombie process may still be holding on to?
> 
> Are you absolutely sure that that zombie process is from the current
> Apache instance and not perhaps an earlier instance of Apache?
> 
> Graham
> 
> On 22/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > Are CGI scripts used anywhere at all on your Apache web site?
> >
> > No, only mod_python and serving static files.
> >
> > > -----Original Message-----
> > > From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> > > Sent: Monday, January 21, 2008 10:07 PM
> > > To: Alec Matusis
> > > Cc: mod_python@modpython.org
> > > Subject: Re: [mod_python] remnant 'orphan' apache subprocesses
> > >
> > > Are CGI scripts used anywhere at all on your Apache web site?
> > >
> > > On 22/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > > > What version of Apache are you using?
> > > >
> > > > 2.2.6
> > > >
> > > > > What Python web application are you running on top of
> mod_python, a
> > > > > self built one or one that uses one of the larger web
> frameworks?
> > > >
> > > > Only self-built stuff, nothing complicated.
> > > >
> > > > > Does your application create sub processes in any way to
> perform
> > > > > additional work?
> > > >
> > > > No sub processes and no threads, except that we use MySQLdb
> module
> > > (which
> > > > might create threads?).
> > > >
> > > > I noticed a warning in the error log:
> > > > /live/scripts/_pro.py:100: Warning: Rows matched: 1  Changed: 1
> > > Warnings: 1
> > > > (this is a mysql warning), but I would not think this is
> relevant...
> > > >
> > > >
> > > > > -----Original Message-----
> > > > > From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> > > > > Sent: Monday, January 21, 2008 9:22 PM
> > > > > To: Alec Matusis
> > > > > Cc: mod_python@modpython.org
> > > > > Subject: Re: [mod_python] remnant 'orphan' apache subprocesses
> > > > >
> > > > > What version of Apache are you using?
> > > > >
> > > > > What Python web application are you running on top of
> mod_python, a
> > > > > self built one or one that uses one of the larger web
> frameworks?
> > > > >
> > > > > Does your application create sub processes in any way to
> perform
> > > > > additional work?
> > > > >
> > > > > Graham
> > > > >
> > > > > On 22/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > > > > I have been investigating a memory leak that occurs on  an
> apache
> > > > > server
> > > > > > since we switched to worker MPM.
> > > > > > I found that the source of it are apache subprocesses that
> lose
> > > track
> > > > > of
> > > > > > their parent and never exit:
> > > > > >
> > > > > > root@web10 ~> ps -ef | grep httpd
> > > > > > root     16197     1  0 02:00 ?        00:00:09
> > > > > > /usr/local/encap/httpd/bin/httpd -f /p2/web/conf/web10.conf -
> k
> > > start
> > > > > > nobody   17750     1  0 17:53 ?        00:00:00
> > > > > > /usr/local/encap/httpd/bin/httpd -f /p2/web/conf/web10.conf -
> k
> > > start
> > > > > > nobody    5112 16197  4 20:02 ?        00:00:16
> > > > > > /usr/local/encap/httpd/bin/httpd -f /p2/web/conf/web10.conf -
> k
> > > start
> > > > > > nobody    5159 16197  4 20:02 ?        00:00:15
> > > > > > /usr/local/encap/httpd/bin/httpd -f /p2/web/conf/web10.conf -
> k
> > > start
> > > > > > nobody    5300 16197  4 20:03 ?        00:00:14
> > > > > > /usr/local/encap/httpd/bin/httpd -f /p2/web/conf/web10.conf -
> k
> > > start
> > > > > >
> > > > > >
> > > > > > in this output, apache child pid 17750 has pid 1 as a parent,
> and
> > > it
> > > > > is one
> > > > > > of those 'zombie children'.
> > > > > > Pids 5112,  5159, 5300 were normal (parent is pid 16197), and
> > > they
> > > > > exited
> > > > > > after MaxRequestsPerChild was reached.
> > > > > >
> > > > > > Does anybody have any advice on this? I cannot correlate this
> to
> > > > > anything,
> > > > > > there's nothing interesting in the server error log.
> > > > > > These 'zombies' appear at a rate of 2-3 per day; this apache
> > > serves
> > > > > about
> > > > > > 350 requests per second.
> > > > > >
> > > > > > This Apache configuration is
> > > > > >
> > > > > > ServerLimit 40
> > > > > > ThreadLimit 70
> > > > > >
> > > > > > StartServers 10
> > > > > > MaxClients 1600
> > > > > > MinSpareThreads 75
> > > > > > MaxSpareThreads 200
> > > > > > ThreadsPerChild 40
> > > > > > MaxRequestsPerChild 10000
> > > > > >
> > > > > >
> > > > > >
> > > > > >
> > > > > >
> > > > > > _______________________________________________
> > > > > > Mod_python mailing list
> > > > > > Mod_python@modpython.org
> > > > > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > > > > >
> > > >
> > > >
> >
> >

From necmettin.begiter at gmail.com  Tue Jan 22 01:53:33 2008
From: necmettin.begiter at gmail.com (Necmettin Begiter)
Date: Tue Jan 22 01:53:40 2008
Subject: [mod_python] can't seem to expire a cookie value
In-Reply-To: <54151.76.197.59.196.1200967249.squirrel@webmail.wageslavery.org>
References: <50446.67.122.209.91.1200955138.squirrel@webmail.wageslavery.org>
	<88e286470801211513g222d4d62m8e3285897ab5382c@mail.gmail.com>
	<54151.76.197.59.196.1200967249.squirrel@webmail.wageslavery.org>
Message-ID: <200801220853.33635.necmettin.begiter@gmail.com>

22 January 2008 Tuesday 04:00:49 tarihinde Matt Barnicle ?unlar? yazm??t?:
> ok i installed the extension and captured some data..  here is what the
> header looks like when i click the signout button:
> 
> Set-Cookie: user_name=matt; expires=Mon, 22-Jan-2007 01:54:01 GMT
> 
> then when i go back to the home page, my code reads the cookies to see if
> the cookie called 'user_name' exists, and if so, logs me in and resets the
> cookies:
> 
> if cookies.has_key('user_name'):
> 	cookie = Cookie.Cookie('user_name', user_name)
> 	cookie.expires = time.time() + 31536000
> 	Cookie.add_cookie(self.req, cookie)

1. Seems you are moving the cookie's expiration date one year forward, not back; you are making 
an addition. Your problem might be this simple.

2. Firefox has an option for keeping cookies until they expire or until Firefox is closed. Check with 
other browsers, too.

3. Keeping login information by just checking for the username is not a good approach. It is 
pretty easy to 'play' with the cookies. You must have at least one other cookie for this (but not 
the password of course).

From mattb at wageslavery.org  Tue Jan 22 15:08:13 2008
From: mattb at wageslavery.org (Matt Barnicle)
Date: Tue Jan 22 15:07:37 2008
Subject: [mod_python] can't seem to expire a cookie value
In-Reply-To: <200801220853.33635.necmettin.begiter@gmail.com>
References: <50446.67.122.209.91.1200955138.squirrel@webmail.wageslavery.org>
	<88e286470801211513g222d4d62m8e3285897ab5382c@mail.gmail.com>
	<54151.76.197.59.196.1200967249.squirrel@webmail.wageslavery.org>
	<200801220853.33635.necmettin.begiter@gmail.com>
Message-ID: <51673.76.195.11.168.1201032493.squirrel@webmail.wageslavery.org>

> 22 January 2008 Tuesday 04:00:49 tarihinde Matt Barnicle ??unlar??
> yazm????t??:
>> ok i installed the extension and captured some data..  here is what the
>> header looks like when i click the signout button:
>>
>> Set-Cookie: user_name=matt; expires=Mon, 22-Jan-2007 01:54:01 GMT
>>
>> then when i go back to the home page, my code reads the cookies to see
>> if
>> the cookie called 'user_name' exists, and if so, logs me in and resets
>> the
>> cookies:
>>
>> if cookies.has_key('user_name'):
>> 	cookie = Cookie.Cookie('user_name', user_name)
>> 	cookie.expires = time.time() + 31536000
>> 	Cookie.add_cookie(self.req, cookie)
>
> 1. Seems you are moving the cookie's expiration date one year forward, not
> back; you are making
> an addition. Your problem might be this simple.

sorry for the confusion, what i was doing in this instance was after the
user successfully logs in, this is the code in which i set the user name
in their cookies to begin with, before they log out later on and i try to
expire it..

> 2. Firefox has an option for keeping cookies until they expire or until
> Firefox is closed. Check with
> other browsers, too.

ah, good point..  i double checked and my settings are ok..

> 3. Keeping login information by just checking for the username is not a
> good approach. It is
> pretty easy to 'play' with the cookies. You must have at least one other
> cookie for this (but not
> the password of course).

correct..  i was just trying to get it to work for the time being and then
expand from that.  what i've done now that i've got it working is to
create a unique one way hash id for each user based on a few things, some
of them being random, and store that in the cookies and the user table... 
so when they first arrive to the site and have no session information, i
check for user name + unique hash id and match that to the user table.. 
is there more i could do?  if u have a recommendation or a page that
discusses this in greater length i would be very keen to know about it.

thanks!

- m@

From mattb at wageslavery.org  Tue Jan 22 15:09:50 2008
From: mattb at wageslavery.org (Matt Barnicle)
Date: Tue Jan 22 15:09:12 2008
Subject: [mod_python] can't seem to expire a cookie value
In-Reply-To: <479585BB.5080307@isomedia.com>
References: <50446.67.122.209.91.1200955138.squirrel@webmail.wageslavery.org>
	<88e286470801211513g222d4d62m8e3285897ab5382c@mail.gmail.com>
	<54151.76.197.59.196.1200967249.squirrel@webmail.wageslavery.org>
	<88e286470801211934j2a0f3ebfg96e5c30feede8fc7@mail.gmail.com>
	<57217.69.111.192.251.1200979965.squirrel@webmail.wageslavery.org>
	<479585BB.5080307@isomedia.com>
Message-ID: <51682.76.195.11.168.1201032590.squirrel@webmail.wageslavery.org>

> I fear that your work around might run into the same trouble with the
> paths if you are setting the login state to not-logged-in from the same
> context in which you are trying to expire you current cookie.

correct..  so what i'm doing now is setting the path to '/' for all of my
cookies..

> You might try using:
>
>    PythonOption ApplicationPath /
>
> or for mod_python version 3.3:
>
>    mod_python.session.application_path /
>
> in your Apache config.
>
> In my experience it keeps cookies from my site at the root level without
> any path information.
>
> --Eric

thanks for the suggestion!  i think i will do that instead, makes for
easier coding..  i really don't plan on having separate cookies per path
in our app.

- m@

From matusis at yahoo.com  Tue Jan 22 19:54:08 2008
From: matusis at yahoo.com (Alec Matusis)
Date: Tue Jan 22 19:54:50 2008
Subject: [mod_python] remnant 'orphan' apache subprocesses
In-Reply-To: <88e286470801212226g48f6cea7n8879ec21cb8ecae9@mail.gmail.com>
References: <107401c85cb5$7eb44b00$7c1ce100$@com>	
	<88e286470801212122u6d07141bwd1d4746abc638c30@mail.gmail.com>	
	<108b01c85cbc$46afc2f0$d40f48d0$@com>	
	<88e286470801212206j5981df10ocd4dc9b9cf13803b@mail.gmail.com>	
	<109001c85cbd$ed9af930$c8d0eb90$@com>
	<88e286470801212226g48f6cea7n8879ec21cb8ecae9@mail.gmail.com>
Message-ID: <022701c85d5a$76334350$6299c9f0$@com>

> What do you get if you use a program like lsof or ofiles to work out
> what open resources the zombie process may still be holding on to?

There are 6 zombie sub processes now; executing lsof -p pid takes ages, and
it brings the load average up from 8.0 to 23+ on this machine- so I am
afraid to wait long enough to get a result.
#ps -ef | grep httpd
root     16197     1  0 Jan21 ?        00:00:15
nobody   23095 16197  0 08:44 ?        00:00:06
nobody   29548     1  0 13:14 ?        00:00:00
nobody    3812     1  0 13:57 ?        00:00:00
nobody    4161     1  0 13:59 ?        00:00:00
nobody   20110     1  0 15:43 ?        00:00:00
nobody   25399     1  0 16:17 ?        00:00:00
nobody   28722     1  0 16:38 ?        00:00:00
nobody   28971 16197  5 16:40 ?        00:00:20
nobody   29189 16197  7 16:42 ?        00:00:21
nobody   29327 16197  7 16:42 ?        00:00:18
nobody   29453 16197  6 16:43 ?        00:00:13
nobody   29496 16197 10 16:43 ?        00:00:20
nobody   29539 16197  9 16:43 ?        00:00:19
nobody   29639 16197 11 16:44 ?        00:00:14
nobody   29713 16197 11 16:45 ?        00:00:12
nobody   29804 16197  5 16:45 ?        00:00:05
nobody   29857 16197 10 16:45 ?        00:00:09
nobody   29902 16197 10 16:45 ?        00:00:08
nobody   29945 16197 11 16:46 ?        00:00:07
nobody   29998 16197 11 16:46 ?        00:00:06
nobody   30058 16197 16 16:47 ?        00:00:01

note that those zombie sub processes seem to have had 00:00:00 run time,
unlike normal sub processes.
3 entries in apache error logs this time:

[Tue Jan 22 10:44:45 2008] [notice] child pid 8798 exit signal Segmentation
fault (11)
...
Fatal Python error: Inconsistent interned string state.
[Tue Jan 22 14:03:16 2008] [notice] child pid 4008 exit signal Aborted (6)

is there a faster way to see what it is holding on to? 

> -----Original Message-----
> From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> Sent: Monday, January 21, 2008 10:27 PM
> To: Alec Matusis
> Cc: mod_python@modpython.org
> Subject: Re: [mod_python] remnant 'orphan' apache subprocesses
> 
> What do you get if you use a program like lsof or ofiles to work out
> what open resources the zombie process may still be holding on to?
> 
> Are you absolutely sure that that zombie process is from the current
> Apache instance and not perhaps an earlier instance of Apache?
> 
> Graham
> 
> On 22/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > Are CGI scripts used anywhere at all on your Apache web site?
> >
> > No, only mod_python and serving static files.
> >
> > > -----Original Message-----
> > > From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> > > Sent: Monday, January 21, 2008 10:07 PM
> > > To: Alec Matusis
> > > Cc: mod_python@modpython.org
> > > Subject: Re: [mod_python] remnant 'orphan' apache subprocesses
> > >
> > > Are CGI scripts used anywhere at all on your Apache web site?
> > >
> > > On 22/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > > > What version of Apache are you using?
> > > >
> > > > 2.2.6
> > > >
> > > > > What Python web application are you running on top of
> mod_python, a
> > > > > self built one or one that uses one of the larger web
> frameworks?
> > > >
> > > > Only self-built stuff, nothing complicated.
> > > >
> > > > > Does your application create sub processes in any way to
> perform
> > > > > additional work?
> > > >
> > > > No sub processes and no threads, except that we use MySQLdb
> module
> > > (which
> > > > might create threads?).
> > > >
> > > > I noticed a warning in the error log:
> > > > /live/scripts/_pro.py:100: Warning: Rows matched: 1  Changed: 1
> > > Warnings: 1
> > > > (this is a mysql warning), but I would not think this is
> relevant...
> > > >
> > > >
> > > > > -----Original Message-----
> > > > > From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> > > > > Sent: Monday, January 21, 2008 9:22 PM
> > > > > To: Alec Matusis
> > > > > Cc: mod_python@modpython.org
> > > > > Subject: Re: [mod_python] remnant 'orphan' apache subprocesses
> > > > >
> > > > > What version of Apache are you using?
> > > > >
> > > > > What Python web application are you running on top of
> mod_python, a
> > > > > self built one or one that uses one of the larger web
> frameworks?
> > > > >
> > > > > Does your application create sub processes in any way to
> perform
> > > > > additional work?
> > > > >
> > > > > Graham
> > > > >
> > > > > On 22/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > > > > I have been investigating a memory leak that occurs on  an
> apache
> > > > > server
> > > > > > since we switched to worker MPM.
> > > > > > I found that the source of it are apache subprocesses that
> lose
> > > track
> > > > > of
> > > > > > their parent and never exit:
> > > > > >
> > > > > > root@web10 ~> ps -ef | grep httpd
> > > > > > root     16197     1  0 02:00 ?        00:00:09
> > > > > > /usr/local/encap/httpd/bin/httpd -f /p2/web/conf/web10.conf -
> k
> > > start
> > > > > > nobody   17750     1  0 17:53 ?        00:00:00
> > > > > > /usr/local/encap/httpd/bin/httpd -f /p2/web/conf/web10.conf -
> k
> > > start
> > > > > > nobody    5112 16197  4 20:02 ?        00:00:16
> > > > > > /usr/local/encap/httpd/bin/httpd -f /p2/web/conf/web10.conf -
> k
> > > start
> > > > > > nobody    5159 16197  4 20:02 ?        00:00:15
> > > > > > /usr/local/encap/httpd/bin/httpd -f /p2/web/conf/web10.conf -
> k
> > > start
> > > > > > nobody    5300 16197  4 20:03 ?        00:00:14
> > > > > > /usr/local/encap/httpd/bin/httpd -f /p2/web/conf/web10.conf -
> k
> > > start
> > > > > >
> > > > > >
> > > > > > in this output, apache child pid 17750 has pid 1 as a parent,
> and
> > > it
> > > > > is one
> > > > > > of those 'zombie children'.
> > > > > > Pids 5112,  5159, 5300 were normal (parent is pid 16197), and
> > > they
> > > > > exited
> > > > > > after MaxRequestsPerChild was reached.
> > > > > >
> > > > > > Does anybody have any advice on this? I cannot correlate this
> to
> > > > > anything,
> > > > > > there's nothing interesting in the server error log.
> > > > > > These 'zombies' appear at a rate of 2-3 per day; this apache
> > > serves
> > > > > about
> > > > > > 350 requests per second.
> > > > > >
> > > > > > This Apache configuration is
> > > > > >
> > > > > > ServerLimit 40
> > > > > > ThreadLimit 70
> > > > > >
> > > > > > StartServers 10
> > > > > > MaxClients 1600
> > > > > > MinSpareThreads 75
> > > > > > MaxSpareThreads 200
> > > > > > ThreadsPerChild 40
> > > > > > MaxRequestsPerChild 10000
> > > > > >
> > > > > >
> > > > > >
> > > > > >
> > > > > >
> > > > > > _______________________________________________
> > > > > > Mod_python mailing list
> > > > > > Mod_python@modpython.org
> > > > > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > > > > >
> > > >
> > > >
> >
> >

From graham.dumpleton at gmail.com  Tue Jan 22 20:15:15 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue Jan 22 20:15:22 2008
Subject: [mod_python] remnant 'orphan' apache subprocesses
In-Reply-To: <022701c85d5a$76334350$6299c9f0$@com>
References: <107401c85cb5$7eb44b00$7c1ce100$@com>
	<88e286470801212122u6d07141bwd1d4746abc638c30@mail.gmail.com>
	<108b01c85cbc$46afc2f0$d40f48d0$@com>
	<88e286470801212206j5981df10ocd4dc9b9cf13803b@mail.gmail.com>
	<109001c85cbd$ed9af930$c8d0eb90$@com>
	<88e286470801212226g48f6cea7n8879ec21cb8ecae9@mail.gmail.com>
	<022701c85d5a$76334350$6299c9f0$@com>
Message-ID: <88e286470801221715nf13ecf2mf862352e6ab5ec70@mail.gmail.com>

On 23/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > What do you get if you use a program like lsof or ofiles to work out
> > what open resources the zombie process may still be holding on to?
>
> There are 6 zombie sub processes now; executing lsof -p pid takes ages, and
> it brings the load average up from 8.0 to 23+ on this machine- so I am
> afraid to wait long enough to get a result.
> #ps -ef | grep httpd
> root     16197     1  0 Jan21 ?        00:00:15
> nobody   23095 16197  0 08:44 ?        00:00:06
> nobody   29548     1  0 13:14 ?        00:00:00
> nobody    3812     1  0 13:57 ?        00:00:00
> nobody    4161     1  0 13:59 ?        00:00:00
> nobody   20110     1  0 15:43 ?        00:00:00
> nobody   25399     1  0 16:17 ?        00:00:00
> nobody   28722     1  0 16:38 ?        00:00:00
> nobody   28971 16197  5 16:40 ?        00:00:20
> nobody   29189 16197  7 16:42 ?        00:00:21
> nobody   29327 16197  7 16:42 ?        00:00:18
> nobody   29453 16197  6 16:43 ?        00:00:13
> nobody   29496 16197 10 16:43 ?        00:00:20
> nobody   29539 16197  9 16:43 ?        00:00:19
> nobody   29639 16197 11 16:44 ?        00:00:14
> nobody   29713 16197 11 16:45 ?        00:00:12
> nobody   29804 16197  5 16:45 ?        00:00:05
> nobody   29857 16197 10 16:45 ?        00:00:09
> nobody   29902 16197 10 16:45 ?        00:00:08
> nobody   29945 16197 11 16:46 ?        00:00:07
> nobody   29998 16197 11 16:46 ?        00:00:06
> nobody   30058 16197 16 16:47 ?        00:00:01
>
> note that those zombie sub processes seem to have had 00:00:00 run time,
> unlike normal sub processes.
> 3 entries in apache error logs this time:
>
> [Tue Jan 22 10:44:45 2008] [notice] child pid 8798 exit signal Segmentation
> fault (11)
> ...
> Fatal Python error: Inconsistent interned string state.

This is corruption of memory used by Python.

What version of mod_python are you using?

> [Tue Jan 22 14:03:16 2008] [notice] child pid 4008 exit signal Aborted (6)
>
> is there a faster way to see what it is holding on to?

I know you said the applications weren't spawning sub processes, but
if your system has 'ptree' try that. In other words, see if those
daemon processes have children which still exist. This was in part
what I was hoping to see, ie., pipes to child processes. The other
thing I was looking for was stuck file accesses to NFS mounted
filesystems or something. Alternative to ptree is just to look at
parent child relationships in ps output.

Graham

> > -----Original Message-----
> > From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> > Sent: Monday, January 21, 2008 10:27 PM
> > To: Alec Matusis
> > Cc: mod_python@modpython.org
> > Subject: Re: [mod_python] remnant 'orphan' apache subprocesses
> >
> > What do you get if you use a program like lsof or ofiles to work out
> > what open resources the zombie process may still be holding on to?
> >
> > Are you absolutely sure that that zombie process is from the current
> > Apache instance and not perhaps an earlier instance of Apache?
> >
> > Graham
> >
> > On 22/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > > Are CGI scripts used anywhere at all on your Apache web site?
> > >
> > > No, only mod_python and serving static files.
> > >
> > > > -----Original Message-----
> > > > From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> > > > Sent: Monday, January 21, 2008 10:07 PM
> > > > To: Alec Matusis
> > > > Cc: mod_python@modpython.org
> > > > Subject: Re: [mod_python] remnant 'orphan' apache subprocesses
> > > >
> > > > Are CGI scripts used anywhere at all on your Apache web site?
> > > >
> > > > On 22/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > > > > What version of Apache are you using?
> > > > >
> > > > > 2.2.6
> > > > >
> > > > > > What Python web application are you running on top of
> > mod_python, a
> > > > > > self built one or one that uses one of the larger web
> > frameworks?
> > > > >
> > > > > Only self-built stuff, nothing complicated.
> > > > >
> > > > > > Does your application create sub processes in any way to
> > perform
> > > > > > additional work?
> > > > >
> > > > > No sub processes and no threads, except that we use MySQLdb
> > module
> > > > (which
> > > > > might create threads?).
> > > > >
> > > > > I noticed a warning in the error log:
> > > > > /live/scripts/_pro.py:100: Warning: Rows matched: 1  Changed: 1
> > > > Warnings: 1
> > > > > (this is a mysql warning), but I would not think this is
> > relevant...
> > > > >
> > > > >
> > > > > > -----Original Message-----
> > > > > > From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> > > > > > Sent: Monday, January 21, 2008 9:22 PM
> > > > > > To: Alec Matusis
> > > > > > Cc: mod_python@modpython.org
> > > > > > Subject: Re: [mod_python] remnant 'orphan' apache subprocesses
> > > > > >
> > > > > > What version of Apache are you using?
> > > > > >
> > > > > > What Python web application are you running on top of
> > mod_python, a
> > > > > > self built one or one that uses one of the larger web
> > frameworks?
> > > > > >
> > > > > > Does your application create sub processes in any way to
> > perform
> > > > > > additional work?
> > > > > >
> > > > > > Graham
> > > > > >
> > > > > > On 22/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > > > > > I have been investigating a memory leak that occurs on  an
> > apache
> > > > > > server
> > > > > > > since we switched to worker MPM.
> > > > > > > I found that the source of it are apache subprocesses that
> > lose
> > > > track
> > > > > > of
> > > > > > > their parent and never exit:
> > > > > > >
> > > > > > > root@web10 ~> ps -ef | grep httpd
> > > > > > > root     16197     1  0 02:00 ?        00:00:09
> > > > > > > /usr/local/encap/httpd/bin/httpd -f /p2/web/conf/web10.conf -
> > k
> > > > start
> > > > > > > nobody   17750     1  0 17:53 ?        00:00:00
> > > > > > > /usr/local/encap/httpd/bin/httpd -f /p2/web/conf/web10.conf -
> > k
> > > > start
> > > > > > > nobody    5112 16197  4 20:02 ?        00:00:16
> > > > > > > /usr/local/encap/httpd/bin/httpd -f /p2/web/conf/web10.conf -
> > k
> > > > start
> > > > > > > nobody    5159 16197  4 20:02 ?        00:00:15
> > > > > > > /usr/local/encap/httpd/bin/httpd -f /p2/web/conf/web10.conf -
> > k
> > > > start
> > > > > > > nobody    5300 16197  4 20:03 ?        00:00:14
> > > > > > > /usr/local/encap/httpd/bin/httpd -f /p2/web/conf/web10.conf -
> > k
> > > > start
> > > > > > >
> > > > > > >
> > > > > > > in this output, apache child pid 17750 has pid 1 as a parent,
> > and
> > > > it
> > > > > > is one
> > > > > > > of those 'zombie children'.
> > > > > > > Pids 5112,  5159, 5300 were normal (parent is pid 16197), and
> > > > they
> > > > > > exited
> > > > > > > after MaxRequestsPerChild was reached.
> > > > > > >
> > > > > > > Does anybody have any advice on this? I cannot correlate this
> > to
> > > > > > anything,
> > > > > > > there's nothing interesting in the server error log.
> > > > > > > These 'zombies' appear at a rate of 2-3 per day; this apache
> > > > serves
> > > > > > about
> > > > > > > 350 requests per second.
> > > > > > >
> > > > > > > This Apache configuration is
> > > > > > >
> > > > > > > ServerLimit 40
> > > > > > > ThreadLimit 70
> > > > > > >
> > > > > > > StartServers 10
> > > > > > > MaxClients 1600
> > > > > > > MinSpareThreads 75
> > > > > > > MaxSpareThreads 200
> > > > > > > ThreadsPerChild 40
> > > > > > > MaxRequestsPerChild 10000
> > > > > > >
> > > > > > >
> > > > > > >
> > > > > > >
> > > > > > >
> > > > > > > _______________________________________________
> > > > > > > Mod_python mailing list
> > > > > > > Mod_python@modpython.org
> > > > > > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > > > > > >
> > > > >
> > > > >
> > >
> > >
>
>
From matusis at yahoo.com  Tue Jan 22 20:20:47 2008
From: matusis at yahoo.com (Alec Matusis)
Date: Tue Jan 22 20:21:30 2008
Subject: [mod_python] remnant 'orphan' apache subprocesses
In-Reply-To: <88e286470801221715nf13ecf2mf862352e6ab5ec70@mail.gmail.com>
References: <107401c85cb5$7eb44b00$7c1ce100$@com>	
	<88e286470801212122u6d07141bwd1d4746abc638c30@mail.gmail.com>	
	<108b01c85cbc$46afc2f0$d40f48d0$@com>	
	<88e286470801212206j5981df10ocd4dc9b9cf13803b@mail.gmail.com>	
	<109001c85cbd$ed9af930$c8d0eb90$@com>	
	<88e286470801212226g48f6cea7n8879ec21cb8ecae9@mail.gmail.com>	
	<022701c85d5a$76334350$6299c9f0$@com>
	<88e286470801221715nf13ecf2mf862352e6ab5ec70@mail.gmail.com>
Message-ID: <000301c85d5e$2f7ba340$8e72e9c0$@com>

> > [Tue Jan 22 10:44:45 2008] [notice] child pid 8798 exit signal
> Segmentation
> > fault (11)
> > ...
> > Fatal Python error: Inconsistent interned string state.
> 
> This is corruption of memory used by Python.
> 
> What version of mod_python are you using?

Apache/2.2.6 (Unix) mod_python/3.3.1 Python/2.4.1

But since there is only one such log entry, I'd expect at most 1 zombie as a
result of this? I have 6. 

> -----Original Message-----
> From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> Sent: Tuesday, January 22, 2008 5:15 PM
> To: Alec Matusis
> Cc: mod_python@modpython.org
> Subject: Re: [mod_python] remnant 'orphan' apache subprocesses
> 
> On 23/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > What do you get if you use a program like lsof or ofiles to work
> out
> > > what open resources the zombie process may still be holding on to?
> >
> > There are 6 zombie sub processes now; executing lsof -p pid takes
> ages, and
> > it brings the load average up from 8.0 to 23+ on this machine- so I
> am
> > afraid to wait long enough to get a result.
> > #ps -ef | grep httpd
> > root     16197     1  0 Jan21 ?        00:00:15
> > nobody   23095 16197  0 08:44 ?        00:00:06
> > nobody   29548     1  0 13:14 ?        00:00:00
> > nobody    3812     1  0 13:57 ?        00:00:00
> > nobody    4161     1  0 13:59 ?        00:00:00
> > nobody   20110     1  0 15:43 ?        00:00:00
> > nobody   25399     1  0 16:17 ?        00:00:00
> > nobody   28722     1  0 16:38 ?        00:00:00
> > nobody   28971 16197  5 16:40 ?        00:00:20
> > nobody   29189 16197  7 16:42 ?        00:00:21
> > nobody   29327 16197  7 16:42 ?        00:00:18
> > nobody   29453 16197  6 16:43 ?        00:00:13
> > nobody   29496 16197 10 16:43 ?        00:00:20
> > nobody   29539 16197  9 16:43 ?        00:00:19
> > nobody   29639 16197 11 16:44 ?        00:00:14
> > nobody   29713 16197 11 16:45 ?        00:00:12
> > nobody   29804 16197  5 16:45 ?        00:00:05
> > nobody   29857 16197 10 16:45 ?        00:00:09
> > nobody   29902 16197 10 16:45 ?        00:00:08
> > nobody   29945 16197 11 16:46 ?        00:00:07
> > nobody   29998 16197 11 16:46 ?        00:00:06
> > nobody   30058 16197 16 16:47 ?        00:00:01
> >
> > note that those zombie sub processes seem to have had 00:00:00 run
> time,
> > unlike normal sub processes.
> > 3 entries in apache error logs this time:
> >
> > [Tue Jan 22 10:44:45 2008] [notice] child pid 8798 exit signal
> Segmentation
> > fault (11)
> > ...
> > Fatal Python error: Inconsistent interned string state.
> 
> This is corruption of memory used by Python.
> 
> What version of mod_python are you using?
> 
> > [Tue Jan 22 14:03:16 2008] [notice] child pid 4008 exit signal
> Aborted (6)
> >
> > is there a faster way to see what it is holding on to?
> 
> I know you said the applications weren't spawning sub processes, but
> if your system has 'ptree' try that. In other words, see if those
> daemon processes have children which still exist. This was in part
> what I was hoping to see, ie., pipes to child processes. The other
> thing I was looking for was stuck file accesses to NFS mounted
> filesystems or something. Alternative to ptree is just to look at
> parent child relationships in ps output.
> 
> Graham
> 
> > > -----Original Message-----
> > > From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> > > Sent: Monday, January 21, 2008 10:27 PM
> > > To: Alec Matusis
> > > Cc: mod_python@modpython.org
> > > Subject: Re: [mod_python] remnant 'orphan' apache subprocesses
> > >
> > > What do you get if you use a program like lsof or ofiles to work
> out
> > > what open resources the zombie process may still be holding on to?
> > >
> > > Are you absolutely sure that that zombie process is from the
> current
> > > Apache instance and not perhaps an earlier instance of Apache?
> > >
> > > Graham
> > >
> > > On 22/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > > > Are CGI scripts used anywhere at all on your Apache web site?
> > > >
> > > > No, only mod_python and serving static files.
> > > >
> > > > > -----Original Message-----
> > > > > From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> > > > > Sent: Monday, January 21, 2008 10:07 PM
> > > > > To: Alec Matusis
> > > > > Cc: mod_python@modpython.org
> > > > > Subject: Re: [mod_python] remnant 'orphan' apache subprocesses
> > > > >
> > > > > Are CGI scripts used anywhere at all on your Apache web site?
> > > > >
> > > > > On 22/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > > > > > What version of Apache are you using?
> > > > > >
> > > > > > 2.2.6
> > > > > >
> > > > > > > What Python web application are you running on top of
> > > mod_python, a
> > > > > > > self built one or one that uses one of the larger web
> > > frameworks?
> > > > > >
> > > > > > Only self-built stuff, nothing complicated.
> > > > > >
> > > > > > > Does your application create sub processes in any way to
> > > perform
> > > > > > > additional work?
> > > > > >
> > > > > > No sub processes and no threads, except that we use MySQLdb
> > > module
> > > > > (which
> > > > > > might create threads?).
> > > > > >
> > > > > > I noticed a warning in the error log:
> > > > > > /live/scripts/_pro.py:100: Warning: Rows matched: 1  Changed:
> 1
> > > > > Warnings: 1
> > > > > > (this is a mysql warning), but I would not think this is
> > > relevant...
> > > > > >
> > > > > >
> > > > > > > -----Original Message-----
> > > > > > > From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> > > > > > > Sent: Monday, January 21, 2008 9:22 PM
> > > > > > > To: Alec Matusis
> > > > > > > Cc: mod_python@modpython.org
> > > > > > > Subject: Re: [mod_python] remnant 'orphan' apache
> subprocesses
> > > > > > >
> > > > > > > What version of Apache are you using?
> > > > > > >
> > > > > > > What Python web application are you running on top of
> > > mod_python, a
> > > > > > > self built one or one that uses one of the larger web
> > > frameworks?
> > > > > > >
> > > > > > > Does your application create sub processes in any way to
> > > perform
> > > > > > > additional work?
> > > > > > >
> > > > > > > Graham
> > > > > > >
> > > > > > > On 22/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > > > > > > I have been investigating a memory leak that occurs on
> an
> > > apache
> > > > > > > server
> > > > > > > > since we switched to worker MPM.
> > > > > > > > I found that the source of it are apache subprocesses
> that
> > > lose
> > > > > track
> > > > > > > of
> > > > > > > > their parent and never exit:
> > > > > > > >
> > > > > > > > root@web10 ~> ps -ef | grep httpd
> > > > > > > > root     16197     1  0 02:00 ?        00:00:09
> > > > > > > > /usr/local/encap/httpd/bin/httpd -f
> /p2/web/conf/web10.conf -
> > > k
> > > > > start
> > > > > > > > nobody   17750     1  0 17:53 ?        00:00:00
> > > > > > > > /usr/local/encap/httpd/bin/httpd -f
> /p2/web/conf/web10.conf -
> > > k
> > > > > start
> > > > > > > > nobody    5112 16197  4 20:02 ?        00:00:16
> > > > > > > > /usr/local/encap/httpd/bin/httpd -f
> /p2/web/conf/web10.conf -
> > > k
> > > > > start
> > > > > > > > nobody    5159 16197  4 20:02 ?        00:00:15
> > > > > > > > /usr/local/encap/httpd/bin/httpd -f
> /p2/web/conf/web10.conf -
> > > k
> > > > > start
> > > > > > > > nobody    5300 16197  4 20:03 ?        00:00:14
> > > > > > > > /usr/local/encap/httpd/bin/httpd -f
> /p2/web/conf/web10.conf -
> > > k
> > > > > start
> > > > > > > >
> > > > > > > >
> > > > > > > > in this output, apache child pid 17750 has pid 1 as a
> parent,
> > > and
> > > > > it
> > > > > > > is one
> > > > > > > > of those 'zombie children'.
> > > > > > > > Pids 5112,  5159, 5300 were normal (parent is pid 16197),
> and
> > > > > they
> > > > > > > exited
> > > > > > > > after MaxRequestsPerChild was reached.
> > > > > > > >
> > > > > > > > Does anybody have any advice on this? I cannot correlate
> this
> > > to
> > > > > > > anything,
> > > > > > > > there's nothing interesting in the server error log.
> > > > > > > > These 'zombies' appear at a rate of 2-3 per day; this
> apache
> > > > > serves
> > > > > > > about
> > > > > > > > 350 requests per second.
> > > > > > > >
> > > > > > > > This Apache configuration is
> > > > > > > >
> > > > > > > > ServerLimit 40
> > > > > > > > ThreadLimit 70
> > > > > > > >
> > > > > > > > StartServers 10
> > > > > > > > MaxClients 1600
> > > > > > > > MinSpareThreads 75
> > > > > > > > MaxSpareThreads 200
> > > > > > > > ThreadsPerChild 40
> > > > > > > > MaxRequestsPerChild 10000
> > > > > > > >
> > > > > > > >
> > > > > > > >
> > > > > > > >
> > > > > > > >
> > > > > > > > _______________________________________________
> > > > > > > > Mod_python mailing list
> > > > > > > > Mod_python@modpython.org
> > > > > > > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > > > > > > >
> > > > > >
> > > > > >
> > > >
> > > >
> >
> >

From graham.dumpleton at gmail.com  Tue Jan 22 20:49:21 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue Jan 22 20:49:28 2008
Subject: [mod_python] remnant 'orphan' apache subprocesses
In-Reply-To: <000301c85d5e$2f7ba340$8e72e9c0$@com>
References: <107401c85cb5$7eb44b00$7c1ce100$@com>
	<88e286470801212122u6d07141bwd1d4746abc638c30@mail.gmail.com>
	<108b01c85cbc$46afc2f0$d40f48d0$@com>
	<88e286470801212206j5981df10ocd4dc9b9cf13803b@mail.gmail.com>
	<109001c85cbd$ed9af930$c8d0eb90$@com>
	<88e286470801212226g48f6cea7n8879ec21cb8ecae9@mail.gmail.com>
	<022701c85d5a$76334350$6299c9f0$@com>
	<88e286470801221715nf13ecf2mf862352e6ab5ec70@mail.gmail.com>
	<000301c85d5e$2f7ba340$8e72e9c0$@com>
Message-ID: <88e286470801221749u3be1eccbh67e54b2a645929e8@mail.gmail.com>

BTW, originally you said:

"""I have been investigating a memory leak that occurs on  an apache server
since we switched to worker MPM.
I found that the source of it are apache subprocesses that lose track of
their parent and never exit:"""

If the processes are truly zombie processes, then they shouldn't
actually consume any resources except for the entry in the process
table. Ie., they are an process accounting artifact.

So, strictly speaking they shouldn't be causing any memory leaks, or
more correctly consuming memory which isn't released.

Graham

On 23/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > [Tue Jan 22 10:44:45 2008] [notice] child pid 8798 exit signal
> > Segmentation
> > > fault (11)
> > > ...
> > > Fatal Python error: Inconsistent interned string state.
> >
> > This is corruption of memory used by Python.
> >
> > What version of mod_python are you using?
>
> Apache/2.2.6 (Unix) mod_python/3.3.1 Python/2.4.1
>
> But since there is only one such log entry, I'd expect at most 1 zombie as a
> result of this? I have 6.
>
> > -----Original Message-----
> > From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> > Sent: Tuesday, January 22, 2008 5:15 PM
> > To: Alec Matusis
> > Cc: mod_python@modpython.org
> > Subject: Re: [mod_python] remnant 'orphan' apache subprocesses
> >
> > On 23/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > > What do you get if you use a program like lsof or ofiles to work
> > out
> > > > what open resources the zombie process may still be holding on to?
> > >
> > > There are 6 zombie sub processes now; executing lsof -p pid takes
> > ages, and
> > > it brings the load average up from 8.0 to 23+ on this machine- so I
> > am
> > > afraid to wait long enough to get a result.
> > > #ps -ef | grep httpd
> > > root     16197     1  0 Jan21 ?        00:00:15
> > > nobody   23095 16197  0 08:44 ?        00:00:06
> > > nobody   29548     1  0 13:14 ?        00:00:00
> > > nobody    3812     1  0 13:57 ?        00:00:00
> > > nobody    4161     1  0 13:59 ?        00:00:00
> > > nobody   20110     1  0 15:43 ?        00:00:00
> > > nobody   25399     1  0 16:17 ?        00:00:00
> > > nobody   28722     1  0 16:38 ?        00:00:00
> > > nobody   28971 16197  5 16:40 ?        00:00:20
> > > nobody   29189 16197  7 16:42 ?        00:00:21
> > > nobody   29327 16197  7 16:42 ?        00:00:18
> > > nobody   29453 16197  6 16:43 ?        00:00:13
> > > nobody   29496 16197 10 16:43 ?        00:00:20
> > > nobody   29539 16197  9 16:43 ?        00:00:19
> > > nobody   29639 16197 11 16:44 ?        00:00:14
> > > nobody   29713 16197 11 16:45 ?        00:00:12
> > > nobody   29804 16197  5 16:45 ?        00:00:05
> > > nobody   29857 16197 10 16:45 ?        00:00:09
> > > nobody   29902 16197 10 16:45 ?        00:00:08
> > > nobody   29945 16197 11 16:46 ?        00:00:07
> > > nobody   29998 16197 11 16:46 ?        00:00:06
> > > nobody   30058 16197 16 16:47 ?        00:00:01
> > >
> > > note that those zombie sub processes seem to have had 00:00:00 run
> > time,
> > > unlike normal sub processes.
> > > 3 entries in apache error logs this time:
> > >
> > > [Tue Jan 22 10:44:45 2008] [notice] child pid 8798 exit signal
> > Segmentation
> > > fault (11)
> > > ...
> > > Fatal Python error: Inconsistent interned string state.
> >
> > This is corruption of memory used by Python.
> >
> > What version of mod_python are you using?
> >
> > > [Tue Jan 22 14:03:16 2008] [notice] child pid 4008 exit signal
> > Aborted (6)
> > >
> > > is there a faster way to see what it is holding on to?
> >
> > I know you said the applications weren't spawning sub processes, but
> > if your system has 'ptree' try that. In other words, see if those
> > daemon processes have children which still exist. This was in part
> > what I was hoping to see, ie., pipes to child processes. The other
> > thing I was looking for was stuck file accesses to NFS mounted
> > filesystems or something. Alternative to ptree is just to look at
> > parent child relationships in ps output.
> >
> > Graham
> >
> > > > -----Original Message-----
> > > > From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> > > > Sent: Monday, January 21, 2008 10:27 PM
> > > > To: Alec Matusis
> > > > Cc: mod_python@modpython.org
> > > > Subject: Re: [mod_python] remnant 'orphan' apache subprocesses
> > > >
> > > > What do you get if you use a program like lsof or ofiles to work
> > out
> > > > what open resources the zombie process may still be holding on to?
> > > >
> > > > Are you absolutely sure that that zombie process is from the
> > current
> > > > Apache instance and not perhaps an earlier instance of Apache?
> > > >
> > > > Graham
> > > >
> > > > On 22/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > > > > Are CGI scripts used anywhere at all on your Apache web site?
> > > > >
> > > > > No, only mod_python and serving static files.
> > > > >
> > > > > > -----Original Message-----
> > > > > > From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> > > > > > Sent: Monday, January 21, 2008 10:07 PM
> > > > > > To: Alec Matusis
> > > > > > Cc: mod_python@modpython.org
> > > > > > Subject: Re: [mod_python] remnant 'orphan' apache subprocesses
> > > > > >
> > > > > > Are CGI scripts used anywhere at all on your Apache web site?
> > > > > >
> > > > > > On 22/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > > > > > > What version of Apache are you using?
> > > > > > >
> > > > > > > 2.2.6
> > > > > > >
> > > > > > > > What Python web application are you running on top of
> > > > mod_python, a
> > > > > > > > self built one or one that uses one of the larger web
> > > > frameworks?
> > > > > > >
> > > > > > > Only self-built stuff, nothing complicated.
> > > > > > >
> > > > > > > > Does your application create sub processes in any way to
> > > > perform
> > > > > > > > additional work?
> > > > > > >
> > > > > > > No sub processes and no threads, except that we use MySQLdb
> > > > module
> > > > > > (which
> > > > > > > might create threads?).
> > > > > > >
> > > > > > > I noticed a warning in the error log:
> > > > > > > /live/scripts/_pro.py:100: Warning: Rows matched: 1  Changed:
> > 1
> > > > > > Warnings: 1
> > > > > > > (this is a mysql warning), but I would not think this is
> > > > relevant...
> > > > > > >
> > > > > > >
> > > > > > > > -----Original Message-----
> > > > > > > > From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> > > > > > > > Sent: Monday, January 21, 2008 9:22 PM
> > > > > > > > To: Alec Matusis
> > > > > > > > Cc: mod_python@modpython.org
> > > > > > > > Subject: Re: [mod_python] remnant 'orphan' apache
> > subprocesses
> > > > > > > >
> > > > > > > > What version of Apache are you using?
> > > > > > > >
> > > > > > > > What Python web application are you running on top of
> > > > mod_python, a
> > > > > > > > self built one or one that uses one of the larger web
> > > > frameworks?
> > > > > > > >
> > > > > > > > Does your application create sub processes in any way to
> > > > perform
> > > > > > > > additional work?
> > > > > > > >
> > > > > > > > Graham
> > > > > > > >
> > > > > > > > On 22/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > > > > > > > I have been investigating a memory leak that occurs on
> > an
> > > > apache
> > > > > > > > server
> > > > > > > > > since we switched to worker MPM.
> > > > > > > > > I found that the source of it are apache subprocesses
> > that
> > > > lose
> > > > > > track
> > > > > > > > of
> > > > > > > > > their parent and never exit:
> > > > > > > > >
> > > > > > > > > root@web10 ~> ps -ef | grep httpd
> > > > > > > > > root     16197     1  0 02:00 ?        00:00:09
> > > > > > > > > /usr/local/encap/httpd/bin/httpd -f
> > /p2/web/conf/web10.conf -
> > > > k
> > > > > > start
> > > > > > > > > nobody   17750     1  0 17:53 ?        00:00:00
> > > > > > > > > /usr/local/encap/httpd/bin/httpd -f
> > /p2/web/conf/web10.conf -
> > > > k
> > > > > > start
> > > > > > > > > nobody    5112 16197  4 20:02 ?        00:00:16
> > > > > > > > > /usr/local/encap/httpd/bin/httpd -f
> > /p2/web/conf/web10.conf -
> > > > k
> > > > > > start
> > > > > > > > > nobody    5159 16197  4 20:02 ?        00:00:15
> > > > > > > > > /usr/local/encap/httpd/bin/httpd -f
> > /p2/web/conf/web10.conf -
> > > > k
> > > > > > start
> > > > > > > > > nobody    5300 16197  4 20:03 ?        00:00:14
> > > > > > > > > /usr/local/encap/httpd/bin/httpd -f
> > /p2/web/conf/web10.conf -
> > > > k
> > > > > > start
> > > > > > > > >
> > > > > > > > >
> > > > > > > > > in this output, apache child pid 17750 has pid 1 as a
> > parent,
> > > > and
> > > > > > it
> > > > > > > > is one
> > > > > > > > > of those 'zombie children'.
> > > > > > > > > Pids 5112,  5159, 5300 were normal (parent is pid 16197),
> > and
> > > > > > they
> > > > > > > > exited
> > > > > > > > > after MaxRequestsPerChild was reached.
> > > > > > > > >
> > > > > > > > > Does anybody have any advice on this? I cannot correlate
> > this
> > > > to
> > > > > > > > anything,
> > > > > > > > > there's nothing interesting in the server error log.
> > > > > > > > > These 'zombies' appear at a rate of 2-3 per day; this
> > apache
> > > > > > serves
> > > > > > > > about
> > > > > > > > > 350 requests per second.
> > > > > > > > >
> > > > > > > > > This Apache configuration is
> > > > > > > > >
> > > > > > > > > ServerLimit 40
> > > > > > > > > ThreadLimit 70
> > > > > > > > >
> > > > > > > > > StartServers 10
> > > > > > > > > MaxClients 1600
> > > > > > > > > MinSpareThreads 75
> > > > > > > > > MaxSpareThreads 200
> > > > > > > > > ThreadsPerChild 40
> > > > > > > > > MaxRequestsPerChild 10000
> > > > > > > > >
> > > > > > > > >
> > > > > > > > >
> > > > > > > > >
> > > > > > > > >
> > > > > > > > > _______________________________________________
> > > > > > > > > Mod_python mailing list
> > > > > > > > > Mod_python@modpython.org
> > > > > > > > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > > > > > > > >
> > > > > > >
> > > > > > >
> > > > >
> > > > >
> > >
> > >
>
>
From matusis at yahoo.com  Tue Jan 22 20:54:13 2008
From: matusis at yahoo.com (Alec Matusis)
Date: Tue Jan 22 20:54:57 2008
Subject: [mod_python] remnant 'orphan' apache subprocesses
In-Reply-To: <88e286470801221749u3be1eccbh67e54b2a645929e8@mail.gmail.com>
References: <107401c85cb5$7eb44b00$7c1ce100$@com>	
	<88e286470801212122u6d07141bwd1d4746abc638c30@mail.gmail.com>	
	<108b01c85cbc$46afc2f0$d40f48d0$@com>	
	<88e286470801212206j5981df10ocd4dc9b9cf13803b@mail.gmail.com>	
	<109001c85cbd$ed9af930$c8d0eb90$@com>	
	<88e286470801212226g48f6cea7n8879ec21cb8ecae9@mail.gmail.com>	
	<022701c85d5a$76334350$6299c9f0$@com>	
	<88e286470801221715nf13ecf2mf862352e6ab5ec70@mail.gmail.com>	
	<000301c85d5e$2f7ba340$8e72e9c0$@com>
	<88e286470801221749u3be1eccbh67e54b2a645929e8@mail.gmail.com>
Message-ID: <001001c85d62$db738ba0$925aa2e0$@com>

> If the processes are truly zombie processes, then they shouldn't
> actually consume any resources except for the entry in the process
> table. Ie., they are an process accounting artifact.
> 
> So, strictly speaking they shouldn't be causing any memory leaks, or
> more correctly consuming memory which isn't released

If I look at them with `ps aux`, it shows them in S state, while truly
zombie processes are in Z state.
Normal apache sub processes are actually in Sl state.

So they are not zombie, they are 'orphan' processes.

When I kill them, free memory reported by `free` increases by the amount of
memory they took, I am sure of that. 

> -----Original Message-----
> From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> Sent: Tuesday, January 22, 2008 5:49 PM
> To: Alec Matusis
> Cc: mod_python@modpython.org
> Subject: Re: [mod_python] remnant 'orphan' apache subprocesses
> 
> BTW, originally you said:
> 
> """I have been investigating a memory leak that occurs on  an apache
> server
> since we switched to worker MPM.
> I found that the source of it are apache subprocesses that lose track
> of
> their parent and never exit:"""
> 
> If the processes are truly zombie processes, then they shouldn't
> actually consume any resources except for the entry in the process
> table. Ie., they are an process accounting artifact.
> 
> So, strictly speaking they shouldn't be causing any memory leaks, or
> more correctly consuming memory which isn't released.
> 
> Graham
> 
> On 23/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > > [Tue Jan 22 10:44:45 2008] [notice] child pid 8798 exit signal
> > > Segmentation
> > > > fault (11)
> > > > ...
> > > > Fatal Python error: Inconsistent interned string state.
> > >
> > > This is corruption of memory used by Python.
> > >
> > > What version of mod_python are you using?
> >
> > Apache/2.2.6 (Unix) mod_python/3.3.1 Python/2.4.1
> >
> > But since there is only one such log entry, I'd expect at most 1
> zombie as a
> > result of this? I have 6.
> >
> > > -----Original Message-----
> > > From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> > > Sent: Tuesday, January 22, 2008 5:15 PM
> > > To: Alec Matusis
> > > Cc: mod_python@modpython.org
> > > Subject: Re: [mod_python] remnant 'orphan' apache subprocesses
> > >
> > > On 23/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > > > What do you get if you use a program like lsof or ofiles to
> work
> > > out
> > > > > what open resources the zombie process may still be holding on
> to?
> > > >
> > > > There are 6 zombie sub processes now; executing lsof -p pid takes
> > > ages, and
> > > > it brings the load average up from 8.0 to 23+ on this machine- so
> I
> > > am
> > > > afraid to wait long enough to get a result.
> > > > #ps -ef | grep httpd
> > > > root     16197     1  0 Jan21 ?        00:00:15
> > > > nobody   23095 16197  0 08:44 ?        00:00:06
> > > > nobody   29548     1  0 13:14 ?        00:00:00
> > > > nobody    3812     1  0 13:57 ?        00:00:00
> > > > nobody    4161     1  0 13:59 ?        00:00:00
> > > > nobody   20110     1  0 15:43 ?        00:00:00
> > > > nobody   25399     1  0 16:17 ?        00:00:00
> > > > nobody   28722     1  0 16:38 ?        00:00:00
> > > > nobody   28971 16197  5 16:40 ?        00:00:20
> > > > nobody   29189 16197  7 16:42 ?        00:00:21
> > > > nobody   29327 16197  7 16:42 ?        00:00:18
> > > > nobody   29453 16197  6 16:43 ?        00:00:13
> > > > nobody   29496 16197 10 16:43 ?        00:00:20
> > > > nobody   29539 16197  9 16:43 ?        00:00:19
> > > > nobody   29639 16197 11 16:44 ?        00:00:14
> > > > nobody   29713 16197 11 16:45 ?        00:00:12
> > > > nobody   29804 16197  5 16:45 ?        00:00:05
> > > > nobody   29857 16197 10 16:45 ?        00:00:09
> > > > nobody   29902 16197 10 16:45 ?        00:00:08
> > > > nobody   29945 16197 11 16:46 ?        00:00:07
> > > > nobody   29998 16197 11 16:46 ?        00:00:06
> > > > nobody   30058 16197 16 16:47 ?        00:00:01
> > > >
> > > > note that those zombie sub processes seem to have had 00:00:00
> run
> > > time,
> > > > unlike normal sub processes.
> > > > 3 entries in apache error logs this time:
> > > >
> > > > [Tue Jan 22 10:44:45 2008] [notice] child pid 8798 exit signal
> > > Segmentation
> > > > fault (11)
> > > > ...
> > > > Fatal Python error: Inconsistent interned string state.
> > >
> > > This is corruption of memory used by Python.
> > >
> > > What version of mod_python are you using?
> > >
> > > > [Tue Jan 22 14:03:16 2008] [notice] child pid 4008 exit signal
> > > Aborted (6)
> > > >
> > > > is there a faster way to see what it is holding on to?
> > >
> > > I know you said the applications weren't spawning sub processes,
> but
> > > if your system has 'ptree' try that. In other words, see if those
> > > daemon processes have children which still exist. This was in part
> > > what I was hoping to see, ie., pipes to child processes. The other
> > > thing I was looking for was stuck file accesses to NFS mounted
> > > filesystems or something. Alternative to ptree is just to look at
> > > parent child relationships in ps output.
> > >
> > > Graham
> > >
> > > > > -----Original Message-----
> > > > > From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> > > > > Sent: Monday, January 21, 2008 10:27 PM
> > > > > To: Alec Matusis
> > > > > Cc: mod_python@modpython.org
> > > > > Subject: Re: [mod_python] remnant 'orphan' apache subprocesses
> > > > >
> > > > > What do you get if you use a program like lsof or ofiles to
> work
> > > out
> > > > > what open resources the zombie process may still be holding on
> to?
> > > > >
> > > > > Are you absolutely sure that that zombie process is from the
> > > current
> > > > > Apache instance and not perhaps an earlier instance of Apache?
> > > > >
> > > > > Graham
> > > > >
> > > > > On 22/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > > > > > Are CGI scripts used anywhere at all on your Apache web
> site?
> > > > > >
> > > > > > No, only mod_python and serving static files.
> > > > > >
> > > > > > > -----Original Message-----
> > > > > > > From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> > > > > > > Sent: Monday, January 21, 2008 10:07 PM
> > > > > > > To: Alec Matusis
> > > > > > > Cc: mod_python@modpython.org
> > > > > > > Subject: Re: [mod_python] remnant 'orphan' apache
> subprocesses
> > > > > > >
> > > > > > > Are CGI scripts used anywhere at all on your Apache web
> site?
> > > > > > >
> > > > > > > On 22/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > > > > > > > What version of Apache are you using?
> > > > > > > >
> > > > > > > > 2.2.6
> > > > > > > >
> > > > > > > > > What Python web application are you running on top of
> > > > > mod_python, a
> > > > > > > > > self built one or one that uses one of the larger web
> > > > > frameworks?
> > > > > > > >
> > > > > > > > Only self-built stuff, nothing complicated.
> > > > > > > >
> > > > > > > > > Does your application create sub processes in any way
> to
> > > > > perform
> > > > > > > > > additional work?
> > > > > > > >
> > > > > > > > No sub processes and no threads, except that we use
> MySQLdb
> > > > > module
> > > > > > > (which
> > > > > > > > might create threads?).
> > > > > > > >
> > > > > > > > I noticed a warning in the error log:
> > > > > > > > /live/scripts/_pro.py:100: Warning: Rows matched: 1
> Changed:
> > > 1
> > > > > > > Warnings: 1
> > > > > > > > (this is a mysql warning), but I would not think this is
> > > > > relevant...
> > > > > > > >
> > > > > > > >
> > > > > > > > > -----Original Message-----
> > > > > > > > > From: Graham Dumpleton
> [mailto:graham.dumpleton@gmail.com]
> > > > > > > > > Sent: Monday, January 21, 2008 9:22 PM
> > > > > > > > > To: Alec Matusis
> > > > > > > > > Cc: mod_python@modpython.org
> > > > > > > > > Subject: Re: [mod_python] remnant 'orphan' apache
> > > subprocesses
> > > > > > > > >
> > > > > > > > > What version of Apache are you using?
> > > > > > > > >
> > > > > > > > > What Python web application are you running on top of
> > > > > mod_python, a
> > > > > > > > > self built one or one that uses one of the larger web
> > > > > frameworks?
> > > > > > > > >
> > > > > > > > > Does your application create sub processes in any way
> to
> > > > > perform
> > > > > > > > > additional work?
> > > > > > > > >
> > > > > > > > > Graham
> > > > > > > > >
> > > > > > > > > On 22/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > > > > > > > > I have been investigating a memory leak that occurs
> on
> > > an
> > > > > apache
> > > > > > > > > server
> > > > > > > > > > since we switched to worker MPM.
> > > > > > > > > > I found that the source of it are apache subprocesses
> > > that
> > > > > lose
> > > > > > > track
> > > > > > > > > of
> > > > > > > > > > their parent and never exit:
> > > > > > > > > >
> > > > > > > > > > root@web10 ~> ps -ef | grep httpd
> > > > > > > > > > root     16197     1  0 02:00 ?        00:00:09
> > > > > > > > > > /usr/local/encap/httpd/bin/httpd -f
> > > /p2/web/conf/web10.conf -
> > > > > k
> > > > > > > start
> > > > > > > > > > nobody   17750     1  0 17:53 ?        00:00:00
> > > > > > > > > > /usr/local/encap/httpd/bin/httpd -f
> > > /p2/web/conf/web10.conf -
> > > > > k
> > > > > > > start
> > > > > > > > > > nobody    5112 16197  4 20:02 ?        00:00:16
> > > > > > > > > > /usr/local/encap/httpd/bin/httpd -f
> > > /p2/web/conf/web10.conf -
> > > > > k
> > > > > > > start
> > > > > > > > > > nobody    5159 16197  4 20:02 ?        00:00:15
> > > > > > > > > > /usr/local/encap/httpd/bin/httpd -f
> > > /p2/web/conf/web10.conf -
> > > > > k
> > > > > > > start
> > > > > > > > > > nobody    5300 16197  4 20:03 ?        00:00:14
> > > > > > > > > > /usr/local/encap/httpd/bin/httpd -f
> > > /p2/web/conf/web10.conf -
> > > > > k
> > > > > > > start
> > > > > > > > > >
> > > > > > > > > >
> > > > > > > > > > in this output, apache child pid 17750 has pid 1 as a
> > > parent,
> > > > > and
> > > > > > > it
> > > > > > > > > is one
> > > > > > > > > > of those 'zombie children'.
> > > > > > > > > > Pids 5112,  5159, 5300 were normal (parent is pid
> 16197),
> > > and
> > > > > > > they
> > > > > > > > > exited
> > > > > > > > > > after MaxRequestsPerChild was reached.
> > > > > > > > > >
> > > > > > > > > > Does anybody have any advice on this? I cannot
> correlate
> > > this
> > > > > to
> > > > > > > > > anything,
> > > > > > > > > > there's nothing interesting in the server error log.
> > > > > > > > > > These 'zombies' appear at a rate of 2-3 per day; this
> > > apache
> > > > > > > serves
> > > > > > > > > about
> > > > > > > > > > 350 requests per second.
> > > > > > > > > >
> > > > > > > > > > This Apache configuration is
> > > > > > > > > >
> > > > > > > > > > ServerLimit 40
> > > > > > > > > > ThreadLimit 70
> > > > > > > > > >
> > > > > > > > > > StartServers 10
> > > > > > > > > > MaxClients 1600
> > > > > > > > > > MinSpareThreads 75
> > > > > > > > > > MaxSpareThreads 200
> > > > > > > > > > ThreadsPerChild 40
> > > > > > > > > > MaxRequestsPerChild 10000
> > > > > > > > > >
> > > > > > > > > >
> > > > > > > > > >
> > > > > > > > > >
> > > > > > > > > >
> > > > > > > > > > _______________________________________________
> > > > > > > > > > Mod_python mailing list
> > > > > > > > > > Mod_python@modpython.org
> > > > > > > > > >
> http://mailman.modpython.org/mailman/listinfo/mod_python
> > > > > > > > > >
> > > > > > > >
> > > > > > > >
> > > > > >
> > > > > >
> > > >
> > > >
> >
> >

From matusis at yahoo.com  Tue Jan 22 20:57:16 2008
From: matusis at yahoo.com (Alec Matusis)
Date: Tue Jan 22 20:57:58 2008
Subject: [mod_python] remnant 'orphan' apache subprocesses
In-Reply-To: <88e286470801221749u3be1eccbh67e54b2a645929e8@mail.gmail.com>
References: <107401c85cb5$7eb44b00$7c1ce100$@com>	
	<88e286470801212122u6d07141bwd1d4746abc638c30@mail.gmail.com>	
	<108b01c85cbc$46afc2f0$d40f48d0$@com>	
	<88e286470801212206j5981df10ocd4dc9b9cf13803b@mail.gmail.com>	
	<109001c85cbd$ed9af930$c8d0eb90$@com>	
	<88e286470801212226g48f6cea7n8879ec21cb8ecae9@mail.gmail.com>	
	<022701c85d5a$76334350$6299c9f0$@com>	
	<88e286470801221715nf13ecf2mf862352e6ab5ec70@mail.gmail.com>	
	<000301c85d5e$2f7ba340$8e72e9c0$@com>
	<88e286470801221749u3be1eccbh67e54b2a645929e8@mail.gmail.com>
Message-ID: <001101c85d63$47c2bfb0$d7483f10$@com>

Here is another potentially useful cue:
32427 is this orphan process.

# strace -p 32427
Process 32427 attached - interrupt to quit
futex(0x5b7820, FUTEX_WAIT, 0, NULL

and it's just stuck there.

> -----Original Message-----
> From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> Sent: Tuesday, January 22, 2008 5:49 PM
> To: Alec Matusis
> Cc: mod_python@modpython.org
> Subject: Re: [mod_python] remnant 'orphan' apache subprocesses
> 
> BTW, originally you said:
> 
> """I have been investigating a memory leak that occurs on  an apache
> server
> since we switched to worker MPM.
> I found that the source of it are apache subprocesses that lose track
> of
> their parent and never exit:"""
> 
> If the processes are truly zombie processes, then they shouldn't
> actually consume any resources except for the entry in the process
> table. Ie., they are an process accounting artifact.
> 
> So, strictly speaking they shouldn't be causing any memory leaks, or
> more correctly consuming memory which isn't released.
> 
> Graham
> 
> On 23/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > > [Tue Jan 22 10:44:45 2008] [notice] child pid 8798 exit signal
> > > Segmentation
> > > > fault (11)
> > > > ...
> > > > Fatal Python error: Inconsistent interned string state.
> > >
> > > This is corruption of memory used by Python.
> > >
> > > What version of mod_python are you using?
> >
> > Apache/2.2.6 (Unix) mod_python/3.3.1 Python/2.4.1
> >
> > But since there is only one such log entry, I'd expect at most 1
> zombie as a
> > result of this? I have 6.
> >
> > > -----Original Message-----
> > > From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> > > Sent: Tuesday, January 22, 2008 5:15 PM
> > > To: Alec Matusis
> > > Cc: mod_python@modpython.org
> > > Subject: Re: [mod_python] remnant 'orphan' apache subprocesses
> > >
> > > On 23/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > > > What do you get if you use a program like lsof or ofiles to
> work
> > > out
> > > > > what open resources the zombie process may still be holding on
> to?
> > > >
> > > > There are 6 zombie sub processes now; executing lsof -p pid takes
> > > ages, and
> > > > it brings the load average up from 8.0 to 23+ on this machine- so
> I
> > > am
> > > > afraid to wait long enough to get a result.
> > > > #ps -ef | grep httpd
> > > > root     16197     1  0 Jan21 ?        00:00:15
> > > > nobody   23095 16197  0 08:44 ?        00:00:06
> > > > nobody   29548     1  0 13:14 ?        00:00:00
> > > > nobody    3812     1  0 13:57 ?        00:00:00
> > > > nobody    4161     1  0 13:59 ?        00:00:00
> > > > nobody   20110     1  0 15:43 ?        00:00:00
> > > > nobody   25399     1  0 16:17 ?        00:00:00
> > > > nobody   28722     1  0 16:38 ?        00:00:00
> > > > nobody   28971 16197  5 16:40 ?        00:00:20
> > > > nobody   29189 16197  7 16:42 ?        00:00:21
> > > > nobody   29327 16197  7 16:42 ?        00:00:18
> > > > nobody   29453 16197  6 16:43 ?        00:00:13
> > > > nobody   29496 16197 10 16:43 ?        00:00:20
> > > > nobody   29539 16197  9 16:43 ?        00:00:19
> > > > nobody   29639 16197 11 16:44 ?        00:00:14
> > > > nobody   29713 16197 11 16:45 ?        00:00:12
> > > > nobody   29804 16197  5 16:45 ?        00:00:05
> > > > nobody   29857 16197 10 16:45 ?        00:00:09
> > > > nobody   29902 16197 10 16:45 ?        00:00:08
> > > > nobody   29945 16197 11 16:46 ?        00:00:07
> > > > nobody   29998 16197 11 16:46 ?        00:00:06
> > > > nobody   30058 16197 16 16:47 ?        00:00:01
> > > >
> > > > note that those zombie sub processes seem to have had 00:00:00
> run
> > > time,
> > > > unlike normal sub processes.
> > > > 3 entries in apache error logs this time:
> > > >
> > > > [Tue Jan 22 10:44:45 2008] [notice] child pid 8798 exit signal
> > > Segmentation
> > > > fault (11)
> > > > ...
> > > > Fatal Python error: Inconsistent interned string state.
> > >
> > > This is corruption of memory used by Python.
> > >
> > > What version of mod_python are you using?
> > >
> > > > [Tue Jan 22 14:03:16 2008] [notice] child pid 4008 exit signal
> > > Aborted (6)
> > > >
> > > > is there a faster way to see what it is holding on to?
> > >
> > > I know you said the applications weren't spawning sub processes,
> but
> > > if your system has 'ptree' try that. In other words, see if those
> > > daemon processes have children which still exist. This was in part
> > > what I was hoping to see, ie., pipes to child processes. The other
> > > thing I was looking for was stuck file accesses to NFS mounted
> > > filesystems or something. Alternative to ptree is just to look at
> > > parent child relationships in ps output.
> > >
> > > Graham
> > >
> > > > > -----Original Message-----
> > > > > From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> > > > > Sent: Monday, January 21, 2008 10:27 PM
> > > > > To: Alec Matusis
> > > > > Cc: mod_python@modpython.org
> > > > > Subject: Re: [mod_python] remnant 'orphan' apache subprocesses
> > > > >
> > > > > What do you get if you use a program like lsof or ofiles to
> work
> > > out
> > > > > what open resources the zombie process may still be holding on
> to?
> > > > >
> > > > > Are you absolutely sure that that zombie process is from the
> > > current
> > > > > Apache instance and not perhaps an earlier instance of Apache?
> > > > >
> > > > > Graham
> > > > >
> > > > > On 22/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > > > > > Are CGI scripts used anywhere at all on your Apache web
> site?
> > > > > >
> > > > > > No, only mod_python and serving static files.
> > > > > >
> > > > > > > -----Original Message-----
> > > > > > > From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> > > > > > > Sent: Monday, January 21, 2008 10:07 PM
> > > > > > > To: Alec Matusis
> > > > > > > Cc: mod_python@modpython.org
> > > > > > > Subject: Re: [mod_python] remnant 'orphan' apache
> subprocesses
> > > > > > >
> > > > > > > Are CGI scripts used anywhere at all on your Apache web
> site?
> > > > > > >
> > > > > > > On 22/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > > > > > > > What version of Apache are you using?
> > > > > > > >
> > > > > > > > 2.2.6
> > > > > > > >
> > > > > > > > > What Python web application are you running on top of
> > > > > mod_python, a
> > > > > > > > > self built one or one that uses one of the larger web
> > > > > frameworks?
> > > > > > > >
> > > > > > > > Only self-built stuff, nothing complicated.
> > > > > > > >
> > > > > > > > > Does your application create sub processes in any way
> to
> > > > > perform
> > > > > > > > > additional work?
> > > > > > > >
> > > > > > > > No sub processes and no threads, except that we use
> MySQLdb
> > > > > module
> > > > > > > (which
> > > > > > > > might create threads?).
> > > > > > > >
> > > > > > > > I noticed a warning in the error log:
> > > > > > > > /live/scripts/_pro.py:100: Warning: Rows matched: 1
> Changed:
> > > 1
> > > > > > > Warnings: 1
> > > > > > > > (this is a mysql warning), but I would not think this is
> > > > > relevant...
> > > > > > > >
> > > > > > > >
> > > > > > > > > -----Original Message-----
> > > > > > > > > From: Graham Dumpleton
> [mailto:graham.dumpleton@gmail.com]
> > > > > > > > > Sent: Monday, January 21, 2008 9:22 PM
> > > > > > > > > To: Alec Matusis
> > > > > > > > > Cc: mod_python@modpython.org
> > > > > > > > > Subject: Re: [mod_python] remnant 'orphan' apache
> > > subprocesses
> > > > > > > > >
> > > > > > > > > What version of Apache are you using?
> > > > > > > > >
> > > > > > > > > What Python web application are you running on top of
> > > > > mod_python, a
> > > > > > > > > self built one or one that uses one of the larger web
> > > > > frameworks?
> > > > > > > > >
> > > > > > > > > Does your application create sub processes in any way
> to
> > > > > perform
> > > > > > > > > additional work?
> > > > > > > > >
> > > > > > > > > Graham
> > > > > > > > >
> > > > > > > > > On 22/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > > > > > > > > I have been investigating a memory leak that occurs
> on
> > > an
> > > > > apache
> > > > > > > > > server
> > > > > > > > > > since we switched to worker MPM.
> > > > > > > > > > I found that the source of it are apache subprocesses
> > > that
> > > > > lose
> > > > > > > track
> > > > > > > > > of
> > > > > > > > > > their parent and never exit:
> > > > > > > > > >
> > > > > > > > > > root@web10 ~> ps -ef | grep httpd
> > > > > > > > > > root     16197     1  0 02:00 ?        00:00:09
> > > > > > > > > > /usr/local/encap/httpd/bin/httpd -f
> > > /p2/web/conf/web10.conf -
> > > > > k
> > > > > > > start
> > > > > > > > > > nobody   17750     1  0 17:53 ?        00:00:00
> > > > > > > > > > /usr/local/encap/httpd/bin/httpd -f
> > > /p2/web/conf/web10.conf -
> > > > > k
> > > > > > > start
> > > > > > > > > > nobody    5112 16197  4 20:02 ?        00:00:16
> > > > > > > > > > /usr/local/encap/httpd/bin/httpd -f
> > > /p2/web/conf/web10.conf -
> > > > > k
> > > > > > > start
> > > > > > > > > > nobody    5159 16197  4 20:02 ?        00:00:15
> > > > > > > > > > /usr/local/encap/httpd/bin/httpd -f
> > > /p2/web/conf/web10.conf -
> > > > > k
> > > > > > > start
> > > > > > > > > > nobody    5300 16197  4 20:03 ?        00:00:14
> > > > > > > > > > /usr/local/encap/httpd/bin/httpd -f
> > > /p2/web/conf/web10.conf -
> > > > > k
> > > > > > > start
> > > > > > > > > >
> > > > > > > > > >
> > > > > > > > > > in this output, apache child pid 17750 has pid 1 as a
> > > parent,
> > > > > and
> > > > > > > it
> > > > > > > > > is one
> > > > > > > > > > of those 'zombie children'.
> > > > > > > > > > Pids 5112,  5159, 5300 were normal (parent is pid
> 16197),
> > > and
> > > > > > > they
> > > > > > > > > exited
> > > > > > > > > > after MaxRequestsPerChild was reached.
> > > > > > > > > >
> > > > > > > > > > Does anybody have any advice on this? I cannot
> correlate
> > > this
> > > > > to
> > > > > > > > > anything,
> > > > > > > > > > there's nothing interesting in the server error log.
> > > > > > > > > > These 'zombies' appear at a rate of 2-3 per day; this
> > > apache
> > > > > > > serves
> > > > > > > > > about
> > > > > > > > > > 350 requests per second.
> > > > > > > > > >
> > > > > > > > > > This Apache configuration is
> > > > > > > > > >
> > > > > > > > > > ServerLimit 40
> > > > > > > > > > ThreadLimit 70
> > > > > > > > > >
> > > > > > > > > > StartServers 10
> > > > > > > > > > MaxClients 1600
> > > > > > > > > > MinSpareThreads 75
> > > > > > > > > > MaxSpareThreads 200
> > > > > > > > > > ThreadsPerChild 40
> > > > > > > > > > MaxRequestsPerChild 10000
> > > > > > > > > >
> > > > > > > > > >
> > > > > > > > > >
> > > > > > > > > >
> > > > > > > > > >
> > > > > > > > > > _______________________________________________
> > > > > > > > > > Mod_python mailing list
> > > > > > > > > > Mod_python@modpython.org
> > > > > > > > > >
> http://mailman.modpython.org/mailman/listinfo/mod_python
> > > > > > > > > >
> > > > > > > >
> > > > > > > >
> > > > > >
> > > > > >
> > > >
> > > >
> >
> >

From graham.dumpleton at gmail.com  Tue Jan 22 21:04:50 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue Jan 22 21:04:55 2008
Subject: [mod_python] remnant 'orphan' apache subprocesses
In-Reply-To: <001101c85d63$47c2bfb0$d7483f10$@com>
References: <107401c85cb5$7eb44b00$7c1ce100$@com>
	<108b01c85cbc$46afc2f0$d40f48d0$@com>
	<88e286470801212206j5981df10ocd4dc9b9cf13803b@mail.gmail.com>
	<109001c85cbd$ed9af930$c8d0eb90$@com>
	<88e286470801212226g48f6cea7n8879ec21cb8ecae9@mail.gmail.com>
	<022701c85d5a$76334350$6299c9f0$@com>
	<88e286470801221715nf13ecf2mf862352e6ab5ec70@mail.gmail.com>
	<000301c85d5e$2f7ba340$8e72e9c0$@com>
	<88e286470801221749u3be1eccbh67e54b2a645929e8@mail.gmail.com>
	<001101c85d63$47c2bfb0$d7483f10$@com>
Message-ID: <88e286470801221804t3a5294b0v9f535c9e935cb4d0@mail.gmail.com>

As root, attach to the process by its pid and generate a full stack trace.

  gdb /usr/bin/httpd 32427

  ...

  $ where

FWIW, for these processes to have a PPID of 1, then some code running
in the process must have tried to daemonise the process, or some
measure of it, for example by calling setsid(). This would
disassociate it with proper Apache parent process.

Graham

On 23/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> Here is another potentially useful cue:
> 32427 is this orphan process.
>
> # strace -p 32427
> Process 32427 attached - interrupt to quit
> futex(0x5b7820, FUTEX_WAIT, 0, NULL
>
> and it's just stuck there.
>
> > -----Original Message-----
> > From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> > Sent: Tuesday, January 22, 2008 5:49 PM
> > To: Alec Matusis
> > Cc: mod_python@modpython.org
> > Subject: Re: [mod_python] remnant 'orphan' apache subprocesses
> >
> > BTW, originally you said:
> >
> > """I have been investigating a memory leak that occurs on  an apache
> > server
> > since we switched to worker MPM.
> > I found that the source of it are apache subprocesses that lose track
> > of
> > their parent and never exit:"""
> >
> > If the processes are truly zombie processes, then they shouldn't
> > actually consume any resources except for the entry in the process
> > table. Ie., they are an process accounting artifact.
> >
> > So, strictly speaking they shouldn't be causing any memory leaks, or
> > more correctly consuming memory which isn't released.
> >
> > Graham
> >
> > On 23/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > > > [Tue Jan 22 10:44:45 2008] [notice] child pid 8798 exit signal
> > > > Segmentation
> > > > > fault (11)
> > > > > ...
> > > > > Fatal Python error: Inconsistent interned string state.
> > > >
> > > > This is corruption of memory used by Python.
> > > >
> > > > What version of mod_python are you using?
> > >
> > > Apache/2.2.6 (Unix) mod_python/3.3.1 Python/2.4.1
> > >
> > > But since there is only one such log entry, I'd expect at most 1
> > zombie as a
> > > result of this? I have 6.
> > >
> > > > -----Original Message-----
> > > > From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> > > > Sent: Tuesday, January 22, 2008 5:15 PM
> > > > To: Alec Matusis
> > > > Cc: mod_python@modpython.org
> > > > Subject: Re: [mod_python] remnant 'orphan' apache subprocesses
> > > >
> > > > On 23/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > > > > What do you get if you use a program like lsof or ofiles to
> > work
> > > > out
> > > > > > what open resources the zombie process may still be holding on
> > to?
> > > > >
> > > > > There are 6 zombie sub processes now; executing lsof -p pid takes
> > > > ages, and
> > > > > it brings the load average up from 8.0 to 23+ on this machine- so
> > I
> > > > am
> > > > > afraid to wait long enough to get a result.
> > > > > #ps -ef | grep httpd
> > > > > root     16197     1  0 Jan21 ?        00:00:15
> > > > > nobody   23095 16197  0 08:44 ?        00:00:06
> > > > > nobody   29548     1  0 13:14 ?        00:00:00
> > > > > nobody    3812     1  0 13:57 ?        00:00:00
> > > > > nobody    4161     1  0 13:59 ?        00:00:00
> > > > > nobody   20110     1  0 15:43 ?        00:00:00
> > > > > nobody   25399     1  0 16:17 ?        00:00:00
> > > > > nobody   28722     1  0 16:38 ?        00:00:00
> > > > > nobody   28971 16197  5 16:40 ?        00:00:20
> > > > > nobody   29189 16197  7 16:42 ?        00:00:21
> > > > > nobody   29327 16197  7 16:42 ?        00:00:18
> > > > > nobody   29453 16197  6 16:43 ?        00:00:13
> > > > > nobody   29496 16197 10 16:43 ?        00:00:20
> > > > > nobody   29539 16197  9 16:43 ?        00:00:19
> > > > > nobody   29639 16197 11 16:44 ?        00:00:14
> > > > > nobody   29713 16197 11 16:45 ?        00:00:12
> > > > > nobody   29804 16197  5 16:45 ?        00:00:05
> > > > > nobody   29857 16197 10 16:45 ?        00:00:09
> > > > > nobody   29902 16197 10 16:45 ?        00:00:08
> > > > > nobody   29945 16197 11 16:46 ?        00:00:07
> > > > > nobody   29998 16197 11 16:46 ?        00:00:06
> > > > > nobody   30058 16197 16 16:47 ?        00:00:01
> > > > >
> > > > > note that those zombie sub processes seem to have had 00:00:00
> > run
> > > > time,
> > > > > unlike normal sub processes.
> > > > > 3 entries in apache error logs this time:
> > > > >
> > > > > [Tue Jan 22 10:44:45 2008] [notice] child pid 8798 exit signal
> > > > Segmentation
> > > > > fault (11)
> > > > > ...
> > > > > Fatal Python error: Inconsistent interned string state.
> > > >
> > > > This is corruption of memory used by Python.
> > > >
> > > > What version of mod_python are you using?
> > > >
> > > > > [Tue Jan 22 14:03:16 2008] [notice] child pid 4008 exit signal
> > > > Aborted (6)
> > > > >
> > > > > is there a faster way to see what it is holding on to?
> > > >
> > > > I know you said the applications weren't spawning sub processes,
> > but
> > > > if your system has 'ptree' try that. In other words, see if those
> > > > daemon processes have children which still exist. This was in part
> > > > what I was hoping to see, ie., pipes to child processes. The other
> > > > thing I was looking for was stuck file accesses to NFS mounted
> > > > filesystems or something. Alternative to ptree is just to look at
> > > > parent child relationships in ps output.
> > > >
> > > > Graham
> > > >
> > > > > > -----Original Message-----
> > > > > > From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> > > > > > Sent: Monday, January 21, 2008 10:27 PM
> > > > > > To: Alec Matusis
> > > > > > Cc: mod_python@modpython.org
> > > > > > Subject: Re: [mod_python] remnant 'orphan' apache subprocesses
> > > > > >
> > > > > > What do you get if you use a program like lsof or ofiles to
> > work
> > > > out
> > > > > > what open resources the zombie process may still be holding on
> > to?
> > > > > >
> > > > > > Are you absolutely sure that that zombie process is from the
> > > > current
> > > > > > Apache instance and not perhaps an earlier instance of Apache?
> > > > > >
> > > > > > Graham
> > > > > >
> > > > > > On 22/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > > > > > > Are CGI scripts used anywhere at all on your Apache web
> > site?
> > > > > > >
> > > > > > > No, only mod_python and serving static files.
> > > > > > >
> > > > > > > > -----Original Message-----
> > > > > > > > From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> > > > > > > > Sent: Monday, January 21, 2008 10:07 PM
> > > > > > > > To: Alec Matusis
> > > > > > > > Cc: mod_python@modpython.org
> > > > > > > > Subject: Re: [mod_python] remnant 'orphan' apache
> > subprocesses
> > > > > > > >
> > > > > > > > Are CGI scripts used anywhere at all on your Apache web
> > site?
> > > > > > > >
> > > > > > > > On 22/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > > > > > > > > What version of Apache are you using?
> > > > > > > > >
> > > > > > > > > 2.2.6
> > > > > > > > >
> > > > > > > > > > What Python web application are you running on top of
> > > > > > mod_python, a
> > > > > > > > > > self built one or one that uses one of the larger web
> > > > > > frameworks?
> > > > > > > > >
> > > > > > > > > Only self-built stuff, nothing complicated.
> > > > > > > > >
> > > > > > > > > > Does your application create sub processes in any way
> > to
> > > > > > perform
> > > > > > > > > > additional work?
> > > > > > > > >
> > > > > > > > > No sub processes and no threads, except that we use
> > MySQLdb
> > > > > > module
> > > > > > > > (which
> > > > > > > > > might create threads?).
> > > > > > > > >
> > > > > > > > > I noticed a warning in the error log:
> > > > > > > > > /live/scripts/_pro.py:100: Warning: Rows matched: 1
> > Changed:
> > > > 1
> > > > > > > > Warnings: 1
> > > > > > > > > (this is a mysql warning), but I would not think this is
> > > > > > relevant...
> > > > > > > > >
> > > > > > > > >
> > > > > > > > > > -----Original Message-----
> > > > > > > > > > From: Graham Dumpleton
> > [mailto:graham.dumpleton@gmail.com]
> > > > > > > > > > Sent: Monday, January 21, 2008 9:22 PM
> > > > > > > > > > To: Alec Matusis
> > > > > > > > > > Cc: mod_python@modpython.org
> > > > > > > > > > Subject: Re: [mod_python] remnant 'orphan' apache
> > > > subprocesses
> > > > > > > > > >
> > > > > > > > > > What version of Apache are you using?
> > > > > > > > > >
> > > > > > > > > > What Python web application are you running on top of
> > > > > > mod_python, a
> > > > > > > > > > self built one or one that uses one of the larger web
> > > > > > frameworks?
> > > > > > > > > >
> > > > > > > > > > Does your application create sub processes in any way
> > to
> > > > > > perform
> > > > > > > > > > additional work?
> > > > > > > > > >
> > > > > > > > > > Graham
> > > > > > > > > >
> > > > > > > > > > On 22/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > > > > > > > > > I have been investigating a memory leak that occurs
> > on
> > > > an
> > > > > > apache
> > > > > > > > > > server
> > > > > > > > > > > since we switched to worker MPM.
> > > > > > > > > > > I found that the source of it are apache subprocesses
> > > > that
> > > > > > lose
> > > > > > > > track
> > > > > > > > > > of
> > > > > > > > > > > their parent and never exit:
> > > > > > > > > > >
> > > > > > > > > > > root@web10 ~> ps -ef | grep httpd
> > > > > > > > > > > root     16197     1  0 02:00 ?        00:00:09
> > > > > > > > > > > /usr/local/encap/httpd/bin/httpd -f
> > > > /p2/web/conf/web10.conf -
> > > > > > k
> > > > > > > > start
> > > > > > > > > > > nobody   17750     1  0 17:53 ?        00:00:00
> > > > > > > > > > > /usr/local/encap/httpd/bin/httpd -f
> > > > /p2/web/conf/web10.conf -
> > > > > > k
> > > > > > > > start
> > > > > > > > > > > nobody    5112 16197  4 20:02 ?        00:00:16
> > > > > > > > > > > /usr/local/encap/httpd/bin/httpd -f
> > > > /p2/web/conf/web10.conf -
> > > > > > k
> > > > > > > > start
> > > > > > > > > > > nobody    5159 16197  4 20:02 ?        00:00:15
> > > > > > > > > > > /usr/local/encap/httpd/bin/httpd -f
> > > > /p2/web/conf/web10.conf -
> > > > > > k
> > > > > > > > start
> > > > > > > > > > > nobody    5300 16197  4 20:03 ?        00:00:14
> > > > > > > > > > > /usr/local/encap/httpd/bin/httpd -f
> > > > /p2/web/conf/web10.conf -
> > > > > > k
> > > > > > > > start
> > > > > > > > > > >
> > > > > > > > > > >
> > > > > > > > > > > in this output, apache child pid 17750 has pid 1 as a
> > > > parent,
> > > > > > and
> > > > > > > > it
> > > > > > > > > > is one
> > > > > > > > > > > of those 'zombie children'.
> > > > > > > > > > > Pids 5112,  5159, 5300 were normal (parent is pid
> > 16197),
> > > > and
> > > > > > > > they
> > > > > > > > > > exited
> > > > > > > > > > > after MaxRequestsPerChild was reached.
> > > > > > > > > > >
> > > > > > > > > > > Does anybody have any advice on this? I cannot
> > correlate
> > > > this
> > > > > > to
> > > > > > > > > > anything,
> > > > > > > > > > > there's nothing interesting in the server error log.
> > > > > > > > > > > These 'zombies' appear at a rate of 2-3 per day; this
> > > > apache
> > > > > > > > serves
> > > > > > > > > > about
> > > > > > > > > > > 350 requests per second.
> > > > > > > > > > >
> > > > > > > > > > > This Apache configuration is
> > > > > > > > > > >
> > > > > > > > > > > ServerLimit 40
> > > > > > > > > > > ThreadLimit 70
> > > > > > > > > > >
> > > > > > > > > > > StartServers 10
> > > > > > > > > > > MaxClients 1600
> > > > > > > > > > > MinSpareThreads 75
> > > > > > > > > > > MaxSpareThreads 200
> > > > > > > > > > > ThreadsPerChild 40
> > > > > > > > > > > MaxRequestsPerChild 10000
> > > > > > > > > > >
> > > > > > > > > > >
> > > > > > > > > > >
> > > > > > > > > > >
> > > > > > > > > > >
> > > > > > > > > > > _______________________________________________
> > > > > > > > > > > Mod_python mailing list
> > > > > > > > > > > Mod_python@modpython.org
> > > > > > > > > > >
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> > > > > > > > > > >
> > > > > > > > >
> > > > > > > > >
> > > > > > >
> > > > > > >
> > > > >
> > > > >
> > >
> > >
>
>
From matusis at yahoo.com  Tue Jan 22 21:20:47 2008
From: matusis at yahoo.com (Alec Matusis)
Date: Tue Jan 22 21:21:28 2008
Subject: [mod_python] remnant 'orphan' apache subprocesses
In-Reply-To: <88e286470801221804t3a5294b0v9f535c9e935cb4d0@mail.gmail.com>
References: <107401c85cb5$7eb44b00$7c1ce100$@com>	
	<108b01c85cbc$46afc2f0$d40f48d0$@com>	
	<88e286470801212206j5981df10ocd4dc9b9cf13803b@mail.gmail.com>	
	<109001c85cbd$ed9af930$c8d0eb90$@com>	
	<88e286470801212226g48f6cea7n8879ec21cb8ecae9@mail.gmail.com>	
	<022701c85d5a$76334350$6299c9f0$@com>	
	<88e286470801221715nf13ecf2mf862352e6ab5ec70@mail.gmail.com>	
	<000301c85d5e$2f7ba340$8e72e9c0$@com>	
	<88e286470801221749u3be1eccbh67e54b2a645929e8@mail.gmail.com>	
	<001101c85d63$47c2bfb0$d7483f10$@com>
	<88e286470801221804t3a5294b0v9f535c9e935cb4d0@mail.gmail.com>
Message-ID: <001b01c85d66$90ccd710$b2668530$@com>

>   gdb /usr/bin/httpd 32427

(gdb) where
#0  0x00002aaaab2c94df in sem_wait () from /lib64/tls/libpthread.so.0
#1  0x00002aaaac204dcd in PyThread_acquire_lock (lock=0x5b7820, waitflag=1)
at thread_pthread.h:298
#2  0x00002aaaac1f7008 in PyImport_ImportModuleEx (name=0x2aaaad7195c4
"errno", globals=0x2aaaada331c0, 
    locals=<value optimized out>, fromlist=0x2aaaad75e998) at import.c:239
#3  0x00002aaaac230883 in builtin___import__ (self=<value optimized out>,
args=<value optimized out>) at bltinmodule.c:45
#4  0x00002aaaac19c91c in PyCFunction_Call (func=0x2aaaad6f9440,
arg=0x2aaab0a68c58, kw=<value optimized out>) at methodobject.c:93
#5  0x00002aaaac177470 in PyObject_Call (func=<value optimized out>,
arg=<value optimized out>, kw=<value optimized out>)
    at abstract.c:1751
#6  0x00002aaaac1cb58e in PyEval_CallObjectWithKeywords
(func=0x2aaaad6f9440, arg=0x2aaab0a68c58, kw=0x0) at ceval.c:3419
#7  0x00002aaaac1cda14 in PyEval_EvalFrame (f=0x8fe4e0) at ceval.c:2020
#8  0x00002aaaac1d2d7e in PyEval_EvalCodeEx (co=0x2aaaad75fb20,
globals=<value optimized out>, locals=<value optimized out>, 
    args=<value optimized out>, argcount=2, kws=0xb71220, kwcount=0,
defs=0x2aaaad761e68, defcount=1, closure=0x0) at ceval.c:2730
#9  0x00002aaaac1d0714 in PyEval_EvalFrame (f=0xb71070) at ceval.c:3639
#10 0x00002aaaac1d26d7 in PyEval_EvalFrame (f=0xa54890) at ceval.c:3629
#11 0x00002aaaac1d26d7 in PyEval_EvalFrame (f=0x891e10) at ceval.c:3629
#12 0x00002aaaac1d2d7e in PyEval_EvalCodeEx (co=0x2aaab0a78f10,
globals=<value optimized out>, locals=<value optimized out>, 
    args=<value optimized out>, argcount=4, kws=0x0, kwcount=0,
defs=0x2aaab0a5bde8, defcount=2, closure=0x0) at ceval.c:2730
#13 0x00002aaaac22acc7 in function_call (func=0x2aaab0aa3050,
arg=0x2aaab0a68520, kw=0x0) at funcobject.c:548
#14 0x00002aaaac177470 in PyObject_Call (func=<value optimized out>,
arg=<value optimized out>, kw=<value optimized out>)
    at abstract.c:1751
#15 0x00002aaaac183871 in instancemethod_call (func=<value optimized out>,
arg=0x2aaab0a68520, kw=0x0) at classobject.c:2431
#16 0x00002aaaac177470 in PyObject_Call (func=<value optimized out>,
arg=<value optimized out>, kw=<value optimized out>)
    at abstract.c:1751
#17 0x00002aaaac1cb58e in PyEval_CallObjectWithKeywords
(func=0x2aaab00c1d20, arg=0x2aaab0aa1280, kw=0x0) at ceval.c:3419
#18 0x00002aaaac18449e in PyInstance_New (klass=<value optimized out>,
arg=0x2aaab0aa1280, kw=0x0) at classobject.c:575
#19 0x00002aaaac177470 in PyObject_Call (func=<value optimized out>,
arg=<value optimized out>, kw=<value optimized out>)
    at abstract.c:1751
#20 0x00002aaaac1cf5b1 in PyEval_EvalFrame (f=0x8fe7c0) at ceval.c:3755
#21 0x00002aaaac1d2d7e in PyEval_EvalCodeEx (co=0x2aaab0a9f810,
globals=<value optimized out>, locals=<value optimized out>, 
    args=<value optimized out>, argcount=2, kws=0x2aaaada67ec0, kwcount=0,
defs=0x2aaab0a5a728, defcount=2, closure=0x0)
    at ceval.c:2730
#22 0x00002aaaac1d0714 in PyEval_EvalFrame (f=0x2aaaada67cf0) at
ceval.c:3639
#23 0x00002aaaac1d2d7e in PyEval_EvalCodeEx (co=0x2aaaad762880,
globals=<value optimized out>, locals=<value optimized out>, 
    args=<value optimized out>, argcount=1, kws=0x987808, kwcount=0,
defs=0x2aaaadc040f8, defcount=2, closure=0x0) at ceval.c:2730
#24 0x00002aaaac1d0714 in PyEval_EvalFrame (f=0x987650) at ceval.c:3639
#25 0x00002aaaac1d2d7e in PyEval_EvalCodeEx (co=0x2aaab00fc8f0,
globals=<value optimized out>, locals=<value optimized out>, 
    args=<value optimized out>, argcount=1, kws=0x7c29e8, kwcount=0,
defs=0x2aaab0095a88, defcount=2, closure=0x0) at ceval.c:2730
#26 0x00002aaaac1d0714 in PyEval_EvalFrame (f=0x7c27b0) at ceval.c:3639
#27 0x00002aaaac1d26d7 in PyEval_EvalFrame (f=0xb04790) at ceval.c:3629
#28 0x00002aaaac1d2d7e in PyEval_EvalCodeEx (co=0x2aaaaec4c960,
globals=<value optimized out>, locals=<value optimized out>, 
    args=<value optimized out>, argcount=1, kws=0x2aaaadd5cd48, kwcount=0,
defs=0x0, defcount=0, closure=0x0) at ceval.c:2730
#29 0x00002aaaac1d0714 in PyEval_EvalFrame (f=0x2aaaadd5cb60) at
ceval.c:3639
#30 0x00002aaaac1d26d7 in PyEval_EvalFrame (f=0x2aaaaddc8b90) at
ceval.c:3629
#31 0x00002aaaac1d2d7e in PyEval_EvalCodeEx (co=0x2aaaaec5e570,
globals=<value optimized out>, locals=<value optimized out>, 
    args=<value optimized out>, argcount=0, kws=0x2aaaadd67568, kwcount=7,
defs=0x0, defcount=0, closure=0x0) at ceval.c:2730
#32 0x00002aaaac1d0714 in PyEval_EvalFrame (f=0x2aaaadd67340) at
ceval.c:3639
#33 0x00002aaaac1d2d7e in PyEval_EvalCodeEx (co=0x2aaaaec5e730,
globals=<value optimized out>, locals=<value optimized out>, 
    args=<value optimized out>, argcount=2, kws=0x0, kwcount=0, defs=0x0,
defcount=0, closure=0x0) at ceval.c:2730
#34 0x00002aaaac22acc7 in function_call (func=0x2aaaaf50fed8,
arg=0x2aaab0158fc8, kw=0x0) at funcobject.c:548
#35 0x00002aaaac177470 in PyObject_Call (func=<value optimized out>,
arg=<value optimized out>, kw=<value optimized out>)
    at abstract.c:1751
#36 0x00002aaaac183871 in instancemethod_call (func=<value optimized out>,
arg=0x2aaab0158fc8, kw=0x0) at classobject.c:2431
#37 0x00002aaaac177470 in PyObject_Call (func=<value optimized out>,
arg=<value optimized out>, kw=<value optimized out>)
    at abstract.c:1751
#38 0x00002aaaac17828d in PyObject_CallMethod (o=<value optimized out>,
name=<value optimized out>, format=0x2aaab0a63190 "\001")
    at abstract.c:1840
#39 0x00002aaaac17603a in python_handler (req=0x853098, phase=0x2aaaac23583f
"PythonHandler") at mod_python.c:1652

> -----Original Message-----
> From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> Sent: Tuesday, January 22, 2008 6:05 PM
> To: Alec Matusis
> Cc: mod_python@modpython.org
> Subject: Re: [mod_python] remnant 'orphan' apache subprocesses
> 
> As root, attach to the process by its pid and generate a full stack
> trace.
> 
>   gdb /usr/bin/httpd 32427
> 
>   ...
> 
>   $ where
> 
> FWIW, for these processes to have a PPID of 1, then some code running
> in the process must have tried to daemonise the process, or some
> measure of it, for example by calling setsid(). This would
> disassociate it with proper Apache parent process.
> 
> Graham
> 
> On 23/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > Here is another potentially useful cue:
> > 32427 is this orphan process.
> >
> > # strace -p 32427
> > Process 32427 attached - interrupt to quit
> > futex(0x5b7820, FUTEX_WAIT, 0, NULL
> >
> > and it's just stuck there.
> >
> > > -----Original Message-----
> > > From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> > > Sent: Tuesday, January 22, 2008 5:49 PM
> > > To: Alec Matusis
> > > Cc: mod_python@modpython.org
> > > Subject: Re: [mod_python] remnant 'orphan' apache subprocesses
> > >
> > > BTW, originally you said:
> > >
> > > """I have been investigating a memory leak that occurs on  an
> apache
> > > server
> > > since we switched to worker MPM.
> > > I found that the source of it are apache subprocesses that lose
> track
> > > of
> > > their parent and never exit:"""
> > >
> > > If the processes are truly zombie processes, then they shouldn't
> > > actually consume any resources except for the entry in the process
> > > table. Ie., they are an process accounting artifact.
> > >
> > > So, strictly speaking they shouldn't be causing any memory leaks,
> or
> > > more correctly consuming memory which isn't released.
> > >
> > > Graham
> > >
> > > On 23/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > > > > [Tue Jan 22 10:44:45 2008] [notice] child pid 8798 exit
> signal
> > > > > Segmentation
> > > > > > fault (11)
> > > > > > ...
> > > > > > Fatal Python error: Inconsistent interned string state.
> > > > >
> > > > > This is corruption of memory used by Python.
> > > > >
> > > > > What version of mod_python are you using?
> > > >
> > > > Apache/2.2.6 (Unix) mod_python/3.3.1 Python/2.4.1
> > > >
> > > > But since there is only one such log entry, I'd expect at most 1
> > > zombie as a
> > > > result of this? I have 6.
> > > >
> > > > > -----Original Message-----
> > > > > From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> > > > > Sent: Tuesday, January 22, 2008 5:15 PM
> > > > > To: Alec Matusis
> > > > > Cc: mod_python@modpython.org
> > > > > Subject: Re: [mod_python] remnant 'orphan' apache subprocesses
> > > > >
> > > > > On 23/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > > > > > What do you get if you use a program like lsof or ofiles to
> > > work
> > > > > out
> > > > > > > what open resources the zombie process may still be holding
> on
> > > to?
> > > > > >
> > > > > > There are 6 zombie sub processes now; executing lsof -p pid
> takes
> > > > > ages, and
> > > > > > it brings the load average up from 8.0 to 23+ on this
> machine- so
> > > I
> > > > > am
> > > > > > afraid to wait long enough to get a result.
> > > > > > #ps -ef | grep httpd
> > > > > > root     16197     1  0 Jan21 ?        00:00:15
> > > > > > nobody   23095 16197  0 08:44 ?        00:00:06
> > > > > > nobody   29548     1  0 13:14 ?        00:00:00
> > > > > > nobody    3812     1  0 13:57 ?        00:00:00
> > > > > > nobody    4161     1  0 13:59 ?        00:00:00
> > > > > > nobody   20110     1  0 15:43 ?        00:00:00
> > > > > > nobody   25399     1  0 16:17 ?        00:00:00
> > > > > > nobody   28722     1  0 16:38 ?        00:00:00
> > > > > > nobody   28971 16197  5 16:40 ?        00:00:20
> > > > > > nobody   29189 16197  7 16:42 ?        00:00:21
> > > > > > nobody   29327 16197  7 16:42 ?        00:00:18
> > > > > > nobody   29453 16197  6 16:43 ?        00:00:13
> > > > > > nobody   29496 16197 10 16:43 ?        00:00:20
> > > > > > nobody   29539 16197  9 16:43 ?        00:00:19
> > > > > > nobody   29639 16197 11 16:44 ?        00:00:14
> > > > > > nobody   29713 16197 11 16:45 ?        00:00:12
> > > > > > nobody   29804 16197  5 16:45 ?        00:00:05
> > > > > > nobody   29857 16197 10 16:45 ?        00:00:09
> > > > > > nobody   29902 16197 10 16:45 ?        00:00:08
> > > > > > nobody   29945 16197 11 16:46 ?        00:00:07
> > > > > > nobody   29998 16197 11 16:46 ?        00:00:06
> > > > > > nobody   30058 16197 16 16:47 ?        00:00:01
> > > > > >
> > > > > > note that those zombie sub processes seem to have had
> 00:00:00
> > > run
> > > > > time,
> > > > > > unlike normal sub processes.
> > > > > > 3 entries in apache error logs this time:
> > > > > >
> > > > > > [Tue Jan 22 10:44:45 2008] [notice] child pid 8798 exit
> signal
> > > > > Segmentation
> > > > > > fault (11)
> > > > > > ...
> > > > > > Fatal Python error: Inconsistent interned string state.
> > > > >
> > > > > This is corruption of memory used by Python.
> > > > >
> > > > > What version of mod_python are you using?
> > > > >
> > > > > > [Tue Jan 22 14:03:16 2008] [notice] child pid 4008 exit
> signal
> > > > > Aborted (6)
> > > > > >
> > > > > > is there a faster way to see what it is holding on to?
> > > > >
> > > > > I know you said the applications weren't spawning sub
> processes,
> > > but
> > > > > if your system has 'ptree' try that. In other words, see if
> those
> > > > > daemon processes have children which still exist. This was in
> part
> > > > > what I was hoping to see, ie., pipes to child processes. The
> other
> > > > > thing I was looking for was stuck file accesses to NFS mounted
> > > > > filesystems or something. Alternative to ptree is just to look
> at
> > > > > parent child relationships in ps output.
> > > > >
> > > > > Graham
> > > > >
> > > > > > > -----Original Message-----
> > > > > > > From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> > > > > > > Sent: Monday, January 21, 2008 10:27 PM
> > > > > > > To: Alec Matusis
> > > > > > > Cc: mod_python@modpython.org
> > > > > > > Subject: Re: [mod_python] remnant 'orphan' apache
> subprocesses
> > > > > > >
> > > > > > > What do you get if you use a program like lsof or ofiles to
> > > work
> > > > > out
> > > > > > > what open resources the zombie process may still be holding
> on
> > > to?
> > > > > > >
> > > > > > > Are you absolutely sure that that zombie process is from
> the
> > > > > current
> > > > > > > Apache instance and not perhaps an earlier instance of
> Apache?
> > > > > > >
> > > > > > > Graham
> > > > > > >
> > > > > > > On 22/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > > > > > > > Are CGI scripts used anywhere at all on your Apache web
> > > site?
> > > > > > > >
> > > > > > > > No, only mod_python and serving static files.
> > > > > > > >
> > > > > > > > > -----Original Message-----
> > > > > > > > > From: Graham Dumpleton
> [mailto:graham.dumpleton@gmail.com]
> > > > > > > > > Sent: Monday, January 21, 2008 10:07 PM
> > > > > > > > > To: Alec Matusis
> > > > > > > > > Cc: mod_python@modpython.org
> > > > > > > > > Subject: Re: [mod_python] remnant 'orphan' apache
> > > subprocesses
> > > > > > > > >
> > > > > > > > > Are CGI scripts used anywhere at all on your Apache web
> > > site?
> > > > > > > > >
> > > > > > > > > On 22/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > > > > > > > > > What version of Apache are you using?
> > > > > > > > > >
> > > > > > > > > > 2.2.6
> > > > > > > > > >
> > > > > > > > > > > What Python web application are you running on top
> of
> > > > > > > mod_python, a
> > > > > > > > > > > self built one or one that uses one of the larger
> web
> > > > > > > frameworks?
> > > > > > > > > >
> > > > > > > > > > Only self-built stuff, nothing complicated.
> > > > > > > > > >
> > > > > > > > > > > Does your application create sub processes in any
> way
> > > to
> > > > > > > perform
> > > > > > > > > > > additional work?
> > > > > > > > > >
> > > > > > > > > > No sub processes and no threads, except that we use
> > > MySQLdb
> > > > > > > module
> > > > > > > > > (which
> > > > > > > > > > might create threads?).
> > > > > > > > > >
> > > > > > > > > > I noticed a warning in the error log:
> > > > > > > > > > /live/scripts/_pro.py:100: Warning: Rows matched: 1
> > > Changed:
> > > > > 1
> > > > > > > > > Warnings: 1
> > > > > > > > > > (this is a mysql warning), but I would not think this
> is
> > > > > > > relevant...
> > > > > > > > > >
> > > > > > > > > >
> > > > > > > > > > > -----Original Message-----
> > > > > > > > > > > From: Graham Dumpleton
> > > [mailto:graham.dumpleton@gmail.com]
> > > > > > > > > > > Sent: Monday, January 21, 2008 9:22 PM
> > > > > > > > > > > To: Alec Matusis
> > > > > > > > > > > Cc: mod_python@modpython.org
> > > > > > > > > > > Subject: Re: [mod_python] remnant 'orphan' apache
> > > > > subprocesses
> > > > > > > > > > >
> > > > > > > > > > > What version of Apache are you using?
> > > > > > > > > > >
> > > > > > > > > > > What Python web application are you running on top
> of
> > > > > > > mod_python, a
> > > > > > > > > > > self built one or one that uses one of the larger
> web
> > > > > > > frameworks?
> > > > > > > > > > >
> > > > > > > > > > > Does your application create sub processes in any
> way
> > > to
> > > > > > > perform
> > > > > > > > > > > additional work?
> > > > > > > > > > >
> > > > > > > > > > > Graham
> > > > > > > > > > >
> > > > > > > > > > > On 22/01/2008, Alec Matusis <matusis@yahoo.com>
> wrote:
> > > > > > > > > > > > I have been investigating a memory leak that
> occurs
> > > on
> > > > > an
> > > > > > > apache
> > > > > > > > > > > server
> > > > > > > > > > > > since we switched to worker MPM.
> > > > > > > > > > > > I found that the source of it are apache
> subprocesses
> > > > > that
> > > > > > > lose
> > > > > > > > > track
> > > > > > > > > > > of
> > > > > > > > > > > > their parent and never exit:
> > > > > > > > > > > >
> > > > > > > > > > > > root@web10 ~> ps -ef | grep httpd
> > > > > > > > > > > > root     16197     1  0 02:00 ?        00:00:09
> > > > > > > > > > > > /usr/local/encap/httpd/bin/httpd -f
> > > > > /p2/web/conf/web10.conf -
> > > > > > > k
> > > > > > > > > start
> > > > > > > > > > > > nobody   17750     1  0 17:53 ?        00:00:00
> > > > > > > > > > > > /usr/local/encap/httpd/bin/httpd -f
> > > > > /p2/web/conf/web10.conf -
> > > > > > > k
> > > > > > > > > start
> > > > > > > > > > > > nobody    5112 16197  4 20:02 ?        00:00:16
> > > > > > > > > > > > /usr/local/encap/httpd/bin/httpd -f
> > > > > /p2/web/conf/web10.conf -
> > > > > > > k
> > > > > > > > > start
> > > > > > > > > > > > nobody    5159 16197  4 20:02 ?        00:00:15
> > > > > > > > > > > > /usr/local/encap/httpd/bin/httpd -f
> > > > > /p2/web/conf/web10.conf -
> > > > > > > k
> > > > > > > > > start
> > > > > > > > > > > > nobody    5300 16197  4 20:03 ?        00:00:14
> > > > > > > > > > > > /usr/local/encap/httpd/bin/httpd -f
> > > > > /p2/web/conf/web10.conf -
> > > > > > > k
> > > > > > > > > start
> > > > > > > > > > > >
> > > > > > > > > > > >
> > > > > > > > > > > > in this output, apache child pid 17750 has pid 1
> as a
> > > > > parent,
> > > > > > > and
> > > > > > > > > it
> > > > > > > > > > > is one
> > > > > > > > > > > > of those 'zombie children'.
> > > > > > > > > > > > Pids 5112,  5159, 5300 were normal (parent is pid
> > > 16197),
> > > > > and
> > > > > > > > > they
> > > > > > > > > > > exited
> > > > > > > > > > > > after MaxRequestsPerChild was reached.
> > > > > > > > > > > >
> > > > > > > > > > > > Does anybody have any advice on this? I cannot
> > > correlate
> > > > > this
> > > > > > > to
> > > > > > > > > > > anything,
> > > > > > > > > > > > there's nothing interesting in the server error
> log.
> > > > > > > > > > > > These 'zombies' appear at a rate of 2-3 per day;
> this
> > > > > apache
> > > > > > > > > serves
> > > > > > > > > > > about
> > > > > > > > > > > > 350 requests per second.
> > > > > > > > > > > >
> > > > > > > > > > > > This Apache configuration is
> > > > > > > > > > > >
> > > > > > > > > > > > ServerLimit 40
> > > > > > > > > > > > ThreadLimit 70
> > > > > > > > > > > >
> > > > > > > > > > > > StartServers 10
> > > > > > > > > > > > MaxClients 1600
> > > > > > > > > > > > MinSpareThreads 75
> > > > > > > > > > > > MaxSpareThreads 200
> > > > > > > > > > > > ThreadsPerChild 40
> > > > > > > > > > > > MaxRequestsPerChild 10000
> > > > > > > > > > > >
> > > > > > > > > > > >
> > > > > > > > > > > >
> > > > > > > > > > > >
> > > > > > > > > > > >
> > > > > > > > > > > > _______________________________________________
> > > > > > > > > > > > Mod_python mailing list
> > > > > > > > > > > > Mod_python@modpython.org
> > > > > > > > > > > >
> > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > > > > > > > > > > >
> > > > > > > > > >
> > > > > > > > > >
> > > > > > > >
> > > > > > > >
> > > > > >
> > > > > >
> > > >
> > > >
> >
> >

From graham.dumpleton at gmail.com  Tue Jan 22 21:35:30 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue Jan 22 21:35:39 2008
Subject: [mod_python] remnant 'orphan' apache subprocesses
In-Reply-To: <001b01c85d66$90ccd710$b2668530$@com>
References: <107401c85cb5$7eb44b00$7c1ce100$@com>
	<109001c85cbd$ed9af930$c8d0eb90$@com>
	<88e286470801212226g48f6cea7n8879ec21cb8ecae9@mail.gmail.com>
	<022701c85d5a$76334350$6299c9f0$@com>
	<88e286470801221715nf13ecf2mf862352e6ab5ec70@mail.gmail.com>
	<000301c85d5e$2f7ba340$8e72e9c0$@com>
	<88e286470801221749u3be1eccbh67e54b2a645929e8@mail.gmail.com>
	<001101c85d63$47c2bfb0$d7483f10$@com>
	<88e286470801221804t3a5294b0v9f535c9e935cb4d0@mail.gmail.com>
	<001b01c85d66$90ccd710$b2668530$@com>
Message-ID: <88e286470801221835p73059c6bi4b7e8ba114e45565@mail.gmail.com>

You may need to get stack traces from all threads:

  thread apply all bt

What this one thread shows is that some Python code in your
application is doing complicated stuff at global level in a module. In
other words, the code is being run at time of import of the module
rather than as a result of a specific request occurring.

Generally it is really bad to do stuff at time of import because the
global Python import lock is held at that time and while that is held
any other threads which want to import a module can't. This means that
if the operation being performed blocks, it will effectively block all
the other threads when they in turn need to import something. Worse is
if that first thread deadlocked in some way as it would stay that way
forever.

When moving to worker MPM did you go over your code and made sure it
was thread safe in the way it manipulated global objects in modules?
Are all the third party modules you use thread safe?

Graham

On 23/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> >   gdb /usr/bin/httpd 32427
>
> (gdb) where
> #0  0x00002aaaab2c94df in sem_wait () from /lib64/tls/libpthread.so.0
> #1  0x00002aaaac204dcd in PyThread_acquire_lock (lock=0x5b7820, waitflag=1)
> at thread_pthread.h:298
> #2  0x00002aaaac1f7008 in PyImport_ImportModuleEx (name=0x2aaaad7195c4
> "errno", globals=0x2aaaada331c0,
>     locals=<value optimized out>, fromlist=0x2aaaad75e998) at import.c:239
> #3  0x00002aaaac230883 in builtin___import__ (self=<value optimized out>,
> args=<value optimized out>) at bltinmodule.c:45
> #4  0x00002aaaac19c91c in PyCFunction_Call (func=0x2aaaad6f9440,
> arg=0x2aaab0a68c58, kw=<value optimized out>) at methodobject.c:93
> #5  0x00002aaaac177470 in PyObject_Call (func=<value optimized out>,
> arg=<value optimized out>, kw=<value optimized out>)
>     at abstract.c:1751
> #6  0x00002aaaac1cb58e in PyEval_CallObjectWithKeywords
> (func=0x2aaaad6f9440, arg=0x2aaab0a68c58, kw=0x0) at ceval.c:3419
> #7  0x00002aaaac1cda14 in PyEval_EvalFrame (f=0x8fe4e0) at ceval.c:2020
> #8  0x00002aaaac1d2d7e in PyEval_EvalCodeEx (co=0x2aaaad75fb20,
> globals=<value optimized out>, locals=<value optimized out>,
>     args=<value optimized out>, argcount=2, kws=0xb71220, kwcount=0,
> defs=0x2aaaad761e68, defcount=1, closure=0x0) at ceval.c:2730
> #9  0x00002aaaac1d0714 in PyEval_EvalFrame (f=0xb71070) at ceval.c:3639
> #10 0x00002aaaac1d26d7 in PyEval_EvalFrame (f=0xa54890) at ceval.c:3629
> #11 0x00002aaaac1d26d7 in PyEval_EvalFrame (f=0x891e10) at ceval.c:3629
> #12 0x00002aaaac1d2d7e in PyEval_EvalCodeEx (co=0x2aaab0a78f10,
> globals=<value optimized out>, locals=<value optimized out>,
>     args=<value optimized out>, argcount=4, kws=0x0, kwcount=0,
> defs=0x2aaab0a5bde8, defcount=2, closure=0x0) at ceval.c:2730
> #13 0x00002aaaac22acc7 in function_call (func=0x2aaab0aa3050,
> arg=0x2aaab0a68520, kw=0x0) at funcobject.c:548
> #14 0x00002aaaac177470 in PyObject_Call (func=<value optimized out>,
> arg=<value optimized out>, kw=<value optimized out>)
>     at abstract.c:1751
> #15 0x00002aaaac183871 in instancemethod_call (func=<value optimized out>,
> arg=0x2aaab0a68520, kw=0x0) at classobject.c:2431
> #16 0x00002aaaac177470 in PyObject_Call (func=<value optimized out>,
> arg=<value optimized out>, kw=<value optimized out>)
>     at abstract.c:1751
> #17 0x00002aaaac1cb58e in PyEval_CallObjectWithKeywords
> (func=0x2aaab00c1d20, arg=0x2aaab0aa1280, kw=0x0) at ceval.c:3419
> #18 0x00002aaaac18449e in PyInstance_New (klass=<value optimized out>,
> arg=0x2aaab0aa1280, kw=0x0) at classobject.c:575
> #19 0x00002aaaac177470 in PyObject_Call (func=<value optimized out>,
> arg=<value optimized out>, kw=<value optimized out>)
>     at abstract.c:1751
> #20 0x00002aaaac1cf5b1 in PyEval_EvalFrame (f=0x8fe7c0) at ceval.c:3755
> #21 0x00002aaaac1d2d7e in PyEval_EvalCodeEx (co=0x2aaab0a9f810,
> globals=<value optimized out>, locals=<value optimized out>,
>     args=<value optimized out>, argcount=2, kws=0x2aaaada67ec0, kwcount=0,
> defs=0x2aaab0a5a728, defcount=2, closure=0x0)
>     at ceval.c:2730
> #22 0x00002aaaac1d0714 in PyEval_EvalFrame (f=0x2aaaada67cf0) at
> ceval.c:3639
> #23 0x00002aaaac1d2d7e in PyEval_EvalCodeEx (co=0x2aaaad762880,
> globals=<value optimized out>, locals=<value optimized out>,
>     args=<value optimized out>, argcount=1, kws=0x987808, kwcount=0,
> defs=0x2aaaadc040f8, defcount=2, closure=0x0) at ceval.c:2730
> #24 0x00002aaaac1d0714 in PyEval_EvalFrame (f=0x987650) at ceval.c:3639
> #25 0x00002aaaac1d2d7e in PyEval_EvalCodeEx (co=0x2aaab00fc8f0,
> globals=<value optimized out>, locals=<value optimized out>,
>     args=<value optimized out>, argcount=1, kws=0x7c29e8, kwcount=0,
> defs=0x2aaab0095a88, defcount=2, closure=0x0) at ceval.c:2730
> #26 0x00002aaaac1d0714 in PyEval_EvalFrame (f=0x7c27b0) at ceval.c:3639
> #27 0x00002aaaac1d26d7 in PyEval_EvalFrame (f=0xb04790) at ceval.c:3629
> #28 0x00002aaaac1d2d7e in PyEval_EvalCodeEx (co=0x2aaaaec4c960,
> globals=<value optimized out>, locals=<value optimized out>,
>     args=<value optimized out>, argcount=1, kws=0x2aaaadd5cd48, kwcount=0,
> defs=0x0, defcount=0, closure=0x0) at ceval.c:2730
> #29 0x00002aaaac1d0714 in PyEval_EvalFrame (f=0x2aaaadd5cb60) at
> ceval.c:3639
> #30 0x00002aaaac1d26d7 in PyEval_EvalFrame (f=0x2aaaaddc8b90) at
> ceval.c:3629
> #31 0x00002aaaac1d2d7e in PyEval_EvalCodeEx (co=0x2aaaaec5e570,
> globals=<value optimized out>, locals=<value optimized out>,
>     args=<value optimized out>, argcount=0, kws=0x2aaaadd67568, kwcount=7,
> defs=0x0, defcount=0, closure=0x0) at ceval.c:2730
> #32 0x00002aaaac1d0714 in PyEval_EvalFrame (f=0x2aaaadd67340) at
> ceval.c:3639
> #33 0x00002aaaac1d2d7e in PyEval_EvalCodeEx (co=0x2aaaaec5e730,
> globals=<value optimized out>, locals=<value optimized out>,
>     args=<value optimized out>, argcount=2, kws=0x0, kwcount=0, defs=0x0,
> defcount=0, closure=0x0) at ceval.c:2730
> #34 0x00002aaaac22acc7 in function_call (func=0x2aaaaf50fed8,
> arg=0x2aaab0158fc8, kw=0x0) at funcobject.c:548
> #35 0x00002aaaac177470 in PyObject_Call (func=<value optimized out>,
> arg=<value optimized out>, kw=<value optimized out>)
>     at abstract.c:1751
> #36 0x00002aaaac183871 in instancemethod_call (func=<value optimized out>,
> arg=0x2aaab0158fc8, kw=0x0) at classobject.c:2431
> #37 0x00002aaaac177470 in PyObject_Call (func=<value optimized out>,
> arg=<value optimized out>, kw=<value optimized out>)
>     at abstract.c:1751
> #38 0x00002aaaac17828d in PyObject_CallMethod (o=<value optimized out>,
> name=<value optimized out>, format=0x2aaab0a63190 "\001")
>     at abstract.c:1840
> #39 0x00002aaaac17603a in python_handler (req=0x853098, phase=0x2aaaac23583f
> "PythonHandler") at mod_python.c:1652
>
> > -----Original Message-----
> > From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> > Sent: Tuesday, January 22, 2008 6:05 PM
> > To: Alec Matusis
> > Cc: mod_python@modpython.org
> > Subject: Re: [mod_python] remnant 'orphan' apache subprocesses
> >
> > As root, attach to the process by its pid and generate a full stack
> > trace.
> >
> >   gdb /usr/bin/httpd 32427
> >
> >   ...
> >
> >   $ where
> >
> > FWIW, for these processes to have a PPID of 1, then some code running
> > in the process must have tried to daemonise the process, or some
> > measure of it, for example by calling setsid(). This would
> > disassociate it with proper Apache parent process.
> >
> > Graham
> >
> > On 23/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > Here is another potentially useful cue:
> > > 32427 is this orphan process.
> > >
> > > # strace -p 32427
> > > Process 32427 attached - interrupt to quit
> > > futex(0x5b7820, FUTEX_WAIT, 0, NULL
> > >
> > > and it's just stuck there.
> > >
> > > > -----Original Message-----
> > > > From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> > > > Sent: Tuesday, January 22, 2008 5:49 PM
> > > > To: Alec Matusis
> > > > Cc: mod_python@modpython.org
> > > > Subject: Re: [mod_python] remnant 'orphan' apache subprocesses
> > > >
> > > > BTW, originally you said:
> > > >
> > > > """I have been investigating a memory leak that occurs on  an
> > apache
> > > > server
> > > > since we switched to worker MPM.
> > > > I found that the source of it are apache subprocesses that lose
> > track
> > > > of
> > > > their parent and never exit:"""
> > > >
> > > > If the processes are truly zombie processes, then they shouldn't
> > > > actually consume any resources except for the entry in the process
> > > > table. Ie., they are an process accounting artifact.
> > > >
> > > > So, strictly speaking they shouldn't be causing any memory leaks,
> > or
> > > > more correctly consuming memory which isn't released.
> > > >
> > > > Graham
> > > >
> > > > On 23/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > > > > > [Tue Jan 22 10:44:45 2008] [notice] child pid 8798 exit
> > signal
> > > > > > Segmentation
> > > > > > > fault (11)
> > > > > > > ...
> > > > > > > Fatal Python error: Inconsistent interned string state.
> > > > > >
> > > > > > This is corruption of memory used by Python.
> > > > > >
> > > > > > What version of mod_python are you using?
> > > > >
> > > > > Apache/2.2.6 (Unix) mod_python/3.3.1 Python/2.4.1
> > > > >
> > > > > But since there is only one such log entry, I'd expect at most 1
> > > > zombie as a
> > > > > result of this? I have 6.
> > > > >
> > > > > > -----Original Message-----
> > > > > > From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> > > > > > Sent: Tuesday, January 22, 2008 5:15 PM
> > > > > > To: Alec Matusis
> > > > > > Cc: mod_python@modpython.org
> > > > > > Subject: Re: [mod_python] remnant 'orphan' apache subprocesses
> > > > > >
> > > > > > On 23/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > > > > > > What do you get if you use a program like lsof or ofiles to
> > > > work
> > > > > > out
> > > > > > > > what open resources the zombie process may still be holding
> > on
> > > > to?
> > > > > > >
> > > > > > > There are 6 zombie sub processes now; executing lsof -p pid
> > takes
> > > > > > ages, and
> > > > > > > it brings the load average up from 8.0 to 23+ on this
> > machine- so
> > > > I
> > > > > > am
> > > > > > > afraid to wait long enough to get a result.
> > > > > > > #ps -ef | grep httpd
> > > > > > > root     16197     1  0 Jan21 ?        00:00:15
> > > > > > > nobody   23095 16197  0 08:44 ?        00:00:06
> > > > > > > nobody   29548     1  0 13:14 ?        00:00:00
> > > > > > > nobody    3812     1  0 13:57 ?        00:00:00
> > > > > > > nobody    4161     1  0 13:59 ?        00:00:00
> > > > > > > nobody   20110     1  0 15:43 ?        00:00:00
> > > > > > > nobody   25399     1  0 16:17 ?        00:00:00
> > > > > > > nobody   28722     1  0 16:38 ?        00:00:00
> > > > > > > nobody   28971 16197  5 16:40 ?        00:00:20
> > > > > > > nobody   29189 16197  7 16:42 ?        00:00:21
> > > > > > > nobody   29327 16197  7 16:42 ?        00:00:18
> > > > > > > nobody   29453 16197  6 16:43 ?        00:00:13
> > > > > > > nobody   29496 16197 10 16:43 ?        00:00:20
> > > > > > > nobody   29539 16197  9 16:43 ?        00:00:19
> > > > > > > nobody   29639 16197 11 16:44 ?        00:00:14
> > > > > > > nobody   29713 16197 11 16:45 ?        00:00:12
> > > > > > > nobody   29804 16197  5 16:45 ?        00:00:05
> > > > > > > nobody   29857 16197 10 16:45 ?        00:00:09
> > > > > > > nobody   29902 16197 10 16:45 ?        00:00:08
> > > > > > > nobody   29945 16197 11 16:46 ?        00:00:07
> > > > > > > nobody   29998 16197 11 16:46 ?        00:00:06
> > > > > > > nobody   30058 16197 16 16:47 ?        00:00:01
> > > > > > >
> > > > > > > note that those zombie sub processes seem to have had
> > 00:00:00
> > > > run
> > > > > > time,
> > > > > > > unlike normal sub processes.
> > > > > > > 3 entries in apache error logs this time:
> > > > > > >
> > > > > > > [Tue Jan 22 10:44:45 2008] [notice] child pid 8798 exit
> > signal
> > > > > > Segmentation
> > > > > > > fault (11)
> > > > > > > ...
> > > > > > > Fatal Python error: Inconsistent interned string state.
> > > > > >
> > > > > > This is corruption of memory used by Python.
> > > > > >
> > > > > > What version of mod_python are you using?
> > > > > >
> > > > > > > [Tue Jan 22 14:03:16 2008] [notice] child pid 4008 exit
> > signal
> > > > > > Aborted (6)
> > > > > > >
> > > > > > > is there a faster way to see what it is holding on to?
> > > > > >
> > > > > > I know you said the applications weren't spawning sub
> > processes,
> > > > but
> > > > > > if your system has 'ptree' try that. In other words, see if
> > those
> > > > > > daemon processes have children which still exist. This was in
> > part
> > > > > > what I was hoping to see, ie., pipes to child processes. The
> > other
> > > > > > thing I was looking for was stuck file accesses to NFS mounted
> > > > > > filesystems or something. Alternative to ptree is just to look
> > at
> > > > > > parent child relationships in ps output.
> > > > > >
> > > > > > Graham
> > > > > >
> > > > > > > > -----Original Message-----
> > > > > > > > From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> > > > > > > > Sent: Monday, January 21, 2008 10:27 PM
> > > > > > > > To: Alec Matusis
> > > > > > > > Cc: mod_python@modpython.org
> > > > > > > > Subject: Re: [mod_python] remnant 'orphan' apache
> > subprocesses
> > > > > > > >
> > > > > > > > What do you get if you use a program like lsof or ofiles to
> > > > work
> > > > > > out
> > > > > > > > what open resources the zombie process may still be holding
> > on
> > > > to?
> > > > > > > >
> > > > > > > > Are you absolutely sure that that zombie process is from
> > the
> > > > > > current
> > > > > > > > Apache instance and not perhaps an earlier instance of
> > Apache?
> > > > > > > >
> > > > > > > > Graham
> > > > > > > >
> > > > > > > > On 22/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > > > > > > > > Are CGI scripts used anywhere at all on your Apache web
> > > > site?
> > > > > > > > >
> > > > > > > > > No, only mod_python and serving static files.
> > > > > > > > >
> > > > > > > > > > -----Original Message-----
> > > > > > > > > > From: Graham Dumpleton
> > [mailto:graham.dumpleton@gmail.com]
> > > > > > > > > > Sent: Monday, January 21, 2008 10:07 PM
> > > > > > > > > > To: Alec Matusis
> > > > > > > > > > Cc: mod_python@modpython.org
> > > > > > > > > > Subject: Re: [mod_python] remnant 'orphan' apache
> > > > subprocesses
> > > > > > > > > >
> > > > > > > > > > Are CGI scripts used anywhere at all on your Apache web
> > > > site?
> > > > > > > > > >
> > > > > > > > > > On 22/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > > > > > > > > > > What version of Apache are you using?
> > > > > > > > > > >
> > > > > > > > > > > 2.2.6
> > > > > > > > > > >
> > > > > > > > > > > > What Python web application are you running on top
> > of
> > > > > > > > mod_python, a
> > > > > > > > > > > > self built one or one that uses one of the larger
> > web
> > > > > > > > frameworks?
> > > > > > > > > > >
> > > > > > > > > > > Only self-built stuff, nothing complicated.
> > > > > > > > > > >
> > > > > > > > > > > > Does your application create sub processes in any
> > way
> > > > to
> > > > > > > > perform
> > > > > > > > > > > > additional work?
> > > > > > > > > > >
> > > > > > > > > > > No sub processes and no threads, except that we use
> > > > MySQLdb
> > > > > > > > module
> > > > > > > > > > (which
> > > > > > > > > > > might create threads?).
> > > > > > > > > > >
> > > > > > > > > > > I noticed a warning in the error log:
> > > > > > > > > > > /live/scripts/_pro.py:100: Warning: Rows matched: 1
> > > > Changed:
> > > > > > 1
> > > > > > > > > > Warnings: 1
> > > > > > > > > > > (this is a mysql warning), but I would not think this
> > is
> > > > > > > > relevant...
> > > > > > > > > > >
> > > > > > > > > > >
> > > > > > > > > > > > -----Original Message-----
> > > > > > > > > > > > From: Graham Dumpleton
> > > > [mailto:graham.dumpleton@gmail.com]
> > > > > > > > > > > > Sent: Monday, January 21, 2008 9:22 PM
> > > > > > > > > > > > To: Alec Matusis
> > > > > > > > > > > > Cc: mod_python@modpython.org
> > > > > > > > > > > > Subject: Re: [mod_python] remnant 'orphan' apache
> > > > > > subprocesses
> > > > > > > > > > > >
> > > > > > > > > > > > What version of Apache are you using?
> > > > > > > > > > > >
> > > > > > > > > > > > What Python web application are you running on top
> > of
> > > > > > > > mod_python, a
> > > > > > > > > > > > self built one or one that uses one of the larger
> > web
> > > > > > > > frameworks?
> > > > > > > > > > > >
> > > > > > > > > > > > Does your application create sub processes in any
> > way
> > > > to
> > > > > > > > perform
> > > > > > > > > > > > additional work?
> > > > > > > > > > > >
> > > > > > > > > > > > Graham
> > > > > > > > > > > >
> > > > > > > > > > > > On 22/01/2008, Alec Matusis <matusis@yahoo.com>
> > wrote:
> > > > > > > > > > > > > I have been investigating a memory leak that
> > occurs
> > > > on
> > > > > > an
> > > > > > > > apache
> > > > > > > > > > > > server
> > > > > > > > > > > > > since we switched to worker MPM.
> > > > > > > > > > > > > I found that the source of it are apache
> > subprocesses
> > > > > > that
> > > > > > > > lose
> > > > > > > > > > track
> > > > > > > > > > > > of
> > > > > > > > > > > > > their parent and never exit:
> > > > > > > > > > > > >
> > > > > > > > > > > > > root@web10 ~> ps -ef | grep httpd
> > > > > > > > > > > > > root     16197     1  0 02:00 ?        00:00:09
> > > > > > > > > > > > > /usr/local/encap/httpd/bin/httpd -f
> > > > > > /p2/web/conf/web10.conf -
> > > > > > > > k
> > > > > > > > > > start
> > > > > > > > > > > > > nobody   17750     1  0 17:53 ?        00:00:00
> > > > > > > > > > > > > /usr/local/encap/httpd/bin/httpd -f
> > > > > > /p2/web/conf/web10.conf -
> > > > > > > > k
> > > > > > > > > > start
> > > > > > > > > > > > > nobody    5112 16197  4 20:02 ?        00:00:16
> > > > > > > > > > > > > /usr/local/encap/httpd/bin/httpd -f
> > > > > > /p2/web/conf/web10.conf -
> > > > > > > > k
> > > > > > > > > > start
> > > > > > > > > > > > > nobody    5159 16197  4 20:02 ?        00:00:15
> > > > > > > > > > > > > /usr/local/encap/httpd/bin/httpd -f
> > > > > > /p2/web/conf/web10.conf -
> > > > > > > > k
> > > > > > > > > > start
> > > > > > > > > > > > > nobody    5300 16197  4 20:03 ?        00:00:14
> > > > > > > > > > > > > /usr/local/encap/httpd/bin/httpd -f
> > > > > > /p2/web/conf/web10.conf -
> > > > > > > > k
> > > > > > > > > > start
> > > > > > > > > > > > >
> > > > > > > > > > > > >
> > > > > > > > > > > > > in this output, apache child pid 17750 has pid 1
> > as a
> > > > > > parent,
> > > > > > > > and
> > > > > > > > > > it
> > > > > > > > > > > > is one
> > > > > > > > > > > > > of those 'zombie children'.
> > > > > > > > > > > > > Pids 5112,  5159, 5300 were normal (parent is pid
> > > > 16197),
> > > > > > and
> > > > > > > > > > they
> > > > > > > > > > > > exited
> > > > > > > > > > > > > after MaxRequestsPerChild was reached.
> > > > > > > > > > > > >
> > > > > > > > > > > > > Does anybody have any advice on this? I cannot
> > > > correlate
> > > > > > this
> > > > > > > > to
> > > > > > > > > > > > anything,
> > > > > > > > > > > > > there's nothing interesting in the server error
> > log.
> > > > > > > > > > > > > These 'zombies' appear at a rate of 2-3 per day;
> > this
> > > > > > apache
> > > > > > > > > > serves
> > > > > > > > > > > > about
> > > > > > > > > > > > > 350 requests per second.
> > > > > > > > > > > > >
> > > > > > > > > > > > > This Apache configuration is
> > > > > > > > > > > > >
> > > > > > > > > > > > > ServerLimit 40
> > > > > > > > > > > > > ThreadLimit 70
> > > > > > > > > > > > >
> > > > > > > > > > > > > StartServers 10
> > > > > > > > > > > > > MaxClients 1600
> > > > > > > > > > > > > MinSpareThreads 75
> > > > > > > > > > > > > MaxSpareThreads 200
> > > > > > > > > > > > > ThreadsPerChild 40
> > > > > > > > > > > > > MaxRequestsPerChild 10000
> > > > > > > > > > > > >
> > > > > > > > > > > > >
> > > > > > > > > > > > >
> > > > > > > > > > > > >
> > > > > > > > > > > > >
> > > > > > > > > > > > > _______________________________________________
> > > > > > > > > > > > > Mod_python mailing list
> > > > > > > > > > > > > Mod_python@modpython.org
> > > > > > > > > > > > >
> > > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > > > > > > > > > > > >
> > > > > > > > > > >
> > > > > > > > > > >
> > > > > > > > >
> > > > > > > > >
> > > > > > >
> > > > > > >
> > > > >
> > > > >
> > >
> > >
>
>
From matusis at yahoo.com  Tue Jan 22 21:49:33 2008
From: matusis at yahoo.com (Alec Matusis)
Date: Tue Jan 22 21:49:46 2008
Subject: [mod_python] remnant 'orphan' apache subprocesses
In-Reply-To: <88e286470801221835p73059c6bi4b7e8ba114e45565@mail.gmail.com>
References: <107401c85cb5$7eb44b00$7c1ce100$@com>	
	<109001c85cbd$ed9af930$c8d0eb90$@com>	
	<88e286470801212226g48f6cea7n8879ec21cb8ecae9@mail.gmail.com>	
	<022701c85d5a$76334350$6299c9f0$@com>	
	<88e286470801221715nf13ecf2mf862352e6ab5ec70@mail.gmail.com>	
	<000301c85d5e$2f7ba340$8e72e9c0$@com>	
	<88e286470801221749u3be1eccbh67e54b2a645929e8@mail.gmail.com>	
	<001101c85d63$47c2bfb0$d7483f10$@com>	
	<88e286470801221804t3a5294b0v9f535c9e935cb4d0@mail.gmail.com>	
	<001b01c85d66$90ccd710$b2668530$@com>
	<88e286470801221835p73059c6bi4b7e8ba114e45565@mail.gmail.com>
Message-ID: <002601c85d6a$96f982b0$c4ec8810$@com>

> (gdb) thread apply all bt

Thread 1 (Thread 1111562592 (LWP 3812)):
#0  0x00002aaaab2c94df in sem_wait () from /lib64/tls/libpthread.so.0
#1  0x00002aaaac204dcd in PyThread_acquire_lock (lock=0x5b7820, waitflag=1)
at thread_pthread.h:298
#2  0x00002aaaac1f7008 in PyImport_ImportModuleEx (name=0x2aaaad7195c4
"errno", globals=0x2aaaada331c0, 
    locals=<value optimized out>, fromlist=0x2aaaad75e998) at import.c:239
#3  0x00002aaaac230883 in builtin___import__ (self=<value optimized out>,
args=<value optimized out>) at bltinmodule.c:45
#4  0x00002aaaac19c91c in PyCFunction_Call (func=0x2aaaad6f9440,
arg=0x2aaab0a68c58, kw=<value optimized out>) at methodobject.c:93
#5  0x00002aaaac177470 in PyObject_Call (func=<value optimized out>,
arg=<value optimized out>, kw=<value optimized out>)
    at abstract.c:1751
#6  0x00002aaaac1cb58e in PyEval_CallObjectWithKeywords
(func=0x2aaaad6f9440, arg=0x2aaab0a68c58, kw=0x0) at ceval.c:3419
#7  0x00002aaaac1cda14 in PyEval_EvalFrame (f=0x8fe4e0) at ceval.c:2020
#8  0x00002aaaac1d2d7e in PyEval_EvalCodeEx (co=0x2aaaad75fb20,
globals=<value optimized out>, locals=<value optimized out>, 
    args=<value optimized out>, argcount=2, kws=0xb71220, kwcount=0,
defs=0x2aaaad761e68, defcount=1, closure=0x0) at ceval.c:2730
#9  0x00002aaaac1d0714 in PyEval_EvalFrame (f=0xb71070) at ceval.c:3639
#10 0x00002aaaac1d26d7 in PyEval_EvalFrame (f=0xa54890) at ceval.c:3629
#11 0x00002aaaac1d26d7 in PyEval_EvalFrame (f=0x891e10) at ceval.c:3629
#12 0x00002aaaac1d2d7e in PyEval_EvalCodeEx (co=0x2aaab0a78f10,
globals=<value optimized out>, locals=<value optimized out>, 
    args=<value optimized out>, argcount=4, kws=0x0, kwcount=0,
defs=0x2aaab0a5bde8, defcount=2, closure=0x0) at ceval.c:2730
#13 0x00002aaaac22acc7 in function_call (func=0x2aaab0aa3050,
arg=0x2aaab0a68520, kw=0x0) at funcobject.c:548
#14 0x00002aaaac177470 in PyObject_Call (func=<value optimized out>,
arg=<value optimized out>, kw=<value optimized out>)
    at abstract.c:1751
#15 0x00002aaaac183871 in instancemethod_call (func=<value optimized out>,
arg=0x2aaab0a68520, kw=0x0) at classobject.c:2431
#16 0x00002aaaac177470 in PyObject_Call (func=<value optimized out>,
arg=<value optimized out>, kw=<value optimized out>)
    at abstract.c:1751
#17 0x00002aaaac1cb58e in PyEval_CallObjectWithKeywords
(func=0x2aaab00c1d20, arg=0x2aaab0aa1280, kw=0x0) at ceval.c:3419
#18 0x00002aaaac18449e in PyInstance_New (klass=<value optimized out>,
arg=0x2aaab0aa1280, kw=0x0) at classobject.c:575
#19 0x00002aaaac177470 in PyObject_Call (func=<value optimized out>,
arg=<value optimized out>, kw=<value optimized out>)
    at abstract.c:1751
#20 0x00002aaaac1cf5b1 in PyEval_EvalFrame (f=0x8fe7c0) at ceval.c:3755
#21 0x00002aaaac1d2d7e in PyEval_EvalCodeEx (co=0x2aaab0a9f810,
globals=<value optimized out>, locals=<value optimized out>, 
    args=<value optimized out>, argcount=2, kws=0x2aaaada67ec0, kwcount=0,
defs=0x2aaab0a5a728, defcount=2, closure=0x0)
    at ceval.c:2730
#22 0x00002aaaac1d0714 in PyEval_EvalFrame (f=0x2aaaada67cf0) at
ceval.c:3639
#23 0x00002aaaac1d2d7e in PyEval_EvalCodeEx (co=0x2aaaad762880,
globals=<value optimized out>, locals=<value optimized out>, 
    args=<value optimized out>, argcount=1, kws=0x987808, kwcount=0,
defs=0x2aaaadc040f8, defcount=2, closure=0x0) at ceval.c:2730
#24 0x00002aaaac1d0714 in PyEval_EvalFrame (f=0x987650) at ceval.c:3639
#25 0x00002aaaac1d2d7e in PyEval_EvalCodeEx (co=0x2aaab00fc8f0,
globals=<value optimized out>, locals=<value optimized out>, 
    args=<value optimized out>, argcount=1, kws=0x7c29e8, kwcount=0,
defs=0x2aaab0095a88, defcount=2, closure=0x0) at ceval.c:2730
#26 0x00002aaaac1d0714 in PyEval_EvalFrame (f=0x7c27b0) at ceval.c:3639
#27 0x00002aaaac1d26d7 in PyEval_EvalFrame (f=0xb04790) at ceval.c:3629
#28 0x00002aaaac1d2d7e in PyEval_EvalCodeEx (co=0x2aaaaec4c960,
globals=<value optimized out>, locals=<value optimized out>, 
    args=<value optimized out>, argcount=1, kws=0x2aaaadd5cd48, kwcount=0,
defs=0x0, defcount=0, closure=0x0) at ceval.c:2730
#29 0x00002aaaac1d0714 in PyEval_EvalFrame (f=0x2aaaadd5cb60) at
ceval.c:3639
#30 0x00002aaaac1d26d7 in PyEval_EvalFrame (f=0x2aaaaddc8b90) at
ceval.c:3629
#31 0x00002aaaac1d2d7e in PyEval_EvalCodeEx (co=0x2aaaaec5e570,
globals=<value optimized out>, locals=<value optimized out>, 
    args=<value optimized out>, argcount=0, kws=0x2aaaadd67568, kwcount=7,
defs=0x0, defcount=0, closure=0x0) at ceval.c:2730
#32 0x00002aaaac1d0714 in PyEval_EvalFrame (f=0x2aaaadd67340) at
ceval.c:3639
#33 0x00002aaaac1d2d7e in PyEval_EvalCodeEx (co=0x2aaaaec5e730,
globals=<value optimized out>, locals=<value optimized out>, 
    args=<value optimized out>, argcount=2, kws=0x0, kwcount=0, defs=0x0,
defcount=0, closure=0x0) at ceval.c:2730
#34 0x00002aaaac22acc7 in function_call (func=0x2aaaaf50fed8,
arg=0x2aaab0158fc8, kw=0x0) at funcobject.c:548
#35 0x00002aaaac177470 in PyObject_Call (func=<value optimized out>,
arg=<value optimized out>, kw=<value optimized out>)
    at abstract.c:1751
#36 0x00002aaaac183871 in instancemethod_call (func=<value optimized out>,
arg=0x2aaab0158fc8, kw=0x0) at classobject.c:2431
#37 0x00002aaaac177470 in PyObject_Call (func=<value optimized out>,
arg=<value optimized out>, kw=<value optimized out>)
    at abstract.c:1751
#38 0x00002aaaac17828d in PyObject_CallMethod (o=<value optimized out>,
name=<value optimized out>, format=0x2aaab0a63190 "\001")
    at abstract.c:1840
#39 0x00002aaaac17603a in python_handler (req=0x853098, phase=0x2aaaac23583f
"PythonHandler") at mod_python.c:1652
#40 0x00000000004328e1 in ap_run_handler (r=0x853098) at config.c:157
#41 0x00000000004359a9 in ap_invoke_handler (r=0x853098) at config.c:372
#42 0x000000000043fb2a in ap_process_request (r=0x853098) at
http_request.c:258
#43 0x000000000043d1fd in ap_process_http_connection (c=0x2aaaada478e0) at
http_core.c:184
#44 0x0000000000439621 in ap_run_process_connection (c=0x2aaaada478e0) at
connection.c:43
#45 0x00000000004443e2 in worker_thread (thd=0x5a9d20, dummy=<value
optimized out>) at worker.c:544
#46 0x00002aaaaaf7417b in dummy_worker (opaque=<value optimized out>) at
thread.c:142
#47 0x00002aaaab2c584f in start_thread () from /lib64/tls/libpthread.so.0
#48 0x00002aaaab591703 in clone () from /lib64/tls/libc.so.6
#49 0x0000000000000000 in ?? ()
#50 0x0000000000000000 in ?? ()

> When moving to worker MPM did you go over your code and made sure it
> was thread safe in the way it manipulated global objects in modules?
> Are all the third party modules you use thread safe?

We eliminated all global objects, so at least there were no errors in the
application logs.
We are using three third-party modules: MySQLdb (compiled in thread-safe
mode), PIL, and Cheetah templates.

> Generally it is really bad to do stuff at time of import because the
> global Python import lock is held at that time and while that is held
> any other threads which want to import a module can't.

I have to look into this more; we have a very simple custom importer:

def _import( module_path ):
    '''this is a custom import function. expects a dotted-notation module
name
    imports the module efficiently, pulls out the class named the same as
the module
    from the module, returns it'''
    try:
        runme = __import__( module_path, globals(), locals(), [])
        for comp in module_path.split('.')[1:]:
            runme = getattr(runme, comp)
    except ImportError,e:
        raise Exception,'Unable to load: '+module_path+'  '+str(e)

    #get the last part
    class_name = module_path.split('.')[-1]
    try:
        runme = getattr(runme, class_name )
    except AttributeError:
        raise Exception,'Module does not contain class '+class_name

    return runme

In publisher, we have:

runme = _import( module_path )
flow_instance = runme(req)
flow_instance.dispatch()
response_buffer = flow_instance.process_template()
req.send_http_header()
req.write(response_buffer)



> -----Original Message-----
> From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> Sent: Tuesday, January 22, 2008 6:36 PM
> To: Alec Matusis
> Cc: mod_python@modpython.org
> Subject: Re: [mod_python] remnant 'orphan' apache subprocesses
> 
> You may need to get stack traces from all threads:
> 
>   thread apply all bt
> 
> What this one thread shows is that some Python code in your
> application is doing complicated stuff at global level in a module. In
> other words, the code is being run at time of import of the module
> rather than as a result of a specific request occurring.
> 
> Generally it is really bad to do stuff at time of import because the
> global Python import lock is held at that time and while that is held
> any other threads which want to import a module can't. This means that
> if the operation being performed blocks, it will effectively block all
> the other threads when they in turn need to import something. Worse is
> if that first thread deadlocked in some way as it would stay that way
> forever.
> 
> When moving to worker MPM did you go over your code and made sure it
> was thread safe in the way it manipulated global objects in modules?
> Are all the third party modules you use thread safe?
> 
> Graham
> 
> On 23/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > >   gdb /usr/bin/httpd 32427
> >
> > (gdb) where
> > #0  0x00002aaaab2c94df in sem_wait () from /lib64/tls/libpthread.so.0
> > #1  0x00002aaaac204dcd in PyThread_acquire_lock (lock=0x5b7820,
> waitflag=1)
> > at thread_pthread.h:298
> > #2  0x00002aaaac1f7008 in PyImport_ImportModuleEx
> (name=0x2aaaad7195c4
> > "errno", globals=0x2aaaada331c0,
> >     locals=<value optimized out>, fromlist=0x2aaaad75e998) at
> import.c:239
> > #3  0x00002aaaac230883 in builtin___import__ (self=<value optimized
> out>,
> > args=<value optimized out>) at bltinmodule.c:45
> > #4  0x00002aaaac19c91c in PyCFunction_Call (func=0x2aaaad6f9440,
> > arg=0x2aaab0a68c58, kw=<value optimized out>) at methodobject.c:93
> > #5  0x00002aaaac177470 in PyObject_Call (func=<value optimized out>,
> > arg=<value optimized out>, kw=<value optimized out>)
> >     at abstract.c:1751
> > #6  0x00002aaaac1cb58e in PyEval_CallObjectWithKeywords
> > (func=0x2aaaad6f9440, arg=0x2aaab0a68c58, kw=0x0) at ceval.c:3419
> > #7  0x00002aaaac1cda14 in PyEval_EvalFrame (f=0x8fe4e0) at
> ceval.c:2020
> > #8  0x00002aaaac1d2d7e in PyEval_EvalCodeEx (co=0x2aaaad75fb20,
> > globals=<value optimized out>, locals=<value optimized out>,
> >     args=<value optimized out>, argcount=2, kws=0xb71220, kwcount=0,
> > defs=0x2aaaad761e68, defcount=1, closure=0x0) at ceval.c:2730
> > #9  0x00002aaaac1d0714 in PyEval_EvalFrame (f=0xb71070) at
> ceval.c:3639
> > #10 0x00002aaaac1d26d7 in PyEval_EvalFrame (f=0xa54890) at
> ceval.c:3629
> > #11 0x00002aaaac1d26d7 in PyEval_EvalFrame (f=0x891e10) at
> ceval.c:3629
> > #12 0x00002aaaac1d2d7e in PyEval_EvalCodeEx (co=0x2aaab0a78f10,
> > globals=<value optimized out>, locals=<value optimized out>,
> >     args=<value optimized out>, argcount=4, kws=0x0, kwcount=0,
> > defs=0x2aaab0a5bde8, defcount=2, closure=0x0) at ceval.c:2730
> > #13 0x00002aaaac22acc7 in function_call (func=0x2aaab0aa3050,
> > arg=0x2aaab0a68520, kw=0x0) at funcobject.c:548
> > #14 0x00002aaaac177470 in PyObject_Call (func=<value optimized out>,
> > arg=<value optimized out>, kw=<value optimized out>)
> >     at abstract.c:1751
> > #15 0x00002aaaac183871 in instancemethod_call (func=<value optimized
> out>,
> > arg=0x2aaab0a68520, kw=0x0) at classobject.c:2431
> > #16 0x00002aaaac177470 in PyObject_Call (func=<value optimized out>,
> > arg=<value optimized out>, kw=<value optimized out>)
> >     at abstract.c:1751
> > #17 0x00002aaaac1cb58e in PyEval_CallObjectWithKeywords
> > (func=0x2aaab00c1d20, arg=0x2aaab0aa1280, kw=0x0) at ceval.c:3419
> > #18 0x00002aaaac18449e in PyInstance_New (klass=<value optimized
> out>,
> > arg=0x2aaab0aa1280, kw=0x0) at classobject.c:575
> > #19 0x00002aaaac177470 in PyObject_Call (func=<value optimized out>,
> > arg=<value optimized out>, kw=<value optimized out>)
> >     at abstract.c:1751
> > #20 0x00002aaaac1cf5b1 in PyEval_EvalFrame (f=0x8fe7c0) at
> ceval.c:3755
> > #21 0x00002aaaac1d2d7e in PyEval_EvalCodeEx (co=0x2aaab0a9f810,
> > globals=<value optimized out>, locals=<value optimized out>,
> >     args=<value optimized out>, argcount=2, kws=0x2aaaada67ec0,
> kwcount=0,
> > defs=0x2aaab0a5a728, defcount=2, closure=0x0)
> >     at ceval.c:2730
> > #22 0x00002aaaac1d0714 in PyEval_EvalFrame (f=0x2aaaada67cf0) at
> > ceval.c:3639
> > #23 0x00002aaaac1d2d7e in PyEval_EvalCodeEx (co=0x2aaaad762880,
> > globals=<value optimized out>, locals=<value optimized out>,
> >     args=<value optimized out>, argcount=1, kws=0x987808, kwcount=0,
> > defs=0x2aaaadc040f8, defcount=2, closure=0x0) at ceval.c:2730
> > #24 0x00002aaaac1d0714 in PyEval_EvalFrame (f=0x987650) at
> ceval.c:3639
> > #25 0x00002aaaac1d2d7e in PyEval_EvalCodeEx (co=0x2aaab00fc8f0,
> > globals=<value optimized out>, locals=<value optimized out>,
> >     args=<value optimized out>, argcount=1, kws=0x7c29e8, kwcount=0,
> > defs=0x2aaab0095a88, defcount=2, closure=0x0) at ceval.c:2730
> > #26 0x00002aaaac1d0714 in PyEval_EvalFrame (f=0x7c27b0) at
> ceval.c:3639
> > #27 0x00002aaaac1d26d7 in PyEval_EvalFrame (f=0xb04790) at
> ceval.c:3629
> > #28 0x00002aaaac1d2d7e in PyEval_EvalCodeEx (co=0x2aaaaec4c960,
> > globals=<value optimized out>, locals=<value optimized out>,
> >     args=<value optimized out>, argcount=1, kws=0x2aaaadd5cd48,
> kwcount=0,
> > defs=0x0, defcount=0, closure=0x0) at ceval.c:2730
> > #29 0x00002aaaac1d0714 in PyEval_EvalFrame (f=0x2aaaadd5cb60) at
> > ceval.c:3639
> > #30 0x00002aaaac1d26d7 in PyEval_EvalFrame (f=0x2aaaaddc8b90) at
> > ceval.c:3629
> > #31 0x00002aaaac1d2d7e in PyEval_EvalCodeEx (co=0x2aaaaec5e570,
> > globals=<value optimized out>, locals=<value optimized out>,
> >     args=<value optimized out>, argcount=0, kws=0x2aaaadd67568,
> kwcount=7,
> > defs=0x0, defcount=0, closure=0x0) at ceval.c:2730
> > #32 0x00002aaaac1d0714 in PyEval_EvalFrame (f=0x2aaaadd67340) at
> > ceval.c:3639
> > #33 0x00002aaaac1d2d7e in PyEval_EvalCodeEx (co=0x2aaaaec5e730,
> > globals=<value optimized out>, locals=<value optimized out>,
> >     args=<value optimized out>, argcount=2, kws=0x0, kwcount=0,
> defs=0x0,
> > defcount=0, closure=0x0) at ceval.c:2730
> > #34 0x00002aaaac22acc7 in function_call (func=0x2aaaaf50fed8,
> > arg=0x2aaab0158fc8, kw=0x0) at funcobject.c:548
> > #35 0x00002aaaac177470 in PyObject_Call (func=<value optimized out>,
> > arg=<value optimized out>, kw=<value optimized out>)
> >     at abstract.c:1751
> > #36 0x00002aaaac183871 in instancemethod_call (func=<value optimized
> out>,
> > arg=0x2aaab0158fc8, kw=0x0) at classobject.c:2431
> > #37 0x00002aaaac177470 in PyObject_Call (func=<value optimized out>,
> > arg=<value optimized out>, kw=<value optimized out>)
> >     at abstract.c:1751
> > #38 0x00002aaaac17828d in PyObject_CallMethod (o=<value optimized
> out>,
> > name=<value optimized out>, format=0x2aaab0a63190 "\001")
> >     at abstract.c:1840
> > #39 0x00002aaaac17603a in python_handler (req=0x853098,
> phase=0x2aaaac23583f
> > "PythonHandler") at mod_python.c:1652
> >
> > > -----Original Message-----
> > > From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> > > Sent: Tuesday, January 22, 2008 6:05 PM
> > > To: Alec Matusis
> > > Cc: mod_python@modpython.org
> > > Subject: Re: [mod_python] remnant 'orphan' apache subprocesses
> > >
> > > As root, attach to the process by its pid and generate a full stack
> > > trace.
> > >
> > >   gdb /usr/bin/httpd 32427
> > >
> > >   ...
> > >
> > >   $ where
> > >
> > > FWIW, for these processes to have a PPID of 1, then some code
> running
> > > in the process must have tried to daemonise the process, or some
> > > measure of it, for example by calling setsid(). This would
> > > disassociate it with proper Apache parent process.
> > >
> > > Graham
> > >
> > > On 23/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > > Here is another potentially useful cue:
> > > > 32427 is this orphan process.
> > > >
> > > > # strace -p 32427
> > > > Process 32427 attached - interrupt to quit
> > > > futex(0x5b7820, FUTEX_WAIT, 0, NULL
> > > >
> > > > and it's just stuck there.
> > > >
> > > > > -----Original Message-----
> > > > > From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> > > > > Sent: Tuesday, January 22, 2008 5:49 PM
> > > > > To: Alec Matusis
> > > > > Cc: mod_python@modpython.org
> > > > > Subject: Re: [mod_python] remnant 'orphan' apache subprocesses
> > > > >
> > > > > BTW, originally you said:
> > > > >
> > > > > """I have been investigating a memory leak that occurs on  an
> > > apache
> > > > > server
> > > > > since we switched to worker MPM.
> > > > > I found that the source of it are apache subprocesses that lose
> > > track
> > > > > of
> > > > > their parent and never exit:"""
> > > > >
> > > > > If the processes are truly zombie processes, then they
> shouldn't
> > > > > actually consume any resources except for the entry in the
> process
> > > > > table. Ie., they are an process accounting artifact.
> > > > >
> > > > > So, strictly speaking they shouldn't be causing any memory
> leaks,
> > > or
> > > > > more correctly consuming memory which isn't released.
> > > > >
> > > > > Graham
> > > > >
> > > > > On 23/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > > > > > > [Tue Jan 22 10:44:45 2008] [notice] child pid 8798 exit
> > > signal
> > > > > > > Segmentation
> > > > > > > > fault (11)
> > > > > > > > ...
> > > > > > > > Fatal Python error: Inconsistent interned string state.
> > > > > > >
> > > > > > > This is corruption of memory used by Python.
> > > > > > >
> > > > > > > What version of mod_python are you using?
> > > > > >
> > > > > > Apache/2.2.6 (Unix) mod_python/3.3.1 Python/2.4.1
> > > > > >
> > > > > > But since there is only one such log entry, I'd expect at
> most 1
> > > > > zombie as a
> > > > > > result of this? I have 6.
> > > > > >
> > > > > > > -----Original Message-----
> > > > > > > From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> > > > > > > Sent: Tuesday, January 22, 2008 5:15 PM
> > > > > > > To: Alec Matusis
> > > > > > > Cc: mod_python@modpython.org
> > > > > > > Subject: Re: [mod_python] remnant 'orphan' apache
> subprocesses
> > > > > > >
> > > > > > > On 23/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > > > > > > > What do you get if you use a program like lsof or
> ofiles to
> > > > > work
> > > > > > > out
> > > > > > > > > what open resources the zombie process may still be
> holding
> > > on
> > > > > to?
> > > > > > > >
> > > > > > > > There are 6 zombie sub processes now; executing lsof -p
> pid
> > > takes
> > > > > > > ages, and
> > > > > > > > it brings the load average up from 8.0 to 23+ on this
> > > machine- so
> > > > > I
> > > > > > > am
> > > > > > > > afraid to wait long enough to get a result.
> > > > > > > > #ps -ef | grep httpd
> > > > > > > > root     16197     1  0 Jan21 ?        00:00:15
> > > > > > > > nobody   23095 16197  0 08:44 ?        00:00:06
> > > > > > > > nobody   29548     1  0 13:14 ?        00:00:00
> > > > > > > > nobody    3812     1  0 13:57 ?        00:00:00
> > > > > > > > nobody    4161     1  0 13:59 ?        00:00:00
> > > > > > > > nobody   20110     1  0 15:43 ?        00:00:00
> > > > > > > > nobody   25399     1  0 16:17 ?        00:00:00
> > > > > > > > nobody   28722     1  0 16:38 ?        00:00:00
> > > > > > > > nobody   28971 16197  5 16:40 ?        00:00:20
> > > > > > > > nobody   29189 16197  7 16:42 ?        00:00:21
> > > > > > > > nobody   29327 16197  7 16:42 ?        00:00:18
> > > > > > > > nobody   29453 16197  6 16:43 ?        00:00:13
> > > > > > > > nobody   29496 16197 10 16:43 ?        00:00:20
> > > > > > > > nobody   29539 16197  9 16:43 ?        00:00:19
> > > > > > > > nobody   29639 16197 11 16:44 ?        00:00:14
> > > > > > > > nobody   29713 16197 11 16:45 ?        00:00:12
> > > > > > > > nobody   29804 16197  5 16:45 ?        00:00:05
> > > > > > > > nobody   29857 16197 10 16:45 ?        00:00:09
> > > > > > > > nobody   29902 16197 10 16:45 ?        00:00:08
> > > > > > > > nobody   29945 16197 11 16:46 ?        00:00:07
> > > > > > > > nobody   29998 16197 11 16:46 ?        00:00:06
> > > > > > > > nobody   30058 16197 16 16:47 ?        00:00:01
> > > > > > > >
> > > > > > > > note that those zombie sub processes seem to have had
> > > 00:00:00
> > > > > run
> > > > > > > time,
> > > > > > > > unlike normal sub processes.
> > > > > > > > 3 entries in apache error logs this time:
> > > > > > > >
> > > > > > > > [Tue Jan 22 10:44:45 2008] [notice] child pid 8798 exit
> > > signal
> > > > > > > Segmentation
> > > > > > > > fault (11)
> > > > > > > > ...
> > > > > > > > Fatal Python error: Inconsistent interned string state.
> > > > > > >
> > > > > > > This is corruption of memory used by Python.
> > > > > > >
> > > > > > > What version of mod_python are you using?
> > > > > > >
> > > > > > > > [Tue Jan 22 14:03:16 2008] [notice] child pid 4008 exit
> > > signal
> > > > > > > Aborted (6)
> > > > > > > >
> > > > > > > > is there a faster way to see what it is holding on to?
> > > > > > >
> > > > > > > I know you said the applications weren't spawning sub
> > > processes,
> > > > > but
> > > > > > > if your system has 'ptree' try that. In other words, see if
> > > those
> > > > > > > daemon processes have children which still exist. This was
> in
> > > part
> > > > > > > what I was hoping to see, ie., pipes to child processes.
> The
> > > other
> > > > > > > thing I was looking for was stuck file accesses to NFS
> mounted
> > > > > > > filesystems or something. Alternative to ptree is just to
> look
> > > at
> > > > > > > parent child relationships in ps output.
> > > > > > >
> > > > > > > Graham
> > > > > > >
> > > > > > > > > -----Original Message-----
> > > > > > > > > From: Graham Dumpleton
> [mailto:graham.dumpleton@gmail.com]
> > > > > > > > > Sent: Monday, January 21, 2008 10:27 PM
> > > > > > > > > To: Alec Matusis
> > > > > > > > > Cc: mod_python@modpython.org
> > > > > > > > > Subject: Re: [mod_python] remnant 'orphan' apache
> > > subprocesses
> > > > > > > > >
> > > > > > > > > What do you get if you use a program like lsof or
> ofiles to
> > > > > work
> > > > > > > out
> > > > > > > > > what open resources the zombie process may still be
> holding
> > > on
> > > > > to?
> > > > > > > > >
> > > > > > > > > Are you absolutely sure that that zombie process is
> from
> > > the
> > > > > > > current
> > > > > > > > > Apache instance and not perhaps an earlier instance of
> > > Apache?
> > > > > > > > >
> > > > > > > > > Graham
> > > > > > > > >
> > > > > > > > > On 22/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > > > > > > > > > Are CGI scripts used anywhere at all on your Apache
> web
> > > > > site?
> > > > > > > > > >
> > > > > > > > > > No, only mod_python and serving static files.
> > > > > > > > > >
> > > > > > > > > > > -----Original Message-----
> > > > > > > > > > > From: Graham Dumpleton
> > > [mailto:graham.dumpleton@gmail.com]
> > > > > > > > > > > Sent: Monday, January 21, 2008 10:07 PM
> > > > > > > > > > > To: Alec Matusis
> > > > > > > > > > > Cc: mod_python@modpython.org
> > > > > > > > > > > Subject: Re: [mod_python] remnant 'orphan' apache
> > > > > subprocesses
> > > > > > > > > > >
> > > > > > > > > > > Are CGI scripts used anywhere at all on your Apache
> web
> > > > > site?
> > > > > > > > > > >
> > > > > > > > > > > On 22/01/2008, Alec Matusis <matusis@yahoo.com>
> wrote:
> > > > > > > > > > > > > What version of Apache are you using?
> > > > > > > > > > > >
> > > > > > > > > > > > 2.2.6
> > > > > > > > > > > >
> > > > > > > > > > > > > What Python web application are you running on
> top
> > > of
> > > > > > > > > mod_python, a
> > > > > > > > > > > > > self built one or one that uses one of the
> larger
> > > web
> > > > > > > > > frameworks?
> > > > > > > > > > > >
> > > > > > > > > > > > Only self-built stuff, nothing complicated.
> > > > > > > > > > > >
> > > > > > > > > > > > > Does your application create sub processes in
> any
> > > way
> > > > > to
> > > > > > > > > perform
> > > > > > > > > > > > > additional work?
> > > > > > > > > > > >
> > > > > > > > > > > > No sub processes and no threads, except that we
> use
> > > > > MySQLdb
> > > > > > > > > module
> > > > > > > > > > > (which
> > > > > > > > > > > > might create threads?).
> > > > > > > > > > > >
> > > > > > > > > > > > I noticed a warning in the error log:
> > > > > > > > > > > > /live/scripts/_pro.py:100: Warning: Rows matched:
> 1
> > > > > Changed:
> > > > > > > 1
> > > > > > > > > > > Warnings: 1
> > > > > > > > > > > > (this is a mysql warning), but I would not think
> this
> > > is
> > > > > > > > > relevant...
> > > > > > > > > > > >
> > > > > > > > > > > >
> > > > > > > > > > > > > -----Original Message-----
> > > > > > > > > > > > > From: Graham Dumpleton
> > > > > [mailto:graham.dumpleton@gmail.com]
> > > > > > > > > > > > > Sent: Monday, January 21, 2008 9:22 PM
> > > > > > > > > > > > > To: Alec Matusis
> > > > > > > > > > > > > Cc: mod_python@modpython.org
> > > > > > > > > > > > > Subject: Re: [mod_python] remnant 'orphan'
> apache
> > > > > > > subprocesses
> > > > > > > > > > > > >
> > > > > > > > > > > > > What version of Apache are you using?
> > > > > > > > > > > > >
> > > > > > > > > > > > > What Python web application are you running on
> top
> > > of
> > > > > > > > > mod_python, a
> > > > > > > > > > > > > self built one or one that uses one of the
> larger
> > > web
> > > > > > > > > frameworks?
> > > > > > > > > > > > >
> > > > > > > > > > > > > Does your application create sub processes in
> any
> > > way
> > > > > to
> > > > > > > > > perform
> > > > > > > > > > > > > additional work?
> > > > > > > > > > > > >
> > > > > > > > > > > > > Graham
> > > > > > > > > > > > >
> > > > > > > > > > > > > On 22/01/2008, Alec Matusis <matusis@yahoo.com>
> > > wrote:
> > > > > > > > > > > > > > I have been investigating a memory leak that
> > > occurs
> > > > > on
> > > > > > > an
> > > > > > > > > apache
> > > > > > > > > > > > > server
> > > > > > > > > > > > > > since we switched to worker MPM.
> > > > > > > > > > > > > > I found that the source of it are apache
> > > subprocesses
> > > > > > > that
> > > > > > > > > lose
> > > > > > > > > > > track
> > > > > > > > > > > > > of
> > > > > > > > > > > > > > their parent and never exit:
> > > > > > > > > > > > > >
> > > > > > > > > > > > > > root@web10 ~> ps -ef | grep httpd
> > > > > > > > > > > > > > root     16197     1  0 02:00 ?
> 00:00:09
> > > > > > > > > > > > > > /usr/local/encap/httpd/bin/httpd -f
> > > > > > > /p2/web/conf/web10.conf -
> > > > > > > > > k
> > > > > > > > > > > start
> > > > > > > > > > > > > > nobody   17750     1  0 17:53 ?
> 00:00:00
> > > > > > > > > > > > > > /usr/local/encap/httpd/bin/httpd -f
> > > > > > > /p2/web/conf/web10.conf -
> > > > > > > > > k
> > > > > > > > > > > start
> > > > > > > > > > > > > > nobody    5112 16197  4 20:02 ?
> 00:00:16
> > > > > > > > > > > > > > /usr/local/encap/httpd/bin/httpd -f
> > > > > > > /p2/web/conf/web10.conf -
> > > > > > > > > k
> > > > > > > > > > > start
> > > > > > > > > > > > > > nobody    5159 16197  4 20:02 ?
> 00:00:15
> > > > > > > > > > > > > > /usr/local/encap/httpd/bin/httpd -f
> > > > > > > /p2/web/conf/web10.conf -
> > > > > > > > > k
> > > > > > > > > > > start
> > > > > > > > > > > > > > nobody    5300 16197  4 20:03 ?
> 00:00:14
> > > > > > > > > > > > > > /usr/local/encap/httpd/bin/httpd -f
> > > > > > > /p2/web/conf/web10.conf -
> > > > > > > > > k
> > > > > > > > > > > start
> > > > > > > > > > > > > >
> > > > > > > > > > > > > >
> > > > > > > > > > > > > > in this output, apache child pid 17750 has
> pid 1
> > > as a
> > > > > > > parent,
> > > > > > > > > and
> > > > > > > > > > > it
> > > > > > > > > > > > > is one
> > > > > > > > > > > > > > of those 'zombie children'.
> > > > > > > > > > > > > > Pids 5112,  5159, 5300 were normal (parent is
> pid
> > > > > 16197),
> > > > > > > and
> > > > > > > > > > > they
> > > > > > > > > > > > > exited
> > > > > > > > > > > > > > after MaxRequestsPerChild was reached.
> > > > > > > > > > > > > >
> > > > > > > > > > > > > > Does anybody have any advice on this? I
> cannot
> > > > > correlate
> > > > > > > this
> > > > > > > > > to
> > > > > > > > > > > > > anything,
> > > > > > > > > > > > > > there's nothing interesting in the server
> error
> > > log.
> > > > > > > > > > > > > > These 'zombies' appear at a rate of 2-3 per
> day;
> > > this
> > > > > > > apache
> > > > > > > > > > > serves
> > > > > > > > > > > > > about
> > > > > > > > > > > > > > 350 requests per second.
> > > > > > > > > > > > > >
> > > > > > > > > > > > > > This Apache configuration is
> > > > > > > > > > > > > >
> > > > > > > > > > > > > > ServerLimit 40
> > > > > > > > > > > > > > ThreadLimit 70
> > > > > > > > > > > > > >
> > > > > > > > > > > > > > StartServers 10
> > > > > > > > > > > > > > MaxClients 1600
> > > > > > > > > > > > > > MinSpareThreads 75
> > > > > > > > > > > > > > MaxSpareThreads 200
> > > > > > > > > > > > > > ThreadsPerChild 40
> > > > > > > > > > > > > > MaxRequestsPerChild 10000
> > > > > > > > > > > > > >
> > > > > > > > > > > > > >
> > > > > > > > > > > > > >
> > > > > > > > > > > > > >
> > > > > > > > > > > > > >
> > > > > > > > > > > > > >
> _______________________________________________
> > > > > > > > > > > > > > Mod_python mailing list
> > > > > > > > > > > > > > Mod_python@modpython.org
> > > > > > > > > > > > > >
> > > > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > > > > > > > > > > > > >
> > > > > > > > > > > >
> > > > > > > > > > > >
> > > > > > > > > >
> > > > > > > > > >
> > > > > > > >
> > > > > > > >
> > > > > >
> > > > > >
> > > >
> > > >
> >
> >

From graham.dumpleton at gmail.com  Tue Jan 22 22:00:08 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue Jan 22 22:00:15 2008
Subject: [mod_python] remnant 'orphan' apache subprocesses
In-Reply-To: <002601c85d6a$96f982b0$c4ec8810$@com>
References: <107401c85cb5$7eb44b00$7c1ce100$@com>
	<022701c85d5a$76334350$6299c9f0$@com>
	<88e286470801221715nf13ecf2mf862352e6ab5ec70@mail.gmail.com>
	<000301c85d5e$2f7ba340$8e72e9c0$@com>
	<88e286470801221749u3be1eccbh67e54b2a645929e8@mail.gmail.com>
	<001101c85d63$47c2bfb0$d7483f10$@com>
	<88e286470801221804t3a5294b0v9f535c9e935cb4d0@mail.gmail.com>
	<001b01c85d66$90ccd710$b2668530$@com>
	<88e286470801221835p73059c6bi4b7e8ba114e45565@mail.gmail.com>
	<002601c85d6a$96f982b0$c4ec8810$@com>
Message-ID: <88e286470801221900y38ea415cta2d15fd78b0f66d8@mail.gmail.com>

On 23/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > (gdb) thread apply all bt
>
> Thread 1 (Thread 1111562592 (LWP 3812)):
> #0  0x00002aaaab2c94df in sem_wait () from /lib64/tls/libpthread.so.0
> #1  0x00002aaaac204dcd in PyThread_acquire_lock (lock=0x5b7820, waitflag=1)

Hmmm, there should have been 39 other stack traces, one for each
worker thread based on your Apache configuration.

Don't necessarily post them all, but you should look and see what is
in frame #0 for all of them and see if there is anything odd such as
one blocking in a call out to some external C library. If no such
thing and they are all stuck on Python mutex locks, then must be
internal deadlock.

This still doesn't explain though how the process has been associated
with PPID of 1, which would  still only seem possible if something had
tried to daemonise process.

Graham

Graham
From matusis at yahoo.com  Tue Jan 22 22:12:31 2008
From: matusis at yahoo.com (Alec Matusis)
Date: Tue Jan 22 22:12:38 2008
Subject: [mod_python] remnant 'orphan' apache subprocesses
In-Reply-To: <88e286470801221900y38ea415cta2d15fd78b0f66d8@mail.gmail.com>
References: <107401c85cb5$7eb44b00$7c1ce100$@com>	
	<022701c85d5a$76334350$6299c9f0$@com>	
	<88e286470801221715nf13ecf2mf862352e6ab5ec70@mail.gmail.com>	
	<000301c85d5e$2f7ba340$8e72e9c0$@com>	
	<88e286470801221749u3be1eccbh67e54b2a645929e8@mail.gmail.com>	
	<001101c85d63$47c2bfb0$d7483f10$@com>	
	<88e286470801221804t3a5294b0v9f535c9e935cb4d0@mail.gmail.com>	
	<001b01c85d66$90ccd710$b2668530$@com>	
	<88e286470801221835p73059c6bi4b7e8ba114e45565@mail.gmail.com>	
	<002601c85d6a$96f982b0$c4ec8810$@com>
	<88e286470801221900y38ea415cta2d15fd78b0f66d8@mail.gmail.com>
Message-ID: <003601c85d6d$cb593a20$620bae60$@com>

> Hmmm, there should have been 39 other stack traces, one for each
> worker thread based on your Apache configuration.
>

That puzzled me too. I could not get other threads from gdb...

> -----Original Message-----
> From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> Sent: Tuesday, January 22, 2008 7:00 PM
> To: Alec Matusis
> Cc: mod_python@modpython.org
> Subject: Re: [mod_python] remnant 'orphan' apache subprocesses
> 
> On 23/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > (gdb) thread apply all bt
> >
> > Thread 1 (Thread 1111562592 (LWP 3812)):
> > #0  0x00002aaaab2c94df in sem_wait () from /lib64/tls/libpthread.so.0
> > #1  0x00002aaaac204dcd in PyThread_acquire_lock (lock=0x5b7820,
> waitflag=1)
> 
> Hmmm, there should have been 39 other stack traces, one for each
> worker thread based on your Apache configuration.
> 
> Don't necessarily post them all, but you should look and see what is
> in frame #0 for all of them and see if there is anything odd such as
> one blocking in a call out to some external C library. If no such
> thing and they are all stuck on Python mutex locks, then must be
> internal deadlock.
> 
> This still doesn't explain though how the process has been associated
> with PPID of 1, which would  still only seem possible if something had
> tried to daemonise process.
> 
> Graham
> 
> Graham

From matusis at yahoo.com  Tue Jan 22 22:22:28 2008
From: matusis at yahoo.com (Alec Matusis)
Date: Tue Jan 22 22:22:36 2008
Subject: [mod_python] remnant 'orphan' apache subprocesses
In-Reply-To: <88e286470801221900y38ea415cta2d15fd78b0f66d8@mail.gmail.com>
References: <107401c85cb5$7eb44b00$7c1ce100$@com>	
	<022701c85d5a$76334350$6299c9f0$@com>	
	<88e286470801221715nf13ecf2mf862352e6ab5ec70@mail.gmail.com>	
	<000301c85d5e$2f7ba340$8e72e9c0$@com>	
	<88e286470801221749u3be1eccbh67e54b2a645929e8@mail.gmail.com>	
	<001101c85d63$47c2bfb0$d7483f10$@com>	
	<88e286470801221804t3a5294b0v9f535c9e935cb4d0@mail.gmail.com>	
	<001b01c85d66$90ccd710$b2668530$@com>	
	<88e286470801221835p73059c6bi4b7e8ba114e45565@mail.gmail.com>	
	<002601c85d6a$96f982b0$c4ec8810$@com>
	<88e286470801221900y38ea415cta2d15fd78b0f66d8@mail.gmail.com>
Message-ID: <003a01c85d6f$2f333fe0$8d99bfa0$@com>

> Hmmm, there should have been 39 other stack traces, one for each
> worker thread based on your Apache configuration.

Looks like it has only one thread:

Orphaned sub process:

# ps -mTp 3812
  PID  SPID TTY          TIME CMD
 3812     - ?        00:00:00 httpd
    -  3812 -        00:00:00 -

Normal sub-process:

# ps -mTp 20205
  PID  SPID TTY          TIME CMD
20205     - ?        00:00:10 httpd
    - 20205 -        00:00:00 -
    - 20207 -        00:00:00 -
    - 20208 -        00:00:00 -
    - 20209 -        00:00:00 -
    - 20210 -        00:00:00 -
    - 20211 -        00:00:00 -
    - 20212 -        00:00:00 -
    - 20213 -        00:00:00 -
    - 20214 -        00:00:00 -
    - 20215 -        00:00:00 -
    - 20216 -        00:00:00 -
    - 20217 -        00:00:00 -
    - 20218 -        00:00:00 -
    - 20219 -        00:00:00 -
    - 20220 -        00:00:00 -
    - 20221 -        00:00:00 -
    - 20222 -        00:00:00 -
    - 20223 -        00:00:00 -
    - 20224 -        00:00:00 -
    - 20225 -        00:00:00 -
    - 20226 -        00:00:00 -
    - 20227 -        00:00:00 -
    - 20228 -        00:00:00 -
    - 20229 -        00:00:00 -
    - 20230 -        00:00:00 -
    - 20231 -        00:00:00 -
    - 20232 -        00:00:00 -
    - 20233 -        00:00:00 -
    - 20234 -        00:00:00 -
    - 20235 -        00:00:00 -
    - 20236 -        00:00:00 -
    - 20237 -        00:00:00 -
    - 20238 -        00:00:00 -
    - 20239 -        00:00:00 -
    - 20240 -        00:00:00 -
    - 20241 -        00:00:00 -
    - 20242 -        00:00:00 -
    - 20243 -        00:00:00 -
    - 20244 -        00:00:00 -
    - 20245 -        00:00:00 -
    - 20246 -        00:00:00 -
    - 20247 -        00:00:00 -


> -----Original Message-----
> From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> Sent: Tuesday, January 22, 2008 7:00 PM
> To: Alec Matusis
> Cc: mod_python@modpython.org
> Subject: Re: [mod_python] remnant 'orphan' apache subprocesses
> 
> On 23/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > (gdb) thread apply all bt
> >
> > Thread 1 (Thread 1111562592 (LWP 3812)):
> > #0  0x00002aaaab2c94df in sem_wait () from /lib64/tls/libpthread.so.0
> > #1  0x00002aaaac204dcd in PyThread_acquire_lock (lock=0x5b7820,
> waitflag=1)
> 
> Hmmm, there should have been 39 other stack traces, one for each
> worker thread based on your Apache configuration.
> 
> Don't necessarily post them all, but you should look and see what is
> in frame #0 for all of them and see if there is anything odd such as
> one blocking in a call out to some external C library. If no such
> thing and they are all stuck on Python mutex locks, then must be
> internal deadlock.
> 
> This still doesn't explain though how the process has been associated
> with PPID of 1, which would  still only seem possible if something had
> tried to daemonise process.
> 
> Graham
> 
> Graham

From graham.dumpleton at gmail.com  Tue Jan 22 23:36:22 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue Jan 22 23:36:30 2008
Subject: [mod_python] remnant 'orphan' apache subprocesses
In-Reply-To: <003a01c85d6f$2f333fe0$8d99bfa0$@com>
References: <107401c85cb5$7eb44b00$7c1ce100$@com>
	<000301c85d5e$2f7ba340$8e72e9c0$@com>
	<88e286470801221749u3be1eccbh67e54b2a645929e8@mail.gmail.com>
	<001101c85d63$47c2bfb0$d7483f10$@com>
	<88e286470801221804t3a5294b0v9f535c9e935cb4d0@mail.gmail.com>
	<001b01c85d66$90ccd710$b2668530$@com>
	<88e286470801221835p73059c6bi4b7e8ba114e45565@mail.gmail.com>
	<002601c85d6a$96f982b0$c4ec8810$@com>
	<88e286470801221900y38ea415cta2d15fd78b0f66d8@mail.gmail.com>
	<003a01c85d6f$2f333fe0$8d99bfa0$@com>
Message-ID: <88e286470801222036v243707c4q40ee44432c2cfae@mail.gmail.com>

On 23/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > Hmmm, there should have been 39 other stack traces, one for each
> > worker thread based on your Apache configuration.
>
> Looks like it has only one thread:

Which almost suggests it was actually a fork of an Apache child
process as that is possibly only way the other threads could have been
killed off. This would sort of sit with idea that some code had tried
to further fork and daemonise the process. This is the only thing that
seems to fit at the moment.

I can't find though any evidence of fork() being used direct in PIL
code at least, but then the popen2 module uses fork() in Popen3 and
Popen4 classes. Again, PIL, although it uses os.popen() doesn't use
popen2 module. Also, that doesn't involved setsid(). The only place in
standard Python modules that appears to use setsid() is pty.fork() and
PIL doesn't use that.

All I can suggest is you might in your loaded application dump out
sys.modules and see if anything has imported pty module. Otherwise
troll through all the Python code you know is used and see if anything
for whatever reason uses fork(), setsid(), popen2 module, or
pty.fork(). More nasty would be a C extension module doing forks and
trying to do Python stuff in forked process but not doing necessary
Python cleanup after the fork. Would have expected to see a C
extension module stack frame in traceback if that was the case though.

Anyway, running out of ideas.

Graham

> Orphaned sub process:
>
> # ps -mTp 3812
>   PID  SPID TTY          TIME CMD
>  3812     - ?        00:00:00 httpd
>     -  3812 -        00:00:00 -
>
> Normal sub-process:
>
> # ps -mTp 20205
>   PID  SPID TTY          TIME CMD
> 20205     - ?        00:00:10 httpd
>     - 20205 -        00:00:00 -
>     - 20207 -        00:00:00 -
>     - 20208 -        00:00:00 -
>     - 20209 -        00:00:00 -
>     - 20210 -        00:00:00 -
>     - 20211 -        00:00:00 -
>     - 20212 -        00:00:00 -
>     - 20213 -        00:00:00 -
>     - 20214 -        00:00:00 -
>     - 20215 -        00:00:00 -
>     - 20216 -        00:00:00 -
>     - 20217 -        00:00:00 -
>     - 20218 -        00:00:00 -
>     - 20219 -        00:00:00 -
>     - 20220 -        00:00:00 -
>     - 20221 -        00:00:00 -
>     - 20222 -        00:00:00 -
>     - 20223 -        00:00:00 -
>     - 20224 -        00:00:00 -
>     - 20225 -        00:00:00 -
>     - 20226 -        00:00:00 -
>     - 20227 -        00:00:00 -
>     - 20228 -        00:00:00 -
>     - 20229 -        00:00:00 -
>     - 20230 -        00:00:00 -
>     - 20231 -        00:00:00 -
>     - 20232 -        00:00:00 -
>     - 20233 -        00:00:00 -
>     - 20234 -        00:00:00 -
>     - 20235 -        00:00:00 -
>     - 20236 -        00:00:00 -
>     - 20237 -        00:00:00 -
>     - 20238 -        00:00:00 -
>     - 20239 -        00:00:00 -
>     - 20240 -        00:00:00 -
>     - 20241 -        00:00:00 -
>     - 20242 -        00:00:00 -
>     - 20243 -        00:00:00 -
>     - 20244 -        00:00:00 -
>     - 20245 -        00:00:00 -
>     - 20246 -        00:00:00 -
>     - 20247 -        00:00:00 -
>
>
> > -----Original Message-----
> > From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> > Sent: Tuesday, January 22, 2008 7:00 PM
> > To: Alec Matusis
> > Cc: mod_python@modpython.org
> > Subject: Re: [mod_python] remnant 'orphan' apache subprocesses
> >
> > On 23/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > > (gdb) thread apply all bt
> > >
> > > Thread 1 (Thread 1111562592 (LWP 3812)):
> > > #0  0x00002aaaab2c94df in sem_wait () from /lib64/tls/libpthread.so.0
> > > #1  0x00002aaaac204dcd in PyThread_acquire_lock (lock=0x5b7820,
> > waitflag=1)
> >
> > Hmmm, there should have been 39 other stack traces, one for each
> > worker thread based on your Apache configuration.
> >
> > Don't necessarily post them all, but you should look and see what is
> > in frame #0 for all of them and see if there is anything odd such as
> > one blocking in a call out to some external C library. If no such
> > thing and they are all stuck on Python mutex locks, then must be
> > internal deadlock.
> >
> > This still doesn't explain though how the process has been associated
> > with PPID of 1, which would  still only seem possible if something had
> > tried to daemonise process.
> >
> > Graham
> >
> > Graham
>
>
From yam at nerd.cx  Wed Jan 23 09:36:57 2008
From: yam at nerd.cx (William Witteman)
Date: Wed Jan 23 09:37:04 2008
Subject: [mod_python] Traversal Not Working
Message-ID: <20080123143657.GA1139@sillyrabbi.dyndns.org>

Hello,

I developed a site using the publisher handler on Debian stable, which
is a bit behind, but which works well.  Here are the versions:

libapache2-mod-python/etch uptodate 3.2.10-4
apache2/etch uptodate 2.2.3-4+etch3
python/etch uptodate 2.4.4-2

The site works great with this httpd.conf:

  <Directory /www/sitedir>
    Options +Includes Indexes FollowSymLinks MultiViews
    AddHandler mod_python .py
    PythonHandler mod_python.publisher
    PythonDebug On
    AllowOverride Options
    Order allow,deny
    allow from all
  </Directory>

I am trying to get this to work on a production server which is more modern, it's versions are as follows:

mod_python-3.3.1
python-2.5
apache2

What is happening is that the first page of the site comes up fine
(index.py in the web root, with an index() function).  However, all
other pages throw 404s.  This seems to be because the directory
traversal is not working, but I am at a loss.  Any suggestions?  Thanks.
-- 

yours,

William
From zimet at manray.com  Wed Jan 23 13:47:39 2008
From: zimet at manray.com (Martha Zimet)
Date: Wed Jan 23 13:48:22 2008
Subject: [mod_python] Problems with mod_python
Message-ID: <60226.1201114059@manray.com>

I am having problems getting mod_python to work correctly.
I am following the directions in
http://www.modpython.org/live/mod_python-3.2.8/doc-html/inst-testing.html
and have written a mptest.py. However, when I access mptest.py from my browser,
the code does not execute and all I get is the text for mptest.py
displaying in the browser window. For example:

from mod_python import apache

def handler(req):
    req.content_type = 'text/plain'
    req.write("Hello World!")
    return apache.OK

Does anyone have any suggestions on what could be wrong with my installation
or how I can further diagnose this problem? Thanks in advance and I apologize
if this situation has been answered before.







From graham.dumpleton at gmail.com  Wed Jan 23 14:30:18 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Wed Jan 23 14:30:25 2008
Subject: [mod_python] Problems with mod_python
In-Reply-To: <60226.1201114059@manray.com>
References: <60226.1201114059@manray.com>
Message-ID: <88e286470801231130o40f5a703ud54cdf6b765add59@mail.gmail.com>

Try following procedure documented in:

  http://www.dscpl.com.au/wiki/ModPython/Articles/GettingModPythonWorking

Do all the checks it talks about to make sure things are configured correctly.

Graham

On 24/01/2008, Martha Zimet <zimet@manray.com> wrote:
> I am having problems getting mod_python to work correctly.
> I am following the directions in
> http://www.modpython.org/live/mod_python-3.2.8/doc-html/inst-testing.html
> and have written a mptest.py. However, when I access mptest.py from my browser,
> the code does not execute and all I get is the text for mptest.py
> displaying in the browser window. For example:
>
> from mod_python import apache
>
> def handler(req):
>     req.content_type = 'text/plain'
>     req.write("Hello World!")
>     return apache.OK
>
> Does anyone have any suggestions on what could be wrong with my installation
> or how I can further diagnose this problem? Thanks in advance and I apologize
> if this situation has been answered before.
>
>
>
>
>
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From rdacker at pacbell.net  Wed Jan 23 14:40:24 2008
From: rdacker at pacbell.net (dudley ackerman)
Date: Wed Jan 23 14:40:33 2008
Subject: [mod_python] Problems with mod_python
In-Reply-To: <60226.1201114059@manray.com>
References: <60226.1201114059@manray.com>
Message-ID: <03A6DB44-C960-42E5-BEA3-750CA8473331@pacbell.net>


On Jan 23, 2008, at 10:47 AM, Martha Zimet wrote:

> I am having problems getting mod_python to work correctly.
> I am following the directions in
> http://www.modpython.org/live/mod_python-3.2.8/doc-html/inst-testing.html
> and have written a mptest.py. However, when I access mptest.py from  
> my browser,
> the code does not execute and all I get is the text for mptest.py
> displaying in the browser window. For example:
>
> from mod_python import apache
>
> def handler(req):
>    req.content_type = 'text/plain'
>    req.write("Hello World!")
>    return apache.OK
>
> Does anyone have any suggestions on what could be wrong with my  
> installation
> or how I can further diagnose this problem? Thanks in advance and I  
> apologize
> if this situation has been answered before.

that happened to me recently because i didn't have the path correct in  
the httpd.conf section setting up mod_python.
i had the capitalization wrong.
you might show us that section you put into httpd.conf.
From zimet at manray.com  Wed Jan 23 15:14:22 2008
From: zimet at manray.com (Martha Zimet)
Date: Wed Jan 23 15:15:52 2008
Subject: [mod_python] Problems with mod_python
Message-ID: <53425.1201119262@manray.com>

I have followed your nstructions and I am still running into
the same problem, that is, only the source displays. I am running
mod_pyton version 3.1 have verified that is is indeed loaded
by checking the httpd error log per the document you referred
me to. 

Any more suggestions? My configuration file has the following:

<Directory /python>
    AddHandler mod_python .py
    PythonHandler mptest
    PythonDebug On
</Direcory>

I have tried it also with a /test directory with the same result.
Any light you can shed would be greatly appreciated.

Regards,

/martha

On Thu Jan 24  6:30 , "Graham Dumpleton"  sent:

>Try following procedure documented in:
>
>  http://www.dscpl.com.au/wiki/ModPython/Articles/GettingModPythonWorking
>
>Do all the checks it talks about to make sure things are configured correctly.
>
>Graham
>
>On 24/01/2008, Martha Zimet zimet@manray.com> wrote:
>> I am having problems getting mod_python to work correctly.
>> I am following the directions in
>> http://www.modpython.org/live/mod_python-3.2.8/doc-html/inst-testing.html
>> and have written a mptest.py. However, when I access mptest.py from my browser,
>> the code does not execute and all I get is the text for mptest.py
>> displaying in the browser window. For example:
>>
>> from mod_python import apache
>>
>> def handler(req):
>>     req.content_type = 'text/plain'
>>     req.write("Hello World!")
>>     return apache.OK
>>
>> Does anyone have any suggestions on what could be wrong with my installation
>> or how I can further diagnose this problem? Thanks in advance and I apologize
>> if this situation has been answered before.
>>
>>
>>
>>
>>
>>
>>
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>



From zimet at manray.com  Wed Jan 23 15:18:00 2008
From: zimet at manray.com (Martha Zimet)
Date: Wed Jan 23 15:18:13 2008
Subject: [mod_python] Problems with mod_python
Message-ID: <50101.1201119480@manray.com>

Here is what I have put into my configuration file:

<Directory /python>
    AddHandler mod_python .py
    PythonHandler mptest
    PythonDebug On
</Directory>

I have also tried things with the /test directory with the
same result. 

Any light you can further shed would be greatly appreciated.

Regards,

/martha

On Wed Jan 23 11:40 , dudley ackerman  sent:

>
>On Jan 23, 2008, at 10:47 AM, Martha Zimet wrote:
>
>> I am having problems getting mod_python to work correctly.
>> I am following the directions in
>> http://www.modpython.org/live/mod_python-3.2.8/doc-html/inst-testing.html
>> and have written a mptest.py. However, when I access mptest.py from  
>> my browser,
>> the code does not execute and all I get is the text for mptest.py
>> displaying in the browser window. For example:
>>
>> from mod_python import apache
>>
>> def handler(req):
>>    req.content_type = 'text/plain'
>>    req.write("Hello World!")
>>    return apache.OK
>>
>> Does anyone have any suggestions on what could be wrong with my  
>> installation
>> or how I can further diagnose this problem? Thanks in advance and I  
>> apologize
>> if this situation has been answered before.
>
>that happened to me recently because i didn't have the path correct in  
>the httpd.conf section setting up mod_python.
>i had the capitalization wrong.
>you might show us that section you put into httpd.conf.



From graham.dumpleton at gmail.com  Wed Jan 23 15:24:24 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Wed Jan 23 15:24:30 2008
Subject: [mod_python] Problems with mod_python
In-Reply-To: <53425.1201119262@manray.com>
References: <53425.1201119262@manray.com>
Message-ID: <88e286470801231224i50e2e078oba7b8555e72e04ab@mail.gmail.com>

On 24/01/2008, Martha Zimet <zimet@manray.com> wrote:
> I have followed your nstructions and I am still running into
> the same problem, that is, only the source displays. I am running
> mod_pyton version 3.1 have verified that is is indeed loaded
> by checking the httpd error log per the document you referred
> me to.

Did you try the .htaccess method in those instructions rather than
trying to do it in your main Apache configuration file?

What operating system are you using?

> Any more suggestions? My configuration file has the following:
>
> <Directory /python>

Is this what you have for real?

The argument to the Directory directive is meant to be an actual
physical directory, not a URL path component.

Graham

>     AddHandler mod_python .py
>     PythonHandler mptest
>     PythonDebug On
> </Direcory>
>
> I have tried it also with a /test directory with the same result.
> Any light you can shed would be greatly appreciated.
>
> Regards,
>
> /martha
>
> On Thu Jan 24  6:30 , "Graham Dumpleton"  sent:
>
> >Try following procedure documented in:
> >
> >  http://www.dscpl.com.au/wiki/ModPython/Articles/GettingModPythonWorking
> >
> >Do all the checks it talks about to make sure things are configured correctly.
> >
> >Graham
> >
> >On 24/01/2008, Martha Zimet zimet@manray.com> wrote:
> >> I am having problems getting mod_python to work correctly.
> >> I am following the directions in
> >> http://www.modpython.org/live/mod_python-3.2.8/doc-html/inst-testing.html
> >> and have written a mptest.py. However, when I access mptest.py from my browser,
> >> the code does not execute and all I get is the text for mptest.py
> >> displaying in the browser window. For example:
> >>
> >> from mod_python import apache
> >>
> >> def handler(req):
> >>     req.content_type = 'text/plain'
> >>     req.write("Hello World!")
> >>     return apache.OK
> >>
> >> Does anyone have any suggestions on what could be wrong with my installation
> >> or how I can further diagnose this problem? Thanks in advance and I apologize
> >> if this situation has been answered before.
> >>
> >>
> >>
> >>
> >>
> >>
> >>
> >> _______________________________________________
> >> Mod_python mailing list
> >> Mod_python@modpython.org
> >> http://mailman.modpython.org/mailman/listinfo/mod_python
> >>
>
>
>
From zimet at manray.com  Wed Jan 23 15:33:43 2008
From: zimet at manray.com (Martha Zimet)
Date: Wed Jan 23 15:34:35 2008
Subject: [mod_python] Problems with mod_python
Message-ID: <60408.1201120423@manray.com>

I am running Linux, kernel 2.6.22.

I have tried the configuration methods using .htaccess and
httpd.conf. I have tried using the complete path name
in httpd.conf (the physical directory) as well. Your 
desscription in the first URL you sent was quite good.

Regards,

/martha

On Thu Jan 24  7:24 , "Graham Dumpleton"  sent:

>On 24/01/2008, Martha Zimet zimet@manray.com> wrote:
>> I have followed your nstructions and I am still running into
>> the same problem, that is, only the source displays. I am running
>> mod_pyton version 3.1 have verified that is is indeed loaded
>> by checking the httpd error log per the document you referred
>> me to.
>
>Did you try the .htaccess method in those instructions rather than
>trying to do it in your main Apache configuration file?
>
>What operating system are you using?
>
>> Any more suggestions? My configuration file has the following:
>>
>> 
>
>Is this what you have for real?
>
>The argument to the Directory directive is meant to be an actual
>physical directory, not a URL path component.
>
>Graham
>
>>     AddHandler mod_python .py
>>     PythonHandler mptest
>>     PythonDebug On
>> 
>>
>> I have tried it also with a /test directory with the same result.
>> Any light you can shed would be greatly appreciated.
>>
>> Regards,
>>
>> /martha
>>
>> On Thu Jan 24  6:30 , "Graham Dumpleton"  sent:
>>
>> >Try following procedure documented in:
>> >
>> >  http://www.dscpl.com.au/wiki/ModPython/Articles/GettingModPythonWorking
>> >
>> >Do all the checks it talks about to make sure things are configured correctly.
>> >
>> >Graham
>> >
>> >On 24/01/2008, Martha Zimet zimet@manray.com> wrote:
>> >> I am having problems getting mod_python to work correctly.
>> >> I am following the directions in
>> >> http://www.modpython.org/live/mod_python-3.2.8/doc-html/inst-testing.html
>> >> and have written a mptest.py. However, when I access mptest.py from my browser,
>> >> the code does not execute and all I get is the text for mptest.py
>> >> displaying in the browser window. For example:
>> >>
>> >> from mod_python import apache
>> >>
>> >> def handler(req):
>> >>     req.content_type = 'text/plain'
>> >>     req.write("Hello World!")
>> >>     return apache.OK
>> >>
>> >> Does anyone have any suggestions on what could be wrong with my installation
>> >> or how I can further diagnose this problem? Thanks in advance and I apologize
>> >> if this situation has been answered before.
>> >>
>> >>
>> >>
>> >>
>> >>
>> >>
>> >>
>> >> _______________________________________________
>> >> Mod_python mailing list
>> >> Mod_python@modpython.org
>> >> http://mailman.modpython.org/mailman/listinfo/mod_python
>> >>
>>
>>
>>



From graham.dumpleton at gmail.com  Wed Jan 23 16:55:45 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Wed Jan 23 16:55:53 2008
Subject: [mod_python] Problems with mod_python
In-Reply-To: <60408.1201120423@manray.com>
References: <60408.1201120423@manray.com>
Message-ID: <88e286470801231355q75071ae2k780277dedb020378@mail.gmail.com>

For the .htaccess method did you validate that the .htaccess file was
actually being used by Apache? The easiest way to do this is to add
some crap in it to trigger a syntax error. This should cause a 500
error response to come back. So, add into your .htaccess file:

  XXXX Some Crap XXXX

If you don't get a 500 error, then you likely don't have FileInfo
override specified for that directory and so Apache is ignoring the
file.

Graham

On 24/01/2008, Martha Zimet <zimet@manray.com> wrote:
> I am running Linux, kernel 2.6.22.
>
> I have tried the configuration methods using .htaccess and
> httpd.conf. I have tried using the complete path name
> in httpd.conf (the physical directory) as well. Your
> desscription in the first URL you sent was quite good.
>
> Regards,
>
> /martha
>
> On Thu Jan 24  7:24 , "Graham Dumpleton"  sent:
>
> >On 24/01/2008, Martha Zimet zimet@manray.com> wrote:
> >> I have followed your nstructions and I am still running into
> >> the same problem, that is, only the source displays. I am running
> >> mod_pyton version 3.1 have verified that is is indeed loaded
> >> by checking the httpd error log per the document you referred
> >> me to.
> >
> >Did you try the .htaccess method in those instructions rather than
> >trying to do it in your main Apache configuration file?
> >
> >What operating system are you using?
> >
> >> Any more suggestions? My configuration file has the following:
> >>
> >>
> >
> >Is this what you have for real?
> >
> >The argument to the Directory directive is meant to be an actual
> >physical directory, not a URL path component.
> >
> >Graham
> >
> >>     AddHandler mod_python .py
> >>     PythonHandler mptest
> >>     PythonDebug On
> >>
> >>
> >> I have tried it also with a /test directory with the same result.
> >> Any light you can shed would be greatly appreciated.
> >>
> >> Regards,
> >>
> >> /martha
> >>
> >> On Thu Jan 24  6:30 , "Graham Dumpleton"  sent:
> >>
> >> >Try following procedure documented in:
> >> >
> >> >  http://www.dscpl.com.au/wiki/ModPython/Articles/GettingModPythonWorking
> >> >
> >> >Do all the checks it talks about to make sure things are configured correctly.
> >> >
> >> >Graham
> >> >
> >> >On 24/01/2008, Martha Zimet zimet@manray.com> wrote:
> >> >> I am having problems getting mod_python to work correctly.
> >> >> I am following the directions in
> >> >> http://www.modpython.org/live/mod_python-3.2.8/doc-html/inst-testing.html
> >> >> and have written a mptest.py. However, when I access mptest.py from my browser,
> >> >> the code does not execute and all I get is the text for mptest.py
> >> >> displaying in the browser window. For example:
> >> >>
> >> >> from mod_python import apache
> >> >>
> >> >> def handler(req):
> >> >>     req.content_type = 'text/plain'
> >> >>     req.write("Hello World!")
> >> >>     return apache.OK
> >> >>
> >> >> Does anyone have any suggestions on what could be wrong with my installation
> >> >> or how I can further diagnose this problem? Thanks in advance and I apologize
> >> >> if this situation has been answered before.
> >> >>
> >> >>
> >> >>
> >> >>
> >> >>
> >> >>
> >> >>
> >> >> _______________________________________________
> >> >> Mod_python mailing list
> >> >> Mod_python@modpython.org
> >> >> http://mailman.modpython.org/mailman/listinfo/mod_python
> >> >>
> >>
> >>
> >>
>
>
>
From graham.dumpleton at gmail.com  Wed Jan 23 16:57:56 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Wed Jan 23 16:58:02 2008
Subject: [mod_python] Traversal Not Working
In-Reply-To: <20080123143657.GA1139@sillyrabbi.dyndns.org>
References: <20080123143657.GA1139@sillyrabbi.dyndns.org>
Message-ID: <88e286470801231357s3c702fbfv7b01861726488539@mail.gmail.com>

Provide a directory listing /www/sitedir showing ownership and
permissions, ie., 'ls -las'. Also provide clear examples of the URLs
that you are using and which work and which don't.

Graham

On 24/01/2008, William Witteman <yam@nerd.cx> wrote:
> Hello,
>
> I developed a site using the publisher handler on Debian stable, which
> is a bit behind, but which works well.  Here are the versions:
>
> libapache2-mod-python/etch uptodate 3.2.10-4
> apache2/etch uptodate 2.2.3-4+etch3
> python/etch uptodate 2.4.4-2
>
> The site works great with this httpd.conf:
>
>   <Directory /www/sitedir>
>     Options +Includes Indexes FollowSymLinks MultiViews
>     AddHandler mod_python .py
>     PythonHandler mod_python.publisher
>     PythonDebug On
>     AllowOverride Options
>     Order allow,deny
>     allow from all
>   </Directory>
>
> I am trying to get this to work on a production server which is more modern, it's versions are as follows:
>
> mod_python-3.3.1
> python-2.5
> apache2
>
> What is happening is that the first page of the site comes up fine
> (index.py in the web root, with an index() function).  However, all
> other pages throw 404s.  This seems to be because the directory
> traversal is not working, but I am at a loss.  Any suggestions?  Thanks.
> --
>
> yours,
>
> William
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From emailmanjula at yahoo.com  Wed Jan 23 16:58:44 2008
From: emailmanjula at yahoo.com (Manjula Kumar)
Date: Wed Jan 23 16:58:51 2008
Subject: [mod_python] Problems with mod_python
In-Reply-To: <88e286470801231224i50e2e078oba7b8555e72e04ab@mail.gmail.com>
Message-ID: <944980.70684.qm@web35501.mail.mud.yahoo.com>

Hi All,
   Can anyone please let me know where I can download mod_python for Apache 1.3.
   
  Thanks,
  Manjula

Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
  On 24/01/2008, Martha Zimet wrote:
> I have followed your nstructions and I am still running into
> the same problem, that is, only the source displays. I am running
> mod_pyton version 3.1 have verified that is is indeed loaded
> by checking the httpd error log per the document you referred
> me to.

Did you try the .htaccess method in those instructions rather than
trying to do it in your main Apache configuration file?

What operating system are you using?

> Any more suggestions? My configuration file has the following:
>
> 

Is this what you have for real?

The argument to the Directory directive is meant to be an actual
physical directory, not a URL path component.

Graham

> AddHandler mod_python .py
> PythonHandler mptest
> PythonDebug On
> 
>
> I have tried it also with a /test directory with the same result.
> Any light you can shed would be greatly appreciated.
>
> Regards,
>
> /martha
>
> On Thu Jan 24 6:30 , "Graham Dumpleton" sent:
>
> >Try following procedure documented in:
> >
> > http://www.dscpl.com.au/wiki/ModPython/Articles/GettingModPythonWorking
> >
> >Do all the checks it talks about to make sure things are configured correctly.
> >
> >Graham
> >
> >On 24/01/2008, Martha Zimet zimet@manray.com> wrote:
> >> I am having problems getting mod_python to work correctly.
> >> I am following the directions in
> >> http://www.modpython.org/live/mod_python-3.2.8/doc-html/inst-testing.html
> >> and have written a mptest.py. However, when I access mptest.py from my browser,
> >> the code does not execute and all I get is the text for mptest.py
> >> displaying in the browser window. For example:
> >>
> >> from mod_python import apache
> >>
> >> def handler(req):
> >> req.content_type = 'text/plain'
> >> req.write("Hello World!")
> >> return apache.OK
> >>
> >> Does anyone have any suggestions on what could be wrong with my installation
> >> or how I can further diagnose this problem? Thanks in advance and I apologize
> >> if this situation has been answered before.
> >>
> >>
> >>
> >>
> >>
> >>
> >>
> >> _______________________________________________
> >> Mod_python mailing list
> >> Mod_python@modpython.org
> >> http://mailman.modpython.org/mailman/listinfo/mod_python
> >>
>
>
>
_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://mailman.modpython.org/mailman/listinfo/mod_python


       
---------------------------------
Never miss a thing.   Make Yahoo your homepage.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080123/a46d7b26/attachment.html
From graham.dumpleton at gmail.com  Wed Jan 23 17:05:52 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Wed Jan 23 17:06:00 2008
Subject: [mod_python] Problems with mod_python
In-Reply-To: <944980.70684.qm@web35501.mail.mud.yahoo.com>
References: <88e286470801231224i50e2e078oba7b8555e72e04ab@mail.gmail.com>
	<944980.70684.qm@web35501.mail.mud.yahoo.com>
Message-ID: <88e286470801231405w5e2090c9y3458f6d897dfe01@mail.gmail.com>

It is available from the downloads page of http://www.modpython.org.
You want version 2.7.11.

If you want this not because you want to write mod_python specific
stuff, but because you want to run a WSGI compliant Python web
application on top, you are better off using mod_wsgi as older
mod_python versions have various bugs.

Graham

On 24/01/2008, Manjula Kumar <emailmanjula@yahoo.com> wrote:
> Hi All,
>  Can anyone please let me know where I can download mod_python for Apache
> 1.3.
>
> Thanks,
> Manjula
>
> Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> On 24/01/2008, Martha Zimet wrote:
> > I have followed your nstructions and I am still running into
> > the same problem, that is, only the source displays. I am running
> > mod_pyton version 3.1 have verified that is is indeed loaded
> > by checking the httpd error log per the document you referred
> > me to.
>
> Did you try the .htaccess method in those instructions rather than
> trying to do it in your main Apache configuration file?
>
> What operating system are you using?
>
> > Any more suggestions? My configuration file has the following:
> >
> >
>
> Is this what you have for real?
>
> The argument to the Directory directive is meant to be an actual
> physical directory, not a URL path component.
>
> Graham
>
> > AddHandler mod_python .py
> > PythonHandler mptest
> > PythonDebug On
> >
> >
> > I have tried it also with a /test directory with the same result.
> > Any light you can shed would be greatly appreciated.
> >
> > Regards,
> >
> > /martha
> >
> > On Thu Jan 24 6:30 , "Graham Dumpleton" sent:
> >
> > >Try following procedure documented in:
> > >
> > >
> http://www.dscpl.com.au/wiki/ModPython/Articles/GettingModPythonWorking
> > >
> > >Do all the checks it talks about to make sure things are configured
> correctly.
> > >
> > >Graham
> > >
> > >On 24/01/2008, Martha Zimet zimet@manray.com> wrote:
> > >> I am having problems getting mod_python to work correctly.
> > >> I am following the directions in
> > >>
> http://www.modpython.org/live/mod_python-3.2.8/doc-html/inst-testing.html
> > >> and have written a mptest.py. However, when I access mptest.py from my
> browser,
> > >> the code does not execute and all I get is the text for mptest.py
> > >> displaying in the browser window. For example:
> > >>
> > >> from mod_python import apache
> > >>
> > >> def handler(req):
> > >> req.content_type = 'text/plain'
> > >> req.write("Hello World!")
> > >> return apache.OK
> > >>
> > >> Does anyone have any suggestions on what could be wrong with my
> installation
> > >> or how I can further diagnose this problem? Thanks in advance and I
> apologize
> > >> if this situation has been answered before.
> > >>
> > >>
> > >>
> > >>
> > >>
> > >>
> > >>
> > >> _______________________________________________
> > >> Mod_python mailing list
> > >> Mod_python@modpython.org
> > >>
> http://mailman.modpython.org/mailman/listinfo/mod_python
> > >>
> >
> >
> >
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
>
>  ________________________________
> Never miss a thing. Make Yahoo your homepage.
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
From emailmanjula at yahoo.com  Wed Jan 23 17:15:47 2008
From: emailmanjula at yahoo.com (Manjula Kumar)
Date: Wed Jan 23 17:15:52 2008
Subject: [mod_python] Problems with mod_python
In-Reply-To: <88e286470801231405w5e2090c9y3458f6d897dfe01@mail.gmail.com>
Message-ID: <334350.50950.qm@web35508.mail.mud.yahoo.com>

Thanks Graham.Should I download this
   
  mp152dll.zip            18-Dec-2000 13:29    15k  HTTP Server project

which is at http://www.alliedquotes.com/mirrors/apache/httpd/modpython/win/2.7.1/
   
  I would like to download mod_python to redirect wiki to root name.
   
  Please let me know whether the mod_python which I am trying to download is proper version.
   
  Thanks,
  Manjula
Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
  It is available from the downloads page of http://www.modpython.org.
You want version 2.7.11.

If you want this not because you want to write mod_python specific
stuff, but because you want to run a WSGI compliant Python web
application on top, you are better off using mod_wsgi as older
mod_python versions have various bugs.

Graham

On 24/01/2008, Manjula Kumar wrote:
> Hi All,
> Can anyone please let me know where I can download mod_python for Apache
> 1.3.
>
> Thanks,
> Manjula
>
> Graham Dumpleton wrote:
> On 24/01/2008, Martha Zimet wrote:
> > I have followed your nstructions and I am still running into
> > the same problem, that is, only the source displays. I am running
> > mod_pyton version 3.1 have verified that is is indeed loaded
> > by checking the httpd error log per the document you referred
> > me to.
>
> Did you try the .htaccess method in those instructions rather than
> trying to do it in your main Apache configuration file?
>
> What operating system are you using?
>
> > Any more suggestions? My configuration file has the following:
> >
> >
>
> Is this what you have for real?
>
> The argument to the Directory directive is meant to be an actual
> physical directory, not a URL path component.
>
> Graham
>
> > AddHandler mod_python .py
> > PythonHandler mptest
> > PythonDebug On
> >
> >
> > I have tried it also with a /test directory with the same result.
> > Any light you can shed would be greatly appreciated.
> >
> > Regards,
> >
> > /martha
> >
> > On Thu Jan 24 6:30 , "Graham Dumpleton" sent:
> >
> > >Try following procedure documented in:
> > >
> > >
> http://www.dscpl.com.au/wiki/ModPython/Articles/GettingModPythonWorking
> > >
> > >Do all the checks it talks about to make sure things are configured
> correctly.
> > >
> > >Graham
> > >
> > >On 24/01/2008, Martha Zimet zimet@manray.com> wrote:
> > >> I am having problems getting mod_python to work correctly.
> > >> I am following the directions in
> > >>
> http://www.modpython.org/live/mod_python-3.2.8/doc-html/inst-testing.html
> > >> and have written a mptest.py. However, when I access mptest.py from my
> browser,
> > >> the code does not execute and all I get is the text for mptest.py
> > >> displaying in the browser window. For example:
> > >>
> > >> from mod_python import apache
> > >>
> > >> def handler(req):
> > >> req.content_type = 'text/plain'
> > >> req.write("Hello World!")
> > >> return apache.OK
> > >>
> > >> Does anyone have any suggestions on what could be wrong with my
> installation
> > >> or how I can further diagnose this problem? Thanks in advance and I
> apologize
> > >> if this situation has been answered before.
> > >>
> > >>
> > >>
> > >>
> > >>
> > >>
> > >>
> > >> _______________________________________________
> > >> Mod_python mailing list
> > >> Mod_python@modpython.org
> > >>
> http://mailman.modpython.org/mailman/listinfo/mod_python
> > >>
> >
> >
> >
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
>
> ________________________________
> Never miss a thing. Make Yahoo your homepage.
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>


       
---------------------------------
Never miss a thing.   Make Yahoo your homepage.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080123/cd87622b/attachment-0001.html
From graham.dumpleton at gmail.com  Wed Jan 23 17:21:15 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Wed Jan 23 17:21:23 2008
Subject: [mod_python] Problems with mod_python
In-Reply-To: <334350.50950.qm@web35508.mail.mud.yahoo.com>
References: <88e286470801231405w5e2090c9y3458f6d897dfe01@mail.gmail.com>
	<334350.50950.qm@web35508.mail.mud.yahoo.com>
Message-ID: <88e286470801231421r4087502fjd417bd7ef4a4efbd@mail.gmail.com>

On 24/01/2008, Manjula Kumar <emailmanjula@yahoo.com> wrote:
> Thanks Graham.Should I download this
>
> mp152dll.zip            18-Dec-2000 13:29    15k  HTTP Server project
>
> which is at
> http://www.alliedquotes.com/mirrors/apache/httpd/modpython/win/2.7.1/

I said 2.7.11, not 2.7.1.

If you are running Windows, which is suggested by the link you have
decided to choose, then I would probably give up as running Apache 1.3
on Windows is probably not a good idea.

> I would like to download mod_python to redirect wiki to root name.

Huh?

What wiki? Why do you think you need mod_python for doing that?

Graham

> Please let me know whether the mod_python which I am trying to download is
> proper version.
>
> Thanks,
> Manjula
> Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> It is available from the downloads page of http://www.modpython.org.
> You want version 2.7.11.
>
> If you want this not because you want to write mod_python specific
> stuff, but because you want to run a WSGI compliant Python web
> application on top, you are better off using mod_wsgi as older
> mod_python versions have various bugs.
>
> Graham
>
> On 24/01/2008, Manjula Kumar wrote:
> > Hi All,
> > Can anyone please let me know where I can download mod_python for Apache
> > 1.3.
> >
> > Thanks,
> > Manjula
> >
> > Graham Dumpleton wrote:
> > On 24/01/2008, Martha Zimet wrote:
> > > I have followed your nstructions and I am still running into
> > > the same problem, that is, only the source displays. I am running
> > > mod_pyton version 3.1 have verified that is is indeed loaded
> > > by checking the httpd error log per the document you referred
> > > me to.
> >
> > Did you try the .htaccess method in those instructions rather than
> > trying to do it in your main Apache configuration file?
> >
> > What operating system are you using?
> >
> > > Any more suggestions? My configuration file has the following:
> > >
> > >
> >
> > Is this what you have for real?
> >
> > The argument to the Directory directive is meant to be an actual
> > physical directory, not a URL path component.
> >
> > Graham
> >
> > > AddHandler mod_python .py
> > > PythonHandler mptest
> > > PythonDebug On
> > >
> > >
> > > I have tried it also with a /test directory with the same result.
> > > Any light you can shed would be greatly appreciated.
> > >
> > > Regards,
> > >
> > > /martha
> > >
> > > On Thu Jan 24 6:30 , "Graham Dumpleton" sent:
> > >
> > > >Try following procedure documented in:
> > > >
> > > >
> >
> http://www.dscpl.com.au/wiki/ModPython/Articles/GettingModPythonWorking
> > > >
> > > >Do all the checks it talks about to make sure things are configured
> > correctly.
> > > >
> > > >Graham
> > > >
> > > >On 24/01/2008, Martha Zimet zimet@manray.com> wrote:
> > > >> I am having problems getting mod_python to work correctly.
> > > >> I am following the directions in
> > > >>
> >
> http://www.modpython.org/live/mod_python-3.2.8/doc-html/inst-testing.html
> > > >> and have written a mptest.py. However, when I access mptest.py from
> my
> > browser,
> > > >> the code does not execute and all I get is the text for mptest.py
> > > >> displaying in the browser window. For example:
> > > >>
> > > >> from mod_python import apache
> > > >>
> > > >> def handler(req):
> > > >> req.content_type = 'text/plain'
> > > >> req.write("Hello World!")
> > > >> return apache.OK
> > > >>
> > > >> Does anyone have any suggestions on what could be wrong with my
> > installation
> > > >> or how I can further diagnose this problem? Thanks in advance and I
> > apologize
> > > >> if this situation has been answered before.
> > > >>
> > > >>
> > > >>
> > > >>
> > > >>
> > > >>
> > > >>
> > > >> _______________________________________________
> > > >> Mod_python mailing list
> > > >> Mod_python@modpython.org
> > > >>
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> > > >>
> > >
> > >
> > >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
> >
> >
> > ________________________________
> > Never miss a thing. Make Yahoo your homepage.
> >
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
> >
>
>
>
>  ________________________________
> Never miss a thing. Make Yahoo your homepage.
>
>
From zimet at manray.com  Wed Jan 23 17:28:02 2008
From: zimet at manray.com (Martha Zimet)
Date: Wed Jan 23 17:28:41 2008
Subject: [mod_python] Problems with mod_python
Message-ID: <47767.1201127282@manray.com>

It looks like .htacess is not being read and and I entered
the AllowOverride FileInfo directive as you suggested. The
directives were entered in the Directory section of httpd.conf. 

I will keep trying.. 

Regards,

/martha

On Thu Jan 24  8:55 , "Graham Dumpleton"  sent:

>For the .htaccess method did you validate that the .htaccess file was
>actually being used by Apache? The easiest way to do this is to add
>some crap in it to trigger a syntax error. This should cause a 500
>error response to come back. So, add into your .htaccess file:
>
>  XXXX Some Crap XXXX
>
>If you don't get a 500 error, then you likely don't have FileInfo
>override specified for that directory and so Apache is ignoring the
>file.
>
>Graham
>
>On 24/01/2008, Martha Zimet zimet@manray.com> wrote:
>> I am running Linux, kernel 2.6.22.
>>
>> I have tried the configuration methods using .htaccess and
>> httpd.conf. I have tried using the complete path name
>> in httpd.conf (the physical directory) as well. Your
>> desscription in the first URL you sent was quite good.
>>
>> Regards,
>>
>> /martha
>>
>> On Thu Jan 24  7:24 , "Graham Dumpleton"  sent:
>>
>> >On 24/01/2008, Martha Zimet zimet@manray.com> wrote:
>> >> I have followed your nstructions and I am still running into
>> >> the same problem, that is, only the source displays. I am running
>> >> mod_pyton version 3.1 have verified that is is indeed loaded
>> >> by checking the httpd error log per the document you referred
>> >> me to.
>> >
>> >Did you try the .htaccess method in those instructions rather than
>> >trying to do it in your main Apache configuration file?
>> >
>> >What operating system are you using?
>> >
>> >> Any more suggestions? My configuration file has the following:
>> >>
>> >>
>> >
>> >Is this what you have for real?
>> >
>> >The argument to the Directory directive is meant to be an actual
>> >physical directory, not a URL path component.
>> >
>> >Graham
>> >
>> >>     AddHandler mod_python .py
>> >>     PythonHandler mptest
>> >>     PythonDebug On
>> >>
>> >>
>> >> I have tried it also with a /test directory with the same result.
>> >> Any light you can shed would be greatly appreciated.
>> >>
>> >> Regards,
>> >>
>> >> /martha
>> >>
>> >> On Thu Jan 24  6:30 , "Graham Dumpleton"  sent:
>> >>
>> >> >Try following procedure documented in:
>> >> >
>> >> >  http://www.dscpl.com.au/wiki/ModPython/Articles/GettingModPythonWorking
>> >> >
>> >> >Do all the checks it talks about to make sure things are configured correctly.
>> >> >
>> >> >Graham
>> >> >
>> >> >On 24/01/2008, Martha Zimet zimet@manray.com> wrote:
>> >> >> I am having problems getting mod_python to work correctly.
>> >> >> I am following the directions in
>> >> >> http://www.modpython.org/live/mod_python-3.2.8/doc-html/inst-testing.html
>> >> >> and have written a mptest.py. However, when I access mptest.py from my
browser,
>> >> >> the code does not execute and all I get is the text for mptest.py
>> >> >> displaying in the browser window. For example:
>> >> >>
>> >> >> from mod_python import apache
>> >> >>
>> >> >> def handler(req):
>> >> >>     req.content_type = 'text/plain'
>> >> >>     req.write("Hello World!")
>> >> >>     return apache.OK
>> >> >>
>> >> >> Does anyone have any suggestions on what could be wrong with my installation
>> >> >> or how I can further diagnose this problem? Thanks in advance and I
apologize
>> >> >> if this situation has been answered before.
>> >> >>
>> >> >>
>> >> >>
>> >> >>
>> >> >>
>> >> >>
>> >> >>
>> >> >> _______________________________________________
>> >> >> Mod_python mailing list
>> >> >> Mod_python@modpython.org
>> >> >> http://mailman.modpython.org/mailman/listinfo/mod_python
>> >> >>
>> >>
>> >>
>> >>
>>
>>
>>



From graham.dumpleton at gmail.com  Wed Jan 23 17:31:32 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Wed Jan 23 17:31:38 2008
Subject: [mod_python] Problems with mod_python
In-Reply-To: <47767.1201127282@manray.com>
References: <47767.1201127282@manray.com>
Message-ID: <88e286470801231431s85c0fe5i2afdedaadd815b6f@mail.gmail.com>

Just make sure you don't have multiple AllowOverride lines in the same
Directory context block as from memory they aren't cumulative. Thus a
later one will wipe out settings from an earlier one.

Graham

On 24/01/2008, Martha Zimet <zimet@manray.com> wrote:
> It looks like .htacess is not being read and and I entered
> the AllowOverride FileInfo directive as you suggested. The
> directives were entered in the Directory section of httpd.conf.
>
> I will keep trying..
>
> Regards,
>
> /martha
>
> On Thu Jan 24  8:55 , "Graham Dumpleton"  sent:
>
> >For the .htaccess method did you validate that the .htaccess file was
> >actually being used by Apache? The easiest way to do this is to add
> >some crap in it to trigger a syntax error. This should cause a 500
> >error response to come back. So, add into your .htaccess file:
> >
> >  XXXX Some Crap XXXX
> >
> >If you don't get a 500 error, then you likely don't have FileInfo
> >override specified for that directory and so Apache is ignoring the
> >file.
> >
> >Graham
> >
> >On 24/01/2008, Martha Zimet zimet@manray.com> wrote:
> >> I am running Linux, kernel 2.6.22.
> >>
> >> I have tried the configuration methods using .htaccess and
> >> httpd.conf. I have tried using the complete path name
> >> in httpd.conf (the physical directory) as well. Your
> >> desscription in the first URL you sent was quite good.
> >>
> >> Regards,
> >>
> >> /martha
> >>
> >> On Thu Jan 24  7:24 , "Graham Dumpleton"  sent:
> >>
> >> >On 24/01/2008, Martha Zimet zimet@manray.com> wrote:
> >> >> I have followed your nstructions and I am still running into
> >> >> the same problem, that is, only the source displays. I am running
> >> >> mod_pyton version 3.1 have verified that is is indeed loaded
> >> >> by checking the httpd error log per the document you referred
> >> >> me to.
> >> >
> >> >Did you try the .htaccess method in those instructions rather than
> >> >trying to do it in your main Apache configuration file?
> >> >
> >> >What operating system are you using?
> >> >
> >> >> Any more suggestions? My configuration file has the following:
> >> >>
> >> >>
> >> >
> >> >Is this what you have for real?
> >> >
> >> >The argument to the Directory directive is meant to be an actual
> >> >physical directory, not a URL path component.
> >> >
> >> >Graham
> >> >
> >> >>     AddHandler mod_python .py
> >> >>     PythonHandler mptest
> >> >>     PythonDebug On
> >> >>
> >> >>
> >> >> I have tried it also with a /test directory with the same result.
> >> >> Any light you can shed would be greatly appreciated.
> >> >>
> >> >> Regards,
> >> >>
> >> >> /martha
> >> >>
> >> >> On Thu Jan 24  6:30 , "Graham Dumpleton"  sent:
> >> >>
> >> >> >Try following procedure documented in:
> >> >> >
> >> >> >  http://www.dscpl.com.au/wiki/ModPython/Articles/GettingModPythonWorking
> >> >> >
> >> >> >Do all the checks it talks about to make sure things are configured correctly.
> >> >> >
> >> >> >Graham
> >> >> >
> >> >> >On 24/01/2008, Martha Zimet zimet@manray.com> wrote:
> >> >> >> I am having problems getting mod_python to work correctly.
> >> >> >> I am following the directions in
> >> >> >> http://www.modpython.org/live/mod_python-3.2.8/doc-html/inst-testing.html
> >> >> >> and have written a mptest.py. However, when I access mptest.py from my
> browser,
> >> >> >> the code does not execute and all I get is the text for mptest.py
> >> >> >> displaying in the browser window. For example:
> >> >> >>
> >> >> >> from mod_python import apache
> >> >> >>
> >> >> >> def handler(req):
> >> >> >>     req.content_type = 'text/plain'
> >> >> >>     req.write("Hello World!")
> >> >> >>     return apache.OK
> >> >> >>
> >> >> >> Does anyone have any suggestions on what could be wrong with my installation
> >> >> >> or how I can further diagnose this problem? Thanks in advance and I
> apologize
> >> >> >> if this situation has been answered before.
> >> >> >>
> >> >> >>
> >> >> >>
> >> >> >>
> >> >> >>
> >> >> >>
> >> >> >>
> >> >> >> _______________________________________________
> >> >> >> Mod_python mailing list
> >> >> >> Mod_python@modpython.org
> >> >> >> http://mailman.modpython.org/mailman/listinfo/mod_python
> >> >> >>
> >> >>
> >> >>
> >> >>
> >>
> >>
> >>
>
>
>
From emailmanjula at yahoo.com  Wed Jan 23 17:41:57 2008
From: emailmanjula at yahoo.com (Manjula Kumar)
Date: Wed Jan 23 17:42:04 2008
Subject: [mod_python] Problems with mod_python
In-Reply-To: <88e286470801231421r4087502fjd417bd7ef4a4efbd@mail.gmail.com>
Message-ID: <160114.25127.qm@web35513.mail.mud.yahoo.com>

There is no version 2.7.11 under Windows.I could find only version 2.7.1.
  When I download the mod_python I gettting only the mod_python.dll file is this correct.
  Can i get mod_python.so and mod+python.c file also.Can anyone help regarding this problem.
  I am runnning moin moin wiki
   
  Thanks,
  Manjula

Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
  On 24/01/2008, Manjula Kumar wrote:
> Thanks Graham.Should I download this
>
> mp152dll.zip 18-Dec-2000 13:29 15k HTTP Server project
>
> which is at
> http://www.alliedquotes.com/mirrors/apache/httpd/modpython/win/2.7.1/

I said 2.7.11, not 2.7.1.

If you are running Windows, which is suggested by the link you have
decided to choose, then I would probably give up as running Apache 1.3
on Windows is probably not a good idea.

> I would like to download mod_python to redirect wiki to root name.

Huh?

What wiki? Why do you think you need mod_python for doing that?

Graham

> Please let me know whether the mod_python which I am trying to download is
> proper version.
>
> Thanks,
> Manjula
> Graham Dumpleton wrote:
> It is available from the downloads page of http://www.modpython.org.
> You want version 2.7.11.
>
> If you want this not because you want to write mod_python specific
> stuff, but because you want to run a WSGI compliant Python web
> application on top, you are better off using mod_wsgi as older
> mod_python versions have various bugs.
>
> Graham
>
> On 24/01/2008, Manjula Kumar wrote:
> > Hi All,
> > Can anyone please let me know where I can download mod_python for Apache
> > 1.3.
> >
> > Thanks,
> > Manjula
> >
> > Graham Dumpleton wrote:
> > On 24/01/2008, Martha Zimet wrote:
> > > I have followed your nstructions and I am still running into
> > > the same problem, that is, only the source displays. I am running
> > > mod_pyton version 3.1 have verified that is is indeed loaded
> > > by checking the httpd error log per the document you referred
> > > me to.
> >
> > Did you try the .htaccess method in those instructions rather than
> > trying to do it in your main Apache configuration file?
> >
> > What operating system are you using?
> >
> > > Any more suggestions? My configuration file has the following:
> > >
> > >
> >
> > Is this what you have for real?
> >
> > The argument to the Directory directive is meant to be an actual
> > physical directory, not a URL path component.
> >
> > Graham
> >
> > > AddHandler mod_python .py
> > > PythonHandler mptest
> > > PythonDebug On
> > >
> > >
> > > I have tried it also with a /test directory with the same result.
> > > Any light you can shed would be greatly appreciated.
> > >
> > > Regards,
> > >
> > > /martha
> > >
> > > On Thu Jan 24 6:30 , "Graham Dumpleton" sent:
> > >
> > > >Try following procedure documented in:
> > > >
> > > >
> >
> http://www.dscpl.com.au/wiki/ModPython/Articles/GettingModPythonWorking
> > > >
> > > >Do all the checks it talks about to make sure things are configured
> > correctly.
> > > >
> > > >Graham
> > > >
> > > >On 24/01/2008, Martha Zimet zimet@manray.com> wrote:
> > > >> I am having problems getting mod_python to work correctly.
> > > >> I am following the directions in
> > > >>
> >
> http://www.modpython.org/live/mod_python-3.2.8/doc-html/inst-testing.html
> > > >> and have written a mptest.py. However, when I access mptest.py from
> my
> > browser,
> > > >> the code does not execute and all I get is the text for mptest.py
> > > >> displaying in the browser window. For example:
> > > >>
> > > >> from mod_python import apache
> > > >>
> > > >> def handler(req):
> > > >> req.content_type = 'text/plain'
> > > >> req.write("Hello World!")
> > > >> return apache.OK
> > > >>
> > > >> Does anyone have any suggestions on what could be wrong with my
> > installation
> > > >> or how I can further diagnose this problem? Thanks in advance and I
> > apologize
> > > >> if this situation has been answered before.
> > > >>
> > > >>
> > > >>
> > > >>
> > > >>
> > > >>
> > > >>
> > > >> _______________________________________________
> > > >> Mod_python mailing list
> > > >> Mod_python@modpython.org
> > > >>
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> > > >>
> > >
> > >
> > >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
> >
> >
> > ________________________________
> > Never miss a thing. Make Yahoo your homepage.
> >
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
> >
>
>
>
> ________________________________
> Never miss a thing. Make Yahoo your homepage.
>
>


       
---------------------------------
Looking for last minute shopping deals?  Find them fast with Yahoo! Search.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080123/c6e200e6/attachment-0001.html
From graham.dumpleton at gmail.com  Wed Jan 23 17:45:45 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Wed Jan 23 17:45:56 2008
Subject: [mod_python] Problems with mod_python
In-Reply-To: <160114.25127.qm@web35513.mail.mud.yahoo.com>
References: <88e286470801231421r4087502fjd417bd7ef4a4efbd@mail.gmail.com>
	<160114.25127.qm@web35513.mail.mud.yahoo.com>
Message-ID: <88e286470801231445h64ed3612lb0ee7388b7b21e16@mail.gmail.com>

On 24/01/2008, Manjula Kumar <emailmanjula@yahoo.com> wrote:
> There is no version 2.7.11 under Windows.I could find only version 2.7.1.
> When I download the mod_python I gettting only the mod_python.dll file is
> this correct.
> Can i get mod_python.so and mod+python.c file also.Can anyone help regarding
> this problem.

The best solution is to get rid of Apache 1.3 and then install Apache
2.2 instead. It is highly unlikely that anyone would be running such
an ancient combination of Apache 1.3 and mod_python on Windows, so you
aren't probably going to get anyone who can provide what you want and
no one will probably want to help you sort out any issues either. Just
upgrade, it will solve you a lot of problems.

Graham

> I am runnning moin moin wiki
>
> Thanks,
> Manjula
>
> Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> On 24/01/2008, Manjula Kumar wrote:
> > Thanks Graham.Should I download this
> >
> > mp152dll.zip 18-Dec-2000 13:29 15k HTTP Server project
> >
> > which is at
> >
> http://www.alliedquotes.com/mirrors/apache/httpd/modpython/win/2.7.1/
>
> I said 2.7.11, not 2.7.1.
>
> If you are running Windows, which is suggested by the link you have
> decided to choose, then I would probably give up as running Apache 1.3
> on Windows is probably not a good idea.
>
> > I would like to download mod_python to redirect wiki to root name.
>
> Huh?
>
> What wiki? Why do you think you need mod_python for doing that?
>
> Graham
>
> > Please let me know whether the mod_python which I am trying to download is
> > proper version.
> >
> > Thanks,
> > Manjula
> > Graham Dumpleton wrote:
> > It is available from the downloads page of http://www.modpython.org.
> > You want version 2.7.11.
> >
> > If you want this not because you want to write mod_python specific
> > stuff, but because you want to run a WSGI compliant Python web
> > application on top, you are better off using mod_wsgi as older
> > mod_python versions have various bugs.
> >
> > Graham
> >
> > On 24/01/2008, Manjula Kumar wrote:
> > > Hi All,
> > > Can anyone please let me know where I can download mod_python for Apache
> > > 1.3.
> > >
> > > Thanks,
> > > Manjula
> > >
> > > Graham Dumpleton wrote:
> > > On 24/01/2008, Martha Zimet wrote:
> > > > I have followed your nstructions and I am still running into
> > > > the same problem, that is, only the source displays. I am running
> > > > mod_pyton version 3.1 have verified that is is indeed loaded
> > > > by checking the httpd error log per the document you referred
> > > > me to.
> > >
> > > Did you try the .htaccess method in those instructions rather than
> > > trying to do it in your main Apache configuration file?
> > >
> > > What operating system are you using?
> > >
> > > > Any more suggestions? My configuration file has the following:
> > > >
> > > >
> > >
> > > Is this what you have for real?
> > >
> > > The argument to the Directory directive is meant to be an actual
> > > physical directory, not a URL path component.
> > >
> > > Graham
> > >
> > > > AddHandler mod_python .py
> > > > PythonHandler mptest
> > > > PythonDebug On
> > > >
> > > >
> > > > I have tried it also with a /test directory with the same result.
> > > > Any light you can shed would be greatly appreciated.
> > > >
> > > > Regards,
> > > >
> > > > /martha
> > > >
> > > > On Thu Jan 24 6:30 , "Graham Dumpleton" sent:
> > > >
> > > > >Try following procedure documented in:
> > > > >
> > > > >
> > >
> >
> http://www.dscpl.com.au/wiki/ModPython/Articles/GettingModPythonWorking
> > > > >
> > > > >Do all the checks it talks about to make sure things are configured
> > > correctly.
> > > > >
> > > > >Graham
> > > > >
> > > > >On 24/01/2008, Martha Zimet zimet@manray.com> wrote:
> > > > >> I am having problems getting mod_python to work correctly.
> > > > >> I am following the directions in
> > > > >>
> > >
> >
> http://www.modpython.org/live/mod_python-3.2.8/doc-html/inst-testing.html
> > > > >> and have written a mptest.py. However, when I access mptest.py from
> > my
> > > browser,
> > > > >> the code does not execute and all I get is the text for mptest.py
> > > > >> displaying in the browser window. For example:
> > > > >>
> > > > >> from mod_python import apache
> > > > >>
> > > > >> def handler(req):
> > > > >> req.content_type = 'text/plain'
> > > > >> req.write("Hello World!")
> > > > >> return apache.OK
> > > > >>
> > > > >> Does anyone have any suggestions on what could be wrong with my
> > > installation
> > > > >> or how I can further diagnose this problem? Thanks in advance and I
> > > apologize
> > > > >> if this situation has been answered before.
> > > > >>
> > > > >>
> > > > >>
> > > > >>
> > > > >>
> > > > >>
> > > > >>
> > > > >> _______________________________________________
> > > > >> Mod_python mailing list
> > > > >> Mod_python@modpython.org
> > > > >>
> > >
> http://mailman.modpython.org/mailman/listinfo/mod_python
> > > > >>
> > > >
> > > >
> > > >
> > > _______________________________________________
> > > Mod_python mailing list
> > > Mod_python@modpython.org
> > >
> http://mailman.modpython.org/mailman/listinfo/mod_python
> > >
> > >
> > >
> > > ________________________________
> > > Never miss a thing. Make Yahoo your homepage.
> > >
> > >
> > > _______________________________________________
> > > Mod_python mailing list
> > > Mod_python@modpython.org
> > >
> http://mailman.modpython.org/mailman/listinfo/mod_python
> > >
> > >
> >
> >
> >
> > ________________________________
> > Never miss a thing. Make Yahoo your homepage.
> >
> >
>
>
>
>  ________________________________
> Looking for last minute shopping deals? Find them fast with Yahoo! Search.
>
>
From graham.dumpleton at gmail.com  Wed Jan 23 18:23:05 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Wed Jan 23 18:23:14 2008
Subject: [mod_python] Problems with mod_python
In-Reply-To: <46433.1201129787@manray.com>
References: <46433.1201129787@manray.com>
Message-ID: <88e286470801231523q2b3c890we288ae71f5bd2baa@mail.gmail.com>

The only other suggestion is to check the file permissions of the
.htaccess file. It must be readable to Apache user. Thus maybe you
need:

  chmod 0644 .htaccess

Graham

On 24/01/2008, Martha Zimet <zimet@manray.com> wrote:
> This is what *exactly* I have in my httpd.conf file in the
> Directory section after the Directory specification for the
> server root directory:
>
> <Directory "/srv/www/html/python">
>     AllowOverride FileInfo
> </Directory>
>
> I have tried many permutations, with and without double quotes,
> specifying All instead of FileInfo, trying different directory names, etc.
> No matter what I do, the .htaccess file is not being read at all.
>
> Thanks for all your help and I am sorry to be a bother.
>
> Regards,
>
> /martha
>
> On Thu Jan 24  9:31 , 'Graham Dumpleton' <graham.dumpleton@gmail.com> sent:
>
> >Just make sure you don't have multiple AllowOverride lines in the same
> >Directory context block as from memory they aren't cumulative. Thus a
> >later one will wipe out settings from an earlier one.
> >
> >Graham
> >
> >On 24/01/2008, Martha Zimet zimet@manray.com> wrote:
> >> It looks like .htacess is not being read and and I entered
> >> the AllowOverride FileInfo directive as you suggested. The
> >> directives were entered in the Directory section of httpd.conf.
> >>
> >> I will keep trying..
> >>
> >> Regards,
> >>
> >> /martha
> >>
> >> On Thu Jan 24  8:55 , "Graham Dumpleton"  sent:
> >>
> >> >For the .htaccess method did you validate that the .htaccess file was
> >> >actually being used by Apache? The easiest way to do this is to add
> >> >some crap in it to trigger a syntax error. This should cause a 500
> >> >error response to come back. So, add into your .htaccess file:
> >> >
> >> >  XXXX Some Crap XXXX
> >> >
> >> >If you don't get a 500 error, then you likely don't have FileInfo
> >> >override specified for that directory and so Apache is ignoring the
> >> >file.
> >> >
> >> >Graham
> >> >
> >> >On 24/01/2008, Martha Zimet zimet@manray.com> wrote:
> >> >> I am running Linux, kernel 2.6.22.
> >> >>
> >> >> I have tried the configuration methods using .htaccess and
> >> >> httpd.conf. I have tried using the complete path name
> >> >> in httpd.conf (the physical directory) as well. Your
> >> >> desscription in the first URL you sent was quite good.
> >> >>
> >> >> Regards,
> >> >>
> >> >> /martha
> >> >>
> >> >> On Thu Jan 24  7:24 , "Graham Dumpleton"  sent:
> >> >>
> >> >> >On 24/01/2008, Martha Zimet zimet@manray.com> wrote:
> >> >> >> I have followed your nstructions and I am still running into
> >> >> >> the same problem, that is, only the source displays. I am running
> >> >> >> mod_pyton version 3.1 have verified that is is indeed loaded
> >> >> >> by checking the httpd error log per the document you referred
> >> >> >> me to.
> >> >> >
> >> >> >Did you try the .htaccess method in those instructions rather than
> >> >> >trying to do it in your main Apache configuration file?
> >> >> >
> >> >> >What operating system are you using?
> >> >> >
> >> >> >> Any more suggestions? My configuration file has the following:
> >> >> >>
> >> >> >>
> >> >> >
> >> >> >Is this what you have for real?
> >> >> >
> >> >> >The argument to the Directory directive is meant to be an actual
> >> >> >physical directory, not a URL path component.
> >> >> >
> >> >> >Graham
> >> >> >
> >> >> >>     AddHandler mod_python .py
> >> >> >>     PythonHandler mptest
> >> >> >>     PythonDebug On
> >> >> >>
> >> >> >>
> >> >> >> I have tried it also with a /test directory with the same result.
> >> >> >> Any light you can shed would be greatly appreciated.
> >> >> >>
> >> >> >> Regards,
> >> >> >>
> >> >> >> /martha
> >> >> >>
> >> >> >> On Thu Jan 24  6:30 , "Graham Dumpleton"  sent:
> >> >> >>
> >> >> >> >Try following procedure documented in:
> >> >> >> >
> >> >> >> >  http://www.dscpl.com.au/wiki/ModPython/Articles/GettingModPythonWorking
> >> >> >> >
> >> >> >> >Do all the checks it talks about to make sure things are configured
> correctly.
> >> >> >> >
> >> >> >> >Graham
> >> >> >> >
> >> >> >> >On 24/01/2008, Martha Zimet zimet@manray.com> wrote:
> >> >> >> >> I am having problems getting mod_python to work correctly.
> >> >> >> >> I am following the directions in
> >> >> >> >> http://www.modpython.org/live/mod_python-3.2.8/doc-html/inst-testing.html
> >> >> >> >> and have written a mptest.py. However, when I access mptest.py from my
> >> browser,
> >> >> >> >> the code does not execute and all I get is the text for mptest.py
> >> >> >> >> displaying in the browser window. For example:
> >> >> >> >>
> >> >> >> >> from mod_python import apache
> >> >> >> >>
> >> >> >> >> def handler(req):
> >> >> >> >>     req.content_type = 'text/plain'
> >> >> >> >>     req.write("Hello World!")
> >> >> >> >>     return apache.OK
> >> >> >> >>
> >> >> >> >> Does anyone have any suggestions on what could be wrong with my
> installation
> >> >> >> >> or how I can further diagnose this problem? Thanks in advance and I
> >> apologize
> >> >> >> >> if this situation has been answered before.
> >> >> >> >>
> >> >> >> >>
> >> >> >> >>
> >> >> >> >>
> >> >> >> >>
> >> >> >> >>
> >> >> >> >>
> >> >> >> >> _______________________________________________
> >> >> >> >> Mod_python mailing list
> >> >> >> >> Mod_python@modpython.org
> >> >> >> >> http://mailman.modpython.org/mailman/listinfo/mod_python
> >> >> >> >>
> >> >> >>
> >> >> >>
> >> >> >>
> >> >>
> >> >>
> >> >>
> >>
> >>
> >>
>
>
>
From graham.dumpleton at gmail.com  Wed Jan 23 19:40:32 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Wed Jan 23 19:40:39 2008
Subject: [mod_python] Problems with mod_python
In-Reply-To: <52759.1201134205@manray.com>
References: <52759.1201134205@manray.com>
Message-ID: <88e286470801231640q311409bdp9c5b4a09f8b1705d@mail.gmail.com>

On 24/01/2008, Martha Zimet <zimet@manray.com> wrote:
> I got it working.. It was something weird. apapchectl restart did not
> seem to reread the httpd.conf file even though it acted like it did
> when I specified the -t option, When I did a apachectl stop and then
> apapchectl start it suddenly started to work.

Progress at least. :-)

> Now, I am getting this error:
>
> Mod_python error: "PythonHandler mptest"
>
> Traceback (most recent call last):
>
>   File "/usr/lib/python2.4/site-packages/mod_python/apache.py", line 287, in
> HandlerDispatch
>     log=debug)
>
>   File "/usr/lib/python2.4/site-packages/mod_python/apache.py", line 454, in
> import_module
>     f, p, d = imp.find_module(parts[i], path)
>
> ImportError: No module named mptest
>
> where mptest is the Python program I have specified as the handler.
> I am assuming that I need to do something with the PythonPath directive.
> Is that correct?

The directory context that the PythonHandler directive is specified in
should be automatically added to Python sys.path unless you have
already specified the PythonPath directive at some scope which
overrides that and thus disables the automatic addition of the path.

So, at the moment are you using main Apache configuration or .htaccess
for setting up PythonHandler directive? Can you show the latest
Directory configuration snippet and .htaccess files?

PS, please keep the discussion on the list. That way it is archived
and others can learn from it.

Graham

> Thanks again.
>
> Regards,
>
> /martha
>
> On Thu Jan 24 10:23 , 'Graham Dumpleton' <graham.dumpleton@gmail.com> sent:
>
> >The only other suggestion is to check the file permissions of the
> >.htaccess file. It must be readable to Apache user. Thus maybe you
> >need:
> >
> >  chmod 0644 .htaccess
> >
> >Graham
> >
> >On 24/01/2008, Martha Zimet zimet@manray.com> wrote:
> >> This is what *exactly* I have in my httpd.conf file in the
> >> Directory section after the Directory specification for the
> >> server root directory:
> >>
> >>
> >>     AllowOverride FileInfo
> >>
> >>
> >> I have tried many permutations, with and without double quotes,
> >> specifying All instead of FileInfo, trying different directory names, etc.
> >> No matter what I do, the .htaccess file is not being read at all.
> >>
> >> Thanks for all your help and I am sorry to be a bother.
> >>
> >> Regards,
> >>
> >> /martha
> >>
> >> On Thu Jan 24  9:31 , 'Graham Dumpleton' graham.dumpleton@gmail.com> sent:
> >>
> >> >Just make sure you don't have multiple AllowOverride lines in the same
> >> >Directory context block as from memory they aren't cumulative. Thus a
> >> >later one will wipe out settings from an earlier one.
> >> >
> >> >Graham
> >> >
> >> >On 24/01/2008, Martha Zimet zimet@manray.com> wrote:
> >> >> It looks like .htacess is not being read and and I entered
> >> >> the AllowOverride FileInfo directive as you suggested. The
> >> >> directives were entered in the Directory section of httpd.conf.
> >> >>
> >> >> I will keep trying..
> >> >>
> >> >> Regards,
> >> >>
> >> >> /martha
> >> >>
> >> >> On Thu Jan 24  8:55 , "Graham Dumpleton"  sent:
> >> >>
> >> >> >For the .htaccess method did you validate that the .htaccess file was
> >> >> >actually being used by Apache? The easiest way to do this is to add
> >> >> >some crap in it to trigger a syntax error. This should cause a 500
> >> >> >error response to come back. So, add into your .htaccess file:
> >> >> >
> >> >> >  XXXX Some Crap XXXX
> >> >> >
> >> >> >If you don't get a 500 error, then you likely don't have FileInfo
> >> >> >override specified for that directory and so Apache is ignoring the
> >> >> >file.
> >> >> >
> >> >> >Graham
> >> >> >
> >> >> >On 24/01/2008, Martha Zimet zimet@manray.com> wrote:
> >> >> >> I am running Linux, kernel 2.6.22.
> >> >> >>
> >> >> >> I have tried the configuration methods using .htaccess and
> >> >> >> httpd.conf. I have tried using the complete path name
> >> >> >> in httpd.conf (the physical directory) as well. Your
> >> >> >> desscription in the first URL you sent was quite good.
> >> >> >>
> >> >> >> Regards,
> >> >> >>
> >> >> >> /martha
> >> >> >>
> >> >> >> On Thu Jan 24  7:24 , "Graham Dumpleton"  sent:
> >> >> >>
> >> >> >> >On 24/01/2008, Martha Zimet zimet@manray.com> wrote:
> >> >> >> >> I have followed your nstructions and I am still running into
> >> >> >> >> the same problem, that is, only the source displays. I am running
> >> >> >> >> mod_pyton version 3.1 have verified that is is indeed loaded
> >> >> >> >> by checking the httpd error log per the document you referred
> >> >> >> >> me to.
> >> >> >> >
> >> >> >> >Did you try the .htaccess method in those instructions rather than
> >> >> >> >trying to do it in your main Apache configuration file?
> >> >> >> >
> >> >> >> >What operating system are you using?
> >> >> >> >
> >> >> >> >> Any more suggestions? My configuration file has the following:
> >> >> >> >>
> >> >> >> >>
> >> >> >> >
> >> >> >> >Is this what you have for real?
> >> >> >> >
> >> >> >> >The argument to the Directory directive is meant to be an actual
> >> >> >> >physical directory, not a URL path component.
> >> >> >> >
> >> >> >> >Graham
> >> >> >> >
> >> >> >> >>     AddHandler mod_python .py
> >> >> >> >>     PythonHandler mptest
> >> >> >> >>     PythonDebug On
> >> >> >> >>
> >> >> >> >>
> >> >> >> >> I have tried it also with a /test directory with the same result.
> >> >> >> >> Any light you can shed would be greatly appreciated.
> >> >> >> >>
> >> >> >> >> Regards,
> >> >> >> >>
> >> >> >> >> /martha
> >> >> >> >>
> >> >> >> >> On Thu Jan 24  6:30 , "Graham Dumpleton"  sent:
> >> >> >> >>
> >> >> >> >> >Try following procedure documented in:
> >> >> >> >> >
> >> >> >> >> >
> http://www.dscpl.com.au/wiki/ModPython/Articles/GettingModPythonWorking
> >> >> >> >> >
> >> >> >> >> >Do all the checks it talks about to make sure things are configured
> >> correctly.
> >> >> >> >> >
> >> >> >> >> >Graham
> >> >> >> >> >
> >> >> >> >> >On 24/01/2008, Martha Zimet zimet@manray.com> wrote:
> >> >> >> >> >> I am having problems getting mod_python to work correctly.
> >> >> >> >> >> I am following the directions in
> >> >> >> >> >>
> http://www.modpython.org/live/mod_python-3.2.8/doc-html/inst-testing.html
> >> >> >> >> >> and have written a mptest.py. However, when I access mptest.py from my
> >> >> browser,
> >> >> >> >> >> the code does not execute and all I get is the text for mptest.py
> >> >> >> >> >> displaying in the browser window. For example:
> >> >> >> >> >>
> >> >> >> >> >> from mod_python import apache
> >> >> >> >> >>
> >> >> >> >> >> def handler(req):
> >> >> >> >> >>     req.content_type = 'text/plain'
> >> >> >> >> >>     req.write("Hello World!")
> >> >> >> >> >>     return apache.OK
> >> >> >> >> >>
> >> >> >> >> >> Does anyone have any suggestions on what could be wrong with my
> >> installation
> >> >> >> >> >> or how I can further diagnose this problem? Thanks in advance and I
> >> >> apologize
> >> >> >> >> >> if this situation has been answered before.
> >> >> >> >> >>
> >> >> >> >> >>
> >> >> >> >> >>
> >> >> >> >> >>
> >> >> >> >> >>
> >> >> >> >> >>
> >> >> >> >> >>
> >> >> >> >> >> _______________________________________________
> >> >> >> >> >> Mod_python mailing list
> >> >> >> >> >> Mod_python@modpython.org
> >> >> >> >> >> http://mailman.modpython.org/mailman/listinfo/mod_python
> >> >> >> >> >>
> >> >> >> >>
> >> >> >> >>
> >> >> >> >>
> >> >> >>
> >> >> >>
> >> >> >>
> >> >>
> >> >>
> >> >>
> >>
> >>
> >>
>
>
>
From zimet at manray.com  Wed Jan 23 19:59:05 2008
From: zimet at manray.com (Martha Zimet)
Date: Wed Jan 23 19:59:44 2008
Subject: [mod_python] Problems with mod_python
Message-ID: <33037.1201136345@manray.com>

It's working fine now. I had a PythonPath directive
which was getting in the way.

I am running things through the .htaccess methodology
that you suggested in the first URL you sent me. I
think this will work fine for me for the long term
as well. 

This is what I have in my http.conf file:

<Directory /srv/www/html/python>
    AllowOverride FileInfo
</Directory>

This is what I have in my .htaccess file in the directory:

AddHandler mod_python .py
PythonHandler mptest
PythonDebug On

Thanks again for all your help. Now, I have to figure
out how to get PyGresSQL working correctly. 

Regards,

/martha

On Thu Jan 24 11:40 , "Graham Dumpleton"  sent:

>On 24/01/2008, Martha Zimet zimet@manray.com> wrote:
>> I got it working.. It was something weird. apapchectl restart did not
>> seem to reread the httpd.conf file even though it acted like it did
>> when I specified the -t option, When I did a apachectl stop and then
>> apapchectl start it suddenly started to work.
>
>Progress at least. :-)
>
>> Now, I am getting this error:
>>
>> Mod_python error: "PythonHandler mptest"
>>
>> Traceback (most recent call last):
>>
>>   File "/usr/lib/python2.4/site-packages/mod_python/apache.py", line 287, in
>> HandlerDispatch
>>     log=debug)
>>
>>   File "/usr/lib/python2.4/site-packages/mod_python/apache.py", line 454, in
>> import_module
>>     f, p, d = imp.find_module(parts[i], path)
>>
>> ImportError: No module named mptest
>>
>> where mptest is the Python program I have specified as the handler.
>> I am assuming that I need to do something with the PythonPath directive.
>> Is that correct?
>
>The directory context that the PythonHandler directive is specified in
>should be automatically added to Python sys.path unless you have
>already specified the PythonPath directive at some scope which
>overrides that and thus disables the automatic addition of the path.
>
>So, at the moment are you using main Apache configuration or .htaccess
>for setting up PythonHandler directive? Can you show the latest
>Directory configuration snippet and .htaccess files?
>
>PS, please keep the discussion on the list. That way it is archived
>and others can learn from it.
>
>Graham
>
>> Thanks again.
>>
>> Regards,
>>
>> /martha
>>
>> On Thu Jan 24 10:23 , 'Graham Dumpleton' graham.dumpleton@gmail.com> sent:
>>
>> >The only other suggestion is to check the file permissions of the
>> >.htaccess file. It must be readable to Apache user. Thus maybe you
>> >need:
>> >
>> >  chmod 0644 .htaccess
>> >
>> >Graham
>> >
>> >On 24/01/2008, Martha Zimet zimet@manray.com> wrote:
>> >> This is what *exactly* I have in my httpd.conf file in the
>> >> Directory section after the Directory specification for the
>> >> server root directory:
>> >>
>> >>
>> >>     AllowOverride FileInfo
>> >>
>> >>
>> >> I have tried many permutations, with and without double quotes,
>> >> specifying All instead of FileInfo, trying different directory names, etc.
>> >> No matter what I do, the .htaccess file is not being read at all.
>> >>
>> >> Thanks for all your help and I am sorry to be a bother.
>> >>
>> >> Regards,
>> >>
>> >> /martha
>> >>
>> >> On Thu Jan 24  9:31 , 'Graham Dumpleton' graham.dumpleton@gmail.com> sent:
>> >>
>> >> >Just make sure you don't have multiple AllowOverride lines in the same
>> >> >Directory context block as from memory they aren't cumulative. Thus a
>> >> >later one will wipe out settings from an earlier one.
>> >> >
>> >> >Graham
>> >> >
>> >> >On 24/01/2008, Martha Zimet zimet@manray.com> wrote:
>> >> >> It looks like .htacess is not being read and and I entered
>> >> >> the AllowOverride FileInfo directive as you suggested. The
>> >> >> directives were entered in the Directory section of httpd.conf.
>> >> >>
>> >> >> I will keep trying..
>> >> >>
>> >> >> Regards,
>> >> >>
>> >> >> /martha
>> >> >>
>> >> >> On Thu Jan 24  8:55 , "Graham Dumpleton"  sent:
>> >> >>
>> >> >> >For the .htaccess method did you validate that the .htaccess file was
>> >> >> >actually being used by Apache? The easiest way to do this is to add
>> >> >> >some crap in it to trigger a syntax error. This should cause a 500
>> >> >> >error response to come back. So, add into your .htaccess file:
>> >> >> >
>> >> >> >  XXXX Some Crap XXXX
>> >> >> >
>> >> >> >If you don't get a 500 error, then you likely don't have FileInfo
>> >> >> >override specified for that directory and so Apache is ignoring the
>> >> >> >file.
>> >> >> >
>> >> >> >Graham
>> >> >> >
>> >> >> >On 24/01/2008, Martha Zimet zimet@manray.com> wrote:
>> >> >> >> I am running Linux, kernel 2.6.22.
>> >> >> >>
>> >> >> >> I have tried the configuration methods using .htaccess and
>> >> >> >> httpd.conf. I have tried using the complete path name
>> >> >> >> in httpd.conf (the physical directory) as well. Your
>> >> >> >> desscription in the first URL you sent was quite good.
>> >> >> >>
>> >> >> >> Regards,
>> >> >> >>
>> >> >> >> /martha
>> >> >> >>
>> >> >> >> On Thu Jan 24  7:24 , "Graham Dumpleton"  sent:
>> >> >> >>
>> >> >> >> >On 24/01/2008, Martha Zimet zimet@manray.com> wrote:
>> >> >> >> >> I have followed your nstructions and I am still running into
>> >> >> >> >> the same problem, that is, only the source displays. I am running
>> >> >> >> >> mod_pyton version 3.1 have verified that is is indeed loaded
>> >> >> >> >> by checking the httpd error log per the document you referred
>> >> >> >> >> me to.
>> >> >> >> >
>> >> >> >> >Did you try the .htaccess method in those instructions rather than
>> >> >> >> >trying to do it in your main Apache configuration file?
>> >> >> >> >
>> >> >> >> >What operating system are you using?
>> >> >> >> >
>> >> >> >> >> Any more suggestions? My configuration file has the following:
>> >> >> >> >>
>> >> >> >> >>
>> >> >> >> >
>> >> >> >> >Is this what you have for real?
>> >> >> >> >
>> >> >> >> >The argument to the Directory directive is meant to be an actual
>> >> >> >> >physical directory, not a URL path component.
>> >> >> >> >
>> >> >> >> >Graham
>> >> >> >> >
>> >> >> >> >>     AddHandler mod_python .py
>> >> >> >> >>     PythonHandler mptest
>> >> >> >> >>     PythonDebug On
>> >> >> >> >>
>> >> >> >> >>
>> >> >> >> >> I have tried it also with a /test directory with the same result.
>> >> >> >> >> Any light you can shed would be greatly appreciated.
>> >> >> >> >>
>> >> >> >> >> Regards,
>> >> >> >> >>
>> >> >> >> >> /martha
>> >> >> >> >>
>> >> >> >> >> On Thu Jan 24  6:30 , "Graham Dumpleton"  sent:
>> >> >> >> >>
>> >> >> >> >> >Try following procedure documented in:
>> >> >> >> >> >
>> >> >> >> >> >
>> http://www.dscpl.com.au/wiki/ModPython/Articles/GettingModPythonWorking
>> >> >> >> >> >
>> >> >> >> >> >Do all the checks it talks about to make sure things are configured
>> >> correctly.
>> >> >> >> >> >
>> >> >> >> >> >Graham
>> >> >> >> >> >
>> >> >> >> >> >On 24/01/2008, Martha Zimet zimet@manray.com> wrote:
>> >> >> >> >> >> I am having problems getting mod_python to work correctly.
>> >> >> >> >> >> I am following the directions in
>> >> >> >> >> >>
>> http://www.modpython.org/live/mod_python-3.2.8/doc-html/inst-testing.html
>> >> >> >> >> >> and have written a mptest.py. However, when I access mptest.py
from my
>> >> >> browser,
>> >> >> >> >> >> the code does not execute and all I get is the text for mptest.py
>> >> >> >> >> >> displaying in the browser window. For example:
>> >> >> >> >> >>
>> >> >> >> >> >> from mod_python import apache
>> >> >> >> >> >>
>> >> >> >> >> >> def handler(req):
>> >> >> >> >> >>     req.content_type = 'text/plain'
>> >> >> >> >> >>     req.write("Hello World!")
>> >> >> >> >> >>     return apache.OK
>> >> >> >> >> >>
>> >> >> >> >> >> Does anyone have any suggestions on what could be wrong with my
>> >> installation
>> >> >> >> >> >> or how I can further diagnose this problem? Thanks in advance and I
>> >> >> apologize
>> >> >> >> >> >> if this situation has been answered before.
>> >> >> >> >> >>
>> >> >> >> >> >>
>> >> >> >> >> >>
>> >> >> >> >> >>
>> >> >> >> >> >>
>> >> >> >> >> >>
>> >> >> >> >> >>
>> >> >> >> >> >> _______________________________________________
>> >> >> >> >> >> Mod_python mailing list
>> >> >> >> >> >> Mod_python@modpython.org
>> >> >> >> >> >> http://mailman.modpython.org/mailman/listinfo/mod_python
>> >> >> >> >> >>
>> >> >> >> >>
>> >> >> >> >>
>> >> >> >> >>
>> >> >> >>
>> >> >> >>
>> >> >> >>
>> >> >>
>> >> >>
>> >> >>
>> >>
>> >>
>> >>
>>
>>
>>



From matusis at yahoo.com  Thu Jan 24 00:59:02 2008
From: matusis at yahoo.com (Alec Matusis)
Date: Thu Jan 24 00:59:21 2008
Subject: [mod_python] remnant 'orphan' apache subprocesses
In-Reply-To: <88e286470801222036v243707c4q40ee44432c2cfae@mail.gmail.com>
References: <107401c85cb5$7eb44b00$7c1ce100$@com>	
	<000301c85d5e$2f7ba340$8e72e9c0$@com>	
	<88e286470801221749u3be1eccbh67e54b2a645929e8@mail.gmail.com>	
	<001101c85d63$47c2bfb0$d7483f10$@com>	
	<88e286470801221804t3a5294b0v9f535c9e935cb4d0@mail.gmail.com>	
	<001b01c85d66$90ccd710$b2668530$@com>	
	<88e286470801221835p73059c6bi4b7e8ba114e45565@mail.gmail.com>	
	<002601c85d6a$96f982b0$c4ec8810$@com>	
	<88e286470801221900y38ea415cta2d15fd78b0f66d8@mail.gmail.com>	
	<003a01c85d6f$2f333fe0$8d99bfa0$@com>
	<88e286470801222036v243707c4q40ee44432c2cfae@mail.gmail.com>
Message-ID: <038f01c85e4e$3b04f5e0$b10ee1a0$@com>

> Which almost suggests it was actually a fork of an Apache child
> process as that is possibly only way the other threads could have been
> killed off.

I think this is right. I caught this evidence:

# ps -ef | grep http  
root     16197     1  0 Jan21 ?
nobody     787 16197  9 18:06 ?
nobody    1096 16197  9 18:09 ?
nobody    1240 16197  8 18:12 ?
nobody    1389 16197  8 18:13 ?
nobody    1525 16197  9 18:14 ?
nobody    1732  1525  0 18:16 ?
....

Note pid 1732 with 0 CPU total being a child of a sub process (pid 1525)
20 minutes later, the parent sub process pid 1525 exited, and pid 1732
became an orphan:

# ps -ef | grep http  
root     16197     1  0 Jan21 ? 
nobody    1732     1  0 18:16 ? 
nobody    9895 16197  6 20:07 ?
.....

> I can't find though any evidence of fork() being used direct in PIL
> code at least, but then the popen2 module uses fork() in Popen3 and
> Popen4 classes.

I found that we send email like this:

try:
     handle = os.popen2('/usr/sbin/sendmail.postfix -f mailzero -t')
     handle[0].write(msg)
     handle[0].write("\n.\n")
 finally :
     if handle:
         handle[0].close()
         handle[1].close()

Could this be the culprit?

PS. I finally obtained lsof for an orphan:

# lsof -p 552
COMMAND PID   USER   FD   TYPE DEVICE     SIZE                 NODE NAME
httpd   552 nobody  cwd    DIR    3,1      560                    2 /
httpd   552 nobody  rtd    DIR    3,1      560                    2 /
httpd   552 nobody  txt    REG    3,3  1459487               120154
/web10/encap/httpd-2.2.6/bin/httpd
httpd   552 nobody  mem    REG    3,1   108173                10583
/lib64/ld-2.3.4.so
httpd   552 nobody  mem    REG    3,1   208464                13742
/usr/lib/locale/en_US.utf8/LC_CTYPE
httpd   552 nobody  mem    REG    3,1    21546                67725
/usr/lib64/gconv/gconv-modules.cache
httpd   552 nobody  mem    REG    3,1   422191               149865
/lib64/tls/libm.so.6
httpd   552 nobody  mem    REG    3,3   359952               120180
/web10/encap/httpd-2.2.6/lib/libaprutil-1.so.0.2.11
httpd   552 nobody  mem    REG    3,3   399356                86545
/web10/encap/expat-1.95.8/lib/libexpat.so.0.5.0
httpd   552 nobody  mem    REG    3,3   644280               120177
/web10/encap/httpd-2.2.6/lib/libapr-1.so.0.2.11
httpd   552 nobody  mem    REG    3,1    44393               149867
/lib64/tls/librt.so.1
httpd   552 nobody  mem    REG    3,1    49785                10590
/lib64/libcrypt.so.1
httpd   552 nobody  mem    REG    3,1   104333               149866
/lib64/tls/libpthread.so.0
httpd   552 nobody  mem    REG    3,1    15367               149856
/lib64/libdl.so.2
httpd   552 nobody  mem    REG    3,1  1446783               149864
/lib64/tls/libc.so.6
httpd   552 nobody  mem    REG    3,3    32293               120510
/web10/encap/httpd-2.2.6/modules/mod_authz_host.so
httpd   552 nobody  mem    REG    3,3    49742               120526
/web10/encap/httpd-2.2.6/modules/mod_mime.so
httpd   552 nobody  mem    REG    3,3    80479               120514
/web10/encap/httpd-2.2.6/modules/mod_log_config.so
httpd   552 nobody  mem    REG    3,3    41745               120525
/web10/encap/httpd-2.2.6/modules/mod_alias.so
httpd   552 nobody  mem    REG    3,3    29404               120540
/web10/encap/httpd-2.2.6/modules/mod_env.so
httpd   552 nobody  mem    REG    3,3    38369               120492
/web10/encap/httpd-2.2.6/modules/mod_setenvif.so
httpd   552 nobody  mem    REG    3,3   104277               120499
/web10/encap/httpd-2.2.6/modules/mod_negotiation.so
httpd   552 nobody  mem    REG    3,3   146518               120535
/web10/encap/httpd-2.2.6/modules/mod_rewrite.so
httpd   552 nobody  mem    REG    3,3    52083               120520
/web10/encap/httpd-2.2.6/modules/mod_status.so
httpd   552 nobody  mem    REG    3,3    52373               120503
/web10/encap/httpd-2.2.6/modules/mod_info.so
httpd   552 nobody  mem    REG    3,3  4984833               120515
/web10/encap/httpd-2.2.6/modules/mod_python.so
httpd   552 nobody  mem    REG    3,1    14784                10606
/lib64/libutil.so.1
httpd   552 nobody  mem    REG    3,3    38039               120494
/web10/encap/httpd-2.2.6/modules/mod_expires.so
httpd   552 nobody  mem    REG    3,1   217016                69589
/var/run/nscd/passwd
httpd   552 nobody  mem    REG    3,1   217016                69590
/var/run/nscd/group
httpd   552 nobody  DEL    REG    3,1                         69591
/var/run/nscd/dbMxLNyI
httpd   552 nobody  DEL    REG    0,7          18446744073632515035
/dev/zero
httpd   552 nobody  mem    REG    3,1    46664                16459
/lib64/libgcc_s.so.1
httpd   552 nobody  mem    REG    3,3    49339                 2814
/web10/encap/Python-2.4.1/lib/python2.4/lib-dynload/time.so
httpd   552 nobody  mem    REG    3,3    70274                 2838
/web10/encap/Python-2.4.1/lib/python2.4/lib-dynload/strop.so
httpd   552 nobody  mem    REG    3,3   101469                 2839
/web10/encap/Python-2.4.1/lib/python2.4/lib-dynload/itertools.so
httpd   552 nobody  mem    REG    3,3    54133                 2791
/web10/encap/Python-2.4.1/lib/python2.4/lib-dynload/cStringIO.so
httpd   552 nobody  mem    REG    3,3   138480                 2837
/web10/encap/Python-2.4.1/lib/python2.4/lib-dynload/_socket.so
httpd   552 nobody  mem    REG    3,3    74923                 2819
/web10/encap/Python-2.4.1/lib/python2.4/lib-dynload/_ssl.so
httpd   552 nobody  mem    REG    3,1   245682               141938
/usr/lib64/libssl.so.0.9.7
httpd   552 nobody  mem    REG    3,1  1441278                59209
/usr/lib64/libcrypto.so.0.9.7
httpd   552 nobody  mem    REG    3,3    46577                 2811
/web10/encap/Python-2.4.1/lib/python2.4/lib-dynload/math.so
httpd   552 nobody  mem    REG    3,3    56810                 2833
/web10/encap/Python-2.4.1/lib/python2.4/lib-dynload/binascii.so
httpd   552 nobody  mem    REG    3,3    36773                 2818
/web10/encap/Python-2.4.1/lib/python2.4/lib-dynload/_random.so
httpd   552 nobody  mem    REG    3,3    37259                 2821
/web10/encap/Python-2.4.1/lib/python2.4/lib-dynload/fcntl.so
httpd   552 nobody  mem    REG    3,3    62744                 2803
/web10/encap/Python-2.4.1/lib/python2.4/lib-dynload/collections.so
httpd   552 nobody  mem    REG    3,3    21960                 2807
/web10/encap/Python-2.4.1/lib/python2.4/lib-dynload/syslog.so
httpd   552 nobody  mem    REG    3,3    82224                 2802
/web10/encap/Python-2.4.1/lib/python2.4/lib-dynload/struct.so
httpd   552 nobody  mem    REG    3,3   264023                 2815
/web10/encap/Python-2.4.1/lib/python2.4/lib-dynload/datetime.so
httpd   552 nobody  mem    REG    3,3    34866                 2823
/web10/encap/Python-2.4.1/lib/python2.4/lib-dynload/md5.so
httpd   552 nobody  mem    REG    3,3    34443                 2827
/web10/encap/Python-2.4.1/lib/python2.4/lib-dynload/sha.so
httpd   552 nobody  mem    REG    3,3    28020                 2832
/web10/encap/Python-2.4.1/lib/python2.4/lib-dynload/_bisect.so
httpd   552 nobody  mem    REG    3,3    21455                 2795
/web10/encap/Python-2.4.1/lib/python2.4/lib-dynload/_weakref.so
httpd   552 nobody  mem    REG    3,3   154790               135012
/web10/encap/MySQL-python-1.2.0/lib/python2.4/site-packages/_mysql.so
httpd   552 nobody  mem    REG    3,3   477383               133941
/web10/encap/mysql-4.1.15/lib/mysql/libmysqlclient_r.so.14.0.0
httpd   552 nobody  mem    REG    3,3    95574               133804
/web10/encap/mysql-4.1.15/lib/mysql/libz.so.0.0.0
httpd   552 nobody  mem    REG    3,1   101209                10594
/lib64/libnsl.so.1
httpd   552 nobody  mem    REG    3,3   119746                 2831
/web10/encap/Python-2.4.1/lib/python2.4/lib-dynload/array.so
httpd   552 nobody  mem    REG    3,1    53431               149860
/lib64/libnss_files.so.2
httpd   552 nobody  mem    REG    3,3    28411                 9381
/web10/encap/Cheetah-0.9.15-nogeninfo/lib/python2.4/site-packages/Cheetah/_n
amemapper.so
httpd   552 nobody  mem    REG    3,3    76289                 9344
/web10/encap/pycrypto-2.0.1/lib/python2.4/site-packages/Crypto/Cipher/DES3.s
o
httpd   552 nobody  mem    REG    3,3   940471                 9223
/web10/encap/Imaging-1.1.5/lib/python2.4/site-packages/PIL/_imaging.so
httpd   552 nobody  mem    REG    3,1   137928                14016
/usr/lib64/libjpeg.so.62.0.0
httpd   552 nobody  mem    REG    3,1    77960                14723
/lib64/libz.so.1.2.2
httpd   552 nobody  mem    REG    3,3    64166                 2843
/web10/encap/Python-2.4.1/lib/python2.4/lib-dynload/operator.so
httpd   552 nobody  mem    REG    3,3    44969                 9267
/web10/encap/Imaging-1.1.5/lib/python2.4/site-packages/PIL/_imagingft.so
httpd   552 nobody  mem    REG    3,1   588288               130060
/usr/lib64/libfreetype.so.6.3.7
httpd   552 nobody  mem    REG    3,3    56595                 2813
/web10/encap/Python-2.4.1/lib/python2.4/lib-dynload/zlib.so
httpd   552 nobody    0r  FIFO    0,5                    4292655466 pipe
httpd   552 nobody    1w  FIFO    0,5                    4292655467 pipe
httpd   552 nobody    2w   REG    3,3 21074695                86518
/web10/web/logs/web10_error_log





> -----Original Message-----
> From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> Sent: Tuesday, January 22, 2008 8:36 PM
> To: Alec Matusis
> Cc: mod_python@modpython.org
> Subject: Re: [mod_python] remnant 'orphan' apache subprocesses
> 
> On 23/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > Hmmm, there should have been 39 other stack traces, one for each
> > > worker thread based on your Apache configuration.
> >
> > Looks like it has only one thread:
> 
> Which almost suggests it was actually a fork of an Apache child
> process as that is possibly only way the other threads could have been
> killed off. This would sort of sit with idea that some code had tried
> to further fork and daemonise the process. This is the only thing that
> seems to fit at the moment.
> 
> I can't find though any evidence of fork() being used direct in PIL
> code at least, but then the popen2 module uses fork() in Popen3 and
> Popen4 classes. Again, PIL, although it uses os.popen() doesn't use
> popen2 module. Also, that doesn't involved setsid(). The only place in
> standard Python modules that appears to use setsid() is pty.fork() and
> PIL doesn't use that.
> 
> All I can suggest is you might in your loaded application dump out
> sys.modules and see if anything has imported pty module. Otherwise
> troll through all the Python code you know is used and see if anything
> for whatever reason uses fork(), setsid(), popen2 module, or
> pty.fork(). More nasty would be a C extension module doing forks and
> trying to do Python stuff in forked process but not doing necessary
> Python cleanup after the fork. Would have expected to see a C
> extension module stack frame in traceback if that was the case though.
> 
> Anyway, running out of ideas.
> 
> Graham
> 
> > Orphaned sub process:
> >
> > # ps -mTp 3812
> >   PID  SPID TTY          TIME CMD
> >  3812     - ?        00:00:00 httpd
> >     -  3812 -        00:00:00 -
> >
> > Normal sub-process:
> >
> > # ps -mTp 20205
> >   PID  SPID TTY          TIME CMD
> > 20205     - ?        00:00:10 httpd
> >     - 20205 -        00:00:00 -
> >     - 20207 -        00:00:00 -
> >     - 20208 -        00:00:00 -
> >     - 20209 -        00:00:00 -
> >     - 20210 -        00:00:00 -
> >     - 20211 -        00:00:00 -
> >     - 20212 -        00:00:00 -
> >     - 20213 -        00:00:00 -
> >     - 20214 -        00:00:00 -
> >     - 20215 -        00:00:00 -
> >     - 20216 -        00:00:00 -
> >     - 20217 -        00:00:00 -
> >     - 20218 -        00:00:00 -
> >     - 20219 -        00:00:00 -
> >     - 20220 -        00:00:00 -
> >     - 20221 -        00:00:00 -
> >     - 20222 -        00:00:00 -
> >     - 20223 -        00:00:00 -
> >     - 20224 -        00:00:00 -
> >     - 20225 -        00:00:00 -
> >     - 20226 -        00:00:00 -
> >     - 20227 -        00:00:00 -
> >     - 20228 -        00:00:00 -
> >     - 20229 -        00:00:00 -
> >     - 20230 -        00:00:00 -
> >     - 20231 -        00:00:00 -
> >     - 20232 -        00:00:00 -
> >     - 20233 -        00:00:00 -
> >     - 20234 -        00:00:00 -
> >     - 20235 -        00:00:00 -
> >     - 20236 -        00:00:00 -
> >     - 20237 -        00:00:00 -
> >     - 20238 -        00:00:00 -
> >     - 20239 -        00:00:00 -
> >     - 20240 -        00:00:00 -
> >     - 20241 -        00:00:00 -
> >     - 20242 -        00:00:00 -
> >     - 20243 -        00:00:00 -
> >     - 20244 -        00:00:00 -
> >     - 20245 -        00:00:00 -
> >     - 20246 -        00:00:00 -
> >     - 20247 -        00:00:00 -
> >
> >
> > > -----Original Message-----
> > > From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> > > Sent: Tuesday, January 22, 2008 7:00 PM
> > > To: Alec Matusis
> > > Cc: mod_python@modpython.org
> > > Subject: Re: [mod_python] remnant 'orphan' apache subprocesses
> > >
> > > On 23/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > > > > (gdb) thread apply all bt
> > > >
> > > > Thread 1 (Thread 1111562592 (LWP 3812)):
> > > > #0  0x00002aaaab2c94df in sem_wait () from
> /lib64/tls/libpthread.so.0
> > > > #1  0x00002aaaac204dcd in PyThread_acquire_lock (lock=0x5b7820,
> > > waitflag=1)
> > >
> > > Hmmm, there should have been 39 other stack traces, one for each
> > > worker thread based on your Apache configuration.
> > >
> > > Don't necessarily post them all, but you should look and see what
> is
> > > in frame #0 for all of them and see if there is anything odd such
> as
> > > one blocking in a call out to some external C library. If no such
> > > thing and they are all stuck on Python mutex locks, then must be
> > > internal deadlock.
> > >
> > > This still doesn't explain though how the process has been
> associated
> > > with PPID of 1, which would  still only seem possible if something
> had
> > > tried to daemonise process.
> > >
> > > Graham
> > >
> > > Graham
> >
> >

From graham.dumpleton at gmail.com  Thu Jan 24 02:16:37 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu Jan 24 02:16:46 2008
Subject: [mod_python] remnant 'orphan' apache subprocesses
In-Reply-To: <038f01c85e4e$3b04f5e0$b10ee1a0$@com>
References: <107401c85cb5$7eb44b00$7c1ce100$@com>
	<001101c85d63$47c2bfb0$d7483f10$@com>
	<88e286470801221804t3a5294b0v9f535c9e935cb4d0@mail.gmail.com>
	<001b01c85d66$90ccd710$b2668530$@com>
	<88e286470801221835p73059c6bi4b7e8ba114e45565@mail.gmail.com>
	<002601c85d6a$96f982b0$c4ec8810$@com>
	<88e286470801221900y38ea415cta2d15fd78b0f66d8@mail.gmail.com>
	<003a01c85d6f$2f333fe0$8d99bfa0$@com>
	<88e286470801222036v243707c4q40ee44432c2cfae@mail.gmail.com>
	<038f01c85e4e$3b04f5e0$b10ee1a0$@com>
Message-ID: <88e286470801232316m700d4785tf800a5a87deeee09@mail.gmail.com>

On 24/01/2008, Alec Matusis <matusis@yahoo.com> wrote:
> > Which almost suggests it was actually a fork of an Apache child
> > process as that is possibly only way the other threads could have been
> > killed off.
>
> I think this is right. I caught this evidence:
>
> # ps -ef | grep http
> root     16197     1  0 Jan21 ?
> nobody     787 16197  9 18:06 ?
> nobody    1096 16197  9 18:09 ?
> nobody    1240 16197  8 18:12 ?
> nobody    1389 16197  8 18:13 ?
> nobody    1525 16197  9 18:14 ?
> nobody    1732  1525  0 18:16 ?
> ....
>
> Note pid 1732 with 0 CPU total being a child of a sub process (pid 1525)
> 20 minutes later, the parent sub process pid 1525 exited, and pid 1732
> became an orphan:
>
> # ps -ef | grep http
> root     16197     1  0 Jan21 ?
> nobody    1732     1  0 18:16 ?
> nobody    9895 16197  6 20:07 ?
> .....
>
> > I can't find though any evidence of fork() being used direct in PIL
> > code at least, but then the popen2 module uses fork() in Popen3 and
> > Popen4 classes.
>
> I found that we send email like this:
>
> try:
>      handle = os.popen2('/usr/sbin/sendmail.postfix -f mailzero -t')
>      handle[0].write(msg)
>      handle[0].write("\n.\n")
>  finally :
>      if handle:
>          handle[0].close()
>          handle[1].close()
>
> Could this be the culprit?

It could be depending on what happens on your specific platform. One
of the fallbacks for popen2() is actually to use Popen3 class.

    def popen2(cmd, bufsize=-1, mode='t'):
        """Execute the shell command 'cmd' in a sub-process. On UNIX, 'cmd' may
        be a sequence, in which case arguments will be passed directly to the
        program without shell intervention (as with os.spawnv()). If 'cmd' is a
        string it will be passed to the shell (as with os.system()). If
        'bufsize' is specified, it sets the buffer size for the I/O pipes. The
        file objects (child_stdout, child_stdin) are returned."""
        inst = Popen3(cmd, False, bufsize)
        return inst.fromchild, inst.tochild

> PS. I finally obtained lsof for an orphan:
>
> httpd   552 nobody    0r  FIFO    0,5                    4292655466 pipe
> httpd   552 nobody    1w  FIFO    0,5                    4292655467 pipe

Pipe to subprocess. That this exists may mean it isn't collecting exit
status properly or sub process hasn't really exited.

Can you easily change your code which invokes sendmail to use smtplib
module instead? If it is easy, no harm in trying and if things work
okay then, then even better. :-)

Graham
From denes1951 at yahoo.ca  Sat Jan 26 19:12:50 2008
From: denes1951 at yahoo.ca (Denes L)
Date: Sat Jan 26 19:12:58 2008
Subject: [mod_python] compile mod_python on iSeries (AS/400)
Message-ID: <412878.40041.qm@web45102.mail.sp1.yahoo.com>

Hello all,

I am trying to compile mod_python on an IBM iSeries (AS400)
with Apache server version: 2.0.52
and Python 2.3.3 (from www.iseriespython.com).

So far I have put together a bunch of include (source) directories and I have fixed a few redefinition errors but I need help with these:

in mod_python.c line 313:
free(ci->interpreter);   
fails with:
Function argument assignment between types "void*" and "const unsigned char*" is not allowed.

Here is some of the expanded code:
310     5 |    if (!idata) {
311     6 |        Py_DECREF(ci->handler);
311     6 +        if (   --(ci->handler)->ob_refcnt != 0) ; else (      (*((PyObject *)(ci->handler))->ob_type->tp_dealloc)((PyObject *)((PyObject *)(ci->handler))));
312     9 |        Py_XDECREF(ci->data);
312     9 +        if ((ci->data) == ((void *)0)) ; else if (   --(ci->data)->ob_refcnt != 0) ; else ((*((PyObject *)(ci->data))->ob_type->tp_dealloc)((PyObject *)((PyObject *)(ci->data))));
313    14 |        free(ci->interpreter);
                          ^ error here

Also, lines:
427    val = apr_table_get(conf->options, "mod_python.mutex_locks");
458    mutex_dir = apr_table_get(conf->options, "mod_python.mutex_directory");
540    (same as line 458 above)
fail with:
Operation between types "unsigned char*" and "const unsigned char*" is not allowed.

Thank you.

       
---------------------------------
Looking for the perfect gift? Give the gift of Flickr!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080126/164e28e7/attachment.html
From graham.dumpleton at gmail.com  Sat Jan 26 23:12:27 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sat Jan 26 23:12:35 2008
Subject: [mod_python] compile mod_python on iSeries (AS/400)
In-Reply-To: <412878.40041.qm@web45102.mail.sp1.yahoo.com>
References: <412878.40041.qm@web45102.mail.sp1.yahoo.com>
Message-ID: <88e286470801262012r21e24789ufe5c8569728362a3@mail.gmail.com>

Try with mod_python 3.3.1. You appear to be using an older version of
mod_python source code. The 3.3.1 source code specifically has:

  free((void *)ci->interpreter);

so shouldn't get that first error.

Graham

On 27/01/2008, Denes L <denes1951@yahoo.ca> wrote:
> Hello all,
>
> I am trying to compile mod_python on an IBM iSeries (AS400)
> with Apache server version: 2.0.52
> and Python 2.3.3 (from www.iseriespython.com).
>
> So far I have put together a bunch of include (source) directories and I
> have fixed a few redefinition errors but I need help with these:
>
> in mod_python.c line 313:
> free(ci->interpreter);
> fails with:
> Function argument assignment between types "void*" and "const unsigned
> char*" is not allowed.
>
> Here is some of the expanded code:
> 310     5 |    if (!idata) {
> 311     6 |        Py_DECREF(ci->handler);
> 311     6 +        if (   --(ci->handler)->ob_refcnt != 0) ; else (
> (*((PyObject
> *)(ci->handler))->ob_type->tp_dealloc)((PyObject
> *)((PyObject *)(ci->handler))));
> 312     9 |        Py_XDECREF(ci->data);
> 312     9 +        if ((ci->data) == ((void *)0)) ; else if (
> --(ci->data)->ob_refcnt != 0) ; else ((*((PyObject
> *)(ci->data))->ob_type->tp_dealloc)((PyObject *)((PyObject
> *)(ci->data))));
> 313    14 |        free(ci->interpreter);
>                           ^ error here
>
> Also, lines:
> 427    val = apr_table_get(conf->options, "mod_python.mutex_locks");
> 458    mutex_dir = apr_table_get(conf->options,
> "mod_python.mutex_directory");
> 540    (same as line 458 above)
> fail with:
> Operation between types "unsigned char*" and "const unsigned char*" is not
> allowed.
>
> Thank you.
>
>
>  ________________________________
>  Looking for the perfect gift? Give the gift of Flickr!
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
From charles.collis at gmail.com  Sun Jan 27 14:38:44 2008
From: charles.collis at gmail.com (Charles Collis)
Date: Sun Jan 27 14:38:53 2008
Subject: [mod_python] Problem getting the Publisher handler to return nothing
Message-ID: <b44a81310801271138x597f726bxdf39997892289f64@mail.gmail.com>

Hi.

I wonder if anyone can help - I am having problems getting the Publisher
handler to return nothing.

I am wanting the publisher handler to return nothing when clicking on a link
that points to a particular function which will perform a system command,
and I am using the recommended 'raise apache.SERVER_RETURN, apache.OK'
trick.

This does indeed stop the page contents refreshing, but has the odd
side-effect of the browser asking wanting to download a file (of 'python
script' type). This behaviour happens in both Firefox 3 beta2 and Konqueror.
It even does it if the function doesn't do anything:

def launch():
   pass
   raise apache.SERVER_RETURN, apache.OK

I am running Ubuntu Gutsy.

Apache and mod_python details:
Apache/2.2.4 (Ubuntu) mod_python/3.3.1 Python/2.5.1 PHP/5.2.3-1ubuntu6.3

Any pointers appreciated. Thanks.

Charles Collis.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080127/0cbe9d58/attachment.html
From graham.dumpleton at gmail.com  Sun Jan 27 16:12:36 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sun Jan 27 16:12:42 2008
Subject: [mod_python] Problem getting the Publisher handler to return
	nothing
In-Reply-To: <b44a81310801271138x597f726bxdf39997892289f64@mail.gmail.com>
References: <b44a81310801271138x597f726bxdf39997892289f64@mail.gmail.com>
Message-ID: <88e286470801271312s2168a1e4g3fc6dc06d0f0a25@mail.gmail.com>

You still must set the response content type else the browser tries to
work out what to do based on the extension in the URL. So, use:

  req.content_type = 'text/plain'

Graham

On 28/01/2008, Charles Collis <charles.collis@gmail.com> wrote:
> Hi.
>
> I wonder if anyone can help - I am having problems getting the Publisher
> handler to return nothing.
>
> I am wanting the publisher handler to return nothing when clicking on a link
> that points to a particular function which will perform a system command,
> and I am using the recommended 'raise apache.SERVER_RETURN, apache.OK'
> trick.
>
> This does indeed stop the page contents refreshing, but has the odd
> side-effect of the browser asking wanting to download a file (of 'python
> script' type). This behaviour happens in both Firefox 3 beta2 and Konqueror.
> It even does it if the function doesn't do anything:
>
> def launch():
>    pass
>    raise apache.SERVER_RETURN, apache.OK
>
> I am running Ubuntu Gutsy.
>
> Apache and mod_python details:
> Apache/2.2.4 (Ubuntu) mod_python/3.3.1 Python/2.5.1 PHP/5.2.3-1ubuntu6.3
>
> Any pointers appreciated. Thanks.
>
> Charles Collis.
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
From charles.collis at gmail.com  Sun Jan 27 18:34:30 2008
From: charles.collis at gmail.com (Charles Collis)
Date: Sun Jan 27 18:34:36 2008
Subject: [mod_python] Problem getting the Publisher handler to return
	nothing
In-Reply-To: <88e286470801271312s2168a1e4g3fc6dc06d0f0a25@mail.gmail.com>
References: <b44a81310801271138x597f726bxdf39997892289f64@mail.gmail.com>
	<88e286470801271312s2168a1e4g3fc6dc06d0f0a25@mail.gmail.com>
Message-ID: <b44a81310801271534m3971f347p28f048211f18efe7@mail.gmail.com>

Thanks Graham.

It now works as intended, although only with Konqueror - Firefox and Safari
both blank the page and the URL in address bar goes to
http://localhost/python/launch, rather than staying at the page they were on
before. Here is the new code as suggested:

def launch(req):
   req.content_type = 'text/plain'
   raise apache.SERVER_RETURN, apache.OK

The only other way I have been able to get it to simulate not leaving the
current page is by returning a short bit of html containing some javascript
that automatically goes back one page (from the new blank page) - but this
is pretty ugly!

On Jan 27, 2008 9:12 PM, Graham Dumpleton <graham.dumpleton@gmail.com>
wrote:

> You still must set the response content type else the browser tries to
> work out what to do based on the extension in the URL. So, use:
>
>  req.content_type = 'text/plain'
>
> Graham
>
> On 28/01/2008, Charles Collis <charles.collis@gmail.com> wrote:
> > Hi.
> >
> > I wonder if anyone can help - I am having problems getting the Publisher
> > handler to return nothing.
> >
> > I am wanting the publisher handler to return nothing when clicking on a
> link
> > that points to a particular function which will perform a system
> command,
> > and I am using the recommended 'raise apache.SERVER_RETURN, apache.OK'
> > trick.
> >
> > This does indeed stop the page contents refreshing, but has the odd
> > side-effect of the browser asking wanting to download a file (of 'python
> > script' type). This behaviour happens in both Firefox 3 beta2 and
> Konqueror.
> > It even does it if the function doesn't do anything:
> >
> > def launch():
> >    pass
> >    raise apache.SERVER_RETURN, apache.OK
> >
> > I am running Ubuntu Gutsy.
> >
> > Apache and mod_python details:
> > Apache/2.2.4 (Ubuntu) mod_python/3.3.1 Python/2.5.1 PHP/5.2.3-1ubuntu6.3
> >
> > Any pointers appreciated. Thanks.
> >
> > Charles Collis.
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080127/b3a97931/attachment.html
From webb.sprague at gmail.com  Sun Jan 27 22:36:00 2008
From: webb.sprague at gmail.com (Webb Sprague)
Date: Sun Jan 27 22:36:06 2008
Subject: [mod_python] Request for documentation change: please mention
	"req.form" SOMEWHERE in the main tree
Message-ID: <b11ea23c0801271936t1d92d6a2laae8e914351fd66a@mail.gmail.com>

I am currently documenting an application built with mod_python (it
has been great overall), and I would like to provide a link for a
description of "req.form", since I use it a lot, but its only mentions
are in the FAQ, in email archives, and in some random places like
changenotes and diffs.

Are those of us who use PublisherHandler in such a small minority that
req.form should be a mostly undocumented feature?

Interestingly the the following Google search  yields nothing in the
main documentation tree, and only 19 hits:

site:www.modpython.org  "req.form" -pipermail

But allowing for pipermail, we get nearly 300 hits that mention
req.form -- maybe we could save Graham some time if we just explained
it ...

I also realize I can download the docs and write a patch.  I probably
won't have time, but if this could go in a TODO or something, it might
flatten the learning curve for more users of mod_python later.

Thanks for everyone's time and patience.
From webb.sprague at gmail.com  Sun Jan 27 22:40:55 2008
From: webb.sprague at gmail.com (Webb Sprague)
Date: Sun Jan 27 22:41:01 2008
Subject: [mod_python] Re: Request for documentation change: please mention
	"req.form" SOMEWHERE in the main tree
In-Reply-To: <b11ea23c0801271936t1d92d6a2laae8e914351fd66a@mail.gmail.com>
References: <b11ea23c0801271936t1d92d6a2laae8e914351fd66a@mail.gmail.com>
Message-ID: <b11ea23c0801271940t17fe3c0fwe1ec351ee781ee96@mail.gmail.com>

Oh -- the application mentioned below is a form based implementation
of Lee-Carter mortality modeling and forecasting, if anyone is
interested, and it lives here:

http://lcfit.demog.berkeley.edu

Comments welcome....

On Jan 27, 2008 7:36 PM, Webb Sprague <webb.sprague@gmail.com> wrote:
> I am currently documenting an application built with mod_python (it
> has been great overall), and I would like to provide a link for a
> description of "req.form", since I use it a lot, but its only mentions
> are in the FAQ, in email archives, and in some random places like
> changenotes and diffs.
>
> Are those of us who use PublisherHandler in such a small minority that
> req.form should be a mostly undocumented feature?
>
> Interestingly the the following Google search  yields nothing in the
> main documentation tree, and only 19 hits:
>
> site:www.modpython.org  "req.form" -pipermail
>
> But allowing for pipermail, we get nearly 300 hits that mention
> req.form -- maybe we could save Graham some time if we just explained
> it ...
>
> I also realize I can download the docs and write a patch.  I probably
> won't have time, but if this could go in a TODO or something, it might
> flatten the learning curve for more users of mod_python later.
>
> Thanks for everyone's time and patience.
>
From graham.dumpleton at gmail.com  Mon Jan 28 00:58:04 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon Jan 28 00:58:12 2008
Subject: [mod_python] Problem getting the Publisher handler to return
	nothing
In-Reply-To: <b44a81310801271534m3971f347p28f048211f18efe7@mail.gmail.com>
References: <b44a81310801271138x597f726bxdf39997892289f64@mail.gmail.com>
	<88e286470801271312s2168a1e4g3fc6dc06d0f0a25@mail.gmail.com>
	<b44a81310801271534m3971f347p28f048211f18efe7@mail.gmail.com>
Message-ID: <88e286470801272158l1092ed52hf269c713a2f4b787@mail.gmail.com>

That might be the case if you have through the browser associated the
.py extension with some helper application for opening it. In other
words, nothing to do with mod_python but your personal machine, or at
least the browsers you are using. Try ensuring that any knowledge
within browser configuration for .py extension is cleared.

Graham

On 28/01/2008, Charles Collis <charles.collis@gmail.com> wrote:
> Thanks Graham.
>
> It now works as intended, although only with Konqueror - Firefox and Safari
> both blank the page and the URL in address bar goes to
> http://localhost/python/launch, rather than staying at the page they were on
> before. Here is the new code as suggested:
>
> def launch(req):
>    req.content_type = 'text/plain'
>    raise apache.SERVER_RETURN, apache.OK
>
> The only other way I have been able to get it to simulate not leaving the
> current page is by returning a short bit of html containing some javascript
> that automatically goes back one page (from the new blank page) - but this
> is pretty ugly!
>
>
> On Jan 27, 2008 9:12 PM, Graham Dumpleton <graham.dumpleton@gmail.com>
> wrote:
> > You still must set the response content type else the browser tries to
> > work out what to do based on the extension in the URL. So, use:
> >
> >  req.content_type = 'text/plain'
> >
> > Graham
> >
> >
> >
> >
> > On 28/01/2008, Charles Collis <charles.collis@gmail.com> wrote:
> > > Hi.
> > >
> > > I wonder if anyone can help - I am having problems getting the Publisher
> > > handler to return nothing.
> > >
> > > I am wanting the publisher handler to return nothing when clicking on a
> link
> > > that points to a particular function which will perform a system
> command,
> > > and I am using the recommended 'raise apache.SERVER_RETURN, apache.OK'
> > > trick.
> > >
> > > This does indeed stop the page contents refreshing, but has the odd
> > > side-effect of the browser asking wanting to download a file (of 'python
> > > script' type). This behaviour happens in both Firefox 3 beta2 and
> Konqueror.
> > > It even does it if the function doesn't do anything:
> > >
> > > def launch():
> > >    pass
> > >    raise apache.SERVER_RETURN, apache.OK
> > >
> > > I am running Ubuntu Gutsy.
> > >
> > > Apache and mod_python details:
> > > Apache/2.2.4 (Ubuntu) mod_python/3.3.1 Python/2.5.1 PHP/5.2.3-1ubuntu6.3
> > >
> > > Any pointers appreciated. Thanks.
> > >
> > > Charles Collis.
> > >
> > > _______________________________________________
> > > Mod_python mailing list
> > > Mod_python@modpython.org
> > >
> http://mailman.modpython.org/mailman/listinfo/mod_python
> > >
> > >
> >
>
>
From graham.dumpleton at gmail.com  Mon Jan 28 01:00:27 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon Jan 28 01:00:30 2008
Subject: [mod_python] Re: Request for documentation change: please mention
	"req.form" SOMEWHERE in the main tree
In-Reply-To: <b11ea23c0801271940t17fe3c0fwe1ec351ee781ee96@mail.gmail.com>
References: <b11ea23c0801271936t1d92d6a2laae8e914351fd66a@mail.gmail.com>
	<b11ea23c0801271940t17fe3c0fwe1ec351ee781ee96@mail.gmail.com>
Message-ID: <88e286470801272200u181f67ccme4f1163f1ed0dfe2@mail.gmail.com>

You can log a task issue at:

  http://issues.apache.org/jira/browse/MODPYTHON

If anyone ever does anything on mod_python source again then they
might make any suggested change. Mentioning it here on the mailing
list will just see it being forgotten.

Graham

On 28/01/2008, Webb Sprague <webb.sprague@gmail.com> wrote:
> Oh -- the application mentioned below is a form based implementation
> of Lee-Carter mortality modeling and forecasting, if anyone is
> interested, and it lives here:
>
> http://lcfit.demog.berkeley.edu
>
> Comments welcome....
>
> On Jan 27, 2008 7:36 PM, Webb Sprague <webb.sprague@gmail.com> wrote:
> > I am currently documenting an application built with mod_python (it
> > has been great overall), and I would like to provide a link for a
> > description of "req.form", since I use it a lot, but its only mentions
> > are in the FAQ, in email archives, and in some random places like
> > changenotes and diffs.
> >
> > Are those of us who use PublisherHandler in such a small minority that
> > req.form should be a mostly undocumented feature?
> >
> > Interestingly the the following Google search  yields nothing in the
> > main documentation tree, and only 19 hits:
> >
> > site:www.modpython.org  "req.form" -pipermail
> >
> > But allowing for pipermail, we get nearly 300 hits that mention
> > req.form -- maybe we could save Graham some time if we just explained
> > it ...
> >
> > I also realize I can download the docs and write a patch.  I probably
> > won't have time, but if this could go in a TODO or something, it might
> > flatten the learning curve for more users of mod_python later.
> >
> > Thanks for everyone's time and patience.
> >
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From denes1951 at yahoo.ca  Mon Jan 28 12:00:03 2008
From: denes1951 at yahoo.ca (Denes L)
Date: Mon Jan 28 12:00:15 2008
Subject: [mod_python] compile mod_python on iSeries (AS/400)
Message-ID: <430656.42028.qm@web45111.mail.sp1.yahoo.com>

Thanks for the suggestion Graham, I forgot to mention that I was using mod_python 3.2.10.

Now with 3.3.1 I get one error on line 826 as follows:

825    APR_REGISTER_OPTIONAL_FN(mp_acquire_interpreter);
825    do { apr_OFN_mp_acquire_interpreter_t *apu__opt = mp_acquire_interpreter; apr_dynamic_fn_register("mp_acquire_interpreter",(apr_opt_fn_t *)apu__opt); } while (0);
826    APR_REGISTER_OPTIONAL_FN(mp_release_interpreter);
826    do { apr_OFN_mp_release_interpreter_t *apu__opt = mp_release_interpreter; apr_dynamic_fn_register("mp_release_interpreter",(apr_opt_fn_t *)apu__opt); } while (0);
Initialization between types "void*(*)()" and "void(*)(void)" is not allowed.

Denes.

Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
 Try with mod_python 3.3.1. You appear to be using an older version of
mod_python source code. The 3.3.1 source code specifically has:

  free((void *)ci->interpreter);

so shouldn't get that first error.

Graham

       
---------------------------------
Be smarter than spam. See how smart SpamGuard is at giving junk email the boot with the All-new Yahoo! Mail  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080128/1533983c/attachment.html
From brunson at brunson.com  Mon Jan 28 12:22:58 2008
From: brunson at brunson.com (Eric Brunson)
Date: Mon Jan 28 12:23:13 2008
Subject: [mod_python] Superfluous  notices in apache error log
Message-ID: <479E0F72.2060705@brunson.com>

I've been looking through the manual for configuration options, but 
haven't found a solution.

Is there any way to suppress these messages from the error logs?

[Tue Jan 15 13:00:44 2008] [notice] mod_python (pid=17906, 
interpreter='engapp01-zone01'): Importing module 
'/wb/apache/htdocs/wbldapauth.py'
[Tue Jan 15 13:00:45 2008] [notice] mod_python (pid=17906, 
interpreter='engapp01-zone01'): Importing module 
'/wb/apache/htdocs/canaries/performanceMonitoring/index.py'
[Tue Jan 15 13:00:47 2008] [notice] mod_python (pid=17960, 
interpreter='engapp01-zone01'): Importing module 
'/wb/apache/htdocs/wbldapauth.py'
[Tue Jan 15 13:00:47 2008] [notice] mod_python (pid=17960, 
interpreter='engapp01-zone01'): Importing module 
'/wb/apache/htdocs/canaries/performanceMonitoring/index.py'

Thanks,
e.

From gzlist at googlemail.com  Mon Jan 28 14:06:39 2008
From: gzlist at googlemail.com (Martin (gzlist))
Date: Mon Jan 28 14:06:46 2008
Subject: [mod_python] Superfluous notices in apache error log
In-Reply-To: <479E0F72.2060705@brunson.com>
References: <479E0F72.2060705@brunson.com>
Message-ID: <d80792120801281106k26950c7cxd1538707d338656c@mail.gmail.com>

On 28/01/2008, Eric Brunson <brunson@brunson.com> wrote:
> I've been looking through the manual for configuration options, but
> haven't found a solution.
>
> Is there any way to suppress these messages from the error logs?
>
> [Tue Jan 15 13:00:44 2008] [notice] mod_python (pid=17906,
> interpreter='engapp01-zone01'): Importing module
> '/wb/apache/htdocs/wbldapauth.py'
> [Tue Jan 15 13:00:45 2008] [notice] mod_python (pid=17906,
> interpreter='engapp01-zone01'): Importing module
> '/wb/apache/htdocs/canaries/performanceMonitoring/index.py'
> [Tue Jan 15 13:00:47 2008] [notice] mod_python (pid=17960,
> interpreter='engapp01-zone01'): Importing module
> '/wb/apache/htdocs/wbldapauth.py'
> [Tue Jan 15 13:00:47 2008] [notice] mod_python (pid=17960,
> interpreter='engapp01-zone01'): Importing module
> '/wb/apache/htdocs/canaries/performanceMonitoring/index.py'

LogLevel warn

<http://httpd.apache.org/docs/2.2/mod/core.html#loglevel>

Martin
From brunson at brunson.com  Mon Jan 28 14:13:14 2008
From: brunson at brunson.com (Eric Brunson)
Date: Mon Jan 28 14:13:40 2008
Subject: [mod_python] Superfluous notices in apache error log
In-Reply-To: <d80792120801281106k26950c7cxd1538707d338656c@mail.gmail.com>
References: <479E0F72.2060705@brunson.com>
	<d80792120801281106k26950c7cxd1538707d338656c@mail.gmail.com>
Message-ID: <479E294A.2020201@brunson.com>


Thank you, Martin.  I was looking for something mod_python specific when 
I should have been looking at the apache docs.

Thanks for the help,
e.

Martin (gzlist) wrote:
> On 28/01/2008, Eric Brunson <brunson@brunson.com> wrote:
>   
>> I've been looking through the manual for configuration options, but
>> haven't found a solution.
>>
>> Is there any way to suppress these messages from the error logs?
>>
>> [Tue Jan 15 13:00:44 2008] [notice] mod_python (pid=17906,
>> interpreter='engapp01-zone01'): Importing module
>> '/wb/apache/htdocs/wbldapauth.py'
>> [Tue Jan 15 13:00:45 2008] [notice] mod_python (pid=17906,
>> interpreter='engapp01-zone01'): Importing module
>> '/wb/apache/htdocs/canaries/performanceMonitoring/index.py'
>> [Tue Jan 15 13:00:47 2008] [notice] mod_python (pid=17960,
>> interpreter='engapp01-zone01'): Importing module
>> '/wb/apache/htdocs/wbldapauth.py'
>> [Tue Jan 15 13:00:47 2008] [notice] mod_python (pid=17960,
>> interpreter='engapp01-zone01'): Importing module
>> '/wb/apache/htdocs/canaries/performanceMonitoring/index.py'
>>     
>
> LogLevel warn
>
> <http://httpd.apache.org/docs/2.2/mod/core.html#loglevel>
>
> Martin
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>   

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080128/26027992/attachment.html
From graham.dumpleton at gmail.com  Mon Jan 28 17:49:09 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon Jan 28 17:49:16 2008
Subject: [mod_python] compile mod_python on iSeries (AS/400)
In-Reply-To: <430656.42028.qm@web45111.mail.sp1.yahoo.com>
References: <430656.42028.qm@web45111.mail.sp1.yahoo.com>
Message-ID: <88e286470801281449r1dda7f1dt7ac4fda40c8f4fb3@mail.gmail.com>

On 29/01/2008, Denes L <denes1951@yahoo.ca> wrote:
> Thanks for the suggestion Graham, I forgot to mention that I was using
> mod_python 3.2.10.
>
> Now with 3.3.1 I get one error on line 826 as follows:
>
> 825    APR_REGISTER_OPTIONAL_FN(mp_acquire_interpreter);
> 825    do { apr_OFN_mp_acquire_interpreter_t *apu__opt =
> mp_acquire_interpreter;
> apr_dynamic_fn_register("mp_acquire_interpreter",(apr_opt_fn_t
> *)apu__opt); } while (0);
> 826    APR_REGISTER_OPTIONAL_FN(mp_release_interpreter);
> 826    do { apr_OFN_mp_release_interpreter_t *apu__opt =
> mp_release_interpreter;
> apr_dynamic_fn_register("mp_release_interpreter",(apr_opt_fn_t
> *)apu__opt); } while (0);
> Initialization between types "void*(*)()" and "void(*)(void)" is not
> allowed.

Hmmm, that is actually a bug in the mod_python code.

In src/include/mod_python.h.in (NOTE the extension is .h.in, not just
.h), change:

APR_DECLARE_OPTIONAL_FN(void *, mp_release_interpreter, ());

to:

APR_DECLARE_OPTIONAL_FN(void, mp_release_interpreter, ());

You should do a make distclean and rerun configure.

Graham

> Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
>  Try with mod_python 3.3.1. You appear to be using an older version of
> mod_python source code. The 3.3.1 source code specifically has:
>
>  free((void *)ci->interpreter);
>
> so shouldn't get that first error.
>
> Graham
>
>
>  ________________________________
> Be smarter than spam. See how smart SpamGuard is at giving junk email the
> boot with the All-new Yahoo! Mail
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
From graham.dumpleton at gmail.com  Mon Jan 28 17:53:43 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon Jan 28 17:53:52 2008
Subject: [mod_python] Superfluous notices in apache error log
In-Reply-To: <479E294A.2020201@brunson.com>
References: <479E0F72.2060705@brunson.com>
	<d80792120801281106k26950c7cxd1538707d338656c@mail.gmail.com>
	<479E294A.2020201@brunson.com>
Message-ID: <88e286470801281453la5e1009q13f6b0426ca4f0c7@mail.gmail.com>

Have you tried:

  PythonDebug Off

directive in configuration?

Graham

On 29/01/2008, Eric Brunson <brunson@brunson.com> wrote:
>
>
>  Thank you, Martin.  I was looking for something mod_python specific when I
> should have been looking at the apache docs.
>
>  Thanks for the help,
>  e.
>
>
>  Martin (gzlist) wrote:
>  On 28/01/2008, Eric Brunson <brunson@brunson.com> wrote:
>
>
>  I've been looking through the manual for configuration options, but
> haven't found a solution.
>
> Is there any way to suppress these messages from the error logs?
>
> [Tue Jan 15 13:00:44 2008] [notice] mod_python (pid=17906,
> interpreter='engapp01-zone01'): Importing module
> '/wb/apache/htdocs/wbldapauth.py'
> [Tue Jan 15 13:00:45 2008] [notice] mod_python (pid=17906,
> interpreter='engapp01-zone01'): Importing module
> '/wb/apache/htdocs/canaries/performanceMonitoring/index.py'
> [Tue Jan 15 13:00:47 2008] [notice] mod_python (pid=17960,
> interpreter='engapp01-zone01'): Importing module
> '/wb/apache/htdocs/wbldapauth.py'
> [Tue Jan 15 13:00:47 2008] [notice] mod_python (pid=17960,
> interpreter='engapp01-zone01'): Importing module
> '/wb/apache/htdocs/canaries/performanceMonitoring/index.py'
>
>  LogLevel warn
>
> <http://httpd.apache.org/docs/2.2/mod/core.html#loglevel>
>
> Martin
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
From charles.collis at gmail.com  Mon Jan 28 19:16:03 2008
From: charles.collis at gmail.com (Charles Collis)
Date: Mon Jan 28 19:16:10 2008
Subject: [mod_python] Problem getting the Publisher handler to return
	nothing
In-Reply-To: <88e286470801272158l1092ed52hf269c713a2f4b787@mail.gmail.com>
References: <b44a81310801271138x597f726bxdf39997892289f64@mail.gmail.com>
	<88e286470801271312s2168a1e4g3fc6dc06d0f0a25@mail.gmail.com>
	<b44a81310801271534m3971f347p28f048211f18efe7@mail.gmail.com>
	<88e286470801272158l1092ed52hf269c713a2f4b787@mail.gmail.com>
Message-ID: <b44a81310801281616p22f031aib79434412d46594e@mail.gmail.com>

Thanks Graham.

No I don't have any associated applications for .py files with my browser(s)
- I have checked the list of applications in Firefox preferences (on Ubuntu
machine) also this behaviour is happens on my Mac using Safari...

Seems a bit odd!

On Jan 28, 2008 5:58 AM, Graham Dumpleton <graham.dumpleton@gmail.com>
wrote:

> That might be the case if you have through the browser associated the
> .py extension with some helper application for opening it. In other
> words, nothing to do with mod_python but your personal machine, or at
> least the browsers you are using. Try ensuring that any knowledge
> within browser configuration for .py extension is cleared.
>
> Graham
>
> On 28/01/2008, Charles Collis <charles.collis@gmail.com> wrote:
> > Thanks Graham.
> >
> > It now works as intended, although only with Konqueror - Firefox and
> Safari
> > both blank the page and the URL in address bar goes to
> > http://localhost/python/launch, rather than staying at the page they
> were on
> > before. Here is the new code as suggested:
> >
> > def launch(req):
> >    req.content_type = 'text/plain'
> >    raise apache.SERVER_RETURN, apache.OK
> >
> > The only other way I have been able to get it to simulate not leaving
> the
> > current page is by returning a short bit of html containing some
> javascript
> > that automatically goes back one page (from the new blank page) - but
> this
> > is pretty ugly!
> >
> >
> > On Jan 27, 2008 9:12 PM, Graham Dumpleton <graham.dumpleton@gmail.com>
> > wrote:
> > > You still must set the response content type else the browser tries to
> > > work out what to do based on the extension in the URL. So, use:
> > >
> > >  req.content_type = 'text/plain'
> > >
> > > Graham
> > >
> > >
> > >
> > >
> > > On 28/01/2008, Charles Collis <charles.collis@gmail.com> wrote:
> > > > Hi.
> > > >
> > > > I wonder if anyone can help - I am having problems getting the
> Publisher
> > > > handler to return nothing.
> > > >
> > > > I am wanting the publisher handler to return nothing when clicking
> on a
> > link
> > > > that points to a particular function which will perform a system
> > command,
> > > > and I am using the recommended 'raise apache.SERVER_RETURN,
> apache.OK'
> > > > trick.
> > > >
> > > > This does indeed stop the page contents refreshing, but has the odd
> > > > side-effect of the browser asking wanting to download a file (of
> 'python
> > > > script' type). This behaviour happens in both Firefox 3 beta2 and
> > Konqueror.
> > > > It even does it if the function doesn't do anything:
> > > >
> > > > def launch():
> > > >    pass
> > > >    raise apache.SERVER_RETURN, apache.OK
> > > >
> > > > I am running Ubuntu Gutsy.
> > > >
> > > > Apache and mod_python details:
> > > > Apache/2.2.4 (Ubuntu) mod_python/3.3.1 Python/2.5.1 PHP/5.2.3-
> 1ubuntu6.3
> > > >
> > > > Any pointers appreciated. Thanks.
> > > >
> > > > Charles Collis.
> > > >
> > > > _______________________________________________
> > > > Mod_python mailing list
> > > > Mod_python@modpython.org
> > > >
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> > > >
> > > >
> > >
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080129/6c47af1f/attachment-0001.html
From graham.dumpleton at gmail.com  Mon Jan 28 19:19:36 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon Jan 28 19:19:45 2008
Subject: [mod_python] Problem getting the Publisher handler to return
	nothing
In-Reply-To: <b44a81310801281616p22f031aib79434412d46594e@mail.gmail.com>
References: <b44a81310801271138x597f726bxdf39997892289f64@mail.gmail.com>
	<88e286470801271312s2168a1e4g3fc6dc06d0f0a25@mail.gmail.com>
	<b44a81310801271534m3971f347p28f048211f18efe7@mail.gmail.com>
	<88e286470801272158l1092ed52hf269c713a2f4b787@mail.gmail.com>
	<b44a81310801281616p22f031aib79434412d46594e@mail.gmail.com>
Message-ID: <88e286470801281619o2e66ea8dx48a90c1c42dffa14@mail.gmail.com>

Then the content type can't be getting sent back properly.

Under FireFox use live headers extension to see what headers are
actually being returned.

Make sure nothing has cached your page and thus a set of old headers.

BTW, is there any reason why you cant use just:

def launch(req):
   req.content_type = 'text/plain'
   return ''

Graham

On 29/01/2008, Charles Collis <charles.collis@gmail.com> wrote:
> Thanks Graham.
>
> No I don't have any associated applications for .py files with my browser(s)
> - I have checked the list of applications in Firefox preferences (on Ubuntu
> machine) also this behaviour is happens on my Mac using Safari...
>
> Seems a bit odd!
>
>
> On Jan 28, 2008 5:58 AM, Graham Dumpleton <graham.dumpleton@gmail.com>
> wrote:
> > That might be the case if you have through the browser associated the
> > .py extension with some helper application for opening it. In other
> > words, nothing to do with mod_python but your personal machine, or at
> > least the browsers you are using. Try ensuring that any knowledge
> > within browser configuration for .py extension is cleared.
> >
> >
> >
> >
> > Graham
> >
> > On 28/01/2008, Charles Collis <charles.collis@gmail.com> wrote:
> > > Thanks Graham.
> > >
> > > It now works as intended, although only with Konqueror - Firefox and
> Safari
> > > both blank the page and the URL in address bar goes to
> > > http://localhost/python/launch, rather than staying at the page they
> were on
> > > before. Here is the new code as suggested:
> > >
> > > def launch(req):
> > >    req.content_type = 'text/plain'
> > >    raise apache.SERVER_RETURN, apache.OK
> > >
> > > The only other way I have been able to get it to simulate not leaving
> the
> > > current page is by returning a short bit of html containing some
> javascript
> > > that automatically goes back one page (from the new blank page) - but
> this
> > > is pretty ugly!
> > >
> > >
> > > On Jan 27, 2008 9:12 PM, Graham Dumpleton <graham.dumpleton@gmail.com>
> > > wrote:
> > > > You still must set the response content type else the browser tries to
> > > > work out what to do based on the extension in the URL. So, use:
> > > >
> > > >  req.content_type = 'text/plain'
> > > >
> > > > Graham
> > > >
> > > >
> > > >
> > > >
> > > > On 28/01/2008, Charles Collis <charles.collis@gmail.com> wrote:
> > > > > Hi.
> > > > >
> > > > > I wonder if anyone can help - I am having problems getting the
> Publisher
> > > > > handler to return nothing.
> > > > >
> > > > > I am wanting the publisher handler to return nothing when clicking
> on a
> > > link
> > > > > that points to a particular function which will perform a system
> > > command,
> > > > > and I am using the recommended 'raise apache.SERVER_RETURN,
> apache.OK'
> > > > > trick.
> > > > >
> > > > > This does indeed stop the page contents refreshing, but has the odd
> > > > > side-effect of the browser asking wanting to download a file (of
> 'python
> > > > > script' type). This behaviour happens in both Firefox 3 beta2 and
> > > Konqueror.
> > > > > It even does it if the function doesn't do anything:
> > > > >
> > > > > def launch():
> > > > >    pass
> > > > >    raise apache.SERVER_RETURN, apache.OK
> > > > >
> > > > > I am running Ubuntu Gutsy.
> > > > >
> > > > > Apache and mod_python details:
> > > > > Apache/2.2.4 (Ubuntu) mod_python/3.3.1 Python/2.5.1
> PHP/5.2.3-1ubuntu6.3
> > > > >
> > > > > Any pointers appreciated. Thanks.
> > > > >
> > > > > Charles Collis.
> > > > >
> > > > > _______________________________________________
> > > > > Mod_python mailing list
> > > > > Mod_python@modpython.org
> > > > >
> > >
> http://mailman.modpython.org/mailman/listinfo/mod_python
> > > > >
> > > > >
> > > >
> > >
> > >
> >
>
>
From linux at qbox.es  Tue Jan 29 11:07:50 2008
From: linux at qbox.es (=?ISO-8859-1?Q?S=2ER=2EPard=E1?=)
Date: Tue Jan 29 11:08:01 2008
Subject: [mod_python] Upload images to web.
Message-ID: <1201622870.6813.3.camel@ThorUx>

Hi,

How can I make an HTML form that enable an user to select a file in the
client PC to be retrieved by the web app using apache mod_Pyhton ? 


Thank You Very Much ?


	S.R.Parda



From cfox at cfconsulting.ca  Tue Jan 29 17:38:05 2008
From: cfox at cfconsulting.ca (Colin Fox)
Date: Tue Jan 29 17:38:18 2008
Subject: [mod_python] Error codes
Message-ID: <479FAACD.3080909@cfconsulting.ca>

Hi everyone.

I'm getting back into an old mod_python project I was working on a while
ago, and something has changed in regards to apache errors.

I have a bit of code which ends with:

else:
    raise apache.ERROR


I can't find anything in any mod_python documentation that even mentions
errors, other than to see the official apache docs. Unfortunately,
that's not useful since obviously "apache.ERROR" is a mod_python thing
and not an apache thing.

Can someone point me to the documentation detailing the list of apache
error codes and their uses?

Thanks!
   cf

From cfox at cfconsulting.ca  Tue Jan 29 17:45:43 2008
From: cfox at cfconsulting.ca (Colin Fox)
Date: Tue Jan 29 17:45:50 2008
Subject: [mod_python] Error codes
In-Reply-To: <479FAACD.3080909@cfconsulting.ca>
References: <479FAACD.3080909@cfconsulting.ca>
Message-ID: <479FAC97.8010507@cfconsulting.ca>

I forgot to mention: apache.ERROR used to work, but no longer, so I need
to know what to substitute it with.

Thanks!
  cf


Colin Fox wrote:
> Hi everyone.
> 
> I'm getting back into an old mod_python project I was working on a while
> ago, and something has changed in regards to apache errors.
> 
> I have a bit of code which ends with:
> 
> else:
>     raise apache.ERROR
> 
> 
> I can't find anything in any mod_python documentation that even mentions
> errors, other than to see the official apache docs. Unfortunately,
> that's not useful since obviously "apache.ERROR" is a mod_python thing
> and not an apache thing.
> 
> Can someone point me to the documentation detailing the list of apache
> error codes and their uses?
> 
> Thanks!
>    cf
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From graham.dumpleton at gmail.com  Tue Jan 29 17:48:44 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue Jan 29 17:49:01 2008
Subject: [mod_python] Upload images to web.
In-Reply-To: <1201622870.6813.3.camel@ThorUx>
References: <1201622870.6813.3.camel@ThorUx>
Message-ID: <88e286470801291448i418ee158o2c09cb6159ebb4fc@mail.gmail.com>

Read through the tutorial at:

  http://webpython.codepoint.net/mod_python

If you also Google the Internet you should also be able to find lots
of pages on HTML forms and how to use them.

Graham

On 30/01/2008, S.R.Pard? <linux@qbox.es> wrote:
> Hi,
>
> How can I make an HTML form that enable an user to select a file in the
> client PC to be retrieved by the web app using apache mod_Pyhton ?
>
>
> Thank You Very Much ?
>
>
>         S.R.Parda
>
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>

From cfox at cfconsulting.ca  Tue Jan 29 18:01:53 2008
From: cfox at cfconsulting.ca (Colin Fox)
Date: Tue Jan 29 18:02:07 2008
Subject: [mod_python] Error codes
In-Reply-To: <479FAC97.8010507@cfconsulting.ca>
References: <479FAACD.3080909@cfconsulting.ca>
	<479FAC97.8010507@cfconsulting.ca>
Message-ID: <479FB061.8090100@cfconsulting.ca>

Colin Fox wrote:
> I forgot to mention: apache.ERROR used to work, but no longer, so I need
> to know what to substitute it with.
>
> Thanks!
>   cf
>   
Gah. Of course, right after I post this, I find the codes I was looking for.

Could the mod_python manual be updated to have a direct link to the
apache response codes? The codes are listed in section 4.2, but if you
follow the ToC to the apache section (4.5) there is no mention of them,
which my admittedly tiny brain found confusing.

Regards,
  cf

From graham.dumpleton at gmail.com  Tue Jan 29 18:07:40 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue Jan 29 18:07:46 2008
Subject: [mod_python] Error codes
In-Reply-To: <479FAC97.8010507@cfconsulting.ca>
References: <479FAACD.3080909@cfconsulting.ca>
	<479FAC97.8010507@cfconsulting.ca>
Message-ID: <88e286470801291507s103e6612h52fa502f1699ddc9@mail.gmail.com>

This did not even exist in mod_python 2.7.10, so am dubious as to
whether such a thing ever existed.

What is it you are actually wanting to do? All we can do is suggest
the official way of doing it.

Graham

On 30/01/2008, Colin Fox <cfox@cfconsulting.ca> wrote:
> I forgot to mention: apache.ERROR used to work, but no longer, so I need
> to know what to substitute it with.
>
> Thanks!
>   cf
>
>
> Colin Fox wrote:
> > Hi everyone.
> >
> > I'm getting back into an old mod_python project I was working on a while
> > ago, and something has changed in regards to apache errors.
> >
> > I have a bit of code which ends with:
> >
> > else:
> >     raise apache.ERROR
> >
> >
> > I can't find anything in any mod_python documentation that even mentions
> > errors, other than to see the official apache docs. Unfortunately,
> > that's not useful since obviously "apache.ERROR" is a mod_python thing
> > and not an apache thing.
> >
> > Can someone point me to the documentation detailing the list of apache
> > error codes and their uses?
> >
> > Thanks!
> >    cf
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From graham.dumpleton at gmail.com  Tue Jan 29 18:10:13 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue Jan 29 18:10:19 2008
Subject: [mod_python] Error codes
In-Reply-To: <479FB061.8090100@cfconsulting.ca>
References: <479FAACD.3080909@cfconsulting.ca>
	<479FAC97.8010507@cfconsulting.ca> <479FB061.8090100@cfconsulting.ca>
Message-ID: <88e286470801291510s3abe0b45je3e0c6d00c4fbd5c@mail.gmail.com>

On 30/01/2008, Colin Fox <cfox@cfconsulting.ca> wrote:
> Colin Fox wrote:
> > I forgot to mention: apache.ERROR used to work, but no longer, so I need
> > to know what to substitute it with.
> >
> > Thanks!
> >   cf
> >
> Gah. Of course, right after I post this, I find the codes I was looking for.
>
> Could the mod_python manual be updated to have a direct link to the
> apache response codes? The codes are listed in section 4.2, but if you
> follow the ToC to the apache section (4.5) there is no mention of them,
> which my admittedly tiny brain found confusing.

Suggestions for changes to the documentation can be logged at:

  https://issues.apache.org/jira/browse/MODPYTHON

Graham
From graham.dumpleton at gmail.com  Wed Jan 30 01:55:11 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Wed Jan 30 01:55:17 2008
Subject: [mod_python] Re: mod_python and no Python.framework on the Mac
In-Reply-To: <9C43BE75-F0A8-477E-A6DA-271A24D0B4A6@dsource.org>
References: <9C43BE75-F0A8-477E-A6DA-271A24D0B4A6@dsource.org>
Message-ID: <88e286470801292255v410f82c3x1a90feb9bd67f7c2@mail.gmail.com>

On 30/01/2008, Brad Anderson <brad@dsource.org> wrote:
> Hi Graham,
>
> I've found this article:  http://www.modpython.org/pipermail/mod_python/2007-September/024205.html
>
> about how I need to doctor up src/Makefile's LDFLAGS to add -Wl,-F/
> some/path/lib
>
> where /some/path/lib is where your Python 2.5 framework library is
> installed.
>
> Thing is, I don't have a Python framework.  I had the one that comes
> with Mac in /System/Library/Frameworks/Python.framework, but I've
> moved it aside, b/c I used MacPorts python25.  It put things into /opt/
> local/, but there's no /opt/local/Library/Frameworks, and also nothing
> pythonic in /Library/Frameworks...
>
> So, I changed the ldflags path to /opt/local/lib
>
> Here's otool:
>
> Macintosh:apache2 root# pwd
> /opt/local/apache2
> Macintosh:apache2 root# otool -L modules/mod_python.so
> modules/mod_python.so:
>          /usr/lib/libSystem.B.dylib (compatibility version 1.0.0,
> current version 111.0.0)
>          /opt/local/lib/libpython2.5.dylib (compatibility version
> 2.5.0, current version 2.5.0)
>          /usr/lib/libgcc_s.1.dylib (compatibility version 1.0.0,
> current version 1.0.0)
>
> So, I'm thinking that is looking pretty good.
>
> However, I still get a 500 error, and the following in the Apache
> error log:
>
> [Wed Jan 30 00:28:22 2008] [error] [client 127.0.0.1] python_handler:
> Can't get/create interpreter.
>
> Any advice?

Yes, use the mailing list for questions. :-)

Oh, and have you actually installed the Python site-packages
components of mod_python.

You can work this out by running actual version of Python you think is
supposed to be used.

$ python
Python 2.5.1 (r251:54863, Oct  9 2007, 20:39:46)
[GCC 4.0.1 (Apple Inc. build 5465)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
>>> import mod_python
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
ImportError: No module named mod_python
>>>

If you get the error shown, it isn't installed properly. If you don't
get it, send all the mod_python related error messages from Apache,
not just that one, the others are there specifically to help debug
problems.

BTW, since Leopard has Python 2.5.1, was there really a pressing need
to install the one from MacPorts.

Please keep followups on the mailing list by using reply-all.

Graham
From mcl.office at googlemail.com  Wed Jan 30 04:48:38 2008
From: mcl.office at googlemail.com (MCL Systems)
Date: Wed Jan 30 04:48:46 2008
Subject: [mod_python] Local Web Server
Message-ID: <46218daf0801300148i77af807arbac647c9f5e068ba@mail.gmail.com>

I am looking for a local lightweight web server, that I can use to run
python apps locally via my USB pen drive.

I am running winxp sp2.

The programs are coded for mod_python and I am using scite portable and
portable python for my development..

I am very limited in my abilities to install programs successfully, but I
can still achieve programming results, to my satisfaction with python.

My programs query text/csv files and display the results in a browser.

So I imagine I will start server 'x', which will point to a document root
and then I can access my files as  http://127.1.0.0 or whatever /mycode.py

So is there a binary I can download, already configured to run locally and
with mod_python support and all I have to do is tell it where document root
is.

I like a simple life.

Richard
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080130/07bda8f9/attachment.html
From graham.dumpleton at gmail.com  Wed Jan 30 05:11:55 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Wed Jan 30 05:12:00 2008
Subject: [mod_python] Local Web Server
In-Reply-To: <46218daf0801300148i77af807arbac647c9f5e068ba@mail.gmail.com>
References: <46218daf0801300148i77af807arbac647c9f5e068ba@mail.gmail.com>
Message-ID: <88e286470801300211m69f745ebrd42f544a4b69bf0a@mail.gmail.com>

On 30/01/2008, MCL Systems <mcl.office@googlemail.com> wrote:
> I am looking for a local lightweight web server, that I can use to run
> python apps locally via my USB pen drive.
>
> I am running winxp sp2.
>
> The programs are coded for mod_python and I am using scite portable and
> portable python for my development..
>
> I am very limited in my abilities to install programs successfully, but I
> can still achieve programming results, to my satisfaction with python.
>
> My programs query text/csv files and display the results in a browser.
>
> So I imagine I will start server 'x', which will point to a document root
> and then I can access my files as  http://127.1.0.0 or whatever /mycode.py
>
> So is there a binary I can download, already configured to run locally and
> with mod_python support and all I have to do is tell it where document root
> is.
>
> I like a simple life.

Frankly, you may be better off converting your Python web application
to use WSGI and run it on top of the web server from Paste. This would
probably be simpler than trying to get Apache/mod_python to host off a
USB drive.

Anyway, I am not a Windows person so my opinion doesn't really matter.
Thus I'll leave it up to the Windows experts to give you a real
answer. :-)

Graham
From charles.collis at gmail.com  Thu Jan 31 04:41:35 2008
From: charles.collis at gmail.com (Charles Collis)
Date: Thu Jan 31 04:41:44 2008
Subject: [mod_python] Problem getting the Publisher handler to return
	nothing
In-Reply-To: <88e286470801281619o2e66ea8dx48a90c1c42dffa14@mail.gmail.com>
References: <b44a81310801271138x597f726bxdf39997892289f64@mail.gmail.com>
	<88e286470801271312s2168a1e4g3fc6dc06d0f0a25@mail.gmail.com>
	<b44a81310801271534m3971f347p28f048211f18efe7@mail.gmail.com>
	<88e286470801272158l1092ed52hf269c713a2f4b787@mail.gmail.com>
	<b44a81310801281616p22f031aib79434412d46594e@mail.gmail.com>
	<88e286470801281619o2e66ea8dx48a90c1c42dffa14@mail.gmail.com>
Message-ID: <b44a81310801310141t323d6325q6fcc9202c3590392@mail.gmail.com>

Thanks for the suggestion.

This returns a bank page, rather than leaving the previous page intact.

On Jan 29, 2008 12:19 AM, Graham Dumpleton <graham.dumpleton@gmail.com>
wrote:

> Then the content type can't be getting sent back properly.
>
> Under FireFox use live headers extension to see what headers are
> actually being returned.
>
> Make sure nothing has cached your page and thus a set of old headers.
>
> BTW, is there any reason why you cant use just:
>
> def launch(req):
>   req.content_type = 'text/plain'
>   return ''
>
> Graham
>
> On 29/01/2008, Charles Collis <charles.collis@gmail.com> wrote:
> > Thanks Graham.
> >
> > No I don't have any associated applications for .py files with my
> browser(s)
> > - I have checked the list of applications in Firefox preferences (on
> Ubuntu
> > machine) also this behaviour is happens on my Mac using Safari...
> >
> > Seems a bit odd!
> >
> >
> > On Jan 28, 2008 5:58 AM, Graham Dumpleton <graham.dumpleton@gmail.com>
> > wrote:
> > > That might be the case if you have through the browser associated the
> > > .py extension with some helper application for opening it. In other
> > > words, nothing to do with mod_python but your personal machine, or at
> > > least the browsers you are using. Try ensuring that any knowledge
> > > within browser configuration for .py extension is cleared.
> > >
> > >
> > >
> > >
> > > Graham
> > >
> > > On 28/01/2008, Charles Collis <charles.collis@gmail.com> wrote:
> > > > Thanks Graham.
> > > >
> > > > It now works as intended, although only with Konqueror - Firefox and
> > Safari
> > > > both blank the page and the URL in address bar goes to
> > > > http://localhost/python/launch, rather than staying at the page they
> > were on
> > > > before. Here is the new code as suggested:
> > > >
> > > > def launch(req):
> > > >    req.content_type = 'text/plain'
> > > >    raise apache.SERVER_RETURN, apache.OK
> > > >
> > > > The only other way I have been able to get it to simulate not
> leaving
> > the
> > > > current page is by returning a short bit of html containing some
> > javascript
> > > > that automatically goes back one page (from the new blank page) -
> but
> > this
> > > > is pretty ugly!
> > > >
> > > >
> > > > On Jan 27, 2008 9:12 PM, Graham Dumpleton <
> graham.dumpleton@gmail.com>
> > > > wrote:
> > > > > You still must set the response content type else the browser
> tries to
> > > > > work out what to do based on the extension in the URL. So, use:
> > > > >
> > > > >  req.content_type = 'text/plain'
> > > > >
> > > > > Graham
> > > > >
> > > > >
> > > > >
> > > > >
> > > > > On 28/01/2008, Charles Collis <charles.collis@gmail.com> wrote:
> > > > > > Hi.
> > > > > >
> > > > > > I wonder if anyone can help - I am having problems getting the
> > Publisher
> > > > > > handler to return nothing.
> > > > > >
> > > > > > I am wanting the publisher handler to return nothing when
> clicking
> > on a
> > > > link
> > > > > > that points to a particular function which will perform a system
> > > > command,
> > > > > > and I am using the recommended 'raise apache.SERVER_RETURN,
> > apache.OK'
> > > > > > trick.
> > > > > >
> > > > > > This does indeed stop the page contents refreshing, but has the
> odd
> > > > > > side-effect of the browser asking wanting to download a file (of
> > 'python
> > > > > > script' type). This behaviour happens in both Firefox 3 beta2
> and
> > > > Konqueror.
> > > > > > It even does it if the function doesn't do anything:
> > > > > >
> > > > > > def launch():
> > > > > >    pass
> > > > > >    raise apache.SERVER_RETURN, apache.OK
> > > > > >
> > > > > > I am running Ubuntu Gutsy.
> > > > > >
> > > > > > Apache and mod_python details:
> > > > > > Apache/2.2.4 (Ubuntu) mod_python/3.3.1 Python/2.5.1
> > PHP/5.2.3-1ubuntu6.3
> > > > > >
> > > > > > Any pointers appreciated. Thanks.
> > > > > >
> > > > > > Charles Collis.
> > > > > >
> > > > > > _______________________________________________
> > > > > > Mod_python mailing list
> > > > > > Mod_python@modpython.org
> > > > > >
> > > >
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> > > > > >
> > > > > >
> > > > >
> > > >
> > > >
> > >
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080131/c19b65db/attachment.html
From charles.collis at gmail.com  Thu Jan 31 04:47:55 2008
From: charles.collis at gmail.com (Charles Collis)
Date: Thu Jan 31 04:48:01 2008
Subject: [mod_python] Problem getting the Publisher handler to return
	nothing
In-Reply-To: <3787dfa80801291523w22fc2f6ehe9e805de89b9aac0@mail.gmail.com>
References: <b44a81310801271138x597f726bxdf39997892289f64@mail.gmail.com>
	<88e286470801271312s2168a1e4g3fc6dc06d0f0a25@mail.gmail.com>
	<b44a81310801271534m3971f347p28f048211f18efe7@mail.gmail.com>
	<88e286470801272158l1092ed52hf269c713a2f4b787@mail.gmail.com>
	<b44a81310801281616p22f031aib79434412d46594e@mail.gmail.com>
	<3787dfa80801291523w22fc2f6ehe9e805de89b9aac0@mail.gmail.com>
Message-ID: <b44a81310801310147o3fccfe38ldbb6c537d5f3ba63@mail.gmail.com>

Thanks necmettin,

The XMLHTTPRequest might be a good way forward, and I will probably end up
using it.

The reason I was trying the other method was that in point 2.19 in the
mod_python FAQ (http://www.modpython.org/FAQ/faqw.py?req=all#2.19) it
suggests forcing an Apache error as a very simple method of returning
nothing to the browser, so I was trying this first.

Charles.


On Jan 29, 2008 11:23 PM, Necmettin Begiter <necmettin.begiter@gmail.com>
wrote:

> 2008/1/29, Charles Collis <charles.collis@gmail.com>:
> > Thanks Graham.
> >
> > No I don't have any associated applications for .py files with my
> browser(s)
> > - I have checked the list of applications in Firefox preferences (on
> Ubuntu
> > machine) also this behaviour is happens on my Mac using Safari...
> >
> > Seems a bit odd!
>
> Been following this thread, seems what you are trying to do is to send
> a request to the server *only*, with no intention of having or showing
> a reply, in that case, this has nothing to do with Python or
> mod_python. It's about how web normally works: request-reply, ..
>
> It does not differ if the reply contains anything or not, that's how
> web servers and clients work; each request requires a reply. What you
> must do is to discard or hide the reply like so:
>
> If you have it among the options, use AJAX to fetch the reply and
> discard it (XMLHTTPRequest is the key); or, direct the output to a
> frame or iframe which is invisible (CSS and <form target=""..). Either
> way, you will get a reply from the web server but the client (person,
> not the application) will not see it.
>
> If I'm not mistaken about what you want, that is.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080131/c8f6f86d/attachment.html
From scott at 3floors.com  Thu Jan 31 05:17:45 2008
From: scott at 3floors.com (Scott Bratcher)
Date: Thu Jan 31 05:17:14 2008
Subject: [mod_python] Apache Fails to load mod_python.so with Permission
	denied error under SELinux
Message-ID: <D984D547-3319-4444-9C24-C330FB3631A3@3floors.com>

Hello all,


THE PROBLEM:

Starting Apache results in this error:

# service httpd start
Starting httpd: httpd: Syntax error on line 210 of /etc/httpd/conf/ 
httpd.conf: Syntax error on line 6 of /etc/httpd/conf.d/python.conf:  
Cannot load /etc/httpd/modules/mod_python.so into server: /etc/httpd/ 
modules/mod_python.so: cannot restore segment prot after reloc:  
Permission denied
                                                            [FAILED]

USING:

RHEL5 / SELinux
Apache 2.2
Python 2.5.1
mod_pythonn 3.3.1
httpd.conf (not .htaccess)


TESTED THUS FAR:

.so file exists with same permissions as other modules
# ls -Z /etc/httpd/modules/mod_python.so
-rwxr-xr-x  root root system_u:object_r:httpd_modules_t /etc/httpd/ 
modules/mod_python.so*

If I comment out:
"#LoadModule python_module modules/mod_python.so"
and other related python lines Apache starts just fine without  
mod_python.
# service httpd start
Starting httpd:                                            [  OK  ]


Test as seen here: http://www.dscpl.com.au/wiki/ModPython/Articles/ 
GettingModPythonWorking
# python
Python 2.5.1 (r251:54863, Jan 30 2008, 20:46:46)
[GCC 4.1.2 20070626 (Red Hat 4.1.2-14)] on linux2
Type "help", "copyright", "credits" or "license" for more information.
 >>> import mod_python.psp
ImportError: No module named _apache
 >>>

Server Output when starting Apache without mod_python:
----
[Thu Jan 31 02:30:09 2008] [notice] SELinux policy enabled; httpd  
running as context user_u:system_r:httpd_t:s0
[Thu Jan 31 02:30:09 2008] [notice] suEXEC mechanism enabled  
(wrapper: /usr/sbin/suexec)
[Thu Jan 31 02:30:10 2008] [notice] Digest: generating secret for  
digest authentication ...
[Thu Jan 31 02:30:10 2008] [notice] Digest: done
[Thu Jan 31 02:30:10 2008] [notice] Apache/2.2.3 (Red Hat) configured  
-- resuming normal operations
[Thu Jan 31 02:30:31 2008] [notice] caught SIGTERM, shutting down
----
No error generated when Syntax Error prevents startup of Apache.


QUESTIONS:

I upgraded to Apache-2.2 then upgraded to  Python-2.5 then installed  
the mod_python with ./configure,make,make install. should I have done  
this in a different order?

Could Apache's installation be pulling up python-2.4 and dislike a  
mod_python installed for python-2.5? Is this what the error would  
look like?


Thanks to anyone who has time to offer aid.

Scott



From scarfboy at gmail.com  Thu Jan 31 07:02:17 2008
From: scarfboy at gmail.com (Bart)
Date: Thu Jan 31 07:02:22 2008
Subject: [mod_python] Local Web Server
In-Reply-To: <46218daf0801300148i77af807arbac647c9f5e068ba@mail.gmail.com>
References: <46218daf0801300148i77af807arbac647c9f5e068ba@mail.gmail.com>
Message-ID: <b71082d80801310402j6b05e905n8ba205691a8f6508@mail.gmail.com>

2008/1/30 MCL Systems <mcl.office@googlemail.com>:
> I am looking for a local lightweight web server, that I can use to run
> python apps locally via my USB pen drive.
>
> I am running winxp sp2.
>
> The programs are coded for mod_python and I am using scite portable and
> portable python for my development..
>
> I am very limited in my abilities to install programs successfully, but I
> can still achieve programming results, to my satisfaction with python.
>
> My programs query text/csv files and display the results in a browser.
>
> So I imagine I will start server 'x', which will point to a document root
> and then I can access my files as  http://127.1.0.0 or whatever /mycode.py
>
> So is there a binary I can download, already configured to run locally and
> with mod_python support and all I have to do is tell it where document root
> is.

Consider cherrypy, since there's much less setup. Server code that is
based off cherrypy will work wherever cherrypy is installed and importable.
On a general python install this just takes a python setup.py install,
though I'm not sure how site packages work in portable python.

--Bart
From martijn at xs4us.nu  Thu Jan 31 10:02:10 2008
From: martijn at xs4us.nu (Martijn Moeling)
Date: Thu Jan 31 10:02:26 2008
Subject: [mod_python] mod_python.Importer.path; set dynamically
Message-ID: <B6C73A5E30565245BB6D32B5F5DF7A52172BA2@sense.emmastraat.pijnacker>


Hi!

I am an extensive mod_python user and my system needs something special.

Consider the following:

in httpd.conf I have :

PythonOption mod_python.importer.path ["/var/www/python_modules"]

/var/www/html/index.py is linked to ../python_modules/index.py

the python_modules directory has subdirectories, like; developer1, developer2

the python_modules contains stable modules and developerX holds development versions.

I have load balancing with multiple frond-ends (apache/MP) and one backend (MySQL). 

I would like to dynamically change the mod_python.importer.path so that developer1 runs code in the corresponding subdir if the module exists,
else fall back to the python_modules directory.

Any tips, suggestions, remarks?

Thanx!!

Martijn Moeling
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080131/eae79d22/attachment-0001.html
From brunson at brunson.com  Thu Jan 31 11:13:08 2008
From: brunson at brunson.com (Eric Brunson)
Date: Thu Jan 31 11:13:15 2008
Subject: [mod_python] Apache Fails to load mod_python.so with Permission
	denied error under SELinux
In-Reply-To: <D984D547-3319-4444-9C24-C330FB3631A3@3floors.com>
References: <D984D547-3319-4444-9C24-C330FB3631A3@3floors.com>
Message-ID: <47A1F394.4030506@brunson.com>

Scott Bratcher wrote:
> Hello all,
>
>
> THE PROBLEM:
>
> Starting Apache results in this error:
>
> # service httpd start
> Starting httpd: httpd: Syntax error on line 210 of 
> /etc/httpd/conf/httpd.conf: Syntax error on line 6 of 
> /etc/httpd/conf.d/python.conf: Cannot load 
> /etc/httpd/modules/mod_python.so into server: 
> /etc/httpd/modules/mod_python.so: cannot restore segment prot after 
> reloc: Permission denied
>                                                            [FAILED]
>

This error message is often related to selinux permissions.

A quick check to see if that is the problem is to disable selinux with 
the command (as root) "setenforce 0".  If the module then loads 
correctly, it can be fixed permanently with the command:

chcon -t texrel_shlib_t /etc/httpd/modules/mod_python.so

Then, re-enable selinux with "setenforce 1".

If disabling selinux does not fix the problem, then more investigation 
is required.

Hope that helps,
e.

> USING:
>
> RHEL5 / SELinux
> Apache 2.2
> Python 2.5.1
> mod_pythonn 3.3.1
> httpd.conf (not .htaccess)
>
>
> TESTED THUS FAR:
>
> .so file exists with same permissions as other modules
> # ls -Z /etc/httpd/modules/mod_python.so
> -rwxr-xr-x  root root system_u:object_r:httpd_modules_t 
> /etc/httpd/modules/mod_python.so*
>
> If I comment out:
> "#LoadModule python_module modules/mod_python.so"
> and other related python lines Apache starts just fine without 
> mod_python.
> # service httpd start
> Starting httpd:                                            [  OK  ]
>
>
> Test as seen here: 
> http://www.dscpl.com.au/wiki/ModPython/Articles/GettingModPythonWorking
> # python
> Python 2.5.1 (r251:54863, Jan 30 2008, 20:46:46)
> [GCC 4.1.2 20070626 (Red Hat 4.1.2-14)] on linux2
> Type "help", "copyright", "credits" or "license" for more information.
> >>> import mod_python.psp
> ImportError: No module named _apache
> >>>
>
> Server Output when starting Apache without mod_python:
> ----
> [Thu Jan 31 02:30:09 2008] [notice] SELinux policy enabled; httpd 
> running as context user_u:system_r:httpd_t:s0
> [Thu Jan 31 02:30:09 2008] [notice] suEXEC mechanism enabled (wrapper: 
> /usr/sbin/suexec)
> [Thu Jan 31 02:30:10 2008] [notice] Digest: generating secret for 
> digest authentication ...
> [Thu Jan 31 02:30:10 2008] [notice] Digest: done
> [Thu Jan 31 02:30:10 2008] [notice] Apache/2.2.3 (Red Hat) configured 
> -- resuming normal operations
> [Thu Jan 31 02:30:31 2008] [notice] caught SIGTERM, shutting down
> ----
> No error generated when Syntax Error prevents startup of Apache.
>
>
> QUESTIONS:
>
> I upgraded to Apache-2.2 then upgraded to  Python-2.5 then installed 
> the mod_python with ./configure,make,make install. should I have done 
> this in a different order?
>
> Could Apache's installation be pulling up python-2.4 and dislike a 
> mod_python installed for python-2.5? Is this what the error would look 
> like?
>
>
> Thanks to anyone who has time to offer aid.
>
> Scott
>
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From scott at 3floors.com  Thu Jan 31 13:47:36 2008
From: scott at 3floors.com (Scott Bratcher)
Date: Thu Jan 31 13:46:43 2008
Subject: [mod_python] Apache Fails to load mod_python.so with Permission
	denied error under SELinux
In-Reply-To: <47A1F394.4030506@brunson.com>
References: <D984D547-3319-4444-9C24-C330FB3631A3@3floors.com>
	<47A1F394.4030506@brunson.com>
Message-ID: <100F2336-310A-4970-B4BB-E27247DF66EE@3floors.com>

Thanks Eric,

"setenforce 0" THIS WORKED. Apache started right up

Below are the results of my attempts as you suggested. I think we are  
onto the problem because with SELinux enforced it loads right up.  
However, the chcon command failed to clear up the problem. I'm new to  
SELinux. Is there another possible SELinux related permission that  
may be the solution? It's just mod_python that is giving this problem  
even though all of the others share the same t permission httpd_module.

# ls -Zd modules
drwxr-xr-x  root root system_u:object_r:httpd_modules_t modules/

So I changed the permissions:

# chcon -t texrel_shlib_t /etc/httpd/modules/mod_python.so
# service httpd start
Starting httpd: httpd: Syntax error on line 210 of /etc/httpd/conf/ 
httpd.conf: Syntax error on line 6 of /etc/httpd/conf.d/python.conf:  
Cannot load /etc/httpd/modules/mod_python.so into server: /etc/httpd/ 
modules/mod_python.so: cannot restore segment prot after reloc:  
Permission denied
                                                            [FAILED]
# ls -Z /etc/httpd/modules/mod_python.so
-rwxr-xr-x  root root system_u:object_r:textrel_shlib_t /etc/httpd/ 
modules/mod_python.so*



I also tried changing the permissions of the 2.5 site-packages to the  
same permissions as the previously working 2.4 site-packages, plus  
the other listed below, and the still Apache Failure occurs.

# ls -Zd /usr/local/lib/python2.5/site-packages/ /usr/lib/python2.4/ 
site-packages/
drwxr-xr-x  root root system_u:object_r:lib_t           /usr/lib/ 
python2.4/site-packages/
drwxr-xr-x  root root user_u:object_r:lib_t             /usr/local/ 
lib/python2.5/site-packages/

system_u:object_r:lib_t
system_u:object_r:textrel_shlib_t
user_u:object_r:textrel_shlib_t


If you have other tips I'd appreciate any help you can offer.

Scott



On Jan 31, 2008, at 10:13 AM, Eric Brunson wrote:

> Scott Bratcher wrote:
>> Hello all,
>>
>>
>> THE PROBLEM:
>>
>> Starting Apache results in this error:
>>
>> # service httpd start
>> Starting httpd: httpd: Syntax error on line 210 of /etc/httpd/conf/ 
>> httpd.conf: Syntax error on line 6 of /etc/httpd/conf.d/ 
>> python.conf: Cannot load /etc/httpd/modules/mod_python.so into  
>> server: /etc/httpd/modules/mod_python.so: cannot restore segment  
>> prot after reloc: Permission denied
>>                                                            [FAILED]
>>
>
> This error message is often related to selinux permissions.
>
> A quick check to see if that is the problem is to disable selinux  
> with the command (as root) "setenforce 0".  If the module then  
> loads correctly, it can be fixed permanently with the command:
>
> chcon -t texrel_shlib_t /etc/httpd/modules/mod_python.so
>
> Then, re-enable selinux with "setenforce 1".
>
> If disabling selinux does not fix the problem, then more  
> investigation is required.
>
> Hope that helps,
> e.
>
>> USING:
>>
>> RHEL5 / SELinux
>> Apache 2.2
>> Python 2.5.1
>> mod_pythonn 3.3.1
>> httpd.conf (not .htaccess)
>>
>>
>> TESTED THUS FAR:
>>
>> .so file exists with same permissions as other modules
>> # ls -Z /etc/httpd/modules/mod_python.so
>> -rwxr-xr-x  root root system_u:object_r:httpd_modules_t /etc/httpd/ 
>> modules/mod_python.so*
>>
>> If I comment out:
>> "#LoadModule python_module modules/mod_python.so"
>> and other related python lines Apache starts just fine without  
>> mod_python.
>> # service httpd start
>> Starting httpd:                                            [  OK  ]
>>
>>
>>
>

From brunson at brunson.com  Thu Jan 31 15:00:19 2008
From: brunson at brunson.com (Eric Brunson)
Date: Thu Jan 31 15:00:23 2008
Subject: [mod_python] Apache Fails to load mod_python.so with Permission
	denied error under SELinux
In-Reply-To: <100F2336-310A-4970-B4BB-E27247DF66EE@3floors.com>
References: <D984D547-3319-4444-9C24-C330FB3631A3@3floors.com>
	<47A1F394.4030506@brunson.com>
	<100F2336-310A-4970-B4BB-E27247DF66EE@3floors.com>
Message-ID: <47A228D3.3060702@brunson.com>

Scott Bratcher wrote:
> Thanks Eric,
>
> "setenforce 0" THIS WORKED. Apache started right up
>
> Below are the results of my attempts as you suggested. I think we are 
> onto the problem because with SELinux enforced it loads right up. 
> However, the chcon command failed to clear up the problem. I'm new to 
> SELinux. Is there another possible SELinux related permission that may 
> be the solution? It's just mod_python that is giving this problem even 
> though all of the others share the same t permission httpd_module.
>
> # ls -Zd modules
> drwxr-xr-x  root root system_u:object_r:httpd_modules_t modules/
>
> So I changed the permissions:
>
> # chcon -t texrel_shlib_t /etc/httpd/modules/mod_python.so
> # service httpd start
> Starting httpd: httpd: Syntax error on line 210 of 
> /etc/httpd/conf/httpd.conf: Syntax error on line 6 of 
> /etc/httpd/conf.d/python.conf: Cannot load 
> /etc/httpd/modules/mod_python.so into server: 
> /etc/httpd/modules/mod_python.so: cannot restore segment prot after 
> reloc: Permission denied
>                                                            [FAILED]
> # ls -Z /etc/httpd/modules/mod_python.so
> -rwxr-xr-x  root root system_u:object_r:textrel_shlib_t 
> /etc/httpd/modules/mod_python.so*

I'm far from an expert in selinux, so this could be hit and miss.  The 
google article I was reading may have been out of date, I know selinux 
policies have been under heavy development in Fedora and RHEL.

Try:

chcon -t system_u:object_r:httpd_modules_t /etc/httpd/modules/mod_python.so

Later,
e.

>
>
>
> I also tried changing the permissions of the 2.5 site-packages to the 
> same permissions as the previously working 2.4 site-packages, plus the 
> other listed below, and the still Apache Failure occurs.
>
> # ls -Zd /usr/local/lib/python2.5/site-packages/ 
> /usr/lib/python2.4/site-packages/
> drwxr-xr-x  root root system_u:object_r:lib_t           
> /usr/lib/python2.4/site-packages/
> drwxr-xr-x  root root user_u:object_r:lib_t             
> /usr/local/lib/python2.5/site-packages/
>
> system_u:object_r:lib_t
> system_u:object_r:textrel_shlib_t
> user_u:object_r:textrel_shlib_t
>
>
> If you have other tips I'd appreciate any help you can offer.
>
> Scott
>
>
>
> On Jan 31, 2008, at 10:13 AM, Eric Brunson wrote:
>
>> Scott Bratcher wrote:
>>> Hello all,
>>>
>>>
>>> THE PROBLEM:
>>>
>>> Starting Apache results in this error:
>>>
>>> # service httpd start
>>> Starting httpd: httpd: Syntax error on line 210 of 
>>> /etc/httpd/conf/httpd.conf: Syntax error on line 6 of 
>>> /etc/httpd/conf.d/python.conf: Cannot load 
>>> /etc/httpd/modules/mod_python.so into server: 
>>> /etc/httpd/modules/mod_python.so: cannot restore segment prot after 
>>> reloc: Permission denied
>>>                                                            [FAILED]
>>>
>>
>> This error message is often related to selinux permissions.
>>
>> A quick check to see if that is the problem is to disable selinux 
>> with the command (as root) "setenforce 0".  If the module then loads 
>> correctly, it can be fixed permanently with the command:
>>
>> chcon -t texrel_shlib_t /etc/httpd/modules/mod_python.so
>>
>> Then, re-enable selinux with "setenforce 1".
>>
>> If disabling selinux does not fix the problem, then more 
>> investigation is required.
>>
>> Hope that helps,
>> e.
>>
>>> USING:
>>>
>>> RHEL5 / SELinux
>>> Apache 2.2
>>> Python 2.5.1
>>> mod_pythonn 3.3.1
>>> httpd.conf (not .htaccess)
>>>
>>>
>>> TESTED THUS FAR:
>>>
>>> .so file exists with same permissions as other modules
>>> # ls -Z /etc/httpd/modules/mod_python.so
>>> -rwxr-xr-x  root root system_u:object_r:httpd_modules_t 
>>> /etc/httpd/modules/mod_python.so*
>>>
>>> If I comment out:
>>> "#LoadModule python_module modules/mod_python.so"
>>> and other related python lines Apache starts just fine without 
>>> mod_python.
>>> # service httpd start
>>> Starting httpd:                                            [  OK  ]
>>>
>>>
>>>
>>
>

From emailmanjula at yahoo.com  Thu Jan 31 15:25:24 2008
From: emailmanjula at yahoo.com (Manjula Kumar)
Date: Thu Jan 31 15:25:38 2008
Subject: [mod_python] Apache Fails to load mod_python.so with Permission
	denied error under SELinux
In-Reply-To: <47A228D3.3060702@brunson.com>
Message-ID: <836967.28064.qm@web35511.mail.mud.yahoo.com>

Hi All,
   I downloaded mod_python3.3.1 for Apache 2.2 and python 2.5 for Windows.But when i restart the apache it is giving the error,
  httpd.exe: Syntax error on line 116 of C:/Program Files/Apache Software Foundation/Apache2.2/conf/httpd.conf: Cannot load C:/Program Files/Apache Software Foundation/Apache2.2/modules/mod_python.so into server: The specified module could not be found.
But i am able to see the mod_python load module installed.
   If I comment out:
 #LoadModule python_module modules/mod_python.so
  Apache starts just fine without.
   
  Can anyone let me know what I am doing wrong.
   
  Thanks,
  Manjula 

  
Eric Brunson <brunson@brunson.com> wrote:
  Scott Bratcher wrote:
> Thanks Eric,
>
> "setenforce 0" THIS WORKED. Apache started right up
>
> Below are the results of my attempts as you suggested. I think we are 
> onto the problem because with SELinux enforced it loads right up. 
> However, the chcon command failed to clear up the problem. I'm new to 
> SELinux. Is there another possible SELinux related permission that may 
> be the solution? It's just mod_python that is giving this problem even 
> though all of the others share the same t permission httpd_module.
>
> # ls -Zd modules
> drwxr-xr-x root root system_u:object_r:httpd_modules_t modules/
>
> So I changed the permissions:
>
> # chcon -t texrel_shlib_t /etc/httpd/modules/mod_python.so
> # service httpd start
> Starting httpd: httpd: Syntax error on line 210 of 
> /etc/httpd/conf/httpd.conf: Syntax error on line 6 of 
> /etc/httpd/conf.d/python.conf: Cannot load 
> /etc/httpd/modules/mod_python.so into server: 
> /etc/httpd/modules/mod_python.so: cannot restore segment prot after 
> reloc: Permission denied
> [FAILED]
> # ls -Z /etc/httpd/modules/mod_python.so
> -rwxr-xr-x root root system_u:object_r:textrel_shlib_t 
> /etc/httpd/modules/mod_python.so*

I'm far from an expert in selinux, so this could be hit and miss. The 
google article I was reading may have been out of date, I know selinux 
policies have been under heavy development in Fedora and RHEL.

Try:

chcon -t system_u:object_r:httpd_modules_t /etc/httpd/modules/mod_python.so

Later,
e.

>
>
>
> I also tried changing the permissions of the 2.5 site-packages to the 
> same permissions as the previously working 2.4 site-packages, plus the 
> other listed below, and the still Apache Failure occurs.
>
> # ls -Zd /usr/local/lib/python2.5/site-packages/ 
> /usr/lib/python2.4/site-packages/
> drwxr-xr-x root root system_u:object_r:lib_t 
> /usr/lib/python2.4/site-packages/
> drwxr-xr-x root root user_u:object_r:lib_t 
> /usr/local/lib/python2.5/site-packages/
>
> system_u:object_r:lib_t
> system_u:object_r:textrel_shlib_t
> user_u:object_r:textrel_shlib_t
>
>
> If you have other tips I'd appreciate any help you can offer.
>
> Scott
>
>
>
> On Jan 31, 2008, at 10:13 AM, Eric Brunson wrote:
>
>> Scott Bratcher wrote:
>>> Hello all,
>>>
>>>
>>> THE PROBLEM:
>>>
>>> Starting Apache results in this error:
>>>
>>> # service httpd start
>>> Starting httpd: httpd: Syntax error on line 210 of 
>>> /etc/httpd/conf/httpd.conf: Syntax error on line 6 of 
>>> /etc/httpd/conf.d/python.conf: Cannot load 
>>> /etc/httpd/modules/mod_python.so into server: 
>>> /etc/httpd/modules/mod_python.so: cannot restore segment prot after 
>>> reloc: Permission denied
>>> [FAILED]
>>>
>>
>> This error message is often related to selinux permissions.
>>
>> A quick check to see if that is the problem is to disable selinux 
>> with the command (as root) "setenforce 0". If the module then loads 
>> correctly, it can be fixed permanently with the command:
>>
>> chcon -t texrel_shlib_t /etc/httpd/modules/mod_python.so
>>
>> Then, re-enable selinux with "setenforce 1".
>>
>> If disabling selinux does not fix the problem, then more 
>> investigation is required.
>>
>> Hope that helps,
>> e.
>>
>>> USING:
>>>
>>> RHEL5 / SELinux
>>> Apache 2.2
>>> Python 2.5.1
>>> mod_pythonn 3.3.1
>>> httpd.conf (not .htaccess)
>>>
>>>
>>> TESTED THUS FAR:
>>>
>>> .so file exists with same permissions as other modules
>>> # ls -Z /etc/httpd/modules/mod_python.so
>>> -rwxr-xr-x root root system_u:object_r:httpd_modules_t 
>>> /etc/httpd/modules/mod_python.so*
>>>
>>> If I comment out:
>>> "#LoadModule python_module modules/mod_python.so"
>>> and other related python lines Apache starts just fine without 
>>> mod_python.
>>> # service httpd start
>>> Starting httpd: [ OK ]
>>>
>>>
>>>
>>
>

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://mailman.modpython.org/mailman/listinfo/mod_python


       
---------------------------------
Be a better friend, newshound, and know-it-all with Yahoo! Mobile.  Try it now.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080131/3e4e6bfb/attachment.html
From graham.dumpleton at gmail.com  Thu Jan 31 17:03:44 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu Jan 31 17:03:57 2008
Subject: [mod_python] mod_python.Importer.path; set dynamically
In-Reply-To: <B6C73A5E30565245BB6D32B5F5DF7A52172BA2@sense.emmastraat.pijnacker>
References: <B6C73A5E30565245BB6D32B5F5DF7A52172BA2@sense.emmastraat.pijnacker>
Message-ID: <88e286470801311403u467069a8r75eab9f16184c0fd@mail.gmail.com>

On 01/02/2008, Martijn Moeling <martijn@xs4us.nu> wrote:
> Hi!
>
>  I am an extensive mod_python user and my system needs something special.
>
>  Consider the following:
>
>  in httpd.conf I have :
>
>  PythonOption mod_python.importer.path ["/var/www/python_modules"]
>
>  /var/www/html/index.py is linked to ../python_modules/index.py
>
>  the python_modules directory has subdirectories, like; developer1,
> developer2
>
>  the python_modules contains stable modules and developerX holds development
> versions.
>
>  I have load balancing with multiple frond-ends (apache/MP) and one backend
> (MySQL).
>
>  I would like to dynamically change the mod_python.importer.path so that
> developer1 runs code in the corresponding subdir if the module exists,
>  else fall back to the python_modules directory.
>
>  Any tips, suggestions, remarks?

What is the distinguisher used to know which developer it is? Are you
using something like Basic authentication and so could distinguish
based on req.user?

If you tell me what the distinguisher is, probably have an idea.

Graham
From graham.dumpleton at gmail.com  Thu Jan 31 17:08:54 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu Jan 31 17:09:00 2008
Subject: [mod_python] Apache Fails to load mod_python.so on Windows
Message-ID: <88e286470801311408n593156cct65a13014babad317@mail.gmail.com>

Please don't follow up to a different thread with a new question.
Subject now changed.

If you are running Apache as a service, it may be running as a
specific user, not the one which you installed the mod_python code as.
If this is the case, you need to make sure that the user that Apache
is running as has correct access rights to be able to read the module
file.

If this has occurred, you may also have problems with loaded module
then being able to read the installed Python code files.

Generally it is recommended that Apache, Python and mod_python all be
installed as an administrator and not as an individual user.

Graham

On 01/02/2008, Manjula Kumar <emailmanjula@yahoo.com> wrote:
> Hi All,
>  I downloaded mod_python3.3.1 for Apache 2.2 and python 2.5 for Windows.But
> when i restart the apache it is giving the error,
> httpd.exe: Syntax error on line 116 of C:/Program Files/Apache Software
> Foundation/Apache2.2/conf/httpd.conf: Cannot load
> C:/Program Files/Apache Software
> Foundation/Apache2.2/modules/mod_python.so into server: The
> specified module could not be found.
> But i am able to see the mod_python load module installed.
>  If I comment out:
>  #LoadModule python_module modules/mod_python.so
>   Apache starts just fine without.
>
> Can anyone let me know what I am doing wrong.
>
> Thanks,
> Manjula
>
>
> Eric Brunson <brunson@brunson.com> wrote:
> Scott Bratcher wrote:
> > Thanks Eric,
> >
> > "setenforce 0" THIS WORKED. Apache started right up
> >
> > Below are the results of my attempts as you suggested. I think we are
> > onto the problem because with SELinux enforced it loads right up.
> > However, the chcon command failed to clear up the problem. I'm new to
> > SELinux. Is there another possible SELinux related permission that may
> > be the solution? It's just mod_python that is giving this problem even
> > though all of the others share the same t permission httpd_module.
> >
> > # ls -Zd modules
> > drwxr-xr-x root root system_u:object_r:httpd_modules_t
> modules/
> >
> > So I changed the permissions:
> >
> > # chcon -t texrel_shlib_t
> /etc/httpd/modules/mod_python.so
> > # service httpd start
> > Starting httpd: httpd: Syntax error on line 210 of
> > /etc/httpd/conf/httpd.conf: Syntax error on line 6 of
> > /etc/httpd/conf.d/python.conf: Cannot load
> > /etc/httpd/modules/mod_python.so into server:
> > /etc/httpd/modules/mod_python.so: cannot restore segment
> prot after
> > reloc: Permission denied
> > [FAILED]
> > # ls -Z /etc/httpd/modules/mod_python.so
> > -rwxr-xr-x root root system_u:object_r:textrel_shlib_t
> > /etc/httpd/modules/mod_python.so*
>
> I'm far from an expert in selinux, so this could be hit and miss. The
> google article I was reading may have been out of date, I know selinux
> policies have been under heavy development in Fedora and RHEL.
>
> Try:
>
> chcon -t system_u:object_r:httpd_modules_t
> /etc/httpd/modules/mod_python.so
>
> Later,
> e.
>
> >
> >
> >
> > I also tried changing the permissions of the 2.5 site-packages to the
> > same permissions as the previously working 2.4 site-packages, plus the
> > other listed below, and the still Apache Failure occurs.
> >
> > # ls -Zd /usr/local/lib/python2.5/site-packages/
> > /usr/lib/python2.4/site-packages/
> > drwxr-xr-x root root system_u:object_r:lib_t
> > /usr/lib/python2.4/site-packages/
> > drwxr-xr-x root root user_u:object_r:lib_t
> > /usr/local/lib/python2.5/site-packages/
> >
> > system_u:object_r:lib_t
> > system_u:object_r:textrel_shlib_t
> > user_u:object_r:textrel_shlib_t
> >
> >
> > If you have other tips I'd appreciate any help you can offer.
> >
> > Scott
> >
> >
> >
> > On Jan 31, 2008, at 10:13 AM, Eric Brunson wrote:
> >
> >> Scott Bratcher wrote:
> >>> Hello all,
> >>>
> >>>
> >>> THE PROBLEM:
> >>>
> >>> Starting Apache results in this error:
> >>>
> >>> # service httpd start
> >>> Starting httpd: httpd: Syntax error on line 210 of
> >>> /etc/httpd/conf/httpd.conf: Syntax error on line 6 of
> >>> /etc/httpd/conf.d/python.conf: Cannot load
> >>> /etc/httpd/modules/mod_python.so into server:
> >>> /etc/httpd/modules/mod_python.so: cannot restore
> segment prot after
> >>> reloc: Permission denied
> >>> [FAILED]
> >>>
> >>
> >> This error message is often related to selinux permissions.
> >>
> >> A quick check to see if that is the problem is to disable selinux
> >> with the command (as root) "setenforce 0". If the module then loads
> >> correctly, it can be fixed permanently with the command:
> >>
> >> chcon -t texrel_shlib_t /etc/httpd/modules/mod_python.so
> >>
> >> Then, re-enable selinux with "setenforce 1".
> >>
> >> If disabling selinux does not fix the problem, then more
> >> investigation is required.
> >>
> >> Hope that helps,
> >> e.
> >>
> >>> USING:
> >>>
> >>> RHEL5 / SELinux
> >>> Apache 2.2
> >>> Python 2.5.1
> >>> mod_pythonn 3.3.1
> >>> httpd.conf (not .htaccess)
> >>>
> >>>
> >>> TESTED THUS FAR:
> >>>
> >>> .so file exists with same permissions as other modules
> >>> # ls -Z /etc/httpd/modules/mod_python.so
> >>> -rwxr-xr-x root root system_u:object_r:httpd_modules_t
> >>> /etc/httpd/modules/mod_python.so*
> >>>
> >>> If I comment out:
> >>> "#LoadModule python_module modules/mod_python.so"
> >>> and other related python lines Apache starts just fine without
> >>> mod_python.
> >>> # service httpd start
> >>> Starting httpd: [ OK ]
> >>>
> >>>
> >>>
> >>
> >
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
>
>  ________________________________
> Be a better friend, newshound, and know-it-all with Yahoo! Mobile. Try it
> now.
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
From charles.collis at gmail.com  Thu Jan 31 18:35:50 2008
From: charles.collis at gmail.com (Charles Collis)
Date: Thu Jan 31 18:35:56 2008
Subject: [mod_python] Problem getting the Publisher handler to return
	nothing
In-Reply-To: <3787dfa80801310203w2e773e8fo5fd828b9f63175ef@mail.gmail.com>
References: <b44a81310801271138x597f726bxdf39997892289f64@mail.gmail.com>
	<88e286470801271312s2168a1e4g3fc6dc06d0f0a25@mail.gmail.com>
	<b44a81310801271534m3971f347p28f048211f18efe7@mail.gmail.com>
	<88e286470801272158l1092ed52hf269c713a2f4b787@mail.gmail.com>
	<b44a81310801281616p22f031aib79434412d46594e@mail.gmail.com>
	<3787dfa80801291523w22fc2f6ehe9e805de89b9aac0@mail.gmail.com>
	<b44a81310801310147o3fccfe38ldbb6c537d5f3ba63@mail.gmail.com>
	<3787dfa80801310203w2e773e8fo5fd828b9f63175ef@mail.gmail.com>
Message-ID: <b44a81310801311535n2644471eg70768543c93315f8@mail.gmail.com>

Hadn't tried it before, but have now - unfortunately still no joy.

If I return 'apache.HTTP_NO_CONTENT' my browser then shows a blank page with
'24' at the top which presumably is the code for 'HTTP_NO_CONTENT'.

If I raise the error:

raise apache.HTTP_NO_CONTENT, apache.OK (whether I put ',apache.OK' there or
not),

I get an error message in browser saying:

'TypeError: exceptions must be classes, instances, or strings
(deprecated), not int'


>
> Have you tried returning apache.HTTP_NO_CONTENT ?
> According to [0],
> http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html this should
> cause clients do nothing. As the behaviour of the client cannot be
> controlled except for a status code in the header, this might be an
> option easier than creating internal requests using Ajax.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080131/b3709b90/attachment.html
From graham.dumpleton at gmail.com  Thu Jan 31 19:20:06 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu Jan 31 19:20:15 2008
Subject: [mod_python] Problem getting the Publisher handler to return
	nothing
In-Reply-To: <b44a81310801311535n2644471eg70768543c93315f8@mail.gmail.com>
References: <b44a81310801271138x597f726bxdf39997892289f64@mail.gmail.com>
	<88e286470801271312s2168a1e4g3fc6dc06d0f0a25@mail.gmail.com>
	<b44a81310801271534m3971f347p28f048211f18efe7@mail.gmail.com>
	<88e286470801272158l1092ed52hf269c713a2f4b787@mail.gmail.com>
	<b44a81310801281616p22f031aib79434412d46594e@mail.gmail.com>
	<3787dfa80801291523w22fc2f6ehe9e805de89b9aac0@mail.gmail.com>
	<b44a81310801310147o3fccfe38ldbb6c537d5f3ba63@mail.gmail.com>
	<3787dfa80801310203w2e773e8fo5fd828b9f63175ef@mail.gmail.com>
	<b44a81310801311535n2644471eg70768543c93315f8@mail.gmail.com>
Message-ID: <88e286470801311620n520b3288j22b76b27bc0ec42e@mail.gmail.com>

On 01/02/2008, Charles Collis <charles.collis@gmail.com> wrote:
> Hadn't tried it before, but have now - unfortunately still no joy.
>
> If I return 'apache.HTTP_NO_CONTENT' my browser then shows a blank page with
> '24' at the top which presumably is the code for 'HTTP_NO_CONTENT'.
>
> If I raise the error:
>
> raise apache.HTTP_NO_CONTENT, apache.OK (whether I put ',apache.OK' there or
> not),

Use:

  raise apache.SERVER_RETURN, apache.HTTP_NO_CONTENT

I am not sure though whether that will still trigger Apache to send a
default error page. You may have to use:

  req.status = apache.HTTP_NO_CONTENT
  raise apache.SERVER_RETURN, apache.DONE

to be absolutely sure that Apache doesn't further process it.

Graham

> I get an error message in browser saying:
> 'TypeError: exceptions must be classes, instances, or strings (deprecated),
> not int'
>
>
>
> >
> >
> >
> >
> > Have you tried returning apache.HTTP_NO_CONTENT ?
> > According to [0],
> > http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html
> this should
> > cause clients do nothing. As the behaviour of the client cannot be
> > controlled except for a status code in the header, this might be an
> > option easier than creating internal requests using Ajax.
> >
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
From scott at 3floors.com  Thu Jan 31 19:28:58 2008
From: scott at 3floors.com (Scott Bratcher)
Date: Thu Jan 31 19:28:05 2008
Subject: [mod_python] Apache Fails to load mod_python.so with
	Permissiondenied error under SELinux
In-Reply-To: <004f01c86441$6e292060$0200a8c0@TMSMAIN>
References: <D984D547-3319-4444-9C24-C330FB3631A3@3floors.com><47A1F394.4030506@brunson.com>
	<100F2336-310A-4970-B4BB-E27247DF66EE@3floors.com>
	<004f01c86441$6e292060$0200a8c0@TMSMAIN>
Message-ID: <F593A28B-30EE-4BA9-898C-522D36C034D6@3floors.com>

Thanks Eric and Tom,

Unresolved however. I did some permissions tests based on your feedback.


I'm chasing this issue as though it is a permissions issue and have  
identified SELinux as the hold-up. I've tried all of these permission  
sets on the modules actual folder and the modules symlinked folder.
I did both directories just in case the permissions trickle down to  
the actual files being loaded by mod_python itself:

# chcon -R -h -u system_u -r object_r -t httpd_sys_content_t /usr/lib/ 
httpd/modules /etc/httpd/modules
# chcon -R -h -u user_u -r object_r -t httpd_sys_content_t /usr/lib/ 
httpd/modules /etc/httpd/modules
# chcon -R -h -u user_u -r object_r -t httpd_modules_t /usr/lib/httpd/ 
modules /etc/httpd/modules
# chcon -R -h -u system_u -r object_r -t httpd_modules_t /usr/lib/ 
httpd/modules /etc/httpd/modules ((( This one is the original  
permission of all apache modules)))
# chcon -R -h -u system_u -r object_r -t lib_t /usr/lib/httpd/ 
modules /etc/httpd/modules
# chcon -R -h -u system_u -r object_r -t shlib_t /usr/lib/httpd/ 
modules /etc/httpd/modules
# chcon -R -h -u system_u -r object_r -t textrel_shlib_t /usr/lib/ 
httpd/modules /etc/httpd/modules

All gave this error:
----------
# service httpd start
Starting httpd: httpd: Syntax error on line 210 of /etc/httpd/conf/ 
httpd.conf: Syntax error on line 6 of /etc/httpd/conf.d/python.conf:  
Cannot load /etc/httpd/modules/mod_python.so into server: /etc/httpd/ 
modules/mod_python.so: cannot restore segment prot after reloc:  
Permission denied
                                                            [FAILED]
----------

---> This is the only one that gave me a different error.
----------
# chcon -R -h -u system_u -t textrel_shlib_t /usr/lib/httpd/modules / 
etc/httpd/modules
# service httpd start
Starting httpd: httpd: Syntax error on line 148 of /etc/httpd/conf/ 
httpd.conf: Cannot load /etc/httpd/modules/mod_auth_basic.so into  
server: /etc/httpd/modules/mod_auth_basic.so: cannot open shared  
object file: Permission denied
                                                            [FAILED]
----------


****AGAIN I MUST NOTE: All is solved by turning off SELinux and/or  
All is solved by not loading mod_python. All other modules loaded  
just fine with their original permissions which matched mod_python  
exactly.




Scott



On Jan 31, 2008, at 1:42 PM, Tom Stambaugh wrote:

> The incantation that I use (for solving different problems, though)  
> is:
>
> chcon -R -h -t httpd_sys_content_t <filename>
>
> I think the "-R" makes it recurse to all children, and I think the
> "httpd_sys_content_t" is more permissive (though that could be  
> mistaken).
> The -h causes it to apply to sym links.
>
> Afterwords, I get:
>
> #ls -lZ adminuser
> -rw-rw-r--  zeetix   zeetix   user_u:object_r:httpd_sys_content_t  
> <filename>
>
> I use Fedora core3/core4 linux, so YMMV.
>
> Thx,
> Tom
>
> ----- Original Message -----
> From: "Scott Bratcher" <scott@3floors.com>
> To: "Eric Brunson" <brunson@brunson.com>
> Cc: <mod_python@modpython.org>
> Sent: Thursday, January 31, 2008 1:47 PM
> Subject: Re: [mod_python] Apache Fails to load mod_python.so with
> Permissiondenied error under SELinux
>
>
>> Thanks Eric,
>>
>> "setenforce 0" THIS WORKED. Apache started right up
>>
>> Below are the results of my attempts as you suggested. I think we are
>> onto the problem because with SELinux enforced it loads right up.
>> However, the chcon command failed to clear up the problem. I'm new to
>> SELinux. Is there another possible SELinux related permission  
>> that  may be
>> the solution? It's just mod_python that is giving this problem  even
>> though all of the others share the same t permission httpd_module.
>>
>> # ls -Zd modules
>> drwxr-xr-x  root root system_u:object_r:httpd_modules_t modules/
>>
>> So I changed the permissions:
>>
>> # chcon -t texrel_shlib_t /etc/httpd/modules/mod_python.so
>> # service httpd start
>> Starting httpd: httpd: Syntax error on line 210 of /etc/httpd/conf/
>> httpd.conf: Syntax error on line 6 of /etc/httpd/conf.d/python.conf:
>> Cannot load /etc/httpd/modules/mod_python.so into server: /etc/httpd/
>> modules/mod_python.so: cannot restore segment prot after reloc:
>> Permission denied
>>                                                            [FAILED]
>> # ls -Z /etc/httpd/modules/mod_python.so
>> -rwxr-xr-x  root root system_u:object_r:textrel_shlib_t /etc/httpd/
>> modules/mod_python.so*
>>
>>
>>
>> I also tried changing the permissions of the 2.5 site-packages to the
>> same permissions as the previously working 2.4 site-packages,  
>> plus  the
>> other listed below, and the still Apache Failure occurs.
>>
>> # ls -Zd /usr/local/lib/python2.5/site-packages/ /usr/lib/python2.4/
>> site-packages/
>> drwxr-xr-x  root root system_u:object_r:lib_t           /usr/lib/
>> python2.4/site-packages/
>> drwxr-xr-x  root root user_u:object_r:lib_t             /usr/local/
>> lib/python2.5/site-packages/
>>
>> system_u:object_r:lib_t
>> system_u:object_r:textrel_shlib_t
>> user_u:object_r:textrel_shlib_t
>>
>>
>> If you have other tips I'd appreciate any help you can offer.
>>
>> Scott
>>
>>
>>
>> On Jan 31, 2008, at 10:13 AM, Eric Brunson wrote:
>>
>>> Scott Bratcher wrote:
>>>> Hello all,
>>>>
>>>>
>>>> THE PROBLEM:
>>>>
>>>> Starting Apache results in this error:
>>>>
>>>> # service httpd start
>>>> Starting httpd: httpd: Syntax error on line 210 of /etc/httpd/conf/
>>>> httpd.conf: Syntax error on line 6 of /etc/httpd/conf.d/  
>>>> python.conf:
>>>> Cannot load /etc/httpd/modules/mod_python.so into  server:
>>>> /etc/httpd/modules/mod_python.so: cannot restore segment  prot  
>>>> after
>>>> reloc: Permission denied
>>>>                                                            [FAILED]
>>>>
>>>
>>> This error message is often related to selinux permissions.
>>>
>>> A quick check to see if that is the problem is to disable  
>>> selinux  with
>>> the command (as root) "setenforce 0".  If the module then  loads
>>> correctly, it can be fixed permanently with the command:
>>>
>>> chcon -t texrel_shlib_t /etc/httpd/modules/mod_python.so
>>>
>>> Then, re-enable selinux with "setenforce 1".
>>>
>>> If disabling selinux does not fix the problem, then more   
>>> investigation
>>> is required.
>>>
>>> Hope that helps,
>>> e.
>>>
>>>> USING:
>>>>
>>>> RHEL5 / SELinux
>>>> Apache 2.2
>>>> Python 2.5.1
>>>> mod_pythonn 3.3.1
>>>> httpd.conf (not .htaccess)
>>>>
>>>>
>>>> TESTED THUS FAR:
>>>>
>>>> .so file exists with same permissions as other modules
>>>> # ls -Z /etc/httpd/modules/mod_python.so
>>>> -rwxr-xr-x  root root system_u:object_r:httpd_modules_t /etc/httpd/
>>>> modules/mod_python.so*
>>>>
>>>> If I comment out:
>>>> "#LoadModule python_module modules/mod_python.so"
>>>> and other related python lines Apache starts just fine without
>>>> mod_python.
>>>> # service httpd start
>>>> Starting httpd:                                            [  OK  ]
>>>>
>>>>
>>>>
>>>
>>
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>
>
>
>

From brunson at brunson.com  Thu Jan 31 19:34:31 2008
From: brunson at brunson.com (Eric Brunson)
Date: Thu Jan 31 19:34:42 2008
Subject: [mod_python] Apache Fails to load mod_python.so with
	Permissiondenied error under SELinux
In-Reply-To: <F593A28B-30EE-4BA9-898C-522D36C034D6@3floors.com>
References: <D984D547-3319-4444-9C24-C330FB3631A3@3floors.com><47A1F394.4030506@brunson.com>
	<100F2336-310A-4970-B4BB-E27247DF66EE@3floors.com>
	<004f01c86441$6e292060$0200a8c0@TMSMAIN>
	<F593A28B-30EE-4BA9-898C-522D36C034D6@3floors.com>
Message-ID: <47A26917.2020704@brunson.com>


What distro are you running?  Did you install from a package or from 
source?  I have RHEL5, CentOS5 and Fedora 8 machines and they all have 
no problem with selinux and loading mod_python.so.

Just curious.

Scott Bratcher wrote:
> Thanks Eric and Tom,
>
> Unresolved however. I did some permissions tests based on your feedback.
>
>
> I'm chasing this issue as though it is a permissions issue and have 
> identified SELinux as the hold-up. I've tried all of these permission 
> sets on the modules actual folder and the modules symlinked folder.
> I did both directories just in case the permissions trickle down to 
> the actual files being loaded by mod_python itself:
>
> # chcon -R -h -u system_u -r object_r -t httpd_sys_content_t 
> /usr/lib/httpd/modules /etc/httpd/modules
> # chcon -R -h -u user_u -r object_r -t httpd_sys_content_t 
> /usr/lib/httpd/modules /etc/httpd/modules
> # chcon -R -h -u user_u -r object_r -t httpd_modules_t 
> /usr/lib/httpd/modules /etc/httpd/modules
> # chcon -R -h -u system_u -r object_r -t httpd_modules_t 
> /usr/lib/httpd/modules /etc/httpd/modules ((( This one is the original 
> permission of all apache modules)))
> # chcon -R -h -u system_u -r object_r -t lib_t /usr/lib/httpd/modules 
> /etc/httpd/modules
> # chcon -R -h -u system_u -r object_r -t shlib_t 
> /usr/lib/httpd/modules /etc/httpd/modules
> # chcon -R -h -u system_u -r object_r -t textrel_shlib_t 
> /usr/lib/httpd/modules /etc/httpd/modules
>
> All gave this error:
> ----------
> # service httpd start
> Starting httpd: httpd: Syntax error on line 210 of 
> /etc/httpd/conf/httpd.conf: Syntax error on line 6 of 
> /etc/httpd/conf.d/python.conf: Cannot load 
> /etc/httpd/modules/mod_python.so into server: 
> /etc/httpd/modules/mod_python.so: cannot restore segment prot after 
> reloc: Permission denied
>                                                            [FAILED]
> ----------
>
> ---> This is the only one that gave me a different error.
> ----------
> # chcon -R -h -u system_u -t textrel_shlib_t /usr/lib/httpd/modules 
> /etc/httpd/modules
> # service httpd start
> Starting httpd: httpd: Syntax error on line 148 of 
> /etc/httpd/conf/httpd.conf: Cannot load 
> /etc/httpd/modules/mod_auth_basic.so into server: 
> /etc/httpd/modules/mod_auth_basic.so: cannot open shared object file: 
> Permission denied
>                                                            [FAILED]
> ----------
>
>
> ****AGAIN I MUST NOTE: All is solved by turning off SELinux and/or All 
> is solved by not loading mod_python. All other modules loaded just 
> fine with their original permissions which matched mod_python exactly.
>
>
>
>
> Scott
>
>
>
> On Jan 31, 2008, at 1:42 PM, Tom Stambaugh wrote:
>
>> The incantation that I use (for solving different problems, though) is:
>>
>> chcon -R -h -t httpd_sys_content_t <filename>
>>
>> I think the "-R" makes it recurse to all children, and I think the
>> "httpd_sys_content_t" is more permissive (though that could be 
>> mistaken).
>> The -h causes it to apply to sym links.
>>
>> Afterwords, I get:
>>
>> #ls -lZ adminuser
>> -rw-rw-r--  zeetix   zeetix   user_u:object_r:httpd_sys_content_t 
>> <filename>
>>
>> I use Fedora core3/core4 linux, so YMMV.
>>
>> Thx,
>> Tom
>>
>>
>>>
>>
>>
>

From graham.dumpleton at gmail.com  Thu Jan 31 19:51:20 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu Jan 31 19:51:28 2008
Subject: [mod_python] Apache Fails to load mod_python.so with
	Permissiondenied error under SELinux
In-Reply-To: <F593A28B-30EE-4BA9-898C-522D36C034D6@3floors.com>
References: <D984D547-3319-4444-9C24-C330FB3631A3@3floors.com>
	<47A1F394.4030506@brunson.com>
	<100F2336-310A-4970-B4BB-E27247DF66EE@3floors.com>
	<004f01c86441$6e292060$0200a8c0@TMSMAIN>
	<F593A28B-30EE-4BA9-898C-522D36C034D6@3floors.com>
Message-ID: <88e286470801311651j4e2c129al2c4cb226c3ca51a0@mail.gmail.com>

How big is your:

  /etc/httpd/modules/mod_python.so

file? If you run ldd on it, what does it output as far as dependencies
on shared libraries?

One of the problems with some Python installations is that they still
do not provide a shared library and so a static library gets embedded
in mod_python.so. This results in some messy adress relocations having
to be done when mod_python.so is loaded. I am wandering whether the
'reloc' mentioned in:

  cannot restore segment prot after reloc

is the module loading relocations and it is having a problem with that.

If there is no libpythonX.Y.so linked to mod_python.so, then reinstall
Python using --enable-shared to configure, possibly fix up missing
libpythonX.Y.so symlink in Python installed config directory and then
rebuild mod_python, see if that makes a difference.

Probably nothing to do with this, but if nothing else works. :-)

Graham

On 01/02/2008, Scott Bratcher <scott@3floors.com> wrote:
> Thanks Eric and Tom,
>
> Unresolved however. I did some permissions tests based on your feedback.
>
>
> I'm chasing this issue as though it is a permissions issue and have
> identified SELinux as the hold-up. I've tried all of these permission
> sets on the modules actual folder and the modules symlinked folder.
> I did both directories just in case the permissions trickle down to
> the actual files being loaded by mod_python itself:
>
> # chcon -R -h -u system_u -r object_r -t httpd_sys_content_t /usr/lib/
> httpd/modules /etc/httpd/modules
> # chcon -R -h -u user_u -r object_r -t httpd_sys_content_t /usr/lib/
> httpd/modules /etc/httpd/modules
> # chcon -R -h -u user_u -r object_r -t httpd_modules_t /usr/lib/httpd/
> modules /etc/httpd/modules
> # chcon -R -h -u system_u -r object_r -t httpd_modules_t /usr/lib/
> httpd/modules /etc/httpd/modules ((( This one is the original
> permission of all apache modules)))
> # chcon -R -h -u system_u -r object_r -t lib_t /usr/lib/httpd/
> modules /etc/httpd/modules
> # chcon -R -h -u system_u -r object_r -t shlib_t /usr/lib/httpd/
> modules /etc/httpd/modules
> # chcon -R -h -u system_u -r object_r -t textrel_shlib_t /usr/lib/
> httpd/modules /etc/httpd/modules
>
> All gave this error:
> ----------
> # service httpd start
> Starting httpd: httpd: Syntax error on line 210 of /etc/httpd/conf/
> httpd.conf: Syntax error on line 6 of /etc/httpd/conf.d/python.conf:
> Cannot load /etc/httpd/modules/mod_python.so into server: /etc/httpd/
> modules/mod_python.so: cannot restore segment prot after reloc:
> Permission denied
>                                                             [FAILED]
> ----------
>
> ---> This is the only one that gave me a different error.
> ----------
> # chcon -R -h -u system_u -t textrel_shlib_t /usr/lib/httpd/modules /
> etc/httpd/modules
> # service httpd start
> Starting httpd: httpd: Syntax error on line 148 of /etc/httpd/conf/
> httpd.conf: Cannot load /etc/httpd/modules/mod_auth_basic.so into
> server: /etc/httpd/modules/mod_auth_basic.so: cannot open shared
> object file: Permission denied
>                                                             [FAILED]
> ----------
>
>
> ****AGAIN I MUST NOTE: All is solved by turning off SELinux and/or
> All is solved by not loading mod_python. All other modules loaded
> just fine with their original permissions which matched mod_python
> exactly.
>
>
>
>
> Scott
>
>
>
> On Jan 31, 2008, at 1:42 PM, Tom Stambaugh wrote:
>
> > The incantation that I use (for solving different problems, though)
> > is:
> >
> > chcon -R -h -t httpd_sys_content_t <filename>
> >
> > I think the "-R" makes it recurse to all children, and I think the
> > "httpd_sys_content_t" is more permissive (though that could be
> > mistaken).
> > The -h causes it to apply to sym links.
> >
> > Afterwords, I get:
> >
> > #ls -lZ adminuser
> > -rw-rw-r--  zeetix   zeetix   user_u:object_r:httpd_sys_content_t
> > <filename>
> >
> > I use Fedora core3/core4 linux, so YMMV.
> >
> > Thx,
> > Tom
> >
> > ----- Original Message -----
> > From: "Scott Bratcher" <scott@3floors.com>
> > To: "Eric Brunson" <brunson@brunson.com>
> > Cc: <mod_python@modpython.org>
> > Sent: Thursday, January 31, 2008 1:47 PM
> > Subject: Re: [mod_python] Apache Fails to load mod_python.so with
> > Permissiondenied error under SELinux
> >
> >
> >> Thanks Eric,
> >>
> >> "setenforce 0" THIS WORKED. Apache started right up
> >>
> >> Below are the results of my attempts as you suggested. I think we are
> >> onto the problem because with SELinux enforced it loads right up.
> >> However, the chcon command failed to clear up the problem. I'm new to
> >> SELinux. Is there another possible SELinux related permission
> >> that  may be
> >> the solution? It's just mod_python that is giving this problem  even
> >> though all of the others share the same t permission httpd_module.
> >>
> >> # ls -Zd modules
> >> drwxr-xr-x  root root system_u:object_r:httpd_modules_t modules/
> >>
> >> So I changed the permissions:
> >>
> >> # chcon -t texrel_shlib_t /etc/httpd/modules/mod_python.so
> >> # service httpd start
> >> Starting httpd: httpd: Syntax error on line 210 of /etc/httpd/conf/
> >> httpd.conf: Syntax error on line 6 of /etc/httpd/conf.d/python.conf:
> >> Cannot load /etc/httpd/modules/mod_python.so into server: /etc/httpd/
> >> modules/mod_python.so: cannot restore segment prot after reloc:
> >> Permission denied
> >>                                                            [FAILED]
> >> # ls -Z /etc/httpd/modules/mod_python.so
> >> -rwxr-xr-x  root root system_u:object_r:textrel_shlib_t /etc/httpd/
> >> modules/mod_python.so*
> >>
> >>
> >>
> >> I also tried changing the permissions of the 2.5 site-packages to the
> >> same permissions as the previously working 2.4 site-packages,
> >> plus  the
> >> other listed below, and the still Apache Failure occurs.
> >>
> >> # ls -Zd /usr/local/lib/python2.5/site-packages/ /usr/lib/python2.4/
> >> site-packages/
> >> drwxr-xr-x  root root system_u:object_r:lib_t           /usr/lib/
> >> python2.4/site-packages/
> >> drwxr-xr-x  root root user_u:object_r:lib_t             /usr/local/
> >> lib/python2.5/site-packages/
> >>
> >> system_u:object_r:lib_t
> >> system_u:object_r:textrel_shlib_t
> >> user_u:object_r:textrel_shlib_t
> >>
> >>
> >> If you have other tips I'd appreciate any help you can offer.
> >>
> >> Scott
> >>
> >>
> >>
> >> On Jan 31, 2008, at 10:13 AM, Eric Brunson wrote:
> >>
> >>> Scott Bratcher wrote:
> >>>> Hello all,
> >>>>
> >>>>
> >>>> THE PROBLEM:
> >>>>
> >>>> Starting Apache results in this error:
> >>>>
> >>>> # service httpd start
> >>>> Starting httpd: httpd: Syntax error on line 210 of /etc/httpd/conf/
> >>>> httpd.conf: Syntax error on line 6 of /etc/httpd/conf.d/
> >>>> python.conf:
> >>>> Cannot load /etc/httpd/modules/mod_python.so into  server:
> >>>> /etc/httpd/modules/mod_python.so: cannot restore segment  prot
> >>>> after
> >>>> reloc: Permission denied
> >>>>                                                            [FAILED]
> >>>>
> >>>
> >>> This error message is often related to selinux permissions.
> >>>
> >>> A quick check to see if that is the problem is to disable
> >>> selinux  with
> >>> the command (as root) "setenforce 0".  If the module then  loads
> >>> correctly, it can be fixed permanently with the command:
> >>>
> >>> chcon -t texrel_shlib_t /etc/httpd/modules/mod_python.so
> >>>
> >>> Then, re-enable selinux with "setenforce 1".
> >>>
> >>> If disabling selinux does not fix the problem, then more
> >>> investigation
> >>> is required.
> >>>
> >>> Hope that helps,
> >>> e.
> >>>
> >>>> USING:
> >>>>
> >>>> RHEL5 / SELinux
> >>>> Apache 2.2
> >>>> Python 2.5.1
> >>>> mod_pythonn 3.3.1
> >>>> httpd.conf (not .htaccess)
> >>>>
> >>>>
> >>>> TESTED THUS FAR:
> >>>>
> >>>> .so file exists with same permissions as other modules
> >>>> # ls -Z /etc/httpd/modules/mod_python.so
> >>>> -rwxr-xr-x  root root system_u:object_r:httpd_modules_t /etc/httpd/
> >>>> modules/mod_python.so*
> >>>>
> >>>> If I comment out:
> >>>> "#LoadModule python_module modules/mod_python.so"
> >>>> and other related python lines Apache starts just fine without
> >>>> mod_python.
> >>>> # service httpd start
> >>>> Starting httpd:                                            [  OK  ]
> >>>>
> >>>>
> >>>>
> >>>
> >>
> >> _______________________________________________
> >> Mod_python mailing list
> >> Mod_python@modpython.org
> >> http://mailman.modpython.org/mailman/listinfo/mod_python
> >>
> >
> >
> >
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From scott at 3floors.com  Thu Jan 31 23:07:27 2008
From: scott at 3floors.com (Scott Bratcher)
Date: Thu Jan 31 23:06:36 2008
Subject: [mod_python] Apache Fails to load mod_python.so with
	Permissiondenied error under SELinux
In-Reply-To: <88e286470801311651j4e2c129al2c4cb226c3ca51a0@mail.gmail.com>
References: <D984D547-3319-4444-9C24-C330FB3631A3@3floors.com>
	<47A1F394.4030506@brunson.com>
	<100F2336-310A-4970-B4BB-E27247DF66EE@3floors.com>
	<004f01c86441$6e292060$0200a8c0@TMSMAIN>
	<F593A28B-30EE-4BA9-898C-522D36C034D6@3floors.com>
	<88e286470801311651j4e2c129al2c4cb226c3ca51a0@mail.gmail.com>
Message-ID: <7B19A3C2-910E-4F06-B9EE-F4FEEEB2ED39@3floors.com>

Thank you for looking in, Graham,

DEPENDENCIES:
# ldd /etc/httpd/modules/mod_python.so
         linux-gate.so.1 =>  (0x00b16000)
         libpthread.so.0 => /lib/libpthread.so.0 (0x00f2d000)
         libdl.so.2 => /lib/libdl.so.2 (0x00aa7000)
         libutil.so.1 => /lib/libutil.so.1 (0x00110000)
         libm.so.6 => /lib/libm.so.6 (0x00114000)
         libc.so.6 => /lib/libc.so.6 (0x00453000)
         /lib/ld-linux.so.2 (0x0076d000)

SIZE:
# ls -fla /etc/httpd/modules/mod_python.so
-rwxr-xr-x 1 root root 4.1M Jan 31 01:51 /etc/httpd/modules/ 
mod_python.so*

I'm game to reinstall python, how do I check to see if there is a  
libpythonX.Y.so file linked to mod_python.so?

Scott



On Jan 31, 2008, at 6:51 PM, Graham Dumpleton wrote:

> How big is your:
>
>   /etc/httpd/modules/mod_python.so
>
> file? If you run ldd on it, what does it output as far as dependencies
> on shared libraries?
>
> One of the problems with some Python installations is that they still
> do not provide a shared library and so a static library gets embedded
> in mod_python.so. This results in some messy adress relocations having
> to be done when mod_python.so is loaded. I am wandering whether the
> 'reloc' mentioned in:
>
>   cannot restore segment prot after reloc
>
> is the module loading relocations and it is having a problem with  
> that.
>
> If there is no libpythonX.Y.so linked to mod_python.so, then reinstall
> Python using --enable-shared to configure, possibly fix up missing
> libpythonX.Y.so symlink in Python installed config directory and then
> rebuild mod_python, see if that makes a difference.
>
> Probably nothing to do with this, but if nothing else works. :-)
>
> Graham
>
> On 01/02/2008, Scott Bratcher <scott@3floors.com> wrote:
>> Thanks Eric and Tom,
>>
>> Unresolved however. I did some permissions tests based on your  
>> feedback.
>>
>>
>> I'm chasing this issue as though it is a permissions issue and have
>> identified SELinux as the hold-up. I've tried all of these permission
>> sets on the modules actual folder and the modules symlinked folder.
>> I did both directories just in case the permissions trickle down to
>> the actual files being loaded by mod_python itself:
>>
>> # chcon -R -h -u system_u -r object_r -t httpd_sys_content_t /usr/ 
>> lib/
>> httpd/modules /etc/httpd/modules
>> # chcon -R -h -u user_u -r object_r -t httpd_sys_content_t /usr/lib/
>> httpd/modules /etc/httpd/modules
>> # chcon -R -h -u user_u -r object_r -t httpd_modules_t /usr/lib/ 
>> httpd/
>> modules /etc/httpd/modules
>> # chcon -R -h -u system_u -r object_r -t httpd_modules_t /usr/lib/
>> httpd/modules /etc/httpd/modules ((( This one is the original
>> permission of all apache modules)))
>> # chcon -R -h -u system_u -r object_r -t lib_t /usr/lib/httpd/
>> modules /etc/httpd/modules
>> # chcon -R -h -u system_u -r object_r -t shlib_t /usr/lib/httpd/
>> modules /etc/httpd/modules
>> # chcon -R -h -u system_u -r object_r -t textrel_shlib_t /usr/lib/
>> httpd/modules /etc/httpd/modules
>>
>> All gave this error:
>> ----------
>> # service httpd start
>> Starting httpd: httpd: Syntax error on line 210 of /etc/httpd/conf/
>> httpd.conf: Syntax error on line 6 of /etc/httpd/conf.d/python.conf:
>> Cannot load /etc/httpd/modules/mod_python.so into server: /etc/httpd/
>> modules/mod_python.so: cannot restore segment prot after reloc:
>> Permission denied
>>                                                             [FAILED]
>> ----------
>>
>> ---> This is the only one that gave me a different error.
>> ----------
>> # chcon -R -h -u system_u -t textrel_shlib_t /usr/lib/httpd/modules /
>> etc/httpd/modules
>> # service httpd start
>> Starting httpd: httpd: Syntax error on line 148 of /etc/httpd/conf/
>> httpd.conf: Cannot load /etc/httpd/modules/mod_auth_basic.so into
>> server: /etc/httpd/modules/mod_auth_basic.so: cannot open shared
>> object file: Permission denied
>>                                                             [FAILED]
>> ----------
>>
>>
>> ****AGAIN I MUST NOTE: All is solved by turning off SELinux and/or
>> All is solved by not loading mod_python. All other modules loaded
>> just fine with their original permissions which matched mod_python
>> exactly.
>>
>>
>>
>>
>> Scott
>>
>>
>>
>> On Jan 31, 2008, at 1:42 PM, Tom Stambaugh wrote:
>>
>>> The incantation that I use (for solving different problems, though)
>>> is:
>>>
>>> chcon -R -h -t httpd_sys_content_t <filename>
>>>
>>> I think the "-R" makes it recurse to all children, and I think the
>>> "httpd_sys_content_t" is more permissive (though that could be
>>> mistaken).
>>> The -h causes it to apply to sym links.
>>>
>>> Afterwords, I get:
>>>
>>> #ls -lZ adminuser
>>> -rw-rw-r--  zeetix   zeetix   user_u:object_r:httpd_sys_content_t
>>> <filename>
>>>
>>> I use Fedora core3/core4 linux, so YMMV.
>>>
>>> Thx,
>>> Tom
>>>
>>> ----- Original Message -----
>>> From: "Scott Bratcher" <scott@3floors.com>
>>> To: "Eric Brunson" <brunson@brunson.com>
>>> Cc: <mod_python@modpython.org>
>>> Sent: Thursday, January 31, 2008 1:47 PM
>>> Subject: Re: [mod_python] Apache Fails to load mod_python.so with
>>> Permissiondenied error under SELinux
>>>
>>>
>>>> Thanks Eric,
>>>>
>>>> "setenforce 0" THIS WORKED. Apache started right up
>>>>
>>>> Below are the results of my attempts as you suggested. I think  
>>>> we are
>>>> onto the problem because with SELinux enforced it loads right up.
>>>> However, the chcon command failed to clear up the problem. I'm  
>>>> new to
>>>> SELinux. Is there another possible SELinux related permission
>>>> that  may be
>>>> the solution? It's just mod_python that is giving this problem   
>>>> even
>>>> though all of the others share the same t permission httpd_module.
>>>>
>>>> # ls -Zd modules
>>>> drwxr-xr-x  root root system_u:object_r:httpd_modules_t modules/
>>>>
>>>> So I changed the permissions:
>>>>
>>>> # chcon -t texrel_shlib_t /etc/httpd/modules/mod_python.so
>>>> # service httpd start
>>>> Starting httpd: httpd: Syntax error on line 210 of /etc/httpd/conf/
>>>> httpd.conf: Syntax error on line 6 of /etc/httpd/conf.d/ 
>>>> python.conf:
>>>> Cannot load /etc/httpd/modules/mod_python.so into server: /etc/ 
>>>> httpd/
>>>> modules/mod_python.so: cannot restore segment prot after reloc:
>>>> Permission denied
>>>>                                                            [FAILED]
>>>> # ls -Z /etc/httpd/modules/mod_python.so
>>>> -rwxr-xr-x  root root system_u:object_r:textrel_shlib_t /etc/httpd/
>>>> modules/mod_python.so*
>>>>
>>>>
>>>>
>>>> I also tried changing the permissions of the 2.5 site-packages  
>>>> to the
>>>> same permissions as the previously working 2.4 site-packages,
>>>> plus  the
>>>> other listed below, and the still Apache Failure occurs.
>>>>
>>>> # ls -Zd /usr/local/lib/python2.5/site-packages/ /usr/lib/ 
>>>> python2.4/
>>>> site-packages/
>>>> drwxr-xr-x  root root system_u:object_r:lib_t           /usr/lib/
>>>> python2.4/site-packages/
>>>> drwxr-xr-x  root root user_u:object_r:lib_t             /usr/local/
>>>> lib/python2.5/site-packages/
>>>>
>>>> system_u:object_r:lib_t
>>>> system_u:object_r:textrel_shlib_t
>>>> user_u:object_r:textrel_shlib_t
>>>>
>>>>
>>>> If you have other tips I'd appreciate any help you can offer.
>>>>
>>>> Scott
>>>>
>>>>
>>>>
>>>> On Jan 31, 2008, at 10:13 AM, Eric Brunson wrote:
>>>>
>>>>> Scott Bratcher wrote:
>>>>>> Hello all,
>>>>>>
>>>>>>
>>>>>> THE PROBLEM:
>>>>>>
>>>>>> Starting Apache results in this error:
>>>>>>
>>>>>> # service httpd start
>>>>>> Starting httpd: httpd: Syntax error on line 210 of /etc/httpd/ 
>>>>>> conf/
>>>>>> httpd.conf: Syntax error on line 6 of /etc/httpd/conf.d/
>>>>>> python.conf:
>>>>>> Cannot load /etc/httpd/modules/mod_python.so into  server:
>>>>>> /etc/httpd/modules/mod_python.so: cannot restore segment  prot
>>>>>> after
>>>>>> reloc: Permission denied
>>>>>>                                                             
>>>>>> [FAILED]
>>>>>>
>>>>>
>>>>> This error message is often related to selinux permissions.
>>>>>
>>>>> A quick check to see if that is the problem is to disable
>>>>> selinux  with
>>>>> the command (as root) "setenforce 0".  If the module then  loads
>>>>> correctly, it can be fixed permanently with the command:
>>>>>
>>>>> chcon -t texrel_shlib_t /etc/httpd/modules/mod_python.so
>>>>>
>>>>> Then, re-enable selinux with "setenforce 1".
>>>>>
>>>>> If disabling selinux does not fix the problem, then more
>>>>> investigation
>>>>> is required.
>>>>>
>>>>> Hope that helps,
>>>>> e.
>>>>>
>>>>>> USING:
>>>>>>
>>>>>> RHEL5 / SELinux
>>>>>> Apache 2.2
>>>>>> Python 2.5.1
>>>>>> mod_pythonn 3.3.1
>>>>>> httpd.conf (not .htaccess)
>>>>>>
>>>>>>
>>>>>> TESTED THUS FAR:
>>>>>>
>>>>>> .so file exists with same permissions as other modules
>>>>>> # ls -Z /etc/httpd/modules/mod_python.so
>>>>>> -rwxr-xr-x  root root system_u:object_r:httpd_modules_t /etc/ 
>>>>>> httpd/
>>>>>> modules/mod_python.so*
>>>>>>
>>>>>> If I comment out:
>>>>>> "#LoadModule python_module modules/mod_python.so"
>>>>>> and other related python lines Apache starts just fine without
>>>>>> mod_python.
>>>>>> # service httpd start
>>>>>> Starting httpd:                                             
>>>>>> [  OK  ]
>>>>>>
>>>>>>
>>>>>>
>>>>>
>>>>
>>>> _______________________________________________
>>>> Mod_python mailing list
>>>> Mod_python@modpython.org
>>>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>>>
>>>
>>>
>>>
>>
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>

From graham.dumpleton at gmail.com  Thu Jan 31 23:10:43 2008
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu Jan 31 23:10:49 2008
Subject: [mod_python] Apache Fails to load mod_python.so with
	Permissiondenied error under SELinux
In-Reply-To: <7B19A3C2-910E-4F06-B9EE-F4FEEEB2ED39@3floors.com>
References: <D984D547-3319-4444-9C24-C330FB3631A3@3floors.com>
	<47A1F394.4030506@brunson.com>
	<100F2336-310A-4970-B4BB-E27247DF66EE@3floors.com>
	<004f01c86441$6e292060$0200a8c0@TMSMAIN>
	<F593A28B-30EE-4BA9-898C-522D36C034D6@3floors.com>
	<88e286470801311651j4e2c129al2c4cb226c3ca51a0@mail.gmail.com>
	<7B19A3C2-910E-4F06-B9EE-F4FEEEB2ED39@3floors.com>
Message-ID: <88e286470801312010x170d346bn891ea7dd80a3abe4@mail.gmail.com>

On 01/02/2008, Scott Bratcher <scott@3floors.com> wrote:
> Thank you for looking in, Graham,
>
> DEPENDENCIES:
> # ldd /etc/httpd/modules/mod_python.so
>          linux-gate.so.1 =>  (0x00b16000)
>          libpthread.so.0 => /lib/libpthread.so.0 (0x00f2d000)
>          libdl.so.2 => /lib/libdl.so.2 (0x00aa7000)
>          libutil.so.1 => /lib/libutil.so.1 (0x00110000)
>          libm.so.6 => /lib/libm.so.6 (0x00114000)
>          libc.so.6 => /lib/libc.so.6 (0x00453000)
>          /lib/ld-linux.so.2 (0x0076d000)
>
> SIZE:
> # ls -fla /etc/httpd/modules/mod_python.so
> -rwxr-xr-x 1 root root 4.1M Jan 31 01:51 /etc/httpd/modules/
> mod_python.so*
>
> I'm game to reinstall python, how do I check to see if there is a
> libpythonX.Y.so file linked to mod_python.so?

It should appear in that list above.

Check out notes in:

  http://code.google.com/p/modwsgi/wiki/InstallationIssues

This is for mod_wsgi, but it has the same issue with the Python library.

Graham

> On Jan 31, 2008, at 6:51 PM, Graham Dumpleton wrote:
>
> > How big is your:
> >
> >   /etc/httpd/modules/mod_python.so
> >
> > file? If you run ldd on it, what does it output as far as dependencies
> > on shared libraries?
> >
> > One of the problems with some Python installations is that they still
> > do not provide a shared library and so a static library gets embedded
> > in mod_python.so. This results in some messy adress relocations having
> > to be done when mod_python.so is loaded. I am wandering whether the
> > 'reloc' mentioned in:
> >
> >   cannot restore segment prot after reloc
> >
> > is the module loading relocations and it is having a problem with
> > that.
> >
> > If there is no libpythonX.Y.so linked to mod_python.so, then reinstall
> > Python using --enable-shared to configure, possibly fix up missing
> > libpythonX.Y.so symlink in Python installed config directory and then
> > rebuild mod_python, see if that makes a difference.
> >
> > Probably nothing to do with this, but if nothing else works. :-)
> >
> > Graham
> >
> > On 01/02/2008, Scott Bratcher <scott@3floors.com> wrote:
> >> Thanks Eric and Tom,
> >>
> >> Unresolved however. I did some permissions tests based on your
> >> feedback.
> >>
> >>
> >> I'm chasing this issue as though it is a permissions issue and have
> >> identified SELinux as the hold-up. I've tried all of these permission
> >> sets on the modules actual folder and the modules symlinked folder.
> >> I did both directories just in case the permissions trickle down to
> >> the actual files being loaded by mod_python itself:
> >>
> >> # chcon -R -h -u system_u -r object_r -t httpd_sys_content_t /usr/
> >> lib/
> >> httpd/modules /etc/httpd/modules
> >> # chcon -R -h -u user_u -r object_r -t httpd_sys_content_t /usr/lib/
> >> httpd/modules /etc/httpd/modules
> >> # chcon -R -h -u user_u -r object_r -t httpd_modules_t /usr/lib/
> >> httpd/
> >> modules /etc/httpd/modules
> >> # chcon -R -h -u system_u -r object_r -t httpd_modules_t /usr/lib/
> >> httpd/modules /etc/httpd/modules ((( This one is the original
> >> permission of all apache modules)))
> >> # chcon -R -h -u system_u -r object_r -t lib_t /usr/lib/httpd/
> >> modules /etc/httpd/modules
> >> # chcon -R -h -u system_u -r object_r -t shlib_t /usr/lib/httpd/
> >> modules /etc/httpd/modules
> >> # chcon -R -h -u system_u -r object_r -t textrel_shlib_t /usr/lib/
> >> httpd/modules /etc/httpd/modules
> >>
> >> All gave this error:
> >> ----------
> >> # service httpd start
> >> Starting httpd: httpd: Syntax error on line 210 of /etc/httpd/conf/
> >> httpd.conf: Syntax error on line 6 of /etc/httpd/conf.d/python.conf:
> >> Cannot load /etc/httpd/modules/mod_python.so into server: /etc/httpd/
> >> modules/mod_python.so: cannot restore segment prot after reloc:
> >> Permission denied
> >>                                                             [FAILED]
> >> ----------
> >>
> >> ---> This is the only one that gave me a different error.
> >> ----------
> >> # chcon -R -h -u system_u -t textrel_shlib_t /usr/lib/httpd/modules /
> >> etc/httpd/modules
> >> # service httpd start
> >> Starting httpd: httpd: Syntax error on line 148 of /etc/httpd/conf/
> >> httpd.conf: Cannot load /etc/httpd/modules/mod_auth_basic.so into
> >> server: /etc/httpd/modules/mod_auth_basic.so: cannot open shared
> >> object file: Permission denied
> >>                                                             [FAILED]
> >> ----------
> >>
> >>
> >> ****AGAIN I MUST NOTE: All is solved by turning off SELinux and/or
> >> All is solved by not loading mod_python. All other modules loaded
> >> just fine with their original permissions which matched mod_python
> >> exactly.
> >>
> >>
> >>
> >>
> >> Scott
> >>
> >>
> >>
> >> On Jan 31, 2008, at 1:42 PM, Tom Stambaugh wrote:
> >>
> >>> The incantation that I use (for solving different problems, though)
> >>> is:
> >>>
> >>> chcon -R -h -t httpd_sys_content_t <filename>
> >>>
> >>> I think the "-R" makes it recurse to all children, and I think the
> >>> "httpd_sys_content_t" is more permissive (though that could be
> >>> mistaken).
> >>> The -h causes it to apply to sym links.
> >>>
> >>> Afterwords, I get:
> >>>
> >>> #ls -lZ adminuser
> >>> -rw-rw-r--  zeetix   zeetix   user_u:object_r:httpd_sys_content_t
> >>> <filename>
> >>>
> >>> I use Fedora core3/core4 linux, so YMMV.
> >>>
> >>> Thx,
> >>> Tom
> >>>
> >>> ----- Original Message -----
> >>> From: "Scott Bratcher" <scott@3floors.com>
> >>> To: "Eric Brunson" <brunson@brunson.com>
> >>> Cc: <mod_python@modpython.org>
> >>> Sent: Thursday, January 31, 2008 1:47 PM
> >>> Subject: Re: [mod_python] Apache Fails to load mod_python.so with
> >>> Permissiondenied error under SELinux
> >>>
> >>>
> >>>> Thanks Eric,
> >>>>
> >>>> "setenforce 0" THIS WORKED. Apache started right up
> >>>>
> >>>> Below are the results of my attempts as you suggested. I think
> >>>> we are
> >>>> onto the problem because with SELinux enforced it loads right up.
> >>>> However, the chcon command failed to clear up the problem. I'm
> >>>> new to
> >>>> SELinux. Is there another possible SELinux related permission
> >>>> that  may be
> >>>> the solution? It's just mod_python that is giving this problem
> >>>> even
> >>>> though all of the others share the same t permission httpd_module.
> >>>>
> >>>> # ls -Zd modules
> >>>> drwxr-xr-x  root root system_u:object_r:httpd_modules_t modules/
> >>>>
> >>>> So I changed the permissions:
> >>>>
> >>>> # chcon -t texrel_shlib_t /etc/httpd/modules/mod_python.so
> >>>> # service httpd start
> >>>> Starting httpd: httpd: Syntax error on line 210 of /etc/httpd/conf/
> >>>> httpd.conf: Syntax error on line 6 of /etc/httpd/conf.d/
> >>>> python.conf:
> >>>> Cannot load /etc/httpd/modules/mod_python.so into server: /etc/
> >>>> httpd/
> >>>> modules/mod_python.so: cannot restore segment prot after reloc:
> >>>> Permission denied
> >>>>                                                            [FAILED]
> >>>> # ls -Z /etc/httpd/modules/mod_python.so
> >>>> -rwxr-xr-x  root root system_u:object_r:textrel_shlib_t /etc/httpd/
> >>>> modules/mod_python.so*
> >>>>
> >>>>
> >>>>
> >>>> I also tried changing the permissions of the 2.5 site-packages
> >>>> to the
> >>>> same permissions as the previously working 2.4 site-packages,
> >>>> plus  the
> >>>> other listed below, and the still Apache Failure occurs.
> >>>>
> >>>> # ls -Zd /usr/local/lib/python2.5/site-packages/ /usr/lib/
> >>>> python2.4/
> >>>> site-packages/
> >>>> drwxr-xr-x  root root system_u:object_r:lib_t           /usr/lib/
> >>>> python2.4/site-packages/
> >>>> drwxr-xr-x  root root user_u:object_r:lib_t             /usr/local/
> >>>> lib/python2.5/site-packages/
> >>>>
> >>>> system_u:object_r:lib_t
> >>>> system_u:object_r:textrel_shlib_t
> >>>> user_u:object_r:textrel_shlib_t
> >>>>
> >>>>
> >>>> If you have other tips I'd appreciate any help you can offer.
> >>>>
> >>>> Scott
> >>>>
> >>>>
> >>>>
> >>>> On Jan 31, 2008, at 10:13 AM, Eric Brunson wrote:
> >>>>
> >>>>> Scott Bratcher wrote:
> >>>>>> Hello all,
> >>>>>>
> >>>>>>
> >>>>>> THE PROBLEM:
> >>>>>>
> >>>>>> Starting Apache results in this error:
> >>>>>>
> >>>>>> # service httpd start
> >>>>>> Starting httpd: httpd: Syntax error on line 210 of /etc/httpd/
> >>>>>> conf/
> >>>>>> httpd.conf: Syntax error on line 6 of /etc/httpd/conf.d/
> >>>>>> python.conf:
> >>>>>> Cannot load /etc/httpd/modules/mod_python.so into  server:
> >>>>>> /etc/httpd/modules/mod_python.so: cannot restore segment  prot
> >>>>>> after
> >>>>>> reloc: Permission denied
> >>>>>>
> >>>>>> [FAILED]
> >>>>>>
> >>>>>
> >>>>> This error message is often related to selinux permissions.
> >>>>>
> >>>>> A quick check to see if that is the problem is to disable
> >>>>> selinux  with
> >>>>> the command (as root) "setenforce 0".  If the module then  loads
> >>>>> correctly, it can be fixed permanently with the command:
> >>>>>
> >>>>> chcon -t texrel_shlib_t /etc/httpd/modules/mod_python.so
> >>>>>
> >>>>> Then, re-enable selinux with "setenforce 1".
> >>>>>
> >>>>> If disabling selinux does not fix the problem, then more
> >>>>> investigation
> >>>>> is required.
> >>>>>
> >>>>> Hope that helps,
> >>>>> e.
> >>>>>
> >>>>>> USING:
> >>>>>>
> >>>>>> RHEL5 / SELinux
> >>>>>> Apache 2.2
> >>>>>> Python 2.5.1
> >>>>>> mod_pythonn 3.3.1
> >>>>>> httpd.conf (not .htaccess)
> >>>>>>
> >>>>>>
> >>>>>> TESTED THUS FAR:
> >>>>>>
> >>>>>> .so file exists with same permissions as other modules
> >>>>>> # ls -Z /etc/httpd/modules/mod_python.so
> >>>>>> -rwxr-xr-x  root root system_u:object_r:httpd_modules_t /etc/
> >>>>>> httpd/
> >>>>>> modules/mod_python.so*
> >>>>>>
> >>>>>> If I comment out:
> >>>>>> "#LoadModule python_module modules/mod_python.so"
> >>>>>> and other related python lines Apache starts just fine without
> >>>>>> mod_python.
> >>>>>> # service httpd start
> >>>>>> Starting httpd:
> >>>>>> [  OK  ]
> >>>>>>
> >>>>>>
> >>>>>>
> >>>>>
> >>>>
> >>>> _______________________________________________
> >>>> Mod_python mailing list
> >>>> Mod_python@modpython.org
> >>>> http://mailman.modpython.org/mailman/listinfo/mod_python
> >>>>
> >>>
> >>>
> >>>
> >>
> >> _______________________________________________
> >> Mod_python mailing list
> >> Mod_python@modpython.org
> >> http://mailman.modpython.org/mailman/listinfo/mod_python
> >>
>
>
