<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Re: [4suite] 4Suite Reliance on ENVIRONMENT &amp; global variables
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Re%3A%20%5B4suite%5D%204Suite%20Reliance%20on%20ENVIRONMENT%20%26%20global%20variables&In-Reply-To=1043129964.1419.305.camel%40refugeeMedia">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009691.html">
   <LINK REL="Next"  HREF="009688.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
<table border=0 width="100%"><tr><td valign="top">
   <H1>[mod_python] Re: [4suite] 4Suite Reliance on ENVIRONMENT &amp; global variables</H1>
    <B>Mongryong</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Re%3A%20%5B4suite%5D%204Suite%20Reliance%20on%20ENVIRONMENT%20%26%20global%20variables&In-Reply-To=1043129964.1419.305.camel%40refugeeMedia"
       TITLE="[mod_python] Re: [4suite] 4Suite Reliance on ENVIRONMENT &amp; global variables">Mongryong at sympatico.ca
       </A><BR>
    <I>Tue Jan 21 20:48:59 EST 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="009691.html">[mod_python] calla function from form and via link
</A></li>
        <LI>Next message: <A HREF="009688.html">[mod_python] [error] make_obcallback: could not import mod_python.apache
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9687">[ date ]</a>
              <a href="thread.html#9687">[ thread ]</a>
              <a href="subject.html#9687">[ subject ]</a>
              <a href="author.html#9687">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Ok, here's an update.  I've tested things out with a variety of
environment scenarios:

Computer - RedHat 8, PIII, 256mb, &gt; 60Gb

Scenario#1 - Works fine
Apache httpd Server 1.3.27
Python 2.2.2
mod_python 2.7.8
4Suite 0.11.1
PyXML 0.6.6

Scenario#2 - Works fine
Apache httpd Server 2.0.44
Python 2.2.2
mod_python 3.0.2 (CVS)
4Suite 0.11.1
PyXML 0.6.6

Scenario#3 - Fails (encoding problem??)
Apache httpd Server 1.3.27
Python 2.2.2
mod_python 2.7.8
4Suite 0.12a CVS latest
PyXML 0.8.x

Scenario#4 - Fails (encoding problem??)
Apache httpd Server 2.0.44
Python 2.2.2
mod_python 3.0.2 (CVS)
4Suite 0.12a CVS latest
PyXML 0.8.x

Scenario#5 - Fails (encoding problem??)
Apache httpd Server 2.1.0 CVS latest
Python 2.2.2
mod_python 3.0.2 CVS latest
4Suite 0.12a CVS latest
PyXML 0.8.x

Scenario#5 - Fails (encoding problem??)
Apache httpd Server 2.1.0 CVS latest
Python 2.3a CVS latest
mod_python 3.0.2 (CVS)
4Suite 0.12a CVS latest
PyXML 0.8.x

Summary of combinations that produced no 'encoding' problem:
Apache 1.3.27 to 2.1 CVS latest
mod_python 3.0.2 CVS latest
Python 2.2.2  
4Suite 0.11.1 
PyXML 0.6.6

To me, the encoding problem appears to have something to do with 4Suite
0.12.x or PyXML 0.8.x or a combination of the two.  

It would be nice to be able to test if the encoding problem appears in
another 'embedded python' app or module.  This would help strengthen the
case against 4Suite/PyXml.  My guess is that the encoding problem is not
unique to mod_python.

On Tue, 2003-01-21 at 01:19, Mongryong wrote:
&gt;<i> Ok, I've modified my simple test script so that it can be easily started
</I>&gt;<i> from a shell (python main.py) as well as working with mod_python.
</I>&gt;<i> 
</I>&gt;<i> Again, here's the url to my server where you can view the mod_python
</I>&gt;<i> result: <A HREF="http://rezquest.cjb.net/bin/main">http://rezquest.cjb.net/bin/main</A>
</I>&gt;<i> 
</I>&gt;<i> So, now the test outputs the XML source as just a string and as dom node
</I>&gt;<i> from NonvalidatingReader.
</I>&gt;<i> 
</I>&gt;<i> You should clearly see the difference between the standalone and
</I>&gt;<i> mod_python results.
</I>&gt;<i> 
</I>&gt;<i> On Tue, 2003-01-21 at 00:23, Michael Olson wrote:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; &gt; The strange thing is that if I directly output the XML source without
</I>&gt;<i> &gt; &gt; doing any XSLT processing, the XML source appears correctly.  Somewhere
</I>&gt;<i> &gt; &gt; along the line where the strings are being passed from the python
</I>&gt;<i> &gt; &gt; libraries to the 4Suite libraries (by Py_ParseArgs..???), the strings
</I>&gt;<i> &gt; &gt; are being 'miscommunicated'.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; By &quot;output the XML source&quot; do you mean just print it out (or fetch it 
</I>&gt;<i> &gt; from the file system) ro do you mean parse it into DOM, and print it 
</I>&gt;<i> &gt; out?
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; If not the later, can you try that instead of XSLT to see if this works.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Thanks
</I>&gt;<i> &gt; Mike
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; &gt; Now, it might be a Python2.2.2 issue since libxml2/libxslt from the
</I>&gt;<i> &gt; &gt; gnome project are having similar problems as well.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; In 4Suite, do the apps embedd the python interpretor or do the apps
</I>&gt;<i> &gt; &gt; start purely from a python environment?
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; It might be good to check to see whether this problem still occurs 
</I>&gt;<i> &gt; &gt; other
</I>&gt;<i> &gt; &gt; 'python embedded' application (ie. uses Py_NewInterpretor from C). I
</I>&gt;<i> &gt; &gt; forget, does the command-line version of python dynamically link to the
</I>&gt;<i> &gt; &gt; python libraries?  If so, I wonder if the command-line version of 
</I>&gt;<i> &gt; &gt; python
</I>&gt;<i> &gt; &gt; is doing anything special or different when it links up and initializes
</I>&gt;<i> &gt; &gt; the python libraries.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; I'm reposting this message on to the Python mailing list to see if
</I>&gt;<i> &gt; &gt; anybody there can help give us a clue.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; P.S Has there been any changes in Python2.2.3+ that might possibly fix
</I>&gt;<i> &gt; &gt; this problem?
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; On Mon, 2003-01-20 at 22:28, Uche Ogbuji wrote:
</I>&gt;<i> &gt; &gt;&gt; On Mon, 2003-01-20 at 14:52, Mongryong wrote:
</I>&gt;<i> &gt; &gt;&gt;&gt; Hi,
</I>&gt;<i> &gt; &gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt; I'm having trouble getting the latest 4Suite XML/XSLT tools to work 
</I>&gt;<i> &gt; &gt;&gt;&gt; the
</I>&gt;<i> &gt; &gt;&gt;&gt; way I want in mod_python and I know I'm not the first one to 
</I>&gt;<i> &gt; &gt;&gt;&gt; experience
</I>&gt;<i> &gt; &gt;&gt;&gt; &quot;out-of-the-box&quot; success.
</I>&gt;<i> &gt; &gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt; I've determined that it's an encoding issue.   Now, with a 
</I>&gt;<i> &gt; &gt;&gt;&gt; stand-alone
</I>&gt;<i> &gt; &gt;&gt;&gt; script or CGI script under Apache, 4XSLT works fine.  But under
</I>&gt;<i> &gt; &gt;&gt;&gt; mod_python (which doesn't have access to ENVIRONMENT variables), 
</I>&gt;<i> &gt; &gt;&gt;&gt; 4XSLT
</I>&gt;<i> &gt; &gt;&gt;&gt; library decodes the XML source file in a total different encoding.  
</I>&gt;<i> &gt; &gt;&gt;&gt; XSL
</I>&gt;<i> &gt; &gt;&gt;&gt; templates (ie. &lt;xsl:template name=&quot;blah&quot;&gt;) are never executed because
</I>&gt;<i> &gt; &gt;&gt;&gt; the XML tag is never recognized by the XSL processor.  Hence, you 
</I>&gt;<i> &gt; &gt;&gt;&gt; get an
</I>&gt;<i> &gt; &gt;&gt;&gt; empty output.
</I>&gt;<i> &gt; &gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt; I've check the default system encoding codec and it returns 'ascii' 
</I>&gt;<i> &gt; &gt;&gt;&gt; (ie.
</I>&gt;<i> &gt; &gt;&gt;&gt; sys.getdefaultencoding).  Now, it could be that the python library
</I>&gt;<i> &gt; &gt;&gt;&gt; relies on some ENVIRONMENT variable for its configuration.
</I>&gt;<i> &gt; &gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt; Anybody have any ideas what 'parameters' might not be initialized
</I>&gt;<i> &gt; &gt;&gt;&gt; properly under a non-CGI or non-shell environment such as mod_python?
</I>&gt;<i> &gt; &gt;&gt;&gt; Or, is there a parameter that one can set to change the XML input
</I>&gt;<i> &gt; &gt;&gt;&gt; decoding?
</I>&gt;<i> &gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt; I don't think there is any environment variable that could affect 
</I>&gt;<i> &gt; &gt;&gt; this.
</I>&gt;<i> &gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt; However, there have been a lot of fixes recently, including to some
</I>&gt;<i> &gt; &gt;&gt; endianness bugs.  Do you mind trying again with latest 4Suite CVS and
</I>&gt;<i> &gt; &gt;&gt; telling us if it helps?  Either wait till tomorrow's snapshot, or 
</I>&gt;<i> &gt; &gt;&gt; check
</I>&gt;<i> &gt; &gt;&gt; out current CVS HEAD directly
</I>&gt;<i> &gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt; <A HREF="http://4suite.org/docs/4SuiteCVS.xml">http://4suite.org/docs/4SuiteCVS.xml</A>
</I>&gt;<i> &gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt; If it doesn't help, I hope you'll be able to help us work with you to
</I>&gt;<i> &gt; &gt;&gt; find a solution for mod_python users.
</I>&gt;<i> &gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt; -- 
</I>&gt;<i> &gt; &gt;&gt; Uche Ogbuji                                    Fourthought, Inc.
</I>&gt;<i> &gt; &gt;&gt; <A HREF="http://uche.ogbuji.net">http://uche.ogbuji.net</A>    <A HREF="http://4Suite.org">http://4Suite.org</A>    <A HREF="http://fourthought.com">http://fourthought.com</A>
</I>&gt;<i> &gt; &gt;&gt; Python Generators + DOM - 
</I>&gt;<i> &gt; &gt;&gt; <A HREF="http://www.xml.com/pub/a/2003/01/08/py-xml.html">http://www.xml.com/pub/a/2003/01/08/py-xml.html</A>
</I>&gt;<i> &gt; &gt;&gt; 4Suite Repository Features - 
</I>&gt;<i> &gt; &gt;&gt; <A HREF="https://www6.software.ibm.com/reg/devworks/dw-x4suite5-i/">https://www6.software.ibm.com/reg/devworks/dw-x4suite5-i/</A>
</I>&gt;<i> &gt; &gt;&gt; XML class warfare - <A HREF="http://www.adtmag.com/article.asp?id=6965">http://www.adtmag.com/article.asp?id=6965</A>
</I>&gt;<i> &gt; &gt;&gt; MusicBrainz  metadata - 
</I>&gt;<i> &gt; &gt;&gt; <A HREF="http://www-106.ibm.com/developerworks/xml/library/x-think14.html">http://www-106.ibm.com/developerworks/xml/library/x-think14.html</A>
</I>&gt;<i> &gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; &lt;main.py&gt;
</I>&gt;<i> &gt; Mike Olson                                Principal Consultant
</I>&gt;<i> &gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mike.olson at fourthought.com</A>                +1 303 583 9900 x 102
</I>&gt;<i> &gt; Fourthought, Inc.                         <A HREF="http://Fourthought.com">http://Fourthought.com</A>
</I>&gt;<i> &gt; PO Box 270590,                            <A HREF="http://4Suite.org">http://4Suite.org</A>
</I>&gt;<i> &gt; Louisville, CO 80027-5009, USA
</I>&gt;<i> &gt; XML strategy, XML tools, knowledge management
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; 4suite mailing list
</I>&gt;<i> &gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">4suite at lists.fourthought.com</A>
</I>&gt;<i> &gt; <A HREF="http://lists.fourthought.com/mailman/listinfo/4suite">http://lists.fourthought.com/mailman/listinfo/4suite</A>
</I>&gt;<i> 
</I>&gt;<i> ----
</I>&gt;<i> 
</I>
&gt;<i> #!/usr/local/bin/python
</I>&gt;<i> 
</I>&gt;<i> import sys
</I>&gt;<i> import locale
</I>&gt;<i> 
</I>&gt;<i> #The identity transform: duplicates the input to output
</I>&gt;<i> TRANSFORM = &quot;&quot;&quot;&lt;xsl:stylesheet xmlns:xsl=&quot;<A HREF="http://www.w3.org/1999/XSL/Transform&quot;">http://www.w3.org/1999/XSL/Transform&quot;</A> version=&quot;1.0&quot;&gt;
</I>&gt;<i> &lt;xsl:template match=&quot;@*|node()&quot;&gt;
</I>&gt;<i>   &lt;xsl:copy&gt;
</I>&gt;<i>     &lt;xsl:apply-templates select=&quot;@*|node()&quot;/&gt;
</I>&gt;<i>   &lt;/xsl:copy&gt;
</I>&gt;<i> &lt;/xsl:template&gt;
</I>&gt;<i> 
</I>&gt;<i> &lt;/xsl:stylesheet&gt;
</I>&gt;<i> &quot;&quot;&quot;
</I>&gt;<i> 
</I>&gt;<i> SOURCE = &quot;&quot;&quot;&lt;spam id=&quot;eggs&quot;&gt;I don't like spam&lt;/spam&gt;&quot;&quot;&quot;
</I>&gt;<i> 
</I>&gt;<i> #The processor class is the core of the XSLT API
</I>&gt;<i> import Ft
</I>&gt;<i> from Ft.Xml.Xslt import Processor
</I>&gt;<i> from Ft.Xml import InputSource
</I>&gt;<i> 
</I>&gt;<i> from xml.dom import Node
</I>&gt;<i> from Ft.Xml.Domlette import Print, PrettyPrint
</I>&gt;<i> from Ft.Xml.Domlette import NonvalidatingReader
</I>&gt;<i> 
</I>&gt;<i> #from mod_python import apache
</I>&gt;<i> 
</I>&gt;<i> from StringIO import StringIO
</I>&gt;<i> 
</I>&gt;<i> def test(req):
</I>&gt;<i>     # TEST 1
</I>&gt;<i>     req.write ( &quot;Here's the result of just printing the string SOURCE\n&quot; )
</I>&gt;<i>     req.write ( SOURCE )
</I>&gt;<i>     req.write ( &quot;\n\n&quot; )
</I>&gt;<i> 
</I>&gt;<i>     # TEST 2
</I>&gt;<i>     buf = StringIO()
</I>&gt;<i>     transform = InputSource.DefaultFactory.fromString(TRANSFORM, &quot;<A HREF="http://spam.com/identity.xslt&quot;">http://spam.com/identity.xslt&quot;</A>)
</I>&gt;<i>     source = InputSource.DefaultFactory.fromString(SOURCE, &quot;<A HREF="http://spam.com/doc.xml&quot;">http://spam.com/doc.xml&quot;</A>)
</I>&gt;<i>     dom = NonvalidatingReader.parse ( source )   
</I>&gt;<i> 
</I>&gt;<i>     PrettyPrint (dom, buf)
</I>&gt;<i>     
</I>&gt;<i>     req.write ( &quot;Here's the result of printing from the SOURCE dom tree (Domlette)\n&quot; )
</I>&gt;<i>     req.write ( buf.getvalue() )
</I>&gt;<i>     req.write ( &quot;\n\n&quot; )
</I>&gt;<i> 
</I>&gt;<i>     buf.close ()
</I>&gt;<i> 
</I>&gt;<i>     # TEST 3
</I>&gt;<i>     req.write(&quot;Here's the result of the XSLT processing\n&quot;)
</I>&gt;<i>     processor = Processor.Processor()
</I>&gt;<i>     processor.appendStylesheet(transform)
</I>&gt;<i>     result = processor.runNode(dom, &quot;<A HREF="http://spam.com/doc.xml&quot;">http://spam.com/doc.xml&quot;</A>)
</I>&gt;<i>     
</I>&gt;<i>     req.write( result + &quot;\n\n&quot; )
</I>&gt;<i> 
</I>&gt;<i>     # LOCALE STUFF
</I>&gt;<i>     req.write(&quot;Ft.DEFAULT_ENCODING = &quot; + Ft.DEFAULT_ENCODING + &quot;\n&quot;)
</I>&gt;<i>     req.write(&quot;sys.getdefaultencoding = &quot; + sys.getdefaultencoding() + &quot;\n&quot;)
</I>&gt;<i>     req.write(&quot;local.getdefaultlocale()[1] = &quot; + locale.getdefaultlocale()[1] + &quot;\n\n&quot;)
</I>&gt;<i> 
</I>&gt;<i> def handler(req):    
</I>&gt;<i> 
</I>&gt;<i>     req.content_type = &quot;text/plain&quot;   
</I>&gt;<i>     test(req)
</I>&gt;<i>     
</I>&gt;<i>     return 0
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> if __name__ == &quot;__main__&quot;:
</I>&gt;<i>     test(sys.stdout)
</I>


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009691.html">[mod_python] calla function from form and via link
</A></li>
	<LI>Next message: <A HREF="009688.html">[mod_python] [error] make_obcallback: could not import mod_python.apache
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9687">[ date ]</a>
              <a href="thread.html#9687">[ thread ]</a>
              <a href="subject.html#9687">[ subject ]</a>
              <a href="author.html#9687">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
