<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> I: [mod_python] problem with file download in mod-python 3.0.1
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=I%3A%20%5Bmod_python%5D%20problem%20with%20file%20download%20in%20mod-python%203.0.1&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013320.html">
   <LINK REL="Next"  HREF="013314.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>I: [mod_python] problem with file download in mod-python 3.0.1</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Manera, Villiam</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=I%3A%20%5Bmod_python%5D%20problem%20with%20file%20download%20in%20mod-python%203.0.1&In-Reply-To="
       TITLE="I: [mod_python] problem with file download in mod-python 3.0.1">vmanera at manord.com
       </A><BR>
    <I>Thu Jan  2 11:09:59 EST 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="013320.html">[mod_python] linking installation problem [Fwd: Re: [mod_python]
 installation problems]
</A></li>
        <LI>Next message: <A HREF="013314.html">[mod_python] How to build mod_python on Windows NT?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13312">[ date ]</a>
              <a href="thread.html#13312">[ thread ]</a>
              <a href="subject.html#13312">[ subject ]</a>
              <a href="author.html#13312">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Da: Manera, Villiam 
Inviato: gioved&#236; 2 gennaio 2003 11.08
A: 'Gregory (Grisha) Trubetskoy'
Oggetto: R: [mod_python] problem with file download in mod-python 3.0.1


The problem is in python 2.2, Christopher Sean Hilton [<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">chris at vindaloo.com</A>]
wrote:

His problem is that python 2.2 does not include the __methods__ attribute 
for classes but the publisher.py code which actually handles the file inload

depends on it. If he downgrades from python 2.2 to python 2.1 he'll have the

__methods__ attribute of the file class. Someone needs to address this in 
the mod_python code however:

        for m in field.file.__methods__:
            self.__dict__[m] = getattr(field.file, m)

        self.headers = field.headers
        self.filename = field.filename

doesn't work in python 2.2 because __methods__ doesn't exist. The code 
appears to be trying to make local copies of all of the methods in the 
object that gets passed to the user. I had this problem in Unix (FreeBSD) 
two weeks ago and downgrading my python from 2.2 to 2.1 solved it. A google 
search on python, __methods__, 2.1 and 2.2 will yield more information.

Chris

after this John D. Garberson [<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">john.garberson at nexos.com</A>] wrote:
Having to downgrade seems a bit extreme [;-)

I don't know much about the publisher.py module, never having used it.
But if you do this import:

------------------------------------------------------------------------

from types import BuiltinMethodType

------------------------------------------------------------------------

then this function:

------------------------------------------------------------------------

def sim_methods(obj):
    return filter(lambda s, t=obj:
           type(getattr(t, s)) == BuiltinMethodType,
                                             dir(obj))

--------------------------------------------------------------------------

works under both 2.0 and 2.2.1 (I don't have a 2.1 any more) and delivers
the list of methods that it seems you want, looking at the publisher.py
source.  If you're not a fan of the functional programming approach, then
a list comprehension:

-----------------------------------------------------------------------

def sim_methods(obj):
    return [m for m in dir(obj)
                   if type(getattr(obj, m)) == BuiltinMethodType]

-----------------------------------------------------------------------

works just as well.

You could just replace the 'for m in field.file.__methods__:'

with

'for m in sim_methods(field.file):'

Hope this helps.

John
==============================================================
This work fine and I don't investigate any more from more elegant solution
I'm not so good in python!!

Villiam M.
-----Messaggio originale-----
Da: Gregory (Grisha) Trubetskoy [mailto:<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">grisha at modpython.org</A>]
Inviato: venerd&#236; 20 dicembre 2002 22.35
A: Manera, Villiam
Cc: <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
Oggetto: Re: [mod_python] problem with file download in mod-python 3.0.1



I must be missing something obvious, but without testing it and just by
looking at the code, I'm not sure I understand what the benefit is of
filtering out BuiltinMethodType, as opposed to just using straight
dir(obj).

The above might be a moot point since just as Brian Hawthorne suggested
I'm not sure why we don't need the File class at all and am in the process
of trying to fish out any memories from my tired brain about how it came
about in the fist place....

Grisha

On Thu, 12 Dec 2002, Manera, Villiam wrote:

&gt;<i> I'm testing mod-python 3.0.1 with apache 2.0.43 and python 2.2.2
</I>&gt;<i>
</I>&gt;<i> I've founded a older problem in file download (from python 2.1 to 2.2)
</I>&gt;<i>
</I>&gt;<i> the workaround is still the same:
</I>&gt;<i>
</I>&gt;<i> in publisher.py:
</I>&gt;<i>
</I>&gt;<i>  class File:
</I>&gt;<i>      &quot;&quot;&quot; Like a file, but also has headers and filename
</I>&gt;<i>      &quot;&quot;&quot;
</I>&gt;<i>      def __init__(self, field):
</I>&gt;<i>          # steal all the file-like methods
</I>&gt;<i>          for m in dir(field.file):
</I>&gt;<i> 		 self.__dict__[m] = getattr(field.file, m)
</I>&gt;<i>
</I>&gt;<i>          self.headers = field.headers
</I>&gt;<i>          self.filename = field.filename
</I>&gt;<i> ======================workaround
</I>&gt;<i> ==============================================
</I>&gt;<i>  class File:
</I>&gt;<i>      &quot;&quot;&quot; Like a file, but also has headers and filename
</I>&gt;<i>      &quot;&quot;&quot;
</I>&gt;<i>      def __init__(self, field):
</I>&gt;<i>          # steal all the file-like methods
</I>&gt;<i>          #for m in dir(field.file):    #dont' work
</I>&gt;<i>          for m in self.sim_methods(field.file):
</I>&gt;<i>              self.__dict__[m] = getattr(field.file, m)
</I>&gt;<i>
</I>&gt;<i>          self.headers = field.headers
</I>&gt;<i>          self.filename = field.filename
</I>&gt;<i>
</I>&gt;<i> 	#new--------
</I>&gt;<i>      def sim_methods(self,obj):
</I>&gt;<i>          from types import BuiltinMethodType
</I>&gt;<i>          return filter(lambda s, t=obj:
</I>&gt;<i>             type(getattr(t, s)) == BuiltinMethodType, dir(obj))
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I hope it will be put in place
</I>&gt;<i>
</I>&gt;<i> regards
</I>&gt;<i>
</I>&gt;<i> Villiam Manera
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://www.modpython.org/mailman/listinfo/mod_python">http://www.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i>
</I>


_______________________________________________
Mod_python mailing list
<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
<A HREF="http://www.modpython.org/mailman/listinfo/mod_python">http://www.modpython.org/mailman/listinfo/mod_python</A>


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013320.html">[mod_python] linking installation problem [Fwd: Re: [mod_python]
 installation problems]
</A></li>
	<LI>Next message: <A HREF="013314.html">[mod_python] How to build mod_python on Windows NT?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13312">[ date ]</a>
              <a href="thread.html#13312">[ thread ]</a>
              <a href="subject.html#13312">[ subject ]</a>
              <a href="author.html#13312">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
