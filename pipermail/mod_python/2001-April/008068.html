<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] CGI to mod_python -- what's the best way?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20CGI%20to%20mod_python%20--%20what%27s%20the%20best%20way%3F&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008066.html">
   <LINK REL="Next"  HREF="008069.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
<table border=0 width="100%"><tr><td valign="top">
   <H1>[mod_python] CGI to mod_python -- what's the best way?</H1>
    <B>Victor Muslin</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20CGI%20to%20mod_python%20--%20what%27s%20the%20best%20way%3F&In-Reply-To="
       TITLE="[mod_python] CGI to mod_python -- what's the best way?">victor at prodigy.net
       </A><BR>
    <I>Sun Apr  8 17:38:31 EST 2001</I>
    <P><UL>
        <LI>Previous message: <A HREF="008066.html">[mod_python] Instalation Error
</A></li>
        <LI>Next message: <A HREF="008069.html">[mod_python] CGI to mod_python -- what's the best way?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8068">[ date ]</a>
              <a href="thread.html#8068">[ thread ]</a>
              <a href="subject.html#8068">[ subject ]</a>
              <a href="author.html#8068">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Sorry for a long message, but this requires a bit of explanation. I 
appreciate your patience in advance.

I have a bunch of python legacy code that used to be part of a large 
CGI-based system. This code simply used print statements to output HTML as 
follows:

def foo():
         print 'html1'
         print 'html2'

Now I want to convert CGI to mod_python, but I would like to re-use the 
legacy code with as little re-writing as possible (obviously the legacy 
code is a lot lengthier and more complicated than the example above). I am 
using the publisher module, which requires my code to return a string 
containing all of the HTML. So I thought I would be clever and do something 
like this:

import sys, cStringIO
def handler(req):
         out =  sys.stdout = StringIO()
         foo()
         return out

This works great as long as the second request does not arrive before the 
first one is done. Otherwise, the output gets screwed up. Since &quot;out&quot; is a 
local variable, each request has its own instance, but sys.stdout is a 
global. When the second request arrives, sys.stdout gets reassigned and the 
rest of the output produced by print statements in the foo() function goes 
to the new StringIO object. For example, if the second request arrives and 
gets executed between the two print statements of the first request, then 
the first request's output could be  'html1\n' and the second request's 
output could be 'html2\nhtml1\nhtml2\n'.

Has anyone dealt with such a situation? Any clever suggestion would be 
appreciated as I hate to have to go into all the legacy code and change it 
to something like this:

def foo():
         out = 'html1\n'
         out = out + 'html2\n'
         return out

def handler(req):
         return foo()

Thanks in advance.
__________________________________________________________________________________
Victor Muslin      The power of accurate observation is frequently called
                          cynicism by those who don't have it.
                                       - George Bernard Shaw
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://mailman.modpython.org/pipermail/mod_python/attachments/20010408/b9ac82b3/attachment-0002.htm">http://mailman.modpython.org/pipermail/mod_python/attachments/20010408/b9ac82b3/attachment-0002.htm</A>
</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008066.html">[mod_python] Instalation Error
</A></li>
	<LI>Next message: <A HREF="008069.html">[mod_python] CGI to mod_python -- what's the best way?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8068">[ date ]</a>
              <a href="thread.html#8068">[ thread ]</a>
              <a href="subject.html#8068">[ subject ]</a>
              <a href="author.html#8068">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
