From grisha at ispol.com  Thu May 11 18:04:09 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:52 2004
Subject: [mod_python] This is just a test
Message-ID: <Pine.LNX.4.21.0005111803520.9333-100000@saturn.ispol.com>

Hello there!

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com


From peter at wl.vg  Sat May 13 20:25:53 2000
From: peter at wl.vg (Peter Halliday)
Date: Fri Jan  9 21:45:52 2004
Subject: [mod_python] use rpms, no src directory for apache
Message-ID: <391DF291.4BB5F774@wl.vg>

I am a developer that does a lot of online applications.  I am
interested in switching to python, because of its OOP and scalibility.
I am very impressed with python.  However, the problem is that I don't
have a src/modules directory.  I am runnign Red Hat 6.1 and installed
apache with their rpms.  Can you please help me.

<!--
Peter Halliday                            |   peter@whetstonelogic.com
Online Application Developer  |   IM   ScreenName: hoaggelos
Whetstone Logic, Inc.              |
-->


From jam at quark.emich.edu  Sun May 14 20:52:44 2000
From: jam at quark.emich.edu (Jeff)
Date: Fri Jan  9 21:45:52 2004
Subject: [mod_python] configuration of mod_python as DSO
Message-ID: <20000514205244.D11083@quark.emich.edu>

greetings,

I've done some preliminary work on a RedHat 6.2 box to get mod_python to
compile as a DSO module, and I've so far had limited success-- I'd rather
not have to rebuild apache from sources to get this functionality.

to start, I built the .so with the following command:

% /usr/sbin/apxs -Wl,-export-dynamic -L/usr/lib/python1.5/config \
-I/usr/include/python1.5/ -I/usr/include/apache -c mod_python.c -lpython1.5 \
-lpthread

I then copied the resulting .so module to /usr/lib/apache:
% sudo cp mod_python.so /usr/lib/apache

I then added these lines to the /etc/httpd/conf/httpd.conf file:
LoadModule python_module        modules/mod_python.so
AddModule mod_python.c

The 'LoadModule' directive was inserted in the group of 'LoadModule' lines that
were already in the file, and the same with AddModule. I just put them at
the end of their respective lists.

Since the machine I'm installing this on is not production, I made a
.htaccess file in /home/httpd/html containing the following:
-- begin .htaccess --
AddHandler python-program .py
PythonDebug
PythonHandler test
-- end .htacess --

My 'test.py' file contains the following:
-- begin test.py --
from mod_python import apache

def handler(req):
  req.send_http_header()
  req.write("Hello World!")
  return apache.OK
-- end test.py --

I then restarted apache:
[~] [8:21pm] [jam@toast-pts/2] % /etc/rc.d/init.d/httpd status
httpd dead but subsys locked
[~] [8:21pm] [jam@toast-pts/2] % sudo /etc/rc.d/init.d/httpd restart
Password:
Shutting down http:                                        [FAILED]
Starting httpd:                                            [  OK  ]
[~] [8:21pm] [jam@toast-pts/2] % /etc/rc.d/init.d/httpd status
httpd dead but subsys locked

any clues as to where I might have gone wrong?

regards,
J
-- 
|| visit gfd <http://quark.emich.edu/>
|| psa member -- <http://www.python.org/psa/> 

From echuck at mindspring.com  Tue May 16 07:52:19 2000
From: echuck at mindspring.com (Chuck Esterbrook)
Date: Fri Jan  9 21:45:52 2004
Subject: [mod_python] Handlers
Message-ID: <39213673.4F54B5B9@mindspring.com>

Hi, I noticed that you have 3 out-of-the-box handlers including one for ZPublisher. I was wondering if you would be interested in providing a handler for Webware for Python?

We already have 2 handlers, one for CGI and another for FastCGI. Actually, there is also a 3rd for AOLserver provided by the AOLserver time which, like you, packages ready-made handlers (we call them adaptors).

The URL is below in my .sig.  :-)

-Chuck
____________________________________________________________

http://webware.sourceforge.net

From grisha at ispol.com  Tue May 16 08:04:07 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:52 2004
Subject: [mod_python] Handlers
In-Reply-To: <39213673.4F54B5B9@mindspring.com>
Message-ID: <Pine.LNX.4.21.0005160758040.3709-100000@saturn.ispol.com>

On Tue, 16 May 2000, Chuck Esterbrook wrote:

> 
> Hi, I noticed that you have 3 out-of-the-box handlers including one
> for ZPublisher. I was wondering if you would be interested in
> providing a handler for Webware for Python?

"providing" as in "writing"? Probably not, there is enough things to do
with mod_python (like DSO) that I'd rather not get distracted on
handlers...

(What is webware, BTW? I couldn't gather from the website what it is and
didn't feel like downloading it right now.)

My vision for mod_python is that of a very simple piece of software, in
fact I'm not even sure that the three handlers that come with it *should*
be part of the package...

BUT, you and everyone else are more than welcome to contribute, we could
create a section on the website for additional handlers.

> We already have 2 handlers, one for CGI and another for FastCGI.

When you say "handler" do you mean it is a mod_python handler, or some
other handler?

Grisha


From grisha at ispol.com  Tue May 16 22:12:54 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:52 2004
Subject: [mod_python] DSO
In-Reply-To: <20000515210702.A19290@yetix.sz-sb.de>
Message-ID: <Pine.LNX.4.21.0005162200180.20825-100000@saturn.ispol.com>

I just tried mod_python as a dso on 

Linux 2.2.14 (Debian [potato])
gcc 2.9.52
libc6
python 1.5.2 with and without threads
apache-3.1.12

and it seems to work OK, at least the test.py does.

I used 

apxs -I /usr/local/include/python1.5 -c mod_python.c \
     /usr/local/lib/python1.5/config/libpython1.5.a  \
     -lpthead

to compile the module.

On another Linux system it compiles, but Apache complains upon loading the
module that "python_module is garbled", although I think that's a libc/gcc
incompatibility problem of some sort.

On FreeBSD 4.0 STABLE apxs doesn't work at all - it gives gcc arguments
that are not allowed....

It'd be interesting to see what experiences other people have with this?

Grisha


On Mon, 15 May 2000, Andreas Jung wrote:

> 
> hehe...try to get DSO working because I dislike recompiling
> Apache for every new module :)
> 
> Andreas
>  
> 


From ralf at silicon.org  Thu May 18 13:32:38 2000
From: ralf at silicon.org (Ralf Canis)
Date: Fri Jan  9 21:45:52 2004
Subject: [mod_python] problem using regular expressions in CGI scripts
Message-ID: <20000518133238.A6940@silicon.org>

Hello,

I've just installed mod_python and have a problem with CGI scripts
using regular expressions.

apache 1.3.6
python 1.52
mod_python 1.9a

httpd.conf contains:
AddHandler python-program .py
PythonHandler cgihandler

--- snip ---
import re, sys, traceback

print 'Content-type: text/plain'
print

sys.stderr = sys.stdout

try:
  re.compile( r'foo(\(.+\))bar' )
  print 'ok'
except:
  print '\n\n'
  traceback.print_exc()
  print '\n'
--- snip ---

Opening this page in a browser and pressing refresh several times
results in the following error, one at a time. Sometimes it works :)
I've already reinstalled python and mod_python. BTW, same problem
when using PyApache!

BUT: Loading the Python interpreter as a standard CGI program always works.

Traceback (innermost last):
  File "/home/httpd/sites/ralf/test/re_err.py", line 9, in ?
    re.compile( r'foo(\(.+\))bar' )
  File "/var/tmp/python/python-root/usr/lib/python1.5/re.py", line 79, in compile
    code=pcre_compile(pattern, flags, groupindex)
pcre.error: ('back reference to non-existent subpattern', 4149)

or

Traceback (innermost last):
  File "/home/httpd/sites/ralf/test/re_err.py", line 9, in ?
    re.compile( r'foo(\(.+\))bar' )
  File "/var/tmp/python/python-root/usr/lib/python1.5/re.py", line 79, in compile
    code=pcre_compile(pattern, flags, groupindex)
pcre.error: ('\\ at end of pattern', 1886)

or

Traceback (innermost last):
  File "/home/httpd/sites/ralf/test/re_err.py", line 9, in ?
    re.compile( r'foo(\(.+\))bar' )                     
  File "/var/tmp/python/python-root/usr/lib/python1.5/re.py", line 79, in compile
    code=pcre_compile(pattern, flags, groupindex)
pcre.error: ('unmatched parentheses', 10)

or

Traceback (innermost last):
  File "/home/httpd/sites/ralf/test/re_err.py", line 9, in ?
    re.compile( r'foo(\(.+\))bar' )                     
  File "/var/tmp/python/python-root/usr/lib/python1.5/re.py", line 79, in compile
    code=pcre_compile(pattern, flags, groupindex)
pcre.error: ('regular expression too large', 0)

or

Traceback (innermost last):
  File "/home/httpd/sites/ralf/test/re_err.py", line 9, in ?
    re.compile( r'foo(\(.+\))bar' )
  File "/var/tmp/python/python-root/usr/lib/python1.5/re.py", line 79, in compile
    code=pcre_compile(pattern, flags, groupindex)
pcre.error: ('missing )', 113)


Did I miss something or is this a nasty bug? It's ugly, because MySQLdb
doesn't work because of it.

Sincerely
  Ralf

-- 
Ralf Canis            ralf@silicon.org
Germany               canis@bigfoot.com

From ralf at silicon.org  Thu May 18 14:59:53 2000
From: ralf at silicon.org (Ralf Canis)
Date: Fri Jan  9 21:45:52 2004
Subject: [mod_python] problem using regular expressions in CGI scripts
In-Reply-To: <20000518143946.O3437@lib.hel.fi>; from erno@iki.fi on Thu, May 18, 2000 at 02:39:46PM +0300
References: <20000518133238.A6940@silicon.org> <20000518143946.O3437@lib.hel.fi>
Message-ID: <20000518145953.A7140@silicon.org>

On Thu, May 18, 2000 at 02:39:46PM +0300, Erno Kuusela wrote:

Hello Erno,

> i haven't even installed mod_python yet, but a debugging idea
> came to mind...
> 
> if you compile your regular expressions, they will have a .pattern
> attribute that contains your regexp. it seem to me something
> in mod_python may be munging/interpreting \-escapes, so if
> you print the pattern out and it looks different from the
> one you put in, you might be closer to figuring out what
> is going on..

Yes, I thought so, too. Therefor I modified re.py in lib/python1.5
at line 79 (re.compile) to print the pattern right before calling
pcre_compile - it's the pattern I call it with :(
Regarding this, I guess the problem is in prce_compile, but I did
not investigate this further.

Ralf

-- 
Ralf Canis            ralf@silicon.org
Germany               canis@bigfoot.com

From grisha at ispol.com  Thu May 18 09:15:50 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:52 2004
Subject: [mod_python] problem using regular expressions in CGI scripts
In-Reply-To: <20000518145953.A7140@silicon.org>
Message-ID: <Pine.LNX.4.21.0005180903560.30961-100000@saturn.ispol.com>

Can you try running the same code in your own handler, and see where that
takes you, in other words:

httpd.conf:
AddHandler python-program .py
PythonHandler myhandler
PythonDebug

Then the myhandler.py file would have something like

--- snip ---

from mod_python import apache
import re, sys

def handler(req):

    req.content_type = 'text/plain'
    req.send_http_header()
    re.compile( r'foo(\(.+\))bar' )
    req.write('ok')
    return apache.OK

--- snip ---


Note that it is not necessary to print out the traceback - mod_python does
that for you if PythonDebug directive is specified.

Grisha


On Thu, 18 May 2000, Ralf Canis wrote:

> On Thu, May 18, 2000 at 02:39:46PM +0300, Erno Kuusela wrote:
> 
> Hello Erno,
> 
> > i haven't even installed mod_python yet, but a debugging idea
> > came to mind...
> > 
> > if you compile your regular expressions, they will have a .pattern
> > attribute that contains your regexp. it seem to me something
> > in mod_python may be munging/interpreting \-escapes, so if
> > you print the pattern out and it looks different from the
> > one you put in, you might be closer to figuring out what
> > is going on..
> 
> Yes, I thought so, too. Therefor I modified re.py in lib/python1.5
> at line 79 (re.compile) to print the pattern right before calling
> pcre_compile - it's the pattern I call it with :(
> Regarding this, I guess the problem is in prce_compile, but I did
> not investigate this further.
> 
> Ralf
> 
> -- 
> Ralf Canis            ralf@silicon.org
> Germany               canis@bigfoot.com
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 





From ralf at silicon.org  Fri May 19 10:33:56 2000
From: ralf at silicon.org (Ralf Canis)
Date: Fri Jan  9 21:45:52 2004
Subject: [mod_python] SOLVED: problem using regular expressions in CGI scripts
Message-ID: <20000519103356.A1499@silicon.org>

Hi,

I found what caused this strange problem: loading mod_python dynamically!
(build+installed using apxs).

Thanks everybody
  Ralf
-- 
Ralf Canis            ralf@silicon.org
Germany               canis@bigfoot.com

From grisha at ispol.com  Fri May 19 07:39:55 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:52 2004
Subject: [mod_python] SOLVED: problem using regular expressions in CGI
 scripts
In-Reply-To: <20000519103356.A1499@silicon.org>
Message-ID: <Pine.LNX.4.21.0005190737330.5106-100000@saturn.ispol.com>

Very cusrious. 

The dynamic loading by itself shouldn't make the module act any
differently. It's probably not the dynamic loading itself, but rather that
as a result of dynamic loading some libraries get rearranged?

I haven't had the time to look at this yet as I've been busy perfecting
the documentation and working out other DSO issues, but I will try soon.

Grisha

On Fri, 19 May 2000, Ralf Canis wrote:

> Hi,
> 
> I found what caused this strange problem: loading mod_python dynamically!
> (build+installed using apxs).
> 
> Thanks everybody
>   Ralf
> -- 
> Ralf Canis            ralf@silicon.org
> Germany               canis@bigfoot.com
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From grisha at ispol.com  Fri May 19 19:47:06 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:52 2004
Subject: [mod_python] problem using regular expressions in CGI scripts
In-Reply-To: <20000518152302.A7535@silicon.org>
Message-ID: <Pine.LNX.4.21.0005191945410.8192-100000@saturn.ispol.com>

I'm unable to reproduce this. Tried it as DSO, on Linux and FreeBSD and it
works fine...

Anybody else on the list want to try it?

Grisha


On Thu, 18 May 2000, Ralf Canis wrote:

> On Thu, May 18, 2000 at 09:15:50AM -0400, Gregory Trubetskoy wrote:
> 
> Hi Grisha,
> 
> same errors, here's one for example.
> 
> Ralf
> 
> ---snip---
> \nERROR mod_python: "PythonHandler myhandler"
> 
> Traceback (innermost last):
> 
>   File "/usr/lib/python1.5/site-packages/mod_python/apache.py", line 110, in Dispatch
>     result = object(req)
> 
>   File "./myhandler.py", line 8, in handler
>     re.compile( r'foo(\(.+\))bar' )
> 
>   File "/usr/lib/python1.5/re.py", line 79, in compile
>     code=pcre_compile(pattern, flags, groupindex)
> 
> pcre.error: ('missing )', 2493)
> 
> 
> NOTE: More output from other handlers, if any, may follow.
> This will NOT happen, and request processing will STOP
> at this point when you remove PythonDebug directive.
> ---snip---
> 
> > 
> > Can you try running the same code in your own handler, and see where that
> > takes you, in other words:
> > 
> > httpd.conf:
> > AddHandler python-program .py
> > PythonHandler myhandler
> > PythonDebug
> > 
> > Then the myhandler.py file would have something like
> > 
> > --- snip ---
> > 
> > from mod_python import apache
> > import re, sys
> > 
> > def handler(req):
> > 
> >     req.content_type = 'text/plain'
> >     req.send_http_header()
> >     re.compile( r'foo(\(.+\))bar' )
> >     req.write('ok')
> >     return apache.OK
> > 
> > --- snip ---
> > 
> > 
> > Note that it is not necessary to print out the traceback - mod_python does
> > that for you if PythonDebug directive is specified.
> > 
> > Grisha
> > 
> > 
> > On Thu, 18 May 2000, Ralf Canis wrote:
> > 
> > > On Thu, May 18, 2000 at 02:39:46PM +0300, Erno Kuusela wrote:
> > > 
> > > Hello Erno,
> > > 
> > > > i haven't even installed mod_python yet, but a debugging idea
> > > > came to mind...
> > > > 
> > > > if you compile your regular expressions, they will have a .pattern
> > > > attribute that contains your regexp. it seem to me something
> > > > in mod_python may be munging/interpreting \-escapes, so if
> > > > you print the pattern out and it looks different from the
> > > > one you put in, you might be closer to figuring out what
> > > > is going on..
> > > 
> > > Yes, I thought so, too. Therefor I modified re.py in lib/python1.5
> > > at line 79 (re.compile) to print the pattern right before calling
> > > pcre_compile - it's the pattern I call it with :(
> > > Regarding this, I guess the problem is in prce_compile, but I did
> > > not investigate this further.
> > > 
> -- 
> Ralf Canis            ralf@silicon.org
> Germany               canis@bigfoot.com
> 


From stevena at permanent.cc  Sat May 20 23:42:32 2000
From: stevena at permanent.cc (Steven D. Arnold)
Date: Fri Jan  9 21:45:52 2004
Subject: [mod_python] apache compile problems
Message-ID: <4.3.1.2.20000520233846.014d7ee8@phear.dementian.com>

Hi,

I'm trying to compile apache with mod_python and I'm getting the following 
error:

[root@catatonia apache_1.3.12]# ./configure 
--activate-module=src/modules/extra/mod_python.c --prefix=/usr/local/apache 
--enable-module=all
Configuring for Apache, Version 1.3.12
  + using installation path layout: Apache (config.layout)
  + activated python module (modules/extra/mod_python.c)
Creating Makefile
Creating Configuration.apaci in src
grep: /usr/lib/python1.5/config/Makefile: No such file or directory
grep: /usr/lib/python1.5/config/Makefile: No such file or directory
grep: /usr/lib/python1.5/config/Makefile: No such file or directory
grep: /usr/lib/python1.5/config/Makefile: No such file or directory
cd ..; gcc  -DLINUX=2 -DUSE_HSREGEX -DUSE_EXPAT -I./lib/expat-lite 
`./apaci` -I/usr/include/python1.5    -o helpers/dummy 
helpers/dummy.c   -lm -lcrypt -lndbm -ldb 
/usr/lib/python1.5/config/libpython1.5.a   -ldl
gcc: /usr/lib/python1.5/config/libpython1.5.a: No such file or directory
make: *** [dummy] Error 1
Creating Makefile in src
  + configured for Linux platform
  + setting C compiler to gcc
  + setting C pre-processor to gcc -E
  + checking for system header files
  + adding selected modules
     o rewrite_module uses ConfigStart/End
  + using -lndbm for DBM support
       enabling DBM support for mod_rewrite
     o dbm_auth_module uses ConfigStart/End
     o db_auth_module uses ConfigStart/End
       using Berkeley-DB/2.x for mod_auth_db (-ldb)
     o python_module uses ConfigStart/End
  + using -ldl for vendor DSO support
  + checking sizeof various data types
  + doing sanity check on compiler and options
** A test compilation with your Makefile configuration
** failed.  The below error output from the compilation
** test will give you an idea what is failing. Note that
** Apache requires an ANSI C Compiler, such as gcc.

======== Error Output for sanity check ========
============= End of Error Report =============

  Aborting!


I have no directory /usr/lib/python1.5/config, though the parent of that 
dir does exist.  I just freshly installed python 1.5.2 before trying the 
above.  Platform is Red Hat Linux 6.2.  Any ideas?


steve

--
Steven D. Arnold          Que quiero sera           stevena@permanent.cc
"We choose to go to the moon in this decade and do the other things, not
because they are easy, but because they are hard."    -- John F. Kennedy


From stevena at permanent.cc  Sun May 21 00:28:14 2000
From: stevena at permanent.cc (Steven D. Arnold)
Date: Fri Jan  9 21:45:52 2004
Subject: [mod_python] [SOLVED] apache compile problems
In-Reply-To: <4.3.1.2.20000520233846.014d7ee8@phear.dementian.com>
Message-ID: <4.3.1.2.20000521002528.015faf08@phear.dementian.com>

For some reason, the original installation of python on my system didn't 
have a config dir inside /usr/lib/python1.5.  I reinstalled python and it 
made sys.exec_prefix /usr/local; however, it didn't replace the old copies 
of python sitting in /usr/bin.  (It did put new copies in 
/usr/local/bin.)  When I deleted the old copies and created symlinks to the 
new copies, python then knew to look in /usr/local/lib/python1.5/config, 
and all was well.


steve

--
Steven D. Arnold          Que quiero sera           stevena@permanent.cc
"We choose to go to the moon in this decade and do the other things, not
because they are easy, but because they are hard."    -- John F. Kennedy


From jam at quark.emich.edu  Sun May 21 08:04:35 2000
From: jam at quark.emich.edu (Jeff)
Date: Fri Jan  9 21:45:52 2004
Subject: [mod_python] apache compile problems
In-Reply-To: <4.3.1.2.20000520233846.014d7ee8@phear.dementian.com>; from stevena@permanent.cc on Sat, May 20, 2000 at 11:42:32PM -0400
References: <4.3.1.2.20000520233846.014d7ee8@phear.dementian.com>
Message-ID: <20000521080435.A1765@quark.emich.edu>

On Sat, May 20, 2000 at 11:42:32PM -0400, Steven D. Arnold wrote:
> Hi,
> 
> I'm trying to compile apache with mod_python and I'm getting the following 
> error:
[...snipped...]
> 
> ======== Error Output for sanity check ========
> ============= End of Error Report =============
> 
>   Aborting!
> 
> 
> I have no directory /usr/lib/python1.5/config, though the parent of that 
> dir does exist.  I just freshly installed python 1.5.2 before trying the 
> above.  Platform is Red Hat Linux 6.2.  Any ideas?
> 
> 
> steve
> 

be sure that the python-devel package has been installed before attempting
the build.

hope that helps ;)

regards,
J
-- 
|| visit gfd <http://quark.emich.edu/>
|| psa member -- <http://www.python.org/psa/> 

From wayne.izatt at myself.com  Sun May 21 14:38:05 2000
From: wayne.izatt at myself.com (Wayne Izatt)
Date: Fri Jan  9 21:45:52 2004
Subject: [mod_python] .htaccess and httpd.conf
Message-ID: <3928573C.EFEB5271@myself.com>

Hi all. I've built and installed a mod_python enabled apache. However,
I'm not sure what, if any, directives I need to add to httpd.conf to get
it to pass .py files to the python handler. When I point my browser at
the test script, all that I get is the script in the browser window.

Perhaps someone has a sample httpd.conf (just the handler stuff will do)
or a vanilla .htaccess (if that's where the directives should go).

(Yes, I've followed the installation instructions, but something simple
is still eluding me).

cheers


From stevena at permanent.cc  Sun May 21 17:56:24 2000
From: stevena at permanent.cc (Steven D. Arnold)
Date: Fri Jan  9 21:45:52 2004
Subject: [mod_python] .htaccess and httpd.conf
In-Reply-To: <3928573C.EFEB5271@myself.com>
Message-ID: <4.3.1.2.20000521175332.01f98ee8@phear.dementian.com>

At 02:38 PM 5/21/2000 -0700, Wayne Izatt wrote:
>Hi all. I've built and installed a mod_python enabled apache. However,
>I'm not sure what, if any, directives I need to add to httpd.conf to get
>it to pass .py files to the python handler. When I point my browser at
>the test script, all that I get is the script in the browser window.
>
>Perhaps someone has a sample httpd.conf (just the handler stuff will do)
>or a vanilla .htaccess (if that's where the directives should go).
>
>(Yes, I've followed the installation instructions, but something simple
>is still eluding me).

I'm having the same experience.

I tried the following directives:

Alias /python /usr/local/apache/htdocs/python

<Location /python/>
     AllowOverride All
     AddHandler python-program .py
     PythonDebug
     PythonHandler test
</Location>


When I try loading the page, I get this error:

\nERROR mod_python: "PythonHandler test"

Traceback (innermost last):

File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 
107, in Dispatch object = self.resolve_object(module_name, object_str)

File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 
70, in resolve_object raise "ResolveError", "Couldn't resolve object '%s' 
in module '%s'." % \

ResolveError: Couldn't resolve object 'handler' in module 'test'.

NOTE: More output from other handlers, if any, may follow. This will NOT 
happen, and request processing will STOP at this point when you remove 
PythonDebug directive.


I'm not quite sure what I'm doing wrong.  Any ideas?


steve

--
Steven D. Arnold          Que quiero sera           stevena@permanent.cc
"We choose to go to the moon in this decade and do the other things, not
because they are easy, but because they are hard."    -- John F. Kennedy


From wayne.izatt at myself.com  Sun May 21 15:37:21 2000
From: wayne.izatt at myself.com (Wayne Izatt)
Date: Fri Jan  9 21:45:52 2004
Subject: [Fwd: [mod_python] .htaccess and httpd.conf]
Message-ID: <39286520.67A1B247@myself.com>

Victory. Here's what I did.

added:

AddModule mod_python.c

after the other added modules.

added this directive:

<Directory "/usr/local/apache/htdocs/ptest">
    AddHandler python-program .py
    PythonDebug
    PythonHandler test
</Directory>

and everything works fine.

thanks all

Wayne Izatt wrote:

> Hi all. I've built and installed a mod_python enabled apache. However,
> I'm not sure what, if any, directives I need to add to httpd.conf to get
> it to pass .py files to the python handler. When I point my browser at
> the test script, all that I get is the script in the browser window.
>
> Perhaps someone has a sample httpd.conf (just the handler stuff will do)
> or a vanilla .htaccess (if that's where the directives should go).
>
> (Yes, I've followed the installation instructions, but something simple
> is still eluding me).
>
> cheers
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python




From grisha at ispol.com  Sun May 21 19:11:37 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:52 2004
Subject: [mod_python] .htaccess and httpd.conf
In-Reply-To: <4.3.1.2.20000521175332.01f98ee8@phear.dementian.com>
Message-ID: <Pine.LNX.4.21.0005211909500.29474-100000@saturn.ispol.com>

This means that test.py doesn't have a function called "handler" defined
in it.

What's in your test.py?

Grisha


On Sun, 21 May 2000, Steven D. Arnold wrote:

> When I try loading the page, I get this error:
> 
> ResolveError: Couldn't resolve object 'handler' in module 'test'.
> 


From stevena at permanent.cc  Sun May 21 20:05:44 2000
From: stevena at permanent.cc (Steven D. Arnold)
Date: Fri Jan  9 21:45:52 2004
Subject: [mod_python] .htaccess and httpd.conf
In-Reply-To: <Pine.LNX.4.21.0005211909500.29474-100000@saturn.ispol.com>
References: <4.3.1.2.20000521175332.01f98ee8@phear.dementian.com>
Message-ID: <4.3.1.2.20000521200358.015c0300@phear.dementian.com>

At 07:11 PM 5/21/2000 -0400, Gregory Trubetskoy wrote:

>This means that test.py doesn't have a function called "handler" defined
>in it.
>
>What's in your test.py?

I put exactly what the docs suggest:

from mod_python import apache

def handler(req):
         req.send_http_header()
         req.write("Hello World!")
         return apache.OK


However, I made the changes Wayne suggested, and now it works for me. 
:-)  (It didn't initially, but it does now -- I can't explain 
why.)  Apparently the AddModule and Directory directives did it...


steve


--
Steven D. Arnold          Que quiero sera           stevena@permanent.cc
"We choose to go to the moon in this decade and do the other things, not
because they are easy, but because they are hard."    -- John F. Kennedy


From grisha at ispol.com  Mon May 22 19:19:38 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:52 2004
Subject: [mod_python] mod_python 2.0
In-Reply-To: <4.3.1.2.20000520233846.014d7ee8@phear.dementian.com>
Message-ID: <Pine.LNX.4.21.0005211901010.29474-100000@saturn.ispol.com>


Is out on the site - http://www.modpython.org/

(well, as soon as the DNS changes take effect - the site has moved to
another server.)

It has quite a bit of documentation improvements, especially the
installation section, as well as some significant code fixes, though no
new features. I think this version should be more or less stable because
since 1.9 I haven't really found any really major bugs or had reports of
instability, except during the install process, which is quite normal.

Unless something major turns up in the very near future, an announcement
to comp.lang.python will follow, as well as links on Python and Apache
site requested, which should up the user base a bit.... :-)

Grisha


From morton at dennisinter.com  Mon May 22 21:14:40 2000
From: morton at dennisinter.com (Damian Morton)
Date: Fri Jan  9 21:45:52 2004
Subject: [mod_python] mod_python 2.0
In-Reply-To: <Pine.LNX.4.21.0005211901010.29474-100000@saturn.ispol.com>
Message-ID: <NDBBLENPLCPAHKODFHNGMEEKDHAA.morton@dennisinter.com>

Please excuse the newbie question, as Im not as familiar with unix and
apache as Id like to be, although the availability of mod_python opens up
some very interesting possibilities.

I know from observing mod_perl people that there are some problems with
having global data shared between invokations of request handlers. Is there
some mechanism in mod_python to get around this? I understand that the issue
is that Apache runs serveral processes to optimise performance, and that
each request will likely get routed to different processes, each one having
its own (global?) data.



> -----Original Message-----
> From: mod_python-admin@modpython.org
> [mailto:mod_python-admin@modpython.org]On Behalf Of Gregory Trubetskoy
> Sent: Monday, May 22, 2000 7:20 PM
> To: mod_python list
> Subject: [mod_python] mod_python 2.0
>
>
>
>
> Is out on the site - http://www.modpython.org/
>
> (well, as soon as the DNS changes take effect - the site has moved to
> another server.)
>
> It has quite a bit of documentation improvements, especially the
> installation section, as well as some significant code fixes, though no
> new features. I think this version should be more or less stable because
> since 1.9 I haven't really found any really major bugs or had reports of
> instability, except during the install process, which is quite normal.
>
> Unless something major turns up in the very near future, an announcement
> to comp.lang.python will follow, as well as links on Python and Apache
> site requested, which should up the user base a bit.... :-)
>
> Grisha
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python


From grisha at ispol.com  Tue May 23 07:28:36 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:53 2004
Subject: [mod_python] mod_python 2.0
In-Reply-To: <NDBBLENPLCPAHKODFHNGMEEKDHAA.morton@dennisinter.com>
Message-ID: <Pine.LNX.4.21.0005230719150.7819-100000@saturn.ispol.com>

On Mon, 22 May 2000, Damian Morton wrote:

> I understand that the issue is that Apache runs serveral processes to
> optimise performance, and that each request will likely get routed to
> different processes, each one having its own (global?) data.

This is hardly a mod_python issue, but...

There are basically two common ways of sharing data - through a backend
database like MySQL or via a file. With a file you will need a locking
mechanism of some sort.

I, personally, have yet to find an application where there is a true need
for global data (other than a backend database). HTTP applications, given
the stateless nature of the protocol, have eveolved with other ways to
retain state - cookies, URL's, form data and those are usually sufficient.

HTH -

Grisha


From riku.voipio at tietoenator.com  Tue May 23 16:11:47 2000
From: riku.voipio at tietoenator.com (Riku Voipio)
Date: Fri Jan  9 21:45:53 2004
Subject: [mod_python] apache reload wont't work with DSO mod_python
Message-ID: <20000523161147.A23015@samncd.tsd.tieto.com>

Hi, 
/etc/init.d/apache reload crashes if mod_python is loaded.
Another anomility noted is, that apache wont start, if the last 
loaded module is mod_python.

Elsewell it is running smoothly.

Running Debian potato apt-get up-to-date today. 

and as for last, 
Here's a patch to fix a type on install.html

--- installation.html.old       Tue May 23 16:01:31 2000
+++ installation.html   Tue May 23 16:05:27 2000
@@ -177,8 +177,8 @@
      standard Debian Python development package installed]
 
     1. cd src/modules/extra
-    2. axps -I /usr/local/include/python1.5 -c mod_python.c \
-            /usr/local/lib/python1.5/config/libpython1.5.a -lpthread
+    2. apxs -I /usr/include/python1.5 -c mod_python.c \
+            /usr/lib/python1.5/config/libpython1.5.a -lpthread
       (You don't nead -lpthread if your Python is compiled without threads)
 


-- 
Riku Voipio
riku.voipio@tietoenator.com
09-862 60764

From grisha at ispol.com  Thu May 25 22:50:59 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:53 2004
Subject: [mod_python] quick code review
In-Reply-To: <Pine.LNX.4.10.10005251801100.16846-100000@nebula.lyra.org>
Message-ID: <Pine.LNX.4.21.0005252248100.24987-100000@saturn.ispol.com>


Thanks for taking the time to look over the code and all the comments, I
think they're all valid and I'll address them.

On Thu, 25 May 2000, Greg Stein wrote:

> *) I don't understand why the PyTypeObject's are init'd/copied in
>    python_init, rather than just doing that at the module level. For
>    example:
>      static PyTypeObject serverobjecttype = { ... };

I wonder if this is something that I had to do back in httpdapy times so
that it compiled on Visual C++...?

Grisha

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python

From grisha at ispol.com  Thu May 25 22:53:34 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:53 2004
Subject: [mod_python] reload problem
In-Reply-To: <Pine.LNX.4.10.10005251746270.16846-100000@nebula.lyra.org>
Message-ID: <Pine.LNX.4.21.0005252251390.24987-100000@saturn.ispol.com>


I think the archive is broken, BTW, ever since I moved mailman to another
machine.... I don't see any messages from today or yesterday.

I will probably recreate this list tomorrow and I'll try to make the
archives reflect everything that wasn't archived.

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Thu, 25 May 2000, Greg Stein wrote:

> [ I just subscribed, so I can't "reply" to the reload issue that I saw in
>   the archive... starting from scratch ]

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python

From gstein at lyra.org  Fri May 26 00:54:31 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:45:53 2004
Subject: [mod_python] quick code review
In-Reply-To: <Pine.LNX.4.21.0005252248100.24987-100000@saturn.ispol.com>
Message-ID: <Pine.LNX.4.10.10005260049500.21092-100000@nebula.lyra.org>

On Thu, 25 May 2000, Gregory Trubetskoy wrote:
>...
> On Thu, 25 May 2000, Greg Stein wrote:
> > *) I don't understand why the PyTypeObject's are init'd/copied in
> >    python_init, rather than just doing that at the module level. For
> >    example:
> >      static PyTypeObject serverobjecttype = { ... };
> 
> I wonder if this is something that I had to do back in httpdapy times so
> that it compiled on Visual C++...?

There is something about static initializers in MSVC. Generally, code will
add a line such as:

(from arraymodule.c)

    Arraytype.ob_type = &PyType_Type;


I don't know exactly *why* it must be done that way, but there ya go. The
underlying point is that the initialization of the type objects can be
simplified quite a bit.

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python

From gstein at lyra.org  Fri May 26 01:54:54 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:45:53 2004
Subject: [mod_python] apache.py suggestions
Message-ID: <Pine.LNX.4.10.10005260147360.21092-100000@nebula.lyra.org>

Here are a few more suggestions, but for apache.py:

*) avoid exec/eval: they are quite slow, and can pose a security risk

*) to import modules, use: module = __import__(module_name)

*) resolve_object(), use the getattr() function for traversing

*) copy a dictionary using dict.copy()

*) maybe move some of the CGI stuff off to 'cgihandler'


Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python

From mmach at batory.org.pl  Fri May 26 11:05:50 2000
From: mmach at batory.org.pl (Micha<B3> Mach)
Date: Fri Jan  9 21:45:53 2004
Subject: [mod_python] apache.py suggestions
In-Reply-To: <Pine.LNX.4.10.10005260147360.21092-100000@nebula.lyra.org>
Message-ID: <NDBBIBMMILNGAOKOEEKDEECDCEAA.mmach@batory.org.pl>


Hi,

> *) to import modules, use: module = __import__(module_name)

Why so? That's perhaps more like the Python question than mod_python matter,
but anyway...

Best,
Michal


---
Michal Mach   mmach@batory.org.pl
Stefan Batory Foundation
http://www.batory.org.pl/

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python

From gstein at lyra.org  Fri May 26 03:39:52 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:45:53 2004
Subject: [mod_python] apache.py suggestions
In-Reply-To: <NDBBIBMMILNGAOKOEEKDEECDCEAA.mmach@batory.org.pl>
Message-ID: <Pine.LNX.4.10.10005260335290.21092-100000@nebula.lyra.org>

On Fri, 26 May 2000, Micha<B3> Mach wrote:
> > *) to import modules, use: module = __import__(module_name)
> 
> Why so? That's perhaps more like the Python question than mod_python matter,
> but anyway...

apache.py was doing something like the following:

    exec "import " + module_name
    module = eval(module_name)

The above code is horribly inefficient compared to the code I provided
(using __import__). You have two parse/compile passes at runtime. The
"exec" disables certain optimizations. I don't think the code allows it,
but if module_name happens to come from some user input, then you are
effectively executing arbitrary code. Very bad.

Python vs mod_python? Bah. I wouldn't have brought it up if it wasn't a
mod_python issue.

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python

From gstein at lyra.org  Thu May 25 17:57:13 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:45:53 2004
Subject: [mod_python] reload problem
Message-ID: <Pine.LNX.4.10.10005251746270.16846-100000@nebula.lyra.org>

[ I just subscribed, so I can't "reply" to the reload issue that I saw in
  the archive... starting from scratch ]

The reload issue might be caused by the global variables in mod_python.c.
Those values should be wiped when the configuration pool is tossed.
Specifically, a "cleanup" should be registered at the point that those
variables are allocated.

That might not truly be it, but globals are *always* suspect when dealing
with Apache modules.

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python

From gstein at lyra.org  Thu May 25 19:12:10 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:45:53 2004
Subject: [mod_python] quick code review
Message-ID: <Pine.LNX.4.10.10005251801100.16846-100000@nebula.lyra.org>

There are a number of issues that I see with mod_python.c. I'll try to
address a good number of them here, but I'm invariably going to miss some.
After some changes are made, then another pass can be done at that point.

Please try to take this constructively... the goal is to improve the
code... :-)

*) when storing the tstate into obcallback, use a PyCObject rather than an
   integer. That will avoid the (int) casting (a no-no)

*) noop is not needed; use ap_null_cleanup() (I think that's the name;
   close to it, at least)

*) simplify make_obcallback(): the two params are always NULL

*) I don't understand why the PyTypeObject's are init'd/copied in
   python_init, rather than just doing that at the module level. For
   example:
     static PyTypeObject serverobjecttype = { ... };

*) use PyImport_Import() rather than PyRun_SimpleString to get the
   module imported. This returns the "mod_python" or "mod_python.apache"
   module (I forget which; probably the former).

*) use PyObject_CallMethod() to call the "init" method in the module
   retrieved from above. Use the *return* value for obCallBack, rather
   than the SetCallback nastiness.

*) in python_directive, just use a cast to (py_dir_config *) rather than
   all the offset stuff. Also, there is no need to dup() the string since
   it is a constant.

*) unused: python_dict_merge, table2dict, print_table, print_array

*) exit(1) should not be used; use ap_log_rerror() and return failure
   codes to Apache

*) rather than storing the "request object" into r->notes, place it into
   tstate->dict. you won't have to do the atoi() stuff (which is Bad
   anyways)

*) use ap_log_rerror() instead of ap_log_error(). the former is better
   from a logging standpoint (it has more info)


That's all for now!

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/
_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python


From mmach at batory.org.pl  Fri May 26 15:45:24 2000
From: mmach at batory.org.pl (Micha³ Mach)
Date: Fri Jan  9 21:45:53 2004
Subject: [mod_python] apache.py suggestions
In-Reply-To: <Pine.LNX.4.10.10005260335290.21092-100000@nebula.lyra.org>
Message-ID: <NDBBIBMMILNGAOKOEEKDIECGCEAA.mmach@batory.org.pl>

> apache.py was doing something like the following:
>
>     exec "import " + module_name
>     module = eval(module_name)
>
> The above code is horribly inefficient compared to the code I provided
> (using __import__). You have two parse/compile passes at runtime. The
> "exec" disables certain optimizations. I don't think the code allows it,
> but if module_name happens to come from some user input, then you are
> effectively executing arbitrary code. Very bad.

Sorry, I realize now my question was stupid in fact - I assumed You're
talking about Python in general speaking about the __import__ thing. I
didn't watch see the mod_python code as carefully as You. ;-)

> Python vs mod_python? Bah. I wouldn't have brought it up if it wasn't a
> mod_python issue.

Well, the criticism was directed towards my own question, so don't take it
personally. ;-)

Best,
Michal

P.S. Perhaps I didn't mention it earlier, but I'm a happy man - noone will
tell me now that mod_perl rules. :-) One world, one language! (which means
Python, of course) :-)

---
Michal Mach   mmach@batory.org.pl
Stefan Batory Foundation
http://www.batory.org.pl/


From gstein at lyra.org  Fri May 26 08:21:34 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:45:53 2004
Subject: [mod_python] apache.py suggestions
In-Reply-To: <Pine.GSO.4.05.10005260802450.12724-100000@koi>
Message-ID: <Pine.LNX.4.10.10005260820440.23146-100000@nebula.lyra.org>

On Fri, 26 May 2000 grisha@verio.net wrote:
> On Fri, 26 May 2000, Greg Stein wrote:
> 
> > *) avoid exec/eval: they are quite slow, and can pose a security risk
> > *) to import modules, use: module = __import__(module_name)
> 
> The reasoning behind using exec to import was that __import__ doesn't
> understand dots (packages),

Eh? Sure it does.

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/


From grisha at ispol.com  Fri May 26 12:03:26 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:53 2004
Subject: [mod_python] apache.py suggestions
In-Reply-To: <Pine.LNX.4.10.10005260820440.23146-100000@nebula.lyra.org>
Message-ID: <Pine.LNX.4.21.0005261158110.27589-100000@saturn.ispol.com>

On Fri, 26 May 2000, Greg Stein wrote:

> > The reasoning behind using exec to import was that __import__ doesn't
> > understand dots (packages),
> 
> Eh? Sure it does.

Looks like it does indeed. I wonder why I put this comment in
(now obsolete) httpdapy:

                # we could use __import__ but it can't handle packages
                exec "import " + module_name

May be it's something new with 1.5 or 1.5.2? I'm almost tempted to compile
an old Python version, but I think I'll pass.... :-)

Grisha


From gstein at lyra.org  Fri May 26 09:12:23 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:45:53 2004
Subject: [mod_python] apache.py suggestions
In-Reply-To: <Pine.LNX.4.21.0005261158110.27589-100000@saturn.ispol.com>
Message-ID: <Pine.LNX.4.10.10005260909320.23146-100000@nebula.lyra.org>

On Fri, 26 May 2000, Gregory Trubetskoy wrote:
> On Fri, 26 May 2000, Greg Stein wrote:
> > > The reasoning behind using exec to import was that __import__ doesn't
> > > understand dots (packages),
> > 
> > Eh? Sure it does.
> 
> Looks like it does indeed. I wonder why I put this comment in
> (now obsolete) httpdapy:
> 
>                 # we could use __import__ but it can't handle packages
>                 exec "import " + module_name
> 
> May be it's something new with 1.5 or 1.5.2? I'm almost tempted to compile
> an old Python version, but I think I'll pass.... :-)

Yes, it is new to the Python 1.5 series. Before then, packages were only
possible if "ni" was imported. 1.5 built the logic directly into the core.

Due to the Interpreter/Thread State stuff in mod_python.c, you are
specific to Python 1.5 anyways, so relying on __import__ and packages
should be fine.

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/



From grisha at ispol.com  Fri May 26 13:13:59 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:53 2004
Subject: [mod_python] apache.py suggestions
In-Reply-To: <Pine.LNX.4.10.10005260909320.23146-100000@nebula.lyra.org>
Message-ID: <Pine.LNX.4.21.0005261303250.28220-100000@saturn.ispol.com>

OK, here is the deal - 

	exec "import " + module_name
	module = eval(module_name)

is not the same as module = __import__(module_name), but rather:

	module = __import__(module_name)
	list = string.split(module_name, ".")
	for n in list[1:]:
		module = getattr(module, n)

My quick tests on which is faster where inconclusive. The former is
less lines of code and is (IMHO) simpler to read, the latter is definitely
more secure since it doesn't have the exec or eval.

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Fri, 26 May 2000, Greg Stein wrote:

> On Fri, 26 May 2000, Gregory Trubetskoy wrote:
> > On Fri, 26 May 2000, Greg Stein wrote:
> > > > The reasoning behind using exec to import was that __import__ doesn't
> > > > understand dots (packages),
> > > 
> > > Eh? Sure it does.
> > 
k


From gstein at lyra.org  Fri May 26 10:37:22 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:45:53 2004
Subject: [mod_python] apache.py suggestions
In-Reply-To: <Pine.LNX.4.21.0005261303250.28220-100000@saturn.ispol.com>
Message-ID: <Pine.LNX.4.10.10005261024330.23146-200000@nebula.lyra.org>

On Fri, 26 May 2000, Gregory Trubetskoy wrote:
> OK, here is the deal - 
> 
> 	exec "import " + module_name
> 	module = eval(module_name)
> 
> is not the same as module = __import__(module_name), but rather:
> 
> 	module = __import__(module_name)
> 	list = string.split(module_name, ".")
> 	for n in list[1:]:
> 		module = getattr(module, n)
> 
> My quick tests on which is faster where inconclusive. The former is
> less lines of code and is (IMHO) simpler to read, the latter is definitely
> more secure since it doesn't have the exec or eval.

Mine were quite conclusive. The latter code is 4 to 6 times faster.

I've attached my timing script. Here is the output of a couple runs:

[gstein@kurgan python]$ ./time-eval.py
16.6380729675 2.65576100349 6.2648984399
22.0597770214 5.24019098282 4.20972767858
[gstein@kurgan python]$ ./time-eval.py
16.5899840593 2.59417903423 6.39508061719
21.954955101 5.28538203239 4.15390126323

Note that each run already loops through 10000 times, so the numbers above
should be quite stable.

Yes, I understand that the first import is longer than the following
imports. And that I'm not testing the cost of that first import. This is
intended: the underlying import mechanism which runs on that first import
is the same for both (e.g. the parse/load and module setup), so it can be
considered a constant factor and omitted.

Much of this may be moot anyhow since the "import" logic in question
occurs at startup only. But I don't think the use of exec/eval should ever
be encouraged :-) (performance and security)

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/
-------------- next part --------------
#!/usr/bin/env python

import time
import string

def do_timing(m):
  l = xrange(10000)

  t = time.time()
  for i in l:
    exec "import " + m
    mod = eval(m)
  t1 = time.time() - t

  t = time.time()
  for i in l:
    mod = __import__(m)
    for p in string.split(m, '.')[1:]:
      mod = getattr(mod, p)
  t2 = time.time() - t
  print t1, t2, t1/t2

do_timing('httplib')
do_timing('xml.dom.core')
From gstein at lyra.org  Fri May 26 10:49:44 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:45:53 2004
Subject: [mod_python] apache.py suggestions
In-Reply-To: <Pine.LNX.4.10.10005261024330.23146-200000@nebula.lyra.org>
Message-ID: <Pine.LNX.4.10.10005261048480.23146-100000@nebula.lyra.org>

On Fri, 26 May 2000, Greg Stein wrote:
>...
> Mine were quite conclusive. The latter code is 4 to 6 times faster.
>...
> Yes, I understand that the first import is longer than the following
> imports. And that I'm not testing the cost of that first import. This is
> intended: the underlying import mechanism which runs on that first import
> is the same for both (e.g. the parse/load and module setup), so it can be
> considered a constant factor and omitted.

Oops. One more note. I was accidentally charging that first import to the
exec/eval style. I moved that out, but it did not change the results at
all.

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/


From jbauer at rubic.com  Fri May 26 14:25:05 2000
From: jbauer at rubic.com (Jeff Bauer)
Date: Fri Jan  9 21:45:53 2004
Subject: [mod_python] quick code review
Message-ID: <392ECF91.78FD963D@rubic.com>

Many thanks to Greg for his code review and
suggestions.  The mod_python code will benefit
from Greg's experience, and the resulting product
should be easier to use and maintain.  The
earlier pyapache module had stability problems
that we shouldn't have to endure with mod_python.

-Jeff Bauer

From erno at iki.fi  Sat May 27 12:41:21 2000
From: erno at iki.fi (Erno Kuusela)
Date: Fri Jan  9 21:45:53 2004
Subject: [mod_python] quick code review
In-Reply-To: <392ECF91.78FD963D@rubic.com>; from jbauer@rubic.com on Fri, May 26, 2000 at 02:25:05PM -0500
References: <392ECF91.78FD963D@rubic.com>
Message-ID: <20000527124121.G20066@lib.hel.fi>

|                                        The
| earlier pyapache module had stability problems
| that we shouldn't have to endure with mod_python.

actually the predecessor to mod_python was httpdapy,
with which i haven't had any stability problems...

  -- erno

From jbauer at rubic.com  Sat May 27 07:10:49 2000
From: jbauer at rubic.com (Jeff Bauer)
Date: Fri Jan  9 21:45:53 2004
Subject: [mod_python] quick code review
 
Message-ID: <392FBB49.1D03D917@rubic.com>

JB>> earlier pyapache module had stability problems
JB>> that we shouldn't have to endure with mod_python.

EK> actually the predecessor to mod_python was httpdapy,
EK> with which i haven't had any stability problems...

I didn't mean to imply that pyapache was an earlier
version of mod_python, but rather that pyapache was the 
first experience of Python+Apache for many users.

-Jeff

From cobrien at Radix.Net  Sun May 28 10:29:51 2000
From: cobrien at Radix.Net (Cary O'Brien)
Date: Fri Jan  9 21:45:53 2004
Subject: [mod_python] Hi, database connection queston
Message-ID: <200005281429.KAA19075@saltmine.radix.net>

Hi,

Glad to hear about mod_python, it is almost exactly what I am looking for. 
I've used mod_perl/embperl and mod_dtcl, but I really wanted to try using
python.

I'm going to try to fire it up over the long weekend.

I've got a couple of questions (of course).

1) How are people handling persistant database connections?  Ideally (for me)
   there would be a single db connection for each apache process.  That 
   minimizes connection setup time (non-trivial for PostgreSQL at least),
   lets me control the number of database connections (apache max-servers), 
   and lets me control their lifetimes (i.e. serve 10,000 requests then exit),
   and restarts them if they die.  Nice eh?

   My question is how do I setup a shared database connection used by each
   handler?  It seems from the documentation that each request gets its own
   subinterpreter.  I'd like them all to be handled by the same sub-interpreter.
   Or, in reality, just share the same db connection.

   The python doc for Py_NewInterpreter() says

     the new interpreter has separate, independent versions of all imported modules, 

   So what happens to class variables.  Can I connect to the database there?

2) Re Zope.  There seems to be a ZPublisher interface.  Does this mean I can
   run 30 apache processes against the same Zope database?  How fine/course is
   the locking on the zope database?  I asked this on the zope list a while
   back and didn't get a good answer.

3) Does anyone have the bits to embed python calls in an html document a-la 
   embperl/php/mod_dtcl? I know mixing logic with presentation is 
   in general a bad idea, but having embedded code in documents is a fast
   way to get things up and running.
   
-- cary

Cary O'Brien
cobrien@radix.net



 





From jam at quark.emich.edu  Sun May 28 10:52:22 2000
From: jam at quark.emich.edu (Jeff)
Date: Fri Jan  9 21:45:53 2004
Subject: [mod_python] SUCCESS-- mod_python as DSO
Message-ID: <20000528105222.C25643@quark.emich.edu>

Greetings,

I'm happy to report that I was able to get Apache on a Red Hat 6.2 box
working while loading mod_python as a DSO. I took the advise of one of the
FAQ entries, and put the "LoadModule" directive up at the top (instead of
the bottom) of the list in httpd.conf, and it worked just fine (previously I
would get a core dump from Apache).

My question is: why is this necessary? Does this reflect a bug in Apache or
is it some other issue?

Regards,
J
-- 
|| visit gfd <http://quark.emich.edu/>
|| psa member -- <http://www.python.org/psa/> 

From walter at bnbt.de  Sun May 28 17:58:40 2000
From: walter at bnbt.de (Walter =?iso-8859-1?Q?D=F6rwald?=)
Date: Fri Jan  9 21:45:53 2004
Subject: [mod_python] Hi, database connection queston
In-Reply-To: <200005281429.KAA19075@saltmine.radix.net>
Message-ID: <4.3.1.0.20000528175049.00ae2ab0@mail.bnbt.de>

At 16:29 28.05.00, Cary O'Brien wrote:

>[...]
>
>3) Does anyone have the bits to embed python calls in an html document a-la
>    embperl/php/mod_dtcl?

You might want to try XIST available from
ftp://titan.bnbt.de/pub/livinglogic/xist/

It needs a little additional logic to wire the HTML files to the
mod_python RequestHandler, but this shouldn't be a big deal.

>  I know mixing logic with presentation is
>    in general a bad idea, [...]

Well XIST helps you with that too.

Bye,
         Walter D?rwald


From jam at quark.emich.edu  Sun May 28 13:53:01 2000
From: jam at quark.emich.edu (Jeff)
Date: Fri Jan  9 21:45:53 2004
Subject: [mod_python] trouble with mod_python from public_html directory
Message-ID: <20000528135301.B28853@quark.emich.edu>

Greetings,

I'm having difficulty figuring out this problem, and I'm hoping someone will
be able to help get it resolved. I'm not sure if this is a problem with
mod_rewrite or mod_python or my configuration of them.

I have the following .htaccess file in /home/jam/public_html:
[~/public_html] [1:35pm] [jam@toast-pts/2] % cat .htaccess 
AddHandler python-program .py
PythonHandler cgihandler
RewriteEngine on
RewriteCond %{REQUEST_FILENAME} !-s
RewriteRule ^(.*)\.html$          $1.py   [L]

The intent of the rewrite rule is if the URL requests a file ending in
.html, it will check first to see if that file exists (and send it as normal
if it does), and if a suitable file does *not* exist, check for a .py
extension and run that via mod_python if it does.

The above set of directives works *fine* if I install it in
/home/httpd/html.. I can request 'index.html' and it will run the 'index.py'
module I've created.

The problem starts when I copy the .htaccess file to my home directory, and
try to get the same thing to work. it doesn't. I get the following error in
the /var/log/httpd/error_log file: [Sun May 28 13:36:02 2000] [error]
[client 192.168.2.3] File does not exist:
/home/httpd/html/home/jam/public_html/index.py

This indicates the reason for the error-- it's looking for a file called
"/home/httpd/html/home/jam/public_html/index.py", which clearly doesn't
exist (it should instead be "/home/jam/public_html/index.py").

This error occurs regardless of the existence of a .htaccess file in
/home/httpd/html-- I had thought that might be part of the problem, so at
first I added a "PythonInterpPerDirectory" directive, and then renamed the
file so it wouldn't be used, and tried again-- no luck.

I'm not sure if I need to present more information before this problem can
be solved.. please let me know if I can answer any questions about the setup
that might point me in the right direction.

Thanks in advance ;)

Regards,
J
-- 
|| visit gfd <http://quark.emich.edu/>
|| psa member -- <http://www.python.org/psa/> 

From richard at whitequeen.com  Sun May 28 11:01:05 2000
From: richard at whitequeen.com (richard offer)
Date: Fri Jan  9 21:45:53 2004
Subject: [mod_python] Apache fails to start: ImportError: No module named mod_python.apache
Message-ID: <200005281801.e4SI15p04688@erij.whitequeen.com>

Hi,

Apache is failing to start when I have mod_python as a DSO on RH 6.1.

The report from the apache error log is

Traceback (innermost last):
  File "<string>", line 1, in ?
ImportError: No module named mod_python.apache
PythonInitFunction: could not import mod_python.apache.


I've rebuilt python to live under the same top level directory as Apache
(/usr/www/).

[root@erij bin]# ls /usr/www/lib/python1.5/site-packages/mod_python/
__init__.py   apache.py   cgihandler.py   httpdapi.py   zhandler.py
__init__.pyc  apache.pyc  cgihandler.pyc  httpdapi.pyc  zhandler.pyc

[root@erij bin]# ls /usr/www/libexec/
httpd.exp         mod_autoindex.so  mod_include.so      mod_rewrite.so
libproxy.so       mod_cern_meta.so  mod_info.so         mod_setenvif.so
mod_access.so     mod_cgi.so        mod_log_agent.so    mod_speling.so
mod_actions.so    mod_digest.so     mod_log_config.so   mod_status.so
mod_alias.so      mod_dir.so        mod_log_referer.so  mod_unique_id.so
mod_asis.so       mod_env.so        mod_mime.so         mod_userdir.so
mod_auth.so       mod_example.so    mod_mime_magic.so   mod_usertrack.so
mod_auth_anon.so  mod_expires.so    mod_mmap_static.so  mod_vhost_alias.so
mod_auth_db.so    mod_headers.so    mod_negotiation.so
mod_auth_dbm.so   mod_imap.so       mod_python.so

[root@erij bin]# ldd /usr/www/libexec/mod_python.so 
        libpthread.so.0 => /lib/libpthread.so.0 (0x400a9000)
        libc.so.6 => /lib/libc.so.6 (0x400bb000)
        /lib/ld-linux.so.2 => /lib/ld-linux.so.2 (0x80000000)


[root@erij bin]# /usr/www/bin/python
Python 1.5.2 (#1, May 28 2000, 08:30:59)  [GCC egcs-2.91.66 19990314/Linux (egcs- on linux2
Copyright 1991-1995 Stichting Mathematisch Centrum, Amsterdam
>>> import mod_python
>>> from mod_python import apache
Traceback (innermost last):
  File "<stdin>", line 1, in ?
  File "/usr/www/lib/python1.5/site-packages/mod_python/apache.py", line 18, in ?
    import _apache
ImportError: No module named _apache

[ I don't expect this last one to work, but its at least picking up the
right module ]



Can someone hit me with a clue stick.




richard.


-----------------------------------------------------------------------
richard offer @ home 
_______________________________http://www.whitequeen.com/users/richard/


From grisha at ispol.com  Sun May 28 14:06:26 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:53 2004
Subject: [mod_python] Hi, database connection queston
In-Reply-To: <200005281429.KAA19075@saltmine.radix.net>
Message-ID: <Pine.LNX.4.21.0005281353050.14870-100000@saturn.ispol.com>

On Sun, 28 May 2000, Cary O'Brien wrote:

> 1) How are people handling persistant database connections?
[....]
>    It seems from the documentation that each request gets its own
>    subinterpreter.

Incorrect. Each directive directory and its subdirectories get its own
subinterpreter. All requests for files in the directory where the
Python*Handler directive was first encountered and its subdirectories are
in the same subinterpreter.

This behaviour can be altered via PythonInterpreter or
PythonInterPerDirectory directives.

As far as database connections - here how I used to do it. I had a module
called data.py (this is not the entire code, some parts are cut out, think
of it as an example rather than something ready to use. cfg contained
configuration). In your scripts, you would have something like:

import data
result = data._run_sql("select * from myteable")

And it would behave exactly as you describe - initiate the db connection
once and keep it for as long as the process lives. Of course, you end up
having as many connections as there are Apache processes, which you can
control by MaxClients directive.

-------------

import cfg
import mysqldb
import string

def _db_login(relogin = 0):
    """Login to the database
    """

    global DB_CONN

    if relogin:
        DB_CONN = mysqldb.mysqldb(cfg.DB_LOGIN)
        return DB_CONN
    else:
        try:
            return DB_CONN

        except NameError:

            DB_CONN = mysqldb.mysqldb(cfg.DB_LOGIN)
            return DB_CONN

def _run_sql( sql, n = 0, with_desc=0 ):
    """ Runs SQL on the server and returns result
    """

    db = _db_login()

    try:
        cur = db.cursor()
        rc = cur.execute(sql)

    except:
        # it's possible that mysql connection
        # timed out. Try one more time.
        db = _db_login(relogin = 1)
        cur = db.cursor()
        rc = cur.execute(sql)

    if string.upper(string.split(sql)[0]) in \
       ("SELECT", "SHOW", "DESC", "DESCRIBE"):
        if n:
            recset = cur.fetchmany(n)
        else:
            recset = cur.fetchall()

        if with_desc:
            return recset, cur.description
        else:
            return recset
    else:
        return rc

------------------

> 2) Re Zope.  There seems to be a ZPublisher interface.  Does this mean I can
>    run 30 apache processes against the same Zope database?  

As I already said on comp.lang.python - no.

>    How fine/course is
>    the locking on the zope database?  I asked this on the zope list a while
>    back and didn't get a good answer.

The first process will lock the database, and all the other ones will just
sit there and wait :-(

> 3) Does anyone have the bits to embed python calls in an html document a-la 
>    embperl/php/mod_dtcl? I know mixing logic with presentation is 
>    in general a bad idea, but having embedded code in documents is a fast
>    way to get things up and running.

You can use the Z DocuemntTemplate with ZHandler, it works pretty well.

HTH,

Grisha


From grisha at ispol.com  Sun May 28 14:10:32 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:53 2004
Subject: [mod_python] SUCCESS-- mod_python as DSO
In-Reply-To: <20000528105222.C25643@quark.emich.edu>
Message-ID: <Pine.LNX.4.21.0005281408570.14870-100000@saturn.ispol.com>

Could you send a list of all LoadModules you had and the sequence that
works and the one that doesn't?


On Sun, 28 May 2000, Jeff wrote:

> I took the advise of one of the
> FAQ entries, and put the "LoadModule" directive up at the top (instead of
> the bottom) of the list in httpd.conf, and it worked just fine (previously I
> would get a core dump from Apache).


From grisha at ispol.com  Sun May 28 14:20:30 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:53 2004
Subject: [mod_python] Apache fails to start: ImportError: No module named
 mod_python.apache
In-Reply-To: <200005281801.e4SI15p04688@erij.whitequeen.com>
Message-ID: <Pine.LNX.4.21.0005281418440.14870-100000@saturn.ispol.com>

Did you rebuild mod_python after rebuilding Python and made sure that it
is linked against the new libpython library? I have a feeling mod_python
is still looking in /usr/local

Grisha

On Sun, 28 May 2000, richard offer wrote:

> 
> Hi,
> 
> Apache is failing to start when I have mod_python as a DSO on RH 6.1.
> 
> The report from the apache error log is
> 
> Traceback (innermost last):
>   File "<string>", line 1, in ?
> ImportError: No module named mod_python.apache
> PythonInitFunction: could not import mod_python.apache.
> 
> 
> I've rebuilt python to live under the same top level directory as Apache
> (/usr/www/).


From jam at quark.emich.edu  Sun May 28 14:40:34 2000
From: jam at quark.emich.edu (Jeff)
Date: Fri Jan  9 21:45:53 2004
Subject: [mod_python] trouble with mod_python from public_html directory
In-Reply-To: <Pine.LNX.4.21.0005281413050.14870-100000@saturn.ispol.com>; from grisha@ispol.com on Sun, May 28, 2000 at 02:15:01PM -0400
References: <20000528135301.B28853@quark.emich.edu> <Pine.LNX.4.21.0005281413050.14870-100000@saturn.ispol.com>
Message-ID: <20000528144034.D28853@quark.emich.edu>

On Sun, May 28, 2000 at 02:15:01PM -0400, Gregory Trubetskoy wrote:
> 
> Try replacing "AddHandler python-program .py" with "AddHandler cgi-script
> .py" and see if you get the same errors. 
> 
> This will tell you whether this is at all related to mod_python. I suspect
> it isn't - the "File not found" is not a mod_python error.
> 

You were correct.. this had nothing to do with mod_python, but rather
something odd with mod_rewrite. When I added a 'RewriteBase /~jam/'
directive to the .htaccess file in my public_html, things started working as
designed. This directive is not necessary in directories off of
/home/httpd/html, though. This isn't the generic solution I was expecting,
but it works, so I'm going to move on.

Thanks for the help.

Regards,
J
-- 
|| visit gfd <http://quark.emich.edu/>
|| psa member -- <http://www.python.org/psa/> 

From danilo at telusplanet.net  Sun May 28 18:54:02 2000
From: danilo at telusplanet.net (Danilo Fiorenzano)
Date: Fri Jan  9 21:45:53 2004
Subject: [mod_python] Hi, database connection queston
In-Reply-To: Gregory Trubetskoy's message of "Sun, 28 May 2000 14:06:26 -0400 (EDT)"
References: <Pine.LNX.4.21.0005281353050.14870-100000@saturn.ispol.com>
Message-ID: <m31z2mnplh.fsf@spike.interalta.com>

On Sun, 28 May 2000, Cary O'Brien wrote:
 
> 1) How are people handling persistant database connections?
> [....]
>    It seems from the documentation that each request gets its own
>    subinterpreter.

Since global vars retain their values between requests serviced by the
same httpd process, I ended up doing something like this:

---------------- cut ---------------- cut ---------------- cut ----------------
import informixdb
import os, re, cgi, string
from mod_python import apache

_dbconn = None

def handler(req):
    global _dbconn

    ... etc etc ...
    results = findProducts('acid')
    ... etc etc ...


def findProducts(substring):
    global _dbconn

    if _dbconn == None:
        try:
            _dbconn = informixdb.informixdb('db@server', 'user', 'password')
        except:
            return ['Access Denied']

    c = _dbconn.cursor()
    blah = "%" + string.lower(substring) + "%"

    c.execute("select strshippingname from tblproducts where lower(strshippingname) like ?", (blah,))
    retval = []
    for row in c.fetchall():
        retval.append(row[0])

    return retval

---------------- cut ---------------- cut ---------------- cut ----------------

  This works exactly as you want, although it should also have a "try:
except:" block around the actual query, to recover from dropped
connections et similia.  Otherwise, normally the connection is
established only when a freshly-spawned httpd executes a query for the
first time, and should persist until it reaches 'MaxRequestsPerChild"
in httpd.conf - then the httpd instance is terminated and the
connection is closed automatically.

 I have been wondering how one could automatically preload a Python
module upon start of a new httpd, so users would not have to endure
the occasional delay due to the opening of a new connection to the
database.  I suspect it may be possible by using some apache
directives, but I haven't really looked into it yet :)

-- Shade

From grisha at ispol.com  Sun May 28 22:22:13 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:53 2004
Subject: [mod_python] Hi, database connection queston
In-Reply-To: <m31z2mnplh.fsf@spike.interalta.com>
Message-ID: <Pine.LNX.4.21.0005282218240.16648-100000@saturn.ispol.com>

On 28 May 2000, Danilo Fiorenzano wrote:

>  I have been wondering how one could automatically preload a Python
> module upon start of a new httpd, so users would not have to endure
> the occasional delay due to the opening of a new connection to the
> database.  I suspect it may be possible by using some apache
> directives, but I haven't really looked into it yet :)

Such directive does not exist just yet, but it is planned for the future.

Grisha


From grisha at ispol.com  Mon May 29 11:44:15 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:53 2004
Subject: [mod_python] quick code review
In-Reply-To: <Pine.LNX.4.10.10005251801100.16846-100000@nebula.lyra.org>
Message-ID: <Pine.LNX.4.21.0005291123250.18967-100000@saturn.ispol.com>

On Thu, 25 May 2000, Greg Stein wrote:

> *) rather than storing the "request object" into r->notes, place it into
>    tstate->dict. you won't have to do the atoi() stuff (which is Bad
>    anyways)

This won't work. Or rather it will, but it's getting too complex to be
worth it. 

The problem is that a single request can span multiple thread states - a
typical scenario is when there is a PythonAuthenHandler directive
somewhere in a parent directory and a PythonHandler directive in a
subdirectory. The two handlers will be executed in different
subinterpreters, thereofre having different tstates and result in two
separate requestobjects being instantiated. 

So you get the malloc penalty plus the complexity of dealing with the
tstate->dict dictionary (which too will need to be created, another
malloc) for not much of a practical gain other than proper code, which,
btw, becomes kind of arcane and hard to understand (a bad thing as well).

It seems to me that I am working around what is really an Apache
limitation. The request_rec is clearly the right place to store a pointer
to a requestobject for that request_rec, the limitation is that the place
alloted for these sorts of things (r->notes) only deals with strings.

I think there needs to be something similar to r->notes that can take a
pointer. For now, I think I'm going to revert to the atoi stuff...

Grisha


From grisha at ispol.com  Mon May 29 13:13:51 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:53 2004
Subject: [mod_python] mod_python 2.1
Message-ID: <Pine.LNX.4.21.0005291305150.19547-100000@saturn.ispol.com>

Is available for download. Functionally, it should be equivalent to 2.0
(i.e. no new features), internally, a lot of changes were made mostly
resulting in cleaner code, better performance and security, as well as
(eventually) stability ("eventually" because stability is something that
I'd rather not brag about after having made so many changes). BIG THANKS
to Greg Stein for taking the time to review the code and comments.

Enjoy!

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com



From gstein at lyra.org  Mon May 29 12:36:10 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:45:54 2004
Subject: [mod_python] quick code review
In-Reply-To: <Pine.LNX.4.21.0005291123250.18967-100000@saturn.ispol.com>
Message-ID: <Pine.LNX.4.10.10005291225280.14857-100000@nebula.lyra.org>

On Mon, 29 May 2000, Gregory Trubetskoy wrote:
> On Thu, 25 May 2000, Greg Stein wrote:
> 
> > *) rather than storing the "request object" into r->notes, place it into
> >    tstate->dict. you won't have to do the atoi() stuff (which is Bad
> >    anyways)
> 
> This won't work. Or rather it will, but it's getting too complex to be
> worth it. 
> 
> The problem is that a single request can span multiple thread states - a
> typical scenario is when there is a PythonAuthenHandler directive
> somewhere in a parent directory and a PythonHandler directive in a
> subdirectory. The two handlers will be executed in different
> subinterpreters, thereofre having different tstates and result in two
> separate requestobjects being instantiated. 

All right. Fair enough.

Apache will use a single thread, but the multiple interpreters is a good
point (that I hadn't seen).

>...
> It seems to me that I am working around what is really an Apache
> limitation. The request_rec is clearly the right place to store a pointer
> to a requestobject for that request_rec, the limitation is that the place
> alloted for these sorts of things (r->notes) only deals with strings.

True.

> I think there needs to be something similar to r->notes that can take a
> pointer. For now, I think I'm going to revert to the atoi stuff...

At least use atol(). Still far from portable, but better.

(in the "ascii" scheme, the "best" would be to use PyLong_FromVoidPtr(),
 then convert that long to a string; reverse that sequence for the other
 direction)

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/


From gstein at lyra.org  Mon May 29 12:43:49 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:45:54 2004
Subject: [mod_python] quick code review
In-Reply-To: <Pine.LNX.4.21.0005281654430.15397-100000@saturn.ispol.com>
Message-ID: <Pine.LNX.4.10.10005291242580.14857-100000@nebula.lyra.org>

On Sun, 28 May 2000, Gregory Trubetskoy wrote:
> On Thu, 25 May 2000, Greg Stein wrote:
> > *) exit(1) should not be used; use ap_log_rerror() and return failure
> >    codes to Apache
> 
> are you sure?
> 
> the module initializer is a void *, its return doesn't seem to be checked
> at all.

I was referring more to the make_obcallback() function.

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/


From grisha at ispol.com  Mon May 29 20:42:33 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:54 2004
Subject: [mod_python] quick code review
In-Reply-To: <Pine.LNX.4.10.10005291242580.14857-100000@nebula.lyra.org>
Message-ID: <Pine.LNX.4.21.0005292040440.21046-100000@saturn.ispol.com>

On Mon, 29 May 2000, Greg Stein wrote:

> I was referring more to the make_obcallback() function.

Rats - I didn't it even see it there! Will fix in 2.2.

Grisha


From grisha at ispol.com  Mon May 29 20:55:32 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:54 2004
Subject: [mod_python] SUCCESS-- mod_python as DSO
In-Reply-To: <20000529104801.B29367@quark.emich.edu>
Message-ID: <Pine.LNX.4.21.0005292044500.21046-100000@saturn.ispol.com>

Curious.... I do most of my development and testing on FreeBSD 4.0 and
occasional testing on a Debian Linux (Potato) and a Sun Sparc (Sol 2.7).
On one FreeBSD system I have a very similar ClearModuleList set up (the
default FreeBSD Apache port install). I have LoadModule python_module dead
last and it works great...

I guess I'm going to have to install Red Hat somewhere, since it seems to
be the most popular thing out there....

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com~

On Mon, 29 May 2000, Jeff wrote:

> On Sun, May 28, 2000 at 02:10:32PM -0400, Gregory Trubetskoy wrote:
> > 
> > Could you send a list of all LoadModules you had and the sequence that
> > works and the one that doesn't?
> > 
> 
> The following sequence works. This list is a piece of the most stripped down
> config I could make and still have a useful webserver. It could probably be
> trimmed even more.
> 
> LoadModule python_module      modules/mod_python.so
> LoadModule env_module         modules/mod_env.so
> LoadModule config_log_module  modules/mod_log_config.so
> LoadModule agent_log_module   modules/mod_log_agent.so
> LoadModule referer_log_module modules/mod_log_referer.so
> LoadModule mime_module        modules/mod_mime.so
> LoadModule negotiation_module modules/mod_negotiation.so
> LoadModule status_module      modules/mod_status.so
> LoadModule autoindex_module   modules/mod_autoindex.so
> LoadModule dir_module         modules/mod_dir.so
> LoadModule userdir_module     modules/mod_userdir.so
> LoadModule alias_module       modules/mod_alias.so
> LoadModule rewrite_module     modules/mod_rewrite.so
> LoadModule access_module      modules/mod_access.so
> LoadModule setenvif_module    modules/mod_setenvif.so
> 
> ClearModuleList
> AddModule mod_env.c
> AddModule mod_log_config.c
> AddModule mod_log_agent.c
> AddModule mod_log_referer.c
> AddModule mod_mime.c
> AddModule mod_negotiation.c
> AddModule mod_status.c
> AddModule mod_autoindex.c
> AddModule mod_dir.c
> AddModule mod_userdir.c
> AddModule mod_alias.c
> AddModule mod_rewrite.c
> AddModule mod_access.c
> AddModule mod_so.c
> AddModule mod_setenvif.c
> AddModule mod_python.c
> 
> If I change the list so that mod_python is loaded *last* (or, apparently,
> anything other than first), Apache will core dump. I haven't tried changing
> the sequence of the 'AddModule' directives to see if it changes the
> situation. Please let me know if that would be a useful test, or if there
> are any more questions or concerns.
> 
> Regards,
> J
> -- 
> || visit gfd <http://quark.emich.edu/>
> || psa member -- <http://www.python.org/psa/> 
> 


From aiglauer at yahoo.com  Wed May 31 05:38:17 2000
From: aiglauer at yahoo.com (Alexis Iglauer)
Date: Fri Jan  9 21:45:54 2004
Subject: [mod_python] Python as a DSO problems
Message-ID: <20000531123817.9586.qmail@web2205.mail.yahoo.com>

I have had exactly the same problem in Mandrake 6.0
and Mandrake 7.0 - core dump if mod_python is at the
bottom of the list, works at the top.

I had another problem in MDK 7.0 - I had to install
the files from the mod_packages/ dir into
/usr/lib/python-1.5/site-packages - it did not work in
a mod_python subirectory off that folder.  Could just
have been an effect of a late night too though.

aei

__________________________________________________
Do You Yahoo!?
Send instant messages & get email alerts with Yahoo! Messenger.
http://im.yahoo.com/

From aiglauer at yahoo.com  Wed May 31 05:43:03 2000
From: aiglauer at yahoo.com (Alexis Iglauer)
Date: Fri Jan  9 21:45:54 2004
Subject: [mod_python] Modules not reloading when changed
Message-ID: <20000531124303.145.qmail@web2206.mail.yahoo.com>

I am developing a CGI app using the cgihandler.  There
are several different pages, each with their own .py
file and there is one .py file (SLobj.py) which is
imported by nearly all these individual files, but is
never used by apache directly.  The problem I have is
that the website runs old code - I can see from the
debug logs that it is running old code from SLobj.py
which I have already changed.

Is there a way to force mod_python to reload the .py
modules?  I am not using PythonNoReload.

Thanks
aei

__________________________________________________
Do You Yahoo!?
Send instant messages & get email alerts with Yahoo! Messenger.
http://im.yahoo.com/

From grisha at ispol.com  Wed May 31 09:17:51 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:54 2004
Subject: [mod_python] Modules not reloading when changed
In-Reply-To: <20000531124303.145.qmail@web2206.mail.yahoo.com>
Message-ID: <Pine.LNX.4.21.0005310856020.28492-100000@saturn.ispol.com>


On Wed, 31 May 2000, Alexis Iglauer wrote:

> Is there a way to force mod_python to reload the .py
> modules?  I am not using PythonNoReload.

Unfortunately, mod_python has no way of controlling what modules your
scripts will be importing and making them reload.

There are a few ways to force a reload of modules that have changed and
are imported "indirectly":

1. The obvious - restart the server. 

2. The not so obvious - invoke the module that needs reloading directly
via a URL.  This will produce an error, but will force the module to
reload. This doesn't work too well when the module is not in one of the
WWW accessible directories because you will get a "File not found".

Another catch with this approach is that you will have to do this as many
times as there are apache server processes currently running.

3. Recommended approach. Create a debug flag in your scripts and do a
reload when it is on:

DEBUG = 1

import mymodulea
import mymoduleb
import string
import cgi

if DEBUG:
	mymodulea = reload(mymodulea)
	mymoduleb = reload(mymoduleb)

When you're done debugging, you set DEBUG to 0 or None.

HTH,

Grisha


From grisha at ispol.com  Thu May 11 18:04:09 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:51:56 2004
Subject: [mod_python] This is just a test
Message-ID: <Pine.LNX.4.21.0005111803520.9333-100000@saturn.ispol.com>

Hello there!

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com


From peter at wl.vg  Sat May 13 20:25:53 2000
From: peter at wl.vg (Peter Halliday)
Date: Fri Jan  9 21:51:56 2004
Subject: [mod_python] use rpms, no src directory for apache
Message-ID: <391DF291.4BB5F774@wl.vg>

I am a developer that does a lot of online applications.  I am
interested in switching to python, because of its OOP and scalibility.
I am very impressed with python.  However, the problem is that I don't
have a src/modules directory.  I am runnign Red Hat 6.1 and installed
apache with their rpms.  Can you please help me.

<!--
Peter Halliday                            |   peter@whetstonelogic.com
Online Application Developer  |   IM   ScreenName: hoaggelos
Whetstone Logic, Inc.              |
-->


From jam at quark.emich.edu  Sun May 14 20:52:44 2000
From: jam at quark.emich.edu (Jeff)
Date: Fri Jan  9 21:51:56 2004
Subject: [mod_python] configuration of mod_python as DSO
Message-ID: <20000514205244.D11083@quark.emich.edu>

greetings,

I've done some preliminary work on a RedHat 6.2 box to get mod_python to
compile as a DSO module, and I've so far had limited success-- I'd rather
not have to rebuild apache from sources to get this functionality.

to start, I built the .so with the following command:

% /usr/sbin/apxs -Wl,-export-dynamic -L/usr/lib/python1.5/config \
-I/usr/include/python1.5/ -I/usr/include/apache -c mod_python.c -lpython1.5 \
-lpthread

I then copied the resulting .so module to /usr/lib/apache:
% sudo cp mod_python.so /usr/lib/apache

I then added these lines to the /etc/httpd/conf/httpd.conf file:
LoadModule python_module        modules/mod_python.so
AddModule mod_python.c

The 'LoadModule' directive was inserted in the group of 'LoadModule' lines that
were already in the file, and the same with AddModule. I just put them at
the end of their respective lists.

Since the machine I'm installing this on is not production, I made a
.htaccess file in /home/httpd/html containing the following:
-- begin .htaccess --
AddHandler python-program .py
PythonDebug
PythonHandler test
-- end .htacess --

My 'test.py' file contains the following:
-- begin test.py --
from mod_python import apache

def handler(req):
  req.send_http_header()
  req.write("Hello World!")
  return apache.OK
-- end test.py --

I then restarted apache:
[~] [8:21pm] [jam@toast-pts/2] % /etc/rc.d/init.d/httpd status
httpd dead but subsys locked
[~] [8:21pm] [jam@toast-pts/2] % sudo /etc/rc.d/init.d/httpd restart
Password:
Shutting down http:                                        [FAILED]
Starting httpd:                                            [  OK  ]
[~] [8:21pm] [jam@toast-pts/2] % /etc/rc.d/init.d/httpd status
httpd dead but subsys locked

any clues as to where I might have gone wrong?

regards,
J
-- 
|| visit gfd <http://quark.emich.edu/>
|| psa member -- <http://www.python.org/psa/> 

From echuck at mindspring.com  Tue May 16 07:52:19 2000
From: echuck at mindspring.com (Chuck Esterbrook)
Date: Fri Jan  9 21:51:56 2004
Subject: [mod_python] Handlers
Message-ID: <39213673.4F54B5B9@mindspring.com>

Hi, I noticed that you have 3 out-of-the-box handlers including one for ZPublisher. I was wondering if you would be interested in providing a handler for Webware for Python?

We already have 2 handlers, one for CGI and another for FastCGI. Actually, there is also a 3rd for AOLserver provided by the AOLserver time which, like you, packages ready-made handlers (we call them adaptors).

The URL is below in my .sig.  :-)

-Chuck
____________________________________________________________

http://webware.sourceforge.net

From grisha at ispol.com  Tue May 16 08:04:07 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:51:56 2004
Subject: [mod_python] Handlers
In-Reply-To: <39213673.4F54B5B9@mindspring.com>
Message-ID: <Pine.LNX.4.21.0005160758040.3709-100000@saturn.ispol.com>

On Tue, 16 May 2000, Chuck Esterbrook wrote:

> 
> Hi, I noticed that you have 3 out-of-the-box handlers including one
> for ZPublisher. I was wondering if you would be interested in
> providing a handler for Webware for Python?

"providing" as in "writing"? Probably not, there is enough things to do
with mod_python (like DSO) that I'd rather not get distracted on
handlers...

(What is webware, BTW? I couldn't gather from the website what it is and
didn't feel like downloading it right now.)

My vision for mod_python is that of a very simple piece of software, in
fact I'm not even sure that the three handlers that come with it *should*
be part of the package...

BUT, you and everyone else are more than welcome to contribute, we could
create a section on the website for additional handlers.

> We already have 2 handlers, one for CGI and another for FastCGI.

When you say "handler" do you mean it is a mod_python handler, or some
other handler?

Grisha


From grisha at ispol.com  Tue May 16 22:12:54 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:51:56 2004
Subject: [mod_python] DSO
In-Reply-To: <20000515210702.A19290@yetix.sz-sb.de>
Message-ID: <Pine.LNX.4.21.0005162200180.20825-100000@saturn.ispol.com>

I just tried mod_python as a dso on 

Linux 2.2.14 (Debian [potato])
gcc 2.9.52
libc6
python 1.5.2 with and without threads
apache-3.1.12

and it seems to work OK, at least the test.py does.

I used 

apxs -I /usr/local/include/python1.5 -c mod_python.c \
     /usr/local/lib/python1.5/config/libpython1.5.a  \
     -lpthead

to compile the module.

On another Linux system it compiles, but Apache complains upon loading the
module that "python_module is garbled", although I think that's a libc/gcc
incompatibility problem of some sort.

On FreeBSD 4.0 STABLE apxs doesn't work at all - it gives gcc arguments
that are not allowed....

It'd be interesting to see what experiences other people have with this?

Grisha


On Mon, 15 May 2000, Andreas Jung wrote:

> 
> hehe...try to get DSO working because I dislike recompiling
> Apache for every new module :)
> 
> Andreas
>  
> 


From ralf at silicon.org  Thu May 18 13:32:38 2000
From: ralf at silicon.org (Ralf Canis)
Date: Fri Jan  9 21:51:56 2004
Subject: [mod_python] problem using regular expressions in CGI scripts
Message-ID: <20000518133238.A6940@silicon.org>

Hello,

I've just installed mod_python and have a problem with CGI scripts
using regular expressions.

apache 1.3.6
python 1.52
mod_python 1.9a

httpd.conf contains:
AddHandler python-program .py
PythonHandler cgihandler

--- snip ---
import re, sys, traceback

print 'Content-type: text/plain'
print

sys.stderr = sys.stdout

try:
  re.compile( r'foo(\(.+\))bar' )
  print 'ok'
except:
  print '\n\n'
  traceback.print_exc()
  print '\n'
--- snip ---

Opening this page in a browser and pressing refresh several times
results in the following error, one at a time. Sometimes it works :)
I've already reinstalled python and mod_python. BTW, same problem
when using PyApache!

BUT: Loading the Python interpreter as a standard CGI program always works.

Traceback (innermost last):
  File "/home/httpd/sites/ralf/test/re_err.py", line 9, in ?
    re.compile( r'foo(\(.+\))bar' )
  File "/var/tmp/python/python-root/usr/lib/python1.5/re.py", line 79, in compile
    code=pcre_compile(pattern, flags, groupindex)
pcre.error: ('back reference to non-existent subpattern', 4149)

or

Traceback (innermost last):
  File "/home/httpd/sites/ralf/test/re_err.py", line 9, in ?
    re.compile( r'foo(\(.+\))bar' )
  File "/var/tmp/python/python-root/usr/lib/python1.5/re.py", line 79, in compile
    code=pcre_compile(pattern, flags, groupindex)
pcre.error: ('\\ at end of pattern', 1886)

or

Traceback (innermost last):
  File "/home/httpd/sites/ralf/test/re_err.py", line 9, in ?
    re.compile( r'foo(\(.+\))bar' )                     
  File "/var/tmp/python/python-root/usr/lib/python1.5/re.py", line 79, in compile
    code=pcre_compile(pattern, flags, groupindex)
pcre.error: ('unmatched parentheses', 10)

or

Traceback (innermost last):
  File "/home/httpd/sites/ralf/test/re_err.py", line 9, in ?
    re.compile( r'foo(\(.+\))bar' )                     
  File "/var/tmp/python/python-root/usr/lib/python1.5/re.py", line 79, in compile
    code=pcre_compile(pattern, flags, groupindex)
pcre.error: ('regular expression too large', 0)

or

Traceback (innermost last):
  File "/home/httpd/sites/ralf/test/re_err.py", line 9, in ?
    re.compile( r'foo(\(.+\))bar' )
  File "/var/tmp/python/python-root/usr/lib/python1.5/re.py", line 79, in compile
    code=pcre_compile(pattern, flags, groupindex)
pcre.error: ('missing )', 113)


Did I miss something or is this a nasty bug? It's ugly, because MySQLdb
doesn't work because of it.

Sincerely
  Ralf

-- 
Ralf Canis            ralf@silicon.org
Germany               canis@bigfoot.com

From ralf at silicon.org  Thu May 18 14:59:53 2000
From: ralf at silicon.org (Ralf Canis)
Date: Fri Jan  9 21:51:56 2004
Subject: [mod_python] problem using regular expressions in CGI scripts
In-Reply-To: <20000518143946.O3437@lib.hel.fi>; from erno@iki.fi on Thu, May 18, 2000 at 02:39:46PM +0300
References: <20000518133238.A6940@silicon.org> <20000518143946.O3437@lib.hel.fi>
Message-ID: <20000518145953.A7140@silicon.org>

On Thu, May 18, 2000 at 02:39:46PM +0300, Erno Kuusela wrote:

Hello Erno,

> i haven't even installed mod_python yet, but a debugging idea
> came to mind...
> 
> if you compile your regular expressions, they will have a .pattern
> attribute that contains your regexp. it seem to me something
> in mod_python may be munging/interpreting \-escapes, so if
> you print the pattern out and it looks different from the
> one you put in, you might be closer to figuring out what
> is going on..

Yes, I thought so, too. Therefor I modified re.py in lib/python1.5
at line 79 (re.compile) to print the pattern right before calling
pcre_compile - it's the pattern I call it with :(
Regarding this, I guess the problem is in prce_compile, but I did
not investigate this further.

Ralf

-- 
Ralf Canis            ralf@silicon.org
Germany               canis@bigfoot.com

From grisha at ispol.com  Thu May 18 09:15:50 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:51:56 2004
Subject: [mod_python] problem using regular expressions in CGI scripts
In-Reply-To: <20000518145953.A7140@silicon.org>
Message-ID: <Pine.LNX.4.21.0005180903560.30961-100000@saturn.ispol.com>

Can you try running the same code in your own handler, and see where that
takes you, in other words:

httpd.conf:
AddHandler python-program .py
PythonHandler myhandler
PythonDebug

Then the myhandler.py file would have something like

--- snip ---

from mod_python import apache
import re, sys

def handler(req):

    req.content_type = 'text/plain'
    req.send_http_header()
    re.compile( r'foo(\(.+\))bar' )
    req.write('ok')
    return apache.OK

--- snip ---


Note that it is not necessary to print out the traceback - mod_python does
that for you if PythonDebug directive is specified.

Grisha


On Thu, 18 May 2000, Ralf Canis wrote:

> On Thu, May 18, 2000 at 02:39:46PM +0300, Erno Kuusela wrote:
> 
> Hello Erno,
> 
> > i haven't even installed mod_python yet, but a debugging idea
> > came to mind...
> > 
> > if you compile your regular expressions, they will have a .pattern
> > attribute that contains your regexp. it seem to me something
> > in mod_python may be munging/interpreting \-escapes, so if
> > you print the pattern out and it looks different from the
> > one you put in, you might be closer to figuring out what
> > is going on..
> 
> Yes, I thought so, too. Therefor I modified re.py in lib/python1.5
> at line 79 (re.compile) to print the pattern right before calling
> pcre_compile - it's the pattern I call it with :(
> Regarding this, I guess the problem is in prce_compile, but I did
> not investigate this further.
> 
> Ralf
> 
> -- 
> Ralf Canis            ralf@silicon.org
> Germany               canis@bigfoot.com
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 





From ralf at silicon.org  Fri May 19 10:33:56 2000
From: ralf at silicon.org (Ralf Canis)
Date: Fri Jan  9 21:51:56 2004
Subject: [mod_python] SOLVED: problem using regular expressions in CGI scripts
Message-ID: <20000519103356.A1499@silicon.org>

Hi,

I found what caused this strange problem: loading mod_python dynamically!
(build+installed using apxs).

Thanks everybody
  Ralf
-- 
Ralf Canis            ralf@silicon.org
Germany               canis@bigfoot.com

From grisha at ispol.com  Fri May 19 07:39:55 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:51:56 2004
Subject: [mod_python] SOLVED: problem using regular expressions in CGI
 scripts
In-Reply-To: <20000519103356.A1499@silicon.org>
Message-ID: <Pine.LNX.4.21.0005190737330.5106-100000@saturn.ispol.com>

Very cusrious. 

The dynamic loading by itself shouldn't make the module act any
differently. It's probably not the dynamic loading itself, but rather that
as a result of dynamic loading some libraries get rearranged?

I haven't had the time to look at this yet as I've been busy perfecting
the documentation and working out other DSO issues, but I will try soon.

Grisha

On Fri, 19 May 2000, Ralf Canis wrote:

> Hi,
> 
> I found what caused this strange problem: loading mod_python dynamically!
> (build+installed using apxs).
> 
> Thanks everybody
>   Ralf
> -- 
> Ralf Canis            ralf@silicon.org
> Germany               canis@bigfoot.com
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From grisha at ispol.com  Fri May 19 19:47:06 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:51:56 2004
Subject: [mod_python] problem using regular expressions in CGI scripts
In-Reply-To: <20000518152302.A7535@silicon.org>
Message-ID: <Pine.LNX.4.21.0005191945410.8192-100000@saturn.ispol.com>

I'm unable to reproduce this. Tried it as DSO, on Linux and FreeBSD and it
works fine...

Anybody else on the list want to try it?

Grisha


On Thu, 18 May 2000, Ralf Canis wrote:

> On Thu, May 18, 2000 at 09:15:50AM -0400, Gregory Trubetskoy wrote:
> 
> Hi Grisha,
> 
> same errors, here's one for example.
> 
> Ralf
> 
> ---snip---
> \nERROR mod_python: "PythonHandler myhandler"
> 
> Traceback (innermost last):
> 
>   File "/usr/lib/python1.5/site-packages/mod_python/apache.py", line 110, in Dispatch
>     result = object(req)
> 
>   File "./myhandler.py", line 8, in handler
>     re.compile( r'foo(\(.+\))bar' )
> 
>   File "/usr/lib/python1.5/re.py", line 79, in compile
>     code=pcre_compile(pattern, flags, groupindex)
> 
> pcre.error: ('missing )', 2493)
> 
> 
> NOTE: More output from other handlers, if any, may follow.
> This will NOT happen, and request processing will STOP
> at this point when you remove PythonDebug directive.
> ---snip---
> 
> > 
> > Can you try running the same code in your own handler, and see where that
> > takes you, in other words:
> > 
> > httpd.conf:
> > AddHandler python-program .py
> > PythonHandler myhandler
> > PythonDebug
> > 
> > Then the myhandler.py file would have something like
> > 
> > --- snip ---
> > 
> > from mod_python import apache
> > import re, sys
> > 
> > def handler(req):
> > 
> >     req.content_type = 'text/plain'
> >     req.send_http_header()
> >     re.compile( r'foo(\(.+\))bar' )
> >     req.write('ok')
> >     return apache.OK
> > 
> > --- snip ---
> > 
> > 
> > Note that it is not necessary to print out the traceback - mod_python does
> > that for you if PythonDebug directive is specified.
> > 
> > Grisha
> > 
> > 
> > On Thu, 18 May 2000, Ralf Canis wrote:
> > 
> > > On Thu, May 18, 2000 at 02:39:46PM +0300, Erno Kuusela wrote:
> > > 
> > > Hello Erno,
> > > 
> > > > i haven't even installed mod_python yet, but a debugging idea
> > > > came to mind...
> > > > 
> > > > if you compile your regular expressions, they will have a .pattern
> > > > attribute that contains your regexp. it seem to me something
> > > > in mod_python may be munging/interpreting \-escapes, so if
> > > > you print the pattern out and it looks different from the
> > > > one you put in, you might be closer to figuring out what
> > > > is going on..
> > > 
> > > Yes, I thought so, too. Therefor I modified re.py in lib/python1.5
> > > at line 79 (re.compile) to print the pattern right before calling
> > > pcre_compile - it's the pattern I call it with :(
> > > Regarding this, I guess the problem is in prce_compile, but I did
> > > not investigate this further.
> > > 
> -- 
> Ralf Canis            ralf@silicon.org
> Germany               canis@bigfoot.com
> 


From stevena at permanent.cc  Sat May 20 23:42:32 2000
From: stevena at permanent.cc (Steven D. Arnold)
Date: Fri Jan  9 21:51:57 2004
Subject: [mod_python] apache compile problems
Message-ID: <4.3.1.2.20000520233846.014d7ee8@phear.dementian.com>

Hi,

I'm trying to compile apache with mod_python and I'm getting the following 
error:

[root@catatonia apache_1.3.12]# ./configure 
--activate-module=src/modules/extra/mod_python.c --prefix=/usr/local/apache 
--enable-module=all
Configuring for Apache, Version 1.3.12
  + using installation path layout: Apache (config.layout)
  + activated python module (modules/extra/mod_python.c)
Creating Makefile
Creating Configuration.apaci in src
grep: /usr/lib/python1.5/config/Makefile: No such file or directory
grep: /usr/lib/python1.5/config/Makefile: No such file or directory
grep: /usr/lib/python1.5/config/Makefile: No such file or directory
grep: /usr/lib/python1.5/config/Makefile: No such file or directory
cd ..; gcc  -DLINUX=2 -DUSE_HSREGEX -DUSE_EXPAT -I./lib/expat-lite 
`./apaci` -I/usr/include/python1.5    -o helpers/dummy 
helpers/dummy.c   -lm -lcrypt -lndbm -ldb 
/usr/lib/python1.5/config/libpython1.5.a   -ldl
gcc: /usr/lib/python1.5/config/libpython1.5.a: No such file or directory
make: *** [dummy] Error 1
Creating Makefile in src
  + configured for Linux platform
  + setting C compiler to gcc
  + setting C pre-processor to gcc -E
  + checking for system header files
  + adding selected modules
     o rewrite_module uses ConfigStart/End
  + using -lndbm for DBM support
       enabling DBM support for mod_rewrite
     o dbm_auth_module uses ConfigStart/End
     o db_auth_module uses ConfigStart/End
       using Berkeley-DB/2.x for mod_auth_db (-ldb)
     o python_module uses ConfigStart/End
  + using -ldl for vendor DSO support
  + checking sizeof various data types
  + doing sanity check on compiler and options
** A test compilation with your Makefile configuration
** failed.  The below error output from the compilation
** test will give you an idea what is failing. Note that
** Apache requires an ANSI C Compiler, such as gcc.

======== Error Output for sanity check ========
============= End of Error Report =============

  Aborting!


I have no directory /usr/lib/python1.5/config, though the parent of that 
dir does exist.  I just freshly installed python 1.5.2 before trying the 
above.  Platform is Red Hat Linux 6.2.  Any ideas?


steve

--
Steven D. Arnold          Que quiero sera           stevena@permanent.cc
"We choose to go to the moon in this decade and do the other things, not
because they are easy, but because they are hard."    -- John F. Kennedy


From stevena at permanent.cc  Sun May 21 00:28:14 2000
From: stevena at permanent.cc (Steven D. Arnold)
Date: Fri Jan  9 21:51:57 2004
Subject: [mod_python] [SOLVED] apache compile problems
In-Reply-To: <4.3.1.2.20000520233846.014d7ee8@phear.dementian.com>
Message-ID: <4.3.1.2.20000521002528.015faf08@phear.dementian.com>

For some reason, the original installation of python on my system didn't 
have a config dir inside /usr/lib/python1.5.  I reinstalled python and it 
made sys.exec_prefix /usr/local; however, it didn't replace the old copies 
of python sitting in /usr/bin.  (It did put new copies in 
/usr/local/bin.)  When I deleted the old copies and created symlinks to the 
new copies, python then knew to look in /usr/local/lib/python1.5/config, 
and all was well.


steve

--
Steven D. Arnold          Que quiero sera           stevena@permanent.cc
"We choose to go to the moon in this decade and do the other things, not
because they are easy, but because they are hard."    -- John F. Kennedy


From jam at quark.emich.edu  Sun May 21 08:04:35 2000
From: jam at quark.emich.edu (Jeff)
Date: Fri Jan  9 21:51:57 2004
Subject: [mod_python] apache compile problems
In-Reply-To: <4.3.1.2.20000520233846.014d7ee8@phear.dementian.com>; from stevena@permanent.cc on Sat, May 20, 2000 at 11:42:32PM -0400
References: <4.3.1.2.20000520233846.014d7ee8@phear.dementian.com>
Message-ID: <20000521080435.A1765@quark.emich.edu>

On Sat, May 20, 2000 at 11:42:32PM -0400, Steven D. Arnold wrote:
> Hi,
> 
> I'm trying to compile apache with mod_python and I'm getting the following 
> error:
[...snipped...]
> 
> ======== Error Output for sanity check ========
> ============= End of Error Report =============
> 
>   Aborting!
> 
> 
> I have no directory /usr/lib/python1.5/config, though the parent of that 
> dir does exist.  I just freshly installed python 1.5.2 before trying the 
> above.  Platform is Red Hat Linux 6.2.  Any ideas?
> 
> 
> steve
> 

be sure that the python-devel package has been installed before attempting
the build.

hope that helps ;)

regards,
J
-- 
|| visit gfd <http://quark.emich.edu/>
|| psa member -- <http://www.python.org/psa/> 

From wayne.izatt at myself.com  Sun May 21 14:38:05 2000
From: wayne.izatt at myself.com (Wayne Izatt)
Date: Fri Jan  9 21:51:57 2004
Subject: [mod_python] .htaccess and httpd.conf
Message-ID: <3928573C.EFEB5271@myself.com>

Hi all. I've built and installed a mod_python enabled apache. However,
I'm not sure what, if any, directives I need to add to httpd.conf to get
it to pass .py files to the python handler. When I point my browser at
the test script, all that I get is the script in the browser window.

Perhaps someone has a sample httpd.conf (just the handler stuff will do)
or a vanilla .htaccess (if that's where the directives should go).

(Yes, I've followed the installation instructions, but something simple
is still eluding me).

cheers


From stevena at permanent.cc  Sun May 21 17:56:24 2000
From: stevena at permanent.cc (Steven D. Arnold)
Date: Fri Jan  9 21:51:57 2004
Subject: [mod_python] .htaccess and httpd.conf
In-Reply-To: <3928573C.EFEB5271@myself.com>
Message-ID: <4.3.1.2.20000521175332.01f98ee8@phear.dementian.com>

At 02:38 PM 5/21/2000 -0700, Wayne Izatt wrote:
>Hi all. I've built and installed a mod_python enabled apache. However,
>I'm not sure what, if any, directives I need to add to httpd.conf to get
>it to pass .py files to the python handler. When I point my browser at
>the test script, all that I get is the script in the browser window.
>
>Perhaps someone has a sample httpd.conf (just the handler stuff will do)
>or a vanilla .htaccess (if that's where the directives should go).
>
>(Yes, I've followed the installation instructions, but something simple
>is still eluding me).

I'm having the same experience.

I tried the following directives:

Alias /python /usr/local/apache/htdocs/python

<Location /python/>
     AllowOverride All
     AddHandler python-program .py
     PythonDebug
     PythonHandler test
</Location>


When I try loading the page, I get this error:

\nERROR mod_python: "PythonHandler test"

Traceback (innermost last):

File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 
107, in Dispatch object = self.resolve_object(module_name, object_str)

File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 
70, in resolve_object raise "ResolveError", "Couldn't resolve object '%s' 
in module '%s'." % \

ResolveError: Couldn't resolve object 'handler' in module 'test'.

NOTE: More output from other handlers, if any, may follow. This will NOT 
happen, and request processing will STOP at this point when you remove 
PythonDebug directive.


I'm not quite sure what I'm doing wrong.  Any ideas?


steve

--
Steven D. Arnold          Que quiero sera           stevena@permanent.cc
"We choose to go to the moon in this decade and do the other things, not
because they are easy, but because they are hard."    -- John F. Kennedy


From wayne.izatt at myself.com  Sun May 21 15:37:21 2000
From: wayne.izatt at myself.com (Wayne Izatt)
Date: Fri Jan  9 21:51:57 2004
Subject: [Fwd: [mod_python] .htaccess and httpd.conf]
Message-ID: <39286520.67A1B247@myself.com>

Victory. Here's what I did.

added:

AddModule mod_python.c

after the other added modules.

added this directive:

<Directory "/usr/local/apache/htdocs/ptest">
    AddHandler python-program .py
    PythonDebug
    PythonHandler test
</Directory>

and everything works fine.

thanks all

Wayne Izatt wrote:

> Hi all. I've built and installed a mod_python enabled apache. However,
> I'm not sure what, if any, directives I need to add to httpd.conf to get
> it to pass .py files to the python handler. When I point my browser at
> the test script, all that I get is the script in the browser window.
>
> Perhaps someone has a sample httpd.conf (just the handler stuff will do)
> or a vanilla .htaccess (if that's where the directives should go).
>
> (Yes, I've followed the installation instructions, but something simple
> is still eluding me).
>
> cheers
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python




From grisha at ispol.com  Sun May 21 19:11:37 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:51:57 2004
Subject: [mod_python] .htaccess and httpd.conf
In-Reply-To: <4.3.1.2.20000521175332.01f98ee8@phear.dementian.com>
Message-ID: <Pine.LNX.4.21.0005211909500.29474-100000@saturn.ispol.com>

This means that test.py doesn't have a function called "handler" defined
in it.

What's in your test.py?

Grisha


On Sun, 21 May 2000, Steven D. Arnold wrote:

> When I try loading the page, I get this error:
> 
> ResolveError: Couldn't resolve object 'handler' in module 'test'.
> 


From stevena at permanent.cc  Sun May 21 20:05:44 2000
From: stevena at permanent.cc (Steven D. Arnold)
Date: Fri Jan  9 21:51:57 2004
Subject: [mod_python] .htaccess and httpd.conf
In-Reply-To: <Pine.LNX.4.21.0005211909500.29474-100000@saturn.ispol.com>
References: <4.3.1.2.20000521175332.01f98ee8@phear.dementian.com>
Message-ID: <4.3.1.2.20000521200358.015c0300@phear.dementian.com>

At 07:11 PM 5/21/2000 -0400, Gregory Trubetskoy wrote:

>This means that test.py doesn't have a function called "handler" defined
>in it.
>
>What's in your test.py?

I put exactly what the docs suggest:

from mod_python import apache

def handler(req):
         req.send_http_header()
         req.write("Hello World!")
         return apache.OK


However, I made the changes Wayne suggested, and now it works for me. 
:-)  (It didn't initially, but it does now -- I can't explain 
why.)  Apparently the AddModule and Directory directives did it...


steve


--
Steven D. Arnold          Que quiero sera           stevena@permanent.cc
"We choose to go to the moon in this decade and do the other things, not
because they are easy, but because they are hard."    -- John F. Kennedy


From grisha at ispol.com  Mon May 22 19:19:38 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:51:57 2004
Subject: [mod_python] mod_python 2.0
In-Reply-To: <4.3.1.2.20000520233846.014d7ee8@phear.dementian.com>
Message-ID: <Pine.LNX.4.21.0005211901010.29474-100000@saturn.ispol.com>


Is out on the site - http://www.modpython.org/

(well, as soon as the DNS changes take effect - the site has moved to
another server.)

It has quite a bit of documentation improvements, especially the
installation section, as well as some significant code fixes, though no
new features. I think this version should be more or less stable because
since 1.9 I haven't really found any really major bugs or had reports of
instability, except during the install process, which is quite normal.

Unless something major turns up in the very near future, an announcement
to comp.lang.python will follow, as well as links on Python and Apache
site requested, which should up the user base a bit.... :-)

Grisha


From morton at dennisinter.com  Mon May 22 21:14:40 2000
From: morton at dennisinter.com (Damian Morton)
Date: Fri Jan  9 21:51:57 2004
Subject: [mod_python] mod_python 2.0
In-Reply-To: <Pine.LNX.4.21.0005211901010.29474-100000@saturn.ispol.com>
Message-ID: <NDBBLENPLCPAHKODFHNGMEEKDHAA.morton@dennisinter.com>

Please excuse the newbie question, as Im not as familiar with unix and
apache as Id like to be, although the availability of mod_python opens up
some very interesting possibilities.

I know from observing mod_perl people that there are some problems with
having global data shared between invokations of request handlers. Is there
some mechanism in mod_python to get around this? I understand that the issue
is that Apache runs serveral processes to optimise performance, and that
each request will likely get routed to different processes, each one having
its own (global?) data.



> -----Original Message-----
> From: mod_python-admin@modpython.org
> [mailto:mod_python-admin@modpython.org]On Behalf Of Gregory Trubetskoy
> Sent: Monday, May 22, 2000 7:20 PM
> To: mod_python list
> Subject: [mod_python] mod_python 2.0
>
>
>
>
> Is out on the site - http://www.modpython.org/
>
> (well, as soon as the DNS changes take effect - the site has moved to
> another server.)
>
> It has quite a bit of documentation improvements, especially the
> installation section, as well as some significant code fixes, though no
> new features. I think this version should be more or less stable because
> since 1.9 I haven't really found any really major bugs or had reports of
> instability, except during the install process, which is quite normal.
>
> Unless something major turns up in the very near future, an announcement
> to comp.lang.python will follow, as well as links on Python and Apache
> site requested, which should up the user base a bit.... :-)
>
> Grisha
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python


From grisha at ispol.com  Tue May 23 07:28:36 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:51:57 2004
Subject: [mod_python] mod_python 2.0
In-Reply-To: <NDBBLENPLCPAHKODFHNGMEEKDHAA.morton@dennisinter.com>
Message-ID: <Pine.LNX.4.21.0005230719150.7819-100000@saturn.ispol.com>

On Mon, 22 May 2000, Damian Morton wrote:

> I understand that the issue is that Apache runs serveral processes to
> optimise performance, and that each request will likely get routed to
> different processes, each one having its own (global?) data.

This is hardly a mod_python issue, but...

There are basically two common ways of sharing data - through a backend
database like MySQL or via a file. With a file you will need a locking
mechanism of some sort.

I, personally, have yet to find an application where there is a true need
for global data (other than a backend database). HTTP applications, given
the stateless nature of the protocol, have eveolved with other ways to
retain state - cookies, URL's, form data and those are usually sufficient.

HTH -

Grisha


From riku.voipio at tietoenator.com  Tue May 23 16:11:47 2000
From: riku.voipio at tietoenator.com (Riku Voipio)
Date: Fri Jan  9 21:51:57 2004
Subject: [mod_python] apache reload wont't work with DSO mod_python
Message-ID: <20000523161147.A23015@samncd.tsd.tieto.com>

Hi, 
/etc/init.d/apache reload crashes if mod_python is loaded.
Another anomility noted is, that apache wont start, if the last 
loaded module is mod_python.

Elsewell it is running smoothly.

Running Debian potato apt-get up-to-date today. 

and as for last, 
Here's a patch to fix a type on install.html

--- installation.html.old       Tue May 23 16:01:31 2000
+++ installation.html   Tue May 23 16:05:27 2000
@@ -177,8 +177,8 @@
      standard Debian Python development package installed]
 
     1. cd src/modules/extra
-    2. axps -I /usr/local/include/python1.5 -c mod_python.c \
-            /usr/local/lib/python1.5/config/libpython1.5.a -lpthread
+    2. apxs -I /usr/include/python1.5 -c mod_python.c \
+            /usr/lib/python1.5/config/libpython1.5.a -lpthread
       (You don't nead -lpthread if your Python is compiled without threads)
 


-- 
Riku Voipio
riku.voipio@tietoenator.com
09-862 60764

From grisha at ispol.com  Thu May 25 22:50:59 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:51:57 2004
Subject: [mod_python] quick code review
In-Reply-To: <Pine.LNX.4.10.10005251801100.16846-100000@nebula.lyra.org>
Message-ID: <Pine.LNX.4.21.0005252248100.24987-100000@saturn.ispol.com>


Thanks for taking the time to look over the code and all the comments, I
think they're all valid and I'll address them.

On Thu, 25 May 2000, Greg Stein wrote:

> *) I don't understand why the PyTypeObject's are init'd/copied in
>    python_init, rather than just doing that at the module level. For
>    example:
>      static PyTypeObject serverobjecttype = { ... };

I wonder if this is something that I had to do back in httpdapy times so
that it compiled on Visual C++...?

Grisha

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python

From grisha at ispol.com  Thu May 25 22:53:34 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:51:57 2004
Subject: [mod_python] reload problem
In-Reply-To: <Pine.LNX.4.10.10005251746270.16846-100000@nebula.lyra.org>
Message-ID: <Pine.LNX.4.21.0005252251390.24987-100000@saturn.ispol.com>


I think the archive is broken, BTW, ever since I moved mailman to another
machine.... I don't see any messages from today or yesterday.

I will probably recreate this list tomorrow and I'll try to make the
archives reflect everything that wasn't archived.

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Thu, 25 May 2000, Greg Stein wrote:

> [ I just subscribed, so I can't "reply" to the reload issue that I saw in
>   the archive... starting from scratch ]

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python

From gstein at lyra.org  Fri May 26 00:54:31 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:51:57 2004
Subject: [mod_python] quick code review
In-Reply-To: <Pine.LNX.4.21.0005252248100.24987-100000@saturn.ispol.com>
Message-ID: <Pine.LNX.4.10.10005260049500.21092-100000@nebula.lyra.org>

On Thu, 25 May 2000, Gregory Trubetskoy wrote:
>...
> On Thu, 25 May 2000, Greg Stein wrote:
> > *) I don't understand why the PyTypeObject's are init'd/copied in
> >    python_init, rather than just doing that at the module level. For
> >    example:
> >      static PyTypeObject serverobjecttype = { ... };
> 
> I wonder if this is something that I had to do back in httpdapy times so
> that it compiled on Visual C++...?

There is something about static initializers in MSVC. Generally, code will
add a line such as:

(from arraymodule.c)

    Arraytype.ob_type = &PyType_Type;


I don't know exactly *why* it must be done that way, but there ya go. The
underlying point is that the initialization of the type objects can be
simplified quite a bit.

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python

From gstein at lyra.org  Fri May 26 01:54:54 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:51:57 2004
Subject: [mod_python] apache.py suggestions
Message-ID: <Pine.LNX.4.10.10005260147360.21092-100000@nebula.lyra.org>

Here are a few more suggestions, but for apache.py:

*) avoid exec/eval: they are quite slow, and can pose a security risk

*) to import modules, use: module = __import__(module_name)

*) resolve_object(), use the getattr() function for traversing

*) copy a dictionary using dict.copy()

*) maybe move some of the CGI stuff off to 'cgihandler'


Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python

From mmach at batory.org.pl  Fri May 26 11:05:50 2000
From: mmach at batory.org.pl (Micha<B3> Mach)
Date: Fri Jan  9 21:51:57 2004
Subject: [mod_python] apache.py suggestions
In-Reply-To: <Pine.LNX.4.10.10005260147360.21092-100000@nebula.lyra.org>
Message-ID: <NDBBIBMMILNGAOKOEEKDEECDCEAA.mmach@batory.org.pl>


Hi,

> *) to import modules, use: module = __import__(module_name)

Why so? That's perhaps more like the Python question than mod_python matter,
but anyway...

Best,
Michal


---
Michal Mach   mmach@batory.org.pl
Stefan Batory Foundation
http://www.batory.org.pl/

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python

From gstein at lyra.org  Fri May 26 03:39:52 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:51:57 2004
Subject: [mod_python] apache.py suggestions
In-Reply-To: <NDBBIBMMILNGAOKOEEKDEECDCEAA.mmach@batory.org.pl>
Message-ID: <Pine.LNX.4.10.10005260335290.21092-100000@nebula.lyra.org>

On Fri, 26 May 2000, Micha<B3> Mach wrote:
> > *) to import modules, use: module = __import__(module_name)
> 
> Why so? That's perhaps more like the Python question than mod_python matter,
> but anyway...

apache.py was doing something like the following:

    exec "import " + module_name
    module = eval(module_name)

The above code is horribly inefficient compared to the code I provided
(using __import__). You have two parse/compile passes at runtime. The
"exec" disables certain optimizations. I don't think the code allows it,
but if module_name happens to come from some user input, then you are
effectively executing arbitrary code. Very bad.

Python vs mod_python? Bah. I wouldn't have brought it up if it wasn't a
mod_python issue.

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python

From gstein at lyra.org  Thu May 25 17:57:13 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:51:57 2004
Subject: [mod_python] reload problem
Message-ID: <Pine.LNX.4.10.10005251746270.16846-100000@nebula.lyra.org>

[ I just subscribed, so I can't "reply" to the reload issue that I saw in
  the archive... starting from scratch ]

The reload issue might be caused by the global variables in mod_python.c.
Those values should be wiped when the configuration pool is tossed.
Specifically, a "cleanup" should be registered at the point that those
variables are allocated.

That might not truly be it, but globals are *always* suspect when dealing
with Apache modules.

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python

From gstein at lyra.org  Thu May 25 19:12:10 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:51:57 2004
Subject: [mod_python] quick code review
Message-ID: <Pine.LNX.4.10.10005251801100.16846-100000@nebula.lyra.org>

There are a number of issues that I see with mod_python.c. I'll try to
address a good number of them here, but I'm invariably going to miss some.
After some changes are made, then another pass can be done at that point.

Please try to take this constructively... the goal is to improve the
code... :-)

*) when storing the tstate into obcallback, use a PyCObject rather than an
   integer. That will avoid the (int) casting (a no-no)

*) noop is not needed; use ap_null_cleanup() (I think that's the name;
   close to it, at least)

*) simplify make_obcallback(): the two params are always NULL

*) I don't understand why the PyTypeObject's are init'd/copied in
   python_init, rather than just doing that at the module level. For
   example:
     static PyTypeObject serverobjecttype = { ... };

*) use PyImport_Import() rather than PyRun_SimpleString to get the
   module imported. This returns the "mod_python" or "mod_python.apache"
   module (I forget which; probably the former).

*) use PyObject_CallMethod() to call the "init" method in the module
   retrieved from above. Use the *return* value for obCallBack, rather
   than the SetCallback nastiness.

*) in python_directive, just use a cast to (py_dir_config *) rather than
   all the offset stuff. Also, there is no need to dup() the string since
   it is a constant.

*) unused: python_dict_merge, table2dict, print_table, print_array

*) exit(1) should not be used; use ap_log_rerror() and return failure
   codes to Apache

*) rather than storing the "request object" into r->notes, place it into
   tstate->dict. you won't have to do the atoi() stuff (which is Bad
   anyways)

*) use ap_log_rerror() instead of ap_log_error(). the former is better
   from a logging standpoint (it has more info)


That's all for now!

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/
_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python


From mmach at batory.org.pl  Fri May 26 15:45:24 2000
From: mmach at batory.org.pl (Micha³ Mach)
Date: Fri Jan  9 21:51:57 2004
Subject: [mod_python] apache.py suggestions
In-Reply-To: <Pine.LNX.4.10.10005260335290.21092-100000@nebula.lyra.org>
Message-ID: <NDBBIBMMILNGAOKOEEKDIECGCEAA.mmach@batory.org.pl>

> apache.py was doing something like the following:
>
>     exec "import " + module_name
>     module = eval(module_name)
>
> The above code is horribly inefficient compared to the code I provided
> (using __import__). You have two parse/compile passes at runtime. The
> "exec" disables certain optimizations. I don't think the code allows it,
> but if module_name happens to come from some user input, then you are
> effectively executing arbitrary code. Very bad.

Sorry, I realize now my question was stupid in fact - I assumed You're
talking about Python in general speaking about the __import__ thing. I
didn't watch see the mod_python code as carefully as You. ;-)

> Python vs mod_python? Bah. I wouldn't have brought it up if it wasn't a
> mod_python issue.

Well, the criticism was directed towards my own question, so don't take it
personally. ;-)

Best,
Michal

P.S. Perhaps I didn't mention it earlier, but I'm a happy man - noone will
tell me now that mod_perl rules. :-) One world, one language! (which means
Python, of course) :-)

---
Michal Mach   mmach@batory.org.pl
Stefan Batory Foundation
http://www.batory.org.pl/


From gstein at lyra.org  Fri May 26 08:21:34 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:51:57 2004
Subject: [mod_python] apache.py suggestions
In-Reply-To: <Pine.GSO.4.05.10005260802450.12724-100000@koi>
Message-ID: <Pine.LNX.4.10.10005260820440.23146-100000@nebula.lyra.org>

On Fri, 26 May 2000 grisha@verio.net wrote:
> On Fri, 26 May 2000, Greg Stein wrote:
> 
> > *) avoid exec/eval: they are quite slow, and can pose a security risk
> > *) to import modules, use: module = __import__(module_name)
> 
> The reasoning behind using exec to import was that __import__ doesn't
> understand dots (packages),

Eh? Sure it does.

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/


From grisha at ispol.com  Fri May 26 12:03:26 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:51:57 2004
Subject: [mod_python] apache.py suggestions
In-Reply-To: <Pine.LNX.4.10.10005260820440.23146-100000@nebula.lyra.org>
Message-ID: <Pine.LNX.4.21.0005261158110.27589-100000@saturn.ispol.com>

On Fri, 26 May 2000, Greg Stein wrote:

> > The reasoning behind using exec to import was that __import__ doesn't
> > understand dots (packages),
> 
> Eh? Sure it does.

Looks like it does indeed. I wonder why I put this comment in
(now obsolete) httpdapy:

                # we could use __import__ but it can't handle packages
                exec "import " + module_name

May be it's something new with 1.5 or 1.5.2? I'm almost tempted to compile
an old Python version, but I think I'll pass.... :-)

Grisha


From gstein at lyra.org  Fri May 26 09:12:23 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:51:57 2004
Subject: [mod_python] apache.py suggestions
In-Reply-To: <Pine.LNX.4.21.0005261158110.27589-100000@saturn.ispol.com>
Message-ID: <Pine.LNX.4.10.10005260909320.23146-100000@nebula.lyra.org>

On Fri, 26 May 2000, Gregory Trubetskoy wrote:
> On Fri, 26 May 2000, Greg Stein wrote:
> > > The reasoning behind using exec to import was that __import__ doesn't
> > > understand dots (packages),
> > 
> > Eh? Sure it does.
> 
> Looks like it does indeed. I wonder why I put this comment in
> (now obsolete) httpdapy:
> 
>                 # we could use __import__ but it can't handle packages
>                 exec "import " + module_name
> 
> May be it's something new with 1.5 or 1.5.2? I'm almost tempted to compile
> an old Python version, but I think I'll pass.... :-)

Yes, it is new to the Python 1.5 series. Before then, packages were only
possible if "ni" was imported. 1.5 built the logic directly into the core.

Due to the Interpreter/Thread State stuff in mod_python.c, you are
specific to Python 1.5 anyways, so relying on __import__ and packages
should be fine.

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/



From grisha at ispol.com  Fri May 26 13:13:59 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:51:57 2004
Subject: [mod_python] apache.py suggestions
In-Reply-To: <Pine.LNX.4.10.10005260909320.23146-100000@nebula.lyra.org>
Message-ID: <Pine.LNX.4.21.0005261303250.28220-100000@saturn.ispol.com>

OK, here is the deal - 

	exec "import " + module_name
	module = eval(module_name)

is not the same as module = __import__(module_name), but rather:

	module = __import__(module_name)
	list = string.split(module_name, ".")
	for n in list[1:]:
		module = getattr(module, n)

My quick tests on which is faster where inconclusive. The former is
less lines of code and is (IMHO) simpler to read, the latter is definitely
more secure since it doesn't have the exec or eval.

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Fri, 26 May 2000, Greg Stein wrote:

> On Fri, 26 May 2000, Gregory Trubetskoy wrote:
> > On Fri, 26 May 2000, Greg Stein wrote:
> > > > The reasoning behind using exec to import was that __import__ doesn't
> > > > understand dots (packages),
> > > 
> > > Eh? Sure it does.
> > 
k


From gstein at lyra.org  Fri May 26 10:37:22 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:51:57 2004
Subject: [mod_python] apache.py suggestions
In-Reply-To: <Pine.LNX.4.21.0005261303250.28220-100000@saturn.ispol.com>
Message-ID: <Pine.LNX.4.10.10005261024330.23146-200000@nebula.lyra.org>

On Fri, 26 May 2000, Gregory Trubetskoy wrote:
> OK, here is the deal - 
> 
> 	exec "import " + module_name
> 	module = eval(module_name)
> 
> is not the same as module = __import__(module_name), but rather:
> 
> 	module = __import__(module_name)
> 	list = string.split(module_name, ".")
> 	for n in list[1:]:
> 		module = getattr(module, n)
> 
> My quick tests on which is faster where inconclusive. The former is
> less lines of code and is (IMHO) simpler to read, the latter is definitely
> more secure since it doesn't have the exec or eval.

Mine were quite conclusive. The latter code is 4 to 6 times faster.

I've attached my timing script. Here is the output of a couple runs:

[gstein@kurgan python]$ ./time-eval.py
16.6380729675 2.65576100349 6.2648984399
22.0597770214 5.24019098282 4.20972767858
[gstein@kurgan python]$ ./time-eval.py
16.5899840593 2.59417903423 6.39508061719
21.954955101 5.28538203239 4.15390126323

Note that each run already loops through 10000 times, so the numbers above
should be quite stable.

Yes, I understand that the first import is longer than the following
imports. And that I'm not testing the cost of that first import. This is
intended: the underlying import mechanism which runs on that first import
is the same for both (e.g. the parse/load and module setup), so it can be
considered a constant factor and omitted.

Much of this may be moot anyhow since the "import" logic in question
occurs at startup only. But I don't think the use of exec/eval should ever
be encouraged :-) (performance and security)

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/
-------------- next part --------------
#!/usr/bin/env python

import time
import string

def do_timing(m):
  l = xrange(10000)

  t = time.time()
  for i in l:
    exec "import " + m
    mod = eval(m)
  t1 = time.time() - t

  t = time.time()
  for i in l:
    mod = __import__(m)
    for p in string.split(m, '.')[1:]:
      mod = getattr(mod, p)
  t2 = time.time() - t
  print t1, t2, t1/t2

do_timing('httplib')
do_timing('xml.dom.core')
From gstein at lyra.org  Fri May 26 10:49:44 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:51:57 2004
Subject: [mod_python] apache.py suggestions
In-Reply-To: <Pine.LNX.4.10.10005261024330.23146-200000@nebula.lyra.org>
Message-ID: <Pine.LNX.4.10.10005261048480.23146-100000@nebula.lyra.org>

On Fri, 26 May 2000, Greg Stein wrote:
>...
> Mine were quite conclusive. The latter code is 4 to 6 times faster.
>...
> Yes, I understand that the first import is longer than the following
> imports. And that I'm not testing the cost of that first import. This is
> intended: the underlying import mechanism which runs on that first import
> is the same for both (e.g. the parse/load and module setup), so it can be
> considered a constant factor and omitted.

Oops. One more note. I was accidentally charging that first import to the
exec/eval style. I moved that out, but it did not change the results at
all.

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/


From jbauer at rubic.com  Fri May 26 14:25:05 2000
From: jbauer at rubic.com (Jeff Bauer)
Date: Fri Jan  9 21:51:57 2004
Subject: [mod_python] quick code review
Message-ID: <392ECF91.78FD963D@rubic.com>

Many thanks to Greg for his code review and
suggestions.  The mod_python code will benefit
from Greg's experience, and the resulting product
should be easier to use and maintain.  The
earlier pyapache module had stability problems
that we shouldn't have to endure with mod_python.

-Jeff Bauer

From erno at iki.fi  Sat May 27 12:41:21 2000
From: erno at iki.fi (Erno Kuusela)
Date: Fri Jan  9 21:51:57 2004
Subject: [mod_python] quick code review
In-Reply-To: <392ECF91.78FD963D@rubic.com>; from jbauer@rubic.com on Fri, May 26, 2000 at 02:25:05PM -0500
References: <392ECF91.78FD963D@rubic.com>
Message-ID: <20000527124121.G20066@lib.hel.fi>

|                                        The
| earlier pyapache module had stability problems
| that we shouldn't have to endure with mod_python.

actually the predecessor to mod_python was httpdapy,
with which i haven't had any stability problems...

  -- erno

From jbauer at rubic.com  Sat May 27 07:10:49 2000
From: jbauer at rubic.com (Jeff Bauer)
Date: Fri Jan  9 21:51:57 2004
Subject: [mod_python] quick code review
 
Message-ID: <392FBB49.1D03D917@rubic.com>

JB>> earlier pyapache module had stability problems
JB>> that we shouldn't have to endure with mod_python.

EK> actually the predecessor to mod_python was httpdapy,
EK> with which i haven't had any stability problems...

I didn't mean to imply that pyapache was an earlier
version of mod_python, but rather that pyapache was the 
first experience of Python+Apache for many users.

-Jeff

From cobrien at Radix.Net  Sun May 28 10:29:51 2000
From: cobrien at Radix.Net (Cary O'Brien)
Date: Fri Jan  9 21:51:57 2004
Subject: [mod_python] Hi, database connection queston
Message-ID: <200005281429.KAA19075@saltmine.radix.net>

Hi,

Glad to hear about mod_python, it is almost exactly what I am looking for. 
I've used mod_perl/embperl and mod_dtcl, but I really wanted to try using
python.

I'm going to try to fire it up over the long weekend.

I've got a couple of questions (of course).

1) How are people handling persistant database connections?  Ideally (for me)
   there would be a single db connection for each apache process.  That 
   minimizes connection setup time (non-trivial for PostgreSQL at least),
   lets me control the number of database connections (apache max-servers), 
   and lets me control their lifetimes (i.e. serve 10,000 requests then exit),
   and restarts them if they die.  Nice eh?

   My question is how do I setup a shared database connection used by each
   handler?  It seems from the documentation that each request gets its own
   subinterpreter.  I'd like them all to be handled by the same sub-interpreter.
   Or, in reality, just share the same db connection.

   The python doc for Py_NewInterpreter() says

     the new interpreter has separate, independent versions of all imported modules, 

   So what happens to class variables.  Can I connect to the database there?

2) Re Zope.  There seems to be a ZPublisher interface.  Does this mean I can
   run 30 apache processes against the same Zope database?  How fine/course is
   the locking on the zope database?  I asked this on the zope list a while
   back and didn't get a good answer.

3) Does anyone have the bits to embed python calls in an html document a-la 
   embperl/php/mod_dtcl? I know mixing logic with presentation is 
   in general a bad idea, but having embedded code in documents is a fast
   way to get things up and running.
   
-- cary

Cary O'Brien
cobrien@radix.net



 





From jam at quark.emich.edu  Sun May 28 10:52:22 2000
From: jam at quark.emich.edu (Jeff)
Date: Fri Jan  9 21:51:57 2004
Subject: [mod_python] SUCCESS-- mod_python as DSO
Message-ID: <20000528105222.C25643@quark.emich.edu>

Greetings,

I'm happy to report that I was able to get Apache on a Red Hat 6.2 box
working while loading mod_python as a DSO. I took the advise of one of the
FAQ entries, and put the "LoadModule" directive up at the top (instead of
the bottom) of the list in httpd.conf, and it worked just fine (previously I
would get a core dump from Apache).

My question is: why is this necessary? Does this reflect a bug in Apache or
is it some other issue?

Regards,
J
-- 
|| visit gfd <http://quark.emich.edu/>
|| psa member -- <http://www.python.org/psa/> 

From walter at bnbt.de  Sun May 28 17:58:40 2000
From: walter at bnbt.de (Walter =?iso-8859-1?Q?D=F6rwald?=)
Date: Fri Jan  9 21:51:57 2004
Subject: [mod_python] Hi, database connection queston
In-Reply-To: <200005281429.KAA19075@saltmine.radix.net>
Message-ID: <4.3.1.0.20000528175049.00ae2ab0@mail.bnbt.de>

At 16:29 28.05.00, Cary O'Brien wrote:

>[...]
>
>3) Does anyone have the bits to embed python calls in an html document a-la
>    embperl/php/mod_dtcl?

You might want to try XIST available from
ftp://titan.bnbt.de/pub/livinglogic/xist/

It needs a little additional logic to wire the HTML files to the
mod_python RequestHandler, but this shouldn't be a big deal.

>  I know mixing logic with presentation is
>    in general a bad idea, [...]

Well XIST helps you with that too.

Bye,
         Walter D?rwald


From jam at quark.emich.edu  Sun May 28 13:53:01 2000
From: jam at quark.emich.edu (Jeff)
Date: Fri Jan  9 21:51:57 2004
Subject: [mod_python] trouble with mod_python from public_html directory
Message-ID: <20000528135301.B28853@quark.emich.edu>

Greetings,

I'm having difficulty figuring out this problem, and I'm hoping someone will
be able to help get it resolved. I'm not sure if this is a problem with
mod_rewrite or mod_python or my configuration of them.

I have the following .htaccess file in /home/jam/public_html:
[~/public_html] [1:35pm] [jam@toast-pts/2] % cat .htaccess 
AddHandler python-program .py
PythonHandler cgihandler
RewriteEngine on
RewriteCond %{REQUEST_FILENAME} !-s
RewriteRule ^(.*)\.html$          $1.py   [L]

The intent of the rewrite rule is if the URL requests a file ending in
.html, it will check first to see if that file exists (and send it as normal
if it does), and if a suitable file does *not* exist, check for a .py
extension and run that via mod_python if it does.

The above set of directives works *fine* if I install it in
/home/httpd/html.. I can request 'index.html' and it will run the 'index.py'
module I've created.

The problem starts when I copy the .htaccess file to my home directory, and
try to get the same thing to work. it doesn't. I get the following error in
the /var/log/httpd/error_log file: [Sun May 28 13:36:02 2000] [error]
[client 192.168.2.3] File does not exist:
/home/httpd/html/home/jam/public_html/index.py

This indicates the reason for the error-- it's looking for a file called
"/home/httpd/html/home/jam/public_html/index.py", which clearly doesn't
exist (it should instead be "/home/jam/public_html/index.py").

This error occurs regardless of the existence of a .htaccess file in
/home/httpd/html-- I had thought that might be part of the problem, so at
first I added a "PythonInterpPerDirectory" directive, and then renamed the
file so it wouldn't be used, and tried again-- no luck.

I'm not sure if I need to present more information before this problem can
be solved.. please let me know if I can answer any questions about the setup
that might point me in the right direction.

Thanks in advance ;)

Regards,
J
-- 
|| visit gfd <http://quark.emich.edu/>
|| psa member -- <http://www.python.org/psa/> 

From richard at whitequeen.com  Sun May 28 11:01:05 2000
From: richard at whitequeen.com (richard offer)
Date: Fri Jan  9 21:51:58 2004
Subject: [mod_python] Apache fails to start: ImportError: No module named mod_python.apache
Message-ID: <200005281801.e4SI15p04688@erij.whitequeen.com>

Hi,

Apache is failing to start when I have mod_python as a DSO on RH 6.1.

The report from the apache error log is

Traceback (innermost last):
  File "<string>", line 1, in ?
ImportError: No module named mod_python.apache
PythonInitFunction: could not import mod_python.apache.


I've rebuilt python to live under the same top level directory as Apache
(/usr/www/).

[root@erij bin]# ls /usr/www/lib/python1.5/site-packages/mod_python/
__init__.py   apache.py   cgihandler.py   httpdapi.py   zhandler.py
__init__.pyc  apache.pyc  cgihandler.pyc  httpdapi.pyc  zhandler.pyc

[root@erij bin]# ls /usr/www/libexec/
httpd.exp         mod_autoindex.so  mod_include.so      mod_rewrite.so
libproxy.so       mod_cern_meta.so  mod_info.so         mod_setenvif.so
mod_access.so     mod_cgi.so        mod_log_agent.so    mod_speling.so
mod_actions.so    mod_digest.so     mod_log_config.so   mod_status.so
mod_alias.so      mod_dir.so        mod_log_referer.so  mod_unique_id.so
mod_asis.so       mod_env.so        mod_mime.so         mod_userdir.so
mod_auth.so       mod_example.so    mod_mime_magic.so   mod_usertrack.so
mod_auth_anon.so  mod_expires.so    mod_mmap_static.so  mod_vhost_alias.so
mod_auth_db.so    mod_headers.so    mod_negotiation.so
mod_auth_dbm.so   mod_imap.so       mod_python.so

[root@erij bin]# ldd /usr/www/libexec/mod_python.so 
        libpthread.so.0 => /lib/libpthread.so.0 (0x400a9000)
        libc.so.6 => /lib/libc.so.6 (0x400bb000)
        /lib/ld-linux.so.2 => /lib/ld-linux.so.2 (0x80000000)


[root@erij bin]# /usr/www/bin/python
Python 1.5.2 (#1, May 28 2000, 08:30:59)  [GCC egcs-2.91.66 19990314/Linux (egcs- on linux2
Copyright 1991-1995 Stichting Mathematisch Centrum, Amsterdam
>>> import mod_python
>>> from mod_python import apache
Traceback (innermost last):
  File "<stdin>", line 1, in ?
  File "/usr/www/lib/python1.5/site-packages/mod_python/apache.py", line 18, in ?
    import _apache
ImportError: No module named _apache

[ I don't expect this last one to work, but its at least picking up the
right module ]



Can someone hit me with a clue stick.




richard.


-----------------------------------------------------------------------
richard offer @ home 
_______________________________http://www.whitequeen.com/users/richard/


From grisha at ispol.com  Sun May 28 14:06:26 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:51:58 2004
Subject: [mod_python] Hi, database connection queston
In-Reply-To: <200005281429.KAA19075@saltmine.radix.net>
Message-ID: <Pine.LNX.4.21.0005281353050.14870-100000@saturn.ispol.com>

On Sun, 28 May 2000, Cary O'Brien wrote:

> 1) How are people handling persistant database connections?
[....]
>    It seems from the documentation that each request gets its own
>    subinterpreter.

Incorrect. Each directive directory and its subdirectories get its own
subinterpreter. All requests for files in the directory where the
Python*Handler directive was first encountered and its subdirectories are
in the same subinterpreter.

This behaviour can be altered via PythonInterpreter or
PythonInterPerDirectory directives.

As far as database connections - here how I used to do it. I had a module
called data.py (this is not the entire code, some parts are cut out, think
of it as an example rather than something ready to use. cfg contained
configuration). In your scripts, you would have something like:

import data
result = data._run_sql("select * from myteable")

And it would behave exactly as you describe - initiate the db connection
once and keep it for as long as the process lives. Of course, you end up
having as many connections as there are Apache processes, which you can
control by MaxClients directive.

-------------

import cfg
import mysqldb
import string

def _db_login(relogin = 0):
    """Login to the database
    """

    global DB_CONN

    if relogin:
        DB_CONN = mysqldb.mysqldb(cfg.DB_LOGIN)
        return DB_CONN
    else:
        try:
            return DB_CONN

        except NameError:

            DB_CONN = mysqldb.mysqldb(cfg.DB_LOGIN)
            return DB_CONN

def _run_sql( sql, n = 0, with_desc=0 ):
    """ Runs SQL on the server and returns result
    """

    db = _db_login()

    try:
        cur = db.cursor()
        rc = cur.execute(sql)

    except:
        # it's possible that mysql connection
        # timed out. Try one more time.
        db = _db_login(relogin = 1)
        cur = db.cursor()
        rc = cur.execute(sql)

    if string.upper(string.split(sql)[0]) in \
       ("SELECT", "SHOW", "DESC", "DESCRIBE"):
        if n:
            recset = cur.fetchmany(n)
        else:
            recset = cur.fetchall()

        if with_desc:
            return recset, cur.description
        else:
            return recset
    else:
        return rc

------------------

> 2) Re Zope.  There seems to be a ZPublisher interface.  Does this mean I can
>    run 30 apache processes against the same Zope database?  

As I already said on comp.lang.python - no.

>    How fine/course is
>    the locking on the zope database?  I asked this on the zope list a while
>    back and didn't get a good answer.

The first process will lock the database, and all the other ones will just
sit there and wait :-(

> 3) Does anyone have the bits to embed python calls in an html document a-la 
>    embperl/php/mod_dtcl? I know mixing logic with presentation is 
>    in general a bad idea, but having embedded code in documents is a fast
>    way to get things up and running.

You can use the Z DocuemntTemplate with ZHandler, it works pretty well.

HTH,

Grisha


From grisha at ispol.com  Sun May 28 14:10:32 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:51:58 2004
Subject: [mod_python] SUCCESS-- mod_python as DSO
In-Reply-To: <20000528105222.C25643@quark.emich.edu>
Message-ID: <Pine.LNX.4.21.0005281408570.14870-100000@saturn.ispol.com>

Could you send a list of all LoadModules you had and the sequence that
works and the one that doesn't?


On Sun, 28 May 2000, Jeff wrote:

> I took the advise of one of the
> FAQ entries, and put the "LoadModule" directive up at the top (instead of
> the bottom) of the list in httpd.conf, and it worked just fine (previously I
> would get a core dump from Apache).


From grisha at ispol.com  Sun May 28 14:20:30 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:51:58 2004
Subject: [mod_python] Apache fails to start: ImportError: No module named
 mod_python.apache
In-Reply-To: <200005281801.e4SI15p04688@erij.whitequeen.com>
Message-ID: <Pine.LNX.4.21.0005281418440.14870-100000@saturn.ispol.com>

Did you rebuild mod_python after rebuilding Python and made sure that it
is linked against the new libpython library? I have a feeling mod_python
is still looking in /usr/local

Grisha

On Sun, 28 May 2000, richard offer wrote:

> 
> Hi,
> 
> Apache is failing to start when I have mod_python as a DSO on RH 6.1.
> 
> The report from the apache error log is
> 
> Traceback (innermost last):
>   File "<string>", line 1, in ?
> ImportError: No module named mod_python.apache
> PythonInitFunction: could not import mod_python.apache.
> 
> 
> I've rebuilt python to live under the same top level directory as Apache
> (/usr/www/).


From jam at quark.emich.edu  Sun May 28 14:40:34 2000
From: jam at quark.emich.edu (Jeff)
Date: Fri Jan  9 21:51:58 2004
Subject: [mod_python] trouble with mod_python from public_html directory
In-Reply-To: <Pine.LNX.4.21.0005281413050.14870-100000@saturn.ispol.com>; from grisha@ispol.com on Sun, May 28, 2000 at 02:15:01PM -0400
References: <20000528135301.B28853@quark.emich.edu> <Pine.LNX.4.21.0005281413050.14870-100000@saturn.ispol.com>
Message-ID: <20000528144034.D28853@quark.emich.edu>

On Sun, May 28, 2000 at 02:15:01PM -0400, Gregory Trubetskoy wrote:
> 
> Try replacing "AddHandler python-program .py" with "AddHandler cgi-script
> .py" and see if you get the same errors. 
> 
> This will tell you whether this is at all related to mod_python. I suspect
> it isn't - the "File not found" is not a mod_python error.
> 

You were correct.. this had nothing to do with mod_python, but rather
something odd with mod_rewrite. When I added a 'RewriteBase /~jam/'
directive to the .htaccess file in my public_html, things started working as
designed. This directive is not necessary in directories off of
/home/httpd/html, though. This isn't the generic solution I was expecting,
but it works, so I'm going to move on.

Thanks for the help.

Regards,
J
-- 
|| visit gfd <http://quark.emich.edu/>
|| psa member -- <http://www.python.org/psa/> 

From danilo at telusplanet.net  Sun May 28 18:54:02 2000
From: danilo at telusplanet.net (Danilo Fiorenzano)
Date: Fri Jan  9 21:51:58 2004
Subject: [mod_python] Hi, database connection queston
In-Reply-To: Gregory Trubetskoy's message of "Sun, 28 May 2000 14:06:26 -0400 (EDT)"
References: <Pine.LNX.4.21.0005281353050.14870-100000@saturn.ispol.com>
Message-ID: <m31z2mnplh.fsf@spike.interalta.com>

On Sun, 28 May 2000, Cary O'Brien wrote:
 
> 1) How are people handling persistant database connections?
> [....]
>    It seems from the documentation that each request gets its own
>    subinterpreter.

Since global vars retain their values between requests serviced by the
same httpd process, I ended up doing something like this:

---------------- cut ---------------- cut ---------------- cut ----------------
import informixdb
import os, re, cgi, string
from mod_python import apache

_dbconn = None

def handler(req):
    global _dbconn

    ... etc etc ...
    results = findProducts('acid')
    ... etc etc ...


def findProducts(substring):
    global _dbconn

    if _dbconn == None:
        try:
            _dbconn = informixdb.informixdb('db@server', 'user', 'password')
        except:
            return ['Access Denied']

    c = _dbconn.cursor()
    blah = "%" + string.lower(substring) + "%"

    c.execute("select strshippingname from tblproducts where lower(strshippingname) like ?", (blah,))
    retval = []
    for row in c.fetchall():
        retval.append(row[0])

    return retval

---------------- cut ---------------- cut ---------------- cut ----------------

  This works exactly as you want, although it should also have a "try:
except:" block around the actual query, to recover from dropped
connections et similia.  Otherwise, normally the connection is
established only when a freshly-spawned httpd executes a query for the
first time, and should persist until it reaches 'MaxRequestsPerChild"
in httpd.conf - then the httpd instance is terminated and the
connection is closed automatically.

 I have been wondering how one could automatically preload a Python
module upon start of a new httpd, so users would not have to endure
the occasional delay due to the opening of a new connection to the
database.  I suspect it may be possible by using some apache
directives, but I haven't really looked into it yet :)

-- Shade

From grisha at ispol.com  Sun May 28 22:22:13 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:51:58 2004
Subject: [mod_python] Hi, database connection queston
In-Reply-To: <m31z2mnplh.fsf@spike.interalta.com>
Message-ID: <Pine.LNX.4.21.0005282218240.16648-100000@saturn.ispol.com>

On 28 May 2000, Danilo Fiorenzano wrote:

>  I have been wondering how one could automatically preload a Python
> module upon start of a new httpd, so users would not have to endure
> the occasional delay due to the opening of a new connection to the
> database.  I suspect it may be possible by using some apache
> directives, but I haven't really looked into it yet :)

Such directive does not exist just yet, but it is planned for the future.

Grisha


From grisha at ispol.com  Mon May 29 11:44:15 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:51:58 2004
Subject: [mod_python] quick code review
In-Reply-To: <Pine.LNX.4.10.10005251801100.16846-100000@nebula.lyra.org>
Message-ID: <Pine.LNX.4.21.0005291123250.18967-100000@saturn.ispol.com>

On Thu, 25 May 2000, Greg Stein wrote:

> *) rather than storing the "request object" into r->notes, place it into
>    tstate->dict. you won't have to do the atoi() stuff (which is Bad
>    anyways)

This won't work. Or rather it will, but it's getting too complex to be
worth it. 

The problem is that a single request can span multiple thread states - a
typical scenario is when there is a PythonAuthenHandler directive
somewhere in a parent directory and a PythonHandler directive in a
subdirectory. The two handlers will be executed in different
subinterpreters, thereofre having different tstates and result in two
separate requestobjects being instantiated. 

So you get the malloc penalty plus the complexity of dealing with the
tstate->dict dictionary (which too will need to be created, another
malloc) for not much of a practical gain other than proper code, which,
btw, becomes kind of arcane and hard to understand (a bad thing as well).

It seems to me that I am working around what is really an Apache
limitation. The request_rec is clearly the right place to store a pointer
to a requestobject for that request_rec, the limitation is that the place
alloted for these sorts of things (r->notes) only deals with strings.

I think there needs to be something similar to r->notes that can take a
pointer. For now, I think I'm going to revert to the atoi stuff...

Grisha


From grisha at ispol.com  Mon May 29 13:13:51 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:51:58 2004
Subject: [mod_python] mod_python 2.1
Message-ID: <Pine.LNX.4.21.0005291305150.19547-100000@saturn.ispol.com>

Is available for download. Functionally, it should be equivalent to 2.0
(i.e. no new features), internally, a lot of changes were made mostly
resulting in cleaner code, better performance and security, as well as
(eventually) stability ("eventually" because stability is something that
I'd rather not brag about after having made so many changes). BIG THANKS
to Greg Stein for taking the time to review the code and comments.

Enjoy!

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com



From gstein at lyra.org  Mon May 29 12:36:10 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:51:58 2004
Subject: [mod_python] quick code review
In-Reply-To: <Pine.LNX.4.21.0005291123250.18967-100000@saturn.ispol.com>
Message-ID: <Pine.LNX.4.10.10005291225280.14857-100000@nebula.lyra.org>

On Mon, 29 May 2000, Gregory Trubetskoy wrote:
> On Thu, 25 May 2000, Greg Stein wrote:
> 
> > *) rather than storing the "request object" into r->notes, place it into
> >    tstate->dict. you won't have to do the atoi() stuff (which is Bad
> >    anyways)
> 
> This won't work. Or rather it will, but it's getting too complex to be
> worth it. 
> 
> The problem is that a single request can span multiple thread states - a
> typical scenario is when there is a PythonAuthenHandler directive
> somewhere in a parent directory and a PythonHandler directive in a
> subdirectory. The two handlers will be executed in different
> subinterpreters, thereofre having different tstates and result in two
> separate requestobjects being instantiated. 

All right. Fair enough.

Apache will use a single thread, but the multiple interpreters is a good
point (that I hadn't seen).

>...
> It seems to me that I am working around what is really an Apache
> limitation. The request_rec is clearly the right place to store a pointer
> to a requestobject for that request_rec, the limitation is that the place
> alloted for these sorts of things (r->notes) only deals with strings.

True.

> I think there needs to be something similar to r->notes that can take a
> pointer. For now, I think I'm going to revert to the atoi stuff...

At least use atol(). Still far from portable, but better.

(in the "ascii" scheme, the "best" would be to use PyLong_FromVoidPtr(),
 then convert that long to a string; reverse that sequence for the other
 direction)

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/


From gstein at lyra.org  Mon May 29 12:43:49 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:51:58 2004
Subject: [mod_python] quick code review
In-Reply-To: <Pine.LNX.4.21.0005281654430.15397-100000@saturn.ispol.com>
Message-ID: <Pine.LNX.4.10.10005291242580.14857-100000@nebula.lyra.org>

On Sun, 28 May 2000, Gregory Trubetskoy wrote:
> On Thu, 25 May 2000, Greg Stein wrote:
> > *) exit(1) should not be used; use ap_log_rerror() and return failure
> >    codes to Apache
> 
> are you sure?
> 
> the module initializer is a void *, its return doesn't seem to be checked
> at all.

I was referring more to the make_obcallback() function.

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/


From grisha at ispol.com  Mon May 29 20:42:33 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:51:58 2004
Subject: [mod_python] quick code review
In-Reply-To: <Pine.LNX.4.10.10005291242580.14857-100000@nebula.lyra.org>
Message-ID: <Pine.LNX.4.21.0005292040440.21046-100000@saturn.ispol.com>

On Mon, 29 May 2000, Greg Stein wrote:

> I was referring more to the make_obcallback() function.

Rats - I didn't it even see it there! Will fix in 2.2.

Grisha


From grisha at ispol.com  Mon May 29 20:55:32 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:51:58 2004
Subject: [mod_python] SUCCESS-- mod_python as DSO
In-Reply-To: <20000529104801.B29367@quark.emich.edu>
Message-ID: <Pine.LNX.4.21.0005292044500.21046-100000@saturn.ispol.com>

Curious.... I do most of my development and testing on FreeBSD 4.0 and
occasional testing on a Debian Linux (Potato) and a Sun Sparc (Sol 2.7).
On one FreeBSD system I have a very similar ClearModuleList set up (the
default FreeBSD Apache port install). I have LoadModule python_module dead
last and it works great...

I guess I'm going to have to install Red Hat somewhere, since it seems to
be the most popular thing out there....

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com~

On Mon, 29 May 2000, Jeff wrote:

> On Sun, May 28, 2000 at 02:10:32PM -0400, Gregory Trubetskoy wrote:
> > 
> > Could you send a list of all LoadModules you had and the sequence that
> > works and the one that doesn't?
> > 
> 
> The following sequence works. This list is a piece of the most stripped down
> config I could make and still have a useful webserver. It could probably be
> trimmed even more.
> 
> LoadModule python_module      modules/mod_python.so
> LoadModule env_module         modules/mod_env.so
> LoadModule config_log_module  modules/mod_log_config.so
> LoadModule agent_log_module   modules/mod_log_agent.so
> LoadModule referer_log_module modules/mod_log_referer.so
> LoadModule mime_module        modules/mod_mime.so
> LoadModule negotiation_module modules/mod_negotiation.so
> LoadModule status_module      modules/mod_status.so
> LoadModule autoindex_module   modules/mod_autoindex.so
> LoadModule dir_module         modules/mod_dir.so
> LoadModule userdir_module     modules/mod_userdir.so
> LoadModule alias_module       modules/mod_alias.so
> LoadModule rewrite_module     modules/mod_rewrite.so
> LoadModule access_module      modules/mod_access.so
> LoadModule setenvif_module    modules/mod_setenvif.so
> 
> ClearModuleList
> AddModule mod_env.c
> AddModule mod_log_config.c
> AddModule mod_log_agent.c
> AddModule mod_log_referer.c
> AddModule mod_mime.c
> AddModule mod_negotiation.c
> AddModule mod_status.c
> AddModule mod_autoindex.c
> AddModule mod_dir.c
> AddModule mod_userdir.c
> AddModule mod_alias.c
> AddModule mod_rewrite.c
> AddModule mod_access.c
> AddModule mod_so.c
> AddModule mod_setenvif.c
> AddModule mod_python.c
> 
> If I change the list so that mod_python is loaded *last* (or, apparently,
> anything other than first), Apache will core dump. I haven't tried changing
> the sequence of the 'AddModule' directives to see if it changes the
> situation. Please let me know if that would be a useful test, or if there
> are any more questions or concerns.
> 
> Regards,
> J
> -- 
> || visit gfd <http://quark.emich.edu/>
> || psa member -- <http://www.python.org/psa/> 
> 


From aiglauer at yahoo.com  Wed May 31 05:38:17 2000
From: aiglauer at yahoo.com (Alexis Iglauer)
Date: Fri Jan  9 21:51:58 2004
Subject: [mod_python] Python as a DSO problems
Message-ID: <20000531123817.9586.qmail@web2205.mail.yahoo.com>

I have had exactly the same problem in Mandrake 6.0
and Mandrake 7.0 - core dump if mod_python is at the
bottom of the list, works at the top.

I had another problem in MDK 7.0 - I had to install
the files from the mod_packages/ dir into
/usr/lib/python-1.5/site-packages - it did not work in
a mod_python subirectory off that folder.  Could just
have been an effect of a late night too though.

aei

__________________________________________________
Do You Yahoo!?
Send instant messages & get email alerts with Yahoo! Messenger.
http://im.yahoo.com/

From aiglauer at yahoo.com  Wed May 31 05:43:03 2000
From: aiglauer at yahoo.com (Alexis Iglauer)
Date: Fri Jan  9 21:51:58 2004
Subject: [mod_python] Modules not reloading when changed
Message-ID: <20000531124303.145.qmail@web2206.mail.yahoo.com>

I am developing a CGI app using the cgihandler.  There
are several different pages, each with their own .py
file and there is one .py file (SLobj.py) which is
imported by nearly all these individual files, but is
never used by apache directly.  The problem I have is
that the website runs old code - I can see from the
debug logs that it is running old code from SLobj.py
which I have already changed.

Is there a way to force mod_python to reload the .py
modules?  I am not using PythonNoReload.

Thanks
aei

__________________________________________________
Do You Yahoo!?
Send instant messages & get email alerts with Yahoo! Messenger.
http://im.yahoo.com/

From grisha at ispol.com  Wed May 31 09:17:51 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:51:58 2004
Subject: [mod_python] Modules not reloading when changed
In-Reply-To: <20000531124303.145.qmail@web2206.mail.yahoo.com>
Message-ID: <Pine.LNX.4.21.0005310856020.28492-100000@saturn.ispol.com>


On Wed, 31 May 2000, Alexis Iglauer wrote:

> Is there a way to force mod_python to reload the .py
> modules?  I am not using PythonNoReload.

Unfortunately, mod_python has no way of controlling what modules your
scripts will be importing and making them reload.

There are a few ways to force a reload of modules that have changed and
are imported "indirectly":

1. The obvious - restart the server. 

2. The not so obvious - invoke the module that needs reloading directly
via a URL.  This will produce an error, but will force the module to
reload. This doesn't work too well when the module is not in one of the
WWW accessible directories because you will get a "File not found".

Another catch with this approach is that you will have to do this as many
times as there are apache server processes currently running.

3. Recommended approach. Create a debug flag in your scripts and do a
reload when it is on:

DEBUG = 1

import mymodulea
import mymoduleb
import string
import cgi

if DEBUG:
	mymodulea = reload(mymodulea)
	mymoduleb = reload(mymoduleb)

When you're done debugging, you set DEBUG to 0 or None.

HTH,

Grisha


From grisha at ispol.com  Thu May 11 18:04:09 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:28 2004
Subject: [mod_python] This is just a test
Message-ID: <Pine.LNX.4.21.0005111803520.9333-100000@saturn.ispol.com>

Hello there!

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com


From peter at wl.vg  Sat May 13 20:25:53 2000
From: peter at wl.vg (Peter Halliday)
Date: Fri Jan  9 21:58:28 2004
Subject: [mod_python] use rpms, no src directory for apache
Message-ID: <391DF291.4BB5F774@wl.vg>

I am a developer that does a lot of online applications.  I am
interested in switching to python, because of its OOP and scalibility.
I am very impressed with python.  However, the problem is that I don't
have a src/modules directory.  I am runnign Red Hat 6.1 and installed
apache with their rpms.  Can you please help me.

<!--
Peter Halliday                            |   peter@whetstonelogic.com
Online Application Developer  |   IM   ScreenName: hoaggelos
Whetstone Logic, Inc.              |
-->


From jam at quark.emich.edu  Sun May 14 20:52:44 2000
From: jam at quark.emich.edu (Jeff)
Date: Fri Jan  9 21:58:28 2004
Subject: [mod_python] configuration of mod_python as DSO
Message-ID: <20000514205244.D11083@quark.emich.edu>

greetings,

I've done some preliminary work on a RedHat 6.2 box to get mod_python to
compile as a DSO module, and I've so far had limited success-- I'd rather
not have to rebuild apache from sources to get this functionality.

to start, I built the .so with the following command:

% /usr/sbin/apxs -Wl,-export-dynamic -L/usr/lib/python1.5/config \
-I/usr/include/python1.5/ -I/usr/include/apache -c mod_python.c -lpython1.5 \
-lpthread

I then copied the resulting .so module to /usr/lib/apache:
% sudo cp mod_python.so /usr/lib/apache

I then added these lines to the /etc/httpd/conf/httpd.conf file:
LoadModule python_module        modules/mod_python.so
AddModule mod_python.c

The 'LoadModule' directive was inserted in the group of 'LoadModule' lines that
were already in the file, and the same with AddModule. I just put them at
the end of their respective lists.

Since the machine I'm installing this on is not production, I made a
.htaccess file in /home/httpd/html containing the following:
-- begin .htaccess --
AddHandler python-program .py
PythonDebug
PythonHandler test
-- end .htacess --

My 'test.py' file contains the following:
-- begin test.py --
from mod_python import apache

def handler(req):
  req.send_http_header()
  req.write("Hello World!")
  return apache.OK
-- end test.py --

I then restarted apache:
[~] [8:21pm] [jam@toast-pts/2] % /etc/rc.d/init.d/httpd status
httpd dead but subsys locked
[~] [8:21pm] [jam@toast-pts/2] % sudo /etc/rc.d/init.d/httpd restart
Password:
Shutting down http:                                        [FAILED]
Starting httpd:                                            [  OK  ]
[~] [8:21pm] [jam@toast-pts/2] % /etc/rc.d/init.d/httpd status
httpd dead but subsys locked

any clues as to where I might have gone wrong?

regards,
J
-- 
|| visit gfd <http://quark.emich.edu/>
|| psa member -- <http://www.python.org/psa/> 

From echuck at mindspring.com  Tue May 16 07:52:19 2000
From: echuck at mindspring.com (Chuck Esterbrook)
Date: Fri Jan  9 21:58:28 2004
Subject: [mod_python] Handlers
Message-ID: <39213673.4F54B5B9@mindspring.com>

Hi, I noticed that you have 3 out-of-the-box handlers including one for ZPublisher. I was wondering if you would be interested in providing a handler for Webware for Python?

We already have 2 handlers, one for CGI and another for FastCGI. Actually, there is also a 3rd for AOLserver provided by the AOLserver time which, like you, packages ready-made handlers (we call them adaptors).

The URL is below in my .sig.  :-)

-Chuck
____________________________________________________________

http://webware.sourceforge.net

From grisha at ispol.com  Tue May 16 08:04:07 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:28 2004
Subject: [mod_python] Handlers
In-Reply-To: <39213673.4F54B5B9@mindspring.com>
Message-ID: <Pine.LNX.4.21.0005160758040.3709-100000@saturn.ispol.com>

On Tue, 16 May 2000, Chuck Esterbrook wrote:

> 
> Hi, I noticed that you have 3 out-of-the-box handlers including one
> for ZPublisher. I was wondering if you would be interested in
> providing a handler for Webware for Python?

"providing" as in "writing"? Probably not, there is enough things to do
with mod_python (like DSO) that I'd rather not get distracted on
handlers...

(What is webware, BTW? I couldn't gather from the website what it is and
didn't feel like downloading it right now.)

My vision for mod_python is that of a very simple piece of software, in
fact I'm not even sure that the three handlers that come with it *should*
be part of the package...

BUT, you and everyone else are more than welcome to contribute, we could
create a section on the website for additional handlers.

> We already have 2 handlers, one for CGI and another for FastCGI.

When you say "handler" do you mean it is a mod_python handler, or some
other handler?

Grisha


From grisha at ispol.com  Tue May 16 22:12:54 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:28 2004
Subject: [mod_python] DSO
In-Reply-To: <20000515210702.A19290@yetix.sz-sb.de>
Message-ID: <Pine.LNX.4.21.0005162200180.20825-100000@saturn.ispol.com>

I just tried mod_python as a dso on 

Linux 2.2.14 (Debian [potato])
gcc 2.9.52
libc6
python 1.5.2 with and without threads
apache-3.1.12

and it seems to work OK, at least the test.py does.

I used 

apxs -I /usr/local/include/python1.5 -c mod_python.c \
     /usr/local/lib/python1.5/config/libpython1.5.a  \
     -lpthead

to compile the module.

On another Linux system it compiles, but Apache complains upon loading the
module that "python_module is garbled", although I think that's a libc/gcc
incompatibility problem of some sort.

On FreeBSD 4.0 STABLE apxs doesn't work at all - it gives gcc arguments
that are not allowed....

It'd be interesting to see what experiences other people have with this?

Grisha


On Mon, 15 May 2000, Andreas Jung wrote:

> 
> hehe...try to get DSO working because I dislike recompiling
> Apache for every new module :)
> 
> Andreas
>  
> 


From ralf at silicon.org  Thu May 18 13:32:38 2000
From: ralf at silicon.org (Ralf Canis)
Date: Fri Jan  9 21:58:28 2004
Subject: [mod_python] problem using regular expressions in CGI scripts
Message-ID: <20000518133238.A6940@silicon.org>

Hello,

I've just installed mod_python and have a problem with CGI scripts
using regular expressions.

apache 1.3.6
python 1.52
mod_python 1.9a

httpd.conf contains:
AddHandler python-program .py
PythonHandler cgihandler

--- snip ---
import re, sys, traceback

print 'Content-type: text/plain'
print

sys.stderr = sys.stdout

try:
  re.compile( r'foo(\(.+\))bar' )
  print 'ok'
except:
  print '\n\n'
  traceback.print_exc()
  print '\n'
--- snip ---

Opening this page in a browser and pressing refresh several times
results in the following error, one at a time. Sometimes it works :)
I've already reinstalled python and mod_python. BTW, same problem
when using PyApache!

BUT: Loading the Python interpreter as a standard CGI program always works.

Traceback (innermost last):
  File "/home/httpd/sites/ralf/test/re_err.py", line 9, in ?
    re.compile( r'foo(\(.+\))bar' )
  File "/var/tmp/python/python-root/usr/lib/python1.5/re.py", line 79, in compile
    code=pcre_compile(pattern, flags, groupindex)
pcre.error: ('back reference to non-existent subpattern', 4149)

or

Traceback (innermost last):
  File "/home/httpd/sites/ralf/test/re_err.py", line 9, in ?
    re.compile( r'foo(\(.+\))bar' )
  File "/var/tmp/python/python-root/usr/lib/python1.5/re.py", line 79, in compile
    code=pcre_compile(pattern, flags, groupindex)
pcre.error: ('\\ at end of pattern', 1886)

or

Traceback (innermost last):
  File "/home/httpd/sites/ralf/test/re_err.py", line 9, in ?
    re.compile( r'foo(\(.+\))bar' )                     
  File "/var/tmp/python/python-root/usr/lib/python1.5/re.py", line 79, in compile
    code=pcre_compile(pattern, flags, groupindex)
pcre.error: ('unmatched parentheses', 10)

or

Traceback (innermost last):
  File "/home/httpd/sites/ralf/test/re_err.py", line 9, in ?
    re.compile( r'foo(\(.+\))bar' )                     
  File "/var/tmp/python/python-root/usr/lib/python1.5/re.py", line 79, in compile
    code=pcre_compile(pattern, flags, groupindex)
pcre.error: ('regular expression too large', 0)

or

Traceback (innermost last):
  File "/home/httpd/sites/ralf/test/re_err.py", line 9, in ?
    re.compile( r'foo(\(.+\))bar' )
  File "/var/tmp/python/python-root/usr/lib/python1.5/re.py", line 79, in compile
    code=pcre_compile(pattern, flags, groupindex)
pcre.error: ('missing )', 113)


Did I miss something or is this a nasty bug? It's ugly, because MySQLdb
doesn't work because of it.

Sincerely
  Ralf

-- 
Ralf Canis            ralf@silicon.org
Germany               canis@bigfoot.com

From ralf at silicon.org  Thu May 18 14:59:53 2000
From: ralf at silicon.org (Ralf Canis)
Date: Fri Jan  9 21:58:28 2004
Subject: [mod_python] problem using regular expressions in CGI scripts
In-Reply-To: <20000518143946.O3437@lib.hel.fi>; from erno@iki.fi on Thu, May 18, 2000 at 02:39:46PM +0300
References: <20000518133238.A6940@silicon.org> <20000518143946.O3437@lib.hel.fi>
Message-ID: <20000518145953.A7140@silicon.org>

On Thu, May 18, 2000 at 02:39:46PM +0300, Erno Kuusela wrote:

Hello Erno,

> i haven't even installed mod_python yet, but a debugging idea
> came to mind...
> 
> if you compile your regular expressions, they will have a .pattern
> attribute that contains your regexp. it seem to me something
> in mod_python may be munging/interpreting \-escapes, so if
> you print the pattern out and it looks different from the
> one you put in, you might be closer to figuring out what
> is going on..

Yes, I thought so, too. Therefor I modified re.py in lib/python1.5
at line 79 (re.compile) to print the pattern right before calling
pcre_compile - it's the pattern I call it with :(
Regarding this, I guess the problem is in prce_compile, but I did
not investigate this further.

Ralf

-- 
Ralf Canis            ralf@silicon.org
Germany               canis@bigfoot.com

From grisha at ispol.com  Thu May 18 09:15:50 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:28 2004
Subject: [mod_python] problem using regular expressions in CGI scripts
In-Reply-To: <20000518145953.A7140@silicon.org>
Message-ID: <Pine.LNX.4.21.0005180903560.30961-100000@saturn.ispol.com>

Can you try running the same code in your own handler, and see where that
takes you, in other words:

httpd.conf:
AddHandler python-program .py
PythonHandler myhandler
PythonDebug

Then the myhandler.py file would have something like

--- snip ---

from mod_python import apache
import re, sys

def handler(req):

    req.content_type = 'text/plain'
    req.send_http_header()
    re.compile( r'foo(\(.+\))bar' )
    req.write('ok')
    return apache.OK

--- snip ---


Note that it is not necessary to print out the traceback - mod_python does
that for you if PythonDebug directive is specified.

Grisha


On Thu, 18 May 2000, Ralf Canis wrote:

> On Thu, May 18, 2000 at 02:39:46PM +0300, Erno Kuusela wrote:
> 
> Hello Erno,
> 
> > i haven't even installed mod_python yet, but a debugging idea
> > came to mind...
> > 
> > if you compile your regular expressions, they will have a .pattern
> > attribute that contains your regexp. it seem to me something
> > in mod_python may be munging/interpreting \-escapes, so if
> > you print the pattern out and it looks different from the
> > one you put in, you might be closer to figuring out what
> > is going on..
> 
> Yes, I thought so, too. Therefor I modified re.py in lib/python1.5
> at line 79 (re.compile) to print the pattern right before calling
> pcre_compile - it's the pattern I call it with :(
> Regarding this, I guess the problem is in prce_compile, but I did
> not investigate this further.
> 
> Ralf
> 
> -- 
> Ralf Canis            ralf@silicon.org
> Germany               canis@bigfoot.com
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 





From ralf at silicon.org  Fri May 19 10:33:56 2000
From: ralf at silicon.org (Ralf Canis)
Date: Fri Jan  9 21:58:28 2004
Subject: [mod_python] SOLVED: problem using regular expressions in CGI scripts
Message-ID: <20000519103356.A1499@silicon.org>

Hi,

I found what caused this strange problem: loading mod_python dynamically!
(build+installed using apxs).

Thanks everybody
  Ralf
-- 
Ralf Canis            ralf@silicon.org
Germany               canis@bigfoot.com

From grisha at ispol.com  Fri May 19 07:39:55 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:28 2004
Subject: [mod_python] SOLVED: problem using regular expressions in CGI
 scripts
In-Reply-To: <20000519103356.A1499@silicon.org>
Message-ID: <Pine.LNX.4.21.0005190737330.5106-100000@saturn.ispol.com>

Very cusrious. 

The dynamic loading by itself shouldn't make the module act any
differently. It's probably not the dynamic loading itself, but rather that
as a result of dynamic loading some libraries get rearranged?

I haven't had the time to look at this yet as I've been busy perfecting
the documentation and working out other DSO issues, but I will try soon.

Grisha

On Fri, 19 May 2000, Ralf Canis wrote:

> Hi,
> 
> I found what caused this strange problem: loading mod_python dynamically!
> (build+installed using apxs).
> 
> Thanks everybody
>   Ralf
> -- 
> Ralf Canis            ralf@silicon.org
> Germany               canis@bigfoot.com
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From grisha at ispol.com  Fri May 19 19:47:06 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:28 2004
Subject: [mod_python] problem using regular expressions in CGI scripts
In-Reply-To: <20000518152302.A7535@silicon.org>
Message-ID: <Pine.LNX.4.21.0005191945410.8192-100000@saturn.ispol.com>

I'm unable to reproduce this. Tried it as DSO, on Linux and FreeBSD and it
works fine...

Anybody else on the list want to try it?

Grisha


On Thu, 18 May 2000, Ralf Canis wrote:

> On Thu, May 18, 2000 at 09:15:50AM -0400, Gregory Trubetskoy wrote:
> 
> Hi Grisha,
> 
> same errors, here's one for example.
> 
> Ralf
> 
> ---snip---
> \nERROR mod_python: "PythonHandler myhandler"
> 
> Traceback (innermost last):
> 
>   File "/usr/lib/python1.5/site-packages/mod_python/apache.py", line 110, in Dispatch
>     result = object(req)
> 
>   File "./myhandler.py", line 8, in handler
>     re.compile( r'foo(\(.+\))bar' )
> 
>   File "/usr/lib/python1.5/re.py", line 79, in compile
>     code=pcre_compile(pattern, flags, groupindex)
> 
> pcre.error: ('missing )', 2493)
> 
> 
> NOTE: More output from other handlers, if any, may follow.
> This will NOT happen, and request processing will STOP
> at this point when you remove PythonDebug directive.
> ---snip---
> 
> > 
> > Can you try running the same code in your own handler, and see where that
> > takes you, in other words:
> > 
> > httpd.conf:
> > AddHandler python-program .py
> > PythonHandler myhandler
> > PythonDebug
> > 
> > Then the myhandler.py file would have something like
> > 
> > --- snip ---
> > 
> > from mod_python import apache
> > import re, sys
> > 
> > def handler(req):
> > 
> >     req.content_type = 'text/plain'
> >     req.send_http_header()
> >     re.compile( r'foo(\(.+\))bar' )
> >     req.write('ok')
> >     return apache.OK
> > 
> > --- snip ---
> > 
> > 
> > Note that it is not necessary to print out the traceback - mod_python does
> > that for you if PythonDebug directive is specified.
> > 
> > Grisha
> > 
> > 
> > On Thu, 18 May 2000, Ralf Canis wrote:
> > 
> > > On Thu, May 18, 2000 at 02:39:46PM +0300, Erno Kuusela wrote:
> > > 
> > > Hello Erno,
> > > 
> > > > i haven't even installed mod_python yet, but a debugging idea
> > > > came to mind...
> > > > 
> > > > if you compile your regular expressions, they will have a .pattern
> > > > attribute that contains your regexp. it seem to me something
> > > > in mod_python may be munging/interpreting \-escapes, so if
> > > > you print the pattern out and it looks different from the
> > > > one you put in, you might be closer to figuring out what
> > > > is going on..
> > > 
> > > Yes, I thought so, too. Therefor I modified re.py in lib/python1.5
> > > at line 79 (re.compile) to print the pattern right before calling
> > > pcre_compile - it's the pattern I call it with :(
> > > Regarding this, I guess the problem is in prce_compile, but I did
> > > not investigate this further.
> > > 
> -- 
> Ralf Canis            ralf@silicon.org
> Germany               canis@bigfoot.com
> 


From stevena at permanent.cc  Sat May 20 23:42:32 2000
From: stevena at permanent.cc (Steven D. Arnold)
Date: Fri Jan  9 21:58:28 2004
Subject: [mod_python] apache compile problems
Message-ID: <4.3.1.2.20000520233846.014d7ee8@phear.dementian.com>

Hi,

I'm trying to compile apache with mod_python and I'm getting the following 
error:

[root@catatonia apache_1.3.12]# ./configure 
--activate-module=src/modules/extra/mod_python.c --prefix=/usr/local/apache 
--enable-module=all
Configuring for Apache, Version 1.3.12
  + using installation path layout: Apache (config.layout)
  + activated python module (modules/extra/mod_python.c)
Creating Makefile
Creating Configuration.apaci in src
grep: /usr/lib/python1.5/config/Makefile: No such file or directory
grep: /usr/lib/python1.5/config/Makefile: No such file or directory
grep: /usr/lib/python1.5/config/Makefile: No such file or directory
grep: /usr/lib/python1.5/config/Makefile: No such file or directory
cd ..; gcc  -DLINUX=2 -DUSE_HSREGEX -DUSE_EXPAT -I./lib/expat-lite 
`./apaci` -I/usr/include/python1.5    -o helpers/dummy 
helpers/dummy.c   -lm -lcrypt -lndbm -ldb 
/usr/lib/python1.5/config/libpython1.5.a   -ldl
gcc: /usr/lib/python1.5/config/libpython1.5.a: No such file or directory
make: *** [dummy] Error 1
Creating Makefile in src
  + configured for Linux platform
  + setting C compiler to gcc
  + setting C pre-processor to gcc -E
  + checking for system header files
  + adding selected modules
     o rewrite_module uses ConfigStart/End
  + using -lndbm for DBM support
       enabling DBM support for mod_rewrite
     o dbm_auth_module uses ConfigStart/End
     o db_auth_module uses ConfigStart/End
       using Berkeley-DB/2.x for mod_auth_db (-ldb)
     o python_module uses ConfigStart/End
  + using -ldl for vendor DSO support
  + checking sizeof various data types
  + doing sanity check on compiler and options
** A test compilation with your Makefile configuration
** failed.  The below error output from the compilation
** test will give you an idea what is failing. Note that
** Apache requires an ANSI C Compiler, such as gcc.

======== Error Output for sanity check ========
============= End of Error Report =============

  Aborting!


I have no directory /usr/lib/python1.5/config, though the parent of that 
dir does exist.  I just freshly installed python 1.5.2 before trying the 
above.  Platform is Red Hat Linux 6.2.  Any ideas?


steve

--
Steven D. Arnold          Que quiero sera           stevena@permanent.cc
"We choose to go to the moon in this decade and do the other things, not
because they are easy, but because they are hard."    -- John F. Kennedy


From stevena at permanent.cc  Sun May 21 00:28:14 2000
From: stevena at permanent.cc (Steven D. Arnold)
Date: Fri Jan  9 21:58:28 2004
Subject: [mod_python] [SOLVED] apache compile problems
In-Reply-To: <4.3.1.2.20000520233846.014d7ee8@phear.dementian.com>
Message-ID: <4.3.1.2.20000521002528.015faf08@phear.dementian.com>

For some reason, the original installation of python on my system didn't 
have a config dir inside /usr/lib/python1.5.  I reinstalled python and it 
made sys.exec_prefix /usr/local; however, it didn't replace the old copies 
of python sitting in /usr/bin.  (It did put new copies in 
/usr/local/bin.)  When I deleted the old copies and created symlinks to the 
new copies, python then knew to look in /usr/local/lib/python1.5/config, 
and all was well.


steve

--
Steven D. Arnold          Que quiero sera           stevena@permanent.cc
"We choose to go to the moon in this decade and do the other things, not
because they are easy, but because they are hard."    -- John F. Kennedy


From jam at quark.emich.edu  Sun May 21 08:04:35 2000
From: jam at quark.emich.edu (Jeff)
Date: Fri Jan  9 21:58:29 2004
Subject: [mod_python] apache compile problems
In-Reply-To: <4.3.1.2.20000520233846.014d7ee8@phear.dementian.com>; from stevena@permanent.cc on Sat, May 20, 2000 at 11:42:32PM -0400
References: <4.3.1.2.20000520233846.014d7ee8@phear.dementian.com>
Message-ID: <20000521080435.A1765@quark.emich.edu>

On Sat, May 20, 2000 at 11:42:32PM -0400, Steven D. Arnold wrote:
> Hi,
> 
> I'm trying to compile apache with mod_python and I'm getting the following 
> error:
[...snipped...]
> 
> ======== Error Output for sanity check ========
> ============= End of Error Report =============
> 
>   Aborting!
> 
> 
> I have no directory /usr/lib/python1.5/config, though the parent of that 
> dir does exist.  I just freshly installed python 1.5.2 before trying the 
> above.  Platform is Red Hat Linux 6.2.  Any ideas?
> 
> 
> steve
> 

be sure that the python-devel package has been installed before attempting
the build.

hope that helps ;)

regards,
J
-- 
|| visit gfd <http://quark.emich.edu/>
|| psa member -- <http://www.python.org/psa/> 

From wayne.izatt at myself.com  Sun May 21 14:38:05 2000
From: wayne.izatt at myself.com (Wayne Izatt)
Date: Fri Jan  9 21:58:29 2004
Subject: [mod_python] .htaccess and httpd.conf
Message-ID: <3928573C.EFEB5271@myself.com>

Hi all. I've built and installed a mod_python enabled apache. However,
I'm not sure what, if any, directives I need to add to httpd.conf to get
it to pass .py files to the python handler. When I point my browser at
the test script, all that I get is the script in the browser window.

Perhaps someone has a sample httpd.conf (just the handler stuff will do)
or a vanilla .htaccess (if that's where the directives should go).

(Yes, I've followed the installation instructions, but something simple
is still eluding me).

cheers


From stevena at permanent.cc  Sun May 21 17:56:24 2000
From: stevena at permanent.cc (Steven D. Arnold)
Date: Fri Jan  9 21:58:29 2004
Subject: [mod_python] .htaccess and httpd.conf
In-Reply-To: <3928573C.EFEB5271@myself.com>
Message-ID: <4.3.1.2.20000521175332.01f98ee8@phear.dementian.com>

At 02:38 PM 5/21/2000 -0700, Wayne Izatt wrote:
>Hi all. I've built and installed a mod_python enabled apache. However,
>I'm not sure what, if any, directives I need to add to httpd.conf to get
>it to pass .py files to the python handler. When I point my browser at
>the test script, all that I get is the script in the browser window.
>
>Perhaps someone has a sample httpd.conf (just the handler stuff will do)
>or a vanilla .htaccess (if that's where the directives should go).
>
>(Yes, I've followed the installation instructions, but something simple
>is still eluding me).

I'm having the same experience.

I tried the following directives:

Alias /python /usr/local/apache/htdocs/python

<Location /python/>
     AllowOverride All
     AddHandler python-program .py
     PythonDebug
     PythonHandler test
</Location>


When I try loading the page, I get this error:

\nERROR mod_python: "PythonHandler test"

Traceback (innermost last):

File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 
107, in Dispatch object = self.resolve_object(module_name, object_str)

File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 
70, in resolve_object raise "ResolveError", "Couldn't resolve object '%s' 
in module '%s'." % \

ResolveError: Couldn't resolve object 'handler' in module 'test'.

NOTE: More output from other handlers, if any, may follow. This will NOT 
happen, and request processing will STOP at this point when you remove 
PythonDebug directive.


I'm not quite sure what I'm doing wrong.  Any ideas?


steve

--
Steven D. Arnold          Que quiero sera           stevena@permanent.cc
"We choose to go to the moon in this decade and do the other things, not
because they are easy, but because they are hard."    -- John F. Kennedy


From wayne.izatt at myself.com  Sun May 21 15:37:21 2000
From: wayne.izatt at myself.com (Wayne Izatt)
Date: Fri Jan  9 21:58:29 2004
Subject: [Fwd: [mod_python] .htaccess and httpd.conf]
Message-ID: <39286520.67A1B247@myself.com>

Victory. Here's what I did.

added:

AddModule mod_python.c

after the other added modules.

added this directive:

<Directory "/usr/local/apache/htdocs/ptest">
    AddHandler python-program .py
    PythonDebug
    PythonHandler test
</Directory>

and everything works fine.

thanks all

Wayne Izatt wrote:

> Hi all. I've built and installed a mod_python enabled apache. However,
> I'm not sure what, if any, directives I need to add to httpd.conf to get
> it to pass .py files to the python handler. When I point my browser at
> the test script, all that I get is the script in the browser window.
>
> Perhaps someone has a sample httpd.conf (just the handler stuff will do)
> or a vanilla .htaccess (if that's where the directives should go).
>
> (Yes, I've followed the installation instructions, but something simple
> is still eluding me).
>
> cheers
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python




From grisha at ispol.com  Sun May 21 19:11:37 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:29 2004
Subject: [mod_python] .htaccess and httpd.conf
In-Reply-To: <4.3.1.2.20000521175332.01f98ee8@phear.dementian.com>
Message-ID: <Pine.LNX.4.21.0005211909500.29474-100000@saturn.ispol.com>

This means that test.py doesn't have a function called "handler" defined
in it.

What's in your test.py?

Grisha


On Sun, 21 May 2000, Steven D. Arnold wrote:

> When I try loading the page, I get this error:
> 
> ResolveError: Couldn't resolve object 'handler' in module 'test'.
> 


From stevena at permanent.cc  Sun May 21 20:05:44 2000
From: stevena at permanent.cc (Steven D. Arnold)
Date: Fri Jan  9 21:58:29 2004
Subject: [mod_python] .htaccess and httpd.conf
In-Reply-To: <Pine.LNX.4.21.0005211909500.29474-100000@saturn.ispol.com>
References: <4.3.1.2.20000521175332.01f98ee8@phear.dementian.com>
Message-ID: <4.3.1.2.20000521200358.015c0300@phear.dementian.com>

At 07:11 PM 5/21/2000 -0400, Gregory Trubetskoy wrote:

>This means that test.py doesn't have a function called "handler" defined
>in it.
>
>What's in your test.py?

I put exactly what the docs suggest:

from mod_python import apache

def handler(req):
         req.send_http_header()
         req.write("Hello World!")
         return apache.OK


However, I made the changes Wayne suggested, and now it works for me. 
:-)  (It didn't initially, but it does now -- I can't explain 
why.)  Apparently the AddModule and Directory directives did it...


steve


--
Steven D. Arnold          Que quiero sera           stevena@permanent.cc
"We choose to go to the moon in this decade and do the other things, not
because they are easy, but because they are hard."    -- John F. Kennedy


From grisha at ispol.com  Mon May 22 19:19:38 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:29 2004
Subject: [mod_python] mod_python 2.0
In-Reply-To: <4.3.1.2.20000520233846.014d7ee8@phear.dementian.com>
Message-ID: <Pine.LNX.4.21.0005211901010.29474-100000@saturn.ispol.com>


Is out on the site - http://www.modpython.org/

(well, as soon as the DNS changes take effect - the site has moved to
another server.)

It has quite a bit of documentation improvements, especially the
installation section, as well as some significant code fixes, though no
new features. I think this version should be more or less stable because
since 1.9 I haven't really found any really major bugs or had reports of
instability, except during the install process, which is quite normal.

Unless something major turns up in the very near future, an announcement
to comp.lang.python will follow, as well as links on Python and Apache
site requested, which should up the user base a bit.... :-)

Grisha


From morton at dennisinter.com  Mon May 22 21:14:40 2000
From: morton at dennisinter.com (Damian Morton)
Date: Fri Jan  9 21:58:29 2004
Subject: [mod_python] mod_python 2.0
In-Reply-To: <Pine.LNX.4.21.0005211901010.29474-100000@saturn.ispol.com>
Message-ID: <NDBBLENPLCPAHKODFHNGMEEKDHAA.morton@dennisinter.com>

Please excuse the newbie question, as Im not as familiar with unix and
apache as Id like to be, although the availability of mod_python opens up
some very interesting possibilities.

I know from observing mod_perl people that there are some problems with
having global data shared between invokations of request handlers. Is there
some mechanism in mod_python to get around this? I understand that the issue
is that Apache runs serveral processes to optimise performance, and that
each request will likely get routed to different processes, each one having
its own (global?) data.



> -----Original Message-----
> From: mod_python-admin@modpython.org
> [mailto:mod_python-admin@modpython.org]On Behalf Of Gregory Trubetskoy
> Sent: Monday, May 22, 2000 7:20 PM
> To: mod_python list
> Subject: [mod_python] mod_python 2.0
>
>
>
>
> Is out on the site - http://www.modpython.org/
>
> (well, as soon as the DNS changes take effect - the site has moved to
> another server.)
>
> It has quite a bit of documentation improvements, especially the
> installation section, as well as some significant code fixes, though no
> new features. I think this version should be more or less stable because
> since 1.9 I haven't really found any really major bugs or had reports of
> instability, except during the install process, which is quite normal.
>
> Unless something major turns up in the very near future, an announcement
> to comp.lang.python will follow, as well as links on Python and Apache
> site requested, which should up the user base a bit.... :-)
>
> Grisha
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python


From grisha at ispol.com  Tue May 23 07:28:36 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:29 2004
Subject: [mod_python] mod_python 2.0
In-Reply-To: <NDBBLENPLCPAHKODFHNGMEEKDHAA.morton@dennisinter.com>
Message-ID: <Pine.LNX.4.21.0005230719150.7819-100000@saturn.ispol.com>

On Mon, 22 May 2000, Damian Morton wrote:

> I understand that the issue is that Apache runs serveral processes to
> optimise performance, and that each request will likely get routed to
> different processes, each one having its own (global?) data.

This is hardly a mod_python issue, but...

There are basically two common ways of sharing data - through a backend
database like MySQL or via a file. With a file you will need a locking
mechanism of some sort.

I, personally, have yet to find an application where there is a true need
for global data (other than a backend database). HTTP applications, given
the stateless nature of the protocol, have eveolved with other ways to
retain state - cookies, URL's, form data and those are usually sufficient.

HTH -

Grisha


From riku.voipio at tietoenator.com  Tue May 23 16:11:47 2000
From: riku.voipio at tietoenator.com (Riku Voipio)
Date: Fri Jan  9 21:58:29 2004
Subject: [mod_python] apache reload wont't work with DSO mod_python
Message-ID: <20000523161147.A23015@samncd.tsd.tieto.com>

Hi, 
/etc/init.d/apache reload crashes if mod_python is loaded.
Another anomility noted is, that apache wont start, if the last 
loaded module is mod_python.

Elsewell it is running smoothly.

Running Debian potato apt-get up-to-date today. 

and as for last, 
Here's a patch to fix a type on install.html

--- installation.html.old       Tue May 23 16:01:31 2000
+++ installation.html   Tue May 23 16:05:27 2000
@@ -177,8 +177,8 @@
      standard Debian Python development package installed]
 
     1. cd src/modules/extra
-    2. axps -I /usr/local/include/python1.5 -c mod_python.c \
-            /usr/local/lib/python1.5/config/libpython1.5.a -lpthread
+    2. apxs -I /usr/include/python1.5 -c mod_python.c \
+            /usr/lib/python1.5/config/libpython1.5.a -lpthread
       (You don't nead -lpthread if your Python is compiled without threads)
 


-- 
Riku Voipio
riku.voipio@tietoenator.com
09-862 60764

From grisha at ispol.com  Thu May 25 22:50:59 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:29 2004
Subject: [mod_python] quick code review
In-Reply-To: <Pine.LNX.4.10.10005251801100.16846-100000@nebula.lyra.org>
Message-ID: <Pine.LNX.4.21.0005252248100.24987-100000@saturn.ispol.com>


Thanks for taking the time to look over the code and all the comments, I
think they're all valid and I'll address them.

On Thu, 25 May 2000, Greg Stein wrote:

> *) I don't understand why the PyTypeObject's are init'd/copied in
>    python_init, rather than just doing that at the module level. For
>    example:
>      static PyTypeObject serverobjecttype = { ... };

I wonder if this is something that I had to do back in httpdapy times so
that it compiled on Visual C++...?

Grisha

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python

From grisha at ispol.com  Thu May 25 22:53:34 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:29 2004
Subject: [mod_python] reload problem
In-Reply-To: <Pine.LNX.4.10.10005251746270.16846-100000@nebula.lyra.org>
Message-ID: <Pine.LNX.4.21.0005252251390.24987-100000@saturn.ispol.com>


I think the archive is broken, BTW, ever since I moved mailman to another
machine.... I don't see any messages from today or yesterday.

I will probably recreate this list tomorrow and I'll try to make the
archives reflect everything that wasn't archived.

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Thu, 25 May 2000, Greg Stein wrote:

> [ I just subscribed, so I can't "reply" to the reload issue that I saw in
>   the archive... starting from scratch ]

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python

From gstein at lyra.org  Fri May 26 00:54:31 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:58:29 2004
Subject: [mod_python] quick code review
In-Reply-To: <Pine.LNX.4.21.0005252248100.24987-100000@saturn.ispol.com>
Message-ID: <Pine.LNX.4.10.10005260049500.21092-100000@nebula.lyra.org>

On Thu, 25 May 2000, Gregory Trubetskoy wrote:
>...
> On Thu, 25 May 2000, Greg Stein wrote:
> > *) I don't understand why the PyTypeObject's are init'd/copied in
> >    python_init, rather than just doing that at the module level. For
> >    example:
> >      static PyTypeObject serverobjecttype = { ... };
> 
> I wonder if this is something that I had to do back in httpdapy times so
> that it compiled on Visual C++...?

There is something about static initializers in MSVC. Generally, code will
add a line such as:

(from arraymodule.c)

    Arraytype.ob_type = &PyType_Type;


I don't know exactly *why* it must be done that way, but there ya go. The
underlying point is that the initialization of the type objects can be
simplified quite a bit.

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python

From gstein at lyra.org  Fri May 26 01:54:54 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:58:29 2004
Subject: [mod_python] apache.py suggestions
Message-ID: <Pine.LNX.4.10.10005260147360.21092-100000@nebula.lyra.org>

Here are a few more suggestions, but for apache.py:

*) avoid exec/eval: they are quite slow, and can pose a security risk

*) to import modules, use: module = __import__(module_name)

*) resolve_object(), use the getattr() function for traversing

*) copy a dictionary using dict.copy()

*) maybe move some of the CGI stuff off to 'cgihandler'


Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python

From mmach at batory.org.pl  Fri May 26 11:05:50 2000
From: mmach at batory.org.pl (Micha<B3> Mach)
Date: Fri Jan  9 21:58:29 2004
Subject: [mod_python] apache.py suggestions
In-Reply-To: <Pine.LNX.4.10.10005260147360.21092-100000@nebula.lyra.org>
Message-ID: <NDBBIBMMILNGAOKOEEKDEECDCEAA.mmach@batory.org.pl>


Hi,

> *) to import modules, use: module = __import__(module_name)

Why so? That's perhaps more like the Python question than mod_python matter,
but anyway...

Best,
Michal


---
Michal Mach   mmach@batory.org.pl
Stefan Batory Foundation
http://www.batory.org.pl/

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python

From gstein at lyra.org  Fri May 26 03:39:52 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:58:29 2004
Subject: [mod_python] apache.py suggestions
In-Reply-To: <NDBBIBMMILNGAOKOEEKDEECDCEAA.mmach@batory.org.pl>
Message-ID: <Pine.LNX.4.10.10005260335290.21092-100000@nebula.lyra.org>

On Fri, 26 May 2000, Micha<B3> Mach wrote:
> > *) to import modules, use: module = __import__(module_name)
> 
> Why so? That's perhaps more like the Python question than mod_python matter,
> but anyway...

apache.py was doing something like the following:

    exec "import " + module_name
    module = eval(module_name)

The above code is horribly inefficient compared to the code I provided
(using __import__). You have two parse/compile passes at runtime. The
"exec" disables certain optimizations. I don't think the code allows it,
but if module_name happens to come from some user input, then you are
effectively executing arbitrary code. Very bad.

Python vs mod_python? Bah. I wouldn't have brought it up if it wasn't a
mod_python issue.

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python

From gstein at lyra.org  Thu May 25 17:57:13 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:58:29 2004
Subject: [mod_python] reload problem
Message-ID: <Pine.LNX.4.10.10005251746270.16846-100000@nebula.lyra.org>

[ I just subscribed, so I can't "reply" to the reload issue that I saw in
  the archive... starting from scratch ]

The reload issue might be caused by the global variables in mod_python.c.
Those values should be wiped when the configuration pool is tossed.
Specifically, a "cleanup" should be registered at the point that those
variables are allocated.

That might not truly be it, but globals are *always* suspect when dealing
with Apache modules.

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python

From gstein at lyra.org  Thu May 25 19:12:10 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:58:29 2004
Subject: [mod_python] quick code review
Message-ID: <Pine.LNX.4.10.10005251801100.16846-100000@nebula.lyra.org>

There are a number of issues that I see with mod_python.c. I'll try to
address a good number of them here, but I'm invariably going to miss some.
After some changes are made, then another pass can be done at that point.

Please try to take this constructively... the goal is to improve the
code... :-)

*) when storing the tstate into obcallback, use a PyCObject rather than an
   integer. That will avoid the (int) casting (a no-no)

*) noop is not needed; use ap_null_cleanup() (I think that's the name;
   close to it, at least)

*) simplify make_obcallback(): the two params are always NULL

*) I don't understand why the PyTypeObject's are init'd/copied in
   python_init, rather than just doing that at the module level. For
   example:
     static PyTypeObject serverobjecttype = { ... };

*) use PyImport_Import() rather than PyRun_SimpleString to get the
   module imported. This returns the "mod_python" or "mod_python.apache"
   module (I forget which; probably the former).

*) use PyObject_CallMethod() to call the "init" method in the module
   retrieved from above. Use the *return* value for obCallBack, rather
   than the SetCallback nastiness.

*) in python_directive, just use a cast to (py_dir_config *) rather than
   all the offset stuff. Also, there is no need to dup() the string since
   it is a constant.

*) unused: python_dict_merge, table2dict, print_table, print_array

*) exit(1) should not be used; use ap_log_rerror() and return failure
   codes to Apache

*) rather than storing the "request object" into r->notes, place it into
   tstate->dict. you won't have to do the atoi() stuff (which is Bad
   anyways)

*) use ap_log_rerror() instead of ap_log_error(). the former is better
   from a logging standpoint (it has more info)


That's all for now!

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/
_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python


From mmach at batory.org.pl  Fri May 26 15:45:24 2000
From: mmach at batory.org.pl (Micha³ Mach)
Date: Fri Jan  9 21:58:29 2004
Subject: [mod_python] apache.py suggestions
In-Reply-To: <Pine.LNX.4.10.10005260335290.21092-100000@nebula.lyra.org>
Message-ID: <NDBBIBMMILNGAOKOEEKDIECGCEAA.mmach@batory.org.pl>

> apache.py was doing something like the following:
>
>     exec "import " + module_name
>     module = eval(module_name)
>
> The above code is horribly inefficient compared to the code I provided
> (using __import__). You have two parse/compile passes at runtime. The
> "exec" disables certain optimizations. I don't think the code allows it,
> but if module_name happens to come from some user input, then you are
> effectively executing arbitrary code. Very bad.

Sorry, I realize now my question was stupid in fact - I assumed You're
talking about Python in general speaking about the __import__ thing. I
didn't watch see the mod_python code as carefully as You. ;-)

> Python vs mod_python? Bah. I wouldn't have brought it up if it wasn't a
> mod_python issue.

Well, the criticism was directed towards my own question, so don't take it
personally. ;-)

Best,
Michal

P.S. Perhaps I didn't mention it earlier, but I'm a happy man - noone will
tell me now that mod_perl rules. :-) One world, one language! (which means
Python, of course) :-)

---
Michal Mach   mmach@batory.org.pl
Stefan Batory Foundation
http://www.batory.org.pl/


From gstein at lyra.org  Fri May 26 08:21:34 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:58:29 2004
Subject: [mod_python] apache.py suggestions
In-Reply-To: <Pine.GSO.4.05.10005260802450.12724-100000@koi>
Message-ID: <Pine.LNX.4.10.10005260820440.23146-100000@nebula.lyra.org>

On Fri, 26 May 2000 grisha@verio.net wrote:
> On Fri, 26 May 2000, Greg Stein wrote:
> 
> > *) avoid exec/eval: they are quite slow, and can pose a security risk
> > *) to import modules, use: module = __import__(module_name)
> 
> The reasoning behind using exec to import was that __import__ doesn't
> understand dots (packages),

Eh? Sure it does.

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/


From grisha at ispol.com  Fri May 26 12:03:26 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:29 2004
Subject: [mod_python] apache.py suggestions
In-Reply-To: <Pine.LNX.4.10.10005260820440.23146-100000@nebula.lyra.org>
Message-ID: <Pine.LNX.4.21.0005261158110.27589-100000@saturn.ispol.com>

On Fri, 26 May 2000, Greg Stein wrote:

> > The reasoning behind using exec to import was that __import__ doesn't
> > understand dots (packages),
> 
> Eh? Sure it does.

Looks like it does indeed. I wonder why I put this comment in
(now obsolete) httpdapy:

                # we could use __import__ but it can't handle packages
                exec "import " + module_name

May be it's something new with 1.5 or 1.5.2? I'm almost tempted to compile
an old Python version, but I think I'll pass.... :-)

Grisha


From gstein at lyra.org  Fri May 26 09:12:23 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:58:29 2004
Subject: [mod_python] apache.py suggestions
In-Reply-To: <Pine.LNX.4.21.0005261158110.27589-100000@saturn.ispol.com>
Message-ID: <Pine.LNX.4.10.10005260909320.23146-100000@nebula.lyra.org>

On Fri, 26 May 2000, Gregory Trubetskoy wrote:
> On Fri, 26 May 2000, Greg Stein wrote:
> > > The reasoning behind using exec to import was that __import__ doesn't
> > > understand dots (packages),
> > 
> > Eh? Sure it does.
> 
> Looks like it does indeed. I wonder why I put this comment in
> (now obsolete) httpdapy:
> 
>                 # we could use __import__ but it can't handle packages
>                 exec "import " + module_name
> 
> May be it's something new with 1.5 or 1.5.2? I'm almost tempted to compile
> an old Python version, but I think I'll pass.... :-)

Yes, it is new to the Python 1.5 series. Before then, packages were only
possible if "ni" was imported. 1.5 built the logic directly into the core.

Due to the Interpreter/Thread State stuff in mod_python.c, you are
specific to Python 1.5 anyways, so relying on __import__ and packages
should be fine.

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/



From grisha at ispol.com  Fri May 26 13:13:59 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:29 2004
Subject: [mod_python] apache.py suggestions
In-Reply-To: <Pine.LNX.4.10.10005260909320.23146-100000@nebula.lyra.org>
Message-ID: <Pine.LNX.4.21.0005261303250.28220-100000@saturn.ispol.com>

OK, here is the deal - 

	exec "import " + module_name
	module = eval(module_name)

is not the same as module = __import__(module_name), but rather:

	module = __import__(module_name)
	list = string.split(module_name, ".")
	for n in list[1:]:
		module = getattr(module, n)

My quick tests on which is faster where inconclusive. The former is
less lines of code and is (IMHO) simpler to read, the latter is definitely
more secure since it doesn't have the exec or eval.

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Fri, 26 May 2000, Greg Stein wrote:

> On Fri, 26 May 2000, Gregory Trubetskoy wrote:
> > On Fri, 26 May 2000, Greg Stein wrote:
> > > > The reasoning behind using exec to import was that __import__ doesn't
> > > > understand dots (packages),
> > > 
> > > Eh? Sure it does.
> > 
k


From gstein at lyra.org  Fri May 26 10:37:22 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:58:29 2004
Subject: [mod_python] apache.py suggestions
In-Reply-To: <Pine.LNX.4.21.0005261303250.28220-100000@saturn.ispol.com>
Message-ID: <Pine.LNX.4.10.10005261024330.23146-200000@nebula.lyra.org>

On Fri, 26 May 2000, Gregory Trubetskoy wrote:
> OK, here is the deal - 
> 
> 	exec "import " + module_name
> 	module = eval(module_name)
> 
> is not the same as module = __import__(module_name), but rather:
> 
> 	module = __import__(module_name)
> 	list = string.split(module_name, ".")
> 	for n in list[1:]:
> 		module = getattr(module, n)
> 
> My quick tests on which is faster where inconclusive. The former is
> less lines of code and is (IMHO) simpler to read, the latter is definitely
> more secure since it doesn't have the exec or eval.

Mine were quite conclusive. The latter code is 4 to 6 times faster.

I've attached my timing script. Here is the output of a couple runs:

[gstein@kurgan python]$ ./time-eval.py
16.6380729675 2.65576100349 6.2648984399
22.0597770214 5.24019098282 4.20972767858
[gstein@kurgan python]$ ./time-eval.py
16.5899840593 2.59417903423 6.39508061719
21.954955101 5.28538203239 4.15390126323

Note that each run already loops through 10000 times, so the numbers above
should be quite stable.

Yes, I understand that the first import is longer than the following
imports. And that I'm not testing the cost of that first import. This is
intended: the underlying import mechanism which runs on that first import
is the same for both (e.g. the parse/load and module setup), so it can be
considered a constant factor and omitted.

Much of this may be moot anyhow since the "import" logic in question
occurs at startup only. But I don't think the use of exec/eval should ever
be encouraged :-) (performance and security)

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/
-------------- next part --------------
#!/usr/bin/env python

import time
import string

def do_timing(m):
  l = xrange(10000)

  t = time.time()
  for i in l:
    exec "import " + m
    mod = eval(m)
  t1 = time.time() - t

  t = time.time()
  for i in l:
    mod = __import__(m)
    for p in string.split(m, '.')[1:]:
      mod = getattr(mod, p)
  t2 = time.time() - t
  print t1, t2, t1/t2

do_timing('httplib')
do_timing('xml.dom.core')
From gstein at lyra.org  Fri May 26 10:49:44 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:58:29 2004
Subject: [mod_python] apache.py suggestions
In-Reply-To: <Pine.LNX.4.10.10005261024330.23146-200000@nebula.lyra.org>
Message-ID: <Pine.LNX.4.10.10005261048480.23146-100000@nebula.lyra.org>

On Fri, 26 May 2000, Greg Stein wrote:
>...
> Mine were quite conclusive. The latter code is 4 to 6 times faster.
>...
> Yes, I understand that the first import is longer than the following
> imports. And that I'm not testing the cost of that first import. This is
> intended: the underlying import mechanism which runs on that first import
> is the same for both (e.g. the parse/load and module setup), so it can be
> considered a constant factor and omitted.

Oops. One more note. I was accidentally charging that first import to the
exec/eval style. I moved that out, but it did not change the results at
all.

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/


From jbauer at rubic.com  Fri May 26 14:25:05 2000
From: jbauer at rubic.com (Jeff Bauer)
Date: Fri Jan  9 21:58:29 2004
Subject: [mod_python] quick code review
Message-ID: <392ECF91.78FD963D@rubic.com>

Many thanks to Greg for his code review and
suggestions.  The mod_python code will benefit
from Greg's experience, and the resulting product
should be easier to use and maintain.  The
earlier pyapache module had stability problems
that we shouldn't have to endure with mod_python.

-Jeff Bauer

From erno at iki.fi  Sat May 27 12:41:21 2000
From: erno at iki.fi (Erno Kuusela)
Date: Fri Jan  9 21:58:29 2004
Subject: [mod_python] quick code review
In-Reply-To: <392ECF91.78FD963D@rubic.com>; from jbauer@rubic.com on Fri, May 26, 2000 at 02:25:05PM -0500
References: <392ECF91.78FD963D@rubic.com>
Message-ID: <20000527124121.G20066@lib.hel.fi>

|                                        The
| earlier pyapache module had stability problems
| that we shouldn't have to endure with mod_python.

actually the predecessor to mod_python was httpdapy,
with which i haven't had any stability problems...

  -- erno

From jbauer at rubic.com  Sat May 27 07:10:49 2000
From: jbauer at rubic.com (Jeff Bauer)
Date: Fri Jan  9 21:58:29 2004
Subject: [mod_python] quick code review
 
Message-ID: <392FBB49.1D03D917@rubic.com>

JB>> earlier pyapache module had stability problems
JB>> that we shouldn't have to endure with mod_python.

EK> actually the predecessor to mod_python was httpdapy,
EK> with which i haven't had any stability problems...

I didn't mean to imply that pyapache was an earlier
version of mod_python, but rather that pyapache was the 
first experience of Python+Apache for many users.

-Jeff

From cobrien at Radix.Net  Sun May 28 10:29:51 2000
From: cobrien at Radix.Net (Cary O'Brien)
Date: Fri Jan  9 21:58:29 2004
Subject: [mod_python] Hi, database connection queston
Message-ID: <200005281429.KAA19075@saltmine.radix.net>

Hi,

Glad to hear about mod_python, it is almost exactly what I am looking for. 
I've used mod_perl/embperl and mod_dtcl, but I really wanted to try using
python.

I'm going to try to fire it up over the long weekend.

I've got a couple of questions (of course).

1) How are people handling persistant database connections?  Ideally (for me)
   there would be a single db connection for each apache process.  That 
   minimizes connection setup time (non-trivial for PostgreSQL at least),
   lets me control the number of database connections (apache max-servers), 
   and lets me control their lifetimes (i.e. serve 10,000 requests then exit),
   and restarts them if they die.  Nice eh?

   My question is how do I setup a shared database connection used by each
   handler?  It seems from the documentation that each request gets its own
   subinterpreter.  I'd like them all to be handled by the same sub-interpreter.
   Or, in reality, just share the same db connection.

   The python doc for Py_NewInterpreter() says

     the new interpreter has separate, independent versions of all imported modules, 

   So what happens to class variables.  Can I connect to the database there?

2) Re Zope.  There seems to be a ZPublisher interface.  Does this mean I can
   run 30 apache processes against the same Zope database?  How fine/course is
   the locking on the zope database?  I asked this on the zope list a while
   back and didn't get a good answer.

3) Does anyone have the bits to embed python calls in an html document a-la 
   embperl/php/mod_dtcl? I know mixing logic with presentation is 
   in general a bad idea, but having embedded code in documents is a fast
   way to get things up and running.
   
-- cary

Cary O'Brien
cobrien@radix.net



 





From jam at quark.emich.edu  Sun May 28 10:52:22 2000
From: jam at quark.emich.edu (Jeff)
Date: Fri Jan  9 21:58:29 2004
Subject: [mod_python] SUCCESS-- mod_python as DSO
Message-ID: <20000528105222.C25643@quark.emich.edu>

Greetings,

I'm happy to report that I was able to get Apache on a Red Hat 6.2 box
working while loading mod_python as a DSO. I took the advise of one of the
FAQ entries, and put the "LoadModule" directive up at the top (instead of
the bottom) of the list in httpd.conf, and it worked just fine (previously I
would get a core dump from Apache).

My question is: why is this necessary? Does this reflect a bug in Apache or
is it some other issue?

Regards,
J
-- 
|| visit gfd <http://quark.emich.edu/>
|| psa member -- <http://www.python.org/psa/> 

From walter at bnbt.de  Sun May 28 17:58:40 2000
From: walter at bnbt.de (Walter =?iso-8859-1?Q?D=F6rwald?=)
Date: Fri Jan  9 21:58:29 2004
Subject: [mod_python] Hi, database connection queston
In-Reply-To: <200005281429.KAA19075@saltmine.radix.net>
Message-ID: <4.3.1.0.20000528175049.00ae2ab0@mail.bnbt.de>

At 16:29 28.05.00, Cary O'Brien wrote:

>[...]
>
>3) Does anyone have the bits to embed python calls in an html document a-la
>    embperl/php/mod_dtcl?

You might want to try XIST available from
ftp://titan.bnbt.de/pub/livinglogic/xist/

It needs a little additional logic to wire the HTML files to the
mod_python RequestHandler, but this shouldn't be a big deal.

>  I know mixing logic with presentation is
>    in general a bad idea, [...]

Well XIST helps you with that too.

Bye,
         Walter D?rwald


From jam at quark.emich.edu  Sun May 28 13:53:01 2000
From: jam at quark.emich.edu (Jeff)
Date: Fri Jan  9 21:58:29 2004
Subject: [mod_python] trouble with mod_python from public_html directory
Message-ID: <20000528135301.B28853@quark.emich.edu>

Greetings,

I'm having difficulty figuring out this problem, and I'm hoping someone will
be able to help get it resolved. I'm not sure if this is a problem with
mod_rewrite or mod_python or my configuration of them.

I have the following .htaccess file in /home/jam/public_html:
[~/public_html] [1:35pm] [jam@toast-pts/2] % cat .htaccess 
AddHandler python-program .py
PythonHandler cgihandler
RewriteEngine on
RewriteCond %{REQUEST_FILENAME} !-s
RewriteRule ^(.*)\.html$          $1.py   [L]

The intent of the rewrite rule is if the URL requests a file ending in
.html, it will check first to see if that file exists (and send it as normal
if it does), and if a suitable file does *not* exist, check for a .py
extension and run that via mod_python if it does.

The above set of directives works *fine* if I install it in
/home/httpd/html.. I can request 'index.html' and it will run the 'index.py'
module I've created.

The problem starts when I copy the .htaccess file to my home directory, and
try to get the same thing to work. it doesn't. I get the following error in
the /var/log/httpd/error_log file: [Sun May 28 13:36:02 2000] [error]
[client 192.168.2.3] File does not exist:
/home/httpd/html/home/jam/public_html/index.py

This indicates the reason for the error-- it's looking for a file called
"/home/httpd/html/home/jam/public_html/index.py", which clearly doesn't
exist (it should instead be "/home/jam/public_html/index.py").

This error occurs regardless of the existence of a .htaccess file in
/home/httpd/html-- I had thought that might be part of the problem, so at
first I added a "PythonInterpPerDirectory" directive, and then renamed the
file so it wouldn't be used, and tried again-- no luck.

I'm not sure if I need to present more information before this problem can
be solved.. please let me know if I can answer any questions about the setup
that might point me in the right direction.

Thanks in advance ;)

Regards,
J
-- 
|| visit gfd <http://quark.emich.edu/>
|| psa member -- <http://www.python.org/psa/> 

From richard at whitequeen.com  Sun May 28 11:01:05 2000
From: richard at whitequeen.com (richard offer)
Date: Fri Jan  9 21:58:29 2004
Subject: [mod_python] Apache fails to start: ImportError: No module named mod_python.apache
Message-ID: <200005281801.e4SI15p04688@erij.whitequeen.com>

Hi,

Apache is failing to start when I have mod_python as a DSO on RH 6.1.

The report from the apache error log is

Traceback (innermost last):
  File "<string>", line 1, in ?
ImportError: No module named mod_python.apache
PythonInitFunction: could not import mod_python.apache.


I've rebuilt python to live under the same top level directory as Apache
(/usr/www/).

[root@erij bin]# ls /usr/www/lib/python1.5/site-packages/mod_python/
__init__.py   apache.py   cgihandler.py   httpdapi.py   zhandler.py
__init__.pyc  apache.pyc  cgihandler.pyc  httpdapi.pyc  zhandler.pyc

[root@erij bin]# ls /usr/www/libexec/
httpd.exp         mod_autoindex.so  mod_include.so      mod_rewrite.so
libproxy.so       mod_cern_meta.so  mod_info.so         mod_setenvif.so
mod_access.so     mod_cgi.so        mod_log_agent.so    mod_speling.so
mod_actions.so    mod_digest.so     mod_log_config.so   mod_status.so
mod_alias.so      mod_dir.so        mod_log_referer.so  mod_unique_id.so
mod_asis.so       mod_env.so        mod_mime.so         mod_userdir.so
mod_auth.so       mod_example.so    mod_mime_magic.so   mod_usertrack.so
mod_auth_anon.so  mod_expires.so    mod_mmap_static.so  mod_vhost_alias.so
mod_auth_db.so    mod_headers.so    mod_negotiation.so
mod_auth_dbm.so   mod_imap.so       mod_python.so

[root@erij bin]# ldd /usr/www/libexec/mod_python.so 
        libpthread.so.0 => /lib/libpthread.so.0 (0x400a9000)
        libc.so.6 => /lib/libc.so.6 (0x400bb000)
        /lib/ld-linux.so.2 => /lib/ld-linux.so.2 (0x80000000)


[root@erij bin]# /usr/www/bin/python
Python 1.5.2 (#1, May 28 2000, 08:30:59)  [GCC egcs-2.91.66 19990314/Linux (egcs- on linux2
Copyright 1991-1995 Stichting Mathematisch Centrum, Amsterdam
>>> import mod_python
>>> from mod_python import apache
Traceback (innermost last):
  File "<stdin>", line 1, in ?
  File "/usr/www/lib/python1.5/site-packages/mod_python/apache.py", line 18, in ?
    import _apache
ImportError: No module named _apache

[ I don't expect this last one to work, but its at least picking up the
right module ]



Can someone hit me with a clue stick.




richard.


-----------------------------------------------------------------------
richard offer @ home 
_______________________________http://www.whitequeen.com/users/richard/


From grisha at ispol.com  Sun May 28 14:06:26 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:30 2004
Subject: [mod_python] Hi, database connection queston
In-Reply-To: <200005281429.KAA19075@saltmine.radix.net>
Message-ID: <Pine.LNX.4.21.0005281353050.14870-100000@saturn.ispol.com>

On Sun, 28 May 2000, Cary O'Brien wrote:

> 1) How are people handling persistant database connections?
[....]
>    It seems from the documentation that each request gets its own
>    subinterpreter.

Incorrect. Each directive directory and its subdirectories get its own
subinterpreter. All requests for files in the directory where the
Python*Handler directive was first encountered and its subdirectories are
in the same subinterpreter.

This behaviour can be altered via PythonInterpreter or
PythonInterPerDirectory directives.

As far as database connections - here how I used to do it. I had a module
called data.py (this is not the entire code, some parts are cut out, think
of it as an example rather than something ready to use. cfg contained
configuration). In your scripts, you would have something like:

import data
result = data._run_sql("select * from myteable")

And it would behave exactly as you describe - initiate the db connection
once and keep it for as long as the process lives. Of course, you end up
having as many connections as there are Apache processes, which you can
control by MaxClients directive.

-------------

import cfg
import mysqldb
import string

def _db_login(relogin = 0):
    """Login to the database
    """

    global DB_CONN

    if relogin:
        DB_CONN = mysqldb.mysqldb(cfg.DB_LOGIN)
        return DB_CONN
    else:
        try:
            return DB_CONN

        except NameError:

            DB_CONN = mysqldb.mysqldb(cfg.DB_LOGIN)
            return DB_CONN

def _run_sql( sql, n = 0, with_desc=0 ):
    """ Runs SQL on the server and returns result
    """

    db = _db_login()

    try:
        cur = db.cursor()
        rc = cur.execute(sql)

    except:
        # it's possible that mysql connection
        # timed out. Try one more time.
        db = _db_login(relogin = 1)
        cur = db.cursor()
        rc = cur.execute(sql)

    if string.upper(string.split(sql)[0]) in \
       ("SELECT", "SHOW", "DESC", "DESCRIBE"):
        if n:
            recset = cur.fetchmany(n)
        else:
            recset = cur.fetchall()

        if with_desc:
            return recset, cur.description
        else:
            return recset
    else:
        return rc

------------------

> 2) Re Zope.  There seems to be a ZPublisher interface.  Does this mean I can
>    run 30 apache processes against the same Zope database?  

As I already said on comp.lang.python - no.

>    How fine/course is
>    the locking on the zope database?  I asked this on the zope list a while
>    back and didn't get a good answer.

The first process will lock the database, and all the other ones will just
sit there and wait :-(

> 3) Does anyone have the bits to embed python calls in an html document a-la 
>    embperl/php/mod_dtcl? I know mixing logic with presentation is 
>    in general a bad idea, but having embedded code in documents is a fast
>    way to get things up and running.

You can use the Z DocuemntTemplate with ZHandler, it works pretty well.

HTH,

Grisha


From grisha at ispol.com  Sun May 28 14:10:32 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:30 2004
Subject: [mod_python] SUCCESS-- mod_python as DSO
In-Reply-To: <20000528105222.C25643@quark.emich.edu>
Message-ID: <Pine.LNX.4.21.0005281408570.14870-100000@saturn.ispol.com>

Could you send a list of all LoadModules you had and the sequence that
works and the one that doesn't?


On Sun, 28 May 2000, Jeff wrote:

> I took the advise of one of the
> FAQ entries, and put the "LoadModule" directive up at the top (instead of
> the bottom) of the list in httpd.conf, and it worked just fine (previously I
> would get a core dump from Apache).


From grisha at ispol.com  Sun May 28 14:20:30 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:30 2004
Subject: [mod_python] Apache fails to start: ImportError: No module named
 mod_python.apache
In-Reply-To: <200005281801.e4SI15p04688@erij.whitequeen.com>
Message-ID: <Pine.LNX.4.21.0005281418440.14870-100000@saturn.ispol.com>

Did you rebuild mod_python after rebuilding Python and made sure that it
is linked against the new libpython library? I have a feeling mod_python
is still looking in /usr/local

Grisha

On Sun, 28 May 2000, richard offer wrote:

> 
> Hi,
> 
> Apache is failing to start when I have mod_python as a DSO on RH 6.1.
> 
> The report from the apache error log is
> 
> Traceback (innermost last):
>   File "<string>", line 1, in ?
> ImportError: No module named mod_python.apache
> PythonInitFunction: could not import mod_python.apache.
> 
> 
> I've rebuilt python to live under the same top level directory as Apache
> (/usr/www/).


From jam at quark.emich.edu  Sun May 28 14:40:34 2000
From: jam at quark.emich.edu (Jeff)
Date: Fri Jan  9 21:58:30 2004
Subject: [mod_python] trouble with mod_python from public_html directory
In-Reply-To: <Pine.LNX.4.21.0005281413050.14870-100000@saturn.ispol.com>; from grisha@ispol.com on Sun, May 28, 2000 at 02:15:01PM -0400
References: <20000528135301.B28853@quark.emich.edu> <Pine.LNX.4.21.0005281413050.14870-100000@saturn.ispol.com>
Message-ID: <20000528144034.D28853@quark.emich.edu>

On Sun, May 28, 2000 at 02:15:01PM -0400, Gregory Trubetskoy wrote:
> 
> Try replacing "AddHandler python-program .py" with "AddHandler cgi-script
> .py" and see if you get the same errors. 
> 
> This will tell you whether this is at all related to mod_python. I suspect
> it isn't - the "File not found" is not a mod_python error.
> 

You were correct.. this had nothing to do with mod_python, but rather
something odd with mod_rewrite. When I added a 'RewriteBase /~jam/'
directive to the .htaccess file in my public_html, things started working as
designed. This directive is not necessary in directories off of
/home/httpd/html, though. This isn't the generic solution I was expecting,
but it works, so I'm going to move on.

Thanks for the help.

Regards,
J
-- 
|| visit gfd <http://quark.emich.edu/>
|| psa member -- <http://www.python.org/psa/> 

From danilo at telusplanet.net  Sun May 28 18:54:02 2000
From: danilo at telusplanet.net (Danilo Fiorenzano)
Date: Fri Jan  9 21:58:30 2004
Subject: [mod_python] Hi, database connection queston
In-Reply-To: Gregory Trubetskoy's message of "Sun, 28 May 2000 14:06:26 -0400 (EDT)"
References: <Pine.LNX.4.21.0005281353050.14870-100000@saturn.ispol.com>
Message-ID: <m31z2mnplh.fsf@spike.interalta.com>

On Sun, 28 May 2000, Cary O'Brien wrote:
 
> 1) How are people handling persistant database connections?
> [....]
>    It seems from the documentation that each request gets its own
>    subinterpreter.

Since global vars retain their values between requests serviced by the
same httpd process, I ended up doing something like this:

---------------- cut ---------------- cut ---------------- cut ----------------
import informixdb
import os, re, cgi, string
from mod_python import apache

_dbconn = None

def handler(req):
    global _dbconn

    ... etc etc ...
    results = findProducts('acid')
    ... etc etc ...


def findProducts(substring):
    global _dbconn

    if _dbconn == None:
        try:
            _dbconn = informixdb.informixdb('db@server', 'user', 'password')
        except:
            return ['Access Denied']

    c = _dbconn.cursor()
    blah = "%" + string.lower(substring) + "%"

    c.execute("select strshippingname from tblproducts where lower(strshippingname) like ?", (blah,))
    retval = []
    for row in c.fetchall():
        retval.append(row[0])

    return retval

---------------- cut ---------------- cut ---------------- cut ----------------

  This works exactly as you want, although it should also have a "try:
except:" block around the actual query, to recover from dropped
connections et similia.  Otherwise, normally the connection is
established only when a freshly-spawned httpd executes a query for the
first time, and should persist until it reaches 'MaxRequestsPerChild"
in httpd.conf - then the httpd instance is terminated and the
connection is closed automatically.

 I have been wondering how one could automatically preload a Python
module upon start of a new httpd, so users would not have to endure
the occasional delay due to the opening of a new connection to the
database.  I suspect it may be possible by using some apache
directives, but I haven't really looked into it yet :)

-- Shade

From grisha at ispol.com  Sun May 28 22:22:13 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:30 2004
Subject: [mod_python] Hi, database connection queston
In-Reply-To: <m31z2mnplh.fsf@spike.interalta.com>
Message-ID: <Pine.LNX.4.21.0005282218240.16648-100000@saturn.ispol.com>

On 28 May 2000, Danilo Fiorenzano wrote:

>  I have been wondering how one could automatically preload a Python
> module upon start of a new httpd, so users would not have to endure
> the occasional delay due to the opening of a new connection to the
> database.  I suspect it may be possible by using some apache
> directives, but I haven't really looked into it yet :)

Such directive does not exist just yet, but it is planned for the future.

Grisha


From grisha at ispol.com  Mon May 29 11:44:15 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:30 2004
Subject: [mod_python] quick code review
In-Reply-To: <Pine.LNX.4.10.10005251801100.16846-100000@nebula.lyra.org>
Message-ID: <Pine.LNX.4.21.0005291123250.18967-100000@saturn.ispol.com>

On Thu, 25 May 2000, Greg Stein wrote:

> *) rather than storing the "request object" into r->notes, place it into
>    tstate->dict. you won't have to do the atoi() stuff (which is Bad
>    anyways)

This won't work. Or rather it will, but it's getting too complex to be
worth it. 

The problem is that a single request can span multiple thread states - a
typical scenario is when there is a PythonAuthenHandler directive
somewhere in a parent directory and a PythonHandler directive in a
subdirectory. The two handlers will be executed in different
subinterpreters, thereofre having different tstates and result in two
separate requestobjects being instantiated. 

So you get the malloc penalty plus the complexity of dealing with the
tstate->dict dictionary (which too will need to be created, another
malloc) for not much of a practical gain other than proper code, which,
btw, becomes kind of arcane and hard to understand (a bad thing as well).

It seems to me that I am working around what is really an Apache
limitation. The request_rec is clearly the right place to store a pointer
to a requestobject for that request_rec, the limitation is that the place
alloted for these sorts of things (r->notes) only deals with strings.

I think there needs to be something similar to r->notes that can take a
pointer. For now, I think I'm going to revert to the atoi stuff...

Grisha


From grisha at ispol.com  Mon May 29 13:13:51 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:30 2004
Subject: [mod_python] mod_python 2.1
Message-ID: <Pine.LNX.4.21.0005291305150.19547-100000@saturn.ispol.com>

Is available for download. Functionally, it should be equivalent to 2.0
(i.e. no new features), internally, a lot of changes were made mostly
resulting in cleaner code, better performance and security, as well as
(eventually) stability ("eventually" because stability is something that
I'd rather not brag about after having made so many changes). BIG THANKS
to Greg Stein for taking the time to review the code and comments.

Enjoy!

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com



From gstein at lyra.org  Mon May 29 12:36:10 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:58:30 2004
Subject: [mod_python] quick code review
In-Reply-To: <Pine.LNX.4.21.0005291123250.18967-100000@saturn.ispol.com>
Message-ID: <Pine.LNX.4.10.10005291225280.14857-100000@nebula.lyra.org>

On Mon, 29 May 2000, Gregory Trubetskoy wrote:
> On Thu, 25 May 2000, Greg Stein wrote:
> 
> > *) rather than storing the "request object" into r->notes, place it into
> >    tstate->dict. you won't have to do the atoi() stuff (which is Bad
> >    anyways)
> 
> This won't work. Or rather it will, but it's getting too complex to be
> worth it. 
> 
> The problem is that a single request can span multiple thread states - a
> typical scenario is when there is a PythonAuthenHandler directive
> somewhere in a parent directory and a PythonHandler directive in a
> subdirectory. The two handlers will be executed in different
> subinterpreters, thereofre having different tstates and result in two
> separate requestobjects being instantiated. 

All right. Fair enough.

Apache will use a single thread, but the multiple interpreters is a good
point (that I hadn't seen).

>...
> It seems to me that I am working around what is really an Apache
> limitation. The request_rec is clearly the right place to store a pointer
> to a requestobject for that request_rec, the limitation is that the place
> alloted for these sorts of things (r->notes) only deals with strings.

True.

> I think there needs to be something similar to r->notes that can take a
> pointer. For now, I think I'm going to revert to the atoi stuff...

At least use atol(). Still far from portable, but better.

(in the "ascii" scheme, the "best" would be to use PyLong_FromVoidPtr(),
 then convert that long to a string; reverse that sequence for the other
 direction)

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/


From gstein at lyra.org  Mon May 29 12:43:49 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:58:30 2004
Subject: [mod_python] quick code review
In-Reply-To: <Pine.LNX.4.21.0005281654430.15397-100000@saturn.ispol.com>
Message-ID: <Pine.LNX.4.10.10005291242580.14857-100000@nebula.lyra.org>

On Sun, 28 May 2000, Gregory Trubetskoy wrote:
> On Thu, 25 May 2000, Greg Stein wrote:
> > *) exit(1) should not be used; use ap_log_rerror() and return failure
> >    codes to Apache
> 
> are you sure?
> 
> the module initializer is a void *, its return doesn't seem to be checked
> at all.

I was referring more to the make_obcallback() function.

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/


From grisha at ispol.com  Mon May 29 20:42:33 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:30 2004
Subject: [mod_python] quick code review
In-Reply-To: <Pine.LNX.4.10.10005291242580.14857-100000@nebula.lyra.org>
Message-ID: <Pine.LNX.4.21.0005292040440.21046-100000@saturn.ispol.com>

On Mon, 29 May 2000, Greg Stein wrote:

> I was referring more to the make_obcallback() function.

Rats - I didn't it even see it there! Will fix in 2.2.

Grisha


From grisha at ispol.com  Mon May 29 20:55:32 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:30 2004
Subject: [mod_python] SUCCESS-- mod_python as DSO
In-Reply-To: <20000529104801.B29367@quark.emich.edu>
Message-ID: <Pine.LNX.4.21.0005292044500.21046-100000@saturn.ispol.com>

Curious.... I do most of my development and testing on FreeBSD 4.0 and
occasional testing on a Debian Linux (Potato) and a Sun Sparc (Sol 2.7).
On one FreeBSD system I have a very similar ClearModuleList set up (the
default FreeBSD Apache port install). I have LoadModule python_module dead
last and it works great...

I guess I'm going to have to install Red Hat somewhere, since it seems to
be the most popular thing out there....

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com~

On Mon, 29 May 2000, Jeff wrote:

> On Sun, May 28, 2000 at 02:10:32PM -0400, Gregory Trubetskoy wrote:
> > 
> > Could you send a list of all LoadModules you had and the sequence that
> > works and the one that doesn't?
> > 
> 
> The following sequence works. This list is a piece of the most stripped down
> config I could make and still have a useful webserver. It could probably be
> trimmed even more.
> 
> LoadModule python_module      modules/mod_python.so
> LoadModule env_module         modules/mod_env.so
> LoadModule config_log_module  modules/mod_log_config.so
> LoadModule agent_log_module   modules/mod_log_agent.so
> LoadModule referer_log_module modules/mod_log_referer.so
> LoadModule mime_module        modules/mod_mime.so
> LoadModule negotiation_module modules/mod_negotiation.so
> LoadModule status_module      modules/mod_status.so
> LoadModule autoindex_module   modules/mod_autoindex.so
> LoadModule dir_module         modules/mod_dir.so
> LoadModule userdir_module     modules/mod_userdir.so
> LoadModule alias_module       modules/mod_alias.so
> LoadModule rewrite_module     modules/mod_rewrite.so
> LoadModule access_module      modules/mod_access.so
> LoadModule setenvif_module    modules/mod_setenvif.so
> 
> ClearModuleList
> AddModule mod_env.c
> AddModule mod_log_config.c
> AddModule mod_log_agent.c
> AddModule mod_log_referer.c
> AddModule mod_mime.c
> AddModule mod_negotiation.c
> AddModule mod_status.c
> AddModule mod_autoindex.c
> AddModule mod_dir.c
> AddModule mod_userdir.c
> AddModule mod_alias.c
> AddModule mod_rewrite.c
> AddModule mod_access.c
> AddModule mod_so.c
> AddModule mod_setenvif.c
> AddModule mod_python.c
> 
> If I change the list so that mod_python is loaded *last* (or, apparently,
> anything other than first), Apache will core dump. I haven't tried changing
> the sequence of the 'AddModule' directives to see if it changes the
> situation. Please let me know if that would be a useful test, or if there
> are any more questions or concerns.
> 
> Regards,
> J
> -- 
> || visit gfd <http://quark.emich.edu/>
> || psa member -- <http://www.python.org/psa/> 
> 


From aiglauer at yahoo.com  Wed May 31 05:38:17 2000
From: aiglauer at yahoo.com (Alexis Iglauer)
Date: Fri Jan  9 21:58:30 2004
Subject: [mod_python] Python as a DSO problems
Message-ID: <20000531123817.9586.qmail@web2205.mail.yahoo.com>

I have had exactly the same problem in Mandrake 6.0
and Mandrake 7.0 - core dump if mod_python is at the
bottom of the list, works at the top.

I had another problem in MDK 7.0 - I had to install
the files from the mod_packages/ dir into
/usr/lib/python-1.5/site-packages - it did not work in
a mod_python subirectory off that folder.  Could just
have been an effect of a late night too though.

aei

__________________________________________________
Do You Yahoo!?
Send instant messages & get email alerts with Yahoo! Messenger.
http://im.yahoo.com/

From aiglauer at yahoo.com  Wed May 31 05:43:03 2000
From: aiglauer at yahoo.com (Alexis Iglauer)
Date: Fri Jan  9 21:58:30 2004
Subject: [mod_python] Modules not reloading when changed
Message-ID: <20000531124303.145.qmail@web2206.mail.yahoo.com>

I am developing a CGI app using the cgihandler.  There
are several different pages, each with their own .py
file and there is one .py file (SLobj.py) which is
imported by nearly all these individual files, but is
never used by apache directly.  The problem I have is
that the website runs old code - I can see from the
debug logs that it is running old code from SLobj.py
which I have already changed.

Is there a way to force mod_python to reload the .py
modules?  I am not using PythonNoReload.

Thanks
aei

__________________________________________________
Do You Yahoo!?
Send instant messages & get email alerts with Yahoo! Messenger.
http://im.yahoo.com/

From grisha at ispol.com  Wed May 31 09:17:51 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:30 2004
Subject: [mod_python] Modules not reloading when changed
In-Reply-To: <20000531124303.145.qmail@web2206.mail.yahoo.com>
Message-ID: <Pine.LNX.4.21.0005310856020.28492-100000@saturn.ispol.com>


On Wed, 31 May 2000, Alexis Iglauer wrote:

> Is there a way to force mod_python to reload the .py
> modules?  I am not using PythonNoReload.

Unfortunately, mod_python has no way of controlling what modules your
scripts will be importing and making them reload.

There are a few ways to force a reload of modules that have changed and
are imported "indirectly":

1. The obvious - restart the server. 

2. The not so obvious - invoke the module that needs reloading directly
via a URL.  This will produce an error, but will force the module to
reload. This doesn't work too well when the module is not in one of the
WWW accessible directories because you will get a "File not found".

Another catch with this approach is that you will have to do this as many
times as there are apache server processes currently running.

3. Recommended approach. Create a debug flag in your scripts and do a
reload when it is on:

DEBUG = 1

import mymodulea
import mymoduleb
import string
import cgi

if DEBUG:
	mymodulea = reload(mymodulea)
	mymoduleb = reload(mymoduleb)

When you're done debugging, you set DEBUG to 0 or None.

HTH,

Grisha


From grisha at ispol.com  Thu May 11 18:04:09 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:17 2004
Subject: [mod_python] This is just a test
Message-ID: <Pine.LNX.4.21.0005111803520.9333-100000@saturn.ispol.com>

Hello there!

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com


From peter at wl.vg  Sat May 13 20:25:53 2000
From: peter at wl.vg (Peter Halliday)
Date: Fri Jan  9 22:02:17 2004
Subject: [mod_python] use rpms, no src directory for apache
Message-ID: <391DF291.4BB5F774@wl.vg>

I am a developer that does a lot of online applications.  I am
interested in switching to python, because of its OOP and scalibility.
I am very impressed with python.  However, the problem is that I don't
have a src/modules directory.  I am runnign Red Hat 6.1 and installed
apache with their rpms.  Can you please help me.

<!--
Peter Halliday                            |   peter@whetstonelogic.com
Online Application Developer  |   IM   ScreenName: hoaggelos
Whetstone Logic, Inc.              |
-->


From jam at quark.emich.edu  Sun May 14 20:52:44 2000
From: jam at quark.emich.edu (Jeff)
Date: Fri Jan  9 22:02:17 2004
Subject: [mod_python] configuration of mod_python as DSO
Message-ID: <20000514205244.D11083@quark.emich.edu>

greetings,

I've done some preliminary work on a RedHat 6.2 box to get mod_python to
compile as a DSO module, and I've so far had limited success-- I'd rather
not have to rebuild apache from sources to get this functionality.

to start, I built the .so with the following command:

% /usr/sbin/apxs -Wl,-export-dynamic -L/usr/lib/python1.5/config \
-I/usr/include/python1.5/ -I/usr/include/apache -c mod_python.c -lpython1.5 \
-lpthread

I then copied the resulting .so module to /usr/lib/apache:
% sudo cp mod_python.so /usr/lib/apache

I then added these lines to the /etc/httpd/conf/httpd.conf file:
LoadModule python_module        modules/mod_python.so
AddModule mod_python.c

The 'LoadModule' directive was inserted in the group of 'LoadModule' lines that
were already in the file, and the same with AddModule. I just put them at
the end of their respective lists.

Since the machine I'm installing this on is not production, I made a
.htaccess file in /home/httpd/html containing the following:
-- begin .htaccess --
AddHandler python-program .py
PythonDebug
PythonHandler test
-- end .htacess --

My 'test.py' file contains the following:
-- begin test.py --
from mod_python import apache

def handler(req):
  req.send_http_header()
  req.write("Hello World!")
  return apache.OK
-- end test.py --

I then restarted apache:
[~] [8:21pm] [jam@toast-pts/2] % /etc/rc.d/init.d/httpd status
httpd dead but subsys locked
[~] [8:21pm] [jam@toast-pts/2] % sudo /etc/rc.d/init.d/httpd restart
Password:
Shutting down http:                                        [FAILED]
Starting httpd:                                            [  OK  ]
[~] [8:21pm] [jam@toast-pts/2] % /etc/rc.d/init.d/httpd status
httpd dead but subsys locked

any clues as to where I might have gone wrong?

regards,
J
-- 
|| visit gfd <http://quark.emich.edu/>
|| psa member -- <http://www.python.org/psa/> 

From echuck at mindspring.com  Tue May 16 07:52:19 2000
From: echuck at mindspring.com (Chuck Esterbrook)
Date: Fri Jan  9 22:02:17 2004
Subject: [mod_python] Handlers
Message-ID: <39213673.4F54B5B9@mindspring.com>

Hi, I noticed that you have 3 out-of-the-box handlers including one for ZPublisher. I was wondering if you would be interested in providing a handler for Webware for Python?

We already have 2 handlers, one for CGI and another for FastCGI. Actually, there is also a 3rd for AOLserver provided by the AOLserver time which, like you, packages ready-made handlers (we call them adaptors).

The URL is below in my .sig.  :-)

-Chuck
____________________________________________________________

http://webware.sourceforge.net

From grisha at ispol.com  Tue May 16 08:04:07 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:17 2004
Subject: [mod_python] Handlers
In-Reply-To: <39213673.4F54B5B9@mindspring.com>
Message-ID: <Pine.LNX.4.21.0005160758040.3709-100000@saturn.ispol.com>

On Tue, 16 May 2000, Chuck Esterbrook wrote:

> 
> Hi, I noticed that you have 3 out-of-the-box handlers including one
> for ZPublisher. I was wondering if you would be interested in
> providing a handler for Webware for Python?

"providing" as in "writing"? Probably not, there is enough things to do
with mod_python (like DSO) that I'd rather not get distracted on
handlers...

(What is webware, BTW? I couldn't gather from the website what it is and
didn't feel like downloading it right now.)

My vision for mod_python is that of a very simple piece of software, in
fact I'm not even sure that the three handlers that come with it *should*
be part of the package...

BUT, you and everyone else are more than welcome to contribute, we could
create a section on the website for additional handlers.

> We already have 2 handlers, one for CGI and another for FastCGI.

When you say "handler" do you mean it is a mod_python handler, or some
other handler?

Grisha


From grisha at ispol.com  Tue May 16 22:12:54 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:17 2004
Subject: [mod_python] DSO
In-Reply-To: <20000515210702.A19290@yetix.sz-sb.de>
Message-ID: <Pine.LNX.4.21.0005162200180.20825-100000@saturn.ispol.com>

I just tried mod_python as a dso on 

Linux 2.2.14 (Debian [potato])
gcc 2.9.52
libc6
python 1.5.2 with and without threads
apache-3.1.12

and it seems to work OK, at least the test.py does.

I used 

apxs -I /usr/local/include/python1.5 -c mod_python.c \
     /usr/local/lib/python1.5/config/libpython1.5.a  \
     -lpthead

to compile the module.

On another Linux system it compiles, but Apache complains upon loading the
module that "python_module is garbled", although I think that's a libc/gcc
incompatibility problem of some sort.

On FreeBSD 4.0 STABLE apxs doesn't work at all - it gives gcc arguments
that are not allowed....

It'd be interesting to see what experiences other people have with this?

Grisha


On Mon, 15 May 2000, Andreas Jung wrote:

> 
> hehe...try to get DSO working because I dislike recompiling
> Apache for every new module :)
> 
> Andreas
>  
> 


From ralf at silicon.org  Thu May 18 13:32:38 2000
From: ralf at silicon.org (Ralf Canis)
Date: Fri Jan  9 22:02:17 2004
Subject: [mod_python] problem using regular expressions in CGI scripts
Message-ID: <20000518133238.A6940@silicon.org>

Hello,

I've just installed mod_python and have a problem with CGI scripts
using regular expressions.

apache 1.3.6
python 1.52
mod_python 1.9a

httpd.conf contains:
AddHandler python-program .py
PythonHandler cgihandler

--- snip ---
import re, sys, traceback

print 'Content-type: text/plain'
print

sys.stderr = sys.stdout

try:
  re.compile( r'foo(\(.+\))bar' )
  print 'ok'
except:
  print '\n\n'
  traceback.print_exc()
  print '\n'
--- snip ---

Opening this page in a browser and pressing refresh several times
results in the following error, one at a time. Sometimes it works :)
I've already reinstalled python and mod_python. BTW, same problem
when using PyApache!

BUT: Loading the Python interpreter as a standard CGI program always works.

Traceback (innermost last):
  File "/home/httpd/sites/ralf/test/re_err.py", line 9, in ?
    re.compile( r'foo(\(.+\))bar' )
  File "/var/tmp/python/python-root/usr/lib/python1.5/re.py", line 79, in compile
    code=pcre_compile(pattern, flags, groupindex)
pcre.error: ('back reference to non-existent subpattern', 4149)

or

Traceback (innermost last):
  File "/home/httpd/sites/ralf/test/re_err.py", line 9, in ?
    re.compile( r'foo(\(.+\))bar' )
  File "/var/tmp/python/python-root/usr/lib/python1.5/re.py", line 79, in compile
    code=pcre_compile(pattern, flags, groupindex)
pcre.error: ('\\ at end of pattern', 1886)

or

Traceback (innermost last):
  File "/home/httpd/sites/ralf/test/re_err.py", line 9, in ?
    re.compile( r'foo(\(.+\))bar' )                     
  File "/var/tmp/python/python-root/usr/lib/python1.5/re.py", line 79, in compile
    code=pcre_compile(pattern, flags, groupindex)
pcre.error: ('unmatched parentheses', 10)

or

Traceback (innermost last):
  File "/home/httpd/sites/ralf/test/re_err.py", line 9, in ?
    re.compile( r'foo(\(.+\))bar' )                     
  File "/var/tmp/python/python-root/usr/lib/python1.5/re.py", line 79, in compile
    code=pcre_compile(pattern, flags, groupindex)
pcre.error: ('regular expression too large', 0)

or

Traceback (innermost last):
  File "/home/httpd/sites/ralf/test/re_err.py", line 9, in ?
    re.compile( r'foo(\(.+\))bar' )
  File "/var/tmp/python/python-root/usr/lib/python1.5/re.py", line 79, in compile
    code=pcre_compile(pattern, flags, groupindex)
pcre.error: ('missing )', 113)


Did I miss something or is this a nasty bug? It's ugly, because MySQLdb
doesn't work because of it.

Sincerely
  Ralf

-- 
Ralf Canis            ralf@silicon.org
Germany               canis@bigfoot.com

From ralf at silicon.org  Thu May 18 14:59:53 2000
From: ralf at silicon.org (Ralf Canis)
Date: Fri Jan  9 22:02:17 2004
Subject: [mod_python] problem using regular expressions in CGI scripts
In-Reply-To: <20000518143946.O3437@lib.hel.fi>; from erno@iki.fi on Thu, May 18, 2000 at 02:39:46PM +0300
References: <20000518133238.A6940@silicon.org> <20000518143946.O3437@lib.hel.fi>
Message-ID: <20000518145953.A7140@silicon.org>

On Thu, May 18, 2000 at 02:39:46PM +0300, Erno Kuusela wrote:

Hello Erno,

> i haven't even installed mod_python yet, but a debugging idea
> came to mind...
> 
> if you compile your regular expressions, they will have a .pattern
> attribute that contains your regexp. it seem to me something
> in mod_python may be munging/interpreting \-escapes, so if
> you print the pattern out and it looks different from the
> one you put in, you might be closer to figuring out what
> is going on..

Yes, I thought so, too. Therefor I modified re.py in lib/python1.5
at line 79 (re.compile) to print the pattern right before calling
pcre_compile - it's the pattern I call it with :(
Regarding this, I guess the problem is in prce_compile, but I did
not investigate this further.

Ralf

-- 
Ralf Canis            ralf@silicon.org
Germany               canis@bigfoot.com

From grisha at ispol.com  Thu May 18 09:15:50 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:17 2004
Subject: [mod_python] problem using regular expressions in CGI scripts
In-Reply-To: <20000518145953.A7140@silicon.org>
Message-ID: <Pine.LNX.4.21.0005180903560.30961-100000@saturn.ispol.com>

Can you try running the same code in your own handler, and see where that
takes you, in other words:

httpd.conf:
AddHandler python-program .py
PythonHandler myhandler
PythonDebug

Then the myhandler.py file would have something like

--- snip ---

from mod_python import apache
import re, sys

def handler(req):

    req.content_type = 'text/plain'
    req.send_http_header()
    re.compile( r'foo(\(.+\))bar' )
    req.write('ok')
    return apache.OK

--- snip ---


Note that it is not necessary to print out the traceback - mod_python does
that for you if PythonDebug directive is specified.

Grisha


On Thu, 18 May 2000, Ralf Canis wrote:

> On Thu, May 18, 2000 at 02:39:46PM +0300, Erno Kuusela wrote:
> 
> Hello Erno,
> 
> > i haven't even installed mod_python yet, but a debugging idea
> > came to mind...
> > 
> > if you compile your regular expressions, they will have a .pattern
> > attribute that contains your regexp. it seem to me something
> > in mod_python may be munging/interpreting \-escapes, so if
> > you print the pattern out and it looks different from the
> > one you put in, you might be closer to figuring out what
> > is going on..
> 
> Yes, I thought so, too. Therefor I modified re.py in lib/python1.5
> at line 79 (re.compile) to print the pattern right before calling
> pcre_compile - it's the pattern I call it with :(
> Regarding this, I guess the problem is in prce_compile, but I did
> not investigate this further.
> 
> Ralf
> 
> -- 
> Ralf Canis            ralf@silicon.org
> Germany               canis@bigfoot.com
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 





From ralf at silicon.org  Fri May 19 10:33:56 2000
From: ralf at silicon.org (Ralf Canis)
Date: Fri Jan  9 22:02:17 2004
Subject: [mod_python] SOLVED: problem using regular expressions in CGI scripts
Message-ID: <20000519103356.A1499@silicon.org>

Hi,

I found what caused this strange problem: loading mod_python dynamically!
(build+installed using apxs).

Thanks everybody
  Ralf
-- 
Ralf Canis            ralf@silicon.org
Germany               canis@bigfoot.com

From grisha at ispol.com  Fri May 19 07:39:55 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:17 2004
Subject: [mod_python] SOLVED: problem using regular expressions in CGI
 scripts
In-Reply-To: <20000519103356.A1499@silicon.org>
Message-ID: <Pine.LNX.4.21.0005190737330.5106-100000@saturn.ispol.com>

Very cusrious. 

The dynamic loading by itself shouldn't make the module act any
differently. It's probably not the dynamic loading itself, but rather that
as a result of dynamic loading some libraries get rearranged?

I haven't had the time to look at this yet as I've been busy perfecting
the documentation and working out other DSO issues, but I will try soon.

Grisha

On Fri, 19 May 2000, Ralf Canis wrote:

> Hi,
> 
> I found what caused this strange problem: loading mod_python dynamically!
> (build+installed using apxs).
> 
> Thanks everybody
>   Ralf
> -- 
> Ralf Canis            ralf@silicon.org
> Germany               canis@bigfoot.com
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From grisha at ispol.com  Fri May 19 19:47:06 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:18 2004
Subject: [mod_python] problem using regular expressions in CGI scripts
In-Reply-To: <20000518152302.A7535@silicon.org>
Message-ID: <Pine.LNX.4.21.0005191945410.8192-100000@saturn.ispol.com>

I'm unable to reproduce this. Tried it as DSO, on Linux and FreeBSD and it
works fine...

Anybody else on the list want to try it?

Grisha


On Thu, 18 May 2000, Ralf Canis wrote:

> On Thu, May 18, 2000 at 09:15:50AM -0400, Gregory Trubetskoy wrote:
> 
> Hi Grisha,
> 
> same errors, here's one for example.
> 
> Ralf
> 
> ---snip---
> \nERROR mod_python: "PythonHandler myhandler"
> 
> Traceback (innermost last):
> 
>   File "/usr/lib/python1.5/site-packages/mod_python/apache.py", line 110, in Dispatch
>     result = object(req)
> 
>   File "./myhandler.py", line 8, in handler
>     re.compile( r'foo(\(.+\))bar' )
> 
>   File "/usr/lib/python1.5/re.py", line 79, in compile
>     code=pcre_compile(pattern, flags, groupindex)
> 
> pcre.error: ('missing )', 2493)
> 
> 
> NOTE: More output from other handlers, if any, may follow.
> This will NOT happen, and request processing will STOP
> at this point when you remove PythonDebug directive.
> ---snip---
> 
> > 
> > Can you try running the same code in your own handler, and see where that
> > takes you, in other words:
> > 
> > httpd.conf:
> > AddHandler python-program .py
> > PythonHandler myhandler
> > PythonDebug
> > 
> > Then the myhandler.py file would have something like
> > 
> > --- snip ---
> > 
> > from mod_python import apache
> > import re, sys
> > 
> > def handler(req):
> > 
> >     req.content_type = 'text/plain'
> >     req.send_http_header()
> >     re.compile( r'foo(\(.+\))bar' )
> >     req.write('ok')
> >     return apache.OK
> > 
> > --- snip ---
> > 
> > 
> > Note that it is not necessary to print out the traceback - mod_python does
> > that for you if PythonDebug directive is specified.
> > 
> > Grisha
> > 
> > 
> > On Thu, 18 May 2000, Ralf Canis wrote:
> > 
> > > On Thu, May 18, 2000 at 02:39:46PM +0300, Erno Kuusela wrote:
> > > 
> > > Hello Erno,
> > > 
> > > > i haven't even installed mod_python yet, but a debugging idea
> > > > came to mind...
> > > > 
> > > > if you compile your regular expressions, they will have a .pattern
> > > > attribute that contains your regexp. it seem to me something
> > > > in mod_python may be munging/interpreting \-escapes, so if
> > > > you print the pattern out and it looks different from the
> > > > one you put in, you might be closer to figuring out what
> > > > is going on..
> > > 
> > > Yes, I thought so, too. Therefor I modified re.py in lib/python1.5
> > > at line 79 (re.compile) to print the pattern right before calling
> > > pcre_compile - it's the pattern I call it with :(
> > > Regarding this, I guess the problem is in prce_compile, but I did
> > > not investigate this further.
> > > 
> -- 
> Ralf Canis            ralf@silicon.org
> Germany               canis@bigfoot.com
> 


From stevena at permanent.cc  Sat May 20 23:42:32 2000
From: stevena at permanent.cc (Steven D. Arnold)
Date: Fri Jan  9 22:02:18 2004
Subject: [mod_python] apache compile problems
Message-ID: <4.3.1.2.20000520233846.014d7ee8@phear.dementian.com>

Hi,

I'm trying to compile apache with mod_python and I'm getting the following 
error:

[root@catatonia apache_1.3.12]# ./configure 
--activate-module=src/modules/extra/mod_python.c --prefix=/usr/local/apache 
--enable-module=all
Configuring for Apache, Version 1.3.12
  + using installation path layout: Apache (config.layout)
  + activated python module (modules/extra/mod_python.c)
Creating Makefile
Creating Configuration.apaci in src
grep: /usr/lib/python1.5/config/Makefile: No such file or directory
grep: /usr/lib/python1.5/config/Makefile: No such file or directory
grep: /usr/lib/python1.5/config/Makefile: No such file or directory
grep: /usr/lib/python1.5/config/Makefile: No such file or directory
cd ..; gcc  -DLINUX=2 -DUSE_HSREGEX -DUSE_EXPAT -I./lib/expat-lite 
`./apaci` -I/usr/include/python1.5    -o helpers/dummy 
helpers/dummy.c   -lm -lcrypt -lndbm -ldb 
/usr/lib/python1.5/config/libpython1.5.a   -ldl
gcc: /usr/lib/python1.5/config/libpython1.5.a: No such file or directory
make: *** [dummy] Error 1
Creating Makefile in src
  + configured for Linux platform
  + setting C compiler to gcc
  + setting C pre-processor to gcc -E
  + checking for system header files
  + adding selected modules
     o rewrite_module uses ConfigStart/End
  + using -lndbm for DBM support
       enabling DBM support for mod_rewrite
     o dbm_auth_module uses ConfigStart/End
     o db_auth_module uses ConfigStart/End
       using Berkeley-DB/2.x for mod_auth_db (-ldb)
     o python_module uses ConfigStart/End
  + using -ldl for vendor DSO support
  + checking sizeof various data types
  + doing sanity check on compiler and options
** A test compilation with your Makefile configuration
** failed.  The below error output from the compilation
** test will give you an idea what is failing. Note that
** Apache requires an ANSI C Compiler, such as gcc.

======== Error Output for sanity check ========
============= End of Error Report =============

  Aborting!


I have no directory /usr/lib/python1.5/config, though the parent of that 
dir does exist.  I just freshly installed python 1.5.2 before trying the 
above.  Platform is Red Hat Linux 6.2.  Any ideas?


steve

--
Steven D. Arnold          Que quiero sera           stevena@permanent.cc
"We choose to go to the moon in this decade and do the other things, not
because they are easy, but because they are hard."    -- John F. Kennedy


From stevena at permanent.cc  Sun May 21 00:28:14 2000
From: stevena at permanent.cc (Steven D. Arnold)
Date: Fri Jan  9 22:02:18 2004
Subject: [mod_python] [SOLVED] apache compile problems
In-Reply-To: <4.3.1.2.20000520233846.014d7ee8@phear.dementian.com>
Message-ID: <4.3.1.2.20000521002528.015faf08@phear.dementian.com>

For some reason, the original installation of python on my system didn't 
have a config dir inside /usr/lib/python1.5.  I reinstalled python and it 
made sys.exec_prefix /usr/local; however, it didn't replace the old copies 
of python sitting in /usr/bin.  (It did put new copies in 
/usr/local/bin.)  When I deleted the old copies and created symlinks to the 
new copies, python then knew to look in /usr/local/lib/python1.5/config, 
and all was well.


steve

--
Steven D. Arnold          Que quiero sera           stevena@permanent.cc
"We choose to go to the moon in this decade and do the other things, not
because they are easy, but because they are hard."    -- John F. Kennedy


From jam at quark.emich.edu  Sun May 21 08:04:35 2000
From: jam at quark.emich.edu (Jeff)
Date: Fri Jan  9 22:02:18 2004
Subject: [mod_python] apache compile problems
In-Reply-To: <4.3.1.2.20000520233846.014d7ee8@phear.dementian.com>; from stevena@permanent.cc on Sat, May 20, 2000 at 11:42:32PM -0400
References: <4.3.1.2.20000520233846.014d7ee8@phear.dementian.com>
Message-ID: <20000521080435.A1765@quark.emich.edu>

On Sat, May 20, 2000 at 11:42:32PM -0400, Steven D. Arnold wrote:
> Hi,
> 
> I'm trying to compile apache with mod_python and I'm getting the following 
> error:
[...snipped...]
> 
> ======== Error Output for sanity check ========
> ============= End of Error Report =============
> 
>   Aborting!
> 
> 
> I have no directory /usr/lib/python1.5/config, though the parent of that 
> dir does exist.  I just freshly installed python 1.5.2 before trying the 
> above.  Platform is Red Hat Linux 6.2.  Any ideas?
> 
> 
> steve
> 

be sure that the python-devel package has been installed before attempting
the build.

hope that helps ;)

regards,
J
-- 
|| visit gfd <http://quark.emich.edu/>
|| psa member -- <http://www.python.org/psa/> 

From wayne.izatt at myself.com  Sun May 21 14:38:05 2000
From: wayne.izatt at myself.com (Wayne Izatt)
Date: Fri Jan  9 22:02:18 2004
Subject: [mod_python] .htaccess and httpd.conf
Message-ID: <3928573C.EFEB5271@myself.com>

Hi all. I've built and installed a mod_python enabled apache. However,
I'm not sure what, if any, directives I need to add to httpd.conf to get
it to pass .py files to the python handler. When I point my browser at
the test script, all that I get is the script in the browser window.

Perhaps someone has a sample httpd.conf (just the handler stuff will do)
or a vanilla .htaccess (if that's where the directives should go).

(Yes, I've followed the installation instructions, but something simple
is still eluding me).

cheers


From stevena at permanent.cc  Sun May 21 17:56:24 2000
From: stevena at permanent.cc (Steven D. Arnold)
Date: Fri Jan  9 22:02:18 2004
Subject: [mod_python] .htaccess and httpd.conf
In-Reply-To: <3928573C.EFEB5271@myself.com>
Message-ID: <4.3.1.2.20000521175332.01f98ee8@phear.dementian.com>

At 02:38 PM 5/21/2000 -0700, Wayne Izatt wrote:
>Hi all. I've built and installed a mod_python enabled apache. However,
>I'm not sure what, if any, directives I need to add to httpd.conf to get
>it to pass .py files to the python handler. When I point my browser at
>the test script, all that I get is the script in the browser window.
>
>Perhaps someone has a sample httpd.conf (just the handler stuff will do)
>or a vanilla .htaccess (if that's where the directives should go).
>
>(Yes, I've followed the installation instructions, but something simple
>is still eluding me).

I'm having the same experience.

I tried the following directives:

Alias /python /usr/local/apache/htdocs/python

<Location /python/>
     AllowOverride All
     AddHandler python-program .py
     PythonDebug
     PythonHandler test
</Location>


When I try loading the page, I get this error:

\nERROR mod_python: "PythonHandler test"

Traceback (innermost last):

File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 
107, in Dispatch object = self.resolve_object(module_name, object_str)

File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 
70, in resolve_object raise "ResolveError", "Couldn't resolve object '%s' 
in module '%s'." % \

ResolveError: Couldn't resolve object 'handler' in module 'test'.

NOTE: More output from other handlers, if any, may follow. This will NOT 
happen, and request processing will STOP at this point when you remove 
PythonDebug directive.


I'm not quite sure what I'm doing wrong.  Any ideas?


steve

--
Steven D. Arnold          Que quiero sera           stevena@permanent.cc
"We choose to go to the moon in this decade and do the other things, not
because they are easy, but because they are hard."    -- John F. Kennedy


From wayne.izatt at myself.com  Sun May 21 15:37:21 2000
From: wayne.izatt at myself.com (Wayne Izatt)
Date: Fri Jan  9 22:02:18 2004
Subject: [Fwd: [mod_python] .htaccess and httpd.conf]
Message-ID: <39286520.67A1B247@myself.com>

Victory. Here's what I did.

added:

AddModule mod_python.c

after the other added modules.

added this directive:

<Directory "/usr/local/apache/htdocs/ptest">
    AddHandler python-program .py
    PythonDebug
    PythonHandler test
</Directory>

and everything works fine.

thanks all

Wayne Izatt wrote:

> Hi all. I've built and installed a mod_python enabled apache. However,
> I'm not sure what, if any, directives I need to add to httpd.conf to get
> it to pass .py files to the python handler. When I point my browser at
> the test script, all that I get is the script in the browser window.
>
> Perhaps someone has a sample httpd.conf (just the handler stuff will do)
> or a vanilla .htaccess (if that's where the directives should go).
>
> (Yes, I've followed the installation instructions, but something simple
> is still eluding me).
>
> cheers
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python




From grisha at ispol.com  Sun May 21 19:11:37 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:18 2004
Subject: [mod_python] .htaccess and httpd.conf
In-Reply-To: <4.3.1.2.20000521175332.01f98ee8@phear.dementian.com>
Message-ID: <Pine.LNX.4.21.0005211909500.29474-100000@saturn.ispol.com>

This means that test.py doesn't have a function called "handler" defined
in it.

What's in your test.py?

Grisha


On Sun, 21 May 2000, Steven D. Arnold wrote:

> When I try loading the page, I get this error:
> 
> ResolveError: Couldn't resolve object 'handler' in module 'test'.
> 


From stevena at permanent.cc  Sun May 21 20:05:44 2000
From: stevena at permanent.cc (Steven D. Arnold)
Date: Fri Jan  9 22:02:18 2004
Subject: [mod_python] .htaccess and httpd.conf
In-Reply-To: <Pine.LNX.4.21.0005211909500.29474-100000@saturn.ispol.com>
References: <4.3.1.2.20000521175332.01f98ee8@phear.dementian.com>
Message-ID: <4.3.1.2.20000521200358.015c0300@phear.dementian.com>

At 07:11 PM 5/21/2000 -0400, Gregory Trubetskoy wrote:

>This means that test.py doesn't have a function called "handler" defined
>in it.
>
>What's in your test.py?

I put exactly what the docs suggest:

from mod_python import apache

def handler(req):
         req.send_http_header()
         req.write("Hello World!")
         return apache.OK


However, I made the changes Wayne suggested, and now it works for me. 
:-)  (It didn't initially, but it does now -- I can't explain 
why.)  Apparently the AddModule and Directory directives did it...


steve


--
Steven D. Arnold          Que quiero sera           stevena@permanent.cc
"We choose to go to the moon in this decade and do the other things, not
because they are easy, but because they are hard."    -- John F. Kennedy


From grisha at ispol.com  Mon May 22 19:19:38 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:18 2004
Subject: [mod_python] mod_python 2.0
In-Reply-To: <4.3.1.2.20000520233846.014d7ee8@phear.dementian.com>
Message-ID: <Pine.LNX.4.21.0005211901010.29474-100000@saturn.ispol.com>


Is out on the site - http://www.modpython.org/

(well, as soon as the DNS changes take effect - the site has moved to
another server.)

It has quite a bit of documentation improvements, especially the
installation section, as well as some significant code fixes, though no
new features. I think this version should be more or less stable because
since 1.9 I haven't really found any really major bugs or had reports of
instability, except during the install process, which is quite normal.

Unless something major turns up in the very near future, an announcement
to comp.lang.python will follow, as well as links on Python and Apache
site requested, which should up the user base a bit.... :-)

Grisha


From morton at dennisinter.com  Mon May 22 21:14:40 2000
From: morton at dennisinter.com (Damian Morton)
Date: Fri Jan  9 22:02:18 2004
Subject: [mod_python] mod_python 2.0
In-Reply-To: <Pine.LNX.4.21.0005211901010.29474-100000@saturn.ispol.com>
Message-ID: <NDBBLENPLCPAHKODFHNGMEEKDHAA.morton@dennisinter.com>

Please excuse the newbie question, as Im not as familiar with unix and
apache as Id like to be, although the availability of mod_python opens up
some very interesting possibilities.

I know from observing mod_perl people that there are some problems with
having global data shared between invokations of request handlers. Is there
some mechanism in mod_python to get around this? I understand that the issue
is that Apache runs serveral processes to optimise performance, and that
each request will likely get routed to different processes, each one having
its own (global?) data.



> -----Original Message-----
> From: mod_python-admin@modpython.org
> [mailto:mod_python-admin@modpython.org]On Behalf Of Gregory Trubetskoy
> Sent: Monday, May 22, 2000 7:20 PM
> To: mod_python list
> Subject: [mod_python] mod_python 2.0
>
>
>
>
> Is out on the site - http://www.modpython.org/
>
> (well, as soon as the DNS changes take effect - the site has moved to
> another server.)
>
> It has quite a bit of documentation improvements, especially the
> installation section, as well as some significant code fixes, though no
> new features. I think this version should be more or less stable because
> since 1.9 I haven't really found any really major bugs or had reports of
> instability, except during the install process, which is quite normal.
>
> Unless something major turns up in the very near future, an announcement
> to comp.lang.python will follow, as well as links on Python and Apache
> site requested, which should up the user base a bit.... :-)
>
> Grisha
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python


From grisha at ispol.com  Tue May 23 07:28:36 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:18 2004
Subject: [mod_python] mod_python 2.0
In-Reply-To: <NDBBLENPLCPAHKODFHNGMEEKDHAA.morton@dennisinter.com>
Message-ID: <Pine.LNX.4.21.0005230719150.7819-100000@saturn.ispol.com>

On Mon, 22 May 2000, Damian Morton wrote:

> I understand that the issue is that Apache runs serveral processes to
> optimise performance, and that each request will likely get routed to
> different processes, each one having its own (global?) data.

This is hardly a mod_python issue, but...

There are basically two common ways of sharing data - through a backend
database like MySQL or via a file. With a file you will need a locking
mechanism of some sort.

I, personally, have yet to find an application where there is a true need
for global data (other than a backend database). HTTP applications, given
the stateless nature of the protocol, have eveolved with other ways to
retain state - cookies, URL's, form data and those are usually sufficient.

HTH -

Grisha


From riku.voipio at tietoenator.com  Tue May 23 16:11:47 2000
From: riku.voipio at tietoenator.com (Riku Voipio)
Date: Fri Jan  9 22:02:18 2004
Subject: [mod_python] apache reload wont't work with DSO mod_python
Message-ID: <20000523161147.A23015@samncd.tsd.tieto.com>

Hi, 
/etc/init.d/apache reload crashes if mod_python is loaded.
Another anomility noted is, that apache wont start, if the last 
loaded module is mod_python.

Elsewell it is running smoothly.

Running Debian potato apt-get up-to-date today. 

and as for last, 
Here's a patch to fix a type on install.html

--- installation.html.old       Tue May 23 16:01:31 2000
+++ installation.html   Tue May 23 16:05:27 2000
@@ -177,8 +177,8 @@
      standard Debian Python development package installed]
 
     1. cd src/modules/extra
-    2. axps -I /usr/local/include/python1.5 -c mod_python.c \
-            /usr/local/lib/python1.5/config/libpython1.5.a -lpthread
+    2. apxs -I /usr/include/python1.5 -c mod_python.c \
+            /usr/lib/python1.5/config/libpython1.5.a -lpthread
       (You don't nead -lpthread if your Python is compiled without threads)
 


-- 
Riku Voipio
riku.voipio@tietoenator.com
09-862 60764

From grisha at ispol.com  Thu May 25 22:50:59 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:18 2004
Subject: [mod_python] quick code review
In-Reply-To: <Pine.LNX.4.10.10005251801100.16846-100000@nebula.lyra.org>
Message-ID: <Pine.LNX.4.21.0005252248100.24987-100000@saturn.ispol.com>


Thanks for taking the time to look over the code and all the comments, I
think they're all valid and I'll address them.

On Thu, 25 May 2000, Greg Stein wrote:

> *) I don't understand why the PyTypeObject's are init'd/copied in
>    python_init, rather than just doing that at the module level. For
>    example:
>      static PyTypeObject serverobjecttype = { ... };

I wonder if this is something that I had to do back in httpdapy times so
that it compiled on Visual C++...?

Grisha

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python

From grisha at ispol.com  Thu May 25 22:53:34 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:18 2004
Subject: [mod_python] reload problem
In-Reply-To: <Pine.LNX.4.10.10005251746270.16846-100000@nebula.lyra.org>
Message-ID: <Pine.LNX.4.21.0005252251390.24987-100000@saturn.ispol.com>


I think the archive is broken, BTW, ever since I moved mailman to another
machine.... I don't see any messages from today or yesterday.

I will probably recreate this list tomorrow and I'll try to make the
archives reflect everything that wasn't archived.

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Thu, 25 May 2000, Greg Stein wrote:

> [ I just subscribed, so I can't "reply" to the reload issue that I saw in
>   the archive... starting from scratch ]

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python

From gstein at lyra.org  Fri May 26 00:54:31 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 22:02:18 2004
Subject: [mod_python] quick code review
In-Reply-To: <Pine.LNX.4.21.0005252248100.24987-100000@saturn.ispol.com>
Message-ID: <Pine.LNX.4.10.10005260049500.21092-100000@nebula.lyra.org>

On Thu, 25 May 2000, Gregory Trubetskoy wrote:
>...
> On Thu, 25 May 2000, Greg Stein wrote:
> > *) I don't understand why the PyTypeObject's are init'd/copied in
> >    python_init, rather than just doing that at the module level. For
> >    example:
> >      static PyTypeObject serverobjecttype = { ... };
> 
> I wonder if this is something that I had to do back in httpdapy times so
> that it compiled on Visual C++...?

There is something about static initializers in MSVC. Generally, code will
add a line such as:

(from arraymodule.c)

    Arraytype.ob_type = &PyType_Type;


I don't know exactly *why* it must be done that way, but there ya go. The
underlying point is that the initialization of the type objects can be
simplified quite a bit.

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python

From gstein at lyra.org  Fri May 26 01:54:54 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 22:02:18 2004
Subject: [mod_python] apache.py suggestions
Message-ID: <Pine.LNX.4.10.10005260147360.21092-100000@nebula.lyra.org>

Here are a few more suggestions, but for apache.py:

*) avoid exec/eval: they are quite slow, and can pose a security risk

*) to import modules, use: module = __import__(module_name)

*) resolve_object(), use the getattr() function for traversing

*) copy a dictionary using dict.copy()

*) maybe move some of the CGI stuff off to 'cgihandler'


Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python

From mmach at batory.org.pl  Fri May 26 11:05:50 2000
From: mmach at batory.org.pl (Micha<B3> Mach)
Date: Fri Jan  9 22:02:18 2004
Subject: [mod_python] apache.py suggestions
In-Reply-To: <Pine.LNX.4.10.10005260147360.21092-100000@nebula.lyra.org>
Message-ID: <NDBBIBMMILNGAOKOEEKDEECDCEAA.mmach@batory.org.pl>


Hi,

> *) to import modules, use: module = __import__(module_name)

Why so? That's perhaps more like the Python question than mod_python matter,
but anyway...

Best,
Michal


---
Michal Mach   mmach@batory.org.pl
Stefan Batory Foundation
http://www.batory.org.pl/

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python

From gstein at lyra.org  Fri May 26 03:39:52 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 22:02:18 2004
Subject: [mod_python] apache.py suggestions
In-Reply-To: <NDBBIBMMILNGAOKOEEKDEECDCEAA.mmach@batory.org.pl>
Message-ID: <Pine.LNX.4.10.10005260335290.21092-100000@nebula.lyra.org>

On Fri, 26 May 2000, Micha<B3> Mach wrote:
> > *) to import modules, use: module = __import__(module_name)
> 
> Why so? That's perhaps more like the Python question than mod_python matter,
> but anyway...

apache.py was doing something like the following:

    exec "import " + module_name
    module = eval(module_name)

The above code is horribly inefficient compared to the code I provided
(using __import__). You have two parse/compile passes at runtime. The
"exec" disables certain optimizations. I don't think the code allows it,
but if module_name happens to come from some user input, then you are
effectively executing arbitrary code. Very bad.

Python vs mod_python? Bah. I wouldn't have brought it up if it wasn't a
mod_python issue.

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python

From gstein at lyra.org  Thu May 25 17:57:13 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 22:02:18 2004
Subject: [mod_python] reload problem
Message-ID: <Pine.LNX.4.10.10005251746270.16846-100000@nebula.lyra.org>

[ I just subscribed, so I can't "reply" to the reload issue that I saw in
  the archive... starting from scratch ]

The reload issue might be caused by the global variables in mod_python.c.
Those values should be wiped when the configuration pool is tossed.
Specifically, a "cleanup" should be registered at the point that those
variables are allocated.

That might not truly be it, but globals are *always* suspect when dealing
with Apache modules.

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python

From gstein at lyra.org  Thu May 25 19:12:10 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 22:02:18 2004
Subject: [mod_python] quick code review
Message-ID: <Pine.LNX.4.10.10005251801100.16846-100000@nebula.lyra.org>

There are a number of issues that I see with mod_python.c. I'll try to
address a good number of them here, but I'm invariably going to miss some.
After some changes are made, then another pass can be done at that point.

Please try to take this constructively... the goal is to improve the
code... :-)

*) when storing the tstate into obcallback, use a PyCObject rather than an
   integer. That will avoid the (int) casting (a no-no)

*) noop is not needed; use ap_null_cleanup() (I think that's the name;
   close to it, at least)

*) simplify make_obcallback(): the two params are always NULL

*) I don't understand why the PyTypeObject's are init'd/copied in
   python_init, rather than just doing that at the module level. For
   example:
     static PyTypeObject serverobjecttype = { ... };

*) use PyImport_Import() rather than PyRun_SimpleString to get the
   module imported. This returns the "mod_python" or "mod_python.apache"
   module (I forget which; probably the former).

*) use PyObject_CallMethod() to call the "init" method in the module
   retrieved from above. Use the *return* value for obCallBack, rather
   than the SetCallback nastiness.

*) in python_directive, just use a cast to (py_dir_config *) rather than
   all the offset stuff. Also, there is no need to dup() the string since
   it is a constant.

*) unused: python_dict_merge, table2dict, print_table, print_array

*) exit(1) should not be used; use ap_log_rerror() and return failure
   codes to Apache

*) rather than storing the "request object" into r->notes, place it into
   tstate->dict. you won't have to do the atoi() stuff (which is Bad
   anyways)

*) use ap_log_rerror() instead of ap_log_error(). the former is better
   from a logging standpoint (it has more info)


That's all for now!

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/
_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python


From mmach at batory.org.pl  Fri May 26 15:45:24 2000
From: mmach at batory.org.pl (Micha³ Mach)
Date: Fri Jan  9 22:02:18 2004
Subject: [mod_python] apache.py suggestions
In-Reply-To: <Pine.LNX.4.10.10005260335290.21092-100000@nebula.lyra.org>
Message-ID: <NDBBIBMMILNGAOKOEEKDIECGCEAA.mmach@batory.org.pl>

> apache.py was doing something like the following:
>
>     exec "import " + module_name
>     module = eval(module_name)
>
> The above code is horribly inefficient compared to the code I provided
> (using __import__). You have two parse/compile passes at runtime. The
> "exec" disables certain optimizations. I don't think the code allows it,
> but if module_name happens to come from some user input, then you are
> effectively executing arbitrary code. Very bad.

Sorry, I realize now my question was stupid in fact - I assumed You're
talking about Python in general speaking about the __import__ thing. I
didn't watch see the mod_python code as carefully as You. ;-)

> Python vs mod_python? Bah. I wouldn't have brought it up if it wasn't a
> mod_python issue.

Well, the criticism was directed towards my own question, so don't take it
personally. ;-)

Best,
Michal

P.S. Perhaps I didn't mention it earlier, but I'm a happy man - noone will
tell me now that mod_perl rules. :-) One world, one language! (which means
Python, of course) :-)

---
Michal Mach   mmach@batory.org.pl
Stefan Batory Foundation
http://www.batory.org.pl/


From gstein at lyra.org  Fri May 26 08:21:34 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 22:02:18 2004
Subject: [mod_python] apache.py suggestions
In-Reply-To: <Pine.GSO.4.05.10005260802450.12724-100000@koi>
Message-ID: <Pine.LNX.4.10.10005260820440.23146-100000@nebula.lyra.org>

On Fri, 26 May 2000 grisha@verio.net wrote:
> On Fri, 26 May 2000, Greg Stein wrote:
> 
> > *) avoid exec/eval: they are quite slow, and can pose a security risk
> > *) to import modules, use: module = __import__(module_name)
> 
> The reasoning behind using exec to import was that __import__ doesn't
> understand dots (packages),

Eh? Sure it does.

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/


From grisha at ispol.com  Fri May 26 12:03:26 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:18 2004
Subject: [mod_python] apache.py suggestions
In-Reply-To: <Pine.LNX.4.10.10005260820440.23146-100000@nebula.lyra.org>
Message-ID: <Pine.LNX.4.21.0005261158110.27589-100000@saturn.ispol.com>

On Fri, 26 May 2000, Greg Stein wrote:

> > The reasoning behind using exec to import was that __import__ doesn't
> > understand dots (packages),
> 
> Eh? Sure it does.

Looks like it does indeed. I wonder why I put this comment in
(now obsolete) httpdapy:

                # we could use __import__ but it can't handle packages
                exec "import " + module_name

May be it's something new with 1.5 or 1.5.2? I'm almost tempted to compile
an old Python version, but I think I'll pass.... :-)

Grisha


From gstein at lyra.org  Fri May 26 09:12:23 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 22:02:18 2004
Subject: [mod_python] apache.py suggestions
In-Reply-To: <Pine.LNX.4.21.0005261158110.27589-100000@saturn.ispol.com>
Message-ID: <Pine.LNX.4.10.10005260909320.23146-100000@nebula.lyra.org>

On Fri, 26 May 2000, Gregory Trubetskoy wrote:
> On Fri, 26 May 2000, Greg Stein wrote:
> > > The reasoning behind using exec to import was that __import__ doesn't
> > > understand dots (packages),
> > 
> > Eh? Sure it does.
> 
> Looks like it does indeed. I wonder why I put this comment in
> (now obsolete) httpdapy:
> 
>                 # we could use __import__ but it can't handle packages
>                 exec "import " + module_name
> 
> May be it's something new with 1.5 or 1.5.2? I'm almost tempted to compile
> an old Python version, but I think I'll pass.... :-)

Yes, it is new to the Python 1.5 series. Before then, packages were only
possible if "ni" was imported. 1.5 built the logic directly into the core.

Due to the Interpreter/Thread State stuff in mod_python.c, you are
specific to Python 1.5 anyways, so relying on __import__ and packages
should be fine.

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/



From grisha at ispol.com  Fri May 26 13:13:59 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:18 2004
Subject: [mod_python] apache.py suggestions
In-Reply-To: <Pine.LNX.4.10.10005260909320.23146-100000@nebula.lyra.org>
Message-ID: <Pine.LNX.4.21.0005261303250.28220-100000@saturn.ispol.com>

OK, here is the deal - 

	exec "import " + module_name
	module = eval(module_name)

is not the same as module = __import__(module_name), but rather:

	module = __import__(module_name)
	list = string.split(module_name, ".")
	for n in list[1:]:
		module = getattr(module, n)

My quick tests on which is faster where inconclusive. The former is
less lines of code and is (IMHO) simpler to read, the latter is definitely
more secure since it doesn't have the exec or eval.

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Fri, 26 May 2000, Greg Stein wrote:

> On Fri, 26 May 2000, Gregory Trubetskoy wrote:
> > On Fri, 26 May 2000, Greg Stein wrote:
> > > > The reasoning behind using exec to import was that __import__ doesn't
> > > > understand dots (packages),
> > > 
> > > Eh? Sure it does.
> > 
k


From gstein at lyra.org  Fri May 26 10:37:22 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 22:02:18 2004
Subject: [mod_python] apache.py suggestions
In-Reply-To: <Pine.LNX.4.21.0005261303250.28220-100000@saturn.ispol.com>
Message-ID: <Pine.LNX.4.10.10005261024330.23146-200000@nebula.lyra.org>

On Fri, 26 May 2000, Gregory Trubetskoy wrote:
> OK, here is the deal - 
> 
> 	exec "import " + module_name
> 	module = eval(module_name)
> 
> is not the same as module = __import__(module_name), but rather:
> 
> 	module = __import__(module_name)
> 	list = string.split(module_name, ".")
> 	for n in list[1:]:
> 		module = getattr(module, n)
> 
> My quick tests on which is faster where inconclusive. The former is
> less lines of code and is (IMHO) simpler to read, the latter is definitely
> more secure since it doesn't have the exec or eval.

Mine were quite conclusive. The latter code is 4 to 6 times faster.

I've attached my timing script. Here is the output of a couple runs:

[gstein@kurgan python]$ ./time-eval.py
16.6380729675 2.65576100349 6.2648984399
22.0597770214 5.24019098282 4.20972767858
[gstein@kurgan python]$ ./time-eval.py
16.5899840593 2.59417903423 6.39508061719
21.954955101 5.28538203239 4.15390126323

Note that each run already loops through 10000 times, so the numbers above
should be quite stable.

Yes, I understand that the first import is longer than the following
imports. And that I'm not testing the cost of that first import. This is
intended: the underlying import mechanism which runs on that first import
is the same for both (e.g. the parse/load and module setup), so it can be
considered a constant factor and omitted.

Much of this may be moot anyhow since the "import" logic in question
occurs at startup only. But I don't think the use of exec/eval should ever
be encouraged :-) (performance and security)

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/
-------------- next part --------------
#!/usr/bin/env python

import time
import string

def do_timing(m):
  l = xrange(10000)

  t = time.time()
  for i in l:
    exec "import " + m
    mod = eval(m)
  t1 = time.time() - t

  t = time.time()
  for i in l:
    mod = __import__(m)
    for p in string.split(m, '.')[1:]:
      mod = getattr(mod, p)
  t2 = time.time() - t
  print t1, t2, t1/t2

do_timing('httplib')
do_timing('xml.dom.core')
From gstein at lyra.org  Fri May 26 10:49:44 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 22:02:18 2004
Subject: [mod_python] apache.py suggestions
In-Reply-To: <Pine.LNX.4.10.10005261024330.23146-200000@nebula.lyra.org>
Message-ID: <Pine.LNX.4.10.10005261048480.23146-100000@nebula.lyra.org>

On Fri, 26 May 2000, Greg Stein wrote:
>...
> Mine were quite conclusive. The latter code is 4 to 6 times faster.
>...
> Yes, I understand that the first import is longer than the following
> imports. And that I'm not testing the cost of that first import. This is
> intended: the underlying import mechanism which runs on that first import
> is the same for both (e.g. the parse/load and module setup), so it can be
> considered a constant factor and omitted.

Oops. One more note. I was accidentally charging that first import to the
exec/eval style. I moved that out, but it did not change the results at
all.

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/


From jbauer at rubic.com  Fri May 26 14:25:05 2000
From: jbauer at rubic.com (Jeff Bauer)
Date: Fri Jan  9 22:02:18 2004
Subject: [mod_python] quick code review
Message-ID: <392ECF91.78FD963D@rubic.com>

Many thanks to Greg for his code review and
suggestions.  The mod_python code will benefit
from Greg's experience, and the resulting product
should be easier to use and maintain.  The
earlier pyapache module had stability problems
that we shouldn't have to endure with mod_python.

-Jeff Bauer

From erno at iki.fi  Sat May 27 12:41:21 2000
From: erno at iki.fi (Erno Kuusela)
Date: Fri Jan  9 22:02:18 2004
Subject: [mod_python] quick code review
In-Reply-To: <392ECF91.78FD963D@rubic.com>; from jbauer@rubic.com on Fri, May 26, 2000 at 02:25:05PM -0500
References: <392ECF91.78FD963D@rubic.com>
Message-ID: <20000527124121.G20066@lib.hel.fi>

|                                        The
| earlier pyapache module had stability problems
| that we shouldn't have to endure with mod_python.

actually the predecessor to mod_python was httpdapy,
with which i haven't had any stability problems...

  -- erno

From jbauer at rubic.com  Sat May 27 07:10:49 2000
From: jbauer at rubic.com (Jeff Bauer)
Date: Fri Jan  9 22:02:18 2004
Subject: [mod_python] quick code review
 
Message-ID: <392FBB49.1D03D917@rubic.com>

JB>> earlier pyapache module had stability problems
JB>> that we shouldn't have to endure with mod_python.

EK> actually the predecessor to mod_python was httpdapy,
EK> with which i haven't had any stability problems...

I didn't mean to imply that pyapache was an earlier
version of mod_python, but rather that pyapache was the 
first experience of Python+Apache for many users.

-Jeff

From cobrien at Radix.Net  Sun May 28 10:29:51 2000
From: cobrien at Radix.Net (Cary O'Brien)
Date: Fri Jan  9 22:02:18 2004
Subject: [mod_python] Hi, database connection queston
Message-ID: <200005281429.KAA19075@saltmine.radix.net>

Hi,

Glad to hear about mod_python, it is almost exactly what I am looking for. 
I've used mod_perl/embperl and mod_dtcl, but I really wanted to try using
python.

I'm going to try to fire it up over the long weekend.

I've got a couple of questions (of course).

1) How are people handling persistant database connections?  Ideally (for me)
   there would be a single db connection for each apache process.  That 
   minimizes connection setup time (non-trivial for PostgreSQL at least),
   lets me control the number of database connections (apache max-servers), 
   and lets me control their lifetimes (i.e. serve 10,000 requests then exit),
   and restarts them if they die.  Nice eh?

   My question is how do I setup a shared database connection used by each
   handler?  It seems from the documentation that each request gets its own
   subinterpreter.  I'd like them all to be handled by the same sub-interpreter.
   Or, in reality, just share the same db connection.

   The python doc for Py_NewInterpreter() says

     the new interpreter has separate, independent versions of all imported modules, 

   So what happens to class variables.  Can I connect to the database there?

2) Re Zope.  There seems to be a ZPublisher interface.  Does this mean I can
   run 30 apache processes against the same Zope database?  How fine/course is
   the locking on the zope database?  I asked this on the zope list a while
   back and didn't get a good answer.

3) Does anyone have the bits to embed python calls in an html document a-la 
   embperl/php/mod_dtcl? I know mixing logic with presentation is 
   in general a bad idea, but having embedded code in documents is a fast
   way to get things up and running.
   
-- cary

Cary O'Brien
cobrien@radix.net



 





From jam at quark.emich.edu  Sun May 28 10:52:22 2000
From: jam at quark.emich.edu (Jeff)
Date: Fri Jan  9 22:02:18 2004
Subject: [mod_python] SUCCESS-- mod_python as DSO
Message-ID: <20000528105222.C25643@quark.emich.edu>

Greetings,

I'm happy to report that I was able to get Apache on a Red Hat 6.2 box
working while loading mod_python as a DSO. I took the advise of one of the
FAQ entries, and put the "LoadModule" directive up at the top (instead of
the bottom) of the list in httpd.conf, and it worked just fine (previously I
would get a core dump from Apache).

My question is: why is this necessary? Does this reflect a bug in Apache or
is it some other issue?

Regards,
J
-- 
|| visit gfd <http://quark.emich.edu/>
|| psa member -- <http://www.python.org/psa/> 

From walter at bnbt.de  Sun May 28 17:58:40 2000
From: walter at bnbt.de (Walter =?iso-8859-1?Q?D=F6rwald?=)
Date: Fri Jan  9 22:02:18 2004
Subject: [mod_python] Hi, database connection queston
In-Reply-To: <200005281429.KAA19075@saltmine.radix.net>
Message-ID: <4.3.1.0.20000528175049.00ae2ab0@mail.bnbt.de>

At 16:29 28.05.00, Cary O'Brien wrote:

>[...]
>
>3) Does anyone have the bits to embed python calls in an html document a-la
>    embperl/php/mod_dtcl?

You might want to try XIST available from
ftp://titan.bnbt.de/pub/livinglogic/xist/

It needs a little additional logic to wire the HTML files to the
mod_python RequestHandler, but this shouldn't be a big deal.

>  I know mixing logic with presentation is
>    in general a bad idea, [...]

Well XIST helps you with that too.

Bye,
         Walter D?rwald


From jam at quark.emich.edu  Sun May 28 13:53:01 2000
From: jam at quark.emich.edu (Jeff)
Date: Fri Jan  9 22:02:19 2004
Subject: [mod_python] trouble with mod_python from public_html directory
Message-ID: <20000528135301.B28853@quark.emich.edu>

Greetings,

I'm having difficulty figuring out this problem, and I'm hoping someone will
be able to help get it resolved. I'm not sure if this is a problem with
mod_rewrite or mod_python or my configuration of them.

I have the following .htaccess file in /home/jam/public_html:
[~/public_html] [1:35pm] [jam@toast-pts/2] % cat .htaccess 
AddHandler python-program .py
PythonHandler cgihandler
RewriteEngine on
RewriteCond %{REQUEST_FILENAME} !-s
RewriteRule ^(.*)\.html$          $1.py   [L]

The intent of the rewrite rule is if the URL requests a file ending in
.html, it will check first to see if that file exists (and send it as normal
if it does), and if a suitable file does *not* exist, check for a .py
extension and run that via mod_python if it does.

The above set of directives works *fine* if I install it in
/home/httpd/html.. I can request 'index.html' and it will run the 'index.py'
module I've created.

The problem starts when I copy the .htaccess file to my home directory, and
try to get the same thing to work. it doesn't. I get the following error in
the /var/log/httpd/error_log file: [Sun May 28 13:36:02 2000] [error]
[client 192.168.2.3] File does not exist:
/home/httpd/html/home/jam/public_html/index.py

This indicates the reason for the error-- it's looking for a file called
"/home/httpd/html/home/jam/public_html/index.py", which clearly doesn't
exist (it should instead be "/home/jam/public_html/index.py").

This error occurs regardless of the existence of a .htaccess file in
/home/httpd/html-- I had thought that might be part of the problem, so at
first I added a "PythonInterpPerDirectory" directive, and then renamed the
file so it wouldn't be used, and tried again-- no luck.

I'm not sure if I need to present more information before this problem can
be solved.. please let me know if I can answer any questions about the setup
that might point me in the right direction.

Thanks in advance ;)

Regards,
J
-- 
|| visit gfd <http://quark.emich.edu/>
|| psa member -- <http://www.python.org/psa/> 

From richard at whitequeen.com  Sun May 28 11:01:05 2000
From: richard at whitequeen.com (richard offer)
Date: Fri Jan  9 22:02:19 2004
Subject: [mod_python] Apache fails to start: ImportError: No module named mod_python.apache
Message-ID: <200005281801.e4SI15p04688@erij.whitequeen.com>

Hi,

Apache is failing to start when I have mod_python as a DSO on RH 6.1.

The report from the apache error log is

Traceback (innermost last):
  File "<string>", line 1, in ?
ImportError: No module named mod_python.apache
PythonInitFunction: could not import mod_python.apache.


I've rebuilt python to live under the same top level directory as Apache
(/usr/www/).

[root@erij bin]# ls /usr/www/lib/python1.5/site-packages/mod_python/
__init__.py   apache.py   cgihandler.py   httpdapi.py   zhandler.py
__init__.pyc  apache.pyc  cgihandler.pyc  httpdapi.pyc  zhandler.pyc

[root@erij bin]# ls /usr/www/libexec/
httpd.exp         mod_autoindex.so  mod_include.so      mod_rewrite.so
libproxy.so       mod_cern_meta.so  mod_info.so         mod_setenvif.so
mod_access.so     mod_cgi.so        mod_log_agent.so    mod_speling.so
mod_actions.so    mod_digest.so     mod_log_config.so   mod_status.so
mod_alias.so      mod_dir.so        mod_log_referer.so  mod_unique_id.so
mod_asis.so       mod_env.so        mod_mime.so         mod_userdir.so
mod_auth.so       mod_example.so    mod_mime_magic.so   mod_usertrack.so
mod_auth_anon.so  mod_expires.so    mod_mmap_static.so  mod_vhost_alias.so
mod_auth_db.so    mod_headers.so    mod_negotiation.so
mod_auth_dbm.so   mod_imap.so       mod_python.so

[root@erij bin]# ldd /usr/www/libexec/mod_python.so 
        libpthread.so.0 => /lib/libpthread.so.0 (0x400a9000)
        libc.so.6 => /lib/libc.so.6 (0x400bb000)
        /lib/ld-linux.so.2 => /lib/ld-linux.so.2 (0x80000000)


[root@erij bin]# /usr/www/bin/python
Python 1.5.2 (#1, May 28 2000, 08:30:59)  [GCC egcs-2.91.66 19990314/Linux (egcs- on linux2
Copyright 1991-1995 Stichting Mathematisch Centrum, Amsterdam
>>> import mod_python
>>> from mod_python import apache
Traceback (innermost last):
  File "<stdin>", line 1, in ?
  File "/usr/www/lib/python1.5/site-packages/mod_python/apache.py", line 18, in ?
    import _apache
ImportError: No module named _apache

[ I don't expect this last one to work, but its at least picking up the
right module ]



Can someone hit me with a clue stick.




richard.


-----------------------------------------------------------------------
richard offer @ home 
_______________________________http://www.whitequeen.com/users/richard/


From grisha at ispol.com  Sun May 28 14:06:26 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:19 2004
Subject: [mod_python] Hi, database connection queston
In-Reply-To: <200005281429.KAA19075@saltmine.radix.net>
Message-ID: <Pine.LNX.4.21.0005281353050.14870-100000@saturn.ispol.com>

On Sun, 28 May 2000, Cary O'Brien wrote:

> 1) How are people handling persistant database connections?
[....]
>    It seems from the documentation that each request gets its own
>    subinterpreter.

Incorrect. Each directive directory and its subdirectories get its own
subinterpreter. All requests for files in the directory where the
Python*Handler directive was first encountered and its subdirectories are
in the same subinterpreter.

This behaviour can be altered via PythonInterpreter or
PythonInterPerDirectory directives.

As far as database connections - here how I used to do it. I had a module
called data.py (this is not the entire code, some parts are cut out, think
of it as an example rather than something ready to use. cfg contained
configuration). In your scripts, you would have something like:

import data
result = data._run_sql("select * from myteable")

And it would behave exactly as you describe - initiate the db connection
once and keep it for as long as the process lives. Of course, you end up
having as many connections as there are Apache processes, which you can
control by MaxClients directive.

-------------

import cfg
import mysqldb
import string

def _db_login(relogin = 0):
    """Login to the database
    """

    global DB_CONN

    if relogin:
        DB_CONN = mysqldb.mysqldb(cfg.DB_LOGIN)
        return DB_CONN
    else:
        try:
            return DB_CONN

        except NameError:

            DB_CONN = mysqldb.mysqldb(cfg.DB_LOGIN)
            return DB_CONN

def _run_sql( sql, n = 0, with_desc=0 ):
    """ Runs SQL on the server and returns result
    """

    db = _db_login()

    try:
        cur = db.cursor()
        rc = cur.execute(sql)

    except:
        # it's possible that mysql connection
        # timed out. Try one more time.
        db = _db_login(relogin = 1)
        cur = db.cursor()
        rc = cur.execute(sql)

    if string.upper(string.split(sql)[0]) in \
       ("SELECT", "SHOW", "DESC", "DESCRIBE"):
        if n:
            recset = cur.fetchmany(n)
        else:
            recset = cur.fetchall()

        if with_desc:
            return recset, cur.description
        else:
            return recset
    else:
        return rc

------------------

> 2) Re Zope.  There seems to be a ZPublisher interface.  Does this mean I can
>    run 30 apache processes against the same Zope database?  

As I already said on comp.lang.python - no.

>    How fine/course is
>    the locking on the zope database?  I asked this on the zope list a while
>    back and didn't get a good answer.

The first process will lock the database, and all the other ones will just
sit there and wait :-(

> 3) Does anyone have the bits to embed python calls in an html document a-la 
>    embperl/php/mod_dtcl? I know mixing logic with presentation is 
>    in general a bad idea, but having embedded code in documents is a fast
>    way to get things up and running.

You can use the Z DocuemntTemplate with ZHandler, it works pretty well.

HTH,

Grisha


From grisha at ispol.com  Sun May 28 14:10:32 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:19 2004
Subject: [mod_python] SUCCESS-- mod_python as DSO
In-Reply-To: <20000528105222.C25643@quark.emich.edu>
Message-ID: <Pine.LNX.4.21.0005281408570.14870-100000@saturn.ispol.com>

Could you send a list of all LoadModules you had and the sequence that
works and the one that doesn't?


On Sun, 28 May 2000, Jeff wrote:

> I took the advise of one of the
> FAQ entries, and put the "LoadModule" directive up at the top (instead of
> the bottom) of the list in httpd.conf, and it worked just fine (previously I
> would get a core dump from Apache).


From grisha at ispol.com  Sun May 28 14:20:30 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:19 2004
Subject: [mod_python] Apache fails to start: ImportError: No module named
 mod_python.apache
In-Reply-To: <200005281801.e4SI15p04688@erij.whitequeen.com>
Message-ID: <Pine.LNX.4.21.0005281418440.14870-100000@saturn.ispol.com>

Did you rebuild mod_python after rebuilding Python and made sure that it
is linked against the new libpython library? I have a feeling mod_python
is still looking in /usr/local

Grisha

On Sun, 28 May 2000, richard offer wrote:

> 
> Hi,
> 
> Apache is failing to start when I have mod_python as a DSO on RH 6.1.
> 
> The report from the apache error log is
> 
> Traceback (innermost last):
>   File "<string>", line 1, in ?
> ImportError: No module named mod_python.apache
> PythonInitFunction: could not import mod_python.apache.
> 
> 
> I've rebuilt python to live under the same top level directory as Apache
> (/usr/www/).


From jam at quark.emich.edu  Sun May 28 14:40:34 2000
From: jam at quark.emich.edu (Jeff)
Date: Fri Jan  9 22:02:19 2004
Subject: [mod_python] trouble with mod_python from public_html directory
In-Reply-To: <Pine.LNX.4.21.0005281413050.14870-100000@saturn.ispol.com>; from grisha@ispol.com on Sun, May 28, 2000 at 02:15:01PM -0400
References: <20000528135301.B28853@quark.emich.edu> <Pine.LNX.4.21.0005281413050.14870-100000@saturn.ispol.com>
Message-ID: <20000528144034.D28853@quark.emich.edu>

On Sun, May 28, 2000 at 02:15:01PM -0400, Gregory Trubetskoy wrote:
> 
> Try replacing "AddHandler python-program .py" with "AddHandler cgi-script
> .py" and see if you get the same errors. 
> 
> This will tell you whether this is at all related to mod_python. I suspect
> it isn't - the "File not found" is not a mod_python error.
> 

You were correct.. this had nothing to do with mod_python, but rather
something odd with mod_rewrite. When I added a 'RewriteBase /~jam/'
directive to the .htaccess file in my public_html, things started working as
designed. This directive is not necessary in directories off of
/home/httpd/html, though. This isn't the generic solution I was expecting,
but it works, so I'm going to move on.

Thanks for the help.

Regards,
J
-- 
|| visit gfd <http://quark.emich.edu/>
|| psa member -- <http://www.python.org/psa/> 

From danilo at telusplanet.net  Sun May 28 18:54:02 2000
From: danilo at telusplanet.net (Danilo Fiorenzano)
Date: Fri Jan  9 22:02:19 2004
Subject: [mod_python] Hi, database connection queston
In-Reply-To: Gregory Trubetskoy's message of "Sun, 28 May 2000 14:06:26 -0400 (EDT)"
References: <Pine.LNX.4.21.0005281353050.14870-100000@saturn.ispol.com>
Message-ID: <m31z2mnplh.fsf@spike.interalta.com>

On Sun, 28 May 2000, Cary O'Brien wrote:
 
> 1) How are people handling persistant database connections?
> [....]
>    It seems from the documentation that each request gets its own
>    subinterpreter.

Since global vars retain their values between requests serviced by the
same httpd process, I ended up doing something like this:

---------------- cut ---------------- cut ---------------- cut ----------------
import informixdb
import os, re, cgi, string
from mod_python import apache

_dbconn = None

def handler(req):
    global _dbconn

    ... etc etc ...
    results = findProducts('acid')
    ... etc etc ...


def findProducts(substring):
    global _dbconn

    if _dbconn == None:
        try:
            _dbconn = informixdb.informixdb('db@server', 'user', 'password')
        except:
            return ['Access Denied']

    c = _dbconn.cursor()
    blah = "%" + string.lower(substring) + "%"

    c.execute("select strshippingname from tblproducts where lower(strshippingname) like ?", (blah,))
    retval = []
    for row in c.fetchall():
        retval.append(row[0])

    return retval

---------------- cut ---------------- cut ---------------- cut ----------------

  This works exactly as you want, although it should also have a "try:
except:" block around the actual query, to recover from dropped
connections et similia.  Otherwise, normally the connection is
established only when a freshly-spawned httpd executes a query for the
first time, and should persist until it reaches 'MaxRequestsPerChild"
in httpd.conf - then the httpd instance is terminated and the
connection is closed automatically.

 I have been wondering how one could automatically preload a Python
module upon start of a new httpd, so users would not have to endure
the occasional delay due to the opening of a new connection to the
database.  I suspect it may be possible by using some apache
directives, but I haven't really looked into it yet :)

-- Shade

From grisha at ispol.com  Sun May 28 22:22:13 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:19 2004
Subject: [mod_python] Hi, database connection queston
In-Reply-To: <m31z2mnplh.fsf@spike.interalta.com>
Message-ID: <Pine.LNX.4.21.0005282218240.16648-100000@saturn.ispol.com>

On 28 May 2000, Danilo Fiorenzano wrote:

>  I have been wondering how one could automatically preload a Python
> module upon start of a new httpd, so users would not have to endure
> the occasional delay due to the opening of a new connection to the
> database.  I suspect it may be possible by using some apache
> directives, but I haven't really looked into it yet :)

Such directive does not exist just yet, but it is planned for the future.

Grisha


From grisha at ispol.com  Mon May 29 11:44:15 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:19 2004
Subject: [mod_python] quick code review
In-Reply-To: <Pine.LNX.4.10.10005251801100.16846-100000@nebula.lyra.org>
Message-ID: <Pine.LNX.4.21.0005291123250.18967-100000@saturn.ispol.com>

On Thu, 25 May 2000, Greg Stein wrote:

> *) rather than storing the "request object" into r->notes, place it into
>    tstate->dict. you won't have to do the atoi() stuff (which is Bad
>    anyways)

This won't work. Or rather it will, but it's getting too complex to be
worth it. 

The problem is that a single request can span multiple thread states - a
typical scenario is when there is a PythonAuthenHandler directive
somewhere in a parent directory and a PythonHandler directive in a
subdirectory. The two handlers will be executed in different
subinterpreters, thereofre having different tstates and result in two
separate requestobjects being instantiated. 

So you get the malloc penalty plus the complexity of dealing with the
tstate->dict dictionary (which too will need to be created, another
malloc) for not much of a practical gain other than proper code, which,
btw, becomes kind of arcane and hard to understand (a bad thing as well).

It seems to me that I am working around what is really an Apache
limitation. The request_rec is clearly the right place to store a pointer
to a requestobject for that request_rec, the limitation is that the place
alloted for these sorts of things (r->notes) only deals with strings.

I think there needs to be something similar to r->notes that can take a
pointer. For now, I think I'm going to revert to the atoi stuff...

Grisha


From grisha at ispol.com  Mon May 29 13:13:51 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:19 2004
Subject: [mod_python] mod_python 2.1
Message-ID: <Pine.LNX.4.21.0005291305150.19547-100000@saturn.ispol.com>

Is available for download. Functionally, it should be equivalent to 2.0
(i.e. no new features), internally, a lot of changes were made mostly
resulting in cleaner code, better performance and security, as well as
(eventually) stability ("eventually" because stability is something that
I'd rather not brag about after having made so many changes). BIG THANKS
to Greg Stein for taking the time to review the code and comments.

Enjoy!

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com



From gstein at lyra.org  Mon May 29 12:36:10 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 22:02:19 2004
Subject: [mod_python] quick code review
In-Reply-To: <Pine.LNX.4.21.0005291123250.18967-100000@saturn.ispol.com>
Message-ID: <Pine.LNX.4.10.10005291225280.14857-100000@nebula.lyra.org>

On Mon, 29 May 2000, Gregory Trubetskoy wrote:
> On Thu, 25 May 2000, Greg Stein wrote:
> 
> > *) rather than storing the "request object" into r->notes, place it into
> >    tstate->dict. you won't have to do the atoi() stuff (which is Bad
> >    anyways)
> 
> This won't work. Or rather it will, but it's getting too complex to be
> worth it. 
> 
> The problem is that a single request can span multiple thread states - a
> typical scenario is when there is a PythonAuthenHandler directive
> somewhere in a parent directory and a PythonHandler directive in a
> subdirectory. The two handlers will be executed in different
> subinterpreters, thereofre having different tstates and result in two
> separate requestobjects being instantiated. 

All right. Fair enough.

Apache will use a single thread, but the multiple interpreters is a good
point (that I hadn't seen).

>...
> It seems to me that I am working around what is really an Apache
> limitation. The request_rec is clearly the right place to store a pointer
> to a requestobject for that request_rec, the limitation is that the place
> alloted for these sorts of things (r->notes) only deals with strings.

True.

> I think there needs to be something similar to r->notes that can take a
> pointer. For now, I think I'm going to revert to the atoi stuff...

At least use atol(). Still far from portable, but better.

(in the "ascii" scheme, the "best" would be to use PyLong_FromVoidPtr(),
 then convert that long to a string; reverse that sequence for the other
 direction)

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/


From gstein at lyra.org  Mon May 29 12:43:49 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 22:02:19 2004
Subject: [mod_python] quick code review
In-Reply-To: <Pine.LNX.4.21.0005281654430.15397-100000@saturn.ispol.com>
Message-ID: <Pine.LNX.4.10.10005291242580.14857-100000@nebula.lyra.org>

On Sun, 28 May 2000, Gregory Trubetskoy wrote:
> On Thu, 25 May 2000, Greg Stein wrote:
> > *) exit(1) should not be used; use ap_log_rerror() and return failure
> >    codes to Apache
> 
> are you sure?
> 
> the module initializer is a void *, its return doesn't seem to be checked
> at all.

I was referring more to the make_obcallback() function.

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/


From grisha at ispol.com  Mon May 29 20:42:33 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:19 2004
Subject: [mod_python] quick code review
In-Reply-To: <Pine.LNX.4.10.10005291242580.14857-100000@nebula.lyra.org>
Message-ID: <Pine.LNX.4.21.0005292040440.21046-100000@saturn.ispol.com>

On Mon, 29 May 2000, Greg Stein wrote:

> I was referring more to the make_obcallback() function.

Rats - I didn't it even see it there! Will fix in 2.2.

Grisha


From grisha at ispol.com  Mon May 29 20:55:32 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:19 2004
Subject: [mod_python] SUCCESS-- mod_python as DSO
In-Reply-To: <20000529104801.B29367@quark.emich.edu>
Message-ID: <Pine.LNX.4.21.0005292044500.21046-100000@saturn.ispol.com>

Curious.... I do most of my development and testing on FreeBSD 4.0 and
occasional testing on a Debian Linux (Potato) and a Sun Sparc (Sol 2.7).
On one FreeBSD system I have a very similar ClearModuleList set up (the
default FreeBSD Apache port install). I have LoadModule python_module dead
last and it works great...

I guess I'm going to have to install Red Hat somewhere, since it seems to
be the most popular thing out there....

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com~

On Mon, 29 May 2000, Jeff wrote:

> On Sun, May 28, 2000 at 02:10:32PM -0400, Gregory Trubetskoy wrote:
> > 
> > Could you send a list of all LoadModules you had and the sequence that
> > works and the one that doesn't?
> > 
> 
> The following sequence works. This list is a piece of the most stripped down
> config I could make and still have a useful webserver. It could probably be
> trimmed even more.
> 
> LoadModule python_module      modules/mod_python.so
> LoadModule env_module         modules/mod_env.so
> LoadModule config_log_module  modules/mod_log_config.so
> LoadModule agent_log_module   modules/mod_log_agent.so
> LoadModule referer_log_module modules/mod_log_referer.so
> LoadModule mime_module        modules/mod_mime.so
> LoadModule negotiation_module modules/mod_negotiation.so
> LoadModule status_module      modules/mod_status.so
> LoadModule autoindex_module   modules/mod_autoindex.so
> LoadModule dir_module         modules/mod_dir.so
> LoadModule userdir_module     modules/mod_userdir.so
> LoadModule alias_module       modules/mod_alias.so
> LoadModule rewrite_module     modules/mod_rewrite.so
> LoadModule access_module      modules/mod_access.so
> LoadModule setenvif_module    modules/mod_setenvif.so
> 
> ClearModuleList
> AddModule mod_env.c
> AddModule mod_log_config.c
> AddModule mod_log_agent.c
> AddModule mod_log_referer.c
> AddModule mod_mime.c
> AddModule mod_negotiation.c
> AddModule mod_status.c
> AddModule mod_autoindex.c
> AddModule mod_dir.c
> AddModule mod_userdir.c
> AddModule mod_alias.c
> AddModule mod_rewrite.c
> AddModule mod_access.c
> AddModule mod_so.c
> AddModule mod_setenvif.c
> AddModule mod_python.c
> 
> If I change the list so that mod_python is loaded *last* (or, apparently,
> anything other than first), Apache will core dump. I haven't tried changing
> the sequence of the 'AddModule' directives to see if it changes the
> situation. Please let me know if that would be a useful test, or if there
> are any more questions or concerns.
> 
> Regards,
> J
> -- 
> || visit gfd <http://quark.emich.edu/>
> || psa member -- <http://www.python.org/psa/> 
> 


From aiglauer at yahoo.com  Wed May 31 05:38:17 2000
From: aiglauer at yahoo.com (Alexis Iglauer)
Date: Fri Jan  9 22:02:19 2004
Subject: [mod_python] Python as a DSO problems
Message-ID: <20000531123817.9586.qmail@web2205.mail.yahoo.com>

I have had exactly the same problem in Mandrake 6.0
and Mandrake 7.0 - core dump if mod_python is at the
bottom of the list, works at the top.

I had another problem in MDK 7.0 - I had to install
the files from the mod_packages/ dir into
/usr/lib/python-1.5/site-packages - it did not work in
a mod_python subirectory off that folder.  Could just
have been an effect of a late night too though.

aei

__________________________________________________
Do You Yahoo!?
Send instant messages & get email alerts with Yahoo! Messenger.
http://im.yahoo.com/

From aiglauer at yahoo.com  Wed May 31 05:43:03 2000
From: aiglauer at yahoo.com (Alexis Iglauer)
Date: Fri Jan  9 22:02:19 2004
Subject: [mod_python] Modules not reloading when changed
Message-ID: <20000531124303.145.qmail@web2206.mail.yahoo.com>

I am developing a CGI app using the cgihandler.  There
are several different pages, each with their own .py
file and there is one .py file (SLobj.py) which is
imported by nearly all these individual files, but is
never used by apache directly.  The problem I have is
that the website runs old code - I can see from the
debug logs that it is running old code from SLobj.py
which I have already changed.

Is there a way to force mod_python to reload the .py
modules?  I am not using PythonNoReload.

Thanks
aei

__________________________________________________
Do You Yahoo!?
Send instant messages & get email alerts with Yahoo! Messenger.
http://im.yahoo.com/

From grisha at ispol.com  Wed May 31 09:17:51 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:19 2004
Subject: [mod_python] Modules not reloading when changed
In-Reply-To: <20000531124303.145.qmail@web2206.mail.yahoo.com>
Message-ID: <Pine.LNX.4.21.0005310856020.28492-100000@saturn.ispol.com>


On Wed, 31 May 2000, Alexis Iglauer wrote:

> Is there a way to force mod_python to reload the .py
> modules?  I am not using PythonNoReload.

Unfortunately, mod_python has no way of controlling what modules your
scripts will be importing and making them reload.

There are a few ways to force a reload of modules that have changed and
are imported "indirectly":

1. The obvious - restart the server. 

2. The not so obvious - invoke the module that needs reloading directly
via a URL.  This will produce an error, but will force the module to
reload. This doesn't work too well when the module is not in one of the
WWW accessible directories because you will get a "File not found".

Another catch with this approach is that you will have to do this as many
times as there are apache server processes currently running.

3. Recommended approach. Create a debug flag in your scripts and do a
reload when it is on:

DEBUG = 1

import mymodulea
import mymoduleb
import string
import cgi

if DEBUG:
	mymodulea = reload(mymodulea)
	mymoduleb = reload(mymoduleb)

When you're done debugging, you set DEBUG to 0 or None.

HTH,

Grisha


