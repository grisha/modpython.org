<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Mod_python and kerberos authentication
	(mod_auth_kerb)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Mod_python%20and%20kerberos%20authentication%0A%09%28mod_auth_kerb%29&In-Reply-To=BC53C974C3B9E542BC0A9BD4C5B1168A03EB07A9%40NEWMAIL.manord.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024666.html">
   <LINK REL="Next"  HREF="024669.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Mod_python and kerberos authentication
	(mod_auth_kerb)</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Mod_python%20and%20kerberos%20authentication%0A%09%28mod_auth_kerb%29&In-Reply-To=BC53C974C3B9E542BC0A9BD4C5B1168A03EB07A9%40NEWMAIL.manord.com"
       TITLE="[mod_python] Mod_python and kerberos authentication
	(mod_auth_kerb)">graham.dumpleton at gmail.com
       </A><BR>
    <I>Mon Jan 14 16:27:49 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="024666.html">[mod_python] Mod_python and kerberos authentication
	(mod_auth_kerb)
</A></li>
        <LI>Next message: <A HREF="024669.html">[mod_python] Mod_python and kerberos authentication
	(mod_auth_kerb)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24668">[ date ]</a>
              <a href="thread.html#24668">[ thread ]</a>
              <a href="subject.html#24668">[ subject ]</a>
              <a href="author.html#24668">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>No access to mod_python code right now to do any checking so only
thing I can suggest is to set handler to be mod_python.testhandler and
have a look at what it returns and see if you can see anything strange
about the request details that make it through. You might scrub what
it shows of any sensitive data and post it.

Graham

On 14/01/2008, Cassiano, Marco &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mcassiano at manord.com</A>&gt; wrote:
&gt;<i> Graham,
</I>&gt;<i>
</I>&gt;<i> thank you for your answer.
</I>&gt;<i> I've made a very simple test script named domain_login.py. Here it is :
</I>&gt;<i>
</I>&gt;<i> def check_user(req):
</I>&gt;<i>         return 'ok'
</I>&gt;<i>
</I>&gt;<i> and I call it with the URL  <A HREF="http://apache.foo.com/login/domain_login.py/check_user">http://apache.foo.com/login/domain_login.py/check_user</A>
</I>&gt;<i>
</I>&gt;<i> So, to answer your question, the request is a GET.
</I>&gt;<i> It is strange that if I put in the URL a wrong (non-existent) name, for example :
</I>&gt;<i>
</I>&gt;<i>  <A HREF="http://apache.foo.com/login/domain_login.py/wrong_call">http://apache.foo.com/login/domain_login.py/wrong_call</A>
</I>&gt;<i>
</I>&gt;<i> I got the same Bad Request error. So the problem seems to occur before the execution of the script.
</I>&gt;<i> In the apache error log I only see that the kerberos authentication was ok and then nothing else...
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> [Mon Jan 14 10:04:35 2008] [debug] src/mod_auth_kerb.c(1485): [client 192.168.1.25] kerb_authenticate_user entered with user (NULL) and auth_type Kerberos
</I>&gt;<i> [Mon Jan 14 10:04:35 2008] [debug] src/mod_auth_kerb.c(1485): [client 192.168.1.25] kerb_authenticate_user entered with user (NULL) and auth_type Kerberos
</I>&gt;<i> [Mon Jan 14 10:04:35 2008] [debug] src/mod_auth_kerb.c(1172): [client 192.168.1.25] Acquiring creds for HTTP/<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">sviluppo.manord.com at MANORD.COM</A>
</I>&gt;<i> [Mon Jan 14 10:04:35 2008] [debug] src/mod_auth_kerb.c(1316): [client 192.168.1.25] Verifying client data using SPNEGO GSS-API
</I>&gt;<i> [Mon Jan 14 10:04:35 2008] [debug] src/mod_auth_kerb.c(1332): [client 192.168.1.25] Verification returned code 0
</I>&gt;<i> [Mon Jan 14 10:04:35 2008] [debug] src/mod_auth_kerb.c(1350): [client 192.168.1.25] GSS-API token of length 151 bytes will be sent back
</I>&gt;<i>
</I>&gt;<i> In the apache access.log I see two entries
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> 192.168.1.25 - - [14/Jan/2008:10:56:04 +0100] &quot;GET /login/domain_login1.py/check_user HTTP/1.1&quot; 401 401 &quot;-&quot; &quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.11) Gecko/20071127 Firefox/2.0.0.11&quot;
</I>&gt;<i> 192.168.1.25 - <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">myuser at FOO.COM</A> [14/Jan/2008:10:56:04 +0100] &quot;GET /login/domain_login1.py/check_user HTTP/1.1&quot; 404 231 &quot;-&quot; &quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.11) Gecko/20071127 Firefox/2.0.0.11&quot;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> In the second line the windows domain user is correctly reported so it seems the kerberos authentication worked...
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> If I remove the kerberos authentication, the script works ok.
</I>&gt;<i> If I remove the mod_python handler from the directory and I ask for a plain html page the kerberos authentication works...
</I>&gt;<i>
</I>&gt;<i> We also tried with mod_python.servlet (PythonHandler mod_python.servlet)
</I>&gt;<i> and the kerberos authentication works perfectly. The script is executed and we can retrieve the username in req.user.
</I>&gt;<i>
</I>&gt;<i> So it seems a problem related to the publisher....
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Thank you
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Marco Cassiano
</I>&gt;<i>
</I>&gt;<i> Manifatture del Nord srl unipersonale
</I>&gt;<i> Gruppo MaxMara
</I>&gt;<i>
</I>&gt;<i> via Mazzacurati 6
</I>&gt;<i> 42100 Reggio Emilia RE
</I>&gt;<i> ITALY
</I>&gt;<i>
</I>&gt;<i> Tel. +39 0522 358215
</I>&gt;<i> Fax +39 0522 268715
</I>&gt;<i> email : <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mcassiano at manord.com</A>
</I>&gt;<i> www.pennyblack.com
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> The contents of the present communication is strictly confidential and reserved solely to the referred addressees. In the event was received by person different from the addressee, it is forbidden the diffusion, distribution and copy. In the event you have received it mistakenly we ask you to inform us and to destroy and/or to delete it by your computer, without using the data herein contained.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> The present message (eventual annexes inclusive) shall not be considered any contractual proposal and/or acceptance of offer coming from the addressee, nor waiver neither recognizance of rights, debts and/or credits, and it shall not be binding, when it is not executed a subsequent agreement by person who could lawfully represent us. No pre-contractual liability shall derive to us, when the present communication is not followed by any binding agreement between the parties.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> -----Original Message-----
</I>&gt;<i> From: Graham Dumpleton [mailto:<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">graham.dumpleton at gmail.com</A>]
</I>&gt;<i> Sent: Friday, January 11, 2008 10:24 PM
</I>&gt;<i> To: Cassiano, Marco
</I>&gt;<i> Cc: <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python at modpython.org</A>
</I>&gt;<i> Subject: Re: [mod_python] Mod_python and kerberos authentication (mod_auth_kerb)
</I>&gt;<i>
</I>&gt;<i> When using mod_python.publisher, you would get a Bad Request error if
</I>&gt;<i> the request wasn't either a GET or POST. What is the type of HTTP
</I>&gt;<i> request?
</I>&gt;<i>
</I>&gt;<i> Graham
</I>&gt;<i>
</I>&gt;<i> On 12/01/2008, Cassiano, Marco &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mcassiano at manord.com</A>&gt; wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Hi all,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I've just configured our apache server (Linux RedHat) for kerberos
</I>&gt;<i> &gt; authentication to allow our windows domain users to access it without having
</I>&gt;<i> &gt; to reauthenticate.
</I>&gt;<i> &gt; Everything works fine for a plain html directory, so I'm pretty sure that
</I>&gt;<i> &gt; the kerberos configuration for the apache server is working.
</I>&gt;<i> &gt; When I try to specify Kerberos authentication together with mod_python it's
</I>&gt;<i> &gt; not working. I got the message :
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Bad Request
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Your browser sent a request that this server could not understand.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; My httpd configuration is :
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Alias /login/ &quot;/var/www/kerb/login/&quot;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &lt;Directory &quot;/var/www/kerb/login&quot;&gt;
</I>&gt;<i> &gt; ##  AuthName &quot;Kerberos Login&quot;
</I>&gt;<i> &gt;   AuthType Kerberos
</I>&gt;<i> &gt;   KrbAuthRealm FOO.COM
</I>&gt;<i> &gt;   KrbServiceName HTTP/<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">apache.foo.com at FOO.COM</A>
</I>&gt;<i> &gt;   Krb5Keytab /etc/httpd/conf/apache.tab
</I>&gt;<i> &gt;   KrbMethodNegotiate on
</I>&gt;<i> &gt;   KrbMethodK5Passwd off
</I>&gt;<i> &gt; #  KrbSaveCredentials off
</I>&gt;<i> &gt; #  KrbVerifyKDC off
</I>&gt;<i> &gt;   Require valid-user
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;   Order Deny,Allow
</I>&gt;<i> &gt;   Deny from all
</I>&gt;<i> &gt;   Allow from foo.com
</I>&gt;<i> &gt;   Allow from 127.0.0.1
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;   SetHandler mod_python
</I>&gt;<i> &gt;   PythonHandler mod_python.publisher | .py
</I>&gt;<i> &gt;   PythonDebug on
</I>&gt;<i> &gt;   PythonOption ApplicationPath '/'
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &lt;/Directory&gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Thanks in advance for your advice
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Marco Cassiano
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Manifatture del Nord srl
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Italy
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ---------------------------------------------------------------------------------------------
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Il contenuto della presente comunicazione &#232; riservato e destinato
</I>&gt;<i> &gt; esclusivamente ai destinatari indicati. Nel caso in cui sia ricevuto da
</I>&gt;<i> &gt; persona diversa dal destinatario sono proibite la diffusione, la
</I>&gt;<i> &gt; distribuzione e la copia. Nel caso riceveste la presente per errore, Vi
</I>&gt;<i> &gt; preghiamo di informarci e di distruggerlo e/o cancellarlo dal Vostro
</I>&gt;<i> &gt; computer, senza utilizzare i dati contenuti.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; La presente comunicazione (comprensiva dei documenti allegati) non avr&#224;
</I>&gt;<i> &gt; valore di proposta contrattuale e/o accettazione di proposte provenienti dal
</I>&gt;<i> &gt; destinatario, n&#232; rinuncia o riconoscimento di diritti, debiti e/o crediti,
</I>&gt;<i> &gt; n&#232; sar&#224; impegnativa, qualora non sia sottoscritto successivo accordo da chi
</I>&gt;<i> &gt; pu&#242; validamente obbligarci. Non deriver&#224; alcuna responsabilit&#224;
</I>&gt;<i> &gt; precontrattuale a ns. carico, se la presente non sia seguita da contratto
</I>&gt;<i> &gt; sottoscritto dalle parti.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ---------------------------------------------------------------------------------------------
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The contents of the present communication is strictly confidential and
</I>&gt;<i> &gt; reserved solely to the referred addressees. In the event was received by
</I>&gt;<i> &gt; person different from the addressee, it is forbidden the diffusion,
</I>&gt;<i> &gt; distribution and copy. In the event you have received it mistakenly we ask
</I>&gt;<i> &gt; you to inform us and to destroy and/or to delete it by your computer,
</I>&gt;<i> &gt; without using the data herein contained.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The present message (eventual annexes inclusive) shall not be considered any
</I>&gt;<i> &gt; contractual proposal and/or acceptance of offer coming from the addressee,
</I>&gt;<i> &gt; nor waiver neither recognizance of rights, debts and/or credits, and it
</I>&gt;<i> &gt; shall not be binding, when it is not executed a subsequent agreement by
</I>&gt;<i> &gt; person who could lawfully represent us. No pre-contractual liability shall
</I>&gt;<i> &gt; derive to us, when the present communication is not followed by any binding
</I>&gt;<i> &gt; agreement between the parties.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ---------------------------------------------------------------------------------------------
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; Mod_python mailing list
</I>&gt;<i> &gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> &gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024666.html">[mod_python] Mod_python and kerberos authentication
	(mod_auth_kerb)
</A></li>
	<LI>Next message: <A HREF="024669.html">[mod_python] Mod_python and kerberos authentication
	(mod_auth_kerb)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24668">[ date ]</a>
              <a href="thread.html#24668">[ thread ]</a>
              <a href="subject.html#24668">[ subject ]</a>
              <a href="author.html#24668">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
