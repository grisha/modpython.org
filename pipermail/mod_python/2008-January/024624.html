<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] apache.SERVER_RETURN and chunked encoding
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20apache.SERVER_RETURN%20and%20chunked%20encoding&In-Reply-To=88e286470801021513r479cf170r974f39a6a8cbdc4f%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024623.html">
   <LINK REL="Next"  HREF="024625.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] apache.SERVER_RETURN and chunked encoding</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Matthew Dennis</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20apache.SERVER_RETURN%20and%20chunked%20encoding&In-Reply-To=88e286470801021513r479cf170r974f39a6a8cbdc4f%40mail.gmail.com"
       TITLE="[mod_python] apache.SERVER_RETURN and chunked encoding">mdennis at merfer.net
       </A><BR>
    <I>Wed Jan  2 20:56:05 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="024623.html">[mod_python] apache.SERVER_RETURN and chunked encoding
</A></li>
        <LI>Next message: <A HREF="024625.html">[mod_python] apache.SERVER_RETURN and chunked encoding
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24624">[ date ]</a>
              <a href="thread.html#24624">[ thread ]</a>
              <a href="subject.html#24624">[ subject ]</a>
              <a href="author.html#24624">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 1/2/08, Graham Dumpleton &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">graham.dumpleton at gmail.com</A>&gt; wrote:
&gt;<i>
</I>&gt;<i> On 03/01/2008, Matthew Dennis &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mdennis at merfer.net</A>&gt; wrote:
</I>&gt;<i> &gt; I have a handler that streams large amounts of data.  Using chunked
</I>&gt;<i> encoding
</I>&gt;<i> &gt; in necessary as the total size is not known upfront.  If there is an
</I>&gt;<i> error
</I>&gt;<i> &gt; during the generation, I raise a apache.SERVER_RETURN (with
</I>&gt;<i> &gt; HTTP_PARTIAL_RESPONSE I believe).  The problem is that it looks like
</I>&gt;<i> &gt; mod_python and/or apache just appends some error html to the output
</I>&gt;<i> stream
</I>&gt;<i> &gt; and continues with the chunked encoding like there was no error.  In
</I>&gt;<i> other
</I>&gt;<i> &gt; words, some data chunks come from the server, then a chunk with the
</I>&gt;<i> error
</I>&gt;<i> &gt; html in it, then the last chunk.  Thus, the client has no way of knowing
</I>&gt;<i>
</I>&gt;<i> &gt; that the data is incomplete (not all of it was generated) and corrupt
</I>&gt;<i> &gt; (random html appended onto the end).  Am I just missing something, or is
</I>&gt;<i> &gt; this a bug?
</I>&gt;<i>
</I>&gt;<i> A HTTP status code can only be returned/raised before any data has
</I>&gt;<i> been sent as that information is at the beginning of the response. If
</I>&gt;<i> you are trying to raise the HTTP response status after data has been
</I>&gt;<i> sent then your code is wrong.
</I>&gt;<i>
</I>&gt;<i> What do you think HTTP_PARTIAL_RESPONSE is meant to be used for? Maybe
</I>&gt;<i> you understanding is not complete, or you don't understand how HTTP
</I>&gt;<i> responses are put together.
</I>&gt;<i>
</I>&gt;<i> Graham
</I>&gt;<i>
</I>
Sorry, it was INTERNAL_SERVER_ERROR.  I don't know where I got
PARTIAL_RESPONSE from, there is no such thing.  There is a PARTIAL_CONTENT
status, but it's not even an error (it's a 200 status for range requests)
In any case, I would not expect that raising apache.SERVER_RETURN to
continue processing the request as if nothing happened.  SERVER_RETURN
requires a status/error code to be passed in, but I wasn't actually
expecting the status code to be sent to the client.  I was trying to have
apache/mod_python signal the client that the generation failed.

Let me approach this from a different direction, as it sounds like my
understanding of raising SERVER_RETURN is wrong.  I thought raising
SERVER_RETURN was the correct way to inform apache and/or mod_python that an
error occurred and that the handler can not continue - is that incorrect?
I'm starting to assume from the name that my understanding is wrong...

The real question is if a handler is in the middle of sending a chunked
response, how does it inform apache and/or mod_python that it can not
continue?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080102/ed427620/attachment.html">http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080102/ed427620/attachment.html</A>
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024623.html">[mod_python] apache.SERVER_RETURN and chunked encoding
</A></li>
	<LI>Next message: <A HREF="024625.html">[mod_python] apache.SERVER_RETURN and chunked encoding
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24624">[ date ]</a>
              <a href="thread.html#24624">[ thread ]</a>
              <a href="subject.html#24624">[ subject ]</a>
              <a href="author.html#24624">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
