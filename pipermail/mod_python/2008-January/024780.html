<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Apache Fails to load mod_python.so with Permission
	denied error under SELinux
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Apache%20Fails%20to%20load%20mod_python.so%20with%20Permission%0A%09denied%20error%20under%20SELinux&In-Reply-To=47A1F394.4030506%40brunson.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024779.html">
   <LINK REL="Next"  HREF="024781.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Apache Fails to load mod_python.so with Permission
	denied error under SELinux</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Scott Bratcher</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Apache%20Fails%20to%20load%20mod_python.so%20with%20Permission%0A%09denied%20error%20under%20SELinux&In-Reply-To=47A1F394.4030506%40brunson.com"
       TITLE="[mod_python] Apache Fails to load mod_python.so with Permission
	denied error under SELinux">scott at 3floors.com
       </A><BR>
    <I>Thu Jan 31 13:47:36 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="024779.html">[mod_python] Apache Fails to load mod_python.so with Permission
	denied error under SELinux
</A></li>
        <LI>Next message: <A HREF="024781.html">[mod_python] Apache Fails to load mod_python.so with Permission
	denied error under SELinux
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24780">[ date ]</a>
              <a href="thread.html#24780">[ thread ]</a>
              <a href="subject.html#24780">[ subject ]</a>
              <a href="author.html#24780">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks Eric,

&quot;setenforce 0&quot; THIS WORKED. Apache started right up

Below are the results of my attempts as you suggested. I think we are  
onto the problem because with SELinux enforced it loads right up.  
However, the chcon command failed to clear up the problem. I'm new to  
SELinux. Is there another possible SELinux related permission that  
may be the solution? It's just mod_python that is giving this problem  
even though all of the others share the same t permission httpd_module.

# ls -Zd modules
drwxr-xr-x  root root system_u:object_r:httpd_modules_t modules/

So I changed the permissions:

# chcon -t texrel_shlib_t /etc/httpd/modules/mod_python.so
# service httpd start
Starting httpd: httpd: Syntax error on line 210 of /etc/httpd/conf/ 
httpd.conf: Syntax error on line 6 of /etc/httpd/conf.d/python.conf:  
Cannot load /etc/httpd/modules/mod_python.so into server: /etc/httpd/ 
modules/mod_python.so: cannot restore segment prot after reloc:  
Permission denied
                                                            [FAILED]
# ls -Z /etc/httpd/modules/mod_python.so
-rwxr-xr-x  root root system_u:object_r:textrel_shlib_t /etc/httpd/ 
modules/mod_python.so*



I also tried changing the permissions of the 2.5 site-packages to the  
same permissions as the previously working 2.4 site-packages, plus  
the other listed below, and the still Apache Failure occurs.

# ls -Zd /usr/local/lib/python2.5/site-packages/ /usr/lib/python2.4/ 
site-packages/
drwxr-xr-x  root root system_u:object_r:lib_t           /usr/lib/ 
python2.4/site-packages/
drwxr-xr-x  root root user_u:object_r:lib_t             /usr/local/ 
lib/python2.5/site-packages/

system_u:object_r:lib_t
system_u:object_r:textrel_shlib_t
user_u:object_r:textrel_shlib_t


If you have other tips I'd appreciate any help you can offer.

Scott



On Jan 31, 2008, at 10:13 AM, Eric Brunson wrote:

&gt;<i> Scott Bratcher wrote:
</I>&gt;&gt;<i> Hello all,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> THE PROBLEM:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Starting Apache results in this error:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # service httpd start
</I>&gt;&gt;<i> Starting httpd: httpd: Syntax error on line 210 of /etc/httpd/conf/ 
</I>&gt;&gt;<i> httpd.conf: Syntax error on line 6 of /etc/httpd/conf.d/ 
</I>&gt;&gt;<i> python.conf: Cannot load /etc/httpd/modules/mod_python.so into  
</I>&gt;&gt;<i> server: /etc/httpd/modules/mod_python.so: cannot restore segment  
</I>&gt;&gt;<i> prot after reloc: Permission denied
</I>&gt;&gt;<i>                                                            [FAILED]
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> This error message is often related to selinux permissions.
</I>&gt;<i>
</I>&gt;<i> A quick check to see if that is the problem is to disable selinux  
</I>&gt;<i> with the command (as root) &quot;setenforce 0&quot;.  If the module then  
</I>&gt;<i> loads correctly, it can be fixed permanently with the command:
</I>&gt;<i>
</I>&gt;<i> chcon -t texrel_shlib_t /etc/httpd/modules/mod_python.so
</I>&gt;<i>
</I>&gt;<i> Then, re-enable selinux with &quot;setenforce 1&quot;.
</I>&gt;<i>
</I>&gt;<i> If disabling selinux does not fix the problem, then more  
</I>&gt;<i> investigation is required.
</I>&gt;<i>
</I>&gt;<i> Hope that helps,
</I>&gt;<i> e.
</I>&gt;<i>
</I>&gt;&gt;<i> USING:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> RHEL5 / SELinux
</I>&gt;&gt;<i> Apache 2.2
</I>&gt;&gt;<i> Python 2.5.1
</I>&gt;&gt;<i> mod_pythonn 3.3.1
</I>&gt;&gt;<i> httpd.conf (not .htaccess)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> TESTED THUS FAR:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> .so file exists with same permissions as other modules
</I>&gt;&gt;<i> # ls -Z /etc/httpd/modules/mod_python.so
</I>&gt;&gt;<i> -rwxr-xr-x  root root system_u:object_r:httpd_modules_t /etc/httpd/ 
</I>&gt;&gt;<i> modules/mod_python.so*
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> If I comment out:
</I>&gt;&gt;<i> &quot;#LoadModule python_module modules/mod_python.so&quot;
</I>&gt;&gt;<i> and other related python lines Apache starts just fine without  
</I>&gt;&gt;<i> mod_python.
</I>&gt;&gt;<i> # service httpd start
</I>&gt;&gt;<i> Starting httpd:                                            [  OK  ]
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024779.html">[mod_python] Apache Fails to load mod_python.so with Permission
	denied error under SELinux
</A></li>
	<LI>Next message: <A HREF="024781.html">[mod_python] Apache Fails to load mod_python.so with Permission
	denied error under SELinux
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24780">[ date ]</a>
              <a href="thread.html#24780">[ thread ]</a>
              <a href="subject.html#24780">[ subject ]</a>
              <a href="author.html#24780">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
