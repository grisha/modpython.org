<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Mod_python and kerberos authentication
	(mod_auth_kerb)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Mod_python%20and%20kerberos%20authentication%0A%09%28mod_auth_kerb%29&In-Reply-To=88e286470801111324j7212fbcbu90a8c19bcd4dc9e4%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024656.html">
   <LINK REL="Next"  HREF="024668.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Mod_python and kerberos authentication
	(mod_auth_kerb)</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Cassiano, Marco</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Mod_python%20and%20kerberos%20authentication%0A%09%28mod_auth_kerb%29&In-Reply-To=88e286470801111324j7212fbcbu90a8c19bcd4dc9e4%40mail.gmail.com"
       TITLE="[mod_python] Mod_python and kerberos authentication
	(mod_auth_kerb)">mcassiano at manord.com
       </A><BR>
    <I>Mon Jan 14 05:10:10 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="024656.html">[mod_python] Mod_python and kerberos authentication
	(mod_auth_kerb)
</A></li>
        <LI>Next message: <A HREF="024668.html">[mod_python] Mod_python and kerberos authentication
	(mod_auth_kerb)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24666">[ date ]</a>
              <a href="thread.html#24666">[ thread ]</a>
              <a href="subject.html#24666">[ subject ]</a>
              <a href="author.html#24666">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Graham,

thank you for your answer.
I've made a very simple test script named domain_login.py. Here it is :

def check_user(req):
        return 'ok'

and I call it with the URL  <A HREF="http://apache.foo.com/login/domain_login.py/check_user">http://apache.foo.com/login/domain_login.py/check_user</A>

So, to answer your question, the request is a GET.
It is strange that if I put in the URL a wrong (non-existent) name, for example :

 <A HREF="http://apache.foo.com/login/domain_login.py/wrong_call">http://apache.foo.com/login/domain_login.py/wrong_call</A>

I got the same Bad Request error. So the problem seems to occur before the execution of the script.
In the apache error log I only see that the kerberos authentication was ok and then nothing else...


[Mon Jan 14 10:04:35 2008] [debug] src/mod_auth_kerb.c(1485): [client 192.168.1.25] kerb_authenticate_user entered with user (NULL) and auth_type Kerberos
[Mon Jan 14 10:04:35 2008] [debug] src/mod_auth_kerb.c(1485): [client 192.168.1.25] kerb_authenticate_user entered with user (NULL) and auth_type Kerberos
[Mon Jan 14 10:04:35 2008] [debug] src/mod_auth_kerb.c(1172): [client 192.168.1.25] Acquiring creds for HTTP/<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">sviluppo.manord.com at MANORD.COM</A>
[Mon Jan 14 10:04:35 2008] [debug] src/mod_auth_kerb.c(1316): [client 192.168.1.25] Verifying client data using SPNEGO GSS-API
[Mon Jan 14 10:04:35 2008] [debug] src/mod_auth_kerb.c(1332): [client 192.168.1.25] Verification returned code 0
[Mon Jan 14 10:04:35 2008] [debug] src/mod_auth_kerb.c(1350): [client 192.168.1.25] GSS-API token of length 151 bytes will be sent back

In the apache access.log I see two entries


192.168.1.25 - - [14/Jan/2008:10:56:04 +0100] &quot;GET /login/domain_login1.py/check_user HTTP/1.1&quot; 401 401 &quot;-&quot; &quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.11) Gecko/20071127 Firefox/2.0.0.11&quot;
192.168.1.25 - <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">myuser at FOO.COM</A> [14/Jan/2008:10:56:04 +0100] &quot;GET /login/domain_login1.py/check_user HTTP/1.1&quot; 404 231 &quot;-&quot; &quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.11) Gecko/20071127 Firefox/2.0.0.11&quot;


In the second line the windows domain user is correctly reported so it seems the kerberos authentication worked...


If I remove the kerberos authentication, the script works ok.
If I remove the mod_python handler from the directory and I ask for a plain html page the kerberos authentication works...

We also tried with mod_python.servlet (PythonHandler mod_python.servlet)
and the kerberos authentication works perfectly. The script is executed and we can retrieve the username in req.user.

So it seems a problem related to the publisher....



Thank you



Marco Cassiano 
  
Manifatture del Nord srl unipersonale
Gruppo MaxMara 

via Mazzacurati 6
42100 Reggio Emilia RE
ITALY 

Tel. +39 0522 358215 
Fax +39 0522 268715 
email : <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mcassiano at manord.com</A> 
www.pennyblack.com 



The contents of the present communication is strictly confidential and reserved solely to the referred addressees. In the event was received by person different from the addressee, it is forbidden the diffusion, distribution and copy. In the event you have received it mistakenly we ask you to inform us and to destroy and/or to delete it by your computer, without using the data herein contained.

 

The present message (eventual annexes inclusive) shall not be considered any contractual proposal and/or acceptance of offer coming from the addressee, nor waiver neither recognizance of rights, debts and/or credits, and it shall not be binding, when it is not executed a subsequent agreement by person who could lawfully represent us. No pre-contractual liability shall derive to us, when the present communication is not followed by any binding agreement between the parties.



-----Original Message-----
From: Graham Dumpleton [mailto:<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">graham.dumpleton at gmail.com</A>] 
Sent: Friday, January 11, 2008 10:24 PM
To: Cassiano, Marco
Cc: <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python at modpython.org</A>
Subject: Re: [mod_python] Mod_python and kerberos authentication (mod_auth_kerb)

When using mod_python.publisher, you would get a Bad Request error if
the request wasn't either a GET or POST. What is the type of HTTP
request?

Graham

On 12/01/2008, Cassiano, Marco &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mcassiano at manord.com</A>&gt; wrote:
&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Hi all,
</I>&gt;<i>
</I>&gt;<i> I've just configured our apache server (Linux RedHat) for kerberos
</I>&gt;<i> authentication to allow our windows domain users to access it without having
</I>&gt;<i> to reauthenticate.
</I>&gt;<i> Everything works fine for a plain html directory, so I'm pretty sure that
</I>&gt;<i> the kerberos configuration for the apache server is working.
</I>&gt;<i> When I try to specify Kerberos authentication together with mod_python it's
</I>&gt;<i> not working. I got the message :
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Bad Request
</I>&gt;<i>
</I>&gt;<i> Your browser sent a request that this server could not understand.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> My httpd configuration is :
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Alias /login/ &quot;/var/www/kerb/login/&quot;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &lt;Directory &quot;/var/www/kerb/login&quot;&gt;
</I>&gt;<i> ##  AuthName &quot;Kerberos Login&quot;
</I>&gt;<i>   AuthType Kerberos
</I>&gt;<i>   KrbAuthRealm FOO.COM
</I>&gt;<i>   KrbServiceName HTTP/<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">apache.foo.com at FOO.COM</A>
</I>&gt;<i>   Krb5Keytab /etc/httpd/conf/apache.tab
</I>&gt;<i>   KrbMethodNegotiate on
</I>&gt;<i>   KrbMethodK5Passwd off
</I>&gt;<i> #  KrbSaveCredentials off
</I>&gt;<i> #  KrbVerifyKDC off
</I>&gt;<i>   Require valid-user
</I>&gt;<i>
</I>&gt;<i>   Order Deny,Allow
</I>&gt;<i>   Deny from all
</I>&gt;<i>   Allow from foo.com
</I>&gt;<i>   Allow from 127.0.0.1
</I>&gt;<i>
</I>&gt;<i>   SetHandler mod_python
</I>&gt;<i>   PythonHandler mod_python.publisher | .py
</I>&gt;<i>   PythonDebug on
</I>&gt;<i>   PythonOption ApplicationPath '/'
</I>&gt;<i>
</I>&gt;<i> &lt;/Directory&gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Thanks in advance for your advice
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Marco Cassiano
</I>&gt;<i>
</I>&gt;<i> Manifatture del Nord srl
</I>&gt;<i>
</I>&gt;<i> Italy
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ---------------------------------------------------------------------------------------------
</I>&gt;<i>
</I>&gt;<i> Il contenuto della presente comunicazione &#232; riservato e destinato
</I>&gt;<i> esclusivamente ai destinatari indicati. Nel caso in cui sia ricevuto da
</I>&gt;<i> persona diversa dal destinatario sono proibite la diffusione, la
</I>&gt;<i> distribuzione e la copia. Nel caso riceveste la presente per errore, Vi
</I>&gt;<i> preghiamo di informarci e di distruggerlo e/o cancellarlo dal Vostro
</I>&gt;<i> computer, senza utilizzare i dati contenuti.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> La presente comunicazione (comprensiva dei documenti allegati) non avr&#224;
</I>&gt;<i> valore di proposta contrattuale e/o accettazione di proposte provenienti dal
</I>&gt;<i> destinatario, n&#232; rinuncia o riconoscimento di diritti, debiti e/o crediti,
</I>&gt;<i> n&#232; sar&#224; impegnativa, qualora non sia sottoscritto successivo accordo da chi
</I>&gt;<i> pu&#242; validamente obbligarci. Non deriver&#224; alcuna responsabilit&#224;
</I>&gt;<i> precontrattuale a ns. carico, se la presente non sia seguita da contratto
</I>&gt;<i> sottoscritto dalle parti.
</I>&gt;<i>
</I>&gt;<i> ---------------------------------------------------------------------------------------------
</I>&gt;<i>
</I>&gt;<i> The contents of the present communication is strictly confidential and
</I>&gt;<i> reserved solely to the referred addressees. In the event was received by
</I>&gt;<i> person different from the addressee, it is forbidden the diffusion,
</I>&gt;<i> distribution and copy. In the event you have received it mistakenly we ask
</I>&gt;<i> you to inform us and to destroy and/or to delete it by your computer,
</I>&gt;<i> without using the data herein contained.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> The present message (eventual annexes inclusive) shall not be considered any
</I>&gt;<i> contractual proposal and/or acceptance of offer coming from the addressee,
</I>&gt;<i> nor waiver neither recognizance of rights, debts and/or credits, and it
</I>&gt;<i> shall not be binding, when it is not executed a subsequent agreement by
</I>&gt;<i> person who could lawfully represent us. No pre-contractual liability shall
</I>&gt;<i> derive to us, when the present communication is not followed by any binding
</I>&gt;<i> agreement between the parties.
</I>&gt;<i>
</I>&gt;<i> ---------------------------------------------------------------------------------------------
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i>
</I>&gt;<i>
</I>
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024656.html">[mod_python] Mod_python and kerberos authentication
	(mod_auth_kerb)
</A></li>
	<LI>Next message: <A HREF="024668.html">[mod_python] Mod_python and kerberos authentication
	(mod_auth_kerb)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24666">[ date ]</a>
              <a href="thread.html#24666">[ thread ]</a>
              <a href="subject.html#24666">[ subject ]</a>
              <a href="author.html#24666">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
