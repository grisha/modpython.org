<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] remnant 'orphan' apache subprocesses
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20remnant%20%27orphan%27%20apache%20subprocesses&In-Reply-To=003a01c85d6f%242f333fe0%248d99bfa0%24%40com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024722.html">
   <LINK REL="Next"  HREF="024745.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] remnant 'orphan' apache subprocesses</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20remnant%20%27orphan%27%20apache%20subprocesses&In-Reply-To=003a01c85d6f%242f333fe0%248d99bfa0%24%40com"
       TITLE="[mod_python] remnant 'orphan' apache subprocesses">graham.dumpleton at gmail.com
       </A><BR>
    <I>Tue Jan 22 23:36:22 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="024722.html">[mod_python] remnant 'orphan' apache subprocesses
</A></li>
        <LI>Next message: <A HREF="024745.html">[mod_python] remnant 'orphan' apache subprocesses
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24723">[ date ]</a>
              <a href="thread.html#24723">[ thread ]</a>
              <a href="subject.html#24723">[ subject ]</a>
              <a href="author.html#24723">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 23/01/2008, Alec Matusis &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">matusis at yahoo.com</A>&gt; wrote:
&gt;<i> &gt; Hmmm, there should have been 39 other stack traces, one for each
</I>&gt;<i> &gt; worker thread based on your Apache configuration.
</I>&gt;<i>
</I>&gt;<i> Looks like it has only one thread:
</I>
Which almost suggests it was actually a fork of an Apache child
process as that is possibly only way the other threads could have been
killed off. This would sort of sit with idea that some code had tried
to further fork and daemonise the process. This is the only thing that
seems to fit at the moment.

I can't find though any evidence of fork() being used direct in PIL
code at least, but then the popen2 module uses fork() in Popen3 and
Popen4 classes. Again, PIL, although it uses os.popen() doesn't use
popen2 module. Also, that doesn't involved setsid(). The only place in
standard Python modules that appears to use setsid() is pty.fork() and
PIL doesn't use that.

All I can suggest is you might in your loaded application dump out
sys.modules and see if anything has imported pty module. Otherwise
troll through all the Python code you know is used and see if anything
for whatever reason uses fork(), setsid(), popen2 module, or
pty.fork(). More nasty would be a C extension module doing forks and
trying to do Python stuff in forked process but not doing necessary
Python cleanup after the fork. Would have expected to see a C
extension module stack frame in traceback if that was the case though.

Anyway, running out of ideas.

Graham

&gt;<i> Orphaned sub process:
</I>&gt;<i>
</I>&gt;<i> # ps -mTp 3812
</I>&gt;<i>   PID  SPID TTY          TIME CMD
</I>&gt;<i>  3812     - ?        00:00:00 httpd
</I>&gt;<i>     -  3812 -        00:00:00 -
</I>&gt;<i>
</I>&gt;<i> Normal sub-process:
</I>&gt;<i>
</I>&gt;<i> # ps -mTp 20205
</I>&gt;<i>   PID  SPID TTY          TIME CMD
</I>&gt;<i> 20205     - ?        00:00:10 httpd
</I>&gt;<i>     - 20205 -        00:00:00 -
</I>&gt;<i>     - 20207 -        00:00:00 -
</I>&gt;<i>     - 20208 -        00:00:00 -
</I>&gt;<i>     - 20209 -        00:00:00 -
</I>&gt;<i>     - 20210 -        00:00:00 -
</I>&gt;<i>     - 20211 -        00:00:00 -
</I>&gt;<i>     - 20212 -        00:00:00 -
</I>&gt;<i>     - 20213 -        00:00:00 -
</I>&gt;<i>     - 20214 -        00:00:00 -
</I>&gt;<i>     - 20215 -        00:00:00 -
</I>&gt;<i>     - 20216 -        00:00:00 -
</I>&gt;<i>     - 20217 -        00:00:00 -
</I>&gt;<i>     - 20218 -        00:00:00 -
</I>&gt;<i>     - 20219 -        00:00:00 -
</I>&gt;<i>     - 20220 -        00:00:00 -
</I>&gt;<i>     - 20221 -        00:00:00 -
</I>&gt;<i>     - 20222 -        00:00:00 -
</I>&gt;<i>     - 20223 -        00:00:00 -
</I>&gt;<i>     - 20224 -        00:00:00 -
</I>&gt;<i>     - 20225 -        00:00:00 -
</I>&gt;<i>     - 20226 -        00:00:00 -
</I>&gt;<i>     - 20227 -        00:00:00 -
</I>&gt;<i>     - 20228 -        00:00:00 -
</I>&gt;<i>     - 20229 -        00:00:00 -
</I>&gt;<i>     - 20230 -        00:00:00 -
</I>&gt;<i>     - 20231 -        00:00:00 -
</I>&gt;<i>     - 20232 -        00:00:00 -
</I>&gt;<i>     - 20233 -        00:00:00 -
</I>&gt;<i>     - 20234 -        00:00:00 -
</I>&gt;<i>     - 20235 -        00:00:00 -
</I>&gt;<i>     - 20236 -        00:00:00 -
</I>&gt;<i>     - 20237 -        00:00:00 -
</I>&gt;<i>     - 20238 -        00:00:00 -
</I>&gt;<i>     - 20239 -        00:00:00 -
</I>&gt;<i>     - 20240 -        00:00:00 -
</I>&gt;<i>     - 20241 -        00:00:00 -
</I>&gt;<i>     - 20242 -        00:00:00 -
</I>&gt;<i>     - 20243 -        00:00:00 -
</I>&gt;<i>     - 20244 -        00:00:00 -
</I>&gt;<i>     - 20245 -        00:00:00 -
</I>&gt;<i>     - 20246 -        00:00:00 -
</I>&gt;<i>     - 20247 -        00:00:00 -
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; -----Original Message-----
</I>&gt;<i> &gt; From: Graham Dumpleton [mailto:<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">graham.dumpleton at gmail.com</A>]
</I>&gt;<i> &gt; Sent: Tuesday, January 22, 2008 7:00 PM
</I>&gt;<i> &gt; To: Alec Matusis
</I>&gt;<i> &gt; Cc: <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python at modpython.org</A>
</I>&gt;<i> &gt; Subject: Re: [mod_python] remnant 'orphan' apache subprocesses
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On 23/01/2008, Alec Matusis &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">matusis at yahoo.com</A>&gt; wrote:
</I>&gt;<i> &gt; &gt; &gt; (gdb) thread apply all bt
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Thread 1 (Thread 1111562592 (LWP 3812)):
</I>&gt;<i> &gt; &gt; #0  0x00002aaaab2c94df in sem_wait () from /lib64/tls/libpthread.so.0
</I>&gt;<i> &gt; &gt; #1  0x00002aaaac204dcd in PyThread_acquire_lock (lock=0x5b7820,
</I>&gt;<i> &gt; waitflag=1)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Hmmm, there should have been 39 other stack traces, one for each
</I>&gt;<i> &gt; worker thread based on your Apache configuration.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Don't necessarily post them all, but you should look and see what is
</I>&gt;<i> &gt; in frame #0 for all of them and see if there is anything odd such as
</I>&gt;<i> &gt; one blocking in a call out to some external C library. If no such
</I>&gt;<i> &gt; thing and they are all stuck on Python mutex locks, then must be
</I>&gt;<i> &gt; internal deadlock.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; This still doesn't explain though how the process has been associated
</I>&gt;<i> &gt; with PPID of 1, which would  still only seem possible if something had
</I>&gt;<i> &gt; tried to daemonise process.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Graham
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Graham
</I>&gt;<i>
</I>&gt;<i>
</I></PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024722.html">[mod_python] remnant 'orphan' apache subprocesses
</A></li>
	<LI>Next message: <A HREF="024745.html">[mod_python] remnant 'orphan' apache subprocesses
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24723">[ date ]</a>
              <a href="thread.html#24723">[ thread ]</a>
              <a href="subject.html#24723">[ subject ]</a>
              <a href="author.html#24723">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
