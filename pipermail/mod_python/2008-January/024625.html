<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] apache.SERVER_RETURN and chunked encoding
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20apache.SERVER_RETURN%20and%20chunked%20encoding&In-Reply-To=e94d85500801021756n39a0272fga72709192790717%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024624.html">
   <LINK REL="Next"  HREF="024626.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] apache.SERVER_RETURN and chunked encoding</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20apache.SERVER_RETURN%20and%20chunked%20encoding&In-Reply-To=e94d85500801021756n39a0272fga72709192790717%40mail.gmail.com"
       TITLE="[mod_python] apache.SERVER_RETURN and chunked encoding">graham.dumpleton at gmail.com
       </A><BR>
    <I>Wed Jan  2 21:44:58 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="024624.html">[mod_python] apache.SERVER_RETURN and chunked encoding
</A></li>
        <LI>Next message: <A HREF="024626.html">[mod_python] providing REST style interfaces
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24625">[ date ]</a>
              <a href="thread.html#24625">[ thread ]</a>
              <a href="subject.html#24625">[ subject ]</a>
              <a href="author.html#24625">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 03/01/2008, Matthew Dennis &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mdennis at merfer.net</A>&gt; wrote:
&gt;<i> On 1/2/08, Graham Dumpleton &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">graham.dumpleton at gmail.com</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;<i> &gt; On 03/01/2008, Matthew Dennis &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mdennis at merfer.net</A>&gt; wrote:
</I>&gt;<i> &gt; &gt; I have a handler that streams large amounts of data.  Using chunked
</I>&gt;<i> encoding
</I>&gt;<i> &gt; &gt; in necessary as the total size is not known upfront.  If there is an
</I>&gt;<i> error
</I>&gt;<i> &gt; &gt; during the generation, I raise a apache.SERVER_RETURN (with
</I>&gt;<i> &gt; &gt; HTTP_PARTIAL_RESPONSE I believe).  The problem is that it looks like
</I>&gt;<i> &gt; &gt; mod_python and/or apache just appends some error html to the output
</I>&gt;<i> stream
</I>&gt;<i> &gt; &gt; and continues with the chunked encoding like there was no error.  In
</I>&gt;<i> other
</I>&gt;<i> &gt; &gt; words, some data chunks come from the server, then a chunk with the
</I>&gt;<i> error
</I>&gt;<i> &gt; &gt; html in it, then the last chunk.  Thus, the client has no way of knowing
</I>&gt;<i> &gt; &gt; that the data is incomplete (not all of it was generated) and corrupt
</I>&gt;<i> &gt; &gt; (random html appended onto the end).  Am I just missing something, or is
</I>&gt;<i> &gt; &gt; this a bug?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; A HTTP status code can only be returned/raised before any data has
</I>&gt;<i> &gt; been sent as that information is at the beginning of the response. If
</I>&gt;<i> &gt; you are trying to raise the HTTP response status after data has been
</I>&gt;<i> &gt; sent then your code is wrong.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; What do you think HTTP_PARTIAL_RESPONSE is meant to be used for? Maybe
</I>&gt;<i> &gt; you understanding is not complete, or you don't understand how HTTP
</I>&gt;<i> &gt; responses are put together.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Graham
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i> Sorry, it was INTERNAL_SERVER_ERROR.  I don't know where I got
</I>&gt;<i> PARTIAL_RESPONSE from, there is no such thing.  There is a PARTIAL_CONTENT
</I>&gt;<i> status, but it's not even an error (it's a 200 status for range requests)
</I>&gt;<i> In any case, I would not expect that raising apache.SERVER_RETURN to
</I>&gt;<i> continue processing the request as if nothing happened.  SERVER_RETURN
</I>&gt;<i> requires a status/error code to be passed in, but I wasn't actually
</I>&gt;<i> expecting the status code to be sent to the client.  I was trying to have
</I>&gt;<i> apache/mod_python signal the client that the generation failed.
</I>&gt;<i>
</I>&gt;<i> Let me approach this from a different direction, as it sounds like my
</I>&gt;<i> understanding of raising SERVER_RETURN is wrong.  I thought raising
</I>&gt;<i> SERVER_RETURN was the correct way to inform apache and/or mod_python that an
</I>&gt;<i> error occurred and that the handler can not continue - is that incorrect?
</I>&gt;<i> I'm starting to assume from the name that my understanding is wrong...
</I>&gt;<i>
</I>&gt;<i> The real question is if a handler is in the middle of sending a chunked
</I>&gt;<i> response, how does it inform apache and/or mod_python that it can not
</I>&gt;<i> continue?
</I>
You can't return error status after having started writing data. All
you can do is close the connection and not send any more data.

To do that return apache.OK or raise it using SERVER_RETURN. Ie., from memory:

  raise apache.SERVER_RETURN, apache.OK

If you want some sort of error to be flagged, best you can do is log
something in the Apache error logs using req.log_error().

Graham
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024624.html">[mod_python] apache.SERVER_RETURN and chunked encoding
</A></li>
	<LI>Next message: <A HREF="024626.html">[mod_python] providing REST style interfaces
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24625">[ date ]</a>
              <a href="thread.html#24625">[ thread ]</a>
              <a href="subject.html#24625">[ subject ]</a>
              <a href="author.html#24625">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
