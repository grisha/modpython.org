<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Apache Fails to load mod_python.so with
	Permissiondenied error under SELinux
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Apache%20Fails%20to%20load%20mod_python.so%20with%0A%09Permissiondenied%20error%20under%20SELinux&In-Reply-To=F593A28B-30EE-4BA9-898C-522D36C034D6%403floors.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024788.html">
   <LINK REL="Next"  HREF="024790.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Apache Fails to load mod_python.so with
	Permissiondenied error under SELinux</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Apache%20Fails%20to%20load%20mod_python.so%20with%0A%09Permissiondenied%20error%20under%20SELinux&In-Reply-To=F593A28B-30EE-4BA9-898C-522D36C034D6%403floors.com"
       TITLE="[mod_python] Apache Fails to load mod_python.so with
	Permissiondenied error under SELinux">graham.dumpleton at gmail.com
       </A><BR>
    <I>Thu Jan 31 19:51:20 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="024788.html">[mod_python] Apache Fails to load mod_python.so with
	Permissiondenied error under SELinux
</A></li>
        <LI>Next message: <A HREF="024790.html">[mod_python] Apache Fails to load mod_python.so with
	Permissiondenied error under SELinux
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24789">[ date ]</a>
              <a href="thread.html#24789">[ thread ]</a>
              <a href="subject.html#24789">[ subject ]</a>
              <a href="author.html#24789">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>How big is your:

  /etc/httpd/modules/mod_python.so

file? If you run ldd on it, what does it output as far as dependencies
on shared libraries?

One of the problems with some Python installations is that they still
do not provide a shared library and so a static library gets embedded
in mod_python.so. This results in some messy adress relocations having
to be done when mod_python.so is loaded. I am wandering whether the
'reloc' mentioned in:

  cannot restore segment prot after reloc

is the module loading relocations and it is having a problem with that.

If there is no libpythonX.Y.so linked to mod_python.so, then reinstall
Python using --enable-shared to configure, possibly fix up missing
libpythonX.Y.so symlink in Python installed config directory and then
rebuild mod_python, see if that makes a difference.

Probably nothing to do with this, but if nothing else works. :-)

Graham

On 01/02/2008, Scott Bratcher &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">scott at 3floors.com</A>&gt; wrote:
&gt;<i> Thanks Eric and Tom,
</I>&gt;<i>
</I>&gt;<i> Unresolved however. I did some permissions tests based on your feedback.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I'm chasing this issue as though it is a permissions issue and have
</I>&gt;<i> identified SELinux as the hold-up. I've tried all of these permission
</I>&gt;<i> sets on the modules actual folder and the modules symlinked folder.
</I>&gt;<i> I did both directories just in case the permissions trickle down to
</I>&gt;<i> the actual files being loaded by mod_python itself:
</I>&gt;<i>
</I>&gt;<i> # chcon -R -h -u system_u -r object_r -t httpd_sys_content_t /usr/lib/
</I>&gt;<i> httpd/modules /etc/httpd/modules
</I>&gt;<i> # chcon -R -h -u user_u -r object_r -t httpd_sys_content_t /usr/lib/
</I>&gt;<i> httpd/modules /etc/httpd/modules
</I>&gt;<i> # chcon -R -h -u user_u -r object_r -t httpd_modules_t /usr/lib/httpd/
</I>&gt;<i> modules /etc/httpd/modules
</I>&gt;<i> # chcon -R -h -u system_u -r object_r -t httpd_modules_t /usr/lib/
</I>&gt;<i> httpd/modules /etc/httpd/modules ((( This one is the original
</I>&gt;<i> permission of all apache modules)))
</I>&gt;<i> # chcon -R -h -u system_u -r object_r -t lib_t /usr/lib/httpd/
</I>&gt;<i> modules /etc/httpd/modules
</I>&gt;<i> # chcon -R -h -u system_u -r object_r -t shlib_t /usr/lib/httpd/
</I>&gt;<i> modules /etc/httpd/modules
</I>&gt;<i> # chcon -R -h -u system_u -r object_r -t textrel_shlib_t /usr/lib/
</I>&gt;<i> httpd/modules /etc/httpd/modules
</I>&gt;<i>
</I>&gt;<i> All gave this error:
</I>&gt;<i> ----------
</I>&gt;<i> # service httpd start
</I>&gt;<i> Starting httpd: httpd: Syntax error on line 210 of /etc/httpd/conf/
</I>&gt;<i> httpd.conf: Syntax error on line 6 of /etc/httpd/conf.d/python.conf:
</I>&gt;<i> Cannot load /etc/httpd/modules/mod_python.so into server: /etc/httpd/
</I>&gt;<i> modules/mod_python.so: cannot restore segment prot after reloc:
</I>&gt;<i> Permission denied
</I>&gt;<i>                                                             [FAILED]
</I>&gt;<i> ----------
</I>&gt;<i>
</I>&gt;<i> ---&gt; This is the only one that gave me a different error.
</I>&gt;<i> ----------
</I>&gt;<i> # chcon -R -h -u system_u -t textrel_shlib_t /usr/lib/httpd/modules /
</I>&gt;<i> etc/httpd/modules
</I>&gt;<i> # service httpd start
</I>&gt;<i> Starting httpd: httpd: Syntax error on line 148 of /etc/httpd/conf/
</I>&gt;<i> httpd.conf: Cannot load /etc/httpd/modules/mod_auth_basic.so into
</I>&gt;<i> server: /etc/httpd/modules/mod_auth_basic.so: cannot open shared
</I>&gt;<i> object file: Permission denied
</I>&gt;<i>                                                             [FAILED]
</I>&gt;<i> ----------
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ****AGAIN I MUST NOTE: All is solved by turning off SELinux and/or
</I>&gt;<i> All is solved by not loading mod_python. All other modules loaded
</I>&gt;<i> just fine with their original permissions which matched mod_python
</I>&gt;<i> exactly.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Scott
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Jan 31, 2008, at 1:42 PM, Tom Stambaugh wrote:
</I>&gt;<i>
</I>&gt;<i> &gt; The incantation that I use (for solving different problems, though)
</I>&gt;<i> &gt; is:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; chcon -R -h -t httpd_sys_content_t &lt;filename&gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I think the &quot;-R&quot; makes it recurse to all children, and I think the
</I>&gt;<i> &gt; &quot;httpd_sys_content_t&quot; is more permissive (though that could be
</I>&gt;<i> &gt; mistaken).
</I>&gt;<i> &gt; The -h causes it to apply to sym links.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Afterwords, I get:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; #ls -lZ adminuser
</I>&gt;<i> &gt; -rw-rw-r--  zeetix   zeetix   user_u:object_r:httpd_sys_content_t
</I>&gt;<i> &gt; &lt;filename&gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I use Fedora core3/core4 linux, so YMMV.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Thx,
</I>&gt;<i> &gt; Tom
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ----- Original Message -----
</I>&gt;<i> &gt; From: &quot;Scott Bratcher&quot; &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">scott at 3floors.com</A>&gt;
</I>&gt;<i> &gt; To: &quot;Eric Brunson&quot; &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">brunson at brunson.com</A>&gt;
</I>&gt;<i> &gt; Cc: &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python at modpython.org</A>&gt;
</I>&gt;<i> &gt; Sent: Thursday, January 31, 2008 1:47 PM
</I>&gt;<i> &gt; Subject: Re: [mod_python] Apache Fails to load mod_python.so with
</I>&gt;<i> &gt; Permissiondenied error under SELinux
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;&gt; Thanks Eric,
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; &quot;setenforce 0&quot; THIS WORKED. Apache started right up
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Below are the results of my attempts as you suggested. I think we are
</I>&gt;<i> &gt;&gt; onto the problem because with SELinux enforced it loads right up.
</I>&gt;<i> &gt;&gt; However, the chcon command failed to clear up the problem. I'm new to
</I>&gt;<i> &gt;&gt; SELinux. Is there another possible SELinux related permission
</I>&gt;<i> &gt;&gt; that  may be
</I>&gt;<i> &gt;&gt; the solution? It's just mod_python that is giving this problem  even
</I>&gt;<i> &gt;&gt; though all of the others share the same t permission httpd_module.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; # ls -Zd modules
</I>&gt;<i> &gt;&gt; drwxr-xr-x  root root system_u:object_r:httpd_modules_t modules/
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; So I changed the permissions:
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; # chcon -t texrel_shlib_t /etc/httpd/modules/mod_python.so
</I>&gt;<i> &gt;&gt; # service httpd start
</I>&gt;<i> &gt;&gt; Starting httpd: httpd: Syntax error on line 210 of /etc/httpd/conf/
</I>&gt;<i> &gt;&gt; httpd.conf: Syntax error on line 6 of /etc/httpd/conf.d/python.conf:
</I>&gt;<i> &gt;&gt; Cannot load /etc/httpd/modules/mod_python.so into server: /etc/httpd/
</I>&gt;<i> &gt;&gt; modules/mod_python.so: cannot restore segment prot after reloc:
</I>&gt;<i> &gt;&gt; Permission denied
</I>&gt;<i> &gt;&gt;                                                            [FAILED]
</I>&gt;<i> &gt;&gt; # ls -Z /etc/httpd/modules/mod_python.so
</I>&gt;<i> &gt;&gt; -rwxr-xr-x  root root system_u:object_r:textrel_shlib_t /etc/httpd/
</I>&gt;<i> &gt;&gt; modules/mod_python.so*
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; I also tried changing the permissions of the 2.5 site-packages to the
</I>&gt;<i> &gt;&gt; same permissions as the previously working 2.4 site-packages,
</I>&gt;<i> &gt;&gt; plus  the
</I>&gt;<i> &gt;&gt; other listed below, and the still Apache Failure occurs.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; # ls -Zd /usr/local/lib/python2.5/site-packages/ /usr/lib/python2.4/
</I>&gt;<i> &gt;&gt; site-packages/
</I>&gt;<i> &gt;&gt; drwxr-xr-x  root root system_u:object_r:lib_t           /usr/lib/
</I>&gt;<i> &gt;&gt; python2.4/site-packages/
</I>&gt;<i> &gt;&gt; drwxr-xr-x  root root user_u:object_r:lib_t             /usr/local/
</I>&gt;<i> &gt;&gt; lib/python2.5/site-packages/
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; system_u:object_r:lib_t
</I>&gt;<i> &gt;&gt; system_u:object_r:textrel_shlib_t
</I>&gt;<i> &gt;&gt; user_u:object_r:textrel_shlib_t
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; If you have other tips I'd appreciate any help you can offer.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Scott
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; On Jan 31, 2008, at 10:13 AM, Eric Brunson wrote:
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; Scott Bratcher wrote:
</I>&gt;<i> &gt;&gt;&gt;&gt; Hello all,
</I>&gt;<i> &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt; THE PROBLEM:
</I>&gt;<i> &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt; Starting Apache results in this error:
</I>&gt;<i> &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt; # service httpd start
</I>&gt;<i> &gt;&gt;&gt;&gt; Starting httpd: httpd: Syntax error on line 210 of /etc/httpd/conf/
</I>&gt;<i> &gt;&gt;&gt;&gt; httpd.conf: Syntax error on line 6 of /etc/httpd/conf.d/
</I>&gt;<i> &gt;&gt;&gt;&gt; python.conf:
</I>&gt;<i> &gt;&gt;&gt;&gt; Cannot load /etc/httpd/modules/mod_python.so into  server:
</I>&gt;<i> &gt;&gt;&gt;&gt; /etc/httpd/modules/mod_python.so: cannot restore segment  prot
</I>&gt;<i> &gt;&gt;&gt;&gt; after
</I>&gt;<i> &gt;&gt;&gt;&gt; reloc: Permission denied
</I>&gt;<i> &gt;&gt;&gt;&gt;                                                            [FAILED]
</I>&gt;<i> &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; This error message is often related to selinux permissions.
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; A quick check to see if that is the problem is to disable
</I>&gt;<i> &gt;&gt;&gt; selinux  with
</I>&gt;<i> &gt;&gt;&gt; the command (as root) &quot;setenforce 0&quot;.  If the module then  loads
</I>&gt;<i> &gt;&gt;&gt; correctly, it can be fixed permanently with the command:
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; chcon -t texrel_shlib_t /etc/httpd/modules/mod_python.so
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; Then, re-enable selinux with &quot;setenforce 1&quot;.
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; If disabling selinux does not fix the problem, then more
</I>&gt;<i> &gt;&gt;&gt; investigation
</I>&gt;<i> &gt;&gt;&gt; is required.
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; Hope that helps,
</I>&gt;<i> &gt;&gt;&gt; e.
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt; USING:
</I>&gt;<i> &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt; RHEL5 / SELinux
</I>&gt;<i> &gt;&gt;&gt;&gt; Apache 2.2
</I>&gt;<i> &gt;&gt;&gt;&gt; Python 2.5.1
</I>&gt;<i> &gt;&gt;&gt;&gt; mod_pythonn 3.3.1
</I>&gt;<i> &gt;&gt;&gt;&gt; httpd.conf (not .htaccess)
</I>&gt;<i> &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt; TESTED THUS FAR:
</I>&gt;<i> &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt; .so file exists with same permissions as other modules
</I>&gt;<i> &gt;&gt;&gt;&gt; # ls -Z /etc/httpd/modules/mod_python.so
</I>&gt;<i> &gt;&gt;&gt;&gt; -rwxr-xr-x  root root system_u:object_r:httpd_modules_t /etc/httpd/
</I>&gt;<i> &gt;&gt;&gt;&gt; modules/mod_python.so*
</I>&gt;<i> &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt; If I comment out:
</I>&gt;<i> &gt;&gt;&gt;&gt; &quot;#LoadModule python_module modules/mod_python.so&quot;
</I>&gt;<i> &gt;&gt;&gt;&gt; and other related python lines Apache starts just fine without
</I>&gt;<i> &gt;&gt;&gt;&gt; mod_python.
</I>&gt;<i> &gt;&gt;&gt;&gt; # service httpd start
</I>&gt;<i> &gt;&gt;&gt;&gt; Starting httpd:                                            [  OK  ]
</I>&gt;<i> &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; _______________________________________________
</I>&gt;<i> &gt;&gt; Mod_python mailing list
</I>&gt;<i> &gt;&gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> &gt;&gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i>
</I></PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024788.html">[mod_python] Apache Fails to load mod_python.so with
	Permissiondenied error under SELinux
</A></li>
	<LI>Next message: <A HREF="024790.html">[mod_python] Apache Fails to load mod_python.so with
	Permissiondenied error under SELinux
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24789">[ date ]</a>
              <a href="thread.html#24789">[ thread ]</a>
              <a href="subject.html#24789">[ subject ]</a>
              <a href="author.html#24789">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
