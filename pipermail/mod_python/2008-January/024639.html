<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Exceptions in the mod_python handler?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Exceptions%20in%20the%20mod_python%20handler%3F&In-Reply-To=b11ea23c0801062050g2f0dfe70kccd7156feb0b48fc%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024638.html">
   <LINK REL="Next"  HREF="024651.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Exceptions in the mod_python handler?</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Bart</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Exceptions%20in%20the%20mod_python%20handler%3F&In-Reply-To=b11ea23c0801062050g2f0dfe70kccd7156feb0b48fc%40mail.gmail.com"
       TITLE="[mod_python] Exceptions in the mod_python handler?">scarfboy at gmail.com
       </A><BR>
    <I>Mon Jan  7 13:37:23 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="024638.html">[mod_python] Exceptions in the mod_python handler?
</A></li>
        <LI>Next message: <A HREF="024651.html">[mod_python] Exceptions in the mod_python handler?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24639">[ date ]</a>
              <a href="thread.html#24639">[ thread ]</a>
              <a href="subject.html#24639">[ subject ]</a>
              <a href="author.html#24639">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Jan 7, 2008 5:50 AM, Webb Sprague &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">webb.sprague at gmail.com</A>&gt; wrote:
&gt;<i> Hi all,
</I>&gt;<i>
</I>&gt;<i> I have a mod_python handler, called &quot;lc.py&quot;, which has a bunch of
</I>&gt;<i> functions -- mapped to pages --  called things &quot;index&quot;,
</I>&gt;<i> &quot;process_request&quot;, etc.  Before defining those functions, I connect to
</I>&gt;<i> the database with psycopg2 and pass that connection handle to each
</I>&gt;<i> function/ page.
</I>&gt;<i>
</I>&gt;<i> &lt;Directory /var/www/localhost/htdocs/lcfit&gt;
</I>&gt;<i>     SetHandler mod_python
</I>&gt;<i>     PythonHandler mod_python.publisher
</I>&gt;<i>     PythonDebug On
</I>&gt;<i> &lt;/Directory&gt;
</I>&gt;<i>
</I>&gt;<i> # This is lc.py in the lcfit directory
</I>&gt;<i> dbcon = pyscopg2.connect(&quot;blah&quot;)
</I>&gt;<i> def index(req, dbcon=dbcon):
</I>&gt;<i>       curs = dbcon.cursor()
</I>&gt;<i>       # etc
</I>&gt;<i>
</I>&gt;<i> This works fine usually.  However,  when the connection fails I don't
</I>&gt;<i> know how to get apache to send some text to the user saying &quot;call the
</I>&gt;<i> admin and tell him to restart postgres.&quot;  At the moment I get a nice
</I>&gt;<i> stack trace that I know how to read, but I would like to catch the
</I>&gt;<i> exception, print something less intimidating, and quit processing the
</I>&gt;<i> handler.
</I>
The stack trace comes from PythonDebug being On, as you probably know.
You can turn it off and raise an error that causes apache to generate its
generic error page (for the HTTP code), but this is probably no more
informative.
Since you'll probably want something app-specific, you'll probably want to
catch the error inside python and generate your own error page.

Exactly what and how depends on your wishes. I have an app in which
I should really hide the stack trace muck, but it's relatively rare as I
catch most errors inside handler code anyway, so I can probably get away
with a generic error handler for the few I forgot.
I'm thinking of doing so via a decorator, which is my pet method
of non-redundantly adding handler-wide things to multiple handlers.


&gt;<i> If I can somehow mark it so that apache knows to reload lc.py
</I>&gt;<i> and attempt to reconnect the database the next time (hopefully after
</I>&gt;<i> postgres is restarted), that would be especially great (touching the
</I>&gt;<i> file?).
</I>&gt;<i>
</I>&gt;<i> Is this a bad design?  I am probably misunderstanding the order in
</I>&gt;<i> which things are called (handlers, functions, modules, etc...), but I
</I>&gt;<i> don't want each page to connect() and close() on each call, and I
</I>&gt;<i> don't know where else to put the connection code except in the main
</I>&gt;<i> handler.
</I>
Leaving connections open between page loads is technically possible,
but opens a world of worry and bordercases.
As I recall, psycopg does connection pooling anyway, so I'd suggest
reading up on how to use it.


Regards,
--Bart
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024638.html">[mod_python] Exceptions in the mod_python handler?
</A></li>
	<LI>Next message: <A HREF="024651.html">[mod_python] Exceptions in the mod_python handler?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24639">[ date ]</a>
              <a href="thread.html#24639">[ thread ]</a>
              <a href="subject.html#24639">[ subject ]</a>
              <a href="author.html#24639">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
