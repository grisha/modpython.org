<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] strange behavior with mpm worker (inaccurate number
	of max processes?)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20strange%20behavior%20with%20mpm%20worker%20%28inaccurate%20number%0A%09of%20max%20processes%3F%29&In-Reply-To=88e286470801211937v732a64b2t1bc85ec5f59439df%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024695.html">
   <LINK REL="Next"  HREF="024697.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] strange behavior with mpm worker (inaccurate number
	of max processes?)</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Alec Matusis</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20strange%20behavior%20with%20mpm%20worker%20%28inaccurate%20number%0A%09of%20max%20processes%3F%29&In-Reply-To=88e286470801211937v732a64b2t1bc85ec5f59439df%40mail.gmail.com"
       TITLE="[mod_python] strange behavior with mpm worker (inaccurate number
	of max processes?)">matusis at yahoo.com
       </A><BR>
    <I>Mon Jan 21 23:29:29 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="024695.html">[mod_python] strange behavior with mpm worker (inaccurate number
	of max processes?)
</A></li>
        <LI>Next message: <A HREF="024697.html">[mod_python] strange behavior with mpm worker (inaccurate number
	of max processes?)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24696">[ date ]</a>
              <a href="thread.html#24696">[ thread ]</a>
              <a href="subject.html#24696">[ subject ]</a>
              <a href="author.html#24696">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> Just ignore it if it seems wrong. It is quite possible mod_python does
</I>&gt;<i> it wrong
</I>
Am I correct in thinking that this bug will actually reduce the number of
available maxclients to mod_python (i.e. it's not just a logging error)?
We serve both scripts and static content from this apache server, so
hopefully this will at least not affect the settings for static content?

Incidentally, I think this random number &quot;11 max processes&quot; is the actual
number of processes that were alive when apache was restarted by cron. Since
we run that cron at night, the number of processes that we need during the
day is higher, so this could be a problem.

&gt;<i> -----Original Message-----
</I>&gt;<i> From: Graham Dumpleton [mailto:<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">graham.dumpleton at gmail.com</A>]
</I>&gt;<i> Sent: Monday, January 21, 2008 7:38 PM
</I>&gt;<i> To: Alec Matusis
</I>&gt;<i> Cc: <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python at modpython.org</A>
</I>&gt;<i> Subject: Re: [mod_python] strange behavior with mpm worker (inaccurate
</I>&gt;<i> number of max processes?)
</I>&gt;<i> 
</I>&gt;<i> Just ignore it if it seems wrong. It is quite possible mod_python does
</I>&gt;<i> it wrong, or does it in a way which isn't compatible with newer
</I>&gt;<i> versions of Apache. The code certainly has various warnings against
</I>&gt;<i> the code which make it look a little suspect.
</I>&gt;<i> 
</I>&gt;<i>     /* figure out maximum possible concurrent connections */
</I>&gt;<i>     /* MAX_DAEMON_USED seems to account for MaxClients, as opposed to
</I>&gt;<i>        MAX_DAEMONS, which is ServerLimit
</I>&gt;<i>     */
</I>&gt;<i>     ap_mpm_query(AP_MPMQ_IS_THREADED, &amp;is_threaded);
</I>&gt;<i>     if (is_threaded != AP_MPMQ_NOT_SUPPORTED) {
</I>&gt;<i>         ap_mpm_query(AP_MPMQ_MAX_THREADS, &amp;max_threads);
</I>&gt;<i>     }
</I>&gt;<i>     ap_mpm_query(AP_MPMQ_IS_FORKED, &amp;is_forked);
</I>&gt;<i>     if (is_forked != AP_MPMQ_NOT_SUPPORTED) {
</I>&gt;<i>         /* XXX This looks strange, and it is. prefork.c seems to use
</I>&gt;<i>            MAX_DAEMON_USED the same way that worker.c uses
</I>&gt;<i>            MAX_DAEMONS (prefork is wrong IMO) */
</I>&gt;<i>         ap_mpm_query(AP_MPMQ_MAX_DAEMON_USED, &amp;max_procs);
</I>&gt;<i>         if (max_procs == -1) {
</I>&gt;<i>             ap_mpm_query(AP_MPMQ_MAX_DAEMONS, &amp;max_procs);
</I>&gt;<i>         }
</I>&gt;<i>     }
</I>&gt;<i>     max_clients = (((max_threads &lt;= 0) ? 1 : max_threads) *
</I>&gt;<i>                    ((max_procs &lt;= 0) ? 1 : max_procs));
</I>&gt;<i> 
</I>&gt;<i> Graham
</I>&gt;<i> 
</I>&gt;<i> On 21/01/2008, Alec Matusis &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">matusis at yahoo.com</A>&gt; wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; We are using worker MPM
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Our apache configuration is
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ServerLimit 40
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ThreadLimit 70
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; StartServers          10
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; MaxClients            1600
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; MinSpareThreads       75
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; MaxSpareThreads       200
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ThreadsPerChild       40
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; MaxRequestsPerChild   10000
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; When apache is restarted with
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; #apachectl stop
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; #apachectl start
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; We get in the error log:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; [notice] mod_python: Creating 32 session mutexes based on 40 max
</I>&gt;<i> processes
</I>&gt;<i> &gt; and 40 max threads
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; [notice] Apache/2.2.6 (Unix) mod_python/3.3.1 Python/2.4.1 configured
</I>&gt;<i> --
</I>&gt;<i> &gt; resuming normal operations
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; This is what we expect.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Now we restart apache this way:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; #apachectl restart
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; In the error log:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; [notice] SIGHUP received.  Attempting to restart
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;  [notice] mod_python: Creating 32 session mutexes based on 11 max
</I>&gt;<i> processes
</I>&gt;<i> &gt; and 40 max threads.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;  [notice] mod_python: using mutex_directory /tmp
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;  [notice] Apache/2.2.6 (Unix) mod_python/3.3.1 Python/2.4.1
</I>&gt;<i> configured --
</I>&gt;<i> &gt; resuming normal operations
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Where does this number &quot;11 max processes&quot; come from? We do not have
</I>&gt;<i> it
</I>&gt;<i> &gt; anywhere in the configuration.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; We get
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; Mod_python mailing list
</I>&gt;<i> &gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> &gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024695.html">[mod_python] strange behavior with mpm worker (inaccurate number
	of max processes?)
</A></li>
	<LI>Next message: <A HREF="024697.html">[mod_python] strange behavior with mpm worker (inaccurate number
	of max processes?)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24696">[ date ]</a>
              <a href="thread.html#24696">[ thread ]</a>
              <a href="subject.html#24696">[ subject ]</a>
              <a href="author.html#24696">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
