<tt>
&lt;html&gt;&lt;div&gt;Sorry&nbsp;for&nbsp;a&nbsp;long&nbsp;message,&nbsp;but&nbsp;this&nbsp;requires&nbsp;a&nbsp;bit&nbsp;of<br>
explanation.&nbsp;I&nbsp;appreciate&nbsp;your&nbsp;patience&nbsp;in&nbsp;advance.&lt;/div&gt;<br>
&lt;br&gt;<br>
&lt;div&gt;I&nbsp;have&nbsp;a&nbsp;bunch&nbsp;of&nbsp;python&nbsp;legacy&nbsp;code&nbsp;that&nbsp;used&nbsp;to&nbsp;be&nbsp;part&nbsp;of&nbsp;a&nbsp;large<br>
CGI-based&nbsp;system.&nbsp;This&nbsp;code&nbsp;simply&nbsp;used&nbsp;print&nbsp;statements&nbsp;to&nbsp;output&nbsp;HTML<br>
as&nbsp;follows:&lt;/div&gt;<br>
&lt;br&gt;<br>
&lt;div&gt;def&nbsp;foo():&lt;/div&gt;<br>
&lt;div&gt;&lt;x-tab&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/x-tab&gt;print<br>
'html1'&lt;/div&gt;<br>
&lt;div&gt;&lt;x-tab&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/x-tab&gt;print<br>
'html2'&lt;/div&gt;<br>
&lt;br&gt;<br>
&lt;div&gt;Now&nbsp;I&nbsp;want&nbsp;to&nbsp;convert&nbsp;CGI&nbsp;to&nbsp;mod_python,&nbsp;but&nbsp;I&nbsp;would&nbsp;like&nbsp;to&nbsp;re-use<br>
the&nbsp;legacy&nbsp;code&nbsp;with&nbsp;as&nbsp;little&nbsp;re-writing&nbsp;as&nbsp;possible&nbsp;(obviously&nbsp;the<br>
legacy&nbsp;code&nbsp;is&nbsp;a&nbsp;lot&nbsp;lengthier&nbsp;and&nbsp;more&nbsp;complicated&nbsp;than&nbsp;the&nbsp;example<br>
above).&nbsp;I&nbsp;am&nbsp;using&nbsp;the&nbsp;publisher&nbsp;module,&nbsp;which&nbsp;requires&nbsp;my&nbsp;code&nbsp;to&nbsp;return<br>
a&nbsp;string&nbsp;containing&nbsp;all&nbsp;of&nbsp;the&nbsp;HTML.&nbsp;So&nbsp;I&nbsp;thought&nbsp;I&nbsp;would&nbsp;be&nbsp;clever&nbsp;and<br>
do&nbsp;something&nbsp;like&nbsp;this:&lt;/div&gt;<br>
&lt;br&gt;<br>
&lt;div&gt;import&nbsp;sys,&nbsp;cStringIO&lt;/div&gt;<br>
&lt;div&gt;def&nbsp;handler(req):&lt;/div&gt;<br>
&lt;div&gt;&lt;x-tab&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/x-tab&gt;out<br>
=&amp;nbsp;&nbsp;sys.stdout&nbsp;=&nbsp;StringIO()&lt;/div&gt;<br>
&lt;div&gt;&lt;x-tab&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/x-tab&gt;foo()&lt;/div&gt;<br>
&lt;div&gt;&lt;x-tab&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/x-tab&gt;return<br>
out&lt;/div&gt;<br>
&lt;br&gt;<br>
&lt;div&gt;This&nbsp;works&nbsp;great&nbsp;as&nbsp;long&nbsp;as&nbsp;the&nbsp;second&nbsp;request&nbsp;does&nbsp;not&nbsp;arrive<br>
before&nbsp;the&nbsp;first&nbsp;one&nbsp;is&nbsp;done.&nbsp;Otherwise,&nbsp;the&nbsp;output&nbsp;gets&nbsp;screwed&nbsp;up.<br>
Since&nbsp;&amp;quot;out&amp;quot;&nbsp;is&nbsp;a&nbsp;local&nbsp;variable,&nbsp;each&nbsp;request&nbsp;has&nbsp;its&nbsp;own<br>
instance,&nbsp;but&nbsp;sys.stdout&nbsp;is&nbsp;a&nbsp;global.&nbsp;When&nbsp;the&nbsp;second&nbsp;request&nbsp;arrives,<br>
sys.stdout&nbsp;gets&nbsp;reassigned&nbsp;and&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;output&nbsp;produced&nbsp;by&nbsp;print<br>
statements&nbsp;in&nbsp;the&nbsp;foo()&nbsp;function&nbsp;goes&nbsp;to&nbsp;the&nbsp;new&nbsp;StringIO&nbsp;object.&nbsp;For<br>
example,&nbsp;if&nbsp;the&nbsp;second&nbsp;request&nbsp;arrives&nbsp;and&nbsp;gets&nbsp;executed&nbsp;between&nbsp;the&nbsp;two<br>
print&nbsp;statements&nbsp;of&nbsp;the&nbsp;first&nbsp;request,&nbsp;then&nbsp;the&nbsp;first&nbsp;request's&nbsp;output<br>
could&nbsp;be&amp;nbsp;&nbsp;'html1\n'&nbsp;and&nbsp;the&nbsp;second&nbsp;request's&nbsp;output&nbsp;could&nbsp;be<br>
'html2\nhtml1\nhtml2\n'.&lt;/div&gt;<br>
&lt;br&gt;<br>
&lt;div&gt;Has&nbsp;anyone&nbsp;dealt&nbsp;with&nbsp;such&nbsp;a&nbsp;situation?&nbsp;Any&nbsp;clever&nbsp;suggestion&nbsp;would<br>
be&nbsp;appreciated&nbsp;as&nbsp;I&nbsp;hate&nbsp;to&nbsp;have&nbsp;to&nbsp;go&nbsp;into&nbsp;all&nbsp;the&nbsp;legacy&nbsp;code&nbsp;and<br>
change&nbsp;it&nbsp;to&nbsp;something&nbsp;like&nbsp;this:&lt;/div&gt;<br>
&lt;br&gt;<br>
&lt;div&gt;def&nbsp;foo():&lt;/div&gt;<br>
&lt;div&gt;&lt;x-tab&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/x-tab&gt;out&nbsp;=<br>
'html1\n'&lt;/div&gt;<br>
&lt;div&gt;&lt;x-tab&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/x-tab&gt;out&nbsp;=<br>
out&nbsp;+&nbsp;'html2\n'&lt;/div&gt;<br>
&lt;div&gt;&lt;x-tab&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/x-tab&gt;return<br>
out&lt;/div&gt;<br>
&lt;br&gt;<br>
&lt;div&gt;def&nbsp;handler(req):&lt;/div&gt;<br>
&lt;div&gt;&lt;x-tab&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/x-tab&gt;return<br>
foo()&lt;/div&gt;<br>
&lt;br&gt;<br>
Thanks&nbsp;in&nbsp;advance.<br>
&lt;br&gt;<br>
<br>
&lt;font&nbsp;face=&quot;Courier&nbsp;New,&nbsp;Courier&quot;&gt;__________________________________________________________________________________&lt;br&gt;<br>
&lt;/font&gt;&lt;font&nbsp;face=&quot;Courier&nbsp;New,&nbsp;Courier&quot;&nbsp;size=5&nbsp;color=&quot;#000080&quot;&gt;&lt;b&gt;Victor<br>
Muslin&lt;/b&gt;&lt;/font&gt;&lt;font&nbsp;face=&quot;Courier&nbsp;New,&nbsp;Courier&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;<br>
&lt;i&gt;The&nbsp;power&nbsp;of&nbsp;accurate&nbsp;observation&nbsp;is&nbsp;frequently&nbsp;called&nbsp;&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;<br>
cynicism&nbsp;by&nbsp;those&nbsp;who&nbsp;don't&nbsp;have&nbsp;it.&nbsp;&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&nbsp;-&nbsp;George&nbsp;Bernard<br>
Shaw&lt;br&gt;<br>
&lt;/font&gt;&lt;/i&gt;&lt;/html&gt;<br>

</tt>
