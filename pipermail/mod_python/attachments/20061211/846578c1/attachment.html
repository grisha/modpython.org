<tt>
&lt;!DOCTYPE&nbsp;html&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.01&nbsp;Transitional//EN&quot;&gt;<br>
&lt;html&gt;<br>
&lt;head&gt;<br>
&lt;/head&gt;<br>
&lt;body&nbsp;bgcolor=&quot;#ffffff&quot;&nbsp;text=&quot;#000000&quot;&gt;<br>
Hi!&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;many&nbsp;times&nbsp;thinking&nbsp;about&nbsp;better&nbsp;site&nbsp;structures,&nbsp;and&nbsp;everytime&nbsp;I<br>
hampered&nbsp;by&nbsp;&quot;import&nbsp;hell&quot;...&lt;br&gt;<br>
So&nbsp;yesterday&nbsp;I&nbsp;tried&nbsp;something.&lt;br&gt;<br>
&lt;br&gt;<br>
There&nbsp;is&nbsp;many&nbsp;way&nbsp;to&nbsp;avoid&nbsp;this&nbsp;problem.&lt;br&gt;<br>
With&nbsp;import:&lt;br&gt;<br>
1.)&nbsp;Use&nbsp;only&nbsp;one&nbsp;file&nbsp;that&nbsp;handle&nbsp;every&nbsp;request.&lt;br&gt;<br>
2.)&nbsp;Use&nbsp;one&nbsp;main&nbsp;file,&nbsp;and&nbsp;one&nbsp;file&nbsp;for&nbsp;every&nbsp;subdirs.&lt;br&gt;<br>
3.)&nbsp;Use&nbsp;many&nbsp;file,&nbsp;every&nbsp;of&nbsp;them&nbsp;handle&nbsp;it's&nbsp;subdirs.&lt;br&gt;<br>
In&nbsp;this&nbsp;way&nbsp;you&nbsp;need&nbsp;unique&nbsp;named&nbsp;submodules:&nbsp;xxxx_name&nbsp;(where&nbsp;xxxx&nbsp;is<br>
a&nbsp;hexad.&nbsp;id),&nbsp;or&nbsp;fullpathname&nbsp;(example:&nbsp;/main/sub/subsub&nbsp;=<br>
main_sub_sub).&lt;br&gt;<br>
This&nbsp;structure&nbsp;is&nbsp;very&nbsp;unflexible,&nbsp;because&nbsp;some&nbsp;of&nbsp;the&nbsp;informations&nbsp;are<br>
stored&nbsp;in&nbsp;real&nbsp;subfolders,&nbsp;some&nbsp;of&nbsp;in&nbsp;the&nbsp;filenames.&lt;br&gt;<br>
I&nbsp;cannot&nbsp;create&nbsp;unified&nbsp;directory&nbsp;structure&nbsp;for&nbsp;use&nbsp;same&nbsp;names&nbsp;except&nbsp;I<br>
create&nbsp;unique&nbsp;module&nbsp;names.&lt;br&gt;<br>
&lt;br&gt;<br>
Without&nbsp;import:&lt;br&gt;<br>
1.)&nbsp;Execfile,&nbsp;Exec.&lt;br&gt;<br>
2.)&nbsp;PSP.&lt;br&gt;<br>
&lt;br&gt;<br>
Exec&nbsp;is&nbsp;good,&nbsp;but&nbsp;need&nbsp;reinterpretation&nbsp;in&nbsp;every&nbsp;request,&nbsp;and&nbsp;every&nbsp;of<br>
them&nbsp;need&nbsp;to&nbsp;have&nbsp;same&nbsp;structure.&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;conclosion&nbsp;that&nbsp;import&nbsp;is&nbsp;need&nbsp;UNIQUE&nbsp;name,&nbsp;but&nbsp;uniqueness&nbsp;is&nbsp;could<br>
be&nbsp;everything&nbsp;what&nbsp;can&nbsp;representable&nbsp;in&nbsp;complete&nbsp;filepath.&lt;br&gt;<br>
&lt;br&gt;<br>
Yesterday&nbsp;I&nbsp;tried&nbsp;something.&lt;br&gt;<br>
The&nbsp;module&nbsp;importing&nbsp;in&nbsp;python&nbsp;is&nbsp;based&nbsp;on&nbsp;sys.modules.&lt;br&gt;<br>
But&nbsp;if&nbsp;you&nbsp;get&nbsp;out&nbsp;from&nbsp;this&nbsp;way,&nbsp;you&nbsp;can&nbsp;use&nbsp;imp&nbsp;module&nbsp;to&nbsp;do&nbsp;it&nbsp;in<br>
your&nbsp;way.&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;created&nbsp;some&nbsp;example.&lt;br&gt;<br>
In&nbsp;this&nbsp;example&nbsp;I&nbsp;create&nbsp;many&nbsp;subdirs&nbsp;with&nbsp;many&nbsp;index.py,&nbsp;and&nbsp;I&nbsp;import<br>
them&nbsp;one&nbsp;by&nbsp;one.&lt;br&gt;<br>
And&nbsp;later&nbsp;I&nbsp;modify&nbsp;one&nbsp;of&nbsp;them,&nbsp;and&nbsp;I&nbsp;test&nbsp;reloading.&nbsp;&lt;br&gt;<br>
It&nbsp;is&nbsp;working,&nbsp;but&nbsp;some&nbsp;os.sleep&nbsp;is&nbsp;needed&nbsp;to&nbsp;it&nbsp;recognize&nbsp;the&nbsp;changes.&lt;br&gt;<br>
&lt;br&gt;<br>
Please&nbsp;write&nbsp;me&nbsp;(Graham!)&nbsp;your&nbsp;opinion:&nbsp;it&nbsp;is&nbsp;useful,&nbsp;or&nbsp;not&nbsp;?&lt;br&gt;<br>
&lt;br&gt;<br>
Thanks&nbsp;for&nbsp;it:&lt;br&gt;<br>
   &nbsp;dd&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&gt;import&nbsp;os,&nbsp;sys&lt;br&gt;<br>
from&nbsp;threading&nbsp;import&nbsp;Lock&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
_ImportLock&nbsp;=&nbsp;Lock()&lt;br&gt;<br>
_Modules&nbsp;=&nbsp;{}&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
def&nbsp;Import(ModPath):&lt;br&gt;<br>
   &nbsp;ModPath&nbsp;=&nbsp;os.path.abspath(ModPath)&lt;br&gt;<br>
   &nbsp;_ImportLock.acquire(1)&lt;br&gt;<br>
   &nbsp;try:&lt;br&gt;<br>
       &nbsp;if&nbsp;not&nbsp;os.path.exists(ModPath):&lt;br&gt;<br>
           &nbsp;raise&nbsp;Exception,&nbsp;'Module&nbsp;named&nbsp;&quot;%s&quot;&nbsp;does&nbsp;not&nbsp;exists!'&nbsp;%<br>
ModPath&lt;br&gt;<br>
       &nbsp;modinfo&nbsp;=&nbsp;_Modules.get(ModPath,&nbsp;None)&lt;br&gt;<br>
       &nbsp;needreload&nbsp;=&nbsp;(not&nbsp;modinfo)&lt;br&gt;<br>
       &nbsp;actmodtime&nbsp;=&nbsp;os.path.getmtime(ModPath)&lt;br&gt;<br>
       &nbsp;if&nbsp;modinfo:&lt;br&gt;<br>
           &nbsp;modtime,&nbsp;module&nbsp;=&nbsp;modinfo&lt;br&gt;<br>
           &nbsp;needreload&nbsp;=&nbsp;(actmodtime&nbsp;!=&nbsp;modtime)&lt;br&gt;<br>
       &nbsp;if&nbsp;not&nbsp;needreload:&lt;br&gt;<br>
           &nbsp;return&nbsp;module&lt;br&gt;<br>
       &nbsp;mpath,&nbsp;mfn&nbsp;=&nbsp;os.path.split(ModPath)&lt;br&gt;<br>
       &nbsp;mf,&nbsp;me&nbsp;=&nbsp;os.path.splitext(mfn)&lt;br&gt;<br>
       &nbsp;import&nbsp;imp&lt;br&gt;<br>
       &nbsp;imp.acquire_lock(&nbsp;)&lt;br&gt;<br>
       &nbsp;try:&lt;br&gt;<br>
           &nbsp;afile,&nbsp;apathname,&nbsp;adescription&nbsp;=&nbsp;imp.find_module(mf,<br>
[mpath])&lt;br&gt;<br>
           &nbsp;module&nbsp;=&nbsp;imp.load_module(mf,&nbsp;afile,&nbsp;ModPath,&nbsp;adescription)&lt;br&gt;<br>
           &nbsp;del(sys.modules[mf])&lt;br&gt;<br>
       &nbsp;finally:&lt;br&gt;<br>
           &nbsp;imp.release_lock()&lt;br&gt;<br>
       &nbsp;_Modules[ModPath]&nbsp;=&nbsp;[actmodtime,&nbsp;module]&lt;br&gt;<br>
       &nbsp;return&nbsp;module&lt;br&gt;<br>
   &nbsp;finally:&lt;br&gt;<br>
       &nbsp;_ImportLock.release()&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
#print&nbsp;os.path.abspath('./t1/index.py')&lt;br&gt;<br>
#import&nbsp;sys&lt;br&gt;<br>
#sys.exit()&lt;br&gt;<br>
modtext&nbsp;=&nbsp;'''&lt;br&gt;<br>
name&nbsp;=&nbsp;%s&lt;br&gt;<br>
def&nbsp;PrintInfo():&lt;br&gt;<br>
   &nbsp;print&nbsp;&quot;File:&quot;,&nbsp;__file__&lt;br&gt;<br>
   &nbsp;print&nbsp;&quot;Name&nbsp;var:&quot;,&nbsp;name&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
'''&lt;br&gt;<br>
moddatas&nbsp;=&nbsp;[]&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
def&nbsp;WriteIndexPy(Number,&nbsp;VarValue):&lt;br&gt;<br>
   &nbsp;spath&nbsp;=&nbsp;'./subdir%03d'&nbsp;%&nbsp;Number&lt;br&gt;<br>
   &nbsp;if&nbsp;not&nbsp;os.path.exists(spath):&lt;br&gt;<br>
       &nbsp;os.makedirs(spath)&lt;br&gt;<br>
   &nbsp;sfn&nbsp;=&nbsp;os.path.join(spath,&nbsp;'index.py')&lt;br&gt;<br>
   &nbsp;pytext&nbsp;=&nbsp;modtext&nbsp;%&nbsp;VarValue&lt;br&gt;<br>
   &nbsp;f&nbsp;=&nbsp;open(sfn,&nbsp;'w')&lt;br&gt;<br>
   &nbsp;f.write(pytext)&lt;br&gt;<br>
   &nbsp;f.close()&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
print&nbsp;&quot;Creating&nbsp;modules&quot;&lt;br&gt;<br>
for&nbsp;i&nbsp;in&nbsp;range(100):&lt;br&gt;<br>
   &nbsp;WriteIndexPy(i,&nbsp;i)&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
print&nbsp;&quot;Import&nbsp;new&nbsp;modules&quot;&lt;br&gt;<br>
import&nbsp;time&lt;br&gt;<br>
st&nbsp;=&nbsp;time.time()&lt;br&gt;<br>
for&nbsp;i&nbsp;in&nbsp;range(100):&lt;br&gt;<br>
   &nbsp;spath&nbsp;=&nbsp;'./subdir%03d'&nbsp;%&nbsp;i&lt;br&gt;<br>
   &nbsp;sfn&nbsp;=&nbsp;os.path.join(spath,&nbsp;'index.py')&lt;br&gt;<br>
   &nbsp;m&nbsp;=&nbsp;Import(sfn)&lt;br&gt;<br>
   &nbsp;#print&nbsp;&quot;Module:&quot;,&nbsp;m&lt;br&gt;<br>
   &nbsp;#print&nbsp;&quot;Module's&nbsp;var&quot;,&nbsp;m.name&lt;br&gt;<br>
   &nbsp;#m.PrintInfo()&lt;br&gt;<br>
et&nbsp;=&nbsp;time.time()&lt;br&gt;<br>
print&nbsp;et&nbsp;-&nbsp;st,&nbsp;&quot;seconds&quot;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
print&nbsp;&quot;Import&nbsp;loaded&nbsp;modules&quot;&lt;br&gt;<br>
import&nbsp;time&lt;br&gt;<br>
st&nbsp;=&nbsp;time.time()&lt;br&gt;<br>
for&nbsp;i&nbsp;in&nbsp;range(100):&lt;br&gt;<br>
   &nbsp;spath&nbsp;=&nbsp;'./subdir%03d'&nbsp;%&nbsp;i&lt;br&gt;<br>
   &nbsp;sfn&nbsp;=&nbsp;os.path.join(spath,&nbsp;'index.py')&lt;br&gt;<br>
   &nbsp;m&nbsp;=&nbsp;Import(sfn)&lt;br&gt;<br>
   &nbsp;#print&nbsp;&quot;Module:&quot;,&nbsp;m&lt;br&gt;<br>
   &nbsp;#print&nbsp;&quot;Module's&nbsp;var&quot;,&nbsp;m.name&lt;br&gt;<br>
   &nbsp;#m.PrintInfo()&lt;br&gt;<br>
et&nbsp;=&nbsp;time.time()&lt;br&gt;<br>
print&nbsp;et&nbsp;-&nbsp;st,&nbsp;&quot;seconds&quot;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
time.sleep(1)&lt;br&gt;<br>
print&nbsp;&quot;Reload&nbsp;1&quot;&lt;br&gt;<br>
spath&nbsp;=&nbsp;'./subdir%03d'&nbsp;%&nbsp;0&lt;br&gt;<br>
sfn&nbsp;=&nbsp;os.path.join(spath,&nbsp;'index.py')&lt;br&gt;<br>
WriteIndexPy(0,100)&lt;br&gt;<br>
m&nbsp;=&nbsp;Import(sfn)&lt;br&gt;<br>
print&nbsp;&quot;Module:&quot;,&nbsp;m&lt;br&gt;<br>
print&nbsp;&quot;Module's&nbsp;var&quot;,&nbsp;m.name&lt;br&gt;<br>
m.PrintInfo()&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
print&nbsp;&quot;Reload&nbsp;2&quot;&lt;br&gt;<br>
m&nbsp;=&nbsp;Import(sfn)&lt;br&gt;<br>
print&nbsp;&quot;Module:&quot;,&nbsp;m&lt;br&gt;<br>
print&nbsp;&quot;Module's&nbsp;var&quot;,&nbsp;m.name&lt;br&gt;<br>
m.PrintInfo()&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
print&nbsp;&quot;Exec&nbsp;test&quot;&lt;br&gt;<br>
import&nbsp;time&lt;br&gt;<br>
st&nbsp;=&nbsp;time.time()&lt;br&gt;<br>
for&nbsp;i&nbsp;in&nbsp;range(100):&lt;br&gt;<br>
   &nbsp;spath&nbsp;=&nbsp;'./subdir%03d'&nbsp;%&nbsp;i&lt;br&gt;<br>
   &nbsp;sfn&nbsp;=&nbsp;os.path.join(spath,&nbsp;'index.py')&lt;br&gt;<br>
   &nbsp;execfile(sfn,&nbsp;globals(),&nbsp;locals())&lt;br&gt;<br>
et&nbsp;=&nbsp;time.time()&lt;br&gt;<br>
print&nbsp;et&nbsp;-&nbsp;st,&nbsp;&quot;seconds&quot;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
