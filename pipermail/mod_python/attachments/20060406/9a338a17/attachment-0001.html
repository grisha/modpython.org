<tt>
I&nbsp;have&nbsp;a&nbsp;bit&nbsp;of&nbsp;code&nbsp;that's&nbsp;trying&nbsp;to&nbsp;access&nbsp;google&nbsp;from&nbsp;a&nbsp;mod_python&nbsp;request&nbsp;handler,&nbsp;and&nbsp;it&nbsp;crashes&nbsp;Apache&nbsp;when&nbsp;it&nbsp;reaches&nbsp;the&nbsp;line&lt;br&gt;&lt;br&gt;response&nbsp;=&nbsp;opener.open(self.url)&lt;br&gt;&lt;br&gt;Is&nbsp;it&nbsp;possible&nbsp;to&nbsp;connect&nbsp;to&nbsp;external&nbsp;sites&nbsp;from&nbsp;Apache&nbsp;in&nbsp;this&nbsp;manner,&nbsp;or&nbsp;should&nbsp;I&nbsp;just&nbsp;give&nbsp;up&nbsp;and&nbsp;use&nbsp;PHP?<br>
&lt;br&gt;&lt;br&gt;import&nbsp;httplib,&nbsp;profile,&nbsp;pstats,&nbsp;re,&nbsp;sys,&nbsp;thread,&nbsp;threading,&nbsp;urllib2&lt;br&gt;from&nbsp;mod_python&nbsp;import&nbsp;apache&lt;br&gt;from&nbsp;BeautifulSoup&nbsp;import&nbsp;BeautifulSoup&lt;br&gt;&lt;br&gt;MAXCONNECTIONS&nbsp;=&nbsp;2&lt;br&gt;MAXRESULTS&nbsp;=&nbsp;10&lt;br&gt;&lt;br&gt;class&nbsp;PageGrabber(<br>
threading.Thread):&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;connectionPool&nbsp;=&nbsp;threading.Semaphore(MAXCONNECTIONS)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;outputSemaphore&nbsp;=&nbsp;threading.Semaphore()&lt;br&gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;def&nbsp;__init__(self,&nbsp;url,&nbsp;req):&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;self.url&nbsp;=&nbsp;url&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;self.req&nbsp;=&nbsp;req&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;threading.Thread.__init__(self)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;def&nbsp;run(self):&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;opener&nbsp;=&nbsp;urllib2.build_opener()&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;opener.addheaders&nbsp;=&nbsp;[('User-agent',&nbsp;'Mozilla/5.0')]&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;try:&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;PageGrabber.connectionPool.acquire<br>
()&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;response&nbsp;=&nbsp;opener.open(self.url)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;PageGrabber.connectionPool.release()&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;soup&nbsp;=&nbsp;BeautifulSoup(response)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;PageGrabber.outputSemaphore.acquire()&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;#strip&nbsp;google&nbsp;cache&nbsp;header&nbsp;stuff<br>
&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;cutPage&nbsp;=&nbsp;re.split('&amp;lt;hr&amp;gt;|&amp;lt;hr&nbsp;/&amp;gt;',&nbsp;str(soup),&nbsp;1)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;strippedPage&nbsp;=&nbsp;cutPage[1]&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;#split&nbsp;into&nbsp;words&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;wordList&nbsp;=&nbsp;re.split('\t|\n|&nbsp;|&amp;lt;.*?&amp;gt;|\r|&amp;lt;!--|--&amp;gt;|&amp;amp;nbsp;|,|&amp;amp;quot;|&amp;amp;lt;|&amp;amp;gt;|\?|!|:|\*|\.|\[|\]|\(|\)|\'|\-|&amp;quot;|=|/|&amp;lt;|&amp;gt;|\+|&amp;amp;|@|#',&nbsp;str(strippedPage))<br>
&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;#print&nbsp;only&nbsp;nonzero&nbsp;words&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;for&nbsp;word&nbsp;in&nbsp;wordList:&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;len(word)&nbsp;&amp;gt;&nbsp;0:&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;self.req.write(word&nbsp;+&nbsp;'&nbsp;/&nbsp;')&nbsp;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;PageGrabber.outputSemaphore.release<br>
()&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;except&nbsp;Exception:&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;print&nbsp;'timed&nbsp;out'&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;return&lt;br&gt;&lt;br&gt;def&nbsp;main(req):&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;opener&nbsp;=&nbsp;urllib2.build_opener()&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;opener.addheaders&nbsp;=&nbsp;[('User-agent',&nbsp;'Mozilla/5.0')]&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;searchTerms&nbsp;=&nbsp;['python']<br>
&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;len(searchTerms)&nbsp;&amp;gt;&nbsp;1:&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;searchString&nbsp;=&nbsp;'+'.join(searchTerms)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;else:&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;searchString&nbsp;=&nbsp;searchTerms[0]&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;response&nbsp;=&nbsp;opener.open('&lt;a&nbsp;href=&quot;http://www.google.com/search?num=&quot;&gt;http://www.google.com/search?num=<br>
&lt;/a&gt;'&nbsp;+&nbsp;str(MAXRESULTS)&nbsp;+'&amp;amp;q='&nbsp;+&nbsp;searchString)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;soup&nbsp;=&nbsp;BeautifulSoup(response)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;cachedURLs&nbsp;=&nbsp;[]&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;#extract&nbsp;cache&nbsp;urls&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;for&nbsp;result&nbsp;in&nbsp;soup('a'):&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;re.search('q=cache',&nbsp;result['href']):<br>
&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;cachedURLs.append(result['href'])&lt;br&gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;#start&nbsp;threads&nbsp;to&nbsp;pull&nbsp;down&nbsp;cached&nbsp;data&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;for&nbsp;cachedURL&nbsp;in&nbsp;cachedURLs:&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;#use&nbsp;google's&nbsp;image&nbsp;strip&nbsp;thingie&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;stripURL&nbsp;=&nbsp;cachedURL&nbsp;+&nbsp;'&amp;amp;strip=1'<br>
&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;PageGrabber(stripURL,&nbsp;req).start()&lt;br&gt;&lt;br&gt;def&nbsp;handler(req):&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;req.content_type&nbsp;=&nbsp;'text/plain'&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;main(req)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;return&nbsp;apache.OK&lt;br&gt;&lt;br&gt;<br>

</tt>
