<tt>
&lt;!DOCTYPE&nbsp;html&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.01&nbsp;Transitional//EN&quot;&gt;<br>
&lt;html&gt;<br>
&lt;head&gt;<br>
&nbsp;&nbsp;&lt;meta&nbsp;content=&quot;text/html;charset=UTF-8&quot;&nbsp;http-equiv=&quot;Content-Type&quot;&gt;<br>
&lt;/head&gt;<br>
&lt;body&nbsp;bgcolor=&quot;#ffffff&quot;&nbsp;text=&quot;#000000&quot;&gt;<br>
I&nbsp;was&nbsp;having&nbsp;trouble&nbsp;loading&nbsp;a&nbsp;pickled&nbsp;class&nbsp;object&nbsp;using&nbsp;mod_python<br>
when&nbsp;I&nbsp;came&nbsp;across&nbsp;this&nbsp;post&nbsp;in&nbsp;the&nbsp;mod_python&nbsp;archives&nbsp;from&nbsp;June&nbsp;2007.<br>
even&nbsp;though&nbsp;the&nbsp;link&nbsp;below&nbsp;implies&nbsp;that&nbsp;loading&nbsp;a&nbsp;pickled&nbsp;object&nbsp;in<br>
this&nbsp;manner&nbsp;cannot&nbsp;be&nbsp;done,&nbsp;I&nbsp;believe&nbsp;I&nbsp;may&nbsp;have&nbsp;found&nbsp;a&nbsp;work&nbsp;around.&nbsp;I<br>
wanted&nbsp;to&nbsp;bounce&nbsp;this&nbsp;off&nbsp;the&nbsp;mod_python&nbsp;list&nbsp;for&nbsp;two&nbsp;reasons:&nbsp;(a)&nbsp;to<br>
make&nbsp;sure&nbsp;I'm&nbsp;not&nbsp;breaking&nbsp;anything,&nbsp;and&nbsp;(b)&nbsp;to&nbsp;share&nbsp;what&nbsp;may&nbsp;be&nbsp;a<br>
viable&nbsp;solution&nbsp;to&nbsp;this&nbsp;problem.&lt;br&gt;<br>
&lt;br&gt;<br>
the&nbsp;link&nbsp;mentioned&nbsp;here&nbsp;seems&nbsp;to&nbsp;imply&nbsp;that&nbsp;one&nbsp;cannot&nbsp;load&nbsp;a&nbsp;pickled<br>
instance&nbsp;of&nbsp;a&nbsp;class&nbsp;in&nbsp;a&nbsp;script&nbsp;running&nbsp;through&nbsp;mod_python.&nbsp;the&nbsp;problem<br>
seems&nbsp;to&nbsp;be&nbsp;related&nbsp;to&nbsp;mod_python's&nbsp;method&nbsp;of&nbsp;importing.&nbsp;since&nbsp;there<br>
doesn't&nbsp;seem&nbsp;to&nbsp;be&nbsp;a&nbsp;good&nbsp;way&nbsp;to&nbsp;guarantee&nbsp;where&nbsp;on&nbsp;the&nbsp;file&nbsp;system&nbsp;the<br>
script&nbsp;will&nbsp;run&nbsp;when&nbsp;apache&nbsp;receives&nbsp;a&nbsp;request&nbsp;that&nbsp;invokes&nbsp;mod_python.<br>
thus,&nbsp;rather&nbsp;than&nbsp;referring&nbsp;to&nbsp;a&nbsp;module&nbsp;by&nbsp;name&nbsp;alone&nbsp;(with&nbsp;the<br>
standard&nbsp;&quot;import&nbsp;module_name&quot;&nbsp;approach),&nbsp;modules&nbsp;are&nbsp;referred&nbsp;to&nbsp;by<br>
their&nbsp;path&nbsp;on&nbsp;the&nbsp;file&nbsp;system&nbsp;using&nbsp;apache.import_module,&nbsp;for&nbsp;example<br>
&quot;my_module&nbsp;=<br>
apache.import_module('/home/username/my_proj/my_module.py')&quot;.&lt;br&gt;<br>
&lt;br&gt;<br>
the&nbsp;problem&nbsp;becomes&nbsp;that&nbsp;this&nbsp;method&nbsp;of&nbsp;importing&nbsp;doesn't&nbsp;register&nbsp;the<br>
module&nbsp;name&nbsp;with&nbsp;sys.modules.&nbsp;therefore,&nbsp;if&nbsp;I&nbsp;have&nbsp;a&nbsp;pickled&nbsp;instance<br>
of&nbsp;some&nbsp;class&nbsp;my_module.MyClass,&nbsp;when&nbsp;I&nbsp;try&nbsp;to&nbsp;load&nbsp;the&nbsp;pickled<br>
instance,&nbsp;python&nbsp;would&nbsp;complain&nbsp;that&nbsp;there&nbsp;is&nbsp;&quot;No&nbsp;module&nbsp;named<br>
my_module&quot;&nbsp;(as&nbsp;described&nbsp;by&nbsp;the&nbsp;OP),&nbsp;even&nbsp;if&nbsp;I&nbsp;had&nbsp;loaded&nbsp;it&nbsp;using<br>
apache.import_module.&lt;br&gt;<br>
&lt;br&gt;<br>
the&nbsp;workaround&nbsp;that&nbsp;I&nbsp;found&nbsp;looks&nbsp;something&nbsp;like&nbsp;the&nbsp;following.&lt;br&gt;<br>
&lt;br&gt;<br>
import&nbsp;sys&lt;br&gt;<br>
def&nbsp;index(req):&lt;br&gt;<br>
   &nbsp;my_module&nbsp;=<br>
apache.import_module('/home/username/my_proj/my_module.py')&lt;br&gt;<br>
   &nbsp;sys.modules['my_module']&nbsp;=&nbsp;my_module&lt;br&gt;<br>
&lt;br&gt;<br>
this&nbsp;code&nbsp;ensures&nbsp;that&nbsp;my_module&nbsp;is&nbsp;registered&nbsp;with&nbsp;the&nbsp;list&nbsp;of&nbsp;modules<br>
python&nbsp;knows&nbsp;about&nbsp;in&nbsp;sys.modules,&nbsp;so&nbsp;that&nbsp;when&nbsp;I&nbsp;load&nbsp;that&nbsp;pickled<br>
instance&nbsp;of&nbsp;my_module.MyClass,&nbsp;python&nbsp;knows&nbsp;about&nbsp;a&nbsp;module&nbsp;named<br>
&quot;my_module&quot;&nbsp;and&nbsp;thus&nbsp;can&nbsp;properly&nbsp;load&nbsp;the&nbsp;class.&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;should&nbsp;note&nbsp;that,&nbsp;in&nbsp;practice,&nbsp;this&nbsp;has&nbsp;actually&nbsp;worked&nbsp;for&nbsp;me.<br>
whether&nbsp;or&nbsp;not&nbsp;it's&nbsp;a&nbsp;good&nbsp;idea,&nbsp;though,&nbsp;is&nbsp;another&nbsp;question.&lt;br&gt;<br>
&lt;br&gt;<br>
what&nbsp;do&nbsp;you&nbsp;all&nbsp;think?&nbsp;have&nbsp;I&nbsp;gone&nbsp;horribly&nbsp;wrong,&nbsp;or&nbsp;is&nbsp;this&nbsp;a&nbsp;viable<br>
work&nbsp;around&nbsp;to&nbsp;loading&nbsp;a&nbsp;pickled&nbsp;instance&nbsp;of&nbsp;a&nbsp;class?&lt;br&gt;<br>
&lt;br&gt;<br>
~Eric&lt;br&gt;<br>
&lt;pre&gt;<br>
<br>
<br>
&lt;pre&nbsp;wrap=&quot;&quot;&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;pre&nbsp;wrap=&quot;&quot;&gt;<br>
&lt;/pre&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;pre&nbsp;wrap=&quot;&quot;&gt;&amp;gt;&lt;i&gt;&nbsp;Read:<br>
&lt;/i&gt;&amp;gt;&lt;i&gt;<br>
&lt;/i&gt;&amp;gt;&lt;i&gt;&nbsp;&nbsp;&nbsp;&lt;a<br>
&nbsp;href=&quot;http://www.dscpl.com.au/wiki/ModPython/Articles/IssuesWithSessionObjects&quot;&gt;http://www.dscpl.com.au/wiki/ModPython/Articles/IssuesWithSessionObjects&lt;/a&gt;<br>
&lt;/i&gt;&amp;gt;&lt;i&gt;<br>
&lt;/i&gt;&amp;gt;&lt;i&gt;&nbsp;Although&nbsp;document&nbsp;was&nbsp;written&nbsp;in&nbsp;reference&nbsp;to&nbsp;sessions,&nbsp;they&nbsp;use<br>
&lt;/i&gt;&amp;gt;&lt;i&gt;&nbsp;pickle&nbsp;and&nbsp;thus&nbsp;it&nbsp;still&nbsp;applies.<br>
&lt;/i&gt;&amp;gt;&lt;i&gt;<br>
&lt;/i&gt;&amp;gt;&lt;i&gt;&nbsp;Graham<br>
&lt;/i&gt;&lt;pre&nbsp;wrap=&quot;&quot;&gt;Ok,&nbsp;that's&nbsp;a&nbsp;limitation,&nbsp;but&nbsp;I'll&nbsp;now&nbsp;I&nbsp;understand&nbsp;what&nbsp;happened&nbsp;&nbsp;!<br>
<br>
Thanks&nbsp;!<br>
<br>
Seb&lt;/pre&gt;&lt;/pre&gt;&lt;/blockquote&gt;&lt;pre&nbsp;wrap=&quot;&quot;&gt;Hello&nbsp;!<br>
<br>
I've&nbsp;found&nbsp;something&nbsp;a&nbsp;bit&nbsp;strange&nbsp;in&nbsp;mod_python&nbsp;:&nbsp;the&nbsp;pickle<br>
instruction&nbsp;doesn't&nbsp;work&nbsp;when&nbsp;we&nbsp;want&nbsp;to&nbsp;save&nbsp;classes&nbsp;(&nbsp;there&nbsp;is&nbsp;no<br>
problème&nbsp;with&nbsp;tupple&nbsp;or&nbsp;list..&nbsp;)<br>
<br>
I&nbsp;made&nbsp;this&nbsp;code&nbsp;for&nbsp;explain&nbsp;it:<br>
<br>
--&amp;gt;<br>
import&nbsp;mod_python<br>
import&nbsp;pickle<br>
<br>
#Create&nbsp;a&nbsp;very&nbsp;simple&nbsp;class&nbsp;object<br>
class&nbsp;another_class:<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;__init__(self,&nbsp;text):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.text&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br>
<br>
#Another&nbsp;one&nbsp;class<br>
class&nbsp;a_class:<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;__init__(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.elements&nbsp;=&nbsp;[]<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Add&nbsp;an&nbsp;element&nbsp;of&nbsp;the&nbsp;second&nbsp;class<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.add_entry(&quot;test&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.save()<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;add_entry(self,&nbsp;name):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.elements.append(&nbsp;another_class(name)&nbsp;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;save(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Try&nbsp;to&nbsp;save&nbsp;it&nbsp;with&nbsp;pickle..&nbsp;works&nbsp;but<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;=&nbsp;pickle.dumps(self.elements)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#We&nbsp;can't&nbsp;load&nbsp;the&nbsp;data&nbsp;after&nbsp;!<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.elements&nbsp;=&nbsp;pickle.loads(result)<br>
<br>
#If&nbsp;all&nbsp;works&nbsp;good,&nbsp;send&nbsp;a&nbsp;message<br>
def&nbsp;handler(req):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;req.write(&nbsp;'ok'&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return(mod_python.apache.OK)<br>
<br>
#We&nbsp;run&nbsp;this&nbsp;class&nbsp;outside&nbsp;any&nbsp;mod_python&nbsp;event<br>
my_class&nbsp;=&nbsp;a_class()<br>
&amp;lt;--<br>
<br>
And&nbsp;here&nbsp;is&nbsp;the&nbsp;result&nbsp;:<br>
<br>
--&amp;gt;<br>
MOD_PYTHON&nbsp;ERROR<br>
<br>
ProcessId:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5104<br>
Interpreter:&nbsp;&nbsp;&nbsp;&nbsp;'localhost.localdomain'<br>
<br>
ServerName:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'localhost.localdomain'<br>
DocumentRoot:&nbsp;&nbsp;&nbsp;'/var/www/'<br>
<br>
URI:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'/~sebastien/test/'<br>
Location:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;None<br>
Directory:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'/home/sebastien/public_html/test/'<br>
Filename:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'/home/sebastien/public_html/test/'<br>
PathInfo:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;''<br>
<br>
Phase:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'PythonHandler'<br>
Handler:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'handler'<br>
<br>
Traceback&nbsp;(most&nbsp;recent&nbsp;call&nbsp;last):<br>
<br>
&nbsp;File&nbsp;&quot;/usr/lib/python2.4/site-packages/mod_python/importer.py&quot;,&nbsp;line<br>
1537,&nbsp;in&nbsp;HandlerDispatch<br>
&nbsp;&nbsp;&nbsp;default=default_handler,&nbsp;arg=req,&nbsp;silent=hlist.silent)<br>
<br>
&nbsp;File&nbsp;&quot;/usr/lib/python2.4/site-packages/mod_python/importer.py&quot;,&nbsp;line<br>
1202,&nbsp;in&nbsp;_process_target<br>
&nbsp;&nbsp;&nbsp;module&nbsp;=&nbsp;import_module(module_name,&nbsp;path=path)<br>
<br>
&nbsp;File&nbsp;&quot;/usr/lib/python2.4/site-packages/mod_python/importer.py&quot;,&nbsp;line<br>
296,&nbsp;in&nbsp;import_module<br>
&nbsp;&nbsp;&nbsp;log,&nbsp;import_path)<br>
<br>
&nbsp;File&nbsp;&quot;/usr/lib/python2.4/site-packages/mod_python/importer.py&quot;,&nbsp;line<br>
680,&nbsp;in&nbsp;import_module<br>
&nbsp;&nbsp;&nbsp;execfile(file,&nbsp;module.__dict__)<br>
<br>
&nbsp;File&nbsp;&quot;/home/sebastien/public_html/test/handler.py&quot;,&nbsp;line&nbsp;35,&nbsp;in&nbsp;?<br>
&nbsp;&nbsp;&nbsp;my_class&nbsp;=&nbsp;a_class()<br>
<br>
&nbsp;File&nbsp;&quot;/home/sebastien/public_html/test/handler.py&quot;,&nbsp;line&nbsp;18,&nbsp;in&nbsp;__init__<br>
&nbsp;&nbsp;&nbsp;self.save()<br>
<br>
&nbsp;File&nbsp;&quot;/home/sebastien/public_html/test/handler.py&quot;,&nbsp;line&nbsp;27,&nbsp;in&nbsp;save<br>
&nbsp;&nbsp;&nbsp;self.elements&nbsp;=&nbsp;pickle.loads(result)<br>
<br>
&nbsp;File&nbsp;&quot;pickle.py&quot;,&nbsp;line&nbsp;1394,&nbsp;in&nbsp;loads<br>
&nbsp;&nbsp;&nbsp;return&nbsp;Unpickler(file).load()<br>
<br>
&nbsp;File&nbsp;&quot;pickle.py&quot;,&nbsp;line&nbsp;872,&nbsp;in&nbsp;load<br>
&nbsp;&nbsp;&nbsp;dispatch[key](self)<br>
<br>
&nbsp;File&nbsp;&quot;pickle.py&quot;,&nbsp;line&nbsp;1083,&nbsp;in&nbsp;load_inst<br>
&nbsp;&nbsp;&nbsp;klass&nbsp;=&nbsp;self.find_class(module,&nbsp;name)<br>
<br>
&nbsp;File&nbsp;&quot;pickle.py&quot;,&nbsp;line&nbsp;1138,&nbsp;in&nbsp;find_class<br>
&nbsp;&nbsp;&nbsp;__import__(module)<br>
<br>
ImportError:&nbsp;No&nbsp;module&nbsp;named&nbsp;_mp_e3b5c44c50230d33c470783bc2809f23<br>
<br>
<br>
MODULE&nbsp;CACHE&nbsp;DETAILS<br>
<br>
Accessed:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Thu&nbsp;Jun&nbsp;14&nbsp;22:49:06&nbsp;2007<br>
Generation:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3<br>
<br>
_mp_e3b5c44c50230d33c470783bc2809f23&nbsp;{<br>
&nbsp;FileName:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'/home/sebastien/public_html/test/handler.py'<br>
&nbsp;Instance:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;[RELOAD]<br>
&nbsp;Generation:&nbsp;&nbsp;&nbsp;3&nbsp;[ERROR]<br>
&nbsp;Modified:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Thu&nbsp;Jun&nbsp;14&nbsp;22:48:49&nbsp;2007<br>
&nbsp;Imported:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Thu&nbsp;Jun&nbsp;14&nbsp;22:37:06&nbsp;2007<br>
}<br>
&amp;lt;--<br>
<br>
When&nbsp;I&nbsp;launch&nbsp;this&nbsp;program&nbsp;inside&nbsp;a&nbsp;terminal,&nbsp;all&nbsp;works&nbsp;fine,&nbsp;there<br>
are&nbsp;no&nbsp;error&nbsp;message,&nbsp;so&nbsp;I&nbsp;don't&nbsp;understand&nbsp;what&nbsp;happend..<br>
<br>
&lt;/pre&gt;&lt;/blockquote&gt;&lt;/pre&gt;<br>
&lt;/pre&gt;<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
