<tt>
&lt;!DOCTYPE&nbsp;HTML&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.0&nbsp;Transitional//EN&quot;&gt;<br>
&lt;HTML&gt;&lt;HEAD&gt;<br>
&lt;META&nbsp;http-equiv=Content-Type&nbsp;content=&quot;text/html;&nbsp;charset=iso-8859-1&quot;&gt;<br>
&lt;META&nbsp;content=&quot;MSHTML&nbsp;6.00.2800.1400&quot;&nbsp;name=GENERATOR&gt;<br>
&lt;STYLE&gt;@page&nbsp;Section1&nbsp;{size:&nbsp;595.3pt&nbsp;841.9pt;&nbsp;margin:&nbsp;72.0pt&nbsp;90.0pt&nbsp;72.0pt&nbsp;90.0pt;&nbsp;}<br>
P.MsoNormal&nbsp;{<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspFONT-SIZE:&nbsp;12pt;&nbsp;MARGIN:&nbsp;6pt&nbsp;0cm&nbsp;0pt;&nbsp;FONT-FAMILY:&nbsp;&quot;Times&nbsp;New&nbsp;Roman&quot;<br>
}<br>
LI.MsoNormal&nbsp;{<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspFONT-SIZE:&nbsp;12pt;&nbsp;MARGIN:&nbsp;6pt&nbsp;0cm&nbsp;0pt;&nbsp;FONT-FAMILY:&nbsp;&quot;Times&nbsp;New&nbsp;Roman&quot;<br>
}<br>
DIV.MsoNormal&nbsp;{<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspFONT-SIZE:&nbsp;12pt;&nbsp;MARGIN:&nbsp;6pt&nbsp;0cm&nbsp;0pt;&nbsp;FONT-FAMILY:&nbsp;&quot;Times&nbsp;New&nbsp;Roman&quot;<br>
}<br>
H1&nbsp;{<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspFONT-SIZE:&nbsp;24pt;&nbsp;MARGIN-BOTTOM:&nbsp;12pt;&nbsp;PAGE-BREAK-BEFORE:&nbsp;always;&nbsp;MARGIN-LEFT:&nbsp;18pt;&nbsp;TEXT-INDENT:&nbsp;-18pt;&nbsp;MARGIN-RIGHT:&nbsp;0cm;&nbsp;FONT-FAMILY:&nbsp;&quot;Times&nbsp;New&nbsp;Roman&quot;<br>
}<br>
H1.CxSpFirst&nbsp;{<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspFONT-SIZE:&nbsp;24pt;&nbsp;MARGIN-BOTTOM:&nbsp;0pt;&nbsp;PAGE-BREAK-BEFORE:&nbsp;always;&nbsp;MARGIN-LEFT:&nbsp;18pt;&nbsp;TEXT-INDENT:&nbsp;-18pt;&nbsp;MARGIN-RIGHT:&nbsp;0cm;&nbsp;FONT-FAMILY:&nbsp;&quot;Times&nbsp;New&nbsp;Roman&quot;<br>
}<br>
H1.CxSpMiddle&nbsp;{<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspFONT-SIZE:&nbsp;24pt;&nbsp;MARGIN-BOTTOM:&nbsp;0pt;&nbsp;PAGE-BREAK-BEFORE:&nbsp;always;&nbsp;MARGIN-LEFT:&nbsp;18pt;&nbsp;TEXT-INDENT:&nbsp;-18pt;&nbsp;MARGIN-RIGHT:&nbsp;0cm;&nbsp;FONT-FAMILY:&nbsp;&quot;Times&nbsp;New&nbsp;Roman&quot;<br>
}<br>
H1.CxSpLast&nbsp;{<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspFONT-SIZE:&nbsp;24pt;&nbsp;MARGIN-BOTTOM:&nbsp;12pt;&nbsp;PAGE-BREAK-BEFORE:&nbsp;always;&nbsp;MARGIN-LEFT:&nbsp;18pt;&nbsp;TEXT-INDENT:&nbsp;-18pt;&nbsp;MARGIN-RIGHT:&nbsp;0cm;&nbsp;FONT-FAMILY:&nbsp;&quot;Times&nbsp;New&nbsp;Roman&quot;<br>
}<br>
H4&nbsp;{<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspFONT-SIZE:&nbsp;12pt;&nbsp;MARGIN-LEFT:&nbsp;53.85pt;&nbsp;MARGIN-RIGHT:&nbsp;0cm;&nbsp;FONT-FAMILY:&nbsp;&quot;Times&nbsp;New&nbsp;Roman&quot;<br>
}<br>
H5&nbsp;{<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspFONT-SIZE:&nbsp;10pt;&nbsp;MARGIN-LEFT:&nbsp;71.75pt;&nbsp;MARGIN-RIGHT:&nbsp;0cm;&nbsp;FONT-FAMILY:&nbsp;&quot;Times&nbsp;New&nbsp;Roman&quot;<br>
}<br>
A:link&nbsp;{<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspCOLOR:&nbsp;blue;&nbsp;TEXT-DECORATION:&nbsp;underline<br>
}<br>
SPAN.MsoHyperlink&nbsp;{<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspCOLOR:&nbsp;blue;&nbsp;TEXT-DECORATION:&nbsp;underline<br>
}<br>
A:visited&nbsp;{<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspCOLOR:&nbsp;purple;&nbsp;TEXT-DECORATION:&nbsp;underline<br>
}<br>
SPAN.MsoHyperlinkFollowed&nbsp;{<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspCOLOR:&nbsp;purple;&nbsp;TEXT-DECORATION:&nbsp;underline<br>
}<br>
P.StyleHeading4Left127cm&nbsp;{<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspFONT-WEIGHT:&nbsp;bold;&nbsp;FONT-SIZE:&nbsp;12pt;&nbsp;MARGIN-LEFT:&nbsp;53.85pt;&nbsp;MARGIN-RIGHT:&nbsp;0cm;&nbsp;FONT-FAMILY:&nbsp;&quot;Times&nbsp;New&nbsp;Roman&quot;<br>
}<br>
LI.StyleHeading4Left127cm&nbsp;{<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspFONT-WEIGHT:&nbsp;bold;&nbsp;FONT-SIZE:&nbsp;12pt;&nbsp;MARGIN-LEFT:&nbsp;53.85pt;&nbsp;MARGIN-RIGHT:&nbsp;0cm;&nbsp;FONT-FAMILY:&nbsp;&quot;Times&nbsp;New&nbsp;Roman&quot;<br>
}<br>
DIV.StyleHeading4Left127cm&nbsp;{<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspFONT-WEIGHT:&nbsp;bold;&nbsp;FONT-SIZE:&nbsp;12pt;&nbsp;MARGIN-LEFT:&nbsp;53.85pt;&nbsp;MARGIN-RIGHT:&nbsp;0cm;&nbsp;FONT-FAMILY:&nbsp;&quot;Times&nbsp;New&nbsp;Roman&quot;<br>
}<br>
SPAN.EmailStyle18&nbsp;{<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspCOLOR:&nbsp;windowtext;&nbsp;FONT-FAMILY:&nbsp;Arial<br>
}<br>
DIV.Section1&nbsp;{<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsppage:&nbsp;Section1<br>
}<br>
OL&nbsp;{<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspMARGIN-BOTTOM:&nbsp;0cm<br>
}<br>
UL&nbsp;{<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspMARGIN-BOTTOM:&nbsp;0cm<br>
}<br>
&lt;/STYLE&gt;<br>
&lt;/HEAD&gt;<br>
&lt;BODY&nbsp;lang=EN-GB&nbsp;vLink=purple&nbsp;link=blue&gt;<br>
&lt;DIV&nbsp;dir=ltr&nbsp;align=left&gt;&lt;FONT&nbsp;size=2&gt;<br>
&lt;P&gt;Hi&nbsp;Ian,&lt;/P&gt;<br>
&lt;P&gt;&lt;/P&gt;<br>
&lt;P&gt;You&nbsp;can&nbsp;also&nbsp;use&nbsp;the&nbsp;standard&nbsp;&quot;thread&quot;&nbsp;or&nbsp;&quot;threading&quot;&nbsp;Python&nbsp;modules,&nbsp;so&nbsp;that&nbsp;<br>
you&nbsp;don't&nbsp;depend&nbsp;on&nbsp;_apache.&lt;/P&gt;<br>
&lt;P&gt;&lt;/P&gt;<br>
&lt;P&gt;The&nbsp;approach&nbsp;you&nbsp;have&nbsp;is&nbsp;secure&nbsp;but&nbsp;it&nbsp;has&nbsp;the&nbsp;downside&nbsp;of&nbsp;denying&nbsp;any&nbsp;<br>
concurrent&nbsp;access&nbsp;to&nbsp;the&nbsp;database&nbsp;(if&nbsp;I&nbsp;understand&nbsp;your&nbsp;code&nbsp;correctly).&nbsp;I&nbsp;don't&nbsp;<br>
know&nbsp;SQLite&nbsp;very&nbsp;much,&nbsp;but&nbsp;it&nbsp;seems&nbsp;that&nbsp;it&nbsp;can&nbsp;handle&nbsp;multithreaded&nbsp;access&nbsp;to&nbsp;<br>
the&nbsp;database&nbsp;(see&nbsp;&lt;/FONT&gt;&lt;A&nbsp;href=&quot;http://www.sqlite.org/lockingv3.html&quot;&gt;&lt;U&gt;&lt;FONT&nbsp;<br>
color=#0000ff&nbsp;size=2&gt;http://www.sqlite.org/lockingv3.html&lt;/U&gt;&lt;/FONT&gt;&lt;/A&gt;&lt;FONT&nbsp;<br>
size=2&gt;),&nbsp;so&nbsp;it&nbsp;would&nbsp;be&nbsp;better&nbsp;to&nbsp;leverage&nbsp;this.&nbsp;The&nbsp;solution&nbsp;is&nbsp;a&nbsp;connection&nbsp;<br>
pool.&lt;/FONT&gt;&lt;/P&gt;<br>
&lt;P&gt;&lt;FONT&nbsp;size=2&gt;&lt;/FONT&gt;&lt;/P&gt;<br>
&lt;P&gt;&lt;FONT&nbsp;size=2&gt;You&nbsp;can&nbsp;write&nbsp;a&nbsp;connection&nbsp;pool&nbsp;using&nbsp;the&nbsp;threading.RLock&nbsp;and&nbsp;<br>
threading.Condition&nbsp;to&nbsp;protect&nbsp;the&nbsp;critical&nbsp;sections,&nbsp;namely&nbsp;the&nbsp;acquisition&nbsp;of&nbsp;<br>
database&nbsp;connections.&nbsp;The&nbsp;end&nbsp;result&nbsp;is&nbsp;that&nbsp;each&nbsp;thread&nbsp;is&nbsp;guaranteed&nbsp;to&nbsp;have&nbsp;a&nbsp;<br>
connection&nbsp;of&nbsp;its&nbsp;own,&nbsp;which&nbsp;can&nbsp;be&nbsp;reused&nbsp;as&nbsp;soon&nbsp;the&nbsp;thread&nbsp;release&nbsp;it&nbsp;to&nbsp;the&nbsp;<br>
pool.&nbsp;It&nbsp;usually&nbsp;speeds&nbsp;things&nbsp;up,&nbsp;and&nbsp;I&nbsp;guess&nbsp;it&nbsp;would&nbsp;be&nbsp;especially&nbsp;useful&nbsp;<br>
with&nbsp;SQLite.&nbsp;I've&nbsp;been&nbsp;using&nbsp;such&nbsp;a&nbsp;connection&nbsp;pool&nbsp;for&nbsp;a&nbsp;few&nbsp;months&nbsp;now&nbsp;and&nbsp;<br>
have&nbsp;never&nbsp;looked&nbsp;back&nbsp;since.&nbsp;In&nbsp;your&nbsp;case,&nbsp;it&nbsp;seems&nbsp;that&nbsp;you&nbsp;wrap&nbsp;the&nbsp;SQLite&nbsp;<br>
connection&nbsp;with&nbsp;an&nbsp;UserDatabase&nbsp;object,&nbsp;so&nbsp;maybe&amp;nbsp;&lt;SPAN&nbsp;<br>
class=221363108-07072004&gt;you&nbsp;should&nbsp;pool&nbsp;UserDatabase&nbsp;instances&nbsp;instead&nbsp;of&nbsp;<br>
SQLite&nbsp;connections.&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/P&gt;<br>
&lt;P&gt;&lt;FONT&nbsp;size=2&gt;&lt;/FONT&gt;&lt;/P&gt;<br>
&lt;P&gt;&lt;FONT&nbsp;size=2&gt;Best&nbsp;regards,&lt;/FONT&gt;&lt;/P&gt;<br>
&lt;P&gt;&lt;FONT&nbsp;size=2&gt;&lt;/FONT&gt;&lt;/P&gt;<br>
&lt;P&gt;&lt;FONT&nbsp;size=2&gt;Nicolas&nbsp;Lehuen&lt;/FONT&gt;&lt;/P&gt;&lt;/DIV&gt;&lt;BR&gt;<br>
&lt;BLOCKQUOTE&nbsp;dir=ltr&nbsp;<br>
style=&quot;PADDING-LEFT:&nbsp;5px;&nbsp;MARGIN-LEFT:&nbsp;5px;&nbsp;BORDER-LEFT:&nbsp;#0000ff&nbsp;2px&nbsp;solid;&nbsp;MARGIN-RIGHT:&nbsp;0px&quot;&gt;<br>
&nbsp;&nbsp;&lt;DIV&nbsp;class=OutlookMessageHeader&nbsp;lang=fr&nbsp;dir=ltr&nbsp;align=left&gt;<br>
&nbsp;&nbsp;&lt;HR&nbsp;tabIndex=-1&gt;<br>
&nbsp;&nbsp;&lt;FONT&nbsp;face=Tahoma&nbsp;size=2&gt;&lt;B&gt;De&amp;nbsp;:&lt;/B&gt;&nbsp;mod_python-bounces@modpython.org&nbsp;<br>
&nbsp;&nbsp;[mailto:mod_python-bounces@modpython.org]&nbsp;&lt;B&gt;De&nbsp;la&nbsp;part&nbsp;de&lt;/B&gt;&nbsp;Iain&nbsp;<br>
&nbsp;&nbsp;Mackay&lt;BR&gt;&lt;B&gt;Envoyé&amp;nbsp;:&lt;/B&gt;&nbsp;mardi&nbsp;6&nbsp;juillet&nbsp;2004&nbsp;21:18&lt;BR&gt;&lt;B&gt;À&amp;nbsp;:&lt;/B&gt;&nbsp;<br>
&nbsp;&nbsp;mod_python@modpython.org&lt;BR&gt;&lt;B&gt;Objet&amp;nbsp;:&lt;/B&gt;&nbsp;[mod_python]&nbsp;Apache&nbsp;on&nbsp;Windows&nbsp;<br>
&nbsp;&nbsp;and&nbsp;concurrency&lt;BR&gt;&lt;/FONT&gt;&lt;BR&gt;&lt;/DIV&gt;<br>
&nbsp;&nbsp;&lt;DIV&gt;&lt;/DIV&gt;<br>
&nbsp;&nbsp;&lt;DIV&nbsp;class=Section1&gt;<br>
&nbsp;&nbsp;&lt;P&nbsp;class=MsoNormal&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
&nbsp;&nbsp;style=&quot;FONT-SIZE:&nbsp;10pt;&nbsp;FONT-FAMILY:&nbsp;Arial&quot;&gt;Thanks&nbsp;Grisha&nbsp;for&nbsp;being&nbsp;so&nbsp;quickly&nbsp;<br>
&nbsp;&nbsp;on&nbsp;the&nbsp;case.&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/P&gt;<br>
&nbsp;&nbsp;&lt;P&nbsp;class=MsoNormal&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
&nbsp;&nbsp;style=&quot;FONT-SIZE:&nbsp;10pt;&nbsp;FONT-FAMILY:&nbsp;Arial&quot;&gt;Session.py&nbsp;also&nbsp;includes&nbsp;the&nbsp;<br>
&nbsp;&nbsp;solution&nbsp;to&nbsp;my&nbsp;problem,&nbsp;using&nbsp;the&nbsp;Apache&nbsp;global&nbsp;locks.&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/P&gt;<br>
&nbsp;&nbsp;&lt;P&nbsp;class=MsoNormal&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
&nbsp;&nbsp;style=&quot;FONT-SIZE:&nbsp;10pt;&nbsp;FONT-FAMILY:&nbsp;Arial&quot;&gt;I&nbsp;now&nbsp;have&nbsp;the&nbsp;following&nbsp;code&nbsp;to&nbsp;<br>
&nbsp;&nbsp;protect&nbsp;a&nbsp;section&nbsp;of&nbsp;&amp;nbsp;script&nbsp;that&nbsp;is&nbsp;using&nbsp;the&nbsp;database&nbsp;connection&nbsp;(it&nbsp;<br>
&nbsp;&nbsp;uses&nbsp;SQLite&nbsp;but&nbsp;would&nbsp;apply&nbsp;mutatis&nbsp;mutandis&nbsp;to&nbsp;another&nbsp;database).&nbsp;I&nbsp;have&nbsp;<br>
&nbsp;&nbsp;restored&nbsp;multi-threading&nbsp;and&nbsp;all&nbsp;works&nbsp;smoothly.&nbsp;&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/P&gt;<br>
&nbsp;&nbsp;&lt;P&nbsp;class=MsoNormal&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
&nbsp;&nbsp;style=&quot;FONT-SIZE:&nbsp;10pt;&nbsp;FONT-FAMILY:&nbsp;Arial&quot;&gt;If&nbsp;this&nbsp;is&nbsp;the&nbsp;best&nbsp;way&nbsp;to&nbsp;do&nbsp;<br>
&nbsp;&nbsp;this,&nbsp;it&nbsp;might&nbsp;be&nbsp;worth&nbsp;a&nbsp;mention&nbsp;in&nbsp;the&nbsp;next&nbsp;release&nbsp;of&nbsp;the&nbsp;documentation.&nbsp;I&nbsp;<br>
&nbsp;&nbsp;suppose&nbsp;ideally&nbsp;application&nbsp;code&nbsp;shouldn’t&nbsp;use&nbsp;_apache.&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/P&gt;<br>
&nbsp;&nbsp;&lt;P&nbsp;class=MsoNormal&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
&nbsp;&nbsp;style=&quot;FONT-SIZE:&nbsp;10pt;&nbsp;FONT-FAMILY:&nbsp;Arial&quot;&gt;from&nbsp;mod_python&nbsp;import&nbsp;<br>
&nbsp;&nbsp;apache&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/P&gt;<br>
&nbsp;&nbsp;&lt;P&nbsp;class=MsoNormal&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
&nbsp;&nbsp;style=&quot;FONT-SIZE:&nbsp;10pt;&nbsp;FONT-FAMILY:&nbsp;Arial&quot;&gt;import&nbsp;_apache&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/P&gt;<br>
&nbsp;&nbsp;&lt;P&nbsp;class=MsoNormal&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
&nbsp;&nbsp;style=&quot;FONT-SIZE:&nbsp;10pt;&nbsp;FONT-FAMILY:&nbsp;Arial&quot;&gt;import&nbsp;re&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/P&gt;<br>
&nbsp;&nbsp;&lt;P&nbsp;class=MsoNormal&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
&nbsp;&nbsp;style=&quot;FONT-SIZE:&nbsp;10pt;&nbsp;FONT-FAMILY:&nbsp;Arial&quot;&gt;import&nbsp;sqlite&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/P&gt;<br>
&nbsp;&nbsp;&lt;P&nbsp;class=MsoNormal&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
&nbsp;&nbsp;style=&quot;FONT-SIZE:&nbsp;10pt;&nbsp;FONT-FAMILY:&nbsp;Arial&quot;&gt;import&nbsp;<br>
&nbsp;&nbsp;userdatabase&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/P&gt;<br>
&nbsp;&nbsp;&lt;P&nbsp;class=MsoNormal&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
&nbsp;&nbsp;style=&quot;FONT-SIZE:&nbsp;10pt;&nbsp;FONT-FAMILY:&nbsp;Arial&quot;&gt;import&nbsp;sys&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/P&gt;<br>
&nbsp;&nbsp;&lt;P&nbsp;class=MsoNormal&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
&nbsp;&nbsp;style=&quot;FONT-SIZE:&nbsp;10pt;&nbsp;FONT-FAMILY:&nbsp;Arial&quot;&gt;&lt;/SPAN&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/P&gt;<br>
&nbsp;&nbsp;&lt;P&nbsp;class=MsoNormal&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
&nbsp;&nbsp;style=&quot;FONT-SIZE:&nbsp;10pt;&nbsp;FONT-FAMILY:&nbsp;Arial&quot;&gt;users&nbsp;=&nbsp;None&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/P&gt;<br>
&nbsp;&nbsp;&lt;P&nbsp;class=MsoNormal&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
&nbsp;&nbsp;style=&quot;FONT-SIZE:&nbsp;10pt;&nbsp;FONT-FAMILY:&nbsp;Arial&quot;&gt;apache.log_error&nbsp;(&quot;userHandler&nbsp;<br>
&nbsp;&nbsp;initialising&quot;,&nbsp;apache.APLOG_INFO)&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/P&gt;<br>
&nbsp;&nbsp;&lt;P&nbsp;class=MsoNormal&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
&nbsp;&nbsp;style=&quot;FONT-SIZE:&nbsp;10pt;&nbsp;FONT-FAMILY:&nbsp;Arial&quot;&gt;&lt;/SPAN&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/P&gt;<br>
&nbsp;&nbsp;&lt;P&nbsp;class=MsoNormal&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
&nbsp;&nbsp;style=&quot;FONT-SIZE:&nbsp;10pt;&nbsp;FONT-FAMILY:&nbsp;Arial&quot;&gt;def&nbsp;beginDB&nbsp;<br>
&nbsp;&nbsp;(req):&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/P&gt;<br>
&nbsp;&nbsp;&lt;P&nbsp;class=MsoNormal&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
&nbsp;&nbsp;style=&quot;FONT-SIZE:&nbsp;10pt;&nbsp;FONT-FAMILY:&nbsp;Arial&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
&nbsp;&nbsp;_apache._global_lock(req.server,&nbsp;None,&nbsp;0)&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/P&gt;<br>
&nbsp;&nbsp;&lt;P&nbsp;class=MsoNormal&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
&nbsp;&nbsp;style=&quot;FONT-SIZE:&nbsp;10pt;&nbsp;FONT-FAMILY:&nbsp;Arial&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
&nbsp;&nbsp;global&nbsp;users&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/P&gt;<br>
&nbsp;&nbsp;&lt;P&nbsp;class=MsoNormal&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
&nbsp;&nbsp;style=&quot;FONT-SIZE:&nbsp;10pt;&nbsp;FONT-FAMILY:&nbsp;Arial&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
&nbsp;&nbsp;if&nbsp;not&nbsp;users:&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/P&gt;<br>
&nbsp;&nbsp;&lt;P&nbsp;class=MsoNormal&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
&nbsp;&nbsp;style=&quot;FONT-SIZE:&nbsp;10pt;&nbsp;FONT-FAMILY:&nbsp;Arial&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
&nbsp;&nbsp;try:&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/P&gt;<br>
&nbsp;&nbsp;&lt;P&nbsp;class=MsoNormal&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
&nbsp;&nbsp;style=&quot;FONT-SIZE:&nbsp;10pt;&nbsp;FONT-FAMILY:&nbsp;Arial&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
&nbsp;&nbsp;try:&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/P&gt;<br>
&nbsp;&nbsp;&lt;P&nbsp;class=MsoNormal&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
&nbsp;&nbsp;style=&quot;FONT-SIZE:&nbsp;10pt;&nbsp;FONT-FAMILY:&nbsp;Arial&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
&nbsp;&nbsp;defaultUser&nbsp;=&nbsp;req.get_options&nbsp;()[&quot;defaultUser&quot;]&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/P&gt;<br>
&nbsp;&nbsp;&lt;P&nbsp;class=MsoNormal&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
&nbsp;&nbsp;style=&quot;FONT-SIZE:&nbsp;10pt;&nbsp;FONT-FAMILY:&nbsp;Arial&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
&nbsp;&nbsp;except:&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/P&gt;<br>
&nbsp;&nbsp;&lt;P&nbsp;class=MsoNormal&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
&nbsp;&nbsp;style=&quot;FONT-SIZE:&nbsp;10pt;&nbsp;FONT-FAMILY:&nbsp;Arial&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
&nbsp;&nbsp;defaultUser&nbsp;=&nbsp;&quot;guest&quot;&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/P&gt;<br>
&nbsp;&nbsp;&lt;P&nbsp;class=MsoNormal&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
&nbsp;&nbsp;style=&quot;FONT-SIZE:&nbsp;10pt;&nbsp;FONT-FAMILY:&nbsp;Arial&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
&nbsp;&nbsp;users&nbsp;=&nbsp;userdatabase.UserDatabase\&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/P&gt;<br>
&nbsp;&nbsp;&lt;P&nbsp;class=MsoNormal&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
&nbsp;&nbsp;style=&quot;FONT-SIZE:&nbsp;10pt;&nbsp;FONT-FAMILY:&nbsp;Arial&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
&nbsp;&nbsp;(sqlite.connect&nbsp;(req.get_options&nbsp;()[&quot;dbFile&quot;],&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/P&gt;<br>
&nbsp;&nbsp;&lt;P&nbsp;class=MsoNormal&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
&nbsp;&nbsp;style=&quot;FONT-SIZE:&nbsp;10pt;&nbsp;FONT-FAMILY:&nbsp;Arial&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
&nbsp;&nbsp;077,&nbsp;autocommit=1),&nbsp;defaultUser)&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/P&gt;<br>
&nbsp;&nbsp;&lt;P&nbsp;class=MsoNormal&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
&nbsp;&nbsp;style=&quot;FONT-SIZE:&nbsp;10pt;&nbsp;FONT-FAMILY:&nbsp;Arial&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
&nbsp;&nbsp;except:&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/P&gt;<br>
&nbsp;&nbsp;&lt;P&nbsp;class=MsoNormal&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
&nbsp;&nbsp;style=&quot;FONT-SIZE:&nbsp;10pt;&nbsp;FONT-FAMILY:&nbsp;Arial&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
&nbsp;&nbsp;(type,&nbsp;value,&nbsp;tb)&nbsp;=&nbsp;sys.exc_info()&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/P&gt;<br>
&nbsp;&nbsp;&lt;P&nbsp;class=MsoNormal&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
&nbsp;&nbsp;style=&quot;FONT-SIZE:&nbsp;10pt;&nbsp;FONT-FAMILY:&nbsp;Arial&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
&nbsp;&nbsp;apache.log_error&nbsp;(&quot;Cannot&nbsp;access&nbsp;user&nbsp;database:&nbsp;%s&nbsp;(%s)&quot;&nbsp;%&nbsp;(type,&nbsp;<br>
&nbsp;&nbsp;value),&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/P&gt;<br>
&nbsp;&nbsp;&lt;P&nbsp;class=MsoNormal&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
&nbsp;&nbsp;style=&quot;FONT-SIZE:&nbsp;10pt;&nbsp;FONT-FAMILY:&nbsp;Arial&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
&nbsp;&nbsp;apache.APLOG_ERR)&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/P&gt;<br>
&nbsp;&nbsp;&lt;P&nbsp;class=MsoNormal&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
&nbsp;&nbsp;style=&quot;FONT-SIZE:&nbsp;10pt;&nbsp;FONT-FAMILY:&nbsp;Arial&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
&nbsp;&nbsp;&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/P&gt;<br>
&nbsp;&nbsp;&lt;P&nbsp;class=MsoNormal&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
&nbsp;&nbsp;style=&quot;FONT-SIZE:&nbsp;10pt;&nbsp;FONT-FAMILY:&nbsp;Arial&quot;&gt;def&nbsp;endDB&nbsp;(req):&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/P&gt;<br>
&nbsp;&nbsp;&lt;P&nbsp;class=MsoNormal&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
&nbsp;&nbsp;style=&quot;FONT-SIZE:&nbsp;10pt;&nbsp;FONT-FAMILY:&nbsp;Arial&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
&nbsp;&nbsp;_apache._global_unlock(req.server,&nbsp;None,&nbsp;0)&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/P&gt;<br>
&nbsp;&nbsp;&lt;P&nbsp;class=MsoNormal&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
&nbsp;&nbsp;style=&quot;FONT-SIZE:&nbsp;10pt;&nbsp;FONT-FAMILY:&nbsp;Arial&quot;&gt;&lt;/SPAN&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/P&gt;&lt;/DIV&gt;&lt;/BLOCKQUOTE&gt;&lt;/BODY&gt;&lt;/HTML&gt;<br>

</tt>
