<tt>
<br>
&lt;br&gt;&lt;font&nbsp;size=2&nbsp;face=&quot;sans-serif&quot;&gt;In&nbsp;php&nbsp;gzipping&nbsp;the&nbsp;pages&nbsp;is&nbsp;fairly&nbsp;trivial.&nbsp;Include&nbsp;this&nbsp;in&nbsp;the&nbsp;file&lt;/font&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;font&nbsp;size=2&nbsp;face=&quot;sans-serif&quot;&gt;&amp;lt;?php&nbsp;ob_start(&amp;quot;ob_gzhandler&amp;quot;);&nbsp;?&amp;gt;&lt;br&gt;<br>
&lt;/font&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;font&nbsp;size=2&nbsp;face=&quot;sans-serif&quot;&gt;Alan&nbsp;Kennedy&nbsp;has&nbsp;a&nbsp;faq&nbsp;for&nbsp;mod_python.&lt;/font&gt;<br>
&lt;br&gt;&lt;font&nbsp;size=2&nbsp;face=&quot;sans-serif&quot;&gt;http://www.xhaus.com/alan/python/httpcomp.html#gzip&lt;/font&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;font&nbsp;size=2&nbsp;face=&quot;sans-serif&quot;&gt;Grisha&nbsp;-&nbsp;It&nbsp;would&nbsp;be&nbsp;nice&nbsp;to&nbsp;include&nbsp;something&nbsp;closer&nbsp;to&nbsp;the&nbsp;php&nbsp;version&nbsp;in&nbsp;the&nbsp;included&nbsp;libraries.&lt;/font&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;font&nbsp;size=2&nbsp;face=&quot;sans-serif&quot;&gt;Anthony&lt;/font&gt;<br>
&lt;br&gt;&lt;font&nbsp;size=3&nbsp;face=&quot;Courier&nbsp;New&quot;&gt;--------------------------------------------------------------&lt;br&gt;<br>
import&nbsp;string&lt;br&gt;<br>
import&nbsp;os&lt;br&gt;<br>
import&nbsp;sys&lt;br&gt;<br>
import&nbsp;gzip&lt;br&gt;<br>
import&nbsp;cStringIO&lt;br&gt;<br>
from&nbsp;&amp;nbsp;&nbsp;mod_python&nbsp;import&nbsp;apache&lt;br&gt;<br>
&lt;br&gt;<br>
def&nbsp;compressBuf(buf):&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;zbuf&nbsp;=&nbsp;cStringIO.StringIO()&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;zfile&nbsp;=&nbsp;gzip.GzipFile(mode&nbsp;=&nbsp;'wb',&nbsp;&amp;nbsp;fileobj&nbsp;=&nbsp;zbuf,&nbsp;compresslevel&nbsp;=&nbsp;6)&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;zfile.write(buf)&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;zfile.close()&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;return&nbsp;zbuf.getvalue()&lt;br&gt;<br>
&lt;br&gt;<br>
def&nbsp;testAcceptsGzip(req):&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;if&nbsp;req.headers_in.has_key('accept-encoding'):&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;encodings&nbsp;=&nbsp;req.headers_in['accept-encoding']&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;return&nbsp;(string.find(encodings,&nbsp;&amp;quot;gzip&amp;quot;)&nbsp;!=&nbsp;-1)&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;else:&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;return&nbsp;0&lt;br&gt;<br>
&lt;br&gt;<br>
def&nbsp;handler(req):&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;req.content_type&nbsp;=&nbsp;&amp;quot;text/html&amp;quot;&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;myHtml&nbsp;=&nbsp;&amp;quot;&amp;quot;&amp;quot;&amp;lt;html&amp;gt;&amp;lt;body&amp;gt;&amp;lt;h1&amp;gt;hello&nbsp;compressed&nbsp;world!&amp;lt;/h1&amp;gt;&amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt;&amp;quot;&amp;quot;&amp;quot;&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;if&nbsp;testAcceptsGzip(req):&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;zbuf&nbsp;=&nbsp;compressBuf(myHtml)&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;req.headers_out['Content-Encoding']&nbsp;=&nbsp;'gzip'&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;req.headers_out['Content-Length']&nbsp;=&nbsp;'%d'&nbsp;%&nbsp;(len(zbuf))&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;req.send_http_header()&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;req.write(zbuf)&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;else:&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;req.send_http_header()&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;req.write(myHtml)&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;return&nbsp;apache.OK&lt;br&gt;<br>
#--------------------------------------------------------------&lt;/font&gt;
</tt>
