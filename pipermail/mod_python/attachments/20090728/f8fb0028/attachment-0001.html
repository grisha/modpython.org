<tt>
&lt;!DOCTYPE&nbsp;HTML&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.0&nbsp;Transitional//EN&quot;&gt;<br>
&lt;HTML&gt;&lt;HEAD&gt;<br>
&lt;META&nbsp;http-equiv=Content-Type&nbsp;content=&quot;text/html;&nbsp;charset=us-ascii&quot;&gt;<br>
&lt;META&nbsp;content=&quot;MSHTML&nbsp;6.00.2900.5512&quot;&nbsp;name=GENERATOR&gt;&lt;/HEAD&gt;<br>
&lt;BODY&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=108512715-28072009&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;Hi&nbsp;<br>
all,&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=108512715-28072009&gt;&lt;FONT&nbsp;face=Arial&nbsp;<br>
size=2&gt;&lt;/FONT&gt;&lt;/SPAN&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=108512715-28072009&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;I&nbsp;was&nbsp;intending&nbsp;to&nbsp;<br>
post&nbsp;this&nbsp;to&nbsp;the&nbsp;-dev&nbsp;list,&nbsp;but&nbsp;it&nbsp;appears&nbsp;to&nbsp;have&nbsp;moved&nbsp;somewhere&nbsp;I&nbsp;cannot&nbsp;find&nbsp;<br>
it,&nbsp;so&nbsp;hopefully&nbsp;this&nbsp;email&nbsp;will&nbsp;find&nbsp;the&nbsp;right&nbsp;eyes.&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=108512715-28072009&gt;&lt;FONT&nbsp;face=Arial&nbsp;<br>
size=2&gt;&lt;/FONT&gt;&lt;/SPAN&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=108512715-28072009&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;I&nbsp;recently&nbsp;upgraded&nbsp;<br>
our&nbsp;mod_python&nbsp;from&nbsp;an&nbsp;old&nbsp;version&nbsp;(circa&nbsp;2004)&nbsp;to&nbsp;the&nbsp;latest&nbsp;and&nbsp;greatest&nbsp;<br>
Ubuntu&nbsp;had&nbsp;to&nbsp;offer,&nbsp;and&nbsp;unfortunately&nbsp;this&nbsp;caused&nbsp;a&nbsp;bit&nbsp;of&nbsp;a&nbsp;regression&nbsp;in&nbsp;our&nbsp;<br>
system.&nbsp;We&nbsp;have&nbsp;to&nbsp;interface&nbsp;with&nbsp;a&nbsp;rather&nbsp;obscure&nbsp;client,&nbsp;which&nbsp;sends&nbsp;its&nbsp;data&nbsp;<br>
through&nbsp;a&nbsp;HTTP&nbsp;POST&nbsp;request&nbsp;as&nbsp;a&nbsp;multipart&nbsp;message&nbsp;separated&nbsp;nicely&nbsp;with&nbsp;<br>
boundaries,&nbsp;but&nbsp;which&nbsp;&lt;EM&gt;does&nbsp;not&nbsp;add&nbsp;a&nbsp;new&nbsp;line&nbsp;or&nbsp;carriage&nbsp;return&amp;nbsp;after&nbsp;<br>
the&nbsp;final&nbsp;boundary&lt;/EM&gt;.&nbsp;I&nbsp;am&nbsp;not&nbsp;sure&nbsp;whether&nbsp;this&nbsp;is&nbsp;permitted&nbsp;in&nbsp;the&nbsp;<br>
standard,&nbsp;but&nbsp;it&nbsp;worked&nbsp;in&nbsp;the&nbsp;old&nbsp;version&nbsp;-&nbsp;I&nbsp;think&nbsp;some&nbsp;changes&nbsp;to&nbsp;improve&nbsp;<br>
multi-line&nbsp;handling&nbsp;(adding&nbsp;the&nbsp;use&nbsp;of&nbsp;a&nbsp;boundary&nbsp;regex)&nbsp;upset&nbsp;<br>
this.&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=108512715-28072009&gt;&lt;FONT&nbsp;face=Arial&nbsp;<br>
size=2&gt;&lt;/FONT&gt;&lt;/SPAN&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=108512715-28072009&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;I&nbsp;have&nbsp;a&nbsp;very&nbsp;small&nbsp;<br>
patch&nbsp;for&nbsp;util.py&nbsp;which&nbsp;fixes&nbsp;this&nbsp;on&nbsp;my&nbsp;end,&nbsp;and&nbsp;I&nbsp;think&nbsp;should&nbsp;be&nbsp;benign.&nbsp;If&nbsp;<br>
someone&nbsp;in&nbsp;the&nbsp;know&nbsp;would&nbsp;like&nbsp;to&nbsp;check&nbsp;it&nbsp;won't&nbsp;have&nbsp;any&nbsp;unintended&nbsp;side&nbsp;<br>
effects,&nbsp;it&nbsp;would&nbsp;be&nbsp;great&nbsp;to&nbsp;stick&nbsp;it&nbsp;in&nbsp;the&nbsp;tree;&nbsp;perhaps&nbsp;there&nbsp;are&nbsp;some&nbsp;more&nbsp;<br>
obscure&nbsp;clients&nbsp;that&nbsp;do&nbsp;this&nbsp;as&nbsp;well?&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=108512715-28072009&gt;&lt;FONT&nbsp;face=Arial&nbsp;<br>
size=2&gt;&lt;/FONT&gt;&lt;/SPAN&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;BLOCKQUOTE&nbsp;dir=ltr&nbsp;style=&quot;MARGIN-RIGHT:&nbsp;0px&quot;&gt;<br>
&nbsp;&nbsp;&lt;DIV&gt;&lt;SPAN&nbsp;class=108512715-28072009&gt;&lt;FONT&nbsp;face=&quot;Courier&nbsp;New&quot;&nbsp;size=2&gt;---&nbsp;<br>
&nbsp;&nbsp;util.py.orig&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;2009-07-28&nbsp;<br>
&nbsp;&nbsp;16:08:00.000000000&nbsp;+0100&lt;BR&gt;+++&nbsp;util.py&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;2009-07-28&nbsp;<br>
&nbsp;&nbsp;16:08:19.000000000&nbsp;+0100&lt;BR&gt;@@&nbsp;-237,7&nbsp;+237,7&nbsp;<br>
&nbsp;&nbsp;@@&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
&nbsp;&nbsp;boundary&nbsp;=&nbsp;<br>
&nbsp;&nbsp;ctype[i+9:]&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
&nbsp;&nbsp;if&nbsp;len(boundary)&nbsp;&amp;gt;=&nbsp;2&nbsp;and&nbsp;boundary[0]&nbsp;==&nbsp;boundary[-1]&nbsp;==&nbsp;<br>
&nbsp;&nbsp;'&quot;':&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
&nbsp;&nbsp;boundary&nbsp;=&nbsp;<br>
&nbsp;&nbsp;boundary[1:-1]&lt;BR&gt;-&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
&nbsp;&nbsp;boundary&nbsp;=&nbsp;re.compile(&quot;--&quot;&nbsp;+&nbsp;re.escape(boundary)&nbsp;+&nbsp;<br>
&nbsp;&nbsp;&quot;(--)?\r?\n&quot;)&lt;BR&gt;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
&nbsp;&nbsp;boundary&nbsp;=&nbsp;re.compile(&quot;--&quot;&nbsp;+&nbsp;re.escape(boundary)&nbsp;+&nbsp;<br>
&nbsp;&nbsp;&quot;(--)?\r?\n?&quot;)&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;<br>
&nbsp;&nbsp;&lt;DIV&gt;&lt;FONT&nbsp;face=&quot;Courier&nbsp;New&quot;&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&nbsp;&nbsp;&lt;DIV&gt;&lt;SPAN&nbsp;class=108512715-28072009&gt;&lt;FONT&nbsp;face=&quot;Courier&nbsp;New&quot;&nbsp;<br>
&nbsp;&nbsp;size=2&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;except&nbsp;<br>
&nbsp;&nbsp;ValueError:&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
&nbsp;&nbsp;raise&nbsp;apache.SERVER_RETURN,&nbsp;<br>
apache.HTTP_BAD_REQUEST&lt;BR&gt;&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;&lt;/BLOCKQUOTE&gt;<br>
&lt;DIV&nbsp;dir=ltr&gt;&lt;SPAN&nbsp;class=108512715-28072009&gt;&lt;FONT&nbsp;face=&quot;Courier&nbsp;New&quot;&gt;&lt;FONT&nbsp;<br>
face=Arial&nbsp;size=2&gt;I&nbsp;think&nbsp;that&nbsp;since&nbsp;we&nbsp;get&nbsp;the&nbsp;line&nbsp;we&nbsp;compare&nbsp;to&nbsp;boundary&nbsp;<br>
using&nbsp;readline()&nbsp;anyway,&nbsp;it&nbsp;is&nbsp;safe&nbsp;to&nbsp;make&nbsp;the&nbsp;final&nbsp;\n&nbsp;optional.&nbsp;It&nbsp;certainly&nbsp;<br>
appears&nbsp;to&nbsp;work..&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&nbsp;dir=ltr&nbsp;style=&quot;MARGIN-RIGHT:&nbsp;0px&quot;&gt;&lt;FONT&nbsp;face=Arial&nbsp;<br>
size=2&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&nbsp;dir=ltr&nbsp;style=&quot;MARGIN-RIGHT:&nbsp;0px&quot;&gt;&lt;SPAN&nbsp;class=108512715-28072009&gt;&lt;FONT&nbsp;<br>
face=Arial&nbsp;size=2&gt;Thanks,&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;<br>
&lt;DIV&nbsp;dir=ltr&nbsp;style=&quot;MARGIN-RIGHT:&nbsp;0px&quot;&gt;&lt;SPAN&nbsp;class=108512715-28072009&gt;&lt;FONT&nbsp;<br>
face=Arial&nbsp;size=2&gt;&lt;/FONT&gt;&lt;/SPAN&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&nbsp;dir=ltr&nbsp;style=&quot;MARGIN-RIGHT:&nbsp;0px&quot;&gt;&lt;SPAN&nbsp;class=108512715-28072009&gt;&lt;FONT&nbsp;<br>
face=Arial&nbsp;size=2&gt;Philip&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;&lt;/BODY&gt;&lt;/HTML&gt;<br>

</tt>
