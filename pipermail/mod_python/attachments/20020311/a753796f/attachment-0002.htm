<tt>
&lt;!doctype&nbsp;html&nbsp;public&nbsp;&quot;-//w3c//dtd&nbsp;html&nbsp;4.0&nbsp;transitional//en&quot;&gt;<br>
&lt;html&gt;<br>
&lt;tt&gt;def&nbsp;setup_cgi(req):&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&quot;&quot;&quot;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;Replace&nbsp;sys.stdin&nbsp;and&nbsp;stdout&nbsp;with&nbsp;an&nbsp;objects<br>
that&nbsp;read/write&nbsp;to&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;the&nbsp;socket,&nbsp;as&nbsp;well&nbsp;as&nbsp;substitute&nbsp;the&nbsp;os.environ.&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;Returns&nbsp;(environ,&nbsp;stdin,&nbsp;stdout)&nbsp;which&nbsp;you&nbsp;must<br>
save&nbsp;and&nbsp;then&nbsp;use&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;with&nbsp;restore_nocgi().&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&quot;&quot;&quot;&lt;/tt&gt;&lt;tt&gt;&lt;/tt&gt;<br>
&lt;p&gt;&lt;tt&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;#&nbsp;save&nbsp;env&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;env&nbsp;=&nbsp;os.environ.copy()&nbsp;&amp;lt;&amp;lt;&amp;lt;&amp;lt;&nbsp;1&nbsp;!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&amp;nbsp;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;si&nbsp;=&nbsp;sys.stdin&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;so&nbsp;=&nbsp;sys.stdout&lt;/tt&gt;&lt;tt&gt;&lt;/tt&gt;<br>
&lt;p&gt;&lt;tt&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;env&nbsp;=&nbsp;build_cgi_env(req)&nbsp;&amp;lt;&amp;lt;&amp;lt;&amp;lt;&amp;lt;<br>
2&nbsp;!!!!!!!!!!!!!!!!!!!&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&amp;nbsp;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;for&nbsp;k&nbsp;in&nbsp;env.keys():&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;os.environ[k]&nbsp;=&nbsp;env[k]&lt;/tt&gt;&lt;tt&gt;&lt;/tt&gt;<br>
&lt;p&gt;&lt;tt&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;sys.stdout&nbsp;=&nbsp;CGIStdout(req)&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;sys.stdin&nbsp;=&nbsp;CGIStdin(req)&lt;/tt&gt;&lt;tt&gt;&lt;/tt&gt;<br>
&lt;p&gt;&lt;tt&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;sys.argv&nbsp;=&nbsp;[]&nbsp;#&nbsp;keeps&nbsp;cgi.py&nbsp;happy&lt;/tt&gt;&lt;tt&gt;&lt;/tt&gt;<br>
&lt;p&gt;&lt;tt&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;return&nbsp;env,&nbsp;si,&nbsp;so&nbsp;&amp;lt;&amp;lt;&amp;lt;&amp;lt;&nbsp;3&nbsp;!!!!!!!!!!!!!!!!!!!!!!!!!&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;/tt&gt;&amp;nbsp;&lt;tt&gt;&lt;/tt&gt;<br>
&lt;p&gt;&lt;tt&gt;-&nbsp;The&nbsp;env&nbsp;(1)&nbsp;perhaps&nbsp;should&nbsp;be&nbsp;called&nbsp;originalenv&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;-&nbsp;(2)&nbsp;keep&nbsp;as&nbsp;is&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;-&nbsp;(3)&nbsp;change&nbsp;to:&nbsp;return&nbsp;originalenv,&nbsp;si,&nbsp;so&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;/tt&gt;&amp;nbsp;&lt;tt&gt;&lt;/tt&gt;<br>
&lt;p&gt;&lt;tt&gt;Will&nbsp;somebody&nbsp;patch&nbsp;it?&lt;/tt&gt;&lt;tt&gt;&lt;/tt&gt;<br>
&lt;p&gt;&lt;tt&gt;This&nbsp;can&nbsp;cause&nbsp;critical&nbsp;bugs!&lt;/tt&gt;&lt;tt&gt;&lt;/tt&gt;<br>
&lt;p&gt;&lt;tt&gt;Greetings,&nbsp;Andre'&lt;/tt&gt;&lt;tt&gt;&lt;/tt&gt;<br>
&lt;p&gt;&lt;tt&gt;--&amp;nbsp;&lt;br&gt;<br>
_____________________________________________&lt;br&gt;<br>
inworks&nbsp;GmbH&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;<br>
Andre&nbsp;Reitz&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br&gt;<br>
Magirusstrasse&nbsp;44&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;Tel.&nbsp;0731/93&nbsp;80&nbsp;7-21&lt;br&gt;<br>
89077&nbsp;Ulm&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;<br>
&lt;A&nbsp;HREF=&quot;http://www.inworks.de&quot;&gt;http://www.inworks.de&lt;/A&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;/tt&gt;&amp;nbsp;&lt;/html&gt;<br>

</tt>
