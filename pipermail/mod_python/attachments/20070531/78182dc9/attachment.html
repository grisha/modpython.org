<tt>
OOPS&nbsp;--&nbsp;I&nbsp;wasn&amp;#39;t&nbsp;supposed&nbsp;to&nbsp;attach&nbsp;that&nbsp;file&nbsp;to&nbsp;that&nbsp;post.&nbsp;I&amp;#39;ll&nbsp;try&nbsp;again.&nbsp;:-)&lt;br&gt;&lt;span&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;span&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;/span&gt;Hi&nbsp;guys,&lt;br&gt;&lt;br&gt;We&amp;#39;re&nbsp;starting&nbsp;a&nbsp;web&nbsp;site&nbsp;running&nbsp;on&nbsp;mod_python,&nbsp;and&nbsp;we&amp;#39;ve&nbsp;run&nbsp;into&nbsp;import&nbsp;problems,&nbsp;specifically&nbsp;using<br>
&lt;br&gt;&lt;br&gt;from&nbsp;DIR&nbsp;import&nbsp;FILE&lt;br&gt;&lt;br&gt;&nbsp;apache.import_modulewhere<br>
&nbsp;DIR&nbsp;is&nbsp;a&nbsp;directory&nbsp;(not&nbsp;a&nbsp;module&nbsp;or&nbsp;package)&nbsp;and&nbsp;file&nbsp;is&nbsp;a&nbsp;FILE.py&nbsp;file.&nbsp;It&nbsp;works&nbsp;with&nbsp;standard&nbsp;Python&nbsp;importing,&nbsp;but&nbsp;now&nbsp;that&nbsp;we&nbsp;have&nbsp;multiple&nbsp;virtual&nbsp;servers,&nbsp;we&nbsp;need&nbsp;to&nbsp;use,&nbsp;but&nbsp;we&nbsp;can&amp;#39;t&nbsp;quite.&lt;br&gt;&lt;br&gt;Here&amp;#39;s&nbsp;the&nbsp;long&nbsp;gory&nbsp;story:<br>
&lt;br&gt;---------------------&lt;br&gt;&lt;br&gt;Up&nbsp;till&nbsp;now&nbsp;we&amp;#39;ve&nbsp;just&nbsp;been&nbsp;using&nbsp;the&nbsp;standard&nbsp;import&nbsp;statement,&nbsp;and&nbsp;it&amp;#39;s&nbsp;worked&nbsp;fine.&nbsp;But&nbsp;now&nbsp;we&amp;#39;re&nbsp;running&nbsp;two&nbsp;copies&nbsp;of&nbsp;our&nbsp;Python&nbsp;code-base&nbsp;on&nbsp;two&nbsp;virtual&nbsp;servers.&nbsp;So&nbsp;there&nbsp;are&nbsp;two&nbsp;files&nbsp;called&nbsp;&amp;quot;<br>
code.py&amp;quot;&nbsp;and&nbsp;suchlike&nbsp;in&nbsp;two&nbsp;different&nbsp;directories,&nbsp;and&nbsp;the&nbsp;imports&nbsp;get&nbsp;confused&nbsp;if&nbsp;the&nbsp;two&nbsp;are&nbsp;out&nbsp;of&nbsp;sync.&nbsp;All&nbsp;as&nbsp;the&nbsp;docs&nbsp;explain&nbsp;...&nbsp;because&nbsp;of&nbsp;how&nbsp;sys.modules&nbsp;is&nbsp;stored&nbsp;without&nbsp;full&nbsp;paths.&lt;span&nbsp;class=&quot;q&quot;&gt;&lt;br&gt;&lt;br&gt;<br>
So&nbsp;I&amp;#39;ve&nbsp;just&nbsp;been&nbsp;trying&nbsp;to&nbsp;use&nbsp;the&nbsp;new&nbsp;<br>
apache.import_module(),&nbsp;but&nbsp;I&amp;#39;m&nbsp;running&nbsp;into&nbsp;various&nbsp;problems&nbsp;because&nbsp;we&nbsp;have&nbsp;multiple&nbsp;directories&nbsp;in&nbsp;our&nbsp;code&nbsp;structure,&nbsp;which&nbsp;looks&nbsp;something&nbsp;like&nbsp;this:&lt;br&gt;&lt;br&gt;code/&lt;br&gt;code/code.py&amp;nbsp;&nbsp;#&nbsp;main&nbsp;file&nbsp;for&nbsp;mod_python&nbsp;usage,&nbsp;imports&nbsp;everything<br>
&lt;br&gt;code/cli.py&amp;nbsp;&nbsp;#&nbsp;command&nbsp;line&nbsp;&amp;quot;test&nbsp;harness&amp;quot;&nbsp;loader&lt;br&gt;code/logic/dbase.py&lt;br&gt;code/logic/errors.py&lt;br&gt;code/handlers/home.py&lt;br&gt;code/handlers/users.py&lt;br&gt;...&amp;nbsp;&nbsp;#&nbsp;and&nbsp;heaps&nbsp;more&nbsp;files&nbsp;in&nbsp;each&nbsp;of&nbsp;the&nbsp;subdirs&lt;br&nbsp;clear=&quot;all&quot;&gt;<br>
<br>
<br>
&lt;br&gt;&amp;quot;logic&amp;quot;&nbsp;and&nbsp;&amp;quot;handlers&amp;quot;&nbsp;aren&amp;#39;t&nbsp;actual&nbsp;packages,&nbsp;so&nbsp;we&nbsp;thought&nbsp;we&amp;#39;d&nbsp;be&nbsp;okay&nbsp;using&nbsp;apache.import_module()&nbsp;on&nbsp;code.py,&nbsp;and&nbsp;all&nbsp;the&nbsp;import&nbsp;statements&nbsp;scattered&nbsp;throughout&nbsp;the&nbsp;code&nbsp;would&nbsp;just&nbsp;work&nbsp;(am&nbsp;I&nbsp;correct&nbsp;in&nbsp;this?&nbsp;if&nbsp;the&nbsp;top-level&nbsp;import&nbsp;uses&nbsp;import_module,&nbsp;the&nbsp;rest&nbsp;will&nbsp;automatically?).&nbsp;<br>
code.py&nbsp;is&nbsp;actually&nbsp;run&nbsp;by&nbsp;modpython_gateway.py,&nbsp;a&nbsp;WSGI&nbsp;wrapper&nbsp;for&nbsp;mod_python&nbsp;that&nbsp;we&nbsp;modified&nbsp;to&nbsp;use&nbsp;import_module&nbsp;instead&nbsp;of&nbsp;__import__.&lt;br&gt;&lt;br&gt;But&nbsp;the&nbsp;problem&nbsp;is&nbsp;that&nbsp;it&nbsp;bombs&nbsp;out&nbsp;on&nbsp;statements&nbsp;like:&lt;br&gt;&lt;br&gt;from&nbsp;logic&nbsp;import&nbsp;errors<br>
&lt;br&gt;&lt;br&gt;with&nbsp;&amp;quot;ImportError:&nbsp;No&nbsp;module&nbsp;named&nbsp;logic&amp;quot;&lt;br&gt;&lt;br&gt;&lt;/span&gt;&lt;span&nbsp;class=&quot;q&quot;&gt;I&nbsp;guess&nbsp;this&nbsp;is&nbsp;because&nbsp;logic&nbsp;isn&amp;#39;t&nbsp;a&nbsp;file/module,&nbsp;it&amp;#39;s&nbsp;a&nbsp;directory.&nbsp;Is&nbsp;this&nbsp;correct?&nbsp;(In&nbsp;.htaccess,&nbsp;I&nbsp;have&nbsp;PythonOption&nbsp;mod_python.importer.path&nbsp;&amp;quot;[&amp;#39;c:/www/mpledge/code&amp;#39;]&amp;quot;&nbsp;so&nbsp;it&nbsp;definitely&nbsp;knows&nbsp;where&nbsp;to&nbsp;go,&nbsp;but&nbsp;the&nbsp;import&nbsp;statement&nbsp;fallback&nbsp;probably&nbsp;doesn&amp;#39;t.&nbsp;It&nbsp;won&amp;#39;t&nbsp;help&nbsp;if&nbsp;we&nbsp;set&nbsp;<br>
sys.path,&nbsp;because&nbsp;then&nbsp;we&amp;#39;re&nbsp;back&nbsp;to&nbsp;the&nbsp;old&nbsp;import&nbsp;problems.)&lt;br&gt;&lt;br&gt;In&nbsp;short,&nbsp;we&amp;#39;re&nbsp;wondering&nbsp;the&nbsp;best&nbsp;way&nbsp;forward&nbsp;using&nbsp;mod_python.&nbsp;The&nbsp;options&nbsp;we&nbsp;see&nbsp;are:&lt;br&gt;&lt;br&gt;1)&nbsp;Only&nbsp;ever&nbsp;run&nbsp;one&nbsp;code&nbsp;base.&nbsp;Non-ideal.&lt;br&gt;<br>
<br>
&lt;br&gt;<br>
2)&nbsp;Override&nbsp;__builtin__.__import__&nbsp;with&nbsp;our&nbsp;own&nbsp;one&nbsp;that&nbsp;checks&nbsp;if&nbsp;it&amp;#39;s&nbsp;a&nbsp;directory&nbsp;and&nbsp;calls&nbsp;your&nbsp;import_module&nbsp;on&nbsp;the&nbsp;result,&nbsp;e.g.,&nbsp;import_module(&amp;#39;logic/errors&amp;#39;).&nbsp;Would&nbsp;this&nbsp;work?&lt;br&gt;&lt;br&gt;3)&nbsp;Write&nbsp;a&nbsp;patch&nbsp;to&nbsp;modpython&amp;#39;s&nbsp;import_module&nbsp;that&nbsp;adds&nbsp;that&nbsp;functionality.&nbsp;But&nbsp;I&amp;#39;m&nbsp;guessing&nbsp;there&amp;#39;s&nbsp;some&nbsp;good&nbsp;reason&nbsp;it&nbsp;doesn&amp;#39;t&nbsp;support&nbsp;this&nbsp;--&nbsp;is&nbsp;that&nbsp;correct?<br>
&lt;br&gt;&lt;br&gt;4)&nbsp;Change&nbsp;all&nbsp;our&nbsp;import&nbsp;statements&nbsp;to&nbsp;import_module&nbsp;calls.&nbsp;We&nbsp;have&nbsp;a&nbsp;lot&nbsp;of&nbsp;them&nbsp;in&nbsp;different&nbsp;forms,&nbsp;so&nbsp;this&nbsp;would&nbsp;be&nbsp;messy.&nbsp;Particularly&nbsp;because&nbsp;we&nbsp;want&nbsp;it&nbsp;to&nbsp;work&nbsp;in&nbsp;test/command-line&nbsp;mode&nbsp;too.&nbsp;And&nbsp;at&nbsp;the&nbsp;moment&nbsp;with&nbsp;import&nbsp;statements&nbsp;it&nbsp;works&nbsp;just&nbsp;as&nbsp;well&nbsp;from&nbsp;Apache&nbsp;with&nbsp;<br>
code.py&nbsp;and&nbsp;from&nbsp;the&nbsp;command&nbsp;line&nbsp;with&nbsp;&amp;quot;python&nbsp;-i&nbsp;cli.py&amp;quot;.&nbsp;So&nbsp;we&amp;#39;d&nbsp;have&nbsp;to&nbsp;do&nbsp;if/else&nbsp;conditions&nbsp;around&nbsp;all&nbsp;the&nbsp;imports,&nbsp;for&nbsp;whether&nbsp;it&amp;#39;s&nbsp;in&nbsp;cli/test&nbsp;mode&nbsp;or&nbsp;not.&lt;br&gt;&lt;br&gt;5)&nbsp;Look&nbsp;into&nbsp;FastCGI&nbsp;or&nbsp;something&nbsp;...&nbsp;but&nbsp;we&amp;#39;re&nbsp;not&nbsp;sure&nbsp;we&nbsp;want&nbsp;to&nbsp;go&nbsp;there&nbsp;at&nbsp;this&nbsp;stage.<br>
&lt;br&gt;&lt;br&gt;Oh,&nbsp;and&nbsp;one&nbsp;more&nbsp;thing,&nbsp;we&amp;#39;re&nbsp;also&nbsp;using&nbsp;Cheetah,&nbsp;so&nbsp;I&nbsp;guess&nbsp;we&amp;#39;ll&nbsp;have&nbsp;to&nbsp;change&nbsp;its&nbsp;__import__s&nbsp;to&nbsp;import_module&nbsp;calls&nbsp;too...&lt;br&gt;<br>
&lt;br&gt;&lt;/span&gt;<br>
What&nbsp;do&nbsp;you&nbsp;think&nbsp;is&nbsp;the&nbsp;best&nbsp;way?&lt;br&gt;&lt;br&gt;Thanks&nbsp;for&nbsp;your&nbsp;time!&lt;div&gt;&lt;span&nbsp;class=&quot;e&quot;&nbsp;id=&quot;q_112e1839996147b6_4&quot;&gt;&lt;br&gt;&lt;br&gt;-Ben&lt;br&gt;&lt;br&gt;P.&nbsp;S.&nbsp;Feel&nbsp;free&nbsp;to&nbsp;check&nbsp;out&nbsp;the&nbsp;&amp;quot;early&nbsp;page&amp;quot;&nbsp;for&nbsp;our&nbsp;website&nbsp;(<br>
&lt;a&nbsp;href=&quot;http://micropledge.com/&quot;&nbsp;target=&quot;_blank&quot;&nbsp;onclick=&quot;return&nbsp;top.js.OpenExtLink(window,event,this)&quot;&gt;http://micropledge.com/&lt;/a&gt;).&nbsp;Hopefully&nbsp;we&nbsp;won&amp;#39;t&nbsp;be&nbsp;upgrading&nbsp;mod_python&nbsp;or&nbsp;something&nbsp;when&nbsp;you&nbsp;look.&nbsp;:-)&lt;span&gt;<br>
&lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;br&gt;--&nbsp;&lt;br&gt;Ben&nbsp;Hoyt,&nbsp;+64&nbsp;21&nbsp;331&nbsp;841&lt;br&gt;&lt;a&nbsp;href=&quot;http://www.benhoyt.com/&quot;&gt;http://www.benhoyt.com/&lt;/a&gt;<br>

</tt>
