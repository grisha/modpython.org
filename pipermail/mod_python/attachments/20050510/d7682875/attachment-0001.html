<tt>
&lt;!DOCTYPE&nbsp;HTML&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.0&nbsp;TRANSITIONAL//EN&quot;&gt;<br>
&lt;HTML&gt;<br>
&lt;HEAD&gt;<br>
&nbsp;&nbsp;&lt;META&nbsp;HTTP-EQUIV=&quot;Content-Type&quot;&nbsp;CONTENT=&quot;text/html;&nbsp;CHARSET=UTF-8&quot;&gt;<br>
&nbsp;&nbsp;&lt;META&nbsp;NAME=&quot;GENERATOR&quot;&nbsp;CONTENT=&quot;GtkHTML/3.2.4&quot;&gt;<br>
&lt;/HEAD&gt;<br>
&lt;BODY&gt;<br>
Update&nbsp;on&nbsp;my&nbsp;own&nbsp;message:&lt;BR&gt;<br>
I&nbsp;have&nbsp;changed&nbsp;the&nbsp;structure&nbsp;a&nbsp;bit,&nbsp;sess&nbsp;has&nbsp;now&nbsp;become&nbsp;req.session,&nbsp;so&nbsp;I&nbsp;can&nbsp;pass&nbsp;around&nbsp;the&nbsp;session&nbsp;together&nbsp;with&nbsp;the&nbsp;request&nbsp;object&nbsp;easily.&lt;BR&gt;<br>
The&nbsp;locking&nbsp;problem&nbsp;has&nbsp;been&nbsp;solved&nbsp;by&nbsp;calling&nbsp;req.session.unlock()&nbsp;every&nbsp;time&nbsp;after&nbsp;saving&nbsp;the&nbsp;session,&nbsp;however&nbsp;this&nbsp;causes&nbsp;the&nbsp;server&nbsp;to&nbsp;start&nbsp;a&nbsp;new&nbsp;session&nbsp;for&nbsp;each&nbsp;request,&nbsp;and&nbsp;that's&nbsp;not&nbsp;the&nbsp;idea,&nbsp;as&nbsp;then&nbsp;info&nbsp;gets&nbsp;lost.&lt;BR&gt;<br>
Also&nbsp;I've&nbsp;noticed&nbsp;that&nbsp;writing&nbsp;and&nbsp;reading&nbsp;back&nbsp;of&nbsp;cookies&nbsp;does&nbsp;not&nbsp;work&nbsp;properly.&nbsp;I'm&nbsp;trying&nbsp;to&nbsp;write&nbsp;a&nbsp;cookie,&nbsp;and&nbsp;when&nbsp;reading&nbsp;it&nbsp;back&nbsp;in&nbsp;case&nbsp;of&nbsp;a&nbsp;new&nbsp;session&nbsp;I&nbsp;get&nbsp;the&nbsp;old&nbsp;data&nbsp;again.&nbsp;But&nbsp;that's&nbsp;for&nbsp;another&nbsp;question.&lt;BR&gt;<br>
&lt;BR&gt;<br>
Any&nbsp;advice&nbsp;is&nbsp;highly&nbsp;appreciated!&lt;BR&gt;<br>
&lt;BR&gt;<br>
Wouter.&lt;BR&gt;<br>
&lt;BR&gt;<br>
On&nbsp;Tue,&nbsp;2005-05-10&nbsp;at&nbsp;14:53&nbsp;+0800,&nbsp;Wouter&nbsp;van&nbsp;Marle&nbsp;wrote:<br>
&lt;BLOCKQUOTE&nbsp;TYPE=CITE&gt;<br>
&lt;PRE&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#000000&quot;&gt;On&nbsp;Tue,&nbsp;2005-05-10&nbsp;at&nbsp;02:01&nbsp;-0400,&nbsp;Jim&nbsp;Gallacher&nbsp;wrote:&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#000000&quot;&gt;&amp;gt;&nbsp;This&nbsp;looks&nbsp;like&nbsp;a&nbsp;problem&nbsp;with&nbsp;session&nbsp;locking,&nbsp;which&nbsp;is&nbsp;the&nbsp;default&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#000000&quot;&gt;&amp;gt;&nbsp;when&nbsp;creating&nbsp;a&nbsp;session.&nbsp;Are&nbsp;you&nbsp;creating&nbsp;more&nbsp;than&nbsp;one&nbsp;session&nbsp;object&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#000000&quot;&gt;&amp;gt;&nbsp;in&nbsp;a&nbsp;request?&nbsp;If&nbsp;so&nbsp;you'll&nbsp;end&nbsp;up&nbsp;with&nbsp;a&nbsp;deadlock.&nbsp;For&nbsp;example&nbsp;the&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#000000&quot;&gt;&amp;gt;&nbsp;following&nbsp;code&nbsp;will&nbsp;deadlock&nbsp;as&nbsp;it&nbsp;is&nbsp;really&nbsp;just&nbsp;accessing&nbsp;the&nbsp;same&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#000000&quot;&gt;&amp;gt;&nbsp;session&nbsp;data:&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#000000&quot;&gt;&amp;gt;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#000000&quot;&gt;&amp;gt;&nbsp;sess1&nbsp;=&nbsp;Session.Session(req)&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#000000&quot;&gt;&amp;gt;&nbsp;sess2&nbsp;-&nbsp;Session.Session(req)&lt;/FONT&gt;<br>
<br>
&lt;FONT&nbsp;COLOR=&quot;#000000&quot;&gt;This&nbsp;is&nbsp;really&nbsp;close&nbsp;to&nbsp;what&nbsp;I&nbsp;am&nbsp;doing.&nbsp;I've&nbsp;to&nbsp;shorten&nbsp;my&nbsp;code&nbsp;a&nbsp;lot&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#000000&quot;&gt;to&nbsp;get&nbsp;it&nbsp;posted&nbsp;here,&nbsp;but&nbsp;basically&nbsp;this&nbsp;happens:&lt;/FONT&gt;<br>
<br>
&lt;FONT&nbsp;COLOR=&quot;#000000&quot;&gt;def&nbsp;home(req):&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#000000&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;sess&nbsp;=&nbsp;Session.Session(req)&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#000000&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;sess.is_new():&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#000000&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;get&nbsp;settings&nbsp;from&nbsp;cookies&nbsp;(using&nbsp;Cookie)&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#000000&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;page&nbsp;built&nbsp;up,&nbsp;using&nbsp;sess[&amp;quot;language&amp;quot;]&nbsp;for&nbsp;the&nbsp;language&nbsp;setting.&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#000000&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;sess.save()&nbsp;&nbsp;&nbsp;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#000000&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;apache.OK&lt;/FONT&gt;<br>
<br>
&lt;FONT&nbsp;COLOR=&quot;#000000&quot;&gt;def&nbsp;english(req)&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#000000&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;sess&nbsp;=&nbsp;Session.Session(req)&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#000000&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;sess[&amp;quot;language&amp;quot;]&nbsp;=&nbsp;&amp;quot;en&amp;quot;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#000000&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;sess.save()&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#000000&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;home(req)&nbsp;#&nbsp;to&nbsp;redraw&nbsp;the&nbsp;main&nbsp;page&lt;/FONT&gt;<br>
<br>
&lt;FONT&nbsp;COLOR=&quot;#000000&quot;&gt;And&nbsp;same&nbsp;for&nbsp;other&nbsp;languages&nbsp;as&nbsp;well.&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#000000&quot;&gt;The&nbsp;page&nbsp;uses&nbsp;a&nbsp;little&nbsp;PSP&nbsp;to&nbsp;easily&nbsp;set&nbsp;some&nbsp;variables,&nbsp;no&nbsp;code&nbsp;in&nbsp;the&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#000000&quot;&gt;pages.&nbsp;It&nbsp;appears&nbsp;to&nbsp;hang&nbsp;on&nbsp;the&nbsp;Session.Session(req)&nbsp;call&nbsp;in&nbsp;the&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#000000&quot;&gt;english&nbsp;routine.&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#000000&quot;&gt;The&nbsp;english&nbsp;routine&nbsp;is&nbsp;called&nbsp;through&nbsp;a&nbsp;hyperlink&nbsp;off&nbsp;the&nbsp;main&nbsp;page&nbsp;(a&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#000000&quot;&gt;href&nbsp;main.py/english).&lt;/FONT&gt;<br>
<br>
&lt;FONT&nbsp;COLOR=&quot;#000000&quot;&gt;Wouter.&lt;/FONT&gt;<br>
<br>
<br>
&lt;FONT&nbsp;COLOR=&quot;#000000&quot;&gt;_______________________________________________&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#000000&quot;&gt;Mod_python&nbsp;mailing&nbsp;list&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#000000&quot;&gt;&lt;A&nbsp;HREF=&quot;mailto:Mod_python@modpython.org&quot;&gt;Mod_python@modpython.org&lt;/A&gt;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#000000&quot;&gt;&lt;A&nbsp;HREF=&quot;http://mailman.modpython.org/mailman/listinfo/mod_python&quot;&gt;http://mailman.modpython.org/mailman/listinfo/mod_python&lt;/A&gt;&lt;/FONT&gt;<br>
<br>
<br>
&lt;/PRE&gt;<br>
&lt;/BLOCKQUOTE&gt;<br>
&lt;/BODY&gt;<br>
&lt;/HTML&gt;<br>

</tt>
