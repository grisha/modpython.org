<tt>
&lt;!DOCTYPE&nbsp;html&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.01&nbsp;Transitional//EN&quot;&gt;<br>
&lt;html&gt;<br>
&lt;head&gt;<br>
&nbsp;&nbsp;&lt;meta&nbsp;content=&quot;text/html;charset=ISO-8859-1&quot;&nbsp;http-equiv=&quot;Content-Type&quot;&gt;<br>
&nbsp;&nbsp;&lt;title&gt;&lt;/title&gt;<br>
&lt;/head&gt;<br>
&lt;body&nbsp;bgcolor=&quot;#ffffff&quot;&nbsp;text=&quot;#000000&quot;&gt;<br>
Hello&nbsp;Graham,&lt;br&gt;<br>
&lt;br&gt;<br>
All&nbsp;of&nbsp;the&nbsp;problems&nbsp;you&nbsp;describe&nbsp;and&nbsp;the&nbsp;scenarios&nbsp;you&nbsp;provided&nbsp;were<br>
right&nbsp;on&nbsp;target&nbsp;as&nbsp;to&nbsp;the&nbsp;kind&nbsp;of&nbsp;issues&nbsp;I&nbsp;am&nbsp;running&nbsp;into.&amp;nbsp;&nbsp;Here&nbsp;is<br>
the&nbsp;response&nbsp;to&nbsp;your&nbsp;question:&lt;br&gt;<br>
&lt;br&gt;<br>
&amp;gt;&nbsp;Anyway,&nbsp;confirm&nbsp;exactly&nbsp;what&nbsp;you&nbsp;meant&nbsp;by&nbsp;having&nbsp;thread&nbsp;locking<br>
going<br>
&lt;br&gt;<br>
&amp;gt;&nbsp;into&nbsp;the&nbsp;handler&nbsp;and&nbsp;describe&nbsp;how&nbsp;you&nbsp;are&nbsp;managing&nbsp;the&nbsp;database<br>
&lt;br&gt;<br>
&amp;gt;&nbsp;connections.&nbsp;Do&nbsp;you&nbsp;create&nbsp;a&nbsp;certain&nbsp;number&nbsp;of&nbsp;database<br>
connections&nbsp;at<br>
&lt;br&gt;<br>
&amp;gt;&nbsp;startup,&nbsp;or&nbsp;on&nbsp;demand&nbsp;as&nbsp;required,&nbsp;but&nbsp;only&nbsp;up&nbsp;to&nbsp;a&nbsp;certain<br>
maximum?<br>
&lt;br&gt;<br>
&amp;gt;&nbsp;Is&nbsp;your&nbsp;connection&nbsp;caching&nbsp;mechanism&nbsp;thread&nbsp;protected&nbsp;in&nbsp;any&nbsp;way?&lt;br&gt;<br>
&lt;br&gt;<br>
Pretty&nbsp;much,&nbsp;the&nbsp;way&nbsp;i&nbsp;have&nbsp;setup&nbsp;the&nbsp;handler&nbsp;is&nbsp;as&nbsp;follows:&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&gt;&lt;b&gt;&lt;font&nbsp;color=&quot;#3333ff&quot;&gt;def&nbsp;handler(req):&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;_lock.acquire()&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&nbsp;try:&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&nbsp;#&nbsp;instantiate&nbsp;and&nbsp;call&nbsp;my&nbsp;driver&nbsp;class&nbsp;that&nbsp;processes&nbsp;the&nbsp;request&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&nbsp;finally:&lt;br&gt;<br>
&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;_lock.release()&lt;/font&gt;&lt;/b&gt;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
You&nbsp;were&nbsp;exactly&nbsp;right&nbsp;about&nbsp;what&nbsp;I&nbsp;was&nbsp;experiencing&nbsp;in&nbsp;that&nbsp;each<br>
thread&nbsp;was&nbsp;waiting&nbsp;on&nbsp;another&nbsp;to&nbsp;release&nbsp;the&nbsp;lock&nbsp;before&nbsp;processing&nbsp;so<br>
the&nbsp;processing&nbsp;of&nbsp;the&nbsp;threads&nbsp;with&nbsp;20&nbsp;concurrent&nbsp;users&nbsp;was&nbsp;serialized.&amp;nbsp;<br>
Taking&nbsp;that&nbsp;into&nbsp;account,&nbsp;I&nbsp;removed&nbsp;the&nbsp;locking&nbsp;from&nbsp;the&nbsp;handler&nbsp;and<br>
ran&nbsp;the&nbsp;20&nbsp;concurrent&nbsp;users&nbsp;test&nbsp;again&nbsp;and&nbsp;then&nbsp;I&nbsp;started&nbsp;running&nbsp;into<br>
problems&nbsp;with&nbsp;the&nbsp;MySQL&nbsp;server&nbsp;dropping&nbsp;connections&nbsp;due&nbsp;to&nbsp;there&nbsp;being<br>
too&nbsp;many&nbsp;simultaneous&nbsp;connections&nbsp;being&nbsp;made&nbsp;from&nbsp;my&nbsp;application.&lt;br&gt;<br>
&lt;br&gt;<br>
To&nbsp;answer&nbsp;your&nbsp;second&nbsp;question&nbsp;of&nbsp;how&nbsp;I&nbsp;am&nbsp;managing&nbsp;the&nbsp;database<br>
connections,&nbsp;pretty&nbsp;much&nbsp;it&nbsp;is&nbsp;very&nbsp;simple.&amp;nbsp;&nbsp;My&nbsp;framework,&nbsp;was<br>
originally&nbsp;written&nbsp;by&nbsp;a&nbsp;friend&nbsp;of&nbsp;mine&nbsp;to&nbsp;work&nbsp;only&nbsp;in&nbsp;CGI&nbsp;about&nbsp;3<br>
years&nbsp;ago.&amp;nbsp;&nbsp;So,&nbsp;in&nbsp;the&nbsp;Data&nbsp;Access&nbsp;Layer,&nbsp;he&nbsp;has&nbsp;a&nbsp;class&nbsp;that&nbsp;manages<br>
connections&nbsp;to&nbsp;different&nbsp;sources&nbsp;being,&nbsp;databases,&nbsp;servers,&nbsp;and&nbsp;payment<br>
processors.&amp;nbsp;&nbsp;For&nbsp;database&nbsp;connections,&nbsp;there&nbsp;is&nbsp;a&nbsp;dictionary&nbsp;that&nbsp;holds<br>
all&nbsp;the&nbsp;connections.&amp;nbsp;&nbsp;Because,&nbsp;it&nbsp;was&nbsp;originally&nbsp;written&nbsp;for&nbsp;CGI,&nbsp;he<br>
saved&nbsp;a&nbsp;connection&nbsp;to&nbsp;a&nbsp;database&nbsp;in&nbsp;the&nbsp;dictionary&nbsp;using&nbsp;the&nbsp;key<br>
&quot;dbname:thread&nbsp;id&quot;.&amp;nbsp;&nbsp;This&nbsp;worked&nbsp;fine,&nbsp;because&nbsp;the&nbsp;environment&nbsp;wasn't<br>
multi&nbsp;threaded,&nbsp;so&nbsp;there&nbsp;was&nbsp;always&nbsp;only&nbsp;one&nbsp;thread&nbsp;id&nbsp;for&nbsp;all<br>
requests.&amp;nbsp;&nbsp;So&nbsp;all&nbsp;the&nbsp;db&nbsp;connections&nbsp;were&nbsp;created&nbsp;on&nbsp;demand&nbsp;and&nbsp;then<br>
cached&nbsp;and&nbsp;then&nbsp;all&nbsp;subsequent&nbsp;requests&nbsp;for&nbsp;the&nbsp;same&nbsp;db&nbsp;connections<br>
were&nbsp;then&nbsp;given&nbsp;back&nbsp;from&nbsp;cache.&amp;nbsp;&nbsp;So&nbsp;it&nbsp;works&nbsp;as&nbsp;follows:&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&gt;&lt;b&gt;&lt;font&nbsp;color=&quot;#3333ff&quot;&gt;class&nbsp;DALResources:&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;def&nbsp;getDB(self,&nbsp;db_name):&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&nbsp;resource_name&nbsp;=&nbsp;&quot;%s:%s&quot;&nbsp;%&nbsp;(db_name,thread_id)&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;db_conn&nbsp;=&nbsp;self.__resource_dict.get(resource_name,None)&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;db_conn&nbsp;==&nbsp;None:&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&nbsp;#&nbsp;create&nbsp;a&nbsp;db&nbsp;connections&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&nbsp;#&nbsp;cache&nbsp;it&nbsp;in&nbsp;the&nbsp;__resource_dict&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&nbsp;return&nbsp;db_conn&lt;/font&gt;&lt;/b&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
So&nbsp;for&nbsp;each&nbsp;db,&nbsp;there&nbsp;is&nbsp;only&nbsp;one&nbsp;connection&nbsp;cached&nbsp;and&nbsp;that&nbsp;is&nbsp;the&nbsp;one<br>
that&nbsp;is&nbsp;shared.&amp;nbsp;&nbsp;The&nbsp;thread_id&nbsp;caused&nbsp;a&nbsp;problem&nbsp;in&nbsp;the&nbsp;multithreaded<br>
environment&nbsp;because&nbsp;there&nbsp;could&nbsp;be&nbsp;a&nbsp;huge&nbsp;number&nbsp;of&nbsp;threads&nbsp;that&nbsp;are<br>
processing&nbsp;requests&nbsp;and&nbsp;as&nbsp;a&nbsp;result&nbsp;too&nbsp;many&nbsp;connections&nbsp;were&nbsp;made.&amp;nbsp;&nbsp;I<br>
tried&nbsp;to&nbsp;go&nbsp;around&nbsp;this&nbsp;problem&nbsp;by&nbsp;removing&nbsp;the&nbsp;thread_id&nbsp;from&nbsp;the<br>
resource_name,&nbsp;however,&nbsp;I&nbsp;still&nbsp;started&nbsp;running&nbsp;into&nbsp;MySQL&nbsp;connection<br>
problems.&lt;br&gt;<br>
&lt;br&gt;<br>
My&nbsp;caching&nbsp;mechanism&nbsp;is&nbsp;not&nbsp;thread&nbsp;protected&nbsp;at&nbsp;all.&amp;nbsp;&nbsp;Pretty&nbsp;much&nbsp;the<br>
DALResources&nbsp;class&nbsp;is&nbsp;created&nbsp;as&nbsp;a&nbsp;singleton&nbsp;and&nbsp;imported&nbsp;in&nbsp;my&nbsp;handler<br>
so&nbsp;that&nbsp;is&nbsp;available&nbsp;for&nbsp;all&nbsp;child&nbsp;threads&nbsp;in&nbsp;a&nbsp;process.&amp;nbsp;&nbsp;One&nbsp;thing&nbsp;I<br>
did&nbsp;yesterday&nbsp;was&nbsp;to&nbsp;try&nbsp;to&nbsp;make&nbsp;my&nbsp;DB&nbsp;Connection&nbsp;object&nbsp;thread&nbsp;safe&nbsp;by<br>
locking&nbsp;the&nbsp;connection&nbsp;where&nbsp;it&nbsp;queries&nbsp;the&nbsp;db.&amp;nbsp;&nbsp;That&nbsp;actually,<br>
resulted&nbsp;in&nbsp;no&nbsp;more&nbsp;connection&nbsp;problems&nbsp;to&nbsp;the&nbsp;db.&lt;br&gt;<br>
&lt;br&gt;<br>
However,&nbsp;I&nbsp;still&nbsp;run&nbsp;into&nbsp;various&nbsp;problems,&nbsp;and&nbsp;I&nbsp;am&nbsp;very&nbsp;sure&nbsp;that&nbsp;is<br>
because&nbsp;there&nbsp;is&nbsp;no&nbsp;locking&nbsp;mechanism&nbsp;available&nbsp;for&nbsp;all&nbsp;the&nbsp;objects&nbsp;I<br>
am&nbsp;sharing&nbsp;by&nbsp;putting&nbsp;it&nbsp;in&nbsp;shared&nbsp;memory.&amp;nbsp;&amp;nbsp;&nbsp;What&nbsp;would&nbsp;you&nbsp;suggest&nbsp;I<br>
do&nbsp;in&nbsp;terms&nbsp;of&nbsp;locking&nbsp;objects?&amp;nbsp;&nbsp;Should&nbsp;I&nbsp;make&nbsp;the&nbsp;objects&nbsp;I&nbsp;am&nbsp;storing<br>
in&nbsp;the&nbsp;cache&nbsp;thread&nbsp;safe&nbsp;or&nbsp;should&nbsp;I&nbsp;create&nbsp;one&nbsp;Caching&nbsp;object&nbsp;and<br>
store&nbsp;all&nbsp;my&nbsp;shared&nbsp;objects&nbsp;in&nbsp;that&nbsp;and&nbsp;add&nbsp;locking&nbsp;to&nbsp;the&nbsp;get&nbsp;and&nbsp;set<br>
methods?&lt;br&gt;<br>
&lt;br&gt;<br>
Thanks&nbsp;again&nbsp;for&nbsp;all&nbsp;your&nbsp;help&nbsp;and&nbsp;I&nbsp;hope&nbsp;I&nbsp;explained&nbsp;all&nbsp;the&nbsp;items&nbsp;you<br>
asked&nbsp;for.&lt;br&gt;<br>
&lt;br&gt;<br>
Hozi&lt;br&gt;<br>
&lt;br&gt;<br>
Graham&nbsp;Dumpleton&nbsp;wrote:<br>
&lt;blockquote&nbsp;cite=&quot;mid45b52d58b25b19dc2f8f858d5f178fb9@dscpl.com.au&quot;<br>
&nbsp;type=&quot;cite&quot;&gt;I'll&nbsp;try&nbsp;and&nbsp;get&nbsp;back&nbsp;to&nbsp;your&nbsp;original&nbsp;problem.&nbsp;I&nbsp;probably<br>
digressed<br>
&nbsp;&nbsp;&lt;br&gt;<br>
and&nbsp;certainly&nbsp;said&nbsp;some&nbsp;things&nbsp;already&nbsp;that&nbsp;most&nbsp;likely&nbsp;aren't&nbsp;relevant<br>
&nbsp;&nbsp;&lt;br&gt;<br>
at&nbsp;all.&nbsp;I&nbsp;should&nbsp;have&nbsp;perhaps&nbsp;read&nbsp;the&nbsp;email&nbsp;properly.&nbsp;My&nbsp;excuse&nbsp;is<br>
that<br>
&nbsp;&nbsp;&lt;br&gt;<br>
I&nbsp;was&nbsp;having&nbsp;a&nbsp;busy&nbsp;day&nbsp;that&nbsp;day.&nbsp;:-)<br>
&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
On&nbsp;05/02/2005,&nbsp;at&nbsp;6:56&nbsp;AM,&nbsp;Huzaifa&nbsp;Tapal&nbsp;wrote:<br>
&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;Is&nbsp;the&nbsp;Python&nbsp;database&nbsp;connection&nbsp;object<br>
internally&nbsp;thread&nbsp;safe?<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
--&nbsp;not&nbsp;its&nbsp;not.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
I&nbsp;should&nbsp;have&nbsp;phrased&nbsp;this&nbsp;question&nbsp;a&nbsp;bit&nbsp;better.&nbsp;Does&nbsp;the&nbsp;database<br>
&nbsp;&nbsp;&lt;br&gt;<br>
interface&nbsp;code&nbsp;support&nbsp;having&nbsp;multiple&nbsp;connection&nbsp;objects&nbsp;active&nbsp;at<br>
&nbsp;&nbsp;&lt;br&gt;<br>
the&nbsp;same&nbsp;time,&nbsp;where&nbsp;each&nbsp;may&nbsp;be&nbsp;held&nbsp;by&nbsp;a&nbsp;distinct&nbsp;thread&nbsp;with&nbsp;that<br>
&nbsp;&nbsp;&lt;br&gt;<br>
thread&nbsp;doing&nbsp;whatever&nbsp;it&nbsp;wants&nbsp;with&nbsp;its&nbsp;own&nbsp;connection&nbsp;object?<br>
&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
Thus,&nbsp;a&nbsp;single&nbsp;database&nbsp;connection&nbsp;object&nbsp;doesn't&nbsp;necessarily&nbsp;have<br>
&nbsp;&nbsp;&lt;br&gt;<br>
to&nbsp;be&nbsp;thread&nbsp;safe&nbsp;in&nbsp;itself,&nbsp;as&nbsp;long&nbsp;as&nbsp;there&nbsp;can&nbsp;be&nbsp;multiple<br>
connection<br>
&nbsp;&nbsp;&lt;br&gt;<br>
objects&nbsp;each&nbsp;being&nbsp;used&nbsp;at&nbsp;the&nbsp;same&nbsp;time&nbsp;by&nbsp;different&nbsp;threads.<br>
&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
Anyway,&nbsp;in&nbsp;your&nbsp;original&nbsp;email&nbsp;you&nbsp;said:<br>
&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
&amp;nbsp;&nbsp;Just&nbsp;to&nbsp;be&nbsp;safe,&nbsp;I&nbsp;implemented&nbsp;thread&nbsp;locking&nbsp;into&nbsp;the&nbsp;handler<br>
&nbsp;&nbsp;&lt;br&gt;<br>
&amp;nbsp;&nbsp;before&nbsp;any&nbsp;request&nbsp;is&nbsp;processed.<br>
&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
That&nbsp;to&nbsp;me&nbsp;says&nbsp;what&nbsp;you&nbsp;did&nbsp;was&nbsp;to&nbsp;make&nbsp;sure&nbsp;only&nbsp;one&nbsp;request&nbsp;at&nbsp;a<br>
&nbsp;&nbsp;&lt;br&gt;<br>
time&nbsp;could&nbsp;actually&nbsp;do&nbsp;anything.&nbsp;Thus&nbsp;all&nbsp;requests&nbsp;were&nbsp;serialised.<br>
&nbsp;&nbsp;&lt;br&gt;<br>
If&nbsp;this&nbsp;was&nbsp;the&nbsp;case,&nbsp;you&nbsp;wouldn't&nbsp;have&nbsp;had&nbsp;any&nbsp;thread&nbsp;problems&nbsp;because<br>
&nbsp;&nbsp;&lt;br&gt;<br>
there&nbsp;wouldn't&nbsp;have&nbsp;actually&nbsp;been&nbsp;multiple&nbsp;requests&nbsp;active,&nbsp;a&nbsp;latter<br>
&nbsp;&nbsp;&lt;br&gt;<br>
request&nbsp;would&nbsp;have&nbsp;sat&nbsp;there&nbsp;until&nbsp;the&nbsp;previous&nbsp;one&nbsp;finished.<br>
&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
If&nbsp;this&nbsp;is&nbsp;true,&nbsp;using&nbsp;a&nbsp;multithreaded&nbsp;MPM&nbsp;would&nbsp;also&nbsp;have&nbsp;just&nbsp;made<br>
&nbsp;&nbsp;&lt;br&gt;<br>
things&nbsp;worse.&nbsp;You&nbsp;would&nbsp;have&nbsp;been&nbsp;better&nbsp;of&nbsp;using&nbsp;Apache&nbsp;in&nbsp;&quot;prefork&quot;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
mode&nbsp;as&nbsp;then&nbsp;each&nbsp;request&nbsp;in&nbsp;each&nbsp;process&nbsp;could&nbsp;have&nbsp;at&nbsp;least&nbsp;run&nbsp;in<br>
&nbsp;&nbsp;&lt;br&gt;<br>
parallel.<br>
&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
Next&nbsp;you&nbsp;said:<br>
&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
&amp;nbsp;&nbsp;We&nbsp;are&nbsp;gaining&nbsp;huge&nbsp;performance&nbsp;increases&nbsp;by&nbsp;caching&nbsp;our&nbsp;template<br>
&nbsp;&nbsp;&lt;br&gt;<br>
&amp;nbsp;&nbsp;objects&nbsp;and&nbsp;db&nbsp;connection&nbsp;objects.<br>
&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
Which&nbsp;is&nbsp;logical,&nbsp;as&nbsp;you&nbsp;have&nbsp;avoided&nbsp;the&nbsp;startup&nbsp;cost&nbsp;with&nbsp;creating<br>
&nbsp;&nbsp;&lt;br&gt;<br>
a&nbsp;database&nbsp;connection&nbsp;for&nbsp;each&nbsp;request,&nbsp;as&nbsp;well&nbsp;as&nbsp;the&nbsp;cost&nbsp;of&nbsp;loading<br>
&nbsp;&nbsp;&lt;br&gt;<br>
a&nbsp;template&nbsp;on&nbsp;every&nbsp;request.&nbsp;This&nbsp;would&nbsp;be&nbsp;true&nbsp;whether&nbsp;or&nbsp;not&nbsp;you&nbsp;are<br>
&nbsp;&nbsp;&lt;br&gt;<br>
using&nbsp;threads.<br>
&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
Your&nbsp;next&nbsp;comment&nbsp;was:<br>
&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
&amp;nbsp;&nbsp;The&nbsp;problem&nbsp;I&nbsp;am&nbsp;running&nbsp;into&nbsp;is&nbsp;that&nbsp;if&nbsp;I&nbsp;run&nbsp;through&nbsp;the<br>
application,<br>
&nbsp;&nbsp;&lt;br&gt;<br>
&amp;nbsp;&nbsp;each&nbsp;request&nbsp;takes&nbsp;on&nbsp;average&nbsp;300&nbsp;ms&nbsp;to&nbsp;process.&amp;nbsp;&nbsp;However,&nbsp;when&nbsp;we<br>
&nbsp;&nbsp;&lt;br&gt;<br>
&amp;nbsp;&nbsp;benchmark&nbsp;with&nbsp;20&nbsp;concurrent&nbsp;users,&nbsp;the&nbsp;average&nbsp;goes&nbsp;up&nbsp;to&nbsp;around<br>
&nbsp;&nbsp;&lt;br&gt;<br>
&amp;nbsp;&nbsp;2200&nbsp;ms.&amp;nbsp;&nbsp;I&nbsp;am&nbsp;very&nbsp;sure&nbsp;that&nbsp;this&nbsp;is&nbsp;due&nbsp;to&nbsp;a&nbsp;thread&nbsp;locking<br>
&nbsp;&nbsp;&lt;br&gt;<br>
&amp;nbsp;&nbsp;shared&nbsp;objects&nbsp;in&nbsp;memory&nbsp;which&nbsp;results&nbsp;in&nbsp;another&nbsp;thread&nbsp;waiting&nbsp;for<br>
&nbsp;&nbsp;&lt;br&gt;<br>
&amp;nbsp;&nbsp;the&nbsp;lock&nbsp;to&nbsp;be&nbsp;released.<br>
&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
If&nbsp;each&nbsp;thread&nbsp;was&nbsp;trying&nbsp;to&nbsp;acquire&nbsp;the&nbsp;same&nbsp;lock&nbsp;before&nbsp;going&nbsp;into&nbsp;a<br>
&nbsp;&nbsp;&lt;br&gt;<br>
handler&nbsp;and&nbsp;only&nbsp;releasing&nbsp;it&nbsp;when&nbsp;exiting&nbsp;the&nbsp;handler,&nbsp;thus<br>
serialising<br>
&nbsp;&nbsp;&lt;br&gt;<br>
requests,&nbsp;what&nbsp;you&nbsp;are&nbsp;seeing&nbsp;would&nbsp;be&nbsp;expected.&nbsp;In&nbsp;short&nbsp;you&nbsp;were<br>
&nbsp;&nbsp;&lt;br&gt;<br>
simply&nbsp;overloading&nbsp;your&nbsp;servers&nbsp;ability&nbsp;to&nbsp;respond&nbsp;quickly&nbsp;enough.&nbsp;Add<br>
&nbsp;&nbsp;&lt;br&gt;<br>
even&nbsp;more&nbsp;concurrent&nbsp;users&nbsp;and&nbsp;the&nbsp;average&nbsp;would&nbsp;like&nbsp;keep&nbsp;growing.<br>
&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
Finally&nbsp;you&nbsp;said:<br>
&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
&amp;nbsp;&nbsp;If&nbsp;I&nbsp;take&nbsp;the&nbsp;thread&nbsp;locking&nbsp;mechanism&nbsp;out&nbsp;then&nbsp;we&nbsp;run&nbsp;into&nbsp;problems<br>
&nbsp;&nbsp;&lt;br&gt;<br>
&amp;nbsp;&nbsp;with&nbsp;there&nbsp;being&nbsp;too&nbsp;many&nbsp;connections&nbsp;being&nbsp;made&nbsp;to&nbsp;the&nbsp;MySQL&nbsp;db&nbsp;if<br>
&nbsp;&nbsp;&lt;br&gt;<br>
&amp;nbsp;&nbsp;the&nbsp;cached&nbsp;connection&nbsp;is&nbsp;being&nbsp;used&nbsp;and&nbsp;then&nbsp;the&nbsp;db&nbsp;starts&nbsp;dropping<br>
&nbsp;&nbsp;&lt;br&gt;<br>
&amp;nbsp;&nbsp;connections.<br>
&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
If&nbsp;there&nbsp;was&nbsp;indeed&nbsp;a&nbsp;lock&nbsp;around&nbsp;any&nbsp;handler&nbsp;call&nbsp;and&nbsp;you&nbsp;took&nbsp;it&nbsp;out,<br>
&nbsp;&nbsp;&lt;br&gt;<br>
you&nbsp;would&nbsp;at&nbsp;least&nbsp;still&nbsp;need&nbsp;to&nbsp;thread&nbsp;protect&nbsp;your&nbsp;database<br>
connection<br>
&nbsp;&nbsp;&lt;br&gt;<br>
pool/cache.<br>
&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
You&nbsp;might&nbsp;need&nbsp;to&nbsp;explain&nbsp;how&nbsp;you&nbsp;manage&nbsp;your&nbsp;database&nbsp;connections.<br>
&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
I&nbsp;haven't&nbsp;done&nbsp;database&nbsp;connection&nbsp;pooling&nbsp;in&nbsp;mod_python&nbsp;when&nbsp;using<br>
&nbsp;&nbsp;&lt;br&gt;<br>
threads&nbsp;yet&nbsp;but&nbsp;there&nbsp;are&nbsp;others&nbsp;here&nbsp;who&nbsp;have&nbsp;and&nbsp;may&nbsp;suggest&nbsp;the&nbsp;best<br>
ways<br>
&nbsp;&nbsp;&lt;br&gt;<br>
of&nbsp;doing&nbsp;it.<br>
&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
To&nbsp;me&nbsp;the&nbsp;simplest&nbsp;way&nbsp;would&nbsp;be&nbsp;to&nbsp;create&nbsp;a&nbsp;set&nbsp;of&nbsp;database&nbsp;connection<br>
&nbsp;&nbsp;&lt;br&gt;<br>
objects&nbsp;at&nbsp;startup&nbsp;and&nbsp;place&nbsp;these&nbsp;in&nbsp;a&nbsp;Queue.Queue&nbsp;object.&nbsp;As&nbsp;each<br>
request<br>
&nbsp;&nbsp;&lt;br&gt;<br>
comes&nbsp;in,&nbsp;it&nbsp;can&nbsp;get&nbsp;an&nbsp;available&nbsp;database&nbsp;connection&nbsp;off&nbsp;the&nbsp;queue,<br>
&nbsp;&nbsp;&lt;br&gt;<br>
use&nbsp;it&nbsp;then&nbsp;put&nbsp;it&nbsp;back.&nbsp;In&nbsp;practice,&nbsp;it&nbsp;probably&nbsp;needs&nbsp;to&nbsp;be&nbsp;a&nbsp;bit<br>
more<br>
&nbsp;&nbsp;&lt;br&gt;<br>
robust&nbsp;than&nbsp;that.<br>
&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
Anyway,&nbsp;confirm&nbsp;exactly&nbsp;what&nbsp;you&nbsp;meant&nbsp;by&nbsp;having&nbsp;thread&nbsp;locking&nbsp;going<br>
&nbsp;&nbsp;&lt;br&gt;<br>
into&nbsp;the&nbsp;handler&nbsp;and&nbsp;describe&nbsp;how&nbsp;you&nbsp;are&nbsp;managing&nbsp;the&nbsp;database<br>
&nbsp;&nbsp;&lt;br&gt;<br>
connections.&nbsp;Do&nbsp;you&nbsp;create&nbsp;a&nbsp;certain&nbsp;number&nbsp;of&nbsp;database&nbsp;connections&nbsp;at<br>
&nbsp;&nbsp;&lt;br&gt;<br>
startup,&nbsp;or&nbsp;on&nbsp;demand&nbsp;as&nbsp;required,&nbsp;but&nbsp;only&nbsp;up&nbsp;to&nbsp;a&nbsp;certain&nbsp;maximum?<br>
&nbsp;&nbsp;&lt;br&gt;<br>
Is&nbsp;your&nbsp;connection&nbsp;caching&nbsp;mechanism&nbsp;thread&nbsp;protected&nbsp;in&nbsp;any&nbsp;way?<br>
&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
Sorry&nbsp;again&nbsp;for&nbsp;getting&nbsp;off&nbsp;the&nbsp;track.&nbsp;:-)<br>
&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
Graham<br>
&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
