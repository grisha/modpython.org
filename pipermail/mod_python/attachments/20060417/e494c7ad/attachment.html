<tt>
&lt;!DOCTYPE&nbsp;HTML&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.0&nbsp;Transitional//EN&quot;&gt;<br>
&lt;HTML&gt;&lt;HEAD&gt;&lt;TITLE&gt;Output&nbsp;Filters&nbsp;Redeaux&lt;/TITLE&gt;<br>
&lt;META&nbsp;http-equiv=Content-Type&nbsp;content=&quot;text/html;&nbsp;charset=us-ascii&quot;&gt;<br>
&lt;META&nbsp;content=&quot;MSHTML&nbsp;6.00.2900.2873&quot;&nbsp;name=GENERATOR&gt;&lt;/HEAD&gt;<br>
&lt;BODY&gt;<br>
&lt;DIV&nbsp;dir=ltr&nbsp;align=left&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
class=390303016-17042006&gt;Greetings!&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&nbsp;dir=ltr&nbsp;align=left&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
class=390303016-17042006&gt;&lt;/SPAN&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&nbsp;dir=ltr&nbsp;align=left&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
class=390303016-17042006&gt;This&nbsp;is&nbsp;the&nbsp;code&nbsp;for&nbsp;a&nbsp;Mod&nbsp;Python&nbsp;output&nbsp;filter&nbsp;that&nbsp;<br>
performs&nbsp;an&nbsp;XSLT&nbsp;transform&nbsp;on&nbsp;XML&nbsp;data&nbsp;that&nbsp;I&nbsp;published&nbsp;a&nbsp;few&nbsp;weeks&nbsp;ago.&amp;nbsp;&nbsp;<br>
I've&nbsp;restructured&nbsp;it&nbsp;as&nbsp;an&nbsp;example&nbsp;application&nbsp;of&nbsp;the&nbsp;filter&nbsp;<br>
template:&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&nbsp;dir=ltr&nbsp;align=left&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
class=390303016-17042006&gt;&lt;/SPAN&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&nbsp;dir=ltr&nbsp;align=left&gt;&lt;FONT&nbsp;face=&quot;Courier&nbsp;New&quot;&nbsp;color=#0000ff&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
class=390303016-17042006&gt;from&nbsp;mod_python&nbsp;import&nbsp;apache&lt;BR&gt;from&nbsp;cStringIO&nbsp;import&nbsp;<br>
StringIO&lt;BR&gt;import&nbsp;lxml.etree&lt;BR&gt;import&nbsp;time&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=&quot;Courier&nbsp;New&quot;&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&nbsp;dir=ltr&nbsp;align=left&gt;&lt;FONT&nbsp;face=&quot;Courier&nbsp;New&quot;&nbsp;color=#0000ff&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
class=390303016-17042006&gt;name&nbsp;=&nbsp;'LXML'&lt;BR&gt;timestring&nbsp;=&nbsp;'Time&nbsp;to&nbsp;process&nbsp;XML/XSLT&nbsp;<br>
files&nbsp;using&nbsp;%s:&nbsp;%.3f&nbsp;milliseconds&nbsp;(%s&nbsp;pages&nbsp;per&nbsp;second)&nbsp;[%s&nbsp;<br>
pass]\n'&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=&quot;Courier&nbsp;New&quot;&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&nbsp;dir=ltr&nbsp;align=left&gt;&lt;FONT&nbsp;face=&quot;Courier&nbsp;New&quot;&nbsp;color=#0000ff&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
class=390303016-17042006&gt;xsltfile&nbsp;=&nbsp;<br>
open('c:/webdev/sites/crashtest/templates/template.xslt',&nbsp;'rU')&lt;BR&gt;styledoc&nbsp;=&nbsp;<br>
lxml.etree.parse(StringIO(xsltfile.read()))&lt;BR&gt;transformer&nbsp;=&nbsp;<br>
lxml.etree.XSLT(styledoc)&lt;BR&gt;xsltfile.close()&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=&quot;Courier&nbsp;New&quot;&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&nbsp;dir=ltr&nbsp;align=left&gt;&lt;FONT&nbsp;face=&quot;Courier&nbsp;New&quot;&nbsp;color=#0000ff&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
class=390303016-17042006&gt;def&nbsp;outputfilter&nbsp;<br>
(filter):&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;try:&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
streambuffer&nbsp;=&nbsp;filter.req.streambuffer&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;except&nbsp;<br>
AttributeError:&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
filter.req.streambuffer&nbsp;=&nbsp;<br>
StringIO()&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;streambuffer&nbsp;=&nbsp;<br>
filter.req.streambuffer&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
filter.req.start&nbsp;=&nbsp;time.clock()&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
filter.req.passes&nbsp;=&nbsp;0&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;streamlet&nbsp;=&nbsp;filter.read()&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;while&nbsp;<br>
streamlet:&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;filter.req.passes&nbsp;+=&nbsp;<br>
1&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
streambuffer.write(streamlet.replace('\r\n',&nbsp;<br>
'\n'))&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;streamlet&nbsp;=&nbsp;<br>
filter.read()&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=&quot;Courier&nbsp;New&quot;&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&nbsp;dir=ltr&nbsp;align=left&gt;&lt;FONT&nbsp;face=&quot;Courier&nbsp;New&quot;&nbsp;color=#0000ff&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
class=390303016-17042006&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;streamlet&nbsp;is&nbsp;<br>
None:&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;doc&nbsp;=&nbsp;<br>
lxml.etree.parse(streambuffer)&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
doc.xinclude()&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;result&nbsp;=&nbsp;<br>
str(transformer(doc))&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;end&nbsp;=&nbsp;<br>
time.clock()&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;start&nbsp;=&nbsp;<br>
filter.req.start&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;passes&nbsp;=&nbsp;<br>
filter.req.passes&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;ms&nbsp;=&nbsp;<br>
(end-start)*1000&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;pps&nbsp;=&nbsp;<br>
int(1/(end-start))&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;timestamp&nbsp;=&nbsp;<br>
timestring&nbsp;%&nbsp;(name,&nbsp;ms,&nbsp;pps,&nbsp;<br>
passes)&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
filter.write(result.replace('benchmark',&nbsp;<br>
timestamp))&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
filter.close()&lt;BR&gt;&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;nbsp;&lt;/DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;size=2&gt;&lt;/FONT&gt;&lt;BR&gt;&lt;BR&gt;<br>
&lt;P&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;Best&nbsp;Regards,&lt;/FONT&gt;&nbsp;&lt;BR&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;Lee&nbsp;<br>
E.&nbsp;Brown&lt;/FONT&gt;&nbsp;&lt;BR&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;(leebrown@leebrown.org)&lt;/FONT&gt;&nbsp;<br>
&lt;/P&gt;&lt;/BODY&gt;&lt;/HTML&gt;<br>

</tt>
