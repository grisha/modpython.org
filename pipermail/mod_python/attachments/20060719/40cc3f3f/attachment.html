<tt>
&lt;html&nbsp;xmlns:o=&quot;urn:schemas-microsoft-com:office:office&quot;&nbsp;xmlns:w=&quot;urn:schemas-microsoft-com:office:word&quot;&nbsp;xmlns=&quot;http://www.w3.org/TR/REC-html40&quot;&gt;<br>
<br>
&lt;head&gt;<br>
&lt;meta&nbsp;http-equiv=Content-Type&nbsp;content=&quot;text/html;&nbsp;charset=us-ascii&quot;&gt;<br>
&lt;meta&nbsp;name=Generator&nbsp;content=&quot;Microsoft&nbsp;Word&nbsp;11&nbsp;(filtered&nbsp;medium)&quot;&gt;<br>
&lt;style&gt;<br>
&lt;!--<br>
&nbsp;/*&nbsp;Style&nbsp;Definitions&nbsp;*/<br>
&nbsp;p.MsoNormal,&nbsp;li.MsoNormal,&nbsp;div.MsoNormal<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp{margin:0in;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspmargin-bottom:.0001pt;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfont-size:12.0pt;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfont-family:&quot;Times&nbsp;New&nbsp;Roman&quot;;}<br>
a:link,&nbsp;span.MsoHyperlink<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp{color:blue;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptext-decoration:underline;}<br>
a:visited,&nbsp;span.MsoHyperlinkFollowed<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp{color:#606420;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptext-decoration:underline;}<br>
code<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp{font-family:&quot;Courier&nbsp;New&quot;;}<br>
span.E-mailStijl17<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp{mso-style-type:personal-compose;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfont-family:Arial;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcolor:windowtext;}<br>
@page&nbsp;Section1<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp{size:8.5in&nbsp;11.0in;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspmargin:1.0in&nbsp;1.25in&nbsp;1.0in&nbsp;1.25in;}<br>
div.Section1<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp{page:Section1;}<br>
--&gt;<br>
&lt;/style&gt;<br>
<br>
&lt;/head&gt;<br>
<br>
&lt;body&nbsp;lang=EN-US&nbsp;link=blue&nbsp;vlink=&quot;#606420&quot;&gt;<br>
<br>
&lt;div&nbsp;class=Section1&gt;<br>
<br>
&lt;p&nbsp;class=MsoNormal&gt;&lt;font&nbsp;size=2&nbsp;face=Arial&gt;&lt;span&nbsp;style='font-size:10.0pt;<br>
font-family:Arial'&gt;Hi&nbsp;all,&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=MsoNormal&gt;&lt;font&nbsp;size=2&nbsp;face=Arial&gt;&lt;span&nbsp;style='font-size:10.0pt;<br>
font-family:Arial'&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=MsoNormal&gt;&lt;font&nbsp;size=2&nbsp;face=Arial&gt;&lt;span&nbsp;style='font-size:10.0pt;<br>
font-family:Arial'&gt;I&nbsp;started&nbsp;the&nbsp;development&nbsp;of&nbsp;a&nbsp;specific&nbsp;kind&nbsp;of&nbsp;CMS&nbsp;over&nbsp;2<br>
years&nbsp;ago,&nbsp;and&nbsp;due&nbsp;to&nbsp;sparse&nbsp;documentation&nbsp;I&nbsp;am&nbsp;still&nbsp;puzzled&nbsp;about&nbsp;a&nbsp;few<br>
things.&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=MsoNormal&gt;&lt;font&nbsp;size=2&nbsp;face=Arial&gt;&lt;span&nbsp;style='font-size:10.0pt;<br>
font-family:Arial'&gt;Basically&nbsp;it&nbsp;consist&nbsp;of&nbsp;one&nbsp;.py&nbsp;and&nbsp;a&nbsp;mysqldatabase&nbsp;with&nbsp;all<br>
the&nbsp;data&nbsp;and&nbsp;templates,&nbsp;ALL&nbsp;pages&nbsp;are&nbsp;generated&nbsp;on&nbsp;the&nbsp;fly.&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=MsoNormal&gt;&lt;font&nbsp;size=2&nbsp;face=Arial&gt;&lt;span&nbsp;style='font-size:10.0pt;<br>
font-family:Arial'&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=MsoNormal&gt;&lt;font&nbsp;size=2&nbsp;face=Arial&gt;&lt;span&nbsp;style='font-size:10.0pt;<br>
font-family:Arial'&gt;First&nbsp;of&nbsp;all&nbsp;I&nbsp;am&nbsp;confused&nbsp;about&nbsp;PythonInterPerDirectory&nbsp;and<br>
PythonInterpPerDirectory&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=MsoNormal&gt;&lt;font&nbsp;size=2&nbsp;face=Arial&gt;&lt;span&nbsp;style='font-size:10.0pt;<br>
font-family:Arial'&gt;In&nbsp;the&nbsp;way&nbsp;I&nbsp;use&nbsp;modpython.&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=MsoNormal&gt;&lt;font&nbsp;size=2&nbsp;face=Arial&gt;&lt;span&nbsp;style='font-size:10.0pt;<br>
font-family:Arial'&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=MsoNormal&gt;&lt;font&nbsp;size=2&nbsp;face=Arial&gt;&lt;span&nbsp;style='font-size:10.0pt;<br>
font-family:Arial'&gt;My&nbsp;apache&nbsp;has&nbsp;no&nbsp;configured&nbsp;virtual&nbsp;hosts&nbsp;since&nbsp;my&nbsp;CMS&nbsp;can<br>
handle&nbsp;this&nbsp;on&nbsp;its&nbsp;own&nbsp;by&nbsp;looking&nbsp;at&nbsp;req.host&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=MsoNormal&gt;&lt;font&nbsp;size=2&nbsp;face=Arial&gt;&lt;span&nbsp;style='font-size:10.0pt;<br>
font-family:Arial'&gt;On&nbsp;one&nbsp;site&nbsp;which&nbsp;is&nbsp;running&nbsp;on&nbsp;my&nbsp;system&nbsp;(&nbsp;&lt;a<br>
href=&quot;http://www.mkbok.nl/&quot;&gt;http://www.mkbok.nl&lt;/a&gt;&nbsp;)&nbsp;we&nbsp;use&nbsp;different<br>
subdomains,&nbsp;so&nbsp;basically&nbsp;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=MsoNormal&gt;&lt;font&nbsp;size=2&nbsp;face=Arial&gt;&lt;span&nbsp;style='font-size:10.0pt;<br>
font-family:Arial'&gt;the&nbsp;page&nbsp;to&nbsp;be&nbsp;build&nbsp;is&nbsp;derived&nbsp;from&nbsp;the&nbsp;req.host&nbsp;(e.g.&nbsp;xxx.yyy.mkbok.nl)<br>
where&nbsp;xxx&nbsp;and&nbsp;yyy&nbsp;are&nbsp;variable.&nbsp;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=MsoNormal&gt;&lt;font&nbsp;size=2&nbsp;face=Arial&gt;&lt;span&nbsp;style='font-size:10.0pt;<br>
font-family:Arial'&gt;This&nbsp;is&nbsp;done&nbsp;by&nbsp;DNS&nbsp;records&nbsp;like&amp;nbsp;&amp;nbsp;<br>
*&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;A&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;ip1.ip2.ip3.ip4&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=MsoNormal&gt;&lt;font&nbsp;size=2&nbsp;face=Arial&gt;&lt;span&nbsp;style='font-size:10.0pt;<br>
font-family:Arial'&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=MsoNormal&gt;&lt;font&nbsp;size=2&nbsp;face=Arial&gt;&lt;span&nbsp;style='font-size:10.0pt;<br>
font-family:Arial'&gt;My&nbsp;next&nbsp;problem&nbsp;seems&nbsp;mysql&nbsp;and&nbsp;mysqldb.&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=MsoNormal&gt;&lt;font&nbsp;size=2&nbsp;face=Arial&gt;&lt;span&nbsp;style='font-size:10.0pt;<br>
font-family:Arial'&gt;Since&nbsp;I&nbsp;do&nbsp;not&nbsp;know&nbsp;which&nbsp;website&nbsp;is&nbsp;requested&nbsp;(multiple&nbsp;are<br>
running&nbsp;on&nbsp;that&nbsp;server)&nbsp;I&nbsp;open&nbsp;a&nbsp;database&nbsp;connection,&nbsp;do&nbsp;my&nbsp;stuff&nbsp;and&nbsp;close&nbsp;the<br>
connection,&nbsp;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=MsoNormal&gt;&lt;font&nbsp;size=2&nbsp;face=Arial&gt;&lt;span&nbsp;style='font-size:10.0pt;<br>
font-family:Arial'&gt;Again&nbsp;the&nbsp;database&nbsp;selection&nbsp;comes&nbsp;from&nbsp;req.host,&nbsp;and&nbsp;here<br>
the&nbsp;domainname&nbsp;is&nbsp;used&nbsp;for&nbsp;database&nbsp;selection.&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=MsoNormal&gt;&lt;font&nbsp;size=2&nbsp;face=Arial&gt;&lt;span&nbsp;style='font-size:10.0pt;<br>
font-family:Arial'&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=MsoNormal&gt;&lt;font&nbsp;size=2&nbsp;face=Arial&gt;&lt;span&nbsp;style='font-size:10.0pt;<br>
font-family:Arial'&gt;The&nbsp;system&nbsp;runs&nbsp;extremely&nbsp;well,&nbsp;but&nbsp;once&nbsp;in&nbsp;a&nbsp;while&nbsp;the<br>
webserver&nbsp;becomes&nbsp;so&nbsp;busy&nbsp;that&nbsp;it&nbsp;does&nbsp;not&nbsp;respond&nbsp;to&nbsp;page&nbsp;request&nbsp;anymore.&nbsp;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=MsoNormal&gt;&lt;font&nbsp;size=2&nbsp;face=Arial&gt;&lt;span&nbsp;style='font-size:10.0pt;<br>
font-family:Arial'&gt;We&nbsp;suspect&nbsp;that&nbsp;mysql&nbsp;is&nbsp;the&nbsp;problem&nbsp;here&nbsp;since&nbsp;the&nbsp;only<br>
thing&nbsp;we&nbsp;can&nbsp;see&nbsp;is&nbsp;mysql&nbsp;is&nbsp;consuming&nbsp;more&nbsp;and&nbsp;more&nbsp;swapspace&nbsp;and&nbsp;at&nbsp;some<br>
point&nbsp;it&nbsp;runs&nbsp;out&nbsp;of&nbsp;resources&nbsp;and&nbsp;starts&nbsp;looping.&nbsp;At&nbsp;that&nbsp;point&nbsp;the&nbsp;system&nbsp;(Linux)<br>
keeps&nbsp;running&nbsp;but&nbsp;with&nbsp;a&nbsp;100%&nbsp;cpu&nbsp;utilization&nbsp;and&nbsp;we&nbsp;are&nbsp;unable&nbsp;to&nbsp;login&nbsp;and<br>
investigate.&nbsp;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=MsoNormal&gt;&lt;font&nbsp;size=2&nbsp;face=Arial&gt;&lt;span&nbsp;style='font-size:10.0pt;<br>
font-family:Arial'&gt;So&nbsp;logging&nbsp;in&nbsp;to&nbsp;the&nbsp;UPS&nbsp;remotely&nbsp;and&nbsp;power&nbsp;down&nbsp;the&nbsp;system<br>
by&nbsp;virtually&nbsp;unplugging&nbsp;the&nbsp;cable&nbsp;is&nbsp;the&nbsp;only&nbsp;(and&nbsp;BAD)&nbsp;solution.&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=MsoNormal&gt;&lt;font&nbsp;size=2&nbsp;face=Arial&gt;&lt;span&nbsp;style='font-size:10.0pt;<br>
font-family:Arial'&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=MsoNormal&gt;&lt;font&nbsp;size=2&nbsp;face=Arial&gt;&lt;span&nbsp;style='font-size:10.0pt;<br>
font-family:Arial'&gt;So&nbsp;what&nbsp;is&nbsp;best&nbsp;practice&nbsp;when&nbsp;you&nbsp;have&nbsp;to&nbsp;connect&nbsp;to&nbsp;mysql<br>
with&nbsp;mysqldb&nbsp;in&nbsp;a&nbsp;mod_python&nbsp;environment&nbsp;keeping&nbsp;in&nbsp;mind&nbsp;that&nbsp;the&nbsp;database<br>
connection&nbsp;has&nbsp;to&nbsp;be&nbsp;build&nbsp;every&nbsp;time&nbsp;a&nbsp;visitor&nbsp;requests&nbsp;a&nbsp;page?&nbsp;Think&nbsp;in&nbsp;terms<br>
of&nbsp;a&nbsp;&amp;#8220;globally&amp;#8221;&nbsp;available&nbsp;db&nbsp;or&nbsp;db.cursor&nbsp;connection.&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=MsoNormal&gt;&lt;font&nbsp;size=2&nbsp;face=Arial&gt;&lt;span&nbsp;style='font-size:10.0pt;<br>
font-family:Arial'&gt;Since&nbsp;global&nbsp;variables&nbsp;are&nbsp;troublesome&nbsp;in&nbsp;the&nbsp;.py&nbsp;contaning<br>
the&nbsp;handler&nbsp;I&nbsp;use&nbsp;a&nbsp;class&nbsp;from&nbsp;which&nbsp;an&nbsp;instance&nbsp;is&nbsp;created&nbsp;every&nbsp;time&nbsp;a&nbsp;client<br>
connects&nbsp;and&nbsp;the&nbsp;DB&nbsp;connection&nbsp;is&nbsp;global&nbsp;to&nbsp;that&nbsp;class,&nbsp;ist&nbsp;that&nbsp;wrong?&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=MsoNormal&gt;&lt;font&nbsp;size=2&nbsp;face=Arial&gt;&lt;span&nbsp;style='font-size:10.0pt;<br>
font-family:Arial'&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=MsoNormal&gt;&lt;font&nbsp;size=2&nbsp;face=Arial&gt;&lt;span&nbsp;style='font-size:10.0pt;<br>
font-family:Arial'&gt;What&nbsp;happenens&nbsp;if&nbsp;mod_python&nbsp;finds&nbsp;an&nbsp;error&nbsp;before&nbsp;my<br>
mysqldb&nbsp;connection&nbsp;is&nbsp;closed&nbsp;(not&nbsp;that&nbsp;this&nbsp;happenes&nbsp;a&nbsp;lot,&nbsp;but&nbsp;it&nbsp;does&nbsp;happen,<br>
sorry)&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=MsoNormal&gt;&lt;font&nbsp;size=2&nbsp;face=Arial&gt;&lt;span&nbsp;style='font-size:10.0pt;<br>
font-family:Arial'&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=MsoNormal&gt;&lt;font&nbsp;size=2&nbsp;face=Arial&gt;&lt;span&nbsp;style='font-size:10.0pt;<br>
font-family:Arial'&gt;Also&nbsp;I&nbsp;do&nbsp;not&nbsp;understand&nbsp;the&nbsp;&lt;/span&gt;&lt;/font&gt;&lt;code&gt;&lt;font<br>
size=2&nbsp;face=&quot;Courier&nbsp;New&quot;&gt;&lt;span&nbsp;style='font-size:10.0pt'&gt;req.register_cleanup()<br>
method,&nbsp;what&nbsp;is&nbsp;cleaned&nbsp;up&nbsp;and&nbsp;what&nbsp;not?&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/font&gt;&lt;/code&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=MsoNormal&gt;&lt;code&gt;&lt;font&nbsp;size=2&nbsp;face=&quot;Courier&nbsp;New&quot;&gt;&lt;span<br>
style='font-size:10.0pt'&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/span&gt;&lt;/font&gt;&lt;/code&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=MsoNormal&gt;&lt;code&gt;&lt;font&nbsp;size=2&nbsp;face=&quot;Courier&nbsp;New&quot;&gt;&lt;span<br>
style='font-size:10.0pt'&gt;Martijn&lt;/span&gt;&lt;/font&gt;&lt;/code&gt;&lt;font&nbsp;size=2&nbsp;face=Arial&gt;&lt;span<br>
style='font-size:10.0pt;font-family:Arial'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=MsoNormal&gt;&lt;font&nbsp;size=2&nbsp;face=Arial&gt;&lt;span&nbsp;style='font-size:10.0pt;<br>
font-family:Arial'&gt;&amp;nbsp;&amp;nbsp;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
<br>
&lt;/div&gt;<br>
<br>
&lt;/body&gt;<br>
<br>
&lt;/html&gt;<br>

</tt>
