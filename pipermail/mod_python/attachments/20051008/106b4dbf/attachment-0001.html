<tt>
&lt;HTML&gt;&lt;BODY&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-khtml-nbsp-mode:&nbsp;space;&nbsp;-khtml-line-break:&nbsp;after-white-space;&nbsp;&quot;&gt;&lt;BR&gt;&lt;DIV&gt;&lt;DIV&gt;On&nbsp;07/10/2005,&nbsp;at&nbsp;11:28&nbsp;PM,&nbsp;Fabiano&nbsp;Sidler&nbsp;wrote:&lt;/DIV&gt;&lt;BR&gt;&lt;BLOCKQUOTE&nbsp;type=&quot;cite&quot;&gt;&lt;DIV&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;&quot;&gt;Therefore&nbsp;I&nbsp;need&nbsp;to&nbsp;store&nbsp;the&nbsp;req&nbsp;object&nbsp;globally,&nbsp;but&nbsp;in&nbsp;a&lt;SPAN&nbsp;class=&quot;Apple-converted-space&quot;&gt; &nbsp;&lt;/SPAN&gt;threadsafe&lt;SPAN&nbsp;class=&quot;Apple-converted-space&quot;&gt; &lt;/SPAN&gt;&lt;/DIV&gt;&lt;DIV&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;&quot;&gt;manner.&nbsp;Actually,&nbsp;I&nbsp;wrote&nbsp;a&nbsp;pure&nbsp;static&nbsp;class&nbsp;returning&nbsp;the&nbsp;thread's&nbsp;req&lt;/DIV&gt;&lt;DIV&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;&quot;&gt;object&nbsp;to&nbsp;the&nbsp;caller,&nbsp;which&nbsp;I'm&nbsp;going&nbsp;to&nbsp;use&nbsp;in&nbsp;the&nbsp;lower&nbsp;level&nbsp;code&nbsp;of&nbsp;my&lt;/DIV&gt;&lt;DIV&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;&quot;&gt;application&nbsp;otherwise&nbsp;written&nbsp;as&nbsp;portable&nbsp;as&nbsp;possible.&lt;/DIV&gt;&lt;/BLOCKQUOTE&gt;&lt;DIV&gt;&lt;BR&nbsp;class=&quot;khtml-block-placeholder&quot;&gt;&lt;/DIV&gt;FWIW,&nbsp;you&nbsp;might&nbsp;look&nbsp;at:&lt;/DIV&gt;&lt;DIV&gt;&lt;BR&nbsp;class=&quot;khtml-block-placeholder&quot;&gt;&lt;/DIV&gt;&lt;DIV&gt;  &lt;A&nbsp;href=&quot;http://www.modpython.org/pipermail/mod_python/2005-September/019071.html&quot;&gt;http://www.modpython.org/pipermail/mod_python/2005-September/019071.html&lt;/A&gt;&lt;/DIV&gt;&lt;DIV&gt;&lt;BR&nbsp;class=&quot;khtml-block-placeholder&quot;&gt;&lt;/DIV&gt;&lt;DIV&gt;It&nbsp;isn't&nbsp;a&nbsp;simple&nbsp;matter&nbsp;of&nbsp;just&nbsp;storing&nbsp;the&nbsp;request&nbsp;object&nbsp;based&nbsp;on&nbsp;the&lt;/DIV&gt;&lt;DIV&gt;thread.&nbsp;You&nbsp;have&nbsp;to&nbsp;consider&nbsp;that&nbsp;a&nbsp;handler&nbsp;can&nbsp;do&nbsp;an&nbsp;internal&nbsp;redirect&lt;/DIV&gt;&lt;DIV&gt;which&nbsp;will&nbsp;result&nbsp;in&nbsp;the&nbsp;same&nbsp;thread&nbsp;having&nbsp;to&nbsp;deal&nbsp;with&nbsp;a&nbsp;new&nbsp;request&lt;/DIV&gt;&lt;DIV&gt;object.&nbsp;You&nbsp;therefore&nbsp;need&nbsp;a&nbsp;stack&nbsp;onto&nbsp;which&nbsp;you&nbsp;push&nbsp;the&nbsp;request&lt;/DIV&gt;&lt;DIV&gt;object&nbsp;and&nbsp;pop&nbsp;it&nbsp;off&nbsp;when&nbsp;done.&lt;/DIV&gt;&lt;DIV&gt;&lt;BR&nbsp;class=&quot;khtml-block-placeholder&quot;&gt;&lt;/DIV&gt;&lt;DIV&gt;This&nbsp;though&nbsp;still&nbsp;doesn't&nbsp;contend&nbsp;with&nbsp;the&nbsp;strange&nbsp;situation&nbsp;you&nbsp;are&lt;/DIV&gt;&lt;DIV&gt;going&nbsp;to&nbsp;have&nbsp;where&nbsp;the&nbsp;handler&nbsp;actually&nbsp;triggers&nbsp;separate&nbsp;threads&lt;/DIV&gt;&lt;DIV&gt;to&nbsp;do&nbsp;the&nbsp;work.&nbsp;Those&nbsp;separate&nbsp;threads&nbsp;will&nbsp;not&nbsp;be&nbsp;able&nbsp;to&nbsp;access&nbsp;the&lt;/DIV&gt;&lt;DIV&gt;request&nbsp;object&nbsp;using&nbsp;their&nbsp;own&nbsp;thread&nbsp;identifier&nbsp;as&nbsp;key&nbsp;as&nbsp;it&nbsp;will&nbsp;be&lt;/DIV&gt;&lt;DIV&gt;different&nbsp;to&nbsp;the&nbsp;main&nbsp;handler&nbsp;thread.&lt;/DIV&gt;&lt;DIV&gt;&lt;BR&nbsp;class=&quot;khtml-block-placeholder&quot;&gt;&lt;/DIV&gt;&lt;DIV&gt;Not&nbsp;sure&nbsp;how&nbsp;you&nbsp;intend&nbsp;dealing with&nbsp;that,&nbsp;but&nbsp;then,&nbsp;since&nbsp;you&nbsp;are&lt;/DIV&gt;&lt;DIV&gt;using&nbsp;prefork&nbsp;and&nbsp;not&nbsp;a&nbsp;threaded&nbsp;MPM,&nbsp;you&nbsp;will&nbsp;probably&nbsp;have&lt;/DIV&gt;&lt;DIV&gt;something&nbsp;simpler&nbsp;anyway.&nbsp;Your&nbsp;code&nbsp;though&nbsp;probably&nbsp;will&nbsp;not&nbsp;work&lt;/DIV&gt;&lt;DIV&gt;in&nbsp;a&nbsp;threaded&nbsp;MPM,&nbsp;so&nbsp;isn't&nbsp;going&nbsp;to&nbsp;be&nbsp;portable&nbsp;to&nbsp;&quot;winnt&quot;&nbsp;or&nbsp;&quot;worker&quot;&lt;/DIV&gt;&lt;DIV&gt;MPM.&lt;/DIV&gt;&lt;DIV&gt;&lt;BR&nbsp;class=&quot;khtml-block-placeholder&quot;&gt;&lt;/DIV&gt;&lt;BLOCKQUOTE&nbsp;type=&quot;cite&quot;&gt;&lt;DIV&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;&quot;&gt;The&nbsp;handler&nbsp;function&nbsp;should&nbsp;become&nbsp;the&nbsp;smallest&nbsp;thing&nbsp;in&nbsp;my&nbsp;application.&lt;/DIV&gt;&lt;DIV&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;&quot;&gt;I&nbsp;want&nbsp;to&nbsp;build&nbsp;the&nbsp;application&nbsp;as&nbsp;a&nbsp;set&nbsp;of&nbsp;classes&nbsp;on&nbsp;top&nbsp;of&nbsp;everything&nbsp;and &lt;/DIV&gt;&lt;DIV&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;&quot;&gt;have&nbsp;the&nbsp;handler&nbsp;only&nbsp;create&nbsp;these&nbsp;classes&nbsp;and&nbsp;then&nbsp;pass&nbsp;them&nbsp;the&nbsp;control. &lt;/DIV&gt;&lt;/BLOCKQUOTE&gt;&lt;DIV&gt;&lt;BR&nbsp;class=&quot;khtml-block-placeholder&quot;&gt;&lt;/DIV&gt;&lt;DIV&gt;If&nbsp;the&nbsp;aim&nbsp;is&nbsp;to&nbsp;make&nbsp;the&nbsp;handler&nbsp;only&nbsp;deal&nbsp;with&nbsp;view&nbsp;presentation,&nbsp;I&lt;/DIV&gt;&lt;DIV&gt;still&nbsp;don't&nbsp;see&nbsp;the&nbsp;need&nbsp;for&nbsp;threads,&nbsp;a&nbsp;simple&nbsp;separation&nbsp;of&nbsp;view&nbsp;and&lt;/DIV&gt;&lt;DIV&gt;control code from&nbsp;the&nbsp;main&nbsp;model&nbsp;code&nbsp;of&nbsp;the&nbsp;application&nbsp;is&nbsp;generally&lt;/DIV&gt;&lt;DIV&gt;sufficient.&nbsp;I&nbsp;feel&nbsp;that&nbsp;threads&nbsp;generally&nbsp;only&nbsp;serve&nbsp;to&nbsp;complicate&nbsp;code&lt;/DIV&gt;&lt;DIV&gt;and&nbsp;make&nbsp;it&nbsp;harder&nbsp;to&nbsp;get&nbsp;right.&nbsp;There&nbsp;are&nbsp;a&nbsp;lot&nbsp;of&nbsp;traps&nbsp;in&nbsp;thread&lt;/DIV&gt;&lt;DIV&gt;programming&nbsp;to&nbsp;begin&nbsp;with&nbsp;and&nbsp;mod_python&nbsp;doesn't&nbsp;make&nbsp;it&nbsp;any&lt;/DIV&gt;&lt;DIV&gt;easier&nbsp;with&nbsp;its&nbsp;own&nbsp;set&nbsp;of&nbsp;gotchas&nbsp;when&nbsp;using&nbsp;threads.&lt;/DIV&gt;&lt;DIV&gt;&lt;BR&nbsp;class=&quot;khtml-block-placeholder&quot;&gt;&lt;/DIV&gt;&lt;DIV&gt;Where&nbsp;real&nbsp;clear&nbsp;separation&nbsp;is&nbsp;required,&nbsp;a&nbsp;better&nbsp;approach&nbsp;may&nbsp;be&lt;/DIV&gt;&lt;DIV&gt;to&nbsp;host&nbsp;the&nbsp;whole&nbsp;core&nbsp;of&nbsp;the&nbsp;application&nbsp;in&nbsp;a&nbsp;separate&nbsp;process&nbsp;and&lt;/DIV&gt;&lt;DIV&gt;use&nbsp;something&nbsp;like&nbsp;XML-RPC&nbsp;to&nbsp;communicate&nbsp;from&nbsp;the&nbsp;handler&lt;/DIV&gt;&lt;DIV&gt;to&nbsp;the&nbsp;backend&nbsp;system.&nbsp;The&nbsp;handler&nbsp;then&nbsp;becomes&nbsp;a&nbsp;series&nbsp;of&nbsp;call&lt;/DIV&gt;&lt;DIV&gt;outs&nbsp;to&nbsp;do&nbsp;things&nbsp;with&nbsp;results&nbsp;being&nbsp;formatted&nbsp;into&nbsp;a&nbsp;result.&lt;/DIV&gt;&lt;DIV&gt;&lt;BR&nbsp;class=&quot;khtml-block-placeholder&quot;&gt;&lt;/DIV&gt;&lt;DIV&gt;In&nbsp;the&nbsp;extreme,&nbsp;a&nbsp;full&nbsp;blown&nbsp;messaging&nbsp;system&nbsp;could&nbsp;be&nbsp;used&nbsp;allowing&lt;/DIV&gt;&lt;DIV&gt;construction&nbsp;of&nbsp;a&nbsp;service&nbsp;oriented&nbsp;like&nbsp;architecture&nbsp;where&nbsp;service&lt;/DIV&gt;&lt;DIV&gt;agents&nbsp;could&nbsp;reside&nbsp;in&nbsp;distinct&nbsp;processes&nbsp;or&nbsp;in&nbsp;the&nbsp;Apache&nbsp;process.&lt;/DIV&gt;&lt;DIV&gt;Through&nbsp;appropriate&nbsp;use&nbsp;of&nbsp;threading&nbsp;in&nbsp;conjunction&nbsp;with&nbsp;the&nbsp;event&lt;/DIV&gt;&lt;DIV&gt;driven&nbsp;messaging&nbsp;system,&nbsp;service&nbsp;agents&nbsp;in&nbsp;the&nbsp;Apache&nbsp;process&nbsp;and&lt;/DIV&gt;&lt;DIV&gt;the&nbsp;backend&nbsp;can be&nbsp;active&nbsp;standalone&nbsp;agents&nbsp;that&nbsp;still&nbsp;communicate&lt;/DIV&gt;&lt;DIV&gt;with&nbsp;each&nbsp;other&nbsp;independent&nbsp;of&nbsp;HTTP&nbsp;requests,&nbsp;but&nbsp;still&nbsp;service&nbsp;requests&lt;/DIV&gt;&lt;DIV&gt;from&nbsp;the&nbsp;handlers&nbsp;as&nbsp;well.&lt;/DIV&gt;&lt;DIV&gt;&lt;BR&nbsp;class=&quot;khtml-block-placeholder&quot;&gt;&lt;/DIV&gt;&lt;DIV&gt;Note&nbsp;that&nbsp;in&nbsp;this&nbsp;case&nbsp;the&nbsp;service&nbsp;agent framework&nbsp;is&nbsp;there&nbsp;only&nbsp;to&lt;/DIV&gt;&lt;DIV&gt;support&nbsp;the&nbsp;internal&nbsp;operation&nbsp;of&nbsp;your application,&nbsp;just&nbsp;because&nbsp;I&nbsp;use &lt;/DIV&gt;&lt;DIV&gt;the&nbsp;SOA&nbsp;term&nbsp;doesn't&nbsp;mean&nbsp;SOAP&nbsp;is&nbsp;involved&nbsp;or&nbsp;that&nbsp;users&nbsp;are&lt;/DIV&gt;&lt;DIV&gt;making&nbsp;direct&nbsp;calls&nbsp;to&nbsp;service&nbsp;agents&nbsp;via&nbsp;HTTP.&lt;/DIV&gt;&lt;DIV&gt;&lt;BR&gt;&lt;BLOCKQUOTE&nbsp;type=&quot;cite&quot;&gt;&lt;BLOCKQUOTE&nbsp;type=&quot;cite&quot;&gt;&lt;DIV&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;&quot;&gt;What&nbsp;you&nbsp;are&nbsp;better&nbsp;off&nbsp;doing&nbsp;is&nbsp;catching&nbsp;any&nbsp;exceptions&nbsp;in&nbsp;the&nbsp;separate&lt;/DIV&gt;&lt;DIV&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;&quot;&gt;thread,&nbsp;formatting&nbsp;your&nbsp;own&nbsp;exception&nbsp;traceback&nbsp;and&nbsp;details&nbsp;and&nbsp;logging&lt;/DIV&gt;&lt;DIV&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;&quot;&gt;it&nbsp;directly&nbsp;to&nbsp;the&nbsp;Apache&nbsp;log&nbsp;using&nbsp;the&nbsp;apache.log_error()&nbsp;function&lt;/DIV&gt;&lt;DIV&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;&quot;&gt;provided&nbsp;with&nbsp;mod_python.&nbsp;This&nbsp;is&nbsp;possibly&nbsp;the&nbsp;only&nbsp;way&nbsp;to&nbsp;get&nbsp;the&lt;/DIV&gt;&lt;DIV&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;&quot;&gt;information&nbsp;to&nbsp;appear&nbsp;immediately.&lt;/DIV&gt;&nbsp;&lt;BR&gt;&lt;/BLOCKQUOTE&gt;&lt;DIV&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;min-height:&nbsp;14px;&nbsp;&quot;&gt;&lt;BR&gt;&lt;/DIV&gt;&lt;DIV&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;&quot;&gt;The&nbsp;problem&nbsp;is,&nbsp;raised&nbsp;exceptions&nbsp;should&nbsp;be&nbsp;communicated&nbsp;to&nbsp;the&nbsp;client&nbsp;because&lt;/DIV&gt;&lt;DIV&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;&quot;&gt;I&nbsp;intend&nbsp;to&nbsp;raise&nbsp;exceptions&nbsp;in&nbsp;my&nbsp;application&nbsp;too.&nbsp;That's&nbsp;why&nbsp;I&nbsp;need&lt;/DIV&gt;&lt;DIV&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;&quot;&gt;exceptions&nbsp;to&nbsp;be&nbsp;brought&nbsp;to&nbsp;the&nbsp;thread&nbsp;in&nbsp;which&nbsp;handler()&nbsp;was&nbsp;called.&lt;/DIV&gt;&lt;/BLOCKQUOTE&gt;&lt;/DIV&gt;&lt;BR&gt;&lt;DIV&gt;&lt;FONT&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#0000DD&quot;&gt;Still&nbsp;seems&nbsp;messy&nbsp;to&nbsp;me&nbsp;and&nbsp;complexity&nbsp;which&nbsp;possibly&nbsp;should&nbsp;not&nbsp;be&lt;/FONT&gt;&lt;/DIV&gt;&lt;DIV&gt;&lt;FONT&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#0000DD&quot;&gt;in&nbsp;the&nbsp;Apache&nbsp;processes.&lt;/FONT&gt;&lt;/DIV&gt;&lt;DIV&gt;&lt;FONT&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#0000DD&quot;&gt;&lt;BR&nbsp;class=&quot;khtml-block-placeholder&quot;&gt;&lt;/FONT&gt;&lt;/DIV&gt;&lt;DIV&gt;&lt;FONT&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#0000DD&quot;&gt;Anyway,&nbsp;I&nbsp;can&nbsp;only&nbsp;make&nbsp;huge&nbsp;assumptions&nbsp;about&nbsp;what&nbsp;you&nbsp;are&nbsp;doing.&lt;/FONT&gt;&lt;/DIV&gt;&lt;DIV&gt;&lt;FONT&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#0000DD&quot;&gt;You&nbsp;probably&nbsp;have&nbsp;it&nbsp;very&nbsp;clear&nbsp;in&nbsp;your&nbsp;head&nbsp;and&nbsp;thus&nbsp;it&nbsp;possibly&nbsp;is&nbsp;not&lt;/FONT&gt;&lt;/DIV&gt;&lt;DIV&gt;&lt;FONT&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#0000DD&quot;&gt;as&nbsp;bad&nbsp;as&nbsp;it&nbsp;seems&nbsp;to&nbsp;me.&nbsp;;-)&lt;/FONT&gt;&lt;/DIV&gt;&lt;DIV&gt;&lt;FONT&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#0000DD&quot;&gt;&lt;BR&nbsp;class=&quot;khtml-block-placeholder&quot;&gt;&lt;/FONT&gt;&lt;/DIV&gt;&lt;DIV&gt;&lt;FONT&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#0000DD&quot;&gt;Graham&lt;/FONT&gt;&lt;/DIV&gt;&lt;/BODY&gt;&lt;/HTML&gt;
</tt>
