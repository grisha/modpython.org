<tt>
&lt;!DOCTYPE&nbsp;html&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.01&nbsp;Transitional//EN&quot;&gt;<br>
&lt;html&gt;<br>
&lt;head&gt;<br>
&nbsp;&nbsp;&lt;meta&nbsp;content=&quot;text/html;charset=ISO-8859-1&quot;&nbsp;http-equiv=&quot;Content-Type&quot;&gt;<br>
&lt;/head&gt;<br>
&lt;body&nbsp;bgcolor=&quot;#ffffff&quot;&nbsp;text=&quot;#000000&quot;&gt;<br>
Nicolas,&lt;br&gt;<br>
&lt;br&gt;<br>
Your&nbsp;response&nbsp;was&nbsp;perfect!&amp;nbsp;&nbsp;Thanks&nbsp;a&nbsp;lot&nbsp;for&nbsp;that&nbsp;explaination&nbsp;and<br>
advice.&amp;nbsp;&nbsp;I&nbsp;wouldn't&nbsp;be&nbsp;able&nbsp;to&nbsp;encapsulate&nbsp;the&nbsp;path&nbsp;variable&nbsp;since&nbsp;the<br>
path&nbsp;is&nbsp;dynamic&nbsp;and&nbsp;is&nbsp;based&nbsp;off&nbsp;of&nbsp;the&nbsp;URI&nbsp;which&nbsp;provides&nbsp;the&nbsp;path&nbsp;to<br>
the&nbsp;page&nbsp;to&nbsp;be&nbsp;executed.&amp;nbsp;&nbsp;However,&nbsp;your&nbsp;information&nbsp;has&nbsp;given&nbsp;me&nbsp;a&nbsp;very<br>
good&nbsp;understanding&nbsp;on&nbsp;programming&nbsp;in&nbsp;multi-threaded&nbsp;environment.&amp;nbsp;&nbsp;&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;will&nbsp;definitely,&nbsp;look&nbsp;into&nbsp;the&nbsp;book&nbsp;you&nbsp;have&nbsp;suggested.&lt;br&gt;<br>
&lt;br&gt;<br>
Thanks&nbsp;again&nbsp;for&nbsp;all&nbsp;of&nbsp;your&nbsp;help.&amp;nbsp;&nbsp;Sorry&nbsp;to&nbsp;be&nbsp;a&nbsp;pain&nbsp;:-(&lt;br&gt;<br>
&lt;br&gt;<br>
Huzaifa&lt;br&gt;<br>
&lt;br&gt;<br>
Nicolas&nbsp;Lehuen&nbsp;wrote:<br>
&lt;blockquote&nbsp;cite=&quot;midc298f2d705050223147e6c4c6@mail.gmail.com&quot;<br>
&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;Huzaifa,<br>
<br>
You're&nbsp;right&nbsp;in&nbsp;thinking&nbsp;that&nbsp;the&nbsp;same&nbsp;method&nbsp;will&nbsp;be&nbsp;accessed&nbsp;at&nbsp;the<br>
same&nbsp;time,&nbsp;but&nbsp;wrong&nbsp;in&nbsp;thinking&nbsp;that&nbsp;there&nbsp;is&nbsp;a&nbsp;risk&nbsp;that&nbsp;a&nbsp;thread<br>
messes&nbsp;with&nbsp;another&nbsp;thread's&nbsp;stack.<br>
<br>
Multi-threading&nbsp;is&nbsp;perfectly&nbsp;predictable&nbsp;and&nbsp;safe&nbsp;on&nbsp;this&nbsp;level&nbsp;:&nbsp;you<br>
can&nbsp;launch&nbsp;as&nbsp;many&nbsp;threads&nbsp;as&nbsp;you&nbsp;want&nbsp;running&nbsp;the&nbsp;same<br>
function/method,&nbsp;each&nbsp;thread&nbsp;will&nbsp;execute&nbsp;in&nbsp;its&nbsp;own&nbsp;environment,&nbsp;each<br>
one&nbsp;will&nbsp;get&nbsp;its&nbsp;own&nbsp;stack,&nbsp;therefore&nbsp;each&nbsp;one&nbsp;will&nbsp;have&nbsp;its&nbsp;own&nbsp;set<br>
of&nbsp;local&nbsp;variables&nbsp;(including&nbsp;parameters)&nbsp;when&nbsp;the&nbsp;method&nbsp;will&nbsp;be<br>
executed.&nbsp;There&nbsp;is&nbsp;absolutely&nbsp;no&nbsp;risk&nbsp;that&nbsp;changing&nbsp;a&nbsp;local&nbsp;parameter<br>
in&nbsp;one&nbsp;thread&nbsp;messes&nbsp;with&nbsp;a&nbsp;local&nbsp;parameter&nbsp;in&nbsp;another&nbsp;thread.<br>
<br>
You&nbsp;only&nbsp;have&nbsp;to&nbsp;worry&nbsp;about&nbsp;synchronization&nbsp;when&nbsp;multiple&nbsp;thread<br>
share&nbsp;some&nbsp;data&nbsp;;&nbsp;for&nbsp;example,&nbsp;for&nbsp;a&nbsp;bound&nbsp;method&nbsp;(a&nbsp;method&nbsp;which&nbsp;is<br>
applied&nbsp;to&nbsp;a&nbsp;specific&nbsp;object&nbsp;instance),&nbsp;even&nbsp;if&nbsp;the&nbsp;threads&nbsp;stacks&nbsp;are<br>
perfectly&nbsp;isolated,&nbsp;the&nbsp;multiple&nbsp;threads&nbsp;will&nbsp;target&nbsp;the&nbsp;same&nbsp;object<br>
instance,&nbsp;and&nbsp;therefore&nbsp;one&nbsp;must&nbsp;think&nbsp;about&nbsp;synchronisation&nbsp;issues<br>
when&nbsp;accessing&nbsp;the&nbsp;members&nbsp;of&nbsp;the&nbsp;object.<br>
<br>
To&nbsp;go&nbsp;back&nbsp;to&nbsp;your&nbsp;fix_path()&nbsp;example,&nbsp;only&nbsp;local&nbsp;variables&nbsp;are<br>
changed&nbsp;in&nbsp;the&nbsp;function.&nbsp;The&nbsp;local&nbsp;&quot;path&quot;&nbsp;variable&nbsp;changes,&nbsp;but&nbsp;not<br>
the&nbsp;list&nbsp;passed&nbsp;as&nbsp;a&nbsp;parameter.&nbsp;This&nbsp;means&nbsp;the&nbsp;code&nbsp;would&nbsp;be&nbsp;perfectly<br>
thread-safe&nbsp;even&nbsp;with&nbsp;the&nbsp;locking&nbsp;code&nbsp;removed.<br>
<br>
Still,&nbsp;you&nbsp;will&nbsp;tell&nbsp;me,&nbsp;there&nbsp;is&nbsp;the&nbsp;possibility&nbsp;that&nbsp;someone&nbsp;changes<br>
the&nbsp;shared&nbsp;path&nbsp;while&nbsp;I'm&nbsp;trying&nbsp;to&nbsp;fix&nbsp;it.&nbsp;Then,&nbsp;change&nbsp;your&nbsp;design.<br>
At&nbsp;the&nbsp;minimum,&nbsp;you&nbsp;should&nbsp;place&nbsp;your&nbsp;locking&nbsp;code&nbsp;where&nbsp;it&nbsp;is&nbsp;needed,<br>
not&nbsp;in&nbsp;the&nbsp;lowest&nbsp;common&nbsp;factor&nbsp;point.<br>
<br>
The&nbsp;one&nbsp;you&nbsp;chose&nbsp;is&nbsp;pretty&nbsp;bad&nbsp;(sorry&nbsp;to&nbsp;be&nbsp;harsh&nbsp;;-)&nbsp;:&nbsp;imagine&nbsp;you<br>
want&nbsp;to&nbsp;call&nbsp;fix_path&nbsp;for&nbsp;each&nbsp;request.&nbsp;Bam,&nbsp;for&nbsp;each&nbsp;request,&nbsp;you'll<br>
hold&nbsp;a&nbsp;global&nbsp;lock&nbsp;just&nbsp;for&nbsp;fixing&nbsp;a&nbsp;path&nbsp;variable&nbsp;!&nbsp;You'll&nbsp;reduce&nbsp;the<br>
server&nbsp;performance&nbsp;just&nbsp;for&nbsp;housekeeping&nbsp;issues...<br>
<br>
Putting&nbsp;some&nbsp;code&nbsp;where&nbsp;it&nbsp;is&nbsp;needed&nbsp;is&nbsp;what&nbsp;OOP&nbsp;was&nbsp;made&nbsp;for&nbsp;(well,<br>
it&nbsp;was&nbsp;made&nbsp;for&nbsp;making&nbsp;it&nbsp;easier,&nbsp;at&nbsp;least).&nbsp;What&nbsp;I'm&nbsp;suggesting&nbsp;is&nbsp;to<br>
encapsulate&nbsp;the&nbsp;shared&nbsp;path&nbsp;variable&nbsp;in&nbsp;an&nbsp;object,&nbsp;and&nbsp;fix&nbsp;it&nbsp;each<br>
time&nbsp;it&nbsp;is&nbsp;modified,&nbsp;not&nbsp;each&nbsp;time&nbsp;it&nbsp;is&nbsp;accessed.&nbsp;Then,&nbsp;you&nbsp;can&nbsp;use<br>
whatever&nbsp;locking&nbsp;scheme&nbsp;you&nbsp;need&nbsp;to&nbsp;ensure&nbsp;the&nbsp;consistency&nbsp;of&nbsp;this<br>
shared&nbsp;path&nbsp;variable.<br>
<br>
Also,&nbsp;locking&nbsp;is&nbsp;not&nbsp;the&nbsp;only&nbsp;option&nbsp;for&nbsp;this&nbsp;:&nbsp;you&nbsp;can&nbsp;also&nbsp;copy&nbsp;the<br>
path&nbsp;list&nbsp;and&nbsp;use&nbsp;a&nbsp;copy&nbsp;in&nbsp;the&nbsp;thread,&nbsp;instead&nbsp;of&nbsp;the&nbsp;original&nbsp;;&nbsp;you<br>
won't&nbsp;have&nbsp;to&nbsp;worry&nbsp;about&nbsp;the&nbsp;original&nbsp;list&nbsp;being&nbsp;modified,&nbsp;since&nbsp;each<br>
thread&nbsp;will&nbsp;have&nbsp;its&nbsp;own&nbsp;copy.<br>
<br>
There&nbsp;are&nbsp;many,&nbsp;many&nbsp;design&nbsp;choices&nbsp;to&nbsp;be&nbsp;made&nbsp;when&nbsp;build&nbsp;a<br>
multi-threaded&nbsp;architecture.&nbsp;One&nbsp;thing&nbsp;is&nbsp;sure&nbsp;:&nbsp;you&nbsp;can't&nbsp;assume&nbsp;the<br>
worst&nbsp;in&nbsp;each&nbsp;part&nbsp;of&nbsp;the&nbsp;architecture.&nbsp;You&nbsp;have&nbsp;to&nbsp;have&nbsp;places&nbsp;(like<br>
this&nbsp;utility&nbsp;method)&nbsp;where&nbsp;you&nbsp;can&nbsp;safely&nbsp;assume&nbsp;that&nbsp;the&nbsp;parameters<br>
you&nbsp;are&nbsp;given&nbsp;won't&nbsp;be&nbsp;modified&nbsp;during&nbsp;the&nbsp;call.<br>
<br>
Multi-threading&nbsp;is&nbsp;not&nbsp;about&nbsp;locking&nbsp;everything,&nbsp;not&nbsp;at&nbsp;all,&nbsp;because<br>
we&nbsp;might&nbsp;as&nbsp;well&nbsp;run&nbsp;in&nbsp;a&nbsp;single&nbsp;thread,&nbsp;the&nbsp;performances&nbsp;would&nbsp;be<br>
better.&nbsp;It's&nbsp;about&nbsp;putting&nbsp;the&nbsp;right&nbsp;locks&nbsp;at&nbsp;the&nbsp;right&nbsp;place,<br>
sometimes&nbsp;choosing&nbsp;to&nbsp;copy&nbsp;data&nbsp;instead&nbsp;of&nbsp;sharing&nbsp;it.<br>
<br>
Sorry&nbsp;to&nbsp;be&nbsp;so&nbsp;vague,&nbsp;but&nbsp;to&nbsp;go&nbsp;further,&nbsp;I'd&nbsp;need&nbsp;to&nbsp;go&nbsp;deeper&nbsp;in&nbsp;your<br>
code,&nbsp;and&nbsp;this&nbsp;I&nbsp;have&nbsp;not&nbsp;enough&nbsp;time&nbsp;to&nbsp;do&nbsp;:).<br>
<br>
A&nbsp;very&nbsp;good&nbsp;book&nbsp;about&nbsp;multithreading&nbsp;is&nbsp;&quot;Concurrent&nbsp;Programming&nbsp;in<br>
Java&quot;&nbsp;from&nbsp;Doug&nbsp;Lea.&nbsp;It's&nbsp;about&nbsp;Java&nbsp;and&nbsp;also&nbsp;quite&nbsp;old&nbsp;but&nbsp;a&nbsp;lot&nbsp;of<br>
information&nbsp;can&nbsp;be&nbsp;applied&nbsp;to&nbsp;any&nbsp;multi-threading&nbsp;problem.<br>
<br>
&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://www.amazon.com/exec/obidos/tg/detail/-/0201310090/&quot;&gt;http://www.amazon.com/exec/obidos/tg/detail/-/0201310090/&lt;/a&gt;<br>
<br>
Regards,<br>
Nicolas<br>
<br>
2005/5/3,&nbsp;Huzaifa&nbsp;Tapal&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-rfc2396E&quot;&nbsp;href=&quot;mailto:huzaifa@hostway.com&quot;&gt;&amp;lt;huzaifa@hostway.com&amp;gt;&lt;/a&gt;:<br>
&nbsp;&nbsp;&lt;/pre&gt;<br>
&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;&nbsp;Hello&nbsp;Nicolas,<br>
&nbsp;<br>
&nbsp;What&nbsp;I&nbsp;am&nbsp;really&nbsp;worried&nbsp;about&nbsp;is&nbsp;that&nbsp;in&nbsp;a&nbsp;multi-threaded&nbsp;environment,<br>
accessing&nbsp;a&nbsp;modular&nbsp;level&nbsp;method,&nbsp;multiple&nbsp;threads&nbsp;might&nbsp;be&nbsp;accessing&nbsp;the<br>
same&nbsp;method&nbsp;at&nbsp;the&nbsp;same&nbsp;time&nbsp;and&nbsp;overwriting&nbsp;the&nbsp;other&nbsp;threads&nbsp;path&nbsp;list&nbsp;as<br>
a&nbsp;result.&nbsp;&nbsp;<br>
&nbsp;<br>
&nbsp;As&nbsp;per&nbsp;your&nbsp;question,&nbsp;I&nbsp;create&nbsp;a&nbsp;_lock&nbsp;object&nbsp;on&nbsp;top&nbsp;of&nbsp;the&nbsp;module.&nbsp;&nbsp;Pretty<br>
much&nbsp;this&nbsp;method&nbsp;was&nbsp;created&nbsp;in&nbsp;a&nbsp;&quot;SharedResources&quot;&nbsp;module&nbsp;as&nbsp;a&nbsp;modular<br>
level&nbsp;method.&nbsp;&nbsp;My&nbsp;framework&nbsp;then&nbsp;imports&nbsp;the&nbsp;method&nbsp;and&nbsp;uses&nbsp;it&nbsp;within&nbsp;to<br>
fix&nbsp;the&nbsp;paths.<br>
&nbsp;<br>
&nbsp;What&nbsp;do&nbsp;you&nbsp;think?<br>
&nbsp;<br>
&nbsp;Hozi<br>
<br>
&nbsp;<br>
&nbsp;Nicolas&nbsp;Lehuen&nbsp;wrote:&nbsp;<br>
&nbsp;Hi&nbsp;Huzaifa,<br>
<br>
Well,&nbsp;that's&nbsp;really&nbsp;up&nbsp;to&nbsp;you,&nbsp;especially&nbsp;since&nbsp;I&nbsp;don't&nbsp;understand<br>
where&nbsp;the&nbsp;_lock&nbsp;variable&nbsp;comes&nbsp;from.<br>
<br>
If&nbsp;it's&nbsp;not&nbsp;possible&nbsp;to&nbsp;change&nbsp;the&nbsp;path&nbsp;list&nbsp;which&nbsp;is&nbsp;passed&nbsp;as&nbsp;a<br>
parameter&nbsp;without&nbsp;acquiring&nbsp;the&nbsp;lock,&nbsp;then&nbsp;why&nbsp;not,&nbsp;but&nbsp;I'd&nbsp;put&nbsp;the<br>
locking&nbsp;mechanism&nbsp;in&nbsp;the&nbsp;calling&nbsp;code&nbsp;rather&nbsp;than&nbsp;in&nbsp;this&nbsp;function.<br>
Note&nbsp;that&nbsp;you&nbsp;are&nbsp;not&nbsp;modifying&nbsp;the&nbsp;path&nbsp;list&nbsp;in-place&nbsp;:&nbsp;you&nbsp;just<br>
return&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;path&nbsp;list&nbsp;with&nbsp;some&nbsp;fixes&nbsp;in&nbsp;it.&nbsp;So&nbsp;there&nbsp;is&nbsp;no<br>
need&nbsp;to&nbsp;lock&nbsp;anything&nbsp;here,&nbsp;except&nbsp;if&nbsp;you&nbsp;fear&nbsp;that&nbsp;the&nbsp;path&nbsp;list&nbsp;will<br>
be&nbsp;changed&nbsp;during&nbsp;the&nbsp;iteration,&nbsp;but&nbsp;for&nbsp;that,&nbsp;you&nbsp;have&nbsp;to&nbsp;put&nbsp;a<br>
locking&nbsp;mechanism&nbsp;somewhere&nbsp;else&nbsp;for&nbsp;any&nbsp;modification&nbsp;of&nbsp;the&nbsp;path<br>
list.&nbsp;So&nbsp;my&nbsp;first&nbsp;advice&nbsp;is&nbsp;:&nbsp;keep&nbsp;all&nbsp;locking&nbsp;code&nbsp;in&nbsp;the&nbsp;same&nbsp;place<br>
and&nbsp;you'll&nbsp;save&nbsp;time&nbsp;and&nbsp;mental&nbsp;health&nbsp;:).<br>
<br>
My&nbsp;second&nbsp;advice&nbsp;is&nbsp;:&nbsp;don't&nbsp;be&nbsp;over-protective&nbsp;at&nbsp;the&nbsp;cost&nbsp;of<br>
performance.&nbsp;Trust&nbsp;the&nbsp;users&nbsp;of&nbsp;your&nbsp;code.&nbsp;Provided&nbsp;that&nbsp;they&nbsp;have&nbsp;a<br>
proper&nbsp;documentation,&nbsp;it's&nbsp;not&nbsp;necessary&nbsp;to&nbsp;lock&nbsp;anything,&nbsp;because<br>
your&nbsp;users&nbsp;will&nbsp;know&nbsp;that&nbsp;bad&nbsp;things&nbsp;will&nbsp;happen&nbsp;if&nbsp;they&nbsp;change&nbsp;the<br>
path&nbsp;list&nbsp;during&nbsp;iteration,&nbsp;so&nbsp;they'll&nbsp;do&nbsp;the&nbsp;right&nbsp;stuff&nbsp;accordingly.<br>
Likewise,&nbsp;it's&nbsp;not&nbsp;necessary&nbsp;to&nbsp;check&nbsp;whether&nbsp;path&nbsp;is&nbsp;a&nbsp;list,&nbsp;or<br>
whether&nbsp;some&nbsp;path&nbsp;entries&nbsp;are&nbsp;None&nbsp;or&nbsp;&quot;&quot;.&nbsp;If&nbsp;your&nbsp;users&nbsp;want&nbsp;to&nbsp;give<br>
silly&nbsp;data&nbsp;to&nbsp;your&nbsp;function,&nbsp;let&nbsp;them&nbsp;do&nbsp;it,&nbsp;and&nbsp;let&nbsp;Python&nbsp;throw<br>
exceptions&nbsp;at&nbsp;them.<br>
<br>
Regards,<br>
<br>
Nicolas<br>
<br>
On&nbsp;4/29/05,&nbsp;Huzaifa&nbsp;Tapal&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-rfc2396E&quot;&nbsp;href=&quot;mailto:huzaifa@hostway.com&quot;&gt;&amp;lt;huzaifa@hostway.com&amp;gt;&lt;/a&gt;&nbsp;wrote:<br>
&nbsp;<br>
&nbsp;<br>
&nbsp;I&nbsp;wanted&nbsp;to&nbsp;ask&nbsp;for&nbsp;a&nbsp;piece&nbsp;of&nbsp;advise.&nbsp;So&nbsp;the&nbsp;fix&nbsp;that&nbsp;I&nbsp;have&nbsp;mentioned,&nbsp;I<br>
moved&nbsp;that&nbsp;fix&nbsp;(the&nbsp;method&nbsp;I&nbsp;replaced&nbsp;with&nbsp;the&nbsp;map(lambda)&nbsp;solution&nbsp;you&nbsp;had<br>
with&nbsp;a&nbsp;minor&nbsp;fix)&nbsp;to&nbsp;another&nbsp;&quot;SharedResources&quot;&nbsp;module&nbsp;that&nbsp;I&nbsp;import&nbsp;in&nbsp;my<br>
framework's&nbsp;handler.&nbsp;From&nbsp;within&nbsp;the&nbsp;handler&nbsp;and&nbsp;my&nbsp;app,&nbsp;I&nbsp;am&nbsp;call&nbsp;that<br>
method&nbsp;passing&nbsp;in&nbsp;a&nbsp;path&nbsp;argument&nbsp;that&nbsp;it&nbsp;*fixes*&nbsp;and&nbsp;returns&nbsp;back&nbsp;the<br>
results.&nbsp;Here&nbsp;is&nbsp;what&nbsp;the&nbsp;new&nbsp;method&nbsp;looks&nbsp;like:<br>
&nbsp;<br>
&nbsp;def&nbsp;fix_paths(&nbsp;path&nbsp;):<br>
&nbsp;&quot;&quot;&quot;&nbsp;Convenience&nbsp;method&nbsp;for&nbsp;checking&nbsp;and&nbsp;<br>
&nbsp;adding&nbsp;'/'&nbsp;to&nbsp;the&nbsp;end&nbsp;of&nbsp;paths&nbsp;for&nbsp;compatibility<br>
&nbsp;with&nbsp;mod_python's&nbsp;import_module.&nbsp;&quot;&quot;&quot;<br>
&nbsp;<br>
&nbsp;_lock.acquire()<br>
&nbsp;try:<br>
&nbsp;if&nbsp;path&nbsp;and&nbsp;type(path)&nbsp;==&nbsp;type([]):<br>
&nbsp;path&nbsp;=&nbsp;map(lambda&nbsp;entry&nbsp;:&nbsp;(entry!=''&nbsp;and&nbsp;entry[-1]!='/'&nbsp;and<br>
entry+'/')&nbsp;or&nbsp;entry,path)<br>
&nbsp;<br>
&nbsp;return&nbsp;path<br>
&nbsp;finally:<br>
&nbsp;_lock.release()<br>
&nbsp;<br>
&nbsp;Should&nbsp;I&nbsp;have&nbsp;the&nbsp;thread-locking&nbsp;in&nbsp;place&nbsp;or&nbsp;can&nbsp;I&nbsp;get&nbsp;by&nbsp;without&nbsp;having&nbsp;it<br>
in&nbsp;place?&nbsp;The&nbsp;reason&nbsp;I&nbsp;did&nbsp;add&nbsp;that&nbsp;was&nbsp;because&nbsp;the&nbsp;path&nbsp;value&nbsp;may&nbsp;get<br>
changed,&nbsp;in&nbsp;the&nbsp;process,&nbsp;I&nbsp;thought&nbsp;of&nbsp;making&nbsp;this&nbsp;method&nbsp;thread-safe.<br>
&nbsp;<br>
&nbsp;Also&nbsp;Nicolas,&nbsp;if&nbsp;you&nbsp;notice&nbsp;I&nbsp;added&nbsp;another&nbsp;check&nbsp;in&nbsp;your&nbsp;lambda&nbsp;function<br>
to&nbsp;check&nbsp;if&nbsp;the&nbsp;entry&nbsp;is&nbsp;an&nbsp;empty&nbsp;string.&nbsp;If&nbsp;that&nbsp;wasn't&nbsp;there&nbsp;then&nbsp;if&nbsp;an<br>
empty&nbsp;string&nbsp;path&nbsp;was&nbsp;passed&nbsp;in&nbsp;the&nbsp;list&nbsp;paths,&nbsp;the&nbsp;function&nbsp;would&nbsp;break.&nbsp;<br>
Thought,&nbsp;i'd&nbsp;let&nbsp;you&nbsp;know&nbsp;if&nbsp;you&nbsp;were&nbsp;gonna&nbsp;add&nbsp;this&nbsp;functionality&nbsp;into&nbsp;the<br>
import_module&nbsp;method&nbsp;for&nbsp;apache.py<br>
&nbsp;<br>
&nbsp;Thanks<br>
&nbsp;<br>
&nbsp;Hozi<br>
<br>
&nbsp;<br>
&nbsp;Nicolas&nbsp;Lehuen&nbsp;wrote:&nbsp;<br>
&nbsp;Sorry,&nbsp;reposting&nbsp;to&nbsp;the&nbsp;whole&nbsp;list&nbsp;:<br>
<br>
Hi,<br>
<br>
The&nbsp;change&nbsp;I've&nbsp;made&nbsp;for&nbsp;MODPYTHON-9&nbsp;affects&nbsp;only&nbsp;the&nbsp;publisher<br>
module.&nbsp;It&nbsp;solves&nbsp;the&nbsp;problem&nbsp;encountered&nbsp;when&nbsp;you&nbsp;had&nbsp;two&nbsp;pages,&nbsp;one<br>
at&nbsp;/index.py,&nbsp;and&nbsp;the&nbsp;other&nbsp;at&nbsp;/foobar/index.py.<br>
<br>
Huzaifa,&nbsp;what&nbsp;I&nbsp;don't&nbsp;understand&nbsp;here&nbsp;is&nbsp;whether&nbsp;moduleA&nbsp;has&nbsp;the&nbsp;same<br>
name&nbsp;as&nbsp;moduleB,&nbsp;and&nbsp;whether&nbsp;you&nbsp;are&nbsp;using&nbsp;mod_python.publisher&nbsp;or<br>
not.<br>
<br>
If&nbsp;you&nbsp;use&nbsp;the&nbsp;publisher,&nbsp;your&nbsp;problem&nbsp;has&nbsp;been&nbsp;solved&nbsp;in&nbsp;the&nbsp;latest<br>
development&nbsp;version,&nbsp;and&nbsp;the&nbsp;fix&nbsp;will&nbsp;be&nbsp;in&nbsp;the&nbsp;next&nbsp;release.<br>
<br>
Anyway,&nbsp;if&nbsp;we&nbsp;put&nbsp;aside&nbsp;the&nbsp;fix&nbsp;specific&nbsp;to&nbsp;the&nbsp;publisher,&nbsp;the&nbsp;problem<br>
you&nbsp;describe&nbsp;is&nbsp;real,&nbsp;and&nbsp;the&nbsp;workaround&nbsp;you&nbsp;provide&nbsp;is&nbsp;correct.<br>
<br>
It&nbsp;is&nbsp;so&nbsp;correct&nbsp;that&nbsp;the&nbsp;only&nbsp;way&nbsp;I&nbsp;see&nbsp;of&nbsp;fixing&nbsp;that&nbsp;is&nbsp;to<br>
integrate&nbsp;the&nbsp;workaround&nbsp;in&nbsp;the&nbsp;import_module&nbsp;function,&nbsp;that&nbsp;is&nbsp;to&nbsp;say<br>
to&nbsp;check&nbsp;whether&nbsp;each&nbsp;path&nbsp;component&nbsp;passed&nbsp;in&nbsp;the&nbsp;path&nbsp;list&nbsp;argument<br>
ends&nbsp;with&nbsp;a&nbsp;'/'&nbsp;(or&nbsp;'\'),&nbsp;and&nbsp;if&nbsp;not,&nbsp;add&nbsp;a&nbsp;'/'&nbsp;(or&nbsp;'\\').&nbsp;This&nbsp;is<br>
done&nbsp;easily&nbsp;in&nbsp;the&nbsp;first&nbsp;line&nbsp;of&nbsp;the&nbsp;function&nbsp;:<br>
<br>
if&nbsp;path:<br>
&nbsp;path&nbsp;=&nbsp;map(lambda&nbsp;entry&nbsp;:&nbsp;(entry[-1]!='/'&nbsp;and&nbsp;entry+'/')&nbsp;or&nbsp;entry,path)<br>
<br>
However,&nbsp;there&nbsp;is&nbsp;no&nbsp;easy&nbsp;way&nbsp;of&nbsp;telling&nbsp;what&nbsp;directory&nbsp;separator<br>
should&nbsp;be&nbsp;used&nbsp;;&nbsp;theoretically,&nbsp;os.sep&nbsp;gives&nbsp;us&nbsp;the&nbsp;correct&nbsp;directory<br>
separator,&nbsp;but&nbsp;even&nbsp;under&nbsp;Win32&nbsp;Apache&nbsp;admins&nbsp;are&nbsp;advised&nbsp;to&nbsp;use&nbsp;&quot;/&quot;<br>
which&nbsp;is&nbsp;compatible&nbsp;(at&nbsp;the&nbsp;OS&nbsp;level).&nbsp;So,&nbsp;we&nbsp;might&nbsp;as&nbsp;well&nbsp;always&nbsp;use<br>
&quot;/&quot;.<br>
<br>
What&nbsp;I&nbsp;fear&nbsp;is&nbsp;that&nbsp;adding&nbsp;all&nbsp;these&nbsp;checks&nbsp;to&nbsp;import_module&nbsp;will&nbsp;make<br>
it&nbsp;a&nbsp;little&nbsp;bit&nbsp;too&nbsp;slow,&nbsp;so&nbsp;what&nbsp;about&nbsp;adding&nbsp;a&nbsp;line&nbsp;or&nbsp;two&nbsp;in&nbsp;the<br>
documentation&nbsp;about&nbsp;the&nbsp;fact&nbsp;that&nbsp;all&nbsp;directories&nbsp;mentioned&nbsp;in&nbsp;the<br>
path&nbsp;argument&nbsp;should&nbsp;end&nbsp;with&nbsp;a&nbsp;'/'&nbsp;?<br>
<br>
Regards,<br>
<br>
Nicolas<br>
<br>
On&nbsp;4/29/05,&nbsp;Graham&nbsp;Dumpleton&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-rfc2396E&quot;&nbsp;href=&quot;mailto:grahamd@dscpl.com.au&quot;&gt;&amp;lt;grahamd@dscpl.com.au&amp;gt;&lt;/a&gt;&nbsp;wrote:<br>
&nbsp;<br>
&nbsp;<br>
&nbsp;Nicolas,&nbsp;does&nbsp;the&nbsp;change&nbsp;you&nbsp;have&nbsp;already&nbsp;made&nbsp;for&nbsp;MODPYTHON-9<br>
also&nbsp;address&nbsp;this&nbsp;slightly&nbsp;different&nbsp;variation&nbsp;on&nbsp;the&nbsp;problem?<br>
<br>
Original&nbsp;report&nbsp;was&nbsp;based&nbsp;on&nbsp;same&nbsp;name&nbsp;module&nbsp;in&nbsp;parent&nbsp;and&nbsp;child<br>
subdirectories,&nbsp;not&nbsp;sibling&nbsp;directories&nbsp;which&nbsp;share&nbsp;a&nbsp;common&nbsp;prefix<br>
to&nbsp;the&nbsp;subdirectory&nbsp;name.<br>
<br>
Graham<br>
<br>
Huzaifa&nbsp;Tapal&nbsp;wrote&nbsp;..<br>
&nbsp;<br>
&nbsp;<br>
&nbsp;For&nbsp;my&nbsp;fix,&nbsp;I&nbsp;patched&nbsp;this&nbsp;issue&nbsp;by&nbsp;passing&nbsp;the&nbsp;import_module&nbsp;function<br>
the&nbsp;path&nbsp;with&nbsp;&quot;/&quot;&nbsp;in&nbsp;the&nbsp;end.&nbsp;That&nbsp;way&nbsp;it&nbsp;distinguishes&nbsp;from<br>
/home/user/dir1&nbsp;and&nbsp;/home/user/dir123<br>
<br>
hozi<br>
<br>
Graham&nbsp;Dumpleton&nbsp;wrote:<br>
<br>
&nbsp;<br>
&nbsp;<br>
&nbsp;See:<br>
<br>
&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://issues.apache.org/jira/browse/MODPYTHON-9&quot;&gt;http://issues.apache.org/jira/browse/MODPYTHON-9&lt;/a&gt;<br>
&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://issues.apache.org/jira/browse/MODPYTHON-10&quot;&gt;http://issues.apache.org/jira/browse/MODPYTHON-10&lt;/a&gt;<br>
&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://issues.apache.org/jira/browse/MODPYTHON-11&quot;&gt;http://issues.apache.org/jira/browse/MODPYTHON-11&lt;/a&gt;<br>
<br>
There&nbsp;are&nbsp;various&nbsp;known&nbsp;issues&nbsp;with&nbsp;using&nbsp;same&nbsp;name&nbsp;module&nbsp;in&nbsp;different<br>
directories.<br>
<br>
The&nbsp;first&nbsp;one&nbsp;has&nbsp;been&nbsp;addressed&nbsp;for&nbsp;next&nbsp;version&nbsp;of&nbsp;mod_python.<br>
<br>
Graham<br>
<br>
On&nbsp;29/04/2005,&nbsp;at&nbsp;8:22&nbsp;AM,&nbsp;Huzaifa&nbsp;Tapal&nbsp;wrote:<br>
<br>
&nbsp;<br>
&nbsp;<br>
&nbsp;I&nbsp;think&nbsp;there&nbsp;is&nbsp;a&nbsp;bug&nbsp;in&nbsp;apache.import_module.&nbsp;I&nbsp;am&nbsp;using<br>
apache.import_module&nbsp;passing&nbsp;in&nbsp;the&nbsp;path&nbsp;where&nbsp;I&nbsp;want&nbsp;the&nbsp;module<br>
imported&nbsp;from.&nbsp;I&nbsp;am&nbsp;seeing&nbsp;a&nbsp;very&nbsp;odd&nbsp;result&nbsp;as&nbsp;to&nbsp;sometimes,&nbsp;the<br>
module&nbsp;that&nbsp;is&nbsp;loaded&nbsp;is&nbsp;not&nbsp;the&nbsp;right&nbsp;one.&nbsp;Instead&nbsp;it&nbsp;loads&nbsp;a<br>
module&nbsp;that&nbsp;is&nbsp;of&nbsp;the&nbsp;same&nbsp;name&nbsp;but&nbsp;in&nbsp;a&nbsp;different&nbsp;directory.&nbsp;Here<br>
is&nbsp;what&nbsp;is&nbsp;happening:<br>
<br>
I&nbsp;have&nbsp;two&nbsp;modules&nbsp;of&nbsp;same&nbsp;name&nbsp;in&nbsp;2&nbsp;different&nbsp;directories&nbsp;as&nbsp;follows;<br>
<br>
/home/user/dir1/moduleA<br>
/home/user/dir123/moduleB<br>
<br>
Lets&nbsp;say&nbsp;I&nbsp;restart&nbsp;apache&nbsp;and&nbsp;load&nbsp;up&nbsp;moduleA.&nbsp;At&nbsp;that&nbsp;point&nbsp;there<br>
is&nbsp;an&nbsp;entry&nbsp;in&nbsp;sys.modules&nbsp;for&nbsp;moduleA.&nbsp;Lets&nbsp;say&nbsp;then,&nbsp;I&nbsp;load&nbsp;up<br>
moduleB,&nbsp;now&nbsp;the&nbsp;original&nbsp;entry&nbsp;for&nbsp;moduleA&nbsp;is&nbsp;overwritten&nbsp;by&nbsp;this<br>
new&nbsp;entry.&nbsp;Now&nbsp;when&nbsp;I&nbsp;go&nbsp;back&nbsp;to&nbsp;load&nbsp;moduleA,&nbsp;I&nbsp;get&nbsp;back&nbsp;moduleB<br>
results.&nbsp;Here&nbsp;is&nbsp;why:<br>
<br>
In&nbsp;apache.import_module&nbsp;if&nbsp;I&nbsp;pass&nbsp;in&nbsp;the&nbsp;path&nbsp;to&nbsp;load&nbsp;moduleA&nbsp;from<br>
'/home/user/dir1'&nbsp;and&nbsp;the&nbsp;last&nbsp;module&nbsp;was&nbsp;in&nbsp;'/home/user/dir123'&nbsp;then<br>
the&nbsp;check&nbsp;in&nbsp;import_module&nbsp;to&nbsp;make&nbsp;sure&nbsp;both&nbsp;modules&nbsp;aren't&nbsp;the&nbsp;same<br>
fails&nbsp;since&nbsp;it&nbsp;does&nbsp;a&nbsp;&quot;file.startswith()&quot;&nbsp;check&nbsp;on&nbsp;the&nbsp;path.&nbsp;Since<br>
the&nbsp;path&nbsp;moduleA&nbsp;is&nbsp;in&nbsp;the&nbsp;path&nbsp;to&nbsp;moduleB,&nbsp;it&nbsp;loads&nbsp;the&nbsp;wrong&nbsp;module.<br>
<br>
I&nbsp;see&nbsp;that&nbsp;somebody&nbsp;else&nbsp;had&nbsp;complained&nbsp;about&nbsp;this&nbsp;problem&nbsp;in<br>
mod_python&nbsp;1.3.1&nbsp;but&nbsp;it&nbsp;still&nbsp;has&nbsp;not&nbsp;been&nbsp;patched.<br>
<br>
Any&nbsp;ideas?<br>
<br>
Hozi<br>
<br>
<br>
_______________________________________________<br>
Mod_python&nbsp;mailing&nbsp;list<br>
&lt;a&nbsp;class=&quot;moz-txt-link-abbreviated&quot;&nbsp;href=&quot;mailto:Mod_python@modpython.org&quot;&gt;Mod_python@modpython.org&lt;/a&gt;<br>
&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://mailman.modpython.org/mailman/listinfo/mod_python&quot;&gt;http://mailman.modpython.org/mailman/listinfo/mod_python&lt;/a&gt;<br>
&nbsp;<br>
&nbsp;<br>
&nbsp;<br>
&nbsp;_______________________________________________<br>
Mod_python&nbsp;mailing&nbsp;list<br>
&lt;a&nbsp;class=&quot;moz-txt-link-abbreviated&quot;&nbsp;href=&quot;mailto:Mod_python@modpython.org&quot;&gt;Mod_python@modpython.org&lt;/a&gt;<br>
&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://mailman.modpython.org/mailman/listinfo/mod_python&quot;&gt;http://mailman.modpython.org/mailman/listinfo/mod_python&lt;/a&gt;<br>
<br>
&nbsp;<br>
&nbsp;_______________________________________________<br>
Mod_python&nbsp;mailing&nbsp;list<br>
&lt;a&nbsp;class=&quot;moz-txt-link-abbreviated&quot;&nbsp;href=&quot;mailto:Mod_python@modpython.org&quot;&gt;Mod_python@modpython.org&lt;/a&gt;<br>
&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://mailman.modpython.org/mailman/listinfo/mod_python&quot;&gt;http://mailman.modpython.org/mailman/listinfo/mod_python&lt;/a&gt;<br>
<br>
<br>
&nbsp;<br>
<br>
&nbsp;<br>
&nbsp;<br>
&nbsp;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/pre&gt;<br>
&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;&lt;!----&gt;<br>
<br>
&nbsp;&nbsp;&lt;/pre&gt;<br>
&lt;/blockquote&gt;<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
