From mmmietti at cs.Helsinki.FI  Mon Mar  1 10:22:13 2004
From: mmmietti at cs.Helsinki.FI (Miikka Miettinen)
Date: Mon Mar  1 04:17:45 2004
Subject: [mod_python] Connection Handler in a virtual host
Message-ID: <Pine.LNX.4.44.0403010945540.13197-100000@melkinpaasi.cs.Helsinki.FI>

Hi,

I'm trying to set up two name based virtual hosts, one of which would use 
the mod_python connection handler. For some reason, the following 
configuration doesn't work:

------------------------ 
NameVirtualHost *:80

<VirtualHost *:80>
    #this is an "ordinary web site"
    ServerName site1.xyz.org:80
    DocumentRoot /var/www/site1/htdocs
    #...
</VirtualHost>

<VirtualHost *:80>
    ServerName site2.xyz.org:80
    DocumentRoot /var/www/site2/htdocs
    PythonPath "sys.path+['/var/www/test']"
    PythonConnectionHandler conntest
</VirtualHost>
------------

The virtual hosts exist and have different document roots, but my 
connection handler is never called. On the other hand, if I put the 
virtual hosts in different ports, everything works fine:

------------
NameVirtualHost *:80

<VirtualHost *:80>
    #this is an "ordinary web site"
    ServerName site1.xyz.org:80
    DocumentRoot /var/www/site1/htdocs
    #...
</VirtualHost>

Listen 8080
NameVirtualHost *:8080
<VirtualHost *:8080>
    ServerName site2.xyz.org:8080
    DocumentRoot /var/www/site2/htdocs
    PythonPath "sys.path+['/var/www/test']"
    PythonConnectionHandler conntest
</VirtualHost>
------------

I would prefer to use just one port. Does something in Apache or 
mod_python prevent this, or is the configuration just wrong? I'm using 
Apache 2.0.47 and mod_python 3.0.4.

Thanks in advance for your help!

Miikka

From manfred.stienstra at dwerg.net  Mon Mar  1 09:39:16 2004
From: manfred.stienstra at dwerg.net (Manfred Stienstra)
Date: Mon Mar  1 04:30:23 2004
Subject: [mod_python] XML-RPC?
In-Reply-To: <4042865A.8030403@mlug.missouri.edu>
References: <4041D0ED.70807@mlug.missouri.edu>
	 <1078091860.4526.4.camel@ack.dwerg.net>
	 <40426719.8060801@mlug.missouri.edu>
	 <1078095306.4528.16.camel@ack.dwerg.net>
	 <4042865A.8030403@mlug.missouri.edu>
Message-ID: <1078130356.4524.19.camel@ack.dwerg.net>

On Mon, 2004-03-01 at 01:39, Michael wrote:
> >The error appears to come from the Unmarshaller, so I guess you will
> >have to hack into that to figure out what goes wrong...  
> >
> Indeed, and only when run inside Apache/mod_python. I was wondering if 
> there was some threading issue with whatever parser xmlrpclib is trying 
> to use. Something like that maybe?

I didn't write the xmlrpc library, so I don't know. Maybe someone else
on the list knows?

Manfred

p.s. Please reply to the list as well

From kamil at nvstudio.pl  Mon Mar  1 15:28:55 2004
From: kamil at nvstudio.pl (Kamil Niechajewicz)
Date: Mon Mar  1 09:22:54 2004
Subject: [mod_python] Connection Handler in a virtual host
In-Reply-To: <Pine.LNX.4.44.0403010945540.13197-100000@melkinpaasi.cs.Helsinki.FI>
References: <Pine.LNX.4.44.0403010945540.13197-100000@melkinpaasi.cs.Helsinki.FI>
Message-ID: <20040301152855.412de1a8.kamil@nvstudio.pl>

On Mon, 1 Mar 2004 10:22:13 +0200 (EET)
Miikka Miettinen <mmmietti@cs.Helsinki.FI> wrote:

> <VirtualHost *:80>
>     #this is an "ordinary web site"
>     ServerName site1.xyz.org:80
>     DocumentRoot /var/www/site1/htdocs
>     #...
> </VirtualHost>
> 
> <VirtualHost *:80>
>     ServerName site2.xyz.org:80
>     DocumentRoot /var/www/site2/htdocs
>     PythonPath "sys.path+['/var/www/test']"
>     PythonConnectionHandler conntest
> </VirtualHost>

Why are you doing VirtualHost *:80 two times? Shouldn't it be:

<VirtualHost site1.xyz.org:80>
     ServerName site1.xyz.org:80
     DocumentRoot /var/www/site1/htdocs
</VirtualHost>

<VirtualHost site2.xyz.org:80>
     ServerName site2.xyz.org:80
     DocumentRoot /var/www/site2/htdocs
     PythonPath "sys.path+['/var/www/test']"
     PythonConnectionHandler conntest
 </VirtualHost>

Changing ports worked probably because those two declarations
were different. When you have *:80 and *:80 the first (or last, I 
don't remember) was applied to every possible host, I guess. You 
need to specify hostname in VirtualHost directive..

/K
From mmmietti at cs.Helsinki.FI  Mon Mar  1 16:31:46 2004
From: mmmietti at cs.Helsinki.FI (Miikka Miettinen)
Date: Mon Mar  1 10:27:16 2004
Subject: [mod_python] Connection Handler in a virtual host
In-Reply-To: <20040301152855.412de1a8.kamil@nvstudio.pl>
Message-ID: <Pine.LNX.4.44.0403011554550.19290-100000@melkinpaasi.cs.Helsinki.FI>

> > <VirtualHost *:80>
> >     #this is an "ordinary web site"
> >     ServerName site1.xyz.org:80
> >     DocumentRoot /var/www/site1/htdocs
> >     #...
> > </VirtualHost>
> > 
> > <VirtualHost *:80>
> >     ServerName site2.xyz.org:80
> >     DocumentRoot /var/www/site2/htdocs
> >     PythonPath "sys.path+['/var/www/test']"
> >     PythonConnectionHandler conntest
> > </VirtualHost>
> 
> Why are you doing VirtualHost *:80 two times?

I guess different ServerName should be sufficient to identify the 
virtual host (and that part seems to work, since the sites have different 
document roots when I test them with a browser).

> Shouldn't it be:
> 
> <VirtualHost site1.xyz.org:80>
>      ServerName site1.xyz.org:80
>      DocumentRoot /var/www/site1/htdocs
> </VirtualHost>
> 
> <VirtualHost site2.xyz.org:80>
>      ServerName site2.xyz.org:80
>      DocumentRoot /var/www/site2/htdocs
>      PythonPath "sys.path+['/var/www/test']"
>      PythonConnectionHandler conntest
>  </VirtualHost>

If I try this (supplemented with "NameVirtualHost site1.xyz.org:80" and 
"NameVirtualHost site2.xyz.org:80"), I get the warning "NameVirtualHost 
site2.xyz.org:80 has no VirtualHosts". Again, both sites work and have 
different document roots, but the connection handler still isn't called.

If I understood the Apache documentation correctly, you normally use the 
server's IP address in the NameVirtualHost directive. I only have one IP 
address, so maybe I get the warning because both virtual hosts somehow 
look the same. But the document roots are different. Confusing.

Miikka

From kamil at nvstudio.pl  Mon Mar  1 18:13:56 2004
From: kamil at nvstudio.pl (Kamil Niechajewicz)
Date: Mon Mar  1 12:07:53 2004
Subject: [mod_python] Connection Handler in a virtual host
In-Reply-To: <Pine.LNX.4.44.0403011554550.19290-100000@melkinpaasi.cs.Helsinki.FI>
References: <20040301152855.412de1a8.kamil@nvstudio.pl>
	<Pine.LNX.4.44.0403011554550.19290-100000@melkinpaasi.cs.Helsinki.FI>
Message-ID: <20040301181356.7710ade6.kamil@nvstudio.pl>

On Mon, 1 Mar 2004 16:31:46 +0200 (EET)
Miikka Miettinen <mmmietti@cs.helsinki.fi> wrote:

> If I try this (supplemented with "NameVirtualHost site1.xyz.org:80" and 
> "NameVirtualHost site2.xyz.org:80"), I get the warning "NameVirtualHost 
> site2.xyz.org:80 has no VirtualHosts". Again, both sites work and have 
> different document roots, but the connection handler still isn't called.
> 
> If I understood the Apache documentation correctly, you normally use the 
> server's IP address in the NameVirtualHost directive. I only have one IP 
> address, so maybe I get the warning because both virtual hosts somehow 
> look the same. But the document roots are different. Confusing.

I will give you example for my site, for example somewhere I have IP 
1.2.3.4 which serves two virtual hosts xyz.org and abc.com

You need only one NameVirtualHost because you just want to tell Apache
what IPs serve virtual hosts. When your hosts have IN A for the same IP 
just put it in NameVirtualHost, and then define those hosts in VirtualHost
directive.

NameVirtualHost 1.2.3.4

<VirtualHost xyz.org:80>
   ...
</VirtualHost>

<VirtualHost abc.com:80>
  ...
</VirtualHost>

<VirtualHost 1.2.3.4:80>
   # this will be applied when user views http://1.2.3.4 instead
   # of http://abc.com or http://xyz.org
</VirtualHost>

and it works without problem and always worked.

/K
From mmmietti at cs.Helsinki.FI  Mon Mar  1 19:15:47 2004
From: mmmietti at cs.Helsinki.FI (Miikka Miettinen)
Date: Mon Mar  1 13:11:16 2004
Subject: [mod_python] Connection Handler in a virtual host
In-Reply-To: <20040301181356.7710ade6.kamil@nvstudio.pl>
Message-ID: <Pine.LNX.4.44.0403011904340.19290-100000@melkinpaasi.cs.Helsinki.FI>

> You need only one NameVirtualHost because you just want to tell Apache
> what IPs serve virtual hosts. When your hosts have IN A for the same IP 
> just put it in NameVirtualHost, and then define those hosts in VirtualHost
> directive.

Ok, thanks for the tip.


> NameVirtualHost 1.2.3.4
> 
> <VirtualHost xyz.org:80>
>    ...
> </VirtualHost>
> 
> <VirtualHost abc.com:80>
>   ...
> </VirtualHost>
> 
> <VirtualHost 1.2.3.4:80>
>    # this will be applied when user views http://1.2.3.4 instead
>    # of http://abc.com or http://xyz.org
> </VirtualHost>

I did this, but the connection handler is still not being called. :(


Miikka

From grisha at modpython.org  Mon Mar  1 12:35:36 2004
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Mon Mar  1 13:31:14 2004
Subject: [mod_python] Connection Handler in a virtual host
In-Reply-To: <Pine.LNX.4.44.0403010945540.13197-100000@melkinpaasi.cs.Helsinki.FI>
References: <Pine.LNX.4.44.0403010945540.13197-100000@melkinpaasi.cs.Helsinki.FI>
Message-ID: <20040301123348.F72971@onyx.ispol.com>



On Mon, 1 Mar 2004, Miikka Miettinen wrote:

> Hi,
>
> I'm trying to set up two name based virtual hosts, one of which would use
> the mod_python connection handler.

NameBased virtual hosts are based on the Host: header of the HTTP
protocol. Connection handlers step in before any HTTP processing takes
place, therefore you cannot use connection handlers with namebased virtual
hosts.

Grisha
From neel at mediapulse.com  Mon Mar  1 12:45:46 2004
From: neel at mediapulse.com (Michael C. Neel)
Date: Mon Mar  1 13:41:18 2004
Subject: [mod_python] Connection Handler in a virtual host
Message-ID: <C0FC22C08B82074A88B500617641577787A85B@johnson.mediapulse.net>

I would setup the virt host's like such:

NameVirtualHost 1.2.3.4

<VirtualHost 1.2.3.4:80>
     ServerName site1.xyz.org
     DocumentRoot /var/www/site1/htdocs
</VirtualHost>

<VirtualHost 1.2.3.4:80>
     ServerName site2.xyz.org
     DocumentRoot /var/www/site2/htdocs
     PythonPath "sys.path+['/var/www/test']"
     PythonConnectionHandler conntest
</VirtualHost>

Things may have changed with recent options of Apache, but in the past
the first declared VirtualHost would be called if no ServerName or
ServerAlias directives matched.  Also, to help test you can setup
different log files in each VirtualHost, and verify that way which host
if being called on the request.

Mike

> > NameVirtualHost 1.2.3.4
> > 
> > <VirtualHost xyz.org:80>
> >    ...
> > </VirtualHost>
> > 
> > <VirtualHost abc.com:80>
> >   ...
> > </VirtualHost>
> > 
> > <VirtualHost 1.2.3.4:80>
> >    # this will be applied when user views http://1.2.3.4 instead
> >    # of http://abc.com or http://xyz.org
> > </VirtualHost>
> 
> I did this, but the connection handler is still not being called. :(
> 

From mmmietti at cs.Helsinki.FI  Mon Mar  1 21:35:16 2004
From: mmmietti at cs.Helsinki.FI (Miikka Miettinen)
Date: Mon Mar  1 15:30:49 2004
Subject: [mod_python] Connection Handler in a virtual host
In-Reply-To: <20040301123348.F72971@onyx.ispol.com>
Message-ID: <Pine.LNX.4.44.0403012132001.11707-100000@melkinpaasi.cs.Helsinki.FI>

> > I'm trying to set up two name based virtual hosts, one of which would use
> > the mod_python connection handler.
> 
> NameBased virtual hosts are based on the Host: header of the HTTP
> protocol. Connection handlers step in before any HTTP processing takes
> place, therefore you cannot use connection handlers with namebased virtual
> hosts.

Okay, makes sense. Thanks a lot!

Miikka

From uke at jeremy.org  Mon Mar  1 11:54:37 2004
From: uke at jeremy.org (jeremy bornstein)
Date: Mon Mar  1 15:55:43 2004
Subject: [mod_python] Large database-backed mod_python sites?
Message-ID: <20040301195437.GI17530@jeremy.org>

Greetings!  I'm new here but have been using mod_python for a while
now.

I'm trying to find out if anyone has built a large database-backed
website using mod_python.  The context is that I'm building something
which will have to grow to support tens of thousands of simultaneous
users if successful, and it would make my bosses much more comfortable
to know that someone has already done something vaguely similar.  In
my case there will be multiple webserver machines to support the load,
and possibly several (horizontally-partitioned) databases.

Many thanks in advance for any pointers!

Best Regards,
Jeremy Bornstein


-- 
                 jeremy bornstein <jeremy@svadhisthana.org>
                                    -*-
   ESTRAGON: I can't go on like this.   VLADIMIR: That's what you think.
                                    -*-
                             http://jeremy.org/
From jochen.rebhan at primaverasoft.pt  Wed Mar  3 10:01:19 2004
From: jochen.rebhan at primaverasoft.pt (Jochen Rebhan)
Date: Tue Mar  2 05:57:03 2004
Subject: [mod_python] Win32 platform
Message-ID: <1924BF350FC96B46A56BB38087B9B86E952708@srvcorreio.primavera.local>

Has anyone managed to install v3.1.3 on a win32  platform ? 

(WinXP, Apache Win32, Python 2.3.3).

I have both the Mingw gcc as well as VC.Net v.7 installed.

Any help would by highly appreciated !


Regards

Jochen Rebhan
jochen.rebhan@primaverasoft.pt



From azaroth at liverpool.ac.uk  Tue Mar  2 11:42:08 2004
From: azaroth at liverpool.ac.uk (Robert Sanderson)
Date: Tue Mar  2 07:45:22 2004
Subject: [mod_python] BerkeleyDB and 4Suite
In-Reply-To: <1924BF350FC96B46A56BB38087B9B86E952708@srvcorreio.primavera.local>
Message-ID: <Pine.LNX.4.44.0403021133500.819-100000@gondolin.hist.liv.ac.uk>


I've had trouble using these libraries and was wondering if any one had 
had any luck?

If I run the code outside of mod_python everything works as expected. When 
I import the code into a mod_python interpreter, the following occurs:

When importing 4Suite, it fails because it finds the wrong version of 
expat.  I can only assume that it's finding the version compiled with 
Apache first, before finding the one compiled for Python.

Bsddb (the version that comes with 2.3.3) imports okay, but I can't read 
open any database.  It fails with an invalid argument error: 22.  The same 
code works as expected outside of mod_python.

Apache is set to run as the database owner, so it shouldn't be 
permissions. To make sure, I recreated the db as 0777 and it still failed 
to open.

Environment:
i686 linux (Redhat 9) + Apache 2.0.48, Python 2.3.3, mod_python 3.1.2b, 
4Suite 1.0a3, the latest BerkeleyDB


Many thanks,

Rob

-- 
      ,'/:.          Dr Robert Sanderson (azaroth@liverpool.ac.uk)
    ,'-/::::.        http://www.o-r-g.org/~azaroth/
  ,'--/::(@)::.      Special Collections and Archives, extension 3142
,'---/::::::::::.    Nebmedes:  http://nebmedes.o-r-g.org:8000/
____/:::::::::::::.  
I L L U M I N A T I  



From mogmios at mlug.missouri.edu  Wed Mar  3 15:06:55 2004
From: mogmios at mlug.missouri.edu (Michael)
Date: Wed Mar  3 19:02:13 2004
Subject: [mod_python] compiling
Message-ID: <4046650F.60308@mlug.missouri.edu>

I'm recompiling Apache, Python, and mod_python to try to figure out why 
mod_python + xmlrpclib doesn't work for me. I'm trying to use a custom 
compled version of Python compiled without thread support to see if that 
helps. I also compiled Apache without PHP this time.

I noticed that during 'make install' I had problems because the script 
was attempting to use an old copy of Python. I was surprised because I'd 
told it where to find the copy of Python I'd custom compiled. Maybe this 
is an installation bug? I had to manually kill the symlink to the old 
copy of Python and point it to the new copy so that installation could 
work properly.

Now when I try to start Apache I get this error:

Cannot load /usr/local/apache/libexec/mod_python.so into server: 
/usr/local/apache/libexec/mod_python.so: undefined symbol: openpty
/usr/local/apache/bin/apachectl start: httpd could not be started


Any idea what's wrong? Thanks.
From mogmios at mlug.missouri.edu  Wed Mar  3 23:24:12 2004
From: mogmios at mlug.missouri.edu (Michael)
Date: Thu Mar  4 03:19:27 2004
Subject: [mod_python] compiling
In-Reply-To: <4046650F.60308@mlug.missouri.edu>
References: <4046650F.60308@mlug.missouri.edu>
Message-ID: <4046D99C.4050303@mlug.missouri.edu>

Another problem that I ran into with the install process. I decided to 
move to keeping Apache and all webserving related programs to being 
contained within my webserver users files. Just to make it easier to 
make sure no extra files were interfering with the process. As a DSO the 
install process was having the same problem as before. I tried switching 
to a static compile and during install I got his error:

Performing static instalation.
/usr/bin/install -c -o webserve -g webserve -d 
/home/webserver/Apachetoolbox-1.5.69/apache_1.3.29/src/modules/python
/usr/bin/install: invalid user `webserve'
make[1]: *** [install_static] Error 1
make[1]: Leaving directory 
`/home/webserver/Apachetoolbox-1.5.69/src/mod_python-2.7.8'
make: *** [install] Error 2

It looks to me as if the install script is cutting the last letter off 
my username.

> I'm recompiling Apache, Python, and mod_python to try to figure out 
> why mod_python + xmlrpclib doesn't work for me. I'm trying to use a 
> custom compled version of Python compiled without thread support to 
> see if that helps. I also compiled Apache without PHP this time.
>
> I noticed that during 'make install' I had problems because the script 
> was attempting to use an old copy of Python. I was surprised because 
> I'd told it where to find the copy of Python I'd custom compiled. 
> Maybe this is an installation bug? I had to manually kill the symlink 
> to the old copy of Python and point it to the new copy so that 
> installation could work properly.
>
> Now when I try to start Apache I get this error:
>
> Cannot load /usr/local/apache/libexec/mod_python.so into server: 
> /usr/local/apache/libexec/mod_python.so: undefined symbol: openpty
> /usr/local/apache/bin/apachectl start: httpd could not be started
>
>
> Any idea what's wrong? Thanks.


From mollo at club-internet.fr  Thu Mar  4 10:57:56 2004
From: mollo at club-internet.fr (mollo)
Date: Thu Mar  4 05:53:30 2004
Subject: [mod_python] Httpd.conf help for Spyce & mod_python
Message-ID: <20040304105756.4da1c0de@concord.bghflt.org>

Hello List,

I've installed last mod_python 2.7 with python 2.2 and apache 1.3.26
(Debian woody)

The installations examples given in the mod_python doc works nice.

AddModule [snip] mod_python.so

<Directory /var/www/python>
  AddHandler python-program .py
  PythonHandler test # the test.py "hello world" located in               
                     # /var/www/python
  PythonDebug On
</Directory


After I'added spyce (spyce.sourceforge.net) : 

<IfModule mod_python.c>
  AddHandler python-program .spy
  PythonHandler run_spyceModpy::spyceMain
  PythonPath "sys.path+[r'/usr/lib/spyce']"
  #PythonOption SPYCE_CONFIG "/mydir/spyce.conf"
  #PythonOptimize On
</IfModule>

Spyce run nice, but the "original" directives for mod_python don't work anymore with the test.py giving :

---------------
Mod_python error: "PythonHandler mod_python"

Traceback (most recent call last):

  File "/usr/lib/python2.2/site-packages/mod_python/apache.py", line 185, in Dispatch
    object = resolve_object(req, module, object_str, silent)

  File "/usr/lib/python2.2/site-packages/mod_python/apache.py", line 394, in resolve_object
    raise AttributeError, s

AttributeError: module '/usr/lib/python2.2/site-packages/mod_python/__init__.py' contains no 'handler'
----------------


Any tricks for running theses two tools as handler :

mod_python for .py
Spyce for .spy


Thanks 
Mathieu






-- 
From SAiello at Jentoo.com  Thu Mar  4 07:31:57 2004
From: SAiello at Jentoo.com (SAiello@Jentoo.com)
Date: Thu Mar  4 08:28:38 2004
Subject: [mod_python] Session Classes and Documentation
In-Reply-To: <20040116221158.F9788@onyx.ispol.com>
References: <20040116221158.F9788@onyx.ispol.com>
Message-ID: <200403040731.57699.SAiello@Jentoo.com>

I am just starting to try mod_python. I read the 3.1 documentation on the web 
site, chapter 4.8.1 on Classes. Reading the info on "class MemorySession" & 
"class DbmSession", both paragraphs say, "Note that using this class directly 
is not cross-platform. For best compatibility across platforms, always use 
the Session() function to create sessions.". When I just use, "sess = 
Session(req)", I get the following error:

Mod_python error: "PythonHandler mod_python.publisher"

Traceback (most recent call last):

File "/usr/lib/python2.3/site-packages/mod_python/apache.py", line 299, in 
HandlerDispatch
result = object(req)

File "/usr/lib/python2.3/site-packages/mod_python/publisher.py", line 136, in 
handler
    result = util.apply_fs_data(object, req.form, req=req)

File "/usr/lib/python2.3/site-packages/mod_python/util.py", line 361, in 
apply_fs_data
return object(**args)

File "/var/www/localhost/htdocs/python/test.py", line 5, in hello
sess = Session(req)

TypeError: 'module' object is not callable

But if I use either "sess=Session.DbmSession(req)" or 
"sess=Session.MemorySession(req)", everything works. Please advise.

Thanks,
From SAiello at Jentoo.com  Thu Mar  4 08:09:29 2004
From: SAiello at Jentoo.com (SAiello@Jentoo.com)
Date: Thu Mar  4 09:06:05 2004
Subject: [mod_python] Session Classes and Documentation
In-Reply-To: <NHBBJIKGILMEKGJNGPPBEEKEDDAA.fheredero@topmusic.ch>
References: <NHBBJIKGILMEKGJNGPPBEEKEDDAA.fheredero@topmusic.ch>
Message-ID: <200403040809.29211.SAiello@Jentoo.com>

On Thursday 04 March 2004 08:02 am, Fran?ois Heredero - Top Music SA wrote:
> > File "/var/www/localhost/htdocs/python/test.py", line 5, in hello
> > sess = Session(req)
> >
> > TypeError: 'module' object is not callable
>
> Perhaps Session.Session(req) if you use :
> import Session

Using "sess=Session.Session(req)", worked.

Thank you,

From davidf at sjsoft.com  Thu Mar  4 18:44:52 2004
From: davidf at sjsoft.com (David Fraser)
Date: Thu Mar  4 12:40:27 2004
Subject: [mod_python] Win32 platform - test installers available
In-Reply-To: <1924BF350FC96B46A56BB38087B9B86E952708@srvcorreio.primavera.local>
References: <1924BF350FC96B46A56BB38087B9B86E952708@srvcorreio.primavera.local>
Message-ID: <40475D04.2090807@sjsoft.com>

Jochen Rebhan wrote:

>Has anyone managed to install v3.1.3 on a win32  platform ? 
>
>(WinXP, Apache Win32, Python 2.3.3).
>
>I have both the Mingw gcc as well as VC.Net v.7 installed.
>
>Any help would by highly appreciated !
>
>  
>
Me too! :-)
Is there a reason there hasn't been a binary made for win32 yet?
I'll try and look at it myself now, but using VC++ 6 so may be difficult...
I am using Apache 2.0.48 win32 sources and Python 2.3.3 standard 
distribution...

Compiling Apache for windows is described here:
http://httpd.apache.org/docs-2.0/platform/win_compiling.html
That seems to work fine with VC++ 6

Compiling mod_python for windows seems to require compiling in src based 
on the project file for VC++7
I took the vc7to6_prjconverter tool from 
http://www.codeproject.com/tools/prjconverter.asp and converted the file 
for VC++6
Then I had to manually change paths to point to my Apache include and 
Release (lib) directories and my Python include and libs directories
(note that I didn't have to compile Python from source as the include 
and libs are included with the standard distribution...)
These originally are set as $(PYTHONSRC) and $(APACHESRC) in the include 
and libs paths.
I also had to manually add the srclib/apr/include and 
srclib/apr-util/include directories from Apache to the include path, and 
the srclib/apr/Release and srclib/apr-util/Release directories to the 
library path.
Then mod_python linked successfully!

To build the win32 installer it needs to be done in the dist directory 
(apparently under Unix)
I had troubles trying to run configure on MinGW as it needs an apxs to 
find...
but the APXS is not actually needed for the setup script (the code that 
used it is commented out)
So I ran configure on Linux, and built the installer there...
This is done by copying src/Release/mod_python.so to the dist directory.

In fact I found that by simply copying the setup.py generated on Linux I 
could run this on Windows
The instruction is:
  setup.py bdist_wininst --install-script=win32_postinstall.py

I hope the above instructions are useful to anyone else trying the same 
thing.
I have not yet fully tested this binary or installer but it seemed to 
run our applications fine.
mod_python.so and mod_python-3.1.3.win32.exe can be downloaded from:
http://davidf.sjsoft.com/files/mod_python.so
http://davidf.sjsoft.com/files/mod_python-3.1.3.win32.exe

I would appreciate feedback (on this list) so that hopefully these can 
be included in the official release ...

David
From grisha at modpython.org  Thu Mar  4 12:19:12 2004
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Thu Mar  4 13:14:52 2004
Subject: [mod_python] Win32 platform - test installers available
In-Reply-To: <40475D04.2090807@sjsoft.com>
References: <1924BF350FC96B46A56BB38087B9B86E952708@srvcorreio.primavera.local>
	<40475D04.2090807@sjsoft.com>
Message-ID: <20040304115447.R32625@onyx.ispol.com>



On Thu, 4 Mar 2004, David Fraser wrote:

> Is there a reason there hasn't been a binary made for win32 yet?

mainly because making one is a PITA... i'll get to it some time. if anyone
wants to volunteer, you are more than welcome

> I'll try and look at it myself now, but using VC++ 6 so may be difficult...
> I am using Apache 2.0.48 win32 sources and Python 2.3.3 standard
> distribution...

you shouldn't need apache sources. just install the binary apache
distribution, but remember to click on the "custom" install and include
the header files.

> Compiling Apache for windows is described here:
> http://httpd.apache.org/docs-2.0/platform/win_compiling.html
> That seems to work fine with VC++ 6

see above; no need to compile apache

> Compiling mod_python for windows seems to require compiling in src based
> on the project file for VC++7

i actually use the .net version (is that same as 7?) - sorry, it's the
only thing i have access to.

> I took the vc7to6_prjconverter tool from
> http://www.codeproject.com/tools/prjconverter.asp and converted the file
> for VC++6
> Then I had to manually change paths to point to my Apache include and
> Release (lib) directories and my Python include and libs directories

> (note that I didn't have to compile Python from source as the include
> and libs are included with the standard distribution...)

correct, no need to compile your own Python either

> These originally are set as $(PYTHONSRC) and $(APACHESRC) in the include
> and libs paths.

yes. these are the only things you should set (in system preferences |
environment)

> I also had to manually add the srclib/apr/include and
> srclib/apr-util/include directories from Apache to the include path, and
> the srclib/apr/Release and srclib/apr-util/Release directories to the
> library path.

this is because you compiled your own apache

> Then mod_python linked successfully!

cool

>
> To build the win32 installer it needs to be done in the dist directory
> (apparently under Unix)
> I had troubles trying to run configure on MinGW as it needs an apxs to
> find...
> but the APXS is not actually needed for the setup script (the code that
> used it is commented out)
> So I ran configure on Linux, and built the installer there...
> This is done by copying src/Release/mod_python.so to the dist directory.

not anymore, it now can be done under windows. In fact it *has* to because
this step also compiles _psp.

you DO need to manually create a setup.py from setup.py.in since
./configure, as you noted, won't work on windows

> In fact I found that by simply copying the setup.py generated on Linux I
> could run this on Windows
> The instruction is:
>   setup.py bdist_wininst --install-script=win32_postinstall.py

perhaps distutils take care of it automtically, but I've always
done it separately, building the mod_python package for the standard lib,
which would be a step just before the bdist_wininst.

I had to copy src and mod_python (in lib/python) to under dist (on unix
the makefiles creates symlinks, but they don't work under windows, so you
have to copy), then run

(This has to be run from the VC++ msdos shell, since it will invoke the
compiler to build _psp.so (or _psp.dll, don't remember))

 python setup.py build

>
> I hope the above instructions are useful to anyone else trying the same
> thing.

me too. And if someone would care to clean up the Windows build process
and make it seamless enough and contribute it as a patch, we would all
very much appreciate it. I personally dislike Windows so much, I don't
know that will ever bring myself to doing this - just building the Windows
installer is already such a horrifying experience that I usually don't
touch Windows for months thereafeter ;-)

> I have not yet fully tested this binary or installer but it seemed to
> run our applications fine.
> mod_python.so and mod_python-3.1.3.win32.exe can be downloaded from:
> http://davidf.sjsoft.com/files/mod_python.so
> http://davidf.sjsoft.com/files/mod_python-3.1.3.win32.exe

See if you can run the tests. You will have to manually rig a testconf.py
(NOTE - it will not like blanks in path names, e.g. "Program Files", the
only work around I found was using the DOS path name, which you can
determine by firing up command.exe (as opposed to cmd.exe) i believe). But
once you get past the testconf.py, usually all tests run OK.

>
> I would appreciate feedback (on this list) so that hopefully these can
> be included in the official release ...

Thanks for trying!

Grisha

>
> David
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From conrad at hep.caltech.edu  Thu Mar  4 14:53:11 2004
From: conrad at hep.caltech.edu (Conrad Steenberg)
Date: Thu Mar  4 18:48:42 2004
Subject: [mod_python] Impatient Apache server?
Message-ID: <1078440791.1914.362.camel@heppc22.hep.caltech.edu>

Hi

This may be more of an an Apache question, but anyway:

Under the prefork MPM, when Apache gets shut down it gives each child
process a certain amount of time to exit before sending it a TERM
signal, and printing in the log:
[warn] child process XXXX still did not exit, sending a SIGTERM

Is there a way to give the child processes more time to exit on their
own before they get killed forcibly?

Thanks

Conrad


-- 
Conrad Steenberg <conrad@hep.caltech.edu>

From davidf at sjsoft.com  Fri Mar  5 10:32:18 2004
From: davidf at sjsoft.com (David Fraser)
Date: Fri Mar  5 04:27:59 2004
Subject: [mod_python] Win32 platform - test installers available
In-Reply-To: <20040304115447.R32625@onyx.ispol.com>
References: 
	<1924BF350FC96B46A56BB38087B9B86E952708@srvcorreio.primavera.local>
	<40475D04.2090807@sjsoft.com> <20040304115447.R32625@onyx.ispol.com>
Message-ID: <40483B12.2010505@sjsoft.com>

Gregory (Grisha) Trubetskoy wrote:

>On Thu, 4 Mar 2004, David Fraser wrote:
>  
>
>>Is there a reason there hasn't been a binary made for win32 yet?
>>    
>>
>mainly because making one is a PITA... i'll get to it some time. if anyone
>wants to volunteer, you are more than welcome
>  
>
Cool. We need it for our apps, so I'll do this seeing as I have got it 
working now...

>>I'll try and look at it myself now, but using VC++ 6 so may be difficult...
>>I am using Apache 2.0.48 win32 sources and Python 2.3.3 standard
>>distribution...
>>    
>>
>you shouldn't need apache sources. just install the binary apache
>distribution, but remember to click on the "custom" install and include
>the header files.
>  
>
Thanks, that's helpful...

>>Compiling Apache for windows is described here:
>>http://httpd.apache.org/docs-2.0/platform/win_compiling.html
>>That seems to work fine with VC++ 6
>>    
>>
>see above; no need to compile apache
>  
>
>>Compiling mod_python for windows seems to require compiling in src based
>>on the project file for VC++7
>>    
>>
>i actually use the .net version (is that same as 7?) - sorry, it's the
>only thing i have access to.
>  
>
Yes, .net is version 7. Likewise version 6 is the only one I have access 
to ... but shouldn't make much of a difference to people...

>>I took the vc7to6_prjconverter tool from
>>http://www.codeproject.com/tools/prjconverter.asp and converted the file
>>for VC++6
>>Then I had to manually change paths to point to my Apache include and
>>Release (lib) directories and my Python include and libs directories
>>    
>>
>
>  
>
>>(note that I didn't have to compile Python from source as the include
>>and libs are included with the standard distribution...)
>>    
>>
>
>correct, no need to compile your own Python either
>
>  
>
>>These originally are set as $(PYTHONSRC) and $(APACHESRC) in the include
>>and libs paths.
>>    
>>
>
>yes. these are the only things you should set (in system preferences |
>environment)
>  
>
OK, Visual C++ 6 actually can handle these settings, I just had them 
wrong, so there are no changes needed to the generated .dsp file...

>>I also had to manually add the srclib/apr/include and
>>srclib/apr-util/include directories from Apache to the include path, and
>>the srclib/apr/Release and srclib/apr-util/Release directories to the
>>library path.
>>    
>>
>this is because you compiled your own apache
>  
>
Right, I didn't need them when using the Apache installation + include + 
libs

>>Then mod_python linked successfully!
>>    
>>
>cool
>  
>
>>To build the win32 installer it needs to be done in the dist directory
>>(apparently under Unix)
>>I had troubles trying to run configure on MinGW as it needs an apxs to
>>find...
>>but the APXS is not actually needed for the setup script (the code that
>>used it is commented out)
>>So I ran configure on Linux, and built the installer there...
>>This is done by copying src/Release/mod_python.so to the dist directory.
>>    
>>
>not anymore, it now can be done under windows. In fact it *has* to because
>this step also compiles _psp.
>  
>
Hmmm ... the setup.py seems to not compile _psp on windows... is there a 
reason for this?
I will try and merge the two setup approaches by autodetecting 
compilability...

>you DO need to manually create a setup.py from setup.py.in since
>./configure, as you noted, won't work on windows
>  
>
I have now done a fresh patch (similar to another I did) which means 
that setup.py no longer needs configure.
Basically I search through config.status and if that fails search 
through the sources to find MP_VERSION
This can now also detect the APXS version from config.status on Unix
In any case on Windows the config.status file is hard to generate ... 
maybe what's needed here are Windows-specific changes to enable 
configure to pick up the Apache path without apxs

A final change I could do to setup.py.in would be to include the
APXS = "@APXS@"
line, then autodetect if that has not been modified by configure, and do 
the search in that case only... but that may be getting a bit complex

This code seems to be used to find an installed mod_python.so file - but 
currently seems to not include it on Unix. Am I missing something?

>>In fact I found that by simply copying the setup.py generated on Linux I
>>could run this on Windows
>>The instruction is:
>>  setup.py bdist_wininst --install-script=win32_postinstall.py
>>    
>>
>perhaps distutils take care of it automtically, but I've always
>done it separately, building the mod_python package for the standard lib,
>which would be a step just before the bdist_wininst.
>  
>
Yes, distutils should take care of this automatically...

>I had to copy src and mod_python (in lib/python) to under dist (on unix
>the makefiles creates symlinks, but they don't work under windows, so you
>have to copy), then run
>
>(This has to be run from the VC++ msdos shell, since it will invoke the
>compiler to build _psp.so (or _psp.dll, don't remember))
>
> python setup.py build
>
>  
>
I'll start trying to work the above out, just wanted to get this patch 
off for comments...

>>I hope the above instructions are useful to anyone else trying the same
>>thing.
>>    
>>
>
>me too. And if someone would care to clean up the Windows build process
>and make it seamless enough and contribute it as a patch, we would all
>very much appreciate it. I personally dislike Windows so much, I don't
>know that will ever bring myself to doing this - just building the Windows
>installer is already such a horrifying experience that I usually don't
>touch Windows for months thereafeter ;-)
>  
>
:-) Hopefully this is a step along the right direction, let me know

>>I have not yet fully tested this binary or installer but it seemed to
>>run our applications fine.
>>mod_python.so and mod_python-3.1.3.win32.exe can be downloaded from:
>>http://davidf.sjsoft.com/files/mod_python.so
>>http://davidf.sjsoft.com/files/mod_python-3.1.3.win32.exe
>>    
>>
>
>See if you can run the tests. You will have to manually rig a testconf.py
>(NOTE - it will not like blanks in path names, e.g. "Program Files", the
>only work around I found was using the DOS path name, which you can
>determine by firing up command.exe (as opposed to cmd.exe) i believe). But
>once you get past the testconf.py, usually all tests run OK.
>  
>
OK, I managed to fix the testconf.py, and will try look at 
autogenerating that too...
An initial problem, though, was that the LockFile directive is not 
included in Win32 Apache, so I have attached a patch to make this depend 
on mod_prefork

>>I would appreciate feedback (on this list) so that hopefully these can
>>be included in the official release ...
>>    
>>
>
>Thanks for trying!
>
>Grisha
>  
>
My pleasure

David

-------------- next part --------------
A non-text attachment was scrubbed...
Name: setup-lookupall.patch
Type: text/x-patch
Size: 4505 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20040305/840171d3/setup-lookupall.bin
-------------- next part --------------
A non-text attachment was scrubbed...
Name: test-win32.patch
Type: text/x-patch
Size: 573 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20040305/840171d3/test-win32.bin
From davidf at sjsoft.com  Fri Mar  5 11:34:54 2004
From: davidf at sjsoft.com (David Fraser)
Date: Fri Mar  5 05:30:43 2004
Subject: [mod_python] Win32 platform - testing...
In-Reply-To: <20040304115447.R32625@onyx.ispol.com>
References: 
	<1924BF350FC96B46A56BB38087B9B86E952708@srvcorreio.primavera.local>
	<40475D04.2090807@sjsoft.com> <20040304115447.R32625@onyx.ispol.com>
Message-ID: <404849BE.5010609@sjsoft.com>

Gregory (Grisha) Trubetskoy wrote:

>[snip]
>  
>
>>I have not yet fully tested this binary or installer but it seemed to
>>run our applications fine.
>>mod_python.so and mod_python-3.1.3.win32.exe can be downloaded from:
>>http://davidf.sjsoft.com/files/mod_python.so
>>http://davidf.sjsoft.com/files/mod_python-3.1.3.win32.exe
>>    
>>
>
>See if you can run the tests. You will have to manually rig a testconf.py
>(NOTE - it will not like blanks in path names, e.g. "Program Files", the
>only work around I found was using the DOS path name, which you can
>determine by firing up command.exe (as opposed to cmd.exe) i believe). But
>once you get past the testconf.py, usually all tests run OK.
>  
>
OK, further info on the testing on win32...
You can't test off a shared network drive on Windows! Apache will refuse 
to start up at all! (Interestingly, it will run if you run without the 
-k start, but not with it - and no error messages are generated...)
Also, you can't simply have compiled mod_python, you need to have 
installed it...
Once that was sorted out, I got the following errors (I have included 
relevant messages from the log files):
* Testing req.requires()
F
======================================================================
FAIL: test_req_requires (__main__.PerRequestTestCase)
----------------------------------------------------------------------
Traceback (most recent call last):
File "test.py", line 418, in test_req_requires
self.fail(`rsp`)
File "C:\Python\Python2.3.3\lib\unittest.py", line 270, in fail
raise self.failureException, msg
AssertionError: '<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 
2.0//EN">\n<html><head>\n<title>401 Author
ization Required</title>\n</head><body>\n<h1>Authorization 
Required</h1>\n<p>This server could not v
erify that you\nare authorized to access the document\nrequested. Either 
you supplied the wrong\ncr
edentials (e.g., bad password), or your\nbrowser doesn\'t understand how 
to supply\nthe credentials
required.</p>\n</body></html>\n'

* Testing req.sendfile()
F
[Fri Mar 05 11:27:38 2004] [error] [client 127.0.0.1] PythonHandler 
tests::req_sendfile: Traceback (most recent call last):
[Fri Mar 05 11:27:38 2004] [error] [client 127.0.0.1] PythonHandler 
tests::req_sendfile: File "\PURELIB\mod_python\apache.py", line 299, in 
HandlerDispatch
[Fri Mar 05 11:27:38 2004] [error] [client 127.0.0.1] PythonHandler 
tests::req_sendfile: File 
"C:/Apache/mod_python-3.1.3/test\htdocs\tests.py", line 680, in req_sendfile
os.remove(fname)
[Fri Mar 05 11:27:38 2004] [error] [client 127.0.0.1] PythonHandler 
tests::req_sendfile: OSError: [Errno 13] Permission denied: 
'c:\\winnt\\temp\\tmpym3ms4txt'
* Testing mod_python.psp
F
(this is not surprising as I haven't yet got mod_python.psp building...)

I'll work on the remaining issues...

David

From davidf at sjsoft.com  Fri Mar  5 12:51:02 2004
From: davidf at sjsoft.com (David Fraser)
Date: Fri Mar  5 06:47:18 2004
Subject: [mod_python] Win32 platform - compiling psp
In-Reply-To: <20040304115447.R32625@onyx.ispol.com>
References: 
	<1924BF350FC96B46A56BB38087B9B86E952708@srvcorreio.primavera.local>
	<40475D04.2090807@sjsoft.com> <20040304115447.R32625@onyx.ispol.com>
Message-ID: <40485B96.7070608@sjsoft.com>

Gregory (Grisha) Trubetskoy wrote:

>[snip]
>  
>
>>To build the win32 installer it needs to be done in the dist directory
>>(apparently under Unix)
>>I had troubles trying to run configure on MinGW as it needs an apxs to
>>find...
>>but the APXS is not actually needed for the setup script (the code that
>>used it is commented out)
>>So I ran configure on Linux, and built the installer there...
>>This is done by copying src/Release/mod_python.so to the dist directory.
>>    
>>
>
>not anymore, it now can be done under windows. In fact it *has* to because
>this step also compiles _psp.
>
>you DO need to manually create a setup.py from setup.py.in since
>./configure, as you noted, won't work on windows
>
>  
>
>>In fact I found that by simply copying the setup.py generated on Linux I
>>could run this on Windows
>>The instruction is:
>>  setup.py bdist_wininst --install-script=win32_postinstall.py
>>    
>>
>
>perhaps distutils take care of it automtically, but I've always
>done it separately, building the mod_python package for the standard lib,
>which would be a step just before the bdist_wininst.
>
>I had to copy src and mod_python (in lib/python) to under dist (on unix
>the makefiles creates symlinks, but they don't work under windows, so you
>have to copy), then run
>
>(This has to be run from the VC++ msdos shell, since it will invoke the
>compiler to build _psp.so (or _psp.dll, don't remember))
>
> python setup.py build
>  
>

OK, trying to get the win32 build for psp going ...
Previous message from Grisha on the subject (sent privately to me on 
08/21/2003 07:15 PM):

>The you'll need to build _psp.so - that you need to do in the dist
>directory, and you will need to manually create a setup.py file from
>setup.py.in. I think you will also need to copy src and lib into dist in
>order to make it work. Then you do python setup.py build and it should
>produce _psp.so.
>
>Ah, also, you'll need to edit psp_parser.c and comment out a reference to
>unistd.h, also need to do that in include/psp_flex.h.
>  
>
There's a option nounistd in the psp_parser.l code which doesn't work.
However, adding --nounistd to the flex command line does work (it 
removes the includes nicely)
This also sorts out include/psp_flex.h
It's worth noting that flex 2.5.31 compiles and works out of the box on 
CygWin (but not MinGW).

Anyway I have now modified the setup.py.in so that it can be used to 
compile without manually copying the src and lib directories.
The paths are determined automatically. I have tested this on Windows 
and Linux but obviously it would need further testing...
I attach a patch for setup.py.in
With this, mod_psp compiles successfully on Windows and passes the tests...
I also tried getting the install script to run automatically without 
having to specify it on the command line but distutils makes it tricky...

Cheers
David
-------------- next part --------------
A non-text attachment was scrubbed...
Name: setup-compilepsp.patch
Type: text/x-patch
Size: 4960 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20040305/a9844b5c/setup-compilepsp.bin
From davidf at sjsoft.com  Fri Mar  5 13:04:35 2004
From: davidf at sjsoft.com (David Fraser)
Date: Fri Mar  5 07:00:46 2004
Subject: [mod_python] Win32 platform - compiling psp
In-Reply-To: <40485B96.7070608@sjsoft.com>
References: 
	<1924BF350FC96B46A56BB38087B9B86E952708@srvcorreio.primavera.local>
	<40475D04.2090807@sjsoft.com> <20040304115447.R32625@onyx.ispol.com>
	<40485B96.7070608@sjsoft.com>
Message-ID: <40485EC3.5030103@sjsoft.com>

David Fraser wrote:

> Gregory (Grisha) Trubetskoy wrote:
>
>> [snip]
>>  
>>
>>> To build the win32 installer it needs to be done in the dist directory
>>> (apparently under Unix)
>>> I had troubles trying to run configure on MinGW as it needs an apxs to
>>> find...
>>> but the APXS is not actually needed for the setup script (the code that
>>> used it is commented out)
>>> So I ran configure on Linux, and built the installer there...
>>> This is done by copying src/Release/mod_python.so to the dist 
>>> directory.
>>>   
>>
>>
>> not anymore, it now can be done under windows. In fact it *has* to 
>> because
>> this step also compiles _psp.
>>
>> you DO need to manually create a setup.py from setup.py.in since
>> ./configure, as you noted, won't work on windows
>>
>>  
>>
>>> In fact I found that by simply copying the setup.py generated on 
>>> Linux I
>>> could run this on Windows
>>> The instruction is:
>>>  setup.py bdist_wininst --install-script=win32_postinstall.py
>>>   
>>
>>
>> perhaps distutils take care of it automtically, but I've always
>> done it separately, building the mod_python package for the standard 
>> lib,
>> which would be a step just before the bdist_wininst.
>>
>> I had to copy src and mod_python (in lib/python) to under dist (on unix
>> the makefiles creates symlinks, but they don't work under windows, so 
>> you
>> have to copy), then run
>>
>> (This has to be run from the VC++ msdos shell, since it will invoke the
>> compiler to build _psp.so (or _psp.dll, don't remember))
>>
>> python setup.py build
>>  
>>
>
> OK, trying to get the win32 build for psp going ...
> Previous message from Grisha on the subject (sent privately to me on 
> 08/21/2003 07:15 PM):
>
>> The you'll need to build _psp.so - that you need to do in the dist
>> directory, and you will need to manually create a setup.py file from
>> setup.py.in. I think you will also need to copy src and lib into dist in
>> order to make it work. Then you do python setup.py build and it should
>> produce _psp.so.
>>
>> Ah, also, you'll need to edit psp_parser.c and comment out a 
>> reference to
>> unistd.h, also need to do that in include/psp_flex.h.
>>  
>>
> There's a option nounistd in the psp_parser.l code which doesn't work.
> However, adding --nounistd to the flex command line does work (it 
> removes the includes nicely)
> This also sorts out include/psp_flex.h
> It's worth noting that flex 2.5.31 compiles and works out of the box 
> on CygWin (but not MinGW).
>
> Anyway I have now modified the setup.py.in so that it can be used to 
> compile without manually copying the src and lib directories.
> The paths are determined automatically. I have tested this on Windows 
> and Linux but obviously it would need further testing...
> I attach a patch for setup.py.in
> With this, mod_psp compiles successfully on Windows and passes the 
> tests...
> I also tried getting the install script to run automatically without 
> having to specify it on the command line but distutils makes it tricky...
>
> Cheers
> David

Sorry, bad patch...

>+if winbuild:
>+    scripts = ["win32_postinstall.py"]
>+    data_files = [(os.path.join(getmp_srcdir(), 'Release'), ["mod_python.so"])]
>  
>
This should be:

    scripts = ["win32_postinstall.py"]
    # put the mod_python.so file in the Python root ...
    # win32_postinstall.py will pick it up from there...
    data_files = [("", [(os.path.join(getmp_srcdir(), 'Release', 
'mod_python.so'))])]

But I'll fix it all up properly when I combine everything...

I also suspect our method of detecting compiling on Windows is a bit 
strange ... it only adds the scripts in if we're building a windows 
distribution.
But this is impossible from Unix anyway (since you can't compile the C 
extensions...) so maybe we should just detect the current platform

Cheers
David
From mogmios at mlug.missouri.edu  Fri Mar  5 03:06:35 2004
From: mogmios at mlug.missouri.edu (Michael)
Date: Fri Mar  5 07:01:56 2004
Subject: [mod_python] could not import mod_python.apache ?
Message-ID: <40485F3B.7040204@mlug.missouri.edu>

Linux 2.6.2
Apache 2.0.48
Python 2.3.2
Mod_Python 3.1.3

[Fri Mar 05 02:52:05 2004] [error] make_obcallback: could not import 
mod_python.apache.

Apache's error log shows the above message when trying to load a test 
handler. If I try to load the same line, 'from mod_python import 
apache', directly in Python I get the following error.

 >>> from mod_python import apache
Traceback (most recent call last):
  File "<stdin>", line 1, in ?
  File 
"/home/webserver/python2.3/lib/python2.3/site-packages/mod_python/apache.py", 
line 28, in ?
    import _apache
ImportError: No module named _apache

Obviously, I seem to be missing something called _apache. Should this 
have been installed as part of mod_python or from where? Any help?
From bortzmeyer at nic.fr  Fri Mar  5 12:31:16 2004
From: bortzmeyer at nic.fr (Stephane Bortzmeyer)
Date: Fri Mar  5 07:26:49 2004
Subject: [mod_python] Re: could not import mod_python.apache ?
In-Reply-To: <40485F3B.7040204@mlug.missouri.edu>
References: <40485F3B.7040204@mlug.missouri.edu>
Message-ID: <20040305113116.GA11502@nic.fr>

On Fri, Mar 05, 2004 at 03:06:35AM -0800,
 Michael <mogmios@mlug.missouri.edu> wrote 
 a message of 27 lines which said:

> If I try to load the same line, 'from mod_python import 
> apache', directly in Python I get the following error.

This one is normal and documented in
<URL:http://www.modpython.org/FAQ/faqw.py?req=all#2.2>.

From davidf at sjsoft.com  Fri Mar  5 13:44:30 2004
From: davidf at sjsoft.com (David Fraser)
Date: Fri Mar  5 07:40:10 2004
Subject: [mod_python] Re: mod_python
In-Reply-To: <VOYB8.10558CX2@infomail.lacaixa.es>
References: <VOYB8.10558CX2@infomail.lacaixa.es>
Message-ID: <4048681E.30906@sjsoft.com>

Toni Gaya wrote:

>Do you have windows modpython2x compiled for apache 1.3?
>I think do a installer is too much work. A modpython.dll file and a txt file explaining where to copy it is sufficient. Does not you think it?
>There is any way to compile modpython with mingw (mingw.org) compiler? I do it, but ./configure does not find paxs executable.
>
>  
>
No, I don't ... but you should be able to follow the instructions posted 
to the list to confile it.
The installer isn't actually that difficult to build, but once you have 
compiled the mod_python dll you should be able to do as you say.
Note however that you also need to install the mod_python python 
libraries, not just the dll.

modpython will not compile with mingw, and the cconfigure scripts are 
written for unix and expect apxs which is the Apache configuration tool 
that does not exist on Windows.
Hopefully this will be rectified in the 3.x branch, and you could port 
the changes back to 2.x if you want...

Cheers
David
From mogmios at mlug.missouri.edu  Fri Mar  5 05:28:16 2004
From: mogmios at mlug.missouri.edu (Michael)
Date: Fri Mar  5 09:23:32 2004
Subject: [mod_python] mod_python as xml-rpc server
Message-ID: <40488070.8010102@mlug.missouri.edu>

After much fighting to get mod_python working with a xml-rpc handler 
I've sort of figured out some things that together seemed to help me. To 
use xmlrpclib with mod_python to create a xml-rpc server it's best to 
use a 3.x version of mod_python and to install sgmlop because expat 
doesn't seem to work. Just thought I'd share in case anyone else has 
similar problems.
From azaroth at liverpool.ac.uk  Fri Mar  5 13:33:01 2004
From: azaroth at liverpool.ac.uk (Robert Sanderson)
Date: Fri Mar  5 09:36:27 2004
Subject: [mod_python] mod_python as xml-rpc server
In-Reply-To: <40488070.8010102@mlug.missouri.edu>
Message-ID: <Pine.LNX.4.44.0403051328530.23415-100000@gondolin.hist.liv.ac.uk>


> After much fighting to get mod_python working with a xml-rpc handler 
> I've sort of figured out some things that together seemed to help me. To 
> use xmlrpclib with mod_python to create a xml-rpc server it's best to 
> use a 3.x version of mod_python and to install sgmlop because expat 
> doesn't seem to work. Just thought I'd share in case anyone else has 
> similar problems.

I fixed this just yesterday, as it turns out, for 4Suite.

The expat which Python needs is exactly 1.95.6  1.95.5 has a seg fault bug 
in it that will take down python.  1.95.7 has new symbols that prevent 
linking.

My fix was to uninstall 95.5 (default in Redhat 9) and install 95.6 
everywhere, then recompile everything (apache, mod_python, python, 4suite)
With some judicious use of LD_LIBRARY_PATH, everything works fine.

Rob

-- 
      ,'/:.          Dr Robert Sanderson (azaroth@liverpool.ac.uk)
    ,'-/::::.        http://www.o-r-g.org/~azaroth/
  ,'--/::(@)::.      Special Collections and Archives, extension 3142
,'---/::::::::::.    Nebmedes:  http://nebmedes.o-r-g.org:8000/
____/:::::::::::::.  
I L L U M I N A T I  



From davidf at sjsoft.com  Fri Mar  5 17:18:06 2004
From: davidf at sjsoft.com (David Fraser)
Date: Fri Mar  5 11:13:41 2004
Subject: [mod_python] Win32 platform - testing...
In-Reply-To: <404849BE.5010609@sjsoft.com>
References: 
	<1924BF350FC96B46A56BB38087B9B86E952708@srvcorreio.primavera.local>
	<40475D04.2090807@sjsoft.com> <20040304115447.R32625@onyx.ispol.com>
	<404849BE.5010609@sjsoft.com>
Message-ID: <40489A2E.5060406@sjsoft.com>

David Fraser wrote:

> Gregory (Grisha) Trubetskoy wrote:
>
>> [snip]
>>
>>
>>> I have not yet fully tested this binary or installer but it seemed to
>>> run our applications fine.
>>> mod_python.so and mod_python-3.1.3.win32.exe can be downloaded from:
>>> http://davidf.sjsoft.com/files/mod_python.so
>>> http://davidf.sjsoft.com/files/mod_python-3.1.3.win32.exe
>>>
>>
>> See if you can run the tests. You will have to manually rig a 
>> testconf.py
>> (NOTE - it will not like blanks in path names, e.g. "Program Files", the
>> only work around I found was using the DOS path name, which you can
>> determine by firing up command.exe (as opposed to cmd.exe) i 
>> believe). But
>> once you get past the testconf.py, usually all tests run OK.
>>
>>
> OK, further info on the testing on win32...
> You can't test off a shared network drive on Windows! Apache will 
> refuse to start up at all! (Interestingly, it will run if you run 
> without the -k start, but not with it - and no error messages are 
> generated...)
> Also, you can't simply have compiled mod_python, you need to have 
> installed it...
> Once that was sorted out, I got the following errors (I have included 
> relevant messages from the log files):
> * Testing req.requires()
> F
> ======================================================================
> FAIL: test_req_requires (__main__.PerRequestTestCase)
> ----------------------------------------------------------------------
> Traceback (most recent call last):
> File "test.py", line 418, in test_req_requires
> self.fail(`rsp`)
> File "C:\Python\Python2.3.3\lib\unittest.py", line 270, in fail
> raise self.failureException, msg
> AssertionError: '<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 
> 2.0//EN">\n<html><head>\n<title>401 Author
> ization Required</title>\n</head><body>\n<h1>Authorization 
> Required</h1>\n<p>This server could not v
> erify that you\nare authorized to access the document\nrequested. 
> Either you supplied the wrong\ncr
> edentials (e.g., bad password), or your\nbrowser doesn\'t understand 
> how to supply\nthe credentials
> required.</p>\n</body></html>\n'

This seems like the right thing is happening but the test is failing...

>
> * Testing req.sendfile()
> F
> [Fri Mar 05 11:27:38 2004] [error] [client 127.0.0.1] PythonHandler 
> tests::req_sendfile: Traceback (most recent call last):
> [Fri Mar 05 11:27:38 2004] [error] [client 127.0.0.1] PythonHandler 
> tests::req_sendfile: File "\PURELIB\mod_python\apache.py", line 299, 
> in HandlerDispatch
> [Fri Mar 05 11:27:38 2004] [error] [client 127.0.0.1] PythonHandler 
> tests::req_sendfile: File 
> "C:/Apache/mod_python-3.1.3/test\htdocs\tests.py", line 680, in 
> req_sendfile
> os.remove(fname)

Hmmm ... it seems that req.sendfile opens the file using apr_file_open 
and then uses ap_send_fd to send it. Does this close the file correctly? 
Doesn't seem like it from the Apache source...
I suspect that's why the os.remove fails...

> [Fri Mar 05 11:27:38 2004] [error] [client 127.0.0.1] PythonHandler 
> tests::req_sendfile: OSError: [Errno 13] Permission denied: 
> 'c:\\winnt\\temp\\tmpym3ms4txt'
> * Testing mod_python.psp
> F
> (this is not surprising as I haven't yet got mod_python.psp building...)

mod_python.psp is now working ...

David
From grisha at modpython.org  Fri Mar  5 10:30:37 2004
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Mar  5 11:26:15 2004
Subject: [mod_python] Win32 platform - test installers available
In-Reply-To: <40483B12.2010505@sjsoft.com>
References: <1924BF350FC96B46A56BB38087B9B86E952708@srvcorreio.primavera.local>
	<40475D04.2090807@sjsoft.com> <20040304115447.R32625@onyx.ispol.com>
	<40483B12.2010505@sjsoft.com>
Message-ID: <20040305102844.W35501@onyx.ispol.com>



On Fri, 5 Mar 2004, David Fraser wrote:

> Basically I search through config.status and if that fails search
> through the sources to find MP_VERSION

The best way to do this would be to read the version from
src/include/mpversion.h, since it's the "authoritative" source.

Grisha
From davidf at sjsoft.com  Fri Mar  5 17:51:25 2004
From: davidf at sjsoft.com (David Fraser)
Date: Fri Mar  5 11:46:56 2004
Subject: [mod_python] Win32 platform - test installers available
In-Reply-To: <20040305102844.W35501@onyx.ispol.com>
References: 
	<1924BF350FC96B46A56BB38087B9B86E952708@srvcorreio.primavera.local>
	<40475D04.2090807@sjsoft.com> <20040304115447.R32625@onyx.ispol.com>
	<40483B12.2010505@sjsoft.com> <20040305102844.W35501@onyx.ispol.com>
Message-ID: <4048A1FD.1090304@sjsoft.com>

Gregory (Grisha) Trubetskoy wrote:

>On Fri, 5 Mar 2004, David Fraser wrote:
>
>  
>
>>Basically I search through config.status and if that fails search
>>through the sources to find MP_VERSION
>>    
>>
>
>The best way to do this would be to read the version from
>src/include/mpversion.h, since it's the "authoritative" source.
>
>Grisha
>
>  
>
Thanks Grisha, I've updated this...

David
From davidf at sjsoft.com  Fri Mar  5 18:21:20 2004
From: davidf at sjsoft.com (David Fraser)
Date: Fri Mar  5 12:16:54 2004
Subject: [mod_python] 
 New setup.py.in for mod_python - builds mod_python extension from
 distutils
Message-ID: <4048A900.8080201@sjsoft.com>

Hi

I've been working on the mod_python dist/setup.py.in (mostly to make it 
work for win32) and have added some important functionality...

1) it no longer requires configure (so it could just be setup.py) - it 
either scans config.status or calculates the information itself (e.g. it 
scans through the source file to find the mod_python version number). On 
Windows it uses the APACHESRC environment variables to find the apache 
include and lib directories (just like the VC++ project does)
2) it is now able to build mod_psp on Windows as well as Linux
3) most importantly, it is now able to build mod_python directly from 
the setup.py (on Windows)
    this should be possible on non-Windows system too but will require 
some work (we may have to make a distutils compiler class for apxs)

There are a few notes:
- the build of the mod_python extension produces a mod_python_so.pyd 
file, instead of the mod_python.so file we want. But at least on 
Windows, I have modified win32_postinstall to install this one instead 
of the other... (I call it mod_python_so.pyd instead of mod_python.pyd 
so that when it is put in the site-packages directory it does not 
confuse importing packages from mod_python)
- I have also added code to win32_postinstall to automatically detect 
the currently installed versions of Apache from the registry. It would 
be nice to let the user choose one of these. As a start, it just selects 
the latest version as the starting point for the tkinter file selection 
dialog (the win32 shell classes don't seem to let you do this...)

I have attached the modified setup.py.in (easier than a patch as almost 
everything has changed) and win32_postinstall.py

Any comments appreciated

David

-------------- next part --------------

# $Id: setup.py.in,v 1.5 2003/07/24 17:46:09 grisha Exp $

from distutils.core import setup, Extension

import sys
import re
import os.path

def getmp_rootdir():
    """gets the root directory of the mod_python source tree..."""
    return os.path.abspath(os.path.join(os.path.dirname(__file__), '..'))

def getmp_srcdir():
    """gets the src subdirectory of the mod_python source tree..."""
    return os.path.join(getmp_rootdir(), 'src')

def getmp_includedir():
    """gets the src subdirectory of the mod_python source tree..."""
    return os.path.join(getmp_rootdir(), 'src', 'include')

def getconfigure_option(option_name):
    """gets an option from the config.status file"""
    config_status_file = os.path.join(getmp_rootdir(), 'config.status')
    if not os.path.exists(config_status_file):
        raise AssertionError("config.status not found in expected location (%s)" % config_status_file)
    header = open(config_status_file,'r')
    r = re.compile('s,@%s@,(?P<OPTION_STRING>[^,]+),' % (option_name))
    for line in header.readlines():
        m = r.search(line)
        if m is not None:
            return m.group('OPTION_STRING')
    raise AssertionError("unable to find @%s@ definition in %s", (option_name, config_status_file))

def getmp_version():
    """finds out the version of mod_python"""
    # if that fails, read it from the source file ourselves...
    mpversion_file = os.path.join(getmp_includedir(), 'mpversion.h')
    if not os.path.exists(mpversion_file):
        raise AssertionError("mpversion.h not found in expected location (%s)" % mpversion_file)
    header = open(mpversion_file,'r')
    r = re.compile('#define\s+MPV_STRING\s+"(?P<MPV_STRING>[^"]+)"')
    for line in header.readlines():
        m = r.search(line)
        if m is not None:
            return m.group('MPV_STRING')
    raise AssertionError("unable to find MPV_STRING in %s", mpversion_file)

def getapxs_location():
    """finds the location of apxs from the config.status file"""
    return getconfigure_option("APXS")

def getapxs_option(option):
    APXS = getapxs_location()
    import commands
    return commands.getoutput("%s -q %s" % (APXS, option))

def getapache_srcdir():
    """returns apache src directory"""
    return os.getenv("APACHESRC")

def getapache_includedir():
    """returns apache include directory"""
    apache_srcdir = getapache_srcdir()
    if apache_srcdir is None:
        return getapxs_option("INCLUDEDIR")
    else:
        return os.path.join(getapache_srcdir(), "include")

def getapache_libdir():
    """returns apache lib directory"""
    apache_srcdir = getapache_srcdir()
    if apache_srcdir is None:
        return ""
    else:
        return os.path.join(apache_srcdir, "lib")

VER = getmp_version()

# TODO: improve the intelligence here...
winbuild = (len(sys.argv) > 1 and sys.argv[1] == "bdist_wininst") or (os.name == "nt")

class PSPExtension(Extension):
    """a class that helps build the PSP extension"""
    def __init__(self, source_dir, include_dirs):
        Extension.__init__(self, "mod_python._psp",
                               [os.path.join(source_dir, source_file) for source_file in
                                    ("psp_string.c", "psp_parser.c", "_pspmodule.c")],
                                include_dirs=include_dirs
                           )

PSPModule = PSPExtension(getmp_srcdir(), [getmp_includedir()])

modpy_src_files = ("mod_python.c", "_apachemodule.c", "connobject.c", "filterobject.c",
                   "hlist.c", "hlistobject.c", "requestobject.c", "serverobject.c", "tableobject.c",
                   "util.c")

class finallist(list):
  """this represents a list that cannot be appended to..."""
  def append(self, object):
    return

class ModPyExtension(Extension):
    """a class that actually builds the mod_python.so extension for Apache (yikes)"""
    def __init__(self, source_dir, include_dirs, library_dirs):
        Extension.__init__(self, "mod_python_so",
            sources = [os.path.join(source_dir, source_file) for source_file in modpy_src_files],
            include_dirs=include_dirs,
            libraries = ['libhttpd','libapr','libaprutil','ws2_32'],
            library_dirs=library_dirs
            )
        if winbuild:
            self.define_macros.extend([('WIN32',None),('NDEBUG',None),('_WINDOWS',None)])
            self.sources.append(os.path.join(source_dir, "Version.rc"))
        else:
            # TODO: fix this to autodetect if required...
            self.include_dirs.append("/usr/include/apr-0")
        # this is a hack to prevent build_ext from trying to append "initmod_python" to the export symbols
        self.export_symbols = finallist(self.export_symbols)

ModPyModule = ModPyExtension(getmp_srcdir(), [getmp_includedir(), getapache_includedir()], [getapache_libdir()])

if winbuild:
    scripts = ["win32_postinstall.py"]
    # put the mod_python.so file in the Python root ...
    # win32_postinstall.py will pick it up from there...
    # data_files = [("", [(os.path.join(getmp_srcdir(), 'Release', 'mod_python.so'))])]
    data_files = []
else:
    # mpso = "../src/mod_python.so"
    scripts = []
    data_files = []

setup(name="mod_python",
      version=VER,
      description="Apache/Python Integration",
      author="Gregory Trubetskoy et al",
      author_email="mod_python@modpython.org",
      url="http://www.modpython.org/",
      packages=["mod_python"],
      package_dir={'mod_python': os.path.join(getmp_rootdir(), 'lib', 'python', 'mod_python')},
      scripts=scripts,
      data_files=data_files,
      ext_modules=[ModPyModule, PSPModule])

# makes emacs go into python mode
### Local Variables:
### mode:python
### End:
-------------- next part --------------
A non-text attachment was scrubbed...
Name: win32_postinstall.py
Type: text/x-python
Size: 4908 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20040305/b415eb65/win32_postinstall.py
From conrad at hep.caltech.edu  Fri Mar  5 09:09:17 2004
From: conrad at hep.caltech.edu (Conrad Steenberg)
Date: Fri Mar  5 13:04:49 2004
Subject: [mod_python] Impatient Apache server?
In-Reply-To: <1078440791.1914.362.camel@heppc22.hep.caltech.edu>
References: <1078440791.1914.362.camel@heppc22.hep.caltech.edu>
Message-ID: <1078506557.16251.17.camel@heppc22.hep.caltech.edu>

In case someone is interested:

The answer is that it is not possible without recompiling the Apache
server. The relevant code is in server/mpm_common.c:

            case 5:     /*  82ms */
            case 6:     /* 344ms */
            case 7:     /* 1.4sec */
                /* ok, now it's being annoying */
                ap_log_error(APLOG_MARK, APLOG_WARNING,
                             0, ap_server_conf,
                             "child process %ld still did not exit, "
                             "sending a SIGTERM",
                             (long)pid);
                kill(pid, SIGTERM);
                break;

I.e. each process gets only 82ms to exit from the time that the parent
starts issuing exit orders to children.

Cheers

Conrad

On Thu, 2004-03-04 at 14:53, Conrad Steenberg wrote:
> Hi
> 
> This may be more of an an Apache question, but anyway:
> 
> Under the prefork MPM, when Apache gets shut down it gives each child
> process a certain amount of time to exit before sending it a TERM
> signal, and printing in the log:
> [warn] child process XXXX still did not exit, sending a SIGTERM
> 
> Is there a way to give the child processes more time to exit on their
> own before they get killed forcibly?
> 
> Thanks
> 
> Conrad
-- 
Conrad Steenberg <conrad@hep.caltech.edu>

From conrad at hep.caltech.edu  Fri Mar  5 09:13:14 2004
From: conrad at hep.caltech.edu (Conrad Steenberg)
Date: Fri Mar  5 13:08:45 2004
Subject: [mod_python] mod_python as xml-rpc server
In-Reply-To: <40488070.8010102@mlug.missouri.edu>
References: <40488070.8010102@mlug.missouri.edu>
Message-ID: <1078506793.16251.21.camel@heppc22.hep.caltech.edu>

Hi Michael

Btw, I've had great success with using py-xmlrpc from
http://sourceforge.net/projects/py-xmlrpc/ which uses a custom XMLRPC
parser instead of a general XML parser and is quite fast.

Cheers

Conrad

On Fri, 2004-03-05 at 05:28, Michael wrote:
> After much fighting to get mod_python working with a xml-rpc handler 
> I've sort of figured out some things that together seemed to help me. To 
> use xmlrpclib with mod_python to create a xml-rpc server it's best to 
> use a 3.x version of mod_python and to install sgmlop because expat 
> doesn't seem to work. Just thought I'd share in case anyone else has 
> similar problems.
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
-- 
Conrad Steenberg <conrad@hep.caltech.edu>

From binarybrain at phreaker.net  Fri Mar  5 19:15:05 2004
From: binarybrain at phreaker.net (Jim)
Date: Fri Mar  5 20:08:46 2004
Subject: [mod_python] More Cookie troubles
Message-ID: <1078532105.555.7.camel@debbie>

Unfortunetly, I am stuck using a somewhat older version of mod_python
3.0.4-2 which I guess is what is distributed with Debian unstable. I am
able to set cookies. 

I can't seem to read the Cookies. I tried 2 different ways. 

1) os.environ.keys() displays no env vars resembling a Cookie
2) req.headers_in I seem to be getting the header stuff but nothing
resembling a Cookie

(I tested the above by printing the results out to the web page)

I have tried numorous examples. I have been over all the threads on
Cookies in the recent months. I realize that a newer version of
mod_python might help resolve this as it has native Cookie support. If I
don't get any other solutions or suggestions I would willing to upgrade
by hand. If I end up having to upgrade by hand any suggestions for
people that have done this.

Thanks in advance.

Jim





From binarybrain at phreaker.net  Fri Mar  5 21:54:40 2004
From: binarybrain at phreaker.net (Jim)
Date: Fri Mar  5 22:48:24 2004
Subject: [mod_python] More Cookie troubles
In-Reply-To: <1078532105.555.7.camel@debbie>
References: <1078532105.555.7.camel@debbie>
Message-ID: <1078541680.501.9.camel@debbie>

So I have gone ahead and updated to 3.1.3. Let me give this a try and
see how I do.

Thanks.


On Fri, 2004-03-05 at 19:15, Jim wrote:
> Unfortunetly, I am stuck using a somewhat older version of mod_python
> 3.0.4-2 which I guess is what is distributed with Debian unstable. I am
> able to set cookies. 
> 
> I can't seem to read the Cookies. I tried 2 different ways. 
> 
> 1) os.environ.keys() displays no env vars resembling a Cookie
> 2) req.headers_in I seem to be getting the header stuff but nothing
> resembling a Cookie
> 
> (I tested the above by printing the results out to the web page)
> 
> I have tried numorous examples. I have been over all the threads on
> Cookies in the recent months. I realize that a newer version of
> mod_python might help resolve this as it has native Cookie support. If I
> don't get any other solutions or suggestions I would willing to upgrade
> by hand. If I end up having to upgrade by hand any suggestions for
> people that have done this.
> 
> Thanks in advance.
> 
> Jim
> 
> 
> 
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python


From mogmios at mlug.missouri.edu  Sat Mar  6 03:23:07 2004
From: mogmios at mlug.missouri.edu (Michael)
Date: Sat Mar  6 07:18:21 2004
Subject: [mod_python] feedback on my XML-RPC handler?
Message-ID: <4049B49B.6040609@mlug.missouri.edu>

This is my first stab at an XML-RPC handler for mod_python. I haven't 
really used mod_python before this so I thought maybe somee of you could 
take a peek and give me advice on if I'm doing things horribly wrong or 
not. Obviously I borrowed this mostly from Python's own 
CGIXMLRPCRequestHandler but with the needed changes to work with 
mod_python and to provide some documentation to visitors. Thanks.

----
from mod_python import apache
from mod_python import util
import SimpleXMLRPCServer

class MPXMLRPCRequestHandler ( SimpleXMLRPCServer.SimpleXMLRPCDispatcher ):
    """Simple handler for XML-RPC data passed through mod_python."""
    def __init__ ( self ):
        SimpleXMLRPCServer.SimpleXMLRPCDispatcher.__init__ ( self )

    def handle_xmlrpc ( self, req ):
        """Handle a single XML-RPC request or a request for 
documentation."""
        if req.method == 'POST':
                response = self._marshaled_dispatch ( req.read () )
                req.content_type = "text/xml"
                req.send_http_header ()
                req.write ( response )
        elif req.method == 'GET':
                path = 'http://%s:%s%s' % ( req.server.server_hostname, 
req.server.port, req.parsed_uri[apache.URI_PATH] )
                req.content_type = "text/html"
                req.send_http_header ()
                FS = util.FieldStorage ( req )
                docs = ''
                if FS.has_key ( 'topic' ):
                        docs += '<a href="%s">back to topic 
list</a><h1>%s</h1>' % ( path, FS['topic'] )
                        docs += self.system_methodHelp ( FS['topic'] )
                else:
                        methods = self.system_listMethods ()
                        if methods:
                                for method in methods:
                                        docs += '<li><a 
href="%s?topic=%s">%s</a></li>' % ( path, method, method )
                req.write ( 
'<html><head><title>Documentation</title></head><body>%s</body></html>' 
% ( docs ) )

def test ( i ):
        """These are my test docs."""
        return i, i * 2

xmlrpc = MPXMLRPCRequestHandler ()
xmlrpc.register_function ( test )
xmlrpc.register_introspection_functions ()

def handler ( req ):
        global xmlrpc
        xmlrpc.handle_xmlrpc ( req )
        return apache.OK
----
From chenzizhao at hotmail.com  Sat Mar  6 22:01:10 2004
From: chenzizhao at hotmail.com (chenzizhao@hotmail.com)
Date: Sat Mar  6 09:57:01 2004
Subject: [mod_python] psp does not work
Message-ID: <Law10-OE47ZzvGT4CV5000395c7@hotmail.com>

my configfle file:
<Directory /var/www/html/test> 
    AddHandler mod_python .psp
    PythonHandler mod_python.psp
    PythonDebug On
</Directory>
but,when i go to http://192.168.0.1/test/helloword.psp,i got the source file .(it remain contain the <%%> flag)

From grisha at modpython.org  Sat Mar  6 12:00:47 2004
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Sat Mar  6 12:56:26 2004
Subject: [mod_python] psp does not work
In-Reply-To: <Law10-OE47ZzvGT4CV5000395c7@hotmail.com>
References: <Law10-OE47ZzvGT4CV5000395c7@hotmail.com>
Message-ID: <20040306115942.E72878@onyx.ispol.com>


Do you have mod_python loaded using a LoadModule directive?

Grisha

On Sat, 6 Mar 2004 chenzizhao@hotmail.com wrote:

> my configfle file:
> <Directory /var/www/html/test>
>     AddHandler mod_python .psp
>     PythonHandler mod_python.psp
>     PythonDebug On
> </Directory>
> but,when i go to http://192.168.0.1/test/helloword.psp,i got the source file .(it remain contain the <%%> flag)
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From jpeterson at ainet.com  Sat Mar  6 12:23:36 2004
From: jpeterson at ainet.com (Jim Peterson)
Date: Sat Mar  6 16:20:42 2004
Subject: [mod_python] modpython psp v. spyce
Message-ID: <404A3348.2020105@ainet.com>

Hi,

Newbie here. Before Grisha released psp, I started using Spyce with 
apache/python.  I'm really still new to python, apache etc.  not a web 
guy by training.  I've been skimming the group archives to see some 
comparisons of Spyce and Grisha's PSP.

Can someone give some insight into how these two approaches compare?  Is 
there a reason for both to exist?  I admit I felt a little bad for Rimon 
when G released his approach.  Kind of pulls the rug out from under 
Rimon after years of work.  But in the longer term, integrated PSP 
should be better than third-party PSP.

In the shorter term, both seem very similar in functionality.  Can 
anyone offer some comparisons?

My style is to stay away from template systems, as they seem to 
introduce another language.  I keep my python-in-html to simple function 
calls, sometimes passing in html strings as arguments.  I want to keep 
the web pages 'programming light' so that an html/javascript guy will 
feel comfortable.  All the computation, I do in straight python.

Seems like there has been no discussion of Spyce.  Or the discussion 
never got past the 'is this the right thing to do' rather than technical 
comparisons.  Is Spyce the elephant in the room, or an also-ran?

grazie




From david at rebirthing.co.nz  Sun Mar  7 12:06:26 2004
From: david at rebirthing.co.nz (David McNab)
Date: Sat Mar  6 19:02:10 2004
Subject: [mod_python] modpython psp v. spyce
In-Reply-To: <404A3348.2020105@ainet.com>
References: <404A3348.2020105@ainet.com>
Message-ID: <404A5972.1060408@rebirthing.co.nz>

As someone who spent a year writing in PHP, then switched to Python, I 
missed the ability to 'execute' an HTML file with code embedded.

I came across Spyce, and even wrote my own Python-in-HTML preprocessor.

However, I'm since come to feel - and this is a personal thing - that 
the very notion of embedding code within HTML is fraught with severe 
suckage.

I worked with the PHP-Nuke software, and even published a few add-ons 
for it.

For small jobs, (and jobs which stay small), embedding code into HTML 
has its appeal.

But as a web app grows into any level of sophistication, this whole 
approach can give rise to some abominably messy code.

So these days, I use a tag class library, and generate the HTML purely 
from code. To me now, raw HTML feels like the 'assembly code', or even 
the 'machine code', of web programming. I'm much preferring the ability 
to build pages as a hierarchy of abstract widgets, where each 'widget' 
is a class which ultimately renders down to HTML code.

Lately, I've just finished the first cut of a web app framework called 
pyweb.gui. As soon as I finish the documentation, I'll announce an alpha 
  to this and other lists. Early trials of pyweb.gui have seen me able 
to build active web pages in a fraction of the time, and end up with 
stateful web apps that can run identically over traditional CGI, 
mod_python CGI, mod_python with custom handler or standalone server.

pyweb.gui one one hand is 'just another' python web app framework. But 
on the other hand, it is one of the few that can be deployed on even the 
  cheapest and most restrictive web hosts.

So I ask people to question whether embedding code into HTML, 
particularly with such a beautiful and powerfully-OO language like 
Python, is really a desirable direction to go in.

Cheers
David

--

leave this line intact so your email gets through my junk mail filter
From dwmp at opti.cgi.net  Sat Mar  6 17:14:48 2004
From: dwmp at opti.cgi.net (Daniel West)
Date: Sat Mar  6 19:09:08 2004
Subject: [mod_python] PSP Return
Message-ID: <5.2.1.1.2.20040306170233.020454d0@mail.pyxos.com>


Consider the following PSP code:

<%
if(not form.has_key('good')):
     req.internal_redirect('/errors/missing_good.html')
     return apache.OK

# Do database insertion here
# ...
%>
<html>
<body>
Successful form POST
</body>
</html>


The return apache.OK isn't valid there, but is there an 
equivalent?  Internal redirects are great for keeping error pages simple 
and for hiding implementation details from the end user.  Plus you cannot 
redirect a POST request with psp.redirect().

-Dan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20040306/20e0b99a/attachment.html
From mogmios at mlug.missouri.edu  Sat Mar  6 15:49:40 2004
From: mogmios at mlug.missouri.edu (Michael)
Date: Sat Mar  6 19:44:55 2004
Subject: [mod_python] modpython psp v. spyce
In-Reply-To: <404A5972.1060408@rebirthing.co.nz>
References: <404A3348.2020105@ainet.com> <404A5972.1060408@rebirthing.co.nz>
Message-ID: <404A6394.2070001@mlug.missouri.edu>

I've been writing web apps since the beginning (since the time when I 
accessed the Internet over a 2400 baud modem and used a text based 
browser) and I agree with you. I never really saw the point of inline 
code in html. It's okay for short scripts but for applications it's a 
definate no-no IMO. With PHP I didn't use it and so far with Python I'm 
not using it. I like to collect my output in a variable and then write 
it to the client all at once. Python's string processing is quite nice 
in itself. A framework is definately the way to go and is why I'm moving 
from PHP to Python. PHP just doesn't lend itself well to that kind of 
use. The lack of decent namespace or objects makes any complex framework 
a pain to work with. Python, so far, looks much better.

> As someone who spent a year writing in PHP, then switched to Python, I 
> missed the ability to 'execute' an HTML file with code embedded.
>
> I came across Spyce, and even wrote my own Python-in-HTML preprocessor.
>
> However, I'm since come to feel - and this is a personal thing - that 
> the very notion of embedding code within HTML is fraught with severe 
> suckage.
>
> I worked with the PHP-Nuke software, and even published a few add-ons 
> for it.
>
> For small jobs, (and jobs which stay small), embedding code into HTML 
> has its appeal.
>
> But as a web app grows into any level of sophistication, this whole 
> approach can give rise to some abominably messy code.
>
> So these days, I use a tag class library, and generate the HTML purely 
> from code. To me now, raw HTML feels like the 'assembly code', or even 
> the 'machine code', of web programming. I'm much preferring the 
> ability to build pages as a hierarchy of abstract widgets, where each 
> 'widget' is a class which ultimately renders down to HTML code.
>
> Lately, I've just finished the first cut of a web app framework called 
> pyweb.gui. As soon as I finish the documentation, I'll announce an 
> alpha  to this and other lists. Early trials of pyweb.gui have seen me 
> able to build active web pages in a fraction of the time, and end up 
> with stateful web apps that can run identically over traditional CGI, 
> mod_python CGI, mod_python with custom handler or standalone server.
>
> pyweb.gui one one hand is 'just another' python web app framework. But 
> on the other hand, it is one of the few that can be deployed on even 
> the  cheapest and most restrictive web hosts.
>
> So I ask people to question whether embedding code into HTML, 
> particularly with such a beautiful and powerfully-OO language like 
> Python, is really a desirable direction to go in. 


From cfox at cfconsulting.ca  Sat Mar  6 17:01:04 2004
From: cfox at cfconsulting.ca (Colin Fox)
Date: Sat Mar  6 20:56:16 2004
Subject: [mod_python] Flexible imports
Message-ID: <404A7450.6050207@cfconsulting.ca>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1


Hi, all. I'm trying to do something with mod_python that is easy with
CGIs, but is turning out to be somewhat challenging.

I'd like to support python modules in a variety of subdirectories. So a
url like

http://localhost/top/something.py

and

http://localhost/top/next/somethingelse.py

would both work. However, the way it seems to be set up, if you install
a python handler (say in /top), then it gets executed for all .py files
regardless of where they are (so in this case, somethingelse.py would be
expected to be in /top, not /top/next). That can be useful at times, but
at other times it can be a stumbling block.

Here's a snippet of my handler:

# --------------------

def process_pyx(req):
~    path, filename = os.path.split(req.filename)
~    name, ext = string.split(filename, ".")

~    #pyx_mod = apache.import_module("%s/%s" % (path,name))
~    #pyx_mod = apache.import_module(name, path=path)
~    pyx_mod = apache.import_module("%s" % name)

~    pyx_mod.main(req)
~    return apache.OK

def handler(req):
~    if args['requestedfile'].endswith('.py'):
	return process_pyx(req)
~    elif args['requestedfile'].endswith('.xml'):
	return process_xml(req)
~    else:
	return apache.ERROR

# --------------------

This works fine for any .py file that is in the same directory as this
handler. However, it doesn't work for subdirectories. You can see some
attempts for adding a path for the import, but they don't work.

So - is there an elegant way to allow a specifically named .py file to
be executed from any directory under this handler's directory?

Thanks,
~   cf

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.4 (GNU/Linux)

iD8DBQFASnRQoaQ1/feGlJoRAoqnAJ9RvjGNKHTFTAGJ0rqwreIj244ckgCfbPU6
X+g/D+w9b/97UwCY2BLd7Qs=
=OPj0
-----END PGP SIGNATURE-----
From grisha at modpython.org  Sat Mar  6 22:12:11 2004
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Sat Mar  6 23:07:11 2004
Subject: [mod_python] PSP Return
In-Reply-To: <5.2.1.1.2.20040306170233.020454d0@mail.pyxos.com>
References: <5.2.1.1.2.20040306170233.020454d0@mail.pyxos.com>
Message-ID: <20040306221053.H74239@onyx.ispol.com>


You might be able to:

raise apache.SERVER_RETURN, apache.OK

I haven't tested it, but I think it should work.

On Sat, 6 Mar 2004, Daniel West wrote:

>
> Consider the following PSP code:
>
> <%
> if(not form.has_key('good')):
>      req.internal_redirect('/errors/missing_good.html')
>      return apache.OK
>
> # Do database insertion here
> # ...
> %>
> <html>
> <body>
> Successful form POST
> </body>
> </html>
>
>
> The return apache.OK isn't valid there, but is there an
> equivalent?  Internal redirects are great for keeping error pages simple
> and for hiding implementation details from the end user.  Plus you cannot
> redirect a POST request with psp.redirect().
>
> -Dan
>
From mogmios at mlug.missouri.edu  Sat Mar  6 19:52:22 2004
From: mogmios at mlug.missouri.edu (Michael)
Date: Sat Mar  6 23:47:02 2004
Subject: [mod_python] Flexible imports
In-Reply-To: <404A7450.6050207@cfconsulting.ca>
References: <404A7450.6050207@cfconsulting.ca>
Message-ID: <404A9C76.8000401@mlug.missouri.edu>

Wouldn't you use .htaccess and Directory tags to set that up?

> Hi, all. I'm trying to do something with mod_python that is easy with
> CGIs, but is turning out to be somewhat challenging.
>
> I'd like to support python modules in a variety of subdirectories. So a
> url like
>
> http://localhost/top/something.py
>
> and
>
> http://localhost/top/next/somethingelse.py
>
> would both work. However, the way it seems to be set up, if you install
> a python handler (say in /top), then it gets executed for all .py files
> regardless of where they are (so in this case, somethingelse.py would be
> expected to be in /top, not /top/next). That can be useful at times, but
> at other times it can be a stumbling block.
>
> Here's a snippet of my handler:
>
> # --------------------
>
> def process_pyx(req):
> ~    path, filename = os.path.split(req.filename)
> ~    name, ext = string.split(filename, ".")
>
> ~    #pyx_mod = apache.import_module("%s/%s" % (path,name))
> ~    #pyx_mod = apache.import_module(name, path=path)
> ~    pyx_mod = apache.import_module("%s" % name)
>
> ~    pyx_mod.main(req)
> ~    return apache.OK
>
> def handler(req):
> ~    if args['requestedfile'].endswith('.py'):
>     return process_pyx(req)
> ~    elif args['requestedfile'].endswith('.xml'):
>     return process_xml(req)
> ~    else:
>     return apache.ERROR
>
> # --------------------
>
> This works fine for any .py file that is in the same directory as this
> handler. However, it doesn't work for subdirectories. You can see some
> attempts for adding a path for the import, but they don't work.
>
> So - is there an elegant way to allow a specifically named .py file to
> be executed from any directory under this handler's directory?


From dwmp at opti.cgi.net  Sat Mar  6 22:33:16 2004
From: dwmp at opti.cgi.net (Daniel West)
Date: Sun Mar  7 00:25:10 2004
Subject: [mod_python] PSP Return
In-Reply-To: <20040306221053.H74239@onyx.ispol.com>
References: <5.2.1.1.2.20040306170233.020454d0@mail.pyxos.com>
 <5.2.1.1.2.20040306170233.020454d0@mail.pyxos.com>
Message-ID: <5.2.1.1.2.20040306223234.02211ff8@mail.pyxos.com>


Works perfectly!!  Thank you!! :)

-Dan


At 10:12 PM 3/6/2004 -0500, you wrote:

>You might be able to:
>
>raise apache.SERVER_RETURN, apache.OK
>
>I haven't tested it, but I think it should work.
>
>On Sat, 6 Mar 2004, Daniel West wrote:
>
> >
> > Consider the following PSP code:
> >
> > <%
> > if(not form.has_key('good')):
> >      req.internal_redirect('/errors/missing_good.html')
> >      return apache.OK
> >
> > # Do database insertion here
> > # ...
> > %>
> > <html>
> > <body>
> > Successful form POST
> > </body>
> > </html>
> >
> >
> > The return apache.OK isn't valid there, but is there an
> > equivalent?  Internal redirects are great for keeping error pages simple
> > and for hiding implementation details from the end user.  Plus you cannot
> > redirect a POST request with psp.redirect().
> >
> > -Dan
> >


From cfox at cfconsulting.ca  Sat Mar  6 22:12:55 2004
From: cfox at cfconsulting.ca (Colin Fox)
Date: Sun Mar  7 02:08:05 2004
Subject: [mod_python] Flexible imports
In-Reply-To: <404A9C76.8000401@mlug.missouri.edu>
References: <404A7450.6050207@cfconsulting.ca>
	<404A9C76.8000401@mlug.missouri.edu>
Message-ID: <404ABD67.9030101@cfconsulting.ca>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Michael wrote:
| Wouldn't you use .htaccess and Directory tags to set that up?
|

I don't want to have tons of .htaccess files all over the place. I just
want to be able to make a directory, put a python file into that
directory and get it executed. The same way as would happen
automatically if I was using CGIs.

|> Hi, all. I'm trying to do something with mod_python that is easy with
|> CGIs, but is turning out to be somewhat challenging.
|>
|> I'd like to support python modules in a variety of subdirectories. So a
|> url like
|>
|> http://localhost/top/something.py
|>
|> and
|>
|> http://localhost/top/next/somethingelse.py
|>
|> would both work. However, the way it seems to be set up, if you install
|> a python handler (say in /top), then it gets executed for all .py files
|> regardless of where they are (so in this case, somethingelse.py would be
|> expected to be in /top, not /top/next). That can be useful at times, but
|> at other times it can be a stumbling block.
|>
|> Here's a snippet of my handler:
|>
|> # --------------------
|>
|> def process_pyx(req):
|> ~    path, filename = os.path.split(req.filename)
|> ~    name, ext = string.split(filename, ".")
|>
|> ~    #pyx_mod = apache.import_module("%s/%s" % (path,name))
|> ~    #pyx_mod = apache.import_module(name, path=path)
|> ~    pyx_mod = apache.import_module("%s" % name)
|>
|> ~    pyx_mod.main(req)
|> ~    return apache.OK
|>
|> def handler(req):
|> ~    if args['requestedfile'].endswith('.py'):
|>     return process_pyx(req)
|> ~    elif args['requestedfile'].endswith('.xml'):
|>     return process_xml(req)
|> ~    else:
|>     return apache.ERROR
|>
|> # --------------------
|>
|> This works fine for any .py file that is in the same directory as this
|> handler. However, it doesn't work for subdirectories. You can see some
|> attempts for adding a path for the import, but they don't work.
|>
|> So - is there an elegant way to allow a specifically named .py file to
|> be executed from any directory under this handler's directory?
|
|

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.4 (GNU/Linux)

iD8DBQFASr1noaQ1/feGlJoRAtxdAJ95DsLIev9oKIwDdD2zlDQW5dFYUwCeKGy2
GY42ZfcSiBhSLCHCiMpG2GE=
=XVux
-----END PGP SIGNATURE-----
From d.holton at vanderbilt.edu  Sun Mar  7 10:07:14 2004
From: d.holton at vanderbilt.edu (Doug Holton)
Date: Sun Mar  7 12:02:24 2004
Subject: [mod_python] modpython psp v. spyce
In-Reply-To: <200403070709.i2779Hxj001022@slash.mediapulse.com>
References: <200403070709.i2779Hxj001022@slash.mediapulse.com>
Message-ID: <404B48B2.1050304@vanderbilt.edu>


> Newbie here. Before Grisha released psp, I started using Spyce with 
> apache/python.  I'm really still new to python, apache etc.  not a web 
> guy by training.  I've been skimming the group archives to see some 
> comparisons of Spyce and Grisha's PSP.
> 
> Can someone give some insight into how these two approaches compare?  Is 
> there a reason for both to exist?  

Like others have mentioned, PHP mixes code in with HTML can get messy. 
One solution in PHP is to use the Smarty templating system to separate 
the view (the html) and the data (like the results of a database query 
for example).

It looks like you can do something similar with PSP or Cheetah but not 
Spyce.  See "Using PSP as a Templating System" here:
http://www.onlamp.com/pub/a/python/2004/02/26/python_server_pages.html

Smarty, PSP, and Cheetah have speed optimizations too: they can cache a 
parsed template so that it only has to be parsed once. See the 
PSPDbmCache option to make PSP cache to files instead of using up memory.

A possible disadvantage of PSP though is that it is tied to mod_python, 
whereas Spyce or other frameworks like Quixote can be used with or 
without mod_python.


From grisha at modpython.org  Sun Mar  7 13:26:52 2004
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Sun Mar  7 14:21:53 2004
Subject: [mod_python] Flexible imports
In-Reply-To: <404ABD67.9030101@cfconsulting.ca>
References: <404A7450.6050207@cfconsulting.ca>
	<404A9C76.8000401@mlug.missouri.edu>
	<404ABD67.9030101@cfconsulting.ca>
Message-ID: <20040307132636.E90677@onyx.ispol.com>


Why don't you use the publisher handler for that?

Grisha

On Sat, 6 Mar 2004, Colin Fox wrote:

> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> Michael wrote:
> | Wouldn't you use .htaccess and Directory tags to set that up?
> |
>
> I don't want to have tons of .htaccess files all over the place. I just
> want to be able to make a directory, put a python file into that
> directory and get it executed. The same way as would happen
> automatically if I was using CGIs.
>
> |> Hi, all. I'm trying to do something with mod_python that is easy with
> |> CGIs, but is turning out to be somewhat challenging.
> |>
> |> I'd like to support python modules in a variety of subdirectories. So a
> |> url like
> |>
> |> http://localhost/top/something.py
> |>
> |> and
> |>
> |> http://localhost/top/next/somethingelse.py
> |>
> |> would both work. However, the way it seems to be set up, if you install
> |> a python handler (say in /top), then it gets executed for all .py files
> |> regardless of where they are (so in this case, somethingelse.py would be
> |> expected to be in /top, not /top/next). That can be useful at times, but
> |> at other times it can be a stumbling block.
> |>
> |> Here's a snippet of my handler:
> |>
> |> # --------------------
> |>
> |> def process_pyx(req):
> |> ~    path, filename = os.path.split(req.filename)
> |> ~    name, ext = string.split(filename, ".")
> |>
> |> ~    #pyx_mod = apache.import_module("%s/%s" % (path,name))
> |> ~    #pyx_mod = apache.import_module(name, path=path)
> |> ~    pyx_mod = apache.import_module("%s" % name)
> |>
> |> ~    pyx_mod.main(req)
> |> ~    return apache.OK
> |>
> |> def handler(req):
> |> ~    if args['requestedfile'].endswith('.py'):
> |>     return process_pyx(req)
> |> ~    elif args['requestedfile'].endswith('.xml'):
> |>     return process_xml(req)
> |> ~    else:
> |>     return apache.ERROR
> |>
> |> # --------------------
> |>
> |> This works fine for any .py file that is in the same directory as this
> |> handler. However, it doesn't work for subdirectories. You can see some
> |> attempts for adding a path for the import, but they don't work.
> |>
> |> So - is there an elegant way to allow a specifically named .py file to
> |> be executed from any directory under this handler's directory?
> |
> |
>
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.2.4 (GNU/Linux)
>
> iD8DBQFASr1noaQ1/feGlJoRAtxdAJ95DsLIev9oKIwDdD2zlDQW5dFYUwCeKGy2
> GY42ZfcSiBhSLCHCiMpG2GE=
> =XVux
> -----END PGP SIGNATURE-----
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From sterling at apache.org  Sun Mar  7 11:22:14 2004
From: sterling at apache.org (Sterling Hughes)
Date: Sun Mar  7 14:42:40 2004
Subject: [mod_python] modpython psp v. spyce
In-Reply-To: <404B48B2.1050304@vanderbilt.edu>
References: <200403070709.i2779Hxj001022@slash.mediapulse.com>
	<404B48B2.1050304@vanderbilt.edu>
Message-ID: <98592086-7053-11D8-ACA7-000A95E073A0@apache.org>


On Mar 7, 2004, at 11:07 AM, Doug Holton wrote:

>
>> Newbie here. Before Grisha released psp, I started using Spyce with 
>> apache/python.  I'm really still new to python, apache etc.  not a 
>> web guy by training.  I've been skimming the group archives to see 
>> some comparisons of Spyce and Grisha's PSP.
>> Can someone give some insight into how these two approaches compare?  
>> Is there a reason for both to exist?
>
> Like others have mentioned, PHP mixes code in with HTML can get messy. 
> One solution in PHP is to use the Smarty templating system to separate 
> the view (the html) and the data (like the results of a database query 
> for example).
>
> It looks like you can do something similar with PSP or Cheetah but not 
> Spyce.  See "Using PSP as a Templating System" here:
> http://www.onlamp.com/pub/a/python/2004/02/26/python_server_pages.html
>
> Smarty, PSP, and Cheetah have speed optimizations too: they can cache 
> a parsed template so that it only has to be parsed once. See the 
> PSPDbmCache option to make PSP cache to files instead of using up 
> memory.
>
> A possible disadvantage of PSP though is that it is tied to 
> mod_python, whereas Spyce or other frameworks like Quixote can be used 
> with or without mod_python.
>
>

The general philosophy of people writing php code on large sites (or 
experienced PHP programmers) is that "php is my templating language."  
Mixing PHP code with HTML is not at all messy - what's messy is mixing 
backend interface logic with frontend logic.   Generally, in PHP, i 
have a little template class that works akin to this small function:

<?php
function template_include($file, $params)
{
	explode($params);
	include_once($file);
}
?>

And that's how I separate my backend and frontend logic.  I use the PHP 
processor, but I restrict what I put in my template.  This is not only 
an order of magnitude faster than a solution like Smarty, but its just 
as clean from an interface perspective.

PSP takes the same approach.  Its not about encouraging you to mix 
backend and frontend logic - although it certainly makes it easier.  
Its about providing an efficient templating solution "out-of-the-box," 
and without the extra layer of complexity.  Frontends are simple, 
writing a templating language, or mini-language on top of python just 
adds unnecessary complexity.

-Sterling

From cfox at cfconsulting.ca  Sun Mar  7 11:19:02 2004
From: cfox at cfconsulting.ca (Colin Fox)
Date: Sun Mar  7 15:14:18 2004
Subject: [mod_python] Flexible imports
In-Reply-To: <20040307132636.E90677@onyx.ispol.com>
References: <404A7450.6050207@cfconsulting.ca>
	<404A9C76.8000401@mlug.missouri.edu> <404ABD67.9030101@cfconsulting.ca>
	<20040307132636.E90677@onyx.ispol.com>
Message-ID: <404B75A6.3040202@cfconsulting.ca>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Gregory (Grisha) Trubetskoy wrote:
| Why don't you use the publisher handler for that?
|
| Grisha
|
| On Sat, 6 Mar 2004, Colin Fox wrote:

Hmm. Ok, what I'm trying to accomplish is this: I am building a site
which is a combination of XML files (which get processed into HTML) and
python files.

I want the xml files to be processed by the xml_handler, regardless of
where they are. I want the python files to be executed as python files
regardless of where they are.

Here's my .htaccess file:

DirectoryIndex index.xml index.html index.py
AddHandler python-program .xml .py
PythonHandler xml_handler
PythonDebug on
PythonAutoReload on


(By the way - it seems that PythonAutoReload (according to mod_python
source) should cause mod_python to automatically re-load a module if it
has changed. Is that true? If so, does that solve the issue of reloads
that people have solved by setting MaxRequestsPerChild to 1?)

I originally tried to solve this by putting two PythonHandler
declarations in, but that didn't work.

AddHandler python-program .xml
PythonHandler xml_handler
PythonDebug on
AddHandler python-program .py
PythonHandler mod_python.publisher
PythonAutoReload on

So now in my xml_handler file I have a chunk of code that looks like this:

def handler(req):
~    if args['requestedfile'].endswith('.py'):
~        return process_py(req)
~    elif args['requestedfile'].endswith('.xml'):
~        return process_xml(req)
~    else:
~        return apache.ERROR

This gets me almost where I want to be - I can process the two different
types of files. Now I'm left with the fact that I want to be able to
process XML files from a single function, but python files to be
processed as python files, and from where they reside.

Any suggestions?

Thanks,
~  cf
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.4 (GNU/Linux)

iD8DBQFAS3WmoaQ1/feGlJoRAgYuAJ9PF2bAjVrWY738acWysCkT7cjoYwCghFa+
O6l64siCyIIW5eH61PpMl7I=
=w4r0
-----END PGP SIGNATURE-----
From cfox at cfconsulting.ca  Sun Mar  7 11:37:17 2004
From: cfox at cfconsulting.ca (Colin Fox)
Date: Sun Mar  7 15:32:28 2004
Subject: [mod_python] Flexible imports
In-Reply-To: <20040307132636.E90677@onyx.ispol.com>
References: <404A7450.6050207@cfconsulting.ca>
	<404A9C76.8000401@mlug.missouri.edu> <404ABD67.9030101@cfconsulting.ca>
	<20040307132636.E90677@onyx.ispol.com>
Message-ID: <404B79ED.5050903@cfconsulting.ca>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Gregory (Grisha) Trubetskoy wrote:
| Why don't you use the publisher handler for that?
|
| Grisha
|

There's something else as well - I've done a lot of work with Zope, and
I really like one aspect of their form processing logic.

If you name a form widget like "x.i:records", then there will be a
dictionary called x with a field called i. If you happen to have a form
that's built up of a set of values, this results in a list of dictionaries.

This is perfect for group-processing of data. Say, for example, you want
to edit a list of items. You could present a table with one row per
record that has a name field for the items. Each row in the table may
have two form variables:

<input type="hidden" name="items.id:records" value=1>
<input type="text" name="items.name:records" value="Blah">

The code that processes this form is handed a list of dictionaries, and
can simply go through that list and process them one at a time by name.

I've reimplemented this form processing logic myself for my CGIs, and
I'd like to do the same with mod_python. But it seems that a clever
mod_python feature - where you specify a function & parameters to call
for processing - would actually get in the way of this. For my form
processing, I just want the request object, I don't want it trying to
break down the parameters.

Can this be done with the publisher handler? This is something I already
have working (see my other email in this thread about .py & .xml files),
but that particular solution's only weakness is that it can't handle .py
files in arbitrary locations.

Thanks,
~  cf
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.4 (GNU/Linux)

iD8DBQFAS3ntoaQ1/feGlJoRAm31AJ4mOf/Ug2mj7w+qoh40TflYnLEadQCggE+/
g71NgKCNSkCD5qqBP9JwBrY=
=HgrZ
-----END PGP SIGNATURE-----
From donnie at darthik.com  Sun Mar  7 16:15:37 2004
From: donnie at darthik.com (donnie)
Date: Sun Mar  7 17:10:38 2004
Subject: [mod_python] mod_python, debian, apache configuration.
Message-ID: <1078694137.20915.20.camel@sleek>

Hello.

I have been trying to get apache and mod_python working with Debian.
Using the mod_python manual, I have attempted to copy the exact mptest
given in the manual to make sure that mod_python is working.

Here is what I have in my httpd.conf:

<Directory /var/www/darthik>
        AddHandler mod_python .py
        PythonHandler mptest
        PythonDebug On
</Directory>

I am using the exact mptest.py from the manual:

from mod_python import apache

def handler(req):
	req.write("Hello World!")
        return apache.OK

However, each time I go to http://localhost/darthik/mptest.py it simply
asks me to save,cancel, or open the file, instead of HelloWorld showing
up in my browser. 

Information from the apache logs:
Apache/2.0.48 (Debian GNU/Linux) mod_python/3.0.4 Python/2.3.3

I have also tried to get it working with Apache 1.3.29 with the same
problem occurring.

I am confused at what could be the issue...
Any help would be greatly appreciated.  Thanks.

--
Donnie
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20040307/e8009070/attachment.bin
From bortzmeyer at nic.fr  Sun Mar  7 22:24:37 2004
From: bortzmeyer at nic.fr (Stephane Bortzmeyer)
Date: Sun Mar  7 17:19:36 2004
Subject: [mod_python] Re: mod_python, debian, apache configuration.
In-Reply-To: <1078694137.20915.20.camel@sleek>
References: <1078694137.20915.20.camel@sleek>
Message-ID: <20040307212437.GA19681@nic.fr>

On Sun, Mar 07, 2004 at 04:15:37PM -0500,
 donnie <donnie@darthik.com> wrote 
 a message of 75 lines which said:

> I am using the exact mptest.py from the manual:
> 
> from mod_python import apache
> 
> def handler(req):
> 	req.write("Hello World!")
>         return apache.OK
> 
> However, each time I go to http://localhost/darthik/mptest.py it simply
> asks me to save,cancel, or open the file, instead of HelloWorld showing
> up in my browser. 

Before writing "Hello, world", you should send HTTP headers, I believe
(your Apache probably defaults to application/octet-stream):

    req.content_type = "text/html"
    req.send_http_header()
From ronwalf at umd.edu  Sun Mar  7 18:18:47 2004
From: ronwalf at umd.edu (Ron Alford)
Date: Sun Mar  7 19:13:55 2004
Subject: [mod_python] Flexible imports
In-Reply-To: <404B75A6.3040202@cfconsulting.ca>
References: <404A7450.6050207@cfconsulting.ca>
	<404A9C76.8000401@mlug.missouri.edu> <404ABD67.9030101@cfconsulting.ca>
	<20040307132636.E90677@onyx.ispol.com> <404B75A6.3040202@cfconsulting.ca>
Message-ID: <404BADD7.1070901@umd.edu>

Colin Fox wrote:

> Here's my .htaccess file:
> 
> DirectoryIndex index.xml index.html index.py
> AddHandler python-program .xml .py
> PythonHandler xml_handler
> PythonDebug on
> PythonAutoReload on
> 

You're setting the PythonHandler for everything with that line
I believe the syntax for PythonHandler in this case is
PythonHandler xml_handler | .xml
PythonHandler foo_handler | .py

Or, if you're like me and stuck with apache 1.3,
<Files *.xml>
   PythonHandler xml_handler
</Files>
<Files *.py>
   PythonHandler foo_handler
</Files>



Hope this helps,
-Ron
From grisha at modpython.org  Sun Mar  7 19:15:56 2004
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Sun Mar  7 20:10:59 2004
Subject: [mod_python] Re: mod_python, debian, apache configuration.
In-Reply-To: <20040307212437.GA19681@nic.fr>
References: <1078694137.20915.20.camel@sleek> <20040307212437.GA19681@nic.fr>
Message-ID: <20040307191337.D90677@onyx.ispol.com>



On Sun, 7 Mar 2004, Stephane Bortzmeyer wrote:

> Before writing "Hello, world", you should send HTTP headers, I believe
> (your Apache probably defaults to application/octet-stream):
>
>     req.content_type = "text/html"
>     req.send_http_header()

A minor correction - on mod_python 3.0 and later there is no need to send
headers, they are sent when needed automatically. This is really a feature
of Apache rather than mod_python. So send_http_header() is a noop.

Setting a content-type, however, sometimes is indeed necessary :-)

Grisha
From cfox at cfconsulting.ca  Sun Mar  7 19:46:18 2004
From: cfox at cfconsulting.ca (Colin Fox)
Date: Sun Mar  7 23:41:25 2004
Subject: [mod_python] Flexible imports
In-Reply-To: <404BADD7.1070901@umd.edu>
References: <404A7450.6050207@cfconsulting.ca>
	<404A9C76.8000401@mlug.missouri.edu> <404ABD67.9030101@cfconsulting.ca>
	<20040307132636.E90677@onyx.ispol.com> <404B75A6.3040202@cfconsulting.ca>
	<404BADD7.1070901@umd.edu>
Message-ID: <404BEC8A.8090609@cfconsulting.ca>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Ron Alford wrote:
| Colin Fox wrote:
|
|> Here's my .htaccess file:
|>
|> DirectoryIndex index.xml index.html index.py
|> AddHandler python-program .xml .py
|> PythonHandler xml_handler
|> PythonDebug on
|> PythonAutoReload on
|>
|
| You're setting the PythonHandler for everything with that line
| I believe the syntax for PythonHandler in this case is
| PythonHandler xml_handler | .xml
| PythonHandler foo_handler | .py

Thanks! That works beautifully.

Now I've run into a slightly different quandry. Using the above note, I
can now process XML files via my single XML handler, and python files
wherever they are. That's great.

I only need one last thing for this to be all perfect - I need a
lower-level access to the req object. When the python file indicated in
the URL is called, any form data is already processed into a
FieldStorage object.

I have a different format that I use and would prefer to process it
myself. I can use the FieldStorage, but it's a waste of cycles to
process input into FieldStorage objects just to pull the info right back
out into something else. I just need the raw data, straight from the req
object.

Also, the return value of the python function is apparently a print
statement or something. What I would like would be to handle all the
processing, and perhaps even execute internal or external redirects,
which doesn't seem to be possible or practical if I'm to return a string.

If I write my own publisher, I get a raw req object, and I can return
various apache error codes. Is there a way to get this lower-level
access to both the input and output of the request handling?

Thanks,
~   cf
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.4 (GNU/Linux)

iD8DBQFAS+yKoaQ1/feGlJoRAqkUAJ0SVXH4LmeTpTnP/bCDjNw92t1jfgCffD3t
Au5e9uiSC62ySZoYaegxj90=
=FeDg
-----END PGP SIGNATURE-----
From dg at sponsera.com  Mon Mar  8 00:21:37 2004
From: dg at sponsera.com (David Geller)
Date: Mon Mar  8 01:18:42 2004
Subject: [mod_python] persistent, reliable globals
Message-ID: <404C02E1.1060107@sponsera.com>

Hi,

I would like to set a global variable (in memory) from a module. I would 
then like to access this same global variable susequently by other 
modules at any other time, and have the value that was set there to be 
there (until, of course, Apache is restarted).

I have tried several ways of doing this, and it doesn't seem to be 
reliable - i.e., sometimes the global variable is set when I look at it, 
and sometimes it is still at its original state.

What am I doing wrong (or right)?

Thanks!



From bert at tela.com  Mon Mar  8 00:13:03 2004
From: bert at tela.com (Bert Hughes)
Date: Mon Mar  8 02:08:04 2004
Subject: [mod_python] persistent, reliable globals
References: <404C02E1.1060107@sponsera.com>
Message-ID: <001701c404d4$6a73fa60$0301a8c0@janine>


----- Original Message ----- 
From: "David Geller" <dg@sponsera.com>
To: <mod_python@modpython.org>
Sent: Sunday, March 07, 2004 11:21 PM
Subject: [mod_python] persistent, reliable globals


> Hi,
> 
> I would like to set a global variable (in memory) from a module. I would 
> then like to access this same global variable susequently by other 
> modules at any other time, and have the value that was set there to be 
> there (until, of course, Apache is restarted).
> 
> I have tried several ways of doing this, and it doesn't seem to be 
> reliable - i.e., sometimes the global variable is set when I look at it, 
> and sometimes it is still at its original state.
> 
> What am I doing wrong (or right)?
> 
> Thanks!
> 
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 
> 

From bert at tela.com  Mon Mar  8 00:45:47 2004
From: bert at tela.com (Bert Hughes)
Date: Mon Mar  8 02:40:46 2004
Subject: [mod_python] persistent, reliable globals
References: <404C02E1.1060107@sponsera.com>
Message-ID: <004f01c404d8$fd69c170$0301a8c0@janine>

Apache starts number of child process - any given web connection could be
served by any of these, or apache root may start a new child to answer http
request.  Refreshing same page from same client could result in service from
different apache child processes.  Mod_python and your modules live in each
child independently - setting global only sets in it one apache process, not
other or future processes.

At least that's my understanding.

Bert Hughes

----- Original Message ----- 
From: "David Geller" <dg@sponsera.com>
To: <mod_python@modpython.org>
Sent: Sunday, March 07, 2004 11:21 PM
Subject: [mod_python] persistent, reliable globals


> Hi,
>
> I would like to set a global variable (in memory) from a module. I would
> then like to access this same global variable susequently by other
> modules at any other time, and have the value that was set there to be
> there (until, of course, Apache is restarted).
>
> I have tried several ways of doing this, and it doesn't seem to be
> reliable - i.e., sometimes the global variable is set when I look at it,
> and sometimes it is still at its original state.
>
> What am I doing wrong (or right)?
>
> Thanks!
>
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>


From mod_python at 24ksoftware.com  Mon Mar  8 01:10:54 2004
From: mod_python at 24ksoftware.com (Erik)
Date: Mon Mar  8 04:05:31 2004
Subject: [mod_python] persistent, reliable globals
Message-ID: <Pine.LNX.4.58.0403080108300.14807@ramuh.int.24ksoftware.com>

On Mon, 8 Mar 2004, David Geller wrote:

> I would like to set a global variable (in memory) from a module. I would
> then like to access this same global variable susequently by other
> modules at any other time, and have the value that was set there to be
> there (until, of course, Apache is restarted).
>
> I have tried several ways of doing this, and it doesn't seem to be
> reliable - i.e., sometimes the global variable is set when I look at it,
> and sometimes it is still at its original state.
>
> What am I doing wrong (or right)?

Greetings,

New to the list and mod_python in general, but it sounds like you will
only be able to pull this off if you are using a threaded Apache.
Again, I'm new so I could be wrong.

If you're stuck with a forked Apache, then you could try using
something from the IPC toolbox: shared files, shared memory, messages,
etc.  I would pickle whatever you wanted shared to some temp file and
have your code check for that file and define it if does not exist.
That approach has some dangerous aspects to it.  The threaded Apache
approach sounds much better.


Best regards,
Erik
From rdavisunr at yahoo.com  Mon Mar  8 09:10:29 2004
From: rdavisunr at yahoo.com (Robert Thomas Davis)
Date: Mon Mar  8 13:05:32 2004
Subject: [mod_python] Nested For Loops
Message-ID: <20040308171029.31376.qmail@web80304.mail.yahoo.com>

Hello all.  The following code is in a template file which gets passed the "record_set" variable, which is the result from an SQL query.  Its job is to create an table with the query information.  This all works fine, however, I have been unable to figure out where to put the closing tag for the <tr> tag.  According to what I have read it should be placed after the end to the first inner loop.  However, that places </tr> tags after every <td></td> pair.  This is all with the goal in mind of keeping things XHTML complient.  I would appreciate any comments and suggestions.
 
Thanks everyone.
 
<span>
<table border="1">
<caption><%= caption %></caption>
<%
for record in record_set:
        # begin outer loop
%>
        <tr>
        <%
        for field in record:
                # begin inner loop
        %>
                <td><%= field %></td>
        <%
        # end inner loop
        %>
<%
# end outer loop
%>
</table>
</span>


-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20040308/80bf4644/attachment.html
From ben at medianstrip.net  Mon Mar  8 12:33:30 2004
From: ben at medianstrip.net (Ben)
Date: Mon Mar  8 13:28:27 2004
Subject: [mod_python] Re: persistent, reliable globals
Message-ID: <20040308123316.I37127-100000@inman.medianstrip.net>

Hello,

it seems like this is a question that is asked enough to be worth

a) putting into the FAQ (for now), and
b) eventually trying to solve.

i used to do some apache API coding so i'd be willing to look into
trying to support per-child (and possibly per-thread) initialization
code.  i remember this used to be possible, and looking at mod_perl i
see it has a PerlChildExitHandler.

http://perl.apache.org/docs/2.0/user/handlers/server.html

i'll start code-diving today, and let people know what i find.  (oh
woe to the python programmer who has to read C!)

take care, B

ps i happen to want this for my project, which is an object / aspect
oriented servlet framework, that supports mixin-style functionality
for session-based authentication, caching, etc.  i plan on releasing
that too, after some bugfixes and documentation.

>
> Message: 2
> Date: Mon, 8 Mar 2004 00:13:03 -0600
> From: "Bert Hughes" <bert@tela.com>
> Subject: Re: [mod_python] persistent, reliable globals
> To: <mod_python@modpython.org>
> Message-ID: <001701c404d4$6a73fa60$0301a8c0@janine>
> Content-Type: text/plain;	charset="iso-8859-1"
>
>
> ----- Original Message -----
> From: "David Geller" <dg@sponsera.com>
> To: <mod_python@modpython.org>
> Sent: Sunday, March 07, 2004 11:21 PM
> Subject: [mod_python] persistent, reliable globals
>
>
> > Hi,
> >
> > I would like to set a global variable (in memory) from a module. I would
> > then like to access this same global variable susequently by other
> > modules at any other time, and have the value that was set there to be
> > there (until, of course, Apache is restarted).
> >
> > I have tried several ways of doing this, and it doesn't seem to be
> > reliable - i.e., sometimes the global variable is set when I look at it,
> > and sometimes it is still at its original state.
> >
> > What am I doing wrong (or right)?
> >
> > Thanks!
> >
> >
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
> >
>
>
> ------------------------------
>
> Message: 3
> Date: Mon, 8 Mar 2004 00:45:47 -0600
> From: "Bert Hughes" <bert@tela.com>
> Subject: Re: [mod_python] persistent, reliable globals
> To: <mod_python@modpython.org>
> Message-ID: <004f01c404d8$fd69c170$0301a8c0@janine>
> Content-Type: text/plain;	charset="iso-8859-1"
>
> Apache starts number of child process - any given web connection could be
> served by any of these, or apache root may start a new child to answer http
> request.  Refreshing same page from same client could result in service from
> different apache child processes.  Mod_python and your modules live in each
> child independently - setting global only sets in it one apache process, not
> other or future processes.
>
> At least that's my understanding.
>
> Bert Hughes
>
> ----- Original Message -----
> From: "David Geller" <dg@sponsera.com>
> To: <mod_python@modpython.org>
> Sent: Sunday, March 07, 2004 11:21 PM
> Subject: [mod_python] persistent, reliable globals
>
>
> > Hi,
> >
> > I would like to set a global variable (in memory) from a module. I would
> > then like to access this same global variable susequently by other
> > modules at any other time, and have the value that was set there to be
> > there (until, of course, Apache is restarted).
> >
> > I have tried several ways of doing this, and it doesn't seem to be
> > reliable - i.e., sometimes the global variable is set when I look at it,
> > and sometimes it is still at its original state.
> >
> > What am I doing wrong (or right)?
> >
> > Thanks!
> >
> >
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
> >
>
>
>
> ------------------------------
>
> Message: 4
> Date: Mon, 8 Mar 2004 01:10:54 -0700 (MST)
> From: Erik <mod_python@24ksoftware.com>
> Subject: Re: [mod_python] persistent, reliable globals
> To: mod_python@modpython.org
> Message-ID:
> 	<Pine.LNX.4.58.0403080108300.14807@ramuh.int.24ksoftware.com>
> Content-Type: TEXT/PLAIN; charset=US-ASCII
>
> On Mon, 8 Mar 2004, David Geller wrote:
>
> > I would like to set a global variable (in memory) from a module. I would
> > then like to access this same global variable susequently by other
> > modules at any other time, and have the value that was set there to be
> > there (until, of course, Apache is restarted).
> >
> > I have tried several ways of doing this, and it doesn't seem to be
> > reliable - i.e., sometimes the global variable is set when I look at it,
> > and sometimes it is still at its original state.
> >
> > What am I doing wrong (or right)?
>
> Greetings,
>
> New to the list and mod_python in general, but it sounds like you will
> only be able to pull this off if you are using a threaded Apache.
> Again, I'm new so I could be wrong.
>
> If you're stuck with a forked Apache, then you could try using
> something from the IPC toolbox: shared files, shared memory, messages,
> etc.  I would pickle whatever you wanted shared to some temp file and
> have your code check for that file and define it if does not exist.
> That approach has some dangerous aspects to it.  The threaded Apache
> approach sounds much better.
>
>
> Best regards,
> Erik
>
> ------------------------------
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
> End of Mod_python Digest, Vol 12, Issue 10
> ******************************************
>


From mod_python at 24ksoftware.com  Mon Mar  8 10:39:07 2004
From: mod_python at 24ksoftware.com (Erik Stephens)
Date: Mon Mar  8 13:33:44 2004
Subject: [mod_python] Nested For Loops
In-Reply-To: <20040308171029.31376.qmail@web80304.mail.yahoo.com>
References: <20040308171029.31376.qmail@web80304.mail.yahoo.com>
Message-ID: <Pine.LNX.4.58.0403081029320.14807@ramuh.int.24ksoftware.com>

On Mon, 8 Mar 2004, Robert Thomas Davis wrote:

> Hello all.  The following code is in a template file which gets
> passed the "record_set" variable, which is the result from an SQL
> query.  Its job is to create an table with the query information.
> This all works fine, however, I have been unable to figure out where
> to put the closing tag for the <tr> tag.  According to what I have
> read it should be placed after the end to the first inner loop.
> However, that places </tr> tags after every <td></td> pair.  This is
> all with the goal in mind of keeping things XHTML complient.  I
> would appreciate any comments and suggestions.

> <span>
> <table border="1">
> <caption><%= caption %></caption>
> <%
> for record in record_set:
>         # begin outer loop
> %>
>         <tr>
>         <%
>         for field in record:
>                 # begin inner loop
>         %>
>                 <td><%= field %></td>
>         <%
>         # end inner loop
>         %>
> <%
> # end outer loop
> %>
> </table>
> </span>

I got the following code to work like I think you want.  The position of
those '# end' comments or the whitespace around them affects the code, so
be careful with those.

  <table border=1>
<%
for i in range(10):
    # begin outer loop
%>
    <tr>
<%
    for j in range(5):
        # begin inner loop
%>
      <td><%= j %></td>
<%
    # end inner loop
%>
    </tr>
<%
# end outer loop
%>
  </table>


Personally, I find this difficult to read and very error-prone.  I'd
write it like this if possible.  Granted, this will probably get ugly
as the layout gets more complicated.

  <table border=1>
<%
for i in range(10):
    req.write('<tr>')
    for j in range(5):
        req.write('<td>[%d, %d]</td>' % (i,j))
    req.write('</tr>')

%>
  </table>


Best regards,
Erik
From SAiello at Jentoo.com  Mon Mar  8 13:54:06 2004
From: SAiello at Jentoo.com (SAiello@Jentoo.com)
Date: Mon Mar  8 14:49:24 2004
Subject: [mod_python] Storing functions in session ?
In-Reply-To: <20040308123316.I37127-100000@inman.medianstrip.net>
References: <20040308123316.I37127-100000@inman.medianstrip.net>
Message-ID: <200403081354.06546.SAiello@Jentoo.com>

I was wondering if it is possible to store functions within the session. I am 
playing around with writing a Python web IMAP client. I have been using the 
imaplib.IMAP4 library. The reason I ask, is once I create a connection to the 
IMAP server, I would like to keep it for any other commands. Thus I do not 
have to keep logging in, everytime I need to run an IMAP command.

What I have done is:
imapSess=imaplib.IMAP4('server.com')
imapSess.login(sess['imapUser'], sess['imapPass'])
sess['IMAP']=imapSess
sess.save()

When I do this I get:
TypeError: a class that defines __slots__ without defining __getstate__ cannot 
be pickled

I am still rather new to python, so I figure I am trying to do something 
stupid.

Thanks.

From mod_python at 24ksoftware.com  Mon Mar  8 12:13:36 2004
From: mod_python at 24ksoftware.com (Erik Stephens)
Date: Mon Mar  8 15:08:12 2004
Subject: [mod_python] Storing functions in session ?
In-Reply-To: <200403081354.06546.SAiello@Jentoo.com>
References: <20040308123316.I37127-100000@inman.medianstrip.net>
 <200403081354.06546.SAiello@Jentoo.com>
Message-ID: <Pine.LNX.4.58.0403081202160.20089@ramuh.int.24ksoftware.com>

On Mon, 8 Mar 2004, SAiello@Jentoo.com wrote:

> I was wondering if it is possible to store functions within the
> session. I am playing around with writing a Python web IMAP
> client. I have been using the imaplib.IMAP4 library. The reason I
> ask, is once I create a connection to the IMAP server, I would like
> to keep it for any other commands. Thus I do not have to keep
> logging in, everytime I need to run an IMAP command.

Pickling something like a connection to a server seems odd.  Not sure
it's really possible the way you describe it.  You could pickle all of
the connection information but not the connection itself.  By
connection, I'm referring to the underlying network connection, not
the Python object that is abstracting that.  You could maybe get that
IMAP4 instance to pickle by overriding some hooks or something, but to
avoid dangling connections you would want to disconnect from the
server when pickling and re-connect when unpickling which doesn't seem
what you are striving for.

Note: this is kinda off the top of my head about what I know about
pickling/serialization in general, which I'm assuming is part of the
session handling interface and which I'm no expert :)


Best regards,
Erik

From SAiello at Jentoo.com  Mon Mar  8 14:34:31 2004
From: SAiello at Jentoo.com (SAiello@Jentoo.com)
Date: Mon Mar  8 15:29:48 2004
Subject: [mod_python] Storing functions in session ?
In-Reply-To: <Pine.LNX.4.58.0403081202160.20089@ramuh.int.24ksoftware.com>
References: <20040308123316.I37127-100000@inman.medianstrip.net>
	<200403081354.06546.SAiello@Jentoo.com>
	<Pine.LNX.4.58.0403081202160.20089@ramuh.int.24ksoftware.com>
Message-ID: <200403081434.31659.SAiello@Jentoo.com>

Well storing the function seemed kinda wrong. I just do not know if there is 
any way to open a connection, and leave that connection open for use later 
on. Not to sure on the jargon, almost like pooling connections to a database.  
Only problem is each connection is for a particular user, and you would never 
want them to get mixed up, otherwise someone would be reading someone else's 
email. Any ideas or suggestions are welcomed. 

On Monday 08 March 2004 02:13 pm, Erik Stephens wrote:
> On Mon, 8 Mar 2004, SAiello@Jentoo.com wrote:
> > I was wondering if it is possible to store functions within the
> > session. I am playing around with writing a Python web IMAP
> > client. I have been using the imaplib.IMAP4 library. The reason I
> > ask, is once I create a connection to the IMAP server, I would like
> > to keep it for any other commands. Thus I do not have to keep
> > logging in, everytime I need to run an IMAP command.
>
> Pickling something like a connection to a server seems odd.  Not sure
> it's really possible the way you describe it.  You could pickle all of
> the connection information but not the connection itself.  By
> connection, I'm referring to the underlying network connection, not
> the Python object that is abstracting that.  You could maybe get that
> IMAP4 instance to pickle by overriding some hooks or something, but to
> avoid dangling connections you would want to disconnect from the
> server when pickling and re-connect when unpickling which doesn't seem
> what you are striving for.
>
> Note: this is kinda off the top of my head about what I know about
> pickling/serialization in general, which I'm assuming is part of the
> session handling interface and which I'm no expert :)
>
>
> Best regards,
> Erik
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
From fred at forsalebyowner.com  Mon Mar  8 14:32:59 2004
From: fred at forsalebyowner.com (Frederick Grim)
Date: Mon Mar  8 15:44:22 2004
Subject: [mod_python] zero terminated strings and req.write
Message-ID: <20040308193259.GA13285@golgatha.local>

Howdy all,
	so I have a little problem that is making me crazy. I have a python script
	like
	
def gen_xml():
	return """<?xml ... Tons of xhtml stuff here
	
</html>"""
	
def main(req, ERR='0'):
	re.content_type = 'text/xml'
	req.write(gen_xml())
	return apache.OK

The problem here is that python puts null bytes at the end of a string and
req.write fails with the error that there is a 0 after </html>.  How do I get this
failure to not happen.  Even if i set content_type to 'text/html' there appears a
little zero at the end of my script. It seems like a bug? maybe.  I am using mod_python 3.1.3
apache 2.0.47, and python 2.3

	Fred

-- 
"Windows Longhorn will be like having a little cop right inside your computer"
	-- Jorge Lopez, MCSE
From mod_python at 24ksoftware.com  Mon Mar  8 14:03:43 2004
From: mod_python at 24ksoftware.com (Erik Stephens)
Date: Mon Mar  8 16:58:07 2004
Subject: [mod_python] Storing functions in session ?
In-Reply-To: <200403081434.31659.SAiello@Jentoo.com>
References: <20040308123316.I37127-100000@inman.medianstrip.net>
	<Pine.LNX.4.58.0403081202160.20089@ramuh.int.24ksoftware.com>
	<200403081434.31659.SAiello@Jentoo.com>
Message-ID: <Pine.LNX.4.58.0403081318210.21437@localhost>

On Mon, 8 Mar 2004, SAiello@Jentoo.com wrote:

> Well storing the function seemed kinda wrong. I just do not know if
> there is any way to open a connection, and leave that connection
> open for use later on. Not to sure on the jargon, almost like
> pooling connections to a database.  Only problem is each connection
> is for a particular user, and you would never want them to get mixed
> up, otherwise someone would be reading someone else's email. Any
> ideas or suggestions are welcomed.

So, it sounds like you want a global object to be able to "serve" the
already opened connections to the different Apache threads or
processes (depending on your Apache implementation).  With a threaded
implementation, it *should* be as easy as creating a global hash/dict
keyed by user id or email address.  I've never done this, that's why I
say "should".  I'll be doing something along those lines soon enough
though.  You'll just have to take care that the threads don't step on
eachother when accessing that shared hash.

For a forking Apache implementation, it's beyond my abilities to see
how to do it.  I was just reading in Eric Raymond's "The Art of Unix
Programming" why multi-threaded programs are worse than per-process
ones.  I have to disagree, at least in this domain.


Best regards,
Erik

From mod_python at 24ksoftware.com  Mon Mar  8 14:35:04 2004
From: mod_python at 24ksoftware.com (Erik Stephens)
Date: Mon Mar  8 17:29:35 2004
Subject: [mod_python] zero terminated strings and req.write
In-Reply-To: <20040308193259.GA13285@golgatha.local>
References: <20040308193259.GA13285@golgatha.local>
Message-ID: <Pine.LNX.4.58.0403081429140.21437@localhost>

On Mon, 8 Mar 2004, Frederick Grim wrote:

> def gen_xml():
> 	return """<?xml ... Tons of xhtml stuff here
>
> </html>"""
>
> def main(req, ERR='0'):
> 	re.content_type = 'text/xml'
> 	req.write(gen_xml())
> 	return apache.OK
>
> The problem here is that python puts null bytes at the end of a
> string and req.write fails with the error that there is a 0 after
> </html>.

How does it fail?  Raises an exception?  What is the actual exception
type and value?  It sounds strange to me cuz I've never had to worry
about null bytes in strings in my Python travels.


> How do I get this failure to not happen.  Even if i set content_type
> to 'text/html' there appears a little zero at the end of my
> script. It seems like a bug? maybe.  I am using mod_python 3.1.3
> apache 2.0.47, and python 2.3

Dumb questions maybe, but what handler are you using?  If you're using
the publisher handler, then maybe that zero at the end is what
apache.OK equals?


Best regards,
Erik

From grisha at modpython.org  Mon Mar  8 16:58:44 2004
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Mon Mar  8 17:53:46 2004
Subject: [mod_python] Storing functions in session ?
In-Reply-To: <200403081354.06546.SAiello@Jentoo.com>
References: <20040308123316.I37127-100000@inman.medianstrip.net>
 <200403081354.06546.SAiello@Jentoo.com>
Message-ID: <20040308165806.G9768@onyx.ispol.com>


No, the things that you store in a session must be picklable.

Grisha

On Mon, 8 Mar 2004, SAiello@Jentoo.com wrote:

> I was wondering if it is possible to store functions within the session. I am
> playing around with writing a Python web IMAP client. I have been using the
> imaplib.IMAP4 library. The reason I ask, is once I create a connection to the
> IMAP server, I would like to keep it for any other commands. Thus I do not
> have to keep logging in, everytime I need to run an IMAP command.
>
> What I have done is:
> imapSess=imaplib.IMAP4('server.com')
> imapSess.login(sess['imapUser'], sess['imapPass'])
> sess['IMAP']=imapSess
> sess.save()
>
> When I do this I get:
> TypeError: a class that defines __slots__ without defining __getstate__ cannot
> be pickled
>
> I am still rather new to python, so I figure I am trying to do something
> stupid.
>
> Thanks.
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From SAiello at Jentoo.com  Mon Mar  8 17:12:11 2004
From: SAiello at Jentoo.com (SAiello@Jentoo.com)
Date: Mon Mar  8 18:07:26 2004
Subject: [mod_python] Storing functions in session ?
In-Reply-To: <Pine.LNX.4.58.0403081318210.21437@localhost>
References: <20040308123316.I37127-100000@inman.medianstrip.net>
	<200403081434.31659.SAiello@Jentoo.com>
	<Pine.LNX.4.58.0403081318210.21437@localhost>
Message-ID: <200403081712.11103.SAiello@Jentoo.com>

I went looking through the mod_python docs, I really didn't see anything that 
screamed out to me that would perform what ya suggested.  Any pointers to 
docs, or samples would be great if possible. 

Only way I saw how to tell if my apache was threaded or forked was through the 
apache.mpm_query(). Is that right ?

Thanks again for all your thoughts on this,
  Steven

On Monday 08 March 2004 04:03 pm, Erik Stephens wrote:
> So, it sounds like you want a global object to be able to "serve" the
> already opened connections to the different Apache threads or
> processes (depending on your Apache implementation).  With a threaded
> implementation, it *should* be as easy as creating a global hash/dict
> keyed by user id or email address.  I've never done this, that's why I
> say "should".  I'll be doing something along those lines soon enough
> though.  You'll just have to take care that the threads don't step on
> eachother when accessing that shared hash.
>
> For a forking Apache implementation, it's beyond my abilities to see
> how to do it.  I was just reading in Eric Raymond's "The Art of Unix
> Programming" why multi-threaded programs are worse than per-process
> ones.  I have to disagree, at least in this domain.
>
>
> Best regards,
> Erik
From vlindberg at verio.net  Mon Mar  8 15:31:35 2004
From: vlindberg at verio.net (VanL)
Date: Mon Mar  8 18:26:32 2004
Subject: [mod_python] 
	Supporting legacy PHP pages while still giving mod_python the root
Message-ID: <404CF447.7020803@verio.net>

Hello,

I have an apache 1.3.x + mod_python + quixote intranet.  I also have 
some legacy PHP pages.  I am currently running mod_python off a 
subdirectory, but I would like to make mod_python the root but still 
maintain PHP access to the old pages.

In my mod_python handler, I currently have the following code

def handler(req):
    # Try to find php
    urlpath = str(req.uri).lower()
    if urlpath.find('.php') != -1:
        # Found a php extension
        return apache.DECLINED
    else:
        # Continue with mod_python stuff

 From the docs, this would appear to pass this request on to the next 
handler, presumably the one set by the SetHandler function in the 
httpd.conf.  Unfortunately, it doesn't work; it ends up giving me a 404 
error.

I know this code is being executed; if I change apache.DECLINED to 
apache.HTTP_INTERNAL_SERVER_ERROR, an error is thrown whenever I have 
.php in the request uri.  

Is there a way to make sure that the path is appropriately followed and 
the php file appropriately executed if we find ".php"?

Thanks,

VanL
From bje at apnic.net  Tue Mar  9 08:47:25 2004
From: bje at apnic.net (Byron Ellacott)
Date: Mon Mar  8 18:42:39 2004
Subject: [mod_python]  Supporting legacy PHP pages while still giving
	mod_python the root
In-Reply-To: <404CF447.7020803@verio.net>
References: <404CF447.7020803@verio.net>
Message-ID: <1078786045.10238.10.camel@ping.apnic.net>

On Tue, 2004-03-09 at 08:31, VanL wrote:
> I have an apache 1.3.x + mod_python + quixote intranet.  I also have 
> some legacy PHP pages.  I am currently running mod_python off a 
> subdirectory, but I would like to make mod_python the root but still 
> maintain PHP access to the old pages.

<Files *.php>
   ... PHP config here ...
</Files>

? 

-- 
bje
From grisha at modpython.org  Mon Mar  8 18:13:16 2004
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Mon Mar  8 19:08:20 2004
Subject: [mod_python] Storing functions in session ?
In-Reply-To: <200403081712.11103.SAiello@Jentoo.com>
References: <20040308123316.I37127-100000@inman.medianstrip.net>
	<Pine.LNX.4.58.0403081318210.21437@localhost>
	<200403081712.11103.SAiello@Jentoo.com>
Message-ID: <20040308181234.B9768@onyx.ispol.com>


On Mon, 8 Mar 2004, SAiello@Jentoo.com wrote:

> Only way I saw how to tell if my apache was threaded or forked was through the
> apache.mpm_query(). Is that right ?

Yes, you can look at Session.py for some code that makes use of this API.

Grisha
From ben at medianstrip.net  Mon Mar  8 19:52:55 2004
From: ben at medianstrip.net (Ben)
Date: Mon Mar  8 20:47:53 2004
Subject: [mod_python] Re: persistent, reliable globals
In-Reply-To: <20040308114302.R36312-100000@inman.medianstrip.net>
Message-ID: <20040308183456.J41550-100000@inman.medianstrip.net>

Hello all,

After grovelling mod_python, mod_perl, and Apache API docs, what i've
discovered is this:

If you just want to initialize a global variable, you can probably do
that using the "PythonImport" directive.  in short:

ServerName foo.com
PythonPath "sys.path+['/path/to/MyGlobals']"
PythonImport MyGlobals foo.com

or something like this, depending on how you set the
PythonInterpPerDirective/Directory settings.  PythonImport happens
per-subinterpreter (not for the main interpreter, nor per-thread),
inside of the apache per-child hook.  This of course will only be
shared within a child process, within a named subinterpreter.  There
are good docs on how it is used in the mod_python manuals.

More examples:

PythonInterpPerDirective
<Directory /mydir>
	AddHandler mod_python .py
	PythonHandler mod_python.publisher
	PythonPath "sys.path+['/path/to/MyGlobals']"
	PythonImport MyGlobals /mydir
</Directory>

OR

# Creates a subinterpreter "MyInterpreter" which handles the
# requests in this scope to be run there
PythonInterpreter MyInterpreter
PythonPath "sys.path+['/path/to/MyGlobals']"
PythonImport MyGlobals MyInterpreter

There are some caveats, however:

1) The imports happen at child initialization time, when a lot of the
configuration hasn't been merged in yet.  This includes:
PythonInterpreter (!!!), PythonOptions, ....

2) PythonImport is not really subinterpreter-scoped: it is a global
directive that specifies the interpreter name.  Plus PythonInterpreter
isn't in effect at the time of import, either.  It would be nice to
have a directive like

PythonInterpInit Foo

which would affect the interpreter "in the current scope" in the
apache configuration -- i.e. at the virtual server level by default,
or per directive / directory if those options are used.

3) This is not entirely specific to PythonImport, but it is difficult
in general to get your hands on configuration variables
(PythonOption-s, in particular) not in the context of a request.  It
would be nice if each subinterpreter had access to the Apache
configuration variables (e.g. PythonOptions) scope-local to it.

As a workaround, I'm using named interpreters and moving all
sub-interpreter-specific configuration into importable files.

4) Running with PythonAutoReload may still kill global variables if
you're not careful.

B

ps put this into the FAQ?

On Mon, 8 Mar 2004, Ben wrote:

> Hello,
>
> it seems like this is a question that is asked enough to be worth
>
> a) putting into the FAQ (for now), and
> b) eventually trying to solve.
>
> i used to do some apache API coding so i'd be willing to look into
> trying to support per-child (and possibly per-thread) initialization
> code.  i remember this used to be possible, and looking at mod_perl i
> see it has a PerlChildExitHandler.
>
> http://perl.apache.org/docs/2.0/user/handlers/server.html
>
> i'll start code-diving today, and let people know what i find.  (oh
> woe to the python programmer who has to read C!)
>
> take care, B
>
> ps i happen to want this for my project, which is an object / aspect
> oriented servlet framework, that supports mixin-style functionality
> for session-based authentication, caching, etc.  i plan on releasing
> that too, after some bugfixes and documentation.


From ben at medianstrip.net  Tue Mar  9 04:18:09 2004
From: ben at medianstrip.net (Ben)
Date: Tue Mar  9 05:13:07 2004
Subject: [mod_python] Re: persistent, reliable globals
In-Reply-To: <20040308183456.J41550-100000@inman.medianstrip.net>
Message-ID: <20040309041716.V47774-100000@inman.medianstrip.net>

Whoops!  I forgot to mention, PythonImport is a server directive, so
it's only valid at server-scope.  E.g. not in Location or Directories.

B

On Mon, 8 Mar 2004, Ben wrote:

> Hello all,
>
> After grovelling mod_python, mod_perl, and Apache API docs, what i've
> discovered is this:
>
> If you just want to initialize a global variable, you can probably do
> that using the "PythonImport" directive.  in short:
>
> ServerName foo.com
> PythonPath "sys.path+['/path/to/MyGlobals']"
> PythonImport MyGlobals foo.com
>
> or something like this, depending on how you set the
> PythonInterpPerDirective/Directory settings.  PythonImport happens
> per-subinterpreter (not for the main interpreter, nor per-thread),
> inside of the apache per-child hook.  This of course will only be
> shared within a child process, within a named subinterpreter.  There
> are good docs on how it is used in the mod_python manuals.
>
> More examples:
>
> PythonInterpPerDirective
> <Directory /mydir>
> 	AddHandler mod_python .py
> 	PythonHandler mod_python.publisher
> 	PythonPath "sys.path+['/path/to/MyGlobals']"
> 	PythonImport MyGlobals /mydir
> </Directory>
>
> OR
>
> # Creates a subinterpreter "MyInterpreter" which handles the
> # requests in this scope to be run there
> PythonInterpreter MyInterpreter
> PythonPath "sys.path+['/path/to/MyGlobals']"
> PythonImport MyGlobals MyInterpreter
>
> There are some caveats, however:
>
> 1) The imports happen at child initialization time, when a lot of the
> configuration hasn't been merged in yet.  This includes:
> PythonInterpreter (!!!), PythonOptions, ....
>
> 2) PythonImport is not really subinterpreter-scoped: it is a global
> directive that specifies the interpreter name.  Plus PythonInterpreter
> isn't in effect at the time of import, either.  It would be nice to
> have a directive like
>
> PythonInterpInit Foo
>
> which would affect the interpreter "in the current scope" in the
> apache configuration -- i.e. at the virtual server level by default,
> or per directive / directory if those options are used.
>
> 3) This is not entirely specific to PythonImport, but it is difficult
> in general to get your hands on configuration variables
> (PythonOption-s, in particular) not in the context of a request.  It
> would be nice if each subinterpreter had access to the Apache
> configuration variables (e.g. PythonOptions) scope-local to it.
>
> As a workaround, I'm using named interpreters and moving all
> sub-interpreter-specific configuration into importable files.
>
> 4) Running with PythonAutoReload may still kill global variables if
> you're not careful.
>
> B
>
> ps put this into the FAQ?
>
> On Mon, 8 Mar 2004, Ben wrote:
>
> > Hello,
> >
> > it seems like this is a question that is asked enough to be worth
> >
> > a) putting into the FAQ (for now), and
> > b) eventually trying to solve.
> >
> > i used to do some apache API coding so i'd be willing to look into
> > trying to support per-child (and possibly per-thread) initialization
> > code.  i remember this used to be possible, and looking at mod_perl i
> > see it has a PerlChildExitHandler.
> >
> > http://perl.apache.org/docs/2.0/user/handlers/server.html
> >
> > i'll start code-diving today, and let people know what i find.  (oh
> > woe to the python programmer who has to read C!)
> >
> > take care, B
> >
> > ps i happen to want this for my project, which is an object / aspect
> > oriented servlet framework, that supports mixin-style functionality
> > for session-based authentication, caching, etc.  i plan on releasing
> > that too, after some bugfixes and documentation.
>
>
>

From mollo at club-internet.fr  Tue Mar  9 10:53:44 2004
From: mollo at club-internet.fr (mollo)
Date: Tue Mar  9 05:48:47 2004
Subject: [mod_python] Multiples Handlers (Spyce, Python)
Message-ID: <20040309105344.056a716a@concord.bghflt.org>

Hello List

Any tip around to archieve that but with mod_python 2.7 (see Faq 1.2
bellow)

I fail to configure Apache 1.3.26/Mod_Python 2.7.9/Python 2.2 for handling
spyce and python code :

<IfModule mod_python.c>
  AddHandler python-program .spy
  PythonHandler run_spyceModpy::spyceMain
  PythonPath "sys.path+[r'/usr/lib/spyce']"
  #PythonOption SPYCE_CONFIG "/mydir/spyce.conf"
  #PythonOptimize On
</IfModule>

<IfModule mod_python.c>
  AddHandler python-program .py
  PythonHandler mytestprogram
</IfModule>

Neither of these 2 handlers work, only the first one (spyce) run fine when
the second is commented.

Thanks.

> 1.2. Multiple handlers in a single directory
> If you encountered a situation when you need to have several mod_python
> handlers in the same directory, this is the way to do it...
> 
> Suppose you want all .py files to be handled with mod_python.publisher,
> all .spy files with spyce and all .pysp files with mod_python.psp.
> 
> This is the configuration to achieve that:
> 
>  <Directory /home/www/>
>         AddHandler mod_python .py .spy .pysp
>         PythonHandler mod_python.publisher | .py
>         PythonHandler spyce.run_spyceModpy::spyceMain | .spy
>         PythonHandler mod_python.psp | .pysp
>         PythonDebug On
>  </Directory>
> 
> ps. this only works in mod_python 3.x of course 


Mathieu
-- 
From fred at forsalebyowner.com  Tue Mar  9 09:25:55 2004
From: fred at forsalebyowner.com (Frederick Grim)
Date: Tue Mar  9 11:26:26 2004
Subject: [mod_python] zero terminated strings and req.write
In-Reply-To: <Pine.LNX.4.58.0403081429140.21437@localhost>
References: <20040308193259.GA13285@golgatha.local>
	<Pine.LNX.4.58.0403081429140.21437@localhost>
Message-ID: <20040309142555.GA1744@golgatha.local>

Erik Stephens at <mod_python@24ksoftware.com> replied:
> On Mon, 8 Mar 2004, Frederick Grim wrote:
> 
> > def gen_xml():
> > 	return """<?xml ... Tons of xhtml stuff here
> >
> > </html>"""
> >
> > def main(req, ERR='0'):
> > 	re.content_type = 'text/xml'
> > 	req.write(gen_xml())
> > 	return apache.OK
> >
> > The problem here is that python puts null bytes at the end of a
> > string and req.write fails with the error that there is a 0 after
> > </html>.
> 
> How does it fail?  Raises an exception?  What is the actual exception
> type and value?  It sounds strange to me cuz I've never had to worry
> about null bytes in strings in my Python travels.

okay I have tracked the problem down.  It seems that return apache.OK
adds a 0 to the output that the browser picks up so somewhere between function and
browser mod_python leaves the zero at the end of the string.  The problem
manifested itself with a failure when content_type was set to 'text/xml' since I
guess mod_python shoved the output through a validating parser.

	1. Is this a correct analysis
	2. Is this a bug or my misuse of mod_python
	if is_bug:
		print 'Has this been addressed?'
	else:
		fred_file_bug_report()

	heh :)
		Fred
> 
> 
> > How do I get this failure to not happen.  Even if i set content_type
> > to 'text/html' there appears a little zero at the end of my
> > script. It seems like a bug? maybe.  I am using mod_python 3.1.3
> > apache 2.0.47, and python 2.3
> 
> Dumb questions maybe, but what handler are you using?  If you're using
> the publisher handler, then maybe that zero at the end is what
> apache.OK equals?
> 
> 
> Best regards,
> Erik
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

-- 
"Windows Longhorn will be like having a little cop right inside your computer"
	-- Jorge Lopez, MCSE
From neel at mediapulse.com  Tue Mar  9 10:39:05 2004
From: neel at mediapulse.com (Michael C. Neel)
Date: Tue Mar  9 11:34:09 2004
Subject: [mod_python]  Supporting legacy PHP pages while still
	givingmod_python the root
Message-ID: <C0FC22C08B82074A88B500617641577787A865@johnson.mediapulse.net>

> > I have an apache 1.3.x + mod_python + quixote intranet.  I 
> also have 
> > some legacy PHP pages.  I am currently running mod_python off a 
> > subdirectory, but I would like to make mod_python the root 
> but still 
> > maintain PHP access to the old pages.
> 
> <Files *.php>
>    ... PHP config here ...
> </Files>
> 
> ? 

Also sounds as if your php and python files use different directories
completely?  
You'll need to probably work in an Alias /php /home/site/phpfiles so
that apache can find the files.  Looking in the errorlog, I'd bet you
see something like "File does not exist:
/home/site/pythonfiles/something.php".  The alias will mean that it is
likely you'll need to rename some links, and/or get creative with
mod_rewrite.  I'd consider merging the two directories as well, but
doing that depends on just how evenything was laid out to begin with.

Mike

From jciccale at mac.com  Tue Mar  9 16:47:37 2004
From: jciccale at mac.com (=?iso-8859-1?Q?Juli=E1n_Ciccal=E8?=)
Date: Tue Mar  9 11:42:48 2004
Subject: [mod_python] zero terminated strings and req.write
In-Reply-To: <20040309142555.GA1744@golgatha.local>
Message-ID: <200403091642.i29Ggkxj012306@slash.mediapulse.com>

Yes apache.OK equals 0. 

If you are using the Publisher handler, the return value of your function is
writed out on the request.
So you either write your own data to the request and not return any value,
Or return the string to be writed on the request.

Anyway, returning apache.* values is used when you define
your OWN mod_python handler.

- julian

-----Mensaje original-----
De: mod_python-bounces@modpython.org
[mailto:mod_python-bounces@modpython.org] En nombre de Frederick Grim
Enviado el: martes, 09 de marzo de 2004 15:26
Para: mod_python@modpython.org
Asunto: Re: [mod_python] zero terminated strings and req.write

Erik Stephens at <mod_python@24ksoftware.com> replied:
> On Mon, 8 Mar 2004, Frederick Grim wrote:
> 
> > def gen_xml():
> > 	return """<?xml ... Tons of xhtml stuff here
> >
> > </html>"""
> >
> > def main(req, ERR='0'):
> > 	re.content_type = 'text/xml'
> > 	req.write(gen_xml())
> > 	return apache.OK
> >
> > The problem here is that python puts null bytes at the end of a
> > string and req.write fails with the error that there is a 0 after
> > </html>.
> 
> How does it fail?  Raises an exception?  What is the actual exception
> type and value?  It sounds strange to me cuz I've never had to worry
> about null bytes in strings in my Python travels.

okay I have tracked the problem down.  It seems that return apache.OK
adds a 0 to the output that the browser picks up so somewhere between
function and
browser mod_python leaves the zero at the end of the string.  The problem
manifested itself with a failure when content_type was set to 'text/xml'
since I
guess mod_python shoved the output through a validating parser.

	1. Is this a correct analysis
	2. Is this a bug or my misuse of mod_python
	if is_bug:
		print 'Has this been addressed?'
	else:
		fred_file_bug_report()

	heh :)
		Fred
> 
> 
> > How do I get this failure to not happen.  Even if i set content_type
> > to 'text/html' there appears a little zero at the end of my
> > script. It seems like a bug? maybe.  I am using mod_python 3.1.3
> > apache 2.0.47, and python 2.3
> 
> Dumb questions maybe, but what handler are you using?  If you're using
> the publisher handler, then maybe that zero at the end is what
> apache.OK equals?
> 
> 
> Best regards,
> Erik
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

-- 
"Windows Longhorn will be like having a little cop right inside your
computer"
	-- Jorge Lopez, MCSE
_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://mailman.modpython.org/mailman/listinfo/mod_python

From grisha at modpython.org  Tue Mar  9 12:45:07 2004
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Tue Mar  9 13:40:11 2004
Subject: [mod_python] zero terminated strings and req.write
In-Reply-To: <20040309142555.GA1744@golgatha.local>
References: <20040308193259.GA13285@golgatha.local>
	<Pine.LNX.4.58.0403081429140.21437@localhost>
	<20040309142555.GA1744@golgatha.local>
Message-ID: <20040309124337.X16199@onyx.ispol.com>



On Tue, 9 Mar 2004, Frederick Grim wrote:

> 	1. Is this a correct analysis
> 	2. Is this a bug or my misuse of mod_python

The answer depends very much on Erik's question (below). What does the
relevant part of your Apache config look like?

Grisha

> > Dumb questions maybe, but what handler are you using?  If you're using
> > the publisher handler, then maybe that zero at the end is what
> > apache.OK equals?
> >
> >
> > Best regards,
> > Erik
From fred at forsalebyowner.com  Tue Mar  9 12:54:26 2004
From: fred at forsalebyowner.com (Frederick Grim)
Date: Tue Mar  9 13:51:10 2004
Subject: [mod_python] xml, xslt mod_python FAQ inclusion
Message-ID: <20040309175426.GA25735@golgatha.local>

Howdy all,
	I am wondering if the FAQ could get an inclusion like
	"Whats up with the 4suite tools and mod_python?"
		Reply: Don't bother they don't work together.   Tell yourself 
	again and again "CGI is fun" and try again without mod_python
	or redesign your app entirely

	That entry would have saved me about a day.  Because they
don't and the issue outlined in
http://mail.python.org/pipermail/xml-sig/2003-June/009606.html
is apparently still unresolved.  Man I wished I'd never bothered...
	Fred
-- 
"Windows Longhorn will be like having a little cop right inside your computer"
	-- Jorge Lopez, MCSE
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20040309/66b698d0/attachment.bin
From fred at forsalebyowner.com  Tue Mar  9 13:05:36 2004
From: fred at forsalebyowner.com (Frederick Grim)
Date: Tue Mar  9 14:02:29 2004
Subject: [mod_python] zero terminated strings and req.write
In-Reply-To: <20040309124337.X16199@onyx.ispol.com>
References: <20040308193259.GA13285@golgatha.local>
	<Pine.LNX.4.58.0403081429140.21437@localhost>
	<20040309142555.GA1744@golgatha.local> <20040309124337.X16199@onyx.ispol.com>
Message-ID: <20040309180536.GA28648@golgatha.local>

Gregory (Grisha) Trubetskoy at <grisha@modpython.org> replied:
> 
> 
> On Tue, 9 Mar 2004, Frederick Grim wrote:
> 
> > 	1. Is this a correct analysis
> > 	2. Is this a bug or my misuse of mod_python
> 
> The answer depends very much on Erik's question (below). What does the
> relevant part of your Apache config look like?

	I was using the publisher but it's really a moot point now after a day of tussling
with mod_python I am giving up and working with something less complicated /
working if I had another few weeks to figure this out maybe but this project has
to be done soon and mod_python is slowly making me crazy (as the tone of this
email indicates)  After I sorted that problem the wierdness with suddenly not
finding files that are in the proper directory, then making me hard code every
path in the xhtml like href-"http://127.0.0.1/~hal9000/foo.py/handler" then having
to restart the webserver everytime I change a module (I saw the FAQ entry on this
but couldn't get it to work) python bailed with an error. I am sure now that I think
about it that the problem was that there is some module in the standard library
that I was failing to load.  

In short I am sure all of my problems (other then the 4suite stuff) is due to
my own lack of reading but shit I read the entire manual, read a bunch of
apache docs and getting even the most basic scripts to work was a huge pain in
the ass.

		Fred

> 
> Grisha
> 
> > > Dumb questions maybe, but what handler are you using?  If you're using
> > > the publisher handler, then maybe that zero at the end is what
> > > apache.OK equals?
> > >
> > >
> > > Best regards,
> > > Erik
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

-- 
"Windows Longhorn will be like having a little cop right inside your computer"
	-- Jorge Lopez, MCSE
From grisha at modpython.org  Tue Mar  9 14:00:30 2004
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Tue Mar  9 14:55:34 2004
Subject: [mod_python] zero terminated strings and req.write
In-Reply-To: <20040309180536.GA28648@golgatha.local>
References: <20040308193259.GA13285@golgatha.local>
	<Pine.LNX.4.58.0403081429140.21437@localhost>
	<20040309124337.X16199@onyx.ispol.com>
	<20040309180536.GA28648@golgatha.local>
Message-ID: <20040309135625.X16199@onyx.ispol.com>



On Tue, 9 Mar 2004, Frederick Grim wrote:

> Gregory (Grisha) Trubetskoy at <grisha@modpython.org> replied:
> >
> >
> > On Tue, 9 Mar 2004, Frederick Grim wrote:
> >
> > > 	1. Is this a correct analysis
> > > 	2. Is this a bug or my misuse of mod_python
> >
> > The answer depends very much on Erik's question (below). What does the
> > relevant part of your Apache config look like?
>
> 	I was using the publisher

Well there is the answer - the return value from the functions called by
the publisher is your content, so if you didn't want to return anything
you can just "return" without any arguments.

Grisha

> >
> > > > Dumb questions maybe, but what handler are you using?  If you're using
> > > > the publisher handler, then maybe that zero at the end is what
> > > > apache.OK equals?
> > > >
> > > >
> > > > Best regards,
> > > > Erik
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
>
> --
> "Windows Longhorn will be like having a little cop right inside your computer"
> 	-- Jorge Lopez, MCSE
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From neel at mediapulse.com  Tue Mar  9 14:19:39 2004
From: neel at mediapulse.com (Michael C. Neel)
Date: Tue Mar  9 15:14:43 2004
Subject: [mod_python] zero terminated strings and req.write
Message-ID: <C0FC22C08B82074A88B500617641577787A866@johnson.mediapulse.net>

> 	I was using the publisher but it's really a moot point 
> now after a day of tussling
> with mod_python I am giving up and working with something 
> less complicated /
> working if I had another few weeks to figure this out maybe 
> but this project has
> to be done soon and mod_python is slowly making me crazy (as 
> the tone of this
> email indicates)  After I sorted that problem the wierdness 
> with suddenly not
> finding files that are in the proper directory, then making 
> me hard code every
> path in the xhtml like 
> href-"http://127.0.0.1/~hal9000/foo.py/handler" then having
> to restart the webserver everytime I change a module (I saw 
> the FAQ entry on this
> but couldn't get it to work) python bailed with an error. I 
> am sure now that I think
> about it that the problem was that there is some module in 
> the standard library
> that I was failing to load.  
> 
> In short I am sure all of my problems (other then the 4suite 
> stuff) is due to
> my own lack of reading but shit I read the entire manual, 
> read a bunch of
> apache docs and getting even the most basic scripts to work 
> was a huge pain in
> the ass.
> 
> 		Fred


This sounds like it was a poor time for you to learn a new system.  PHP
and Mod_Python are not remotly the same things, you would have the same
trouble moving to Mod_perl.  Perhaps you would be better spending time
learning the new system by creating new/test applications in it, than
trying to dive in by migrating portions of a legacy application, and
allowing yourself learning time.  It's sad, but few people will spending
a month learning something, everyone tends to start a new technology by
writing a real-world application.

Also it's important top understand how "high-level" you are.  PHP is a
very high-level language, abstracting just about all the details of the
http protocol.  Mod_python propvides various levels of abstraction on
top of the Apache API, which really doesn't abstract much but hiding the
details od TCP/IP from you.  Same rules apply as they always have, the
lower you get the more complex and more powerful.

And don't forget Python itself.  Most people think that python is like
perl with some minor differences, which is flat out wrong.  It would be
better if people thought of Python as Java with some differences.  Perl
is a wood screw, Python is machine threads, use either one on the wrong
material and things break.  PHP is more a mix of C and Perl style, than
a C++ or Java style.

I'm sorry you weren't able to use python on this project, but give
yourself time to learn it and try again, and I think you'll be pleased
with the results.

Mike

From dg at sponsera.com  Tue Mar  9 14:50:04 2004
From: dg at sponsera.com (David Geller)
Date: Tue Mar  9 15:47:16 2004
Subject: [mod_python] persistent, reliable globals
In-Reply-To: <Pine.LNX.4.58.0403080108300.14807@ramuh.int.24ksoftware.com>
References: <Pine.LNX.4.58.0403080108300.14807@ramuh.int.24ksoftware.com>
Message-ID: <404E1FEC.8010602@sponsera.com>

Hi,

Well, I had more or less come to this conclusion for the current
mod_python version. Thankyou.

Suggestion:
Perhaps what would be handy: a special python function call, implemented
via the API, to allow setting/getting of objects global to all the
forked children for a particular named interpreter. These objects might 
be accessible through the req
object, for example. I don't know enough to judge...

Is this feaible? Useful (well, it would be to me...)? Easy/hard?

Regards,
David

Erik wrote:

>On Mon, 8 Mar 2004, David Geller wrote:
>
>  
>
>>I would like to set a global variable (in memory) from a module. I would
>>then like to access this same global variable susequently by other
>>modules at any other time, and have the value that was set there to be
>>there (until, of course, Apache is restarted).
>>
>>I have tried several ways of doing this, and it doesn't seem to be
>>reliable - i.e., sometimes the global variable is set when I look at it,
>>and sometimes it is still at its original state.
>>
>>What am I doing wrong (or right)?
>>    
>>
>
>Greetings,
>
>New to the list and mod_python in general, but it sounds like you will
>only be able to pull this off if you are using a threaded Apache.
>Again, I'm new so I could be wrong.
>
>If you're stuck with a forked Apache, then you could try using
>something from the IPC toolbox: shared files, shared memory, messages,
>etc.  I would pickle whatever you wanted shared to some temp file and
>have your code check for that file and define it if does not exist.
>That approach has some dangerous aspects to it.  The threaded Apache
>approach sounds much better.
>
>
>Best regards,
>Erik
>_______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org
>http://mailman.modpython.org/mailman/listinfo/mod_python
>
>  
>

-- 
David Geller
Sponsera, LLC
dg@sponsera.com
www.sponsera.com
Phone: 703.532.6812
Fax: 703.532.6058




From michael at dynamine.net  Tue Mar  9 12:34:26 2004
From: michael at dynamine.net (Michael S. Fischer)
Date: Tue Mar  9 16:29:34 2004
Subject: [mod_python] persistent, reliable globals
In-Reply-To: <404E1FEC.8010602@sponsera.com>
Message-ID: <20040309203429.8381E3118BE@attrition.dynamine.net>

David Geller writes:

> Suggestion:
> Perhaps what would be handy: a special python function call, 
> implemented via the API, to allow setting/getting of objects 
> global to all the forked children for a particular named 
> interpreter. These objects might be accessible through the 
> req object, for example. I don't know enough to judge...
> 
> Is this feaible? Useful (well, it would be to me...)? Easy/hard?

Why don't you just use on-disk storage (e.g. anydbm) or a remote db for
this?  Why reinvent the wheel?

--Michael 

From grisha at modpython.org  Tue Mar  9 16:11:24 2004
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Tue Mar  9 17:06:29 2004
Subject: [mod_python] persistent, reliable globals
In-Reply-To: <404E1FEC.8010602@sponsera.com>
References: <Pine.LNX.4.58.0403080108300.14807@ramuh.int.24ksoftware.com>
 <404E1FEC.8010602@sponsera.com>
Message-ID: <20040309160825.B30330@onyx.ispol.com>


On Tue, 9 Mar 2004, David Geller wrote:

> Hi,
>
> Well, I had more or less come to this conclusion for the current
> mod_python version. Thankyou.
>
> Suggestion:
> Perhaps what would be handy: a special python function call, implemented
> via the API, to allow setting/getting of objects global to all the
> forked children for a particular named interpreter. These objects might
> be accessible through the req
> object, for example. I don't know enough to judge...
>
> Is this feaible? Useful (well, it would be to me...)? Easy/hard?

I've looked at this issue, and it's doable, but pretty darn difficult,
which is why it isn't part of mod_python, at least not yet. There are a
lot of hidden issues with making things global to multiple processes.

This page might be hlepful to get some idea of the level of complexity:

http://poshmodule.sourceforge.net/

Grisha
From mod_python at 24ksoftware.com  Tue Mar  9 14:31:29 2004
From: mod_python at 24ksoftware.com (Erik Stephens)
Date: Tue Mar  9 17:25:55 2004
Subject: [mod_python] persistent, reliable globals
In-Reply-To: <20040309203429.8381E3118BE@attrition.dynamine.net>
References: <20040309203429.8381E3118BE@attrition.dynamine.net>
Message-ID: <Pine.LNX.4.58.0403091427540.22165@localhost>

On Tue, 9 Mar 2004, Michael S. Fischer wrote:

> David Geller writes:
>
> > Suggestion:
> > Perhaps what would be handy: a special python function call,
> > implemented via the API, to allow setting/getting of objects
> > global to all the forked children for a particular named
> > interpreter. These objects might be accessible through the
> > req object, for example. I don't know enough to judge...
> >
> > Is this feaible? Useful (well, it would be to me...)? Easy/hard?
>
> Why don't you just use on-disk storage (e.g. anydbm) or a remote db for
> this?  Why reinvent the wheel?

Doesn't this limit you to using pickle-able objects only then?  There are
some important things that don't fall under this category (e.g. db
connections).


Best regards,
Erik

From michael at dynamine.net  Tue Mar  9 13:46:18 2004
From: michael at dynamine.net (Michael S. Fischer)
Date: Tue Mar  9 17:41:26 2004
Subject: [mod_python] persistent, reliable globals
In-Reply-To: <Pine.LNX.4.58.0403091427540.22165@localhost>
Message-ID: <20040309214621.4B6E83118BE@attrition.dynamine.net>

Erik Stephens writes:

> > > Perhaps what would be handy: a special python function call, 
> > > implemented via the API, to allow setting/getting of 
> objects global 
> > > to all the forked children for a particular named 
> interpreter. These 
> > > objects might be accessible through the req object, for 
> example. I 
> > > don't know enough to judge...
> > >
> > > Is this feaible? Useful (well, it would be to me...)? Easy/hard?
> >
> > Why don't you just use on-disk storage (e.g. anydbm) or a remote db 
> > for this?  Why reinvent the wheel?
> 
> Doesn't this limit you to using pickle-able objects only 
> then?  There are some important things that don't fall under 
> this category (e.g. db connections).

That's what middleware is for.  Again, why reinvent the wheel?

Best,

--Michael

From alain at onesite.org  Tue Mar  9 23:28:16 2004
From: alain at onesite.org (Alain Tesio)
Date: Tue Mar  9 18:23:18 2004
Subject: [mod_python] persistent, reliable globals
In-Reply-To: <20040309214621.4B6E83118BE@attrition.dynamine.net>
References: <Pine.LNX.4.58.0403091427540.22165@localhost>
	<20040309214621.4B6E83118BE@attrition.dynamine.net>
Message-ID: <20040309232816.4f791f47.alain@onesite.org>

On Tue, 9 Mar 2004 13:46:18 -0800
"Michael S. Fischer" <michael@dynamine.net> wrote:

> > > Why don't you just use on-disk storage (e.g. anydbm) or a remote db 
> > > for this?  Why reinvent the wheel?

It sounds quite silly to store data on disk to share objects which may not even
need to be stored at all, if the point is to have objects in memory and not
read/write/pickle/unpickle them all the time and managing locks too.

Maybe you can look at shared memory, there is a shm module for python,
the problem is that apache processes have their own address space, so you
need a fixed shared memory location with an mmaped file or a shm device,
I'm not sure it will be really faster because you still need to pickle objects.

I don't know a lot about zodb but it may help if it keeps data in cache as
real python objects.

A similar idea is using an object broker like Pyro hosting global objects,
you have local network overhead but no file and no pickling, it may be
really good depending of the type of calls you need (complex global
objects but simple method calls from each process)

The final solution is to have your own multithreaded server and apache
forwarding requests it with proxy directives (like roundup does)

Alain
From neel at mediapulse.com  Tue Mar  9 17:52:07 2004
From: neel at mediapulse.com (Michael C. Neel)
Date: Tue Mar  9 18:47:11 2004
Subject: [mod_python] persistent, reliable globals
Message-ID: <C0FC22C08B82074A88B500617641577787A868@johnson.mediapulse.net>

> > > > Perhaps what would be handy: a special python function call, 
> > > > implemented via the API, to allow setting/getting of 
> > objects global 
> > > > to all the forked children for a particular named 
> > interpreter. These 
> > > > objects might be accessible through the req object, for 
> > example. I 
> > > > don't know enough to judge...
> > > >
> > > > Is this feaible? Useful (well, it would be to me...)? Easy/hard?
> > >
> > > Why don't you just use on-disk storage (e.g. anydbm) or a 
> remote db 
> > > for this?  Why reinvent the wheel?
> > 
> > Doesn't this limit you to using pickle-able objects only 
> > then?  There are some important things that don't fall under 
> > this category (e.g. db connections).
> 
> That's what middleware is for.  Again, why reinvent the wheel?
> 
> Best,
> 

Not to beat the horse anymore, but it seems like most of these
db/globals issues could be handled with access to the Apache API
functions for child init and shutdown though mod_python.  One drawback
on not having access to these hooks is that as apache kills children who
hit max requests per child limit python cleans up the memory of that
system, but there is no chance to send a message to other servers that
may need to act as well, such as a db server to know to close a
connection.

Mike

From mod_python at 24ksoftware.com  Tue Mar  9 15:58:29 2004
From: mod_python at 24ksoftware.com (Erik Stephens)
Date: Tue Mar  9 18:52:57 2004
Subject: [mod_python] persistent, reliable globals
In-Reply-To: <20040309214621.4B6E83118BE@attrition.dynamine.net>
References: <20040309214621.4B6E83118BE@attrition.dynamine.net>
Message-ID: <Pine.LNX.4.58.0403091517440.22165@localhost>

On Tue, 9 Mar 2004, Michael S. Fischer wrote:

> Erik Stephens writes:
>
> > > Why don't you just use on-disk storage (e.g. anydbm) or a remote db
> > > for this?  Why reinvent the wheel?
> >
> > Doesn't this limit you to using pickle-able objects only
> > then?  There are some important things that don't fall under
> > this category (e.g. db connections).
>
> That's what middleware is for.  Again, why reinvent the wheel?

What middleware are you or others using for making SQL queries without
connecting to a db server for each query?  I've done some internet
research and haven't found anything that stands out as an obvious
choice for this particular problem.  I just want a hammer to pound
this one nail, not a whole toolbox.

On a more philosophical note, the idea of middleware *sounds* nice but
how much of a pain is it to maintain/work with?  Personally, I'm kinda
anti-technology these days, meaning the fewer pieces of technology
that I have to rely on to solve a problem, the better.  Maybe I'm
failing to grok what middleware means.  To me, its yet one more thing
that I don't have full control of that can trip me up.  I doubt it's a
popular opinion, but it's only that, an opinion.


Best regards,
Erik

From michael at dynamine.net  Tue Mar  9 15:33:07 2004
From: michael at dynamine.net (Michael S. Fischer)
Date: Tue Mar  9 19:28:47 2004
Subject: [mod_python] persistent, reliable globals
In-Reply-To: <20040309232816.4f791f47.alain@onesite.org>
Message-ID: <20040309233340.204123118BE@attrition.dynamine.net>

Alain Tesio writes:

> It sounds quite silly to store data on disk to share objects 
> which may not even need to be stored at all, if the point is 
> to have objects in memory and not read/write/pickle/unpickle 
> them all the time and managing locks too.

When you have a hammer (e.g. pickle), everything looks like a nail, I
suppose.

Don't underestimate the power and speed of the filesytem, particularly if
you're using a decent storage API like Berkeley DB.  Using disk storage
doesn't have all the drawbacks you might believe.  Most importantly, if
you're using a modern OS, your performance will be close enough to mmapped
I/O due to buffer caching.

Plus you get the benefit of persistence across machine reboots or server
crashes.

Besides, coding man-hours are expensive, while RAM and disk is cheap.

Lock concerns?  Use rename() (safest) or fcntl.flock()/lockf() (can handle
multiple readers, but not NFS-safe; if you're using NFS, you won't get
buffer cache benefits anyway, so I don't recommend it).

--Michael

From mogmios at mlug.missouri.edu  Tue Mar  9 15:47:58 2004
From: mogmios at mlug.missouri.edu (Michael)
Date: Tue Mar  9 19:43:02 2004
Subject: [mod_python] xml, xslt mod_python FAQ inclusion
In-Reply-To: <20040309175426.GA25735@golgatha.local>
References: <20040309175426.GA25735@golgatha.local>
Message-ID: <404E57AE.7000502@mlug.missouri.edu>

I am running mod_python as an xml-rpc server and it's working fine. I 
did have to switch to sgmlop because Expat just didn't work at all. 
xmlrpclib didn't work well at all with Expat. Maybe that'd help you with 
4Suite. Look back in the threads a while (about xml-rpc) and it was 
mentioned that you had to have exactly the right version of Expat for 
4Suite I think. (Look at March 5)

>Howdy all,
>	I am wondering if the FAQ could get an inclusion like
>	"Whats up with the 4suite tools and mod_python?"
>		Reply: Don't bother they don't work together.   Tell yourself 
>	again and again "CGI is fun" and try again without mod_python
>	or redesign your app entirely
>
>	That entry would have saved me about a day.  Because they
>don't and the issue outlined in
>http://mail.python.org/pipermail/xml-sig/2003-June/009606.html
>is apparently still unresolved.  Man I wished I'd never bothered...
>  
>

From ben at medianstrip.net  Tue Mar  9 22:16:42 2004
From: ben at medianstrip.net (Ben)
Date: Tue Mar  9 23:11:41 2004
Subject: [mod_python] persistent, reliable globals
In-Reply-To: <20040309203429.8381E3118BE@attrition.dynamine.net>
Message-ID: <20040309221441.P59806-100000@inman.medianstrip.net>

personally i'm using bsddb3 / sleepycat, which is available on
sourceforge.  it provides concurrent super-fast shared-memory disk
backed btree databases.  YMMV.

B

On Tue, 9 Mar 2004, Michael S. Fischer wrote:

> David Geller writes:
>
> > Suggestion:
> > Perhaps what would be handy: a special python function call,
> > implemented via the API, to allow setting/getting of objects
> > global to all the forked children for a particular named
> > interpreter. These objects might be accessible through the
> > req object, for example. I don't know enough to judge...
> >
> > Is this feaible? Useful (well, it would be to me...)? Easy/hard?
>
> Why don't you just use on-disk storage (e.g. anydbm) or a remote db for
> this?  Why reinvent the wheel?
>
> --Michael
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>

From ben at medianstrip.net  Tue Mar  9 22:22:56 2004
From: ben at medianstrip.net (Ben)
Date: Tue Mar  9 23:17:55 2004
Subject: [mod_python] persistent, reliable globals
In-Reply-To: <20040309233340.204123118BE@attrition.dynamine.net>
Message-ID: <20040309221839.T59806-100000@inman.medianstrip.net>

sleepycat / bsddb3 handles locking automatically.  after setting the
environment, you can use it like a dictionary and it works like magic.

by the way, i'm 99% done with my non-middleware framework that will
plug right into modpython, allow caching db connections, etc.  it
supports programmable caching, right now it can make dynamically
generated pages nearly as fast as plain apache!  i call it
non-middleware because it's super lightweight, and hopefully
unobtrusive.  i will release it as soon as i've sanity checked it all.

B

On Tue, 9 Mar 2004, Michael S. Fischer wrote:

> Alain Tesio writes:
>
> > It sounds quite silly to store data on disk to share objects
> > which may not even need to be stored at all, if the point is
> > to have objects in memory and not read/write/pickle/unpickle
> > them all the time and managing locks too.
>
> When you have a hammer (e.g. pickle), everything looks like a nail, I
> suppose.
>
> Don't underestimate the power and speed of the filesytem, particularly if
> you're using a decent storage API like Berkeley DB.  Using disk storage
> doesn't have all the drawbacks you might believe.  Most importantly, if
> you're using a modern OS, your performance will be close enough to mmapped
> I/O due to buffer caching.
>
> Plus you get the benefit of persistence across machine reboots or server
> crashes.
>
> Besides, coding man-hours are expensive, while RAM and disk is cheap.
>
> Lock concerns?  Use rename() (safest) or fcntl.flock()/lockf() (can handle
> multiple readers, but not NFS-safe; if you're using NFS, you won't get
> buffer cache benefits anyway, so I don't recommend it).
>
> --Michael
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>

From vincent_delft at yahoo.com  Wed Mar 10 03:16:31 2004
From: vincent_delft at yahoo.com (vincent delft)
Date: Wed Mar 10 07:11:31 2004
Subject: [mod_python] persistent, reliable globals
In-Reply-To: <20040309221839.T59806-100000@inman.medianstrip.net>
Message-ID: <20040310111631.41759.qmail@web11506.mail.yahoo.com>

Have you look at pyro (http://pyro.sf.net).

It's not a middleware, but will allow you to "play"
with Python object throught the newtork.

Pyro has caching mechanism.

As mention earlier, xml-rpc is a possibility too. no?

Those tool combine with mod_python is a powerfull
framework, no ?




--- Ben <ben@medianstrip.net> wrote:
> sleepycat / bsddb3 handles locking automatically. 
> after setting the
> environment, you can use it like a dictionary and it
> works like magic.
> 
> by the way, i'm 99% done with my non-middleware
> framework that will
> plug right into modpython, allow caching db
> connections, etc.  it
> supports programmable caching, right now it can make
> dynamically
> generated pages nearly as fast as plain apache!  i
> call it
> non-middleware because it's super lightweight, and
> hopefully
> unobtrusive.  i will release it as soon as i've
> sanity checked it all.
> 
> B
> 
> On Tue, 9 Mar 2004, Michael S. Fischer wrote:
> 
> > Alain Tesio writes:
> >
> > > It sounds quite silly to store data on disk to
> share objects
> > > which may not even need to be stored at all, if
> the point is
> > > to have objects in memory and not
> read/write/pickle/unpickle
> > > them all the time and managing locks too.
> >
> > When you have a hammer (e.g. pickle), everything
> looks like a nail, I
> > suppose.
> >
> > Don't underestimate the power and speed of the
> filesytem, particularly if
> > you're using a decent storage API like Berkeley
> DB.  Using disk storage
> > doesn't have all the drawbacks you might believe. 
> Most importantly, if
> > you're using a modern OS, your performance will be
> close enough to mmapped
> > I/O due to buffer caching.
> >
> > Plus you get the benefit of persistence across
> machine reboots or server
> > crashes.
> >
> > Besides, coding man-hours are expensive, while RAM
> and disk is cheap.
> >
> > Lock concerns?  Use rename() (safest) or
> fcntl.flock()/lockf() (can handle
> > multiple readers, but not NFS-safe; if you're
> using NFS, you won't get
> > buffer cache benefits anyway, so I don't recommend
> it).
> >
> > --Michael
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> >
>
http://mailman.modpython.org/mailman/listinfo/mod_python
> >
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
>
http://mailman.modpython.org/mailman/listinfo/mod_python


__________________________________
Do you Yahoo!?
Yahoo! Search - Find what youre looking for faster
http://search.yahoo.com
From leon.hayes at ultimate-uk.com  Wed Mar 10 16:23:19 2004
From: leon.hayes at ultimate-uk.com (Leon Hayes)
Date: Wed Mar 10 12:19:42 2004
Subject: [mod_python] Installation help on Win32
Message-ID: <001701c406bc$0207cb20$0500000a@leon>

Hi all.

I'm running XP Pro, Apache/2.0.48 (Win32) PHP/4.3.4 mod_python/3.0.1
Python/2.2.3

As you can see from above, I've managed to load mod_python.

My problem is this:

Whenever a try and visit a .py file via the browser, it writes out the
python code to the screen instead of parsing it through python.

I added this to the apache conf:

<Directory c:/apache2/htdocs>
AddHandler mod_python .py
PythonHandler mptest
PythonDebug On
</Directory>

And I use this line to load the module into apache:

LoadModule python_module modules/mod_python.so

Any help would be greatly appreciated.

Best Regards

Leon Hayes

---
Outgoing mail is certified Virus Free.
Checked by AVG anti-virus system (http://www.grisoft.com).
Version: 6.0.595 / Virus Database: 378 - Release Date: 25/02/2004
 

From fred at forsalebyowner.com  Wed Mar 10 11:53:00 2004
From: fred at forsalebyowner.com (Frederick Grim)
Date: Wed Mar 10 12:48:59 2004
Subject: [mod_python] Installation help on Win32
In-Reply-To: <001701c406bc$0207cb20$0500000a@leon>
References: <001701c406bc$0207cb20$0500000a@leon>
Message-ID: <20040310165300.GA3270@golgatha.local>

Leon Hayes at <leon.hayes@ultimate-uk.com> replied:
> Hi all.
> 
> I'm running XP Pro, Apache/2.0.48 (Win32) PHP/4.3.4 mod_python/3.0.1
> Python/2.2.3
> 
> As you can see from above, I've managed to load mod_python.
> 
> My problem is this:
> 
> Whenever a try and visit a .py file via the browser, it writes out the
> python code to the screen instead of parsing it through python.
>

one cheesy hack I did to stop this behavior was set the 
DefaultType directive in httpd.conf.  It's pretty cheesy though

	Fred


> I added this to the apache conf:
> 
> <Directory c:/apache2/htdocs>
> AddHandler mod_python .py
> PythonHandler mptest
> PythonDebug On
> </Directory>
> 
> And I use this line to load the module into apache:
> 
> LoadModule python_module modules/mod_python.so
> 
> Any help would be greatly appreciated.
> 
> Best Regards
> 
> Leon Hayes
> 
> ---
> Outgoing mail is certified Virus Free.
> Checked by AVG anti-virus system (http://www.grisoft.com).
> Version: 6.0.595 / Virus Database: 378 - Release Date: 25/02/2004
>  
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

-- 
"Windows Longhorn will be like having a little cop right inside your computer"
	-- Jorge Lopez, MCSE
From mod_python at 24ksoftware.com  Wed Mar 10 09:54:39 2004
From: mod_python at 24ksoftware.com (Erik Stephens)
Date: Wed Mar 10 12:49:05 2004
Subject: [mod_python] Installation help on Win32
In-Reply-To: <001701c406bc$0207cb20$0500000a@leon>
References: <001701c406bc$0207cb20$0500000a@leon>
Message-ID: <Pine.LNX.4.58.0403100942540.21590@ramuh.int.24ksoftware.com>

On Wed, 10 Mar 2004, Leon Hayes wrote:

> My problem is this:
>
> Whenever a try and visit a .py file via the browser, it writes out the
> python code to the screen instead of parsing it through python.
>
> I added this to the apache conf:
>
> <Directory c:/apache2/htdocs>
> AddHandler mod_python .py
> PythonHandler mptest
> PythonDebug On
> </Directory>

Do you have c:/apache2/htdocs/mptest.py defined?  Maybe you should be
using the publisher handler instead?  If not, what URL are you testing
and what is the contents of your mptest.py?  Also, should probably add
.pyc files also:

  <Directory c:/apache2/htdocs>
   AddHandler mod_python .py .pyc
   PythonHandler mod_python.publisher
   PythonDebug On
  </Directory>

More info about the publisher handler here:

  http://www.modpython.org/live/current/doc-html/hand-pub.html


Best regards,
Erik

From ben at medianstrip.net  Wed Mar 10 13:54:59 2004
From: ben at medianstrip.net (Ben)
Date: Wed Mar 10 14:50:03 2004
Subject: [mod_python] persistent, reliable globals
In-Reply-To: <20040310111631.41759.qmail@web11506.mail.yahoo.com>
Message-ID: <20040310125658.L69287-100000@inman.medianstrip.net>

a good point, vincent.

another more general question might be: given the proliferation of
application server frameworks, why another one?  the ironic thing is
that i decided to make this kit because i was not happy with how other
frameworks were "reinventing the wheel" (from my point of view.)

what do i mean by this?

1) no extra servers: running another server behind apache is not that
difficult, but it seems like a waste to not use apache itself as a
server.  e.g. use the apache process model (which will be more
thoroughly tested than any server i will write), http / ssl server,
request processing, configuration, logs, etc.

2) no toy languages: python is an excellent language.  use the
features of python (and not some funny interface to the features of
python) for your framework.  this means: use objects, modules and
packages, not a domain-specific component framekwork.  and, no
preprecessors / compilers: straight python.

an example: i'm often think "what is really going on" when i read big
configuraiton files.  i've decided to make my configuration files
actual python, so it should be clear!

3) be relatively feature-full.  this means: sessions, cookies,
authentication, caching.

1+2 = python programmers don't have to learn anything to get started.
i think grisha's publisher framework is a good example of this.

less important and unrelated concerns:

4) template / database neutrality.  personally i'm anti-template, but
i see their usefulness, but people have religious opinions / legacy
systems to worry about.

5) finally, i selfishly want to see mod_python everywhere, like
mod_perl, so i thought by making a great framework that was tightly
bound to mod_python would help.

ok, now my humble evaluation of some existing frameworks: i don't want
to start a flamewar, so let me start off by saying i really like a lot
of these, except where i say otherwise, and my opinions certainly
aren't set in stone if people want to convince me otherwise.

zope: well this one i'm not a fan of.  there are plenty of anti-zope
web pages out there, so i'll leave it at that.  skunkweb, webware, and
cherrypy are all really much better, imho.

i've used skunkweb for a commercial site.  its caching and performance
are reputable, and is generally pleasant to use.  my complaints: its
session handling and authentication is less-than-mature.  (i
contributed some code to this.)  stml is nice, but i'm not a fan of
the component framework, which makes pages in a piece-meal fashion,
not in an object-oriented way.  the request processing framework is a
little hard to understand, or at least not well documented (though
this might be changing soon.)  the configuration is powerful but a bit
overwhelming.  (there's a FAQ "my config file is so big!")  it doesn't
install out-of-the-box into freebsd (what i use).

cheerypy i've played with.  i like it a lot too.  however i'm not a
fan of the toy language.  i've stolen remi's idea of using aspects in
web programming (which admittedly is a very old idea), but without a
preprocessor.  the fact that it is a compiler makes it hard to grovel
the source: your code gets munged together with a bunch of other code
which is hard to figure out where it came from.  again it has a
component framework which, while closely mapping to python's, is in
the toy language.  (i can't get emacs to do intentation properly!)
but it certainly is lightweight and object-oriented, and relatively
well-documented.  i had a lot of fun writing some test pages, and even
contributed a bugfix (to the authentication code, again.)

webware i've only read about so probably shouldn't comment on.  but i
will say after working at a startup, i have a phobia of phrases like
3-tier, etc.  people seem to like webware though so maybe i should get
over my prejudices.  it's trying to be complete in a way that i'm not:
i think they want to replace zope (which is an admirable goal.)  i
don't want object-relational mappers built-in, i just want to control
how requests get processed and sent to you.  i do like using the java
servlet model though (which i've adopted: my kit is called "pylets"
for now.)

pyro is really cool.  certainly it is an interesting way to go.
however i'm interested in tight binding with apache: no separate
server process to manage, use the apache logs, and of course the
performance you get by being inside apache.

i'm a couple days from pre-alpha release, mostly documentation work.
probably these emails i'm writing may form the start of the docs.
sorry to flood you all with my ramblings.  i hope people will play
with it, once it's out.

take care, Ben

On Wed, 10 Mar 2004, vincent delft wrote:

> Have you look at pyro (http://pyro.sf.net).
>
> It's not a middleware, but will allow you to "play"
> with Python object throught the newtork.
>
> Pyro has caching mechanism.
>
> As mention earlier, xml-rpc is a possibility too. no?
>
> Those tool combine with mod_python is a powerfull
> framework, no ?

From neel at mediapulse.com  Wed Mar 10 15:07:03 2004
From: neel at mediapulse.com (Michael C. Neel)
Date: Wed Mar 10 16:02:09 2004
Subject: [mod_python] persistent, reliable globals
Message-ID: <C0FC22C08B82074A88B50061764157776B9B5D@johnson.mediapulse.net>

I believed you just summed up albatross/draco's take on "the wheel".  I
prefer Albatross, but you should look at both:

http://www.object-craft.com.au/projects/albatross/
http://draco.boskant.nl/

Mike

> -----Original Message-----
> From: Ben [mailto:ben@medianstrip.net] 
> Sent: Wednesday, March 10, 2004 1:55 PM
> To: vincent delft
> Cc: mod_python@modpython.org
> Subject: RE: [mod_python] persistent, reliable globals
> 
> 
> a good point, vincent.
> 
> another more general question might be: given the proliferation of
> application server frameworks, why another one?  the ironic thing is
> that i decided to make this kit because i was not happy with how other
> frameworks were "reinventing the wheel" (from my point of view.)
> 
> what do i mean by this?
> 
> 1) no extra servers: running another server behind apache is not that
> difficult, but it seems like a waste to not use apache itself as a
> server.  e.g. use the apache process model (which will be more
> thoroughly tested than any server i will write), http / ssl server,
> request processing, configuration, logs, etc.
> 
> 2) no toy languages: python is an excellent language.  use the
> features of python (and not some funny interface to the features of
> python) for your framework.  this means: use objects, modules and
> packages, not a domain-specific component framekwork.  and, no
> preprecessors / compilers: straight python.
> 
> an example: i'm often think "what is really going on" when i read big
> configuraiton files.  i've decided to make my configuration files
> actual python, so it should be clear!
> 
> 3) be relatively feature-full.  this means: sessions, cookies,
> authentication, caching.
> 
> 1+2 = python programmers don't have to learn anything to get started.
> i think grisha's publisher framework is a good example of this.
> 
> less important and unrelated concerns:
> 
> 4) template / database neutrality.  personally i'm anti-template, but
> i see their usefulness, but people have religious opinions / legacy
> systems to worry about.
> 
> 5) finally, i selfishly want to see mod_python everywhere, like
> mod_perl, so i thought by making a great framework that was tightly
> bound to mod_python would help.
> 
> ok, now my humble evaluation of some existing frameworks: i don't want
> to start a flamewar, so let me start off by saying i really like a lot
> of these, except where i say otherwise, and my opinions certainly
> aren't set in stone if people want to convince me otherwise.
> 
> zope: well this one i'm not a fan of.  there are plenty of anti-zope
> web pages out there, so i'll leave it at that.  skunkweb, webware, and
> cherrypy are all really much better, imho.
> 
> i've used skunkweb for a commercial site.  its caching and performance
> are reputable, and is generally pleasant to use.  my complaints: its
> session handling and authentication is less-than-mature.  (i
> contributed some code to this.)  stml is nice, but i'm not a fan of
> the component framework, which makes pages in a piece-meal fashion,
> not in an object-oriented way.  the request processing framework is a
> little hard to understand, or at least not well documented (though
> this might be changing soon.)  the configuration is powerful but a bit
> overwhelming.  (there's a FAQ "my config file is so big!")  it doesn't
> install out-of-the-box into freebsd (what i use).
> 
> cheerypy i've played with.  i like it a lot too.  however i'm not a
> fan of the toy language.  i've stolen remi's idea of using aspects in
> web programming (which admittedly is a very old idea), but without a
> preprocessor.  the fact that it is a compiler makes it hard to grovel
> the source: your code gets munged together with a bunch of other code
> which is hard to figure out where it came from.  again it has a
> component framework which, while closely mapping to python's, is in
> the toy language.  (i can't get emacs to do intentation properly!)
> but it certainly is lightweight and object-oriented, and relatively
> well-documented.  i had a lot of fun writing some test pages, and even
> contributed a bugfix (to the authentication code, again.)
> 
> webware i've only read about so probably shouldn't comment on.  but i
> will say after working at a startup, i have a phobia of phrases like
> 3-tier, etc.  people seem to like webware though so maybe i should get
> over my prejudices.  it's trying to be complete in a way that i'm not:
> i think they want to replace zope (which is an admirable goal.)  i
> don't want object-relational mappers built-in, i just want to control
> how requests get processed and sent to you.  i do like using the java
> servlet model though (which i've adopted: my kit is called "pylets"
> for now.)
> 
> pyro is really cool.  certainly it is an interesting way to go.
> however i'm interested in tight binding with apache: no separate
> server process to manage, use the apache logs, and of course the
> performance you get by being inside apache.
> 
> i'm a couple days from pre-alpha release, mostly documentation work.
> probably these emails i'm writing may form the start of the docs.
> sorry to flood you all with my ramblings.  i hope people will play
> with it, once it's out.
> 
> take care, Ben
> 
> On Wed, 10 Mar 2004, vincent delft wrote:
> 
> > Have you look at pyro (http://pyro.sf.net).
> >
> > It's not a middleware, but will allow you to "play"
> > with Python object throught the newtork.
> >
> > Pyro has caching mechanism.
> >
> > As mention earlier, xml-rpc is a possibility too. no?
> >
> > Those tool combine with mod_python is a powerfull
> > framework, no ?
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 

From ben at medianstrip.net  Wed Mar 10 17:46:12 2004
From: ben at medianstrip.net (Ben)
Date: Wed Mar 10 18:41:17 2004
Subject: Pylets (was RE: [mod_python] persistent, reliable globals)
In-Reply-To: <C0FC22C08B82074A88B50061764157776B9B5D@johnson.mediapulse.net>
Message-ID: <20040310165242.E72639-100000@inman.medianstrip.net>

thanks for the pointers.  i was vaguely aware of both, but i looked at
them again.

albatross is pretty cool, esp since you can run it in CGI (for those
who are living in draconian servers.)  it doesn't seem particularly
well-integrated with mod_python, tho.  e.g. it has a Session server.

draco looks very cool..  i remember reading about it and not choosing
for some reason.  probably i was temporarily insane.  ah yes i
remember why: it uses the MVC way of things, which is fine, but not my
cup of tea.  not really a big issue.

an unsubstantiated claim: object-per-url-matcher can simply implement
MVC, but not vice versa.

their notion of events and namespaces is pretty cool.  i've looked at
the code and there are some thread issues for their child inits, but
that's not really an issue.  i'd also rather be more tightly bound
with mod_python.  e.g. using 3.1.3 sessions, apache logs, etc.  (draco
does use a relational database for session management, which is a
little icky.)

pylets (as i'm now calling it, since the only other pylet i found on
google was something for Local Exchange Trading systems) also is more
focused on being high-performance current versions in "production
mode" can serve (cacheable) requests within 1.5x the time it takes
apache serving static pages.  "debug mode" is about 7-8x, which is
pretty fast.  these are microbenchmarks, so YMMV.

take care, B

On Wed, 10 Mar 2004, Michael C. Neel wrote:

> I believed you just summed up albatross/draco's take on "the wheel".  I
> prefer Albatross, but you should look at both:
>
> http://www.object-craft.com.au/projects/albatross/
> http://draco.boskant.nl/
>
> Mike

From ben at medianstrip.net  Wed Mar 10 17:47:55 2004
From: ben at medianstrip.net (Ben)
Date: Wed Mar 10 18:42:54 2004
Subject: [mod_python] server cleanup
Message-ID: <20040310174637.Q72639-100000@inman.medianstrip.net>

Grisha --

why can you only get a server object within the scope of a request?

and

why does server.register_cleanup() require a request object param?

thanks,

B

From neel at mediapulse.com  Wed Mar 10 18:38:05 2004
From: neel at mediapulse.com (Michael C. Neel)
Date: Wed Mar 10 19:33:17 2004
Subject: Pylets (was RE: [mod_python] persistent, reliable globals)
Message-ID: <C0FC22C08B82074A88B500617641577787A86E@johnson.mediapulse.net>

> albatross is pretty cool, esp since you can run it in CGI (for those
> who are living in draconian servers.)  it doesn't seem particularly
> well-integrated with mod_python, tho.  e.g. it has a Session server.
> 

Albatross has request interfaces for CGI, mod_python, fcgi (fast CGI?)
and it's own webserver that it comes with for development when you don't
have a server handy.  Every albatross app I've deployed has been
albatross, mod_python, and mysql on apache 1.3 or 2.0.  Albatross
handles the session and logic, but I use mod_python and a auth handler
for authencation.

Sessions are managed though hidden fields, session file on the server,
or a session server - you're free to choose which one you need.  Session
management is abstracted from view, you just simply pick the scheme you
want.  Like all of albatross (request interfaces, template tags, etc),
it's easily extendable and it's a matter of time before session
management ties in with mod python.  Two things I think holding that
back atm, one is session management is new, and therefore not a well
tested, as the other options and also it's only supported on apache 2.0,
so those living with draconian servers are out.  

Just recently I subclassed a request class to work as an apache filter,
so that I can use albatross when writing a filter.  This came in handy
"skinning" some cgi scripts with a new site template and not having to
redevelop them in python (I'm talking about ikonboard here).

I've also put together a set of tag extensions I use for running an SQL
statment in a template, called Axe at http://axe.pseudocode.net/

Mike

From grisha at modpython.org  Wed Mar 10 20:10:32 2004
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Wed Mar 10 21:05:39 2004
Subject: [mod_python] server cleanup
In-Reply-To: <20040310174637.Q72639-100000@inman.medianstrip.net>
References: <20040310174637.Q72639-100000@inman.medianstrip.net>
Message-ID: <20040310200842.Q48840@onyx.ispol.com>


On Wed, 10 Mar 2004, Ben wrote:

> Grisha --
>
> why can you only get a server object within the scope of a request?

Yes.

> why does server.register_cleanup() require a request object param?

This is because the server object itself has no reference to a request,
but a request is required for logging AFAIR.

Grisha
From ben at medianstrip.net  Wed Mar 10 20:49:02 2004
From: ben at medianstrip.net (Ben)
Date: Wed Mar 10 21:44:02 2004
Subject: [mod_python] server cleanup
In-Reply-To: <20040310200842.Q48840@onyx.ispol.com>
Message-ID: <20040310201521.F76332-100000@inman.medianstrip.net>

er, i was asking WHY you can't get a server object w/out a request.

re: why does server.register_cleanup() need a request oject: there is
apache.log_error, which doesn't refer to a request.  why can't it use
this?

these would be really helpful for me to have.  should i look into
adding them to mod_python, or is there an implementation quirk that
makes it impossible?

take care, B

On Wed, 10 Mar 2004, Gregory (Grisha) Trubetskoy wrote:

>
> On Wed, 10 Mar 2004, Ben wrote:
>
> > Grisha --
> >
> > why can you only get a server object within the scope of a request?
>
> Yes.
>
> > why does server.register_cleanup() require a request object param?
>
> This is because the server object itself has no reference to a request,
> but a request is required for logging AFAIR.
>
> Grisha
>

From gnb at itga.com.au  Thu Mar 11 13:05:51 2004
From: gnb at itga.com.au (Gregory Bond)
Date: Wed Mar 10 22:00:55 2004
Subject: [mod_python] Undocumented (?) change in PythonPath for 3.0 vs 2.7
Message-ID: <200403110205.NAA22716@lightning.itga.com.au>

In mod_python 2.7, I could do this:

  <Directory /mywebdir>
    AddHandler python-program .py
    PythonDebug On
    PythonPath "['/mywebdir'] + sys.path"
    <Files "prog1.py"
      PythonHandler prog1
    </Files>
    <Files "prog2.py"
      PythonHandler prog2
    </Files>
  </Directory>

but under 3.0 this doesn't work - the PythonPath directive seems to not be 
noticed, as accessing "/prog1.py" returns an ImportError.

But if I do this under 3.0:

  <Directory /mywebdir>
    AddHandler python-program .py
    PythonDebug On
    <Files *.py>
      PythonPath "['/mywebdir'] + sys.path"
    </Files>
    <Files "prog1.py"
      PythonHandler prog1
    </Files>
    <Files "prog2.py"
      PythonHandler prog2
    </Files>
  </Directory>

(i.e. put the PythonPath inside a <Files *.py>) this works.

Wierd!

I've not yet tried with 3.1.3 - hopefully next week.

(FAQ 3.4 updated.)


From gnb at itga.com.au  Thu Mar 11 13:10:07 2004
From: gnb at itga.com.au (Gregory Bond)
Date: Wed Mar 10 22:05:16 2004
Subject: [mod_python] server cleanup 
In-Reply-To: Your message of Wed, 10 Mar 2004 20:49:02 -0500.
Message-ID: <200403110210.NAA23032@lightning.itga.com.au>

(IIUC from last time this was asked...)

because apache lazy-evaluates the config info and only builds server objects
when a request for that (possibly virtual) server arrives.


From grisha at modpython.org  Wed Mar 10 23:41:46 2004
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Thu Mar 11 00:36:52 2004
Subject: [mod_python] server cleanup
In-Reply-To: <20040310201521.F76332-100000@inman.medianstrip.net>
References: <20040310201521.F76332-100000@inman.medianstrip.net>
Message-ID: <20040310233914.C48840@onyx.ispol.com>


i just looked at the code, and it looks like it needs it to extract the
information about the name of the subinterpreter under which the cleanup
should execute. so i suppose another way could be for the
server.register_cleanup to require the interpreter name rather than
request, but requiring the request (which you must have available, becuase
the only way to get to the server is via request) is easier.

On Wed, 10 Mar 2004, Ben wrote:

> er, i was asking WHY you can't get a server object w/out a request.
>
> re: why does server.register_cleanup() need a request oject: there is
> apache.log_error, which doesn't refer to a request.  why can't it use
> this?
>
> these would be really helpful for me to have.  should i look into
> adding them to mod_python, or is there an implementation quirk that
> makes it impossible?
>
> take care, B
>
> On Wed, 10 Mar 2004, Gregory (Grisha) Trubetskoy wrote:
>
> >
> > On Wed, 10 Mar 2004, Ben wrote:
> >
> > > Grisha --
> > >
> > > why can you only get a server object within the scope of a request?
> >
> > Yes.
> >
> > > why does server.register_cleanup() require a request object param?
> >
> > This is because the server object itself has no reference to a request,
> > but a request is required for logging AFAIR.
> >
> > Grisha
> >
>
From dannoritzer at web.de  Thu Mar 11 06:45:27 2004
From: dannoritzer at web.de (dannoritzer@web.de)
Date: Thu Mar 11 01:40:44 2004
Subject: Pylets (was RE: [mod_python] persistent, reliable globals)
In-Reply-To: <20040310165242.E72639-100000@inman.medianstrip.net>
References: <20040310165242.E72639-100000@inman.medianstrip.net>
Message-ID: <404FFCF7.6060708@web.de>

Ben,

I am a newbie in web development and just looking into draco. I would be 
interested in some more details about your opinion about draco, before 
going deeper into it.

What is "the MVC way of things"? Is it the Model View Controller design 
pattern? What do you not like about it?

Concerning the relational database for session management, what is so 
icky about that ?

Thanks for your thoughts.

Guenter




Ben wrote:

> thanks for the pointers.  i was vaguely aware of both, but i looked at
> them again.
> 
> albatross is pretty cool, esp since you can run it in CGI (for those
> who are living in draconian servers.)  it doesn't seem particularly
> well-integrated with mod_python, tho.  e.g. it has a Session server.
> 
> draco looks very cool..  i remember reading about it and not choosing
> for some reason.  probably i was temporarily insane.  ah yes i
> remember why: it uses the MVC way of things, which is fine, but not my
> cup of tea.  not really a big issue.
> 
> an unsubstantiated claim: object-per-url-matcher can simply implement
> MVC, but not vice versa.
> 
> their notion of events and namespaces is pretty cool.  i've looked at
> the code and there are some thread issues for their child inits, but
> that's not really an issue.  i'd also rather be more tightly bound
> with mod_python.  e.g. using 3.1.3 sessions, apache logs, etc.  (draco
> does use a relational database for session management, which is a
> little icky.)
> 
> pylets (as i'm now calling it, since the only other pylet i found on
> google was something for Local Exchange Trading systems) also is more
> focused on being high-performance current versions in "production
> mode" can serve (cacheable) requests within 1.5x the time it takes
> apache serving static pages.  "debug mode" is about 7-8x, which is
> pretty fast.  these are microbenchmarks, so YMMV.
> 
> take care, B
> 
> On Wed, 10 Mar 2004, Michael C. Neel wrote:
> 
> 
>>I believed you just summed up albatross/draco's take on "the wheel".  I
>>prefer Albatross, but you should look at both:
>>
>>http://www.object-craft.com.au/projects/albatross/
>>http://draco.boskant.nl/
>>
>>Mike
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 
From ben at medianstrip.net  Thu Mar 11 02:20:51 2004
From: ben at medianstrip.net (Ben)
Date: Thu Mar 11 03:15:51 2004
Subject: Pylets (was RE: [mod_python] persistent, reliable globals)
In-Reply-To: <404FFCF7.6060708@web.de>
Message-ID: <20040311021636.V79699-100000@inman.medianstrip.net>

i think draco is great.  you should definitely use it.

you're of course welcome to beta / alpha test whatever i come up with.
however i expect it won't be as mature as draco for some time.

MVC = model view controller, yes.  i think it's a good paradigm.  i
just prefer to not have it built into the system.

sessions are short-lived data that needs to be accessed frequently.
this it not what relational databases are for.  a dbm-style database
is a better choice.  but there's no real difference unless you're
trying to squeeze out a lot of performance.

hope this answers your questions.  i'm sure the experts who read this
list might have more educated responses.

B

On Thu, 11 Mar 2004 dannoritzer@web.de wrote:

> Ben,
>
> I am a newbie in web development and just looking into draco. I would be
> interested in some more details about your opinion about draco, before
> going deeper into it.
>
> What is "the MVC way of things"? Is it the Model View Controller design
> pattern? What do you not like about it?
>
> Concerning the relational database for session management, what is so
> icky about that ?
>
> Thanks for your thoughts.
>
> Guenter

From ben at medianstrip.net  Thu Mar 11 02:33:06 2004
From: ben at medianstrip.net (Ben)
Date: Thu Mar 11 03:28:05 2004
Subject: [mod_python] server cleanup 
In-Reply-To: <200403110210.NAA23032@lightning.itga.com.au>
Message-ID: <20040311022628.G79699-100000@inman.medianstrip.net>

ah, interesting.  something for a the FAQ i guess.  hope you don't
mind me quoting you there.

B

On Thu, 11 Mar 2004, Gregory Bond wrote:

> (IIUC from last time this was asked...)
>
> because apache lazy-evaluates the config info and only builds server objects
> when a request for that (possibly virtual) server arrives.
>
>

From vincent_delft at yahoo.com  Thu Mar 11 00:58:53 2004
From: vincent_delft at yahoo.com (vincent delft)
Date: Thu Mar 11 04:54:08 2004
Subject: Pylets (was RE: [mod_python] persistent, reliable globals)
In-Reply-To: <20040311021636.V79699-100000@inman.medianstrip.net>
Message-ID: <20040311085853.86879.qmail@web11506.mail.yahoo.com>

Draco is really nice but I find that his memory foot
print is quite big.
On the other hand I don't see it for heavy loaded web
site (my personnal view)

In the same area Karrigell
(http://karrigell.sourceforge.net )is also nice.

But I personnally don't think they are ready to be
used for real production web site.




--- Ben <ben@medianstrip.net> wrote:
> i think draco is great.  you should definitely use
> it.
> 
> you're of course welcome to beta / alpha test
> whatever i come up with.
> however i expect it won't be as mature as draco for
> some time.
> 
> MVC = model view controller, yes.  i think it's a
> good paradigm.  i
> just prefer to not have it built into the system.
> 
> sessions are short-lived data that needs to be
> accessed frequently.
> this it not what relational databases are for.  a
> dbm-style database
> is a better choice.  but there's no real difference
> unless you're
> trying to squeeze out a lot of performance.
> 
> hope this answers your questions.  i'm sure the
> experts who read this
> list might have more educated responses.
> 
> B
> 
> On Thu, 11 Mar 2004 dannoritzer@web.de wrote:
> 
> > Ben,
> >
> > I am a newbie in web development and just looking
> into draco. I would be
> > interested in some more details about your opinion
> about draco, before
> > going deeper into it.
> >
> > What is "the MVC way of things"? Is it the Model
> View Controller design
> > pattern? What do you not like about it?
> >
> > Concerning the relational database for session
> management, what is so
> > icky about that ?
> >
> > Thanks for your thoughts.
> >
> > Guenter
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
>
http://mailman.modpython.org/mailman/listinfo/mod_python


__________________________________
Do you Yahoo!?
Yahoo! Search - Find what youre looking for faster
http://search.yahoo.com
From neel at mediapulse.com  Thu Mar 11 10:27:57 2004
From: neel at mediapulse.com (Michael C. Neel)
Date: Thu Mar 11 11:23:03 2004
Subject: [mod_python] server cleanup 
Message-ID: <C0FC22C08B82074A88B500617641577787A870@johnson.mediapulse.net>

Actually, everything is correct here, server.register_cleanup is
intended to take a request object.

There are two cleanups you can use in Apache (I don't know if mod_pytohn
does them both, going off of Apache API here).  One is the request
cleanup, the other server cleanup.

Request cleanup is run as the very last phase of the request, after the
logging phase and after the client connection is closed.  Anything that
you need to custom delete from a request can be done here, but sometimes
you want to keep something arounf for another request - an example is
the log file it self, you don't want to open and close this file each
request, but rather open it the first request and keep it open for all
requests following.

This is where server cleanup comes it.  It is registered from a request,
but doesn't execute until the server is shutdown.  This means the parent
apache process is killed, not the children.  So in code you would see if
the log file was open, if not open it and register a server cleanup to
close it.  If it was open, just get the file handle.

The advantage of this method over serverinit/servershutdown and
childinit/childshutdown (not currently supported in mod_python, but in
the Apache API) is that setup can be done at request time, per directoy
and/or query args, for very unique requirments.

It's very dated now, but the Orilley book "Apache Modules in C and Perl"
is probably the best thing out there for understanding the Apache API.
It's not hard to read that and then take it to mod_python.  Maybe the
next edition will be "Apache Modules in C, Perl and Python"? =)

Mike


> -----Original Message-----
> From: Ben [mailto:ben@medianstrip.net] 
> Subject: Re: [mod_python] server cleanup 
> 
> 
> ah, interesting.  something for a the FAQ i guess.  hope you don't
> mind me quoting you there.
> 
> B
> 
> On Thu, 11 Mar 2004, Gregory Bond wrote:
> 
> > (IIUC from last time this was asked...)
> >
> > because apache lazy-evaluates the config info and only 
> builds server objects
> > when a request for that (possibly virtual) server arrives.
> >
> >

From neel at mediapulse.com  Thu Mar 11 10:35:11 2004
From: neel at mediapulse.com (Michael C. Neel)
Date: Thu Mar 11 11:30:27 2004
Subject: Pylets (was RE: [mod_python] persistent, reliable globals)
Message-ID: <C0FC22C08B82074A88B500617641577787A871@johnson.mediapulse.net>

> Ben,
> 
> I am a newbie in web development and just looking into draco. 
> I would be 
> interested in some more details about your opinion about 
> draco, before 
> going deeper into it.

When starting out I went with Albatross vs Draco because of the template
syntax, Albatross uses XML tags and I liked the look better.  Honestly,
that's what made my choice, lol.

 
> What is "the MVC way of things"? Is it the Model View 
> Controller design 
> pattern? What do you not like about it?

I've not heard the term MVC, but if it's what I've called "Document View
Achitecture", then I agree it's a good thing but shouldn't be forced by
the system, but encouraged.  I hope my Microsoft roots aren't too
obvious by the term...


> Concerning the relational database for session management, what is so 
> icky about that ?
> 

As ben said, sessions are usually short lived, and putting them into the
database is really overkill.  They are also such a common need by all
that whatever system you go with, should support sessions out of the
gate, so the need to place them in a database is even less because there
is already a solution provided.

Mike

From davidf at sjsoft.com  Thu Mar 11 17:37:23 2004
From: davidf at sjsoft.com (David Fraser)
Date: Thu Mar 11 11:32:10 2004
Subject: [mod_python] Win32 platform - req.sendfile
In-Reply-To: <40489A2E.5060406@sjsoft.com>
References: 
	<1924BF350FC96B46A56BB38087B9B86E952708@srvcorreio.primavera.local>
	<40475D04.2090807@sjsoft.com> <20040304115447.R32625@onyx.ispol.com>
	<404849BE.5010609@sjsoft.com> <40489A2E.5060406@sjsoft.com>
Message-ID: <405087B3.8050407@sjsoft.com>

David Fraser wrote:

> David Fraser wrote:
>
>>
>> * Testing req.sendfile()
>> F
>> [Fri Mar 05 11:27:38 2004] [error] [client 127.0.0.1] PythonHandler 
>> tests::req_sendfile: Traceback (most recent call last):
>> [Fri Mar 05 11:27:38 2004] [error] [client 127.0.0.1] PythonHandler 
>> tests::req_sendfile: File "\PURELIB\mod_python\apache.py", line 299, 
>> in HandlerDispatch
>> [Fri Mar 05 11:27:38 2004] [error] [client 127.0.0.1] PythonHandler 
>> tests::req_sendfile: File 
>> "C:/Apache/mod_python-3.1.3/test\htdocs\tests.py", line 680, in 
>> req_sendfile
>> os.remove(fname)
>
>
> Hmmm ... it seems that req.sendfile opens the file using apr_file_open 
> and then uses ap_send_fd to send it. Does this close the file 
> correctly? Doesn't seem like it from the Apache source...
> I suspect that's why the os.remove fails...
>
OK, It seems I was wrong about this. Adding a apr_file_close doesn't 
make a difference.
I wonder if Windows is taking a while to close the file...
Anybody else tried this on Windows?

David
From davidf at sjsoft.com  Thu Mar 11 17:40:01 2004
From: davidf at sjsoft.com (David Fraser)
Date: Thu Mar 11 11:34:41 2004
Subject: [mod_python] Re: New mod_python win32 installer for testing
In-Reply-To: <4048A900.8080201@sjsoft.com>
References: <4048A900.8080201@sjsoft.com>
Message-ID: <40508851.7000703@sjsoft.com>

I have made an updated installer using these scripts.
It can be downloaded from 
http://davidf.sjsoft.com/files/mod_python-3.1.3.win32-py2.3.exe
I would appreciate feedback from anybody using Windows...

David

David Fraser wrote:

> Hi
>
> I've been working on the mod_python dist/setup.py.in (mostly to make 
> it work for win32) and have added some important functionality...
>
> 1) it no longer requires configure (so it could just be setup.py) - it 
> either scans config.status or calculates the information itself (e.g. 
> it scans through the source file to find the mod_python version 
> number). On Windows it uses the APACHESRC environment variables to 
> find the apache include and lib directories (just like the VC++ 
> project does)
> 2) it is now able to build mod_psp on Windows as well as Linux
> 3) most importantly, it is now able to build mod_python directly from 
> the setup.py (on Windows)
>    this should be possible on non-Windows system too but will require 
> some work (we may have to make a distutils compiler class for apxs)
>
> There are a few notes:
> - the build of the mod_python extension produces a mod_python_so.pyd 
> file, instead of the mod_python.so file we want. But at least on 
> Windows, I have modified win32_postinstall to install this one instead 
> of the other... (I call it mod_python_so.pyd instead of mod_python.pyd 
> so that when it is put in the site-packages directory it does not 
> confuse importing packages from mod_python)
> - I have also added code to win32_postinstall to automatically detect 
> the currently installed versions of Apache from the registry. It would 
> be nice to let the user choose one of these. As a start, it just 
> selects the latest version as the starting point for the tkinter file 
> selection dialog (the win32 shell classes don't seem to let you do 
> this...)
>
> I have attached the modified setup.py.in (easier than a patch as 
> almost everything has changed) and win32_postinstall.py
>
> Any comments appreciated
>
> David 


From ben at medianstrip.net  Thu Mar 11 11:48:51 2004
From: ben at medianstrip.net (Ben)
Date: Thu Mar 11 12:43:51 2004
Subject: [mod_python] Error:Failed to reinit global mutex
Message-ID: <20040311113637.Q85400-100000@inman.medianstrip.net>

this might be more of an OS or Apache question but....

i'm debugging something right now which seems to crash apache /
mod_python.  probably something i'm doing, i'm sure.  anyhow, it
wouldn't be much of a problem except that when it crashes, i can't
restart the server without rebooting.  i get errors like:

[Thu Mar 11 10:08:51 2004] [notice] mod_python: Creating 32 session mutexes based on 50 max processes and 0 max threads.
(24)Too many open files: mod_python: Failed to reinit global mutex /tmp/mpmtx84815.
'import site' failed; use -v for traceback
[Thu Mar 11 10:08:52 2004] [error] make_obcallback: could not import mod_python.apache.

ImportError: No module named mod_python.apache
[Thu Mar 11 10:10:38 2004] [error] (24)Too many open files: apr_accept: (client socket)

i've cleaned up /tmp/mpm*, /var/run/httpd.scoreboard, etc.  i've also
verified that in fact

kern.openfiles: 68
kern.maxfiles: 12328

and raised the openfiles limit on the www process, and checked lsof
which says there isn't much open.  so it looks like some kind of
shared memory / locking thing, except that ipcs tells me not much: i
guess it's not a sysv ipc thing.

does anyone know how to clean house for this kind of stuff?

B

From grisha at modpython.org  Thu Mar 11 12:27:58 2004
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Thu Mar 11 13:23:05 2004
Subject: [mod_python] Error:Failed to reinit global mutex
In-Reply-To: <20040311113637.Q85400-100000@inman.medianstrip.net>
References: <20040311113637.Q85400-100000@inman.medianstrip.net>
Message-ID: <20040311121924.F48840@onyx.ispol.com>


I think this is because on startup Python can open a boatload of files
while importing modules. I'd just up kern.maxfiles and
kern.maxfilesperproc, especially if your apache is configured to start a
lot of children upfront.

Just FYI, my settings are:

kern.maxfiles: 32808
kern.maxfilesperproc: 29527

and I don't think there is much harm in taking it much higher for a heavy
load production system.

Grisha

On Thu, 11 Mar 2004, Ben wrote:

> this might be more of an OS or Apache question but....
>
> i'm debugging something right now which seems to crash apache /
> mod_python.  probably something i'm doing, i'm sure.  anyhow, it
> wouldn't be much of a problem except that when it crashes, i can't
> restart the server without rebooting.  i get errors like:
>
> [Thu Mar 11 10:08:51 2004] [notice] mod_python: Creating 32 session mutexes based on 50 max processes and 0 max threads.
> (24)Too many open files: mod_python: Failed to reinit global mutex /tmp/mpmtx84815.
> 'import site' failed; use -v for traceback
> [Thu Mar 11 10:08:52 2004] [error] make_obcallback: could not import mod_python.apache.
>
> ImportError: No module named mod_python.apache
> [Thu Mar 11 10:10:38 2004] [error] (24)Too many open files: apr_accept: (client socket)
>
> i've cleaned up /tmp/mpm*, /var/run/httpd.scoreboard, etc.  i've also
> verified that in fact
>
> kern.openfiles: 68
> kern.maxfiles: 12328
>
> and raised the openfiles limit on the www process, and checked lsof
> which says there isn't much open.  so it looks like some kind of
> shared memory / locking thing, except that ipcs tells me not much: i
> guess it's not a sysv ipc thing.
>
> does anyone know how to clean house for this kind of stuff?
>
> B
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From vmanera at manord.com  Thu Mar 11 18:41:43 2004
From: vmanera at manord.com (Manera, Villiam)
Date: Thu Mar 11 13:42:01 2004
Subject: R: [mod_python] Re: New mod_python win32 installer for testing
Message-ID: <52DC70C1C1575C418CB033523A29CF1401A7678D@exchange2000.manord.com>

I have just install it and all seems work fine

the mod_python.so of 3.1.0a was 112 kb
and the new on only 80kb

Grazie 1000
Villiam
-----Messaggio originale-----
Da: mod_python-bounces@modpython.org
[mailto:mod_python-bounces@modpython.org]Per conto di David Fraser
Inviato: gioved? 11 marzo 2004 16.40
A: Gregory (Grisha) Trubetskoy
Cc: python-dev@httpd.apache.org; ModPython mail list
Oggetto: [mod_python] Re: New mod_python win32 installer for testing


I have made an updated installer using these scripts.
It can be downloaded from 
http://davidf.sjsoft.com/files/mod_python-3.1.3.win32-py2.3.exe
I would appreciate feedback from anybody using Windows...

David

David Fraser wrote:

> Hi
>
> I've been working on the mod_python dist/setup.py.in (mostly to make 
> it work for win32) and have added some important functionality...
>
> 1) it no longer requires configure (so it could just be setup.py) - it 
> either scans config.status or calculates the information itself (e.g. 
> it scans through the source file to find the mod_python version 
> number). On Windows it uses the APACHESRC environment variables to 
> find the apache include and lib directories (just like the VC++ 
> project does)
> 2) it is now able to build mod_psp on Windows as well as Linux
> 3) most importantly, it is now able to build mod_python directly from 
> the setup.py (on Windows)
>    this should be possible on non-Windows system too but will require 
> some work (we may have to make a distutils compiler class for apxs)
>
> There are a few notes:
> - the build of the mod_python extension produces a mod_python_so.pyd 
> file, instead of the mod_python.so file we want. But at least on 
> Windows, I have modified win32_postinstall to install this one instead 
> of the other... (I call it mod_python_so.pyd instead of mod_python.pyd 
> so that when it is put in the site-packages directory it does not 
> confuse importing packages from mod_python)
> - I have also added code to win32_postinstall to automatically detect 
> the currently installed versions of Apache from the registry. It would 
> be nice to let the user choose one of these. As a start, it just 
> selects the latest version as the starting point for the tkinter file 
> selection dialog (the win32 shell classes don't seem to let you do 
> this...)
>
> I have attached the modified setup.py.in (easier than a patch as 
> almost everything has changed) and win32_postinstall.py
>
> Any comments appreciated
>
> David 


_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://mailman.modpython.org/mailman/listinfo/mod_python

From davidf at sjsoft.com  Thu Mar 11 23:54:27 2004
From: davidf at sjsoft.com (David Fraser)
Date: Thu Mar 11 17:49:10 2004
Subject: R: [mod_python] Re: New mod_python win32 installer for testing
In-Reply-To: <52DC70C1C1575C418CB033523A29CF1401A7678D@exchange2000.manord.com>
References: <52DC70C1C1575C418CB033523A29CF1401A7678D@exchange2000.manord.com>
Message-ID: <4050E013.6070301@sjsoft.com>

Manera, Villiam wrote:

>I have just install it and all seems work fine
>  
>
Great, thanks for the feedback ...

>the mod_python.so of 3.1.0a was 112 kb
>and the new on only 80kb
>  
>
Yes, this seemed to change when I moved from compiling with the VC++ 
project file to compiling out of the Python distutils (which uses the 
VC++ command line but will include different stuff...) and that's why I 
am eager to hear if it works just as well...

>Grazie 1000
>Villiam
>  
>
My pleasure :-)
David

>-----Messaggio originale-----
>Da: mod_python-bounces@modpython.org
>[mailto:mod_python-bounces@modpython.org]Per conto di David Fraser
>Inviato: gioved? 11 marzo 2004 16.40
>A: Gregory (Grisha) Trubetskoy
>Cc: python-dev@httpd.apache.org; ModPython mail list
>Oggetto: [mod_python] Re: New mod_python win32 installer for testing
>
>
>I have made an updated installer using these scripts.
>It can be downloaded from 
>http://davidf.sjsoft.com/files/mod_python-3.1.3.win32-py2.3.exe
>I would appreciate feedback from anybody using Windows...
>
>David
>
>David Fraser wrote:
>
>  
>
>>Hi
>>
>>I've been working on the mod_python dist/setup.py.in (mostly to make 
>>it work for win32) and have added some important functionality...
>>
>>1) it no longer requires configure (so it could just be setup.py) - it 
>>either scans config.status or calculates the information itself (e.g. 
>>it scans through the source file to find the mod_python version 
>>number). On Windows it uses the APACHESRC environment variables to 
>>find the apache include and lib directories (just like the VC++ 
>>project does)
>>2) it is now able to build mod_psp on Windows as well as Linux
>>3) most importantly, it is now able to build mod_python directly from 
>>the setup.py (on Windows)
>>   this should be possible on non-Windows system too but will require 
>>some work (we may have to make a distutils compiler class for apxs)
>>
>>There are a few notes:
>>- the build of the mod_python extension produces a mod_python_so.pyd 
>>file, instead of the mod_python.so file we want. But at least on 
>>Windows, I have modified win32_postinstall to install this one instead 
>>of the other... (I call it mod_python_so.pyd instead of mod_python.pyd 
>>so that when it is put in the site-packages directory it does not 
>>confuse importing packages from mod_python)
>>- I have also added code to win32_postinstall to automatically detect 
>>the currently installed versions of Apache from the registry. It would 
>>be nice to let the user choose one of these. As a start, it just 
>>selects the latest version as the starting point for the tkinter file 
>>selection dialog (the win32 shell classes don't seem to let you do 
>>this...)
>>
>>I have attached the modified setup.py.in (easier than a patch as 
>>almost everything has changed) and win32_postinstall.py
>>
>>Any comments appreciated
>>
>>David 
>>    
>>
>
>
>_______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org
>http://mailman.modpython.org/mailman/listinfo/mod_python
>
>  
>

From eric at ericwalstad.com  Thu Mar 11 14:56:12 2004
From: eric at ericwalstad.com (Eric Walstad)
Date: Thu Mar 11 18:51:17 2004
Subject: [mod_python] req.form keep_blank_values with mod_python.publisher 
Message-ID: <200403111456.12202.eric@ericwalstad.com>

Hi All,

I'd like to use the mod_python.publisher when working with form posts.  
I'm using req.form to access the form data.  Not all the form data is 
getting passed back in the req.form object.  I suspect it's because the 
auto-created util.FieldStorage object (req.form) is created without 
setting the keep_blank_values parameter to a true value.

My two questions are:
Is this the reason I'm not getting all my form values?
If so, is there a way to turn on keep_blank_values in the default 
req.form object without having to modify mod_python source code?

I'm working on Debian/Python2.3/Apache1.3/mod_python2.7.10.  This is my 
first mod_python project.

Many thanks in advance!

Eric.
-- 
Eric Walstad
http://ericwalstad.com/

From ben at medianstrip.net  Thu Mar 11 19:45:50 2004
From: ben at medianstrip.net (Ben)
Date: Thu Mar 11 20:40:50 2004
Subject: [mod_python] Error:Failed to reinit global mutex
In-Reply-To: <20040311121924.F48840@onyx.ispol.com>
Message-ID: <20040311194241.E91500-100000@inman.medianstrip.net>

well, yes, i have upped my maxfiles / maxfiles per proc etc and it
still doesn't run.

again, the really weird thing is that mod_python / apache starts at
first, but after i make it crash, it won't start again!  i don't
understand what is changing between runs of apache, since i'm cleaning
out all temp files, looking for open files / sysv ipc stuff.....

any unix hackers out there have any ideas?  this will be my last post
since it's off-topic, sorry.

take care, B

On Thu, 11 Mar 2004, Gregory (Grisha) Trubetskoy wrote:

>
> I think this is because on startup Python can open a boatload of files
> while importing modules. I'd just up kern.maxfiles and
> kern.maxfilesperproc, especially if your apache is configured to start a
> lot of children upfront.
>
> Just FYI, my settings are:
>
> kern.maxfiles: 32808
> kern.maxfilesperproc: 29527
>
> and I don't think there is much harm in taking it much higher for a heavy
> load production system.
>
> Grisha
>
> On Thu, 11 Mar 2004, Ben wrote:
>
> > this might be more of an OS or Apache question but....
> >
> > i'm debugging something right now which seems to crash apache /
> > mod_python.  probably something i'm doing, i'm sure.  anyhow, it
> > wouldn't be much of a problem except that when it crashes, i can't
> > restart the server without rebooting.  i get errors like:
> >
> > [Thu Mar 11 10:08:51 2004] [notice] mod_python: Creating 32 session mutexes based on 50 max processes and 0 max threads.
> > (24)Too many open files: mod_python: Failed to reinit global mutex /tmp/mpmtx84815.
> > 'import site' failed; use -v for traceback
> > [Thu Mar 11 10:08:52 2004] [error] make_obcallback: could not import mod_python.apache.
> >
> > ImportError: No module named mod_python.apache
> > [Thu Mar 11 10:10:38 2004] [error] (24)Too many open files: apr_accept: (client socket)
> >
> > i've cleaned up /tmp/mpm*, /var/run/httpd.scoreboard, etc.  i've also
> > verified that in fact
> >
> > kern.openfiles: 68
> > kern.maxfiles: 12328
> >
> > and raised the openfiles limit on the www process, and checked lsof
> > which says there isn't much open.  so it looks like some kind of
> > shared memory / locking thing, except that ipcs tells me not much: i
> > guess it's not a sysv ipc thing.
> >
> > does anyone know how to clean house for this kind of stuff?
> >
> > B
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
>

From ajr at dynacap.com  Thu Mar 11 19:51:47 2004
From: ajr at dynacap.com (Arnaldo Riquelme)
Date: Fri Mar 12 00:49:13 2004
Subject: [mod_python] Publisher Handler
Message-ID: <0HUG00I4M5M5RC@mmp-1.gci.net>


I'm getting familiar with PSP and mod_python in general. I'm also reading
Gregory Trubetskoy O'Reilly Article from 2/26/2004.
I'm having trouble running the example on 'Using PSP as a Templating
System'.

I'm running Apache 2.0.48 ,Python 2.3, mod_python 3.1.2b  on a Windows 2000
machine.
I have this on my Apache config

 <Directory "C:/Program Files/Apache Group/Apache2/htdocs/publisher">
SetHandler mod_python 
PythonHandler mod_python.publisher
PythonDebug On
</Directory>

I also have the two files from the article hello.tmpl and pubpsp.py both on
C:/Program Files/Apache Group/Apache2/htdocs/publisher.
When I run http://localhost/publisher/pubpsp/hello I get his error message
----------------------------------------------------------------------------
-------------------------------------------------------
 Mod_python error: "PythonHandler mod_python.publisher"
Traceback (most recent call last):
  File "C:\Python23\Lib\site-packages\mod_python\apache.py", line 338, in
HandlerDispatch
    result = object(req)
  File "C:\Python23\Lib\site-packages\mod_python\publisher.py", line 164, in
handler
    result = util.apply_fs_data(object, req.form, req=req)
  File "C:\Python23\Lib\site-packages\mod_python\util.py", line 400, in
apply_fs_data
    return object(**args)
  File "C:/Program Files/Apache Group/Apache2/htdocs/publisher\puppsp.py",
line 8, in hello
    tmpl = psp.PSP(req, filename='hello.tmpl')
  File "C:\Python23\Lib\site-packages\mod_python\psp.py", line 143, in
__init__
    self.load_from_file()
  File "C:\Python23\Lib\site-packages\mod_python\psp.py", line 194, in
load_from_file
    raise ValueError, "%s is not a file" % filename
ValueError: hello.tmpl is not a file
----------------------------------------------------------------------------
--------------------------------------------------------------

Why does it say that hello.tmpl is not a file? Can anyone point out what I'm
missing here?

Thanks a lot

Arnaldo


-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20040311/27ca3460/attachment.html
From mod_python at 24ksoftware.com  Thu Mar 11 22:35:10 2004
From: mod_python at 24ksoftware.com (Erik Stephens)
Date: Fri Mar 12 01:29:41 2004
Subject: [mod_python] Publisher Handler
In-Reply-To: <0HUG00I4M5M5RC@mmp-1.gci.net>
References: <0HUG00I4M5M5RC@mmp-1.gci.net>
Message-ID: <Pine.LNX.4.58.0403112221340.23507@ramuh.int.24ksoftware.com>

On Thu, 11 Mar 2004, Arnaldo  Riquelme wrote:

> I have this on my Apache config
>
> <Directory "C:/Program Files/Apache Group/Apache2/htdocs/publisher">
>   SetHandler mod_python
>   PythonHandler mod_python.publisher
>   PythonDebug On
> </Directory>
>
> I also have the two files from the article hello.tmpl and pubpsp.py
> both on C:/Program Files/Apache Group/Apache2/htdocs/publisher.

> [snip]
>   File "C:\Python23\Lib\site-packages\mod_python\psp.py", line 194, in
> load_from_file
>     raise ValueError, "%s is not a file" % filename
> ValueError: hello.tmpl is not a file
>
> Why does it say that hello.tmpl is not a file? Can anyone point out
> what I'm missing here?

I'm not using Windows, but in my psp.py file there is:

    # if filename is not absolute, default to our guess
    # of current directory
    if not os.path.isabs(filename):
	base = os.path.split(req.filename)[0]
	self.filename = os.path.join(base, filename)

Assuming you're giving the PSP constructer a relative pathname, you
can try something like this in your method to see what this is doing
in your setup:

  raise 'DebugError', [req.filename, os.path.split(req.filename)]

Hope this doesn't sound like a cop-out, but look at the source.  It
may sound daunting at times (it does to me :), but it's worth it.
That's one nice thing about Python: you don't spend so much time
tripping over someone's style when reading their code.


Best regards,
Erik

From dg at sponsera.com  Sat Mar 13 03:49:11 2004
From: dg at sponsera.com (David Geller)
Date: Sat Mar 13 04:42:17 2004
Subject: [mod_python] persistent, reliable globals
In-Reply-To: <404C02E1.1060107@sponsera.com>
References: <404C02E1.1060107@sponsera.com>
Message-ID: <4052CB07.8010005@sponsera.com>

Hi -
Thanks for the answers - really interesting discussion.

I guess to summarize, if you want/need a memory-based solution for
globals, an answer would be:
1. You can't easily do what I want with apache
2. use something else, like shared memory or pyro

I've looked at many of these more general frameworks discussed, and
still don't have an answer as to what is a good one (and so, have more
or less created a home grown one, for now). I like the idea of using
flexible templates (Cheetah has its merits, as does SimpleTAL).  Awhile
ago I used a framework called "slither" which was really simple and neat
- but relied on CGI and had its own templates which were rather minimal.
I have been tempted to port slither to mod_python and Cheetah (the folks
who wrote it claim this has been done, but the code doesn't seem to be
available).

Criteria for a framework for me:
1. simple simple SIMPLE  - some of these frameworks are great, but are
worlds onto themselves - for me, a thin layer of convenience is
preferable to being all-encompassing.  Reasons I prefer simple:
reliability, debug-ability/understandability, learning-curve, ease of
interface with existing subsystems
2. Interface to existing template systems (why reinvent the wheel?) -
preferably, both sorts: html-compatible (like SimpleTAL) for easy
wysiwyg editing , and more general (like Cheetah) for all kinds of other
things (building pages from the "inside out" piece by piece, javascript,
etc.)
3. Handle sessions (etc) in a general and flexible way (maybe the new
version of mod_python does this, I don't know...)
4. Good logging / error handling facilities
5. Easy, flexiible way of storing modules in a directory tree suitable
for the application at hand
6. Perhaps desireable but by no means necessary: ability to run with or
without mod_python. For me, this is not an issue, but for many, CGI is
still the only way to go for various reasons. And in a sense, not
*requiring* mod_python makes things a bit more general and flexible
(this of course, is very debateable)


Regards,
David


David Geller wrote:

> Hi,
>
> I would like to set a global variable (in memory) from a module. I 
> would then like to access this same global variable susequently by 
> other modules at any other time, and have the value that was set there 
> to be there (until, of course, Apache is restarted).
>
> I have tried several ways of doing this, and it doesn't seem to be 
> reliable - i.e., sometimes the global variable is set when I look at 
> it, and sometimes it is still at its original state.
>
> What am I doing wrong (or right)?
>
> Thanks!
>
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>

-- 
David Geller
Sponsera, LLC
dg@sponsera.com
www.sponsera.com
Phone: 703.532.6812
Fax: 703.532.6058




From volodya at real.samuraj.org  Sat Mar 13 21:26:23 2004
From: volodya at real.samuraj.org (Volodya)
Date: Sat Mar 13 15:22:58 2004
Subject: [mod_python] file uploads and StringField / Field instances
Message-ID: <20040313192623.GA8692@mki-btc.com>

Hello,

I'm experimenting with form-based file uploads (mod_python.publisher
handler). After reading mod_python-docs, i expect to get an instance of
Field class in one of req.form's items. But i always get StringField
instance. 

My html-code:

<html>
<head><title>file upload</title></head>
<body>
<FORM NAME="upload" ACTION="save.py"
   ENCTYPE="multipart/form-data" METHOD="post">
   <INPUT TYPE="file" NAME="upload"/>
   <INPUT TYPE="submit" VALUE="Upload">
</FORM>
</body>
</html>

Handler's code: 

def index(req):
	return type(req.form['upload'])

And the output is always : <class 'mod_python.util.StringField'>

Env: win32 , apache 2.0.48 , mod_python 3.1.2b , Python 2.3.3
Browsers: IE 6.0 , Mozilla 1.3

Getting the file as a string is not a big problem with small files. But
when clients will upload huge files simultaneously it will be a problem.
What am i doing wrong ?

Here is the capture of http-request from IE (Mozilla's one looks similar):

POST /save.py HTTP/1.1
Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, application/x-shockwave-flash, application/vnd.ms-excel, application/vnd.ms-powerpoint, application/msword, */*
Referer: http://192.168.1.2/gal/manage/upload.html
Accept-Language: ru
Content-Type: multipart/form-data;
boundary=---------------------------7d412a1350100
User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; .NET CLR 1.0.3705; .NET CLR 1.1.4322)
Host: 127.0.0.1:8080
Content-Length: 257
Connection: Keep-Alive
Cache-Control: no-cache

-----------------------------7d412a1350100
Content-Disposition: form-data; name="upload"; filename="C:\123.gif"
Content-Type: image/gif
[    binary data of 123.gif goes here    ]
-----------------------------7d412a1350100--



From davidf at sjsoft.com  Sat Mar 13 22:02:34 2004
From: davidf at sjsoft.com (David Fraser)
Date: Sat Mar 13 15:57:06 2004
Subject: [mod_python] file uploads and StringField / Field instances
In-Reply-To: <20040313192623.GA8692@mki-btc.com>
References: <20040313192623.GA8692@mki-btc.com>
Message-ID: <405368DA.4090005@sjsoft.com>

Volodya wrote:

>Hello,
>
>I'm experimenting with form-based file uploads (mod_python.publisher
>handler). After reading mod_python-docs, i expect to get an instance of
>Field class in one of req.form's items. But i always get StringField
>instance. 
>  
>
I reported this problem on the python-dev list.
Here is my mail... and I have attached the patch... try it out and 
report back...
David Fraser wrote:

> Hi
>
> Submitting a file through a form (multipart/form-data) that has worked 
> under mod_python 3.0.3 (ended up as a File object) seems to produce a 
> StringField under mod_python 3.1.3
>
> It seems this part of the diff is responsible (util.py):
>
> @@ -260,10 +224,10 @@
>         found = []
>         for item in self.list:
>             if item.name == key:
> -                if isinstance(item.file, StringIO.StringIO):
> -                    found.append(StringField(item.value))
> -                else:
> +                if isinstance(item.file, FileType):
>                     found.append(item)
> +                else:
> +                    found.append(StringField(item.value))
>         if not found:
>             raise KeyError, key
>         if len(found) == 1:
>
> Since in mod_python 3.1.3 the file is created using tempfile, 
> item.file can end up being a tempfile._TemporaryFileWrapper. This does 
> in fact happen (at least under Windows), resulting in the attachment 
> coming out as a StringField.
>
> This patch fixes the problem by checking if the file has a "file" 
> attribute itself, and checking the type of that.
> There may be a cleaner way to do it.
>
> David


-------------- next part --------------
A non-text attachment was scrubbed...
Name: util-tempfilefix.patch
Type: text/x-patch
Size: 1476 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20040313/3f7accea/util-tempfilefix.bin
From volodya at real.samuraj.org  Sat Mar 13 23:17:43 2004
From: volodya at real.samuraj.org (Volodya)
Date: Sat Mar 13 17:14:33 2004
Subject: [mod_python] file uploads and StringField / Field instances
In-Reply-To: <405368DA.4090005@sjsoft.com>
References: <20040313192623.GA8692@mki-btc.com> <405368DA.4090005@sjsoft.com>
Message-ID: <20040313211743.GB8692@mki-btc.com>

On Sat, Mar 13, 2004 at 10:02:34PM +0200, David Fraser wrote:
> Volodya wrote:
> 
> >Hello,
> >
> >I'm experimenting with form-based file uploads (mod_python.publisher
> >handler). After reading mod_python-docs, i expect to get an instance of
> >Field class in one of req.form's items. But i always get StringField
> >instance. 
> > 
> >
> I reported this problem on the python-dev list.
> Here is my mail... and I have attached the patch... try it out and 
> report back...

Thanks, David!
After applying Your patch it works just fine.
I've tested it on both 3.1.2b and yours 3.1.3 build (it seems the only
changes from 3.1.2b to 3.1.3 in util.py are license lines).


From cfox at cfconsulting.ca  Sat Mar 13 14:56:53 2004
From: cfox at cfconsulting.ca (Colin Fox)
Date: Sat Mar 13 18:52:05 2004
Subject: [mod_python] An odd use of the publisher
Message-ID: <405391B5.6060504@cfconsulting.ca>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hi, all.

I'm doing something with the publisher that feels a little odd, but I
don't know of any other way to do it. I just wanted an opinion or two.

I'm building a site that works based on XML pages and python scripts. I
have an .htaccess file that sets things up such that the publisher gets
called for any .py file in my hierarchy, and a single xml handler gets
called for any xml file. All good.

The question comes with how I'm using the publisher. I want the ability
to execute python code from everywhere, but I don't want all the
processing that the publisher does for me - I just want a simple
execution. I would like to process the request object's form input
fields myself, rather than having them processed into FieldStorage
objects (since I'll just have to pull them out of FS objects), and I
want to be able to do redirections & return error codes.

The publisher processes input for me, and takes a string as a return
value for printing.

To get around the return issue, I'm finishing off my handler with this:

~    raise apache.SERVER_RETURN, apache.OK


I don't particularly like raising an exception as a normal return, but I
don't know any other way around it.

Am I missing something?

Thanks,
~   cf
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.4 (GNU/Linux)

iD8DBQFAU5G1oaQ1/feGlJoRAsLXAKCTXZzsO4/ycg44Emn+blEc17LozwCfSIVG
oJ+v8Po69rlXBiJMcMgUnBM=
=5Qr6
-----END PGP SIGNATURE-----
From cfox at cfconsulting.ca  Sat Mar 13 15:14:32 2004
From: cfox at cfconsulting.ca (Colin Fox)
Date: Sat Mar 13 19:09:43 2004
Subject: [mod_python] Referrer value?
Message-ID: <405395D8.7010200@cfconsulting.ca>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Where can I get the value of the referrer? I don't see a referrer field
in any of the request, server or connection objects.

Or is it by another name, or part of another field?

cf
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.4 (GNU/Linux)

iD8DBQFAU5XYoaQ1/feGlJoRAkwVAJwKEze6YVOv4zXg+djNumofu9kCvQCfY+BU
avxnTe1Tqdp+cFcGEY/w0b4=
=5/23
-----END PGP SIGNATURE-----
From modpython at holovaty.com  Sat Mar 13 17:28:38 2004
From: modpython at holovaty.com (Adrian Holovaty)
Date: Sat Mar 13 19:24:17 2004
Subject: [mod_python] Referrer value?
In-Reply-To: <405395D8.7010200@cfconsulting.ca>
References: <405395D8.7010200@cfconsulting.ca>
Message-ID: <200403131728.38753.modpython@holovaty.com>

Colin Fox wrote:
> Where can I get the value of the referrer? I don't see a referrer field
> in any of the request, server or connection objects.
>
> Or is it by another name, or part of another field?

It's kinda hidden. Look in req.headers_in, which allows you to access client 
headers using dictionary syntax.

Adrian
From ronwalf at umd.edu  Sat Mar 13 20:06:14 2004
From: ronwalf at umd.edu (Ron Alford)
Date: Sat Mar 13 21:01:33 2004
Subject: [mod_python] An odd use of the publisher
In-Reply-To: <405391B5.6060504@cfconsulting.ca>
References: <405391B5.6060504@cfconsulting.ca>
Message-ID: <4053B006.2090501@umd.edu>

Colin Fox wrote:

> To get around the return issue, I'm finishing off my handler with this:
> 
> ~    raise apache.SERVER_RETURN, apache.OK

How does a straight 'return' with no arguments work? I thought I was 
using that at one point.


-Ron
From cfox at cfconsulting.ca  Sat Mar 13 22:20:23 2004
From: cfox at cfconsulting.ca (Colin Fox)
Date: Sun Mar 14 02:15:35 2004
Subject: [mod_python] An odd use of the publisher
In-Reply-To: <4053B006.2090501@umd.edu>
References: <405391B5.6060504@cfconsulting.ca> <4053B006.2090501@umd.edu>
Message-ID: <4053F9A7.6030004@cfconsulting.ca>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Ron Alford wrote:
| Colin Fox wrote:
|
|> To get around the return issue, I'm finishing off my handler with this:
|>
|> ~    raise apache.SERVER_RETURN, apache.OK
|
|
| How does a straight 'return' with no arguments work? I thought I was
| using that at one point.
|
|
| -Ron

It doesn't work - but even if it did, what I'd like to return is the
success/failure code, not a string (which is what it's expecting).

I also want to be able to do redirections.

Raising an exception gives me the control I want, it's just that it
feels wierd to be doing that as a normal exit, rather than a problem exit.

I'd just like to be sure that nothing odd is going to happen if I raise
an exception. Or alternatively, how I could get processing similar to
what I get if I write my own handler (where you create a handler()
function and return a success code).

cf
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.4 (GNU/Linux)

iD8DBQFAU/mnoaQ1/feGlJoRAlapAJ9offurXoKqw39FN+lyiVE8RCSF5wCeLHn/
9uqZJIYZ+wg3WvNzWGKRJC4=
=qllQ
-----END PGP SIGNATURE-----
From mod_python at 24ksoftware.com  Sun Mar 14 09:18:25 2004
From: mod_python at 24ksoftware.com (Erik Stephens)
Date: Sun Mar 14 12:13:31 2004
Subject: [mod_python] An odd use of the publisher
In-Reply-To: <4053F9A7.6030004@cfconsulting.ca>
References: <405391B5.6060504@cfconsulting.ca> <4053B006.2090501@umd.edu>
 <4053F9A7.6030004@cfconsulting.ca>
Message-ID: <Pine.LNX.4.58.0403140917520.23507@ramuh.int.24ksoftware.com>

On Sat, 13 Mar 2004, Colin Fox wrote:

> Ron Alford wrote:
> | Colin Fox wrote:
> |
> |> To get around the return issue, I'm finishing off my handler with this:
> |>
> |> ~    raise apache.SERVER_RETURN, apache.OK
> |
> |
> | How does a straight 'return' with no arguments work? I thought I was
> | using that at one point.
> |
> |
> | -Ron
>
> It doesn't work - but even if it did, what I'd like to return is the
> success/failure code, not a string (which is what it's expecting).
>
> I also want to be able to do redirections.

Can't you use util.redirect?

  http://www.modpython.org/live/current/doc-html/pyapi-util-funcs.html


> Raising an exception gives me the control I want, it's just that it
> feels wierd to be doing that as a normal exit, rather than a problem exit.

Yeah, it is very weird.  I'm surprised it's working for you.  Maybe
I'm missing something about your requirements or architecture.


> I'd just like to be sure that nothing odd is going to happen if I raise
> an exception. Or alternatively, how I could get processing similar to
> what I get if I write my own handler (where you create a handler()
> function and return a success code).

Can't you just assume that if no exceptions have been raised, then
everything was successful?  Exception handling seems to me to be more
powerful and flexible than return codes.

I think you may be over-complicating things a bit.  I'd recommend that
you continue using publisher and factor out how you want each request
to get handled into a method or class.  Here's just one way:


class Page:

    def __call__(self, req):
        try:
            return self.get_contents(req)
        except:
            pass # your exception handling code here


class IndexPage:

    def get_contents(self, req):
        # This would be where you could put
        # your current handler stuff


index = IndexPage
about_us = AboutPage
...


Hope it helps and that I didn't misunderstand you completely :)


Best regards,
Erik
From grisha at modpython.org  Sun Mar 14 13:46:05 2004
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Sun Mar 14 14:41:14 2004
Subject: [mod_python] An odd use of the publisher
In-Reply-To: <4053F9A7.6030004@cfconsulting.ca>
References: <405391B5.6060504@cfconsulting.ca> <4053B006.2090501@umd.edu>
 <4053F9A7.6030004@cfconsulting.ca>
Message-ID: <20040314134415.L12042@onyx.ispol.com>


On Sat, 13 Mar 2004, Colin Fox wrote:

> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> Ron Alford wrote:
> | Colin Fox wrote:
> |
> |> To get around the return issue, I'm finishing off my handler with this:
> |>
> |> ~    raise apache.SERVER_RETURN, apache.OK
> |
> |
> | How does a straight 'return' with no arguments work? I thought I was
> | using that at one point.
>
> It doesn't work

Can you elaborate on the "doesn't work"? It's supposed to, at least on
version 3.1.x and may be even 3.0.x

Grisha
From cfox at cfconsulting.ca  Sun Mar 14 13:35:00 2004
From: cfox at cfconsulting.ca (Colin Fox)
Date: Sun Mar 14 17:30:28 2004
Subject: [mod_python] An odd use of the publisher
In-Reply-To: <20040314134415.L12042@onyx.ispol.com>
References: <405391B5.6060504@cfconsulting.ca> <4053B006.2090501@umd.edu>
	<4053F9A7.6030004@cfconsulting.ca> <20040314134415.L12042@onyx.ispol.com>
Message-ID: <4054D004.6070801@cfconsulting.ca>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Gregory (Grisha) Trubetskoy wrote:
| On Sat, 13 Mar 2004, Colin Fox wrote:
|
|
|>-----BEGIN PGP SIGNED MESSAGE-----
|>Hash: SHA1
|>
|>Ron Alford wrote:
|>| Colin Fox wrote:
|>|
|>|> To get around the return issue, I'm finishing off my handler with this:
|>|>
|>|> ~    raise apache.SERVER_RETURN, apache.OK
|>|
|>|
|>| How does a straight 'return' with no arguments work? I thought I was
|>| using that at one point.
|>
|>It doesn't work
|
|
| Can you elaborate on the "doesn't work"? It's supposed to, at least on
| version 3.1.x and may be even 3.0.x
|
| Grisha

Perhaps I am just totally missing something, but if I have a
mod_python.publisher handler called 'blah.py', with a function in it
called 'index':

def index(req):
~    req.write("hello, world!")
~    req.content_type("text/plain")
~    return

This is what I get:

hello, world!<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN">
<html><head>
<title>200 OK</title>
</head><body>
<h1>OK</h1>
<p>The server encountered an internal error or
misconfiguration and was unable to complete
your request.</p>
<p>Please contact the server administrator,
~ root@localhost and inform them of the time the error occurred,
and anything you might have done that may have
caused the error.</p>
<p>More information about this error may be available
in the server error log.</p>
<hr />
<address>Apache/2.0.48 (Gentoo/Linux) mod_python/3.0.4 Python/2.3.3
mod_ssl/2.0.48 OpenSSL/0.9.7c DAV/2 Server at cube.localdomain Port
80</address>
</body></html>

To avoid that I have to raise the apache.OK exception instead of just
returning.

cf
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.4 (GNU/Linux)

iD8DBQFAVNAEoaQ1/feGlJoRAm5PAJ9qtoImr+bKLvDbqEOZc2Vhiwf0BwCdHAzk
U+rq4Emf5ICGZsVX8SSSueM=
=1fPn
-----END PGP SIGNATURE-----
From cfox at cfconsulting.ca  Sun Mar 14 13:57:18 2004
From: cfox at cfconsulting.ca (Colin Fox)
Date: Sun Mar 14 17:52:36 2004
Subject: [mod_python] An odd use of the publisher
In-Reply-To: <Pine.LNX.4.58.0403140917520.23507@ramuh.int.24ksoftware.com>
References: <405391B5.6060504@cfconsulting.ca> <4053B006.2090501@umd.edu>
	<4053F9A7.6030004@cfconsulting.ca>
	<Pine.LNX.4.58.0403140917520.23507@ramuh.int.24ksoftware.com>
Message-ID: <4054D53E.8040803@cfconsulting.ca>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Erik Stephens wrote:
|
|>Raising an exception gives me the control I want, it's just that it
|>feels wierd to be doing that as a normal exit, rather than a problem exit.
|
|
| Yeah, it is very weird.  I'm surprised it's working for you.  Maybe
| I'm missing something about your requirements or architecture.

Well, what I'm looking for is actually quite simple. If you write your
own handler instead of using the mod_python.publisher, you get handed an
unprocessed req object, and you respond by returning an apache return
code. This is great. The problem is, your single handler gets executed
regardless of where in the tree you are. So, if in your .htaccess file
you say:
PythonHandler myhandler .py

and if you try to execute:

http://localhost/test1.py

and

http://localhost/folder/test2.py

then your 'myhandler.py' module gets executed for both test1.py and
test2.py. I want to be able to have .py files all over my hierarchy that
get executed, rather than a single handler.

To do that, I have to use mod_python.publisher. However, if I use
mod_python.publisher, then I no longer return an apache code, I return a
string that is to be printed. I don't want to do that - I'll handle that
myself.

So I want some features of both techniques, and to do that I end up
having to end my publisher based calls by raising exceptions.

The system is working perfectly now as far as I can tell, I'm just
concerned that there may be a performance penalty with raising
exceptions like this, or that the system may at  some point be changed
so that any raised exception will be considered an error, which will
cause my stuff to break.

|
|>I'd just like to be sure that nothing odd is going to happen if I raise
|>an exception. Or alternatively, how I could get processing similar to
|>what I get if I write my own handler (where you create a handler()
|>function and return a success code).
|
|
| Can't you just assume that if no exceptions have been raised, then
| everything was successful?  Exception handling seems to me to be more
| powerful and flexible than return codes.

As I said - *I'M* the one raising the exception, to get the behaviour I
need. It has nothing to do with me assuming what an exception means if
someone else raises it.

| I think you may be over-complicating things a bit.  I'd recommend that
| you continue using publisher and factor out how you want each request
| to get handled into a method or class.  Here's just one way:
|
|
| class Page:
|
|     def __call__(self, req):
|         try:
|             return self.get_contents(req)
|         except:
|             pass # your exception handling code here
|
|
| class IndexPage:
|
|     def get_contents(self, req):
|         # This would be where you could put
|         # your current handler stuff
|
|
| index = IndexPage
| about_us = AboutPage
| ...
|

I'm not quite sure what you're illustrating here - the Page class isn't
used or referenced - is Page supposed to be derived from IndexPage? Or
vice versa? And I'm not concerned with HANDLING exceptions, I'm
concerned with what happens to the rest of the mod_python system state
if I THROW exceptions under normal circumstances. Zope, for example,
will execute a database rollback if you raise an exception. I don't want
that kind of thing being added on behind the scenes.

|
| Hope it helps and that I didn't misunderstand you completely :)
|
|
| Best regards,
| Erik

It's funny, but what I need is pretty simple, but the more I explain it
the more it seems to get complicated.

I think the best thing is for me to simply publish what I'm doing, and
point to it so everyone can see in context what I'm doing. I'll put
proper copyright attributions on my files and do just that.

cf

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.4 (GNU/Linux)

iD8DBQFAVNU9oaQ1/feGlJoRAjRZAJwLjeEmoxFC5+f1CSa4OCZx1f7rKQCeNVyK
w7RwcMbPAqjErlpOF85992M=
=xi9V
-----END PGP SIGNATURE-----
From grisha at modpython.org  Sun Mar 14 17:50:27 2004
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Sun Mar 14 18:45:37 2004
Subject: [mod_python] An odd use of the publisher
In-Reply-To: <4054D004.6070801@cfconsulting.ca>
References: <405391B5.6060504@cfconsulting.ca> <4053B006.2090501@umd.edu>
 <4053F9A7.6030004@cfconsulting.ca> <20040314134415.L12042@onyx.ispol.com>
 <4054D004.6070801@cfconsulting.ca>
Message-ID: <20040314174836.Y12042@onyx.ispol.com>



On Sun, 14 Mar 2004, Colin Fox wrote:

> |>Ron Alford wrote:
> |>| How does a straight 'return' with no arguments work? I thought I was
> |>| using that at one point.
> |>
> |>It doesn't work
> |
> | Can you elaborate on the "doesn't work"? It's supposed to, at least on
> | version 3.1.x and may be even 3.0.x
> |
> | Grisha
>
> Perhaps I am just totally missing something, but if I have a
> mod_python.publisher handler called 'blah.py', with a function in it
> called 'index':

No, you're not missing anything, looking at the CVS, it appears that
return with no arguments would only work starting with mod_python 3.1.

Grisha
From grisha at modpython.org  Sun Mar 14 17:54:28 2004
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Sun Mar 14 18:49:37 2004
Subject: [mod_python] An odd use of the publisher
In-Reply-To: <4054D53E.8040803@cfconsulting.ca>
References: <405391B5.6060504@cfconsulting.ca> <4053B006.2090501@umd.edu>
	<Pine.LNX.4.58.0403140917520.23507@ramuh.int.24ksoftware.com>
	<4054D53E.8040803@cfconsulting.ca>
Message-ID: <20040314175145.Y12042@onyx.ispol.com>



On Sun, 14 Mar 2004, Colin Fox wrote:

> The system is working perfectly now as far as I can tell, I'm just
> concerned that there may be a performance penalty with raising
> exceptions like this, or that the system may at  some point be changed
> so that any raised exception will be considered an error, which will
> cause my stuff to break.

I wouldn't worry about it - if there is a performance hit, it's minimal,
and raising SERVER_RETURN is the "official" way, it is here to stay.

Grisha
From gnb at itga.com.au  Mon Mar 15 12:42:49 2004
From: gnb at itga.com.au (Gregory Bond)
Date: Sun Mar 14 21:37:57 2004
Subject: [mod_python] Serious wierdness with PythonPath and Files
Message-ID: <200403150142.MAA09126@lightning.itga.com.au>

This is getting weirder and weirder.  See FAQ 3.4 for more details!

Under 2.7, I did this:
  <Directory /mywebdir>
    AddHandler python-program .py
    PythonDebug On
    PythonPath "['/mywebdir'] + sys.path"
    <Files "prog1.py"
      PythonHandler prog1
    </Files>
    <Files "prog2.py"
      PythonHandler prog2
    </Files>
  </Directory>

and it all worked fine.  I could use prog1.py and prog2.py as expected and the 
server was able to find the files to import.

If I try this under 3.0.4 or 3.1.3, then it fails, with unable to import.
Adding some debug code into apache.py:import_module() shows this:

[Mon Mar 15 11:47:01 2004] [notice] mod_python: (Re)importing module 'mptest', s
ys.path = ['mptest.py/', '/opt/python-2.3.1/lib/python23.zip', <rest of sys.path>]

i.e. the PyhonPath directive is not being recognised / acted on.

Weird #1:

If I add the PythonPath to a wildcard files directive:
    <Files *.py>
      PythonPath "['/mywebdir'] + sys.path"
    </Files>
    <Files "prog1.py"
      PythonHandler prog1
    </Files>
	
Then it _sometimes_ works.  And once it's worked once, then it will continue 
to work for the life of that apache process.

Weirder #2:  If I add the PythonPath to ONLY ONE of the Files entries:

    <Files "prog1.py"
      PythonHandler prog1
    </Files>
    <Files "prog2.py"
      PythonHandler prog2
      PythonPath "['/mywebdir'] + sys.path"
    </Files>

Then, after a server restart, prog1.py fails.  As soon as I access prog2.py 
for the first time, this works, and from then on prog1.py also works until the 
next server restart.

Now I can work around this by adding a PythonPath to every <Files> section, 
at some cost to efficiency, but there is something very odd going on here.



From ben at medianstrip.net  Mon Mar 15 04:35:48 2004
From: ben at medianstrip.net (Ben)
Date: Mon Mar 15 05:30:58 2004
Subject: [mod_python] Pylets-0.1
Message-ID: <20040315043256.J43722-100000@inman.medianstrip.net>

Sorry to pollute people's mailboxes but I promised someone on this
list that they could try out my mod_python-based web framework.  Well
I've just cut an alpha-release (with some not-so-great documentation.)
You can find it at

http://sf.net/projects/pylets

I'm actively working on it so suggestions / bug reports are welcome.
Please let me know if you're playing with it so I can inform you when
I find out it's all broken!

take care, B

From johannes at aitellu.com  Mon Mar 15 11:26:40 2004
From: johannes at aitellu.com (=?ISO-8859-1?Q?Johannes_=D6hlin?=)
Date: Mon Mar 15 06:23:08 2004
Subject: [mod_python] PSP escaping HTML
Message-ID: <405584E0.7030101@aitellu.com>

Hi

I've encountered some strange behavior of PSP. Whenever I have 
backslashes in my html-template file PSP messes things up and replaces 
for example \n with a newline. This destroys some of my javascripts.

Can anyone explain what's going on? Am I overlooking something or have I 
encountered a bug?

I'm using PSP as a template system with mod_python 3.1.3.


/Johannes


From manfred.stienstra at dwerg.net  Mon Mar 15 15:48:58 2004
From: manfred.stienstra at dwerg.net (Manfred Stienstra)
Date: Mon Mar 15 10:39:35 2004
Subject: [mod_python] Pylets-0.1
In-Reply-To: <20040315043256.J43722-100000@inman.medianstrip.net>
References: <20040315043256.J43722-100000@inman.medianstrip.net>
Message-ID: <1079362138.4746.5.camel@ack.dwerg.net>

On Mon, 2004-03-15 at 10:35, Ben wrote:
> I'm actively working on it so suggestions / bug reports are welcome.
> Please let me know if you're playing with it so I can inform you when
> I find out it's all broken!

Your methods and functions don't have docstrings, this could be a nice
way to document the framework.

Manfred

From mod_python at 24ksoftware.com  Mon Mar 15 10:35:25 2004
From: mod_python at 24ksoftware.com (Erik Stephens)
Date: Mon Mar 15 13:30:25 2004
Subject: [mod_python] PSP escaping HTML
In-Reply-To: <405584E0.7030101@aitellu.com>
References: <405584E0.7030101@aitellu.com>
Message-ID: <Pine.LNX.4.58.0403151035150.23507@ramuh.int.24ksoftware.com>

On Mon, 15 Mar 2004, Johannes ?hlin wrote:

> I've encountered some strange behavior of PSP. Whenever I have
> backslashes in my html-template file PSP messes things up and
> replaces for example \n with a newline. This destroys some of my
> javascripts.
>
> Can anyone explain what's going on? Am I overlooking something or
> have I encountered a bug?

My gut tells me it's not a bug.  Have you tried escaping them (e.g
\\n, \\\n, etc.)?  Is that feasible?


Best regards,
Erik

From johannes at aitellu.com  Tue Mar 16 08:52:27 2004
From: johannes at aitellu.com (=?ISO-8859-1?Q?Johannes_=D6hlin?=)
Date: Tue Mar 16 03:48:58 2004
Subject: [mod_python] PSP escaping HTML
In-Reply-To: <Pine.LNX.4.58.0403151035150.23507@ramuh.int.24ksoftware.com>
References: <405584E0.7030101@aitellu.com>
	<Pine.LNX.4.58.0403151035150.23507@ramuh.int.24ksoftware.com>
Message-ID: <4056B23B.30504@aitellu.com>

Erik Stephens wrote:

>On Mon, 15 Mar 2004, Johannes ?hlin wrote:
>
>  
>
>>I've encountered some strange behavior of PSP. Whenever I have
>>backslashes in my html-template file PSP messes things up and
>>replaces for example \n with a newline. This destroys some of my
>>javascripts.
>>
>>Can anyone explain what's going on? Am I overlooking something or
>>have I encountered a bug?
>>    
>>
>
>My gut tells me it's not a bug.  Have you tried escaping them (e.g
>\\n, \\\n, etc.)?  Is that feasible?
>
>
>  
>
It is indeed possible to escape the html, but that means corrupting it. 
Changing the html, adapting it to PSP, doesn't really address the 
problem, it's more of a quick fix of the symptom.

Isn't PSP supposed to pass on everything not enclosed in <% %> as is? 
Looking at the output of display_code() it seems like PSP escapes quotes 
("), but not backslashes. Is there a reason for this?

/Johannes



From grisha at modpython.org  Tue Mar 16 09:47:12 2004
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Tue Mar 16 10:42:24 2004
Subject: [mod_python] PSP escaping HTML
In-Reply-To: <4056B23B.30504@aitellu.com>
References: <405584E0.7030101@aitellu.com>
	<Pine.LNX.4.58.0403151035150.23507@ramuh.int.24ksoftware.com>
	<4056B23B.30504@aitellu.com>
Message-ID: <20040316094622.A61409@onyx.ispol.com>



On Tue, 16 Mar 2004, [ISO-8859-1] Johannes ?hlin wrote:

> It is indeed possible to escape the html, but that means corrupting it.
> Changing the html, adapting it to PSP, doesn't really address the
> problem, it's more of a quick fix of the symptom.
>
> Isn't PSP supposed to pass on everything not enclosed in <% %> as is?
> Looking at the output of display_code() it seems like PSP escapes quotes
> ("), but not backslashes. Is there a reason for this?

I agree, this is a bug in PSP - you shouldn't have to escape backslashes.

Grisha
From davidf at sjsoft.com  Wed Mar 17 15:31:35 2004
From: davidf at sjsoft.com (David Fraser)
Date: Wed Mar 17 09:26:04 2004
Subject: [mod_python] Win32 platform - testing...
In-Reply-To: <OF5C2FDDF0.EE81A22C-ON85256E5A.00493453-85256E5A.00497BAB@notes.bmo.com>
References: <OF5C2FDDF0.EE81A22C-ON85256E5A.00493453-85256E5A.00497BAB@notes.bmo.com>
Message-ID: <40585337.8020902@sjsoft.com>

anthony.barker@bmo.com wrote:

>
>
> That "error" I got is described in the faq.
>
> http://www.modpython.org/FAQ/faqw.py?req=all#2.2>
>
>
> Anthony

So you mean you were importing them in plain Python from outside Apache? 
In that case ignore my other message...

>
> -------------------------------------------------------------------
>
>
> I tested on 3 machines (XP, 2000) with Apache 2.0.47, 48
>
>
> I haven't had any problems to speak of except if I load the Session or 
> util modules without loading apache first occasionally I get some errors.
>
>
> When will you put the installer on the website?
>
> Anthony 


From rdavisunr at yahoo.com  Wed Mar 17 11:20:57 2004
From: rdavisunr at yahoo.com (Robert Thomas Davis)
Date: Wed Mar 17 15:16:10 2004
Subject: [mod_python] Form Action
Message-ID: <20040317192057.74301.qmail@web80310.mail.yahoo.com>

Hello All
 
I have the following template file (form.tmpl)
 
<table border="0">
<caption><%=caption%></caption>
<form method="post" name="<%= name %>"
        id="<%= name%>" action="<%= processor %>" >
<%
for field in form_control_fields:
        req.write('<tr>')
        req.write('<td>')
        req.write( str(field.vars['name']))
        req.write('</td>')
        req.write('<td align="right">')
        req.write( str(field) )
        req.write('</td>')
        req.write('</tr>')
%>
<%
# end
%>
        <tr>
        <td colspan="2" align="center">
        <input type="submit" name="submit_btn" value="<%= submit_value %>" />
        </td>
        </tr>
</form>
</table>

I currently send this template all the variable you see above; my question is in regard to the <%=processor%> variable which is where I specify which function in my .py file should process the form.  I would like to specify a funtion here that begins with a "_" so that it cannot be freely accessed.  Is this possible? Am I going about it the right way, or does anyone have suggestions for improvment?
 
Thanks in advance!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20040317/4e56b4dd/attachment.html
From cfox at cfconsulting.ca  Wed Mar 17 20:38:54 2004
From: cfox at cfconsulting.ca (Colin Fox)
Date: Thu Mar 18 00:34:45 2004
Subject: [mod_python] _apache module
Message-ID: <405927DE.8040106@cfconsulting.ca>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1


I'm writing some unit tests, and one of my modules is doing a "from
mod_python import apache".

I get this:

~    from mod_python import apache
~  File "/usr/lib/python2.3/site-packages/mod_python/apache.py", line 28,
in ?
~    import _apache
ImportError: No module named _apache


when I try to run my tests stand-alone. When run from within apache,
this works.

How can I get it to run in stand-alone mode?

Thanks,
~  cf



-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.4 (GNU/Linux)

iD8DBQFAWSfeoaQ1/feGlJoRAmJKAJ9i5Y3tZYp2BzAi5ZE3oEJZbT5uBQCfRQnm
YyJXY0hks0X1wOIvqMsi/Og=
=j5GU
-----END PGP SIGNATURE-----
From gnb at itga.com.au  Thu Mar 18 16:25:07 2004
From: gnb at itga.com.au (Gregory Bond)
Date: Thu Mar 18 01:20:23 2004
Subject: [mod_python] _apache module 
In-Reply-To: Your message of Wed, 17 Mar 2004 20:38:54 -0800.
Message-ID: <200403180525.QAA22120@lightning.itga.com.au>


cfox@cfconsulting.ca said:
> How can I get it to run in stand-alone mode? 

Short answer: you can't.

See FAQ 2.2: http://www.modpython.org/FAQ/faqw.py?req=show&file=faq02.002.htp


From jkevans at pacbell.net  Wed Mar 17 22:14:14 2004
From: jkevans at pacbell.net (Jeremy Evans)
Date: Thu Mar 18 02:06:57 2004
Subject: [mod_python] _apache module
In-Reply-To: <200403180525.QAA22120@lightning.itga.com.au>
References: <200403180525.QAA22120@lightning.itga.com.au>
Message-ID: <40593E36.3070608@pacbell.net>

Gregory Bond wrote:

> cfox@cfconsulting.ca said:
> 
>>How can I get it to run in stand-alone mode? 
> 
> 
> Short answer: you can't.
> 
> See FAQ 2.2: http://www.modpython.org/FAQ/faqw.py?req=show&file=faq02.002.htp

This is a little off topic, but that FAQ Entry isn't completely 
accurate.  At the very least, you can import the _psp module.  For 
example, the following code will work as a command line psp->html converter:

#!/path/to/python
from mod_python._psp import parse
import os
class psp2html:
     def __init__(self, f):
         self.fil= file(f,'w')
     def write(self, data, blah=""):
         self.fil.write(data)
os.chdir('/path/to/page/')
req = psp2html('index.html')
exec(parse('index.psp'))

I release it is probably considered bad form to import the "private" 
_psp module, but importing psp doesn't work, because psp imports apache 
which imports _apache.  However, as long as you aren't using any other 
mod_python modules in the psp code for the page you are converting to 
html, the above should work (it does for me, at least).  The class is 
needed because the psp parser uses the req.write() function with both 2 
and 3 arguments in different places, so making req a file won't work.

>
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 
From cfox at cfconsulting.ca  Wed Mar 17 23:11:08 2004
From: cfox at cfconsulting.ca (Colin Fox)
Date: Thu Mar 18 03:06:25 2004
Subject: [mod_python] apache.import_module()
Message-ID: <40594B8C.2050509@cfconsulting.ca>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hi, all.

I'm still struggling a bit to get all the nuances of my program working.

I'll eventually be opening this up as a GPL project, but at the moment
I'd kind of like to solidify it in my head before I do that. I know that
it would probably help to be able to point to the in-progress code so
that it could be viewed in context. Hopefully that will be soon.

Part of what I need is the ability to import modules on an ad-hoc basis.

What would be absolutely perfect would be the ability to do this:


- -------------
mymod.py:

# This module is found in subs/funstuff"
def func(req,arg):
~    req.write(arg)
- -------------

Then in my handler, I have this snippet:

- ---------------
m = 'mymod'
f = 'func'
p = 'subs/funstuff'

~    md = apache.import_module(m,path=p)
~    s = md[f](req,a)
- --------------

If I try this, I get:

~    ImportError: No frozen submodule named subs/funstuff.mymod

If I don't have the path, I just get:

~    ImportError: No module named mymod

How exactly is the path supposed to work? Is it supposed to be based off
of the current directory? The directory found in the url? What is a
frozen submodule?

And even if I was able to actually do the module import, can I use the
dictionary syntax for function execution? (md[f])?

Thanks,
~  cf


-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.4 (GNU/Linux)

iD8DBQFAWUuMoaQ1/feGlJoRAreiAJ0ZYH/yaroeX8mgYtrQjBCCzCRpKgCfWpes
eFcu3yp2kx/yqZCUu4pvwSM=
=G+LZ
-----END PGP SIGNATURE-----
From vyermolenko at ukr.net  Thu Mar 18 13:42:31 2004
From: vyermolenko at ukr.net (Vitaliy Yermolenko)
Date: Thu Mar 18 07:37:44 2004
Subject: [mod_python] 
	HELP required: Apache with mod_python is not started - 0 max threads
Message-ID: <E1B3vux-000D1N-00@storage.ukr.net>

Hi,

Problem: Apache is not started after successfull installation of httpd-2.0.46 and mod_python-3.1.3 from sources on RH9.0 (2.4.20-8). During Apache startup I have got just next message, and nothing else:

mod_python: Creating 32 session mutexes based on 150 max processes and 0 max threads

What does it mean: 0 max threads?
May be this is the reason why Apache is not started properly?

Any suggestions?
 
Thanks.

-+-->
Regards,
Vitaliy Yermolenko.
From grisha at modpython.org  Thu Mar 18 09:52:17 2004
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Thu Mar 18 10:47:31 2004
Subject: [mod_python]  HELP required: Apache with mod_python is not
 started - 0 max threads
In-Reply-To: <E1B3vux-000D1N-00@storage.ukr.net>
References: <E1B3vux-000D1N-00@storage.ukr.net>
Message-ID: <20040318094915.G95123@onyx.ispol.com>



On Thu, 18 Mar 2004, Vitaliy Yermolenko wrote:

> Hi,
>
> Problem: Apache is not started after successfull installation of
> httpd-2.0.46 and mod_python-3.1.3 from sources on RH9.0 (2.4.20-8).
> During Apache startup I have got just next message, and nothing else:
>
> mod_python: Creating 32 session mutexes based on 150 max processes and 0
> max threads
>
> What does it mean: 0 max threads?

That just means that you're not using a threaded MPM... Are you sure there
is nothing else in the log files? Do you have a .core file somewhere
because httpd crashed? Does httpd appear to be running (i.e. does ps -ax
show it?) I believe several people have test mod_python on RH9, so it
should work OK.

Grisha
From vyermolenko at ukr.net  Thu Mar 18 17:21:10 2004
From: vyermolenko at ukr.net (Vitaliy Yermolenko)
Date: Thu Mar 18 11:16:28 2004
Subject: [mod_python]  HELP required: Apache with mod_python is
	notstarted - 0 max threads
In-Reply-To: <20040318094915.G95123@onyx.ispol.com>
Message-ID: <E1B3zKY-000KiC-00@fatlady.ukr.net>

> That just means that you're not using a threaded MPM... Are you sure there
> is nothing else in the log files? Do you have a .core file somewhere
> because httpd crashed? Does httpd appear to be running (i.e. does ps -ax
> show it?) I believe several people have test mod_python on RH9, so it
> should work OK.

Neither core dumps nor anything in logs, see below:

ROOT # pwd
/usr/local/apps/apache/httpd/bin
ROOT # ./apachectl -k start -e debug
[Thu Mar 18 17:11:44 2004] [debug] mod_so.c(290): loaded module python_module
ROOT # ps -fewwwwwwwww|grep http
root      8440 18551  0 17:11 pts/13   00:00:00 grep http
ROOT # cat ../logs/error_log
[Thu Mar 18 17:11:44 2004] [debug] mod_so.c(290): loaded module python_module
[Thu Mar 18 17:11:44 2004] [notice] mod_python: Creating 32 session mutexes based on 150 max processes and 0 max threads.
ROOT #

Could it be reason, when I have Python 2.3.3, installed in customized place (I used ./configure --prefix=/usr/local/apps/apache/httpd-2.0.46/modules --with-apxs=/usr/local/apps/apache/httpd/bin/apxs --with-python=/usr/local/apps/python/bin/python)?

Could I activate some additional debugging info?

Thanks.

-+-->
Regards,
Vitaliy Yermolenko.
From grisha at modpython.org  Thu Mar 18 10:34:42 2004
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Thu Mar 18 11:29:58 2004
Subject: [mod_python] HELP required: Apache with mod_python is
	notstarted - 0 max threads
In-Reply-To: <E1B3zKY-000KiC-00@fatlady.ukr.net>
References: <E1B3zKY-000KiC-00@fatlady.ukr.net>
Message-ID: <20040318102957.N4004@onyx.ispol.com>


First I'd verify that mod_python is the problem, i.e. if you remove
LoadModule, does httpd then start OK?

Second, I'd try to compile it without the customized Python if possible. I
don't think it's the problem, but who knows.

Another thing to look at is the ipc resources with the ipcs command - I
don't remember whether Apache uses system v ipc on RH9, but if it does,
it's possible that there are no more locks/semaphores available,
especially if httpd quits abnormally. You can clean them up with ipcrm (or
by rebooting the server if you're lazy). But if Apache does NOT use sysv
ipc on RH9, ignore this paragraph. :-)

Grisha

On Thu, 18 Mar 2004, Vitaliy Yermolenko wrote:

> > That just means that you're not using a threaded MPM... Are you sure there
> > is nothing else in the log files? Do you have a .core file somewhere
> > because httpd crashed? Does httpd appear to be running (i.e. does ps -ax
> > show it?) I believe several people have test mod_python on RH9, so it
> > should work OK.
>
> Neither core dumps nor anything in logs, see below:
>
> ROOT # pwd
> /usr/local/apps/apache/httpd/bin
> ROOT # ./apachectl -k start -e debug
> [Thu Mar 18 17:11:44 2004] [debug] mod_so.c(290): loaded module python_module
> ROOT # ps -fewwwwwwwww|grep http
> root      8440 18551  0 17:11 pts/13   00:00:00 grep http
> ROOT # cat ../logs/error_log
> [Thu Mar 18 17:11:44 2004] [debug] mod_so.c(290): loaded module python_module
> [Thu Mar 18 17:11:44 2004] [notice] mod_python: Creating 32 session mutexes based on 150 max processes and 0 max threads.
> ROOT #
>
> Could it be reason, when I have Python 2.3.3, installed in customized place (I used ./configure --prefix=/usr/local/apps/apache/httpd-2.0.46/modules --with-apxs=/usr/local/apps/apache/httpd/bin/apxs --with-python=/usr/local/apps/python/bin/python)?
>
> Could I activate some additional debugging info?
>
> Thanks.
>
> -+-->
> Regards,
> Vitaliy Yermolenko.
>
From sgillies at frii.com  Thu Mar 18 09:10:01 2004
From: sgillies at frii.com (Sean Gillies)
Date: Thu Mar 18 12:05:11 2004
Subject: [mod_python] Getting started with PythonLogHandler
Message-ID: <B60EC7E1-78F6-11D8-B9A2-000393B98B56@frii.com>

I'm looking into having a subset of my mod_python app's errors emailed
to an administrator as well as being output to the apache error_log.

Is the PythonLogHandler going to be useful?  Error messages pass through
a defined log handler in some sense, yes?  But through what name do I
access them in order to do my filtering?

Sean

--
Sean Gillies
sgillies at frii dot com
http://users.frii.com/sgillies

From r.barrett at openinfo.co.uk  Thu Mar 18 16:24:11 2004
From: r.barrett at openinfo.co.uk (Richard Barrett)
Date: Thu Mar 18 12:19:42 2004
Subject: [mod_python] Lack of support for subrequests in mod_python?
Message-ID: <B02EAFE2-78F8-11D8-9BA6-000A957C9A50@openinfo.co.uk>

I am new to using mod_python, having some limited familiarity with 
writing Apache modules, and a little puzzled by what appear to be 
omissions from the interface mod_python offers compared with Apache's C 
API and mod_perl. I apologize in advance if the issues have been 
covered in the documentation or on the mod_python list and I missed the 
explanations. If that is the case I woul appreciate a reference to 
pursue.

First up is the lack of access to running subequests using functions on 
a request to analogues of the ap_sub_req_lookup_uri() and 
ap_sub_req_lookup_file() functions, and their friends such as 
ap_run_sub_req(). If I am correct and these capabilities are indeed 
omitted, is there a good reason for me not to consider producing my own 
fork of mod_python-3.1.3 in order to gain access to the functions from 
my python code?

Second up is a separate query about implementation style for 
input/output filters; a Python output filter implementation I have just 
done bringing the issue to mind. I found that successive calls into my 
output filter function to service a particular request were passed a 
succession of different Python filter objects during the life of 
servicing the particular request. For a proxied request returning 
around 80k bytes of data 3 or 4 different filter objects were passed 
in, with the sum total of data from them being the whole of incoming 
response's body. This contrasts with Apache's C API where the filter 
function would be passed the same context data on each call for 
servicing a given request. The filter I was writing needed state to be 
carried from the inception of the request's processing until the EOS 
bucket was encountered; the filter uses an incremental HTML parser with 
a SAX interface which is being feed data progressively all of which is 
not necessarily consumed during the life of my filter function's 
invocation during which the data was read from the filter object. My 
initial thought was that filter objects should have an attribute, 
initialized to None, which my filter could use to store a state object 
for recovery on each entry to my filter function. With such a state 
variable unavailable, my second thought was to use a global dictionary 
using the filter's id() as key to a state variable as value. But both 
of there were non-starters because filter objects passed into my filter 
function could be different throughout the life of the particular 
filter invocation. I ended using the global dictionary idea but with 
the request and server obeject id()s as key (belt and braces approaches 
possibly). It works but feels a bit inelegant and I am wondering what 
an "expert" would have done to solve the problem.

Anatomically feasible advice on the above topics would be appreciated.

Thanks
-----------------------------------------------------------------------
Richard Barrett                               http://www.openinfo.co.uk

From vyermolenko at ukr.net  Thu Mar 18 18:43:19 2004
From: vyermolenko at ukr.net (Vitaliy Yermolenko)
Date: Thu Mar 18 12:38:34 2004
Subject: [mod_python] HELP required: Apache with mod_python is
	notstarted- 0 max threads
In-Reply-To: <20040318102957.N4004@onyx.ispol.com>
Message-ID: <E1B40c3-000MlY-00@fatlady.ukr.net>

> First I'd verify that mod_python is the problem, i.e. if you remove
> LoadModule, does httpd then start OK?

Yes, everything is fine with httpd, when mod_python.so is commented

> Second, I'd try to compile it without the customized Python if possible. I
> don't think it's the problem, but who knows.

Tried to compile mod_python with RH default Python 2.2.2 - unfortunately the same situation.

> Another thing to look at is the ipc resources with the ipcs command - I
> don't remember whether Apache uses system v ipc on RH9, but if it does,

I rebooted my workstation before starting Apache one more time - some shared memory segments were reserved after that, but I have no idea how it can help me. :-(

No any info in system logs as well.

-+-->
Regards,
Vitaliy Yermolenko.
From grisha at modpython.org  Thu Mar 18 13:18:48 2004
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Thu Mar 18 14:14:03 2004
Subject: [mod_python] Lack of support for subrequests in mod_python?
In-Reply-To: <B02EAFE2-78F8-11D8-9BA6-000A957C9A50@openinfo.co.uk>
References: <B02EAFE2-78F8-11D8-9BA6-000A957C9A50@openinfo.co.uk>
Message-ID: <20040318131038.Q4004@onyx.ispol.com>



On Thu, 18 Mar 2004, Richard Barrett wrote:

> First up is the lack of access to running subequests using functions on
> a request to analogues of the ap_sub_req_lookup_uri() and
> ap_sub_req_lookup_file() functions, and their friends such as
> ap_run_sub_req(). If I am correct and these capabilities are indeed
> omitted, is there a good reason for me not to consider producing my own
> fork of mod_python-3.1.3 in order to gain access to the functions from
> my python code?

They aren't there because noone has needed them so far. Instead producing
a fork, why not subscribe to the python-dev@httpd.apache.org list and
submit a patch?

> Second up is a separate query about implementation style for
> input/output filters; a Python output filter implementation I have just
> done bringing the issue to mind. I found that successive calls into my
> output filter function to service a particular request were passed a
> succession of different Python filter objects during the life of
> servicing the particular request. For a proxied request returning
> around 80k bytes of data 3 or 4 different filter objects were passed
> in, with the sum total of data from them being the whole of incoming
> response's body. This contrasts with Apache's C API where the filter
> function would be passed the same context data on each call for
> servicing a given request. The filter I was writing needed state to be
> carried from the inception of the request's processing until the EOS
> bucket was encountered; the filter uses an incremental HTML parser with
> a SAX interface which is being feed data progressively all of which is
> not necessarily consumed during the life of my filter function's
> invocation during which the data was read from the filter object. My
> initial thought was that filter objects should have an attribute,
> initialized to None, which my filter could use to store a state object
> for recovery on each entry to my filter function. With such a state
> variable unavailable, my second thought was to use a global dictionary
> using the filter's id() as key to a state variable as value. But both
> of there were non-starters because filter objects passed into my filter
> function could be different throughout the life of the particular
> filter invocation. I ended using the global dictionary idea but with
> the request and server obeject id()s as key (belt and braces approaches
> possibly). It works but feels a bit inelegant and I am wondering what
> an "expert" would have done to solve the problem.

I cc-d the python-dev@httpd list, I think we should move it there since
this is very techical and concerns how mod_python works rather than how to
use it.

Reading the above - it's hard for me to say right off the bat why there is
a new filter object created every time - there may be a good reason for
it, or there may be no good reason at all.

This will definitely need some code studying, which, btw, you're more than
welcome to do. If you need a quick fix - then the filter.req I'm sure is
the same throughout the request, so you can store your data as an
attribute of the request object, rather than filter.

Grisha
From mmc at tolosatech.com  Thu Mar 18 15:22:39 2004
From: mmc at tolosatech.com (Miles Clark)
Date: Thu Mar 18 19:22:10 2004
Subject: [mod_python] Trouble Installing on Win2k
Message-ID: <405A2F3F.8080405@tolosatech.com>

Hi -

After searching the list & other relevant websites & following those 
instructions to no avail, I thought I'd plead to the list for help...

I'm attempting to install mod_python under Apache on Windows 2000 pro, 
and it refuses to load.  I'm using the following versions:

Apache 2.0.48
Python 2.2.3
mod_python 3.0.4

After adding the LoadModule line to httpd.conf, apache refuses to 
start.  There's no information in the apache error.log, but two errors 
appers int he Windows 2000 Application log:

---
The Apache service named  reported the following error:
 >>> Syntax error on line 176 of D:/tools/Apache2/conf/httpd.conf:     .
---
The Apache service named  reported the following error:
 >>> Cannot load D:/tools/Apache2/modules/mod_python.so into server: The 
specified module could not be found.     .
---

I've verified that mod_python.so does indeed exist in 
D:\tools\Apache2\modules.  I've also checked the syntax many times, and 
it sure looks fine to me:

...
#LoadModule ssl_module modules/mod_ssl.so
LoadModule python_module modules/mod_python.so
...

Any helpful suggestions would be very much appreciated...

thanks,

Miles




From anthony.barker at bmo.com  Fri Mar 19 08:49:10 2004
From: anthony.barker at bmo.com (anthony.barker@bmo.com)
Date: Fri Mar 19 09:44:46 2004
Subject: [mod_python] mp3/ogg recording of Grisha's PyCon presentation
Message-ID: <OFF04CE4B1.CE1F797B-ON85256E5C.004B3EB1@notes.bmo.com>

Would anyone be able to record the presentation and convert it to digital 
format?

I unfortunately can't make it to pycon but would love to get a copy.

If no one from the list can do it I'll try asking a couple of friends from 
Toronto who will be attending.


Anthony



-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20040319/2fa6e247/attachment.html
From anthony.barker at bmo.com  Fri Mar 19 10:30:19 2004
From: anthony.barker at bmo.com (anthony.barker@bmo.com)
Date: Fri Mar 19 11:25:55 2004
Subject: [mod_python] using nested loop to display results in psp
Message-ID: <OFA85BCF9D.F2DC8D47-ON85256E5C.004E4A94@notes.bmo.com>

psp script

=========================================
<html>
<%
names1 = (('Steve','Barker','34'),('John','Smith','27'))
for n in names1:
        for w in n:
%>
<%=w%>
<br>
<%
%>
<%
%>
</html>
===========================================

results:

Steve
Barker
34
John
Smith
27

What I would like to do is format it so that the <br> comes at the end of 
the first for loop. 

Steve Barker 34
John Smith 27

Any ideas?
Once that is working I will reformat it into a table. with <td> and <tr>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20040319/d3f66970/attachment.html
From grisha at modpython.org  Fri Mar 19 11:48:45 2004
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Mar 19 12:43:59 2004
Subject: [mod_python] using nested loop to display results in psp
In-Reply-To: <OFA85BCF9D.F2DC8D47-ON85256E5C.004E4A94@notes.bmo.com>
References: <OFA85BCF9D.F2DC8D47-ON85256E5C.004E4A94@notes.bmo.com>
Message-ID: <20040319114334.S31105@onyx.ispol.com>


<html>
<%
names1 = (('Steve','Barker','34'),('John','Smith','27'))
for n in names1:
    for w in n:
        # begin
%>
<%=w%>
<%
    # end
%>
    <br>
<%
# end
%>
</html>

*** OR ***

<html>

<%
names1 = (('Steve','Barker','34'),('John','Smith','27'))
for n in names1:
    for w in n:
        req.write(w + '\n')
    req.write('<br>\n')
# end
%>

</html>

On Fri, 19 Mar 2004 anthony.barker@bmo.com wrote:

> psp script
>
> =========================================
> <html>
> <%
> names1 = (('Steve','Barker','34'),('John','Smith','27'))
> for n in names1:
>         for w in n:
> %>
> <%=w%>
> <br>
> <%
> %>
> <%
> %>
> </html>
> ===========================================
>
> results:
>
> Steve
> Barker
> 34
> John
> Smith
> 27
>
> What I would like to do is format it so that the <br> comes at the end of
> the first for loop.
>
> Steve Barker 34
> John Smith 27
>
> Any ideas?
> Once that is working I will reformat it into a table. with <td> and <tr>
From krishna at ironport.com  Fri Mar 19 20:06:34 2004
From: krishna at ironport.com (Krishna Srinivasan)
Date: Sat Mar 20 00:01:49 2004
Subject: [mod_python] Fatal Python Error in error_log
Message-ID: <Pine.BSF.4.55.0403191958130.13353@saint.ironport.com>


Greetings.

I am getting the following error in my error_log, whenever
I run mod_python (publisher or psp) code.

============== Mod_python error in error_log ============================
[Fri Mar 19 19:43:49 2004] [notice] mod_python: (Re)importing module 'mod_python.publisher'
[Fri Mar 19 19:43:49 2004] [notice] mod_python: (Re)importing module 'autoweb' with path set to '['/usr/local/apache2/htdocs/testautoweblib']'
Fatal Python error: PyThreadState_Delete: tstate is still current
[Fri Mar 19 19:43:49 2004] [notice] child pid 43463 exit signal Abort trap (6)
=========================================================================

The page does come up fine and things seem to work at the
outset, but still this error comes up - which bothers me.

After some time on google, I tried compiling apache
with threads, but got compile-error - so gave
up on that after reading discouraging web pages
lamenting on how apache2-threads and freebsd are
not friendly.

============== Apache compile error with --enable-threads ===============
/usr/local/bin/bash /home/krishna/work/downloads/httpd-2.0.48/srclib/apr/libtool --silent --mode=compile gcc -g -O2 -pthread   -DHAVE_CONFIG_H -D_REENTRANT -D_THREAD_SAFE   -I../../include -I../../include/arch -I../../include/arch/unix  -c thread_mutex.c && touch thread_mutex.lo
thread_mutex.c: In function `apr_thread_mutex_unlock':
thread_mutex.c:219: void value not ignored as it ought to be
=========================================================================

This is my configuration.
freebsd-4-7
apache-2-0-48
mod_python-3-1-3
python-2-2-3

How can I fix this problem ?
Can someone please help ?

Many thanks in advance,
Krishna.

From grisha at modpython.org  Fri Mar 19 23:44:24 2004
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Sat Mar 20 00:39:39 2004
Subject: [mod_python] Fatal Python Error in error_log
In-Reply-To: <Pine.BSF.4.55.0403191958130.13353@saint.ironport.com>
References: <Pine.BSF.4.55.0403191958130.13353@saint.ironport.com>
Message-ID: <20040319234112.M39573@onyx.ispol.com>


On FreeBSD, if you built apache without thread support, you may need to
add the following lines to $PREFIX/sbin/envvars:

LD_PRELOAD=/usr/lib/libc_r.so
export LD_PRELOAD

Grisha

On Fri, 19 Mar 2004, Krishna Srinivasan wrote:

>
> Greetings.
>
> I am getting the following error in my error_log, whenever
> I run mod_python (publisher or psp) code.
>
> ============== Mod_python error in error_log ============================
> [Fri Mar 19 19:43:49 2004] [notice] mod_python: (Re)importing module 'mod_python.publisher'
> [Fri Mar 19 19:43:49 2004] [notice] mod_python: (Re)importing module 'autoweb' with path set to '['/usr/local/apache2/htdocs/testautoweblib']'
> Fatal Python error: PyThreadState_Delete: tstate is still current
> [Fri Mar 19 19:43:49 2004] [notice] child pid 43463 exit signal Abort trap (6)
> =========================================================================
>
> The page does come up fine and things seem to work at the
> outset, but still this error comes up - which bothers me.
>
> After some time on google, I tried compiling apache
> with threads, but got compile-error - so gave
> up on that after reading discouraging web pages
> lamenting on how apache2-threads and freebsd are
> not friendly.
>
> ============== Apache compile error with --enable-threads ===============
> /usr/local/bin/bash /home/krishna/work/downloads/httpd-2.0.48/srclib/apr/libtool --silent --mode=compile gcc -g -O2 -pthread   -DHAVE_CONFIG_H -D_REENTRANT -D_THREAD_SAFE   -I../../include -I../../include/arch -I../../include/arch/unix  -c thread_mutex.c && touch thread_mutex.lo
> thread_mutex.c: In function `apr_thread_mutex_unlock':
> thread_mutex.c:219: void value not ignored as it ought to be
> =========================================================================
>
> This is my configuration.
> freebsd-4-7
> apache-2-0-48
> mod_python-3-1-3
> python-2-2-3
>
> How can I fix this problem ?
> Can someone please help ?
>
> Many thanks in advance,
> Krishna.
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From davidf at sjsoft.com  Mon Mar 22 05:32:38 2004
From: davidf at sjsoft.com (David Fraser)
Date: Sun Mar 21 23:25:38 2004
Subject: [mod_python] Trouble Installing on Win2k
In-Reply-To: <405A2F3F.8080405@tolosatech.com>
References: <405A2F3F.8080405@tolosatech.com>
Message-ID: <405E5E56.8010504@sjsoft.com>

Miles Clark wrote:

> Hi -
>
> After searching the list & other relevant websites & following those 
> instructions to no avail, I thought I'd plead to the list for help...
>
> I'm attempting to install mod_python under Apache on Windows 2000 pro, 
> and it refuses to load.  I'm using the following versions:
>
> Apache 2.0.48
> Python 2.2.3
> mod_python 3.0.4
>
> After adding the LoadModule line to httpd.conf, apache refuses to 
> start.  There's no information in the apache error.log, but two errors 
> appers int he Windows 2000 Application log:
>
> ---
> The Apache service named  reported the following error:
> >>> Syntax error on line 176 of D:/tools/Apache2/conf/httpd.conf:     .
> ---
> The Apache service named  reported the following error:
> >>> Cannot load D:/tools/Apache2/modules/mod_python.so into server: 
> The specified module could not be found.     .
> ---
>
> I've verified that mod_python.so does indeed exist in 
> D:\tools\Apache2\modules.  I've also checked the syntax many times, 
> and it sure looks fine to me:
>
> ...
> #LoadModule ssl_module modules/mod_ssl.so
> LoadModule python_module modules/mod_python.so
> ...
>
> Any helpful suggestions would be very much appreciated...
>
> thanks,
>
> Miles

Is D: a shared drive? I have had problems with shared drives and Apache 
under Windows. If so, try under a local drive and see if that makes a 
difference...

David
From rdavisunr at yahoo.com  Mon Mar 22 10:10:43 2004
From: rdavisunr at yahoo.com (Robert Thomas Davis)
Date: Mon Mar 22 14:06:01 2004
Subject: [mod_python] preventing module level access
Message-ID: <20040322181043.15782.qmail@web80310.mail.yahoo.com>

Hey guys, this should be an easy one.
 
I know one can use an underscore to
prevent access to functions.  I also know
I have read about a way to prevent
all the functions in a module from 
being able to be accessed...I just cant
seem to find the place where I read it.
 
Thanks

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20040322/416d7ba2/attachment.html
From grisha at modpython.org  Mon Mar 22 14:21:32 2004
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Mon Mar 22 15:16:50 2004
Subject: [mod_python] preventing module level access
In-Reply-To: <20040322181043.15782.qmail@web80310.mail.yahoo.com>
References: <20040322181043.15782.qmail@web80310.mail.yahoo.com>
Message-ID: <20040322142029.E31949@onyx.ispol.com>


This is something specific to the Publisher handler, so you probably read
it in the Publisher section of the docs.

The whole module access can be prevented with:

__access__ = 0

Grisha

On Mon, 22 Mar 2004, Robert Thomas Davis wrote:

> Hey guys, this should be an easy one.
>
> I know one can use an underscore to
> prevent access to functions.  I also know
> I have read about a way to prevent
> all the functions in a module from
> being able to be accessed...I just cant
> seem to find the place where I read it.
>
> Thanks
>
>
From davidf at sjsoft.com  Tue Mar 23 10:17:08 2004
From: davidf at sjsoft.com (David Fraser)
Date: Tue Mar 23 04:15:58 2004
Subject: [mod_python] Trouble Installing on Win2k
In-Reply-To: <NJEBKMCCFCKPFGFIALEBOEKDCDAA.mwatanabe@rogers.com>
References: <NJEBKMCCFCKPFGFIALEBOEKDCDAA.mwatanabe@rogers.com>
Message-ID: <405FF284.9080904@sjsoft.com>

Hi Masaru

I think you have confused me with Miles Clark ... Miles Clark had the 
problem, my Apache works fine.
It just doesn't like working off a shared network drive.
I'm cc'ing the mod_python mailing list on this - if you have problems, 
please try and get help through the list.
I can assure that mod_python under Windows is great and reliable, but 
you need to take it step by step.

Regards
David

masaru watanabe wrote:

>Hi David,
>
>Have you found if Apache 2.0.48 works under Win2K giving you back the test
>page?  Does it also invoke Python to compile a program? I have looked at
>every Python book for information on setting up Apache but no avail; also
>looked at several Apache manuals; none give sufficient info on the proper
>setup - it makes me wonder if any of them that mentions Windows ever tried
>it out!
>I have the same problem as you except I'm trying to get it working under Win
>XP.
>
>good luck in your attempts,
>masaru
>
>-----Original Message-----
>From: mod_python-bounces@modpython.org
>[mailto:mod_python-bounces@modpython.org]On Behalf Of David Fraser
>Sent: Sunday, March 21, 2004 10:33 PM
>To: Miles Clark
>Cc: mod_python@modpython.org
>Subject: Re: [mod_python] Trouble Installing on Win2k
>
>
>Miles Clark wrote:
>
>  
>
>>Hi -
>>
>>After searching the list & other relevant websites & following those
>>instructions to no avail, I thought I'd plead to the list for help...
>>
>>I'm attempting to install mod_python under Apache on Windows 2000 pro,
>>and it refuses to load.  I'm using the following versions:
>>
>>Apache 2.0.48
>>Python 2.2.3
>>mod_python 3.0.4
>>
>>After adding the LoadModule line to httpd.conf, apache refuses to
>>start.  There's no information in the apache error.log, but two errors
>>appers int he Windows 2000 Application log:
>>
>>---
>>The Apache service named  reported the following error:
>>    
>>
>>>>>Syntax error on line 176 of D:/tools/Apache2/conf/httpd.conf:     .
>>>>>          
>>>>>
>>---
>>The Apache service named  reported the following error:
>>    
>>
>>>>>Cannot load D:/tools/Apache2/modules/mod_python.so into server:
>>>>>          
>>>>>
>>The specified module could not be found.     .
>>---
>>
>>I've verified that mod_python.so does indeed exist in
>>D:\tools\Apache2\modules.  I've also checked the syntax many times,
>>and it sure looks fine to me:
>>
>>...
>>#LoadModule ssl_module modules/mod_ssl.so
>>LoadModule python_module modules/mod_python.so
>>...
>>
>>Any helpful suggestions would be very much appreciated...
>>
>>thanks,
>>
>>Miles
>>    
>>
>
>Is D: a shared drive? I have had problems with shared drives and Apache
>under Windows. If so, try under a local drive and see if that makes a
>difference...
>
>David
>_______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org
>http://mailman.modpython.org/mailman/listinfo/mod_python
>
>  
>

From anthony.barker at bmo.com  Tue Mar 23 08:46:28 2004
From: anthony.barker at bmo.com (anthony.barker@bmo.com)
Date: Tue Mar 23 09:42:16 2004
Subject: [mod_python] gzip pages with mod_python
Message-ID: <OF86C01E12.3B582FF5-ON85256E60.004AAE5B@notes.bmo.com>

In php gzipping the pages is fairly trivial. Include this in the file


<?php ob_start("ob_gzhandler"); ?>


Alan Kennedy has a faq for mod_python.
http://www.xhaus.com/alan/python/httpcomp.html#gzip

Grisha - It would be nice to include something closer to the php version 
in the included libraries.


Anthony
--------------------------------------------------------------
import string
import os
import sys
import gzip
import cStringIO
from   mod_python import apache

def compressBuf(buf):
    zbuf = cStringIO.StringIO()
    zfile = gzip.GzipFile(mode = 'wb',  fileobj = zbuf, compresslevel = 6)
    zfile.write(buf)
    zfile.close()
    return zbuf.getvalue()

def testAcceptsGzip(req):
    if req.headers_in.has_key('accept-encoding'):
        encodings = req.headers_in['accept-encoding']
        return (string.find(encodings, "gzip") != -1)
    else:
        return 0

def handler(req):
    req.content_type = "text/html"
    myHtml = """<html><body><h1>hello compressed 
world!</h1></body></html>"""
    if testAcceptsGzip(req):
        zbuf = compressBuf(myHtml)
        req.headers_out['Content-Encoding'] = 'gzip'
        req.headers_out['Content-Length'] = '%d' % (len(zbuf))
        req.send_http_header()
        req.write(zbuf)
    else:
        req.send_http_header()
        req.write(myHtml)
    return apache.OK
#--------------------------------------------------------------
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20040323/c50e6398/attachment.html
From grisha at modpython.org  Tue Mar 23 09:41:09 2004
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Tue Mar 23 10:36:31 2004
Subject: [mod_python] Trouble Installing on Win2k
In-Reply-To: <405FF284.9080904@sjsoft.com>
References: <NJEBKMCCFCKPFGFIALEBOEKDCDAA.mwatanabe@rogers.com>
 <405FF284.9080904@sjsoft.com>
Message-ID: <20040323093911.C48619@onyx.ispol.com>


If I understand it correctly, this doesn't have anything to do with Apache
really. Shared drives exist per-user on Windows. So since Apache may not
run as the same user as you, it may not necessarily see the shared drives
that you see.

But then I'm not a Windows expert, so I may be wrong here.

Grisha

On Tue, 23 Mar 2004, David Fraser wrote:

> Hi Masaru
>
> I think you have confused me with Miles Clark ... Miles Clark had the
> problem, my Apache works fine.
> It just doesn't like working off a shared network drive.
> I'm cc'ing the mod_python mailing list on this - if you have problems,
> please try and get help through the list.
> I can assure that mod_python under Windows is great and reliable, but
> you need to take it step by step.
>
> Regards
> David
>
> masaru watanabe wrote:
>
> >Hi David,
> >
> >Have you found if Apache 2.0.48 works under Win2K giving you back the test
> >page?  Does it also invoke Python to compile a program? I have looked at
> >every Python book for information on setting up Apache but no avail; also
> >looked at several Apache manuals; none give sufficient info on the proper
> >setup - it makes me wonder if any of them that mentions Windows ever tried
> >it out!
> >I have the same problem as you except I'm trying to get it working under Win
> >XP.
> >
> >good luck in your attempts,
> >masaru
> >
> >-----Original Message-----
> >From: mod_python-bounces@modpython.org
> >[mailto:mod_python-bounces@modpython.org]On Behalf Of David Fraser
> >Sent: Sunday, March 21, 2004 10:33 PM
> >To: Miles Clark
> >Cc: mod_python@modpython.org
> >Subject: Re: [mod_python] Trouble Installing on Win2k
> >
> >
> >Miles Clark wrote:
> >
> >
> >
> >>Hi -
> >>
> >>After searching the list & other relevant websites & following those
> >>instructions to no avail, I thought I'd plead to the list for help...
> >>
> >>I'm attempting to install mod_python under Apache on Windows 2000 pro,
> >>and it refuses to load.  I'm using the following versions:
> >>
> >>Apache 2.0.48
> >>Python 2.2.3
> >>mod_python 3.0.4
> >>
> >>After adding the LoadModule line to httpd.conf, apache refuses to
> >>start.  There's no information in the apache error.log, but two errors
> >>appers int he Windows 2000 Application log:
> >>
> >>---
> >>The Apache service named  reported the following error:
> >>
> >>
> >>>>>Syntax error on line 176 of D:/tools/Apache2/conf/httpd.conf:     .
> >>>>>
> >>>>>
> >>---
> >>The Apache service named  reported the following error:
> >>
> >>
> >>>>>Cannot load D:/tools/Apache2/modules/mod_python.so into server:
> >>>>>
> >>>>>
> >>The specified module could not be found.     .
> >>---
> >>
> >>I've verified that mod_python.so does indeed exist in
> >>D:\tools\Apache2\modules.  I've also checked the syntax many times,
> >>and it sure looks fine to me:
> >>
> >>...
> >>#LoadModule ssl_module modules/mod_ssl.so
> >>LoadModule python_module modules/mod_python.so
> >>...
> >>
> >>Any helpful suggestions would be very much appreciated...
> >>
> >>thanks,
> >>
> >>Miles
> >>
> >>
> >
> >Is D: a shared drive? I have had problems with shared drives and Apache
> >under Windows. If so, try under a local drive and see if that makes a
> >difference...
> >
> >David
> >_______________________________________________
> >Mod_python mailing list
> >Mod_python@modpython.org
> >http://mailman.modpython.org/mailman/listinfo/mod_python
> >
> >
> >
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From grisha at modpython.org  Tue Mar 23 09:43:47 2004
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Tue Mar 23 10:39:05 2004
Subject: [mod_python] Re: gzip pages with mod_python
In-Reply-To: <OF86C01E12.3B582FF5-ON85256E60.004AAE5B@notes.bmo.com>
References: <OF86C01E12.3B582FF5-ON85256E60.004AAE5B@notes.bmo.com>
Message-ID: <20040323094214.U48619@onyx.ispol.com>


Just FYI - if you look in your mod_python distribution, there is an
examples directory, which contains a much improved version of a gzip
filter than Alan's version.

Grisha

On Tue, 23 Mar 2004 anthony.barker@bmo.com wrote:

> In php gzipping the pages is fairly trivial. Include this in the file
>
>
> <?php ob_start("ob_gzhandler"); ?>
>
>
> Alan Kennedy has a faq for mod_python.
> http://www.xhaus.com/alan/python/httpcomp.html#gzip
>
> Grisha - It would be nice to include something closer to the php version
> in the included libraries.
>
>
> Anthony
> --------------------------------------------------------------
> import string
> import os
> import sys
> import gzip
> import cStringIO
> from   mod_python import apache
>
> def compressBuf(buf):
>     zbuf = cStringIO.StringIO()
>     zfile = gzip.GzipFile(mode = 'wb',  fileobj = zbuf, compresslevel = 6)
>     zfile.write(buf)
>     zfile.close()
>     return zbuf.getvalue()
>
> def testAcceptsGzip(req):
>     if req.headers_in.has_key('accept-encoding'):
>         encodings = req.headers_in['accept-encoding']
>         return (string.find(encodings, "gzip") != -1)
>     else:
>         return 0
>
> def handler(req):
>     req.content_type = "text/html"
>     myHtml = """<html><body><h1>hello compressed
> world!</h1></body></html>"""
>     if testAcceptsGzip(req):
>         zbuf = compressBuf(myHtml)
>         req.headers_out['Content-Encoding'] = 'gzip'
>         req.headers_out['Content-Length'] = '%d' % (len(zbuf))
>         req.send_http_header()
>         req.write(zbuf)
>     else:
>         req.send_http_header()
>         req.write(myHtml)
>     return apache.OK
> #--------------------------------------------------------------
From davidf at sjsoft.com  Tue Mar 23 18:35:57 2004
From: davidf at sjsoft.com (David Fraser)
Date: Tue Mar 23 12:28:38 2004
Subject: [mod_python] Trouble Installing on Win2k
In-Reply-To: <20040323093911.C48619@onyx.ispol.com>
References: <NJEBKMCCFCKPFGFIALEBOEKDCDAA.mwatanabe@rogers.com>
	<405FF284.9080904@sjsoft.com> <20040323093911.C48619@onyx.ispol.com>
Message-ID: <4060676D.8070408@sjsoft.com>

Hi Grisha,

Yes, this is correct. It's just confusing for a lot of Windows users, so 
I just wanted to check whether this was the problem they were having.

Thanks
David

Gregory (Grisha) Trubetskoy wrote:

>If I understand it correctly, this doesn't have anything to do with Apache
>really. Shared drives exist per-user on Windows. So since Apache may not
>run as the same user as you, it may not necessarily see the shared drives
>that you see.
>
>But then I'm not a Windows expert, so I may be wrong here.
>
>Grisha
>
>On Tue, 23 Mar 2004, David Fraser wrote:
>
>  
>
>>Hi Masaru
>>
>>I think you have confused me with Miles Clark ... Miles Clark had the
>>problem, my Apache works fine.
>>It just doesn't like working off a shared network drive.
>>I'm cc'ing the mod_python mailing list on this - if you have problems,
>>please try and get help through the list.
>>I can assure that mod_python under Windows is great and reliable, but
>>you need to take it step by step.
>>
>>Regards
>>David
>>
>>masaru watanabe wrote:
>>
>>    
>>
>>>Hi David,
>>>
>>>Have you found if Apache 2.0.48 works under Win2K giving you back the test
>>>page?  Does it also invoke Python to compile a program? I have looked at
>>>every Python book for information on setting up Apache but no avail; also
>>>looked at several Apache manuals; none give sufficient info on the proper
>>>setup - it makes me wonder if any of them that mentions Windows ever tried
>>>it out!
>>>I have the same problem as you except I'm trying to get it working under Win
>>>XP.
>>>
>>>good luck in your attempts,
>>>masaru
>>>
>>>-----Original Message-----
>>>From: mod_python-bounces@modpython.org
>>>[mailto:mod_python-bounces@modpython.org]On Behalf Of David Fraser
>>>Sent: Sunday, March 21, 2004 10:33 PM
>>>To: Miles Clark
>>>Cc: mod_python@modpython.org
>>>Subject: Re: [mod_python] Trouble Installing on Win2k
>>>
>>>
>>>Miles Clark wrote:
>>>
>>>
>>>
>>>      
>>>
>>>>Hi -
>>>>
>>>>After searching the list & other relevant websites & following those
>>>>instructions to no avail, I thought I'd plead to the list for help...
>>>>
>>>>I'm attempting to install mod_python under Apache on Windows 2000 pro,
>>>>and it refuses to load.  I'm using the following versions:
>>>>
>>>>Apache 2.0.48
>>>>Python 2.2.3
>>>>mod_python 3.0.4
>>>>
>>>>After adding the LoadModule line to httpd.conf, apache refuses to
>>>>start.  There's no information in the apache error.log, but two errors
>>>>appers int he Windows 2000 Application log:
>>>>
>>>>---
>>>>The Apache service named  reported the following error:
>>>>
>>>>
>>>>        
>>>>
>>>>>>>Syntax error on line 176 of D:/tools/Apache2/conf/httpd.conf:     .
>>>>>>>
>>>>>>>
>>>>>>>              
>>>>>>>
>>>>---
>>>>The Apache service named  reported the following error:
>>>>
>>>>
>>>>        
>>>>
>>>>>>>Cannot load D:/tools/Apache2/modules/mod_python.so into server:
>>>>>>>
>>>>>>>
>>>>>>>              
>>>>>>>
>>>>The specified module could not be found.     .
>>>>---
>>>>
>>>>I've verified that mod_python.so does indeed exist in
>>>>D:\tools\Apache2\modules.  I've also checked the syntax many times,
>>>>and it sure looks fine to me:
>>>>
>>>>...
>>>>#LoadModule ssl_module modules/mod_ssl.so
>>>>LoadModule python_module modules/mod_python.so
>>>>...
>>>>
>>>>Any helpful suggestions would be very much appreciated...
>>>>
>>>>thanks,
>>>>
>>>>Miles
>>>>
>>>>
>>>>        
>>>>
>>>Is D: a shared drive? I have had problems with shared drives and Apache
>>>under Windows. If so, try under a local drive and see if that makes a
>>>difference...
>>>
>>>David
>>>_______________________________________________
>>>Mod_python mailing list
>>>Mod_python@modpython.org
>>>http://mailman.modpython.org/mailman/listinfo/mod_python
>>>
>>>
>>>
>>>      
>>>
>>_______________________________________________
>>Mod_python mailing list
>>Mod_python@modpython.org
>>http://mailman.modpython.org/mailman/listinfo/mod_python
>>
>>    
>>
>_______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org
>http://mailman.modpython.org/mailman/listinfo/mod_python
>
>  
>

From mmc at tolosatech.com  Tue Mar 23 08:52:24 2004
From: mmc at tolosatech.com (Miles Clark)
Date: Tue Mar 23 12:51:12 2004
Subject: [mod_python] Trouble Installing on Win2k
In-Reply-To: <405FF284.9080904@sjsoft.com>
References: <NJEBKMCCFCKPFGFIALEBOEKDCDAA.mwatanabe@rogers.com>
	<405FF284.9080904@sjsoft.com>
Message-ID: <40606B48.10306@tolosatech.com>

Hi  -

I was not able to get the Apache 2.0.48/Python 2.2.3/Modpython 3.0.4 
combination working.  After going through docs & mailing lists, and 
banging my head against the wall for a while, I upgraded to Python 
2.3.3/modpython 3.1.2b & everything worked as advertised!  So that's 
where things stand.

To answer David's question, this was not on a shared drive, it was all 
installed locally.  Thanks for the suggestion, though!!

Miles



David Fraser wrote:

> Hi Masaru
>
> I think you have confused me with Miles Clark ... Miles Clark had the 
> problem, my Apache works fine.
> It just doesn't like working off a shared network drive.
> I'm cc'ing the mod_python mailing list on this - if you have problems, 
> please try and get help through the list.
> I can assure that mod_python under Windows is great and reliable, but 
> you need to take it step by step.
>
> Regards
> David
>
> masaru watanabe wrote:
>
>> Hi David,
>>
>> Have you found if Apache 2.0.48 works under Win2K giving you back the 
>> test
>> page?  Does it also invoke Python to compile a program? I have looked at
>> every Python book for information on setting up Apache but no avail; 
>> also
>> looked at several Apache manuals; none give sufficient info on the 
>> proper
>> setup - it makes me wonder if any of them that mentions Windows ever 
>> tried
>> it out!
>> I have the same problem as you except I'm trying to get it working 
>> under Win
>> XP.
>>
>> good luck in your attempts,
>> masaru
>>
>> -----Original Message-----
>> From: mod_python-bounces@modpython.org
>> [mailto:mod_python-bounces@modpython.org]On Behalf Of David Fraser
>> Sent: Sunday, March 21, 2004 10:33 PM
>> To: Miles Clark
>> Cc: mod_python@modpython.org
>> Subject: Re: [mod_python] Trouble Installing on Win2k
>>
>>
>> Miles Clark wrote:
>>
>>  
>>
>>> Hi -
>>>
>>> After searching the list & other relevant websites & following those
>>> instructions to no avail, I thought I'd plead to the list for help...
>>>
>>> I'm attempting to install mod_python under Apache on Windows 2000 pro,
>>> and it refuses to load.  I'm using the following versions:
>>>
>>> Apache 2.0.48
>>> Python 2.2.3
>>> mod_python 3.0.4
>>>
>>> After adding the LoadModule line to httpd.conf, apache refuses to
>>> start.  There's no information in the apache error.log, but two errors
>>> appers int he Windows 2000 Application log:
>>>
>>> ---
>>> The Apache service named  reported the following error:
>>>   
>>>
>>>>>> Syntax error on line 176 of D:/tools/Apache2/conf/httpd.conf:     .
>>>>>>         
>>>>>
>>> ---
>>> The Apache service named  reported the following error:
>>>   
>>>
>>>>>> Cannot load D:/tools/Apache2/modules/mod_python.so into server:
>>>>>>         
>>>>>
>>> The specified module could not be found.     .
>>> ---
>>>
>>> I've verified that mod_python.so does indeed exist in
>>> D:\tools\Apache2\modules.  I've also checked the syntax many times,
>>> and it sure looks fine to me:
>>>
>>> ...
>>> #LoadModule ssl_module modules/mod_ssl.so
>>> LoadModule python_module modules/mod_python.so
>>> ...
>>>
>>> Any helpful suggestions would be very much appreciated...
>>>
>>> thanks,
>>>
>>> Miles
>>>   
>>
>>
>> Is D: a shared drive? I have had problems with shared drives and Apache
>> under Windows. If so, try under a local drive and see if that makes a
>> difference...
>>
>> David
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>
>>  
>>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python


-- 
Miles Clark
Tolosa Technologies
(805) 545-8086
http://www.tolosatech.com


From dgray at coldstorage.com  Tue Mar 23 18:36:31 2004
From: dgray at coldstorage.com (Doug Gray)
Date: Tue Mar 23 19:32:10 2004
Subject: [mod_python] using httplib with mod python
Message-ID: <200403232337.SAA03874@mail>

Python 2.2.3 running on Redhat Version 8.0

 

I cant get the example httplib from the python.org site to work through a
web application. It will work using python on linux but when I set up a
simple web page form to call a test.py file with a simple function I get an
error. AtrributeError: 'module' object has no attribute 'HTTPConnection'

 

Essential the test.py file  is this

 

 

Import httplib

 

Def testweb(req,**arg):

     conn = httplib.HTTPConnection(www.python.org <http://www.python.org/> )

     conn.request("GET","/index.html")

     r1 = conn.getresponse()

     return r1.status

 

 

 

I call that file from a simple form with action =/test.py/getwebpage

 

Thanks for any help

Doug

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20040323/5cd05bdb/attachment.html
From modpython at sandlus.de  Wed Mar 24 03:55:15 2004
From: modpython at sandlus.de (Marc O. Sandlus)
Date: Tue Mar 23 22:49:01 2004
Subject: [mod_python] AddHandler/SetHandler ignored by apache
Message-ID: <1080096915.6891.20.camel@luke>

Hello,

my problem is simple, and might not even be related to mod_python but to
apache2:
Instead of seeing the output of my scripts, apache2 returns the contents
of the script itself.

I have this setup:
Apache/2.0.48 (Debian GNU/Linux) mod_python/3.0.4 Python/2.3.3
The contents of /etc/apache2/sites-enabled/default are appended at the
end of this mail.

This is what I tried:
http://www.modpython.org/live/current/doc-html/inst-testing.html

All I get is the source of mptest.py, so apache2 doesn't seem to call
mod_python at all. What am I missing?

Thanks a lot for any hints!

Regards,
Marc

Contents of /etc/apache2/sites-enabled/default:

NameVirtualHost *:80
<VirtualHost *:80>
ServerAdmin webmaster@localhost

DocumentRoot /home/www/mp/
<Directory /home/www/mp>
 Options Indexes FollowSymLinks MultiViews
 AllowOverride FileInfo
 Order allow,deny
 allow from all
</Directory>

<Directory /home/www/mp>
 AddHandler mod_python .py
 PythonHandler mptest

 PythonDebug On
</Directory>

ErrorLog /var/log/apache2/error.log

LogLevel debug

CustomLog /var/log/apache2/access.log combined
ServerSignature On

</VirtualHost>


From mogmios at mlug.missouri.edu  Tue Mar 23 20:16:37 2004
From: mogmios at mlug.missouri.edu (Michael)
Date: Wed Mar 24 00:11:37 2004
Subject: [mod_python] security issues?
Message-ID: <40610BA5.2040703@mlug.missouri.edu>

Are their any inherit security issues with mod_python? Would it be 
secure enough, in a properly secured setting, for use in online banking 
apps? Any special steps that need to be taken? Thanks.
From mod_python at 24ksoftware.com  Tue Mar 23 22:15:37 2004
From: mod_python at 24ksoftware.com (Erik Stephens)
Date: Wed Mar 24 01:10:45 2004
Subject: [mod_python] security issues?
In-Reply-To: <40610BA5.2040703@mlug.missouri.edu>
References: <40610BA5.2040703@mlug.missouri.edu>
Message-ID: <Pine.LNX.4.58.0403232200200.1371@ramuh.int.24ksoftware.com>

On Tue, 23 Mar 2004, Michael wrote:

> Are their any inherit security issues with mod_python? Would it be
> secure enough, in a properly secured setting, for use in online
> banking apps?

I would hope that any known security issues have been dealt with
already ;) It's also tough to quantify how secure one piece of
software is versus another.  Since mod_python provides a fairly thin
layer over Apache (a secure, well-trusted web server), I would argue
that it is less prone to security holes than other web application
packages.  Plus, you have the source code if you want to be sure.
Again, since mod_python does not aim to do much more than allow python
to be embedded into Apache, there shouldn't be a lot of source code to
have to verify if you're really concerned about the security.

> Any special steps that need to be taken?

Not that I'm aware other than best practices (i.e. keep up-to-date,
proper configuration, don't trust user input, etc.).  Also, be aware
of common web application holes like cross-site scripting (XSS), sql
injection, and shell injection attacks.


Best regards,
Erik

From dgray at coldstorage.com  Wed Mar 24 14:09:24 2004
From: dgray at coldstorage.com (Doug Gray)
Date: Wed Mar 24 15:04:52 2004
Subject: [mod_python] version mismatch
In-Reply-To: <200403241700.i2OH09xl078737@slash.mediapulse.com>
Message-ID: <200403241909.OAA00767@mail>

I think Im running into version problems

I run python from the unix prompt and I get Python 2.2.3


I created a little .py program that is call through apache using mod_python
that imports sys and prints out the sys.verions. That displays 2.2.1


Do I have to re-install or re-configure mod_python to pick up the correct
python version? How do I get the versions to match?

Thanks
Doug




From grisha at modpython.org  Wed Mar 24 15:05:12 2004
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Wed Mar 24 16:00:32 2004
Subject: [mod_python] version mismatch
In-Reply-To: <200403241909.OAA00767@mail>
References: <200403241909.OAA00767@mail>
Message-ID: <20040324150440.B93260@onyx.ispol.com>


Yes, if you upgraded Python you'll need to recompile mod_python.

Grisha

On Wed, 24 Mar 2004, Doug Gray wrote:

> I think Im running into version problems
>
> I run python from the unix prompt and I get Python 2.2.3
>
>
> I created a little .py program that is call through apache using mod_python
> that imports sys and prints out the sys.verions. That displays 2.2.1
>
>
> Do I have to re-install or re-configure mod_python to pick up the correct
> python version? How do I get the versions to match?
>
> Thanks
> Doug
>
>
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From amy-g-art at cox.net  Wed Mar 24 21:32:33 2004
From: amy-g-art at cox.net (Amy G)
Date: Thu Mar 25 01:27:56 2004
Subject: [mod_python] Getting apache configured correctly?
Message-ID: <003401c4122a$92f4a710$6401a8c0@berry>

I am just trying to get apache to recognize my mod_python.so.

I am using Apache 1.3.7.

I downloaded both mod_pyton-2.7.10 and 2.7.9.

I configured and ran make mso, make install on both with the same result.

After adding the required lines to my httpd.conf and restarting apache I get
the following error.

Syntax error on line 237 of /usr/local/etc/apache/httpd.conf:
Cannot load /usr/local/libexec/apache/mod_python.so into server:
/usr/local/libexec/apache/mod_python.so: Undefined symbol "pthread_create"

Thanks for any help.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20040324/ba272e9d/attachment.html
From amy-g-art at cox.net  Wed Mar 24 21:43:26 2004
From: amy-g-art at cox.net (Amy G)
Date: Thu Mar 25 01:38:46 2004
Subject: [mod_python] Getting apache configured correctly?
References: <003401c4122a$92f4a710$6401a8c0@berry>
Message-ID: <004401c4122c$183a2020$6401a8c0@berry>

Well I got this working - sort of - by adding the following to my
environment.

LD_PRELOAD=/usr/lib/libc_r.so
export LD_PRELOAD

So now I can restart apache without any error messages.

But a file containing the following...
#!/usr/local/bin/python

from mod_python import apache

def handler(req):
    req.content_type = "text/plain"
	req.write("Hello World!")

	return apache.OK

just prints the code to the screen when I look at it through a browser.  I
was under the impression that this should print Hello World! to the browser
window.

Any help is appreciated.  Also, where can I find a good online tutorial for
mod_python?

Thanks



----- Original Message ----- 
From: Amy G
To: mod_python@modpython.org
Sent: Wednesday, March 24, 2004 9:32 PM
Subject: [mod_python] Getting apache configured correctly?


I am just trying to get apache to recognize my mod_python.so.

I am using Apache 1.3.7.

I downloaded both mod_pyton-2.7.10 and 2.7.9.

I configured and ran make mso, make install on both with the same result.

After adding the required lines to my httpd.conf and restarting apache I get
the following error.

Syntax error on line 237 of /usr/local/etc/apache/httpd.conf:
Cannot load /usr/local/libexec/apache/mod_python.so into server:
/usr/local/libexec/apache/mod_python.so: Undefined symbol "pthread_create"

Thanks for any help.




_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://mailman.modpython.org/mailman/listinfo/mod_python

From amy-g-art at cox.net  Wed Mar 24 23:16:34 2004
From: amy-g-art at cox.net (Amy G)
Date: Thu Mar 25 03:11:56 2004
Subject: [mod_python] My mod_python configuration woes...
Message-ID: <002801c41239$1b0eb100$6401a8c0@berry>

Mod_python version -- 2.7.9, 2.7.10
Os -- FreeBSD 5.1
Python 2.3
Apache 1.3.7


I successfully ran
./configure --with-apxs=/usr/local/apache/sbin/apxs

I then ran
make dso

Then
make install

Everyting completed successfully and the make install output message told me
what lines to add to my httpd.conf.

I did so adding...

LoadModule python_module      libexec/apache/mod_python.so
AddModule mod_python.c

<Directory /usr/local/www/data-dist/python>
    AddHandler python-program .py
    PythonHandler example
    PythonDebug On
</Directory>

I also had to add
LD_PRELOAD=/usr/lib/libc_r.so
export LD_PRELOAD
to my environment.

The directory /usr/local/www/data-dist/pthon is viewable on the internet.
But, the file still shows up as text output to the browser window.
The program example.py is as follows.

#!/usr/local/bin/python

from mod_python import apache

def handler(req):
    req.content_type = "text/plain"
    req.write("Hello World!")
    return apache.OK



Any ideas.  I love the programming power of python and would like to start
writing some cgi scripts of my own.

Thanks.

From bortzmeyer at nic.fr  Thu Mar 25 09:57:14 2004
From: bortzmeyer at nic.fr (Stephane Bortzmeyer)
Date: Thu Mar 25 04:52:38 2004
Subject: [mod_python] Re: security issues?
In-Reply-To: <Pine.LNX.4.58.0403232200200.1371@ramuh.int.24ksoftware.com>
References: <40610BA5.2040703@mlug.missouri.edu>
	<Pine.LNX.4.58.0403232200200.1371@ramuh.int.24ksoftware.com>
Message-ID: <20040325085714.GA21027@nic.fr>

On Tue, Mar 23, 2004 at 10:15:37PM -0700,
 Erik Stephens <mod_python@24ksoftware.com> wrote 
 a message of 31 lines which said:

> Not that I'm aware other than best practices (i.e. keep up-to-date,
> proper configuration, don't trust user input, 
                        ^^^^^^^^^^^^^^^^^^^^^^ 
                        Speaking of this, I do not find in Python the
			equivalent of Perl's -T switch. It is very
			useful to limit the risks of user-controlled
			input. Is there something like this in Python?
From toms.baugis at tietoenator.com  Thu Mar 25 16:56:59 2004
From: toms.baugis at tietoenator.com (Toms Baugis)
Date: Thu Mar 25 10:48:14 2004
Subject: [mod_python] apache.import_module picks wrong module
Message-ID: <4062F33B.2090707@tietoenator.com>

I am using mod_python 1.3.1

Have been using publisher handler for several days and got some problems.
Here is the situation:

In short, i have something like following directory structure

index.py
\dlu\index.py
\dlu\templates\index.py

all 3 files contain only one "def index" function

Now try following thing:
1. open index.py, then \dlu\index.py then \dlu\templates\index.py
2. now open index.py (try several times, if you have autoreload)

As result, sometimes in place of index.py you will get \dlu\index.py or 
\dlu\templates\index.py, also in place of \dlu\index.py you will 
sometimes get \dlu\templates\index.py

Found the problem in import_module function of mod_python.apache module:

.
        # of arbitrary already imported modules, such as os. The
        # reason we use startswith as opposed to exact match is that
        # modules inside packages are actually in subdirectories.

        if not file or (path and not filter(file.startswith, path)):
.

well if I do as i did in #1, then "import \dlu\index.py" will pick 
\dlu\templates\index.py - because "\dlu\templates" really startswith "\dlu\"

problem fixed by changing path checking to following:
        file_path = file[:file.rfind('/')]
        if not file or (path and (file_path <> path)):

(if something looks not good - sorry, i am new in python)

tm
From kamil at nvstudio.pl  Thu Mar 25 17:30:11 2004
From: kamil at nvstudio.pl (Kamil Niechajewicz)
Date: Thu Mar 25 11:23:04 2004
Subject: [mod_python] apache.import_module picks wrong module
In-Reply-To: <4062F33B.2090707@tietoenator.com>
References: <4062F33B.2090707@tietoenator.com>
Message-ID: <20040325173011.4c1c2c8b.kamil@nvstudio.pl>

On Thu, 25 Mar 2004 16:56:59 +0200
Toms Baugis <toms.baugis@tietoenator.com> wrote:
<cut>

I've had somehow similar problem. It made me crazy one day.
I'll try to explain it in detail now.

I had one VirtualHost declaration, and under it I had two
<Location> statements:

<Location /app1>
    SetHandler python-program
    PythonHandler myhandler 
    PythonDebug on
    PythonPath "sys.path + ['/path/to/app1/']"
</Location>

and

<Location /app2>
    SetHandler python-program
    PythonHandler myhandler
    PythonDebug on
    PythonPath "sys.path + ['/path/to/app2/']"
</Location>

now the directory structure:

upper_dir/

    app1/
           templates/
                  template1.xsl
                  index.xsl
 
           myhandler.py
           BaseForm.py
           BaseField.py
           something.py
    app2/
           templates/
                   template2.xsl
                   index.xsl
           myhandler.py
           BaseForm.py
           BaseField.py
           something_different.py

when I had only one application running under this VHost 
everything was fine. but when I added the second app, 
which was in totally different directory, but had few
files that had the same name like files from first
application, something started to go wrong.

usualy application worked fine, but sometimes strange
errors happened, like reporting runtime error that
SHOULD NOT happen. suddenly I noticed that applications
are somehow messing their paths? or something - there
was a random chance that app1 will mistake myhandler.py
from app1/myhandler.py and instead of using it, it will
load app2/myhandler.py, because it had the same name.
but path declarations are different for every app, so
how such mistakes were possible? the same problem happened
with templates, sometimes wrong template was loaded.

is that a matter of mod_python? my wrong apache conf
directives, or apache itself?

actually i've renamed all files that had the same names
in both applications to some, so that they all differ 
now and are not messed, but it cost me alot of work
that shouldn't be necessary. 

how could i solve this problem in the future, so that
i woulnd't have to rename all files? for me its quite
logical that some files can have the same names in
different apps-directories, and apache/modpython/whatever
shouldn't mistake them when it has directives that tell
'use this path for /app1 and this path for /app2'. i
guess that the randomness of those errors was a result
of apache-children, sometimes i ran into thread that 
had this bad configuration and everything was messed,
and sometimes i could see the page properly.

with regards,
K.
From neel at mediapulse.com  Thu Mar 25 11:03:19 2004
From: neel at mediapulse.com (Michael C. Neel)
Date: Thu Mar 25 11:59:29 2004
Subject: [mod_python] apache.import_module picks wrong module
Message-ID: <C0FC22C08B82074A88B500617641577787A886@johnson.mediapulse.net>

> actually i've renamed all files that had the same names
> in both applications to some, so that they all differ 
> now and are not messed, but it cost me alot of work
> that shouldn't be necessary. 
> 

I agree here as well.  mod_pyhton's import method needs an overhaul I
think - we are addressing similar issues atm too.  I'm working to
isolate the problem (in our case it's going beyond mixing the module,
but actually mixing variables that are not even named the same thing, or
in similar named modules).

Reproducing the error is random at best, to see it requires a decent
amount of traffic to the modules.  I've also noticed that these issues
are 2.7.x related, and not in 3.x mp.  If you can go to Apache 2 I'd
recommend it, as there isn't a whole lot of active development on 2.7
mp; but I know that isn't always possible.

I'm working on some ways to test for this error right now, and hopefully
in a week I'll have something to post on the list with more detail.

Mike

From gah at research.att.com  Thu Mar 25 11:56:32 2004
From: gah at research.att.com (Glenn A. Hochberg)
Date: Thu Mar 25 12:51:48 2004
Subject: [mod_python] apache.import_module picks wrong module
In-Reply-To: <200403251703.i2PH3Vxl082602@slash.mediapulse.com>
References: <200403251703.i2PH3Vxl082602@slash.mediapulse.com>
Message-ID: <40630F40.4070908@research.att.com>

On Thu, 25 Mar 2004 17:30:11 +0100,
Kamil Niechajewicz <kamil@nvstudio.pl> wrote:

actually i've renamed all files that had the same names
in both applications to some, so that they all differ
now and are not messed, but it cost me alot of work
that shouldn't be necessary.

I would guess you that you need to use separate subinterpreters (see 
http://www.modpython.org/live/mod_python-2.7.8/doc-html/pyapi-interps.html).
The problem is likely that, since the two directories are sharing the 
same python interpreter, whichever one gets hit first imports the 
commonly-named module first--and once it's imported it gets cached and 
not re-imported when the other directory gets hit.  Using 
PythonInterpPerDirective would likely solve this.

    -Glenn



From mod_python at 24ksoftware.com  Thu Mar 25 10:09:03 2004
From: mod_python at 24ksoftware.com (Erik Stephens)
Date: Thu Mar 25 13:04:13 2004
Subject: [mod_python] Re: security issues?
In-Reply-To: <20040325085714.GA21027@nic.fr>
References: <40610BA5.2040703@mlug.missouri.edu>
 <Pine.LNX.4.58.0403232200200.1371@ramuh.int.24ksoftware.com>
 <20040325085714.GA21027@nic.fr>
Message-ID: <Pine.LNX.4.58.0403250931190.6718@ramuh.int.24ksoftware.com>

On Thu, 25 Mar 2004, Stephane Bortzmeyer wrote:

> > Not that I'm aware other than best practices (i.e. keep up-to-date,
> > proper configuration, don't trust user input,
>                         ^^^^^^^^^^^^^^^^^^^^^^
> Speaking of this, I do not find in Python the equivalent of Perl's
> -T switch. It is very useful to limit the risks of user-controlled
> input. Is there something like this in Python?

Doesn't look like there is such a thing.  There seem to be some
feature requests for it, though.  I wonder if there is a simpler way
than having to modify the language.  Perl and Ruby seem to only care
about tainted variables if the context is bad, like when used in a
shell command.  What if CGI script writers would have to untaint all
user inputs up front?  This would make it easier to plumb this feature
in at a higher level, like mod_python, as opposed to the language
level.

Although, now that I think about it, if the taint/untaint interface is
too annoying for programmers, then I'd imagine a lot of people would
ignore it by doing the minimal amount of work to untaint everything.
Maybe that's why the context-sensitive approach is better.  It only
squawks when it has to.

Don't really know what my point is, just random thoughts I guess :)


Best regards,
Erik
From neel at mediapulse.com  Thu Mar 25 13:54:15 2004
From: neel at mediapulse.com (Michael C. Neel)
Date: Thu Mar 25 14:49:36 2004
Subject: [mod_python] apache.import_module picks wrong module
Message-ID: <C0FC22C08B82074A88B500617641577787A887@johnson.mediapulse.net>

> I would guess you that you need to use separate subinterpreters (see 
> http://www.modpython.org/live/mod_python-2.7.8/doc-html/pyapi-
interps.html).


In our case though, it is going across virtual servers - which are
supposed to have their own subinterpreter by default.  Maybe that's not
happening correctly... it gives me a road to go down at least.

Mike

From krishna at ironport.com  Thu Mar 25 12:02:55 2004
From: krishna at ironport.com (Krishna Srinivasan)
Date: Thu Mar 25 15:58:16 2004
Subject: [mod_python] cannot import name psp
Message-ID: <Pine.BSF.4.55.0403251159460.43715@saint.ironport.com>


When I do

    from mod_python import apache
    from mod_python import psp

I get an error, but when I do

    from mod_python import apache, psp

I don't get an error.
But I still get this error every now and then -

Mod_python error: "PythonHandler mod_python.publisher"

Traceback (most recent call last):

File "/usr/local/lib/python2.2/site-packages/mod_python/apache.py", line 299, in HandlerDispatch
  result = object(req)

File "/usr/local/lib/python2.2/site-packages/mod_python/publisher.py", line 136, in handler
  result = util.apply_fs_data(object, req.form, req=req)

File "/usr/local/lib/python2.2/site-packages/mod_python/util.py", line 361, in apply_fs_data
 return object(**args)

File "/usr/home/krishna/work/head/ironport/qa/autoweb/lib/myprogram.py", line 36, in form_reply
 from mod_python import psp

ImportError: cannot import name psp


Why is this occuring only now and then ?
That too this is happening only for importing psp module.

Thanks,
Krishna.

From modpython at sandlus.de  Fri Mar 26 03:58:03 2004
From: modpython at sandlus.de (Marc O. Sandlus)
Date: Thu Mar 25 22:51:51 2004
Subject: [mod_python] using publisher as a virtual dir with apache2/mp3
Message-ID: <1080269882.19090.42.camel@luke>

Hello list,

under apache1/modpython2 I used mod_python.publisher to serve python
functions of a file called "dir.py" as the contents of a "virtual" dir,
like so:

httpd.conf:

| DocumentRoot /some/path/dir.py

and dir.py was something like:

|def file1(req):
|  return "Hello World"

Requesting http://www.mydomain.com/file1 would return "Hello world".

How can the same be achieved under
Apache/2.0.48 (Debian GNU/Linux) mod_python/3.0.4 Python/2.3.3?

The problem is that under apache2, DocumentRoot needs to be a physical
directory which "dir.py" is obviously not.

Well, I could hack some RewriteRules, but is there a more elegant way to
do this?

Thanks for any help.

--Marc


From russell at balest.com  Thu Mar 25 22:14:09 2004
From: russell at balest.com (Russell Balest)
Date: Thu Mar 25 23:08:32 2004
Subject: [mod_python] profiler under mod_python
Message-ID: <4063A001.8010603@balest.com>


    Can the profiler ( python 2.2.3 ) be run inside mod_python?   I just 
tried it and it doesn't work.  It says the function I want to time 
doesn't exist.

From davidf at sjsoft.com  Fri Mar 26 09:21:20 2004
From: davidf at sjsoft.com (David Fraser)
Date: Fri Mar 26 03:13:38 2004
Subject: [mod_python] profiler under mod_python
In-Reply-To: <4063A001.8010603@balest.com>
References: <4063A001.8010603@balest.com>
Message-ID: <4063D9F0.5050601@sjsoft.com>

Russell Balest wrote:

> Can the profiler ( python 2.2.3 ) be run inside mod_python?   I just 
> tried it and it doesn't work.  It says the function I want to time 
> doesn't exist.

Haven't tried that, but I have successfully used psyco
(psyco.sourceforge.net) to profile mod_python code. Of course, it does a
lot more...
but I found its profiling logging code is quite useful.

David

From manfred.stienstra at dwerg.net  Fri Mar 26 08:37:54 2004
From: manfred.stienstra at dwerg.net (Manfred Stienstra)
Date: Fri Mar 26 03:28:27 2004
Subject: [mod_python] using publisher as a virtual dir with apache2/mp3
Message-ID: <1080286674.16388.64.camel@ack.dwerg.net>

On Fri, 2004-03-26 at 03:58, Marc O. Sandlus wrote:
> and dir.py was something like:
> 
> |def file1(req):
> |  return "Hello World"
> 
> Requesting http://www.mydomain.com/file1 would return "Hello world".

Put this is a location or .htaccess:

SetHandler python-program
PythonHandler handler

In the python script:

from mod_python import apache

def file1(request):
    request.write("file1")

def file2(request):
    request.write("file2")

def dir1/file1(request):
    request.write("dir1/file1")

def handler(request):
    request.content_type = "text/plain"
    function = request.uri[1:].replace('/','_')
    if function[-1] == '_':
        function = function[:-1]
    try:
        function(request)
    except AttributeError: # I think (:
        return apache.DECLINED


Manfred

From toms.baugis at tietoenator.com  Fri Mar 26 12:02:51 2004
From: toms.baugis at tietoenator.com (Toms Baugis)
Date: Fri Mar 26 05:54:05 2004
Subject: [mod_python] apache.import_module picks wrong module
In-Reply-To: <4062F33B.2090707@tietoenator.com>
References: <4062F33B.2090707@tietoenator.com>
Message-ID: <4063FFCB.3080400@tietoenator.com>

funny, didn't notice that the last part of my e-mail was missing 
(http://www.modpython.org/pipermail/mod_python/2004-March/015284.html 
contains my full email)
Here is the rest of my e-mail (i was asking for help to write it 
correctly in python):

        # of arbitrary already imported modules, such as os. The
        # reason we use startswith as opposed to exact match is that
        # modules inside packages are actually in subdirectories.

        if not file or (path and not filter(file.startswith, path)):

well if I do as i did in #1, then "import \dlu\index.py" will pick 
\dlu\templates\index.py - because "\dlu\templates" really startswith "\dlu\"

problem fixed by changing path checking to following:
        file_path = file[:file.rfind('/')]
        if not file or (path and (file_path <> path)):

(if something looks not good - sorry, i am new in python)

tm





Toms Baugis wrote:

> I am using mod_python 1.3.1
>
> Have been using publisher handler for several days and got some problems.
> Here is the situation:
>
> In short, i have something like following directory structure
>
> index.py
> \dlu\index.py
> \dlu\templates\index.py
>
> all 3 files contain only one "def index" function
>
> Now try following thing:
> 1. open index.py, then \dlu\index.py then \dlu\templates\index.py
> 2. now open index.py (try several times, if you have autoreload)
>
> As result, sometimes in place of index.py you will get \dlu\index.py 
> or \dlu\templates\index.py, also in place of \dlu\index.py you will 
> sometimes get \dlu\templates\index.py
>
> Found the problem in import_module function of mod_python.apache module:
>
From kamil at nvstudio.pl  Fri Mar 26 12:39:16 2004
From: kamil at nvstudio.pl (Kamil Niechajewicz)
Date: Fri Mar 26 06:32:07 2004
Subject: [mod_python] apache.import_module picks wrong module
In-Reply-To: <C0FC22C08B82074A88B500617641577787A887@johnson.mediapulse.net>
References: <C0FC22C08B82074A88B500617641577787A887@johnson.mediapulse.net>
Message-ID: <20040326123916.6f609c70.kamil@nvstudio.pl>

On Thu, 25 Mar 2004 13:54:15 -0500
"Michael C. Neel" <neel@mediapulse.com> wrote:

> > I would guess you that you need to use separate subinterpreters (see 
> > http://www.modpython.org/live/mod_python-2.7.8/doc-html/pyapi-
> interps.html).
> 
> 
> In our case though, it is going across virtual servers - which are
> supposed to have their own subinterpreter by default.  Maybe that's not
> happening correctly... it gives me a road to go down at least.

Yes, in my case I'm using two applications under ONE VirtualHost,
using <Directory> or <Location> directives. So anyway I'd have 
one interpreter per vhost, right? 
Maybe I could just put both apps in different VirtualHosts, but
its not the best solution for me, actually. Is there any way to
do the same with PythonInterpreter for Directory/Location scope,
not only VirtualHost?

Anyway, thanks for help, Glenn, didn't know about this interpreter 
issue, I guess it will help me alot :)

/Kamil
From modpython at sandlus.de  Fri Mar 26 12:39:56 2004
From: modpython at sandlus.de (Marc O. Sandlus)
Date: Fri Mar 26 07:35:20 2004
Subject: [mod_python] using publisher as a virtual dir with apache2/mp3
In-Reply-To: <1080286674.16388.64.camel@ack.dwerg.net>
References: <1080286674.16388.64.camel@ack.dwerg.net>
Message-ID: <1080301195.19092.69.camel@luke>

Hello,

thanks a lot for your reply.

However, I still need this URI
http://www.mydomain.tld/mypythonhander/file1
to call the functions, right? I prefer
http://www.mydomain.tld/file1

Furthermore, I figured that your little script does exactly what
mod_python.publisher does, so I would like to use the publisher instead 

(I already have a site running with apache1/mp2 using the publisher, and
just want to upgrade to apache2/mp3)

Thanks for any help!

--Marc

From neel at mediapulse.com  Fri Mar 26 08:42:53 2004
From: neel at mediapulse.com (Michael C. Neel)
Date: Fri Mar 26 09:38:15 2004
Subject: [mod_python] apache.import_module picks wrong module
Message-ID: <C0FC22C08B82074A88B50061764157776B9BCF@johnson.mediapulse.net>

> In our case though, it is going across virtual servers - which are
> supposed to have their own subinterpreter by default.  Maybe 
> that's not
> happening correctly... it gives me a road to go down at least.
> 

Well, I confirmed that the correct subinterpreter is being run for the
request when a mixup occurs.  After looking at the source, 2.7.10 stores
the name of the subinterpreter in the notes table, so I was able to log
it on errors to check.  

Mike

From manfred.stienstra at dwerg.net  Sat Mar 27 17:13:33 2004
From: manfred.stienstra at dwerg.net (Manfred Stienstra)
Date: Sat Mar 27 12:04:08 2004
Subject: [mod_python] using publisher as a virtual dir with apache2/mp3
In-Reply-To: <1080301195.19092.69.camel@luke>
References: <1080286674.16388.64.camel@ack.dwerg.net>
	 <1080301195.19092.69.camel@luke>
Message-ID: <1080404013.16389.69.camel@ack.dwerg.net>

On Fri, 2004-03-26 at 12:39, Marc O. Sandlus wrote:
> 
> However, I still need this URI
> http://www.mydomain.tld/mypythonhander/file1
> to call the functions, right? I prefer
> http://www.mydomain.tld/file1
> 
> Furthermore, I figured that your little script does exactly what
> mod_python.publisher does, so I would like to use the publisher instead 

The AddHandler directive serves the directory with the handler.py
handler, so when there is a request on the directory apache will ask
mod_python to handle it. So you could use the second url, but also the
first because it doesn't matter what you put there.

I guess this is exactly what the publisher does, but this gives you a
little more control.

Manfred

From lists at webcrunchers.com  Sat Mar 27 16:40:03 2004
From: lists at webcrunchers.com (John Draper)
Date: Sat Mar 27 20:35:26 2004
Subject: [mod_python] Getting started question...
Message-ID: <738935E0-8050-11D8-9BA2-003065477776@webcrunchers.com>

Hi,

I need clarification on the manual...   First,  I'm reading the 
"Getting started"
section....  and it states...

To get the publisher handler working, you will need the following lines 
in your config:

   AddHandler mod_python .py
   PythonHandler mod_python.publisher
   PythonDebug On

Do they mean the 'httpd.conf' file?

John


From mogmios at mlug.missouri.edu  Sat Mar 27 16:53:18 2004
From: mogmios at mlug.missouri.edu (Michael)
Date: Sat Mar 27 20:48:39 2004
Subject: [mod_python] Getting started question...
In-Reply-To: <738935E0-8050-11D8-9BA2-003065477776@webcrunchers.com>
References: <738935E0-8050-11D8-9BA2-003065477776@webcrunchers.com>
Message-ID: <406621FE.6000800@mlug.missouri.edu>


> I need clarification on the manual...   First,  I'm reading the 
> "Getting started"
> section....  and it states...
>
> To get the publisher handler working, you will need the following 
> lines in your config:
>
>   AddHandler mod_python .py
>   PythonHandler mod_python.publisher
>   PythonDebug On
>
> Do they mean the 'httpd.conf' file?

Or in an .htaccess file. I think either will work although I've only 
tried putting mine in httpd.conf thus far. I don't like requiring 
file.py names so I like to do it like this instead though:

<Directory /home/webserver/localhost/xmlrpc>
        SetHandler mod_python
        PythonHandler xmlrpc
        PythonDebug On
</Directory>
From mudd at vex.net  Sat Mar 27 22:09:43 2004
From: mudd at vex.net (John Mudd)
Date: Sat Mar 27 23:05:05 2004
Subject: [mod_python] cookies, sessions, persistent dbs?
Message-ID: <1080443383.2682.204.camel@localhost.localdomain>

I'm able to create a session object, add data to it, save it (in dbm
file, I believe) and get it back for the next request.  Yeah!

I just want to see if I understand this much.

A cookie is just good for tagging a client so that it can be recognized
on the next request.  And it also allows data to persist between
requests.  The cookie data is saved on the client side.  Eventually it
expires and disappears.

Sessions also allow data to be saved between requests.  And, by using a
sessionId cookie, the data can be associated with a specific clients. 
Unlike cookies, sessions are stored on the server side and allow storing
larger amounts of data.  But, unlike cookies, the data may end up on
disk in a dbm file.

So, session objects are only needed when there's too much data to put it
all in cookies?

My session object is saved in a dbm file.  Are the sessions records
automatically deleted from the dbm file when the session expires?

Do I make a db connection persistent by simply saving the connection
variables, either in a cookie or a session object?

Thanks for any help.

John


From mod_python at 24ksoftware.com  Sat Mar 27 21:20:22 2004
From: mod_python at 24ksoftware.com (Erik Stephens)
Date: Sun Mar 28 00:15:21 2004
Subject: [mod_python] cookies, sessions, persistent dbs?
In-Reply-To: <1080443383.2682.204.camel@localhost.localdomain>
References: <1080443383.2682.204.camel@localhost.localdomain>
Message-ID: <Pine.LNX.4.58.0403272101080.6718@ramuh.int.24ksoftware.com>

On Sat, 27 Mar 2004, John Mudd wrote:

> So, session objects are only needed when there's too much data to
> put it all in cookies?

At least one major difference between storing your data in cookies
vs. a server-side session structure: cookie data must cross the
network.  So, that will affect performance and security.  You should
be able to treat server-side data as safe/untainted.  As far as
security is concerned, cookie data should be treated similarly to form
variables.


> My session object is saved in a dbm file.  Are the sessions records
> automatically deleted from the dbm file when the session expires?

Looking at the code real quick-like, it looks like they are removed
when explicitly (for lack of a better word) expired.  By explicit, I
mean the user requests a page after the timeout as been reached.  Now,
if a user never requests another page again, will the cleanup code
ever get called?  Doesn't *look* like it...


> Do I make a db connection persistent by simply saving the connection
> variables, either in a cookie or a session object?

Nope.


Best regards,
Erik

From reed at intersiege.com  Sun Mar 28 00:38:17 2004
From: reed at intersiege.com (Reed L. O'Brien)
Date: Sun Mar 28 01:30:09 2004
Subject: [mod_python] ImportError: cannot import name psp
Message-ID: <3242.66.92.163.23.1080452297.squirrel@webmail.intersiege.com>

*************************************************************
The Error

   Mod_python error: "PythonHandler mod_python.publisher"

   Traceback (most recent call last):

      File "/usr/local/lib/python2.3/site-packages/mod_python/apache.py", 
        line 332, in HandlerDispatch
      result = object(req)

      File
"/usr/local/lib/python2.3/site-packages/mod_python/publisher.py", 
line 153, in handler
      module = apache.import_module(module_name, req.get_config(), [path])

      File "/usr/local/lib/python2.3/site-packages/mod_python/apache.py",
line 499, in import_module
      module = imp.load_module(mname, f, p, d)

      File "/usr/local/www/data/intersiege/py_dir/index.py", line 31, in ?
        from mod_python import apache, psp

    ImportError: cannot import name psp
**************************************************************



**************************************************************
The System:
FreeBSD 4.9
Apache2.0.48
mod_python3.0.3 (will try upgrading to 3.1.3)
Python 2.3.3
**************************************************************



**************************************************************
http.conf
   LoadModule ..........so


   DirectoryIndex index.php index.py default.php default.py index.html

<Directory /usr/local/www/data/company/py_dir>
   AddHandler python-program .py
   #SetHandler mod_python
   #AddHandler mod_python .py
   #PythonHandler mptest
   PythonHandler mod_python.publisher
   PythonDebug On
</Directory>
***************************************************************
I have tried several variations in the config.  The only way I can get he
mod to process anything is with the
AddHandler python-program .py
set, none of the others work they all spit out the code on the page...
I am stuck.

anyone?

TIA,
reed

4.6692016090


From reed at intersiege.com  Sun Mar 28 00:42:53 2004
From: reed at intersiege.com (Reed L. O'Brien)
Date: Sun Mar 28 01:34:44 2004
Subject: [mod_python] ImportError: cannot import name psp
Message-ID: <3247.66.92.163.23.1080452573.squirrel@webmail.intersiege.com>

I apologize if this is twice my mail webmail interface timed out...
but I know sometimes it sends anyhow.


*************************************************************
The Error

   Mod_python error: "PythonHandler mod_python.publisher"

   Traceback (most recent call last):

      File "/usr/local/lib/python2.3/site-packages/mod_python/apache.py", 
        line 332, in HandlerDispatch
      result = object(req)

      File
"/usr/local/lib/python2.3/site-packages/mod_python/publisher.py", 
line 153, in handler
      module = apache.import_module(module_name, req.get_config(), [path])

      File "/usr/local/lib/python2.3/site-packages/mod_python/apache.py",
line 499, in import_module
      module = imp.load_module(mname, f, p, d)

      File "/usr/local/www/data/intersiege/py_dir/index.py", line 31, in ?
        from mod_python import apache, psp

    ImportError: cannot import name psp
**************************************************************



**************************************************************
The System:
FreeBSD 4.9
Apache2.0.48
mod_python3.0.3 (will try upgrading to 3.1.3)
Python 2.3.3
**************************************************************



**************************************************************
http.conf
   LoadModule ..........so


   DirectoryIndex index.php index.py default.php default.py index.html

<Directory /usr/local/www/data/company/py_dir>
   AddHandler python-program .py
   #SetHandler mod_python
   #AddHandler mod_python .py
   #PythonHandler mptest
   PythonHandler mod_python.publisher
   PythonDebug On
</Directory>
***************************************************************
I have tried several variations in the config.  The only way I can get he
mod to process anything is with the
AddHandler python-program .py
set, none of the others work they all spit out the code on the page...
I am stuck.

anyone?

TIA,
reed

4.6692016090


From reed at intersiege.com  Sun Mar 28 01:22:28 2004
From: reed at intersiege.com (Reed L. O'Brien)
Date: Sun Mar 28 02:17:55 2004
Subject: [mod_python] SOLVED  ImportError: cannot import name psp SOLVED
In-Reply-To: <3247.66.92.163.23.1080452573.squirrel@webmail.intersiege.com>
References: <3247.66.92.163.23.1080452573.squirrel@webmail.intersiege.com>
Message-ID: <40666F24.7090801@intersiege.com>

Upgrading to 3.1.3 seems to have fixed this.  Sorry again about the 
double email.


r


Reed L. O'Brien wrote:

>I apologize if this is twice my mail webmail interface timed out...
>but I know sometimes it sends anyhow.
>
>
>*************************************************************
>The Error
>
>   Mod_python error: "PythonHandler mod_python.publisher"
>
>   Traceback (most recent call last):
>
>      File "/usr/local/lib/python2.3/site-packages/mod_python/apache.py", 
>        line 332, in HandlerDispatch
>      result = object(req)
>
>      File
>"/usr/local/lib/python2.3/site-packages/mod_python/publisher.py", 
>line 153, in handler
>      module = apache.import_module(module_name, req.get_config(), [path])
>
>      File "/usr/local/lib/python2.3/site-packages/mod_python/apache.py",
>line 499, in import_module
>      module = imp.load_module(mname, f, p, d)
>
>      File "/usr/local/www/data/intersiege/py_dir/index.py", line 31, in ?
>        from mod_python import apache, psp
>
>    ImportError: cannot import name psp
>**************************************************************
>
>
>
>**************************************************************
>The System:
>FreeBSD 4.9
>Apache2.0.48
>mod_python3.0.3 (will try upgrading to 3.1.3)
>Python 2.3.3
>**************************************************************
>
>
>
>**************************************************************
>http.conf
>   LoadModule ..........so
>
>
>   DirectoryIndex index.php index.py default.php default.py index.html
>
><Directory /usr/local/www/data/company/py_dir>
>   AddHandler python-program .py
>   #SetHandler mod_python
>   #AddHandler mod_python .py
>   #PythonHandler mptest
>   PythonHandler mod_python.publisher
>   PythonDebug On
></Directory>
>***************************************************************
>I have tried several variations in the config.  The only way I can get he
>mod to process anything is with the
>AddHandler python-program .py
>set, none of the others work they all spit out the code on the page...
>I am stuck.
>
>anyone?
>
>TIA,
>reed
>
>4.6692016090
>
>
>_______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org
>http://mailman.modpython.org/mailman/listinfo/mod_python
>  
>

From mudd at vex.net  Sun Mar 28 05:32:04 2004
From: mudd at vex.net (John Mudd)
Date: Sun Mar 28 06:27:29 2004
Subject: [mod_python] bsddb3 magic?
Message-ID: <1080469923.2682.219.camel@localhost.localdomain>

I've been looking at bsddb3 lately.  I don't think it's quite magic,
unfortunately.  It does support concurrent updates but you can still run
into deadlocks (multi-user interference).  And when you do all but one
of the competing processes/threads loose.  And, I think, that's only if
you have the bsddb3 deadlock deamon running in the background to act as
a traffic cop.  Without the deamon I guess the processes are frozen.  Of
course, with a deamon, it's no longer very lightweight.

The same is true for a commercial product that I've used, C-Tree Plus by
Faircom.  One difference is that C-Tree doesn't require a deamon process
to resolve conflicts.  

The remedy for processes that get bumped due to deadlock is to simply
try the update again until it succeeds.

I think the mod_python developers are aware of the (rare) potential for
deadlock with anydbm.  They use the apache global lock when manipulating
the session dbm.

John


Ben ben at medianstrip.net wrote:
> sleepycat / bsddb3 handles locking automatically.  after setting 
> the environment, you can use it like a dictionary and it works
> like magic.

From mudd at vex.net  Sun Mar 28 06:40:34 2004
From: mudd at vex.net (John Mudd)
Date: Sun Mar 28 07:35:59 2004
Subject: [mod_python] persistent db connections?
Message-ID: <1080474034.2682.271.camel@localhost.localdomain>

I've looked at the following mod_python FAQ entry:

	3.3. What is the best way to make 
	persistent connections to a database?



So, I just need some global variables as in this example.

def handler(req):
                                                                        
    global  persist, conn
                                                                        
    try:
        persist += 1
        # No need to create the db connection here.
    except NameError:
        persist = 0
        conn = db.open()   # Create a db connection.


At least this is easy.  But there's no guarantee my next request will
reuse the same thread/process.  So I might (will) end up with extra db
connections in other threads/processes.  For my application that's not
so bad.

Hmmm... I may want to add code to also check if the session has changed
(e.g. the user has re-logged in).  Then close/reopen a db connection if
the user has logged in again.  That would give me an external control so
I can force a new db connection by re-logging into my application. 

And maybe I should also register a cleanup function to close the
connection.




Am I on the right track?

From mudd at vex.net  Sun Mar 28 08:11:03 2004
From: mudd at vex.net (John Mudd)
Date: Sun Mar 28 09:06:24 2004
Subject: [mod_python] persistent db connections?
In-Reply-To: <20040328124919.17413.qmail@web11507.mail.yahoo.com>
References: <20040328124919.17413.qmail@web11507.mail.yahoo.com>
Message-ID: <1080479462.2682.288.camel@localhost.localdomain>

I tend to agree with you.

I was just sitting here trying to map it out with the xmlrpclib module. 
But, you're right, there's Pyro which may be a more complete solution. 
It's temping.

Maybe I can store a pyro connection remote object in the session
object?  That would eliminate the need for a dictionary.  And, assuming
I can register a cleanup function for a session, the connection could be
automatically closed when the session expires.  

John


On Sun, 2004-03-28 at 07:49, vincent delft wrote:
> I'm not sure (because not currently tested with
> mod_python), but pyro (or xmlrpc) will solve all your
> concerns concerning concurrent access ... 
> Then the only thing to set-up is the db connection.
> 
> 
> 
> Just an idea .... throuw it away if I'm wrong.
> 
> 
> 
> --- John Mudd <mudd@vex.net> wrote:
> > I've looked at the following mod_python FAQ entry:
> > 
> > 	3.3. What is the best way to make 
> > 	persistent connections to a database?
> > 
> > 
> > 
> > So, I just need some global variables as in this
> > example.
> > 
> > def handler(req):
> >                                                     
> >                    
> >     global  persist, conn
> >                                                     
> >                    
> >     try:
> >         persist += 1
> >         # No need to create the db connection here.
> >     except NameError:
> >         persist = 0
> >         conn = db.open()   # Create a db connection.
> > 
> > 
> > At least this is easy.  But there's no guarantee my
> > next request will
> > reuse the same thread/process.  So I might (will)
> > end up with extra db
> > connections in other threads/processes.  For my
> > application that's not
> > so bad.
> > 
> > Hmmm... I may want to add code to also check if the
> > session has changed
> > (e.g. the user has re-logged in).  Then close/reopen
> > a db connection if
> > the user has logged in again.  That would give me an
> > external control so
> > I can force a new db connection by re-logging into
> > my application. 
> > 
> > And maybe I should also register a cleanup function
> > to close the
> > connection.
> > 
> > 
> > 
> > 
> > Am I on the right track?
> > 
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> >
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 
> 
> __________________________________
> Do you Yahoo!?
> Yahoo! Finance Tax Center - File online. File on time.
> http://taxes.yahoo.com/filing.html

From mudd at vex.net  Sun Mar 28 15:12:39 2004
From: mudd at vex.net (John Mudd)
Date: Sun Mar 28 16:07:59 2004
Subject: [mod_python] cgitb?
Message-ID: <1080504759.2682.296.camel@localhost.localdomain>

Adding the following to a python CGI script is great for getting the
traceback in HTML displayed on the browser.  Is there a way to use this
with mod_python in a request handler?  I use the "PythonDebug On" now in
httpd.conf and I do get traceback listed on my browser but the cgitb
report is more impressive.

	import cgitb; cgitb.enable()

From mudd at vex.net  Sun Mar 28 15:36:51 2004
From: mudd at vex.net (John Mudd)
Date: Sun Mar 28 16:32:10 2004
Subject: [mod_python] cgitb!
Message-ID: <1080506210.2682.302.camel@localhost.localdomain>

Here's how to use cgitb, copied from
http://lists.community.tummy.com/pipermail/jotweb/2003-December/000007.html



import cgitb

def handler(req):
    try:
        handler2(req)
    except:
        req.content_type = 'text/html'
        cgitb.Hook(file = req).handle()
    
    return apache.OK


def handler2(req):
    # Regular code here, no return needed.
	

From mudd at vex.net  Sun Mar 28 17:51:01 2004
From: mudd at vex.net (John Mudd)
Date: Sun Mar 28 18:46:25 2004
Subject: [mod_python] reading form responses?
Message-ID: <1080514261.2682.311.camel@localhost.localdomain>

I'm trying my first form...

In my python handle I write a form via the request object.  Is there any
way at that point to have the form displayed and get responses via
util.FieldStorage?  

Or do I just return after writing the form and wait for the handler to
be called again, recognize the state of the client (via a cookie value)
and then get responses via util.FieldStorage?

John

From mudd at vex.net  Sun Mar 28 20:18:45 2004
From: mudd at vex.net (John Mudd)
Date: Sun Mar 28 21:14:09 2004
Subject: [mod_python] reading form responses?
Message-ID: <1080523124.2682.322.camel@localhost.localdomain>

No, just specify a response URI in the Form.  That URI will be invoked
when the form is submitted by the client.  For example, in the case of a
login Form, the script will validate the Login Id and Password values. 
If the values pass then the login script can immediately redirect the
user to a URI that gives the user access to the application.

Right?

John


> Or do I just return after writing the form and wait for the handler to
> be called again, recognize the state of the client (via a cookie value)
> and then get responses via util.FieldStorage?


From manfred.stienstra at dwerg.net  Mon Mar 29 08:35:53 2004
From: manfred.stienstra at dwerg.net (Manfred Stienstra)
Date: Mon Mar 29 02:26:25 2004
Subject: [mod_python] reading form responses?
In-Reply-To: <1080523124.2682.322.camel@localhost.localdomain>
References: <1080523124.2682.322.camel@localhost.localdomain>
Message-ID: <1080542153.3318.40.camel@ack.dwerg.net>

On Mon, 2004-03-29 at 03:18, John Mudd wrote:
> No, just specify a response URI in the Form.  That URI will be invoked
> when the form is submitted by the client.  For example, in the case of a
> login Form, the script will validate the Login Id and Password values. 
> If the values pass then the login script can immediately redirect the
> user to a URI that gives the user access to the application.

Ehm, yes.

Manfred

From reed at intersiege.com  Mon Mar 29 06:40:23 2004
From: reed at intersiege.com (Reed L. O'Brien)
Date: Mon Mar 29 07:36:20 2004
Subject: [mod_python] psp_site
Message-ID: <40680B27.6020609@intersiege.com>

Right so I went to dl the psp_site example and it was pretty.  And then 
I decided to update some apps on my machine.  I upgraded  on FreeBSD 4.9

Apache2.0.48 --> 2.0.49
mod_python3.0.3 --> 3.1.3
Python 2.3.3 --> 2.3.3 patchlevel 4

and now the hover over menu is broken (is just plain  links) and it 
doesn't get the logo (broken image symbol) ....
I think it happened after I upgraded apache.  Anyone else seen this 
behavior? or have an idea what caused it?
I have tried dienstalling and reinstalling the above.  No luck.  mod_php 
still works.


TIA
reed
From reed at intersiege.com  Mon Mar 29 07:06:40 2004
From: reed at intersiege.com (Reed L. O'Brien)
Date: Mon Mar 29 08:02:40 2004
Subject: [mod_python] psp_site
In-Reply-To: <20040329114951.GA16840@mki-btc.com>
References: <40680B27.6020609@intersiege.com>
	<20040329114951.GA16840@mki-btc.com>
Message-ID: <40681150.4090807@intersiege.com>

Maybe I need an override statement in my <Directory> directive.  THese 
perms were working before I upgraded.
here is the logo perms

-rw-r--r--  1 reed  reed  7184 Mar 29 06:26 logo.gif
 
and the menu and template stuff

drwxr-xr-x  2 reed  reed     512 Mar 29 06:26 templates
-rw-r--r--  1 reed  reed     726 Mar 29 06:26 view.py
danu# ll templates/
total 16
-rw-r--r--  1 reed  reed    16 Mar 29 06:26 .htaccess
-rw-r--r--  1 reed  reed   538 Mar 28 01:56 about_body.html
-rw-r--r--  1 reed  reed  1244 Mar 28 03:16 home_body.html
-rw-r--r--  1 reed  reed  1156 Mar 29 06:26 home_body.html~
-rw-r--r--  1 reed  reed  1847 Mar 28 03:18 main_frame.html
-rw-r--r--  1 reed  reed  1447 Mar 29 06:26 main_frame.html~
-rw-r--r--  1 reed  reed   733 Jan 16 18:31 main_menu.html
-rw-r--r--  1 reed  reed   594 Mar 28 02:30 product_body.html

Volodya wrote:

>On Mon, Mar 29, 2004 at 06:40:23AM -0500, Reed L. O'Brien wrote:
>  
>
>>Right so I went to dl the psp_site example and it was pretty.  And then 
>>I decided to update some apps on my machine.  I upgraded  on FreeBSD 4.9
>>
>>Apache2.0.48 --> 2.0.49
>>mod_python3.0.3 --> 3.1.3
>>Python 2.3.3 --> 2.3.3 patchlevel 4
>>
>>and now the hover over menu is broken (is just plain  links) and it 
>>doesn't get the logo (broken image symbol) ....
>>I think it happened after I upgraded apache.  Anyone else seen this 
>>behavior? or have an idea what caused it?
>>I have tried dienstalling and reinstalling the above.  No luck.  mod_php 
>>still works.
>>    
>>
>check file/directory permissions on images
>
>
>  
>

From reed at intersiege.com  Mon Mar 29 07:25:56 2004
From: reed at intersiege.com (Reed L. O'Brien)
Date: Mon Mar 29 08:21:58 2004
Subject: [mod_python] Re: [SOLVED] psp_site
In-Reply-To: <40680B27.6020609@intersiege.com>
References: <40680B27.6020609@intersiege.com>
Message-ID: <406815D4.80407@intersiege.com>

I repeated this error with Apache 2.0.48 and 3.1.3 and figured out I had 
to change my SetHandler to make it work.  It now appears to be working OK.

<Directory /usr/local/www/data>
SetHandler mod_python  to  ------>>>> SetHandler python-program   
<<<<-----------
PythonHandler mod_python.publisher
PythonDebug On
</Directory>


 Reed L. O'Brien wrote:

> Right so I went to dl the psp_site example and it was pretty.  And 
> then I decided to update some apps on my machine.  I upgraded  on 
> FreeBSD 4.9
>
> Apache2.0.48 --> 2.0.49
> mod_python3.0.3 --> 3.1.3
> Python 2.3.3 --> 2.3.3 patchlevel 4
>
> and now the hover over menu is broken (is just plain  links) and it 
> doesn't get the logo (broken image symbol) ....
> I think it happened after I upgraded apache.  Anyone else seen this 
> behavior? or have an idea what caused it?
> I have tried dienstalling and reinstalling the above.  No luck.  
> mod_php still works.
>
>
> TIA
> reed


From reed at intersiege.com  Mon Mar 29 07:57:58 2004
From: reed at intersiege.com (Reed L. O'Brien)
Date: Mon Mar 29 08:54:05 2004
Subject: [mod_python] [NOT][SOLVED] psp_site
In-Reply-To: <406815D4.80407@intersiege.com>
References: <40680B27.6020609@intersiege.com> <406815D4.80407@intersiege.com>
Message-ID: <40681D56.5060507@intersiege.com>

I am going to give up for a while.  But here is where I now stand

AddHandler mod_python .py
       Gives a full rendering of the home page if not specified in the 
domain (domain.dom/)
        If you click a link or fill in anything after the slash 
(domain.dom/home) it returns 404

The same apparently goes for :
AddHandler python-program .py

With:
SetHandler mod_python

will render all the text and links but no images or menu colors

As will:
SetHandler python-program

Although if I an add handler and load the default page (nothing after 
trailing slash) then change to SetHandler it will render and work fine.  
But it is pulling images and such from the cache.  This is what tricked 
me into thinking it was solved earlier.  As soon as I clear the cache or 
it expires it falls back to no images and noo menu highlighting.  SO I 
need to take a break til this eve, and stop

Ideas?

Once again the set up:
Apache2.0.49
mod_python3.1.3
Python2.3.3 patchlevel 4
on freebsd 4.9



Reed L. O'Brien wrote:

> I repeated this error with Apache 2.0.48 and 3.1.3 and figured out I 
> had to change my SetHandler to make it work.  It now appears to be 
> working OK.
>
> <Directory /usr/local/www/data>
> SetHandler mod_python  to  ------>>>> SetHandler python-program   
> <<<<-----------
> PythonHandler mod_python.publisher
> PythonDebug On
> </Directory>
>
>
> Reed L. O'Brien wrote:
>
>> Right so I went to dl the psp_site example and it was pretty.  And 
>> then I decided to update some apps on my machine.  I upgraded  on 
>> FreeBSD 4.9
>>
>> Apache2.0.48 --> 2.0.49
>> mod_python3.0.3 --> 3.1.3
>> Python 2.3.3 --> 2.3.3 patchlevel 4
>>
>> and now the hover over menu is broken (is just plain  links) and it 
>> doesn't get the logo (broken image symbol) ....
>> I think it happened after I upgraded apache.  Anyone else seen this 
>> behavior? or have an idea what caused it?
>> I have tried dienstalling and reinstalling the above.  No luck.  
>> mod_php still works.
>>
>>
>> TIA
>> reed
>
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python


From grisha at modpython.org  Mon Mar 29 10:01:32 2004
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Mon Mar 29 10:56:59 2004
Subject: [mod_python] Re: [SOLVED] psp_site
In-Reply-To: <406815D4.80407@intersiege.com>
References: <40680B27.6020609@intersiege.com> <406815D4.80407@intersiege.com>
Message-ID: <20040329095808.C90273@onyx.ispol.com>


SetHandler mod_python and SetHandler python-program are absolutely
identical, so I'm not sure what you changed there.

The symptom you described in your previous e-mail about hover not working
sounds to me like the stylesheet isn't downloaded correctly. IIRC, the
example relies on some .htaccess files to make sure handlers are set
correctly;  it's possible that when you upgraded apache, you got a new
apache config which does not allow .htaccess file - check what your
AllowOverride directive says.

Grisha

On Mon, 29 Mar 2004, Reed L. O'Brien wrote:

> I repeated this error with Apache 2.0.48 and 3.1.3 and figured out I had
> to change my SetHandler to make it work.  It now appears to be working OK.
>
> <Directory /usr/local/www/data>
> SetHandler mod_python  to  ------>>>> SetHandler python-program
> <<<<-----------
> PythonHandler mod_python.publisher
> PythonDebug On
> </Directory>
>
>
>  Reed L. O'Brien wrote:
>
> > Right so I went to dl the psp_site example and it was pretty.  And
> > then I decided to update some apps on my machine.  I upgraded  on
> > FreeBSD 4.9
> >
> > Apache2.0.48 --> 2.0.49
> > mod_python3.0.3 --> 3.1.3
> > Python 2.3.3 --> 2.3.3 patchlevel 4
> >
> > and now the hover over menu is broken (is just plain  links) and it
> > doesn't get the logo (broken image symbol) ....
> > I think it happened after I upgraded apache.  Anyone else seen this
> > behavior? or have an idea what caused it?
> > I have tried dienstalling and reinstalling the above.  No luck.
> > mod_php still works.
> >
> >
> > TIA
> > reed
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From jakob at simon-gaarde.dk  Wed Mar 31 14:27:57 2004
From: jakob at simon-gaarde.dk (jakob@simon-gaarde.dk)
Date: Wed Mar 31 08:23:25 2004
Subject: [mod_python] Module loaded - Nothing is working :(
Message-ID: <26651.80.160.199.114.1080736077.squirrel@webmail1.b-one.nu>

I can't get the python interpreter running through apache. Apache seems to
totally ignore the existance of mod_python. First i started by following
the instructions found at:
http://www.modpython.org/live/current/doc-html/inst-testing.html
The result was the same as it is now after poking around in the
Directory-section I have created:

------------------------------------
Index of /mptest

 Name                    Last modified      Size  Description Parent
Directory                             -
 mptest.py               31-Mar-2004 09:56   95

Apache/2.0.49 (Unix) mod_python/3.1.3 Python/2.3.2 Server at 127.0.0.1
Port 80
------------------------------------

As you see it just lists the files in the directory :(

I have compiled apache 2.0.49 (newest right now), and mod_python 3.1.3
(also the newest).
Currently my alterations to the httpd.conf file (which by the way are the
only alterations I have made) are:

In the Global Environment section:
---------------------------------
LoadModule python_module /usr/modules/mod_python.so
---------------------------------

In the Main Server Configuration:
---------------------------------
Alias /mptest/ /usr/htdocs/test/

<Directory /mptest>
    AllowOverride FileInfo
    AddHandler python-program .py
    PythonHandler mptest
    PythonDebug On
</Directory>
---------------------------------

mptest.py:
---------------------------------
jsg-lap:/usr/htdocs/test# cat mptest.py
from mod_python import apache

def handler(req):
  req.write("Hello World!")
  return apache.OK
---------------------------------

Here is the output of apache when entering the directory
---------------------------------
jsg-lap:/usr/logs# cat access_log
127.0.0.1 - - [31/Mar/2004:14:20:58 +0200] "GET /mptest/ HTTP/1.1" 200 691
127.0.0.1 - - [31/Mar/2004:14:20:58 +0200] "GET /icons/blank.gif HTTP/1.1"
304 -
127.0.0.1 - - [31/Mar/2004:14:20:58 +0200] "GET /icons/back.gif HTTP/1.1"
304 -
127.0.0.1 - - [31/Mar/2004:14:20:58 +0200] "GET /icons/p.gif HTTP/1.1" 304 -
jsg-lap:/usr/logs# cat error_log
[Wed Mar 31 14:20:49 2004] [notice] mod_python: Creating 32 session
mutexes based on 150 max processes and 0 max threads.
[Wed Mar 31 14:20:49 2004] [notice] Apache/2.0.49 (Unix) mod_python/3.1.3
Python/2.3.2 configured -- resuming normal operations
---------------------------------

System:
Xandros Deluxe 2.0 (debian based linux distribution)

Whats wrong I have wasted hours getting nowhere :( Please help...

Best regards
Jakob Simon-Gaarde
From ccurvey at earthlink.net  Wed Mar 31 08:47:08 2004
From: ccurvey at earthlink.net (Chris Curvey)
Date: Wed Mar 31 09:36:25 2004
Subject: [mod_python] Module loaded - Nothing is working :(
In-Reply-To: <26651.80.160.199.114.1080736077.squirrel@webmail1.b-one.nu>
References: <26651.80.160.199.114.1080736077.squirrel@webmail1.b-one.nu>
Message-ID: <406ACBDC.7080207@earthlink.net>

Two thoughts:

1) What url are you going after?  If you're going to 
http://localhost/mptest, then getting an index of the files makes some 
sense.  What happens if you go after http://localhost/mptest/mptest.py ?

2) My httpd.conf is a little different.  it looks like this:

Alias /hmp/ "/home/chris/hoops/mp/mp/web/"
<Directory /home/chris/hoops/mp/mp/web>
    AddHandler mod_python .py
    PythonHandler mod_python.publisher
    PythonDebug On
</Directory>

Let us know how it turns out!

-Chris

jakob@simon-gaarde.dk wrote:

>I can't get the python interpreter running through apache. Apache seems to
>totally ignore the existance of mod_python. First i started by following
>the instructions found at:
>http://www.modpython.org/live/current/doc-html/inst-testing.html
>The result was the same as it is now after poking around in the
>Directory-section I have created:
>
>------------------------------------
>Index of /mptest
>
> Name                    Last modified      Size  Description Parent
>Directory                             -
> mptest.py               31-Mar-2004 09:56   95
>
>Apache/2.0.49 (Unix) mod_python/3.1.3 Python/2.3.2 Server at 127.0.0.1
>Port 80
>------------------------------------
>
>As you see it just lists the files in the directory :(
>
>I have compiled apache 2.0.49 (newest right now), and mod_python 3.1.3
>(also the newest).
>Currently my alterations to the httpd.conf file (which by the way are the
>only alterations I have made) are:
>
>In the Global Environment section:
>---------------------------------
>LoadModule python_module /usr/modules/mod_python.so
>---------------------------------
>
>In the Main Server Configuration:
>---------------------------------
>Alias /mptest/ /usr/htdocs/test/
>
><Directory /mptest>
>    AllowOverride FileInfo
>    AddHandler python-program .py
>    PythonHandler mptest
>    PythonDebug On
></Directory>
>---------------------------------
>
>mptest.py:
>---------------------------------
>jsg-lap:/usr/htdocs/test# cat mptest.py
>from mod_python import apache
>
>def handler(req):
>  req.write("Hello World!")
>  return apache.OK
>---------------------------------
>
>Here is the output of apache when entering the directory
>---------------------------------
>jsg-lap:/usr/logs# cat access_log
>127.0.0.1 - - [31/Mar/2004:14:20:58 +0200] "GET /mptest/ HTTP/1.1" 200 691
>127.0.0.1 - - [31/Mar/2004:14:20:58 +0200] "GET /icons/blank.gif HTTP/1.1"
>304 -
>127.0.0.1 - - [31/Mar/2004:14:20:58 +0200] "GET /icons/back.gif HTTP/1.1"
>304 -
>127.0.0.1 - - [31/Mar/2004:14:20:58 +0200] "GET /icons/p.gif HTTP/1.1" 304 -
>jsg-lap:/usr/logs# cat error_log
>[Wed Mar 31 14:20:49 2004] [notice] mod_python: Creating 32 session
>mutexes based on 150 max processes and 0 max threads.
>[Wed Mar 31 14:20:49 2004] [notice] Apache/2.0.49 (Unix) mod_python/3.1.3
>Python/2.3.2 configured -- resuming normal operations
>---------------------------------
>
>System:
>Xandros Deluxe 2.0 (debian based linux distribution)
>
>Whats wrong I have wasted hours getting nowhere :( Please help...
>
>Best regards
>Jakob Simon-Gaarde
>_______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org
>http://mailman.modpython.org/mailman/listinfo/mod_python
>
>  
>


From modpython at sandlus.de  Wed Mar 31 16:33:26 2004
From: modpython at sandlus.de (Marc O. Sandlus)
Date: Wed Mar 31 10:29:00 2004
Subject: [mod_python] Module loaded - Nothing is working :(
In-Reply-To: <26651.80.160.199.114.1080736077.squirrel@webmail1.b-one.nu>
References: <26651.80.160.199.114.1080736077.squirrel@webmail1.b-one.nu>
Message-ID: <1080743606.19087.156.camel@luke>

Hi,

> <Directory /mptest>
>     AllowOverride FileInfo
>     AddHandler python-program .py
>     PythonHandler mptest
>     PythonDebug On
> </Directory>

I had the same problem recently, and one thing I changed before the
example finally worked was to set "AllowOverride All", so you might want
to give it a try.

--Marc


-- 
It isn't easy being a Friday kind of person in a Monday kind of world.

From bart at wsisiz.edu.pl  Wed Mar 31 17:24:04 2004
From: bart at wsisiz.edu.pl (Bartlomiej Rymarski)
Date: Wed Mar 31 11:19:28 2004
Subject: [mod_python] No luck with 2.7.10
Message-ID: <Pine.LNX.4.58LT.0403311708470.18302@oceanic.wsisiz.edu.pl>

Hello, 
I'm trying to get mod_python 2.7.10 to run under apache 1.3.27 (python 
2.3.3). I have these lines in httpd.conf

#v+
LoadModule python_module /usr/lib/apache/mod_python.so

<Directory /py>
   AddHandler python-program .py
   PythonHandler mod_python.publisher
   Pythondebug On
</Directory>
#v-

No errors while restarting apache, I have a few files in /py directory. 
When I try to access the scripts through web browser I get a "404 Error", 
in httpd/error_log there's only one line:

[notice] mod_python: (Re)importing mod_python.publisher from None

Everything works without mod_python.publisher...

Is this a known issue with 1.3.x apache? I didn't have such problems with 
apache 2.x and publisher from mod_python 3.1 ...

Thanks in advance.

-- 
Bartek Rymarski <bart@wsisiz.edu.pl>
$ %blow
bash: fg: %blow: no such job
From bart at wsisiz.edu.pl  Wed Mar 31 17:45:17 2004
From: bart at wsisiz.edu.pl (Bartlomiej Rymarski)
Date: Wed Mar 31 11:40:41 2004
Subject: [mod_python] No luck with 2.7.10
In-Reply-To: <Pine.LNX.4.58LT.0403311708470.18302@oceanic.wsisiz.edu.pl>
References: <Pine.LNX.4.58LT.0403311708470.18302@oceanic.wsisiz.edu.pl>
Message-ID: <Pine.LNX.4.58LT.0403311742240.30736@oceanic.wsisiz.edu.pl>

On Wed, 31 Mar 2004, Bartlomiej Rymarski wrote:

> [...]

It's all fine... I guess not sleeping too much makes thinking hard... :)

-- 
Bartek Rymarski <bart@wsisiz.edu.pl>
$ %blow
bash: fg: %blow: no such job
From mudd at vex.net  Wed Mar 31 13:00:22 2004
From: mudd at vex.net (John Mudd)
Date: Wed Mar 31 13:55:49 2004
Subject: [mod_python] session.last_accessed() ?
Message-ID: <1080756022.2682.926.camel@localhost.localdomain>

What good is session.last_accessed() ?  

It seems to return the time that I created the session object or last
read it from disk.  Which tells me nothing of interest. 

I'd like to how long since the session was previously (if ever) saved to
disk.  Is there a way to get that?

John

From mudd at vex.net  Wed Mar 31 13:39:05 2004
From: mudd at vex.net (John Mudd)
Date: Wed Mar 31 14:34:29 2004
Subject: [mod_python] session.last_accessed() ?
In-Reply-To: <20040331182834.0C9643118D8@attrition.dynamine.net>
References: <20040331182834.0C9643118D8@attrition.dynamine.net>
Message-ID: <1080758345.2682.931.camel@localhost.localdomain>

I think I'll just put store a time stamp of my own with each session
just before I execute session.save().

John


On Wed, 2004-03-31 at 13:28, Michael S. Fischer wrote:
> Just get the mtime of the backing store file.
> 
> --Michael 
> 
> > -----Original Message-----
> > From: mod_python-bounces@modpython.org 
> > [mailto:mod_python-bounces@modpython.org] On Behalf Of John Mudd
> > Sent: Wednesday, March 31, 2004 10:00 AM
> > To: mpMailList
> > Subject: [mod_python] session.last_accessed() ?
> > 
> > What good is session.last_accessed() ?  
> > 
> > It seems to return the time that I created the session object 
> > or last read it from disk.  Which tells me nothing of interest. 
> > 
> > I'd like to how long since the session was previously (if 
> > ever) saved to disk.  Is there a way to get that?
> > 
> > John
> > 
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> > 
> > 
> > 

From grisha at modpython.org  Wed Mar 31 14:52:15 2004
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Wed Mar 31 15:47:43 2004
Subject: [mod_python] session.last_accessed() ?
In-Reply-To: <1080756022.2682.926.camel@localhost.localdomain>
References: <1080756022.2682.926.camel@localhost.localdomain>
Message-ID: <20040331145107.R35764@onyx.ispol.com>


This is a bug clearly... I suppose a workaround would be to store your own
date until we have this fixed.

Grisha

On Wed, 31 Mar 2004, John Mudd wrote:

> What good is session.last_accessed() ?
>
> It seems to return the time that I created the session object or last
> read it from disk.  Which tells me nothing of interest.
>
> I'd like to how long since the session was previously (if ever) saved to
> disk.  Is there a way to get that?
>
> John
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From mudd at vex.net  Wed Mar 31 15:02:21 2004
From: mudd at vex.net (John Mudd)
Date: Wed Mar 31 15:57:49 2004
Subject: [mod_python] session.last_accessed() ?
In-Reply-To: <20040331145107.R35764@onyx.ispol.com>
References: <1080756022.2682.926.camel@localhost.localdomain>
	 <20040331145107.R35764@onyx.ispol.com>
Message-ID: <1080763341.2682.964.camel@localhost.localdomain>

Thanks.

I started to add my own time stamp and then realized that even that
won't solve my original problem.  

What I really want to know if whether a new session object was created
because (1) there was never a session for this client before or (2) the
previous session has since expired.  I can tell if a session object is
new thanks to the is_new() method but not whether an old session
expired.  If I know then I can tell the client user why they have to
login again (e.g. the session expired).

John


On Wed, 2004-03-31 at 14:52, Gregory (Grisha) Trubetskoy wrote:
> This is a bug clearly... I suppose a workaround would be to store your own
> date until we have this fixed.
> 
> Grisha
> 
> On Wed, 31 Mar 2004, John Mudd wrote:
> 
> > What good is session.last_accessed() ?
> >
> > It seems to return the time that I created the session object or last
> > read it from disk.  Which tells me nothing of interest.
> >
> > I'd like to how long since the session was previously (if ever) saved to
> > disk.  Is there a way to get that?
> >
> > John
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >

From bill at immosys.com  Wed Mar 31 14:13:52 2004
From: bill at immosys.com (Bill Anderson)
Date: Wed Mar 31 17:15:36 2004
Subject: [mod_python] session.last_accessed() ?
In-Reply-To: <1080763341.2682.964.camel@localhost.localdomain>
References: <1080756022.2682.926.camel@localhost.localdomain>
	 <20040331145107.R35764@onyx.ispol.com>
	 <1080763341.2682.964.camel@localhost.localdomain>
Message-ID: <1080767632.20064.92.camel@locutus>

On Wed, 2004-03-31 at 13:02, John Mudd wrote:
> Thanks.
> 
> I started to add my own time stamp and then realized that even that
> won't solve my original problem.  
> 
> What I really want to know if whether a new session object was created
> because (1) there was never a session for this client before or (2) the
> previous session has since expired.  I can tell if a session object is
> new thanks to the is_new() method but not whether an old session
> expired.  If I know then I can tell the client user why they have to
> login again (e.g. the session expired).

Hmmm you could store a cookie with a value of "has logged in before" or
go with a "Your session may have expired or you have not logged in using
this browser before".

Or if you store user data somewhere (some sort of DB) you might have a
flag that indicates if they have logged in before and act accordingly as
well.

Just some thoughts.


-- 
Bill Anderson <bill@immosys.com>
Immosys LLC

From mudd at vex.net  Wed Mar 31 19:33:40 2004
From: mudd at vex.net (John Mudd)
Date: Wed Mar 31 20:29:23 2004
Subject: [mod_python] session.last_accessed() ?
In-Reply-To: <1080767632.20064.92.camel@locutus>
References: <1080756022.2682.926.camel@localhost.localdomain>
	 <20040331145107.R35764@onyx.ispol.com>
	 <1080763341.2682.964.camel@localhost.localdomain>
	 <1080767632.20064.92.camel@locutus>
Message-ID: <1080779619.2682.967.camel@localhost.localdomain>

Yep, I'm going with your second option for now.  It just seems like a
lot of db hits for something that the Session constructor probably
already has access to.

Thanks,
John


On Wed, 2004-03-31 at 16:13, Bill Anderson wrote:
> On Wed, 2004-03-31 at 13:02, John Mudd wrote:
> > Thanks.
> > 
> > I started to add my own time stamp and then realized that even that
> > won't solve my original problem.  
> > 
> > What I really want to know if whether a new session object was created
> > because (1) there was never a session for this client before or (2) the
> > previous session has since expired.  I can tell if a session object is
> > new thanks to the is_new() method but not whether an old session
> > expired.  If I know then I can tell the client user why they have to
> > login again (e.g. the session expired).
> 
> Hmmm you could store a cookie with a value of "has logged in before" or
> go with a "Your session may have expired or you have not logged in using
> this browser before".
> 
> Or if you store user data somewhere (some sort of DB) you might have a
> flag that indicates if they have logged in before and act accordingly as
> well.
> 
> Just some thoughts.
> 

