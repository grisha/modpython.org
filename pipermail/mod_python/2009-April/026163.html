<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Problem with caching
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Problem%20with%20caching&In-Reply-To=bb1c004d0904031615n58d323a3hd50c684008600a3%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026162.html">
   <LINK REL="Next"  HREF="026164.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Problem with caching</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Problem%20with%20caching&In-Reply-To=bb1c004d0904031615n58d323a3hd50c684008600a3%40mail.gmail.com"
       TITLE="[mod_python] Problem with caching">graham.dumpleton at gmail.com
       </A><BR>
    <I>Fri Apr  3 19:28:55 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="026162.html">[mod_python] Problem with caching
</A></li>
        <LI>Next message: <A HREF="026164.html">[SPAM] Re: [mod_python] Problem with caching
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26163">[ date ]</a>
              <a href="thread.html#26163">[ thread ]</a>
              <a href="subject.html#26163">[ subject ]</a>
              <a href="author.html#26163">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>2009/4/4 Aaron Scott Hildebrandt &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">aaron.hildebrandt at gmail.com</A>&gt;:
&gt;<i> This is my first time working with mod_python. One thing that I wasn't
</I>&gt;<i> prepared for was dealing with persistence. I have an app that I'm
</I>&gt;<i> trying to make work through mod_python, but everything goes to hell
</I>&gt;<i> the moment there's multiple users.
</I>&gt;<i>
</I>&gt;<i> The way it's supposed to work is like this:
</I>&gt;<i>
</I>&gt;<i> The page is accessed. A number of variables are loaded. The user
</I>&gt;<i> changes some of the variables, the changes are saved to a pickled
</I>&gt;<i> file. The next time the user loads the page, those saved variable
</I>&gt;<i> values are loaded back in.
</I>&gt;<i>
</I>&gt;<i> The problem is, as soon as the variables have been changed, if anyone
</I>&gt;<i> accesses the page in the near future, they'll see those changed
</I>&gt;<i> variables. Here's where it really starts driving me insane: a lot of
</I>&gt;<i> the time, that second user will see the changed variables even if he
</I>&gt;<i> has his own pickled file that has been loaded and was supposed to
</I>&gt;<i> overwrite them.
</I>&gt;<i>
</I>&gt;<i> For example:
</I>&gt;<i>
</I>&gt;<i> I have a file with the variable &quot;x = 0&quot;. A user changes the value to
</I>&gt;<i> &quot;x = 5&quot;, and that change is saved to a pickled file (tied to a session
</I>&gt;<i> ID).
</I>&gt;<i>
</I>&gt;<i> A second user accesses the page, where the value is now &quot;x = 5&quot;. He
</I>&gt;<i> changed the value to &quot;x = 10&quot;. This is saved to his own pickled file.
</I>&gt;<i>
</I>&gt;<i> The first user returns to the site. Since he's returning, his pickled
</I>&gt;<i> file, with &quot;x = 5&quot;, is loaded. Except, when he looks at the data, he
</I>&gt;<i> sees &quot;x = 10&quot;, even though that variable was supposed to have been
</I>&gt;<i> changed to &quot;5&quot; when his file loaded.
</I>&gt;<i>
</I>&gt;<i> A more direct code example:
</I>&gt;<i>
</I>&gt;<i> The module lab.game has the class InitGame, which contains &quot;daemons =
</I>&gt;<i> {}&quot;. There's an instance of this class called &quot;settings&quot;.
</I>&gt;<i>
</I>&gt;<i> A user runs the code, resulting in some values in &quot;daemons&quot;:
</I>&gt;<i> &quot;{'berry2': 3, 'berry3': 5, 'berry1': 7}&quot;. These are pickled. The next
</I>&gt;<i> user runs the code. I put this in to make sure &quot;daemons&quot; is getting
</I>&gt;<i> reset:
</I>&gt;<i>
</I>&gt;<i> &#160; &#160; &#160; &#160;req.write(str(lab.game.settings.daemons))
</I>&gt;<i> &#160; &#160; &#160; &#160;del lab.game.settings
</I>&gt;<i> &#160; &#160; &#160; &#160;try: req.write(str(lab.game.settings.daemons))
</I>&gt;<i> &#160; &#160; &#160; &#160;except: req.write(&quot;failed&quot;)
</I>&gt;<i> &#160; &#160; &#160; &#160;lab.game.settings = lab.game.InitGame()
</I>&gt;<i> &#160; &#160; &#160; &#160;req.write(str(lab.game.settings.daemons))
</I>&gt;<i>
</I>&gt;<i> Okay, that should wipe out any of the values and leave us with a clean
</I>&gt;<i> slate, right? But no, it doesn't. This is the output:
</I>&gt;<i>
</I>&gt;<i> &#160; &#160; &#160; &#160;{'berry2': 3, 'berry3': 5, 'berry1': 7}failed{'berry2': 3,
</I>&gt;<i> 'berry3': 5, 'berry1': 7}
</I>&gt;<i>
</I>&gt;<i> So, even if I try deleting the variable itself, the moment I try to
</I>&gt;<i> reinitialize it, the old values return.
</I>&gt;<i>
</I>&gt;<i> Does anyone know what I'm doing wrong, or if there's any way I can
</I>&gt;<i> just kill mod_python's persistence altogether?
</I>
Apache is a multiprocess web server and if using worker MPM each
process can be multithreaded as well. It sounds like your application
may not be dealing properly with one or the other. Read:

  <A HREF="http://www.dscpl.com.au/wiki/ModPython/Articles/TheProcessInterpreterModel">http://www.dscpl.com.au/wiki/ModPython/Articles/TheProcessInterpreterModel</A>

Is the data you are changing global? Are you expected global data to
be the same between requests?

See summary in that document about shared data.

The provide more details about where these variables are that you are
changing. Ie., what context, global, local, session etc.

Graham

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026162.html">[mod_python] Problem with caching
</A></li>
	<LI>Next message: <A HREF="026164.html">[SPAM] Re: [mod_python] Problem with caching
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26163">[ date ]</a>
              <a href="thread.html#26163">[ thread ]</a>
              <a href="subject.html#26163">[ subject ]</a>
              <a href="author.html#26163">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
