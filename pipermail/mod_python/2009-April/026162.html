<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Problem with caching
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Problem%20with%20caching&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026161.html">
   <LINK REL="Next"  HREF="026163.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Problem with caching</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Aaron Scott Hildebrandt</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Problem%20with%20caching&In-Reply-To="
       TITLE="[mod_python] Problem with caching">aaron.hildebrandt at gmail.com
       </A><BR>
    <I>Fri Apr  3 19:15:32 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="026161.html">[mod_python] _hashlib fails to load
</A></li>
        <LI>Next message: <A HREF="026163.html">[mod_python] Problem with caching
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26162">[ date ]</a>
              <a href="thread.html#26162">[ thread ]</a>
              <a href="subject.html#26162">[ subject ]</a>
              <a href="author.html#26162">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is my first time working with mod_python. One thing that I wasn't
prepared for was dealing with persistence. I have an app that I'm
trying to make work through mod_python, but everything goes to hell
the moment there's multiple users.

The way it's supposed to work is like this:

The page is accessed. A number of variables are loaded. The user
changes some of the variables, the changes are saved to a pickled
file. The next time the user loads the page, those saved variable
values are loaded back in.

The problem is, as soon as the variables have been changed, if anyone
accesses the page in the near future, they'll see those changed
variables. Here's where it really starts driving me insane: a lot of
the time, that second user will see the changed variables even if he
has his own pickled file that has been loaded and was supposed to
overwrite them.

For example:

I have a file with the variable &quot;x = 0&quot;. A user changes the value to
&quot;x = 5&quot;, and that change is saved to a pickled file (tied to a session
ID).

A second user accesses the page, where the value is now &quot;x = 5&quot;. He
changed the value to &quot;x = 10&quot;. This is saved to his own pickled file.

The first user returns to the site. Since he's returning, his pickled
file, with &quot;x = 5&quot;, is loaded. Except, when he looks at the data, he
sees &quot;x = 10&quot;, even though that variable was supposed to have been
changed to &quot;5&quot; when his file loaded.

A more direct code example:

The module lab.game has the class InitGame, which contains &quot;daemons =
{}&quot;. There's an instance of this class called &quot;settings&quot;.

A user runs the code, resulting in some values in &quot;daemons&quot;:
&quot;{'berry2': 3, 'berry3': 5, 'berry1': 7}&quot;. These are pickled. The next
user runs the code. I put this in to make sure &quot;daemons&quot; is getting
reset:

        req.write(str(lab.game.settings.daemons))
        del lab.game.settings
	try: req.write(str(lab.game.settings.daemons))
	except: req.write(&quot;failed&quot;)
        lab.game.settings = lab.game.InitGame()
        req.write(str(lab.game.settings.daemons))

Okay, that should wipe out any of the values and leave us with a clean
slate, right? But no, it doesn't. This is the output:

        {'berry2': 3, 'berry3': 5, 'berry1': 7}failed{'berry2': 3,
'berry3': 5, 'berry1': 7}

So, even if I try deleting the variable itself, the moment I try to
reinitialize it, the old values return.

Does anyone know what I'm doing wrong, or if there's any way I can
just kill mod_python's persistence altogether?

Thanks,
Aaron

-- 
Aaron Scott Hildebrandt
andcuriouser.com
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026161.html">[mod_python] _hashlib fails to load
</A></li>
	<LI>Next message: <A HREF="026163.html">[mod_python] Problem with caching
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26162">[ date ]</a>
              <a href="thread.html#26162">[ thread ]</a>
              <a href="subject.html#26162">[ subject ]</a>
              <a href="author.html#26162">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
