<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Cookies not persisting 
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Cookies%20not%20persisting%20&In-Reply-To=464366E3.8030800%40ryankaskel.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023591.html">
   <LINK REL="Next"  HREF="023598.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Cookies not persisting </H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>John Raines</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Cookies%20not%20persisting%20&In-Reply-To=464366E3.8030800%40ryankaskel.com"
       TITLE="[mod_python] Cookies not persisting ">jrraines at comcast.net
       </A><BR>
    <I>Thu May 10 19:30:32 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="023591.html">[mod_python] Cookies not persisting 
</A></li>
        <LI>Next message: <A HREF="023598.html">[mod_python] Cookies not persisting
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23596">[ date ]</a>
              <a href="thread.html#23596">[ thread ]</a>
              <a href="subject.html#23596">[ subject ]</a>
              <a href="author.html#23596">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Syntax of the Set-Cookie HTTP Response Header

This is the format a CGI script would use to add to the HTTP headers  
a new piece of data which is to be stored by the client for later  
retrieval.
Set-Cookie: NAME=VALUE; expires=DATE;
path=PATH; domain=DOMAIN_NAME; secure
NAME=VALUE
This string is a sequence of characters excluding semi-colon, comma  
and white space. If there is a need to place such data in the name or  
value, some encoding method such as URL style %XX encoding is  
recommended, though no encoding is defined or required.
This is the only required attribute on the Set-Cookie header.

expires=DATE
The expires attribute specifies a date string that defines the valid  
life time of that cookie. Once the expiration date has been reached,  
the cookie will no longer be stored or given out.
The date string is formatted as:
Wdy, DD-Mon-YYYY HH:MM:SS GMT
This is based on RFC 822, RFC 850, RFC 1036, and RFC 1123, with the  
variations that the only legal time zone is GMT and the separators  
between the elements of the date must be dashes.
expires is an optional attribute. If not specified, the cookie will  
expire when the user's session ends.



So if you don't specify, the cookie disappears when the browser quits.


On May 10, 2007, at 1:39 PM, Ryan Kaskel wrote:

&gt;<i> I am trying to fiddle around with AJAX but before I can get to that  
</I>&gt;<i> part I need to make a little test login system will automatically  
</I>&gt;<i> log the user in if a cookie is found. The problem is when I close  
</I>&gt;<i> the browser the cookie is deleted. Everything else should work  
</I>&gt;<i> (when I click the logout button I am still staying logged in  
</I>&gt;<i> because it found the cookie). Does it have something to do with my  
</I>&gt;<i> browser or an attribute I am not setting when I create the cookie.
</I>&gt;<i>
</I>&gt;<i> Thanks,
</I>&gt;<i> Ryan
</I>&gt;<i>
</I>&gt;<i> below is the code:
</I>&gt;<i>
</I>&gt;<i> import time
</I>&gt;<i> from mod_python import util
</I>&gt;<i> from mod_python import Session, Cookie
</I>&gt;<i>
</I>&gt;<i> username = &quot;test&quot;
</I>&gt;<i> password = &quot;pass&quot;
</I>&gt;<i>
</I>&gt;<i> main_page2 = &quot;&quot;&quot;
</I>&gt;<i> &lt;html&gt;
</I>&gt;<i> &lt;head&gt;
</I>&gt;<i>  &lt;title&gt;Main&lt;/title&gt;
</I>&gt;<i> &lt;/head&gt;
</I>&gt;<i> &lt;body&gt;
</I>&gt;<i>  Welcome!
</I>&gt;<i>  &lt;p&gt; &lt;a href=\&quot;./logout\&quot;&gt;Logout&lt;/a&gt; &lt;/p&gt;
</I>&gt;<i> &lt;/body&gt;
</I>&gt;<i> &lt;/html&gt;
</I>&gt;<i> &quot;&quot;&quot;
</I>&gt;<i>
</I>&gt;<i> login_page = &quot;&quot;&quot;
</I>&gt;<i> &lt;html&gt;
</I>&gt;<i> &lt;head&gt;
</I>&gt;<i>  &lt;title&gt;Login&lt;/title&gt;
</I>&gt;<i> &lt;/head&gt;
</I>&gt;<i> &lt;body&gt;
</I>&gt;<i>  &lt;h1&gt;Please login&lt;/h1&gt;
</I>&gt;<i>  &lt;form action=\&quot;./login\&quot; method=\&quot;POST\&quot;&gt;
</I>&gt;<i>   Username &lt;input type=\&quot;text\&quot; name=\&quot;user\&quot;/&gt; &lt;br/&gt;
</I>&gt;<i>   Password &lt;input type=\&quot;text\&quot; name=\&quot;pass\&quot;/&gt; &lt;br/&gt;
</I>&gt;<i>   Remember me? &lt;input type=\&quot;checkbox\&quot; name=\&quot;remember\&quot;/&gt; &lt;br/&gt;
</I>&gt;<i>   &lt;button type=\&quot;submit\&quot;&gt;Login&lt;/button&gt;
</I>&gt;<i>  &lt;/form&gt;
</I>&gt;<i> &lt;/body&gt;
</I>&gt;<i> &lt;/html&gt;
</I>&gt;<i> &quot;&quot;&quot;
</I>&gt;<i> def main(req):
</I>&gt;<i>    req.content_type = 'text/html'
</I>&gt;<i>    main_page = main_page2
</I>&gt;<i>    session = Session.Session(req)
</I>&gt;<i>    cookies = Cookie.get_cookies(req, Cookie.MarshalCookie,  
</I>&gt;<i> secret=&quot;example&quot;)
</I>&gt;<i>    if cookies.has_key('example1'):
</I>&gt;<i>        cookie = cookies['example1']
</I>&gt;<i>        if type(cookie) is Cookie.MarshalCookie:
</I>&gt;<i>            data = cookie.value
</I>&gt;<i>            main_page = data['user'] + &quot; &quot; + data['passw'] + main_page
</I>&gt;<i>            session['valid'] = 'true'
</I>&gt;<i>            session.save()
</I>&gt;<i>    else:
</I>&gt;<i>        if session.is_new():
</I>&gt;<i>            util.redirect(req,'./login')
</I>&gt;<i>        if session['valid'] != 'true':
</I>&gt;<i>            util.redirect(req,'./login')
</I>&gt;<i>    req.write(main_page)
</I>&gt;<i>
</I>&gt;<i> def login(req):
</I>&gt;<i>    req.content_type = &quot;text/html&quot;
</I>&gt;<i>    if req.method == 'POST':
</I>&gt;<i>        if req.form['user'] == username and req.form['pass'] ==  
</I>&gt;<i> password:
</I>&gt;<i>            session = Session.Session(req)
</I>&gt;<i>            session['valid'] = 'true'
</I>&gt;<i>            session.save()
</I>&gt;<i>            if req.form.has_key('remember') and req.form['remember']:
</I>&gt;<i>                value = {'user': req.form['user'], 'passw': req.form 
</I>&gt;<i> ['pass']}
</I>&gt;<i>                Cookie.add_cookie(req, Cookie.MarshalCookie 
</I>&gt;<i> ('example1', value,'example'), expires=time.time() + 3000000)
</I>&gt;<i>            util.redirect(req,'./main')
</I>&gt;<i>        else:
</I>&gt;<i>            req.write(&quot;bad credentials&quot;)
</I>&gt;<i>    else:
</I>&gt;<i>        req.write(str(Cookie.get_cookies(req, Cookie.MarshalCookie,  
</I>&gt;<i> secret='example')))
</I>&gt;<i>        req.write(login_page)
</I>&gt;<i>
</I>&gt;<i> def logout(req):
</I>&gt;<i>    req.content_type = &quot;text/html&quot;
</I>&gt;<i>    session = Session.Session(req)
</I>&gt;<i>    if session.has_key('valid'):
</I>&gt;<i>        session.delete()
</I>&gt;<i>    util.redirect(req,'./main')
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070510/4fe9e702/attachment-0001.html">http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070510/4fe9e702/attachment-0001.html</A>
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023591.html">[mod_python] Cookies not persisting 
</A></li>
	<LI>Next message: <A HREF="023598.html">[mod_python] Cookies not persisting
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23596">[ date ]</a>
              <a href="thread.html#23596">[ thread ]</a>
              <a href="subject.html#23596">[ subject ]</a>
              <a href="author.html#23596">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
