<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] import_module is case sensitive even if the OS isn't
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20import_module%20is%20case%20sensitive%20even%20if%20the%20OS%20isn%27t&In-Reply-To=b26b30150705111347u2884083fo162c2cf9fc6809e6%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023603.html">
   <LINK REL="Next"  HREF="023605.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] import_module is case sensitive even if the OS isn't</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20import_module%20is%20case%20sensitive%20even%20if%20the%20OS%20isn%27t&In-Reply-To=b26b30150705111347u2884083fo162c2cf9fc6809e6%40mail.gmail.com"
       TITLE="[mod_python] import_module is case sensitive even if the OS isn't">graham.dumpleton at gmail.com
       </A><BR>
    <I>Fri May 11 20:06:57 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="023603.html">[mod_python] import_module is case sensitive even if the OS isn't
</A></li>
        <LI>Next message: <A HREF="023605.html">[mod_python] dot dot in the url
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23604">[ date ]</a>
              <a href="thread.html#23604">[ thread ]</a>
              <a href="subject.html#23604">[ subject ]</a>
              <a href="author.html#23604">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The _check_directory() method will also need to be changed in some way
to ensure the integrity checks work also. Ie.

    if directory in sys.path:

need to change to:

    if directory in map(os.path.normcase, sys.path):

What happens though if Windows is being asked to mount a remote file
system which is case sensitive and files were being loaded from there.
Are files on such a file system seen as case sensitive. If they are
then the changes can't be made. Can anyone comment on the remote file
system example and how case is handled for files from that?

Also, are there any native file systems on Windows that are case
sensitive. On Mac OS X the default file system is case insensitive,
but one can use case sensitive local file systems as well.

Finally, with such a change log messages and error pages are going to
now show lower case paths which may confuse people if the original
path used mixed case.

It is because of these issues that I may have originally not applied
os.path.normcase() to paths and basically taken the viewpoint that
users should just get their paths consistent in the first place as too
hard otherwise.

Graham

On 12/05/07, simon holness &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">simon.holness at gmail.com</A>&gt; wrote:
&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> I've found an apparent issue with apache.import_module() - it seems to
</I>&gt;<i> key the module on a case sensitive path/name even if the operating
</I>&gt;<i> system (i.e. windows) doesn't. Thus a module can be wrongly loaded
</I>&gt;<i> twice by using different capitalisation in different import requests.
</I>&gt;<i>
</I>&gt;<i> For most applications this will not be an issue since the separately
</I>&gt;<i> loaded modules will be distinct. If, however, and application is
</I>&gt;<i> relying on a module being loaded only once per interpreter (yeah,
</I>&gt;<i> guess which case I've got) it can cause problems.
</I>&gt;<i>
</I>&gt;<i> This can be trivially reproduced by importing the same module twice
</I>&gt;<i> with differing pathnames.
</I>&gt;<i>
</I>&gt;<i> e.g.
</I>&gt;<i>
</I>&gt;<i> mytest.psp
</I>&gt;<i> -------------------------
</I>&gt;<i> &lt;%
</I>&gt;<i> mod1 = apache.import_module(&quot;c:\\work\\Webroot\\mymodule.py&quot;) # nb cap W
</I>&gt;<i> mod2 = apache.import_module(&quot;c:\\work\\webroot\\mymodule.py&quot;)
</I>&gt;<i> %&gt;
</I>&gt;<i> &lt;html&gt;
</I>&gt;<i> &lt;head&gt;&lt;title&gt;&lt;/title&gt;&lt;/head&gt;
</I>&gt;<i> &lt;body&gt;go read your apache error log to see what got loaded&lt;/body&gt;
</I>&gt;<i> &lt;/html&gt;
</I>&gt;<i> ------------------------
</I>&gt;<i> mymodule.py
</I>&gt;<i> ------------------------
</I>&gt;<i> # I'm a very boring module
</I>&gt;<i> pass
</I>&gt;<i> ------------------------
</I>&gt;<i>
</I>&gt;<i> error.log contains
</I>&gt;<i> ------------------------
</I>&gt;<i> ....
</I>&gt;<i> ... Importing module 'c:\\work\\Webroot\\mymodule.py'
</I>&gt;<i> ... Importing module 'c:\\work\\webroot\\mymodule.py'
</I>&gt;<i>
</I>&gt;<i> This, obviously, won't be an issue on any case-sensitive OS (*nix).
</I>&gt;<i>
</I>&gt;<i> Having had a quick look at the code (and run a very simple test) it
</I>&gt;<i> appears that altering importer.py line 454 to
</I>&gt;<i>
</I>&gt;<i> file = os.path.normcase(os.path.normpath(file))
</I>&gt;<i>
</I>&gt;<i> fixes the issue.
</I>&gt;<i> I haven't looked to see if there are other places where the path would
</I>&gt;<i> need to be normalised. Possibly in _setup_current_cache() ?
</I>&gt;<i>
</I>&gt;<i> normcase() should be safe &amp; correct on both types of system.
</I>&gt;<i>
</I>&gt;<i> Cheers
</I>&gt;<i> Simon Holness
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i>
</I></PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023603.html">[mod_python] import_module is case sensitive even if the OS isn't
</A></li>
	<LI>Next message: <A HREF="023605.html">[mod_python] dot dot in the url
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23604">[ date ]</a>
              <a href="thread.html#23604">[ thread ]</a>
              <a href="subject.html#23604">[ subject ]</a>
              <a href="author.html#23604">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
