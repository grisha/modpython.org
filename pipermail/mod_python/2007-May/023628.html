<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] import_module is case sensitive even if the OS isn't
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20import_module%20is%20case%20sensitive%20even%20if%20the%20OS%20isn%27t&In-Reply-To=b26b30150705140709o5221945fs8218a9fb5e7cd6a5%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023617.html">
   <LINK REL="Next"  HREF="023630.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] import_module is case sensitive even if the OS isn't</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20import_module%20is%20case%20sensitive%20even%20if%20the%20OS%20isn%27t&In-Reply-To=b26b30150705140709o5221945fs8218a9fb5e7cd6a5%40mail.gmail.com"
       TITLE="[mod_python] import_module is case sensitive even if the OS isn't">graham.dumpleton at gmail.com
       </A><BR>
    <I>Mon May 14 20:24:10 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="023617.html">[mod_python] import_module is case sensitive even if the OS isn't
</A></li>
        <LI>Next message: <A HREF="023630.html">[mod_python] import_module is case sensitive even if the OS isn't
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23628">[ date ]</a>
              <a href="thread.html#23628">[ thread ]</a>
              <a href="subject.html#23628">[ subject ]</a>
              <a href="author.html#23628">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 15/05/07, Simon Holness &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">simon.holness at gmail.com</A>&gt; wrote:
&gt;<i> normcase() could also be used just to produce the label used to key
</I>&gt;<i> the module within the cache, rather than performing the lookup / file
</I>&gt;<i> operations on a case-munged path. Thus file-system interraction (e.g.
</I>&gt;<i> using a case-sensitive file system where normcase doesn't expect it).
</I>&gt;<i>
</I>&gt;<i> e.g.    label = self._module_label(os.path.normcase(file))
</I>
This is the change I was thinking of rather than change the full path
name itself. That way any error messages at the time will be what the
user used. The only thing which would show as different would be the
__file__ attribute in the module may use different case to what you
might originally have used when two different places use versions of
path which differ by case.

&gt;<i> This use of normcase() would only &quot;break&quot; things if you were loading
</I>&gt;<i> modules from two paths which differed only by case (after a normpath()
</I>&gt;<i> operation, I think?) on an OS which is (normally) case insensitive,
</I>&gt;<i> which is a fairly pathological and ill-advised thing to be doing.
</I>
All equivalence checks in the cache are done by the label and not the
path, so I don't see any cases where doing this would be a problem.

&gt;<i> Having just looked at the code, all the os.path stuff is specific to
</I>&gt;<i> operating system - posix / NT / mac. I would assume that these
</I>&gt;<i> behaviours are also embedded pretty deeply elsewhere in python.
</I>&gt;<i>
</I>&gt;<i> I'm just a little wary about having import_path silently deviate from
</I>&gt;<i> its stated behaviour (&quot;distinguishing modules by location&quot;).
</I>
One can still get unexpected behaviour if there are symlinks. One
could also apply os.path.realpath() to eliminate symlink issues on
platforms which support them, but this would slow things down further.
Also would break code where code assumes it can use
os.path.dirname(__file__) to determine a bas directory as the real
file can be in a totally different location. Thus why I don't try and
load just one module instance where multiple symlinks point to one
physical file.

&gt;<i> I was
</I>&gt;<i> watching imports carefully so spotted it, but I would imagine most
</I>&gt;<i> people would struggle to understand why &quot;~/mymodule&quot; and
</I>&gt;<i> &quot;c:\mypath\mymodule&quot; was causing the module to be loaded twice even
</I>&gt;<i> though it's in the same location.
</I>
What are you expecting '~/' to resolve to? In the mod_python module
importer '~/' is resolved to be the directory the handler was
designated for. It should replace the '~/' with the actual value and
if that happened to be 'c:/mypath', the final path should be the same
and there should only be one module loaded, not two. Thus if you are
seeing two modules may be a bug.

Graham
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023617.html">[mod_python] import_module is case sensitive even if the OS isn't
</A></li>
	<LI>Next message: <A HREF="023630.html">[mod_python] import_module is case sensitive even if the OS isn't
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23628">[ date ]</a>
              <a href="thread.html#23628">[ thread ]</a>
              <a href="subject.html#23628">[ subject ]</a>
              <a href="author.html#23628">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
