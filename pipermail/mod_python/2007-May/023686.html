<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] StringField patch for 3.3.10
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20StringField%20patch%20for%203.3.10&In-Reply-To=46560578.1080503%40teamsystem.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023685.html">
   <LINK REL="Next"  HREF="023688.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] StringField patch for 3.3.10</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20StringField%20patch%20for%203.3.10&In-Reply-To=46560578.1080503%40teamsystem.com"
       TITLE="[mod_python] StringField patch for 3.3.10">graham.dumpleton at gmail.com
       </A><BR>
    <I>Thu May 24 18:18:56 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="023685.html">[mod_python] StringField patch for 3.3.10
</A></li>
        <LI>Next message: <A HREF="023688.html">[mod_python] StringField patch for 3.3.10
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23686">[ date ]</a>
              <a href="thread.html#23686">[ thread ]</a>
              <a href="subject.html#23686">[ subject ]</a>
              <a href="author.html#23686">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>We can look at your changes, but the documentation does say about the
Field class:

&quot;&quot;&quot;This class is used internally by FieldStorage and is not meant to
be instantiated by the user.&quot;&quot;&quot;

In other words it is an implementation detail and you perhaps
shouldn't be expecting it to be able to be pickled and unpickled, the
later equating to instantiation by the user.

You would perhaps be better off using the public API to translate the
form/fields into a neutral format and then doing the pickle on that.

BTW, I presume you meant 3.3.1 rather than 3.3.10.

Graham

On 25/05/07, Luca Montecchiani &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">l.montecchiani at teamsystem.com</A>&gt; wrote:
&gt;<i> Hi all,
</I>&gt;<i>
</I>&gt;<i> after a while I figure out all the problems withe the new
</I>&gt;<i> StringField objects and I've cooked a patch that works for me.
</I>&gt;<i> The patch try to fix the following problems:
</I>&gt;<i>
</I>&gt;<i> 1- StringField not pickable anymore with modpython 3.3.10
</I>&gt;<i> 2- StringField eval() problem with modpython 3.3.10
</I>&gt;<i> 3- avoid to put the entire file content on Field __repr__ method
</I>&gt;<i>
</I>&gt;<i> please let me know if this could be an acceptable way to address
</I>&gt;<i> all this compatibility problems.
</I>&gt;<i>
</I>&gt;<i> thanks in advance,
</I>&gt;<i> luca
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Luca Montecchiani
</I>&gt;<i> Software Di Base
</I>&gt;<i> TeamSystem S.p.a.
</I>&gt;<i> ------------------------------------------------------------------------------------------
</I>&gt;<i> Informativa ai sensi del D. Lgs. 196-30/06/2003.
</I>&gt;<i> Il contenuto di questa e.mail e degli eventuali allegati, deve essere nella disponibilit&#224;
</I>&gt;<i> del solo destinatario.  Se ricevete per errore questa e-mail siete pregati di informarci
</I>&gt;<i> (rispedendola al mittente) e di provvedere alla sua rimozione.
</I>&gt;<i> Possono essere presenti informazioni riservate e non corrette (parzialmente o totalmente).
</I>&gt;<i> Le e-mail in partenza e in arrivo possono essere oggetto di monitoraggio
</I>&gt;<i> da parte di Teamsystem spa.  Del contenuto &#232; responsabile il mittente della presente.
</I>&gt;<i> Chiunque venga in possesso non autorizzato di questa e-mail &#232; vincolato
</I>&gt;<i> dalla Legge a non leggerne il contenuto, a non copiarla, a non diffonderla e a non usarla.
</I>&gt;<i> Informiamo che per l' esercizio dei diritti di cui all'art. 7 del d.lgs.196/2003 ci si pu&#242;
</I>&gt;<i> rivolgere al Titolare del trattamento Teamsystem S.r.l. via Gagarin 205 61100 PESARO
</I>&gt;<i> per posta o fax, indicando sulla busta o sul foglio la dicitura &quot;Inerente alla Privacy&quot;,
</I>&gt;<i> o inviando una e-mail all' indirizzo <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">privacy at teamsystem.com</A> .
</I>&gt;<i> ------------------------------------------------------------------------------------------
</I>&gt;<i>
</I>&gt;<i> --- util.py.orig        Wed Nov 22 12:15:54 2006
</I>&gt;<i> +++ util.py     Thu May 24 23:06:42 2007
</I>&gt;<i> @@ -83,7 +83,12 @@
</I>&gt;<i>
</I>&gt;<i>      def __repr__(self):
</I>&gt;<i>          &quot;&quot;&quot;Return printable representation.&quot;&quot;&quot;
</I>&gt;<i> -        return &quot;Field(%s, %s)&quot; % (`self.name`, `self.value`)
</I>&gt;<i> +        if self.file:
</I>&gt;<i> +            # avoid to put the entire file content in the
</I>&gt;<i> +            # returned string !
</I>&gt;<i> +            return &quot;Field(%s, %s)&quot; % (`self.name`, `self.filename`)
</I>&gt;<i> +        else:
</I>&gt;<i> +            return &quot;Field(%s, %s)&quot; % (`self.name`, `self.value`)
</I>&gt;<i>
</I>&gt;<i>      def __getattr__(self, name):
</I>&gt;<i>          if name != 'value':
</I>&gt;<i> @@ -126,8 +131,8 @@
</I>&gt;<i>          return self.file
</I>&gt;<i>
</I>&gt;<i>      def __repr__(self):
</I>&gt;<i> -        &quot;&quot;&quot;Return printable representation (to pass unit tests).&quot;&quot;&quot;
</I>&gt;<i> -        return &quot;Field(%s, %s)&quot; % (`self.name`, `self.value`)
</I>&gt;<i> +        # this is necessary if you want to eval a StringField
</I>&gt;<i> +        return self.value
</I>&gt;<i>
</I>&gt;<i>  class FieldList(list):
</I>&gt;<i>
</I>&gt;<i> @@ -330,15 +335,18 @@
</I>&gt;<i>              if disp_options.has_key(&quot;filename&quot;):
</I>&gt;<i>                  field = Field(name)
</I>&gt;<i>                  field.filename = disp_options[&quot;filename&quot;]
</I>&gt;<i> +                # file and headers attributes are only
</I>&gt;<i> +                # for Field objects because they will make
</I>&gt;<i> +                # a StringField unpickable
</I>&gt;<i> +                field.file = file
</I>&gt;<i> +                field.headers = headers
</I>&gt;<i>              else:
</I>&gt;<i>                  field = StringField(file.read())
</I>&gt;<i>                  field.name = name
</I>&gt;<i> -            field.file = file
</I>&gt;<i>              field.type = ctype
</I>&gt;<i>              field.type_options = type_options
</I>&gt;<i>              field.disposition = disp
</I>&gt;<i>              field.disposition_options = disp_options
</I>&gt;<i> -            field.headers = headers
</I>&gt;<i>              self.list.append(field)
</I>&gt;<i>
</I>&gt;<i>      def add_field(self, key, value):
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i>
</I>&gt;<i>
</I>
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023685.html">[mod_python] StringField patch for 3.3.10
</A></li>
	<LI>Next message: <A HREF="023688.html">[mod_python] StringField patch for 3.3.10
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23686">[ date ]</a>
              <a href="thread.html#23686">[ thread ]</a>
              <a href="subject.html#23686">[ subject ]</a>
              <a href="author.html#23686">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
