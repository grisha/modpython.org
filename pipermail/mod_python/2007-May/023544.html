<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Session.Session(req) not finding saved session
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Session.Session%28req%29%20not%20finding%20saved%20session&In-Reply-To=e01039650705010928u1ae6701dt6046f455ea10f9bf%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023542.html">
   <LINK REL="Next"  HREF="023545.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Session.Session(req) not finding saved session</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Jim Gallacher</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Session.Session%28req%29%20not%20finding%20saved%20session&In-Reply-To=e01039650705010928u1ae6701dt6046f455ea10f9bf%40mail.gmail.com"
       TITLE="[mod_python] Session.Session(req) not finding saved session">jpg at jgassociates.ca
       </A><BR>
    <I>Tue May  1 15:06:02 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="023542.html">[mod_python] Session.Session(req) not finding saved session
</A></li>
        <LI>Next message: <A HREF="023545.html">[mod_python] Session.Session(req) not finding saved session
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23544">[ date ]</a>
              <a href="thread.html#23544">[ thread ]</a>
              <a href="subject.html#23544">[ subject ]</a>
              <a href="author.html#23544">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Will Gray wrote:
&gt;<i> I'm running Apache 2.2.3 and Mod_Python 3.2.10.  I'm using
</I>&gt;<i> Mod_Python.Publisher to handle requests.  When I upgraded Apache from 
</I>&gt;<i> 2.0 to
</I>&gt;<i> 2.2 (and Mod_Python, accordingly), I was no longer able to get the saved
</I>&gt;<i> session when a visitor changes pages.  Instead, it creates and returns a 
</I>&gt;<i> new
</I>&gt;<i> session.  I was able to verify that the session was still available and
</I>&gt;<i> being saved correctly with the data inside.  Here is a sample of what my
</I>&gt;<i> views are doing:
</I>&gt;<i> 
</I>&gt;<i> def login(req):
</I>&gt;<i>    sess = Session.Session(req)
</I>&gt;<i>    userid = sess.get('uid', None)
</I>&gt;<i>    if userid:
</I>&gt;<i>        util.redirect(req, 'view')
</I>&gt;<i>    ##get username and password from req.form and authenticate against db##
</I>&gt;<i>    if uid:
</I>&gt;<i>        sess['uid'] = uid
</I>&gt;<i>        sess.save()
</I>&gt;<i>        util.redirect(req, 'view')
</I>&gt;<i>    else:
</I>&gt;<i>        ##display the login form##
</I>&gt;<i> 
</I>&gt;<i> def view(req):
</I>&gt;<i>    sess = Session.Session(req) # creates a new session instead of finding
</I>&gt;<i> the old one
</I>&gt;<i>    userid = sess.get('uid', None)
</I>&gt;<i>    if not userid:
</I>&gt;<i>        util.redirect(req, 'login')
</I>&gt;<i>    ##do some db queries and display the page##
</I>
I don't see an immediate problem with the code snippet, but given the 
redirecting back and forth I think the potential is there for things to 
get out of order.

Try tracing through your execution path again and make sure the session 
is indeed being saved at the appropriate time.

Also remember that your session instance must be created *before* 
returning any output to the client. The first call to req.write() 
flushes the response headers. Once that happens it's too late to create 
the session object - you can still create it and save it, but the 
session cookie will not be sent to the client, so you'll end up with at 
new session for every request. Typically this results in the behaviour 
you are seeing - the session data gets saved, but you always end up with 
a new session.

Jim




</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023542.html">[mod_python] Session.Session(req) not finding saved session
</A></li>
	<LI>Next message: <A HREF="023545.html">[mod_python] Session.Session(req) not finding saved session
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23544">[ date ]</a>
              <a href="thread.html#23544">[ thread ]</a>
              <a href="subject.html#23544">[ subject ]</a>
              <a href="author.html#23544">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
