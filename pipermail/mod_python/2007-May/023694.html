<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] MySQL connections not closing properly
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20MySQL%20connections%20not%20closing%20properly&In-Reply-To=41B623DE-5999-4946-B206-DDD5917F6891%40octopart.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023692.html">
   <LINK REL="Next"  HREF="023726.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] MySQL connections not closing properly</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20MySQL%20connections%20not%20closing%20properly&In-Reply-To=41B623DE-5999-4946-B206-DDD5917F6891%40octopart.com"
       TITLE="[mod_python] MySQL connections not closing properly">graham.dumpleton at gmail.com
       </A><BR>
    <I>Fri May 25 19:08:48 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="023692.html">[mod_python] MySQL connections not closing properly
</A></li>
        <LI>Next message: <A HREF="023726.html">[mod_python] MySQL connections not closing properly
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23694">[ date ]</a>
              <a href="thread.html#23694">[ thread ]</a>
              <a href="subject.html#23694">[ subject ]</a>
              <a href="author.html#23694">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>There is no guarantee that objects will be destroyed when the process
exits, so you cant rely on __del__ methods being triggered. In fact,
mod_python as it is doesn't currently even shutdown Python
interpreters on normal process exit as it was causing hangs and other
errors. I actually know now why this was the case and how to fix it
but lot of work to fix it all up.

The preferred way at the moment is to register cleanup functions for
mod_python to call on process shutdown. This can be done using
apache.register_cleanup(). See documentation for register_cleanup()
in:

  <A HREF="http://www.modpython.org/live/current/doc-html/pyapi-apmeth.html">http://www.modpython.org/live/current/doc-html/pyapi-apmeth.html</A>

Graham

On 26/05/07, Andres Morey &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">amorey at octopart.com</A>&gt; wrote:
&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> I am using mod_python 3.3.1 with Python 2.5, Apache 2.2.4, MySQL
</I>&gt;<i> 5.0.27 and MySQLdb 1.2.2. When I stop the server I get &quot;Aborted
</I>&gt;<i> connection&quot; warnings in MySQL even though I am closing the database
</I>&gt;<i> connections properly when an object goes out of scope (by using the
</I>&gt;<i> __del__ method). These warnings only happen when a python instance
</I>&gt;<i> with an open database connection is killed abruptly, so I think it
</I>&gt;<i> has something to do with the way that mod_python shuts down the
</I>&gt;<i> python interpreter.
</I>&gt;<i>
</I>&gt;<i> How does mod_python shut down the python interpreter? Is there a good
</I>&gt;<i> way to handle when mod_python shuts down the python interpreter?
</I>&gt;<i>
</I>&gt;<i> Thanks,
</I>&gt;<i> Andres
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i>
</I></PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023692.html">[mod_python] MySQL connections not closing properly
</A></li>
	<LI>Next message: <A HREF="023726.html">[mod_python] MySQL connections not closing properly
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23694">[ date ]</a>
              <a href="thread.html#23694">[ thread ]</a>
              <a href="subject.html#23694">[ subject ]</a>
              <a href="author.html#23694">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
