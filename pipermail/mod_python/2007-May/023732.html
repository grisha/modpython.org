<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Apache directory listing
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Apache%20directory%20listing&In-Reply-To=1FCFF8A5-7ABF-45F5-AEE9-58FD822F9782%40gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023730.html">
   <LINK REL="Next"  HREF="023733.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Apache directory listing</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Apache%20directory%20listing&In-Reply-To=1FCFF8A5-7ABF-45F5-AEE9-58FD822F9782%40gmail.com"
       TITLE="[mod_python] Apache directory listing">graham.dumpleton at gmail.com
       </A><BR>
    <I>Tue May 29 18:59:00 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="023730.html">[mod_python] Apache directory listing
</A></li>
        <LI>Next message: <A HREF="023733.html">[mod_python] Apache directory listing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23732">[ date ]</a>
              <a href="thread.html#23732">[ thread ]</a>
              <a href="subject.html#23732">[ subject ]</a>
              <a href="author.html#23732">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 30/05/07, Aaron Gallagher &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">habnabit at gmail.com</A>&gt; wrote:
&gt;<i> Okay, I had limited success with mod_autoindex, but unfortunately it
</I>&gt;<i> seems to be impossible to have Apache autoindex the directory.
</I>
I'll have a got at doing what I think you are trying to do later. As I
understand it you want directory index if request against directory,
otherwise SetHandler (or equivalent) should apply. Yes/No?

&gt;<i> Writing my own indexer was pretty simple and it's working well.
</I>&gt;<i>
</I>&gt;<i> Now, though, I'm trying to figure out how to catch errors like 401
</I>&gt;<i> and 403 errors and handle them within my fixuphandler. Is this
</I>&gt;<i> possible? My fixuphandler is currently using the internal_redirect
</I>&gt;<i> function to use a custom 404 page, but I'd like to potentially catch
</I>&gt;<i> all of my errors without using the internal_redirect function.
</I>&gt;<i>
</I>&gt;<i> My authenhandler returns 401 or 403 if there's a bad username or
</I>&gt;<i> password, but it seems that it doesn't go to my fixuphandler but
</I>&gt;<i> apache generates the error pages on its own. It seems like whenever I
</I>&gt;<i> return an error code, apache generates an error page.
</I>&gt;<i>
</I>&gt;<i> So, I guess my question is how I should catch every error to make
</I>&gt;<i> custom error pages?
</I>
Use the Apache ErrorDocument directive to specify an internal URL for
the handler which generates the error page. When you return an error
number as status, Apache will invoke the handler associated with the
ErrorDocument for you without you need to do the redirect. If you want
to pass information about the error to the error handler, store it in
req.notes['error-notes']. That value will then be available in
req.subprocess_env of error handler under ERROR_NOTE or
REDIRECT_ERROR_NOTES (cant remember which).

Graham

&gt;<i> On May 28, 2007, at 3:11 PM, Graham Dumpleton wrote:
</I>&gt;<i>
</I>&gt;<i> &gt; BTW, SetHandler is only processed in typehandler phase. Thus if you
</I>&gt;<i> &gt; want to override that, you must be doing it in the fixuphandler phase.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Also note that allowing automatic directory listings in mod_python can
</I>&gt;<i> &gt; cause issues if there are subdirectories which are also managed in
</I>&gt;<i> &gt; some way by mod_python. Can't remember whether there is an issue
</I>&gt;<i> &gt; logged about it or whether I ranted about it on one of the mailing
</I>&gt;<i> &gt; lists somewhere.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Graham
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On 29/05/07, Graham Dumpleton &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">graham.dumpleton at gmail.com</A>&gt; wrote:
</I>&gt;<i> &gt;&gt; If a phase earlier than response handler phase is providing the
</I>&gt;<i> &gt;&gt; complete response, it should return apache.DONE and not apache.OK.
</I>&gt;<i> &gt;&gt; This will stop later phases running.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Graham
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; On 28/05/07, Aaron Gallagher &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">habnabit at gmail.com</A>&gt; wrote:
</I>&gt;<i> &gt;&gt; &gt; I've just moved a lot of my code (including the code that checks to
</I>&gt;<i> &gt;&gt; &gt; see if a directory should have its contents listed) from a
</I>&gt;<i> &gt;&gt; &gt; PythonHandler into a PythonHeaderParserHandler, because after
</I>&gt;<i> &gt;&gt; looking
</I>&gt;<i> &gt;&gt; &gt; at the response loop, I determined that PythonFixupHandler was
</I>&gt;<i> &gt;&gt; &gt; happening too late in the process.
</I>&gt;<i> &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt; It's created some interesting new problems -- my calls to
</I>&gt;<i> &gt;&gt; &gt; req.internal_redirect aren't working, as the code was set up
</I>&gt;<i> &gt;&gt; like this:
</I>&gt;<i> &gt;&gt; &gt; req.internal_redirect(...)
</I>&gt;<i> &gt;&gt; &gt; return apache.OK
</I>&gt;<i> &gt;&gt; &gt; I guess this isn't stopping the request, like it used to do. How
</I>&gt;<i> &gt;&gt; &gt; should I change my code to allow internal redirects?
</I>&gt;<i> &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt; Also, all of your suggestions just act the same way as if I had
</I>&gt;<i> &gt;&gt; just
</I>&gt;<i> &gt;&gt; &gt; done return apache.OK.
</I>&gt;<i> &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt; On May 28, 2007, at 4:22 AM, Graham Dumpleton wrote:
</I>&gt;<i> &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt; &gt; On 28/05/07, Aaron Gallagher &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">habnabit at gmail.com</A>&gt; wrote:
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; Okay, I'll try that.
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt;
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; But, what exactly is the purpose of a PythonFixupHandler? The
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; documentation doesn't have much to say, but I assume it's for
</I>&gt;<i> &gt;&gt; doing
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; URL rewriting and redirection.
</I>&gt;<i> &gt;&gt; &gt; &gt;
</I>&gt;<i> &gt;&gt; &gt; &gt; Potentially. It is one of a number of phases and is a sort of
</I>&gt;<i> &gt;&gt; catch
</I>&gt;<i> &gt;&gt; &gt; &gt; all or last chance phase before actual response handler is
</I>&gt;<i> &gt;&gt; executed.
</I>&gt;<i> &gt;&gt; &gt; &gt; For a very technical description of the whole Apache request-
</I>&gt;<i> &gt;&gt; response
</I>&gt;<i> &gt;&gt; &gt; &gt; loop see:
</I>&gt;<i> &gt;&gt; &gt; &gt;
</I>&gt;<i> &gt;&gt; &gt; &gt;  <A HREF="http://www.fmc-modeling.org/projects/apache/html/">http://www.fmc-modeling.org/projects/apache/html/</A>
</I>&gt;<i> &gt;&gt; &gt; &gt; 4_4Request_Response_Loop.html
</I>&gt;<i> &gt;&gt; &gt; &gt;
</I>&gt;<i> &gt;&gt; &gt; &gt; If you really want to understand how Apache works, that whole
</I>&gt;<i> &gt;&gt; document
</I>&gt;<i> &gt;&gt; &gt; &gt; is quite a good read, albeit probably more in depth than most
</I>&gt;<i> &gt;&gt; people
</I>&gt;<i> &gt;&gt; &gt; &gt; would care for.
</I>&gt;<i> &gt;&gt; &gt; &gt;
</I>&gt;<i> &gt;&gt; &gt; &gt; Graham
</I>&gt;<i> &gt;&gt; &gt; &gt;
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; On May 28, 2007, at 3:44 AM, Graham Dumpleton wrote:
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt;
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt; Arrgghh, mistook mime type for handler.
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt; Trying again, although not sure this will work, but might
</I>&gt;<i> &gt;&gt; be able
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt; to say:
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt;  req.handler = &quot;httpd/unix-directory&quot;
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt;  return apache.DECLINED
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt; The reason this might not work is that mod_python registers
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; itself as
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt; a middle handler as does the autoindex module. Because the
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; autoindex
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt; module is inbuilt, it probably gets processed prior to
</I>&gt;<i> &gt;&gt; mod_python
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt; handler so too late to do the above.
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt; Thus, your only choice would be to provide a fixuphandler
</I>&gt;<i> &gt;&gt; which
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; undoes
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt; the SetHandler just for the request against the directory and
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; triggers
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt; autoindex instead. Ie.,
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt;  def fixuphandler(req):
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt;    if req.content_type = &quot;httpd/x-directory&quot;:
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt;      req.handler = &quot;httpd/unix-directory&quot;
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt;    return apache.OK
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt; Enable this using appropriate PythonFixupHandler directive.
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt; Graham
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt; On 28/05/07, Aaron Gallagher &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">habnabit at gmail.com</A>&gt; wrote:
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt;&gt; I get a 404 Not Found error.
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt;&gt; On May 28, 2007, at 3:22 AM, Graham Dumpleton wrote:
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt;&gt; &gt; What happens if you return apache.DECLINED.
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt;&gt; &gt; Graham
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt;&gt; &gt; On 28/05/07, Aaron Gallagher &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">habnabit at gmail.com</A>&gt; wrote:
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt;&gt; &gt;&gt; Is there a way to tell Apache to give a directory
</I>&gt;<i> &gt;&gt; listing? I'm
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt;&gt; using
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt;&gt; &gt;&gt; SetHandler on a directory, and in some cases, I don't need
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; to do
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt;&gt; &gt;&gt; any special
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt;&gt; &gt;&gt; handling, so I'd like Apache to just list the contents
</I>&gt;<i> &gt;&gt; of the
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt;&gt; &gt;&gt; directory so
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt;&gt; &gt;&gt; that I don't have to write my own way of doing it.
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt;&gt; &gt;&gt; Just returning apache.OK has Apache send a document of
</I>&gt;<i> &gt;&gt; MIME
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; time
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt;&gt; &gt;&gt; httpd/x-directory with content length 0.
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt;&gt; &gt;&gt; Aaron Gallagher
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt;&gt; &gt;&gt; &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">habnabit at gmail.com</A>&gt;
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt;&gt; &gt;&gt; _______________________________________________
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt;&gt; &gt;&gt; Mod_python mailing list
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt;&gt; &gt;&gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt;&gt; &gt;&gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt;&gt; Aaron Gallagher
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt;&gt; &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">habnabit at gmail.com</A>&gt;
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt;
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; Aaron Gallagher
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt; &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">habnabit at gmail.com</A>&gt;
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt;
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt;
</I>&gt;<i> &gt;&gt; &gt; &gt;&gt;
</I>&gt;<i> &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt; Aaron Gallagher
</I>&gt;<i> &gt;&gt; &gt; &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">habnabit at gmail.com</A>&gt;
</I>&gt;<i> &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt; _______________________________________________
</I>&gt;<i> &gt;&gt; &gt; Mod_python mailing list
</I>&gt;<i> &gt;&gt; &gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> &gt;&gt; &gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i> &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i>
</I>&gt;<i> Aaron Gallagher
</I>&gt;<i> &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">habnabit at gmail.com</A>&gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i>
</I></PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023730.html">[mod_python] Apache directory listing
</A></li>
	<LI>Next message: <A HREF="023733.html">[mod_python] Apache directory listing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23732">[ date ]</a>
              <a href="thread.html#23732">[ thread ]</a>
              <a href="subject.html#23732">[ subject ]</a>
              <a href="author.html#23732">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
