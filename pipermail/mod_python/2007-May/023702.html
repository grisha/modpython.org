<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Inspect request body before handing it over to
	mod_proxy
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Inspect%20request%20body%20before%20handing%20it%20over%20to%0A%09mod_proxy&In-Reply-To=d882fce60705271636n44012915q27b48c42c37ecc32%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023701.html">
   <LINK REL="Next"  HREF="023703.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Inspect request body before handing it over to
	mod_proxy</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Inspect%20request%20body%20before%20handing%20it%20over%20to%0A%09mod_proxy&In-Reply-To=d882fce60705271636n44012915q27b48c42c37ecc32%40mail.gmail.com"
       TITLE="[mod_python] Inspect request body before handing it over to
	mod_proxy">graham.dumpleton at gmail.com
       </A><BR>
    <I>Sun May 27 19:52:36 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="023701.html">[mod_python] Inspect request body before handing it over to
	mod_proxy
</A></li>
        <LI>Next message: <A HREF="023703.html">[mod_python] Inspect request body before handing it over to
	mod_proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23702">[ date ]</a>
              <a href="thread.html#23702">[ thread ]</a>
              <a href="subject.html#23702">[ subject ]</a>
              <a href="author.html#23702">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 28/05/07, Jeremy Allen &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python at jez.net.nz</A>&gt; wrote:
&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> I'm using apache 2.2 with mod_proxy functioning as a reverse proxy.
</I>&gt;<i> I was hoping to use mod_python to inspect the body of the http request
</I>&gt;<i> before it gets handled by mod_proxy.
</I>&gt;<i>
</I>&gt;<i> I can happily make a Python*Handler which will receive the request before
</I>&gt;<i> mod_proxy.
</I>&gt;<i> I can inspect and change headers before handing it off to mod_proxy but as
</I>&gt;<i> soon as I touch the body of the request things become trickier.
</I>&gt;<i> Request.read() will give me the body of the request but doing so consumes
</I>&gt;<i> the read characters from the body , thus passing on nothing down to
</I>&gt;<i> mod_proxy.
</I>&gt;<i>
</I>&gt;<i> Am I right in thinking that I cannot merely observe the body of a request, I
</I>&gt;<i> have to consume it?
</I>&gt;<i> Also am I right in thinking that there is no way I can modify the body of a
</I>&gt;<i> request before it gets handed down the request processing chain? (so I could
</I>&gt;<i> read it then perhaps write it back to the request)
</I>&gt;<i>
</I>&gt;<i> I have also tried using a filter instead of a handler but I'm not sure if it
</I>&gt;<i> is possible to trigger a server response like HTTP_FORBIDDEN from a filter.
</I>
To inspect/change the content you can only use an input filter. Do
note though that if you are changing the length of the content, that
will invalidate the incoming Content-Length header which can mean not
all your content may be sent through by mod_proxy if the new content
length is greater.

As to returning a HTTP_FORBIDDEN, is that based on the contents or the
headers. If headers, use a fixup handler. If content, I'm not sure at
the moment what you can do.

BTW, what are you proxying through to and what is the nature of the
changes being made to the content?

Graham
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023701.html">[mod_python] Inspect request body before handing it over to
	mod_proxy
</A></li>
	<LI>Next message: <A HREF="023703.html">[mod_python] Inspect request body before handing it over to
	mod_proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23702">[ date ]</a>
              <a href="thread.html#23702">[ thread ]</a>
              <a href="subject.html#23702">[ subject ]</a>
              <a href="author.html#23702">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
