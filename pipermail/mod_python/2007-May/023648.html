<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Dynamic &lt;IMG&gt; with PIL
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Dynamic%20%3CIMG%3E%20with%20PIL&In-Reply-To=4ca92f240705181648k7d57fc58r7eae46dadc0ae890%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023647.html">
   <LINK REL="Next"  HREF="023649.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Dynamic &lt;IMG&gt; with PIL</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Johannes Erdfelt</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Dynamic%20%3CIMG%3E%20with%20PIL&In-Reply-To=4ca92f240705181648k7d57fc58r7eae46dadc0ae890%40mail.gmail.com"
       TITLE="[mod_python] Dynamic &lt;IMG&gt; with PIL">johannes at erdfelt.com
       </A><BR>
    <I>Fri May 18 20:31:27 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="023647.html">[mod_python] Dynamic &lt;IMG&gt; with PIL
</A></li>
        <LI>Next message: <A HREF="023649.html">[mod_python] Dynamic &lt;IMG&gt; with PIL
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23648">[ date ]</a>
              <a href="thread.html#23648">[ thread ]</a>
              <a href="subject.html#23648">[ subject ]</a>
              <a href="author.html#23648">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Fri, May 18, 2007, Robert Norman &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">tfcrobert at gmail.com</A>&gt; wrote:
&gt;<i> I'm trying to create graphs on the fly with mod-python.  Using PIL I can get
</I>&gt;<i> a &quot;jpeg&quot; image as a string. Is there some way to wrap this information in an
</I>&gt;<i> IMG tag?  I gather that  src parameter in IMG is required so anythink like:
</I>&gt;<i> 
</I>&gt;<i> req.write(&quot;&lt;IMG %s&gt;&quot;  % myString)
</I>&gt;<i> 
</I>&gt;<i> is not going to work.
</I>
No, that certainly won't work. The problem is that the data of your
generated JPEG image isn't text and so isn't appropriate to insert into
HTML.

&gt;<i> One suggestion was to:
</I>&gt;<i> 
</I>&gt;<i> &lt;img src=&quot;get-graph.py?graphId=xyz&quot; /&gt;
</I>&gt;<i> 
</I>&gt;<i> where:
</I>&gt;<i> 
</I>&gt;<i> &quot;get-graph.py is a python script. it sets the header to &quot;image/jpeg&quot; or
</I>&gt;<i> whatever format you want to use than you can use some python libraries to
</I>&gt;<i> create the image. Instead of saving the image to a file you just write it to
</I>&gt;<i> stdout.&quot;
</I>&gt;<i> 
</I>&gt;<i> I don't understand the suggestion especially in the context of mod-python
</I>&gt;<i> since we want to use req to write the page.
</I>
It looks like you don't fully understand how web pages are fetched.

The web browser fetchs the URL specified by the user (either by typing
in, or clicking a link). It then parses the HTML and then starts loading
all of the URLs pointed to by IMG elements. These are seperate HTTP
requests, the only difference from the original request for HTML data
is a different content-type.

The suggestion was you shouldn't generate the images in the handler for
the HTML page. You should generate the image in the handler for the
graphics you're linking to in the original HTML page.

Think of it as a layer of indirection. The HTML points to the images,
which are seperate URLs and in the context of your mod_python
application, it is also a different handler. The complexity comes in
passing data from your main handler to the image handlers. This is
usually done via the query string in the URL.

Alternatively, you can also create the images in your main handler and
save them to somewhere in the webroot which you can then use in the src
attribute of the IMG tag. This usually isn't a good solution since most
generated images are temporary and you'll have to remove the images
you've saved after some period of time.

&gt;<i> What is a reasonable method to generate dynamic image graphics?
</I>
The aforementioned suggestion is the usual way of handling it.

You can also embed the JPEG data in HTML as well, using the new data: URI
scheme (which essentially takes image data and converts it into base64
and makes that the &quot;URL&quot;), but it's a bit complicated and I don't know
how well supported it is in browsers right now. I'd consider this an
advanced solution.

JE

</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023647.html">[mod_python] Dynamic &lt;IMG&gt; with PIL
</A></li>
	<LI>Next message: <A HREF="023649.html">[mod_python] Dynamic &lt;IMG&gt; with PIL
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23648">[ date ]</a>
              <a href="thread.html#23648">[ thread ]</a>
              <a href="subject.html#23648">[ subject ]</a>
              <a href="author.html#23648">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
