From rogerb at rogerbinns.com  Tue May  1 01:31:10 2007
From: rogerb at rogerbinns.com (Roger Binns)
Date: Tue May  1 01:31:14 2007
Subject: [mod_python] Access checking against another path
In-Reply-To: <88e286470704301832k7cc290eetd82a55f393241b53@mail.gmail.com>
References: <46367FF6.2060601@rogerbinns.com>	
	<88e286470704301700s626b9945ha7438de0feac1bb5@mail.gmail.com>	
	<463684D8.6030906@rogerbinns.com>	
	<88e286470704301730u2b660dd5r718b2ba5fbdfc6ee@mail.gmail.com>	
	<46368E34.1060008@rogerbinns.com>
	<88e286470704301832k7cc290eetd82a55f393241b53@mail.gmail.com>
Message-ID: <4636D09E.9020206@rogerbinns.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Graham Dumpleton wrote:
> What type of authentication is being used? Is it 'Basic' for AuthType
> or something entirely different?

Entirely up to the administrator, but most likely ldap.

> The problem is that the way you are doing it is more or less
> circumventing Apache's normal authentication mechanisms. Even if one
> had access to the full Apache C API am not sure you could do it in a
> way that would be seen as being correct for the way Apache works.

That is what I was afraid of.  Note that don't actually want to
circumvent the authentication at all - it is just that in code for one
path I want to see if the supplied credentials are valid for a different
path.

> The only way I could conceive of you being able to do it then would be
> using a session/cookie based mechanism as other person suggested, with
> concept of user roles whereby user who hasn't logged in through web
> form doesn't have rights to do stuff. Ie., the sub handlers when
> called as Python objects would check what role session has and reject
> call if not required rights.

The reason cookies won't work is that the REST path (/api/....) is REST.
 It doesn't give out cookies, or rather wouldn't make sense to.  It
wouldn't be accessed directly from a browser but rather from various
other standalone programs.  The browser would access the web admin which
behind the scenes calls the apis.

I really want to make this easy for the administrator and Apache has a
fine way of expressing access control.  If they say that only members of
a certain ldap group can delete objects (by accessing
/api/objectname/delete) then I want the separate web admin code to
automatically obey that.  I really don't want to have to build in a
second set of access controls, roles etc to the web admin.

I've looked over all the APIs twice and can't see any way that that a
request on one path can do anything with other paths such as retrieve
their content.  I guess my last recourse is to use urllib2 with
request.construct_url() and copy headers across hoping for the best.  It
will work fine with basic style authentication but won't for NTLM and
similar challenge response ones.

Roger
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)

iD8DBQFGNtCemOOfHg372QQRAo1bAJ9tb/l8SUhalehsc3CsrOnD1PM93gCff1cb
xWiACQaWZIEOYj4+a07JEjk=
=DOI9
-----END PGP SIGNATURE-----
From graham.dumpleton at gmail.com  Tue May  1 02:05:59 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue May  1 02:06:06 2007
Subject: [mod_python] Access checking against another path
In-Reply-To: <4636D09E.9020206@rogerbinns.com>
References: <46367FF6.2060601@rogerbinns.com>
	<88e286470704301700s626b9945ha7438de0feac1bb5@mail.gmail.com>
	<463684D8.6030906@rogerbinns.com>
	<88e286470704301730u2b660dd5r718b2ba5fbdfc6ee@mail.gmail.com>
	<46368E34.1060008@rogerbinns.com>
	<88e286470704301832k7cc290eetd82a55f393241b53@mail.gmail.com>
	<4636D09E.9020206@rogerbinns.com>
Message-ID: <88e286470704302305s5b8a9d1dh81b46795508b7dd7@mail.gmail.com>

On 01/05/07, Roger Binns <rogerb@rogerbinns.com> wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> Graham Dumpleton wrote:
> > What type of authentication is being used? Is it 'Basic' for AuthType
> > or something entirely different?
>
> Entirely up to the administrator, but most likely ldap.

To say ldap is only referring to the auth provider, not what HTTP
authentication mechanism is being used. Two that Apache understands
are Basic and Digest.

> > The problem is that the way you are doing it is more or less
> > circumventing Apache's normal authentication mechanisms. Even if one
> > had access to the full Apache C API am not sure you could do it in a
> > way that would be seen as being correct for the way Apache works.
>
> That is what I was afraid of.  Note that don't actually want to
> circumvent the authentication at all - it is just that in code for one
> path I want to see if the supplied credentials are valid for a different
> path.
>
> > The only way I could conceive of you being able to do it then would be
> > using a session/cookie based mechanism as other person suggested, with
> > concept of user roles whereby user who hasn't logged in through web
> > form doesn't have rights to do stuff. Ie., the sub handlers when
> > called as Python objects would check what role session has and reject
> > call if not required rights.
>
> The reason cookies won't work is that the REST path (/api/....) is REST.
>  It doesn't give out cookies, or rather wouldn't make sense to.  It
> wouldn't be accessed directly from a browser but rather from various
> other standalone programs.  The browser would access the web admin which
> behind the scenes calls the apis.
>
> I really want to make this easy for the administrator and Apache has a
> fine way of expressing access control.  If they say that only members of
> a certain ldap group can delete objects (by accessing
> /api/objectname/delete) then I want the separate web admin code to
> automatically obey that.  I really don't want to have to build in a
> second set of access controls, roles etc to the web admin.
>
> I've looked over all the APIs twice and can't see any way that that a
> request on one path can do anything with other paths such as retrieve
> their content.  I guess my last recourse is to use urllib2 with
> request.construct_url() and copy headers across hoping for the best.  It
> will work fine with basic style authentication but won't for NTLM and
> similar challenge response ones.

Except that that will not work. The problem is that AuthType and
AuthName wouldn't be set for /admin if you only use them on /api, so
the web browser wouldn't normally even send the authentication
information through for /admin URL. Thus there isn't going to be any
auth information to pass through to a sub request.

BTW, looking at Apache APIs the call that may have allowed you to do
subrequests and incorporate output within a parent page is:

  ap_run_sub_req()

Even if exposed in mod_python it would still not help given that you
wouldn't have the auth information available for /admin URL to pass
through.

Graham
From graywh at gmail.com  Tue May  1 12:28:33 2007
From: graywh at gmail.com (Will Gray)
Date: Tue May  1 12:28:56 2007
Subject: [mod_python] Session.Session(req) not finding saved session
Message-ID: <e01039650705010928u1ae6701dt6046f455ea10f9bf@mail.gmail.com>

I'm running Apache 2.2.3 and Mod_Python 3.2.10.  I'm using
Mod_Python.Publisher to handle requests.  When I upgraded Apache from 2.0 to
2.2 (and Mod_Python, accordingly), I was no longer able to get the saved
session when a visitor changes pages.  Instead, it creates and returns a new
session.  I was able to verify that the session was still available and
being saved correctly with the data inside.  Here is a sample of what my
views are doing:

def login(req):
    sess = Session.Session(req)
    userid = sess.get('uid', None)
    if userid:
        util.redirect(req, 'view')
    ##get username and password from req.form and authenticate against db##
    if uid:
        sess['uid'] = uid
        sess.save()
        util.redirect(req, 'view')
    else:
        ##display the login form##

def view(req):
    sess = Session.Session(req) # creates a new session instead of finding
the old one
    userid = sess.get('uid', None)
    if not userid:
        util.redirect(req, 'login')
    ##do some db queries and display the page##

-- 
Will Gray
Nashville, TN
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070501/84e242df/attachment.html
From rogerb at rogerbinns.com  Tue May  1 13:08:01 2007
From: rogerb at rogerbinns.com (Roger Binns)
Date: Tue May  1 13:08:05 2007
Subject: [mod_python] Access checking against another path
In-Reply-To: <88e286470704302305s5b8a9d1dh81b46795508b7dd7@mail.gmail.com>
References: <46367FF6.2060601@rogerbinns.com>	
	<88e286470704301700s626b9945ha7438de0feac1bb5@mail.gmail.com>	
	<463684D8.6030906@rogerbinns.com>	
	<88e286470704301730u2b660dd5r718b2ba5fbdfc6ee@mail.gmail.com>	
	<46368E34.1060008@rogerbinns.com>	
	<88e286470704301832k7cc290eetd82a55f393241b53@mail.gmail.com>	
	<4636D09E.9020206@rogerbinns.com>
	<88e286470704302305s5b8a9d1dh81b46795508b7dd7@mail.gmail.com>
Message-ID: <463773F1.2010700@rogerbinns.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Graham Dumpleton wrote:
> To say ldap is only referring to the auth provider, not what HTTP
> authentication mechanism is being used. Two that Apache understands
> are Basic and Digest.

As well as NTLM which does challenge response on the connection.

> Except that that will not work. The problem is that AuthType and
> AuthName wouldn't be set for /admin if you only use them on /api, so
> the web browser wouldn't normally even send the authentication
> information through for /admin URL. Thus there isn't going to be any
> auth information to pass through to a sub request.

That is correct.  I expected to manually copy the status and response
headers from /api into responses from /admin if no authentication
information was present which would then cause the browser to prompt for
and send credentials.

> BTW, looking at Apache APIs the call that may have allowed you to do
> subrequests and incorporate output within a parent page is:
> 
>  ap_run_sub_req()

I only found 1.3 doc for that API but that definitely looks like the
right thing in concert with ap_sub_req_lookup_uri() to make the "sub"
request.

> Even if exposed in mod_python it would still not help given that you
> wouldn't have the auth information available for /admin URL to pass
> through.

That is the easy bit :-)  Just copying the authentication response
headers from /api will do the trick.

For the moment I am resigned to using urllib2 to create a new request
and copying headers into/out of that (effectively using it as an
alternative to ap_sub_req_lookup_uri/ap_run_sub_req).

Roger
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)

iD8DBQFGN3PxmOOfHg372QQRAtDZAKDkwgKKF0gOE3gR+NUUr+1gVgt+dQCgnVfx
XfFBt35d/y4qJavt2RVKoz8=
=TlvJ
-----END PGP SIGNATURE-----
From jpg at jgassociates.ca  Tue May  1 15:06:02 2007
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Tue May  1 15:05:53 2007
Subject: [mod_python] Session.Session(req) not finding saved session
In-Reply-To: <e01039650705010928u1ae6701dt6046f455ea10f9bf@mail.gmail.com>
References: <e01039650705010928u1ae6701dt6046f455ea10f9bf@mail.gmail.com>
Message-ID: <46378F9A.7060505@jgassociates.ca>

Will Gray wrote:
> I'm running Apache 2.2.3 and Mod_Python 3.2.10.  I'm using
> Mod_Python.Publisher to handle requests.  When I upgraded Apache from 
> 2.0 to
> 2.2 (and Mod_Python, accordingly), I was no longer able to get the saved
> session when a visitor changes pages.  Instead, it creates and returns a 
> new
> session.  I was able to verify that the session was still available and
> being saved correctly with the data inside.  Here is a sample of what my
> views are doing:
> 
> def login(req):
>    sess = Session.Session(req)
>    userid = sess.get('uid', None)
>    if userid:
>        util.redirect(req, 'view')
>    ##get username and password from req.form and authenticate against db##
>    if uid:
>        sess['uid'] = uid
>        sess.save()
>        util.redirect(req, 'view')
>    else:
>        ##display the login form##
> 
> def view(req):
>    sess = Session.Session(req) # creates a new session instead of finding
> the old one
>    userid = sess.get('uid', None)
>    if not userid:
>        util.redirect(req, 'login')
>    ##do some db queries and display the page##

I don't see an immediate problem with the code snippet, but given the 
redirecting back and forth I think the potential is there for things to 
get out of order.

Try tracing through your execution path again and make sure the session 
is indeed being saved at the appropriate time.

Also remember that your session instance must be created *before* 
returning any output to the client. The first call to req.write() 
flushes the response headers. Once that happens it's too late to create 
the session object - you can still create it and save it, but the 
session cookie will not be sent to the client, so you'll end up with at 
new session for every request. Typically this results in the behaviour 
you are seeing - the session data gets saved, but you always end up with 
a new session.

Jim




From graywh at gmail.com  Tue May  1 15:49:44 2007
From: graywh at gmail.com (Will Gray)
Date: Tue May  1 15:49:49 2007
Subject: [mod_python] Session.Session(req) not finding saved session
In-Reply-To: <46378F9A.7060505@jgassociates.ca>
References: <e01039650705010928u1ae6701dt6046f455ea10f9bf@mail.gmail.com>
	<46378F9A.7060505@jgassociates.ca>
Message-ID: <e01039650705011249x47f7da15wc598ec940fe6735f@mail.gmail.com>

On 5/1/07, Jim Gallacher <jpg@jgassociates.ca> wrote:
>
> Will Gray wrote:
> > I'm running Apache 2.2.3 and Mod_Python 3.2.10.  I'm using
> > Mod_Python.Publisher to handle requests.  When I upgraded Apache from
> > 2.0 to
> > 2.2 (and Mod_Python, accordingly), I was no longer able to get the saved
> > session when a visitor changes pages.  Instead, it creates and returns a
> > new
> > session.  I was able to verify that the session was still available and
> > being saved correctly with the data inside.  Here is a sample of what my
> > views are doing:
> >
> > def login(req):
> >    sess = Session.Session(req)
> >    userid = sess.get('uid', None)
> >    if userid:
> >        util.redirect(req, 'view')
> >    ##get username and password from req.form and authenticate against
> db##
> >    if uid:
> >        sess['uid'] = uid
> >        sess.save()
> >        util.redirect(req, 'view')
> >    else:
> >        ##display the login form##
> >
> > def view(req):
> >    sess = Session.Session(req) # creates a new session instead of
> finding
> > the old one
> >    userid = sess.get('uid', None)
> >    if not userid:
> >        util.redirect(req, 'login')
> >    ##do some db queries and display the page##
>
> I don't see an immediate problem with the code snippet, but given the
> redirecting back and forth I think the potential is there for things to
> get out of order.
>
> Try tracing through your execution path again and make sure the session
> is indeed being saved at the appropriate time.
>
> Also remember that your session instance must be created *before*
> returning any output to the client. The first call to req.write()
> flushes the response headers. Once that happens it's too late to create
> the session object - you can still create it and save it, but the
> session cookie will not be sent to the client, so you'll end up with at
> new session for every request. Typically this results in the behaviour
> you are seeing - the session data gets saved, but you always end up with
> a new session.
>
>
I've read everything about making sure sessions are created before req.write()
and know that is not the problem.  The cookie is there in the client web
browser with the correct "pysid" value for the session id.

Since everything worked fine before upgrading Apache from 2.0 to 2.2 it
makes me think there is something wrong with that or mod_python.

-- 
Will Gray
Nashville, TN
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070501/c4247bba/attachment.html
From graywh at gmail.com  Tue May  1 17:25:56 2007
From: graywh at gmail.com (Will Gray)
Date: Tue May  1 17:26:02 2007
Subject: [mod_python] Session.Session(req) not finding saved session
In-Reply-To: <e01039650705011249x47f7da15wc598ec940fe6735f@mail.gmail.com>
References: <e01039650705010928u1ae6701dt6046f455ea10f9bf@mail.gmail.com>
	<46378F9A.7060505@jgassociates.ca>
	<e01039650705011249x47f7da15wc598ec940fe6735f@mail.gmail.com>
Message-ID: <e01039650705011425j36465fd6va62e882c1069f951@mail.gmail.com>

On 5/1/07, Will Gray <graywh@gmail.com> wrote:
>
>
>
> On 5/1/07, Jim Gallacher <jpg@jgassociates.ca> wrote:
> >
> > Will Gray wrote:
> > > I'm running Apache 2.2.3 and Mod_Python 3.2.10.  I'm using
> > > Mod_Python.Publisher to handle requests.  When I upgraded Apache from
> > > 2.0 to
> > > 2.2 (and Mod_Python, accordingly), I was no longer able to get the
> > saved
> > > session when a visitor changes pages.  Instead, it creates and returns
> > a
> > > new
> > > session.  I was able to verify that the session was still available
> > and
> > > being saved correctly with the data inside.  Here is a sample of what
> > my
> > > views are doing:
> > >
> > > def login(req):
> > >    sess = Session.Session(req)
> > >    userid = sess.get('uid', None)
> > >    if userid:
> > >        util.redirect(req, 'view')
> > >    ##get username and password from req.form and authenticate against
> > db##
> > >    if uid:
> > >        sess['uid'] = uid
> > >        sess.save()
> > >        util.redirect(req, 'view')
> > >    else:
> > >        ##display the login form##
> > >
> > > def view(req):
> > >    sess = Session.Session(req) # creates a new session instead of
> > finding
> > > the old one
> > >    userid = sess.get('uid', None)
> > >    if not userid:
> > >        util.redirect(req, 'login')
> > >    ##do some db queries and display the page##
> >
> > I don't see an immediate problem with the code snippet, but given the
> > redirecting back and forth I think the potential is there for things to
> > get out of order.
> >
> > Try tracing through your execution path again and make sure the session
> > is indeed being saved at the appropriate time.
> >
> > Also remember that your session instance must be created *before*
> > returning any output to the client. The first call to req.write()
> > flushes the response headers. Once that happens it's too late to create
> > the session object - you can still create it and save it, but the
> > session cookie will not be sent to the client, so you'll end up with at
> > new session for every request. Typically this results in the behaviour
> > you are seeing - the session data gets saved, but you always end up with
> >
> > a new session.
> >
> >
> I've read everything about making sure sessions are created before
> req.write() and know that is not the problem.  The cookie is there in the
> client web browser with the correct "pysid" value for the session id.
>
> Since everything worked fine before upgrading Apache from 2.0 to 2.2 it
> makes me think there is something wrong with that or mod_python.
>

I rearranged my code to more closely match my example above and everything
is fine now.  I did have the redirect in a different place, so that must
have made a big difference.

-- 
Will Gray
Nashville, TN
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070501/d031f2e6/attachment-0001.html
From ghitzacatalin at yahoo.com  Wed May  2 17:53:09 2007
From: ghitzacatalin at yahoo.com (Gheorghe Limboi)
Date: Wed May  2 17:53:17 2007
Subject: [mod_python] mod_python strange error
Message-ID: <780387.39888.qm@web50002.mail.re2.yahoo.com>

Hi,


can sombody tell my what can cause the error below:

AssertionError: Import cycle in /usr/local/nav/apache/webroot/status/StatusPrefs.py.



the whole output is :


MOD_PYTHON ERROR

ProcessId:      5472
Interpreter:    'test.pknet.ro'

ServerName:     'test.pknet.ro'
DocumentRoot:   '/usr/local/nav/apache/webroot'

URI:            '/status/'
Location:       None
Directory:      '/usr/local/nav/apache/webroot/status/'
Filename:       '/usr/local/nav/apache/webroot/status/'
PathInfo:       ''

Phase:          'PythonHandler'
Handler:        'status'

Traceback (most recent call last):

  File "/usr/lib/python2.4/site-packages/mod_python/importer.py", line 1537, in HandlerDispatch
    default=default_handler, arg=req, silent=hlist.silent)

  File "/usr/lib/python2.4/site-packages/mod_python/importer.py", line 1229, in _process_target
    result = _execute_target(config, req, object, arg)

  File "/usr/lib/python2.4/site-packages/mod_python/importer.py", line 1128, in _execute_target
    result = object(arg)

  File "/usr/local/nav/apache/webroot/status/status.py", line 71, in handler
    output = indexInternal(req)

  File "/usr/local/nav/apache/webroot/status/status.py", line 107, in indexInternal
    prefs = HandleStatusPrefs.loadPrefs(req)

  File "/usr/local/nav/apache/webroot/status/StatusPrefs.py", line 340, in loadPrefs
    prefs = cPickle.loads(data)

  File "/usr/lib/python2.4/site-packages/mod_python/importer.py", line 991, in load_module
    return _global_modules_cache.import_module(self.__file)

  File "/usr/lib/python2.4/site-packages/mod_python/importer.py", line 488, in import_module
    assert(file != parent_info.file), "Import cycle in %s." % file

AssertionError: Import cycle in /usr/local/nav/apache/webroot/status/StatusPrefs.py.


Tx,
gheorghe

__________________________________________________
Do You Yahoo!?
Tired of spam?  Yahoo! Mail has the best spam protection around 
http://mail.yahoo.com 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070502/78ff1d7b/attachment.html
From graham.dumpleton at gmail.com  Wed May  2 18:56:31 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Wed May  2 18:56:35 2007
Subject: [mod_python] mod_python strange error
In-Reply-To: <780387.39888.qm@web50002.mail.re2.yahoo.com>
References: <780387.39888.qm@web50002.mail.re2.yahoo.com>
Message-ID: <88e286470705021556p2f93d2aas502e958d2c7f4c40@mail.gmail.com>

You cannot in mod_python pickle certain types of Python objects that
are located within a Python code file/module which is managed by the
mod_python module importer. See:

  http://www.dscpl.com.au/wiki/ModPython/Articles/IssuesWithSessionObjects

You will need to move the objects/types to be pickled into a normal
Python module which appears on the standard Python module search path
outside of your Apache/web application document tree.

Also, read about the import_module() method in the mod_python documentation:

  http://www.modpython.org/live/current/doc-html/pyapi-apmeth.html

This will describe other details about how the mod_python module importer works.

BTW, what have you set PythonPath to in your Apache configuration?
What you have set that to may be contributing to you getting this
specific error message when normally I would have expected to see
something else.

Graham

On 03/05/07, Gheorghe Limboi <ghitzacatalin@yahoo.com> wrote:
>
> Hi,
>
>
> can sombody tell my what can cause the error below:
>
> AssertionError: Import cycle in
> /usr/local/nav/apache/webroot/status/StatusPrefs.py.
>
>
>
> the whole output is :
>
>
> MOD_PYTHON ERROR
>
> ProcessId:      5472
> Interpreter:    'test.pknet.ro'
>
> ServerName:     'test.pknet.ro'
> DocumentRoot:   '/usr/local/nav/apache/webroot'
>
> URI:            '/status/'
> Location:       None
> Directory:      '/usr/local/nav/apache/webroot/status/'
> Filename:       '/usr/local/nav/apache/webroot/status/'
> PathInfo:       ''
>
> Phase:          'PythonHandler'
> Handler:        'status'
>
> Traceback (most recent call last):
>
>   File
> "/usr/lib/python2.4/site-packages/mod_python/importer.py",
> line 1537, in HandlerDispatch
>     default=default_handler, arg=req, silent=hlist.silent)
>
>   File
> "/usr/lib/python2.4/site-packages/mod_python/importer.py",
> line 1229, in _process_target
>     result = _execute_target(config, req, object, arg)
>
>   File
> "/usr/lib/python2.4/site-packages/mod_python/importer.py",
> line 1128, in _execute_target
>     result = object(arg)
>
>   File "/usr/local/nav/apache/webroot/status/status.py",
> line 71, in handler
>     output = indexInternal(req)
>
>   File "/usr/local/nav/apache/webroot/status/status.py",
> line 107, in indexInternal
>     prefs = HandleStatusPrefs.loadPrefs(req)
>
>   File
> "/usr/local/nav/apache/webroot/status/StatusPrefs.py", line
> 340, in loadPrefs
>     prefs = cPickle.loads(data)
>
>   File
> "/usr/lib/python2.4/site-packages/mod_python/importer.py",
> line 991, in load_module
>     return _global_modules_cache.import_module(self.__file)
>
>   File
> "/usr/lib/python2.4/site-packages/mod_python/importer.py",
> line 488, in import_module
>     assert(file != parent_info.file), "Import cycle in %s." % file
>
> AssertionError: Import cycle in
> /usr/local/nav/apache/webroot/status/StatusPrefs.py.
>
>
> Tx,
> gheorghe
>  ________________________________
> Ahhh...imagining that irresistible "new car" smell?
>  Check out new cars at Yahoo! Autos.
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
From martinsenkerik at email.cz  Thu May  3 15:43:51 2007
From: martinsenkerik at email.cz (=?iso-8859-2?B?TWFydGluIKllbmtl+O1r?=)
Date: Thu May  3 15:43:53 2007
Subject: [mod_python] in modpython ,how to restrict the upload file size?
In-Reply-To: <88e286470703311818g107ae776o83dc5c980ab7b102@mail.gmail.com>
References: <op.tp0i14eqju6s6z@localhost>
	<88e286470703302228yf82dd1fy5ebf80855a1c6ac@mail.gmail.com>
	<op.tp2idnluju6s6z@trilobit>
	<88e286470703311818g107ae776o83dc5c980ab7b102@mail.gmail.com>
Message-ID: <op.tp3s3lykju6s6z@trilobit>

Dne Sun, 01 Apr 2007 03:18:22 +0200 Graham Dumpleton  
<graham.dumpleton@gmail.com> napsal/-a:

> On 01/04/07, Martin ?enke??k <martinsenkerik@email.cz> wrote:
>> Thank you for your explanation!
>>
>> I think, now I understand more deeply the machinery around.
>>
>> I realized that in my case I need to close connection to client at my  
>> own.
>> Some clients, while sending POST request, don't react to any response  
>> from
>> the server. However, I was reading through manual and internet but I
>> didn't find way, how to do it. The connection object doesn't seem to
>> provide a way how to close connection....
>>
>> So, my question is: what is the way to force closing the TCP connection  
>> to
>> client?
>
> In general Apache will do that for you, when appropriate. This will
> not stop the client sending data straight away. The client may only
> detect that the connection has closed after writing some amount of
> data and it gets an error. So you can't eliminate the client sending
> at least some data except by the client using the 100-continue feature
> properly.
>
> BTW, please use reply-all to keep discussion on mailing list.
>
> Graham
>

Yes, I understand, maybe I didn't formed my question well.
If client starts sending POST request and didn't use 100-continue feature  
and I decide to stop him sending the data, the only way, as far as I know,  
is by disconnecting him from the server (i expect that than client ends up  
with some error message about lost connection). And this is the point - I  
didn't find any information how to handle this from mod_python. Is there  
any way?


>> Dne Sat, 31 Mar 2007 07:28:41 +0200 Graham Dumpleton
>> <graham.dumpleton@gmail.com> napsal/-a:
>>
>> > On 31/03/07, Martin ?enke??k <martinsenkerik@email.cz> wrote:
>> >>
>> >> This solution works fine only for Opera web browser for me. Others  
>> (I've
>> >> tested Firefox and IE6) continues with transfer. In http  
>> specification
>> >> is
>> >> about "413: Request Entity Too Large" among others written:
>> >>
>> >> "The server MAY close the connection to prevent the client from
>> >> continuing
>> >> the request."
>> >>
>> >> I was trying to find way, how force client to stop the transfer and  
>> to
>> >> redirect them to some explanation page. But with no result. Do you  
>> have
>> >> any ideas? Or is it possible, that problem is somewhere else? e.g.  
>> wrong
>> >> configuration of Apache, mod_python...?
>> >>
>> >> (using Apache/2.2.3, mod_python/3.3.1 Python/2.4.4 on Debian)
>> >
>> > See:
>> >
>> >  http://www.w3.org/Protocols/rfc2616/rfc2616-sec8.html
>> >
>> > Especially section 8.2.3
>> >
>> > It all depends on whether the browser is using HTTP/1.1 and whether it
>> > is sending an Expect header with value 100-continue and subsequently
>> > waiting for a 100 continue response before sending the content.
>> >
>> > If it isn't then the client would be sending the content anyway and
>> > once it does you can't stop it.
>> >
>> > Thus, on your server side dump out to the log what headers are being
>> > sent by client and see what browsers are sending the Expect header and
>> > which aren't.
>> >
>> > I don't know how you might tell the browser to use this.
>> >
>> > Graham
>>
>>
>>

From jeffh at dundeemt.com  Thu May  3 20:58:59 2007
From: jeffh at dundeemt.com (Jeff Hinrichs - DM&T)
Date: Thu May  3 20:59:04 2007
Subject: [mod_python] How to do multi-level dispatch with Vampire
Message-ID: <5aaed53f0705031758w4eb8338dm739c1e0ee5740348@mail.gmail.com>

with mod_python + vampire what is the proper way to dispatch something like:
 /jobs/view/7

I'm thinking of this idiom since it is common in some other frameworks,

def _jobs_view(req,path):
    return 'using _jobs_view'

def _jobs(req, path):
    d = path.split('/')
    if d[1] = 'view':
        return _jobs_view(req, path)
    else:
        return 'unknown action'

job = vampire.PathInfo(_jobs)


I'm trying to make a RESTful api, i.e. /jobs/view/N, /jobs/edit/N, etc

/Thanking/you/jeff


-- 
Jeff Hinrichs
From jeffh at dundeemt.com  Thu May  3 21:06:42 2007
From: jeffh at dundeemt.com (Jeff Hinrichs - DM&T)
Date: Thu May  3 21:06:46 2007
Subject: [mod_python] Re: How to do multi-level dispatch with Vampire
In-Reply-To: <5aaed53f0705031758w4eb8338dm739c1e0ee5740348@mail.gmail.com>
References: <5aaed53f0705031758w4eb8338dm739c1e0ee5740348@mail.gmail.com>
Message-ID: <5aaed53f0705031806i7d4f6a18tfe65ed256a1c7401@mail.gmail.com>

On 5/3/07, Jeff Hinrichs - DM&T <jeffh@dundeemt.com> wrote:
> with mod_python + vampire what is the proper way to dispatch something like:
>  /jobs/view/7
>
> I'm thinking of this idiom since it is common in some other frameworks,
>
> def _jobs_view(req,path):
>     return 'using _jobs_view'
>
> def _jobs(req, path):
>     d = path.split('/')
>     if d[1] = 'view':
>         return _jobs_view(req, path)
>     else:
>         return 'unknown action'
>
> job = vampire.PathInfo(_jobs)
>
>
> I'm trying to make a RESTful api, i.e. /jobs/view/N, /jobs/edit/N, etc
>
> /Thanking/you/jeff
>
>
I completely, and forgot to mention and important part, I'm using
PythonHandler vampire::publisher

and not the handler portion of vampire.

-Jeff
From graham.dumpleton at gmail.com  Thu May  3 21:31:41 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu May  3 21:31:45 2007
Subject: [mod_python] How to do multi-level dispatch with Vampire
In-Reply-To: <5aaed53f0705031758w4eb8338dm739c1e0ee5740348@mail.gmail.com>
References: <5aaed53f0705031758w4eb8338dm739c1e0ee5740348@mail.gmail.com>
Message-ID: <88e286470705031831o27cdd8a1q60b2077a750d7ded@mail.gmail.com>

On 04/05/07, Jeff Hinrichs - DM&T <jeffh@dundeemt.com> wrote:
> with mod_python + vampire what is the proper way to dispatch something like:
>  /jobs/view/7
>
> I'm thinking of this idiom since it is common in some other frameworks,
>
> def _jobs_view(req,path):
>     return 'using _jobs_view'
>
> def _jobs(req, path):
>     d = path.split('/')
>     if d[1] = 'view':
>         return _jobs_view(req, path)
>     else:
>         return 'unknown action'
>
> job = vampire.PathInfo(_jobs)
>
>
> I'm trying to make a RESTful api, i.e. /jobs/view/N, /jobs/edit/N, etc

>From memory and thus untested, but best to use an object instance to
create the URL hierarchy for the 'job/view' component of path, then
use PathInfo wrapper.

  def _view(req, path):
    return path

  def Node: pass

  job = Node()
  job.view = vampire.PathInfo(_view)

or being more explicit by creating a class for the actual concept.

  class Job:
    def _view(self, req, path):
      return path
    view = vampire.PathInfo(_view)

  job = Job()

If using version of Python with decorators, sure you could come up
with a decorator which allowed you to say:

  class Job:
    @pass_path_as_argument
    def view(self, req, path):
      return path

Graham
From jeffh at dundeemt.com  Thu May  3 22:17:20 2007
From: jeffh at dundeemt.com (Jeff Hinrichs - DM&T)
Date: Thu May  3 22:17:24 2007
Subject: [mod_python] How to do multi-level dispatch with Vampire
In-Reply-To: <88e286470705031831o27cdd8a1q60b2077a750d7ded@mail.gmail.com>
References: <5aaed53f0705031758w4eb8338dm739c1e0ee5740348@mail.gmail.com>
	<88e286470705031831o27cdd8a1q60b2077a750d7ded@mail.gmail.com>
Message-ID: <5aaed53f0705031917g7cb85183w9437cbb8335d390b@mail.gmail.com>

On 5/3/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> On 04/05/07, Jeff Hinrichs - DM&T <jeffh@dundeemt.com> wrote:
> > with mod_python + vampire what is the proper way to dispatch something like:
> >  /jobs/view/7
> >
> > I'm thinking of this idiom since it is common in some other frameworks,
> >
> > def _jobs_view(req,path):
> >     return 'using _jobs_view'
> >
> > def _jobs(req, path):
> >     d = path.split('/')
> >     if d[1] = 'view':
> >         return _jobs_view(req, path)
> >     else:
> >         return 'unknown action'
> >
> > job = vampire.PathInfo(_jobs)
> >
> >
> > I'm trying to make a RESTful api, i.e. /jobs/view/N, /jobs/edit/N, etc
>
> From memory and thus untested, but best to use an object instance to
> create the URL hierarchy for the 'job/view' component of path, then
> use PathInfo wrapper.
>
>   def _view(req, path):
>     return path
>
>   def Node: pass
>
>   job = Node()
>   job.view = vampire.PathInfo(_view)
>
> or being more explicit by creating a class for the actual concept.
>
>   class Job:
>     def _view(self, req, path):
>       return path
>     view = vampire.PathInfo(_view)
>
>   job = Job()
>
> If using version of Python with decorators, sure you could come up
> with a decorator which allowed you to say:
>
>   class Job:
>     @pass_path_as_argument
>     def view(self, req, path):
>       return path
>
> Graham
>

Graham,
That was exactly the nudge I was looking to get.  A little trial and
error + some googling resulted in:

class Foo:

    def __init__(self):

        self.bar = vampire.PathInfo(self._bar)

        self.baz = vampire.PathInfo(self._baz)

    def _bar(self,req,path):

        return "foo/bar:%s" % path

    def _baz(self,req,path):

        return "foo/baz:%s" % path



foo = Foo()

I'm looking for some decorator magic now.  I'll post back if/when I
find the right voodoo - I'm new to making my own decorators so they
look like magic to me still.<g>

Thanks for the nudge.

-jeff
From graham.dumpleton at gmail.com  Fri May  4 00:49:33 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Fri May  4 00:49:39 2007
Subject: [mod_python] How to do multi-level dispatch with Vampire
In-Reply-To: <5aaed53f0705032144r757d07c1ua80d07e32937dd98@mail.gmail.com>
References: <5aaed53f0705031758w4eb8338dm739c1e0ee5740348@mail.gmail.com>
	<88e286470705031831o27cdd8a1q60b2077a750d7ded@mail.gmail.com>
	<5aaed53f0705031917g7cb85183w9437cbb8335d390b@mail.gmail.com>
	<5aaed53f0705032144r757d07c1ua80d07e32937dd98@mail.gmail.com>
Message-ID: <88e286470705032149n4857de1fm99b1b72f8f77e6bf@mail.gmail.com>

On 04/05/07, Jeff Hinrichs - DM&T <jeffh@dundeemt.com> wrote:
> On 5/3/07, Jeff Hinrichs - DM&T <jeffh@dundeemt.com> wrote:
> > On 5/3/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> > > On 04/05/07, Jeff Hinrichs - DM&T <jeffh@dundeemt.com> wrote:
> > > > with mod_python + vampire what is the proper way to dispatch something like:
> > > >  /jobs/view/7
> > > >
> > > > I'm thinking of this idiom since it is common in some other frameworks,
> > > >
> > > > def _jobs_view(req,path):
> > > >     return 'using _jobs_view'
> > > >
> > > > def _jobs(req, path):
> > > >     d = path.split('/')
> > > >     if d[1] = 'view':
> > > >         return _jobs_view(req, path)
> > > >     else:
> > > >         return 'unknown action'
> > > >
> > > > job = vampire.PathInfo(_jobs)
> > > >
> > > >
> > > > I'm trying to make a RESTful api, i.e. /jobs/view/N, /jobs/edit/N, etc
> > >
> > > From memory and thus untested, but best to use an object instance to
> > > create the URL hierarchy for the 'job/view' component of path, then
> > > use PathInfo wrapper.
> > >
> > >   def _view(req, path):
> > >     return path
> > >
> > >   def Node: pass
> > >
> > >   job = Node()
> > >   job.view = vampire.PathInfo(_view)
> > >
> > > or being more explicit by creating a class for the actual concept.
> > >
> > >   class Job:
> > >     def _view(self, req, path):
> > >       return path
> > >     view = vampire.PathInfo(_view)
> > >
> > >   job = Job()
> > >
> > > If using version of Python with decorators, sure you could come up
> > > with a decorator which allowed you to say:
> > >
> > >   class Job:
> > >     @pass_path_as_argument
> > >     def view(self, req, path):
> > >       return path
> > >
> > > Graham
> > >
> >
> > Graham,
> > That was exactly the nudge I was looking to get.  A little trial and
> > error + some googling resulted in:
> >
> > class Foo:
> >
> >     def __init__(self):
> >
> >         self.bar = vampire.PathInfo(self._bar)
> >
> >         self.baz = vampire.PathInfo(self._baz)
> >
> >     def _bar(self,req,path):
> >
> >         return "foo/bar:%s" % path
> >
> >     def _baz(self,req,path):
> >
> >         return "foo/baz:%s" % path
> >
> >
> >
> > foo = Foo()
> quick question, If I use the class style to handle /foo/bar how do I
> handle a request /foo ?
> I tried creating an def index(self, req) method but that isn't
> working, it also tried def foo(self, req) and Foo.    Or is it not
> possible to create a default method to use when using a class?

Provide a __call__() method.

  class Node: pass

  def _index(req): ...

  foo = Node()
  foo.__call__ = _index

Graham
From jeffh at dundeemt.com  Fri May  4 01:18:56 2007
From: jeffh at dundeemt.com (Jeff Hinrichs - DM&T)
Date: Fri May  4 01:19:00 2007
Subject: [mod_python] How to do multi-level dispatch with Vampire
In-Reply-To: <88e286470705032149n4857de1fm99b1b72f8f77e6bf@mail.gmail.com>
References: <5aaed53f0705031758w4eb8338dm739c1e0ee5740348@mail.gmail.com>
	<88e286470705031831o27cdd8a1q60b2077a750d7ded@mail.gmail.com>
	<5aaed53f0705031917g7cb85183w9437cbb8335d390b@mail.gmail.com>
	<5aaed53f0705032144r757d07c1ua80d07e32937dd98@mail.gmail.com>
	<88e286470705032149n4857de1fm99b1b72f8f77e6bf@mail.gmail.com>
Message-ID: <5aaed53f0705032218u2030b319naace744d66283d69@mail.gmail.com>

On 5/3/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> On 04/05/07, Jeff Hinrichs - DM&T <jeffh@dundeemt.com> wrote:
> > On 5/3/07, Jeff Hinrichs - DM&T <jeffh@dundeemt.com> wrote:
> > > On 5/3/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> > > > On 04/05/07, Jeff Hinrichs - DM&T <jeffh@dundeemt.com> wrote:
> > > > > with mod_python + vampire what is the proper way to dispatch something like:
> > > > >  /jobs/view/7
> > > > >
> > > > > I'm thinking of this idiom since it is common in some other frameworks,
> > > > >
> > > > > def _jobs_view(req,path):
> > > > >     return 'using _jobs_view'
> > > > >
> > > > > def _jobs(req, path):
> > > > >     d = path.split('/')
> > > > >     if d[1] = 'view':
> > > > >         return _jobs_view(req, path)
> > > > >     else:
> > > > >         return 'unknown action'
> > > > >
> > > > > job = vampire.PathInfo(_jobs)
> > > > >
> > > > >
> > > > > I'm trying to make a RESTful api, i.e. /jobs/view/N, /jobs/edit/N, etc
> > > >
> > > > From memory and thus untested, but best to use an object instance to
> > > > create the URL hierarchy for the 'job/view' component of path, then
> > > > use PathInfo wrapper.
> > > >
> > > >   def _view(req, path):
> > > >     return path
> > > >
> > > >   def Node: pass
> > > >
> > > >   job = Node()
> > > >   job.view = vampire.PathInfo(_view)
> > > >
> > > > or being more explicit by creating a class for the actual concept.
> > > >
> > > >   class Job:
> > > >     def _view(self, req, path):
> > > >       return path
> > > >     view = vampire.PathInfo(_view)
> > > >
> > > >   job = Job()
> > > >
> > > > If using version of Python with decorators, sure you could come up
> > > > with a decorator which allowed you to say:
> > > >
> > > >   class Job:
> > > >     @pass_path_as_argument
> > > >     def view(self, req, path):
> > > >       return path
> > > >
> > > > Graham
> > > >
> > >
> > > Graham,
> > > That was exactly the nudge I was looking to get.  A little trial and
> > > error + some googling resulted in:
> > >
> > > class Foo:
> > >
> > >     def __init__(self):
> > >
> > >         self.bar = vampire.PathInfo(self._bar)
> > >
> > >         self.baz = vampire.PathInfo(self._baz)
> > >
> > >     def _bar(self,req,path):
> > >
> > >         return "foo/bar:%s" % path
> > >
> > >     def _baz(self,req,path):
> > >
> > >         return "foo/baz:%s" % path
> > >
> > >
> > >
> > > foo = Foo()
> > quick question, If I use the class style to handle /foo/bar how do I
> > handle a request /foo ?
> > I tried creating an def index(self, req) method but that isn't
> > working, it also tried def foo(self, req) and Foo.    Or is it not
> > possible to create a default method to use when using a class?
>
> Provide a __call__() method.
>
>   class Node: pass
>
>   def _index(req): ...
>
>   foo = Node()
>   foo.__call__ = _index
>
Outstanding.  Thank you.

-- 
Jeff Hinrichs
http://www.OmahaPython.org
From durumdara at gmail.com  Fri May  4 04:12:03 2007
From: durumdara at gmail.com (durumdara)
Date: Fri May  4 04:12:27 2007
Subject: [mod_python] Pre and postprocess blocks (Publisher mode)?
Message-ID: <463AEAD3.6050809@gmail.com>

Hi!

I tried Pylons to see and check it... how to working, what I need to 
learn about it... from it... :-)

http://groups.google.com/group/pylons-discuss/browse_thread/thread/8870ed10d821c06f

I probably ported my modpy site to pylons-type site.

One thing I like in it: it have preprocess, and postprocess phase where 
I define the common operations.

Example: session, database handling, right/access checking, etc.

So pylons is starts with _before_ procedure, what defined in base 
controller and "overrideable" in any controllers; and next it is 
traverses the path to controller/action.
Then it is calls the actual "controller object"'s actual function (named 
as action). This procedure is get back a Response object.
Finally it is call the _after_ procedure, and finished with request.

Because the controllers are python modules, it is avoid the "same module 
name" hell (in another modules I can use same name - example index).

I know that modpy supports publisher mode, that same like pylons' 
working method.

1.)
But I want to know: how the modpython helps me to I do pre- and 
postprocess operations?

2.)
Can I get paths/pages without extensions like in pylons?
Example:
www.somesite.com/main
www.somesite.com/search
And not:
www.somesite.com/main.py
www.somesite.com/search.py

In publisher mode how the paths are working?
When I have a module named main.py that have many subfunctions, what 
path I need to use?
www.somesite.com/main.py/index
www.somesite.com/main.py/search
or
www.somesite.com/main/index
www.somesite.com/main/search
?

Please help me a little!

Thanks for it!
  dd



From graham.dumpleton at gmail.com  Fri May  4 05:50:59 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Fri May  4 05:51:03 2007
Subject: [mod_python] Pre and postprocess blocks (Publisher mode)?
In-Reply-To: <463AEAD3.6050809@gmail.com>
References: <463AEAD3.6050809@gmail.com>
Message-ID: <88e286470705040250y40677fa7i794d31b53a770f69@mail.gmail.com>

On 04/05/07, durumdara <durumdara@gmail.com> wrote:
> Hi!
>
> I tried Pylons to see and check it... how to working, what I need to
> learn about it... from it... :-)
>
> http://groups.google.com/group/pylons-discuss/browse_thread/thread/8870ed10d821c06f
>
> I probably ported my modpy site to pylons-type site.
>
> One thing I like in it: it have preprocess, and postprocess phase where
> I define the common operations.
>
> Example: session, database handling, right/access checking, etc.
>
> So pylons is starts with _before_ procedure, what defined in base
> controller and "overrideable" in any controllers; and next it is
> traverses the path to controller/action.
> Then it is calls the actual "controller object"'s actual function (named
> as action). This procedure is get back a Response object.
> Finally it is call the _after_ procedure, and finished with request.
>
> Because the controllers are python modules, it is avoid the "same module
> name" hell (in another modules I can use same name - example index).

What exactly are you talking about when you say 'same module name hell'?

Note that packages like Pylons, Django etc rely on standard module
importing mechanism so module names have to be unique or contained
with a package structure. The mod_python module importer supports
being able to load modules based on absolute path as well, thus
allowing same module names in multiple contexts and still support
module reloading. See the apache.import_module() function described
in:

  http://www.modpython.org/live/current/doc-html/pyapi-apmeth.html

> I know that modpy supports publisher mode, that same like pylons'
> working method.
>
> 1.)
> But I want to know: how the modpython helps me to I do pre- and
> postprocess operations?

Apache/mod_python actually has a much better developed concept of
request processing phases than Pylons and other monolithic solutions
such as Django. Have a look at the section '4.4.4 Process HTTP
Request' in:

  http://www.fmc-modeling.org/projects/apache/html/4_4Request_Response_Loop.html

In mod_python most of the phases can have code associated with them. See:

  http://www.modpython.org/live/current/doc-html/dir-handlers.html

A post handler or cleanup handler can be registered using the
req.register_cleanup() method. See documentation in:

  http://www.modpython.org/live/current/doc-html/pyapi-mprequest-meth.html

Note that you can also define stacked handlers for PythonHandler as
another means of implementing a request in multiple phases.

One can also use other Apache modules to implement some phases, thus
avoiding duplication of effort.

> 2.)
> Can I get paths/pages without extensions like in pylons?
> Example:
> www.somesite.com/main
> www.somesite.com/search
> And not:
> www.somesite.com/main.py
> www.somesite.com/search.py

Yes. See discussion of SetHandler/AddHandler differences and
MultiViews feature of Apache in:

  http://www.dscpl.com.au/wiki/ModPython/Articles/SetHandlerVersusAddHandler

> In publisher mode how the paths are working?
> When I have a module named main.py that have many subfunctions, what
> path I need to use?
> www.somesite.com/main.py/index
> www.somesite.com/main.py/search
> or
> www.somesite.com/main/index
> www.somesite.com/main/search
> ?

Either if you set up the Apache configuration correctly.

Also read documentation:

  http://www.modpython.org/live/current/doc-html/hand-pub-alg.html

Overall, Apache/mod_python is probably more flexible and through use
of other Apache modules can be controlled to a much higher degree
without having to write too much custom code for URL dispatching which
is just going to bloat your application.

So, read through all those references and try and take it in. Then
perhaps come back with more specific questions with examples of what
you have tried.

Graham
From jrraines at comcast.net  Fri May  4 07:08:01 2007
From: jrraines at comcast.net (John Raines)
Date: Fri May  4 07:08:05 2007
Subject: [mod_python] implications of multiple interpreters
Message-ID: <179124C1-E0E0-43F0-8456-0CDD25363149@comcast.net>

Last night I found a bug in my code that involved using  
calendar.setfirstweekday in one place and later assuming that it was  
the default at another place (actually an earlier place that I came  
back to).

As I think about this there may be an interaction with multiple  
interpreters so that this MIGHTt ave been hard to reproduce and find.  
I fixed my problem but I am interested in understanding the  
implications of multiple interpreters for issues of this sort.

I suspect this is not dissimilar to the brief thread earlier in the  
week about python 3.0.
From jrraines at comcast.net  Fri May  4 07:33:00 2007
From: jrraines at comcast.net (John Raines)
Date: Fri May  4 07:33:05 2007
Subject: [mod_python] implications of multiple interpreters
In-Reply-To: <179124C1-E0E0-43F0-8456-0CDD25363149@comcast.net>
References: <179124C1-E0E0-43F0-8456-0CDD25363149@comcast.net>
Message-ID: <F52E942C-E73A-40AA-AA60-14F068B5DB02@comcast.net>

To be clearer: an earlier webpage that I came back to
On May 4, 2007, at 6:08 AM, John Raines wrote:

> Last night I found a bug in my code that involved using  
> calendar.setfirstweekday in one place and later assuming that it  
> was the default at another place (actually an earlier place that I  
> came back to).
>
> As I think about this there may be an interaction with multiple  
> interpreters so that this MIGHTt ave been hard to reproduce and  
> find. I fixed my problem but I am interested in understanding the  
> implications of multiple interpreters for issues of this sort.
>
> I suspect this is not dissimilar to the brief thread earlier in the  
> week about python 3.0.
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From graham.dumpleton at gmail.com  Fri May  4 23:19:29 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Fri May  4 23:19:35 2007
Subject: [mod_python] implications of multiple interpreters
In-Reply-To: <179124C1-E0E0-43F0-8456-0CDD25363149@comcast.net>
References: <179124C1-E0E0-43F0-8456-0CDD25363149@comcast.net>
Message-ID: <88e286470705042019j1ab64084sf917ce34e633c24b@mail.gmail.com>

As 'calendar' is a pure Python module any problem wouldn't be anything
to do with multiple sub interpreters as each sub interpreter has its
own copy of pure Python code modules. Any problem you saw is more
likely the result of using the Apache worker MPM on UNIX, or using a
Windows box, and the fact that distinct requests can be running
concurrently within the one sub interpreter of a process in different
threads.

Graham

On 04/05/07, John Raines <jrraines@comcast.net> wrote:
> Last night I found a bug in my code that involved using
> calendar.setfirstweekday in one place and later assuming that it was
> the default at another place (actually an earlier place that I came
> back to).
>
> As I think about this there may be an interaction with multiple
> interpreters so that this MIGHTt ave been hard to reproduce and find.
> I fixed my problem but I am interested in understanding the
> implications of multiple interpreters for issues of this sort.
>
> I suspect this is not dissimilar to the brief thread earlier in the
> week about python 3.0.
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From jrraines at comcast.net  Sat May  5 07:05:24 2007
From: jrraines at comcast.net (John Raines)
Date: Sat May  5 07:05:51 2007
Subject: [mod_python] implications of multiple interpreters
In-Reply-To: <88e286470705042019j1ab64084sf917ce34e633c24b@mail.gmail.com>
References: <179124C1-E0E0-43F0-8456-0CDD25363149@comcast.net>
	<88e286470705042019j1ab64084sf917ce34e633c24b@mail.gmail.com>
Message-ID: <544657AE-0E61-41A6-B716-AF62BEA04831@comcast.net>

My point was that there is presumably one global flag that tells the  
calendar module whether the first weekday is Sunday or Monday. I'm  
presuming that if one subinterpreter changes the default Monday to  
Sunday that all the subinterpreters also see this happen. The flag  
iprobably isn't set on a per interpreter basis and even if it were, a  
browser client isn't guarranteed the same subinterpreter on the next  
request.
The first weekday needs to be restored to the default and the end of  
each page request  and if the client wants something else, it will  
need to be set up each  request by some mechanism usng cookies or  
sessions or something similar.  The first weekday thing can be set  
but not directly read; you can figure out what it is by looking at  
the returned calendar for a specific month.

  If  I understood the python 3.0 issue it was similar to this, but  
more difficult: they were considering adding the ability to override  
arithmetic operators for some classes and this would be global  
behavior. There would typically be no way to reset THAT to default   
and restore it  to what was wanted on each request.
On May 4, 2007, at 10:19 PM, Graham Dumpleton wrote:

> As 'calendar' is a pure Python module any problem wouldn't be anything
> to do with multiple sub interpreters as each sub interpreter has its
> own copy of pure Python code modules. Any problem you saw is more
> likely the result of using the Apache worker MPM on UNIX, or using a
> Windows box, and the fact that distinct requests can be running
> concurrently within the one sub interpreter of a process in different
> threads.
>
> Graham
>
> On 04/05/07, John Raines <jrraines@comcast.net> wrote:
>> Last night I found a bug in my code that involved using
>> calendar.setfirstweekday in one place and later assuming that it was
>> the default at another place (actually an earlier place that I came
>> back to).
>>
>> As I think about this there may be an interaction with multiple
>> interpreters so that this MIGHTt ave been hard to reproduce and find.
>> I fixed my problem but I am interested in understanding the
>> implications of multiple interpreters for issues of this sort.
>>
>> I suspect this is not dissimilar to the brief thread earlier in the
>> week about python 3.0.
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>

From graham.dumpleton at gmail.com  Sat May  5 07:39:51 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sat May  5 07:39:56 2007
Subject: [mod_python] implications of multiple interpreters
In-Reply-To: <544657AE-0E61-41A6-B716-AF62BEA04831@comcast.net>
References: <179124C1-E0E0-43F0-8456-0CDD25363149@comcast.net>
	<88e286470705042019j1ab64084sf917ce34e633c24b@mail.gmail.com>
	<544657AE-0E61-41A6-B716-AF62BEA04831@comcast.net>
Message-ID: <88e286470705050439y477067f3hb66272b09c5a6fb1@mail.gmail.com>

On 05/05/07, John Raines <jrraines@comcast.net> wrote:
> My point was that there is presumably one global flag that tells the
> calendar module whether the first weekday is Sunday or Monday. I'm
> presuming that if one subinterpreter changes the default Monday to
> Sunday that all the subinterpreters also see this happen. The flag
> iprobably isn't set on a per interpreter basis

>From reading 'calendar' code, it would be on per interpreter basis. It
is not global across all sub interpreters within that process. Such
global state across all interpreters would generally only occur in C
extension modules where flag is maintained in C code and not Python
code.

> and even if it were, a
> browser client isn't guarranteed the same subinterpreter on the next
> request.

You might be getting confused with fact that subsequent request may
actually be against a different process. Read:

  http://www.dscpl.com.au/wiki/ModPython/Articles/TheProcessInterpreterModel

The request for a particular URL will always be against the same named
interpreter, but there is a unique instance of that named interpreter
in each Apache child process that might handle a request. Within one
process that one instance of a specific named interpreter persists for
the life of that process.

> The first weekday needs to be restored to the default and the end of
> each page request  and if the client wants something else, it will
> need to be set up each  request by some mechanism usng cookies or
> sessions or something similar.  The first weekday thing can be set
> but not directly read; you can figure out what it is by looking at
> the returned calendar for a specific month.

Setting flag at beginning of request and restoring it at the end of
the request will not work in a multithread Apache MPM as the use of
the flag in a particular state will not be serialised. Thus one
request when cleaning up could set flag back to different value for
other request got to use it with state it had just set it to.

In other words, changing that state in 'calender' is not thread safe
and should only be changed once from module imported using
PythonImport and left that way for life of process.

>   If  I understood the python 3.0 issue it was similar to this, but
> more difficult: they were considering adding the ability to override
> arithmetic operators for some classes and this would be global
> behavior. There would typically be no way to reset THAT to default
> and restore it  to what was wanted on each request.

It was only an issue with Python 3.0 and what they were talking about
because they were talking about making changes at C code level and not
at that point taking into consideration that behaviour may want to be
different where there are multiple sub interpreters.

Graham

> On May 4, 2007, at 10:19 PM, Graham Dumpleton wrote:
>
> > As 'calendar' is a pure Python module any problem wouldn't be anything
> > to do with multiple sub interpreters as each sub interpreter has its
> > own copy of pure Python code modules. Any problem you saw is more
> > likely the result of using the Apache worker MPM on UNIX, or using a
> > Windows box, and the fact that distinct requests can be running
> > concurrently within the one sub interpreter of a process in different
> > threads.
> >
> > Graham
> >
> > On 04/05/07, John Raines <jrraines@comcast.net> wrote:
> >> Last night I found a bug in my code that involved using
> >> calendar.setfirstweekday in one place and later assuming that it was
> >> the default at another place (actually an earlier place that I came
> >> back to).
> >>
> >> As I think about this there may be an interaction with multiple
> >> interpreters so that this MIGHTt ave been hard to reproduce and find.
> >> I fixed my problem but I am interested in understanding the
> >> implications of multiple interpreters for issues of this sort.
> >>
> >> I suspect this is not dissimilar to the brief thread earlier in the
> >> week about python 3.0.
> >> _______________________________________________
> >> Mod_python mailing list
> >> Mod_python@modpython.org
> >> http://mailman.modpython.org/mailman/listinfo/mod_python
> >>
>
>
From jeffh at dundeemt.com  Sat May  5 22:43:43 2007
From: jeffh at dundeemt.com (Jeff Hinrichs - DM&T)
Date: Sat May  5 22:43:53 2007
Subject: [mod_python] Help with session.save and register_cleanup
Message-ID: <5aaed53f0705051943s66141514scee614c8d42b9420@mail.gmail.com>

I know that I am missing something here but googling and banging my
head aren't working so I'll ask.

I'm trying to register the session.save method from the Session I've
attached to the req object in the req.register_cleanup()  like this:

# housekeeping setup for a request

def housekeeping(fn):

    def _setup(req, *args, **kwargs):

        #if session isn't part of the req object, add it

        if not hasattr(req,"session"):

            req.session = Session.Session(req)

            req.session['housekeeped']=1

        #register session.save as a cleanup

        req.register_cleanup(req.session.save)

        #now call the original

        return fn(req,*args,**kwargs)

    return _setup


@housekeeping
def login(req):

    req.session['foo']='bar'

    return "We are in login() %s" % req.session.keys()

Everything seems peachy, the results returned are:

  We are in login() ['foo', 'housekeeped']

However, the register_cleanup fails to save the session, and is
returning the following err:

[notice] vampire: Reimporting module
'/usr/home/apache22/lakota.dundeemt.pri/dora/index.py'
[error] [client 192.168.2.52] python_cleanup: Error calling cleanup
object <bound method DbmSession.save of {'housekeeped': 1}>
[error] [client 192.168.2.52]     exceptions.TypeError: save() takes
exactly 1 argument (2 given)

I've tried changing the register_cleanup to call req.session.save()
(as opposed to .save) but that complains, correctly, that save() is
not callable.

First question, can I register multiple items with multiple calls to
req.register_cleanup? i.e.
req.register_cleanup(_closedb, req)
req.register_cleanup(req.session.save)

or is that my problem?  Or have I just been at the keyboard too long
to see the error that probably is staring me in the face?  The db
cleanup appears to be working without error nor phantom connections.

Thanks,

Jeff Hinrichs
http://www.OmahaPython.org/
From graham.dumpleton at gmail.com  Sun May  6 00:00:54 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sun May  6 00:00:58 2007
Subject: [mod_python] Help with session.save and register_cleanup
In-Reply-To: <5aaed53f0705051943s66141514scee614c8d42b9420@mail.gmail.com>
References: <5aaed53f0705051943s66141514scee614c8d42b9420@mail.gmail.com>
Message-ID: <88e286470705052100r3b83d937tbfabcaaeb717492f@mail.gmail.com>

A cleanup function will always be passed one argument. This will be
the data which is supplied when register_cleanup() is called. If no
cleanup data is supplied, then None will be passed as cleanup data.
Because Session object save() method already has a 'self' argument,
the cleanup data becomes the second argument it complains about.

In short, do this:

  def _cleanup(session):
    session.save()

  req.register_cleanup(_cleanup, req.session)

Graham

On 06/05/07, Jeff Hinrichs - DM&T <jeffh@dundeemt.com> wrote:
> I know that I am missing something here but googling and banging my
> head aren't working so I'll ask.
>
> I'm trying to register the session.save method from the Session I've
> attached to the req object in the req.register_cleanup()  like this:
>
> # housekeeping setup for a request
>
> def housekeeping(fn):
>
>     def _setup(req, *args, **kwargs):
>
>         #if session isn't part of the req object, add it
>
>         if not hasattr(req,"session"):
>
>             req.session = Session.Session(req)
>
>             req.session['housekeeped']=1
>
>         #register session.save as a cleanup
>
>         req.register_cleanup(req.session.save)
>
>         #now call the original
>
>         return fn(req,*args,**kwargs)
>
>     return _setup
>
>
> @housekeeping
> def login(req):
>
>     req.session['foo']='bar'
>
>     return "We are in login() %s" % req.session.keys()
>
> Everything seems peachy, the results returned are:
>
>   We are in login() ['foo', 'housekeeped']
>
> However, the register_cleanup fails to save the session, and is
> returning the following err:
>
> [notice] vampire: Reimporting module
> '/usr/home/apache22/lakota.dundeemt.pri/dora/index.py'
> [error] [client 192.168.2.52] python_cleanup: Error calling cleanup
> object <bound method DbmSession.save of {'housekeeped': 1}>
> [error] [client 192.168.2.52]     exceptions.TypeError: save() takes
> exactly 1 argument (2 given)
>
> I've tried changing the register_cleanup to call req.session.save()
> (as opposed to .save) but that complains, correctly, that save() is
> not callable.
>
> First question, can I register multiple items with multiple calls to
> req.register_cleanup? i.e.
> req.register_cleanup(_closedb, req)
> req.register_cleanup(req.session.save)
>
> or is that my problem?  Or have I just been at the keyboard too long
> to see the error that probably is staring me in the face?  The db
> cleanup appears to be working without error nor phantom connections.
>
> Thanks,
>
> Jeff Hinrichs
> http://www.OmahaPython.org/
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From jeffh at dundeemt.com  Sun May  6 01:06:47 2007
From: jeffh at dundeemt.com (Jeff Hinrichs - DM&T)
Date: Sun May  6 01:06:52 2007
Subject: [mod_python] Help with session.save and register_cleanup
In-Reply-To: <88e286470705052100r3b83d937tbfabcaaeb717492f@mail.gmail.com>
References: <5aaed53f0705051943s66141514scee614c8d42b9420@mail.gmail.com>
	<88e286470705052100r3b83d937tbfabcaaeb717492f@mail.gmail.com>
Message-ID: <5aaed53f0705052206h3ef5faf8v3a7ad35b16c51ea4@mail.gmail.com>

Graham,

Thanks for the feedback.  I reverted back to the method you wrote
about.  I had that originally but I was trying to tidy up a lonely
looking function.  Not that big of a deal.  Thanks again.

Hey, -- while we are chattting, have you ever tried putting a
decorator around a vampire.pathArgs wrapped class method? i..e

def mysession(fn):
  def _setup(req, *args, **kwargs):
        #if session isn't part of the req object, add it

        if not hasattr(req,"session"):

            req.session = Session.Session(req)

        #register session.save as a cleanup

        req.register_cleanup(_savesession, req)

        #now call the original

        return fn(req,*args,**kwargs)

    return _setup

class Foo:
  def __init__(self):
    self.bar = vampire.PathArgs(self._bar)

  @mysession
  def _bar(self, req, id):
    ... do something..

@mysession
def baz(req):
  ...do something...

Using the decorator on the global works just fine, but using the
decorator on the _bar method of the Foo class gives back some very
curious errors -- appears to be confusing the heck out of things.
Complains about Foo not having an "options"  -- feels like the vampire
wrapper and the decorator are intermingling in an unhappy way.

I am quite new to making my own decorators so I could very well be
doing something quite idiotic ;)

I don't require the use of decorators as I can replace them with a
different idiom that is almost as effective.  using mysession as an
example, I rip out the fancy wrapper then make it into a normal bit.

def mysession(req):
       #if session isn't part of the req object, add it
        if not hasattr(req,"session"):
            req.session = Session.Session(req)
        #register session.save as a cleanup
        req.register_cleanup(_savesession, req)

Then I just:

class Foo:
  def __init__(self):
    self.bar = vampire.PathArgs(self._bar)

  def _bar(self, req, id):
    mysession(req)
    ... do something..

Amount of code is about the same, no functionality given up in this
instance -- so the question about the decorator is out of curiosity
not that my app won't work without them.  The same could be done with
@require_admin v. require_admin(req), kind of an anti-decorator
pattern.<g>

Thanks for all of your help.

-Jeff
http://www.OmahaPython.org

On 5/5/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> A cleanup function will always be passed one argument. This will be
> the data which is supplied when register_cleanup() is called. If no
> cleanup data is supplied, then None will be passed as cleanup data.
> Because Session object save() method already has a 'self' argument,
> the cleanup data becomes the second argument it complains about.
>
> In short, do this:
>
>   def _cleanup(session):
>     session.save()
>
>   req.register_cleanup(_cleanup, req.session)
>
> Graham
>
> On 06/05/07, Jeff Hinrichs - DM&T <jeffh@dundeemt.com> wrote:
> > I know that I am missing something here but googling and banging my
> > head aren't working so I'll ask.
> >
> > I'm trying to register the session.save method from the Session I've
> > attached to the req object in the req.register_cleanup()  like this:
> >
> > # housekeeping setup for a request
> >
> > def housekeeping(fn):
> >
> >     def _setup(req, *args, **kwargs):
> >
> >         #if session isn't part of the req object, add it
> >
> >         if not hasattr(req,"session"):
> >
> >             req.session = Session.Session(req)
> >
> >             req.session['housekeeped']=1
> >
> >         #register session.save as a cleanup
> >
> >         req.register_cleanup(req.session.save)
> >
> >         #now call the original
> >
> >         return fn(req,*args,**kwargs)
> >
> >     return _setup
> >
> >
> > @housekeeping
> > def login(req):
> >
> >     req.session['foo']='bar'
> >
> >     return "We are in login() %s" % req.session.keys()
> >
> > Everything seems peachy, the results returned are:
> >
> >   We are in login() ['foo', 'housekeeped']
> >
> > However, the register_cleanup fails to save the session, and is
> > returning the following err:
> >
> > [notice] vampire: Reimporting module
> > '/usr/home/apache22/lakota.dundeemt.pri/dora/index.py'
> > [error] [client 192.168.2.52] python_cleanup: Error calling cleanup
> > object <bound method DbmSession.save of {'housekeeped': 1}>
> > [error] [client 192.168.2.52]     exceptions.TypeError: save() takes
> > exactly 1 argument (2 given)
> >
> > I've tried changing the register_cleanup to call req.session.save()
> > (as opposed to .save) but that complains, correctly, that save() is
> > not callable.
> >
> > First question, can I register multiple items with multiple calls to
> > req.register_cleanup? i.e.
> > req.register_cleanup(_closedb, req)
> > req.register_cleanup(req.session.save)
> >
> > or is that my problem?  Or have I just been at the keyboard too long
> > to see the error that probably is staring me in the face?  The db
> > cleanup appears to be working without error nor phantom connections.
> >
> > Thanks,
> >
> > Jeff Hinrichs
> > http://www.OmahaPython.org/
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
>


-- 
Jeff Hinrichs
Dundee Media & Technology, Inc
jeffh@dundeemt.com
402.320.0821
From graham.dumpleton at gmail.com  Sun May  6 01:17:29 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sun May  6 01:17:33 2007
Subject: [mod_python] Help with session.save and register_cleanup
In-Reply-To: <5aaed53f0705052206h3ef5faf8v3a7ad35b16c51ea4@mail.gmail.com>
References: <5aaed53f0705051943s66141514scee614c8d42b9420@mail.gmail.com>
	<88e286470705052100r3b83d937tbfabcaaeb717492f@mail.gmail.com>
	<5aaed53f0705052206h3ef5faf8v3a7ad35b16c51ea4@mail.gmail.com>
Message-ID: <88e286470705052217j2bdefe1fya0238e7f528b0950@mail.gmail.com>

On 06/05/07, Jeff Hinrichs - DM&T <jeffh@dundeemt.com> wrote:
> Hey, -- while we are chattting, have you ever tried putting a
> decorator around a vampire.pathArgs wrapped class method?

I use Mac OS X and its standard OS supplied Python version is 2.3.5
which doesn't support decorators, thus I have never actually played
with them myself.

Next week am getting some Windows desktop PCs at work replaced and one
doesn't have to run Windows so will probably install Ubuntu on it with
newest versions of tools like Apache/Python so maybe I might get
around to it some time. :-)

Graham
From rogerb at rogerbinns.com  Sun May  6 16:57:07 2007
From: rogerb at rogerbinns.com (Roger Binns)
Date: Sun May  6 16:57:14 2007
Subject: [mod_python] Setting HTTP response status line
Message-ID: <463E4123.2030701@rogerbinns.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

I'm trying to set the response status line, and failing.

def handler(req):
   raise apache.SERVER_RETURN, (400, "You must supply a foo")

This is with the mod_python on Ubuntu feisty (3.2.10).  From the code in
apache.py, it sets req.status with the text message although the doc
says that is an integer field.

However the http client always receives standard text (eg 'Bad Request'
for code 400).

The PythonDebug option is also confusing.  If I turn it on, then
responses go back as 200 OK with the body of tracebacks etc, whereas
with it off then you get 500 Internal Server Error with no traceback
type information.

It seems to me that if you want to return anything other than success
that Apache goes to great lengths to obliterate whatever it is that you
were trying to send back and replaces it with its own canned
information, hence the behaviour of PythonDebug.  Is there any way
around this?

Roger
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)

iD8DBQFGPkEjmOOfHg372QQRAtuxAKDLsTPlKUZEbhGBS7DBAo0lgFd+8ACfRY5B
Kr0KeQjYPQEAc90GEY5dnbM=
=Rm72
-----END PGP SIGNATURE-----
From graham.dumpleton at gmail.com  Sun May  6 17:53:38 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sun May  6 17:53:43 2007
Subject: [mod_python] Setting HTTP response status line
In-Reply-To: <463E4123.2030701@rogerbinns.com>
References: <463E4123.2030701@rogerbinns.com>
Message-ID: <88e286470705061453o2aa4f7aau66d481ae8812be96@mail.gmail.com>

On 07/05/07, Roger Binns <rogerb@rogerbinns.com> wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> I'm trying to set the response status line, and failing.
>
> def handler(req):
>    raise apache.SERVER_RETURN, (400, "You must supply a foo")
>
> This is with the mod_python on Ubuntu feisty (3.2.10).  From the code in
> apache.py, it sets req.status with the text message although the doc
> says that is an integer field.
>
> However the http client always receives standard text (eg 'Bad Request'
> for code 400).

Where did you get the idea you could do that in the first place?

Where one argument is used with SERVER_RETURN it should be the handler
result code. Eg. apache.OK, apache.DONE or a specific error status
value such as apache.HTTP_BAD_REQUEST (400).

Where one argument is supplied and you return apache.OK or
apache.DONE, it is assumed you have overridden req.status yourself, if
not req.status is set to apache.HTTP_OK (200).

Where two argument are supplied, the first argument should be
apache.OK or apache.DONE. The second argument will be used to set the
value of req.status for you.

At no time can you supply an alternate status line message. Apache
will always use its own internal versions of the strings.

> The PythonDebug option is also confusing.  If I turn it on, then
> responses go back as 200 OK with the body of tracebacks etc, whereas
> with it off then you get 500 Internal Server Error with no traceback
> type information.

What is more confusing is why people keep using old versions of
mod_python where there is a newer, better, less buggy and more stable
version available. Upgrade to mod_python 3.3. See:

  http://issues.apache.org/jira/browse/MODPYTHON-167

> It seems to me that if you want to return anything other than success
> that Apache goes to great lengths to obliterate whatever it is that you
> were trying to send back and replaces it with its own canned
> information, hence the behaviour of PythonDebug.  Is there any way
> around this?

For the status line message the answer is no. Why would you want to
change the message from the normal one anyway?

If your complaint is because you are getting the mod_python traceback
error page when you use the above SERVER_RETURN, I'm not surprised as
your code is wrong and mod_python would be complaining that you are
giving it a string when it is expecting an integer.

Graham
From rogerb at rogerbinns.com  Sun May  6 18:18:45 2007
From: rogerb at rogerbinns.com (Roger Binns)
Date: Sun May  6 18:18:47 2007
Subject: [mod_python] Setting HTTP response status line
In-Reply-To: <88e286470705061453o2aa4f7aau66d481ae8812be96@mail.gmail.com>
References: <463E4123.2030701@rogerbinns.com>
	<88e286470705061453o2aa4f7aau66d481ae8812be96@mail.gmail.com>
Message-ID: <463E5445.6020408@rogerbinns.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Graham Dumpleton wrote:
> Where did you get the idea you could do that in the first place?

The code took two parameters and so it was a (wrong) educated guess as
to what they were :-)

> At no time can you supply an alternate status line message. Apache
> will always use its own internal versions of the strings.

That is a pity.  I was hoping to use it as part of my automated testing.

> What is more confusing is why people keep using old versions of
> mod_python 

3.2.10 wasn't released that long ago.  It is the default one supplied
with Feisty which went into freeze a few months ago (ie before 3.3.1 was
released).  If 3.3.1 was guaranteed bug free at release etc then I'm
sure they could have sneaked it in, but I doubt it or any other software
can make those guarantees :-)

>  http://issues.apache.org/jira/browse/MODPYTHON-167

That is pretty much the problem.  I ultimately solved all the issues by
writing a decorator for my handlers that checks return codes (I got
bitten a few times forgetting to return OK or DECLINED), sets the
correct codes, prints stack traces with variables (see
http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/52215 ) etc.

> For the status line message the answer is no. Why would you want to
> change the message from the normal one anyway?

So I can use it in my testing.  The status line is intended to be
targeted at machines and hence can be terse.  The body is longer winded
and targeted at people.  (Sure it can be done either way but it was just
something I hoped to be able to do).

Roger
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)

iD8DBQFGPlREmOOfHg372QQRAjKCAJ42Kj/uxj/0WSXuO4vjp8sYUAJatgCeKSEE
no/XSBy+Qs9jJD/ax9lyi8o=
=fKps
-----END PGP SIGNATURE-----
From graham.dumpleton at gmail.com  Sun May  6 18:34:21 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sun May  6 18:34:25 2007
Subject: [mod_python] Setting HTTP response status line
In-Reply-To: <463E5445.6020408@rogerbinns.com>
References: <463E4123.2030701@rogerbinns.com>
	<88e286470705061453o2aa4f7aau66d481ae8812be96@mail.gmail.com>
	<463E5445.6020408@rogerbinns.com>
Message-ID: <88e286470705061534l45474a2fva17775c7eb12a397@mail.gmail.com>

On 07/05/07, Roger Binns <rogerb@rogerbinns.com> wrote:
> > What is more confusing is why people keep using old versions of
> > mod_python
>
> 3.2.10 wasn't released that long ago.

About nine months ago. :-)

> It is the default one supplied
> with Feisty which went into freeze a few months ago (ie before 3.3.1 was
> released).  If 3.3.1 was guaranteed bug free at release etc then I'm
> sure they could have sneaked it in, but I doubt it or any other software
> can make those guarantees :-)

There haven't been any complaints about mod_python 3.3.1 and we have
no immediate plans as such to come out with another bug fix release in
the near future. Yes there are still known issues with mod_python but
more to do with lack of functionality than outright bugs and certainly
not in the core stuff that everyone uses.

> > For the status line message the answer is no. Why would you want to
> > change the message from the normal one anyway?
>
> So I can use it in my testing.  The status line is intended to be
> targeted at machines and hence can be terse.  The body is longer winded
> and targeted at people.  (Sure it can be done either way but it was just
> something I hoped to be able to do).

Consider setting a special response header just when doing testing. For example:

  X-Test-Information: Some value.

The 'X-' prefix is generally accepted as being for non standard
headers. Your test client can then extra information from that.

Graham
From rogerb at rogerbinns.com  Sun May  6 18:51:30 2007
From: rogerb at rogerbinns.com (Roger Binns)
Date: Sun May  6 18:51:34 2007
Subject: [mod_python] Setting HTTP response status line
In-Reply-To: <88e286470705061534l45474a2fva17775c7eb12a397@mail.gmail.com>
References: <463E4123.2030701@rogerbinns.com>	
	<88e286470705061453o2aa4f7aau66d481ae8812be96@mail.gmail.com>	
	<463E5445.6020408@rogerbinns.com>
	<88e286470705061534l45474a2fva17775c7eb12a397@mail.gmail.com>
Message-ID: <463E5BF2.5050602@rogerbinns.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Graham Dumpleton wrote:
> About nine months ago. :-)

Feisty went into freeze on February 8th or December 21st for stuff
originating in Debian.  3.3.1 was out for minus one week (or more).
3.2.10 had been out for 6 months by that point.

  https://wiki.ubuntu.com/FeistyReleaseSchedule

The schedules unfortunately didn't match each other.  The 3.2.10 package
does include some bug fixes (technically it is on the 3rd spin).

The moral of the story for providers of packages is that nothing is more
important than the Ubuntu schedule :-)

> There haven't been any complaints about mod_python 3.3.1 

The Ubuntu developers could hardly have been able to predict that a week
or more before it was released!

> Consider setting a special response header just when doing testing. 

I will actually be emitting something all the time.  eg if a request
must include a "foo" then I'll be stating that in the stuff that goes
back.  It is also helpful to distinguish "Internal Server Error" when
something in Apache has messed up vs when my code messed up :-)

>  X-Test-Information: Some value.

Yup, I have to revisit how to deal with returning error information in
machine and human readable forms.  Short of the status line, I guess
headers are going to be the best for machine readable.

Hmmm, I wonder if I could pickle an exception and traceback, base64
encode it and return in a header?  Kidding :-)

Roger
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)

iD8DBQFGPlvymOOfHg372QQRAg8UAKCHeh9n6gGKPxb7X0cRsyOQFtsmmACdGFK9
cvMBSIcWTGE1O8UdUFpAIWI=
=fzCY
-----END PGP SIGNATURE-----
From durumdara at gmail.com  Mon May  7 04:22:01 2007
From: durumdara at gmail.com (durumdara)
Date: Mon May  7 04:22:20 2007
Subject: [mod_python] Pre and postprocess blocks (Publisher mode)?
In-Reply-To: <88e286470705040250y40677fa7i794d31b53a770f69@mail.gmail.com>
References: <463AEAD3.6050809@gmail.com>
	<88e286470705040250y40677fa7i794d31b53a770f69@mail.gmail.com>
Message-ID: <463EE1A9.3040807@gmail.com>

Hi!

Graham Dumpleton wrote:
>> Because the controllers are python modules, it is avoid the "same module
>> name" hell (in another modules I can use same name - example index).
>
> What exactly are you talking about when you say 'same module name hell'?
The basic python import problem - example: more index.py.
>
> module reloading. See the apache.import_module() function described
> in:
>
>  http://www.modpython.org/live/current/doc-html/pyapi-apmeth.html
Yes, I know it, and now I use it (3.3.1).
>
>> I know that modpy supports publisher mode, that same like pylons'
>> working method.
>>
>> 1.)
>> But I want to know: how the modpython helps me to I do pre- and
>> postprocess operations?
>
> Apache/mod_python actually has a much better developed concept of
> request processing phases than Pylons and other monolithic solutions
> such as Django. Have a look at the section '4.4.4 Process HTTP
> Request' in:
>
>  http://www.fmc-modeling.org/projects/apache/html/4_4Request_Response_Loop.html 
>
It is too complicated for me to understand these process-diagrams of apache.
> A post handler or cleanup handler can be registered using the
> req.register_cleanup() method. See documentation in:
>
>  http://www.modpython.org/live/current/doc-html/pyapi-mprequest-meth.html
> So, read through all those references and try and take it in. Then
> perhaps come back with more specific questions with examples of what
> you have tried.

I simplify my question:.
I want to use only two callback functions: the first named "pre" must 
called by apache *before* the calling of published procedure, and the 
second (named "post") must called by apache *after* the calling of 
published procedure.

So the question is that: can I set these two callback functions in the 
PUBLISHER HANDLER to initialize and finalize the request handling?
Like in pylons?

In pylons the controllers have _before_ and _after_ methods, they are 
called before/after the calling of the action method.
Example:
.... XController:
  def __before__(self):
       OpenSession()
       OpenDB()
       CheckLogin()
   def __after__(sefl):
       SaveSession()

   def  index(self):
        return Response('INDEX!')

How to I use same mechanism in modpy3.3.1?

Like this pseudocode:

<Directory ...>
   AddHandler publisher prefunctionname Pre postfunctionname Post
...

Thanks for your help:
  dd


From graham.dumpleton at gmail.com  Mon May  7 05:33:07 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon May  7 05:33:18 2007
Subject: [mod_python] Pre and postprocess blocks (Publisher mode)?
In-Reply-To: <463EE1A9.3040807@gmail.com>
References: <463AEAD3.6050809@gmail.com>
	<88e286470705040250y40677fa7i794d31b53a770f69@mail.gmail.com>
	<463EE1A9.3040807@gmail.com>
Message-ID: <88e286470705070233t1ace6ab4jb8245c2865e45261@mail.gmail.com>

> I simplify my question:.
> I want to use only two callback functions: the first named "pre" must
> called by apache *before* the calling of published procedure, and the
> second (named "post") must called by apache *after* the calling of
> published procedure.
>
> So the question is that: can I set these two callback functions in the
> PUBLISHER HANDLER to initialize and finalize the request handling?
> Like in pylons?
>
> In pylons the controllers have _before_ and _after_ methods, they are
> called before/after the calling of the action method.
> Example:
> .... XController:
>   def __before__(self):
>        OpenSession()
>        OpenDB()
>        CheckLogin()
>    def __after__(sefl):
>        SaveSession()
>
>    def  index(self):
>         return Response('INDEX!')
>
> How to I use same mechanism in modpy3.3.1?
>
> Like this pseudocode:
>
> <Directory ...>
>    AddHandler publisher prefunctionname Pre postfunctionname Post
> ...

If you are not prepared to do it the Apache way, the simplest thing
would be to define your own custom mod_python handler:

  PythonHandler myhandler

In that handler, then do something like:

  import mod_python.publisher

  def handler(req):

    before(req)
    try:
        return mod_python.publisher.handler(req)
    finally:
        after(req)

Graham
From nlv11281 at natlab.research.philips.com  Tue May  8 02:11:09 2007
From: nlv11281 at natlab.research.philips.com (Mike Looijmans)
Date: Tue May  8 02:11:27 2007
Subject: [mod_python] Setting HTTP response status line
In-Reply-To: <463E5BF2.5050602@rogerbinns.com>
References: <463E4123.2030701@rogerbinns.com>		<88e286470705061453o2aa4f7aau66d481ae8812be96@mail.gmail.com>		<463E5445.6020408@rogerbinns.com>	<88e286470705061534l45474a2fva17775c7eb12a397@mail.gmail.com>
	<463E5BF2.5050602@rogerbinns.com>
Message-ID: <4640147D.6030801@natlab.research.philips.com>

Roger Binns wrote:
> Yup, I have to revisit how to deal with returning error information in
> machine and human readable forms.  Short of the status line, I guess
> headers are going to be the best for machine readable.

When testing, I just return a 500 page, with an Exception header and a format of text/plain with the 
traceback and stuff. The handler code just throws that text in a new exception and that makes it end 
up into the test logs (unless the call was supposed to fail - bad weather testing is good for the soul).

> Hmmm, I wonder if I could pickle an exception and traceback, base64
> encode it and return in a header?  Kidding :-)

Why in the header? You can use the body as well, so you won't need the encoding at all. It can be 
done, but you must have all the modules that are touched in the traceback at the client side.

On second guess, it won't work because the objects the stack trace refers to can probably not be 
pickled anyway (callables, instances of weird classes, ...). It's safer to convert to text first 
using the traceback module.

--
Mike Looijmans
Philips Natlab / Topic Automation



From fletcher at cs.utexas.edu  Tue May  8 16:39:38 2007
From: fletcher at cs.utexas.edu (Fletcher Mattox)
Date: Tue May  8 16:39:48 2007
Subject: [mod_python] undefined symbol: mod_mod_python
Message-ID: <200705082039.l48KddV8001248@cs.utexas.edu>

Hi,

When I upgraded from apache 2.0.55 to 2.2.4, mod_python stopped
working:

z.cs.utexas.edu# ../bin/apachectl start 
  httpd: Syntax error on line 54 of \
  /lusr/opt/apache-test/conf/httpd.conf: \
  Can't locate API module structure `mod_python' in \
  file /lusr/opt/apache-test/modules/mod_python.so: \
  /lusr/opt/apache-test/modules/mod_python.so: undefined symbol: mod_python
z.cs.utexas.edu# 

Googling around a little, I seem to be the only one with this problem.
This is an extremely vanilla configuration running ubuntu dapper.
mod_python works fine under apache 2.0.55. 
Does anyone know where I should start looking?

Thanks
Fletcher


From graham.dumpleton at gmail.com  Tue May  8 18:20:38 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue May  8 18:20:42 2007
Subject: [mod_python] undefined symbol: mod_mod_python
In-Reply-To: <200705082039.l48KddV8001248@cs.utexas.edu>
References: <200705082039.l48KddV8001248@cs.utexas.edu>
Message-ID: <88e286470705081520j3cffa828rbe74bc7d8b535668@mail.gmail.com>

Did you either upgrade your mod_python binary package to a newer
version built specifically for the new version of Apache, or rebuild
mod_python from source code against the newer version of Apache.

This error typically means you are using a version of the
mod_python.so compiled against a different version of Apache than what
you are running.

On 09/05/07, Fletcher Mattox <fletcher@cs.utexas.edu> wrote:
> Hi,
>
> When I upgraded from apache 2.0.55 to 2.2.4, mod_python stopped
> working:
>
> z.cs.utexas.edu# ../bin/apachectl start
>   httpd: Syntax error on line 54 of \
>   /lusr/opt/apache-test/conf/httpd.conf: \
>   Can't locate API module structure `mod_python' in \
>   file /lusr/opt/apache-test/modules/mod_python.so: \
>   /lusr/opt/apache-test/modules/mod_python.so: undefined symbol: mod_python
> z.cs.utexas.edu#
>
> Googling around a little, I seem to be the only one with this problem.
> This is an extremely vanilla configuration running ubuntu dapper.
> mod_python works fine under apache 2.0.55.
> Does anyone know where I should start looking?
>
> Thanks
> Fletcher
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From fletcher at cs.utexas.edu  Tue May  8 18:28:58 2007
From: fletcher at cs.utexas.edu (Fletcher Mattox)
Date: Tue May  8 18:29:07 2007
Subject: [mod_python] undefined symbol: mod_mod_python
In-Reply-To: <88e286470705081520j3cffa828rbe74bc7d8b535668@mail.gmail.com>
Message-ID: <200705082228.l48MSwQF003233@z.cs.utexas.edu>

Graham,

I don't think there is a version mismatch.  I recompiled
both apache 2.2.4 and mod_python 3.3.1 from source code,
just as I always do when I upgrade.

Also, whatever it is, is unique to mod_python.  All my
other modules (mod_php, mod_perl, et al) work fine with
apache 2.2.4.

Thanks
Fletcher

> From graham.dumpleton@gmail.com  Tue May  8 17:20:44 2007
> From: "Graham Dumpleton" <graham.dumpleton@gmail.com>
> To: "Fletcher Mattox" <fletcher@cs.utexas.edu>
> Subject: Re: [mod_python] undefined symbol: mod_mod_python
> Cc: mod_python@modpython.org
> 
> Did you either upgrade your mod_python binary package to a newer
> version built specifically for the new version of Apache, or rebuild
> mod_python from source code against the newer version of Apache.
> 
> This error typically means you are using a version of the
> mod_python.so compiled against a different version of Apache than what
> you are running.
> 
> On 09/05/07, Fletcher Mattox <fletcher@cs.utexas.edu> wrote:
> > Hi,
> >
> > When I upgraded from apache 2.0.55 to 2.2.4, mod_python stopped
> > working:
> >
> > z.cs.utexas.edu# ../bin/apachectl start
> >   httpd: Syntax error on line 54 of \
> >   /lusr/opt/apache-test/conf/httpd.conf: \
> >   Can't locate API module structure `mod_python' in \
> >   file /lusr/opt/apache-test/modules/mod_python.so: \
> >   /lusr/opt/apache-test/modules/mod_python.so: undefined symbol: mod_python
> > z.cs.utexas.edu#
> >
> > Googling around a little, I seem to be the only one with this problem.
> > This is an extremely vanilla configuration running ubuntu dapper.
> > mod_python works fine under apache 2.0.55.
> > Does anyone know where I should start looking?
> >
> > Thanks
> > Fletcher
> >
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
> 

From graham.dumpleton at gmail.com  Tue May  8 18:31:46 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue May  8 18:31:50 2007
Subject: [mod_python] undefined symbol: mod_mod_python
In-Reply-To: <200705082228.l48MSwQF003233@z.cs.utexas.edu>
References: <88e286470705081520j3cffa828rbe74bc7d8b535668@mail.gmail.com>
	<200705082228.l48MSwQF003233@z.cs.utexas.edu>
Message-ID: <88e286470705081531q4542822elf9345ca343b1de89@mail.gmail.com>

Let me try again then. Have you perhaps written your LoadModule line as:

  LoadModule mod_python modules/mod_python.so

instead of:

  LoadModule python_module modules/mod_python.so

Graham

On 09/05/07, Fletcher Mattox <fletcher@cs.utexas.edu> wrote:
> Graham,
>
> I don't think there is a version mismatch.  I recompiled
> both apache 2.2.4 and mod_python 3.3.1 from source code,
> just as I always do when I upgrade.
>
> Also, whatever it is, is unique to mod_python.  All my
> other modules (mod_php, mod_perl, et al) work fine with
> apache 2.2.4.
>
> Thanks
> Fletcher
>
> > From graham.dumpleton@gmail.com  Tue May  8 17:20:44 2007
> > From: "Graham Dumpleton" <graham.dumpleton@gmail.com>
> > To: "Fletcher Mattox" <fletcher@cs.utexas.edu>
> > Subject: Re: [mod_python] undefined symbol: mod_mod_python
> > Cc: mod_python@modpython.org
> >
> > Did you either upgrade your mod_python binary package to a newer
> > version built specifically for the new version of Apache, or rebuild
> > mod_python from source code against the newer version of Apache.
> >
> > This error typically means you are using a version of the
> > mod_python.so compiled against a different version of Apache than what
> > you are running.
> >
> > On 09/05/07, Fletcher Mattox <fletcher@cs.utexas.edu> wrote:
> > > Hi,
> > >
> > > When I upgraded from apache 2.0.55 to 2.2.4, mod_python stopped
> > > working:
> > >
> > > z.cs.utexas.edu# ../bin/apachectl start
> > >   httpd: Syntax error on line 54 of \
> > >   /lusr/opt/apache-test/conf/httpd.conf: \
> > >   Can't locate API module structure `mod_python' in \
> > >   file /lusr/opt/apache-test/modules/mod_python.so: \
> > >   /lusr/opt/apache-test/modules/mod_python.so: undefined symbol: mod_python
> > > z.cs.utexas.edu#
> > >
> > > Googling around a little, I seem to be the only one with this problem.
> > > This is an extremely vanilla configuration running ubuntu dapper.
> > > mod_python works fine under apache 2.0.55.
> > > Does anyone know where I should start looking?
> > >
> > > Thanks
> > > Fletcher
> > >
> > >
> > > _______________________________________________
> > > Mod_python mailing list
> > > Mod_python@modpython.org
> > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > >
> >
>
>
From fletcher at cs.utexas.edu  Tue May  8 19:12:26 2007
From: fletcher at cs.utexas.edu (Fletcher Mattox)
Date: Tue May  8 19:12:44 2007
Subject: [mod_python] undefined symbol: mod_mod_python
In-Reply-To: <88e286470705081531q4542822elf9345ca343b1de89@mail.gmail.com>
Message-ID: <200705082312.l48NCQJg002554@cs.utexas.edu>

I think httpd.conf is correct:

z.cs.utexas.edu$ grep ^Load httpd.conf 
LoadModule mod_python modules/mod_python.so
z.cs.utexas.edu$ 

Fletcher

> From graham.dumpleton@gmail.com  Tue May  8 17:31:53 2007
> From: "Graham Dumpleton" <graham.dumpleton@gmail.com>
> To: "Fletcher Mattox" <fletcher@cs.utexas.edu>
> Subject: Re: [mod_python] undefined symbol: mod_mod_python
> Cc: mod_python@modpython.org
> 
> Let me try again then. Have you perhaps written your LoadModule line as:
> 
>   LoadModule mod_python modules/mod_python.so
> 
> instead of:
> 
>   LoadModule python_module modules/mod_python.so
> 
> Graham
> 
> On 09/05/07, Fletcher Mattox <fletcher@cs.utexas.edu> wrote:
> > Graham,
> >
> > I don't think there is a version mismatch.  I recompiled
> > both apache 2.2.4 and mod_python 3.3.1 from source code,
> > just as I always do when I upgrade.
> >
> > Also, whatever it is, is unique to mod_python.  All my
> > other modules (mod_php, mod_perl, et al) work fine with
> > apache 2.2.4.
> >
> > Thanks
> > Fletcher
> >
> > > From graham.dumpleton@gmail.com  Tue May  8 17:20:44 2007
> > > From: "Graham Dumpleton" <graham.dumpleton@gmail.com>
> > > To: "Fletcher Mattox" <fletcher@cs.utexas.edu>
> > > Subject: Re: [mod_python] undefined symbol: mod_mod_python
> > > Cc: mod_python@modpython.org
> > >
> > > Did you either upgrade your mod_python binary package to a newer
> > > version built specifically for the new version of Apache, or rebuild
> > > mod_python from source code against the newer version of Apache.
> > >
> > > This error typically means you are using a version of the
> > > mod_python.so compiled against a different version of Apache than what
> > > you are running.
> > >
> > > On 09/05/07, Fletcher Mattox <fletcher@cs.utexas.edu> wrote:
> > > > Hi,
> > > >
> > > > When I upgraded from apache 2.0.55 to 2.2.4, mod_python stopped
> > > > working:
> > > >
> > > > z.cs.utexas.edu# ../bin/apachectl start
> > > >   httpd: Syntax error on line 54 of \
> > > >   /lusr/opt/apache-test/conf/httpd.conf: \
> > > >   Can't locate API module structure `mod_python' in \
> > > >   file /lusr/opt/apache-test/modules/mod_python.so: \
> > > >   /lusr/opt/apache-test/modules/mod_python.so: undefined symbol: mod_python
> > > > z.cs.utexas.edu#
> > > >
> > > > Googling around a little, I seem to be the only one with this problem.
> > > > This is an extremely vanilla configuration running ubuntu dapper.
> > > > mod_python works fine under apache 2.0.55.
> > > > Does anyone know where I should start looking?
> > > >
> > > > Thanks
> > > > Fletcher
> > > >
> > > >
> > > > _______________________________________________
> > > > Mod_python mailing list
> > > > Mod_python@modpython.org
> > > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > > >
> > >
> >
> >
> 

From graham.dumpleton at gmail.com  Tue May  8 20:20:10 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue May  8 20:20:14 2007
Subject: [mod_python] undefined symbol: mod_mod_python
In-Reply-To: <200705082312.l48NCQJg002554@cs.utexas.edu>
References: <88e286470705081531q4542822elf9345ca343b1de89@mail.gmail.com>
	<200705082312.l48NCQJg002554@cs.utexas.edu>
Message-ID: <88e286470705081720l38ecc0c0nb91151850272c616@mail.gmail.com>

Which is wrong. It must be:

  LoadModule python_module modules/mod_python.so

I should have perhaps expressed my question a bit better to indicate
what I saw as possible problem.

Graham

On 09/05/07, Fletcher Mattox <fletcher@cs.utexas.edu> wrote:
> I think httpd.conf is correct:
>
> z.cs.utexas.edu$ grep ^Load httpd.conf
> LoadModule mod_python modules/mod_python.so
> z.cs.utexas.edu$
>
> Fletcher
>
> > From graham.dumpleton@gmail.com  Tue May  8 17:31:53 2007
> > From: "Graham Dumpleton" <graham.dumpleton@gmail.com>
> > To: "Fletcher Mattox" <fletcher@cs.utexas.edu>
> > Subject: Re: [mod_python] undefined symbol: mod_mod_python
> > Cc: mod_python@modpython.org
> >
> > Let me try again then. Have you perhaps written your LoadModule line as:
> >
> >   LoadModule mod_python modules/mod_python.so
> >
> > instead of:
> >
> >   LoadModule python_module modules/mod_python.so
> >
> > Graham
> >
> > On 09/05/07, Fletcher Mattox <fletcher@cs.utexas.edu> wrote:
> > > Graham,
> > >
> > > I don't think there is a version mismatch.  I recompiled
> > > both apache 2.2.4 and mod_python 3.3.1 from source code,
> > > just as I always do when I upgrade.
> > >
> > > Also, whatever it is, is unique to mod_python.  All my
> > > other modules (mod_php, mod_perl, et al) work fine with
> > > apache 2.2.4.
> > >
> > > Thanks
> > > Fletcher
> > >
> > > > From graham.dumpleton@gmail.com  Tue May  8 17:20:44 2007
> > > > From: "Graham Dumpleton" <graham.dumpleton@gmail.com>
> > > > To: "Fletcher Mattox" <fletcher@cs.utexas.edu>
> > > > Subject: Re: [mod_python] undefined symbol: mod_mod_python
> > > > Cc: mod_python@modpython.org
> > > >
> > > > Did you either upgrade your mod_python binary package to a newer
> > > > version built specifically for the new version of Apache, or rebuild
> > > > mod_python from source code against the newer version of Apache.
> > > >
> > > > This error typically means you are using a version of the
> > > > mod_python.so compiled against a different version of Apache than what
> > > > you are running.
> > > >
> > > > On 09/05/07, Fletcher Mattox <fletcher@cs.utexas.edu> wrote:
> > > > > Hi,
> > > > >
> > > > > When I upgraded from apache 2.0.55 to 2.2.4, mod_python stopped
> > > > > working:
> > > > >
> > > > > z.cs.utexas.edu# ../bin/apachectl start
> > > > >   httpd: Syntax error on line 54 of \
> > > > >   /lusr/opt/apache-test/conf/httpd.conf: \
> > > > >   Can't locate API module structure `mod_python' in \
> > > > >   file /lusr/opt/apache-test/modules/mod_python.so: \
> > > > >   /lusr/opt/apache-test/modules/mod_python.so: undefined symbol: mod_python
> > > > > z.cs.utexas.edu#
> > > > >
> > > > > Googling around a little, I seem to be the only one with this problem.
> > > > > This is an extremely vanilla configuration running ubuntu dapper.
> > > > > mod_python works fine under apache 2.0.55.
> > > > > Does anyone know where I should start looking?
> > > > >
> > > > > Thanks
> > > > > Fletcher
> > > > >
> > > > >
> > > > > _______________________________________________
> > > > > Mod_python mailing list
> > > > > Mod_python@modpython.org
> > > > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > > > >
> > > >
> > >
> > >
> >
>
>
From fletcher at cs.utexas.edu  Tue May  8 20:37:37 2007
From: fletcher at cs.utexas.edu (Fletcher Mattox)
Date: Tue May  8 20:37:46 2007
Subject: [mod_python] undefined symbol: mod_mod_python
In-Reply-To: <88e286470705081720l38ecc0c0nb91151850272c616@mail.gmail.com>
Message-ID: <200705090037.l490bbuA002292@cs.utexas.edu>

> Which is wrong. It must be:
> 
>   LoadModule python_module modules/mod_python.so

Groan.  I apologize.  I stared at that all day and did not see it.
My wife calls it refrigerator vision.  Thank you, Graham, for your
patience.

Fletcher
From ben at kilgore.demon.co.uk  Wed May  9 06:18:12 2007
From: ben at kilgore.demon.co.uk (Ben Thompson)
Date: Wed May  9 06:18:25 2007
Subject: [mod_python] Installation problems with mod_python
Message-ID: <200705091018.l49AIJWG008960@modpython.org>

Hi,

 

First-time user of this mailing-list and apache/python here. Please be
gentle with me :-)

 

Problem: When I point my browser at a file with the extension .py, the
browser displays the contents of the file rather than the results of running
it. Apache and python both seem to run ok. I have checked FAQs/How
Tos/Getting Started guides but without success.

 

Platform: Windows XP Professional Version 2002 Service Pack 2

 

Here are the relevant lines from httpd.conf:

 

# Python

LoadModule python_module modules/mod_python.so

 

# Python

<Directory E:/Projects/Web/Home/htdocs/test> 

        AddHandler mod_python .py

        PythonHandler mptest 

        PythonDebug On 

</Directory>

<Location /mpinfo>

      SetHandler mod_python

      PythonHandler mod_python.testhandler

</Location>

<Directory E:/Projects/Web/Home/htdocs/test>

AllowOverride FileInfo

</Directory>

 

The mpinfo location directive seems to work. Here is the Apache version line
from http://localhost/mpinfo:

 

Apache/2.2.4 (Win32) mod_python/3.3.1 Python/2.5.1 PHP/5.2.1

 

But I see no sign of mod_python being loaded successfully in logs/error.log.
Here is what happens when I restart the server:

 

[Sun May 06 23:55:49 2007] [notice] Parent: Received shutdown signal --
Shutting down the server.

[Sun May 06 23:55:49 2007] [notice] Child 2192: Exit event signaled. Child
process is ending.

[Sun May 06 23:55:50 2007] [notice] Child 2192: Released the start mutex

[Sun May 06 23:55:51 2007] [notice] Child 2192: Waiting for 250 worker
threads to exit.

[Sun May 06 23:55:51 2007] [notice] Child 2192: All worker threads have
exited.

[Sun May 06 23:55:51 2007] [notice] Child 2192: Child process is exiting

[Sun May 06 23:55:51 2007] [notice] Parent: Child process exited
successfully.

[Sun May 06 23:55:56 2007] [notice] Apache/2.2.4 (Win32) PHP/5.2.1
configured -- resuming normal operations

[Sun May 06 23:55:56 2007] [notice] Server built: Jan  9 2007 23:17:20

[Sun May 06 23:55:56 2007] [notice] Parent: Created child process 1904

[Sun May 06 23:55:56 2007] [error] python_init: Python version mismatch,
expected '2.5', found '2.5.1'.

[Sun May 06 23:55:56 2007] [error] python_init: Python executable found
'E:\\Program Files\\Apache Software Foundation\\Apache2.2\\bin\\httpd.exe'.

[Sun May 06 23:55:56 2007] [error] python_init: Python path being used
'C:\\WINDOWS\\system32\\python25.zip;E:\\Python25\\Lib;E:\\Python25\\DLLs;E:
\\Python25\\Lib\\lib-tk;;E:\\Program Files\\Apache Software
Foundation\\Apache2.2\\bin'.

[Sun May 06 23:55:56 2007] [notice] mod_python: Creating 8 session mutexes
based on 0 max processes and 250 max threads.

PHP Warning:  Module 'mysql' already loaded in Unknown on line 0

[Sun May 06 23:55:56 2007] [notice] Child 1904: Child process is running

[Sun May 06 23:55:56 2007] [notice] Child 1904: Acquired the start mutex.

[Sun May 06 23:55:56 2007] [notice] Child 1904: Starting 250 worker threads.

[Sun May 06 23:55:56 2007] [notice] Child 1904: Starting thread to listen on
port 80.

 

At one point I read a suggestion to create a .htaccess file in my test
directory (:/Projects/Web/Home/htdocs/test) but on Windows you can't name a
file ".htaccess" so I guess that the right thing to do was to call it
"htaccess" with no extension. E:/Projects/Web/Home/htdocs/test/htaccess
contains:

 

AddHandler mod_python .py

PythonHandler mptest

PythonDebug On

 

and E:/Projects/Web/Home/htdocs/test/mptest.py contains

 

from mod_python import apache

 

def handler(req):

            req.log_error('handler')

            req.content_type = 'text/plain'

            req.send_http_header()

            return apache.OK

 

I note that if I run this from the command prompt I get:

 

Traceback (most recent call last):

  File "mptest.py", line 1, in <module>

    from mod_python import apache

  File "E:\Python25\Lib\site-packages\mod_python\apache.py", line 30, in
<module>

    import _apache

ImportError: No module named _apache

 

 

I can't quite put together all the evidence to sort this out. Any help
gratefully received.

 

Ben

 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070509/a4d7c7cc/attachment-0001.html
From m.r.sanders at gmail.com  Wed May  9 08:46:46 2007
From: m.r.sanders at gmail.com (Michael Sanders)
Date: Wed May  9 08:46:58 2007
Subject: [mod_python] Multiple loading of same module with winnt MPM
Message-ID: <4641C2B6.7060302@gmail.com>

Environment:
- mod_python 3.3.1
- Apache 2.2.3 running on Windows XP
- PSP request handler

[Issue 4] described at the following link still appears to be present in 
mod_python 3.3.1:
http://www.dscpl.com.au/wiki/ModPython/Articles/ModuleImportingIsBroken#line-50

I have a PSP file that imports a module using 'apache.import_module'. If 
I re-start Apache and then fire two simultaneous requests at the PSP 
file, mod_python loads the module twice. (The module in question when 
imported  sets up a logging handler. The initial entry written by this 
module to the log file is duplicated and subsequent calls to this 
handler also give duplicate entries in the log file).

If I import the module using the standard Python 'import', this problem 
does not occur. Likewise, if I use the 'vampire.importModule' method, 
the problem does not occur. The issue only happens when using 
'apache.import_module'.

Has anyone else experienced this? Is there a fix?

Many thanks,
Michael Sanders
From graham.dumpleton at gmail.com  Wed May  9 18:00:47 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Wed May  9 18:00:56 2007
Subject: [mod_python] Multiple loading of same module with winnt MPM
In-Reply-To: <4641C2B6.7060302@gmail.com>
References: <4641C2B6.7060302@gmail.com>
Message-ID: <88e286470705091500l43c18808qe095ca20b8f238c3@mail.gmail.com>

Post the snippet of PSP code you are doing the import from.

Post the Apache configuration snippet you are using so it can be seen
whether you are setting PythonPath to include a directory which
overlaps the document area and whether you are using Apache style
forward slashes in paths or Windows backwards slashes.

Post the snippets of the log files which show when the module is being
loaded so can see the paths it is being loaded under. Especially post
any warnings output about a path appearing in sys.path as well as
mod_python module importer path.

The only issue I know of with PSP and the new module importer is that
if you use 'import' rather than 'apache.import_module()', the 'import'
will always use standard Python module importer and not
'apache.import_module()'. Thus if you were trying to import a module
from the same directory it by default will not work. If you fiddled
PythonPath to include that directory, thus creating an overlap in the
two systems, it will import but thus may be imported separately by
both mechanisms.

To address this latter problem, PSP needs to be changed to fake up
some information in the page pseudo module so that it thinks it was
imported used mod_python importer in the first place and will thus map
'import' through to 'apache.import_module()' properly.

Graham

On 09/05/07, Michael Sanders <m.r.sanders@gmail.com> wrote:
> Environment:
> - mod_python 3.3.1
> - Apache 2.2.3 running on Windows XP
> - PSP request handler
>
> [Issue 4] described at the following link still appears to be present in
> mod_python 3.3.1:
> http://www.dscpl.com.au/wiki/ModPython/Articles/ModuleImportingIsBroken#line-50
>
> I have a PSP file that imports a module using 'apache.import_module'. If
> I re-start Apache and then fire two simultaneous requests at the PSP
> file, mod_python loads the module twice. (The module in question when
> imported  sets up a logging handler. The initial entry written by this
> module to the log file is duplicated and subsequent calls to this
> handler also give duplicate entries in the log file).
>
> If I import the module using the standard Python 'import', this problem
> does not occur. Likewise, if I use the 'vampire.importModule' method,
> the problem does not occur. The issue only happens when using
> 'apache.import_module'.
>
> Has anyone else experienced this? Is there a fix?
>
> Many thanks,
> Michael Sanders
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From graham.dumpleton at gmail.com  Thu May 10 02:27:11 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu May 10 02:27:17 2007
Subject: [mod_python] Installation problems with mod_python
In-Reply-To: <200705091018.l49AIJWG008960@modpython.org>
References: <200705091018.l49AIJWG008960@modpython.org>
Message-ID: <88e286470705092327u63ee900an4425ae34214ff617@mail.gmail.com>

On 09/05/07, Ben Thompson <ben@kilgore.demon.co.uk> wrote:
>
>
> Problem: When I point my browser at a file with the extension .py, the
> browser displays the contents of the file rather than the results of running
> it. Apache and python both seem to run ok. I have checked FAQs/How
> Tos/Getting Started guides but without success.
>
> Platform: Windows XP Professional Version 2002 Service Pack 2
>
> Here are the relevant lines from httpd.conf:
>
>
>
> # Python
>
> LoadModule python_module modules/mod_python.so
>
>
>
> # Python
>
> <Directory E:/Projects/Web/Home/htdocs/test>
>
>         AddHandler mod_python .py
>
>         PythonHandler mptest
>
>         PythonDebug On
>
> </Directory>
>
> <Location /mpinfo>
>
>       SetHandler mod_python
>
>       PythonHandler mod_python.testhandler
>
> </Location>
>
> <Directory E:/Projects/Web/Home/htdocs/test>
>
> AllowOverride FileInfo
>
> </Directory>

What is your 'DocumentRoot' directive set to which indicates where
your Apache document root directory is? If for some reason it doesn't
match as a prefix to the above locations it may not work as a result.

Unless  I am missing the obvious, the configuration otherwise looks okay.

BTW, what is the actual URL you are using to access the page?

> The mpinfo location directive seems to work. Here is the Apache version line
> from http://localhost/mpinfo:
>
>
>
> Apache/2.2.4 (Win32) mod_python/3.3.1 Python/2.5.1 PHP/5.2.1
>
>
>
> But I see no sign of mod_python being loaded successfully in logs/error.log.

That appears to be because a change suggested by someone:

  http://issues.apache.org/jira/browse/MODPYTHON-195

was actually not completely correct.

It causes no harm in the scheme of things but means the initialisation
message for mod_python/Python isn't shown in the error logs. I have
reopened that issue so it can be fixed in a future version.

> [Sun May 06 23:55:56 2007] [error] python_init: Python version mismatch,
> expected '2.5', found '2.5.1'.
>
> [Sun May 06 23:55:56 2007] [error] python_init: Python executable found
> 'E:\\Program Files\\Apache Software
> Foundation\\Apache2.2\\bin\\httpd.exe'.
>
> [Sun May 06 23:55:56 2007] [error] python_init: Python path being used
> 'C:\\WINDOWS\\system32\\python25.zip;E:\\Python25\\Lib;E:\\Python25\\DLLs;E:\\Python25\\Lib\\lib-tk;;E:\\Program
> Files\\Apache Software Foundation\\Apache2.2\\bin'.

This shouldn't cause an issue, but your mod_python was compiled
against a different version of Python than you are using.

> At one point I read a suggestion to create a .htaccess file in my test
> directory (:/Projects/Web/Home/htdocs/test) but on Windows
> you can't name a file ".htaccess" so I guess that the right thing to do was
> to call it "htaccess" with no extension.

In your Apache configuration files, what is the directive
'AccessFileName' set to. This is what dictates what the htaccess file
will be named. As far as I know you can still call files .htaccess on
Windows, but often more convenient to call it something else. If you
are changing it, you may also have to change:

<FilesMatch "^\.ht">
    Order allow,deny
    Deny from all
</FilesMatch>

to something more appropriate so the files aren't accessible.

> E:/Projects/Web/Home/htdocs/test/htaccess contains:
>
>
> AddHandler mod_python .py
>
> PythonHandler mptest
>
> PythonDebug On

The best way of determing if a htaccess file is being read is to put a
syntax error in it. That way it should yield a 500 error. Ie., put a
line in it containing:

  XXXERROR

Graham
From m.r.sanders at gmail.com  Thu May 10 06:26:44 2007
From: m.r.sanders at gmail.com (Michael Sanders)
Date: Thu May 10 06:26:50 2007
Subject: [mod_python] Multiple loading of same module with winnt MPM
In-Reply-To: <88e286470705091500l43c18808qe095ca20b8f238c3@mail.gmail.com>
References: <4641C2B6.7060302@gmail.com>
	<88e286470705091500l43c18808qe095ca20b8f238c3@mail.gmail.com>
Message-ID: <4642F364.6030208@gmail.com>

Graham,

Here is the test PSP file. In my test, this is loaded twice 
(simultaneously) with a newly re-started Apache by an HTML file 
containing two Javascript 'XMLHttpRequest()' calls. (I can post the HTML 
if required).

Note: replacing the '~' in the path passed to apache.import_module with 
the full path gives no change in behaviour.

---- test.psp -------------------------
<%
#import os
#import sys
#ourpath = os.path.dirname(psp.req.canonical_filename)
#sys.path.append(ourpath)
#import mymod

mymod = apache.import_module("~/mymod.py")
mymod.logger.warning('test')

%>
test
---------------------------------------


The imported module. Note: a random number is generated when the module 
is imported and this number is appended to all logged messages, so as to 
identify the logged messages with instance of the imported module (e.g. 
see 'mylog.log' below).

---- mymod.py -------------------------
import sys
import logging
import random
rnd = random.random()
log_file = "c:/temp/mylog.log"
logger = logging.getLogger()

log_handler = logging.FileHandler(log_file,"a")
log_handler.setFormatter(logging.Formatter(fmt='%(asctime)s %(message)s 
'+str(rnd)))
logger.addHandler(log_handler)
logger.warning("added a new log handler")
---------------------------------------


The Apache .htaccess file. The only mod_python related directive in 
httpd.conf is the 'LoadModule' line. There is no PythonPath set in 
httpd.conf and no system PYTHONPATH environment variable set.

---- .htaccess file -------------------
AddHandler mod_python .psp
PythonHandler mod_python.psp
PythonDebug on

<FilesMatch "\.py">
     Order allow,deny
     Deny from all
</FilesMatch>
<FilesMatch "$\.ht">
     Order allow,deny
     Deny from all
</FilesMatch>
---------------------------------------


The Apache access log:

---- access.log -----------------------
10.5.9.120 - - [10/May/2007:10:43:12 +0100] "GET /webapp/test.html 
HTTP/1.1" 304 -
10.5.9.120 - - [10/May/2007:10:43:12 +0100] "GET 
/webapp/test.psp?sid=0.3172181574260018 HTTP/1.1" 200 8
10.5.9.120 - - [10/May/2007:10:43:12 +0100] "GET 
/webapp/test.psp?sid=0.05203795490300955 HTTP/1.1" 200 8
---------------------------------------


The Apache error log:

---- error.log ------------------------
[Thu May 10 10:43:12 2007] [notice] mod_python (pid=5632, 
interpreter='DELL14.mydomain.local'): Importing module 'C:\\Program 
Files\\Apache Software Foundation\\Apache2.2\\htdocs\\webapp\\mymod.py'
[Thu May 10 10:43:12 2007] [notice] mod_python (pid=5632, 
interpreter='DELL14.mydomain.local'): Reimporting module 'C:\\Program 
Files\\Apache Software Foundation\\Apache2.2\\htdocs\\webapp\\mymod.py'
---------------------------------------


The log created by test.psp. This shows two logging handlers being 
created - one when the module is first imported, and the second when the 
module is re-imported. The 'added a new log handler' and test' messages 
generated by the second call to 'test.psp' are therefore logged twice, 
once by each handler.

---- mylog.log ------------------------
2007-05-10 10:43:12,404 added a new log handler 0.884955893555
2007-05-10 10:43:12,404 test 0.884955893555
2007-05-10 10:43:12,420 added a new log handler 0.884955893555
2007-05-10 10:43:12,420 added a new log handler 0.644262952239
2007-05-10 10:43:12,420 test 0.884955893555
2007-05-10 10:43:12,420 test 0.644262952239
---------------------------------------


Changing 'test.psp' to use the standard Python module importer (by 
uncommenting the appropriate lines and commenting out the line 
containing 'apache.import_module'), the following logs are generated:

---- mylog.log ------------------------
2007-05-10 10:55:10,733 added a new log handler 0.851457438205
2007-05-10 10:55:10,733 test 0.851457438205
2007-05-10 10:55:10,733 test 0.851457438205
---------------------------------------

---- access.log -----------------------
10.5.9.120 - - [10/May/2007:10:55:10 +0100] "GET /webapp/test.html 
HTTP/1.1" 304 -
10.5.9.120 - - [10/May/2007:10:55:10 +0100] "GET 
/webapp/test.psp?sid=0.5035066189141854 HTTP/1.1" 200 8
10.5.9.120 - - [10/May/2007:10:55:10 +0100] "GET 
/webapp/test.psp?sid=0.239310630890464 HTTP/1.1" 200 8
---------------------------------------


I forgot to mention in my first mail, that I'm using Python 2.5.

Thanks again for your help.
Michael

Graham Dumpleton wrote:
> Post the snippet of PSP code you are doing the import from.
> 
> Post the Apache configuration snippet you are using so it can be seen
> whether you are setting PythonPath to include a directory which
> overlaps the document area and whether you are using Apache style
> forward slashes in paths or Windows backwards slashes.
> 
> Post the snippets of the log files which show when the module is being
> loaded so can see the paths it is being loaded under. Especially post
> any warnings output about a path appearing in sys.path as well as
> mod_python module importer path.
> 
> The only issue I know of with PSP and the new module importer is that
> if you use 'import' rather than 'apache.import_module()', the 'import'
> will always use standard Python module importer and not
> 'apache.import_module()'. Thus if you were trying to import a module
> from the same directory it by default will not work. If you fiddled
> PythonPath to include that directory, thus creating an overlap in the
> two systems, it will import but thus may be imported separately by
> both mechanisms.
> 
> To address this latter problem, PSP needs to be changed to fake up
> some information in the page pseudo module so that it thinks it was
> imported used mod_python importer in the first place and will thus map
> 'import' through to 'apache.import_module()' properly.
> 
> Graham
> 
> On 09/05/07, Michael Sanders <m.r.sanders@gmail.com> wrote:
>> Environment:
>> - mod_python 3.3.1
>> - Apache 2.2.3 running on Windows XP
>> - PSP request handler
>>
>> [Issue 4] described at the following link still appears to be present in
>> mod_python 3.3.1:
>> http://www.dscpl.com.au/wiki/ModPython/Articles/ModuleImportingIsBroken#line-50 
>>
>>
>> I have a PSP file that imports a module using 'apache.import_module'. If
>> I re-start Apache and then fire two simultaneous requests at the PSP
>> file, mod_python loads the module twice. (The module in question when
>> imported  sets up a logging handler. The initial entry written by this
>> module to the log file is duplicated and subsequent calls to this
>> handler also give duplicate entries in the log file).
>>
>> If I import the module using the standard Python 'import', this problem
>> does not occur. Likewise, if I use the 'vampire.importModule' method,
>> the problem does not occur. The issue only happens when using
>> 'apache.import_module'.
>>
>> Has anyone else experienced this? Is there a fix?
>>
>> Many thanks,
>> Michael Sanders
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>
> 

From graham.dumpleton at gmail.com  Thu May 10 07:01:25 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu May 10 07:01:29 2007
Subject: [mod_python] Multiple loading of same module with winnt MPM
In-Reply-To: <4642F364.6030208@gmail.com>
References: <4641C2B6.7060302@gmail.com>
	<88e286470705091500l43c18808qe095ca20b8f238c3@mail.gmail.com>
	<4642F364.6030208@gmail.com>
Message-ID: <88e286470705100401l6c408fbfnae8fdb2e6a1ff3d6@mail.gmail.com>

I can't explain why a 'reimport' is occurring almost immediately off
the top of my head, but you should be aware that the sort of code you
are putting in the module shouldn't be put in a module which is a
candidate for reloading.

In short, you shouldn't put code into a module which is a candidate
for reloading which is additive to global data. The easiest example of
this is:

  sys.path.append("/some/directory")

Every time the module containing this is touched and therefore
reloaded, that path would be added to sys.path again. If that module
were changed 10 times you would have that path appearing in sys.path
that many times as well.

Thus, you should put such code in normal Python modules which can't be
reloaded and which are preferably outside of your document tree,
unless your code specifically checks that it shouldn't do something
because it has already been done. For example:

  if not "/some/directory" in sys.path:
    sys.path.append("/some/directory")

This is why you get multiple logger instances being created.

As to why the reimport happens I am not sure. Might be something
strange to do with granularity of  system time and modification times
of files on Windows.

I'll have a think about it.

Graham

On 10/05/07, Michael Sanders <m.r.sanders@gmail.com> wrote:
> Graham,
>
> Here is the test PSP file. In my test, this is loaded twice
> (simultaneously) with a newly re-started Apache by an HTML file
> containing two Javascript 'XMLHttpRequest()' calls. (I can post the HTML
> if required).
>
> Note: replacing the '~' in the path passed to apache.import_module with
> the full path gives no change in behaviour.
>
> ---- test.psp -------------------------
> <%
> #import os
> #import sys
> #ourpath = os.path.dirname(psp.req.canonical_filename)
> #sys.path.append(ourpath)
> #import mymod
>
> mymod = apache.import_module("~/mymod.py")
> mymod.logger.warning('test')
>
> %>
> test
> ---------------------------------------
>
>
> The imported module. Note: a random number is generated when the module
> is imported and this number is appended to all logged messages, so as to
> identify the logged messages with instance of the imported module (e.g.
> see 'mylog.log' below).
>
> ---- mymod.py -------------------------
> import sys
> import logging
> import random
> rnd = random.random()
> log_file = "c:/temp/mylog.log"
> logger = logging.getLogger()
>
> log_handler = logging.FileHandler(log_file,"a")
> log_handler.setFormatter(logging.Formatter(fmt='%(asctime)s %(message)s
> '+str(rnd)))
> logger.addHandler(log_handler)
> logger.warning("added a new log handler")
> ---------------------------------------
>
>
> The Apache .htaccess file. The only mod_python related directive in
> httpd.conf is the 'LoadModule' line. There is no PythonPath set in
> httpd.conf and no system PYTHONPATH environment variable set.
>
> ---- .htaccess file -------------------
> AddHandler mod_python .psp
> PythonHandler mod_python.psp
> PythonDebug on
>
> <FilesMatch "\.py">
>      Order allow,deny
>      Deny from all
> </FilesMatch>
> <FilesMatch "$\.ht">
>      Order allow,deny
>      Deny from all
> </FilesMatch>
> ---------------------------------------
>
>
> The Apache access log:
>
> ---- access.log -----------------------
> 10.5.9.120 - - [10/May/2007:10:43:12 +0100] "GET /webapp/test.html
> HTTP/1.1" 304 -
> 10.5.9.120 - - [10/May/2007:10:43:12 +0100] "GET
> /webapp/test.psp?sid=0.3172181574260018 HTTP/1.1" 200 8
> 10.5.9.120 - - [10/May/2007:10:43:12 +0100] "GET
> /webapp/test.psp?sid=0.05203795490300955 HTTP/1.1" 200 8
> ---------------------------------------
>
>
> The Apache error log:
>
> ---- error.log ------------------------
> [Thu May 10 10:43:12 2007] [notice] mod_python (pid=5632,
> interpreter='DELL14.mydomain.local'): Importing module 'C:\\Program
> Files\\Apache Software Foundation\\Apache2.2\\htdocs\\webapp\\mymod.py'
> [Thu May 10 10:43:12 2007] [notice] mod_python (pid=5632,
> interpreter='DELL14.mydomain.local'): Reimporting module 'C:\\Program
> Files\\Apache Software Foundation\\Apache2.2\\htdocs\\webapp\\mymod.py'
> ---------------------------------------
>
>
> The log created by test.psp. This shows two logging handlers being
> created - one when the module is first imported, and the second when the
> module is re-imported. The 'added a new log handler' and test' messages
> generated by the second call to 'test.psp' are therefore logged twice,
> once by each handler.
>
> ---- mylog.log ------------------------
> 2007-05-10 10:43:12,404 added a new log handler 0.884955893555
> 2007-05-10 10:43:12,404 test 0.884955893555
> 2007-05-10 10:43:12,420 added a new log handler 0.884955893555
> 2007-05-10 10:43:12,420 added a new log handler 0.644262952239
> 2007-05-10 10:43:12,420 test 0.884955893555
> 2007-05-10 10:43:12,420 test 0.644262952239
> ---------------------------------------
>
>
> Changing 'test.psp' to use the standard Python module importer (by
> uncommenting the appropriate lines and commenting out the line
> containing 'apache.import_module'), the following logs are generated:
>
> ---- mylog.log ------------------------
> 2007-05-10 10:55:10,733 added a new log handler 0.851457438205
> 2007-05-10 10:55:10,733 test 0.851457438205
> 2007-05-10 10:55:10,733 test 0.851457438205
> ---------------------------------------
>
> ---- access.log -----------------------
> 10.5.9.120 - - [10/May/2007:10:55:10 +0100] "GET /webapp/test.html
> HTTP/1.1" 304 -
> 10.5.9.120 - - [10/May/2007:10:55:10 +0100] "GET
> /webapp/test.psp?sid=0.5035066189141854 HTTP/1.1" 200 8
> 10.5.9.120 - - [10/May/2007:10:55:10 +0100] "GET
> /webapp/test.psp?sid=0.239310630890464 HTTP/1.1" 200 8
> ---------------------------------------
>
>
> I forgot to mention in my first mail, that I'm using Python 2.5.
>
> Thanks again for your help.
> Michael
>
> Graham Dumpleton wrote:
> > Post the snippet of PSP code you are doing the import from.
> >
> > Post the Apache configuration snippet you are using so it can be seen
> > whether you are setting PythonPath to include a directory which
> > overlaps the document area and whether you are using Apache style
> > forward slashes in paths or Windows backwards slashes.
> >
> > Post the snippets of the log files which show when the module is being
> > loaded so can see the paths it is being loaded under. Especially post
> > any warnings output about a path appearing in sys.path as well as
> > mod_python module importer path.
> >
> > The only issue I know of with PSP and the new module importer is that
> > if you use 'import' rather than 'apache.import_module()', the 'import'
> > will always use standard Python module importer and not
> > 'apache.import_module()'. Thus if you were trying to import a module
> > from the same directory it by default will not work. If you fiddled
> > PythonPath to include that directory, thus creating an overlap in the
> > two systems, it will import but thus may be imported separately by
> > both mechanisms.
> >
> > To address this latter problem, PSP needs to be changed to fake up
> > some information in the page pseudo module so that it thinks it was
> > imported used mod_python importer in the first place and will thus map
> > 'import' through to 'apache.import_module()' properly.
> >
> > Graham
> >
> > On 09/05/07, Michael Sanders <m.r.sanders@gmail.com> wrote:
> >> Environment:
> >> - mod_python 3.3.1
> >> - Apache 2.2.3 running on Windows XP
> >> - PSP request handler
> >>
> >> [Issue 4] described at the following link still appears to be present in
> >> mod_python 3.3.1:
> >> http://www.dscpl.com.au/wiki/ModPython/Articles/ModuleImportingIsBroken#line-50
> >>
> >>
> >> I have a PSP file that imports a module using 'apache.import_module'. If
> >> I re-start Apache and then fire two simultaneous requests at the PSP
> >> file, mod_python loads the module twice. (The module in question when
> >> imported  sets up a logging handler. The initial entry written by this
> >> module to the log file is duplicated and subsequent calls to this
> >> handler also give duplicate entries in the log file).
> >>
> >> If I import the module using the standard Python 'import', this problem
> >> does not occur. Likewise, if I use the 'vampire.importModule' method,
> >> the problem does not occur. The issue only happens when using
> >> 'apache.import_module'.
> >>
> >> Has anyone else experienced this? Is there a fix?
> >>
> >> Many thanks,
> >> Michael Sanders
> >> _______________________________________________
> >> Mod_python mailing list
> >> Mod_python@modpython.org
> >> http://mailman.modpython.org/mailman/listinfo/mod_python
> >>
> >
>
>
From graham.dumpleton at gmail.com  Thu May 10 07:48:08 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu May 10 07:48:13 2007
Subject: [mod_python] Multiple loading of same module with winnt MPM
In-Reply-To: <88e286470705100401l6c408fbfnae8fdb2e6a1ff3d6@mail.gmail.com>
References: <4641C2B6.7060302@gmail.com>
	<88e286470705091500l43c18808qe095ca20b8f238c3@mail.gmail.com>
	<4642F364.6030208@gmail.com>
	<88e286470705100401l6c408fbfnae8fdb2e6a1ff3d6@mail.gmail.com>
Message-ID: <88e286470705100448j4b3762a5xb35b2c3318de8f26@mail.gmail.com>

On 10/05/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> As to why the reimport happens I am not sure. Might be something
> strange to do with granularity of  system time and modification times
> of files on Windows.
>
> I'll have a think about it.

Can you make the following modification to:

  lib/python/mod_python/importer.py

and reinstall mod_python. If using binary version of mod_python make
the change to your installed mod_python files.

The change is in __init__() function of _CacheInfo class. Change
initialiser for 'reload' attribute from:

        self.reload = 0

to:

        self.reload = 1

I think that might be stuffing up the logic for case where module has
never been loaded before.

Let me know if that changes anything.

Thanks.

Graham
From m.r.sanders at gmail.com  Thu May 10 08:35:34 2007
From: m.r.sanders at gmail.com (Michael Sanders)
Date: Thu May 10 08:35:49 2007
Subject: [mod_python] Multiple loading of same module with winnt MPM
In-Reply-To: <88e286470705100448j4b3762a5xb35b2c3318de8f26@mail.gmail.com>
References: <4641C2B6.7060302@gmail.com>	
	<88e286470705091500l43c18808qe095ca20b8f238c3@mail.gmail.com>	
	<4642F364.6030208@gmail.com>	
	<88e286470705100401l6c408fbfnae8fdb2e6a1ff3d6@mail.gmail.com>
	<88e286470705100448j4b3762a5xb35b2c3318de8f26@mail.gmail.com>
Message-ID: <46431196.6060707@gmail.com>

Graham Dumpleton wrote:
> Can you make the following modification to:
> 
>  lib/python/mod_python/importer.py
> 
> and reinstall mod_python. If using binary version of mod_python make
> the change to your installed mod_python files.
> 
> The change is in __init__() function of _CacheInfo class. Change
> initialiser for 'reload' attribute from:
> 
>        self.reload = 0
> 
> to:
> 
>        self.reload = 1
> 
> I think that might be stuffing up the logic for case where module has
> never been loaded before.
> 
> Let me know if that changes anything.

No, I'm getting the same behaviour as before.

Thanks,
Michael


From m.r.sanders at gmail.com  Thu May 10 09:27:58 2007
From: m.r.sanders at gmail.com (Michael Sanders)
Date: Thu May 10 09:28:00 2007
Subject: [mod_python] Multiple loading of same module with winnt MPM
In-Reply-To: <46431D1F.3040603@gmail.com>
References: <4641C2B6.7060302@gmail.com>	
	<88e286470705091500l43c18808qe095ca20b8f238c3@mail.gmail.com>	
	<4642F364.6030208@gmail.com>	
	<88e286470705100401l6c408fbfnae8fdb2e6a1ff3d6@mail.gmail.com>
	<88e286470705100448j4b3762a5xb35b2c3318de8f26@mail.gmail.com>
	<46431196.6060707@gmail.com> <46431D1F.3040603@gmail.com>
Message-ID: <46431DDE.9040602@gmail.com>

Michael Sanders wrote:
> Further to this, one of my colleagues has made some other changes to 
> 'importer.py' that appear to fix the problem (please find a diff attached).
> 
> The modification is a change to the locking in the import_module() 
> method of the _ModuleCache class:
> 
> The 'self._lock1' lock is now used to lock out the actual 'loading' code 
> as well as the check-for-cache code: _reload_required().
> 
> See line 554 ish (Code up to line 769 indented)

Apologies, I sent the whole file and not a diff. I've (hopefully) 
attached the diff this time!

Thanks,
Michael
-------------- next part --------------
--- importer.py	2007-05-10 13:57:01.157138700 +0100
+++ importer.py.new	2007-05-10 14:18:22.976417100 +0100
@@ -551,218 +551,222 @@
             # Import module or obtain it from cache as is
             # appropriate.
 
-            if load:
-
-                # Setup a new empty module to load the code for
-                # the module into. Increment the instance count
-                # and set the reload flag to force a reload if
-                # the import fails.
-
-                cache.instance = cache.instance + 1
-                cache.reload = 1
-
-                module = imp.new_module(label)
-
-                # If the module was previously loaded we need to
-                # manage the transition to the new instance of
-                # the module that is being loaded to replace it.
-                # This entails calling the special clone method,
-                # if provided within the existing module. Using
-                # this method the existing module can then
-                # selectively indicate what should be transfered
-                # over to the next instance of the module,
-                # including thread locks. If this process fails
-                # the special purge method is called, if
-                # provided, to indicate that the existing module
-                # is being forcibly purged out of the system. In
-                # that case any existing state will not be
-                # transferred.
-
-                if cache.module != None:
-                    if hasattr(cache.module, "__mp_clone__"):
-                        try:
-                            # Migrate any existing state data from
-                            # existing module instance to new module
-                            # instance.
-
-                            if log:
-                                msg = "Cloning module '%s'" % file
+            try:
+                self._lock1.acquire()
+                if load:
+    
+                    # Setup a new empty module to load the code for
+                    # the module into. Increment the instance count
+                    # and set the reload flag to force a reload if
+                    # the import fails.
+    
+                    cache.instance = cache.instance + 1
+                    cache.reload = 1
+    
+                    module = imp.new_module(label)
+    
+                    # If the module was previously loaded we need to
+                    # manage the transition to the new instance of
+                    # the module that is being loaded to replace it.
+                    # This entails calling the special clone method,
+                    # if provided within the existing module. Using
+                    # this method the existing module can then
+                    # selectively indicate what should be transfered
+                    # over to the next instance of the module,
+                    # including thread locks. If this process fails
+                    # the special purge method is called, if
+                    # provided, to indicate that the existing module
+                    # is being forcibly purged out of the system. In
+                    # that case any existing state will not be
+                    # transferred.
+    
+                    if cache.module != None:
+                        if hasattr(cache.module, "__mp_clone__"):
+                            try:
+                                # Migrate any existing state data from
+                                # existing module instance to new module
+                                # instance.
+    
+                                if log:
+                                    msg = "Cloning module '%s'" % file
+                                    self._log_notice(msg)
+    
+                                cache.module.__mp_clone__(module)
+    
+                            except:
+                                # Forcibly purging module from system.
+    
+                                self._log_exception()
+    
+                                if log:
+                                    msg = "Purging module '%s'" % file
+                                    self._log_notice(msg)
+    
+                                if hasattr(cache.module, "__mp_purge__"):
+                                    try:
+                                        cache.module.__mp_purge__()
+                                    except:
+                                        self._log_exception()
+    
+                                cache.module = None
+    
+                                # Setup a fresh new module yet again.
+    
+                                module = imp.new_module(label)
+    
+                        if log:
+                            if cache.module == None:
+                                msg = "Importing module '%s'" % file
                                 self._log_notice(msg)
-
-                            cache.module.__mp_clone__(module)
-
-                        except:
-                            # Forcibly purging module from system.
-
-                            self._log_exception()
-
-                            if log:
-                                msg = "Purging module '%s'" % file
+                            else:
+                                msg = "Reimporting module '%s'" % file
                                 self._log_notice(msg)
-
-                            if hasattr(cache.module, "__mp_purge__"):
-                                try:
-                                    cache.module.__mp_purge__()
-                                except:
-                                    self._log_exception()
-
-                            cache.module = None
-
-                            # Setup a fresh new module yet again.
-
-                            module = imp.new_module(label)
-
-                    if log:
-                        if cache.module == None:
+                    else:
+                        if log:
                             msg = "Importing module '%s'" % file
                             self._log_notice(msg)
-                        else:
-                            msg = "Reimporting module '%s'" % file
-                            self._log_notice(msg)
-                else:
-                    if log:
-                        msg = "Importing module '%s'" % file
-                        self._log_notice(msg)
-
-                # Must add to the module the path to the modules
-                # file. This ensures that module looks like a
-                # normal module and this path will also be used
-                # in certain contexts when the import statement
-                # is used within the module.
-
-                module.__file__ = file
-
-                # Setup a new instance object to store in the
-                # module. This will refer back to the actual
-                # cache entry and is used to record information
-                # which is specific to this incarnation of the
-                # module when reloading is occuring.
-
-                instance = _InstanceInfo(label, file, cache)
-
-                module.__mp_info__ = instance
-
-                # Cache any additional module search path which
-                # should be used for this instance of the module
-                # or package. The path shouldn't be able to be
-                # changed during the lifetime of the module to
-                # ensure that module imports are always done
-                # against the same path.
-
-                if path is None:
-                    path = []
-
-                module.__mp_path__ = list(path)
-
-                # Place a reference to the module within the
-                # request specific cache of imported modules.
-                # This makes module lookup more efficient when
-                # the same module is imported more than once
-                # within the context of a request. In the case
-                # of a cyclical import, avoids a never ending
-                # recursive loop.
-
-                if modules is not None:
-                    modules[label] = module
-
-                # If this is a child import of some parent
-                # module, add this module as a child of the
-                # parent.
-
-                atime = time.time()
+    
+                    # Must add to the module the path to the modules
+                    # file. This ensures that module looks like a
+                    # normal module and this path will also be used
+                    # in certain contexts when the import statement
+                    # is used within the module.
+    
+                    module.__file__ = file
+    
+                    # Setup a new instance object to store in the
+                    # module. This will refer back to the actual
+                    # cache entry and is used to record information
+                    # which is specific to this incarnation of the
+                    # module when reloading is occuring.
+    
+                    instance = _InstanceInfo(label, file, cache)
+    
+                    module.__mp_info__ = instance
+    
+                    # Cache any additional module search path which
+                    # should be used for this instance of the module
+                    # or package. The path shouldn't be able to be
+                    # changed during the lifetime of the module to
+                    # ensure that module imports are always done
+                    # against the same path.
+    
+                    if path is None:
+                        path = []
+    
+                    module.__mp_path__ = list(path)
+    
+                    # Place a reference to the module within the
+                    # request specific cache of imported modules.
+                    # This makes module lookup more efficient when
+                    # the same module is imported more than once
+                    # within the context of a request. In the case
+                    # of a cyclical import, avoids a never ending
+                    # recursive loop.
+    
+                    if modules is not None:
+                        modules[label] = module
+    
+                    # If this is a child import of some parent
+                    # module, add this module as a child of the
+                    # parent.
+    
+                    atime = time.time()
+    
+                    if parent_info:
+                        parent_info.children[label] = atime
+    
+                    # Perform actual import of the module.
+    
+                    try:
+                        execfile(file, module.__dict__)
+    
+                    except:
+    
+                        # Importation of the module has failed for
+                        # some reason. If this is the very first
+                        # import of the module, need to discard the
+                        # cache entry entirely else a subsequent
+                        # attempt to load the module will wrongly
+                        # think it was successfully loaded already.
+    
+                        if cache.module is None:
+                            del self._cache[label]
+    
+                        raise
+    
+                    # Update the cache and clear the reload flag.
+    
+                    cache.module = module
+                    cache.reload = 0
+    
+                    # Need to also update the list of child modules
+                    # stored in the cache entry with the actual
+                    # children found during the import. A copy is
+                    # made, meaning that any future imports
+                    # performed within the context of the request
+                    # handler don't result in the module later being
+                    # reloaded if they change.
+    
+                    cache.children = dict(module.__mp_info__.children)
+    
+                    # Create link to embedded path at end of import.
+    
+                    cache.path = module.__mp_path__
+    
+                    # Increment the generation count of the global
+                    # state of all modules. This is used in the
+                    # dependency management scheme for reloading to
+                    # determine if a module dependency has been
+                    # reloaded since it was loaded.
+    
+                    self._lock2.acquire()
+                    self._generation = self._generation + 1
+                    cache.generation = self._generation
+                    self._lock2.release()
+    
+                    # Update access time and reset access counts.
+    
+                    cache.ctime = atime
+                    cache.atime = atime
+                    cache.direct = 1
+                    cache.indirect = 0
 
-                if parent_info:
-                    parent_info.children[label] = atime
-
-                # Perform actual import of the module.
-
-                try:
-                    execfile(file, module.__dict__)
-
-                except:
-
-                    # Importation of the module has failed for
-                    # some reason. If this is the very first
-                    # import of the module, need to discard the
-                    # cache entry entirely else a subsequent
-                    # attempt to load the module will wrongly
-                    # think it was successfully loaded already.
-
-                    if cache.module is None:
-                        del self._cache[label]
-
-                    raise
-
-                # Update the cache and clear the reload flag.
-
-                cache.module = module
-                cache.reload = 0
-
-                # Need to also update the list of child modules
-                # stored in the cache entry with the actual
-                # children found during the import. A copy is
-                # made, meaning that any future imports
-                # performed within the context of the request
-                # handler don't result in the module later being
-                # reloaded if they change.
-
-                cache.children = dict(module.__mp_info__.children)
-
-                # Create link to embedded path at end of import.
-
-                cache.path = module.__mp_path__
-
-                # Increment the generation count of the global
-                # state of all modules. This is used in the
-                # dependency management scheme for reloading to
-                # determine if a module dependency has been
-                # reloaded since it was loaded.
-
-                self._lock2.acquire()
-                self._generation = self._generation + 1
-                cache.generation = self._generation
-                self._lock2.release()
-
-                # Update access time and reset access counts.
-
-                cache.ctime = atime
-                cache.atime = atime
-                cache.direct = 1
-                cache.indirect = 0
-
-            else:
-
-                # Update the cache.
-
-                module = cache.module
-
-                # Place a reference to the module within the
-                # request specific cache of imported modules.
-                # This makes module lookup more efficient when
-                # the same module is imported more than once
-                # within the context of a request. In the case
-                # of a cyclical import, avoids a never ending
-                # recursive loop.
-
-                if modules is not None:
-                    modules[label] = module
-
-                # If this is a child import of some parent
-                # module, add this module as a child of the
-                # parent.
-
-                atime = time.time()
-
-                if parent_info:
-                    parent_info.children[label] = atime
-
-                # Didn't need to reload the module so simply
-                # increment access counts and last access time.
-
-                cache.atime = atime
-                cache.direct = cache.direct + 1
-
-            return module
+                else:
+    
+                    # Update the cache.
+    
+                    module = cache.module
+    
+                    # Place a reference to the module within the
+                    # request specific cache of imported modules.
+                    # This makes module lookup more efficient when
+                    # the same module is imported more than once
+                    # within the context of a request. In the case
+                    # of a cyclical import, avoids a never ending
+                    # recursive loop.
+    
+                    if modules is not None:
+                        modules[label] = module
+    
+                    # If this is a child import of some parent
+                    # module, add this module as a child of the
+                    # parent.
+    
+                    atime = time.time()
+    
+                    if parent_info:
+                        parent_info.children[label] = atime
+    
+                    # Didn't need to reload the module so simply
+                    # increment access counts and last access time.
+    
+                    cache.atime = atime
+                    cache.direct = cache.direct + 1
+    
+                return module
+            finally:
+                self._lock1.release() # always unlock
 
         finally:
             # Lock on cache object can now be released.
From ryan at ryankaskel.com  Thu May 10 14:39:31 2007
From: ryan at ryankaskel.com (Ryan Kaskel)
Date: Thu May 10 14:40:02 2007
Subject: [mod_python] Cookies not persisting 
Message-ID: <464366E3.8030800@ryankaskel.com>

I am trying to fiddle around with AJAX but before I can get to that part 
I need to make a little test login system will automatically log the 
user in if a cookie is found. The problem is when I close the browser 
the cookie is deleted. Everything else should work (when I click the 
logout button I am still staying logged in because it found the cookie). 
Does it have something to do with my browser or an attribute I am not 
setting when I create the cookie.

Thanks,
Ryan

below is the code:

import time
from mod_python import util
from mod_python import Session, Cookie

username = "test"
password = "pass"

main_page2 = """
<html>
 <head>
  <title>Main</title>
 </head>
 <body>
  Welcome!
  <p> <a href=\"./logout\">Logout</a> </p>
 </body>
</html>
"""

login_page = """
<html>
 <head>
  <title>Login</title>
 </head>
 <body>
  <h1>Please login</h1>
  <form action=\"./login\" method=\"POST\">
   Username <input type=\"text\" name=\"user\"/> <br/>
   Password <input type=\"text\" name=\"pass\"/> <br/>
   Remember me? <input type=\"checkbox\" name=\"remember\"/> <br/>
   <button type=\"submit\">Login</button>
  </form>
 </body>
</html>
"""
def main(req):
    req.content_type = 'text/html'
    main_page = main_page2
    session = Session.Session(req)
    cookies = Cookie.get_cookies(req, Cookie.MarshalCookie, 
secret="example")
    if cookies.has_key('example1'):
        cookie = cookies['example1']
        if type(cookie) is Cookie.MarshalCookie:
            data = cookie.value
            main_page = data['user'] + " " + data['passw'] + main_page
            session['valid'] = 'true'
            session.save()
    else:
        if session.is_new():
            util.redirect(req,'./login')
        if session['valid'] != 'true':
            util.redirect(req,'./login')
    req.write(main_page)

def login(req):
    req.content_type = "text/html"
    if req.method == 'POST':
        if req.form['user'] == username and req.form['pass'] == password:
            session = Session.Session(req)
            session['valid'] = 'true'
            session.save()
            if req.form.has_key('remember') and req.form['remember']:
                value = {'user': req.form['user'], 'passw': 
req.form['pass']}
                Cookie.add_cookie(req, Cookie.MarshalCookie('example1', 
value,'example'), expires=time.time() + 3000000)
            util.redirect(req,'./main')
        else:
            req.write("bad credentials")
    else:
        req.write(str(Cookie.get_cookies(req, Cookie.MarshalCookie, 
secret='example')))
        req.write(login_page)

def logout(req):
    req.content_type = "text/html"
    session = Session.Session(req)
    if session.has_key('valid'):
        session.delete()
    util.redirect(req,'./main')

From rpgrob at hispeed.ch  Thu May 10 15:31:46 2007
From: rpgrob at hispeed.ch (=?ISO-8859-15?Q?Ren=E9_Grob?=)
Date: Thu May 10 15:31:50 2007
Subject: [mod_python] Python Debugger doesn't start in Mod_Python 
Message-ID: <46437322.5050600@hispeed.ch>

Since my small intranet application keeps getting more complex I tried 
to fix some bugs using the Python Debugger. According to the Mod_python 
manual I added the "PythonEnablePdb On" directive into the directory 
context of my Python application and started httpd from the command line 
with the option -DONE_PROCESS (after stopping httpd first, of course). 
But Apache didn't start and an error window occurred instead showing the 
following message:

"Runtime Error! Program: <Apache path>\httpd.exe. This application has 
requested the Runtime to terminate it in an unusual way. Please contact 
the applications's support team for more information".

I'm using the following prebuilt binaries on Win2k SP4:

mod_python-3.3.1.win32-py2.5-Apache2.2.exe
python-2.5.msi
apache_2.2.4-win32-x86-no_ssl.msi

When Apache is started with the option -DONE_PROCESS but without 
Mod_python there is no error and no Mod_python either (of course). On a 
different machine with WinXP SP2, Apache 2.2.3, Python 2.4.3 and 
Mod_python 2.7.10 the debugger works as expected.

Does anyone have an idea how to fix this?

Thanks

Ren?

From graham.dumpleton at gmail.com  Thu May 10 17:18:41 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu May 10 17:18:47 2007
Subject: [mod_python] Multiple loading of same module with winnt MPM
In-Reply-To: <46431196.6060707@gmail.com>
References: <4641C2B6.7060302@gmail.com>
	<88e286470705091500l43c18808qe095ca20b8f238c3@mail.gmail.com>
	<4642F364.6030208@gmail.com>
	<88e286470705100401l6c408fbfnae8fdb2e6a1ff3d6@mail.gmail.com>
	<88e286470705100448j4b3762a5xb35b2c3318de8f26@mail.gmail.com>
	<46431196.6060707@gmail.com>
Message-ID: <88e286470705101418p3caa25e9we6a3b49ecccb1e36@mail.gmail.com>

I realised as soon as I had shutdown the computer that it wasn't going
to work as had got logic of one of the other checks wrong way around
in my head. I figured I had to make another 3 line change to at least
solve your initial presenting problem. I suspected this may not cover
case of changes after initial import though. Now you have sent such a
big set of changes, I'll have to sit down and look through it properly
which depending on how busy am today may take a little while.

Graham

On 10/05/07, Michael Sanders <m.r.sanders@gmail.com> wrote:
> Graham Dumpleton wrote:
> > Can you make the following modification to:
> >
> >  lib/python/mod_python/importer.py
> >
> > and reinstall mod_python. If using binary version of mod_python make
> > the change to your installed mod_python files.
> >
> > The change is in __init__() function of _CacheInfo class. Change
> > initialiser for 'reload' attribute from:
> >
> >        self.reload = 0
> >
> > to:
> >
> >        self.reload = 1
> >
> > I think that might be stuffing up the logic for case where module has
> > never been loaded before.
> >
> > Let me know if that changes anything.
>
> No, I'm getting the same behaviour as before.
>
> Thanks,
> Michael
>
>
>
From graham.dumpleton at gmail.com  Thu May 10 17:29:33 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu May 10 17:29:37 2007
Subject: [mod_python] Python Debugger doesn't start in Mod_Python
In-Reply-To: <46437322.5050600@hispeed.ch>
References: <46437322.5050600@hispeed.ch>
Message-ID: <88e286470705101429k111c5b4ay8ee2ccbd4149ada9@mail.gmail.com>

I suspect it is because of this change being made:

  http://issues.apache.org/jira/browse/MODPYTHON-195

I had been recently wondering whether the change would upset single
process debugging.

As it is, the issue has had to be reopened because it causes another
minor nuisance issue with version information for Python/mod_python
not being displayed.

Do you have the ability to compile mod_python from source code
yourself and thereby remove the change described in that issue and see
if it then works?

It still may be the case however that single process debugging has
never worked on Windows for one reason or another since people so
rarely use it.

Graham

On 11/05/07, Ren? Grob <rpgrob@hispeed.ch> wrote:
> Since my small intranet application keeps getting more complex I tried
> to fix some bugs using the Python Debugger. According to the Mod_python
> manual I added the "PythonEnablePdb On" directive into the directory
> context of my Python application and started httpd from the command line
> with the option -DONE_PROCESS (after stopping httpd first, of course).
> But Apache didn't start and an error window occurred instead showing the
> following message:
>
> "Runtime Error! Program: <Apache path>\httpd.exe. This application has
> requested the Runtime to terminate it in an unusual way. Please contact
> the applications's support team for more information".
>
> I'm using the following prebuilt binaries on Win2k SP4:
>
> mod_python-3.3.1.win32-py2.5-Apache2.2.exe
> python-2.5.msi
> apache_2.2.4-win32-x86-no_ssl.msi
>
> When Apache is started with the option -DONE_PROCESS but without
> Mod_python there is no error and no Mod_python either (of course). On a
> different machine with WinXP SP2, Apache 2.2.3, Python 2.4.3 and
> Mod_python 2.7.10 the debugger works as expected.
>
> Does anyone have an idea how to fix this?
>
> Thanks
>
> Ren?
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>

From graham.dumpleton at gmail.com  Thu May 10 18:04:52 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu May 10 18:04:55 2007
Subject: [mod_python] Python Debugger doesn't start in Mod_Python
In-Reply-To: <88e286470705101429k111c5b4ay8ee2ccbd4149ada9@mail.gmail.com>
References: <46437322.5050600@hispeed.ch>
	<88e286470705101429k111c5b4ay8ee2ccbd4149ada9@mail.gmail.com>
Message-ID: <88e286470705101504y7d5c7538p82f3a1c19543cf53@mail.gmail.com>

BTW, a couple of things to try.

1. See if running httpd with options '-X -DONE_PROCESS' makes a difference.

2. See if you can arrange for environment variable called
'AP_PARENT_PID' to be set to '0' in the environment that the httpd
process is running so as to stop mod_python avoiding its
initialisation step. Am not sure what magic is required on Windows to
set environment variables.

Graham

On 11/05/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> I suspect it is because of this change being made:
>
>   http://issues.apache.org/jira/browse/MODPYTHON-195
>
> I had been recently wondering whether the change would upset single
> process debugging.
>
> As it is, the issue has had to be reopened because it causes another
> minor nuisance issue with version information for Python/mod_python
> not being displayed.
>
> Do you have the ability to compile mod_python from source code
> yourself and thereby remove the change described in that issue and see
> if it then works?
>
> It still may be the case however that single process debugging has
> never worked on Windows for one reason or another since people so
> rarely use it.
>
> Graham
>
> On 11/05/07, Ren? Grob <rpgrob@hispeed.ch> wrote:
> > Since my small intranet application keeps getting more complex I tried
> > to fix some bugs using the Python Debugger. According to the Mod_python
> > manual I added the "PythonEnablePdb On" directive into the directory
> > context of my Python application and started httpd from the command line
> > with the option -DONE_PROCESS (after stopping httpd first, of course).
> > But Apache didn't start and an error window occurred instead showing the
> > following message:
> >
> > "Runtime Error! Program: <Apache path>\httpd.exe. This application has
> > requested the Runtime to terminate it in an unusual way. Please contact
> > the applications's support team for more information".
> >
> > I'm using the following prebuilt binaries on Win2k SP4:
> >
> > mod_python-3.3.1.win32-py2.5-Apache2.2.exe
> > python-2.5.msi
> > apache_2.2.4-win32-x86-no_ssl.msi
> >
> > When Apache is started with the option -DONE_PROCESS but without
> > Mod_python there is no error and no Mod_python either (of course). On a
> > different machine with WinXP SP2, Apache 2.2.3, Python 2.4.3 and
> > Mod_python 2.7.10 the debugger works as expected.
> >
> > Does anyone have an idea how to fix this?
> >
> > Thanks
> >
> > Ren?
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
>

From jrraines at comcast.net  Thu May 10 19:30:32 2007
From: jrraines at comcast.net (John Raines)
Date: Thu May 10 19:30:36 2007
Subject: [mod_python] Cookies not persisting 
In-Reply-To: <464366E3.8030800@ryankaskel.com>
References: <464366E3.8030800@ryankaskel.com>
Message-ID: <CA235629-6E09-4C21-AC16-C6FDA530244D@comcast.net>

Syntax of the Set-Cookie HTTP Response Header

This is the format a CGI script would use to add to the HTTP headers  
a new piece of data which is to be stored by the client for later  
retrieval.
Set-Cookie: NAME=VALUE; expires=DATE;
path=PATH; domain=DOMAIN_NAME; secure
NAME=VALUE
This string is a sequence of characters excluding semi-colon, comma  
and white space. If there is a need to place such data in the name or  
value, some encoding method such as URL style %XX encoding is  
recommended, though no encoding is defined or required.
This is the only required attribute on the Set-Cookie header.

expires=DATE
The expires attribute specifies a date string that defines the valid  
life time of that cookie. Once the expiration date has been reached,  
the cookie will no longer be stored or given out.
The date string is formatted as:
Wdy, DD-Mon-YYYY HH:MM:SS GMT
This is based on RFC 822, RFC 850, RFC 1036, and RFC 1123, with the  
variations that the only legal time zone is GMT and the separators  
between the elements of the date must be dashes.
expires is an optional attribute. If not specified, the cookie will  
expire when the user's session ends.



So if you don't specify, the cookie disappears when the browser quits.


On May 10, 2007, at 1:39 PM, Ryan Kaskel wrote:

> I am trying to fiddle around with AJAX but before I can get to that  
> part I need to make a little test login system will automatically  
> log the user in if a cookie is found. The problem is when I close  
> the browser the cookie is deleted. Everything else should work  
> (when I click the logout button I am still staying logged in  
> because it found the cookie). Does it have something to do with my  
> browser or an attribute I am not setting when I create the cookie.
>
> Thanks,
> Ryan
>
> below is the code:
>
> import time
> from mod_python import util
> from mod_python import Session, Cookie
>
> username = "test"
> password = "pass"
>
> main_page2 = """
> <html>
> <head>
>  <title>Main</title>
> </head>
> <body>
>  Welcome!
>  <p> <a href=\"./logout\">Logout</a> </p>
> </body>
> </html>
> """
>
> login_page = """
> <html>
> <head>
>  <title>Login</title>
> </head>
> <body>
>  <h1>Please login</h1>
>  <form action=\"./login\" method=\"POST\">
>   Username <input type=\"text\" name=\"user\"/> <br/>
>   Password <input type=\"text\" name=\"pass\"/> <br/>
>   Remember me? <input type=\"checkbox\" name=\"remember\"/> <br/>
>   <button type=\"submit\">Login</button>
>  </form>
> </body>
> </html>
> """
> def main(req):
>    req.content_type = 'text/html'
>    main_page = main_page2
>    session = Session.Session(req)
>    cookies = Cookie.get_cookies(req, Cookie.MarshalCookie,  
> secret="example")
>    if cookies.has_key('example1'):
>        cookie = cookies['example1']
>        if type(cookie) is Cookie.MarshalCookie:
>            data = cookie.value
>            main_page = data['user'] + " " + data['passw'] + main_page
>            session['valid'] = 'true'
>            session.save()
>    else:
>        if session.is_new():
>            util.redirect(req,'./login')
>        if session['valid'] != 'true':
>            util.redirect(req,'./login')
>    req.write(main_page)
>
> def login(req):
>    req.content_type = "text/html"
>    if req.method == 'POST':
>        if req.form['user'] == username and req.form['pass'] ==  
> password:
>            session = Session.Session(req)
>            session['valid'] = 'true'
>            session.save()
>            if req.form.has_key('remember') and req.form['remember']:
>                value = {'user': req.form['user'], 'passw': req.form 
> ['pass']}
>                Cookie.add_cookie(req, Cookie.MarshalCookie 
> ('example1', value,'example'), expires=time.time() + 3000000)
>            util.redirect(req,'./main')
>        else:
>            req.write("bad credentials")
>    else:
>        req.write(str(Cookie.get_cookies(req, Cookie.MarshalCookie,  
> secret='example')))
>        req.write(login_page)
>
> def logout(req):
>    req.content_type = "text/html"
>    session = Session.Session(req)
>    if session.has_key('valid'):
>        session.delete()
>    util.redirect(req,'./main')
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070510/4fe9e702/attachment-0001.html
From graham.dumpleton at gmail.com  Thu May 10 20:46:14 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu May 10 20:46:19 2007
Subject: [mod_python] Multiple loading of same module with winnt MPM
In-Reply-To: <46431DDE.9040602@gmail.com>
References: <4641C2B6.7060302@gmail.com>
	<88e286470705091500l43c18808qe095ca20b8f238c3@mail.gmail.com>
	<4642F364.6030208@gmail.com>
	<88e286470705100401l6c408fbfnae8fdb2e6a1ff3d6@mail.gmail.com>
	<88e286470705100448j4b3762a5xb35b2c3318de8f26@mail.gmail.com>
	<46431196.6060707@gmail.com> <46431D1F.3040603@gmail.com>
	<46431DDE.9040602@gmail.com>
Message-ID: <88e286470705101746m51d0d90fi9a52e1a2807ac336@mail.gmail.com>

Your change narrows the chance of the problem happening but does not
eliminate it completely. Also, it circumvents the whole two level
locking scheme designed to avoid slow downs in a multithreaded system.
In other words, when a module has to be imported you block all other
threads being able to load modules which don't require an actual
import. Also, I suspect the change will also cause a deadlock when a
module being imported in turn tries to use apache.import_module() as
the locks aren't reentrant by the same thread.

More later.

Graham

On 10/05/07, Michael Sanders <m.r.sanders@gmail.com> wrote:
> Michael Sanders wrote:
> > Further to this, one of my colleagues has made some other changes to
> > 'importer.py' that appear to fix the problem (please find a diff attached).
> >
> > The modification is a change to the locking in the import_module()
> > method of the _ModuleCache class:
> >
> > The 'self._lock1' lock is now used to lock out the actual 'loading' code
> > as well as the check-for-cache code: _reload_required().
> >
> > See line 554 ish (Code up to line 769 indented)
>
> Apologies, I sent the whole file and not a diff. I've (hopefully)
> attached the diff this time!
>
> Thanks,
> Michael
>
> --- importer.py 2007-05-10 13:57:01.157138700 +0100
> +++ importer.py.new     2007-05-10 14:18:22.976417100 +0100
> @@ -551,218 +551,222 @@
>              # Import module or obtain it from cache as is
>              # appropriate.
>
> -            if load:
> -
> -                # Setup a new empty module to load the code for
> -                # the module into. Increment the instance count
> -                # and set the reload flag to force a reload if
> -                # the import fails.
> -
> -                cache.instance = cache.instance + 1
> -                cache.reload = 1
> -
> -                module = imp.new_module(label)
> -
> -                # If the module was previously loaded we need to
> -                # manage the transition to the new instance of
> -                # the module that is being loaded to replace it.
> -                # This entails calling the special clone method,
> -                # if provided within the existing module. Using
> -                # this method the existing module can then
> -                # selectively indicate what should be transfered
> -                # over to the next instance of the module,
> -                # including thread locks. If this process fails
> -                # the special purge method is called, if
> -                # provided, to indicate that the existing module
> -                # is being forcibly purged out of the system. In
> -                # that case any existing state will not be
> -                # transferred.
> -
> -                if cache.module != None:
> -                    if hasattr(cache.module, "__mp_clone__"):
> -                        try:
> -                            # Migrate any existing state data from
> -                            # existing module instance to new module
> -                            # instance.
> -
> -                            if log:
> -                                msg = "Cloning module '%s'" % file
> +            try:
> +                self._lock1.acquire()
> +                if load:
> +
> +                    # Setup a new empty module to load the code for
> +                    # the module into. Increment the instance count
> +                    # and set the reload flag to force a reload if
> +                    # the import fails.
> +
> +                    cache.instance = cache.instance + 1
> +                    cache.reload = 1
> +
> +                    module = imp.new_module(label)
> +
> +                    # If the module was previously loaded we need to
> +                    # manage the transition to the new instance of
> +                    # the module that is being loaded to replace it.
> +                    # This entails calling the special clone method,
> +                    # if provided within the existing module. Using
> +                    # this method the existing module can then
> +                    # selectively indicate what should be transfered
> +                    # over to the next instance of the module,
> +                    # including thread locks. If this process fails
> +                    # the special purge method is called, if
> +                    # provided, to indicate that the existing module
> +                    # is being forcibly purged out of the system. In
> +                    # that case any existing state will not be
> +                    # transferred.
> +
> +                    if cache.module != None:
> +                        if hasattr(cache.module, "__mp_clone__"):
> +                            try:
> +                                # Migrate any existing state data from
> +                                # existing module instance to new module
> +                                # instance.
> +
> +                                if log:
> +                                    msg = "Cloning module '%s'" % file
> +                                    self._log_notice(msg)
> +
> +                                cache.module.__mp_clone__(module)
> +
> +                            except:
> +                                # Forcibly purging module from system.
> +
> +                                self._log_exception()
> +
> +                                if log:
> +                                    msg = "Purging module '%s'" % file
> +                                    self._log_notice(msg)
> +
> +                                if hasattr(cache.module, "__mp_purge__"):
> +                                    try:
> +                                        cache.module.__mp_purge__()
> +                                    except:
> +                                        self._log_exception()
> +
> +                                cache.module = None
> +
> +                                # Setup a fresh new module yet again.
> +
> +                                module = imp.new_module(label)
> +
> +                        if log:
> +                            if cache.module == None:
> +                                msg = "Importing module '%s'" % file
>                                  self._log_notice(msg)
> -
> -                            cache.module.__mp_clone__(module)
> -
> -                        except:
> -                            # Forcibly purging module from system.
> -
> -                            self._log_exception()
> -
> -                            if log:
> -                                msg = "Purging module '%s'" % file
> +                            else:
> +                                msg = "Reimporting module '%s'" % file
>                                  self._log_notice(msg)
> -
> -                            if hasattr(cache.module, "__mp_purge__"):
> -                                try:
> -                                    cache.module.__mp_purge__()
> -                                except:
> -                                    self._log_exception()
> -
> -                            cache.module = None
> -
> -                            # Setup a fresh new module yet again.
> -
> -                            module = imp.new_module(label)
> -
> -                    if log:
> -                        if cache.module == None:
> +                    else:
> +                        if log:
>                              msg = "Importing module '%s'" % file
>                              self._log_notice(msg)
> -                        else:
> -                            msg = "Reimporting module '%s'" % file
> -                            self._log_notice(msg)
> -                else:
> -                    if log:
> -                        msg = "Importing module '%s'" % file
> -                        self._log_notice(msg)
> -
> -                # Must add to the module the path to the modules
> -                # file. This ensures that module looks like a
> -                # normal module and this path will also be used
> -                # in certain contexts when the import statement
> -                # is used within the module.
> -
> -                module.__file__ = file
> -
> -                # Setup a new instance object to store in the
> -                # module. This will refer back to the actual
> -                # cache entry and is used to record information
> -                # which is specific to this incarnation of the
> -                # module when reloading is occuring.
> -
> -                instance = _InstanceInfo(label, file, cache)
> -
> -                module.__mp_info__ = instance
> -
> -                # Cache any additional module search path which
> -                # should be used for this instance of the module
> -                # or package. The path shouldn't be able to be
> -                # changed during the lifetime of the module to
> -                # ensure that module imports are always done
> -                # against the same path.
> -
> -                if path is None:
> -                    path = []
> -
> -                module.__mp_path__ = list(path)
> -
> -                # Place a reference to the module within the
> -                # request specific cache of imported modules.
> -                # This makes module lookup more efficient when
> -                # the same module is imported more than once
> -                # within the context of a request. In the case
> -                # of a cyclical import, avoids a never ending
> -                # recursive loop.
> -
> -                if modules is not None:
> -                    modules[label] = module
> -
> -                # If this is a child import of some parent
> -                # module, add this module as a child of the
> -                # parent.
> -
> -                atime = time.time()
> +
> +                    # Must add to the module the path to the modules
> +                    # file. This ensures that module looks like a
> +                    # normal module and this path will also be used
> +                    # in certain contexts when the import statement
> +                    # is used within the module.
> +
> +                    module.__file__ = file
> +
> +                    # Setup a new instance object to store in the
> +                    # module. This will refer back to the actual
> +                    # cache entry and is used to record information
> +                    # which is specific to this incarnation of the
> +                    # module when reloading is occuring.
> +
> +                    instance = _InstanceInfo(label, file, cache)
> +
> +                    module.__mp_info__ = instance
> +
> +                    # Cache any additional module search path which
> +                    # should be used for this instance of the module
> +                    # or package. The path shouldn't be able to be
> +                    # changed during the lifetime of the module to
> +                    # ensure that module imports are always done
> +                    # against the same path.
> +
> +                    if path is None:
> +                        path = []
> +
> +                    module.__mp_path__ = list(path)
> +
> +                    # Place a reference to the module within the
> +                    # request specific cache of imported modules.
> +                    # This makes module lookup more efficient when
> +                    # the same module is imported more than once
> +                    # within the context of a request. In the case
> +                    # of a cyclical import, avoids a never ending
> +                    # recursive loop.
> +
> +                    if modules is not None:
> +                        modules[label] = module
> +
> +                    # If this is a child import of some parent
> +                    # module, add this module as a child of the
> +                    # parent.
> +
> +                    atime = time.time()
> +
> +                    if parent_info:
> +                        parent_info.children[label] = atime
> +
> +                    # Perform actual import of the module.
> +
> +                    try:
> +                        execfile(file, module.__dict__)
> +
> +                    except:
> +
> +                        # Importation of the module has failed for
> +                        # some reason. If this is the very first
> +                        # import of the module, need to discard the
> +                        # cache entry entirely else a subsequent
> +                        # attempt to load the module will wrongly
> +                        # think it was successfully loaded already.
> +
> +                        if cache.module is None:
> +                            del self._cache[label]
> +
> +                        raise
> +
> +                    # Update the cache and clear the reload flag.
> +
> +                    cache.module = module
> +                    cache.reload = 0
> +
> +                    # Need to also update the list of child modules
> +                    # stored in the cache entry with the actual
> +                    # children found during the import. A copy is
> +                    # made, meaning that any future imports
> +                    # performed within the context of the request
> +                    # handler don't result in the module later being
> +                    # reloaded if they change.
> +
> +                    cache.children = dict(module.__mp_info__.children)
> +
> +                    # Create link to embedded path at end of import.
> +
> +                    cache.path = module.__mp_path__
> +
> +                    # Increment the generation count of the global
> +                    # state of all modules. This is used in the
> +                    # dependency management scheme for reloading to
> +                    # determine if a module dependency has been
> +                    # reloaded since it was loaded.
> +
> +                    self._lock2.acquire()
> +                    self._generation = self._generation + 1
> +                    cache.generation = self._generation
> +                    self._lock2.release()
> +
> +                    # Update access time and reset access counts.
> +
> +                    cache.ctime = atime
> +                    cache.atime = atime
> +                    cache.direct = 1
> +                    cache.indirect = 0
>
> -                if parent_info:
> -                    parent_info.children[label] = atime
> -
> -                # Perform actual import of the module.
> -
> -                try:
> -                    execfile(file, module.__dict__)
> -
> -                except:
> -
> -                    # Importation of the module has failed for
> -                    # some reason. If this is the very first
> -                    # import of the module, need to discard the
> -                    # cache entry entirely else a subsequent
> -                    # attempt to load the module will wrongly
> -                    # think it was successfully loaded already.
> -
> -                    if cache.module is None:
> -                        del self._cache[label]
> -
> -                    raise
> -
> -                # Update the cache and clear the reload flag.
> -
> -                cache.module = module
> -                cache.reload = 0
> -
> -                # Need to also update the list of child modules
> -                # stored in the cache entry with the actual
> -                # children found during the import. A copy is
> -                # made, meaning that any future imports
> -                # performed within the context of the request
> -                # handler don't result in the module later being
> -                # reloaded if they change.
> -
> -                cache.children = dict(module.__mp_info__.children)
> -
> -                # Create link to embedded path at end of import.
> -
> -                cache.path = module.__mp_path__
> -
> -                # Increment the generation count of the global
> -                # state of all modules. This is used in the
> -                # dependency management scheme for reloading to
> -                # determine if a module dependency has been
> -                # reloaded since it was loaded.
> -
> -                self._lock2.acquire()
> -                self._generation = self._generation + 1
> -                cache.generation = self._generation
> -                self._lock2.release()
> -
> -                # Update access time and reset access counts.
> -
> -                cache.ctime = atime
> -                cache.atime = atime
> -                cache.direct = 1
> -                cache.indirect = 0
> -
> -            else:
> -
> -                # Update the cache.
> -
> -                module = cache.module
> -
> -                # Place a reference to the module within the
> -                # request specific cache of imported modules.
> -                # This makes module lookup more efficient when
> -                # the same module is imported more than once
> -                # within the context of a request. In the case
> -                # of a cyclical import, avoids a never ending
> -                # recursive loop.
> -
> -                if modules is not None:
> -                    modules[label] = module
> -
> -                # If this is a child import of some parent
> -                # module, add this module as a child of the
> -                # parent.
> -
> -                atime = time.time()
> -
> -                if parent_info:
> -                    parent_info.children[label] = atime
> -
> -                # Didn't need to reload the module so simply
> -                # increment access counts and last access time.
> -
> -                cache.atime = atime
> -                cache.direct = cache.direct + 1
> -
> -            return module
> +                else:
> +
> +                    # Update the cache.
> +
> +                    module = cache.module
> +
> +                    # Place a reference to the module within the
> +                    # request specific cache of imported modules.
> +                    # This makes module lookup more efficient when
> +                    # the same module is imported more than once
> +                    # within the context of a request. In the case
> +                    # of a cyclical import, avoids a never ending
> +                    # recursive loop.
> +
> +                    if modules is not None:
> +                        modules[label] = module
> +
> +                    # If this is a child import of some parent
> +                    # module, add this module as a child of the
> +                    # parent.
> +
> +                    atime = time.time()
> +
> +                    if parent_info:
> +                        parent_info.children[label] = atime
> +
> +                    # Didn't need to reload the module so simply
> +                    # increment access counts and last access time.
> +
> +                    cache.atime = atime
> +                    cache.direct = cache.direct + 1
> +
> +                return module
> +            finally:
> +                self._lock1.release() # always unlock
>
>          finally:
>              # Lock on cache object can now be released.
>
>
From ryan at ryankaskel.com  Thu May 10 20:57:06 2007
From: ryan at ryankaskel.com (Ryan Kaskel)
Date: Thu May 10 20:57:48 2007
Subject: [mod_python] Cookies not persisting
In-Reply-To: <CA235629-6E09-4C21-AC16-C6FDA530244D@comcast.net>
References: <464366E3.8030800@ryankaskel.com>
	<CA235629-6E09-4C21-AC16-C6FDA530244D@comcast.net>
Message-ID: <4643BF62.5010501@ryankaskel.com>

John Raines wrote:
>
> *Syntax of the Set-Cookie HTTP Response Header*
>
> This is the format a CGI script would use to add to the HTTP headers a 
> new piece of data which is to be stored by the client for later retrieval.
> Set-Cookie: /NAME/=/VALUE/; expires=/DATE/;
> path=/PATH/; domain=/DOMAIN_NAME/; secure
> /NAME/=/VALUE/
> This string is a sequence of characters excluding semi-colon, comma 
> and white space. If there is a need to place such data in the name or 
> value, some encoding method such as URL style %XX encoding is 
> recommended, though no encoding is defined or required.
> This is the only required attribute on the *Set-Cookie* header.
>
> *expires*=/DATE/
> The *expires* attribute specifies a date string that defines the valid 
> life time of that cookie. Once the expiration date has been reached, 
> the cookie will no longer be stored or given out.
> The date string is formatted as:
> Wdy, DD-Mon-YYYY HH:MM:SS GMT
> This is based on RFC 822 <http://ds.internic.net/rfc/rfc822.txt>, RFC 
> 850 <http://ds.internic.net/rfc/rfc850.txt>, RFC 1036 
> <http://www.w3.org/hypertext/WWW/Protocols/rfc1036/rfc1036.html#z6>, 
> and RFC 1123 <http://ds1.internic.net/rfc/rfc1123.txt>, with the 
> variations that the only legal time zone is *GMT* and the separators 
> between the elements of the date must be dashes.
>
> *expires* is an optional attribute. If not specified, the cookie will 
> expire when the user's session ends.
>
>
> So if you don't specify, the cookie disappears when the browser quits.
>
Not sure if you looked at what I did but I found the reason anyway.  If 
I change the code to this:

        value = {'user': req.form['user'], 'passw': req.form['pass']}
        c = Cookie.MarshalCookie('example1', value, 'example')
        c.expires=time.time() + 3000
        Cookie.add_cookie(req,c)

It works. After looking at the Cookie.py source, it seems that that 
set_expires is only called when expires is used as an instance attribute 
and not here:

    *def* *__init__*(self, name, value, **kw):

        *"""
        This constructor takes at least a name and value as the
        arguments, as well as optionally any of allowed cookie attributes
        as defined in the existing cookie standards. 
        """*
        self.name, self.value = name, value

        *for* k *in* kw:
            setattr(self, k.lower(), kw[k]) # set_expires not called here when k == 'expires'?

        /# subclasses can use this for internal stuff
/        self.__data__ = {}


Anyway, not sure if what I'm saying is correct but the example given in 
the docs (pass expires as an argument):

c = Cookie.Cookie('spam', 'eggs', expires=time.time()+300)
Cookie.add_cookie(req, c)

didn't work (albeit using the MarshalCookie class instead) but it did 
work when I used c.expires.

Ryan
>
> On May 10, 2007, at 1:39 PM, Ryan Kaskel wrote:
>
>> I am trying to fiddle around with AJAX but before I can get to that 
>> part I need to make a little test login system will automatically log 
>> the user in if a cookie is found. The problem is when I close the 
>> browser the cookie is deleted. Everything else should work (when I 
>> click the logout button I am still staying logged in because it found 
>> the cookie). Does it have something to do with my browser or an 
>> attribute I am not setting when I create the cookie.
>>
>> Thanks,
>> Ryan
>>
>> below is the code:
>>
>> import time
>> from mod_python import util
>> from mod_python import Session, Cookie
>>
>> username = "test"
>> password = "pass"
>>
>> main_page2 = """
>> <html>
>> <head>
>>  <title>Main</title>
>> </head>
>> <body>
>>  Welcome!
>>  <p> <a href=\"./logout\">Logout</a> </p>
>> </body>
>> </html>
>> """
>>
>> login_page = """
>> <html>
>> <head>
>>  <title>Login</title>
>> </head>
>> <body>
>>  <h1>Please login</h1>
>>  <form action=\"./login\" method=\"POST\">
>>   Username <input type=\"text\" name=\"user\"/> <br/>
>>   Password <input type=\"text\" name=\"pass\"/> <br/>
>>   Remember me? <input type=\"checkbox\" name=\"remember\"/> <br/>
>>   <button type=\"submit\">Login</button>
>>  </form>
>> </body>
>> </html>
>> """
>> def main(req):
>>    req.content_type = 'text/html'
>>    main_page = main_page2
>>    session = Session.Session(req)
>>    cookies = Cookie.get_cookies(req, Cookie.MarshalCookie, 
>> secret="example")
>>    if cookies.has_key('example1'):
>>        cookie = cookies['example1']
>>        if type(cookie) is Cookie.MarshalCookie:
>>            data = cookie.value
>>            main_page = data['user'] + " " + data['passw'] + main_page
>>            session['valid'] = 'true'
>>            session.save()
>>    else:
>>        if session.is_new():
>>            util.redirect(req,'./login')
>>        if session['valid'] != 'true':
>>            util.redirect(req,'./login')
>>    req.write(main_page)
>>
>> def login(req):
>>    req.content_type = "text/html"
>>    if req.method == 'POST':
>>        if req.form['user'] == username and req.form['pass'] == password:
>>            session = Session.Session(req)
>>            session['valid'] = 'true'
>>            session.save()
>>            if req.form.has_key('remember') and req.form['remember']:
>>                value = {'user': req.form['user'], 'passw': 
>> req.form['pass']}
>>                Cookie.add_cookie(req, 
>> Cookie.MarshalCookie('example1', value,'example'), 
>> expires=time.time() + 3000000)
>>            util.redirect(req,'./main')
>>        else:
>>            req.write("bad credentials")
>>    else:
>>        req.write(str(Cookie.get_cookies(req, Cookie.MarshalCookie, 
>> secret='example')))
>>        req.write(login_page)
>>
>> def logout(req):
>>    req.content_type = "text/html"
>>    session = Session.Session(req)
>>    if session.has_key('valid'):
>>        session.delete()
>>    util.redirect(req,'./main')
>>
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org <mailto:Mod_python@modpython.org>
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>

From graham.dumpleton at gmail.com  Thu May 10 21:59:34 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu May 10 21:59:38 2007
Subject: [mod_python] Cookies not persisting
In-Reply-To: <464366E3.8030800@ryankaskel.com>
References: <464366E3.8030800@ryankaskel.com>
Message-ID: <88e286470705101859n51e17ed8m32537aaa71658cbf@mail.gmail.com>

On 11/05/07, Ryan Kaskel <ryan@ryankaskel.com> wrote:
>
>                 Cookie.add_cookie(req, Cookie.MarshalCookie('example1',
> value,'example'), expires=time.time() + 3000000)

What happens when you put the close bracket in the correct spot such
that the expires argument is passed to the MarshalCookie constructor
and not the add_cookie() function?

Graham
From simon.holness at gmail.com  Fri May 11 05:22:46 2007
From: simon.holness at gmail.com (simon holness)
Date: Fri May 11 05:22:54 2007
Subject: [mod_python] Multiple loading of same module with winnt MPM
Message-ID: <b26b30150705110222m5164c6e6udd70b2f406f4000e@mail.gmail.com>

Hi, I'm the guy who knocked up the quick fix. Yes, I think you're
quite right and the fix is also not correct.

The problem appears to essentially be that a whole load of processing
is happening on the 'cache' object while it isn't locked.

There's always a severe danger/headache in trying to mesh two locks like this.

Do you know if there's a reason that "_lock1" is used to lock out the
entire of _reload_required(), rather than swapping to the use of
cache.lock ? Is it to do with the processing of the cache's children?
or the call to _check_module() ?

The correct solution looks, to me, like all of the processing of the
cache object should be guarded by its lock, and not by the
_ModuleCache's _lock1. I'm not familiar enough with the code to decide
if that's practicable or correct, though.

Cheers
Simon

> Your change narrows the chance of the problem happening but does not
> eliminate it completely. Also, it circumvents the whole two level
> locking scheme designed to avoid slow downs in a multithreaded system.
> In other words, when a module has to be imported you block all other
> threads being able to load modules which don't require an actual
> import. Also, I suspect the change will also cause a deadlock when a
> module being imported in turn tries to use apache.import_module() as
> the locks aren't reentrant by the same thread.
>
> More later.
>
> Graham
From graham.dumpleton at gmail.com  Fri May 11 06:54:35 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Fri May 11 06:54:40 2007
Subject: [mod_python] Multiple loading of same module with winnt MPM
In-Reply-To: <b26b30150705110222m5164c6e6udd70b2f406f4000e@mail.gmail.com>
References: <b26b30150705110222m5164c6e6udd70b2f406f4000e@mail.gmail.com>
Message-ID: <88e286470705110354o22acd748qb39887387540d3c@mail.gmail.com>

On 11/05/07, simon holness <simon.holness@gmail.com> wrote:
> Hi, I'm the guy who knocked up the quick fix. Yes, I think you're
> quite right and the fix is also not correct.
>
> The problem appears to essentially be that a whole load of processing
> is happening on the 'cache' object while it isn't locked.

It is okay as it is dealing with only read only data at that point.
When a reload is being done it accumulates the new data in temporary
data structure and replaces original later in one atomic operation in
such a way as not to cause problems.

> Do you know if there's a reason that "_lock1" is used to lock out the
> entire of _reload_required(), rather than swapping to the use of
> cache.lock ? Is it to do with the processing of the cache's children?
> or the call to _check_module() ?

The reload check is protected to stop two threads deciding at the same
time that something needs reloading. Where the code went wrong is that
cache.reload is set to 1 part way through cache entry locked code and
depending on whether reload check sees this or not is causing the
problem. I only added this reload flag late in the peace so I could
get some nice debug information but it has screwed things up in this
particular instance.

> The correct solution looks, to me, like all of the processing of the
> cache object should be guarded by its lock,  and not by the
> _ModuleCache's _lock1.

Can't be the cache entry lock as you are actually traversing many
cache entries and not just one.

I already have so changes which should work, but need to sit down and
think it through a bit more first and look back at some older versions
of this code I had if I can find them. I am sure I used to overlap the
reload lock with cache entry lock for a brief time to avoid certain
problems and not sure why the code isn't doing it anymore so have to
look at the way I was avoiding that is actually okay.

I have created an issue for this in the tracking system and any patch
will be put up against it to try.

  http://issues.apache.org/jira/browse/MODPYTHON-219

If I can get to it, will put up something over the weekend.

Graham
From rogerb at rogerbinns.com  Fri May 11 14:01:02 2007
From: rogerb at rogerbinns.com (Roger Binns)
Date: Fri May 11 14:01:05 2007
Subject: [mod_python] lookup_uri
Message-ID: <4644AF5E.1060504@rogerbinns.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

I wrote a week ago about wanting to do subrequests but couldn't find
anything in modpython beyond internal_redirect.

Anyway it turns out that Apache really does have exactly what I need and
they are called subrequests.  The actual method I want to call is
lookup_method_uri (assuming it copies authentication information from
the parent request).

modpython seems not to have this family of methods.  The Perl equivalent
of modpython does:

  http://perl.apache.org/docs/2.0/api/Apache2/SubRequest.html

Any advice on how to get access to these methods?  I'm happy to do any
of the following:

  * Modify modpython source code
  * Abuse ctypes in some way
  * Write an additional library to be loaded accessible from python code

This topic seems to have come up before without apparent resolution:

http://www.modpython.org/pipermail/mod_python/2006-September/021994.html
http://www.mail-archive.com/python-dev@httpd.apache.org/msg02594.html

Roger
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)

iD8DBQFGRK9emOOfHg372QQRAh5kAJ0THpNXpYbBvyGya988Vy2ecjmAcQCffv44
nqc9qmWH4I1rGAUVzWyHsEM=
=KbRQ
-----END PGP SIGNATURE-----
From simon.holness at gmail.com  Fri May 11 16:47:24 2007
From: simon.holness at gmail.com (simon holness)
Date: Fri May 11 16:47:29 2007
Subject: [mod_python] import_module is case sensitive even if the OS isn't
Message-ID: <b26b30150705111347u2884083fo162c2cf9fc6809e6@mail.gmail.com>

Hi,

I've found an apparent issue with apache.import_module() - it seems to
key the module on a case sensitive path/name even if the operating
system (i.e. windows) doesn't. Thus a module can be wrongly loaded
twice by using different capitalisation in different import requests.

For most applications this will not be an issue since the separately
loaded modules will be distinct. If, however, and application is
relying on a module being loaded only once per interpreter (yeah,
guess which case I've got) it can cause problems.

This can be trivially reproduced by importing the same module twice
with differing pathnames.

e.g.

mytest.psp
-------------------------
<%
mod1 = apache.import_module("c:\\work\\Webroot\\mymodule.py") # nb cap W
mod2 = apache.import_module("c:\\work\\webroot\\mymodule.py")
%>
<html>
<head><title></title></head>
<body>go read your apache error log to see what got loaded</body>
</html>
------------------------
mymodule.py
------------------------
# I'm a very boring module
pass
------------------------

error.log contains
------------------------
....
... Importing module 'c:\\work\\Webroot\\mymodule.py'
... Importing module 'c:\\work\\webroot\\mymodule.py'

This, obviously, won't be an issue on any case-sensitive OS (*nix).

Having had a quick look at the code (and run a very simple test) it
appears that altering importer.py line 454 to

file = os.path.normcase(os.path.normpath(file))

fixes the issue.
I haven't looked to see if there are other places where the path would
need to be normalised. Possibly in _setup_current_cache() ?

normcase() should be safe & correct on both types of system.

Cheers
Simon Holness
From graham.dumpleton at gmail.com  Fri May 11 20:06:57 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Fri May 11 20:07:00 2007
Subject: [mod_python] import_module is case sensitive even if the OS isn't
In-Reply-To: <b26b30150705111347u2884083fo162c2cf9fc6809e6@mail.gmail.com>
References: <b26b30150705111347u2884083fo162c2cf9fc6809e6@mail.gmail.com>
Message-ID: <88e286470705111706k165715baya8302f153d90cfd3@mail.gmail.com>

The _check_directory() method will also need to be changed in some way
to ensure the integrity checks work also. Ie.

    if directory in sys.path:

need to change to:

    if directory in map(os.path.normcase, sys.path):

What happens though if Windows is being asked to mount a remote file
system which is case sensitive and files were being loaded from there.
Are files on such a file system seen as case sensitive. If they are
then the changes can't be made. Can anyone comment on the remote file
system example and how case is handled for files from that?

Also, are there any native file systems on Windows that are case
sensitive. On Mac OS X the default file system is case insensitive,
but one can use case sensitive local file systems as well.

Finally, with such a change log messages and error pages are going to
now show lower case paths which may confuse people if the original
path used mixed case.

It is because of these issues that I may have originally not applied
os.path.normcase() to paths and basically taken the viewpoint that
users should just get their paths consistent in the first place as too
hard otherwise.

Graham

On 12/05/07, simon holness <simon.holness@gmail.com> wrote:
> Hi,
>
> I've found an apparent issue with apache.import_module() - it seems to
> key the module on a case sensitive path/name even if the operating
> system (i.e. windows) doesn't. Thus a module can be wrongly loaded
> twice by using different capitalisation in different import requests.
>
> For most applications this will not be an issue since the separately
> loaded modules will be distinct. If, however, and application is
> relying on a module being loaded only once per interpreter (yeah,
> guess which case I've got) it can cause problems.
>
> This can be trivially reproduced by importing the same module twice
> with differing pathnames.
>
> e.g.
>
> mytest.psp
> -------------------------
> <%
> mod1 = apache.import_module("c:\\work\\Webroot\\mymodule.py") # nb cap W
> mod2 = apache.import_module("c:\\work\\webroot\\mymodule.py")
> %>
> <html>
> <head><title></title></head>
> <body>go read your apache error log to see what got loaded</body>
> </html>
> ------------------------
> mymodule.py
> ------------------------
> # I'm a very boring module
> pass
> ------------------------
>
> error.log contains
> ------------------------
> ....
> ... Importing module 'c:\\work\\Webroot\\mymodule.py'
> ... Importing module 'c:\\work\\webroot\\mymodule.py'
>
> This, obviously, won't be an issue on any case-sensitive OS (*nix).
>
> Having had a quick look at the code (and run a very simple test) it
> appears that altering importer.py line 454 to
>
> file = os.path.normcase(os.path.normpath(file))
>
> fixes the issue.
> I haven't looked to see if there are other places where the path would
> need to be normalised. Possibly in _setup_current_cache() ?
>
> normcase() should be safe & correct on both types of system.
>
> Cheers
> Simon Holness
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From rogerb at rogerbinns.com  Fri May 11 20:39:53 2007
From: rogerb at rogerbinns.com (Roger Binns)
Date: Fri May 11 20:39:55 2007
Subject: [mod_python] dot dot in the url
Message-ID: <46450CD9.2030105@rogerbinns.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

I'm using modpython to provide a rest style api.  Unfortunately I am
experiencing a problem when there are ../ sequences as part of the url.
 For example if the path I service is /api/book/TITLE where title is the
title, I can't find anything that allows me to process the url when dots
are there.

An example is wanting to process /api/book/foo/../../bar

In my code I want /api/book/ handler invoked with "foo/../../bar" to be
the title.

Either Apache or modpython "normalizes" the url and treats the whole
thing as /api/bar.  I can't seem to stop that behaviour.  It happens
even if I use %2f/%2e.  I have AllowEncodedSlashes on as well.

I realize the whole thing looks like a directory traversal attack, but
it isn't and my code copes just fine when it is invoked.

Roger
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)

iD8DBQFGRQzZmOOfHg372QQRAimpAJwI1IfNfELlfS5t/Qiak3uyQg8UEwCgtnqp
bJu01YGmVSVX3tPAmlxbnms=
=5TCw
-----END PGP SIGNATURE-----
From graham.dumpleton at gmail.com  Fri May 11 21:13:58 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Fri May 11 21:14:01 2007
Subject: [mod_python] dot dot in the url
In-Reply-To: <46450CD9.2030105@rogerbinns.com>
References: <46450CD9.2030105@rogerbinns.com>
Message-ID: <88e286470705111813t61a0baddg426a9a02727f07d9@mail.gmail.com>

If your web browser doesn't normalise it then Apache will. Such
normalisation will be done before it even gets to mod_python.

You state want you want to happen, but why exactly do you want to do
this in the first place? What is the underlying reason?

Graham

On 12/05/07, Roger Binns <rogerb@rogerbinns.com> wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> I'm using modpython to provide a rest style api.  Unfortunately I am
> experiencing a problem when there are ../ sequences as part of the url.
>  For example if the path I service is /api/book/TITLE where title is the
> title, I can't find anything that allows me to process the url when dots
> are there.
>
> An example is wanting to process /api/book/foo/../../bar
>
> In my code I want /api/book/ handler invoked with "foo/../../bar" to be
> the title.
>
> Either Apache or modpython "normalizes" the url and treats the whole
> thing as /api/bar.  I can't seem to stop that behaviour.  It happens
> even if I use %2f/%2e.  I have AllowEncodedSlashes on as well.
>
> I realize the whole thing looks like a directory traversal attack, but
> it isn't and my code copes just fine when it is invoked.
>
> Roger
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.6 (GNU/Linux)
>
> iD8DBQFGRQzZmOOfHg372QQRAimpAJwI1IfNfELlfS5t/Qiak3uyQg8UEwCgtnqp
> bJu01YGmVSVX3tPAmlxbnms=
> =5TCw
> -----END PGP SIGNATURE-----
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From graham.dumpleton at gmail.com  Sat May 12 00:09:17 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sat May 12 00:09:20 2007
Subject: [mod_python] lookup_uri
In-Reply-To: <4644AF5E.1060504@rogerbinns.com>
References: <4644AF5E.1060504@rogerbinns.com>
Message-ID: <88e286470705112109v3747493excb483e1b3c77144d@mail.gmail.com>

On 12/05/07, Roger Binns <rogerb@rogerbinns.com> wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> I wrote a week ago about wanting to do subrequests but couldn't find
> anything in modpython beyond internal_redirect.
>
> Anyway it turns out that Apache really does have exactly what I need and
> they are called subrequests.  The actual method I want to call is
> lookup_method_uri (assuming it copies authentication information from
> the parent request).

The problem is that in that discussion where I said:

"""Even if exposed in mod_python it would still not help given that
you wouldn't have the auth information available for /admin URL to
pass  through."""

You basically didn't want to agree and said:

"""That is the easy bit :-)  Just copying the authentication response
headers from /api will do the trick."""

I still believe that you don't quite understand what would happen. Let
me see if I can explain it again in a way you can understand.

First off, you said that /admin would have no AuthType/AuthName
directives covering that URL in the Apache configuration. Because of
this fact, the browser isn't going to be sending any authentication
information for that URL. Ie., there will be no Authorization header
available to the request handler for the /admin URL.

Second, you gave the pseudo code for your /admin handler as:

def handler(req):
 print "Hello world"

 # I can't see how to do the next two lines which could have
 # different permissions
 ... check credentials in req against "/api/object/list"
 ... check credentials in req against "/api/object3/delete"

 # The next two could be done by calling the code that
 # implements /api directly (or playing with internal_redirect)
 items=request("/api/object/list")
 request("/api/%s/delete" % (items[3],))

 print "more output saying item3 was deleted"

Your problem as you see it how to check those credentials. The real
problem at this point is where are you getting the credentials from if
the browser isn't going to send them. If you are using either HTTP
Basic or Digest authentication, which you said was one of your
options, given that the admin could choose whatever they wanted, in
order for the browser to send credentials the server has to challenge
the browser indicating that it is a password authenticated area of the
server. To do this it has to send back a special header to the browser
saying what the authentication domain is that credentials need to be
supplied for. You are skipping this important challenge step by
assuming the credentials will be there and simply moving to try and
validate them.

It is also not enough that you have some special separate /login URL
where AuthType and AuthName may be set as the browser will only send
through the credentials for that URL and not arbitrary other URLs such
as /admin which it doesn't know to be in the same AuthName domain.

Where web applications, such as Trac, use a /login URL as a single
login point, once they have successfully logged in the user they then
use cookies to track the fact that the user is logged in.

If you still disagree, and maybe I am missing something, by what
mechanism do you think the credentials will be available in the first
place? How is the browser going to know to send them for the /admin
URL. The only way I can think of where credentials may be available
automatically is if you are using HTTPS with unique client side
certificates which identify the specific user.

> modpython seems not to have this family of methods.  The Perl equivalent
> of modpython does:
>
>   http://perl.apache.org/docs/2.0/api/Apache2/SubRequest.html
>
> Any advice on how to get access to these methods?  I'm happy to do any
> of the following:
>
>   * Modify modpython source code

Go right ahead if you want to modify your mod_python source.

>   * Abuse ctypes in some way

Not something I'd recommend.

>   * Write an additional library to be loaded accessible from python code

Which can also work, with SWIG serving as a useful complement.

> This topic seems to have come up before without apparent resolution:
>
> http://www.modpython.org/pipermail/mod_python/2006-September/021994.html
> http://www.mail-archive.com/python-dev@httpd.apache.org/msg02594.html

More importantly the following which was sent just a week before your
discussion started up.

  http://www.modpython.org/pipermail/mod_python/2007-April/023494.html

and dictates various approaches to how one might go about extending
mod_python features without actually modifying mod_python.

Graham
From rogerb at rogerbinns.com  Sat May 12 01:46:31 2007
From: rogerb at rogerbinns.com (Roger Binns)
Date: Sat May 12 01:46:34 2007
Subject: [mod_python] dot dot in the url
In-Reply-To: <88e286470705111813t61a0baddg426a9a02727f07d9@mail.gmail.com>
References: <46450CD9.2030105@rogerbinns.com>
	<88e286470705111813t61a0baddg426a9a02727f07d9@mail.gmail.com>
Message-ID: <464554B7.90902@rogerbinns.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Graham Dumpleton wrote:
> If your web browser doesn't normalise it 

I am sending requests from my test harness which does not do
normalization.  In my case normalization effectively "corrupts" the data.

> then Apache will. Such
> normalisation will be done before it even gets to mod_python.

req.uri is normalized but req.unparsed_uri is as originally sent by the
client, so I use that.  The only remaining problem is that if the
normalized uri doesn't reference my handler then it isn't called.

<Location /api/v1/>
 SetHandler python-program
 PythonHandler restapiv1::RestAPIV1.RequestHandler
</Location>

So I get called for /api/v1/widget/a/b/c/d/../../e but not for
/api/v1/widget/../../e/a/b/c/d

> You state want you want to happen, but why exactly do you want to do
> this in the first place? What is the underlying reason?

Exactly as I said.  It is a rest service and the names of items appear
as part of the URL.  eg You use PUT /api/v1/widget/foo to create a
widget named foo, GET to query it, DELETE to delete it etc.

But because of this normalization done by Apache before deciding which
handler to call, that imposes an arbitrary constraint on names such that
they can't have ../ sequences that get up before the /api/v1/.  The
arbitrary constraint then has to be documented, tested, have friendly
information in user interfaces etc.  It is an ugly wart and I was hoping
it was unnecessary.

Roger
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)

iD8DBQFGRVS3mOOfHg372QQRAulYAJ90JYiXJ+FSkQzJPNpdlTCFJFSYvgCfbzw4
1FKXPA+JqBzWAufEfSe13CA=
=ZdiB
-----END PGP SIGNATURE-----
From rogerb at rogerbinns.com  Sat May 12 02:13:13 2007
From: rogerb at rogerbinns.com (Roger Binns)
Date: Sat May 12 02:13:16 2007
Subject: [mod_python] lookup_uri
In-Reply-To: <88e286470705112109v3747493excb483e1b3c77144d@mail.gmail.com>
References: <4644AF5E.1060504@rogerbinns.com>
	<88e286470705112109v3747493excb483e1b3c77144d@mail.gmail.com>
Message-ID: <46455AF9.6000100@rogerbinns.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Graham Dumpleton wrote:
> > You basically didn't want to agree and said:
> >
> > """That is the easy bit  :-)   Just copying the authentication response
> > headers from /api will do the trick."""
> >
> > I still believe that you don't quite understand what would happen. Let
> > me see if I can explain it again in a way you can understand.

I really do understand what I am talking about  :-)   How about some
config and code.

<Location /api/v1/widget/>
  <Limit GET>
  Require group reader
  </Limit>
</Location>

That ensures that Apache requires authentication for the rest service.
Now this is my code in the handler for /admin which has no directive
such as the above requiring authentication.

def handler(req):
   name="foo"
   # Before generating this page, check they can get info widget
   sub=req.lookup_method_uri("GET", "/api/v1/widget/"+name)
   # Copy any authentication to subrequest
   sub.headers_in["Authorization"]=req.headers_in["Authorization"]
   # Run the subrequest
   sub.run()
   # Was authentication required?
   if sub.status==401:
      req.status=401

req.headers_out["WWW-Authenticate"]=sub.headers_out["WWW-Authenticate"]
      return apache.OK
   if sub.status!=200:
      req.status=sub.status
      ... copy error message or something similar ...
      return apache.OK
   # At this point we know that there is permission to read widget
   ... generate page etc ...

> > First off, you said that /admin would have no AuthType/AuthName
> > directives covering that URL in the Apache configuration. Because of
> > this fact, the browser isn't going to be sending any authentication
> > information for that URL. Ie., there will be no Authorization header
> > available to the request handler for the /admin URL.

That is correct.  But the subrequest would return 401 if authentication
was required and that can be copied into the response for the request so
the browser will then retry with credentials.

> > Your problem as you see it how to check those credentials. The real
> > problem at this point is where are you getting the credentials from if
> > the browser isn't going to send them.

Well it would since I'd send them back from the subrequest as shown above.

> > You are skipping this important challenge step by
> > assuming the credentials will be there and simply moving to try and
> > validate them.

Err no, the challenge step is there due to sending 401 and
WWW-Authenticate header back to the original request.

> > Where web applications, such as Trac, use a /login URL as a single
> > login point, once they have successfully logged in the user they then
> > use cookies to track the fact that the user is logged in.

Yes.  But those applications also have to implement their own
authorization system.  I intend to let apache do all that.  For example
the administrator can do this in the configuration:

<Location /api/v1/widget/>
  <Limit GET>
  Require group anyone
  </Limit>
</Location>

<Location /api/v1/widget/>
  <Limit DELETE>
  Require group admins
  </Limit>
</Location>

But then they can be more specific as well:

<Location /api/v1/widget/thelab>
  <Limit DELETE>
  Require group labadmins
  </Limit>
</Location>

> > If you still disagree, and maybe I am missing something, by what
> > mechanism do you think the credentials will be available in the first
> > place?

The bit you missed is that it is one line of code to copy a status and
another to copy an Authorization or WWW-Authenticate header  :-)

> > and dictates various approaches to how one might go about extending
> > mod_python features without actually modifying mod_python.

I guess this looks the closest:

  http://issues.apache.org/jira/browse/MODPYTHON-165

However if I am having to go to the trouble of writing an Apache module
I may as well just write one that meets my needs exactly and ignore
mod_python  :-(

Roger
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)

iD8DBQFGRVr5mOOfHg372QQRAn6lAKDCnl4bR7eTgXLXKec/+pn6UC6xKACfRp6K
rqrz4heiawED4cRAQZOIqRk=
=qoF7
-----END PGP SIGNATURE-----
From graham.dumpleton at gmail.com  Sat May 12 02:13:20 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sat May 12 02:13:22 2007
Subject: [mod_python] dot dot in the url
In-Reply-To: <464554B7.90902@rogerbinns.com>
References: <46450CD9.2030105@rogerbinns.com>
	<88e286470705111813t61a0baddg426a9a02727f07d9@mail.gmail.com>
	<464554B7.90902@rogerbinns.com>
Message-ID: <88e286470705112313p14b4e95exa4feb04490616072@mail.gmail.com>

Someone who is more knowledgeable on this may want to comment, but the
RFC for what a URI is and how it should be interpreted gives special
meaning to '../' and './', and it specifically says how they are meant
to be deal with by a server before being interpreted. You appear to be
wanting to side step the RFC and ignore what the standard says and
have it interpreted your way which just seems wrong.

For example, the RFC says:

   The path segments "." and "..", also known as dot-segments, are
   defined for relative reference within the path name hierarchy.  They
   are intended for use at the beginning of a relative-path reference
   (Section 4.2) to indicate relative position within the hierarchical
   tree of names.  This is similar to their role within some operating
   systems' file directory structures to indicate the current directory
   and parent directory, respectively.  However, unlike in a file
   system, these dot-segments are only interpreted within the URI path
   hierarchy and are removed as part of the resolution process (Section
   5.2).

Note how it says that are removed as part of the resolution process.
It is the web server here that is doing the resolution process. Only
after that resolution process can it validly map it to a particular
handler. You only get the resolved path and that is how it is meant to
be.

For more details see:

  http://www.ietf.org/rfc/rfc2396.txt
  http://www.ietf.org/rfc/rfc3986.txt

You just seem to be going about this the wrong way. Why do you expect
a URI that resolves to be outside of the base URI for your handler to
still result in your handler being called? If it is important that it
isn't, you should be generating URIs that map to outside of your base
URI in the first place.

Graham

On 12/05/07, Roger Binns <rogerb@rogerbinns.com> wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> Graham Dumpleton wrote:
> > If your web browser doesn't normalise it
>
> I am sending requests from my test harness which does not do
> normalization.  In my case normalization effectively "corrupts" the data.
>
> > then Apache will. Such
> > normalisation will be done before it even gets to mod_python.
>
> req.uri is normalized but req.unparsed_uri is as originally sent by the
> client, so I use that.  The only remaining problem is that if the
> normalized uri doesn't reference my handler then it isn't called.
>
> <Location /api/v1/>
>  SetHandler python-program
>  PythonHandler restapiv1::RestAPIV1.RequestHandler
> </Location>
>
> So I get called for /api/v1/widget/a/b/c/d/../../e but not for
> /api/v1/widget/../../e/a/b/c/d
>
> > You state want you want to happen, but why exactly do you want to do
> > this in the first place? What is the underlying reason?
>
> Exactly as I said.  It is a rest service and the names of items appear
> as part of the URL.  eg You use PUT /api/v1/widget/foo to create a
> widget named foo, GET to query it, DELETE to delete it etc.
>
> But because of this normalization done by Apache before deciding which
> handler to call, that imposes an arbitrary constraint on names such that
> they can't have ../ sequences that get up before the /api/v1/.  The
> arbitrary constraint then has to be documented, tested, have friendly
> information in user interfaces etc.  It is an ugly wart and I was hoping
> it was unnecessary.
>
> Roger
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.6 (GNU/Linux)
>
> iD8DBQFGRVS3mOOfHg372QQRAulYAJ90JYiXJ+FSkQzJPNpdlTCFJFSYvgCfbzw4
> 1FKXPA+JqBzWAufEfSe13CA=
> =ZdiB
> -----END PGP SIGNATURE-----
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From rogerb at rogerbinns.com  Sat May 12 02:35:14 2007
From: rogerb at rogerbinns.com (Roger Binns)
Date: Sat May 12 02:35:16 2007
Subject: [mod_python] dot dot in the url
In-Reply-To: <88e286470705112313p14b4e95exa4feb04490616072@mail.gmail.com>
References: <46450CD9.2030105@rogerbinns.com>	
	<88e286470705111813t61a0baddg426a9a02727f07d9@mail.gmail.com>	
	<464554B7.90902@rogerbinns.com>
	<88e286470705112313p14b4e95exa4feb04490616072@mail.gmail.com>
Message-ID: <46456022.9050206@rogerbinns.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Graham Dumpleton wrote:
> You appear to be
> wanting to side step the RFC and ignore what the standard says and
> have it interpreted your way which just seems wrong.

The standard significantly predates things like REST and comes from the
days when web servers pretty much served up a content from a filesystem
with a cgi directory stuck on the side for dynamic things.

In my case, yes I do want want the URLs left untranslated when the
prefix indicates my REST service.

> Note how it says that are removed as part of the resolution process.

On Monday I'll investigate if I can prevent this happening by using a
PythonTransHandler or possibly the header handler if they get called
before the URI is munged.

> You just seem to be going about this the wrong way. Why do you expect
> a URI that resolves to be outside of the base URI for your handler to
> still result in your handler being called? 

It doesn't map outside.  The URI is /api/v1/widget/ followed by a name
but I need to find a way to tell Apache that the name portion really is
just a string literal and any ../ sequences are not attempts at relative
paths.

> If it is important that it
> isn't, you should be generating URIs that map to outside of your base
> URI in the first place.

Technically I am not generating them.  The user of my system causes them
to occur if they ever put ../ into the names of items.  They choose the
names.  I am not a fan of humans having to adapt to the idiosyncrasies
of computers.  It should be the other way round.

Roger

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)

iD8DBQFGRWAimOOfHg372QQRAumrAJ9DQcwz0ML9tBNnFHGNrxaTvusibQCgofFa
waKlh5jr/QoVZFMhlg+KFQA=
=t0ge
-----END PGP SIGNATURE-----
From graham.dumpleton at gmail.com  Sat May 12 02:47:32 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sat May 12 02:47:35 2007
Subject: [mod_python] lookup_uri
In-Reply-To: <46455AAB.7080708@rogerbinns.com>
References: <4644AF5E.1060504@rogerbinns.com>
	<88e286470705112109v3747493excb483e1b3c77144d@mail.gmail.com>
	<46455AAB.7080708@rogerbinns.com>
Message-ID: <88e286470705112347i9ce5b8eoa6e01339a45b630@mail.gmail.com>

See comments below.

On 12/05/07, Roger Binns <rogerb@rogerbinns.com> wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> Graham Dumpleton wrote:
> > You basically didn't want to agree and said:
> >
> > """That is the easy bit :-)  Just copying the authentication response
> > headers from /api will do the trick."""
> >
> > I still believe that you don't quite understand what would happen. Let
> > me see if I can explain it again in a way you can understand.
>
> I really do understand what I am talking about :-)  How about some
> config and code.
>
> <Location /api/v1/widget/>
>   <Limit GET>
>   Require group reader
>   </Limit>
> </Location>
>
> That ensures that Apache requires authentication for the rest service.
> Now this is my code in the handler for /admin which has no directive
> such as the above requiring authentication.
>
> def handler(req):
>    name="foo"
>    # Before generating this page, check they can get info widget
>    sub=req.lookup_method_uri("GET", "/api/v1/widget/"+name)
>    # Copy any authentication to subrequest
>    sub.headers_in["Authorization"]=req.headers_in["Authorization"]
>    # Run the subrequest
>    sub.run()
>    # Was authentication required?
>    if sub.status==401:
>       req.status=401
>
> req.headers_out["WWW-Authenticate"]=sub.headers_out["WWW-Authenticate"]
>       return apache.OK
>    if sub.status!=200:
>       req.status=sub.status
>       ... copy error message or something similar ...
>       return apache.OK

Note though that if using Apache properly, none of the above should be
in handler() in the first place and should be in the authenhandler or
authzhandlers phases instead.

>    # At this point we know that there is permission to read widget
>    ... generate page etc ...
>
> > First off, you said that /admin would have no AuthType/AuthName
> > directives covering that URL in the Apache configuration. Because of
> > this fact, the browser isn't going to be sending any authentication
> > information for that URL. Ie., there will be no Authorization header
> > available to the request handler for the /admin URL.
>
> That is correct.  But the subrequest would return 401 if authentication
> was required and that can be copied into the response for the request so
> the browser will then retry with credentials.
>
> > Your problem as you see it how to check those credentials. The real
> > problem at this point is where are you getting the credentials from if
> > the browser isn't going to send them.
>
> Well it would since I'd send them back from the subrequest as shown above.
>
> > You are skipping this important challenge step by
> > assuming the credentials will be there and simply moving to try and
> > validate them.
>
> Err no, the challenge step is there due to sending 401 and
> WWW-Authenticate header back to the original request.

And I did appreciate you might be doing that, but for the most obvious
cases, at that time I couldn't see the point. If you are going to do
that why not let Apache do all the authentication without this fiddle
and have the AuthType/AuthName/Require directives on /admin in the
first place since it is achieving exactly the same thing.

This is where what you were doing seemed to be getting messy for my
personal tastes in what simply appeared to be an attempt to avoid
duplicating some auth configuration in the Apache configuration files.

> > Where web applications, such as Trac, use a /login URL as a single
> > login point, once they have successfully logged in the user they then
> > use cookies to track the fact that the user is logged in.
>
> Yes.  But those applications also have to implement their own
> authorization system.  I intend to let apache do all that.  For example
> the administrator can do this in the configuration:
>
> <Location /api/v1/widget/>
>   <Limit GET>
>   Require group anyone
>   </Limit>
> </Location>
>
> <Location /api/v1/widget/>
>   <Limit DELETE>
>   Require group admins
>   </Limit>
> </Location>
>
> But then they can be more specific as well:
>
> <Location /api/v1/widget/thelab>
>   <Limit DELETE>
>   Require group labadmins
>   </Limit>
> </Location>

Which is all fine for your separate scripts which access just these
URLs. If your /admin URL needs to only access one of them just
duplicate the Apache auth configuration. If your /admin page needs to
check more than one then you are simply probably getting beyond what
the authorization directives of Apache are good for. You can only go
so far with what Apache directives give you. You may be better off
just doing it all in your own authenhandler and authzhandlers for
mod_python, you certainly shouldn't be trying to put authentication
and authorisation into the response handler phase as you are.

> > If you still disagree, and maybe I am missing something, by what
> > mechanism do you think the credentials will be available in the first
> > place?
>
> The bit you missed is that it is one line of code to copy a status and
> another to copy an Authorization or WWW-Authenticate header :-)
>
> > and dictates various approaches to how one might go about extending
> > mod_python features without actually modifying mod_python.
>
> I guess this looks the closest:
>
>   http://issues.apache.org/jira/browse/MODPYTHON-165
>
> However if I am having to go to the trouble of writing an Apache module
> I may as well just write one that meets my needs exactly and ignore
> mod_python :-(

And I'd probably agree on that last point as mod_python falls quite
short of being a true way of writing Apache modules but using Python
instead of C code and personally I don't see that it will ever be able
to do that. The problem is the way the code base is hand coded is in
the long term going to make it impractical to keep adhoc adding more
and more of the Apache and APR C interfaces especially as the mapping
is a direct mapping but a slight Pythonisation of it. Continually
extending mod_python in this way is certainly not something I am
interested in doing as it would be waste of time and too hard to look
after.

The only practical way of getting a complete Python binding for Apache
and APR C interfaces is to completely start over and use SWIG. At
least that way the bulk of the work is automated and it actually
becomes maintainable. I know SWIGing the interfaces isn't that hard as
I have done it to see what would be involved, just needed to go
through and deal with the special exceptions that require special
handling. Even then it is mostly useless in the context of mod_python
anyway and a whole new base level module for doing Python in Apache is
needed to support it. At this point there hasn't really been anyone
else seriously interested in going that path, at least not to extent
they appeared to be prepared to spend a great deal of time themselves
working on it.

Graham
From graham.dumpleton at gmail.com  Sat May 12 03:16:21 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sat May 12 03:16:24 2007
Subject: [mod_python] dot dot in the url
In-Reply-To: <46456022.9050206@rogerbinns.com>
References: <46450CD9.2030105@rogerbinns.com>
	<88e286470705111813t61a0baddg426a9a02727f07d9@mail.gmail.com>
	<464554B7.90902@rogerbinns.com>
	<88e286470705112313p14b4e95exa4feb04490616072@mail.gmail.com>
	<46456022.9050206@rogerbinns.com>
Message-ID: <88e286470705120016s4426cc02l7baa8cd4d74a8e3a@mail.gmail.com>

On 12/05/07, Roger Binns <rogerb@rogerbinns.com> wrote:
> > Note how it says that are removed as part of the resolution process.
>
> On Monday I'll investigate if I can prevent this happening by using a
> PythonTransHandler or possibly the header handler if they get called
> before the URI is munged.

Elimination of '..' and '.' elements in path is done before
translate_name handlers. I think the only way to do anything before
the point that the elements are eliminated in req.uri is using an
Apache quick_handler and that cannot be hooked using mod_python. But
then using a quick handler totally circumvents all the Apache phases
meaning you loose all the authentication stuff as well, thus not of
much use to you.

You can possibly rewrite req.filename in a translate_name handler with
bits from req.unparsed_uri but you would have to be sure you only do
it for your base URI which in itself may be hard to determine if it
has disappeared because of the path resolution.

BTW, how do other REST people address this problem? If it was such a
big issue I would have expected to hear other people asking similar
questions but there haven't been. Or do others simply ensure that they
put validators on data to prevent use of path elements that would
cause problems or map everything through IDs instead of using
arbitrary user input data?

Graham
From jpg at jgassociates.ca  Sat May 12 10:06:40 2007
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Sat May 12 10:06:24 2007
Subject: [mod_python] dot dot in the url
In-Reply-To: <46456022.9050206@rogerbinns.com>
References: <46450CD9.2030105@rogerbinns.com>		<88e286470705111813t61a0baddg426a9a02727f07d9@mail.gmail.com>		<464554B7.90902@rogerbinns.com>	<88e286470705112313p14b4e95exa4feb04490616072@mail.gmail.com>
	<46456022.9050206@rogerbinns.com>
Message-ID: <4645C9F0.1010008@jgassociates.ca>

Roger Binns wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
> 
> Graham Dumpleton wrote:
>> You appear to be
>> wanting to side step the RFC and ignore what the standard says and
>> have it interpreted your way which just seems wrong.
> 
> The standard significantly predates things like REST and comes from the
> days when web servers pretty much served up a content from a filesystem
> with a cgi directory stuck on the side for dynamic things.

I'm sorry, but that statement is just plain wrong.

REST is built *on* the RFC standards and in no way violates them. RFC 
3986 is dated January 2005, whereas the thesis first detailing REST was 
written in 2000. Interestingly, Roy Fielding wrote both of them (or was 
one of the contributors to the RFC at least). Roy also co-authoured RFC 
2396 dated August 1998, so his REST thesis is sandwiched between the 2 RFCs.

Roy is also the VP of the Apache httpd server project. I suspect that 
whatever Apache httpd does will be correct.

Your URL usage does bend the rules, so don't be surprised if it ends up 
being difficult or impossible to make it work the way you want.

Jim
From graham.dumpleton at gmail.com  Mon May 14 06:49:43 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon May 14 06:49:47 2007
Subject: [mod_python] import_module is case sensitive even if the OS isn't
In-Reply-To: <b26b30150705140324x50bc9ec5uc7518cc56304b93@mail.gmail.com>
References: <b26b30150705111347u2884083fo162c2cf9fc6809e6@mail.gmail.com>
	<88e286470705111706k165715baya8302f153d90cfd3@mail.gmail.com>
	<b26b30150705140324x50bc9ec5uc7518cc56304b93@mail.gmail.com>
Message-ID: <88e286470705140349m65aa11d6n42454c6d0608acb5@mail.gmail.com>

Anyone else got any comments on whether normcase() should be applied?
I'm don't use Windows so don't really know what is best.

---------- Forwarded message ----------
From: Simon Holness <simon.holness@gmail.com>
Date: 14-May-2007 20:24
Subject: Re: [mod_python] import_module is case sensitive even if the OS isn't
To: Graham Dumpleton <graham.dumpleton@gmail.com>


On 5/12/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> The _check_directory() method will also need to be changed in some way
> to ensure the integrity checks work also. Ie.
>
>     if directory in sys.path:
>
> need to change to:
>
>     if directory in map(os.path.normcase, sys.path):
>
> What happens though if Windows is being asked to mount a remote file
> system which is case sensitive and files were being loaded from there.
> Are files on such a file system seen as case sensitive. If they are
> then the changes can't be made. Can anyone comment on the remote file
> system example and how case is handled for files from that?

Windows copes really badly, is the short answer.
If you smb mount a case-sensitive filesystem and have a clash of paths
based on differeing case alone, windows will only (afaict) allow you
to navigate into the lowercase version.

E.g. if I mount
/work/test/file1
/work/Test/file2

I can never get windows to find file2 ... listing /work/Test gives file1.

> Also, are there any native file systems on Windows that are case
> sensitive. On Mac OS X the default file system is case insensitive,
> but one can use case sensitive local file systems as well.

How does normcase work in this situation?
I assume its behaviour is based on the sensitivity of the OS not the
filesystem in question? So for OS X I presume normcase leaves paths
unchanged?

> Finally, with such a change log messages and error pages are going to
> now show lower case paths which may confuse people if the original
> path used mixed case.

True. Only on case-insensitive OS's of course, where it shouldn't be a
real problem.

> It is because of these issues that I may have originally not applied
> os.path.normcase() to paths and basically taken the viewpoint that
> users should just get their paths consistent in the first place as too
> hard otherwise.

Fair point, but unfortunately paths aren't always constructed in
simple ways. For example, while windows is case-insensitive for path
navigation it is case sensitive for path generation and reporting. So
it's not a matter of the user being consistent with themselves, but
with the OS (and potentially any other libraries) they're using. In
the case I ran into, for example, I'd used lowercase for the drive
letter in one place and this differed from the upper case which
windows uses (from an auto-generated path I was using in a different
location). Luckily I was looking into the subject of module loading
and so noticed the path difference in the apache log notices, but I'd
guess most people wouldn't spot this easily.

I can certainly see your point. Maybe, if you're not keen on the code
change being made, just a documentation change to note that you must
be consistent with the OS with respect to case or it may load the same
file as multiple modules?

Cheers
Simon
From nlv11281 at natlab.research.philips.com  Mon May 14 09:20:24 2007
From: nlv11281 at natlab.research.philips.com (Mike Looijmans)
Date: Mon May 14 09:20:35 2007
Subject: [mod_python] import_module is case sensitive even if the OS isn't
In-Reply-To: <88e286470705140349m65aa11d6n42454c6d0608acb5@mail.gmail.com>
References: <b26b30150705111347u2884083fo162c2cf9fc6809e6@mail.gmail.com>	<88e286470705111706k165715baya8302f153d90cfd3@mail.gmail.com>	<b26b30150705140324x50bc9ec5uc7518cc56304b93@mail.gmail.com>
	<88e286470705140349m65aa11d6n42454c6d0608acb5@mail.gmail.com>
Message-ID: <46486218.8010103@natlab.research.philips.com>

There is a system call that discloses whether a file system is case sensitive or not. However, the 
problem is not trivial, as there may be links to other devices in the path. For example, 
C:\mnt\somedir might point to another drive with a case sensitive filesystem, which would make the 
"mnt" word case insensitive and the "somedir" word case sensitive. I doubt that the normcase() 
function can cope with that, but i did not even know of its existance up until now.

I'm using an ext2 filesystem under Windows 2000 on a harddisk, and that's local and case sensitive 
indeed.

Probably the safest thing is to open the file and ask whether it's the same file.

The same question then would apply to unix/linux systems, would you want the module loaded as 
"/real/path.py" to be considered the same module as "/softlink/path.py" ?

With all of that - i think it's reasonable to require the same module to be spelled the same way. 
The cure seems more harmful than the disease, since it allows the module importer to "see" through 
links and unexpectedly share globals in those modules.

--
Mike Looijmans
Philips Natlab / Topic Automation


Graham Dumpleton wrote:
> Anyone else got any comments on whether normcase() should be applied?
> I'm don't use Windows so don't really know what is best.
> 
> ---------- Forwarded message ----------
> From: Simon Holness <simon.holness@gmail.com>
> Date: 14-May-2007 20:24
> Subject: Re: [mod_python] import_module is case sensitive even if the OS 
> isn't
> To: Graham Dumpleton <graham.dumpleton@gmail.com>
> 
> 
> On 5/12/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> 
>> The _check_directory() method will also need to be changed in some way
>> to ensure the integrity checks work also. Ie.
>>
>>     if directory in sys.path:
>>
>> need to change to:
>>
>>     if directory in map(os.path.normcase, sys.path):
>>
>> What happens though if Windows is being asked to mount a remote file
>> system which is case sensitive and files were being loaded from there.
>> Are files on such a file system seen as case sensitive. If they are
>> then the changes can't be made. Can anyone comment on the remote file
>> system example and how case is handled for files from that?
> 
> 
> Windows copes really badly, is the short answer.
> If you smb mount a case-sensitive filesystem and have a clash of paths
> based on differeing case alone, windows will only (afaict) allow you
> to navigate into the lowercase version.
> 
> E.g. if I mount
> /work/test/file1
> /work/Test/file2
> 
> I can never get windows to find file2 ... listing /work/Test gives file1.
> 
>> Also, are there any native file systems on Windows that are case
>> sensitive. On Mac OS X the default file system is case insensitive,
>> but one can use case sensitive local file systems as well.
> 
> 
> How does normcase work in this situation?
> I assume its behaviour is based on the sensitivity of the OS not the
> filesystem in question? So for OS X I presume normcase leaves paths
> unchanged?
> 
>> Finally, with such a change log messages and error pages are going to
>> now show lower case paths which may confuse people if the original
>> path used mixed case.
> 
> 
> True. Only on case-insensitive OS's of course, where it shouldn't be a
> real problem.
> 
>> It is because of these issues that I may have originally not applied
>> os.path.normcase() to paths and basically taken the viewpoint that
>> users should just get their paths consistent in the first place as too
>> hard otherwise.
> 
> 
> Fair point, but unfortunately paths aren't always constructed in
> simple ways. For example, while windows is case-insensitive for path
> navigation it is case sensitive for path generation and reporting. So
> it's not a matter of the user being consistent with themselves, but
> with the OS (and potentially any other libraries) they're using. In
> the case I ran into, for example, I'd used lowercase for the drive
> letter in one place and this differed from the upper case which
> windows uses (from an auto-generated path I was using in a different
> location). Luckily I was looking into the subject of module loading
> and so noticed the path difference in the apache log notices, but I'd
> guess most people wouldn't spot this easily.
> 
> I can certainly see your point. Maybe, if you're not keen on the code
> change being made, just a documentation change to note that you must
> be consistent with the OS with respect to case or it may load the same
> file as multiple modules?
> 
> Cheers
> Simon
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 
> 
> 


From simon.holness at gmail.com  Mon May 14 10:09:18 2007
From: simon.holness at gmail.com (Simon Holness)
Date: Mon May 14 10:09:23 2007
Subject: [mod_python] import_module is case sensitive even if the OS isn't
In-Reply-To: <46486218.8010103@natlab.research.philips.com>
References: <b26b30150705111347u2884083fo162c2cf9fc6809e6@mail.gmail.com>
	<88e286470705111706k165715baya8302f153d90cfd3@mail.gmail.com>
	<b26b30150705140324x50bc9ec5uc7518cc56304b93@mail.gmail.com>
	<88e286470705140349m65aa11d6n42454c6d0608acb5@mail.gmail.com>
	<46486218.8010103@natlab.research.philips.com>
Message-ID: <b26b30150705140709o5221945fs8218a9fb5e7cd6a5@mail.gmail.com>

On 5/14/07, Mike Looijmans <nlv11281@natlab.research.philips.com> wrote:
> There is a system call that discloses whether a file system is case sensitive or not. However, the
> problem is not trivial, as there may be links to other devices in the path. For example,
> C:\mnt\somedir might point to another drive with a case sensitive filesystem, which would make the
> "mnt" word case insensitive and the "somedir" word case sensitive. I doubt that the normcase()
> function can cope with that, but i did not even know of its existance up until now.
>
> I'm using an ext2 filesystem under Windows 2000 on a harddisk, and that's local and case sensitive
> indeed.

Interesting. Have you looked at how normpath() and normcase() work?
I've not seen that used before - does windows behave 'correctly' wrt
case sensitivity? (i.e. rejecting paths which are case incorrect)?

> Probably the safest thing is to open the file and ask whether it's the same file.
>
> The same question then would apply to unix/linux systems, would you want the module loaded as
> "/real/path.py" to be considered the same module as "/softlink/path.py" ?
>
> With all of that - i think it's reasonable to require the same module to be spelled the same way.
> The cure seems more harmful than the disease, since it allows the module importer to "see" through
> links and unexpectedly share globals in those modules.

import already uses 'normpath()' so that paths do not have to be
identical. There is a cryptic comment in the os.path docs about
symlinks, too: "It should be understood that this may change the
meaning of the path if it contains symbolic links!", so I suspect that
this can of worms is already open (maybe entirely wrong - I don't know
enough about the subtleties of normpath/normcase).

normcase() could also be used just to produce the label used to key
the module within the cache, rather than performing the lookup / file
operations on a case-munged path. Thus file-system interraction (e.g.
using a case-sensitive file system where normcase doesn't expect it).

e.g.    label = self._module_label(os.path.normcase(file))

This use of normcase() would only "break" things if you were loading
modules from two paths which differed only by case (after a normpath()
operation, I think?) on an OS which is (normally) case insensitive,
which is a fairly pathological and ill-advised thing to be doing.

Having just looked at the code, all the os.path stuff is specific to
operating system - posix / NT / mac. I would assume that these
behaviours are also embedded pretty deeply elsewhere in python.

I'm just a little wary about having import_path silently deviate from
its stated behaviour ("distinguishing modules by location"). I was
watching imports carefully so spotted it, but I would imagine most
people would struggle to understand why "~/mymodule" and
"c:\mypath\mymodule" was causing the module to be loaded twice even
though it's in the same location.

Cheers
Simon
From rogerb at rogerbinns.com  Mon May 14 13:33:18 2007
From: rogerb at rogerbinns.com (Roger Binns)
Date: Mon May 14 13:33:21 2007
Subject: [mod_python] dot dot in the url
In-Reply-To: <4645C9F0.1010008@jgassociates.ca>
References: <46450CD9.2030105@rogerbinns.com>		<88e286470705111813t61a0baddg426a9a02727f07d9@mail.gmail.com>		<464554B7.90902@rogerbinns.com>	<88e286470705112313p14b4e95exa4feb04490616072@mail.gmail.com>
	<46456022.9050206@rogerbinns.com>
	<4645C9F0.1010008@jgassociates.ca>
Message-ID: <46489D5E.7070700@rogerbinns.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Jim Gallacher wrote:
> REST is built *on* the RFC standards and in no way violates them. RFC
> 3986 is dated January 2005, whereas the thesis first detailing REST was
> written in 2000. 

3986 builds on several previous RFCS which do predate REST.  URIs
existed long before REST as did standards specifying URIs.

> Your URL usage does bend the rules, so don't be surprised if it ends up
> being difficult or impossible to make it work the way you want.

REST has identifiers as part of the URL.  In most examples a number is
used because the underlying data is stored as a database and the number
corresponds to a primary key.  However there are many examples of
strings being used as well.  A consequence of the URI rules as done by
Apache is that those strings cannot contain /./ or /../ or start with ./
or ../

I'm just going to have to live with that since even though my code can
cope with them, Apache uses the processed URL for access control,
invoking handlers etc.

I'm left with two alternatives:

 - Outright ban those sequences in unique identifiers
 - Have some sort of escape sequence that allows them

I really hate edge cases like this.  They make software more arbitrary
and annoying.

Roger
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)

iD8DBQFGSJ1emOOfHg372QQRAopFAJ4lSb4Ehk4pikHEmmONeROd2KHRywCg0di3
oT1T5GjRWDUkyfsWuOcL/J0=
=MTts
-----END PGP SIGNATURE-----
From rogerb at rogerbinns.com  Mon May 14 14:05:42 2007
From: rogerb at rogerbinns.com (Roger Binns)
Date: Mon May 14 14:05:45 2007
Subject: [mod_python] lookup_uri
In-Reply-To: <88e286470705112347i9ce5b8eoa6e01339a45b630@mail.gmail.com>
References: <4644AF5E.1060504@rogerbinns.com>	
	<88e286470705112109v3747493excb483e1b3c77144d@mail.gmail.com>	
	<46455AAB.7080708@rogerbinns.com>
	<88e286470705112347i9ce5b8eoa6e01339a45b630@mail.gmail.com>
Message-ID: <4648A4F6.5030505@rogerbinns.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Graham Dumpleton wrote:
> Note though that if using Apache properly, none of the above should be
> in handler() in the first place and should be in the authenhandler or
> authzhandlers phases instead.

Thank you for the reminder!

> And I did appreciate you might be doing that, but for the most obvious
> cases, at that time I couldn't see the point. If you are going to do
> that why not let Apache do all the authentication without this fiddle
> and have the AuthType/AuthName/Require directives on /admin in the
> first place since it is achieving exactly the same thing.

The rest api looks like this:

<Location /api/v1/widget><Limit GET> ... require stuff
<Location /api/v1/widget><Limit PUT DELETE POST> ... require stuff
<Location /api/v1/foo><Limit GET> ... require stuff
<Location /api/v1/foo><Limit PUT DELETE POST> ... require stuff
<Location /api/v1/bar><Limit GET> ... require stuff
<Location /api/v1/bar><Limit PUT DELETE POST> ... require stuff

ie the administrator can decide who can do what to which object.  They
have all the relevant apache modules at their disposal including things
like IP address based control.

For /admin I have a web based admin interface and want to generate a
page.  For the sake of argument, lets say that to generate a page I need
to GET a widget and DELETE a foo.  Using subrequests I can actually do
that and relevant requests get denied base on the access control rules
above.

It it is pretty much impossible to duplicate that fine grained access
control on the /admin location.  Instead I'd have to settle for access
or no access.

> This is where what you were doing seemed to be getting messy for my
> personal tastes in what simply appeared to be an attempt to avoid
> duplicating some auth configuration in the Apache configuration files.

I'd be happy duplicating if that were even possible!  Because the /admin
performs composite actions, it can't be done.

> If your /admin page needs to
> check more than one then you are simply probably getting beyond what
> the authorization directives of Apache are good for. 

As far as I can tell subrequests would do the job perfectly.  This link
even describes exactly what I want to use them for!

http://perl.apache.org/docs/1.0/api/Apache.html#Sub_Requests

"Apache provides a sub-request mechanism to lookup a uri or filename,
performing all access checks, etc., without actually running the
response phase of the given request."

> You can only go
> so far with what Apache directives give you. You may be better off
> just doing it all in your own authenhandler and authzhandlers for
> mod_python, you certainly shouldn't be trying to put authentication
> and authorisation into the response handler phase as you are.

Yes, you are right that authentication stuff should be generated and
processed in the appropriate phase :-)

> And I'd probably agree on that last point as mod_python falls quite
> short of being a true way of writing Apache modules but using Python
> instead of C code

Fortunately I am using such a trivial amount of mod_python that my own C
code apache module to call my own Python code isn't too onerous.

> The only practical way of getting a complete Python binding for Apache
> and APR C interfaces is to completely start over and use SWIG. 

It looked like modperl used SWIG so in theory their .i file could be
swiped as a starting point.

> Even then it is mostly useless in the context of mod_python
> anyway and a whole new base level module for doing Python in Apache is
> needed to support it. At this point there hasn't really been anyone
> else seriously interested in going that path, at least not to extent
> they appeared to be prepared to spend a great deal of time themselves
> working on it.

Have you tried asking the Perl folks since they are already maintaining
a swig'ed interface.  It may not be that much incremental work to add
python.

Roger
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)

iD8DBQFGSKT2mOOfHg372QQRAkF8AJ4j9dqlgH5vvqdDBcvz1sgPy0JdSQCg4yAq
vdezCavW6WqceBlUKs8URzk=
=PIhM
-----END PGP SIGNATURE-----
From ccbean at gmail.com  Mon May 14 14:10:10 2007
From: ccbean at gmail.com (Colin Bean)
Date: Mon May 14 14:10:14 2007
Subject: [mod_python] dot dot in the url
In-Reply-To: <46489D5E.7070700@rogerbinns.com>
References: <46450CD9.2030105@rogerbinns.com>
	<88e286470705111813t61a0baddg426a9a02727f07d9@mail.gmail.com>
	<464554B7.90902@rogerbinns.com>
	<88e286470705112313p14b4e95exa4feb04490616072@mail.gmail.com>
	<46456022.9050206@rogerbinns.com> <4645C9F0.1010008@jgassociates.ca>
	<46489D5E.7070700@rogerbinns.com>
Message-ID: <29a6ca010705141110r67172700y148e720cdc75c498@mail.gmail.com>

Have you considered base64 encoding the path data you want sent as a
parameter?  Might make your application harder to use, but you could
send whatever you wanted as a parameter without involving apache's url
processing rules.

Colin


On 5/14/07, Roger Binns <rogerb@rogerbinns.com> wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> Jim Gallacher wrote:
> > REST is built *on* the RFC standards and in no way violates them. RFC
> > 3986 is dated January 2005, whereas the thesis first detailing REST was
> > written in 2000.
>
> 3986 builds on several previous RFCS which do predate REST.  URIs
> existed long before REST as did standards specifying URIs.
>
> > Your URL usage does bend the rules, so don't be surprised if it ends up
> > being difficult or impossible to make it work the way you want.
>
> REST has identifiers as part of the URL.  In most examples a number is
> used because the underlying data is stored as a database and the number
> corresponds to a primary key.  However there are many examples of
> strings being used as well.  A consequence of the URI rules as done by
> Apache is that those strings cannot contain /./ or /../ or start with ./
> or ../
>
> I'm just going to have to live with that since even though my code can
> cope with them, Apache uses the processed URL for access control,
> invoking handlers etc.
>
> I'm left with two alternatives:
>
>  - Outright ban those sequences in unique identifiers
>  - Have some sort of escape sequence that allows them
>
> I really hate edge cases like this.  They make software more arbitrary
> and annoying.
>
> Roger
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.6 (GNU/Linux)
>
> iD8DBQFGSJ1emOOfHg372QQRAopFAJ4lSb4Ehk4pikHEmmONeROd2KHRywCg0di3
> oT1T5GjRWDUkyfsWuOcL/J0=
> =MTts
> -----END PGP SIGNATURE-----
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From rogerb at rogerbinns.com  Mon May 14 14:32:09 2007
From: rogerb at rogerbinns.com (Roger Binns)
Date: Mon May 14 14:32:14 2007
Subject: [mod_python] dot dot in the url
In-Reply-To: <29a6ca010705141110r67172700y148e720cdc75c498@mail.gmail.com>
References: <46450CD9.2030105@rogerbinns.com>	
	<88e286470705111813t61a0baddg426a9a02727f07d9@mail.gmail.com>	
	<464554B7.90902@rogerbinns.com>	
	<88e286470705112313p14b4e95exa4feb04490616072@mail.gmail.com>	
	<46456022.9050206@rogerbinns.com>
	<4645C9F0.1010008@jgassociates.ca>	
	<46489D5E.7070700@rogerbinns.com>
	<29a6ca010705141110r67172700y148e720cdc75c498@mail.gmail.com>
Message-ID: <4648AB29.60001@rogerbinns.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Colin Bean wrote:
> Have you considered base64 encoding the path data you want sent as a
> parameter?  Might make your application harder to use, but you could
> send whatever you wanted as a parameter without involving apache's url
> processing rules.

Yes, that falls under "Have some sort of escape sequence that allows them"

/./ and /../ are going to be the uncommon case so I'll either ban them
outright or think of something that only requires them to be escaped
rather than the whole string which is what base64 does.  Unfortunately
the obvious use of \ is taken since is the path separator under Windows
and it gets treated similarly to /.  Something like tilde would work
although that now makes two special cases for people have to worry about
(the /../ and tilde).

Roger
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)

iD8DBQFGSKspmOOfHg372QQRApYIAKCx8UaUGwwDkJKsqkK8rDNWxmU/KwCgr1T8
HlEVETadxhw9xITlWrxSys0=
=jWEQ
-----END PGP SIGNATURE-----
From ccbean at gmail.com  Mon May 14 15:20:24 2007
From: ccbean at gmail.com (Colin Bean)
Date: Mon May 14 15:20:28 2007
Subject: [mod_python] dot dot in the url
In-Reply-To: <4648AB29.60001@rogerbinns.com>
References: <46450CD9.2030105@rogerbinns.com>
	<88e286470705111813t61a0baddg426a9a02727f07d9@mail.gmail.com>
	<464554B7.90902@rogerbinns.com>
	<88e286470705112313p14b4e95exa4feb04490616072@mail.gmail.com>
	<46456022.9050206@rogerbinns.com> <4645C9F0.1010008@jgassociates.ca>
	<46489D5E.7070700@rogerbinns.com>
	<29a6ca010705141110r67172700y148e720cdc75c498@mail.gmail.com>
	<4648AB29.60001@rogerbinns.com>
Message-ID: <29a6ca010705141220w77a7e45fq6e36de03dcf6f4e9@mail.gmail.com>

On 5/14/07, Roger Binns <rogerb@rogerbinns.com> wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> Colin Bean wrote:
> > Have you considered base64 encoding the path data you want sent as a
> > parameter?  Might make your application harder to use, but you could
> > send whatever you wanted as a parameter without involving apache's url
> > processing rules.
>
> Yes, that falls under "Have some sort of escape sequence that allows them"

Sort of... I'd consider encoding the entire path a different solution
to escaping specific problem characters (and you make this distinction
below).  Base64 encoding would also handle more than just the /./ and
/../ problem cases, it would handle any other url-unfriendly
characters that appear in your book titles ('#' and foreign language
characters come to mind, although you could still escape / url encode
those).

Anyway, just my $0.02

>
> /./ and /../ are going to be the uncommon case so I'll either ban them
> outright or think of something that only requires them to be escaped
> rather than the whole string which is what base64 does.  Unfortunately
> the obvious use of \ is taken since is the path separator under Windows
> and it gets treated similarly to /.  Something like tilde would work
> although that now makes two special cases for people have to worry about
> (the /../ and tilde).
>
> Roger
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.6 (GNU/Linux)
>
> iD8DBQFGSKspmOOfHg372QQRApYIAKCx8UaUGwwDkJKsqkK8rDNWxmU/KwCgr1T8
> HlEVETadxhw9xITlWrxSys0=
> =jWEQ
> -----END PGP SIGNATURE-----
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From rogerb at rogerbinns.com  Mon May 14 17:45:51 2007
From: rogerb at rogerbinns.com (Roger Binns)
Date: Mon May 14 17:45:53 2007
Subject: [mod_python] dot dot in the url
In-Reply-To: <29a6ca010705141220w77a7e45fq6e36de03dcf6f4e9@mail.gmail.com>
References: <46450CD9.2030105@rogerbinns.com>	
	<88e286470705111813t61a0baddg426a9a02727f07d9@mail.gmail.com>	
	<464554B7.90902@rogerbinns.com>	
	<88e286470705112313p14b4e95exa4feb04490616072@mail.gmail.com>	
	<46456022.9050206@rogerbinns.com>
	<4645C9F0.1010008@jgassociates.ca>	
	<46489D5E.7070700@rogerbinns.com>	
	<29a6ca010705141110r67172700y148e720cdc75c498@mail.gmail.com>	
	<4648AB29.60001@rogerbinns.com>
	<29a6ca010705141220w77a7e45fq6e36de03dcf6f4e9@mail.gmail.com>
Message-ID: <4648D88F.5000804@rogerbinns.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Colin Bean wrote:
>> Sort of... I'd consider encoding the entire path a different solution
>> to escaping specific problem characters (and you make this distinction
>> below).  Base64 encoding would also handle more than just the /./ and
>> /../ problem cases, it would handle any other url-unfriendly
>> characters that appear in your book titles ('#' and foreign language
>> characters come to mind, although you could still escape / url encode
>> those).

All those characters are url encoded(*).  The foreign characters are
dealt with by making the url be utf8 encoded.  You do get the raw bytes
from the utf8 % encoded and it all works fine (I have extensive test
suites).

My top tip for that kind of testing is to go to wikipedia.org and copy
all the text on the front page to use as your test string.  You get a
lot of characters, right to left text and codepoints above 0xffff all at
once.

(*) The URL encoding of / or . doesn't help as Apache unescapes it
before normalization etc.

Roger
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)

iD8DBQFGSNiPmOOfHg372QQRAuZyAJ9tgzgRYxVNvU5JKI6EN5K4HNFfHwCfXLm/
9TijtzxrFguex9LeexDK25k=
=OTnc
-----END PGP SIGNATURE-----
From rpgrob at hispeed.ch  Mon May 14 18:07:51 2007
From: rpgrob at hispeed.ch (=?ISO-8859-1?Q?Ren=E9_Grob?=)
Date: Mon May 14 18:07:54 2007
Subject: [mod_python] Python Debugger doesn't start in Mod_Python
In-Reply-To: <88e286470705101504y7d5c7538p82f3a1c19543cf53@mail.gmail.com>
References: <46437322.5050600@hispeed.ch>	
	<88e286470705101429k111c5b4ay8ee2ccbd4149ada9@mail.gmail.com>
	<88e286470705101504y7d5c7538p82f3a1c19543cf53@mail.gmail.com>
Message-ID: <4648DDB7.10108@hispeed.ch>

Graham Dumpleton schrieb:
> BTW, a couple of things to try.
>
> 1. See if running httpd with options '-X -DONE_PROCESS' makes a 
> difference.
>
> 2. See if you can arrange for environment variable called
> 'AP_PARENT_PID' to be set to '0' in the environment that the httpd
> process is running so as to stop mod_python avoiding its
> initialisation step. Am not sure what magic is required on Windows to
> set environment variables.
>
> Graham
>
> On 11/05/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
>> I suspect it is because of this change being made:
>>
>>   http://issues.apache.org/jira/browse/MODPYTHON-195
>>
>> I had been recently wondering whether the change would upset single
>> process debugging.
>>
>> As it is, the issue has had to be reopened because it causes another
>> minor nuisance issue with version information for Python/mod_python
>> not being displayed.
>>
>> Do you have the ability to compile mod_python from source code
>> yourself and thereby remove the change described in that issue and see
>> if it then works?
>>
>> It still may be the case however that single process debugging has
>> never worked on Windows for one reason or another since people so
>> rarely use it.
>>
>> Graham
>>
>> On 11/05/07, Ren? Grob <rpgrob@hispeed.ch> wrote:
>> > Since my small intranet application keeps getting more complex I tried
>> > to fix some bugs using the Python Debugger. According to the 
>> Mod_python
>> > manual I added the "PythonEnablePdb On" directive into the directory
>> > context of my Python application and started httpd from the command 
>> line
>> > with the option -DONE_PROCESS (after stopping httpd first, of course).
>> > But Apache didn't start and an error window occurred instead 
>> showing the
>> > following message:
>> >
>> > "Runtime Error! Program: <Apache path>\httpd.exe. This application has
>> > requested the Runtime to terminate it in an unusual way. Please 
>> contact
>> > the applications's support team for more information".
>> >
>> > I'm using the following prebuilt binaries on Win2k SP4:
>> >
>> > mod_python-3.3.1.win32-py2.5-Apache2.2.exe
>> > python-2.5.msi
>> > apache_2.2.4-win32-x86-no_ssl.msi
>> >
>> > When Apache is started with the option -DONE_PROCESS but without
>> > Mod_python there is no error and no Mod_python either (of course). 
>> On a
>> > different machine with WinXP SP2, Apache 2.2.3, Python 2.4.3 and
>> > Mod_python 2.7.10 the debugger works as expected.
>> >
>> > Does anyone have an idea how to fix this?
>> >
>> > Thanks
>> >
>> > Ren?
>> >
>> > _______________________________________________
>> > Mod_python mailing list
>> > Mod_python@modpython.org
>> > http://mailman.modpython.org/mailman/listinfo/mod_python
>> >
>>
>
Dear Graham

Thanks for your immediate answer. Your first suggestion, to recompile 
Modpython with the indicated corrections will probably

be the best. But unfortunately I do not have a Microsoft compiler in my 
box. Does anybody know wether I can use the freely

downloadable C++ 'express' version for this?

So I tried out your second suggestions: Starting httpd with the '-X 
-DONE_PROCESS' option results in the same runtime error.

The same happens when I add the '-X' option alone. After setting the 
environment variable AP_PARENT_PID to 0 (which is really

no magic: simply type 'set AP_PARENT_PID=0' <enter> at the command line 
[without the quotes]) strange things happen. Apache

aborts with the following error:

'httpd: Could not open configuration file /apache/conf/httpd.conf: The 
system cannot find the indicated path'

This is independent of wether I add the '-DONE_PROCESS' and/or the '-X' 
option or none at all.
 
After adding the option '-f <path to httpd.conf>/httpd.conf' Apache 
seems to start but the shell returns to the prompt after a

second without any error message. Looking up the process list doesn't 
show any httpd running. So I had a look at the error.log

where I found the following messages:

[Mon May 14 23:20:31 2007] [notice] mod_python: Creating 8 session 
mutexes based on 0 max processes and 250 max threads.
[Mon May 14 23:20:31 2007] [notice] Child 2176: Child process is running
[Mon May 14 23:20:31 2007] [crit] (OS 6)Invalid Handle.  : Child 2176: 
Unable to retrieve the ready event from the parent

With the '-DONE_PROCESS'and/or '-X' option it looks a bit different but 
essentially with the same result:

[Mon May 14 23:28:05 2007] [notice] mod_python: Creating 8 session 
mutexes based on 0 max processes and 250 max threads.
[Mon May 14 23:28:06 2007] [notice] Child 1084: Child process is running
[Mon May 14 23:28:06 2007] [notice] Child 1084: Acquired the start mutex.
[Mon May 14 23:28:06 2007] [notice] Child 1084: Starting 250 worker threads.
[Mon May 14 23:28:06 2007] [crit] (OS 6)Invalid Handle.  : Child 1084: 
WAIT_FAILED -- shutting down server
[Mon May 14 23:28:06 2007] [notice] Child 1084: Starting thread to 
listen on port 80.
[Mon May 14 23:28:07 2007] [notice] Child 1084: Released the start mutex
[Mon May 14 23:28:08 2007] [notice] Child 1084: Waiting for 250 worker 
threads to exit.
[Mon May 14 23:28:08 2007] [notice] Child 1084: All worker threads have 
exited.
[Mon May 14 23:28:08 2007] [notice] Child 1084: Child process is exiting


By the way I tried to start the debugger on a different installation 
with Apache 2.2.3, Modpython 3.2.10 and Python 2.43 on

WinXPSP2. It worked just as expected. The same was true for an older 
installation using Apache 2.0.52, Modpython 3.1.3 and

Python 2.3.4 on WinXPSP1. So the 'problem' must have been introduced 
very recently...(I'm sorry I mixed up the version number

of Modpython in the first post: I didn't test Modpython 2.7.10).

This additional information probably supports your hypothesis that the 
problem is related to

http://issues.apache.org/jira/browse/MODPYTHON-195 doesn't it?

Ren?
From hvdtoorn at gmail.com  Mon May 14 19:38:58 2007
From: hvdtoorn at gmail.com (Henk van den Toorn)
Date: Mon May 14 19:39:00 2007
Subject: [mod_python] compile on 64-bit windows server 2003
Message-ID: <588860ab0705141638g73f5fabek3ef3a303610ebde4@mail.gmail.com>

Hello, people!

I'm very much interested in building the latest (3.3.1) version of
mod_python on a 64-bit server (win2003). I have gotten the sources from
the download pages and the source for apache httpd as well (it seems
like you need that in order to find the httpd.h files and more)

Does anybody have experience doing this? Or can the way to address this
problem be found somewhere on the internet? I've searched everywhere but
I cannot find anything how to do this and all build attempts fail.

Thanks in advance! Greetings, Henk
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070515/c0795e7d/attachment.html
From graham.dumpleton at gmail.com  Mon May 14 19:55:41 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon May 14 19:55:44 2007
Subject: [mod_python] compile on 64-bit windows server 2003
In-Reply-To: <588860ab0705141638g73f5fabek3ef3a303610ebde4@mail.gmail.com>
References: <588860ab0705141638g73f5fabek3ef3a303610ebde4@mail.gmail.com>
Message-ID: <88e286470705141655w67d3e8d3sfa1ff77c27acdb2c@mail.gmail.com>

Did you find these instructions.

  http://www.modpython.org/pipermail/mod_python/2006-September/022092.html

I'm not a Windows person so cant help, but if you try these
instructions and report back what the problems are then others here
probably can help.

Graham

On 15/05/07, Henk van den Toorn <hvdtoorn@gmail.com> wrote:
> Hello, people!
>
> I'm very much interested in building the latest (3.3.1) version of
> mod_python on a 64-bit server (win2003). I have gotten the sources from
> the download pages and the source for apache httpd as well (it seems
> like you need that in order to find the httpd.h files and more)
>
> Does anybody have experience doing this? Or can the way to address this
> problem be found somewhere on the internet? I've searched everywhere but
> I cannot find anything how to do this and all build attempts fail.
>
> Thanks in advance! Greetings, Henk
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
From graham.dumpleton at gmail.com  Mon May 14 20:11:12 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon May 14 20:11:15 2007
Subject: [mod_python] lookup_uri
In-Reply-To: <4648A4F6.5030505@rogerbinns.com>
References: <4644AF5E.1060504@rogerbinns.com>
	<88e286470705112109v3747493excb483e1b3c77144d@mail.gmail.com>
	<46455AAB.7080708@rogerbinns.com>
	<88e286470705112347i9ce5b8eoa6e01339a45b630@mail.gmail.com>
	<4648A4F6.5030505@rogerbinns.com>
Message-ID: <88e286470705141711o528211bcx5cc90dda69be7ba4@mail.gmail.com>

On 15/05/07, Roger Binns <rogerb@rogerbinns.com> wrote:
> Fortunately I am using such a trivial amount of mod_python that my own C
> code apache module to call my own Python code isn't too onerous.
>
> > The only practical way of getting a complete Python binding for Apache
> > and APR C interfaces is to completely start over and use SWIG.
>
> It looked like modperl used SWIG so in theory their .i file could be
> swiped as a starting point.
>
> > Even then it is mostly useless in the context of mod_python
> > anyway and a whole new base level module for doing Python in Apache is
> > needed to support it. At this point there hasn't really been anyone
> > else seriously interested in going that path, at least not to extent
> > they appeared to be prepared to spend a great deal of time themselves
> > working on it.
>
> Have you tried asking the Perl folks since they are already maintaining
> a swig'ed interface.  It may not be that much incremental work to add
> python.

Last time I looked Perl doesn't use SWIG. Instead they use their own
system of creating the wrappers in some sort of automated way. What
are you looking at that makes you believe they use SWIG?

The only reference to SWIG in all the source code is:

"""The mod_perl 2.0 generator is a custom suite of modules specifically
tuned for gluing Apache and allows for complete control over
everything, providing many possibilities none of xsubpp, SWIG
or Inline.pm are designed to do.  Advantages to generating the glue
code include:"""

Which to me reads in part as saying why their way of doing things is
better than what could be achieved using SWIG.

Graham
From graham.dumpleton at gmail.com  Mon May 14 20:24:10 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon May 14 20:24:13 2007
Subject: [mod_python] import_module is case sensitive even if the OS isn't
In-Reply-To: <b26b30150705140709o5221945fs8218a9fb5e7cd6a5@mail.gmail.com>
References: <b26b30150705111347u2884083fo162c2cf9fc6809e6@mail.gmail.com>
	<88e286470705111706k165715baya8302f153d90cfd3@mail.gmail.com>
	<b26b30150705140324x50bc9ec5uc7518cc56304b93@mail.gmail.com>
	<88e286470705140349m65aa11d6n42454c6d0608acb5@mail.gmail.com>
	<46486218.8010103@natlab.research.philips.com>
	<b26b30150705140709o5221945fs8218a9fb5e7cd6a5@mail.gmail.com>
Message-ID: <88e286470705141724v6b86c35x51271ac30cd52f13@mail.gmail.com>

On 15/05/07, Simon Holness <simon.holness@gmail.com> wrote:
> normcase() could also be used just to produce the label used to key
> the module within the cache, rather than performing the lookup / file
> operations on a case-munged path. Thus file-system interraction (e.g.
> using a case-sensitive file system where normcase doesn't expect it).
>
> e.g.    label = self._module_label(os.path.normcase(file))

This is the change I was thinking of rather than change the full path
name itself. That way any error messages at the time will be what the
user used. The only thing which would show as different would be the
__file__ attribute in the module may use different case to what you
might originally have used when two different places use versions of
path which differ by case.

> This use of normcase() would only "break" things if you were loading
> modules from two paths which differed only by case (after a normpath()
> operation, I think?) on an OS which is (normally) case insensitive,
> which is a fairly pathological and ill-advised thing to be doing.

All equivalence checks in the cache are done by the label and not the
path, so I don't see any cases where doing this would be a problem.

> Having just looked at the code, all the os.path stuff is specific to
> operating system - posix / NT / mac. I would assume that these
> behaviours are also embedded pretty deeply elsewhere in python.
>
> I'm just a little wary about having import_path silently deviate from
> its stated behaviour ("distinguishing modules by location").

One can still get unexpected behaviour if there are symlinks. One
could also apply os.path.realpath() to eliminate symlink issues on
platforms which support them, but this would slow things down further.
Also would break code where code assumes it can use
os.path.dirname(__file__) to determine a bas directory as the real
file can be in a totally different location. Thus why I don't try and
load just one module instance where multiple symlinks point to one
physical file.

> I was
> watching imports carefully so spotted it, but I would imagine most
> people would struggle to understand why "~/mymodule" and
> "c:\mypath\mymodule" was causing the module to be loaded twice even
> though it's in the same location.

What are you expecting '~/' to resolve to? In the mod_python module
importer '~/' is resolved to be the directory the handler was
designated for. It should replace the '~/' with the actual value and
if that happened to be 'c:/mypath', the final path should be the same
and there should only be one module loaded, not two. Thus if you are
seeing two modules may be a bug.

Graham
From graham.dumpleton at gmail.com  Mon May 14 20:33:15 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon May 14 20:33:20 2007
Subject: [mod_python] Python Debugger doesn't start in Mod_Python
In-Reply-To: <4648DDB7.10108@hispeed.ch>
References: <46437322.5050600@hispeed.ch>
	<88e286470705101429k111c5b4ay8ee2ccbd4149ada9@mail.gmail.com>
	<88e286470705101504y7d5c7538p82f3a1c19543cf53@mail.gmail.com>
	<4648DDB7.10108@hispeed.ch>
Message-ID: <88e286470705141733n2a040d7l11ace00ff9fca5a9@mail.gmail.com>

Did half suspect that setting AP_PARENT_ID may screw up other things. :-(

And yes your feedback does suggest that the AP_PARENT_ID change in the
code needs to be undone. I hope that Jeff Robins who originally
suggested the change is noting this conversation. :-)

What really needs to be done is for the mod_python parent process
initialisation to be completely rewritten so that it properly destroys
the Python interpreter and the global mutex locks it creates when
appropriate Apache memory pool is destroyed so that when an Apache
restart is done that everything is undone and memory reclaimed. On the
reinitialisation mod_python would then do everything over again
instead of skipping it because of Python already being initialised.
Does also means that one can't skip initialising the interpreter in
the main process on Windows even if redundant on that platform for
normal case. Luckily I have been through working out what needs to be
done in doing all this stuff properly for mod_wsgi.

Graham

On 15/05/07, Ren? Grob <rpgrob@hispeed.ch> wrote:
> Graham Dumpleton schrieb:
> > BTW, a couple of things to try.
> >
> > 1. See if running httpd with options '-X -DONE_PROCESS' makes a
> > difference.
> >
> > 2. See if you can arrange for environment variable called
> > 'AP_PARENT_PID' to be set to '0' in the environment that the httpd
> > process is running so as to stop mod_python avoiding its
> > initialisation step. Am not sure what magic is required on Windows to
> > set environment variables.
> >
> > Graham
> >
> > On 11/05/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> >> I suspect it is because of this change being made:
> >>
> >>   http://issues.apache.org/jira/browse/MODPYTHON-195
> >>
> >> I had been recently wondering whether the change would upset single
> >> process debugging.
> >>
> >> As it is, the issue has had to be reopened because it causes another
> >> minor nuisance issue with version information for Python/mod_python
> >> not being displayed.
> >>
> >> Do you have the ability to compile mod_python from source code
> >> yourself and thereby remove the change described in that issue and see
> >> if it then works?
> >>
> >> It still may be the case however that single process debugging has
> >> never worked on Windows for one reason or another since people so
> >> rarely use it.
> >>
> >> Graham
> >>
> >> On 11/05/07, Ren? Grob <rpgrob@hispeed.ch> wrote:
> >> > Since my small intranet application keeps getting more complex I tried
> >> > to fix some bugs using the Python Debugger. According to the
> >> Mod_python
> >> > manual I added the "PythonEnablePdb On" directive into the directory
> >> > context of my Python application and started httpd from the command
> >> line
> >> > with the option -DONE_PROCESS (after stopping httpd first, of course).
> >> > But Apache didn't start and an error window occurred instead
> >> showing the
> >> > following message:
> >> >
> >> > "Runtime Error! Program: <Apache path>\httpd.exe. This application has
> >> > requested the Runtime to terminate it in an unusual way. Please
> >> contact
> >> > the applications's support team for more information".
> >> >
> >> > I'm using the following prebuilt binaries on Win2k SP4:
> >> >
> >> > mod_python-3.3.1.win32-py2.5-Apache2.2.exe
> >> > python-2.5.msi
> >> > apache_2.2.4-win32-x86-no_ssl.msi
> >> >
> >> > When Apache is started with the option -DONE_PROCESS but without
> >> > Mod_python there is no error and no Mod_python either (of course).
> >> On a
> >> > different machine with WinXP SP2, Apache 2.2.3, Python 2.4.3 and
> >> > Mod_python 2.7.10 the debugger works as expected.
> >> >
> >> > Does anyone have an idea how to fix this?
> >> >
> >> > Thanks
> >> >
> >> > Ren?
> >> >
> >> > _______________________________________________
> >> > Mod_python mailing list
> >> > Mod_python@modpython.org
> >> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >> >
> >>
> >
> Dear Graham
>
> Thanks for your immediate answer. Your first suggestion, to recompile
> Modpython with the indicated corrections will probably
>
> be the best. But unfortunately I do not have a Microsoft compiler in my
> box. Does anybody know wether I can use the freely
>
> downloadable C++ 'express' version for this?
>
> So I tried out your second suggestions: Starting httpd with the '-X
> -DONE_PROCESS' option results in the same runtime error.
>
> The same happens when I add the '-X' option alone. After setting the
> environment variable AP_PARENT_PID to 0 (which is really
>
> no magic: simply type 'set AP_PARENT_PID=0' <enter> at the command line
> [without the quotes]) strange things happen. Apache
>
> aborts with the following error:
>
> 'httpd: Could not open configuration file /apache/conf/httpd.conf: The
> system cannot find the indicated path'
>
> This is independent of wether I add the '-DONE_PROCESS' and/or the '-X'
> option or none at all.
>
> After adding the option '-f <path to httpd.conf>/httpd.conf' Apache
> seems to start but the shell returns to the prompt after a
>
> second without any error message. Looking up the process list doesn't
> show any httpd running. So I had a look at the error.log
>
> where I found the following messages:
>
> [Mon May 14 23:20:31 2007] [notice] mod_python: Creating 8 session
> mutexes based on 0 max processes and 250 max threads.
> [Mon May 14 23:20:31 2007] [notice] Child 2176: Child process is running
> [Mon May 14 23:20:31 2007] [crit] (OS 6)Invalid Handle.  : Child 2176:
> Unable to retrieve the ready event from the parent
>
> With the '-DONE_PROCESS'and/or '-X' option it looks a bit different but
> essentially with the same result:
>
> [Mon May 14 23:28:05 2007] [notice] mod_python: Creating 8 session
> mutexes based on 0 max processes and 250 max threads.
> [Mon May 14 23:28:06 2007] [notice] Child 1084: Child process is running
> [Mon May 14 23:28:06 2007] [notice] Child 1084: Acquired the start mutex.
> [Mon May 14 23:28:06 2007] [notice] Child 1084: Starting 250 worker threads.
> [Mon May 14 23:28:06 2007] [crit] (OS 6)Invalid Handle.  : Child 1084:
> WAIT_FAILED -- shutting down server
> [Mon May 14 23:28:06 2007] [notice] Child 1084: Starting thread to
> listen on port 80.
> [Mon May 14 23:28:07 2007] [notice] Child 1084: Released the start mutex
> [Mon May 14 23:28:08 2007] [notice] Child 1084: Waiting for 250 worker
> threads to exit.
> [Mon May 14 23:28:08 2007] [notice] Child 1084: All worker threads have
> exited.
> [Mon May 14 23:28:08 2007] [notice] Child 1084: Child process is exiting
>
>
> By the way I tried to start the debugger on a different installation
> with Apache 2.2.3, Modpython 3.2.10 and Python 2.43 on
>
> WinXPSP2. It worked just as expected. The same was true for an older
> installation using Apache 2.0.52, Modpython 3.1.3 and
>
> Python 2.3.4 on WinXPSP1. So the 'problem' must have been introduced
> very recently...(I'm sorry I mixed up the version number
>
> of Modpython in the first post: I didn't test Modpython 2.7.10).
>
> This additional information probably supports your hypothesis that the
> problem is related to
>
> http://issues.apache.org/jira/browse/MODPYTHON-195 doesn't it?
>
> Ren?
>

From simon.holness at gmail.com  Tue May 15 06:19:21 2007
From: simon.holness at gmail.com (Simon Holness)
Date: Tue May 15 06:19:27 2007
Subject: [mod_python] import_module is case sensitive even if the OS isn't
In-Reply-To: <88e286470705141724v6b86c35x51271ac30cd52f13@mail.gmail.com>
References: <b26b30150705111347u2884083fo162c2cf9fc6809e6@mail.gmail.com>
	<88e286470705111706k165715baya8302f153d90cfd3@mail.gmail.com>
	<b26b30150705140324x50bc9ec5uc7518cc56304b93@mail.gmail.com>
	<88e286470705140349m65aa11d6n42454c6d0608acb5@mail.gmail.com>
	<46486218.8010103@natlab.research.philips.com>
	<b26b30150705140709o5221945fs8218a9fb5e7cd6a5@mail.gmail.com>
	<88e286470705141724v6b86c35x51271ac30cd52f13@mail.gmail.com>
Message-ID: <b26b30150705150319w76dfef76j731858937b122a7e@mail.gmail.com>

On 15/05/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> One can still get unexpected behaviour if there are symlinks. One
> could also apply os.path.realpath() to eliminate symlink issues on
> platforms which support them, but this would slow things down further.
> Also would break code where code assumes it can use
> os.path.dirname(__file__) to determine a bas directory as the real
> file can be in a totally different location. Thus why I don't try and
> load just one module instance where multiple symlinks point to one
> physical file.

Personally I think the issue of symlinks is a separate one and if
using them you'd expect to identify the modules based on the symlink
path not the realpath. If you create a symlink you're effectively (and
quite deliberately) creating a new path. If you make a case typo in a
config file which renders a correct and working path because the
underlying system is case insensitive, I think that's a different
kettle of fish.

> What are you expecting '~/' to resolve to? In the mod_python module
> importer '~/' is resolved to be the directory the handler was
> designated for. It should replace the '~/' with the actual value and
> if that happened to be 'c:/mypath', the final path should be the same
> and there should only be one module loaded, not two. Thus if you are
> seeing two modules may be a bug.

Sorry, I didn't explain myself clearly. The ~/ notation works fine and
generated the correct path as per spec. It just so happened that in
another handler (not in the same dir) I needed to import the module
again, so I specified the full path. Only I made a mistake and used a
lowercase 'c' for the drive letter rather than uppercase which windows
reports.

So ~/ became C:/mypath/ and I was using c:/mypath/ elsewhere (typed by hand).

On a case sensitive system that would obviously be incorrect and I'd
get an error, but in this case (NTFS) I got the module loaded twice,
with different labels.

I've seen no bugs with the ~/ notation (and it's a very handy feature!).

Cheers
Simon
From graham.dumpleton at gmail.com  Tue May 15 06:32:11 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue May 15 06:32:14 2007
Subject: [mod_python] Setting HTTP response status line
In-Reply-To: <463E4123.2030701@rogerbinns.com>
References: <463E4123.2030701@rogerbinns.com>
Message-ID: <88e286470705150332k2e8329cn70346074ade7c77c@mail.gmail.com>

On 07/05/07, Roger Binns <rogerb@rogerbinns.com> wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> I'm trying to set the response status line, and failing.
>
> def handler(req):
>    raise apache.SERVER_RETURN, (400, "You must supply a foo")
>
> This is with the mod_python on Ubuntu feisty (3.2.10).  From the code in
> apache.py, it sets req.status with the text message although the doc
> says that is an integer field.
>
> However the http client always receives standard text (eg 'Bad Request'
> for code 400).

It turns out that when using the Apache C API one can set the status
line just like you you want, unfortunately mod_python doesn't properly
expose this functionality. The only change required to make it work is
to make the req.status_line attribute writable. In doing that, it
overrides what status line would be calculated from req.status. Ie.,

  req.status_line = "400 You must supply a foo"
  req.write('some data')
  return apache.OK

I'll log an issue in the bug tracking system to have req.status_line
made writable in future version.

Graham
From nferrier at tapsellferrier.co.uk  Tue May 15 06:43:39 2007
From: nferrier at tapsellferrier.co.uk (Nic James Ferrier)
Date: Tue May 15 06:43:57 2007
Subject: [mod_python] London python web hackers meet up
In-Reply-To: <b26b30150705150319w76dfef76j731858937b122a7e@mail.gmail.com>
	(Simon Holness's message of "Tue\, 15 May 2007 11\:19\:21 +0100")
References: <b26b30150705111347u2884083fo162c2cf9fc6809e6@mail.gmail.com>
	<88e286470705111706k165715baya8302f153d90cfd3@mail.gmail.com>
	<b26b30150705140324x50bc9ec5uc7518cc56304b93@mail.gmail.com>
	<88e286470705140349m65aa11d6n42454c6d0608acb5@mail.gmail.com>
	<46486218.8010103@natlab.research.philips.com>
	<b26b30150705140709o5221945fs8218a9fb5e7cd6a5@mail.gmail.com>
	<88e286470705141724v6b86c35x51271ac30cd52f13@mail.gmail.com>
	<b26b30150705150319w76dfef76j731858937b122a7e@mail.gmail.com>
Message-ID: <87veeu9xk4.fsf_-_@kanga.tapsellferrier.co.uk>

Is anyone here interested in getting together for a pint or two in a
London drinking place?

It'd be fun to meet with some python web hackers.

-- 
Nic Ferrier
http://www.tapsellferrier.co.uk   

PS I've also asked the Django people the same thing - it'd be
interesting I think!
From jeffh at dundeemt.com  Tue May 15 09:36:14 2007
From: jeffh at dundeemt.com (Jeff Hinrichs - DM&T)
Date: Tue May 15 09:36:18 2007
Subject: [mod_python] What is the proper way to delete a session member
Message-ID: <5aaed53f0705150636ue60a6a0r252aa44804c08609@mail.gmail.com>

Given:
you have a session object, and there exists req.session['foo'] = bar

How do you remove/delete the member 'foo'?  I want the session to
remain except that the member 'foo' should not exist in the session
object?

Do I just set it to an empty string or None?  I could very well be
blind to this information in the docs but I couldn't seem to find it.
I recall that the session object looks like a dictionary but isn't a
true dictionary.  So I'm not sure if I can use the del method
 del(req.session['foo'])


Even a nudge to some where in the docs would be appreciated.


Thanks,

Jeff Hinrichs
www.OmahaPython.org
From jmt4b04d4v at gmail.com  Tue May 15 12:45:35 2007
From: jmt4b04d4v at gmail.com (Johans Taboada)
Date: Tue May 15 12:45:38 2007
Subject: [mod_python] mod_python+Apache2+OpenSSL missconfiguration?
Message-ID: <1916f5340705150945i233362d0l7452c0f628377de@mail.gmail.com>

Hi list, I ask for help please.

More than a month ago I had problems with a python app (Trac) served by
Apache2+mod_python. It's an SSL related problem.

I wrote to Trac-Users mailing list (take a look for deep clarification,
please):
  *
http://groups.google.com/group/trac-users/browse_thread/thread/901ef327b448b496?hl=en

But got no solution (responses, yes). Then wrote to openssl-users (see
archive):
  * http://www.mail-archive.com/openssl-users@openssl.org/msg48669.html

And got no even response.

> When I use directly trac (it has a lightweight server, tracd), it works
with
no problems.

> But when I use it throught apache2+mod_python, apache shows HTTP 500:

> ... SSL error: cipher or hash unavailable

> The only thing I can guess is that ''apache2+mod_python'' (client-app
role)
fails to access PostgreSQL+SSL (server role). Must be a missconfiguration in
apache2, maybe a missing '''PythonOption'''.

How do I configure Apache2 properly, to act as a SSL client, I have no
problems acting as SSL server role.

You are my last source of help.

Thanks,
--------------------------------------------------------
Johans Marvin Taboada Villca    -`^_^?- .o0O( 2007-04-24, Bienvenida
Bebecita )
--------------------------------------------------------
Adm. Laboratorio de Desarrollo de Software
Carreras de Inform?tica y Sistemas
UMSS, Cochabamba
Bolivia
--------------------------------------------------------
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070515/38e6faac/attachment.html
From tfcrobert at gmail.com  Tue May 15 13:18:39 2007
From: tfcrobert at gmail.com (Robert Norman)
Date: Tue May 15 13:18:46 2007
Subject: [mod_python] How to identify mobile client
Message-ID: <4ca92f240705151018m528625eepa4f1188fa15e1ae8@mail.gmail.com>

I'm setting up demonstration web pages that can be optionally accessed from
a phone or other mobile connection  and would like to customize the look for
such devices. Currently, as a test setup, I'm just looking  HTTP_AGENT and
hard coding some unique information for my personal phone to select css
files, and do  other conditional mod-python customizations.

This will actually work OK for my demo but I'd like to know if there is a
more general way to detect mobile clients.

Thanks

Robert
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070515/b558ed5d/attachment.html
From arolsen at gmail.com  Tue May 15 17:19:52 2007
From: arolsen at gmail.com (Adam Olsen)
Date: Tue May 15 17:19:56 2007
Subject: [mod_python] mod_python handlers seem to start in the wrong
	directory
Message-ID: <2473b43f0705151419of7f98fblb5074782e1fd87cf@mail.gmail.com>

Does anything look wrong with the following in my exaile.org virtualhost
configuration?  Every once in a while, it seems as though the handler
scripts are running in the wrong directory.  They can't find files that are
in the same directory, even if I specifically use os.chdir() right before I
try to access the file.

<Directory /var/www/exaile.org/htdocs/plugins/>
    AddHandler mod_python .py
    PythonHandler plugins
    PythonPath "sys.path + ['/var/www/exaile.org/htdocs/plugins']"
    PythonDebug On
</Directory>
<Directory /var/www/exaile.org/htdocs/>
    AddHandler mod_python .py
    PythonHandler index
    PythonDebug On
    PythonPath "sys.path + ['/var/www/exaile.org/htdocs']"
</Directory>


-- 
Adam Olsen
http://www.vimtips.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070515/6078d191/attachment.html
From graham.dumpleton at gmail.com  Tue May 15 17:22:40 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue May 15 17:22:45 2007
Subject: [mod_python] compile on 64-bit windows server 2003
In-Reply-To: <588860ab0705150525rb0504d9la24f0bbc65370121@mail.gmail.com>
References: <588860ab0705141638g73f5fabek3ef3a303610ebde4@mail.gmail.com>
	<88e286470705141655w67d3e8d3sfa1ff77c27acdb2c@mail.gmail.com>
	<588860ab0705150525rb0504d9la24f0bbc65370121@mail.gmail.com>
Message-ID: <88e286470705151422w1314200dk7d7095fd9ee00309@mail.gmail.com>

---------- Forwarded message ----------
From: Henk van den Toorn <hvdtoorn@gmail.com>
Date: 15-May-2007 22:25
Subject: Re: [mod_python] compile on 64-bit windows server 2003
To: Graham Dumpleton <graham.dumpleton@gmail.com>


Hi,

Thanks Graham! I've gotten it to compile, now I'm testing the module.

Just to share my steps with the community :

The old mail ( http://www.modpython.org/pipermail/mod_python/2006-September/022092.html
) was a big help, but you need to set up some more environment
variables in order to get it to work on the AMD64 ( = EM-64T / x64)
platform.

You need to download and install:
- Windows platform SDK (which comes with a compiler etc.)
- A binary apache installation (the same installation you want to use
your mod_python with)
- the mod_python sources (on the site it says it's for linux, but it
is in fact for windows as well)

The platform SDK gives you several command line environments set up
for the different platforms it supports. For AMD64, use the "x64-bit
retail" version. You can find the command lines in the start menu /
programs.

- You have to set up some variables to tell the python distutils and
the build script what you are doing, so type:

set DISTUTILS_USE_SDK=1
set MSSdk=1
set APACHESRC=[your installation path to apache]

- cd into the \dist directory within the mod_python sources
- now run the build_installer.bat script

If all goes well, all parts are built and a windows installer is put
in the \dist\dist directory. I got an error saying it cannot find the
Python25\Lib\distutils\command\wininst- 8.0.exe file, but copying
wininst-7.1.exe into a file called wininst-8.0.exe (and recompiling
mod_python) just worked for me.
- Unfortunately, the post-install python script does not work, saying
it cannot find python.exe , so I run the \dist\win32_postinstall.py
script by hand, which actually puts the mod_python.so file into the
server \modules\ path.

 As I said, I'm testing now...



On 15/05/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> Did you find these instructions.
>
>   http://www.modpython.org/pipermail/mod_python/2006-September/022092.html
>
> I'm not a Windows person so cant help, but if you try these
> instructions and report back what the problems are then others here
> probably can help.
>
> Graham
>
> On 15/05/07, Henk van den Toorn <hvdtoorn@gmail.com> wrote:
> > Hello, people!
> >
> > I'm very much interested in building the latest (3.3.1) version of
> > mod_python on a 64-bit server (win2003). I have gotten the sources from
> > the download pages and the source for apache httpd as well (it seems
> > like you need that in order to find the httpd.h files and more)
> >
> > Does anybody have experience doing this? Or can the way to address this
> > problem be found somewhere on the internet? I've searched everywhere but
> > I cannot find anything how to do this and all build attempts fail.
> >
> > Thanks in advance! Greetings, Henk
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
> >
>
From graham.dumpleton at gmail.com  Tue May 15 17:29:10 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue May 15 17:29:19 2007
Subject: [mod_python] mod_python+Apache2+OpenSSL missconfiguration?
In-Reply-To: <1916f5340705150945i233362d0l7452c0f628377de@mail.gmail.com>
References: <1916f5340705150945i233362d0l7452c0f628377de@mail.gmail.com>
Message-ID: <88e286470705151429v3987396fo2353356dd6e24549@mail.gmail.com>

If you are relying on SSL client abilities of Python modules, you are
probably having a clash of some sort between version of SSL libraries
Apache is compiled with and those that Apache module is using.
Determine what version of SSL libraries your Apache is using and that
which your Python module is using. If they are different then problems
may occur as the Apache version will be used in preference to that
which the Python module may be linked against.

Graham

On 16/05/07, Johans Taboada <jmt4b04d4v@gmail.com> wrote:
> Hi list, I ask for help please.
>
> More than a month ago I had problems with a python app (Trac) served by
> Apache2+mod_python. It's an SSL related problem.
>
> I wrote to Trac-Users mailing list (take a look for deep clarification,
> please):
>   *
> http://groups.google.com/group/trac-users/browse_thread/thread/901ef327b448b496?hl=en
>
> But got no solution (responses, yes). Then wrote to openssl-users (see
> archive):
>   *
> http://www.mail-archive.com/openssl-users@openssl.org/msg48669.html
>
> And got no even response.
>
> > When I use directly trac (it has a lightweight server, tracd), it works
> with
> no problems.
>
> > But when I use it throught apache2+mod_python, apache shows HTTP 500:
>
> > ... SSL error: cipher or hash unavailable
>
> > The only thing I can guess is that ''apache2+mod_python'' (client-app
> role)
> fails to access PostgreSQL+SSL (server role). Must be a missconfiguration in
> apache2, maybe a missing '''PythonOption'''.
>
> How do I configure Apache2 properly, to act as a SSL client, I have no
> problems acting as SSL server role.
>
> You are my last source of help.
>
> Thanks,
> --------------------------------------------------------
> Johans Marvin Taboada Villca    -`^_^?- .o0O( 2007-04-24, Bienvenida
> Bebecita )
> --------------------------------------------------------
> Adm. Laboratorio de Desarrollo de Software
> Carreras de Inform?tica y Sistemas
> UMSS, Cochabamba
> Bolivia
> --------------------------------------------------------
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>

From graham.dumpleton at gmail.com  Tue May 15 19:34:14 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue May 15 19:34:25 2007
Subject: [mod_python] mod_python handlers seem to start in the wrong
	directory
In-Reply-To: <2473b43f0705151419of7f98fblb5074782e1fd87cf@mail.gmail.com>
References: <2473b43f0705151419of7f98fblb5074782e1fd87cf@mail.gmail.com>
Message-ID: <88e286470705151634u4340c3c7s2962f052d82f3773@mail.gmail.com>

When accessing files from a handler you should always be using
absolute paths and not relative paths. You cannot rely on the current
working directory being a specific value as any other handler or
module running under Apache might change the working directory. If
using a multithreaded MPM for Apache, ie., Windows or worker MPM on
Unix, the current working directory could change between the time you
set it and when you are relying on it being that value, thus making it
unreliable.

How exactly are you accessing the files in the same directory? What
does your code look like?

Note to determine what directory a Python code file is in, you can use:

  directory = os.path.dirname(__file__)

You can then use that as base directory to calculate absolute path for
other files in the same directory.

  file = os.path.join(directory, 'file.txt')

Graham

On 16/05/07, Adam Olsen <arolsen@gmail.com> wrote:
> Does anything look wrong with the following in my exaile.org virtualhost
> configuration?  Every once in a while, it seems as though the handler
> scripts are running in the wrong directory.  They can't find files that are
> in the same directory, even if I specifically use os.chdir() right before I
> try to access the file.
>
> <Directory /var/www/exaile.org/htdocs/plugins/>
>     AddHandler mod_python .py
>     PythonHandler plugins
>     PythonPath "sys.path +
> ['/var/www/exaile.org/htdocs/plugins']"
>     PythonDebug On
> </Directory>
> <Directory /var/www/exaile.org/htdocs/>
>     AddHandler mod_python .py
>     PythonHandler index
>     PythonDebug On
>     PythonPath "sys.path + ['/var/www/exaile.org/htdocs']"
> </Directory>
>
>
> --
> Adam Olsen
> http://www.vimtips.org
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
From greg at vig.co.nz  Tue May 15 19:58:07 2007
From: greg at vig.co.nz (Greg Fawcett)
Date: Tue May 15 19:58:12 2007
Subject: [mod_python] What is the proper way to delete a session member
In-Reply-To: <5aaed53f0705150636ue60a6a0r252aa44804c08609@mail.gmail.com>
References: <5aaed53f0705150636ue60a6a0r252aa44804c08609@mail.gmail.com>
Message-ID: <928306280705151658q2fda77d2h7882ec3aa610c14@mail.gmail.com>

Hi Jeff -

Simply delete it...

    del(req.session['foo'])

Cheers!
Greg.

On 16/05/07, Jeff Hinrichs - DM&T <jeffh@dundeemt.com> wrote:
>
> Given:
> you have a session object, and there exists req.session['foo'] = bar
>
> How do you remove/delete the member 'foo'?  I want the session to
> remain except that the member 'foo' should not exist in the session
> object?
>
> Do I just set it to an empty string or None?  I could very well be
> blind to this information in the docs but I couldn't seem to find it.
> I recall that the session object looks like a dictionary but isn't a
> true dictionary.  So I'm not sure if I can use the del method
> del(req.session['foo'])
>
>
> Even a nudge to some where in the docs would be appreciated.
>
>
> Thanks,
>
> Jeff Hinrichs
> www.OmahaPython.org
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070516/9eb6bd63/attachment-0001.html
From wonder.sk at gmail.com  Tue May 15 20:04:36 2007
From: wonder.sk at gmail.com (Martin Dobias)
Date: Tue May 15 20:04:39 2007
Subject: [mod_python] empty docstrings
Message-ID: <e8e7199c0705151704w61de6e09l374795156e8352e6@mail.gmail.com>

Hi,

I've been trying to get to run matplotlib with mod_python, but it
fails when it gets imported. After some debugging I've found out that
the problem is that parsing of docstrings in their classes fails. The
reason is that the docstrings are empty instead of containing the
actual text.

Here's a simple script that demonstrates this behaviour - displays
'None' from MyClass.__doc__

======
from mod_python import apache

class MyClass:
        """some documentation"""
        pass

def handler(req):
        req.write("Docstring content: %s \n" % MyClass.__doc__)
        return apache.OK
======

Is there any way how to enforce inclusion of docstrings?
Or am I missing something essential?

Regards,
Martin Dobias
From graham.dumpleton at gmail.com  Tue May 15 20:14:18 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue May 15 20:14:23 2007
Subject: [mod_python] empty docstrings
In-Reply-To: <e8e7199c0705151704w61de6e09l374795156e8352e6@mail.gmail.com>
References: <e8e7199c0705151704w61de6e09l374795156e8352e6@mail.gmail.com>
Message-ID: <88e286470705151714i1cf7426dw7deb4ee0f2459825@mail.gmail.com>

Do you have the directive:

  PythonOptimize On

set in your Apache configuration. If you do, then comment it out,
restart Apache and try again.

Graham

On 16/05/07, Martin Dobias <wonder.sk@gmail.com> wrote:
> Hi,
>
> I've been trying to get to run matplotlib with mod_python, but it
> fails when it gets imported. After some debugging I've found out that
> the problem is that parsing of docstrings in their classes fails. The
> reason is that the docstrings are empty instead of containing the
> actual text.
>
> Here's a simple script that demonstrates this behaviour - displays
> 'None' from MyClass.__doc__
>
> ======
> from mod_python import apache
>
> class MyClass:
>         """some documentation"""
>         pass
>
> def handler(req):
>         req.write("Docstring content: %s \n" % MyClass.__doc__)
>         return apache.OK
> ======
>
> Is there any way how to enforce inclusion of docstrings?
> Or am I missing something essential?
>
> Regards,
> Martin Dobias
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From wonder.sk at gmail.com  Tue May 15 20:46:54 2007
From: wonder.sk at gmail.com (Martin Dobias)
Date: Tue May 15 20:46:57 2007
Subject: [mod_python] empty docstrings
In-Reply-To: <88e286470705151714i1cf7426dw7deb4ee0f2459825@mail.gmail.com>
References: <e8e7199c0705151704w61de6e09l374795156e8352e6@mail.gmail.com>
	<88e286470705151714i1cf7426dw7deb4ee0f2459825@mail.gmail.com>
Message-ID: <e8e7199c0705151746p66aa6e68x919974809b35dd80@mail.gmail.com>

Yay! Turning it off has made it!

In docs, there's written that PythonOptimize set to On equals -O
option. But in Python man page it says that docstrings are discarded
only when two -O options are given... Is it possible to use
optimalization with mod_python while leaving docstrings in place?

Thanks a lot for your help.
Martin

On 5/16/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> Do you have the directive:
>
>   PythonOptimize On
>
> set in your Apache configuration. If you do, then comment it out,
> restart Apache and try again.
>
> Graham
>
> On 16/05/07, Martin Dobias <wonder.sk@gmail.com> wrote:
> > Hi,
> >
> > I've been trying to get to run matplotlib with mod_python, but it
> > fails when it gets imported. After some debugging I've found out that
> > the problem is that parsing of docstrings in their classes fails. The
> > reason is that the docstrings are empty instead of containing the
> > actual text.
> >
> > Here's a simple script that demonstrates this behaviour - displays
> > 'None' from MyClass.__doc__
> >
> > ======
> > from mod_python import apache
> >
> > class MyClass:
> >         """some documentation"""
> >         pass
> >
> > def handler(req):
> >         req.write("Docstring content: %s \n" % MyClass.__doc__)
> >         return apache.OK
> > ======
> >
> > Is there any way how to enforce inclusion of docstrings?
> > Or am I missing something essential?
> >
> > Regards,
> > Martin Dobias
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
>
From graham.dumpleton at gmail.com  Tue May 15 20:59:02 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue May 15 20:59:05 2007
Subject: [mod_python] empty docstrings
In-Reply-To: <e8e7199c0705151746p66aa6e68x919974809b35dd80@mail.gmail.com>
References: <e8e7199c0705151704w61de6e09l374795156e8352e6@mail.gmail.com>
	<88e286470705151714i1cf7426dw7deb4ee0f2459825@mail.gmail.com>
	<e8e7199c0705151746p66aa6e68x919974809b35dd80@mail.gmail.com>
Message-ID: <88e286470705151759m6db44f9ci14673d35efd07885@mail.gmail.com>

On 16/05/07, Martin Dobias <wonder.sk@gmail.com> wrote:
> Yay! Turning it off has made it!
>
> In docs, there's written that PythonOptimize set to On equals -O
> option. But in Python man page it says that docstrings are discarded
> only when two -O options are given... Is it possible to use
> optimalization with mod_python while leaving docstrings in place?

Documentation is wrong. I recollect noting that at some point when
doing mod_wsgi.

So this is all perhaps made more flexible in future, have logged the issue:

  http://issues.apache.org/jira/browse/MODPYTHON-227

A workaround you can use for now is to arrange for the environment variable:

  PYTHONOPTIMIZE=1

to be set and exported in the environment of the user that Apache is
initially started.

Graham

> Thanks a lot for your help.
> Martin
>
> On 5/16/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> > Do you have the directive:
> >
> >   PythonOptimize On
> >
> > set in your Apache configuration. If you do, then comment it out,
> > restart Apache and try again.
> >
> > Graham
> >
> > On 16/05/07, Martin Dobias <wonder.sk@gmail.com> wrote:
> > > Hi,
> > >
> > > I've been trying to get to run matplotlib with mod_python, but it
> > > fails when it gets imported. After some debugging I've found out that
> > > the problem is that parsing of docstrings in their classes fails. The
> > > reason is that the docstrings are empty instead of containing the
> > > actual text.
> > >
> > > Here's a simple script that demonstrates this behaviour - displays
> > > 'None' from MyClass.__doc__
> > >
> > > ======
> > > from mod_python import apache
> > >
> > > class MyClass:
> > >         """some documentation"""
> > >         pass
> > >
> > > def handler(req):
> > >         req.write("Docstring content: %s \n" % MyClass.__doc__)
> > >         return apache.OK
> > > ======
> > >
> > > Is there any way how to enforce inclusion of docstrings?
> > > Or am I missing something essential?
> > >
> > > Regards,
> > > Martin Dobias
> > > _______________________________________________
> > > Mod_python mailing list
> > > Mod_python@modpython.org
> > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > >
> >
>
From jmt4b04d4v at gmail.com  Thu May 17 14:51:36 2007
From: jmt4b04d4v at gmail.com (Johans Taboada)
Date: Thu May 17 14:52:16 2007
Subject: [SPAM] Re: [mod_python] mod_python+Apache2+OpenSSL missconfiguration?
In-Reply-To: <88e286470705151429v3987396fo2353356dd6e24549@mail.gmail.com>
References: <1916f5340705150945i233362d0l7452c0f628377de@mail.gmail.com>
	<88e286470705151429v3987396fo2353356dd6e24549@mail.gmail.com>
Message-ID: <1916f5340705171151s4f26b25ai4b4f4f7537acebcb@mail.gmail.com>

2007/5/15, Graham Dumpleton <graham.dumpleton@gmail.com>:
>
> If you are relying on SSL client abilities of Python modules, you are
> probably having a clash of some sort between version of SSL libraries
> Apache is compiled with and those that Apache module is using.
> Determine what version of SSL libraries your Apache is using and that
> which your Python module is using. If they are different then problems
> may occur as the Apache version will be used in preference to that
> which the Python module may be linked against.


Sorry for late response, and thanks for the advice Graham.

I've checked the libraries with ldd, but seems to me that they're fine, I
recognize although that I'm not a linux expert . I post ldd results, maybe
there's something wrong I don't recognize:

root@PCDCOM:/usr/src/trac/pyPgSQL-2.5.1# ldd /usr/bin/python2.4
        linux-gate.so.1 =>  (0xffffe000)
        libpthread.so.0 => /lib/tls/i686/cmov/libpthread.so.0 (0xb7f72000)
        libdl.so.2 => /lib/tls/i686/cmov/libdl.so.2 (0xb7f6e000)
        libutil.so.1 => /lib/tls/i686/cmov/libutil.so.1 (0xb7f6a000)
        libm.so.6 => /lib/tls/i686/cmov/libm.so.6 (0xb7f44000)
        libc.so.6 => /lib/tls/i686/cmov/libc.so.6 (0xb7e10000)
        /lib/ld-linux.so.2 (0xb7f8f000)
root@PCDCOM:/usr/src/trac/pyPgSQL-2.5.1# ldd
/usr/local/lib/python2.4/site-packages/psycopg2/_psycopg.so
        linux-gate.so.1 =>  (0xffffe000)
        libpq.so.4 => /usr/lib/libpq.so.4 (0xb7f45000)
        libpthread.so.0 => /lib/tls/i686/cmov/libpthread.so.0 (0xb7f32000)
        libc.so.6 => /lib/tls/i686/cmov/libc.so.6 (0xb7dfe000)
        libssl.so.0.9.8 => /usr/lib/i686/cmov/libssl.so.0.9.8 (0xb7dbf000)
        libcrypto.so.0.9.8 => /usr/lib/i686/cmov/libcrypto.so.0.9.8
(0xb7c85000)
        libkrb5.so.3 => /usr/lib/libkrb5.so.3 (0xb7c09000)
        libcom_err.so.2 => /lib/libcom_err.so.2 (0xb7c05000)
        libcrypt.so.1 => /lib/tls/i686/cmov/libcrypt.so.1 (0xb7bd7000)
        /lib/ld-linux.so.2 (0x80000000)
        libdl.so.2 => /lib/tls/i686/cmov/libdl.so.2 (0xb7bd3000)
        libz.so.1 => /usr/lib/libz.so.1 (0xb7bbf000)
        libk5crypto.so.3 => /usr/lib/libk5crypto.so.3 (0xb7b9a000)
        libresolv.so.2 => /lib/tls/i686/cmov/libresolv.so.2 (0xb7b86000)
        libkrb5support.so.0 => /usr/lib/libkrb5support.so.0 (0xb7b81000)
root@PCDCOM:/usr/src/trac/pyPgSQL-2.5.1# ldd
/usr/local/lib/python2.4/site-packages/pyPgSQL/libpq/libpqmodule.so
        linux-gate.so.1 =>  (0xffffe000)
        libpq.so.4 => /usr/lib/libpq.so.4 (0xb7fb4000)
        libpthread.so.0 => /lib/tls/i686/cmov/libpthread.so.0 (0xb7fa1000)
        libc.so.6 => /lib/tls/i686/cmov/libc.so.6 (0xb7e6d000)
        libssl.so.0.9.8 => /usr/lib/i686/cmov/libssl.so.0.9.8 (0xb7e2e000)
        libcrypto.so.0.9.8 => /usr/lib/i686/cmov/libcrypto.so.0.9.8
(0xb7cf4000)
        libkrb5.so.3 => /usr/lib/libkrb5.so.3 (0xb7c78000)
        libcom_err.so.2 => /lib/libcom_err.so.2 (0xb7c74000)
        libcrypt.so.1 => /lib/tls/i686/cmov/libcrypt.so.1 (0xb7c46000)
        /lib/ld-linux.so.2 (0x80000000)
        libdl.so.2 => /lib/tls/i686/cmov/libdl.so.2 (0xb7c42000)
        libz.so.1 => /usr/lib/libz.so.1 (0xb7c2e000)
        libk5crypto.so.3 => /usr/lib/libk5crypto.so.3 (0xb7c09000)
        libresolv.so.2 => /lib/tls/i686/cmov/libresolv.so.2 (0xb7bf5000)
        libkrb5support.so.0 => /usr/lib/libkrb5support.so.0 (0xb7bf0000)
root@PCDCOM:/usr/src/trac/pyPgSQL-2.5.1# ldd /usr/local/apache2/bin/httpd
        linux-gate.so.1 =>  (0xffffe000)
        libaprutil-0.so.0 =>
/usr/local/apache2/lib/libaprutil-0.so.0(0xb7f1b000)
        libdb-4.4.so => /usr/lib/libdb-4.4.so (0xb7e17000)
        libexpat.so.0 => /usr/local/apache2/lib/libexpat.so.0 (0xb7df9000)
        libapr-0.so.0 => /usr/local/apache2/lib/libapr-0.so.0 (0xb7dd8000)
        librt.so.1 => /lib/tls/i686/cmov/librt.so.1 (0xb7dcf000)
        libm.so.6 => /lib/tls/i686/cmov/libm.so.6 (0xb7da9000)
        libcrypt.so.1 => /lib/tls/i686/cmov/libcrypt.so.1 (0xb7d7a000)
        libnsl.so.1 => /lib/tls/i686/cmov/libnsl.so.1 (0xb7d64000)
        libpthread.so.0 => /lib/tls/i686/cmov/libpthread.so.0 (0xb7d51000)
        libdl.so.2 => /lib/tls/i686/cmov/libdl.so.2 (0xb7d4d000)
        libc.so.6 => /lib/tls/i686/cmov/libc.so.6 (0xb7c19000)
        /lib/ld-linux.so.2 (0xb7f32000)
root@PCDCOM:/usr/src/trac/pyPgSQL-2.5.1# ldd /usr/lib/libpq.so.4
        linux-gate.so.1 =>  (0xffffe000)
        libssl.so.0.9.8 => /usr/lib/i686/cmov/libssl.so.0.9.8 (0xb7ea5000)
        libcrypto.so.0.9.8 => /usr/lib/i686/cmov/libcrypto.so.0.9.8
(0xb7d6b000)
        libkrb5.so.3 => /usr/lib/libkrb5.so.3 (0xb7cef000)
        libcom_err.so.2 => /lib/libcom_err.so.2 (0xb7cec000)
        libcrypt.so.1 => /lib/tls/i686/cmov/libcrypt.so.1 (0xb7cbe000)
        libpthread.so.0 => /lib/tls/i686/cmov/libpthread.so.0 (0xb7cab000)
        libc.so.6 => /lib/tls/i686/cmov/libc.so.6 (0xb7b76000)
        libdl.so.2 => /lib/tls/i686/cmov/libdl.so.2 (0xb7b72000)
        libz.so.1 => /usr/lib/libz.so.1 (0xb7b5e000)
        libk5crypto.so.3 => /usr/lib/libk5crypto.so.3 (0xb7b39000)
        libresolv.so.2 => /lib/tls/i686/cmov/libresolv.so.2 (0xb7b26000)
        /lib/ld-linux.so.2 (0x80000000)
        libkrb5support.so.0 => /usr/lib/libkrb5support.so.0 (0xb7b20000)
root@PCDCOM:/usr/src/trac/pyPgSQL-2.5.1# ldd
/usr/local/apache2/modules/mod_python.so
        linux-gate.so.1 =>  (0xffffe000)
        libpthread.so.0 => /lib/tls/i686/cmov/libpthread.so.0 (0xb7dca000)
        libdl.so.2 => /lib/tls/i686/cmov/libdl.so.2 (0xb7dc6000)
        libutil.so.1 => /lib/tls/i686/cmov/libutil.so.1 (0xb7dc2000)
        libm.so.6 => /lib/tls/i686/cmov/libm.so.6 (0xb7d9c000)
        libc.so.6 => /lib/tls/i686/cmov/libc.so.6 (0xb7c68000)
        /lib/ld-linux.so.2 (0x80000000)

I've taken a look at python modules (psycopg2 and pyPgSQL) and I guess I've
identified where exceptions generate. It's in '''PQstatus(pgconnection)'''
call (using libpq postgresql client library from '''python-module libpq
wrapper''').

psycopg2-2.0.5.1/psycopg/connection_int.c#L82
    else if (PQstatus(pgconn) == CONNECTION_BAD)
    {
        Dprintf("conn_connect: PQconnectdb(%s) returned BAD", self->dsn);
        PyErr_SetString(OperationalError, PQerrorMessage(pgconn));
        PQfinish(pgconn);
        return -1;
    }


pyPgSQL-2.5.1/pgconnection.c#L698
    if (PQstatus(PgConnection_Get(self)) != CONNECTION_OK)
    {
        PyErr_SetString(PqErr_DatabaseError,
                        PQerrorMessage(PgConnection_Get(self)));
        PQfinish(PgConnection_Get(self));
        PgConnection_Get(self) = (PGconn *)NULL;
        return NULL;
    }

It may help demystify my issue.

Greetings,
--------------------------------------------------------
Johans Marvin Taboada Villca    -`^_^?- .o0O( 2007-04-24, Bienvenida
Bebecita )
--------------------------------------------------------
Adm. Laboratorio de Desarrollo de Software
Carreras de Inform?tica y Sistemas
UMSS, Cochabamba
Bolivia
--------------------------------------------------------
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070517/2bf6a4c9/attachment.html
From graham.dumpleton at gmail.com  Thu May 17 17:53:57 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu May 17 17:54:05 2007
Subject: [SPAM] Re: [mod_python] mod_python+Apache2+OpenSSL
	missconfiguration?
In-Reply-To: <1916f5340705171151s4f26b25ai4b4f4f7537acebcb@mail.gmail.com>
References: <1916f5340705150945i233362d0l7452c0f628377de@mail.gmail.com>
	<88e286470705151429v3987396fo2353356dd6e24549@mail.gmail.com>
	<1916f5340705171151s4f26b25ai4b4f4f7537acebcb@mail.gmail.com>
Message-ID: <88e286470705171453t2c5ad68dq5ae30c728aa70077@mail.gmail.com>

Hmmm, looking at code, the SSL code in Apache is probably embedded
within the actual httpd rather than being linked in. Running:

  nm /usr/local/apache2/bin/httpd | grep ssl

would probably show that to be the case. If it is and the problems are
the result of a clash between the embedded version of SSL and the
external libraries, then solution would be to tell Apache to use
external SSL libraries using the Apache configure script option:

  --with-ssl=DIR          OpenSSL SSL/TLS toolkit

Thus rebuilding Apache to use same external SSL library may be one thing to try.

The next thing I was going to suggest you do was to take a standalone
test program that shows that what you are trying to do works outside
of Apache and make sure it still works when you run it as the same
user that Apache runs as and from the root directory of your
filesystem.

Doing this would check two things. The first is whether it is user
related and second whether it could be the result of things being run
in a directory where no write access is available.

Graham

On 18/05/07, Johans Taboada <jmt4b04d4v@gmail.com> wrote:
> 2007/5/15, Graham Dumpleton <graham.dumpleton@gmail.com>:
> > If you are relying on SSL client abilities of Python modules, you are
> > probably having a clash of some sort between version of SSL libraries
> > Apache is compiled with and those that Apache module is using.
> > Determine what version of SSL libraries your Apache is using and that
> > which your Python module is using. If they are different then problems
> > may occur as the Apache version will be used in preference to that
> > which the Python module may be linked against.
>
> Sorry for late response, and thanks for the advice Graham.
>
> I've checked the libraries with ldd, but seems to me that they're fine, I
> recognize although that I'm not a linux expert . I post ldd results, maybe
> there's something wrong I don't recognize:
>
> root@PCDCOM:/usr/src/trac/pyPgSQL-2.5.1# ldd /usr/bin/python2.4
>         linux-gate.so.1 =>  (0xffffe000)
>         libpthread.so.0 =>
> /lib/tls/i686/cmov/libpthread.so.0 (0xb7f72000)
>         libdl.so.2 => /lib/tls/i686/cmov/libdl.so.2 (0xb7f6e000)
>         libutil.so.1 => /lib/tls/i686/cmov/libutil.so.1 (0xb7f6a000)
>         libm.so.6 => /lib/tls/i686/cmov/libm.so.6 (0xb7f44000)
>         libc.so.6 => /lib/tls/i686/cmov/libc.so.6 (0xb7e10000)
>         /lib/ld-linux.so.2 (0xb7f8f000)
> root@PCDCOM:/usr/src/trac/pyPgSQL-2.5.1# ldd
> /usr/local/lib/python2.4/site-packages/psycopg2/_psycopg.so
>         linux-gate.so.1 =>  (0xffffe000)
>         libpq.so.4 => /usr/lib/libpq.so.4 (0xb7f45000)
>         libpthread.so.0 =>
> /lib/tls/i686/cmov/libpthread.so.0 (0xb7f32000)
>         libc.so.6 => /lib/tls/i686/cmov/libc.so.6 (0xb7dfe000)
>         libssl.so.0.9.8 =>
> /usr/lib/i686/cmov/libssl.so.0.9.8 (0xb7dbf000)
>         libcrypto.so.0.9.8 =>
> /usr/lib/i686/cmov/libcrypto.so.0.9.8 (0xb7c85000)
>         libkrb5.so.3 => /usr/lib/libkrb5.so.3 (0xb7c09000)
>         libcom_err.so.2 => /lib/libcom_err.so.2 (0xb7c05000)
>         libcrypt.so.1 => /lib/tls/i686/cmov/libcrypt.so.1
> (0xb7bd7000)
>         /lib/ld-linux.so.2 (0x80000000)
>         libdl.so.2 => /lib/tls/i686/cmov/libdl.so.2 (0xb7bd3000)
>         libz.so.1 => /usr/lib/libz.so.1 (0xb7bbf000)
>         libk5crypto.so.3 => /usr/lib/libk5crypto.so.3 (0xb7b9a000)
>         libresolv.so.2 => /lib/tls/i686/cmov/libresolv.so.2
> (0xb7b86000)
>         libkrb5support.so.0 => /usr/lib/libkrb5support.so.0 (0xb7b81000)
> root@PCDCOM:/usr/src/trac/pyPgSQL-2.5.1# ldd
> /usr/local/lib/python2.4/site-packages/pyPgSQL/libpq/libpqmodule.so
>         linux-gate.so.1 =>  (0xffffe000)
>         libpq.so.4 => /usr/lib/libpq.so.4 (0xb7fb4000)
>         libpthread.so.0 =>
> /lib/tls/i686/cmov/libpthread.so.0 (0xb7fa1000)
>         libc.so.6 => /lib/tls/i686/cmov/libc.so.6 (0xb7e6d000)
>         libssl.so.0.9.8 =>
> /usr/lib/i686/cmov/libssl.so.0.9.8 (0xb7e2e000)
>         libcrypto.so.0.9.8 =>
> /usr/lib/i686/cmov/libcrypto.so.0.9.8 (0xb7cf4000)
>         libkrb5.so.3 => /usr/lib/libkrb5.so.3 (0xb7c78000)
>         libcom_err.so.2 => /lib/libcom_err.so.2 (0xb7c74000)
>         libcrypt.so.1 => /lib/tls/i686/cmov/libcrypt.so.1
> (0xb7c46000)
>         /lib/ld-linux.so.2 (0x80000000)
>         libdl.so.2 => /lib/tls/i686/cmov/libdl.so.2 (0xb7c42000)
>         libz.so.1 => /usr/lib/libz.so.1 (0xb7c2e000)
>         libk5crypto.so.3 => /usr/lib/libk5crypto.so.3 (0xb7c09000)
>         libresolv.so.2 => /lib/tls/i686/cmov/libresolv.so.2
> (0xb7bf5000)
>         libkrb5support.so.0 => /usr/lib/libkrb5support.so.0 (0xb7bf0000)
> root@PCDCOM:/usr/src/trac/pyPgSQL-2.5.1# ldd /usr/local/apache2/bin/httpd
>         linux-gate.so.1 =>  (0xffffe000)
>         libaprutil-0.so.0 =>
> /usr/local/apache2/lib/libaprutil-0.so.0 (0xb7f1b000)
>         libdb-4.4.so => /usr/lib/libdb-4.4.so (0xb7e17000)
>         libexpat.so.0 =>
> /usr/local/apache2/lib/libexpat.so.0 (0xb7df9000)
>         libapr-0.so.0 => /usr/local/apache2/lib/libapr-0.so.0 (0xb7dd8000)
>         librt.so.1 => /lib/tls/i686/cmov/librt.so.1 (0xb7dcf000)
>         libm.so.6 => /lib/tls/i686/cmov/libm.so.6 (0xb7da9000)
>         libcrypt.so.1 => /lib/tls/i686/cmov/libcrypt.so.1
> (0xb7d7a000)
>         libnsl.so.1 => /lib/tls/i686/cmov/libnsl.so.1 (0xb7d64000)
>          libpthread.so.0 =>
> /lib/tls/i686/cmov/libpthread.so.0 (0xb7d51000)
>         libdl.so.2 => /lib/tls/i686/cmov/libdl.so.2 (0xb7d4d000)
>         libc.so.6 => /lib/tls/i686/cmov/libc.so.6 (0xb7c19000)
>          /lib/ld-linux.so.2 (0xb7f32000)
> root@PCDCOM:/usr/src/trac/pyPgSQL-2.5.1# ldd /usr/lib/libpq.so.4
>         linux-gate.so.1 =>  (0xffffe000)
>         libssl.so.0.9.8 =>
> /usr/lib/i686/cmov/libssl.so.0.9.8 (0xb7ea5000)
>         libcrypto.so.0.9.8 =>
> /usr/lib/i686/cmov/libcrypto.so.0.9.8 (0xb7d6b000)
>         libkrb5.so.3 => /usr/lib/libkrb5.so.3 (0xb7cef000)
>         libcom_err.so.2 => /lib/libcom_err.so.2 (0xb7cec000)
>         libcrypt.so.1 => /lib/tls/i686/cmov/libcrypt.so.1
> (0xb7cbe000)
>         libpthread.so.0 =>
> /lib/tls/i686/cmov/libpthread.so.0 (0xb7cab000)
>         libc.so.6 => /lib/tls/i686/cmov/libc.so.6 (0xb7b76000)
>         libdl.so.2 => /lib/tls/i686/cmov/libdl.so.2 (0xb7b72000)
>         libz.so.1 => /usr/lib/libz.so.1 (0xb7b5e000)
>         libk5crypto.so.3 => /usr/lib/libk5crypto.so.3 (0xb7b39000)
>         libresolv.so.2 => /lib/tls/i686/cmov/libresolv.so.2
> (0xb7b26000)
>         /lib/ld-linux.so.2 (0x80000000)
>         libkrb5support.so.0 => /usr/lib/libkrb5support.so.0 (0xb7b20000)
> root@PCDCOM :/usr/src/trac/pyPgSQL-2.5.1# ldd
> /usr/local/apache2/modules/mod_python.so
>         linux-gate.so.1 =>  (0xffffe000)
>         libpthread.so.0 =>
> /lib/tls/i686/cmov/libpthread.so.0 (0xb7dca000)
>         libdl.so.2 => /lib/tls/i686/cmov/libdl.so.2 (0xb7dc6000)
>         libutil.so.1 => /lib/tls/i686/cmov/libutil.so.1 (0xb7dc2000)
>         libm.so.6 => /lib/tls/i686/cmov/libm.so.6 (0xb7d9c000)
>         libc.so.6 => /lib/tls/i686/cmov/libc.so.6 (0xb7c68000)
>         /lib/ld-linux.so.2 (0x80000000)
>
> I've taken a look at python modules (psycopg2 and pyPgSQL) and I guess I've
> identified where exceptions generate. It's in '''PQstatus(pgconnection)'''
> call (using libpq postgresql client library from '''python-module libpq
> wrapper''').
>
> psycopg2-2.0.5.1/psycopg/connection_int.c#L82
>     else if (PQstatus(pgconn) == CONNECTION_BAD)
>     {
>         Dprintf("conn_connect: PQconnectdb(%s) returned BAD", self->dsn);
>         PyErr_SetString(OperationalError,
> PQerrorMessage(pgconn));
>         PQfinish(pgconn);
>         return -1;
>     }
>
>
> pyPgSQL-2.5.1/pgconnection.c#L698
>     if (PQstatus(PgConnection_Get(self)) != CONNECTION_OK)
>     {
>         PyErr_SetString(PqErr_DatabaseError,
>
> PQerrorMessage(PgConnection_Get(self)));
>         PQfinish(PgConnection_Get(self));
>         PgConnection_Get(self) = (PGconn *)NULL;
>         return NULL;
>     }
>
> It may help demystify my issue.
>
> Greetings,
>
> --------------------------------------------------------
> Johans Marvin Taboada Villca    -`^_^?- .o0O( 2007-04-24, Bienvenida
> Bebecita )
> --------------------------------------------------------
> Adm. Laboratorio de Desarrollo de Software
> Carreras de Inform?tica y Sistemas
> UMSS, Cochabamba
> Bolivia
> --------------------------------------------------------
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>

From tfcrobert at gmail.com  Fri May 18 19:48:23 2007
From: tfcrobert at gmail.com (Robert Norman)
Date: Fri May 18 19:48:44 2007
Subject: [mod_python] Dynamic <IMG> with PIL
Message-ID: <4ca92f240705181648k7d57fc58r7eae46dadc0ae890@mail.gmail.com>

I'm trying to create graphs on the fly with mod-python.  Using PIL I can get
a "jpeg" image as a string. Is there some way to wrap this information in an
IMG tag?  I gather that  src parameter in IMG is required so anythink like:

req.write("<IMG %s>"  % myString)

is not going to work.

One suggestion was to:

 <img src="get-graph.py?graphId=xyz" />

where:

"get-graph.py is a python script. it sets the header to "image/jpeg" or
whatever format you want to use than you can use some python libraries to
create the image. Instead of saving the image to a file you just write it to
stdout."

I don't understand the suggestion especially in the context of mod-python
since we want to use req to write the page.

What is a reasonable method to generate dynamic image graphics?

Robert
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070518/021443b6/attachment.html
From johannes at erdfelt.com  Fri May 18 20:31:27 2007
From: johannes at erdfelt.com (Johannes Erdfelt)
Date: Fri May 18 20:31:34 2007
Subject: [mod_python] Dynamic <IMG> with PIL
In-Reply-To: <4ca92f240705181648k7d57fc58r7eae46dadc0ae890@mail.gmail.com>
References: <4ca92f240705181648k7d57fc58r7eae46dadc0ae890@mail.gmail.com>
Message-ID: <20070519003127.GC20784@sventech.com>

On Fri, May 18, 2007, Robert Norman <tfcrobert@gmail.com> wrote:
> I'm trying to create graphs on the fly with mod-python.  Using PIL I can get
> a "jpeg" image as a string. Is there some way to wrap this information in an
> IMG tag?  I gather that  src parameter in IMG is required so anythink like:
> 
> req.write("<IMG %s>"  % myString)
> 
> is not going to work.

No, that certainly won't work. The problem is that the data of your
generated JPEG image isn't text and so isn't appropriate to insert into
HTML.

> One suggestion was to:
> 
> <img src="get-graph.py?graphId=xyz" />
> 
> where:
> 
> "get-graph.py is a python script. it sets the header to "image/jpeg" or
> whatever format you want to use than you can use some python libraries to
> create the image. Instead of saving the image to a file you just write it to
> stdout."
> 
> I don't understand the suggestion especially in the context of mod-python
> since we want to use req to write the page.

It looks like you don't fully understand how web pages are fetched.

The web browser fetchs the URL specified by the user (either by typing
in, or clicking a link). It then parses the HTML and then starts loading
all of the URLs pointed to by IMG elements. These are seperate HTTP
requests, the only difference from the original request for HTML data
is a different content-type.

The suggestion was you shouldn't generate the images in the handler for
the HTML page. You should generate the image in the handler for the
graphics you're linking to in the original HTML page.

Think of it as a layer of indirection. The HTML points to the images,
which are seperate URLs and in the context of your mod_python
application, it is also a different handler. The complexity comes in
passing data from your main handler to the image handlers. This is
usually done via the query string in the URL.

Alternatively, you can also create the images in your main handler and
save them to somewhere in the webroot which you can then use in the src
attribute of the IMG tag. This usually isn't a good solution since most
generated images are temporary and you'll have to remove the images
you've saved after some period of time.

> What is a reasonable method to generate dynamic image graphics?

The aforementioned suggestion is the usual way of handling it.

You can also embed the JPEG data in HTML as well, using the new data: URI
scheme (which essentially takes image data and converts it into base64
and makes that the "URL"), but it's a bit complicated and I don't know
how well supported it is in browsers right now. I'd consider this an
advanced solution.

JE

From ccbean at gmail.com  Fri May 18 20:36:08 2007
From: ccbean at gmail.com (Colin Bean)
Date: Fri May 18 20:36:30 2007
Subject: [mod_python] Dynamic <IMG> with PIL
In-Reply-To: <4ca92f240705181648k7d57fc58r7eae46dadc0ae890@mail.gmail.com>
References: <4ca92f240705181648k7d57fc58r7eae46dadc0ae890@mail.gmail.com>
Message-ID: <29a6ca010705181736o246f5922t8f32b4bc4f69f637@mail.gmail.com>

Hi Robert,

An image tag in your document won't contain any actual image data, it
simply provides a URL which the browser uses to fetch that image data.
 So in order to do what you want to do, you'll need at least two
separate handlers: one to generate the initial page and one to
generate some dynamic image content.
To explain a little better: after a browser initially loads an HTML
page, it will find the SRC attribute for each IMG tag and then perform
a *separate* HTTP request to that URL, and expect some understandable
image data back.  So you will need to generate the image content
separately from the page, and vice versa.

The suggestion that you posted is probably pretty close to what you
will want to do:  you'll have a hander which generates your image in
PIL, sets the content type, and writes the properly encoded image data
(and nothing else) to the request.  I don't use publisher, but I'm
pretty sure this will NOT work with publisher, you will probably have
to write a small custom handler to do this.  Might look something like
this pseudocode (note I haven't tested this in any way):

from cStringIO import StringIO  #Way to hold the encoded image data, for now

def handler(req):
    #Grab whatever parameters you need...
    #Generate a PIL image, let's call it img....

    s = StringIO()
    img.save(s, 'jpeg')  #We have to encode this as a jpeg or similar format,
                                #if we send the raw PIL data the
client won't understand it

    s.seek(0)
    req.content_type = 'image/jpeg'  #Or whatever matches what we save
it as above

    #Would be nice to set the content length, too...

    req.write(s.getvalue()) #Send the encoded image data as our body
    return apache.OK

A good place to start might be setting this up so you can enter a url
like /myimagehanlder?id=foo and have it display just the image in your
browser.  Then integrating it into your page may make more sense.  I
would also recommend implementing some kind of caching mechanism, as
the above code will be a lot of work for your server.

HTH,

Colin



On 5/18/07, Robert Norman <tfcrobert@gmail.com> wrote:
> I'm trying to create graphs on the fly with mod-python.  Using PIL I can get
> a "jpeg" image as a string. Is there some way to wrap this information in an
> IMG tag?  I gather that  src parameter in IMG is required so anythink like:
>
> req.write("<IMG %s>"  % myString)
>
> is not going to work.
>
> One suggestion was to:
>
>  <img src=" get-graph.py?graphId=xyz" />
>
> where:
>
> "get-graph.py is a python script. it sets the header to "image/jpeg" or
> whatever format you want to use than you can use some python libraries to
> create the image. Instead of saving the image to a file you just write it to
> stdout."
>
> I don't understand the suggestion especially in the context of mod-python
> since we want to use req to write the page.
>
> What is a reasonable method to generate dynamic image graphics?
>
> Robert
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
From tfcrobert at gmail.com  Fri May 18 22:10:42 2007
From: tfcrobert at gmail.com (Robert Norman)
Date: Fri May 18 22:10:49 2007
Subject: [mod_python] Dynamic <IMG> with PIL
In-Reply-To: <29a6ca010705181736o246f5922t8f32b4bc4f69f637@mail.gmail.com>
References: <4ca92f240705181648k7d57fc58r7eae46dadc0ae890@mail.gmail.com>
	<29a6ca010705181736o246f5922t8f32b4bc4f69f637@mail.gmail.com>
Message-ID: <4ca92f240705181910m1fe0a13fm2c5824132b550af6@mail.gmail.com>

Hi Colin,

That did it! I hadn't understood the underlying process.
So my handler gets called once for the main page and again with the name of
the image file contained in the IMG tag. The handler just calls the image
generator and merges it into the page. Worked great!  I already had the
image to StringIO working, so it was simply a matter of staging the
requests.

Mod-python is... cool.

Rob


On 5/18/07, Colin Bean < ccbean@gmail.com> wrote:
>
> Hi Robert,
>
> An image tag in your document won't contain any actual image data, it
> simply provides a URL which the browser uses to fetch that image data.
> So in order to do what you want to do, you'll need at least two
> separate handlers: one to generate the initial page and one to
> generate some dynamic image content.
> To explain a little better: after a browser initially loads an HTML
> page, it will find the SRC attribute for each IMG tag and then perform
> a *separate* HTTP request to that URL, and expect some understandable
> image data back.  So you will need to generate the image content
> separately from the page, and vice versa.
>
> The suggestion that you posted is probably pretty close to what you
> will want to do:  you'll have a hander which generates your image in
> PIL, sets the content type, and writes the properly encoded image data
> (and nothing else) to the request.  I don't use publisher, but I'm
> pretty sure this will NOT work with publisher, you will probably have
> to write a small custom handler to do this.  Might look something like
> this pseudocode (note I haven't tested this in any way):
>
> from cStringIO import StringIO  #Way to hold the encoded image data, for
> now
>
> def handler(req):
>     #Grab whatever parameters you need...
>     #Generate a PIL image, let's call it img....
>
>     s = StringIO()
>     img.save(s, 'jpeg')  #We have to encode this as a jpeg or similar
> format,
>                                 #if we send the raw PIL data the
> client won't understand it
>
>     s.seek(0)
>     req.content_type = 'image/jpeg'  #Or whatever matches what we save
> it as above
>
>     #Would be nice to set the content length, too...
>
>     req.write(s.getvalue()) #Send the encoded image data as our body
>     return apache.OK
>
> A good place to start might be setting this up so you can enter a url
> like /myimagehanlder?id=foo and have it display just the image in your
> browser.  Then integrating it into your page may make more sense.  I
> would also recommend implementing some kind of caching mechanism, as
> the above code will be a lot of work for your server.
>
> HTH,
>
> Colin
>
>
>
> On 5/18/07, Robert Norman <tfcrobert@gmail.com> wrote:
> > I'm trying to create graphs on the fly with mod-python.  Using PIL I can
> get
> > a "jpeg" image as a string. Is there some way to wrap this information
> in an
> > IMG tag?  I gather that  src parameter in IMG is required so anythink
> like:
> >
> > req.write("<IMG %s>"  % myString)
> >
> > is not going to work.
> >
> > One suggestion was to:
> >
> >  <img src=" get-graph.py?graphId=xyz" />
> >
> > where:
> >
> > "get-graph.py is a python script. it sets the header to "image/jpeg" or
> > whatever format you want to use than you can use some python libraries
> to
> > create the image. Instead of saving the image to a file you just write
> it to
> > stdout."
> >
> > I don't understand the suggestion especially in the context of
> mod-python
> > since we want to use req to write the page.
> >
> > What is a reasonable method to generate dynamic image graphics?
> >
> > Robert
> >
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070518/4e58deac/attachment.html
From huanghao.c at gmail.com  Sat May 19 03:14:24 2007
From: huanghao.c at gmail.com (huanghao.c)
Date: Sat May 19 02:55:48 2007
Subject: [mod_python] [SPAM] Hello, (Re) importing module
Message-ID: <464EA3D0.8060107@gmail.com>

Hello,

I got many notices in apache error_log:

[Sat May 19 14:52:27 2007] [notice] mod_python: (Re)importing module
'handler'
[Sat May 19 14:54:11 2007] [notice] mod_python: (Re)importing module
'handler'

my apache conf:
<Directory /data/wwwroot/vhosts/hao.com/htdocs>
<IfModule mod_python.c>
PythonOptimize On
PythonAutoReload Off
PythonDebug On
PythonOption session_directory /data/wwwroot/vhosts/hao.com/tmp
PythonOption mutex_directory /data/wwwroot/vhosts/hao.com/tmp
SetHandler python-program
PythonHandler handler
</IfModule>
</Directory>

have problem?
how to avoid re-importing handler module in every time? I care that may
effect my mod_python performance.

thanks in advance.


From graham.dumpleton at gmail.com  Sat May 19 04:46:13 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sat May 19 04:46:21 2007
Subject: [mod_python] [SPAM] Hello, (Re) importing module
In-Reply-To: <464EA3D0.8060107@gmail.com>
References: <464EA3D0.8060107@gmail.com>
Message-ID: <88e286470705190146lcc3da4ex96d7ecf8460a92ee@mail.gmail.com>

Read:

  http://www.dscpl.com.au/wiki/ModPython/Articles/TheProcessInterpreterModel

Apache actually uses multiple processes and so the messages most
likely correspond to the module being loaded into the distinct
processes.

If you upgrade to latest version of mod_python it will be more obvious
what is going on as the process ID is recorded in the messages, plus
the messages distinguish between the initial import and subsequent
reimporting due to modules being changed.

Many bugs with module importing are also fixed in the newest version
of mod_python.

Graham

On 19/05/07, huanghao.c <huanghao.c@gmail.com> wrote:
> Hello,
>
> I got many notices in apache error_log:
>
> [Sat May 19 14:52:27 2007] [notice] mod_python: (Re)importing module
> 'handler'
> [Sat May 19 14:54:11 2007] [notice] mod_python: (Re)importing module
> 'handler'
>
> my apache conf:
> <Directory /data/wwwroot/vhosts/hao.com/htdocs>
> <IfModule mod_python.c>
> PythonOptimize On
> PythonAutoReload Off
> PythonDebug On
> PythonOption session_directory /data/wwwroot/vhosts/hao.com/tmp
> PythonOption mutex_directory /data/wwwroot/vhosts/hao.com/tmp
> SetHandler python-program
> PythonHandler handler
> </IfModule>
> </Directory>
>
> have problem?
> how to avoid re-importing handler module in every time? I care that may
> effect my mod_python performance.
>
> thanks in advance.
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From chris.monsanto at gmail.com  Sat May 19 20:51:29 2007
From: chris.monsanto at gmail.com (Chris Monsanto)
Date: Sat May 19 20:51:36 2007
Subject: [mod_python] mod_python several magnitudes slower than PHP on my
	installation?
Message-ID: <799316b70705191751y7ccaf252jec718413969dd31a@mail.gmail.com>

Recently I've had to move my site to a new dedicated server running
FreeBSD 6.1. After installing apache 2.0.59, python 2.4.4 and
mod_python 3.3.1, I decided to bench a script in PHP vs one in Python.
I found out that for some reason, my mod_python was performing
extremely slow - magnitudes slower than it should. I scowered the
internet for hours and asked a few friends and still haven't been able
to find a solution to the problem.

from mod_python import apache

def handler(req):
  for i in xrange(1000):
    print >> req, "Yeah"
  return apache.OK

and...

<?
  for ($i = 0; $i < 1000; $i++)
    echo "Yeah\n" ;
?>

when I ran ab on both using 1000 requests and a concurrency of 10, i
got these results:

python- Requests per second:    21.37 [#/sec] (mean)
php- Requests per second:    1008.37 [#/sec] (mean)
Any ideas would really be appreciated... I'm on my last leg.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070519/84a8296f/attachment.html
From gzlist at googlemail.com  Sat May 19 21:28:45 2007
From: gzlist at googlemail.com (Martin _)
Date: Sat May 19 21:28:51 2007
Subject: [mod_python] RE: mod_python several magnitudes slower than PHP on
	my installation?
Message-ID: <d80792120705191828v371c7935i31d8142190a2150d@mail.gmail.com>

The two sample scripts do nothing like the same thing, compare the following:

from mod_python import apache

def badhandler(req):
	"""
	Bad version of sample handler for comparison
	
	Sends 1000 little packets consisting of just "Yeah"
	
	Concurrency Level:      10
	Time taken for tests:   65.437500 seconds
	Complete requests:      1000
	Failed requests:        0
	Write errors:           0
	Total transferred:      5176000 bytes
	HTML transferred:       5000000 bytes
	Requests per second:    15.28 [#/sec] (mean)
	Time per request:       654.375 [ms] (mean)
	Time per request:       65.438 [ms] (mean, across all concurrent requests)
	Transfer rate:          77.23 [Kbytes/sec] received
	Requests per second:    15.28
	"""
	for i in xrange(1000):
		print >> req, "Yeah"
	return apache.OK


def handler(req):
	"""
	Good version of sample handler for comparison
	
	Puts together a thousand "Yeah"s then sends them
	
	Concurrency Level:      10
	Time taken for tests:   1.250000 seconds
	Complete requests:      1000
	Failed requests:        0
	Write errors:           0
	Total transferred:      5198000 bytes
	HTML transferred:       5000000 bytes
	Requests per second:    800.00 [#/sec] (mean)
	Time per request:       12.500 [ms] (mean)
	Time per request:       1.250 [ms] (mean, across all concurrent requests)
	Transfer rate:          4060.80 [Kbytes/sec] received
	"""
	buf = []
	for i in xrange(1000):
		buf.append("Yeah\n")
	req.write("".join(buf), 0)
	return apache.OK
From graham.dumpleton at gmail.com  Sat May 19 21:39:13 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sat May 19 21:39:19 2007
Subject: [mod_python] RE: mod_python several magnitudes slower than PHP on
	my installation?
In-Reply-To: <d80792120705191828v371c7935i31d8142190a2150d@mail.gmail.com>
References: <d80792120705191828v371c7935i31d8142190a2150d@mail.gmail.com>
Message-ID: <88e286470705191839l36341255q11cce8fcea214523@mail.gmail.com>

On 20/05/07, Martin _ <gzlist@googlemail.com> wrote:

> def handler(req):
>         buf = []
>         for i in xrange(1000):
>                 buf.append("Yeah\n")
>         req.write("".join(buf), 0)
>         return apache.OK

Or to avoid buffering in Python code and letting Apache buffering do
its thing instead use:

  def handler(req):
    for i in xrange(1000):
      req.write('Yeah\n, 0)
    return apache.OK

By default req.write() flushes data on each call, which using 'print'
with it would result in happening. Thus call req.write() directly and
supply second argument of 0 to avoid flushing.

Graham
From gzlist at googlemail.com  Sat May 19 21:53:36 2007
From: gzlist at googlemail.com (Martin _)
Date: Sat May 19 21:53:42 2007
Subject: [mod_python] RE: mod_python several magnitudes slower than PHP on
	my installation?
In-Reply-To: <88e286470705191839l36341255q11cce8fcea214523@mail.gmail.com>
References: <d80792120705191828v371c7935i31d8142190a2150d@mail.gmail.com>
	<88e286470705191839l36341255q11cce8fcea214523@mail.gmail.com>
Message-ID: <d80792120705191853r2cb1c298kff28a05b16b6f8ea@mail.gmail.com>

> On 5/20/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> > On 20/05/07, Martin _ <gzlist@googlemail.com> wrote:
> >
> > > def handler(req):
> > >         buf = []
> > >         for i in xrange(1000):
> > >                 buf.append("Yeah\n")
> > >         req.write("".join(buf), 0)
> > >         return apache.OK
> >
> > Or to avoid buffering in Python code and letting Apache buffering do
> > its thing instead use:
> >
> >   def handler(req):
> >     for i in xrange(1000):
> >       req.write('Yeah\n, 0)
> >     return apache.OK
> >
> > By default req.write() flushes data on each call, which using 'print'
> > with it would result in happening. Thus call req.write() directly and
> > supply second argument of 0 to avoid flushing.
> >
> > Graham

For this exact test, calling req.write a thousand times is actually
slower (though only by a factor of two or so). If we were being really
minimal:
req.write("Yeah\n"*1000, 0)
comes in at about a quarter again as fast as the buf version. But
clearly 'benchmarks' on this kind of level aren't really useful, just
needed to point out the difference between sending response to client
in lots of teeny bits vs. one finished chunk.
From dcausevic at navisite.com  Mon May 21 15:06:27 2007
From: dcausevic at navisite.com (Causevic, Dzenan)
Date: Mon May 21 15:06:14 2007
Subject: [mod_python] Test page displayed as plain text file
Message-ID: <0EB5586BC84C9D438A52A7CB46EFB43080B22F@NAVEXC.corp.int.com>

I have successifuly built mod_python from source. When I try test page it is not being executed by python, but it is being returned as a plain text file. I get in my browser the exact python code from the test file. I suspect there is something wrong with my apache configuration file.

I am using Apache HTTP 1.3.34 with mod_python 2.7.11, and Python is 2.3.4
OS is Red Hat Enterprise Server.

Can anybody help me with this?



1. These are relevant section of my HTTP.CONF file:

#
# Dynamic Shared Object (DSO) Support
#
LoadModule php4_module        libexec/libphp4.so
LoadModule python_module      libexec/mod_python.so

#
# DocumentRoot: The directory out of which you will serve your
#
DocumentRoot "/var/www"

#
# This should be changed to whatever you set DocumentRoot to.
#
<Directory "/var/www">
    Options Indexes FollowSymLinks MultiViews
    AllowOverride None
    Order allow,deny
    Allow from all
</Directory>

<Directory "/var/www/wiki">
        AddHandler mod_python .py
        PythonHandler mptest
        PythonDebug On
</Directory>

#
# AccessFileName: The name of the file to look for in each directory
#
AccessFileName .htaccess

#
# DefaultType is the default MIME type the server will use for a document
#
DefaultType text/plain

#
# Document types.
#
<IfModule mod_mime.c>

    #
    # AddType allows you to tweak mime.types without actually editing it, or to
    #
    AddType application/x-tar .tgz
    AddType application/x-httpd-php .php .phtml
    AddType application/x-httpd-php-source .phps

    #
    # AddHandler allows you to map certain file extensions to "handlers",
    # actions unrelated to filetype. These can be either built into the server
    # or added with the Action command (see below)
    #
    # If you want to use server side includes, or CGI outside
    # ScriptAliased directories, uncomment the following lines.
    #
    # To use CGI scripts:
    #
    #AddHandler cgi-script .cgi

    #
    # To use server-parsed HTML files
    #
    #AddType text/html .shtml
    #AddHandler server-parsed .shtml

    #
    # Uncomment the following line to enable Apache's send-asis HTTP file
    # feature
    #
    #AddHandler send-as-is asis

    #
    # If you wish to use server-parsed imagemap files, use
    #
    #AddHandler imap-file map

    #
    # To enable type maps, you might want to use
    #
    #AddHandler type-map var

</IfModule>
# End of document types.

2. This is mmy mptest.py file (with permissions 0755):

from mod_python import apache

def handler(req):
     req.content_type = 'text/plain'
     req.write("Hello World!")
     return apache.OK



This e-mail is the property of NaviSite, Inc. It is intended only
for the person or entity to which it is addressed and may contain
information that is privileged, confidential, or otherwise protected
from disclosure. Distribution or copying of this e-mail, or the
information contained herein, to anyone other than the intended
recipient is prohibited.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070521/5b766c3c/attachment.html
From dcausevic at navisite.com  Mon May 21 15:15:57 2007
From: dcausevic at navisite.com (Causevic, Dzenan)
Date: Mon May 21 15:13:46 2007
Subject: [mod_python] Test page displayed as plain text file
Message-ID: <0EB5586BC84C9D438A52A7CB46EFB43002C4A67A@NAVEXC.corp.int.com>


I have successifuly built mod_python from source. When I try test page
it is not being executed by python, but it is being returned as a plain
text file. I get in my browser the exact python code from the test file.
I suspect there is something wrong with my apache configuration file.

I am using Apache HTTP 1.3.34 with mod_python 2.7.11, and Python is
2.3.4
OS is Red Hat Enterprise Server.

Can anybody help me with this?



1. These are relevant section of my HTTP.CONF file:

#
# Dynamic Shared Object (DSO) Support
#
LoadModule php4_module        libexec/libphp4.so
LoadModule python_module      libexec/mod_python.so

#
# DocumentRoot: The directory out of which you will serve your
#
DocumentRoot "/var/www"

#
# This should be changed to whatever you set DocumentRoot to.
#
<Directory "/var/www">
    Options Indexes FollowSymLinks MultiViews
    AllowOverride None
    Order allow,deny
    Allow from all
</Directory>

<Directory "/var/www/wiki">
        AddHandler mod_python .py
        PythonHandler mptest
        PythonDebug On
</Directory>

#
# AccessFileName: The name of the file to look for in each directory
#
AccessFileName .htaccess

#
# DefaultType is the default MIME type the server will use for a
document
#
DefaultType text/plain

#
# Document types.
#
<IfModule mod_mime.c>

    #
    # AddType allows you to tweak mime.types without actually editing
it, or to
    #
    AddType application/x-tar .tgz
    AddType application/x-httpd-php .php .phtml
    AddType application/x-httpd-php-source .phps

    #
    # AddHandler allows you to map certain file extensions to
"handlers",
    # actions unrelated to filetype. These can be either built into the
server
    # or added with the Action command (see below)
    #
    # If you want to use server side includes, or CGI outside
    # ScriptAliased directories, uncomment the following lines.
    #
    # To use CGI scripts:
    #
    #AddHandler cgi-script .cgi

    #
    # To use server-parsed HTML files
    #
    #AddType text/html .shtml
    #AddHandler server-parsed .shtml

    #
    # Uncomment the following line to enable Apache's send-asis HTTP
file
    # feature
    #
    #AddHandler send-as-is asis

    #
    # If you wish to use server-parsed imagemap files, use
    #
    #AddHandler imap-file map

    #
    # To enable type maps, you might want to use
    #
    #AddHandler type-map var

</IfModule>
# End of document types.

2. This is mmy mptest.py file (with permissions 0755):

from mod_python import apache

def handler(req):
     req.content_type = 'text/plain'
     req.write("Hello World!")
     return apache.OK



This e-mail is the property of NaviSite, Inc. It is intended only
for the person or entity to which it is addressed and may contain
information that is privileged, confidential, or otherwise protected
from disclosure. Distribution or copying of this e-mail, or the
information contained herein, to anyone other than the intended
recipient is prohibited.
From fidita48 at hotmail.com  Mon May 21 15:27:49 2007
From: fidita48 at hotmail.com (=?iso-8859-1?B?SWRvaWEgVmlsbGFjaeFuIFrhcmF0ZQ==?=)
Date: Mon May 21 15:27:59 2007
Subject: [mod_python] Error 
Message-ID: <BAY137-F33F4037172426A4002511FD4370@phx.gbl>

An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070521/790edd5e/attachment.html
From graham.dumpleton at gmail.com  Mon May 21 17:57:16 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon May 21 17:57:20 2007
Subject: [mod_python] Test page displayed as plain text file
In-Reply-To: <0EB5586BC84C9D438A52A7CB46EFB43080B22F@NAVEXC.corp.int.com>
References: <0EB5586BC84C9D438A52A7CB46EFB43080B22F@NAVEXC.corp.int.com>
Message-ID: <88e286470705211457u32dc341cue177dbb9c6cb6df2@mail.gmail.com>

Use the correct documentation for the version of mod_python you are
using, you are using mod_python 3.3 configuration and code with
mod_python 2.7.X. For further help see:

  http://www.dscpl.com.au/wiki/ModPython/Articles/GettingModPythonWorking

Graham

On 22/05/07, Causevic, Dzenan <dcausevic@navisite.com> wrote:
>
>
>
> I have successifuly built mod_python from source. When I try test page it is
> not being executed by python, but it is being returned as a plain text file.
> I get in my browser the exact python code from the test file. I suspect
> there is something wrong with my apache configuration file.
>
>  I am using Apache HTTP 1.3.34 with mod_python 2.7.11, and Python is 2.3.4
>  OS is Red Hat Enterprise Server.
>
>  Can anybody help me with this?
>
>
>
>  1. These are relevant section of my HTTP.CONF file:
>
>  #
>  # Dynamic Shared Object (DSO) Support
>  #
>  LoadModule php4_module        libexec/libphp4.so
>  LoadModule python_module      libexec/mod_python.so
>
>  #
>  # DocumentRoot: The directory out of which you will serve your
>  #
>  DocumentRoot "/var/www"
>
>  #
>  # This should be changed to whatever you set DocumentRoot to.
>  #
>  <Directory "/var/www">
>      Options Indexes FollowSymLinks MultiViews
>      AllowOverride None
>      Order allow,deny
>      Allow from all
>  </Directory>
>
>  <Directory "/var/www/wiki">
>          AddHandler mod_python .py
>          PythonHandler mptest
>          PythonDebug On
>  </Directory>
>
>  #
>  # AccessFileName: The name of the file to look for in each directory
>  #
>  AccessFileName .htaccess
>
>  #
>  # DefaultType is the default MIME type the server will use for a document
>  #
>  DefaultType text/plain
>
>  #
>  # Document types.
>  #
>  <IfModule mod_mime.c>
>
>      #
>      # AddType allows you to tweak mime.types without actually editing it,
> or to
>      #
>      AddType application/x-tar .tgz
>      AddType application/x-httpd-php .php .phtml
>      AddType application/x-httpd-php-source .phps
>
>      #
>      # AddHandler allows you to map certain file extensions to "handlers",
>      # actions unrelated to filetype. These can be either built into the
> server
>      # or added with the Action command (see below)
>      #
>      # If you want to use server side includes, or CGI outside
>      # ScriptAliased directories, uncomment the following lines.
>      #
>      # To use CGI scripts:
>      #
>      #AddHandler cgi-script .cgi
>
>      #
>      # To use server-parsed HTML files
>      #
>      #AddType text/html .shtml
>      #AddHandler server-parsed .shtml
>
>      #
>      # Uncomment the following line to enable Apache's send-asis HTTP file
>      # feature
>      #
>      #AddHandler send-as-is asis
>
>      #
>      # If you wish to use server-parsed imagemap files, use
>      #
>      #AddHandler imap-file map
>
>      #
>      # To enable type maps, you might want to use
>      #
>      #AddHandler type-map var
>
>  </IfModule>
>  # End of document types.
>
>  2. This is mmy mptest.py file (with permissions 0755):
>
>  from mod_python import apache
>
>  def handler(req):
>       req.content_type = 'text/plain'
>       req.write("Hello World!")
>       return apache.OK
>
>
>
> This e-mail is the property of NaviSite, Inc. It is intended only for the
> person or entity to which it is addressed and may contain information that
> is privileged, confidential, or otherwise protected from disclosure.
> Distribution or copying of this e-mail, or the information contained herein,
> to anyone other than the intended recipient is prohibited.
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
From graham.dumpleton at gmail.com  Mon May 21 17:59:31 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon May 21 17:59:36 2007
Subject: [mod_python] Error
In-Reply-To: <BAY137-F33F4037172426A4002511FD4370@phx.gbl>
References: <BAY137-F33F4037172426A4002511FD4370@phx.gbl>
Message-ID: <88e286470705211459g379b0d1dvb3d1de8459bf87e6@mail.gmail.com>

What platform are you using?

How many versions of Python do you have installed?

What are the exact error messages in the Apache error log? Do not just
post the very last line error line, you need to supply some context
before and after that as well.

Graham

On 22/05/07, Idoia Villaci?n Z?rate <fidita48@hotmail.com> wrote:
>
> Hi
>
>
> I've got a problem. I've intalled all the executables of apache, mod_python
> and phyton. All the version are compatible.
>
>
>
> the problem is that after installing al the programs, when I do: from
> mod_python import apache inside that module,then when I go to apache and I
> read this line: import _apache and it gives me an error because it doesn't
> find it anywhere. Am I downloading the program wrongly? Do you have any idea
> of why do I get this error?
>
> Thank you very much
>
> ________________________________
> Ofertas y reservas para viajar por todo el mundo. Organiza y contrata tus
> viajes aqu?.
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>

From mpurkeypile at xignite.com  Mon May 21 22:12:29 2007
From: mpurkeypile at xignite.com (Matt Purkeypile)
Date: Mon May 21 22:12:36 2007
Subject: [mod_python] mod_python crash
Message-ID: <8E53CBC0D8D945D7946914E75B652081@xignitematthew>

I'm running Trac on Apache 2.2.3 and mod_python 3.2.10 on a Windows 2003
server machine. We've had everything up and running successfully until
recently this past weekend. We installed the Windows updates Friday night
and rebooted the machine. No configuration changes were made and we didn't
install any other software or anything. 

 

Now when trying to hit any page utilizing mod_python, it crashes. Apache
reports that it is an access violation exception, and the event log contains
the following error:

 

Faulting application httpd.exe, version 2.2.3.0, faulting module
python24.dll, version 2.4.3150.1012, fault address 0x000ab91f.

 

I'm also unable to bring up the test handler as outlined in the
troubleshooting section of the doc.

 

Has anyone else seen this error or have any ideas on things to try to fix
it? As I said, we didn't make any configuration changes..

 

Thanks,

 

Matt Purkeypile

: : : : : : : : : : : : : : : : : : : : : : : : : : : : : : : : : : 
Xignite, Inc.
Powering On-Demand Financial Applications
Telephone: 1-650-288-4238
Email: mpurkeypile <mailto:mpurkeypile@xignite.com>  at xignite.com

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070521/0fcc0a02/attachment-0001.html
From jrraines at comcast.net  Tue May 22 08:24:36 2007
From: jrraines at comcast.net (John Raines)
Date: Tue May 22 08:24:53 2007
Subject: [mod_python] Error
In-Reply-To: <88e286470705211459g379b0d1dvb3d1de8459bf87e6@mail.gmail.com>
References: <BAY137-F33F4037172426A4002511FD4370@phx.gbl>
	<88e286470705211459g379b0d1dvb3d1de8459bf87e6@mail.gmail.com>
Message-ID: <ED4FE06D-C117-483F-9D12-CF730F632688@comcast.net>

Were you typing that at the command line?
On May 21, 2007, at 4:59 PM, Graham Dumpleton wrote:

> What platform are you using?
>
> How many versions of Python do you have installed?
>
> What are the exact error messages in the Apache error log? Do not just
> post the very last line error line, you need to supply some context
> before and after that as well.
>
> Graham
>
> On 22/05/07, Idoia Villaci?n Z?rate <fidita48@hotmail.com> wrote:
>>
>> Hi
>>
>>
>> I've got a problem. I've intalled all the executables of apache,  
>> mod_python
>> and phyton. All the version are compatible.
>>
>>
>>
>> the problem is that after installing al the programs, when I do: from
>> mod_python import apache inside that module,then when I go to  
>> apache and I
>> read this line: import _apache and it gives me an error because it  
>> doesn't
>> find it anywhere. Am I downloading the program wrongly? Do you  
>> have any idea
>> of why do I get this error?
>>
>> Thank you very much
>>
>> ________________________________
>> Ofertas y reservas para viajar por todo el mundo. Organiza y  
>> contrata tus
>> viajes aqu?.
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>
>>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python


From Erskin.Cherry at ACF.hhs.gov  Tue May 22 08:30:21 2007
From: Erskin.Cherry at ACF.hhs.gov (Cherry, Erskin (ACF) (CTR))
Date: Tue May 22 08:30:41 2007
Subject: [mod_python] Solaris 8 and ld errors
In-Reply-To: <81693BD26641CD4CB6107697CD71B94F0446587C@AVN3VS003.ees.hhs.gov>
Message-ID: <EDA51779D3476A478E1F599389255F580F46E6@AVN3VS004.ees.hhs.gov>

Howdy folks. First off, I'd like to thank you for
helping, or even just being available to help. I
really appreciate it.

That said, I'm having some troubles getting
mod_python going as a DSO with Apache 1.3.31 and
Python 2.5 on a Solaris 8 box.

The configure script is given the location of
apxs and (as was later discovered might help)
specifically told to --enable-libgcc

I'm using gcc 3.4.6 and the Solaris ld.

Everything compiles cleanly and installs, but
after adding only the basic lines to the httpd.conf:

	LoadModule python_module    libexec/mod_python.so

and then: 

	ClearModuleList
	AddModule mod_python.c

and the rest of the modules, things get hairy.

[root@machine mod_python-2.7.11]# /usr/local/apache/bin/apachectl
configtest
Syntax error on line 60 of /usr/local/apache/conf/httpd.conf:
Cannot load /usr/local/apache/libexec/mod_python.so into server:
ld.so.1: /usr/local/apache/bin/httpd: fatal: relocation error: file
/usr/local/apache/libexec/mod_python.so: symbol __muldi3: referenced
symbol not found

Some Google work has indicated that this might have something to do with
the differences between GNU ld and the Solaris ld, and the libgcc
library. This was what led me to add the --enable-libgcc configure
option, but that doesn't change the problem.

Other searching suggested that using GNU ld exclusively might fix this,
but I'm less comfortable doing that, since I don't know what things it
might break. I've also considered trying a static module, but would
rather not have to recompile Apache for business control reasons.

I should mention that while I can type ./configure, make, make install
with the best of them, and understand the basic theory behind what ld is
doing, I could very easily be making a basic error here, (such as
needing to pass another flag somewhere) as I know much more in theory
than in practice.

Any ideas?
-- 
Erskin L. Cherry - Web Developer
Administration for Children and Families - Office of Administration
Contractor through Encore Management Corporation
202-260-4645 (office) - 808-387-3173 (cellular)
 



From jacques.panchard at epfl.ch  Tue May 22 12:19:28 2007
From: jacques.panchard at epfl.ch (Jacques Panchard)
Date: Tue May 22 12:19:50 2007
Subject: [mod_python] Trouble installing mod_python on XP with Apache 2.0
Message-ID: <46531810.5000802@epfl.ch>

Hi,
When running mod_python-3.3.1.win32-py2.4-Apache2.0.exe I am getting 
this error:

Traceback (most recent call last):
File "<string>", line 115, in ?
File "c:\Program Files\Python24\lib\shutil.py", line 92, in copy2
copyfile(src, dst)
File "c:\Program Files\Python24\lib\shutil.py", line 48, in copyfile
fdst = open(dst, 'wb')
IOError: [Errno 2] No such file or directory: 'C:/Program Files/Apache 
Group/Apache2\\modules\\mod_python.so'
*** run_installscript: internal error 0xFFFFFFFF ***

I have Apache2.0.59 installed in C:/Program Files/Apache Group/Apache2
and python2.4.4.

Can anybody help me?

J.


-- 
Jacques Panchard ? PhD Student
Ecole Polytechnique F?d?rale de Lausanne

Mailing address:
EPFL - IC - LCA 
B?timent BC (BC 201)
Station 14
CH-1015 Lausanne, Switzerland

Tel: +4121 693 56 13
Fax: +4121 693 66 10
http://lcawww.epfl.ch/panchard




From mpurkeypile at xignite.com  Tue May 22 13:23:22 2007
From: mpurkeypile at xignite.com (Matt Purkeypile)
Date: Tue May 22 13:23:30 2007
Subject: [mod_python] Trouble installing mod_python on XP with Apache 2.0
In-Reply-To: <46531810.5000802@epfl.ch>
References: <46531810.5000802@epfl.ch>
Message-ID: <1B3E10B0E21149C999B3A164F5DBFC1A@xignitematthew>

Is your "C:/Program Files/Apache 
Group/Apache2\\modules\\mod_python.so" present? 

Matt Purkeypile
: : : : : : : : : : : : : : : : : : : : : : : : : : : : : : : : : : 
Xignite, Inc.
Powering On-Demand Financial Applications
Telephone: 1-650-288-4238
Email: mpurkeypile@xignite.com
-----Original Message-----
From: mod_python-bounces@modpython.org
[mailto:mod_python-bounces@modpython.org] On Behalf Of Jacques Panchard
Sent: Tuesday, May 22, 2007 9:19 AM
To: mod_python@modpython.org
Subject: [mod_python] Trouble installing mod_python on XP with Apache 2.0

Hi,
When running mod_python-3.3.1.win32-py2.4-Apache2.0.exe I am getting 
this error:

Traceback (most recent call last):
File "<string>", line 115, in ?
File "c:\Program Files\Python24\lib\shutil.py", line 92, in copy2
copyfile(src, dst)
File "c:\Program Files\Python24\lib\shutil.py", line 48, in copyfile
fdst = open(dst, 'wb')
IOError: [Errno 2] No such file or directory: 'C:/Program Files/Apache 
Group/Apache2\\modules\\mod_python.so'
*** run_installscript: internal error 0xFFFFFFFF ***

I have Apache2.0.59 installed in C:/Program Files/Apache Group/Apache2
and python2.4.4.

Can anybody help me?

J.


-- 
Jacques Panchard ? PhD Student
Ecole Polytechnique F?d?rale de Lausanne

Mailing address:
EPFL - IC - LCA 
B?timent BC (BC 201)
Station 14
CH-1015 Lausanne, Switzerland

Tel: +4121 693 56 13
Fax: +4121 693 66 10
http://lcawww.epfl.ch/panchard




_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://mailman.modpython.org/mailman/listinfo/mod_python



From fidita48 at hotmail.com  Tue May 22 14:07:35 2007
From: fidita48 at hotmail.com (=?iso-8859-1?B?SWRvaWEgVmlsbGFjaeFuIFrhcmF0ZQ==?=)
Date: Tue May 22 14:07:43 2007
Subject: [mod_python] Error
In-Reply-To: <ED4FE06D-C117-483F-9D12-CF730F632688@comcast.net>
Message-ID: <BAY137-F10D4227082B82F04D17175D4360@phx.gbl>

An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070522/4b523e9d/attachment.html
From David.Bear at asu.edu  Tue May 22 14:05:54 2007
From: David.Bear at asu.edu (David Bear)
Date: Tue May 22 14:09:53 2007
Subject: [mod_python] python program versus handler
Message-ID: <20070522180554.GB12075@asu.edu>

I'm trying to decide whether to use publisher or just use 
AddHandler python-program

I understand with publisher that all defined functions are callable in
the url. What happens though if I just use python-program as the
handler? Which functions are called? What happens the __name__?

-- 
David Bear
phone: 	602-496-0424
fax: 	602-496-0955
College of Public Programs/ASU
University Center Rm 622
411 N Central
Phoenix, AZ 85007-0685
 "Beware the IP portfolio, everyone will be suspect of trespassing"
From jpg at jgassociates.ca  Tue May 22 16:24:50 2007
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Tue May 22 16:22:57 2007
Subject: [mod_python] Error
In-Reply-To: <BAY137-F10D4227082B82F04D17175D4360@phx.gbl>
References: <BAY137-F10D4227082B82F04D17175D4360@phx.gbl>
Message-ID: <46535192.2060600@jgassociates.ca>

Idoia Villaci?n Z?rate wrote:
> I?m using mod_python 3.3.1  with apache 2.2.4 and python 2.4 in Windows XP
> 
> Everything intalls correctly, and when I install mod_phyton I add this line:
> 
> LoadModule python_module modules/mod_python.so
> 
> then in the conf of apache I add the following lines:
> 
> <Directory "C:\Archivos de programa\Apache Software Foundation\Apache2.2\htdocs">
> 
>         AddHandler mod_python .py
> 
>         PythonHandler mptest
> 
>         PythonDebug On
> 
>     </Directory>
> 
> And I write the following program which is called mptest:
> 
> from mod_python import apache
> 
> def handler(req):
>         req.content_type = 'text/plain'
>         req.write("Hello World!")
>         return apache.OK
> 
>  I compile the program and I get this error:
> 
> Traceback (most recent call last):
>   File "C:\Archivos de programa\Apache Software 
> Foundation\Apache2.2\htdocs\mptest.py", line 1, in -toplevel-
>     from mod_python import apache
>   File "C:\Python24\Lib\site-packages\mod_python\apache.py", line 30, in -toplevel-
>     import _apache
> ImportError: No module named _apache
> 
>  
> 
> If I go to apache, which is inside de folder of mod_python I see tha in its 
> comand?s line makes a call to _apache, which is not installed anywhere. That?s 
> why I get the error, how can I get that module?

You can't import _apache from a command line interpreter. It is a 
builtin module provided by mod_python.so and can only be accessed from 
within apache.

Jim
From jpg at jgassociates.ca  Tue May 22 16:30:06 2007
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Tue May 22 16:28:11 2007
Subject: [mod_python] Trouble installing mod_python on XP with Apache 2.0
In-Reply-To: <1B3E10B0E21149C999B3A164F5DBFC1A@xignitematthew>
References: <46531810.5000802@epfl.ch>
	<1B3E10B0E21149C999B3A164F5DBFC1A@xignitematthew>
Message-ID: <465352CE.20809@jgassociates.ca>

Matt Purkeypile wrote:
> Is your "C:/Program Files/Apache 
> Group/Apache2\\modules\\mod_python.so" present? 

Actually I think J is trying to install mod_python so the better 
question might be: does "C:/Program Files/Apache Group/Apache2\\modules" 
directory exist?

Jim


> 
> Matt Purkeypile
> : : : : : : : : : : : : : : : : : : : : : : : : : : : : : : : : : : 
> Xignite, Inc.
> Powering On-Demand Financial Applications
> Telephone: 1-650-288-4238
> Email: mpurkeypile@xignite.com
> -----Original Message-----
> From: mod_python-bounces@modpython.org
> [mailto:mod_python-bounces@modpython.org] On Behalf Of Jacques Panchard
> Sent: Tuesday, May 22, 2007 9:19 AM
> To: mod_python@modpython.org
> Subject: [mod_python] Trouble installing mod_python on XP with Apache 2.0
> 
> Hi,
> When running mod_python-3.3.1.win32-py2.4-Apache2.0.exe I am getting 
> this error:
> 
> Traceback (most recent call last):
> File "<string>", line 115, in ?
> File "c:\Program Files\Python24\lib\shutil.py", line 92, in copy2
> copyfile(src, dst)
> File "c:\Program Files\Python24\lib\shutil.py", line 48, in copyfile
> fdst = open(dst, 'wb')
> IOError: [Errno 2] No such file or directory: 'C:/Program Files/Apache 
> Group/Apache2\\modules\\mod_python.so'
> *** run_installscript: internal error 0xFFFFFFFF ***
> 
> I have Apache2.0.59 installed in C:/Program Files/Apache Group/Apache2
> and python2.4.4.
> 
> Can anybody help me?
> 
> J.
> 
> 

From greg at vig.co.nz  Tue May 22 18:25:16 2007
From: greg at vig.co.nz (Greg Fawcett)
Date: Tue May 22 18:25:23 2007
Subject: [mod_python] python program versus handler
In-Reply-To: <20070522180554.GB12075@asu.edu>
References: <20070522180554.GB12075@asu.edu>
Message-ID: <928306280705221525v1ff2e265yd0993941c3654a4b@mail.gmail.com>

Hi David -

Before I start, I'm fairly new to mod_python, so my approach may not be
ideal - hopefully the wiser heads on this list can correct anything
stupid...

I decided not to go with publisher, because it seemed to include a lot of
functionality I didn't need, and I had this strange compulsion to use URLs
like "message.view", where message is a module and view is a function within
the module. This has worked out quite nicely, with "user.addform" displaying
the form to add a user, "user.add" processing the add form fields, and
you'll guess what "user.delete" does. This allows me to keep all my code
relating to users in one module, which seems a good idea.

My handler is extremely simple - only 70 lines long, including comments. It
grabs the session information, initialises database connection, parses
req.uri to find the moduleName and actionName, and then...

    try:
        module=apache.import_module('vf_'+moduleName)
    except ImportError: # Only catch ImportError so syntax errors show
        apache.log_error('vfax.py could not find module
"vf_%s"'%(moduleName))
        return apache.HTTP_NOT_FOUND

    try:
        action=eval('module.'+actionName)
    except:
        apache.log_error('vfax.py could not find action "%s"'%(actionName))
        return apache.HTTP_NOT_FOUND

    apacheReturnCode=action(ft)


If someone tries to hack in via non-existant module names or functions, they
get a 404. One issue I found is that you have to take care with private
functions which should not be callable from outside the module - perhaps you
have a function formatDate() say, used by public functions in the user
module. This should not be available via the URL "user.formatDate", or else
you are leaving yourself open to myriad security issues. I tried starting
their names with two underscores (so it became __formatDate(), but
"user.__formatDate" still worked. So I added a test in my handler for two
leading underscores and 404'd them too:

        if actionName[0:2]=='__':
            apache.log_error('vfax.py refused action "%s"'%(actionName))
            return apache.HTTP_NOT_FOUND

I'd be interested in those wiser head's comments on this - shouldn't a
function with two leading underscores not be callable from outside the
module?

Anyhow, the main point of this message is that writing your own handler is
not a big deal, as long as you are happy to manage issues like sessions and
URL parsing yourself. Publisher is probably a better idea for newcomers to
web development because it already handles many of the gotchas that may
leave your application vulnerable to the net nasties, but if you have some
experience, you have a lot more control and a faster application by writing
your own handler.

Cheers!
Greg.

On 23/05/07, David Bear <David.Bear@asu.edu> wrote:
>
> I'm trying to decide whether to use publisher or just use
> AddHandler python-program
>
> I understand with publisher that all defined functions are callable in
> the url. What happens though if I just use python-program as the
> handler? Which functions are called? What happens the __name__?
>
> --
> David Bear
> phone:  602-496-0424
> fax:    602-496-0955
> College of Public Programs/ASU
> University Center Rm 622
> 411 N Central
> Phoenix, AZ 85007-0685
> "Beware the IP portfolio, everyone will be suspect of trespassing"
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>



-- 
Phone: +64 3 409 8165
Mobile: +64 21 333 291
Fax: +64 3 974 6810
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070523/900e1017/attachment-0001.html
From graham.dumpleton at gmail.com  Tue May 22 19:36:13 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue May 22 19:36:21 2007
Subject: [mod_python] Error
In-Reply-To: <BAY137-F10D4227082B82F04D17175D4360@phx.gbl>
References: <ED4FE06D-C117-483F-9D12-CF730F632688@comcast.net>
	<BAY137-F10D4227082B82F04D17175D4360@phx.gbl>
Message-ID: <88e286470705221636t3e1aa60cxd351ee0b2134852c@mail.gmail.com>

On 23/05/07, Idoia Villaci?n Z?rate <fidita48@hotmail.com> wrote:

>  I compile the program and I get this error:
>
>
>
> Traceback (most recent call last):
>   File "C:\Archivos de programa\Apache Software
> Foundation\Apache2.2\htdocs\mptest.py", line 1, in
> -toplevel-
>     from mod_python import apache
>   File
> "C:\Python24\Lib\site-packages\mod_python\apache.py", line
> 30, in -toplevel-
>     import _apache
> ImportError: No module named _apache

As Jim points out, you can't run this script from the command line. Is
that what you are doing, or is the error message actually from out of
the Apache error log file when you try and access it by the
appropriate URL?

If it is from the Apache error log file, then please provide more
output from the log file from before this error to give us context. If
it is truly mod_python that is getting triggered then the log file
will show other messages before this point that will confirm it. If
those lines aren't there, then your script may not be getting executed
by mod_python but in some CGI like manner which would account for the
error.

Graham

From graham.dumpleton at gmail.com  Tue May 22 19:48:42 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue May 22 19:48:49 2007
Subject: [mod_python] python program versus handler
In-Reply-To: <928306280705221525v1ff2e265yd0993941c3654a4b@mail.gmail.com>
References: <20070522180554.GB12075@asu.edu>
	<928306280705221525v1ff2e265yd0993941c3654a4b@mail.gmail.com>
Message-ID: <88e286470705221648j746a80e9i3a10145765cc0c5d@mail.gmail.com>

On 23/05/07, Greg Fawcett <greg@vig.co.nz> wrote:
>     try:
>         action=eval('module.'+actionName)
>     except:
>         apache.log_error('vfax.py could not find action "%s"'%(actionName))
>         return apache.HTTP_NOT_FOUND

For a start don't use eval(), it can be dangerous. Imagine someone
constructing a URL which contain a sequence of Python commands in it.

  >>> import sys
  >>> import os
  >>> eval('sys.version and os.system("echo hi")')

If calling functions use:

  if hasattr(module, actionName):
    object = getattr(modue, actionName)
    return object(req)
  else:
    return apache.HTTP_NOT_FOUND

I'd suggest there are perhaps better ways of doing what you are doing,
but don't have the time to go into it now and could also take a long
time to explain how to do it properly and securely. More often than
not, one is better off using a dispatcher written by someone else
which has been used a lot and which is known not to have issues. That
or at least look at others code and learn from it when making your
own. :-)

Graham
From jacques.panchard at epfl.ch  Wed May 23 01:43:52 2007
From: jacques.panchard at epfl.ch (Jacques Panchard)
Date: Wed May 23 01:43:58 2007
Subject: [mod_python] Trouble installing mod_python on XP with Apache 2.0
In-Reply-To: <465352CE.20809@jgassociates.ca>
References: <46531810.5000802@epfl.ch>
	<1B3E10B0E21149C999B3A164F5DBFC1A@xignitematthew>
	<465352CE.20809@jgassociates.ca>
Message-ID: <4653D498.3080208@epfl.ch>

Hi,
I am ashamed. The directory where the installer was pointing was the 
directory of a previous Apache installation, apparently only removed 
partially. Since the two paths were very similar, I did not realize it 
when I was proposed an apache directory during installation.
Must have been tired...
Thanks for the help anyway.
Cheers,
Jacques

Jim Gallacher wrote:

> Matt Purkeypile wrote:
>
>> Is your "C:/Program Files/Apache 
>> Group/Apache2\\modules\\mod_python.so" present? 
>
>
> Actually I think J is trying to install mod_python so the better 
> question might be: does "C:/Program Files/Apache 
> Group/Apache2\\modules" directory exist?
>
> Jim
>
>
>>
>> Matt Purkeypile
>> : : : : : : : : : : : : : : : : : : : : : : : : : : : : : : : : : : 
>> Xignite, Inc.
>> Powering On-Demand Financial Applications
>> Telephone: 1-650-288-4238
>> Email: mpurkeypile@xignite.com
>> -----Original Message-----
>> From: mod_python-bounces@modpython.org
>> [mailto:mod_python-bounces@modpython.org] On Behalf Of Jacques Panchard
>> Sent: Tuesday, May 22, 2007 9:19 AM
>> To: mod_python@modpython.org
>> Subject: [mod_python] Trouble installing mod_python on XP with Apache 
>> 2.0
>>
>> Hi,
>> When running mod_python-3.3.1.win32-py2.4-Apache2.0.exe I am getting 
>> this error:
>>
>> Traceback (most recent call last):
>> File "<string>", line 115, in ?
>> File "c:\Program Files\Python24\lib\shutil.py", line 92, in copy2
>> copyfile(src, dst)
>> File "c:\Program Files\Python24\lib\shutil.py", line 48, in copyfile
>> fdst = open(dst, 'wb')
>> IOError: [Errno 2] No such file or directory: 'C:/Program 
>> Files/Apache Group/Apache2\\modules\\mod_python.so'
>> *** run_installscript: internal error 0xFFFFFFFF ***
>>
>> I have Apache2.0.59 installed in C:/Program Files/Apache Group/Apache2
>> and python2.4.4.
>>
>> Can anybody help me?
>>
>> J.
>>
>>

-- 
Jacques Panchard ? PhD Student
Ecole Polytechnique F?d?rale de Lausanne

Mailing address:
EPFL - IC - LCA 
B?timent BC (BC 201)
Station 14
CH-1015 Lausanne, Switzerland

Tel: +4121 693 56 13
Fax: +4121 693 66 10
http://lcawww.epfl.ch/panchard




From fidita48 at hotmail.com  Wed May 23 11:46:43 2007
From: fidita48 at hotmail.com (=?iso-8859-1?B?SWRvaWEgVmlsbGFjaeFuIFrhcmF0ZQ==?=)
Date: Wed May 23 11:46:50 2007
Subject: [mod_python] Error
Message-ID: <BAY137-F1600840F5E3BFEA32A0C71D4350@phx.gbl>

An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070523/5d209c85/attachment.html
From martijn at xs4us.nu  Wed May 23 11:50:59 2007
From: martijn at xs4us.nu (Martijn Moeling)
Date: Wed May 23 11:51:06 2007
Subject: [mod_python] XSLT and mod_python
Message-ID: <B6C73A5E30565245BB6D32B5F5DF7A52120376@sense.emmastraat.pijnacker>

Hi,

I am currently looking into XSLT and to build support for it in my
mod_python based Browser OS/Desktop, I prefer to use standards and I
prefer Native compiled/compilable stuff.

Suit4 is not my idea of a solution.

I came across mod_xslt2 for apache has anyone used this in conjunction
with MP?

Martijn

From richardlewis at fastmail.co.uk  Wed May 23 12:16:04 2007
From: richardlewis at fastmail.co.uk (Richard Lewis)
Date: Wed May 23 12:16:16 2007
Subject: [mod_python] XSLT and mod_python
In-Reply-To: <B6C73A5E30565245BB6D32B5F5DF7A52120376@sense.emmastraat.pijnacker>
References: <B6C73A5E30565245BB6D32B5F5DF7A52120376@sense.emmastraat.pijnacker>
Message-ID: <200705231716.05231.richardlewis@fastmail.co.uk>

On Wednesday 23 May 2007 16:50:59 Martijn Moeling wrote:
> Hi,
>
> I am currently looking into XSLT and to build support for it in my
> mod_python based Browser OS/Desktop, I prefer to use standards and I
> prefer Native compiled/compilable stuff.
>
> Suit4 is not my idea of a solution.
>
> I came across mod_xslt2 for apache has anyone used this in conjunction
> with MP?
>
I've used libxslt with mod_python.

There are raw Python bindings[1] for libxslt/libxml but they have a few 
drawbacks: bad API; and memory leaks.

Therefore I use lxml[2] which implements Fredrik Lundh[3]'s ElementTree[4] 
interface (which is now part of the Python standard library, as of 2.5[5]) as 
a wrapper around libxml/libxslt. Its a very nice way to work with XML/XSLT in 
Python as its /very/ fast and it creates nice Pythonic data structures as a 
result of your XSLT transformations which you can then go on to manipulate in 
code (or just write to a string or file-like object). The only problem I've 
had with it is, I /think/, that its causing crashing of the mod_python's 
Python interpreter when you use <xsl:import />. As I said, I /think/ this is 
what's causing these crashes, but I'm not sure yet.

I used to work on a Cocoon[6]-like project[7] using mod_python and lxml. My 
co-developer has now taken the reigns of this project as is working with 
WSGI[8] rather than specifically mod_python. </shameless-plug> ;-)

Cheers,
Richard

[1] http://xmlsoft.org/python.html
[2] http://codespeak.net/lxml/
[3] http://effbot.org/zone/about.htm
[4] http://effbot.org/zone/element-index.htm
[5] http://docs.python.org/lib/module-xml.etree.ElementTree.html
[6] http://cocoon.apahce.org/
[7] http://code.google.com/p/pycoon
[8] http://www.python.org/dev/peps/pep-0333/
-- 
-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
Richard Lewis
http://www.richard-lewis.me.uk/
JID: ironchicken@jabber.earth.li
-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
From fidita48 at hotmail.com  Wed May 23 14:56:23 2007
From: fidita48 at hotmail.com (=?iso-8859-1?B?SWRvaWEgVmlsbGFjaeFuIFrhcmF0ZQ==?=)
Date: Wed May 23 14:56:37 2007
Subject: [mod_python] Error
Message-ID: <BAY137-F209C5833F95CCD23BB0CE3D4350@phx.gbl>

An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070523/c1e62b72/attachment.html
From jpg at jgassociates.ca  Wed May 23 14:56:57 2007
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Wed May 23 14:56:46 2007
Subject: [mod_python] Error
In-Reply-To: <BAY137-F1600840F5E3BFEA32A0C71D4350@phx.gbl>
References: <BAY137-F1600840F5E3BFEA32A0C71D4350@phx.gbl>
Message-ID: <46548E79.3000207@jgassociates.ca>

Idoia Villaci?n Z?rate wrote:
> I install apache, then python and later mod_phython and all intalls correctly, I 
> read mod_python?s tutorial and there I have the lines I have to write in 
> apache?s configuration file. After doing this when I restart apache everything 
> goes ok. Untill here everything goes fine
> 
> I continue reading the tutorial and there is an example of what I have to do to 
> get Hello World !. I copy it exactly as is written in the phyton program:
> 
> from mod_python import apache
> 
>  
> 
> def handler(req):
> 
>         req.content_type = 'text/plain'
> 
>         req.write("Hello World!")
> 
>         return apache.OK
> 
>  
> 
>  
> 
> So now, when I compile this program is when I get the error:
> 
> Traceback (most recent call last):
> 
>   File "C:\Archivos de programa\Apache Software 
> Foundation\Apache2.2\htdocs\mptest.py", line 1, in ?
> 
>     from mod_python import apache
> 
>   File "C:\Python24\Lib\site-packages\mod_python\apache.py", line 30, in ?
> 
>     import _apache
> 
> ImportError: No module named _apache
> 
> 
> Do you know what can be the problem?

As Graham suggested previously you are not giving us enough information. 
How are you compiling the program? Generally you don't want to compile 
it yourself. Just access the appropriate URL and let mod_python do the 
compiling for you - at least until you've got everything working and 
have a better understanding of how mod_python works.

Jim

From mpurkeypile at xignite.com  Wed May 23 15:14:02 2007
From: mpurkeypile at xignite.com (Matt Purkeypile)
Date: Wed May 23 15:14:08 2007
Subject: [mod_python] mod_python crash
In-Reply-To: <8E53CBC0D8D945D7946914E75B652081@xignitematthew>
References: <8E53CBC0D8D945D7946914E75B652081@xignitematthew>
Message-ID: <37880E2C8D804AA2907037D86F3DFE45@xignitematthew>

To let everyone know: 

 

We were unable to fix this issue, and ended up switching to using CGI. If
anyone else starts seeing mod_python crashes after applying updates on
Windows 2003 I'd like to hear about it.

 

Matt Purkeypile

: : : : : : : : : : : : : : : : : : : : : : : : : : : : : : : : : : 
Xignite, Inc.
Powering On-Demand Financial Applications
Telephone: 1-650-288-4238
Email: mpurkeypile@xignite.com

  _____  

From: mod_python-bounces@modpython.org
[mailto:mod_python-bounces@modpython.org] On Behalf Of Matt Purkeypile
Sent: Monday, May 21, 2007 7:12 PM
To: mod_python@modpython.org
Subject: [mod_python] mod_python crash

 

I'm running Trac on Apache 2.2.3 and mod_python 3.2.10 on a Windows 2003
server machine. We've had everything up and running successfully until
recently this past weekend. We installed the Windows updates Friday night
and rebooted the machine. No configuration changes were made and we didn't
install any other software or anything. 

 

Now when trying to hit any page utilizing mod_python, it crashes. Apache
reports that it is an access violation exception, and the event log contains
the following error:

 

Faulting application httpd.exe, version 2.2.3.0, faulting module
python24.dll, version 2.4.3150.1012, fault address 0x000ab91f.

 

I'm also unable to bring up the test handler as outlined in the
troubleshooting section of the doc.

 

Has anyone else seen this error or have any ideas on things to try to fix
it? As I said, we didn't make any configuration changes..

 

Thanks,

 

Matt Purkeypile

: : : : : : : : : : : : : : : : : : : : : : : : : : : : : : : : : : 
Xignite, Inc.
Powering On-Demand Financial Applications
Telephone: 1-650-288-4238
Email: mpurkeypile <mailto:mpurkeypile@xignite.com>  at xignite.com

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070523/e11fb094/attachment.html
From fidita48 at hotmail.com  Wed May 23 15:31:51 2007
From: fidita48 at hotmail.com (=?iso-8859-1?B?SWRvaWEgVmlsbGFjaeFuIFrhcmF0ZQ==?=)
Date: Wed May 23 15:32:00 2007
Subject: [mod_python] Error
Message-ID: <BAY137-F298A80BF6E9342DC219478D4350@phx.gbl>

An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070523/fd1472e3/attachment.html
From graham.dumpleton at gmail.com  Wed May 23 18:25:42 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Wed May 23 18:26:01 2007
Subject: [mod_python] Error
In-Reply-To: <BAY137-F209C5833F95CCD23BB0CE3D4350@phx.gbl>
References: <BAY137-F209C5833F95CCD23BB0CE3D4350@phx.gbl>
Message-ID: <88e286470705231525u7df4c5d0l221e02752c0b6633@mail.gmail.com>

On 24/05/07, Idoia Villaci?n Z?rate <fidita48@hotmail.com> wrote:
> I install apache, then python and later mod_phython and all intalls
> correctly, I read mod_python's tutorial and there I have the lines I have to
> write in apache's configuration file. After doing this when I restart apache
> everything goes ok. Untill here everything goes fine
>
> I continue reading the tutorial and there is an example of what I have to do
> to get Hello World!. I copy it exactly as is written in the phyton:

Perhaps go and read the email I sent to you instead and supply the
information that was requested of you, specifically I said:

"""If it is from the Apache error log file, then please provide more
output from the log file from before this error to give us context. If
it is truly mod_python that is getting triggered then the log file
will show other messages before this point that will confirm it. If
those lines aren't there, then your script may not be getting executed
by mod_python but in some CGI like manner which would account for the
error."""

You still haven't done this.

Also, don't create new messages every time you send to the mailing
list, instead use 'reply-all' so the followups are properly connected
to the original thread, else it just makes it harder to find the
information from your previous messages.

So go back now and copy the dozen lines either side of that error
message from your Apache error log file and post it to the list as
requested. Without this context we can't verify you are actually
triggering mod_python and not just CGI.

Graham


> from mod_python import apache
>
>
>
> def handler(req):
>
>         req.content_type = 'text/plain'
>
>         req.write("Hello World!")
>
>         return apache.OK
>
>
>
>
>
> So now, when I compile this program is when I get the error:
>
> Traceback (most recent call last):
>
>   File "C:\Archivos de programa\Apache Software
> Foundation\Apache2.2\htdocs\mptest.py", line 1, in ?
>
>     from mod_python import apache
>
>   File
> "C:\Python24\Lib\site-packages\mod_python\apache.py", line
> 30, in ?
>
>     import _apacheImportError: No module named _apache
>
>
> Do you know what can be the problem?

From l.montecchiani at teamsystem.com  Thu May 24 10:31:44 2007
From: l.montecchiani at teamsystem.com (Luca Montecchiani)
Date: Thu May 24 10:33:13 2007
Subject: [mod_python] StringField not pickable anymore with modpython 3.3.10
Message-ID: <4655A1D0.8090200@teamsystem.com>

Hi all,

in the process to convert our application from 3.2.10 to the
latest version 3.3.10 I've found a problem and an easy workaround.

In some places we need to pickle some form input data but with
the new version we can't do it anymore, the cPickle module
raise an error complain about a cStringIO object unpickability.

This was our workaround :

:
if type(v) == util.StringField:
     v = str(v)
tmp = cPickle.dumps(v,protocol=-1)
:

The same problem there is saving session objects that contain
a StringField, see the traceback:

   File "/projects/portale/20070102/ambiente/portale/core/python/lib/python2.5/site-packages/mod_python/Session.py", line 269, in save
     self.do_save(dict)

   File "/projects/portale/20070102/ambiente/portale/core/python/lib/python2.5/site-packages/mod_python/Session.py", line 407, in do_save
     dbm[self._sid] = cPickle.dumps(dict)

   File "/projects/portale/20070102/ambiente/portale/core/python/lib/python2.5/copy_reg.py", line 69, in _reduce_ex
     raise TypeError, "can't pickle %s objects" % base.__name__

   TypeError: can't pickle StringO objects

This mean that I need to convert to str() every StringField that I want
to put in a Session object :-((

Hope this help,
luca

-- 
Luca Montecchiani
Software Di Base
TeamSystem S.p.a.
------------------------------------------------------------------------------------------
Informativa ai sensi del D. Lgs. 196-30/06/2003.
Il contenuto di questa e.mail e degli eventuali allegati, deve essere nella disponibilit?
del solo destinatario.  Se ricevete per errore questa e-mail siete pregati di informarci
(rispedendola al mittente) e di provvedere alla sua rimozione.
Possono essere presenti informazioni riservate e non corrette (parzialmente o totalmente).
Le e-mail in partenza e in arrivo possono essere oggetto di monitoraggio
da parte di Teamsystem spa.  Del contenuto ? responsabile il mittente della presente.
Chiunque venga in possesso non autorizzato di questa e-mail ? vincolato
dalla Legge a non leggerne il contenuto, a non copiarla, a non diffonderla e a non usarla.
Informiamo che per l' esercizio dei diritti di cui all'art. 7 del d.lgs.196/2003 ci si pu?
rivolgere al Titolare del trattamento Teamsystem S.r.l. via Gagarin 205 61100 PESARO
per posta o fax, indicando sulla busta o sul foglio la dicitura "Inerente alla Privacy",
o inviando una e-mail all' indirizzo privacy@teamsystem.com .
------------------------------------------------------------------------------------------
From l.montecchiani at teamsystem.com  Thu May 24 11:15:13 2007
From: l.montecchiani at teamsystem.com (Luca Montecchiani)
Date: Thu May 24 11:16:39 2007
Subject: [mod_python] StringField eval() problem with modpython 3.3.10
Message-ID: <4655AC01.6070700@teamsystem.com>

The new 3.3.10 StringField object is driving me crazy
it is too way different from the 3.2.10 ones :-(((((

I've problems also with eval() and I need to patch
modpython this way or put str() _everywhere_


--- util.py.orig        Wed Nov 22 12:15:54 2006
+++ util.py     Thu May 24 17:10:17 2007
@@ -126,8 +126,7 @@
          return self.file

      def __repr__(self):
-        """Return printable representation (to pass unit tests)."""
-        return "Field(%s, %s)" % (`self.name`, `self.value`)
+        return self.value

  class FieldList(list):


Please help this is a big compatibly issue,
luca

-- 
Luca Montecchiani
Software Di Base
TeamSystem S.p.a.
------------------------------------------------------------------------------------------
Informativa ai sensi del D. Lgs. 196-30/06/2003.
Il contenuto di questa e.mail e degli eventuali allegati, deve essere nella disponibilit?
del solo destinatario.  Se ricevete per errore questa e-mail siete pregati di informarci
(rispedendola al mittente) e di provvedere alla sua rimozione.
Possono essere presenti informazioni riservate e non corrette (parzialmente o totalmente).
Le e-mail in partenza e in arrivo possono essere oggetto di monitoraggio
da parte di Teamsystem spa.  Del contenuto ? responsabile il mittente della presente.
Chiunque venga in possesso non autorizzato di questa e-mail ? vincolato
dalla Legge a non leggerne il contenuto, a non copiarla, a non diffonderla e a non usarla.
Informiamo che per l' esercizio dei diritti di cui all'art. 7 del d.lgs.196/2003 ci si pu?
rivolgere al Titolare del trattamento Teamsystem S.r.l. via Gagarin 205 61100 PESARO
per posta o fax, indicando sulla busta o sul foglio la dicitura "Inerente alla Privacy",
o inviando una e-mail all' indirizzo privacy@teamsystem.com .
------------------------------------------------------------------------------------------
From l.montecchiani at teamsystem.com  Thu May 24 17:36:56 2007
From: l.montecchiani at teamsystem.com (Luca Montecchiani)
Date: Thu May 24 17:38:28 2007
Subject: [mod_python] StringField patch for 3.3.10
Message-ID: <46560578.1080503@teamsystem.com>

Hi all,

after a while I figure out all the problems withe the new
StringField objects and I've cooked a patch that works for me.
The patch try to fix the following problems:

1- StringField not pickable anymore with modpython 3.3.10
2- StringField eval() problem with modpython 3.3.10
3- avoid to put the entire file content on Field __repr__ method

please let me know if this could be an acceptable way to address
all this compatibility problems.

thanks in advance,
luca

-- 
Luca Montecchiani
Software Di Base
TeamSystem S.p.a.
------------------------------------------------------------------------------------------
Informativa ai sensi del D. Lgs. 196-30/06/2003.
Il contenuto di questa e.mail e degli eventuali allegati, deve essere nella disponibilit?
del solo destinatario.  Se ricevete per errore questa e-mail siete pregati di informarci
(rispedendola al mittente) e di provvedere alla sua rimozione.
Possono essere presenti informazioni riservate e non corrette (parzialmente o totalmente).
Le e-mail in partenza e in arrivo possono essere oggetto di monitoraggio
da parte di Teamsystem spa.  Del contenuto ? responsabile il mittente della presente.
Chiunque venga in possesso non autorizzato di questa e-mail ? vincolato
dalla Legge a non leggerne il contenuto, a non copiarla, a non diffonderla e a non usarla.
Informiamo che per l' esercizio dei diritti di cui all'art. 7 del d.lgs.196/2003 ci si pu?
rivolgere al Titolare del trattamento Teamsystem S.r.l. via Gagarin 205 61100 PESARO
per posta o fax, indicando sulla busta o sul foglio la dicitura "Inerente alla Privacy",
o inviando una e-mail all' indirizzo privacy@teamsystem.com .
------------------------------------------------------------------------------------------
-------------- next part --------------
--- util.py.orig	Wed Nov 22 12:15:54 2006
+++ util.py	Thu May 24 23:06:42 2007
@@ -83,7 +83,12 @@
 
     def __repr__(self):
         """Return printable representation."""
-        return "Field(%s, %s)" % (`self.name`, `self.value`)
+        if self.file:
+            # avoid to put the entire file content in the
+            # returned string !
+            return "Field(%s, %s)" % (`self.name`, `self.filename`)
+        else:
+            return "Field(%s, %s)" % (`self.name`, `self.value`)
 
     def __getattr__(self, name):
         if name != 'value':
@@ -126,8 +131,8 @@
         return self.file
         
     def __repr__(self):
-        """Return printable representation (to pass unit tests)."""
-        return "Field(%s, %s)" % (`self.name`, `self.value`)
+        # this is necessary if you want to eval a StringField
+        return self.value
 
 class FieldList(list):
 
@@ -330,15 +335,18 @@
             if disp_options.has_key("filename"):
                 field = Field(name)
                 field.filename = disp_options["filename"]
+                # file and headers attributes are only
+                # for Field objects because they will make
+                # a StringField unpickable
+                field.file = file
+                field.headers = headers
             else:
                 field = StringField(file.read())
                 field.name = name
-            field.file = file
             field.type = ctype
             field.type_options = type_options
             field.disposition = disp
             field.disposition_options = disp_options
-            field.headers = headers
             self.list.append(field)
 
     def add_field(self, key, value):
From graham.dumpleton at gmail.com  Thu May 24 18:18:56 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu May 24 18:19:02 2007
Subject: [mod_python] StringField patch for 3.3.10
In-Reply-To: <46560578.1080503@teamsystem.com>
References: <46560578.1080503@teamsystem.com>
Message-ID: <88e286470705241518s5de9facfwe83366a3ece613c0@mail.gmail.com>

We can look at your changes, but the documentation does say about the
Field class:

"""This class is used internally by FieldStorage and is not meant to
be instantiated by the user."""

In other words it is an implementation detail and you perhaps
shouldn't be expecting it to be able to be pickled and unpickled, the
later equating to instantiation by the user.

You would perhaps be better off using the public API to translate the
form/fields into a neutral format and then doing the pickle on that.

BTW, I presume you meant 3.3.1 rather than 3.3.10.

Graham

On 25/05/07, Luca Montecchiani <l.montecchiani@teamsystem.com> wrote:
> Hi all,
>
> after a while I figure out all the problems withe the new
> StringField objects and I've cooked a patch that works for me.
> The patch try to fix the following problems:
>
> 1- StringField not pickable anymore with modpython 3.3.10
> 2- StringField eval() problem with modpython 3.3.10
> 3- avoid to put the entire file content on Field __repr__ method
>
> please let me know if this could be an acceptable way to address
> all this compatibility problems.
>
> thanks in advance,
> luca
>
> --
> Luca Montecchiani
> Software Di Base
> TeamSystem S.p.a.
> ------------------------------------------------------------------------------------------
> Informativa ai sensi del D. Lgs. 196-30/06/2003.
> Il contenuto di questa e.mail e degli eventuali allegati, deve essere nella disponibilit?
> del solo destinatario.  Se ricevete per errore questa e-mail siete pregati di informarci
> (rispedendola al mittente) e di provvedere alla sua rimozione.
> Possono essere presenti informazioni riservate e non corrette (parzialmente o totalmente).
> Le e-mail in partenza e in arrivo possono essere oggetto di monitoraggio
> da parte di Teamsystem spa.  Del contenuto ? responsabile il mittente della presente.
> Chiunque venga in possesso non autorizzato di questa e-mail ? vincolato
> dalla Legge a non leggerne il contenuto, a non copiarla, a non diffonderla e a non usarla.
> Informiamo che per l' esercizio dei diritti di cui all'art. 7 del d.lgs.196/2003 ci si pu?
> rivolgere al Titolare del trattamento Teamsystem S.r.l. via Gagarin 205 61100 PESARO
> per posta o fax, indicando sulla busta o sul foglio la dicitura "Inerente alla Privacy",
> o inviando una e-mail all' indirizzo privacy@teamsystem.com .
> ------------------------------------------------------------------------------------------
>
> --- util.py.orig        Wed Nov 22 12:15:54 2006
> +++ util.py     Thu May 24 23:06:42 2007
> @@ -83,7 +83,12 @@
>
>      def __repr__(self):
>          """Return printable representation."""
> -        return "Field(%s, %s)" % (`self.name`, `self.value`)
> +        if self.file:
> +            # avoid to put the entire file content in the
> +            # returned string !
> +            return "Field(%s, %s)" % (`self.name`, `self.filename`)
> +        else:
> +            return "Field(%s, %s)" % (`self.name`, `self.value`)
>
>      def __getattr__(self, name):
>          if name != 'value':
> @@ -126,8 +131,8 @@
>          return self.file
>
>      def __repr__(self):
> -        """Return printable representation (to pass unit tests)."""
> -        return "Field(%s, %s)" % (`self.name`, `self.value`)
> +        # this is necessary if you want to eval a StringField
> +        return self.value
>
>  class FieldList(list):
>
> @@ -330,15 +335,18 @@
>              if disp_options.has_key("filename"):
>                  field = Field(name)
>                  field.filename = disp_options["filename"]
> +                # file and headers attributes are only
> +                # for Field objects because they will make
> +                # a StringField unpickable
> +                field.file = file
> +                field.headers = headers
>              else:
>                  field = StringField(file.read())
>                  field.name = name
> -            field.file = file
>              field.type = ctype
>              field.type_options = type_options
>              field.disposition = disp
>              field.disposition_options = disp_options
> -            field.headers = headers
>              self.list.append(field)
>
>      def add_field(self, key, value):
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>

From nlv11281 at natlab.research.philips.com  Fri May 25 02:28:43 2007
From: nlv11281 at natlab.research.philips.com (Mike Looijmans)
Date: Fri May 25 02:28:55 2007
Subject: [mod_python] StringField patch for 3.3.10
Message-ID: <4656821B.8050906@natlab.research.philips.com>

Since I'm the one responsible for the StringField redesign in 3.3, I feel obliged to respond.

The suggested changes will break a lot more than they will fix. The strange implementation of the
__repr__ functions have been done that way to remain compatible with the existing code. The
StringField and Field classes (there used to be only one in mod_python 3.2) were made to be
compatible with the CGI version of fields.

The StringField can be made picklable by adding a __getstate__ and, if needed, a __setstate__
function, which will not break existing code. Probably, something like this will do (untested code):

...
     def __getstate__(self):
         return {'name': self.name, 'value': self.value}
...

That is a change that we could commit into the SVN archive i guess.

A Field instance (uploaded file with no size limit) should never be pickled - it contains a handle
to a file that will be deleted when the current request handler ends.

Graham's suggestion to translate the fields into something neutral, i suggest using a dictonary, is
simple enough, so I strongly advise taking that route.

--
Mike Looijmans
Philips Natlab / Topic Automation


Graham Dumpleton wrote:
> We can look at your changes, but the documentation does say about the
> Field class:
> 
> """This class is used internally by FieldStorage and is not meant to
> be instantiated by the user."""
> 
> In other words it is an implementation detail and you perhaps
> shouldn't be expecting it to be able to be pickled and unpickled, the
> later equating to instantiation by the user.
> 
> You would perhaps be better off using the public API to translate the
> form/fields into a neutral format and then doing the pickle on that.
> 
> BTW, I presume you meant 3.3.1 rather than 3.3.10.
> 
> Graham
> 
> On 25/05/07, Luca Montecchiani <l.montecchiani@teamsystem.com> wrote:
> 
>> Hi all,
>>
>> after a while I figure out all the problems withe the new
>> StringField objects and I've cooked a patch that works for me.
>> The patch try to fix the following problems:
>>
>> 1- StringField not pickable anymore with modpython 3.3.10
>> 2- StringField eval() problem with modpython 3.3.10
>> 3- avoid to put the entire file content on Field __repr__ method
>>
>> please let me know if this could be an acceptable way to address
>> all this compatibility problems.
>>
>> thanks in advance,
>> luca
>>
>> -- 
>> Luca Montecchiani
>> Software Di Base
>> TeamSystem S.p.a.
>> ------------------------------------------------------------------------------------------ 
>>
>> Informativa ai sensi del D. Lgs. 196-30/06/2003.
>> Il contenuto di questa e.mail e degli eventuali allegati, deve essere 
>> nella disponibilit?
>> del solo destinatario.  Se ricevete per errore questa e-mail siete 
>> pregati di informarci
>> (rispedendola al mittente) e di provvedere alla sua rimozione.
>> Possono essere presenti informazioni riservate e non corrette 
>> (parzialmente o totalmente).
>> Le e-mail in partenza e in arrivo possono essere oggetto di monitoraggio
>> da parte di Teamsystem spa.  Del contenuto ? responsabile il mittente 
>> della presente.
>> Chiunque venga in possesso non autorizzato di questa e-mail ? vincolato
>> dalla Legge a non leggerne il contenuto, a non copiarla, a non 
>> diffonderla e a non usarla.
>> Informiamo che per l' esercizio dei diritti di cui all'art. 7 del 
>> d.lgs.196/2003 ci si pu?
>> rivolgere al Titolare del trattamento Teamsystem S.r.l. via Gagarin 
>> 205 61100 PESARO
>> per posta o fax, indicando sulla busta o sul foglio la dicitura 
>> "Inerente alla Privacy",
>> o inviando una e-mail all' indirizzo privacy@teamsystem.com .
>> ------------------------------------------------------------------------------------------ 
>>
>>
>> --- util.py.orig        Wed Nov 22 12:15:54 2006
>> +++ util.py     Thu May 24 23:06:42 2007
>> @@ -83,7 +83,12 @@
>>
>>      def __repr__(self):
>>          """Return printable representation."""
>> -        return "Field(%s, %s)" % (`self.name`, `self.value`)
>> +        if self.file:
>> +            # avoid to put the entire file content in the
>> +            # returned string !
>> +            return "Field(%s, %s)" % (`self.name`, `self.filename`)
>> +        else:
>> +            return "Field(%s, %s)" % (`self.name`, `self.value`)
>>
>>      def __getattr__(self, name):
>>          if name != 'value':
>> @@ -126,8 +131,8 @@
>>          return self.file
>>
>>      def __repr__(self):
>> -        """Return printable representation (to pass unit tests)."""
>> -        return "Field(%s, %s)" % (`self.name`, `self.value`)
>> +        # this is necessary if you want to eval a StringField
>> +        return self.value
>>
>>  class FieldList(list):
>>
>> @@ -330,15 +335,18 @@
>>              if disp_options.has_key("filename"):
>>                  field = Field(name)
>>                  field.filename = disp_options["filename"]
>> +                # file and headers attributes are only
>> +                # for Field objects because they will make
>> +                # a StringField unpickable
>> +                field.file = file
>> +                field.headers = headers
>>              else:
>>                  field = StringField(file.read())
>>                  field.name = name
>> -            field.file = file
>>              field.type = ctype
>>              field.type_options = type_options
>>              field.disposition = disp
>>              field.disposition_options = disp_options
>> -            field.headers = headers
>>              self.list.append(field)
>>
>>      def add_field(self, key, value):
>>
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>
>>
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 
> 


-- 
Mike Looijmans
Philips Natlab / Topic Automation


From l.montecchiani at teamsystem.com  Fri May 25 03:26:50 2007
From: l.montecchiani at teamsystem.com (Luca Montecchiani)
Date: Fri May 25 03:28:26 2007
Subject: [mod_python] StringField patch for 3.3.10
In-Reply-To: <88e286470705241518s5de9facfwe83366a3ece613c0@mail.gmail.com>
References: <46560578.1080503@teamsystem.com>
	<88e286470705241518s5de9facfwe83366a3ece613c0@mail.gmail.com>
Message-ID: <46568FBA.8030203@teamsystem.com>

Graham Dumpleton wrote:
> We can look at your changes, but the documentation does say about the
> Field class:
> 
> """This class is used internally by FieldStorage and is not meant to
> be instantiated by the user."""
> 
> In other words it is an implementation detail and you perhaps
> shouldn't be expecting it to be able to be pickled and unpickled, the
> later equating to instantiation by the user.

This is true but think about code like this :

myname = req.form['myname']

with version 3.2.10 you could forget about the type
of "myname" variable, now with 3.3.1 version you can't
pickle or eval "myname" _anymore_ .
IMHO this is a compatibility issue.

> You would perhaps be better off using the public API to translate the
> form/fields into a neutral format and then doing the pickle on that.

I'm seriously thinking about this, of course this overhead
will slow down my application a bit :-((

> BTW, I presume you meant 3.3.1 rather than 3.3.10.

Of course, my bad.

One more point is about the Field __repr__ method
that dump all the content of an uploaded file in a
printable form, this fill up my logs heavily !!

later,
luca

-- 
Luca Montecchiani
Software Di Base
TeamSystem S.p.a.
------------------------------------------------------------------------------------------
Informativa ai sensi del D. Lgs. 196-30/06/2003.
Il contenuto di questa e.mail e degli eventuali allegati, deve essere nella disponibilit?
del solo destinatario.  Se ricevete per errore questa e-mail siete pregati di informarci
(rispedendola al mittente) e di provvedere alla sua rimozione.
Possono essere presenti informazioni riservate e non corrette (parzialmente o totalmente).
Le e-mail in partenza e in arrivo possono essere oggetto di monitoraggio
da parte di Teamsystem spa.  Del contenuto ? responsabile il mittente della presente.
Chiunque venga in possesso non autorizzato di questa e-mail ? vincolato
dalla Legge a non leggerne il contenuto, a non copiarla, a non diffonderla e a non usarla.
Informiamo che per l' esercizio dei diritti di cui all'art. 7 del d.lgs.196/2003 ci si pu?
rivolgere al Titolare del trattamento Teamsystem S.r.l. via Gagarin 205 61100 PESARO
per posta o fax, indicando sulla busta o sul foglio la dicitura "Inerente alla Privacy",
o inviando una e-mail all' indirizzo privacy@teamsystem.com .
------------------------------------------------------------------------------------------
From l.montecchiani at teamsystem.com  Fri May 25 03:33:44 2007
From: l.montecchiani at teamsystem.com (Luca Montecchiani)
Date: Fri May 25 03:35:17 2007
Subject: [mod_python] StringField patch for 3.3.10
In-Reply-To: <4656821B.8050906@natlab.research.philips.com>
References: <4656821B.8050906@natlab.research.philips.com>
Message-ID: <46569158.6000506@teamsystem.com>

Mike Looijmans wrote:
> The suggested changes will break a lot more than they will fix. The 
> strange implementation of the
> __repr__ functions have been done that way to remain compatible with the 
> existing code. 

read my reply to Graham, 3.3.1 is not compatible with 3.2.10 IMHO

> The StringField can be made picklable by adding a __getstate__ and, if 
> needed, a __setstate__
> function, which will not break existing code. Probably, something like 
> this will do (untested code):
> 
> ...
>     def __getstate__(self):
>         return {'name': self.name, 'value': self.value}
> ...

I try it and I can tell you that works.

> That is a change that we could commit into the SVN archive i guess.

Two other problems remain open:

- StringField eval() problem with modpython 3.3.10

This could be solved using the Graham's suggestion
it's up to you if this is a big compatibility issue

- avoid to put the entire file content on Field __repr__ method

This could be solved using the Graham's suggestion
but I really don't like the idea of filling up a string with
a 4x time the size of an uploaded binary file ;-)
BTW this is in 3.2.10 too.

> A Field instance (uploaded file with no size limit) should never be 
> pickled - it contains a handle
> to a file that will be deleted when the current request handler ends.

Yes I know and my pickle function check for data type, and only
StringField,str and other basic type was allowed to be pickled.

Looking at 3.3.1 util.py :

     329             # make a Field
     330             if disp_options.has_key("filename"):
     331                 field = Field(name)
     332                 field.filename = disp_options["filename"]
     333             else:
     334                 field = StringField(file.read())
     335                 field.name = name
     336             field.file = file

Why always assign the "file" member ? The docs says it works on demand
and for StringField could be omitted preserving resource :

     329             # make a Field
     330             if disp_options.has_key("filename"):
     331                 field = Field(name)
     332                 field.filename = disp_options["filename"]
     333                 field.file = file
     334             else:
     335                 field = StringField(file.read())
     336                 field.name = name

> Graham's suggestion to translate the fields into something neutral, i 
> suggest using a dictonary, is
> simple enough, so I strongly advise taking that route.

I'm going that way and I will happy if this thread will
improve mopython internals.

thanks again,
luca

-- 
Luca Montecchiani
Software Di Base
TeamSystem S.p.a.
------------------------------------------------------------------------------------------
Informativa ai sensi del D. Lgs. 196-30/06/2003.
Il contenuto di questa e.mail e degli eventuali allegati, deve essere nella disponibilit?
del solo destinatario.  Se ricevete per errore questa e-mail siete pregati di informarci
(rispedendola al mittente) e di provvedere alla sua rimozione.
Possono essere presenti informazioni riservate e non corrette (parzialmente o totalmente).
Le e-mail in partenza e in arrivo possono essere oggetto di monitoraggio
da parte di Teamsystem spa.  Del contenuto ? responsabile il mittente della presente.
Chiunque venga in possesso non autorizzato di questa e-mail ? vincolato
dalla Legge a non leggerne il contenuto, a non copiarla, a non diffonderla e a non usarla.
Informiamo che per l' esercizio dei diritti di cui all'art. 7 del d.lgs.196/2003 ci si pu?
rivolgere al Titolare del trattamento Teamsystem S.r.l. via Gagarin 205 61100 PESARO
per posta o fax, indicando sulla busta o sul foglio la dicitura "Inerente alla Privacy",
o inviando una e-mail all' indirizzo privacy@teamsystem.com .
------------------------------------------------------------------------------------------
From l.montecchiani at teamsystem.com  Fri May 25 04:09:04 2007
From: l.montecchiani at teamsystem.com (Luca Montecchiani)
Date: Fri May 25 04:10:36 2007
Subject: [mod_python] StringField patch for 3.3.10
In-Reply-To: <88e286470705241518s5de9facfwe83366a3ece613c0@mail.gmail.com>
References: <46560578.1080503@teamsystem.com>
	<88e286470705241518s5de9facfwe83366a3ece613c0@mail.gmail.com>
Message-ID: <465699A0.1070906@teamsystem.com>

Graham Dumpleton wrote:
:
> You would perhaps be better off using the public API to translate the
> form/fields into a neutral format and then doing the pickle on that.
:

I've just made it your way and everything works like a charm with
the unmodified modpython 3.3.1 ;-)

With this approach I've also removed all the annoying type(xx) == StringField
in all my code, much better now.

I'm just worried about Field __repr__ and the (unnecessary?) StringField.file
assignment now

thanks,
luca

-- 
Luca Montecchiani
Software Di Base
TeamSystem S.p.a.
------------------------------------------------------------------------------------------
Informativa ai sensi del D. Lgs. 196-30/06/2003.
Il contenuto di questa e.mail e degli eventuali allegati, deve essere nella disponibilit?
del solo destinatario.  Se ricevete per errore questa e-mail siete pregati di informarci
(rispedendola al mittente) e di provvedere alla sua rimozione.
Possono essere presenti informazioni riservate e non corrette (parzialmente o totalmente).
Le e-mail in partenza e in arrivo possono essere oggetto di monitoraggio
da parte di Teamsystem spa.  Del contenuto ? responsabile il mittente della presente.
Chiunque venga in possesso non autorizzato di questa e-mail ? vincolato
dalla Legge a non leggerne il contenuto, a non copiarla, a non diffonderla e a non usarla.
Informiamo che per l' esercizio dei diritti di cui all'art. 7 del d.lgs.196/2003 ci si pu?
rivolgere al Titolare del trattamento Teamsystem S.r.l. via Gagarin 205 61100 PESARO
per posta o fax, indicando sulla busta o sul foglio la dicitura "Inerente alla Privacy",
o inviando una e-mail all' indirizzo privacy@teamsystem.com .
------------------------------------------------------------------------------------------
From David.Bear at asu.edu  Fri May 25 15:58:18 2007
From: David.Bear at asu.edu (David Bear)
Date: Fri May 25 16:02:53 2007
Subject: [mod_python] restful discussion on handler
Message-ID: <20070525195818.GG9131@asu.edu>

recently there was some discussion of implementing a restful api using
the publisher handler.

I'm wondering if anyone has any code use the python-program handler?

I would like to see how to properly handle parsing the req url and
dispatching from that. I liked the way publisher would provide a url
to call a function. It seems that it would just be safer to have one
functions 'handler' that would be used as the single entry point to
all 'dispatching'.


-- 
David Bear
phone: 	602-496-0424
fax: 	602-496-0955
College of Public Programs/ASU
University Center Rm 622
411 N Central
Phoenix, AZ 85007-0685
 "Beware the IP portfolio, everyone will be suspect of trespassing"
From amorey at octopart.com  Fri May 25 16:27:19 2007
From: amorey at octopart.com (Andres Morey)
Date: Fri May 25 16:27:29 2007
Subject: [mod_python] MySQL connections not closing properly
In-Reply-To: <EDA51779D3476A478E1F599389255F580F46E6@AVN3VS004.ees.hhs.gov>
References: <EDA51779D3476A478E1F599389255F580F46E6@AVN3VS004.ees.hhs.gov>
Message-ID: <41B623DE-5999-4946-B206-DDD5917F6891@octopart.com>

Hi,

I am using mod_python 3.3.1 with Python 2.5, Apache 2.2.4, MySQL  
5.0.27 and MySQLdb 1.2.2. When I stop the server I get "Aborted  
connection" warnings in MySQL even though I am closing the database  
connections properly when an object goes out of scope (by using the  
__del__ method). These warnings only happen when a python instance  
with an open database connection is killed abruptly, so I think it  
has something to do with the way that mod_python shuts down the  
python interpreter.

How does mod_python shut down the python interpreter? Is there a good  
way to handle when mod_python shuts down the python interpreter?

Thanks,
Andres

From graham.dumpleton at gmail.com  Fri May 25 19:04:26 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Fri May 25 19:04:42 2007
Subject: [mod_python] restful discussion on handler
In-Reply-To: <20070525195818.GG9131@asu.edu>
References: <20070525195818.GG9131@asu.edu>
Message-ID: <88e286470705251604m6afaacf7qa0b58886ab5cc412@mail.gmail.com>

On 26/05/07, David Bear <David.Bear@asu.edu> wrote:
> recently there was some discussion of implementing a restful api using
> the publisher handler.

Strictly speaking, the publisher handler cannot be used to implement a
true REST API as it only allows GET/POST and not other HTTP method
types.

> I'm wondering if anyone has any code use the python-program handler?

The publisher handler is still a handler and is itself one example of
doing dispatching which you can look at, it probably just does more
than what you are after by what you have said before. Doesn't mean you
can't learn from it.

> I would like to see how to properly handle parsing the req url and
> dispatching from that. I liked the way publisher would provide a url
> to call a function. It seems that it would just be safer to have one
> functions 'handler' that would be used as the single entry point to
> all 'dispatching'.

Overall am still not sure how you are expecting the URL mapping to
work. There are few levels one could go to.

The first is to only map as far as the file. For example, a URL would
map to a standard handler() function in the file. If there is
additional path information after the portion of the URL that mapped
to the file, it would be up to the handler in the file to deal with.

The second is for the dispatcher to take the additional path
information and then map that into objects contained within the file.
One could when doing this one could allow functions to be called with
standard handler prototype and response, or one could could do like
publisher and transform form arguments into arguments and change how
the return value is treated. The publisher handler also allows one to
reference variables and have the string representation of them
changed.

When mapping URL to objects within a file, one can again either
require that the full URL be mapped, like publisher does, or still
allow further path information for the nested handler to deal with.

Implementing code to go to file level only is pretty trivial, but
implementing traversing of objects etc becomes harder.

Thus, what are you actually after?

To get some ideas, you may want to have a look at what Vampire can do.
Through various means and at the option of the user, it can extend
through all levels.

You can find Vampire documentation at:

  http://www.dscpl.com.au/projects/vampire/articles.html

Graham
From graham.dumpleton at gmail.com  Fri May 25 19:08:48 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Fri May 25 19:08:55 2007
Subject: [mod_python] MySQL connections not closing properly
In-Reply-To: <41B623DE-5999-4946-B206-DDD5917F6891@octopart.com>
References: <EDA51779D3476A478E1F599389255F580F46E6@AVN3VS004.ees.hhs.gov>
	<41B623DE-5999-4946-B206-DDD5917F6891@octopart.com>
Message-ID: <88e286470705251608p34dcb987gdefda94fd83a2400@mail.gmail.com>

There is no guarantee that objects will be destroyed when the process
exits, so you cant rely on __del__ methods being triggered. In fact,
mod_python as it is doesn't currently even shutdown Python
interpreters on normal process exit as it was causing hangs and other
errors. I actually know now why this was the case and how to fix it
but lot of work to fix it all up.

The preferred way at the moment is to register cleanup functions for
mod_python to call on process shutdown. This can be done using
apache.register_cleanup(). See documentation for register_cleanup()
in:

  http://www.modpython.org/live/current/doc-html/pyapi-apmeth.html

Graham

On 26/05/07, Andres Morey <amorey@octopart.com> wrote:
> Hi,
>
> I am using mod_python 3.3.1 with Python 2.5, Apache 2.2.4, MySQL
> 5.0.27 and MySQLdb 1.2.2. When I stop the server I get "Aborted
> connection" warnings in MySQL even though I am closing the database
> connections properly when an object goes out of scope (by using the
> __del__ method). These warnings only happen when a python instance
> with an open database connection is killed abruptly, so I think it
> has something to do with the way that mod_python shuts down the
> python interpreter.
>
> How does mod_python shut down the python interpreter? Is there a good
> way to handle when mod_python shuts down the python interpreter?
>
> Thanks,
> Andres
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From fidita48 at hotmail.com  Sat May 26 07:24:34 2007
From: fidita48 at hotmail.com (=?iso-8859-1?B?SWRvaWEgVmlsbGFjaeFuIFrhcmF0ZQ==?=)
Date: Sat May 26 07:24:46 2007
Subject: [mod_python] Error
Message-ID: <BAY137-F27F334BF0512C9CDF2C75ED42A0@phx.gbl>

An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070526/f8de56e6/attachment-0001.html
From graham.dumpleton at gmail.com  Sat May 26 07:36:53 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sat May 26 07:37:02 2007
Subject: [mod_python] Error
In-Reply-To: <BAY137-F27F334BF0512C9CDF2C75ED42A0@phx.gbl>
References: <BAY137-F27F334BF0512C9CDF2C75ED42A0@phx.gbl>
Message-ID: <88e286470705260436i42aec65dr6eb0f5e78a86c684@mail.gmail.com>

I was hoping for the region of the log file which also showed your error:

Traceback (most recent call last):

  File "C:\Archivos de programa\Apache Software
Foundation\Apache2.2\htdocs\mptest.py", line 1, in ?

    from mod_python import apache

  File "C:\Python24\Lib\site-packages\mod_python\apache.py", line 30, in ?

    import _apache
ImportError: No module named _apache

embedded within the middle of it.

Ie., something like:

[Mon Apr 09 13:30:15 2007] [error] [client 127.0.0.1] mod_python
(pid=7293, interpreter='grumpy.local', phase='PythonHandler',
handler='paste.modpython'): Application error
[Mon Apr 09 13:30:15 2007] [error] [client 127.0.0.1] ServerName:
'grumpy.local'[Mon Apr 09 13:30:15 2007] [error] [client 127.0.0.1]
DocumentRoot: '/usr/local/apache-2.2/htdocs'
[Mon Apr 09 13:30:15 2007] [error] [client 127.0.0.1] URI:
'/mod_python/hello'[Mon Apr 09 13:30:15 2007] [error] [client
127.0.0.1] Location: '/mod_python/hello'[Mon Apr 09 13:30:15 2007]
[error] [client 127.0.0.1] Directory: None
[Mon Apr 09 13:30:15 2007] [error] [client 127.0.0.1] Filename:
'/usr/local/apache-2.2/htdocs/mod_python'
[Mon Apr 09 13:30:15 2007] [error] [client 127.0.0.1] PathInfo: '/hello'
[Mon Apr 09 13:30:15 2007] [error] [client 127.0.0.1] Traceback (most
recent call last):
[Mon Apr 09 13:30:15 2007] [error] [client 127.0.0.1]   File
"/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site-packages/mod_python/importer.py",
line 1537, in HandlerDispatch\n    default=default_handler, arg=req,
silent=hlist.silent)[Mon Apr 09 13:30:15 2007] [error] [client
127.0.0.1]   File
"/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site-packages/mod_python/importer.py",
line 1229, in _process_target\n    result = _execute_target(config,
req, object, arg)[Mon Apr 09 13:30:15 2007] [error] [client 127.0.0.1]
  File "/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site-packages/mod_python/importer.py",
line 1128, in _execute_target\n    result = object(arg)[Mon Apr 09
13:30:15 2007] [error] [client 127.0.0.1]   File
"/Library/Python/2.3/site-packages/Paste-1.2.1-py2.3.egg/paste/modpython.py",
line 246, in handler\n    module = __import__(modname, globals(),
locals(), [''])[Mon Apr 09 13:30:15 2007] [error] [client 127.0.0.1]
File "/usr/local/wsgi/scripts/hello.py", line 3, in ?\n    import
mod_wsgi[Mon Apr 09 13:30:15 2007] [error] [client 127.0.0.1]
ImportError: No module named mod_wsgi

The thing I just realised though is that your error message can't be a
result of a failure of mod_python as the way mod_python logs
tracebacks means that the details would have the timestamp information
prefixing each line like above. That they don't appear means your
script is probably most definitely being executed as a CGI script and
not by mod_python.

Thus I would suggest you have a configuration problem with HTTP.
Specifically, you have CGI scripts enabled for that directory, or for
the .py extension.

What do you have elsewhere in your Apache configuration relating to
CGI scripts. Do you have anything like:

  AddHandler cgi-script .py

or:

  Options ExecCGI

Find that section of your configuration and reply-all and quote it.

Graham



On 26/05/07, Idoia Villaci?n Z?rate <fidita48@hotmail.com> wrote:
>
>
> I'm sorry, I didn't know I have to send back the mails, I'll do it from now.
>
>
>
> here I send you the lines of apache's log error:
>
> [Sat May 26 12:42:26 2007] [notice] Apache/2.2.4 (Win32) configured --
> resuming normal operations
>
> [Sat May 26 12:42:26 2007] [notice] Server built: Jan  9 2007 23:17:20
>
> [Sat May 26 12:42:26 2007] [notice] Parent: Created child process 1604
>
> [Sat May 26 12:42:27 2007] [notice] Child 1604: Child process is running
>
> [Sat May 26 12:42:27 2007] [notice] Child 1604: Acquired the start mutex.
>
> [Sat May 26 12:42:27 2007] [notice] Child 1604: Starting 250 worker threads.
>
> [Sat May 26 12:42:27 2007] [notice] Child 1604: Starting thread to listen on
> port 80.
>
> [Sat May 26 12:59:04 2007] [notice] Parent: Received restart signal --
> Restarting the server.
>
> [Sat May 26 12:59:04 2007] [notice] Child 1604: Exit event signaled. Child
> process is ending.
>
> [Sat May 26 12:59:04 2007] [notice] Apache/2.2.4 (Win32) configured --
> resuming normal operations
>
> [Sat May 26 12:59:04 2007] [notice] Server built: Jan  9 2007 23:17:20
>
> [Sat May 26 12:59:04 2007] [notice] Parent: Created child process 5332
>
> [Sat May 26 12:59:05 2007] [error] python_init: Python version mismatch,
> expected '2.4.3', found '2.4.4'.
>
> [Sat May 26 12:59:05 2007] [error] python_init: Python executable found
> 'C:\\Archivos de programa\\Apache Software
> Foundation\\Apache2.2\\bin\\httpd.exe'.
>
> [Sat May 26 12:59:05 2007] [error] python_init: Python path being used
> 'C:\\WINDOWS\\system32\\python24.zip;C:\\Python24\\Lib;C:\\Python24\\DLLs;C:\\Python24\\Lib\\lib-tk;;C:\\Archivos
> de programa\\Apache Software Foundation\\Apache2.2\\bin'.
>
> [Sat May 26 12:59:05 2007] [notice] mod_python: Creating 8 session mutexes
> based on 0 max processes and 250 max threads.
>
> [Sat May 26 12:59:05 2007] [notice] Child 5332: Child process is running
>
> [Sat May 26 12:59:05 2007] [notice] Child 1604: Released the start mutex
>
> [Sat May 26 12:59:05 2007] [notice] Child 5332: Acquired the start mutex.
>
> [Sat May 26 12:59:05 2007] [notice] Child 5332: Starting 250 worker threads.
>
> [Sat May 26 12:59:06 2007] [notice] Child 1604: Waiting for 250 worker
> threads to exit.
>
> [Sat May 26 12:59:06 2007] [notice] Child 1604: All worker threads have
> exited.
>
> [Sat May 26 12:59:06 2007] [notice] Child 1604: Child process is exiting
>
> [Sat May 26 12:59:06 2007] [notice] Child 5332: Starting thread to listen on
> port 80.
>
> [Sat May 26 13:00:22 2007] [notice] Parent: Received restart signal --
> Restarting the server.
>
> [Sat May 26 13:00:22 2007] [notice] Child 5332: Exit event signaled. Child
> process is ending.
>
> [Sat May 26 13:00:22 2007] [notice] Apache/2.2.4 (Win32) configured --
> resuming normal operations
>
> [Sat May 26 13:00:22 2007] [notice] Server built: Jan  9 2007 23:17:20
>
> [Sat May 26 13:00:22 2007] [notice] Parent: Created child process 3408
>
> [Sat May 26 13:00:22 2007] [error] python_init: Python version mismatch,
> expected '2.4.3', found '2.4.4'.
>
> [Sat May 26 13:00:22 2007] [error] python_init: Python executable found
> 'C:\\Archivos de programa\\Apache Software
> Foundation\\Apache2.2\\bin\\httpd.exe'.
>
> [Sat May 26 13:00:22 2007] [error] python_init: Python path being used
> 'C:\\WINDOWS\\system32\\python24.zip;C:\\Python24\\Lib;C:\\Python24\\DLLs;C:\\Python24\\Lib\\lib-tk;;C:\\Archivos
> de programa\\Apache Software Foundation\\Apache2.2\\bin'.
>
> [Sat May 26 13:00:22 2007] [notice] mod_python: Creating 8 session mutexes
> based on 0 max processes and 250 max threads.
>
> [Sat May 26 13:00:22 2007] [notice] Child 3408: Child process is running
>
> [Sat May 26 13:00:23 2007] [notice] Child 5332: Released the start mutex
>
> [Sat May 26 13:00:23 2007] [notice] Child 3408: Acquired the start mutex.
>
> [Sat May 26 13:00:23 2007] [notice] Child 3408: Starting 250 worker threads.
>
> [Sat May 26 13:00:23 2007] [notice] Child 3408: Starting thread to listen on
> port 80.
>
> [Sat May 26 13:00:24 2007] [notice] Child 5332: Waiting for 250 worker
> threads to exit.
>
> [Sat May 26 13:00:24 2007] [notice] Child 5332: All worker threads have
> exited.
>
> [Sat May 26 13:00:24 2007] [notice] Child 5332: Child process is exiting
>
> [Sat May 26 13:06:54 2007] [notice] Parent: Received restart signal --
> Restarting the server.
>
> [Sat May 26 13:06:54 2007] [notice] Child 3408: Exit event signaled. Child
> process is ending.
>
> [Sat May 26 13:06:54 2007] [notice] Apache/2.2.4 (Win32) configured --
> resuming normal operations
>
> [Sat May 26 13:06:54 2007] [notice] Server built: Jan  9 2007 23:17:20
>
> [Sat May 26 13:06:54 2007] [notice] Parent: Created child process 6388
>
> [Sat May 26 13:06:54 2007] [error] python_init: Python version mismatch,
> expected '2.4.3', found '2.4.4'.
>
> [Sat May 26 13:06:54 2007] [error] python_init: Python executable found
> 'C:\\Archivos de programa\\Apache Software
> Foundation\\Apache2.2\\bin\\httpd.exe'.
>
> [Sat May 26 13:06:54 2007] [error] python_init: Python path being used
> 'C:\\WINDOWS\\system32\\python24.zip;C:\\Python24\\Lib;C:\\Python24\\DLLs;C:\\Python24\\Lib\\lib-tk;;C:\\Archivos
> de programa\\Apache Software Foundation\\Apache2.2\\bin'.
>
> [Sat May 26 13:06:54 2007] [notice] mod_python: Creating 8 session mutexes
> based on 0 max processes and 250 max threads.
>
> [Sat May 26 13:06:54 2007] [notice] Child 6388: Child process is running
>
> [Sat May 26 13:06:55 2007] [notice] Child 3408: Released the start mutex
>
> [Sat May 26 13:06:55 2007] [notice] Child 6388: Acquired the start mutex.
>
> [Sat May 26 13:06:55 2007] [notice] Child 6388: Starting 250 worker threads.
>
> [Sat May 26 13:06:55 2007] [notice] Child 6388: Starting thread to listen on
> port 80.
>
> [Sat May 26 13:06:56 2007] [notice] Child 3408: Waiting for 250 worker
> threads to exit.
>
> [Sat May 26 13:06:56 2007] [notice] Child 3408: All worker threads have
> exited.
>
> [Sat May 26 13:06:56 2007] [notice] Child 3408: Child process is exiting
>
>
>
> Thanks
>
>
> ________________________________
> Acepta el reto MSN Premium: Env?a hasta 500 megas diarios de fotos desde
> Hotmail. Desc?rgalo y pru?balo 2 meses gratis.

From jmt4b04d4v at gmail.com  Sat May 26 13:31:49 2007
From: jmt4b04d4v at gmail.com (Johans Taboada)
Date: Sat May 26 13:31:55 2007
Subject: [SPAM] Re: [mod_python] mod_python+Apache2+OpenSSL
	missconfiguration?
In-Reply-To: <88e286470705171453t2c5ad68dq5ae30c728aa70077@mail.gmail.com>
References: <1916f5340705150945i233362d0l7452c0f628377de@mail.gmail.com>
	<88e286470705151429v3987396fo2353356dd6e24549@mail.gmail.com>
	<1916f5340705171151s4f26b25ai4b4f4f7537acebcb@mail.gmail.com>
	<88e286470705171453t2c5ad68dq5ae30c728aa70077@mail.gmail.com>
Message-ID: <1916f5340705261031l44c58e73t43191bc7e19d2fd3@mail.gmail.com>

Hi, sorry again for late response.

2007/5/17, Graham Dumpleton <graham.dumpleton@gmail.com>:
>
> Hmmm, looking at code, the SSL code in Apache is probably embedded
> within the actual httpd rather than being linked in. Running:
>
>   nm /usr/local/apache2/bin/httpd | grep ssl


I think you're right, previous command threw lots (419) of following similar
lines:
{{{
...
08093020 T ssl_cmd_SSLProxyCipherSuite
08093050 T ssl_cmd_SSLProxyEngine
08093430 T ssl_cmd_SSLProxyMachineCertificateFile
...
}}}

I remember now that this installation (of OpenSSL) isn't clean (mix of
unereased prepackaged binaries and source compiled).

would probably show that to be the case. If it is and the problems are
> the result of a clash between the embedded version of SSL and the
> external libraries, then solution would be to tell Apache to use
> external SSL libraries using the Apache configure script option:
>
>   --with-ssl=DIR          OpenSSL SSL/TLS toolkit
>
> Thus rebuilding Apache to use same external SSL library may be one thing
> to try.


I've already made a cleaner installation in another node and everything's
fine now, thanks.

The next thing I was going to suggest you do was to take a standalone
> test program that shows that what you are trying to do works outside
> of Apache and make sure it still works when you run it as the same
> user that Apache runs as and from the root directory of your
> filesystem.
>
> Doing this would check two things. The first is whether it is user
> related and second whether it could be the result of things being run
> in a directory where no write access is available.


I tried this first and found that is not user related.

Graham


Thanks again, I couldn't have made any progress without this help,
--------------------------------------------------------
Johans Marvin Taboada Villca    -`^_^?- .o0O( 2007-04-24, Bienvenida
Bebecita )
--------------------------------------------------------
Adm. Laboratorio de Desarrollo de Software
Carreras de Inform?tica y Sistemas
UMSS, Cochabamba
Bolivia
--------------------------------------------------------
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070526/cbbc0aa3/attachment.html
From deepak.battu at yahoo.co.in  Sun May 27 07:14:33 2007
From: deepak.battu at yahoo.co.in (deepak battu)
Date: Sun May 27 07:14:42 2007
Subject: [mod_python] os.system-not working
Message-ID: <229539.63787.qm@web7810.mail.in.yahoo.com>

cmd = "nmap -O " + myip + "> /usr/local/apache2/htdocs/test/temp/tmp.txt"

os.system(cmd)

 Iran this code in python it is working but when i run this in mod_python through apache it is not showing any errors but not giving the correct result. plz help me.






      Looking for people who are YOUR TYPE? Find them at in.groups.yahoo.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070527/2f12de95/attachment.html
From graham.dumpleton at gmail.com  Sun May 27 07:24:28 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sun May 27 07:24:33 2007
Subject: [mod_python] os.system-not working
In-Reply-To: <229539.63787.qm@web7810.mail.in.yahoo.com>
References: <229539.63787.qm@web7810.mail.in.yahoo.com>
Message-ID: <88e286470705270424o765223a8u4bf2cb79a5564ad4@mail.gmail.com>

On 27/05/07, deepak battu <deepak.battu@yahoo.co.in> wrote:
>
> cmd = "nmap -O " + myip + ">
> /usr/local/apache2/htdocs/test/temp/tmp.txt"
>  os.system(cmd)
>
>  Iran this code in python it is working but when i run this in mod_python
> through apache it is not showing any errors but not giving the correct
> result. plz help me.

Specify an absolute path for the location of 'nmap' because Apache
runs with a quite restrictive PATH and thus the program may not be
able to be found.

Also, Apache runs as a special user which may not have write access to
where you are trying to write the output. Try writing the output file
to /tmp instead.

Finally, I hope your 'myip' value isn't being supplied through a user
editable field in a form because if it has you have just exposed your
box in a way that a remote user could execute arbitrary commands on
your box.

Graham
From graham.dumpleton at gmail.com  Sun May 27 16:52:50 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sun May 27 16:52:55 2007
Subject: [mod_python] os.system-not working
In-Reply-To: <604080.44340.qm@web7808.mail.in.yahoo.com>
References: <604080.44340.qm@web7808.mail.in.yahoo.com>
Message-ID: <88e286470705271352s1e0d27a7qb0e62f4b1a182350@mail.gmail.com>

On 27/05/07, deepak battu <deepak.battu@yahoo.co.in> wrote:
>
> hello graham,
> i have tried it by using the absolute path like this :
>     cmd = "/usr/bin/nmap -O " + myip + "> /tmp/tmp.txt"
>     os.system(cmd)
> but no change.

Change your command to:

     cmd = "/usr/bin/nmap -O " + myip + "> /tmp/tmp.txt 2>&1"
     os.system(cmd)

This will ensure that standard error is also capture into output file
and you can then maybe see what is going wrong with your command line.

Another option is to have:

  import sys
  sys.stderr.flush()

immediately after os.system call to ensure that any standard error
messages are properly flushed through to Apache log.

Also suggest you log then actual command being run to the Apache error
log before you do it. Ie.,

     cmd = "/usr/bin/nmap -O " + myip + "> /tmp/tmp.txt 2>&1"
     apache.log_error('RUNNING: ' + cmd)
     os.system(cmd)

Then you can see what what is being run is what you expect.

Note, please use reply-all so discussion stays on the mailing list as
others may have ideas.

Graham

>  i have votice that this thing worked for another command:
>    cmd = "/usr/bin/nmap -sP " + myip + "> /tmp/tmp.txt"
>      os.system(cmd)
>
> and coming to the myip variable it is giving the correct ip .
> plz help me.
>
>
> ----- Original Message ----
> From: Graham Dumpleton <graham.dumpleton@gmail.com>
> To: deepak battu <deepak.battu@yahoo.co.in>
> Cc: mod_python@modpython.org
> Sent: Sunday, 27 May, 2007 4:54:28 PM
> Subject: Re: [mod_python] os.system-not working
>
> On 27/05/07, deepak battu <deepak.battu@yahoo.co.in> wrote:
> >
> > cmd = "nmap -O " + myip + ">
> > /usr/local/apache2/htdocs/test/temp/tmp.txt"
> >  os.system(cmd)
> >
> >  Iran this code in python it is working but when i run this in mod_python
> > through apache it is not showing any errors but not giving the correct
> > result. plz help me.
>
> Specify an absolute path for the location of 'nmap' because Apache
> runs with a quite restrictive PATH and thus the program may not be
> able to be found.
>
> Also, Apache runs as a special user which may not have write access to
> where you are trying to write the output. Try writing the output file
> to /tmp instead.
>
> Finally, I hope your 'myip' value isn't being supplied through a user
> editable field in a form because if it has you have just exposed your
> box in a way that a remote user could execute arbitrary commands on
> your box.
>
> Graham
>
>
>  ________________________________
>  Download prohibited? No problem! CHAT from any browser, without download.
From mod_python at jez.net.nz  Sun May 27 19:36:05 2007
From: mod_python at jez.net.nz (Jeremy Allen)
Date: Sun May 27 19:36:12 2007
Subject: [mod_python] Inspect request body before handing it over to
	mod_proxy
Message-ID: <d882fce60705271636n44012915q27b48c42c37ecc32@mail.gmail.com>

Hi,

I'm using apache 2.2 with mod_proxy functioning as a reverse proxy.
I was hoping to use mod_python to inspect the body of the http request
before it gets handled by mod_proxy.

I can happily make a Python*Handler which will receive the request before
mod_proxy.
I can inspect and change headers before handing it off to mod_proxy but as
soon as I touch the body of the request things become trickier.
Request.read() will give me the body of the request but doing so consumes
the read characters from the body , thus passing on nothing down to
mod_proxy.

Am I right in thinking that I cannot merely observe the body of a request, I
have to consume it?
Also am I right in thinking that there is no way I can modify the body of a
request before it gets handed down the request processing chain? (so I could
read it then perhaps write it back to the request)

I have also tried using a filter instead of a handler but I'm not sure if it
is possible to trigger a server response like HTTP_FORBIDDEN from a filter.

Thanks,
Jeremy
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070528/0aa6e174/attachment.html
From graham.dumpleton at gmail.com  Sun May 27 19:52:36 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sun May 27 19:52:42 2007
Subject: [mod_python] Inspect request body before handing it over to
	mod_proxy
In-Reply-To: <d882fce60705271636n44012915q27b48c42c37ecc32@mail.gmail.com>
References: <d882fce60705271636n44012915q27b48c42c37ecc32@mail.gmail.com>
Message-ID: <88e286470705271652g53aae990y619524d762b4ec23@mail.gmail.com>

On 28/05/07, Jeremy Allen <mod_python@jez.net.nz> wrote:
> Hi,
>
> I'm using apache 2.2 with mod_proxy functioning as a reverse proxy.
> I was hoping to use mod_python to inspect the body of the http request
> before it gets handled by mod_proxy.
>
> I can happily make a Python*Handler which will receive the request before
> mod_proxy.
> I can inspect and change headers before handing it off to mod_proxy but as
> soon as I touch the body of the request things become trickier.
> Request.read() will give me the body of the request but doing so consumes
> the read characters from the body , thus passing on nothing down to
> mod_proxy.
>
> Am I right in thinking that I cannot merely observe the body of a request, I
> have to consume it?
> Also am I right in thinking that there is no way I can modify the body of a
> request before it gets handed down the request processing chain? (so I could
> read it then perhaps write it back to the request)
>
> I have also tried using a filter instead of a handler but I'm not sure if it
> is possible to trigger a server response like HTTP_FORBIDDEN from a filter.

To inspect/change the content you can only use an input filter. Do
note though that if you are changing the length of the content, that
will invalidate the incoming Content-Length header which can mean not
all your content may be sent through by mod_proxy if the new content
length is greater.

As to returning a HTTP_FORBIDDEN, is that based on the contents or the
headers. If headers, use a fixup handler. If content, I'm not sure at
the moment what you can do.

BTW, what are you proxying through to and what is the nature of the
changes being made to the content?

Graham
From graham.dumpleton at gmail.com  Sun May 27 20:31:36 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sun May 27 20:31:42 2007
Subject: [mod_python] Inspect request body before handing it over to
	mod_proxy
In-Reply-To: <d882fce60705271713o5d903797jb4f469b49248ff0c@mail.gmail.com>
References: <d882fce60705271636n44012915q27b48c42c37ecc32@mail.gmail.com>
	<88e286470705271652g53aae990y619524d762b4ec23@mail.gmail.com>
	<d882fce60705271713o5d903797jb4f469b49248ff0c@mail.gmail.com>
Message-ID: <88e286470705271731o6454b550t5dbadb4484121f53@mail.gmail.com>

On 28/05/07, Jeremy Allen <jeremy@jez.net.nz> wrote:
> I'm hoping to return HTTP_FORBIDDEN based on the content of the request yes,
> so what I'm trying to do doesn't sound feasible.
>
> I'm proxying to SOAP web services, I don't want to change the content being
> posted to them just inspect it to see if ceratin parts of the request are
> valid for the logged in user (logged in by http auth).

>From memory, that was originally the point of the SOAPAction (???)
request header, ie., could be checked without looking at content, but
not sure they could ever agree on how it should be used.

See:

  http://www.oreillynet.com/xml/blog/2002/11/unraveling_the_mystery_of_soap.html

for further details.

It mentions something about it morphing into an 'action' attribute on
content type, but the link for that is broken.

Graham
From deepak.battu at yahoo.co.in  Mon May 28 03:46:31 2007
From: deepak.battu at yahoo.co.in (deepak battu)
Date: Mon May 28 03:46:39 2007
Subject: [mod_python] os.system-not working
Message-ID: <422876.52522.qm@web7814.mail.in.yahoo.com>

Thank you Graham , it resolved the problem
  i changed the command to 
  cmd = "/usr/bin/nmap -O " + myip + "> /tmp/tmp.txt 2>&1"
 and the error came like no root priviliges. 
 so i changed the priviliges of  nmap  , using  chmod +s /usr/bin/nmap
and now it is working.

----- Original Message ----
From: Graham Dumpleton <graham.dumpleton@gmail.com>
To: deepak battu <deepak.battu@yahoo.co.in>
Cc: mod_python <mod_python@modpython.org>
Sent: Monday, 28 May, 2007 2:22:50 AM
Subject: Re: [mod_python] os.system-not working

On 27/05/07, deepak battu <deepak.battu@yahoo.co.in> wrote:
>
> hello graham,
> i have tried it by using the absolute path like this :
>     cmd = "/usr/bin/nmap -O " + myip + "> /tmp/tmp.txt"
>     os.system(cmd)
> but no change.

Change your command to:

     cmd = "/usr/bin/nmap -O " + myip + "> /tmp/tmp.txt 2>&1"
     os.system(cmd)

This will ensure that standard error is also capture into output file
and you can then maybe see what is going wrong with your command line.

Another option is to have:

  import sys
  sys.stderr.flush()

immediately after os.system call to ensure that any standard error
messages are properly flushed through to Apache log.

Also suggest you log then actual command being run to the Apache error
log before you do it. Ie.,

     cmd = "/usr/bin/nmap -O " + myip + "> /tmp/tmp.txt 2>&1"
     apache.log_error('RUNNING: ' + cmd)
     os.system(cmd)

Then you can see what what is being run is what you expect.

Note, please use reply-all so discussion stays on the mailing list as
others may have ideas.

Graham

>  i have votice that this thing worked for another command:
>    cmd = "/usr/bin/nmap -sP " + myip + "> /tmp/tmp.txt"
>      os.system(cmd)
>
> and coming to the myip variable it is giving the correct ip .
> plz help me.
>
>
> ----- Original Message ----
> From: Graham Dumpleton <graham.dumpleton@gmail.com>
> To: deepak battu <deepak.battu@yahoo.co.in>
> Cc: mod_python@modpython.org
> Sent: Sunday, 27 May, 2007 4:54:28 PM
> Subject: Re: [mod_python] os.system-not working
>
> On 27/05/07, deepak battu <deepak.battu@yahoo.co.in> wrote:
> >
> > cmd = "nmap -O " + myip + ">
> > /usr/local/apache2/htdocs/test/temp/tmp.txt"
> >  os.system(cmd)
> >
> >  Iran this code in python it is working but when i run this in mod_python
> > through apache it is not showing any errors but not giving the correct
> > result. plz help me.
>
> Specify an absolute path for the location of 'nmap' because Apache
> runs with a quite restrictive PATH and thus the program may not be
> able to be found.
>
> Also, Apache runs as a special user which may not have write access to
> where you are trying to write the output. Try writing the output file
> to /tmp instead.
>
> Finally, I hope your 'myip' value isn't being supplied through a user
> editable field in a form because if it has you have just exposed your
> box in a way that a remote user could execute arbitrary commands on
> your box.
>
> Graham
>
>
>  ________________________________
>  Download prohibited? No problem! CHAT from any browser, without download.







      Did you know? You can CHAT without downloading messenger. Click here http://in.messenger.yahoo.com/webmessengerpromo.php
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070528/ff4160bf/attachment.html
From czhang.web at gmail.com  Mon May 28 05:43:39 2007
From: czhang.web at gmail.com (=?UTF-8?B?5byg5oiQ?=)
Date: Mon May 28 05:43:48 2007
Subject: [mod_python] Mod_python compilation question,
	per your's comment on "What Powers Curse"
Message-ID: <83995040-224D-4B49-B14F-CA7F2D489F98@gmail.com>

Graham or other mod_python gurus on the m-list:

I tried to verify our mod_python compilation/installation is indeed  
correct after I read the comment <http://www.davidcramer.net/curse/44/ 
what-powers-curse.html#comment-9271>, especially this part:
[quote]
As a reference point for discussion a correctly compiled Python/ 
mod_python should only result in an Apache mod_python.so loadable  
module of at most about 400 kilobytes.
[/quote]

Unfortunately, ours mod_python.so is 1.3M in size:
# ls -lh /usr/lib64/apache2/modules/mod_python.so
-rwxr-xr-x 1 root root 1.3M 2007-04-26 08:42 /usr/lib64/apache2/ 
modules/mod_python.so

Since our Linux box is running Gentoo 2006.1, we do have the shared  
library for Python:
# ls -l /usr/lib/libpython2.4.so
lrwxrwxrwx 1 root root 19 2007-05-28 17:24 /usr/lib/libpython2.4.so - 
 > libpython2.4.so.1.0
# ls -l /usr/lib/libpython2.4.so.1.0
-r-xr-xr-x 1 root root 1073360 2007-05-28 17:24 /usr/lib/ 
libpython2.4.so.1.0

Currently I have no idea why it doesn't use the shared library for  
Python:
# ldd /usr/lib64/apache2/modules/mod_python.so
         libpthread.so.0 => /lib/libpthread.so.0 (0x00002aaef9109000)
         libdl.so.2 => /lib/libdl.so.2 (0x00002aaef9223000)
         libutil.so.1 => /lib/libutil.so.1 (0x00002aaef9327000)
         libm.so.6 => /lib/libm.so.6 (0x00002aaef942b000)
         libc.so.6 => /lib/libc.so.6 (0x00002aaef9580000)
         /lib64/ld-linux-x86-64.so.2 (0x0000555555554000)

Our mod_python compilation log file is attached for your reference.  
Any pointer or hint is greatly appreciated. Thanks in advance.

BR,
- Cheng Zhang
Gentoo/PostgreSQL/Nginx/Python/Django/jQuery Powered
-------------- next part --------------
A non-text attachment was scrubbed...
Name: dev-python:mod_python-3.2.10:20070426-004231.log
Type: application/octet-stream
Size: 20615 bytes
Desc: not available
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070528/cc6285d7/20070426-004231-0001.obj
-------------- next part --------------

From graham.dumpleton at gmail.com  Mon May 28 06:03:26 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon May 28 06:03:32 2007
Subject: [mod_python] Mod_python compilation question,
	per your's comment on "What Powers Curse"
In-Reply-To: <83995040-224D-4B49-B14F-CA7F2D489F98@gmail.com>
References: <83995040-224D-4B49-B14F-CA7F2D489F98@gmail.com>
Message-ID: <88e286470705280303w31452458y5da2da8077c92de7@mail.gmail.com>

On 28/05/07,  <czhang.web@gmail.com> wrote:
> Graham or other mod_python gurus on the m-list:
>
> I tried to verify our mod_python compilation/installation is indeed
> correct after I read the comment <http://www.davidcramer.net/curse/44/
> what-powers-curse.html#comment-9271>, especially this part:
> [quote]
> As a reference point for discussion a correctly compiled Python/
> mod_python should only result in an Apache mod_python.so loadable
> module of at most about 400 kilobytes.
> [/quote]
>
> Unfortunately, ours mod_python.so is 1.3M in size:
> # ls -lh /usr/lib64/apache2/modules/mod_python.so
> -rwxr-xr-x 1 root root 1.3M 2007-04-26 08:42 /usr/lib64/apache2/
> modules/mod_python.so
>
> Since our Linux box is running Gentoo 2006.1, we do have the shared
> library for Python:
> # ls -l /usr/lib/libpython2.4.so
> lrwxrwxrwx 1 root root 19 2007-05-28 17:24 /usr/lib/libpython2.4.so -
>  > libpython2.4.so.1.0
> # ls -l /usr/lib/libpython2.4.so.1.0
> -r-xr-xr-x 1 root root 1073360 2007-05-28 17:24 /usr/lib/
> libpython2.4.so.1.0

What Python libraries are in:

  /usr/lib64/python2.4/config

and:

  /usr/lib64

Ie., the 64 bit lib directories.

It is going to look in the 'config' directory location above first and
if there is only a static library there are not a shared library, it
will probably use the static library. This is because the link line
for library building according to your logs is:

  -L/usr/lib64/python2.4/config

Graham

> Currently I have no idea why it doesn't use the shared library for
> Python:
> # ldd /usr/lib64/apache2/modules/mod_python.so
>          libpthread.so.0 => /lib/libpthread.so.0 (0x00002aaef9109000)
>          libdl.so.2 => /lib/libdl.so.2 (0x00002aaef9223000)
>          libutil.so.1 => /lib/libutil.so.1 (0x00002aaef9327000)
>          libm.so.6 => /lib/libm.so.6 (0x00002aaef942b000)
>          libc.so.6 => /lib/libc.so.6 (0x00002aaef9580000)
>          /lib64/ld-linux-x86-64.so.2 (0x0000555555554000)
>
> Our mod_python compilation log file is attached for your reference.
> Any pointer or hint is greatly appreciated. Thanks in advance.

From habnabit at gmail.com  Mon May 28 06:12:46 2007
From: habnabit at gmail.com (Aaron Gallagher)
Date: Mon May 28 06:12:59 2007
Subject: [mod_python] Apache directory listing
Message-ID: <641494D0-A3E3-400B-BC16-9A8F2995B2CD@gmail.com>

Is there a way to tell Apache to give a directory listing? I'm using  
SetHandler on a directory, and in some cases, I don't need to do any  
special handling, so I'd like Apache to just list the contents of the  
directory so that I don't have to write my own way of doing it.

Just returning apache.OK has Apache send a document of MIME time  
httpd/x-directory with content length 0.

Aaron Gallagher
<habnabit@gmail.com>


-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070528/8c27db23/attachment.html
From graham.dumpleton at gmail.com  Mon May 28 06:14:23 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon May 28 06:14:29 2007
Subject: [mod_python] Mod_python compilation question,
	per your's comment on "What Powers Curse"
In-Reply-To: <83995040-224D-4B49-B14F-CA7F2D489F98@gmail.com>
References: <83995040-224D-4B49-B14F-CA7F2D489F98@gmail.com>
Message-ID: <88e286470705280314p4bd7aedcv9e044cdce3a4d07d@mail.gmail.com>

On 28/05/07,  <czhang.web@gmail.com> wrote:
> Graham or other mod_python gurus on the m-list:
>
> I tried to verify our mod_python compilation/installation is indeed
> correct after I read the comment <http://www.davidcramer.net/curse/44/
> what-powers-curse.html#comment-9271>, especially this part:
> [quote]

BTW, one thing I did forget to mention in that blog comment was that
using PythonOptimize directive may also help to drop memory use, but
one does have to be careful as it has the effect of dropping doc
strings from modules, which is where memory savings might come from.
Thus if a module relies on doc strings to work for some reason, it
will fail.

I haven't gone back to mention this hint since the blog owner hasn't
been inclined to answer my query as yet as to why he thinks mod_python
has excessive memory overhead. Don't know why I can never get anyway
to substantiate comments like this when they make them.  :-(

Graham

From graham.dumpleton at gmail.com  Mon May 28 06:22:48 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon May 28 06:22:54 2007
Subject: [mod_python] Apache directory listing
In-Reply-To: <641494D0-A3E3-400B-BC16-9A8F2995B2CD@gmail.com>
References: <641494D0-A3E3-400B-BC16-9A8F2995B2CD@gmail.com>
Message-ID: <88e286470705280322o21c5f8e1w66b70066838e18a9@mail.gmail.com>

What happens if you return apache.DECLINED.

Graham

On 28/05/07, Aaron Gallagher <habnabit@gmail.com> wrote:
>
> Is there a way to tell Apache to give a directory listing? I'm using
> SetHandler on a directory, and in some cases, I don't need to do any special
> handling, so I'd like Apache to just list the contents of the directory so
> that I don't have to write my own way of doing it.
>
> Just returning apache.OK has Apache send a document of MIME time
> httpd/x-directory with content length 0.
>
> Aaron Gallagher
> <habnabit@gmail.com>
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
From habnabit at gmail.com  Mon May 28 06:30:31 2007
From: habnabit at gmail.com (Aaron Gallagher)
Date: Mon May 28 06:30:45 2007
Subject: [mod_python] Apache directory listing
In-Reply-To: <88e286470705280322o21c5f8e1w66b70066838e18a9@mail.gmail.com>
References: <641494D0-A3E3-400B-BC16-9A8F2995B2CD@gmail.com>
	<88e286470705280322o21c5f8e1w66b70066838e18a9@mail.gmail.com>
Message-ID: <AEF6BFBA-38AA-4BFE-85AC-F08B49951CF7@gmail.com>

I get a 404 Not Found error.

On May 28, 2007, at 3:22 AM, Graham Dumpleton wrote:

> What happens if you return apache.DECLINED.
>
> Graham
>
> On 28/05/07, Aaron Gallagher <habnabit@gmail.com> wrote:
>>
>> Is there a way to tell Apache to give a directory listing? I'm using
>> SetHandler on a directory, and in some cases, I don't need to do  
>> any special
>> handling, so I'd like Apache to just list the contents of the  
>> directory so
>> that I don't have to write my own way of doing it.
>>
>> Just returning apache.OK has Apache send a document of MIME time
>> httpd/x-directory with content length 0.
>>
>> Aaron Gallagher
>> <habnabit@gmail.com>
>>
>>
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>
>>

Aaron Gallagher
<habnabit@gmail.com>


From graham.dumpleton at gmail.com  Mon May 28 06:44:45 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon May 28 06:44:52 2007
Subject: [mod_python] Apache directory listing
In-Reply-To: <AEF6BFBA-38AA-4BFE-85AC-F08B49951CF7@gmail.com>
References: <641494D0-A3E3-400B-BC16-9A8F2995B2CD@gmail.com>
	<88e286470705280322o21c5f8e1w66b70066838e18a9@mail.gmail.com>
	<AEF6BFBA-38AA-4BFE-85AC-F08B49951CF7@gmail.com>
Message-ID: <88e286470705280344m39d0f233p62b1b56365f590a3@mail.gmail.com>

Arrgghh, mistook mime type for handler.

Trying again, although not sure this will work, but might be able to say:

  req.handler = "httpd/unix-directory"
  return apache.DECLINED

The reason this might not work is that mod_python registers itself as
a middle handler as does the autoindex module. Because the autoindex
module is inbuilt, it probably gets processed prior to mod_python
handler so too late to do the above.

Thus, your only choice would be to provide a fixuphandler which undoes
the SetHandler just for the request against the directory and triggers
autoindex instead. Ie.,

  def fixuphandler(req):
    if req.content_type = "httpd/x-directory":
      req.handler = "httpd/unix-directory"
    return apache.OK

Enable this using appropriate PythonFixupHandler directive.

Graham

On 28/05/07, Aaron Gallagher <habnabit@gmail.com> wrote:
> I get a 404 Not Found error.
>
> On May 28, 2007, at 3:22 AM, Graham Dumpleton wrote:
>
> > What happens if you return apache.DECLINED.
> >
> > Graham
> >
> > On 28/05/07, Aaron Gallagher <habnabit@gmail.com> wrote:
> >>
> >> Is there a way to tell Apache to give a directory listing? I'm using
> >> SetHandler on a directory, and in some cases, I don't need to do
> >> any special
> >> handling, so I'd like Apache to just list the contents of the
> >> directory so
> >> that I don't have to write my own way of doing it.
> >>
> >> Just returning apache.OK has Apache send a document of MIME time
> >> httpd/x-directory with content length 0.
> >>
> >> Aaron Gallagher
> >> <habnabit@gmail.com>
> >>
> >>
> >> _______________________________________________
> >> Mod_python mailing list
> >> Mod_python@modpython.org
> >> http://mailman.modpython.org/mailman/listinfo/mod_python
> >>
> >>
>
> Aaron Gallagher
> <habnabit@gmail.com>
>
>
>
From habnabit at gmail.com  Mon May 28 06:51:36 2007
From: habnabit at gmail.com (Aaron Gallagher)
Date: Mon May 28 06:51:51 2007
Subject: [mod_python] Apache directory listing
In-Reply-To: <88e286470705280344m39d0f233p62b1b56365f590a3@mail.gmail.com>
References: <641494D0-A3E3-400B-BC16-9A8F2995B2CD@gmail.com>
	<88e286470705280322o21c5f8e1w66b70066838e18a9@mail.gmail.com>
	<AEF6BFBA-38AA-4BFE-85AC-F08B49951CF7@gmail.com>
	<88e286470705280344m39d0f233p62b1b56365f590a3@mail.gmail.com>
Message-ID: <1759D23B-7ACF-49BD-AF36-F4481639CEE8@gmail.com>

Okay, I'll try that.

But, what exactly is the purpose of a PythonFixupHandler? The  
documentation doesn't have much to say, but I assume it's for doing  
URL rewriting and redirection.

On May 28, 2007, at 3:44 AM, Graham Dumpleton wrote:

> Arrgghh, mistook mime type for handler.
>
> Trying again, although not sure this will work, but might be able  
> to say:
>
>  req.handler = "httpd/unix-directory"
>  return apache.DECLINED
>
> The reason this might not work is that mod_python registers itself as
> a middle handler as does the autoindex module. Because the autoindex
> module is inbuilt, it probably gets processed prior to mod_python
> handler so too late to do the above.
>
> Thus, your only choice would be to provide a fixuphandler which undoes
> the SetHandler just for the request against the directory and triggers
> autoindex instead. Ie.,
>
>  def fixuphandler(req):
>    if req.content_type = "httpd/x-directory":
>      req.handler = "httpd/unix-directory"
>    return apache.OK
>
> Enable this using appropriate PythonFixupHandler directive.
>
> Graham
>
> On 28/05/07, Aaron Gallagher <habnabit@gmail.com> wrote:
>> I get a 404 Not Found error.
>>
>> On May 28, 2007, at 3:22 AM, Graham Dumpleton wrote:
>>
>> > What happens if you return apache.DECLINED.
>> >
>> > Graham
>> >
>> > On 28/05/07, Aaron Gallagher <habnabit@gmail.com> wrote:
>> >>
>> >> Is there a way to tell Apache to give a directory listing? I'm  
>> using
>> >> SetHandler on a directory, and in some cases, I don't need to do
>> >> any special
>> >> handling, so I'd like Apache to just list the contents of the
>> >> directory so
>> >> that I don't have to write my own way of doing it.
>> >>
>> >> Just returning apache.OK has Apache send a document of MIME time
>> >> httpd/x-directory with content length 0.
>> >>
>> >> Aaron Gallagher
>> >> <habnabit@gmail.com>
>> >>
>> >>
>> >> _______________________________________________
>> >> Mod_python mailing list
>> >> Mod_python@modpython.org
>> >> http://mailman.modpython.org/mailman/listinfo/mod_python
>> >>
>> >>
>>
>> Aaron Gallagher
>> <habnabit@gmail.com>
>>
>>
>>

Aaron Gallagher
<habnabit@gmail.com>


From graham.dumpleton at gmail.com  Mon May 28 07:22:21 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon May 28 07:22:30 2007
Subject: [mod_python] Apache directory listing
In-Reply-To: <1759D23B-7ACF-49BD-AF36-F4481639CEE8@gmail.com>
References: <641494D0-A3E3-400B-BC16-9A8F2995B2CD@gmail.com>
	<88e286470705280322o21c5f8e1w66b70066838e18a9@mail.gmail.com>
	<AEF6BFBA-38AA-4BFE-85AC-F08B49951CF7@gmail.com>
	<88e286470705280344m39d0f233p62b1b56365f590a3@mail.gmail.com>
	<1759D23B-7ACF-49BD-AF36-F4481639CEE8@gmail.com>
Message-ID: <88e286470705280422w4e65012o37c9866d43c768a5@mail.gmail.com>

On 28/05/07, Aaron Gallagher <habnabit@gmail.com> wrote:
> Okay, I'll try that.
>
> But, what exactly is the purpose of a PythonFixupHandler? The
> documentation doesn't have much to say, but I assume it's for doing
> URL rewriting and redirection.

Potentially. It is one of a number of phases and is a sort of catch
all or last chance phase before actual response handler is executed.
For a very technical description of the whole Apache request-response
loop see:

  http://www.fmc-modeling.org/projects/apache/html/4_4Request_Response_Loop.html

If you really want to understand how Apache works, that whole document
is quite a good read, albeit probably more in depth than most people
would care for.

Graham

> On May 28, 2007, at 3:44 AM, Graham Dumpleton wrote:
>
> > Arrgghh, mistook mime type for handler.
> >
> > Trying again, although not sure this will work, but might be able
> > to say:
> >
> >  req.handler = "httpd/unix-directory"
> >  return apache.DECLINED
> >
> > The reason this might not work is that mod_python registers itself as
> > a middle handler as does the autoindex module. Because the autoindex
> > module is inbuilt, it probably gets processed prior to mod_python
> > handler so too late to do the above.
> >
> > Thus, your only choice would be to provide a fixuphandler which undoes
> > the SetHandler just for the request against the directory and triggers
> > autoindex instead. Ie.,
> >
> >  def fixuphandler(req):
> >    if req.content_type = "httpd/x-directory":
> >      req.handler = "httpd/unix-directory"
> >    return apache.OK
> >
> > Enable this using appropriate PythonFixupHandler directive.
> >
> > Graham
> >
> > On 28/05/07, Aaron Gallagher <habnabit@gmail.com> wrote:
> >> I get a 404 Not Found error.
> >>
> >> On May 28, 2007, at 3:22 AM, Graham Dumpleton wrote:
> >>
> >> > What happens if you return apache.DECLINED.
> >> >
> >> > Graham
> >> >
> >> > On 28/05/07, Aaron Gallagher <habnabit@gmail.com> wrote:
> >> >>
> >> >> Is there a way to tell Apache to give a directory listing? I'm
> >> using
> >> >> SetHandler on a directory, and in some cases, I don't need to do
> >> >> any special
> >> >> handling, so I'd like Apache to just list the contents of the
> >> >> directory so
> >> >> that I don't have to write my own way of doing it.
> >> >>
> >> >> Just returning apache.OK has Apache send a document of MIME time
> >> >> httpd/x-directory with content length 0.
> >> >>
> >> >> Aaron Gallagher
> >> >> <habnabit@gmail.com>
> >> >>
> >> >>
> >> >> _______________________________________________
> >> >> Mod_python mailing list
> >> >> Mod_python@modpython.org
> >> >> http://mailman.modpython.org/mailman/listinfo/mod_python
> >> >>
> >> >>
> >>
> >> Aaron Gallagher
> >> <habnabit@gmail.com>
> >>
> >>
> >>
>
> Aaron Gallagher
> <habnabit@gmail.com>
>
>
>
From habnabit at gmail.com  Mon May 28 09:22:12 2007
From: habnabit at gmail.com (Aaron Gallagher)
Date: Mon May 28 09:22:26 2007
Subject: [mod_python] Apache directory listing
In-Reply-To: <88e286470705280422w4e65012o37c9866d43c768a5@mail.gmail.com>
References: <641494D0-A3E3-400B-BC16-9A8F2995B2CD@gmail.com>
	<88e286470705280322o21c5f8e1w66b70066838e18a9@mail.gmail.com>
	<AEF6BFBA-38AA-4BFE-85AC-F08B49951CF7@gmail.com>
	<88e286470705280344m39d0f233p62b1b56365f590a3@mail.gmail.com>
	<1759D23B-7ACF-49BD-AF36-F4481639CEE8@gmail.com>
	<88e286470705280422w4e65012o37c9866d43c768a5@mail.gmail.com>
Message-ID: <38671595-13BC-496F-B178-002D3BEDA60C@gmail.com>

I've just moved a lot of my code (including the code that checks to  
see if a directory should have its contents listed) from a  
PythonHandler into a PythonHeaderParserHandler, because after looking  
at the response loop, I determined that PythonFixupHandler was  
happening too late in the process.

It's created some interesting new problems -- my calls to  
req.internal_redirect aren't working, as the code was set up like this:
req.internal_redirect(...)
return apache.OK
I guess this isn't stopping the request, like it used to do. How  
should I change my code to allow internal redirects?

Also, all of your suggestions just act the same way as if I had just  
done return apache.OK.


On May 28, 2007, at 4:22 AM, Graham Dumpleton wrote:

> On 28/05/07, Aaron Gallagher <habnabit@gmail.com> wrote:
>> Okay, I'll try that.
>>
>> But, what exactly is the purpose of a PythonFixupHandler? The
>> documentation doesn't have much to say, but I assume it's for doing
>> URL rewriting and redirection.
>
> Potentially. It is one of a number of phases and is a sort of catch
> all or last chance phase before actual response handler is executed.
> For a very technical description of the whole Apache request-response
> loop see:
>
>  http://www.fmc-modeling.org/projects/apache/html/ 
> 4_4Request_Response_Loop.html
>
> If you really want to understand how Apache works, that whole document
> is quite a good read, albeit probably more in depth than most people
> would care for.
>
> Graham
>
>> On May 28, 2007, at 3:44 AM, Graham Dumpleton wrote:
>>
>> > Arrgghh, mistook mime type for handler.
>> >
>> > Trying again, although not sure this will work, but might be able
>> > to say:
>> >
>> >  req.handler = "httpd/unix-directory"
>> >  return apache.DECLINED
>> >
>> > The reason this might not work is that mod_python registers  
>> itself as
>> > a middle handler as does the autoindex module. Because the  
>> autoindex
>> > module is inbuilt, it probably gets processed prior to mod_python
>> > handler so too late to do the above.
>> >
>> > Thus, your only choice would be to provide a fixuphandler which  
>> undoes
>> > the SetHandler just for the request against the directory and  
>> triggers
>> > autoindex instead. Ie.,
>> >
>> >  def fixuphandler(req):
>> >    if req.content_type = "httpd/x-directory":
>> >      req.handler = "httpd/unix-directory"
>> >    return apache.OK
>> >
>> > Enable this using appropriate PythonFixupHandler directive.
>> >
>> > Graham
>> >
>> > On 28/05/07, Aaron Gallagher <habnabit@gmail.com> wrote:
>> >> I get a 404 Not Found error.
>> >>
>> >> On May 28, 2007, at 3:22 AM, Graham Dumpleton wrote:
>> >>
>> >> > What happens if you return apache.DECLINED.
>> >> >
>> >> > Graham
>> >> >
>> >> > On 28/05/07, Aaron Gallagher <habnabit@gmail.com> wrote:
>> >> >>
>> >> >> Is there a way to tell Apache to give a directory listing? I'm
>> >> using
>> >> >> SetHandler on a directory, and in some cases, I don't need  
>> to do
>> >> >> any special
>> >> >> handling, so I'd like Apache to just list the contents of the
>> >> >> directory so
>> >> >> that I don't have to write my own way of doing it.
>> >> >>
>> >> >> Just returning apache.OK has Apache send a document of MIME  
>> time
>> >> >> httpd/x-directory with content length 0.
>> >> >>
>> >> >> Aaron Gallagher
>> >> >> <habnabit@gmail.com>
>> >> >>
>> >> >>
>> >> >> _______________________________________________
>> >> >> Mod_python mailing list
>> >> >> Mod_python@modpython.org
>> >> >> http://mailman.modpython.org/mailman/listinfo/mod_python
>> >> >>
>> >> >>
>> >>
>> >> Aaron Gallagher
>> >> <habnabit@gmail.com>
>> >>
>> >>
>> >>
>>
>> Aaron Gallagher
>> <habnabit@gmail.com>
>>
>>
>>

Aaron Gallagher
<habnabit@gmail.com>


From hayat221 at yahoo.com  Mon May 28 09:36:03 2007
From: hayat221 at yahoo.com (sikander hayat)
Date: Mon May 28 09:36:24 2007
Subject: [mod_python] run mod_python on server
In-Reply-To: <38671595-13BC-496F-B178-002D3BEDA60C@gmail.com>
Message-ID: <141010.85976.qm@web38706.mail.mud.yahoo.com>

Hi all,

I am running mod_python at the backend of my webpage. The scenario is: a user enters some information in the form elements of a html page and when he presses "submit" button, a python script is called via mod_python and i process the information.

Now, i want to continue this backend processing and allow the user to close my webpage after informing him that the results will be sent via email, so that he doesnt have to wait with the webpage open all the time. How can i do that?

thanks,
Sikander

 
---------------------------------
We won't tell. Get more on shows you hate to love
(and love to hate): Yahoo! TV's Guilty Pleasures list.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070528/df514d17/attachment.html
From fidita48 at hotmail.com  Mon May 28 14:56:15 2007
From: fidita48 at hotmail.com (=?iso-8859-1?B?SWRvaWEgVmlsbGFjaeFuIFrhcmF0ZQ==?=)
Date: Mon May 28 14:56:26 2007
Subject: [SPAM] Re: [mod_python] Error
In-Reply-To: <88e286470705260436i42aec65dr6eb0f5e78a86c684@mail.gmail.com>
Message-ID: <BAY137-F32261099807D452825E2A2D4280@phx.gbl>

An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070528/dc84a54b/attachment.html
From graham.dumpleton at gmail.com  Mon May 28 16:56:57 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon May 28 16:57:04 2007
Subject: [mod_python] Apache directory listing
In-Reply-To: <38671595-13BC-496F-B178-002D3BEDA60C@gmail.com>
References: <641494D0-A3E3-400B-BC16-9A8F2995B2CD@gmail.com>
	<88e286470705280322o21c5f8e1w66b70066838e18a9@mail.gmail.com>
	<AEF6BFBA-38AA-4BFE-85AC-F08B49951CF7@gmail.com>
	<88e286470705280344m39d0f233p62b1b56365f590a3@mail.gmail.com>
	<1759D23B-7ACF-49BD-AF36-F4481639CEE8@gmail.com>
	<88e286470705280422w4e65012o37c9866d43c768a5@mail.gmail.com>
	<38671595-13BC-496F-B178-002D3BEDA60C@gmail.com>
Message-ID: <88e286470705281356j7698aca6u595b565824b71118@mail.gmail.com>

If a phase earlier than response handler phase is providing the
complete response, it should return apache.DONE and not apache.OK.
This will stop later phases running.

Graham

On 28/05/07, Aaron Gallagher <habnabit@gmail.com> wrote:
> I've just moved a lot of my code (including the code that checks to
> see if a directory should have its contents listed) from a
> PythonHandler into a PythonHeaderParserHandler, because after looking
> at the response loop, I determined that PythonFixupHandler was
> happening too late in the process.
>
> It's created some interesting new problems -- my calls to
> req.internal_redirect aren't working, as the code was set up like this:
> req.internal_redirect(...)
> return apache.OK
> I guess this isn't stopping the request, like it used to do. How
> should I change my code to allow internal redirects?
>
> Also, all of your suggestions just act the same way as if I had just
> done return apache.OK.
>
>
> On May 28, 2007, at 4:22 AM, Graham Dumpleton wrote:
>
> > On 28/05/07, Aaron Gallagher <habnabit@gmail.com> wrote:
> >> Okay, I'll try that.
> >>
> >> But, what exactly is the purpose of a PythonFixupHandler? The
> >> documentation doesn't have much to say, but I assume it's for doing
> >> URL rewriting and redirection.
> >
> > Potentially. It is one of a number of phases and is a sort of catch
> > all or last chance phase before actual response handler is executed.
> > For a very technical description of the whole Apache request-response
> > loop see:
> >
> >  http://www.fmc-modeling.org/projects/apache/html/
> > 4_4Request_Response_Loop.html
> >
> > If you really want to understand how Apache works, that whole document
> > is quite a good read, albeit probably more in depth than most people
> > would care for.
> >
> > Graham
> >
> >> On May 28, 2007, at 3:44 AM, Graham Dumpleton wrote:
> >>
> >> > Arrgghh, mistook mime type for handler.
> >> >
> >> > Trying again, although not sure this will work, but might be able
> >> > to say:
> >> >
> >> >  req.handler = "httpd/unix-directory"
> >> >  return apache.DECLINED
> >> >
> >> > The reason this might not work is that mod_python registers
> >> itself as
> >> > a middle handler as does the autoindex module. Because the
> >> autoindex
> >> > module is inbuilt, it probably gets processed prior to mod_python
> >> > handler so too late to do the above.
> >> >
> >> > Thus, your only choice would be to provide a fixuphandler which
> >> undoes
> >> > the SetHandler just for the request against the directory and
> >> triggers
> >> > autoindex instead. Ie.,
> >> >
> >> >  def fixuphandler(req):
> >> >    if req.content_type = "httpd/x-directory":
> >> >      req.handler = "httpd/unix-directory"
> >> >    return apache.OK
> >> >
> >> > Enable this using appropriate PythonFixupHandler directive.
> >> >
> >> > Graham
> >> >
> >> > On 28/05/07, Aaron Gallagher <habnabit@gmail.com> wrote:
> >> >> I get a 404 Not Found error.
> >> >>
> >> >> On May 28, 2007, at 3:22 AM, Graham Dumpleton wrote:
> >> >>
> >> >> > What happens if you return apache.DECLINED.
> >> >> >
> >> >> > Graham
> >> >> >
> >> >> > On 28/05/07, Aaron Gallagher <habnabit@gmail.com> wrote:
> >> >> >>
> >> >> >> Is there a way to tell Apache to give a directory listing? I'm
> >> >> using
> >> >> >> SetHandler on a directory, and in some cases, I don't need
> >> to do
> >> >> >> any special
> >> >> >> handling, so I'd like Apache to just list the contents of the
> >> >> >> directory so
> >> >> >> that I don't have to write my own way of doing it.
> >> >> >>
> >> >> >> Just returning apache.OK has Apache send a document of MIME
> >> time
> >> >> >> httpd/x-directory with content length 0.
> >> >> >>
> >> >> >> Aaron Gallagher
> >> >> >> <habnabit@gmail.com>
> >> >> >>
> >> >> >>
> >> >> >> _______________________________________________
> >> >> >> Mod_python mailing list
> >> >> >> Mod_python@modpython.org
> >> >> >> http://mailman.modpython.org/mailman/listinfo/mod_python
> >> >> >>
> >> >> >>
> >> >>
> >> >> Aaron Gallagher
> >> >> <habnabit@gmail.com>
> >> >>
> >> >>
> >> >>
> >>
> >> Aaron Gallagher
> >> <habnabit@gmail.com>
> >>
> >>
> >>
>
> Aaron Gallagher
> <habnabit@gmail.com>
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From haaserd at gmail.com  Mon May 28 17:24:02 2007
From: haaserd at gmail.com (Roger Haase)
Date: Mon May 28 17:24:09 2007
Subject: [mod_python] Installing mod_python on Vista
Message-ID: <2965cd7d0705281424v793437d0s1cee6310e4004eff@mail.gmail.com>

I am trying to install mod-python 3.3.1 on top of Apache 2.2.4 and Python
2.5 on Windows Vista.  I downloaded
mod-python-3.3.1.win32-py2.5-Apache2.2.exe.  I have Vista UAC turned off.

If I try to install using the administrator command prompt window, I get a
message saying MSVCR71.dll was not found.

If I try d-clicking the filename with Windows Explorer, I get several
messages saying Python25 was found in the registry, etc.
and modules are added to
Python25\Lib\site-packages\mod-python.  Then I get get a message
saying "Could not load Python" in a messagebox labeled "Postinstall
script finished". I was expecting to see a
mod_python.so module moved into Apache2.2\modules, but it was not.  In
addition to the missing mod_python.so, the Python modules in
site-packages\mod_python did not get compiled.

If I run a "path"
within a command prompt window, Python25 shows as the first in the
list. Executing a "python -V" runs OK.

Possible contributing factors is that this Vista is the 64-bit version.  The
32-bit Apache is running fine and I have accessed the manual docs.

Anyone have an idea of how to install mod_python under Vista?

Roger
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070528/c2e0fc34/attachment.html
From greg at vig.co.nz  Mon May 28 17:49:05 2007
From: greg at vig.co.nz (Greg Fawcett)
Date: Mon May 28 17:49:12 2007
Subject: [mod_python] run mod_python on server
In-Reply-To: <141010.85976.qm@web38706.mail.mud.yahoo.com>
References: <38671595-13BC-496F-B178-002D3BEDA60C@gmail.com>
	<141010.85976.qm@web38706.mail.mud.yahoo.com>
Message-ID: <928306280705281449r429f6e95q1084c672ecc34b94@mail.gmail.com>

Hi Sikander -

It sounds like you have a static HTML page with the form on it calling a
python script when the form is submitted.

After your python script processes the information, it can use req.write()
to send the HTML for the confirmation page back to the user, perhaps saying
that an email has been been sent to them. They can then close this page
whenever they like.

Cheers!
Greg.

On 29/05/07, sikander hayat <hayat221@yahoo.com> wrote:
>
> Hi all,
>
> I am running mod_python at the backend of my webpage. The scenario is: a
> user enters some information in the form elements of a html page and when he
> presses "submit" button, a python script is called via mod_python and i
> process the information.
>
> Now, i want to continue this backend processing and allow the user to
> close my webpage after informing him that the results will be sent via
> email, so that he doesnt have to wait with the webpage open all the time.
> How can i do that?
>
> thanks,
> Sikander
>
> ------------------------------
> We won't tell. Get more on shows you hate to love<http://us.rd.yahoo.com/evt=49980/*http://tv.yahoo.com/collections/265%0A>
> (and love to hate): Yahoo! TV's Guilty Pleasures list.<http://us.rd.yahoo.com/evt=49980/*http://tv.yahoo.com/collections/265%0A>
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>


-- 
Phone: +64 3 409 8165
Mobile: +64 21 333 291
Fax: +64 3 974 6810
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070529/9572e040/attachment.html
From graham.dumpleton at gmail.com  Mon May 28 18:11:31 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon May 28 18:11:36 2007
Subject: [mod_python] Apache directory listing
In-Reply-To: <88e286470705281356j7698aca6u595b565824b71118@mail.gmail.com>
References: <641494D0-A3E3-400B-BC16-9A8F2995B2CD@gmail.com>
	<88e286470705280322o21c5f8e1w66b70066838e18a9@mail.gmail.com>
	<AEF6BFBA-38AA-4BFE-85AC-F08B49951CF7@gmail.com>
	<88e286470705280344m39d0f233p62b1b56365f590a3@mail.gmail.com>
	<1759D23B-7ACF-49BD-AF36-F4481639CEE8@gmail.com>
	<88e286470705280422w4e65012o37c9866d43c768a5@mail.gmail.com>
	<38671595-13BC-496F-B178-002D3BEDA60C@gmail.com>
	<88e286470705281356j7698aca6u595b565824b71118@mail.gmail.com>
Message-ID: <88e286470705281511s3ee1ee5cqffa67f500a463abb@mail.gmail.com>

BTW, SetHandler is only processed in typehandler phase. Thus if you
want to override that, you must be doing it in the fixuphandler phase.

Also note that allowing automatic directory listings in mod_python can
cause issues if there are subdirectories which are also managed in
some way by mod_python. Can't remember whether there is an issue
logged about it or whether I ranted about it on one of the mailing
lists somewhere.

Graham

On 29/05/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> If a phase earlier than response handler phase is providing the
> complete response, it should return apache.DONE and not apache.OK.
> This will stop later phases running.
>
> Graham
>
> On 28/05/07, Aaron Gallagher <habnabit@gmail.com> wrote:
> > I've just moved a lot of my code (including the code that checks to
> > see if a directory should have its contents listed) from a
> > PythonHandler into a PythonHeaderParserHandler, because after looking
> > at the response loop, I determined that PythonFixupHandler was
> > happening too late in the process.
> >
> > It's created some interesting new problems -- my calls to
> > req.internal_redirect aren't working, as the code was set up like this:
> > req.internal_redirect(...)
> > return apache.OK
> > I guess this isn't stopping the request, like it used to do. How
> > should I change my code to allow internal redirects?
> >
> > Also, all of your suggestions just act the same way as if I had just
> > done return apache.OK.
> >
> >
> > On May 28, 2007, at 4:22 AM, Graham Dumpleton wrote:
> >
> > > On 28/05/07, Aaron Gallagher <habnabit@gmail.com> wrote:
> > >> Okay, I'll try that.
> > >>
> > >> But, what exactly is the purpose of a PythonFixupHandler? The
> > >> documentation doesn't have much to say, but I assume it's for doing
> > >> URL rewriting and redirection.
> > >
> > > Potentially. It is one of a number of phases and is a sort of catch
> > > all or last chance phase before actual response handler is executed.
> > > For a very technical description of the whole Apache request-response
> > > loop see:
> > >
> > >  http://www.fmc-modeling.org/projects/apache/html/
> > > 4_4Request_Response_Loop.html
> > >
> > > If you really want to understand how Apache works, that whole document
> > > is quite a good read, albeit probably more in depth than most people
> > > would care for.
> > >
> > > Graham
> > >
> > >> On May 28, 2007, at 3:44 AM, Graham Dumpleton wrote:
> > >>
> > >> > Arrgghh, mistook mime type for handler.
> > >> >
> > >> > Trying again, although not sure this will work, but might be able
> > >> > to say:
> > >> >
> > >> >  req.handler = "httpd/unix-directory"
> > >> >  return apache.DECLINED
> > >> >
> > >> > The reason this might not work is that mod_python registers
> > >> itself as
> > >> > a middle handler as does the autoindex module. Because the
> > >> autoindex
> > >> > module is inbuilt, it probably gets processed prior to mod_python
> > >> > handler so too late to do the above.
> > >> >
> > >> > Thus, your only choice would be to provide a fixuphandler which
> > >> undoes
> > >> > the SetHandler just for the request against the directory and
> > >> triggers
> > >> > autoindex instead. Ie.,
> > >> >
> > >> >  def fixuphandler(req):
> > >> >    if req.content_type = "httpd/x-directory":
> > >> >      req.handler = "httpd/unix-directory"
> > >> >    return apache.OK
> > >> >
> > >> > Enable this using appropriate PythonFixupHandler directive.
> > >> >
> > >> > Graham
> > >> >
> > >> > On 28/05/07, Aaron Gallagher <habnabit@gmail.com> wrote:
> > >> >> I get a 404 Not Found error.
> > >> >>
> > >> >> On May 28, 2007, at 3:22 AM, Graham Dumpleton wrote:
> > >> >>
> > >> >> > What happens if you return apache.DECLINED.
> > >> >> >
> > >> >> > Graham
> > >> >> >
> > >> >> > On 28/05/07, Aaron Gallagher <habnabit@gmail.com> wrote:
> > >> >> >>
> > >> >> >> Is there a way to tell Apache to give a directory listing? I'm
> > >> >> using
> > >> >> >> SetHandler on a directory, and in some cases, I don't need
> > >> to do
> > >> >> >> any special
> > >> >> >> handling, so I'd like Apache to just list the contents of the
> > >> >> >> directory so
> > >> >> >> that I don't have to write my own way of doing it.
> > >> >> >>
> > >> >> >> Just returning apache.OK has Apache send a document of MIME
> > >> time
> > >> >> >> httpd/x-directory with content length 0.
> > >> >> >>
> > >> >> >> Aaron Gallagher
> > >> >> >> <habnabit@gmail.com>
> > >> >> >>
> > >> >> >>
> > >> >> >> _______________________________________________
> > >> >> >> Mod_python mailing list
> > >> >> >> Mod_python@modpython.org
> > >> >> >> http://mailman.modpython.org/mailman/listinfo/mod_python
> > >> >> >>
> > >> >> >>
> > >> >>
> > >> >> Aaron Gallagher
> > >> >> <habnabit@gmail.com>
> > >> >>
> > >> >>
> > >> >>
> > >>
> > >> Aaron Gallagher
> > >> <habnabit@gmail.com>
> > >>
> > >>
> > >>
> >
> > Aaron Gallagher
> > <habnabit@gmail.com>
> >
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
>
From graham.dumpleton at gmail.com  Mon May 28 18:20:23 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon May 28 18:20:31 2007
Subject: [mod_python] Error
In-Reply-To: <BAY137-F32261099807D452825E2A2D4280@phx.gbl>
References: <88e286470705260436i42aec65dr6eb0f5e78a86c684@mail.gmail.com>
	<BAY137-F32261099807D452825E2A2D4280@phx.gbl>
Message-ID: <88e286470705281520r29c3b0f5y77f783fe30785634@mail.gmail.com>

Hmmm, no mention of CGI in those bits that may be relevant.

Lets try this a different way. Replace your existing code file with
another with the same name but containing:

  print "Content-type: text/html\n\n"
  print "Hello, World."

When you access the URL you have been using, what is displayed in your
browser and the error logs then?

If this works okay, then it confirms your Apache must be configured
for CGI somehow and it is overriding mod_python.

BTW, what URL are you actually using in your browser again. I don't
recollect seeing you post what you were using.

You also may want to confirm whether you are indeed setting up
everything correctly by following alternate instructions in:

  http://www.dscpl.com.au/wiki/ModPython/Articles/GettingModPythonWorking

You will have to get htaccess files working for your Windows box though.

Graham

On 29/05/07, Idoia Villaci?n Z?rate <fidita48@hotmail.com> wrote:
>
>
>
> Hello,
>
>
>
> What I have in apache's configuration is the following
>
>
>
> <Directory "C:/Archivos de programa/Apache Software
> Foundation/Apache2.2/htdocs">
>
>     #
>
>     # Possible values for the Options directive are "None", "All",
>
>     # or any combination of:
>
>     #   Indexes Includes FollowSymLinks SymLinksifOwnerMatch ExecCGI
> MultiViews
>
>     #
>
>     # Note that "MultiViews" must be named *explicitly* --- "Options All"
>
>     # doesn't give it to you.
>
>     #
>
>     # The Options directive is both complicated and important.  Please see
>
>     #
> http://httpd.apache.org/docs/2.2/mod/core.html#options
>
>     # for more information.
>
>     #
>
>     Options Indexes FollowSymLinks
>
>
>
>     #
>
>     # AllowOverride controls what directives may be placed in .htaccess
> files.
>
>     # It can be "All", "None", or any combination of the keywords:
>
>     #   Options FileInfo AuthConfig Limit
>
>     #
>
>     AllowOverride None
>
>
>
>     #
>
>     # Controls who can get stuff from this server.
>
>     #
>
>     Order allow,deny
>
>     Allow from all
>
>
>
> </Directory>
>
>
>
> And finally:
>
>
>
> #AddHandler cgi-script .cgi
>
>
>
> Thanks
>
>
>
>
>
>
>
>  ________________________________
>
> From:  "Graham Dumpleton" <graham.dumpleton@gmail.com>
> To:  "Idoia Villaci?n Z?rate" <fidita48@hotmail.com>
> CC:  mod_python@modpython.org
> Subject:  Re: [mod_python] Error
> Date:  Sat, 26 May 2007 21:36:53 +1000
>
> >I was hoping for the region of the log file which also showed your
> >error:
> >
> >Traceback (most recent call last):
> >
> >  File "C:\Archivos de programa\Apache Software
> >Foundation\Apache2.2\htdocs\mptest.py", line 1, in ?
> >
> >    from mod_python import apache
> >
> >  File
> "C:\Python24\Lib\site-packages\mod_python\apache.py", line
> >30, in ?
> >
> >    import _apache
> >ImportError: No module named _apache
> >
> >embedded within the middle of it.
> >
> >Ie., something like:
> >
> >[Mon Apr 09 13:30:15 2007] [error] [client 127.0.0.1] mod_python
> >(pid=7293, interpreter='grumpy.local', phase='PythonHandler',
> >handler='paste.modpython'): Application error
> >[Mon Apr 09 13:30:15 2007] [error] [client 127.0.0.1] ServerName:
> >'grumpy.local'[Mon Apr 09 13:30:15 2007] [error] [client 127.0.0.1]
> >DocumentRoot: '/usr/local/apache-2.2/htdocs'
> >[Mon Apr 09 13:30:15 2007] [error] [client 127.0.0.1] URI:
> >'/mod_python/hello'[Mon Apr 09 13:30:15 2007] [error] [client
> >127.0.0.1] Location: '/mod_python/hello'[Mon Apr 09 13:30:15 2007]
> >[error] [client 127.0.0.1] Directory: None
> >[Mon Apr 09 13:30:15 2007] [error] [client 127.0.0.1] Filename:
> >'/usr/local/apache-2.2/htdocs/mod_python'
> >[Mon Apr 09 13:30:15 2007] [error] [client 127.0.0.1] PathInfo:
> >'/hello'
> >[Mon Apr 09 13:30:15 2007] [error] [client 127.0.0.1] Traceback
> >(most
> >recent call last):
> >[Mon Apr 09 13:30:15 2007] [error] [client 127.0.0.1]   File
> >"/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site-packages/mod_python/importer.py",
> >line 1537, in HandlerDispatch\n
> default=default_handler, arg=req,
> >silent=hlist.silent)[Mon Apr 09 13:30:15 2007] [error] [client
> >127.0.0.1]   File
> >"/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site-packages/mod_python/importer.py",
> >line 1229, in _process_target\n    result = _execute_target(config,
> >req, object, arg)[Mon Apr 09 13:30:15 2007] [error] [client
> >127.0.0.1]
> >  File
> >"/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site-packages/mod_python/importer.py",
> >line 1128, in _execute_target\n    result = object(arg)[Mon Apr 09
> >13:30:15 2007] [error] [client 127.0.0.1]   File
> >"/Library/Python/2.3/site-packages/Paste-1.2.1-py2.3.egg/paste/modpython.py",
> >line 246, in handler\n    module = __import__(modname, globals(),
> >locals(), [''])[Mon Apr 09 13:30:15 2007] [error] [client 127.0.0.1]
> >File "/usr/local/wsgi/scripts/hello.py", line 3, in ?\n
> import
> >mod_wsgi[Mon Apr 09 13:30:15 2007] [error] [client 127.0.0.1]
> >ImportError: No module named mod_wsgi
> >
> >The thing I just realised though is that your error message can't be
> >a
> >result of a failure of mod_python as the way mod_python logs
> >tracebacks means that the details would have the timestamp
> >information
> >prefixing each line like above. That they don't appear means your
> >script is probably most definitely being executed as a CGI script
> >and
> >not by mod_python.
> >
> >Thus I would suggest you have a configuration problem with HTTP.
> >Specifically, you have CGI scripts enabled for that directory, or
> >for
> >the .py extension.
> >
> >What do you have elsewhere in your Apache configuration relating to
> >CGI scripts. Do you have anything like:
> >
> >  AddHandler cgi-script .py
> >
> >or:
> >
> >  Options ExecCGI
> >
> >Find that section of your configuration and reply-all and quote it.
> >
> >Graham
> >
> >
> >
> >On 26/05/07, Idoia Villaci?n Z?rate <fidita48@hotmail.com> wrote:
> >>
> >>
> >>I'm sorry, I didn't know I have to send back the mails, I'll do it
> >>from now.
> >>
> >>
> >>
> >>here I send you the lines of apache's log error:
> >>
> >>[Sat May 26 12:42:26 2007] [notice] Apache/2.2.4 (Win32) configured
> >>--
> >>resuming normal operations
> >>
> >>[Sat May 26 12:42:26 2007] [notice] Server built: Jan  9 2007
> >>23:17:20
> >>
> >>[Sat May 26 12:42:26 2007] [notice] Parent: Created child process
> >>1604
> >>
> >>[Sat May 26 12:42:27 2007] [notice] Child 1604: Child process is
> >>running
> >>
> >>[Sat May 26 12:42:27 2007] [notice] Child 1604: Acquired the start
> >>mutex.
> >>
> >>[Sat May 26 12:42:27 2007] [notice] Child 1604: Starting 250 worker
> >>threads.
> >>
> >>[Sat May 26 12:42:27 2007] [notice] Child 1604: Starting thread to
> >>listen on
> >>port 80.
> >>
> >>[Sat May 26 12:59:04 2007] [notice] Parent: Received restart signal
> >>--
> >>Restarting the server.
> >>
> >>[Sat May 26 12:59:04 2007] [notice] Child 1604: Exit event
> >>signaled. Child
> >>process is ending.
> >>
> >>[Sat May 26 12:59:04 2007] [notice] Apache/2.2.4 (Win32) configured
> >>--
> >>resuming normal operations
> >>
> >>[Sat May 26 12:59:04 2007] [notice] Server built: Jan  9 2007
> >>23:17:20
> >>
> >>[Sat May 26 12:59:04 2007] [notice] Parent: Created child process
> >>5332
> >>
> >>[Sat May 26 12:59:05 2007] [error] python_init: Python version
> >>mismatch,
> >>expected '2.4.3', found '2.4.4'.
> >>
> >>[Sat May 26 12:59:05 2007] [error] python_init: Python executable
> >>found
> >>'C:\\Archivos de programa\\Apache Software
> >>Foundation\\Apache2.2\\bin\\httpd.exe'.
> >>
> >>[Sat May 26 12:59:05 2007] [error] python_init: Python path being
> >>used
> >>'C:\\WINDOWS\\system32\\python24.zip;C:\\Python24\\Lib;C:\\Python24\\DLLs;C:\\Python24\\Lib\\lib-tk;;C:\\Archivos
> >>de programa\\Apache Software Foundation\\Apache2.2\\bin'.
> >>
> >>[Sat May 26 12:59:05 2007] [notice] mod_python: Creating 8 session
> >>mutexes
> >>based on 0 max processes and 250 max threads.
> >>
> >>[Sat May 26 12:59:05 2007] [notice] Child 5332: Child process is
> >>running
> >>
> >>[Sat May 26 12:59:05 2007] [notice] Child 1604: Released the start
> >>mutex
> >>
> >>[Sat May 26 12:59:05 2007] [notice] Child 5332: Acquired the start
> >>mutex.
> >>
> >>[Sat May 26 12:59:05 2007] [notice] Child 5332: Starting 250 worker
> >>threads.
> >>
> >>[Sat May 26 12:59:06 2007] [notice] Child 1604: Waiting for 250
> >>worker
> >>threads to exit.
> >>
> >>[Sat May 26 12:59:06 2007] [notice] Child 1604: All worker threads
> >>have
> >>exited.
> >>
> >>[Sat May 26 12:59:06 2007] [notice] Child 1604: Child process is
> >>exiting
> >>
> >>[Sat May 26 12:59:06 2007] [notice] Child 5332: Starting thread to
> >>listen on
> >>port 80.
> >>
> >>[Sat May 26 13:00:22 2007] [notice] Parent: Received restart signal
> >>--
> >>Restarting the server.
> >>
> >>[Sat May 26 13:00:22 2007] [notice] Child 5332: Exit event
> >>signaled. Child
> >>process is ending.
> >>
> >>[Sat May 26 13:00:22 2007] [notice] Apache/2.2.4 (Win32) configured
> >>--
> >>resuming normal operations
> >>
> >>[Sat May 26 13:00:22 2007] [notice] Server built: Jan  9 2007
> >>23:17:20
> >>
> >>[Sat May 26 13:00:22 2007] [notice] Parent: Created child process
> >>3408
> >>
> >>[Sat May 26 13:00:22 2007] [error] python_init: Python version
> >>mismatch,
> >>expected '2.4.3', found '2.4.4'.
> >>
> >>[Sat May 26 13:00:22 2007] [error] python_init: Python executable
> >>found
> >>'C:\\Archivos de programa\\Apache Software
> >>Foundation\\Apache2.2\\bin\\httpd.exe'.
> >>
> >>[Sat May 26 13:00:22 2007] [error] python_init: Python path being
> >>used
> >>'C:\\WINDOWS\\system32\\python24.zip;C:\\Python24\\Lib;C:\\Python24\\DLLs;C:\\Python24\\Lib\\lib-tk;;C:\\Archivos
> >>de programa\\Apache Software Foundation\\Apache2.2\\bin'.
> >>
> >>[Sat May 26 13:00:22 2007] [notice] mod_python: Creating 8 session
> >>mutexes
> >>based on 0 max processes and 250 max threads.
> >>
> >>[Sat May 26 13:00:22 2007] [notice] Child 3408: Child process is
> >>running
> >>
> >>[Sat May 26 13:00:23 2007] [notice] Child 5332: Released the start
> >>mutex
> >>
> >>[Sat May 26 13:00:23 2007] [notice] Child 3408: Acquired the start
> >>mutex.
> >>
> >>[Sat May 26 13:00:23 2007] [notice] Child 3408: Starting 250 worker
> >>threads.
> >>
> >>[Sat May 26 13:00:23 2007] [notice] Child 3408: Starting thread to
> >>listen on
> >>port 80.
> >>
> >>[Sat May 26 13:00:24 2007] [notice] Child 5332: Waiting for 250
> >>worker
> >>threads to exit.
> >>
> >>[Sat May 26 13:00:24 2007] [notice] Child 5332: All worker threads
> >>have
> >>exited.
> >>
> >>[Sat May 26 13:00:24 2007] [notice] Child 5332: Child process is
> >>exiting
> >>
> >>[Sat May 26 13:06:54 2007] [notice] Parent: Received restart signal
> >>--
> >>Restarting the server.
> >>
> >>[Sat May 26 13:06:54 2007] [notice] Child 3408: Exit event
> >>signaled. Child
> >>process is ending.
> >>
> >>[Sat May 26 13:06:54 2007] [notice] Apache/2.2.4 (Win32) configured
> >>--
> >>resuming normal operations
> >>
> >>[Sat May 26 13:06:54 2007] [notice] Server built: Jan  9 2007
> >>23:17:20
> >>
> >>[Sat May 26 13:06:54 2007] [notice] Parent: Created child process
> >>6388
> >>
> >>[Sat May 26 13:06:54 2007] [error] python_init: Python version
> >>mismatch,
> >>expected '2.4.3', found '2.4.4'.
> >>
> >>[Sat May 26 13:06:54 2007] [error] python_init: Python executable
> >>found
> >>'C:\\Archivos de programa\\Apache Software
> >>Foundation\\Apache2.2\\bin\\httpd.exe'.
> >>
> >>[Sat May 26 13:06:54 2007] [error] python_init: Python path being
> >>used
> >>'C:\\WINDOWS\\system32\\python24.zip;C:\\Python24\\Lib;C:\\Python24\\DLLs;C:\\Python24\\Lib\\lib-tk;;C:\\Archivos
> >>de programa\\Apache Software Foundation\\Apache2.2\\bin'.
> >>
> >>[Sat May 26 13:06:54 2007] [notice] mod_python: Creating 8 session
> >>mutexes
> >>based on 0 max processes and 250 max threads.
> >>
> >>[Sat May 26 13:06:54 2007] [notice] Child 6388: Child process is
> >>running
> >>
> >>[Sat May 26 13:06:55 2007] [notice] Child 3408: Released the start
> >>mutex
> >>
> >>[Sat May 26 13:06:55 2007] [notice] Child 6388: Acquired the start
> >>mutex.
> >>
> >>[Sat May 26 13:06:55 2007] [notice] Child 6388: Starting 250 worker
> >>threads.
> >>
> >>[Sat May 26 13:06:55 2007] [notice] Child 6388: Starting thread to
> >>listen on
> >>port 80.
> >>
> >>[Sat May 26 13:06:56 2007] [notice] Child 3408: Waiting for 250
> >>worker
> >>threads to exit.
> >>
> >>[Sat May 26 13:06:56 2007] [notice] Child 3408: All worker threads
> >>have
> >>exited.
> >>
> >>[Sat May 26 13:06:56 2007] [notice] Child 3408: Child process is
> >>exiting
> >>
> >>
> >>
> >>Thanks
> >>
> >>
> >>________________________________
> >>Acepta el reto MSN Premium: Env?a hasta 500 megas diarios de
> >>fotos desde
> >>Hotmail. Desc?rgalo y pru?balo 2 meses gratis.
>
> ________________________________
> Acepta el reto MSN Premium: Env?a hasta 500 megas diarios de fotos desde
> Hotmail. Desc?rgalo y pru?balo 2 meses gratis.

From hayat221 at yahoo.com  Mon May 28 18:30:45 2007
From: hayat221 at yahoo.com (sikander hayat)
Date: Mon May 28 18:30:52 2007
Subject: [SPAM] Re: [mod_python] run mod_python on server
In-Reply-To: <928306280705281449r429f6e95q1084c672ecc34b94@mail.gmail.com>
Message-ID: <802757.61928.qm@web38705.mail.mud.yahoo.com>

Hi Greg,

Thanks for the reply, well, the problem is that the processing time is too long. So what i want is: take the info from the static HTML page and tell the user that an email will be sent and then process the info. And hence, the user can close the window and i can keep on doing my processing...even long after the user has closed the web page :)

thanks,
Sikander

Greg Fawcett <greg@vig.co.nz> wrote: Hi Sikander - 

It sounds like you have a static HTML page with the form on it calling a python script when the form is submitted.

After your python script processes the information, it can use req.write() to send the HTML for the confirmation page back to the user, perhaps saying that an email has been been sent to them. They can then close this page whenever they like. 

Cheers!
Greg.

On 29/05/07, sikander hayat <hayat221@yahoo.com> wrote: Hi all,

I am running mod_python at the backend of my webpage. The scenario is: a user enters some information in the form elements of a html page and when he presses "submit" button, a python script is called via mod_python and i process the information. 

Now, i want to continue this backend processing and allow the user to close my webpage after informing him that the results will be sent via email, so that he doesnt have to wait with the webpage open all the time. How can i do that? 

thanks,
Sikander
   

---------------------------------
We won't tell. Get more on shows you hate to love 
(and love to hate): Yahoo! TV's Guilty Pleasures list. 

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org 
http://mailman.modpython.org/mailman/listinfo/mod_python

 



-- 
Phone: +64 3 409 8165
Mobile: +64 21 333 291
Fax: +64 3 974 6810 

       
---------------------------------
Luggage? GPS? Comic books? 
Check out fitting  gifts for grads at Yahoo! Search.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070528/cc516eec/attachment.html
From graham.dumpleton at gmail.com  Mon May 28 18:38:54 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon May 28 18:38:58 2007
Subject: [SPAM] Re: [mod_python] run mod_python on server
In-Reply-To: <802757.61928.qm@web38705.mail.mud.yahoo.com>
References: <928306280705281449r429f6e95q1084c672ecc34b94@mail.gmail.com>
	<802757.61928.qm@web38705.mail.mud.yahoo.com>
Message-ID: <88e286470705281538w45726eaah57e3358d2daca47a@mail.gmail.com>

Although some create threads within the Apache/mod_python processes to
perform such long running tasks, it is more preferable to run a
backend daemon process to which you forward details of the task to be
run using XML-RPC. Another way is to write details of the task to disk
and have a cron job or backend daemon process read the details from
disk and then process it.

Graham

On 29/05/07, sikander hayat <hayat221@yahoo.com> wrote:
> Hi Greg,
>
> Thanks for the reply, well, the problem is that the processing time is too
> long. So what i want is: take the info from the static HTML page and tell
> the user that an email will be sent and then process the info. And hence,
> the user can close the window and i can keep on doing my processing...even
> long after the user has closed the web page :)
>
> thanks,
> Sikander
>
>
> Greg Fawcett <greg@vig.co.nz> wrote:
>  Hi Sikander -
>
> It sounds like you have a static HTML page with the form on it calling a
> python script when the form is submitted.
>
> After your python script processes the information, it can use req.write()
> to send the HTML for the confirmation page back to the user, perhaps saying
> that an email has been been sent to them. They can then close this page
> whenever they like.
>
> Cheers!
> Greg.
>
> On 29/05/07, sikander hayat <hayat221@yahoo.com> wrote:
> > Hi all,
> >
> > I am running mod_python at the backend of my webpage. The scenario is: a
> user enters some information in the form elements of a html page and when he
> presses "submit" button, a python script is called via mod_python and i
> process the information.
> >
> > Now, i want to continue this backend processing and allow the user to
> close my webpage after informing him that the results will be sent via
> email, so that he doesnt have to wait with the webpage open all the time.
> How can i do that?
> >
> > thanks,
> > Sikander
> >
> > ________________________________
> We won't tell. Get more on shows you hate to love
> > (and love to hate): Yahoo! TV's Guilty Pleasures list.
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
> >
>
>
>
> --
> Phone: +64 3 409 8165
> Mobile: +64 21 333 291
> Fax: +64 3 974 6810
>
>
>  ________________________________
> Luggage? GPS? Comic books?
>  Check out fitting gifts for grads at Yahoo! Search.
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
From rogerb at rogerbinns.com  Mon May 28 23:42:49 2007
From: rogerb at rogerbinns.com (Roger Binns)
Date: Mon May 28 23:42:55 2007
Subject: [mod_python] Some observations after writing my own modpython
Message-ID: <465BA139.9020208@rogerbinns.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

So I wrote my own Apache module because I needed some things that
weren't present in modpython (covered in previous messages in this
group).  Here are some observations based on the experience.

I have a new respect for anyone who has written an Apache module.
Ultimately the internal structure and processing is simple.  Everything
just "plugs in" at the appropriate points.  However the documentation
about the plugging in, which apis to call and when, etc is pretty much
non-existent.  (There are a few hello world examples but that is it).
Doxygen generated references are very good, but the gotcha is that you
have to know which methods to call.  It is kind of like learning a new
language by being handed a dictionary but with no idea of grammar.

For my module I chose to use the same names as the Apache apis.  For
example I used "ap_get_remote_host" as the method name.  This means that
it can be looked up in the Apache documentation for semantics, side
effects and errors.  It does result in un-pythonic names but makes life
easier for me anyway.

My main goal of being able to use subrequests in order to apply
authentication and authorization directives from some uris to code in
another uri has so far worked perfectly although I haven't explored all
corner cases yet.  Note that I can actually do it from the request phase
just fine and don't have to do it in the authentication phase.  (The
request phase is when I have all the information necessary to know
exactly what I want to do.)

These are various issues I found in the modpython code while comparing
my approach with modpython:

Modpython code for setting errors could be using PyErr_SetString  or
PyErr_Format in several places.  In some places it actually leaks, for
example line 111 in connobject.c:

  if (rc != APR_SUCCESS) {
      PyErr_SetObject(PyExc_IOError,
                      PyString_FromString("Connection read error"));
      return NULL;
  }

The PyString_FromString results in a leaked object since it isn't
decrefed.  It would be worthwhile checking out all usages of PyErr_*
which should result in less code and definitely fewer memory leaks.

While on the subject of errors, apr_strerror is never used so you'll not
actually know what an error was.  For example see req_sendfile in
requestobject.c.

  status=apr_file_open(&fd, fname,
                         APR_READ, APR_OS_DEFAULT,
                         self->request_rec->pool);
  if (status != APR_SUCCESS) {
        PyErr_SetString(PyExc_IOError, "Could not open file for reading");
        return NULL;
    }

Using apr_strerror will give the actual error string which could be any
number of things in this example (eg permission denied, file doesn't exist).

The Apache documentation says you are supposed to do this sequence of
calls in order to read a request body:

  ap_setup_client_block()
  if (ap_should_client_block()):
         ap_get_client_block()

modpython does the setup implicitly saying that chunked uploads should
be rejected.  The mp doc doesn't mention that it is always safe to call
read() since it calls should_client_block behind the scenes so as a user
of mp you can always use it without wondering about transfer encodings,
content length headers etc.  In my own module I exposed
ap_setup_client_block and ap_should_client_block which means that from
my Python code I have control over chunked (happy to accept it) and I
can tell if a body was actually supplied or not.  (In HTTP/1.1 any
request can have a body including GET).

I found that mp request write method accepts unicode strings providing
they can be converted to string objects using the default encoding
(this conversion happens due to using PyArg_ParseTuple with a format of
"s").  Personally I think it is a really bad idea to accept unicode
strings and have "magic" (the default encoding) convert them.  With this
kind of thing I believe it is far better to require the user to convert
to bytes explicitly choosing an encoding.

modpython appears to make no effort to ensure that things don't crash if
the python object representing a request outlives the request_rec that
it is wrapping, although I do recall some part of the doc saying "don't
do that".  However I think it is fair for python users to expect not to
be able to coredump the process no matter what they do.  In my own
module I solved this fairly trivially.  When wrapping a request_rec, do
an extra incref.  Then use apr_pool_cleanup_register.  In that callback,
set the wrapped pointer to NULL and do a decref.  That will cause the
python object to live at least as long as the request_rec.  But if the
python object is still alive after the request_rec has gone away, then
the wrapped pointer will be NULL.  In all my methods, I check that for
NULL first and raise an objectdead exception if it is NULL.
Consequently no matter what happens, it is impossible to crash things.
The same principle can be applied to other objects since by definition
they only live as long as their pool.

mp doesn't do OOR - original object return.  ie each time you get a new
request/header/etc python level object that is wrapping an underlying
Apache object, you get a different Python object.  This shouldn't really
matter that much, but it would be nice if you got the same object back
(ie with the same id).  It took wxPython a while to figure out how to do
it, since you'd need to have some way of mapping from the C level object
to a Python level object.  I think you can use pools again to do this
such as by using apr_pool_userdata_set with appropriate keys.

Finally (and this is "cosmetic") the code for setting members of
requestobject has a lot of duplication.  For example there are data
structures defining the names and types and then the code has additional
 type checking and names.  I used PyGetSetDef's and tp_getset and it
results in no duplication :-)

Roger
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)

iD8DBQFGW6E5mOOfHg372QQRAh32AJ9jZX1EOt0bk+uDLSIUWlQ04f2MKQCeLP/a
OZ7VRrM7y5fa7TMtdZL2LWc=
=ybbK
-----END PGP SIGNATURE-----
From graham.dumpleton at gmail.com  Tue May 29 00:23:43 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue May 29 00:23:49 2007
Subject: [mod_python] Some observations after writing my own modpython
In-Reply-To: <465BA139.9020208@rogerbinns.com>
References: <465BA139.9020208@rogerbinns.com>
Message-ID: <88e286470705282123n6f2caf3ey3c4231ce8b244f06@mail.gmail.com>

On 29/05/07, Roger Binns <rogerb@rogerbinns.com> wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> So I wrote my own Apache module because I needed some things that
> weren't present in modpython (covered in previous messages in this
> group).  Here are some observations based on the experience.
>
> I have a new respect for anyone who has written an Apache module.

Maybe you would like to review my code for me. :-)

  http://www.modwsgi.org

I would like to hope it does some of the core things like
initialisation and interpreter management better than mod_python does.
I know it fixes a lot of things that mod_python doesn't really get
right.

> Ultimately the internal structure and processing is simple.  Everything
> just "plugs in" at the appropriate points.  However the documentation
> about the plugging in, which apis to call and when, etc is pretty much
> non-existent.  (There are a few hello world examples but that is it).
> Doxygen generated references are very good, but the gotcha is that you
> have to know which methods to call.  It is kind of like learning a new
> language by being handed a dictionary but with no idea of grammar.

One can read:

  http://www.fmc-modeling.org/projects/apache/html/Apache_Modeling_Project.html

Also, do a search on the net using Google for 'Writing Apache Modules
with Perl and C'. The book is old and some sections are posted on the
mod_perl site. Look a bit harder through the Google search results and
you might stumble across a more complete copy. I will not post the
address as it isn't probably supposed to be on the net in the first
place.

> For my module I chose to use the same names as the Apache apis.  For
> example I used "ap_get_remote_host" as the method name.  This means that
> it can be looked up in the Apache documentation for semantics, side
> effects and errors.  It does result in un-pythonic names but makes life
> easier for me anyway.

All my work on SWIGing the Apache APIs could probably have saved you a
lot of effort. :-)

> My main goal of being able to use subrequests in order to apply
> authentication and authorization directives from some uris to code in
> another uri has so far worked perfectly although I haven't explored all
> corner cases yet.  Note that I can actually do it from the request phase
> just fine and don't have to do it in the authentication phase.  (The
> request phase is when I have all the information necessary to know
> exactly what I want to do.)

Is what you have done patches to mod_python, or have you gone and
written your own Apache module from scratch which is independent of
mod_python, or uses the exported mod_python optional functions for
getting access to interpreters? Are you intending to post your code
anywhere so we can have a look?

> These are various issues I found in the modpython code while comparing
> my approach with modpython:

And there are a lot more problems than that. Personally, in terms of
adding more and more access to the Apache API I am far from convinced
that mod_python is a good starting point. :-)

> Modpython code for setting errors could be using PyErr_SetString  or
> PyErr_Format in several places.  In some places it actually leaks, for
> example line 111 in connobject.c:
>
>   if (rc != APR_SUCCESS) {
>       PyErr_SetObject(PyExc_IOError,
>                       PyString_FromString("Connection read error"));
>       return NULL;
>   }
>
> The PyString_FromString results in a leaked object since it isn't
> decrefed.  It would be worthwhile checking out all usages of PyErr_*
> which should result in less code and definitely fewer memory leaks.
>
> While on the subject of errors, apr_strerror is never used so you'll not
> actually know what an error was.  For example see req_sendfile in
> requestobject.c.
>
>   status=apr_file_open(&fd, fname,
>                          APR_READ, APR_OS_DEFAULT,
>                          self->request_rec->pool);
>   if (status != APR_SUCCESS) {
>         PyErr_SetString(PyExc_IOError, "Could not open file for reading");
>         return NULL;
>     }
>
> Using apr_strerror will give the actual error string which could be any
> number of things in this example (eg permission denied, file doesn't exist).
>
> The Apache documentation says you are supposed to do this sequence of
> calls in order to read a request body:
>
>   ap_setup_client_block()
>   if (ap_should_client_block()):
>          ap_get_client_block()
>
> modpython does the setup implicitly saying that chunked uploads should
> be rejected.  The mp doc doesn't mention that it is always safe to call
> read() since it calls should_client_block behind the scenes so as a user
> of mp you can always use it without wondering about transfer encodings,
> content length headers etc.  In my own module I exposed
> ap_setup_client_block and ap_should_client_block which means that from
> my Python code I have control over chunked (happy to accept it) and I
> can tell if a body was actually supplied or not.  (In HTTP/1.1 any
> request can have a body including GET).

Read:

  https://issues.apache.org/jira/browse/MODPYTHON-222
  https://issues.apache.org/jira/browse/MODPYTHON-212

Probably nothing that can be done to change mod_python though as would
then potentially be incompatible with old code as the semantics of
req.read() would need to change.

> I found that mp request write method accepts unicode strings providing
> they can be converted to string objects using the default encoding
> (this conversion happens due to using PyArg_ParseTuple with a format of
> "s").  Personally I think it is a really bad idea to accept unicode
> strings and have "magic" (the default encoding) convert them.  With this
> kind of thing I believe it is far better to require the user to convert
> to bytes explicitly choosing an encoding.
>
> modpython appears to make no effort to ensure that things don't crash if
> the python object representing a request outlives the request_rec that
> it is wrapping, although I do recall some part of the doc saying "don't
> do that".  However I think it is fair for python users to expect not to
> be able to coredump the process no matter what they do.  In my own
> module I solved this fairly trivially.  When wrapping a request_rec, do
> an extra incref.  Then use apr_pool_cleanup_register.  In that callback,
> set the wrapped pointer to NULL and do a decref.  That will cause the
> python object to live at least as long as the request_rec.  But if the
> python object is still alive after the request_rec has gone away, then
> the wrapped pointer will be NULL.  In all my methods, I check that for
> NULL first and raise an objectdead exception if it is NULL.
> Consequently no matter what happens, it is impossible to crash things.
> The same principle can be applied to other objects since by definition
> they only live as long as their pool.
>
> mp doesn't do OOR - original object return.  ie each time you get a new
> request/header/etc python level object that is wrapping an underlying
> Apache object, you get a different Python object.

You do get the same request object, but correct that for many of the
attributes you don't, plus wrappers for server and connection objects
also always created on demand each time. Trying to cache values,
especially when they aren't all read only and can be updated by other
Apache functions, just makes the job of writing a hand coded wrapper
even more work so I don't begrudge the original author for not doing
it.

> This shouldn't really
> matter that much, but it would be nice if you got the same object back
> (ie with the same id).  It took wxPython a while to figure out how to do
> it, since you'd need to have some way of mapping from the C level object
> to a Python level object.  I think you can use pools again to do this
> such as by using apr_pool_userdata_set with appropriate keys.
>
> Finally (and this is "cosmetic") the code for setting members of
> requestobject has a lot of duplication.  For example there are data
> structures defining the names and types and then the code has additional
>  type checking and names.  I used PyGetSetDef's and tp_getset and it
> results in no duplication :-)

Too true, attribute and method lookup of objects is a mess.

Graham
From nlv11281 at natlab.research.philips.com  Tue May 29 01:35:27 2007
From: nlv11281 at natlab.research.philips.com (Mike Looijmans)
Date: Tue May 29 01:35:37 2007
Subject: [mod_python] MySQL connections not closing properly
In-Reply-To: <41B623DE-5999-4946-B206-DDD5917F6891@octopart.com>
References: <EDA51779D3476A478E1F599389255F580F46E6@AVN3VS004.ees.hhs.gov>
	<41B623DE-5999-4946-B206-DDD5917F6891@octopart.com>
Message-ID: <465BBB9F.7070903@natlab.research.philips.com>

 From your post i understand that this only happens if you kill Apache. Since it is not normal 
practice to stop the HTTP server often, it does not seem like a problem to me. MySQL can handle the 
aborted connections without any problem, so don't bother try to solve something that does not need 
solving. Attempting to shut things down gracefully will actually only make things less stable in 
this particular case.


Mike Looijmans
Philips Natlab / Topic Automation


Andres Morey wrote:
> Hi,
> 
> I am using mod_python 3.3.1 with Python 2.5, Apache 2.2.4, MySQL  5.0.27 
> and MySQLdb 1.2.2. When I stop the server I get "Aborted  connection" 
> warnings in MySQL even though I am closing the database  connections 
> properly when an object goes out of scope (by using the  __del__ 
> method). These warnings only happen when a python instance  with an open 
> database connection is killed abruptly, so I think it  has something to 
> do with the way that mod_python shuts down the  python interpreter.


From czhang.web at gmail.com  Tue May 29 04:02:15 2007
From: czhang.web at gmail.com (=?UTF-8?B?5byg5oiQ?=)
Date: Tue May 29 04:02:21 2007
Subject: [mod_python] Mod_python compilation question,
	per your's comment on "What Powers Curse"
In-Reply-To: <88e286470705280303w31452458y5da2da8077c92de7@mail.gmail.com>
References: <83995040-224D-4B49-B14F-CA7F2D489F98@gmail.com>
	<88e286470705280303w31452458y5da2da8077c92de7@mail.gmail.com>
Message-ID: <CEAE34F9-4A41-47CE-BC69-D043EB8689B1@gmail.com>


On 2007-5-28, at 6:03, Graham Dumpleton wrote:

> On 28/05/07,  <czhang.web@gmail.com> wrote:
>> Graham or other mod_python gurus on the m-list:
>>
>> I tried to verify our mod_python compilation/installation is indeed
>> correct after I read the comment <http://www.davidcramer.net/curse/ 
>> 44/
>> what-powers-curse.html#comment-9271>, especially this part:
>> [quote]
>> As a reference point for discussion a correctly compiled Python/
>> mod_python should only result in an Apache mod_python.so loadable
>> module of at most about 400 kilobytes.
>> [/quote]
>>
>> Unfortunately, ours mod_python.so is 1.3M in size:
>> # ls -lh /usr/lib64/apache2/modules/mod_python.so
>> -rwxr-xr-x 1 root root 1.3M 2007-04-26 08:42 /usr/lib64/apache2/
>> modules/mod_python.so
>>
>> Since our Linux box is running Gentoo 2006.1, we do have the shared
>> library for Python:
>> # ls -l /usr/lib/libpython2.4.so
>> lrwxrwxrwx 1 root root 19 2007-05-28 17:24 /usr/lib/libpython2.4.so -
>>  > libpython2.4.so.1.0
>> # ls -l /usr/lib/libpython2.4.so.1.0
>> -r-xr-xr-x 1 root root 1073360 2007-05-28 17:24 /usr/lib/
>> libpython2.4.so.1.0
>
> What Python libraries are in:
>
>  /usr/lib64/python2.4/config
>
> and:
>
>  /usr/lib64
>
> Ie., the 64 bit lib directories.
>
> It is going to look in the 'config' directory location above first and
> if there is only a static library there are not a shared library, it
> will probably use the static library. This is because the link line
> for library building according to your logs is:
>
>  -L/usr/lib64/python2.4/config
>
> Graham

# ls /usr/lib64/python2.4/config
config.c     install-sh      Makefile         makesetup   
Setup         Setup.local
config.c.in  libpython2.4.a  Makefile.pre.in  python.o   Setup.config

Indeed there is only a static library.

# ls -ld /usr/lib
lrwxrwxrwx 1 root root 5 2006-04-03 16:20 /usr/lib -> lib64

The memory usage of mod_python with the static linked Python on our  
box is (via top):
   PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND
12243 aiyo       1   0  114m  51m 4428 S  0.0  2.0  22:05.23 /usr/ 
sbin/apache2 -f /home/aiyo/apach
12605 aiyo       1   0  106m  47m 3536 S  6.0  1.9  17:47.74 /usr/ 
sbin/apache2 -f /home/aiyo/apach
13192 aiyo       1   0  102m  44m 3536 S  5.0  1.8   7:38.23 /usr/ 
sbin/apache2 -f /home/aiyo/apach
12949 aiyo       1   0  103m  44m 3540 S  0.0  1.8  11:32.30 /usr/ 
sbin/apache2 -f /home/aiyo/apach
13297 aiyo       1   0  101m  43m 3536 S  0.0  1.7   5:12.81 /usr/ 
sbin/apache2 -f /home/aiyo/apach
27974 aiyo      31   0 96200  11m 6188 S  0.0  0.4   0:01.95 /usr/ 
sbin/apache2 -f /home/aiyo/php/h
28606 aiyo       1   0 95212  10m 6064 S  0.0  0.4   0:01.58 /usr/ 
sbin/apache2 -f /home/aiyo/php/h
28604 aiyo       1   0 95224  10m 5964 S  0.0  0.4   0:01.89 /usr/ 
sbin/apache2 -f /home/aiyo/php/h
12128 aiyo       1   0 95192 9856 5504 S  0.0  0.4   0:00.41 /usr/ 
sbin/apache2 -f /home/aiyo/php/h
27972 aiyo      17   0 93004 8264 4992 S  0.0  0.3   0:00.17 /usr/ 
sbin/apache2 -f /home/aiyo/php/h

The first five apache process is an apache instance running  
mod_python, the next five apache process is another apache instance  
running mod_php5.

I just found out there is a program called 'python-config', whose  
output is:
# python-config
-lpython2.4 -lm -L/usr/lib64/python2.4/config

Seems to me that this is where the link parameters for Python come  
from, but don't know how to adjust it to have '-L/usr/lib64'.

I decided to supply the environment variable LDFLAGS="-L/usr/lib64"  
while compiling mod_python, that results in such link command:
/usr/share/apr-0/build/libtool --silent --mode=link x86_64-pc-linux- 
gnu-gcc -o mod_python.la  -rpath /usr/lib64/apache2/modules -module - 
avoid-version    finfoobject.lo hlistobject.lo hlist.lo  
filterobject.lo connobject.lo serverobject.lo util.lo tableobject.lo  
requestobject.lo _apachemodule.lo mod_python.lo -L/usr/lib64 -L/usr/ 
lib64/python2.4/config -Xlinker -export-dynamic -lm -lpython2.4 - 
lpthread -ldl -lutil -lm

# ldd src/.libs/mod_python.so
         libpython2.4.so.1.0 => /usr/lib/libpython2.4.so.1.0  
(0x00002b359b034000)
         libpthread.so.0 => /lib/libpthread.so.0 (0x00002b359b240000)
         libdl.so.2 => /lib/libdl.so.2 (0x00002b359b35a000)
         libutil.so.1 => /lib/libutil.so.1 (0x00002b359b45f000)
         libm.so.6 => /lib/libm.so.6 (0x00002b359b562000)
         libc.so.6 => /lib/libc.so.6 (0x00002b359b6b7000)
         /lib64/ld-linux-x86-64.so.2 (0x0000555555554000)

Now the memory usage of mod_python with the dynamic linked Python on  
our box is (via top):
   PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND
20754 aiyo       5   0  114m  46m 4460 S  0.0  1.9  12:16.48 /usr/ 
sbin/apache2 -f /home/aiyo/apach
22607 aiyo       1   0  105m  44m 3472 S  0.0  1.8   2:16.71 /usr/ 
sbin/apache2 -f /home/aiyo/apach
21664 aiyo       1   0  104m  44m 3916 S  0.0  1.8   8:18.80 /usr/ 
sbin/apache2 -f /home/aiyo/apach
22498 aiyo       1   0  103m  43m 3476 S  1.0  1.7   2:18.09 /usr/ 
sbin/apache2 -f /home/aiyo/apach
22681 aiyo       1   0  101m  42m 3472 S  0.0  1.7   1:11.02 /usr/ 
sbin/apache2 -f /home/aiyo/apach
22721 aiyo       1   0 99.5m  40m 3460 S  0.0  1.6   0:19.66 /usr/ 
sbin/apache2 -f /home/aiyo/apach

Looks like I do squeeze a few meg bytes out of each apache process  
with your help. :-)
Thanks.

BR,
- Cheng
From graham.dumpleton at gmail.com  Tue May 29 06:58:19 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue May 29 06:58:25 2007
Subject: [mod_python] Mod_python compilation question,
	per your's comment on "What Powers Curse"
In-Reply-To: <CEAE34F9-4A41-47CE-BC69-D043EB8689B1@gmail.com>
References: <83995040-224D-4B49-B14F-CA7F2D489F98@gmail.com>
	<88e286470705280303w31452458y5da2da8077c92de7@mail.gmail.com>
	<CEAE34F9-4A41-47CE-BC69-D043EB8689B1@gmail.com>
Message-ID: <88e286470705290358v3de457ffme0f02ef68e566482@mail.gmail.com>

What they have done wrong is that in:

  /usr/lib64/python2.4/config

they should have a symlink to the libpython2.4.so in /usr/lib64.

On Ubuntu they have this link and it compiles fine.

Graham

On 29/05/07,  <czhang.web@gmail.com> wrote:
>
> On 2007-5-28, at 6:03, Graham Dumpleton wrote:
>
> > On 28/05/07,  <czhang.web@gmail.com> wrote:
> >> Graham or other mod_python gurus on the m-list:
> >>
> >> I tried to verify our mod_python compilation/installation is indeed
> >> correct after I read the comment <http://www.davidcramer.net/curse/
> >> 44/
> >> what-powers-curse.html#comment-9271>, especially this part:
> >> [quote]
> >> As a reference point for discussion a correctly compiled Python/
> >> mod_python should only result in an Apache mod_python.so loadable
> >> module of at most about 400 kilobytes.
> >> [/quote]
> >>
> >> Unfortunately, ours mod_python.so is 1.3M in size:
> >> # ls -lh /usr/lib64/apache2/modules/mod_python.so
> >> -rwxr-xr-x 1 root root 1.3M 2007-04-26 08:42 /usr/lib64/apache2/
> >> modules/mod_python.so
> >>
> >> Since our Linux box is running Gentoo 2006.1, we do have the shared
> >> library for Python:
> >> # ls -l /usr/lib/libpython2.4.so
> >> lrwxrwxrwx 1 root root 19 2007-05-28 17:24 /usr/lib/libpython2.4.so -
> >>  > libpython2.4.so.1.0
> >> # ls -l /usr/lib/libpython2.4.so.1.0
> >> -r-xr-xr-x 1 root root 1073360 2007-05-28 17:24 /usr/lib/
> >> libpython2.4.so.1.0
> >
> > What Python libraries are in:
> >
> >  /usr/lib64/python2.4/config
> >
> > and:
> >
> >  /usr/lib64
> >
> > Ie., the 64 bit lib directories.
> >
> > It is going to look in the 'config' directory location above first and
> > if there is only a static library there are not a shared library, it
> > will probably use the static library. This is because the link line
> > for library building according to your logs is:
> >
> >  -L/usr/lib64/python2.4/config
> >
> > Graham
>
> # ls /usr/lib64/python2.4/config
> config.c     install-sh      Makefile         makesetup
> Setup         Setup.local
> config.c.in  libpython2.4.a  Makefile.pre.in  python.o   Setup.config
>
> Indeed there is only a static library.
>
> # ls -ld /usr/lib
> lrwxrwxrwx 1 root root 5 2006-04-03 16:20 /usr/lib -> lib64
>
> The memory usage of mod_python with the static linked Python on our
> box is (via top):
>    PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND
> 12243 aiyo       1   0  114m  51m 4428 S  0.0  2.0  22:05.23 /usr/
> sbin/apache2 -f /home/aiyo/apach
> 12605 aiyo       1   0  106m  47m 3536 S  6.0  1.9  17:47.74 /usr/
> sbin/apache2 -f /home/aiyo/apach
> 13192 aiyo       1   0  102m  44m 3536 S  5.0  1.8   7:38.23 /usr/
> sbin/apache2 -f /home/aiyo/apach
> 12949 aiyo       1   0  103m  44m 3540 S  0.0  1.8  11:32.30 /usr/
> sbin/apache2 -f /home/aiyo/apach
> 13297 aiyo       1   0  101m  43m 3536 S  0.0  1.7   5:12.81 /usr/
> sbin/apache2 -f /home/aiyo/apach
> 27974 aiyo      31   0 96200  11m 6188 S  0.0  0.4   0:01.95 /usr/
> sbin/apache2 -f /home/aiyo/php/h
> 28606 aiyo       1   0 95212  10m 6064 S  0.0  0.4   0:01.58 /usr/
> sbin/apache2 -f /home/aiyo/php/h
> 28604 aiyo       1   0 95224  10m 5964 S  0.0  0.4   0:01.89 /usr/
> sbin/apache2 -f /home/aiyo/php/h
> 12128 aiyo       1   0 95192 9856 5504 S  0.0  0.4   0:00.41 /usr/
> sbin/apache2 -f /home/aiyo/php/h
> 27972 aiyo      17   0 93004 8264 4992 S  0.0  0.3   0:00.17 /usr/
> sbin/apache2 -f /home/aiyo/php/h
>
> The first five apache process is an apache instance running
> mod_python, the next five apache process is another apache instance
> running mod_php5.
>
> I just found out there is a program called 'python-config', whose
> output is:
> # python-config
> -lpython2.4 -lm -L/usr/lib64/python2.4/config
>
> Seems to me that this is where the link parameters for Python come
> from, but don't know how to adjust it to have '-L/usr/lib64'.
>
> I decided to supply the environment variable LDFLAGS="-L/usr/lib64"
> while compiling mod_python, that results in such link command:
> /usr/share/apr-0/build/libtool --silent --mode=link x86_64-pc-linux-
> gnu-gcc -o mod_python.la  -rpath /usr/lib64/apache2/modules -module -
> avoid-version    finfoobject.lo hlistobject.lo hlist.lo
> filterobject.lo connobject.lo serverobject.lo util.lo tableobject.lo
> requestobject.lo _apachemodule.lo mod_python.lo -L/usr/lib64 -L/usr/
> lib64/python2.4/config -Xlinker -export-dynamic -lm -lpython2.4 -
> lpthread -ldl -lutil -lm
>
> # ldd src/.libs/mod_python.so
>          libpython2.4.so.1.0 => /usr/lib/libpython2.4.so.1.0
> (0x00002b359b034000)
>          libpthread.so.0 => /lib/libpthread.so.0 (0x00002b359b240000)
>          libdl.so.2 => /lib/libdl.so.2 (0x00002b359b35a000)
>          libutil.so.1 => /lib/libutil.so.1 (0x00002b359b45f000)
>          libm.so.6 => /lib/libm.so.6 (0x00002b359b562000)
>          libc.so.6 => /lib/libc.so.6 (0x00002b359b6b7000)
>          /lib64/ld-linux-x86-64.so.2 (0x0000555555554000)
>
> Now the memory usage of mod_python with the dynamic linked Python on
> our box is (via top):
>    PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND
> 20754 aiyo       5   0  114m  46m 4460 S  0.0  1.9  12:16.48 /usr/
> sbin/apache2 -f /home/aiyo/apach
> 22607 aiyo       1   0  105m  44m 3472 S  0.0  1.8   2:16.71 /usr/
> sbin/apache2 -f /home/aiyo/apach
> 21664 aiyo       1   0  104m  44m 3916 S  0.0  1.8   8:18.80 /usr/
> sbin/apache2 -f /home/aiyo/apach
> 22498 aiyo       1   0  103m  43m 3476 S  1.0  1.7   2:18.09 /usr/
> sbin/apache2 -f /home/aiyo/apach
> 22681 aiyo       1   0  101m  42m 3472 S  0.0  1.7   1:11.02 /usr/
> sbin/apache2 -f /home/aiyo/apach
> 22721 aiyo       1   0 99.5m  40m 3460 S  0.0  1.6   0:19.66 /usr/
> sbin/apache2 -f /home/aiyo/apach
>
> Looks like I do squeeze a few meg bytes out of each apache process
> with your help. :-)
> Thanks.
>
> BR,
> - Cheng

From fidita48 at hotmail.com  Tue May 29 16:00:52 2007
From: fidita48 at hotmail.com (=?iso-8859-1?B?SWRvaWEgVmlsbGFjaeFuIFrhcmF0ZQ==?=)
Date: Tue May 29 16:01:03 2007
Subject: [SPAM] Re: [mod_python] Error
In-Reply-To: <88e286470705281520r29c3b0f5y77f783fe30785634@mail.gmail.com>
Message-ID: <BAY137-F32DA296568C3CA86288EF2D42F0@phx.gbl>

An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070529/a233e1d1/attachment-0001.html
From habnabit at gmail.com  Tue May 29 17:56:35 2007
From: habnabit at gmail.com (Aaron Gallagher)
Date: Tue May 29 17:56:45 2007
Subject: [mod_python] Apache directory listing
In-Reply-To: <88e286470705281511s3ee1ee5cqffa67f500a463abb@mail.gmail.com>
References: <641494D0-A3E3-400B-BC16-9A8F2995B2CD@gmail.com>
	<88e286470705280322o21c5f8e1w66b70066838e18a9@mail.gmail.com>
	<AEF6BFBA-38AA-4BFE-85AC-F08B49951CF7@gmail.com>
	<88e286470705280344m39d0f233p62b1b56365f590a3@mail.gmail.com>
	<1759D23B-7ACF-49BD-AF36-F4481639CEE8@gmail.com>
	<88e286470705280422w4e65012o37c9866d43c768a5@mail.gmail.com>
	<38671595-13BC-496F-B178-002D3BEDA60C@gmail.com>
	<88e286470705281356j7698aca6u595b565824b71118@mail.gmail.com>
	<88e286470705281511s3ee1ee5cqffa67f500a463abb@mail.gmail.com>
Message-ID: <1FCFF8A5-7ABF-45F5-AEE9-58FD822F9782@gmail.com>

Okay, I had limited success with mod_autoindex, but unfortunately it  
seems to be impossible to have Apache autoindex the directory.  
Writing my own indexer was pretty simple and it's working well.

Now, though, I'm trying to figure out how to catch errors like 401  
and 403 errors and handle them within my fixuphandler. Is this  
possible? My fixuphandler is currently using the internal_redirect  
function to use a custom 404 page, but I'd like to potentially catch  
all of my errors without using the internal_redirect function.

My authenhandler returns 401 or 403 if there's a bad username or  
password, but it seems that it doesn't go to my fixuphandler but  
apache generates the error pages on its own. It seems like whenever I  
return an error code, apache generates an error page.

So, I guess my question is how I should catch every error to make  
custom error pages?

On May 28, 2007, at 3:11 PM, Graham Dumpleton wrote:

> BTW, SetHandler is only processed in typehandler phase. Thus if you
> want to override that, you must be doing it in the fixuphandler phase.
>
> Also note that allowing automatic directory listings in mod_python can
> cause issues if there are subdirectories which are also managed in
> some way by mod_python. Can't remember whether there is an issue
> logged about it or whether I ranted about it on one of the mailing
> lists somewhere.
>
> Graham
>
> On 29/05/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
>> If a phase earlier than response handler phase is providing the
>> complete response, it should return apache.DONE and not apache.OK.
>> This will stop later phases running.
>>
>> Graham
>>
>> On 28/05/07, Aaron Gallagher <habnabit@gmail.com> wrote:
>> > I've just moved a lot of my code (including the code that checks to
>> > see if a directory should have its contents listed) from a
>> > PythonHandler into a PythonHeaderParserHandler, because after  
>> looking
>> > at the response loop, I determined that PythonFixupHandler was
>> > happening too late in the process.
>> >
>> > It's created some interesting new problems -- my calls to
>> > req.internal_redirect aren't working, as the code was set up  
>> like this:
>> > req.internal_redirect(...)
>> > return apache.OK
>> > I guess this isn't stopping the request, like it used to do. How
>> > should I change my code to allow internal redirects?
>> >
>> > Also, all of your suggestions just act the same way as if I had  
>> just
>> > done return apache.OK.
>> >
>> >
>> > On May 28, 2007, at 4:22 AM, Graham Dumpleton wrote:
>> >
>> > > On 28/05/07, Aaron Gallagher <habnabit@gmail.com> wrote:
>> > >> Okay, I'll try that.
>> > >>
>> > >> But, what exactly is the purpose of a PythonFixupHandler? The
>> > >> documentation doesn't have much to say, but I assume it's for  
>> doing
>> > >> URL rewriting and redirection.
>> > >
>> > > Potentially. It is one of a number of phases and is a sort of  
>> catch
>> > > all or last chance phase before actual response handler is  
>> executed.
>> > > For a very technical description of the whole Apache request- 
>> response
>> > > loop see:
>> > >
>> > >  http://www.fmc-modeling.org/projects/apache/html/
>> > > 4_4Request_Response_Loop.html
>> > >
>> > > If you really want to understand how Apache works, that whole  
>> document
>> > > is quite a good read, albeit probably more in depth than most  
>> people
>> > > would care for.
>> > >
>> > > Graham
>> > >
>> > >> On May 28, 2007, at 3:44 AM, Graham Dumpleton wrote:
>> > >>
>> > >> > Arrgghh, mistook mime type for handler.
>> > >> >
>> > >> > Trying again, although not sure this will work, but might  
>> be able
>> > >> > to say:
>> > >> >
>> > >> >  req.handler = "httpd/unix-directory"
>> > >> >  return apache.DECLINED
>> > >> >
>> > >> > The reason this might not work is that mod_python registers
>> > >> itself as
>> > >> > a middle handler as does the autoindex module. Because the
>> > >> autoindex
>> > >> > module is inbuilt, it probably gets processed prior to  
>> mod_python
>> > >> > handler so too late to do the above.
>> > >> >
>> > >> > Thus, your only choice would be to provide a fixuphandler  
>> which
>> > >> undoes
>> > >> > the SetHandler just for the request against the directory and
>> > >> triggers
>> > >> > autoindex instead. Ie.,
>> > >> >
>> > >> >  def fixuphandler(req):
>> > >> >    if req.content_type = "httpd/x-directory":
>> > >> >      req.handler = "httpd/unix-directory"
>> > >> >    return apache.OK
>> > >> >
>> > >> > Enable this using appropriate PythonFixupHandler directive.
>> > >> >
>> > >> > Graham
>> > >> >
>> > >> > On 28/05/07, Aaron Gallagher <habnabit@gmail.com> wrote:
>> > >> >> I get a 404 Not Found error.
>> > >> >>
>> > >> >> On May 28, 2007, at 3:22 AM, Graham Dumpleton wrote:
>> > >> >>
>> > >> >> > What happens if you return apache.DECLINED.
>> > >> >> >
>> > >> >> > Graham
>> > >> >> >
>> > >> >> > On 28/05/07, Aaron Gallagher <habnabit@gmail.com> wrote:
>> > >> >> >>
>> > >> >> >> Is there a way to tell Apache to give a directory  
>> listing? I'm
>> > >> >> using
>> > >> >> >> SetHandler on a directory, and in some cases, I don't need
>> > >> to do
>> > >> >> >> any special
>> > >> >> >> handling, so I'd like Apache to just list the contents  
>> of the
>> > >> >> >> directory so
>> > >> >> >> that I don't have to write my own way of doing it.
>> > >> >> >>
>> > >> >> >> Just returning apache.OK has Apache send a document of  
>> MIME
>> > >> time
>> > >> >> >> httpd/x-directory with content length 0.
>> > >> >> >>
>> > >> >> >> Aaron Gallagher
>> > >> >> >> <habnabit@gmail.com>
>> > >> >> >>
>> > >> >> >>
>> > >> >> >> _______________________________________________
>> > >> >> >> Mod_python mailing list
>> > >> >> >> Mod_python@modpython.org
>> > >> >> >> http://mailman.modpython.org/mailman/listinfo/mod_python
>> > >> >> >>
>> > >> >> >>
>> > >> >>
>> > >> >> Aaron Gallagher
>> > >> >> <habnabit@gmail.com>
>> > >> >>
>> > >> >>
>> > >> >>
>> > >>
>> > >> Aaron Gallagher
>> > >> <habnabit@gmail.com>
>> > >>
>> > >>
>> > >>
>> >
>> > Aaron Gallagher
>> > <habnabit@gmail.com>
>> >
>> >
>> > _______________________________________________
>> > Mod_python mailing list
>> > Mod_python@modpython.org
>> > http://mailman.modpython.org/mailman/listinfo/mod_python
>> >
>>

Aaron Gallagher
<habnabit@gmail.com>


From graham.dumpleton at gmail.com  Tue May 29 18:54:35 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue May 29 18:54:42 2007
Subject: [mod_python] Error
In-Reply-To: <BAY137-F32DA296568C3CA86288EF2D42F0@phx.gbl>
References: <88e286470705281520r29c3b0f5y77f783fe30785634@mail.gmail.com>
	<BAY137-F32DA296568C3CA86288EF2D42F0@phx.gbl>
Message-ID: <88e286470705291554p392ddf18xb523cf27e6e8b32a@mail.gmail.com>

So, after all that it is now working after all. I'm confused.

Graham

On 30/05/07, Idoia Villaci?n Z?rate <fidita48@hotmail.com> wrote:
>
>
>
> Hello,
>
>
>
> When I acces from my URL,that is
> http://localhost/mywebdir/mptest.py, where mptest.py is the
> following program:
>
>
>
> from mod_python import apache
>
>
>
> def handler(req):
>
>     req.content_type = 'text/plain'
>
>     req.write("Hello World!")
>
>     return apache.OK
>
>
>
> The localhost is DocumentRoot "C:/Archivos de programa/Apache Software
> Foundation/Apache2.2/htdocs", mywebdir is the folder where the file mptest
> is, and I get the message Hello world! And in the error log I get :
>
>
>
> [Tue May 29 17:06:49 2007] [notice] mod_python (pid=3844,
> interpreter='127.0.0.1'): Importing module 'C:\\Archivos de
> programa\\Apache Software
> Foundation\\Apache2.2\\htdocs\\mywebdir\\mptest.py'
>
>
>
> If I change the code for the one you give me:
> print "Content-type: text/html\n\n"
> print "Hello, World."
>
>  When I access to the URL y get a message MOD_PYTHON ERROR, and I don't get
> the Hello world, and in the apache's error lof I get the following:
>
>
>
>
> [Tue May 29 21:16:56 2007] [error] [client 127.0.0.1] mod_python (pid=2236,
> interpreter='127.0.0.1', phase='PythonHandler', handler='mptest'):
> Application error
> [Tue May 29 21:16:56 2007] [error] [client 127.0.0.1] ServerName:
> '127.0.0.1'
> [Tue May 29 21:16:56 2007] [error] [client 127.0.0.1] DocumentRoot:
> 'C:/Archivos de programa/Apache Software Foundation/Apache2.2/htdocs'
> [Tue May 29 21:16:56 2007] [error] [client 127.0.0.1] URI:
> '/mywebdir/mptest.py'
> [Tue May 29 21:16:56 2007] [error] [client 127.0.0.1] Location: None
> [Tue May 29 21:16:56 2007] [error] [client 127.0.0.1] Directory:
> 'C:/Archivos de programa/Apache Software
> Foundation/Apache2.2/htdocs/mywebdir/'
> [Tue May 29 21:16:56 2007] [error] [client 127.0.0.1] Filename: 'C:/Archivos
> de programa/Apache Software
> Foundation/Apache2.2/htdocs/mywebdir/mptest.py'
> [Tue May 29 21:16:56 2007] [error] [client 127.0.0.1] PathInfo: ''
> [Tue May 29 21:16:57 2007] [error] [client 127.0.0.1] Traceback (most recent
> call last):
> [Tue May 29 21:16:57 2007] [error] [client 127.0.0.1]   File
> "C:\\Python24\\Lib\\site-packages\\mod_python\\importer.py",
> line 1537, in HandlerDispatch\n
> default=default_handler, arg=req, silent=hlist.silent)
> [Tue May 29 21:16:57 2007] [error] [client 127.0.0.1]   File
> "C:\\Python24\\Lib\\site-packages\\mod_python\\importer.py",
> line 1206, in _process_target\n    object = apache.resolve_object(module,
> object_str, arg, silent=silent)
> [Tue May 29 21:16:57 2007] [error] [client 127.0.0.1]   File
> "C:\\Python24\\Lib\\site-packages\\mod_python\\apache.py",
> line 696, in resolve_object\n    raise AttributeError, s
> [Tue May 29 21:16:57 2007] [error] [client 127.0.0.1] AttributeError: module
> 'C:\\Archivos de programa\\Apache Software
> Foundation\\Apache2.2\\htdocs\\mywebdir\\mptest.py'
> contains no 'handler'
>
>
>
>
>  Thanks
>
>
>  ________________________________
>
> From:  "Graham Dumpleton" <graham.dumpleton@gmail.com>
> To:  "Idoia Villaci?n Z?rate" <fidita48@hotmail.com>
> CC:  mod_python@modpython.org
> Subject:  Re: [mod_python] Error
> Date:  Tue, 29 May 2007 08:20:23 +1000
> >Hmmm, no mention of CGI in those bits that may be relevant.
> >
> >Lets try this a different way. Replace your existing code file with
> >another with the same name but containing:
> >
> >  print "Content-type: text/html\n\n"
> >  print "Hello, World."
> >
> >When you access the URL you have been using, what is displayed in
> >your
> >browser and the error logs then?
> >
> >If this works okay, then it confirms your Apache must be configured
> >for CGI somehow and it is overriding mod_python.
> >
> >BTW, what URL are you actually using in your browser again. I don't
> >recollect seeing you post what you were using.
> >
> >You also may want to confirm whether you are indeed setting up
> >everything correctly by following alternate instructions in:
> >
> >
> >http://www.dscpl.com.au/wiki/ModPython/Articles/GettingModPythonWorking
> >
> >You will have to get htaccess files working for your Windows box
> >though.
> >
> >Graham
> >
> >On 29/05/07, Idoia Villaci??n Z??rate <fidita48@hotmail.com> wrote:
> >>
> >>
> >>
> >>Hello,
> >>
> >>
> >>
> >>What I have in apache's configuration is the following
> >>
> >>
> >>
> >><Directory "C:/Archivos de programa/Apache Software
> >>Foundation/Apache2.2/htdocs">
> >>
> >>     #
> >>
> >>     # Possible values for the Options directive are "None", "All",
> >>
> >>     # or any combination of:
> >>
> >>     #   Indexes Includes FollowSymLinks SymLinksifOwnerMatch
> >>ExecCGI
> >>MultiViews
> >>
> >>     #
> >>
> >>     # Note that "MultiViews" must be named *explicitly* ---
> >>"Options All"
> >>
> >>     # doesn't give it to you.
> >>
> >>     #
> >>
> >>     # The Options directive is both complicated and important.
> >>Please see
> >>
> >>     #
> >>http://httpd.apache.org/docs/2.2/mod/core.html#options
> >>
> >>     # for more information.
> >>
> >>     #
> >>
> >>     Options Indexes FollowSymLinks
> >>
> >>
> >>
> >>     #
> >>
> >>     # AllowOverride controls what directives may be placed in
> >>.htaccess
> >>files.
> >>
> >>     # It can be "All", "None", or any combination of the keywords:
> >>
> >>     #   Options FileInfo AuthConfig Limit
> >>
> >>     #
> >>
> >>     AllowOverride None
> >>
> >>
> >>
> >>     #
> >>
> >>     # Controls who can get stuff from this server.
> >>
> >>     #
> >>
> >>     Order allow,deny
> >>
> >>     Allow from all
> >>
> >>
> >>
> >></Directory>
> >>
> >>
> >>
> >>And finally:
> >>
> >>
> >>
> >>#AddHandler cgi-script .cgi
> >>
> >>
> >>
> >>Thanks
> >>
> >>
> >>
> >>
> >>
> >>
> >>
> >>  ________________________________
> >>
> >>From:  "Graham Dumpleton" <graham.dumpleton@gmail.com>
> >>To:  "Idoia Villaci???n Z???rate" <fidita48@hotmail.com>
>
> >>CC:  mod_python@modpython.org
> >>Subject:  Re: [mod_python] Error
> >>Date:  Sat, 26 May 2007 21:36:53 +1000
> >>
> >> >I was hoping for the region of the log file which also showed
> >>your
> >> >error:
> >> >
> >> >Traceback (most recent call last):
> >> >
> >> >  File "C:\Archivos de programa\Apache Software
> >> >Foundation\Apache2.2\htdocs\mptest.py", line 1, in ?
> >> >
> >> >    from mod_python import apache
> >> >
> >> >  File
> >>"C:\Python24\Lib\site-packages\mod_python\apache.py",
> line
> >> >30, in ?
> >> >
> >> >    import _apache
> >> >ImportError: No module named _apache
> >> >
> >> >embedded within the middle of it.
> >> >
> >> >Ie., something like:
> >> >
> >> >[Mon Apr 09 13:30:15 2007] [error] [client 127.0.0.1] mod_python
> >> >(pid=7293, interpreter='grumpy.local', phase='PythonHandler',
> >> >handler='paste.modpython'): Application error
> >> >[Mon Apr 09 13:30:15 2007] [error] [client 127.0.0.1] ServerName:
> >> >'grumpy.local'[Mon Apr 09 13:30:15 2007] [error] [client
> >>127.0.0.1]
> >> >DocumentRoot: '/usr/local/apache-2.2/htdocs'
> >> >[Mon Apr 09 13:30:15 2007] [error] [client 127.0.0.1] URI:
> >> >'/mod_python/hello'[Mon Apr 09 13:30:15 2007] [error] [client
> >> >127.0.0.1] Location: '/mod_python/hello'[Mon Apr 09 13:30:15
> >>2007]
> >> >[error] [client 127.0.0.1] Directory: None
> >> >[Mon Apr 09 13:30:15 2007] [error] [client 127.0.0.1] Filename:
> >> >'/usr/local/apache-2.2/htdocs/mod_python'
> >> >[Mon Apr 09 13:30:15 2007] [error] [client 127.0.0.1] PathInfo:
> >> >'/hello'
> >> >[Mon Apr 09 13:30:15 2007] [error] [client 127.0.0.1] Traceback
> >> >(most
> >> >recent call last):
> >> >[Mon Apr 09 13:30:15 2007] [error] [client 127.0.0.1]   File
> >>
> >"/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site-packages/mod_python/importer.py",
> >> >line 1537, in HandlerDispatch\n
> >>default=default_handler, arg=req,
> >> >silent=hlist.silent)[Mon Apr 09 13:30:15 2007] [error] [client
> >> >127.0.0.1]   File
> >>
> >"/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site-packages/mod_python/importer.py",
> >> >line 1229, in _process_target\n    result =
> >>_execute_target(config,
> >> >req, object, arg)[Mon Apr 09 13:30:15 2007] [error] [client
> >> >127.0.0.1]
> >> >  File
> >>
> >"/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site-packages/mod_python/importer.py",
> >> >line 1128, in _execute_target\n    result = object(arg)[Mon Apr
> >>09
> >> >13:30:15 2007] [error] [client 127.0.0.1]   File
> >>
> >"/Library/Python/2.3/site-packages/Paste-1.2.1-py2.3.egg/paste/modpython.py",
> >> >line 246, in handler\n    module = __import__(modname, globals(),
> >> >locals(), [''])[Mon Apr 09 13:30:15 2007] [error] [client
> >>127.0.0.1]
> >> >File "/usr/local/wsgi/scripts/hello.py", line 3, in ?\n
> >>import
> >> >mod_wsgi[Mon Apr 09 13:30:15 2007] [error] [client 127.0.0.1]
> >> >ImportError: No module named mod_wsgi
> >> >
> >> >The thing I just realised though is that your error message can't
> >>be
> >> >a
> >> >result of a failure of mod_python as the way mod_python logs
> >> >tracebacks means that the details would have the timestamp
> >> >information
> >> >prefixing each line like above. That they don't appear means your
> >> >script is probably most definitely being executed as a CGI script
> >> >and
> >> >not by mod_python.
> >> >
> >> >Thus I would suggest you have a configuration problem with HTTP.
> >> >Specifically, you have CGI scripts enabled for that directory, or
> >> >for
> >> >the .py extension.
> >> >
> >> >What do you have elsewhere in your Apache configuration relating
> >>to
> >> >CGI scripts. Do you have anything like:
> >> >
> >> >  AddHandler cgi-script .py
> >> >
> >> >or:
> >> >
> >> >  Options ExecCGI
> >> >
> >> >Find that section of your configuration and reply-all and quote
> >>it.
> >> >
> >> >Graham
> >> >
> >> >
> >> >
> >> >On 26/05/07, Idoia Villaci??n Z??rate <fidita48@hotmail.com>
>
> >>wrote:
> >> >>
> >> >>
> >> >>I'm sorry, I didn't know I have to send back the mails, I'll do
> >>it
> >> >>from now.
> >> >>
> >> >>
> >> >>
> >> >>here I send you the lines of apache's log error:
> >> >>
> >> >>[Sat May 26 12:42:26 2007] [notice] Apache/2.2.4 (Win32)
> >>configured
> >> >>--
> >> >>resuming normal operations
> >> >>
> >> >>[Sat May 26 12:42:26 2007] [notice] Server built: Jan  9 2007
> >> >>23:17:20
> >> >>
> >> >>[Sat May 26 12:42:26 2007] [notice] Parent: Created child
> >>process
> >> >>1604
> >> >>
> >> >>[Sat May 26 12:42:27 2007] [notice] Child 1604: Child process is
> >> >>running
> >> >>
> >> >>[Sat May 26 12:42:27 2007] [notice] Child 1604: Acquired the
> >>start
> >> >>mutex.
> >> >>
> >> >>[Sat May 26 12:42:27 2007] [notice] Child 1604: Starting 250
> >>worker
> >> >>threads.
> >> >>
> >> >>[Sat May 26 12:42:27 2007] [notice] Child 1604: Starting thread
> >>to
> >> >>listen on
> >> >>port 80.
> >> >>
> >> >>[Sat May 26 12:59:04 2007] [notice] Parent: Received restart
> >>signal
> >> >>--
> >> >>Restarting the server.
> >> >>
> >> >>[Sat May 26 12:59:04 2007] [notice] Child 1604: Exit event
> >> >>signaled. Child
> >> >>process is ending.
> >> >>
> >> >>[Sat May 26 12:59:04 2007] [notice] Apache/2.2.4 (Win32)
> >>configured
> >> >>--
> >> >>resuming normal operations
> >> >>
> >> >>[Sat May 26 12:59:04 2007] [notice] Server built: Jan  9 2007
> >> >>23:17:20
> >> >>
> >> >>[Sat May 26 12:59:04 2007] [notice] Parent: Created child
> >>process
> >> >>5332
> >> >>
> >> >>[Sat May 26 12:59:05 2007] [error] python_init: Python version
> >> >>mismatch,
> >> >>expected '2.4.3', found '2.4.4'.
> >> >>
> >> >>[Sat May 26 12:59:05 2007] [error] python_init: Python
> >>executable
> >> >>found
> >> >>'C:\\Archivos de programa\\Apache Software
> >> >>Foundation\\Apache2.2\\bin\\httpd.exe'.
> >> >>
> >> >>[Sat May 26 12:59:05 2007] [error] python_init: Python path
> >>being
> >> >>used
> >>
> >>'C:\\WINDOWS\\system32\\python24.zip;C:\\Python24\\Lib;C:\\Python24\\DLLs;C:\\Python24\\Lib\\lib-tk;;C:\\Archivos
> >> >>de programa\\Apache Software Foundation\\Apache2.2\\bin'.
> >> >>
> >> >>[Sat May 26 12:59:05 2007] [notice] mod_python: Creating 8
> >>session
> >> >>mutexes
> >> >>based on 0 max processes and 250 max threads.
> >> >>
> >> >>[Sat May 26 12:59:05 2007] [notice] Child 5332: Child process is
> >> >>running
> >> >>
> >> >>[Sat May 26 12:59:05 2007] [notice] Child 1604: Released the
> >>start
> >> >>mutex
> >> >>
> >> >>[Sat May 26 12:59:05 2007] [notice] Child 5332: Acquired the
> >>start
> >> >>mutex.
> >> >>
> >> >>[Sat May 26 12:59:05 2007] [notice] Child 5332: Starting 250
> >>worker
> >> >>threads.
> >> >>
> >> >>[Sat May 26 12:59:06 2007] [notice] Child 1604: Waiting for 250
> >> >>worker
> >> >>threads to exit.
> >> >>
> >> >>[Sat May 26 12:59:06 2007] [notice] Child 1604: All worker
> >>threads
> >> >>have
> >> >>exited.
> >> >>
> >> >>[Sat May 26 12:59:06 2007] [notice] Child 1604: Child process is
> >> >>exiting
> >> >>
> >> >>[Sat May 26 12:59:06 2007] [notice] Child 5332: Starting thread
> >>to
> >> >>listen on
> >> >>port 80.
> >> >>
> >> >>[Sat May 26 13:00:22 2007] [notice] Parent: Received restart
> >>signal
> >> >>--
> >> >>Restarting the server.
> >> >>
> >> >>[Sat May 26 13:00:22 2007] [notice] Child 5332: Exit event
> >> >>signaled. Child
> >> >>process is ending.
> >> >>
> >> >>[Sat May 26 13:00:22 2007] [notice] Apache/2.2.4 (Win32)
> >>configured
> >> >>--
> >> >>resuming normal operations
> >> >>
> >> >>[Sat May 26 13:00:22 2007] [notice] Server built: Jan  9 2007
> >> >>23:17:20
> >> >>
> >> >>[Sat May 26 13:00:22 2007] [notice] Parent: Created child
> >>process
> >> >>3408
> >> >>
> >> >>[Sat May 26 13:00:22 2007] [error] python_init: Python version
> >> >>mismatch,
> >> >>expected '2.4.3', found '2.4.4'.
> >> >>
> >> >>[Sat May 26 13:00:22 2007] [error] python_init: Python
> >>executable
> >> >>found
> >> >>'C:\\Archivos de programa\\Apache Software
> >> >>Foundation\\Apache2.2\\bin\\httpd.exe'.
> >> >>
> >> >>[Sat May 26 13:00:22 2007] [error] python_init: Python path
> >>being
> >> >>used
> >>
> >>'C:\\WINDOWS\\system32\\python24.zip;C:\\Python24\\Lib;C:\\Python24\\DLLs;C:\\Python24\\Lib\\lib-tk;;C:\\Archivos
> >> >>de programa\\Apache Software Foundation\\Apache2.2\\bin'.
> >> >>
> >> >>[Sat May 26 13:00:22 2007] [notice] mod_python: Creating 8
> >>session
> >> >>mutexes
> >> >>based on 0 max processes and 250 max threads.
> >> >>
> >> >>[Sat May 26 13:00:22 2007] [notice] Child 3408: Child process is
> >> >>running
> >> >>
> >> >>[Sat May 26 13:00:23 2007] [notice] Child 5332: Released the
> >>start
> >> >>mutex
> >> >>
> >> >>[Sat May 26 13:00:23 2007] [notice] Child 3408: Acquired the
> >>start
> >> >>mutex.
> >> >>
> >> >>[Sat May 26 13:00:23 2007] [notice] Child 3408: Starting 250
> >>worker
> >> >>threads.
> >> >>
> >> >>[Sat May 26 13:00:23 2007] [notice] Child 3408: Starting thread
> >>to
> >> >>listen on
> >> >>port 80.
> >> >>
> >> >>[Sat May 26 13:00:24 2007] [notice] Child 5332: Waiting for 250
> >> >>worker
> >> >>threads to exit.
> >> >>
> >> >>[Sat May 26 13:00:24 2007] [notice] Child 5332: All worker
> >>threads
> >> >>have
> >> >>exited.
> >> >>
> >> >>[Sat May 26 13:00:24 2007] [notice] Child 5332: Child process is
> >> >>exiting
> >> >>
> >> >>[Sat May 26 13:06:54 2007] [notice] Parent: Received restart
> >>signal
> >> >>--
> >> >>Restarting the server.
> >> >>
> >> >>[Sat May 26 13:06:54 2007] [notice] Child 3408: Exit event
> >> >>signaled. Child
> >> >>process is ending.
> >> >>
> >> >>[Sat May 26 13:06:54 2007] [notice] Apache/2.2.4 (Win32)
> >>configured
> >> >>--
> >> >>resuming normal operations
> >> >>
> >> >>[Sat May 26 13:06:54 2007] [notice] Server built: Jan  9 2007
> >> >>23:17:20
> >> >>
> >> >>[Sat May 26 13:06:54 2007] [notice] Parent: Created child
> >>process
> >> >>6388
> >> >>
> >> >>[Sat May 26 13:06:54 2007] [error] python_init: Python version
> >> >>mismatch,
> >> >>expected '2.4.3', found '2.4.4'.
> >> >>
> >> >>[Sat May 26 13:06:54 2007] [error] python_init: Python
> >>executable
> >> >>found
> >> >>'C:\\Archivos de programa\\Apache Software
> >> >>Foundation\\Apache2.2\\bin\\httpd.exe'.
> >> >>
> >> >>[Sat May 26 13:06:54 2007] [error] python_init: Python path
> >>being
> >> >>used
> >>
> >>'C:\\WINDOWS\\system32\\python24.zip;C:\\Python24\\Lib;C:\\Python24\\DLLs;C:\\Python24\\Lib\\lib-tk;;C:\\Archivos
> >> >>de programa\\Apache Software Foundation\\Apache2.2\\bin'.
> >> >>
> >> >>[Sat May 26 13:06:54 2007] [notice] mod_python: Creating 8
> >>session
> >> >>mutexes
> >> >>based on 0 max processes and 250 max threads.
> >> >>
> >> >>[Sat May 26 13:06:54 2007] [notice] Child 6388: Child process is
> >> >>running
> >> >>
> >> >>[Sat May 26 13:06:55 2007] [notice] Child 3408: Released the
> >>start
> >> >>mutex
> >> >>
> >> >>[Sat May 26 13:06:55 2007] [notice] Child 6388: Acquired the
> >>start
> >> >>mutex.
> >> >>
> >> >>[Sat May 26 13:06:55 2007] [notice] Child 6388: Starting 250
> >>worker
> >> >>threads.
> >> >>
> >> >>[Sat May 26 13:06:55 2007] [notice] Child 6388: Starting thread
> >>to
> >> >>listen on
> >> >>port 80.
> >> >>
> >> >>[Sat May 26 13:06:56 2007] [notice] Child 3408: Waiting for 250
> >> >>worker
> >> >>threads to exit.
> >> >>
> >> >>[Sat May 26 13:06:56 2007] [notice] Child 3408: All worker
> >>threads
> >> >>have
> >> >>exited.
> >> >>
> >> >>[Sat May 26 13:06:56 2007] [notice] Child 3408: Child process is
> >> >>exiting
> >> >>
> >> >>
> >> >>
> >> >>Thanks
> >> >>
> >> >>
> >> >>________________________________
> >> >>Acepta el reto MSN Premium: Env???a hasta 500 megas diarios de
> >> >>fotos desde
> >> >>Hotmail. Desc???rgalo y pru???balo 2 meses gratis.
> >>
> >>________________________________
> >>Acepta el reto MSN Premium: Env???a hasta 500 megas diarios de
> >>fotos desde
> >>Hotmail. Desc???rgalo y pru???balo 2 meses gratis.
>
> ________________________________
> Encuentra una aventura, un romance o al amor de tu vida. Date de alta
> gratis.

From graham.dumpleton at gmail.com  Tue May 29 18:59:00 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue May 29 18:59:04 2007
Subject: [mod_python] Apache directory listing
In-Reply-To: <1FCFF8A5-7ABF-45F5-AEE9-58FD822F9782@gmail.com>
References: <641494D0-A3E3-400B-BC16-9A8F2995B2CD@gmail.com>
	<88e286470705280322o21c5f8e1w66b70066838e18a9@mail.gmail.com>
	<AEF6BFBA-38AA-4BFE-85AC-F08B49951CF7@gmail.com>
	<88e286470705280344m39d0f233p62b1b56365f590a3@mail.gmail.com>
	<1759D23B-7ACF-49BD-AF36-F4481639CEE8@gmail.com>
	<88e286470705280422w4e65012o37c9866d43c768a5@mail.gmail.com>
	<38671595-13BC-496F-B178-002D3BEDA60C@gmail.com>
	<88e286470705281356j7698aca6u595b565824b71118@mail.gmail.com>
	<88e286470705281511s3ee1ee5cqffa67f500a463abb@mail.gmail.com>
	<1FCFF8A5-7ABF-45F5-AEE9-58FD822F9782@gmail.com>
Message-ID: <88e286470705291559x6fcc686ep158ad5208140c7c6@mail.gmail.com>

On 30/05/07, Aaron Gallagher <habnabit@gmail.com> wrote:
> Okay, I had limited success with mod_autoindex, but unfortunately it
> seems to be impossible to have Apache autoindex the directory.

I'll have a got at doing what I think you are trying to do later. As I
understand it you want directory index if request against directory,
otherwise SetHandler (or equivalent) should apply. Yes/No?

> Writing my own indexer was pretty simple and it's working well.
>
> Now, though, I'm trying to figure out how to catch errors like 401
> and 403 errors and handle them within my fixuphandler. Is this
> possible? My fixuphandler is currently using the internal_redirect
> function to use a custom 404 page, but I'd like to potentially catch
> all of my errors without using the internal_redirect function.
>
> My authenhandler returns 401 or 403 if there's a bad username or
> password, but it seems that it doesn't go to my fixuphandler but
> apache generates the error pages on its own. It seems like whenever I
> return an error code, apache generates an error page.
>
> So, I guess my question is how I should catch every error to make
> custom error pages?

Use the Apache ErrorDocument directive to specify an internal URL for
the handler which generates the error page. When you return an error
number as status, Apache will invoke the handler associated with the
ErrorDocument for you without you need to do the redirect. If you want
to pass information about the error to the error handler, store it in
req.notes['error-notes']. That value will then be available in
req.subprocess_env of error handler under ERROR_NOTE or
REDIRECT_ERROR_NOTES (cant remember which).

Graham

> On May 28, 2007, at 3:11 PM, Graham Dumpleton wrote:
>
> > BTW, SetHandler is only processed in typehandler phase. Thus if you
> > want to override that, you must be doing it in the fixuphandler phase.
> >
> > Also note that allowing automatic directory listings in mod_python can
> > cause issues if there are subdirectories which are also managed in
> > some way by mod_python. Can't remember whether there is an issue
> > logged about it or whether I ranted about it on one of the mailing
> > lists somewhere.
> >
> > Graham
> >
> > On 29/05/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> >> If a phase earlier than response handler phase is providing the
> >> complete response, it should return apache.DONE and not apache.OK.
> >> This will stop later phases running.
> >>
> >> Graham
> >>
> >> On 28/05/07, Aaron Gallagher <habnabit@gmail.com> wrote:
> >> > I've just moved a lot of my code (including the code that checks to
> >> > see if a directory should have its contents listed) from a
> >> > PythonHandler into a PythonHeaderParserHandler, because after
> >> looking
> >> > at the response loop, I determined that PythonFixupHandler was
> >> > happening too late in the process.
> >> >
> >> > It's created some interesting new problems -- my calls to
> >> > req.internal_redirect aren't working, as the code was set up
> >> like this:
> >> > req.internal_redirect(...)
> >> > return apache.OK
> >> > I guess this isn't stopping the request, like it used to do. How
> >> > should I change my code to allow internal redirects?
> >> >
> >> > Also, all of your suggestions just act the same way as if I had
> >> just
> >> > done return apache.OK.
> >> >
> >> >
> >> > On May 28, 2007, at 4:22 AM, Graham Dumpleton wrote:
> >> >
> >> > > On 28/05/07, Aaron Gallagher <habnabit@gmail.com> wrote:
> >> > >> Okay, I'll try that.
> >> > >>
> >> > >> But, what exactly is the purpose of a PythonFixupHandler? The
> >> > >> documentation doesn't have much to say, but I assume it's for
> >> doing
> >> > >> URL rewriting and redirection.
> >> > >
> >> > > Potentially. It is one of a number of phases and is a sort of
> >> catch
> >> > > all or last chance phase before actual response handler is
> >> executed.
> >> > > For a very technical description of the whole Apache request-
> >> response
> >> > > loop see:
> >> > >
> >> > >  http://www.fmc-modeling.org/projects/apache/html/
> >> > > 4_4Request_Response_Loop.html
> >> > >
> >> > > If you really want to understand how Apache works, that whole
> >> document
> >> > > is quite a good read, albeit probably more in depth than most
> >> people
> >> > > would care for.
> >> > >
> >> > > Graham
> >> > >
> >> > >> On May 28, 2007, at 3:44 AM, Graham Dumpleton wrote:
> >> > >>
> >> > >> > Arrgghh, mistook mime type for handler.
> >> > >> >
> >> > >> > Trying again, although not sure this will work, but might
> >> be able
> >> > >> > to say:
> >> > >> >
> >> > >> >  req.handler = "httpd/unix-directory"
> >> > >> >  return apache.DECLINED
> >> > >> >
> >> > >> > The reason this might not work is that mod_python registers
> >> > >> itself as
> >> > >> > a middle handler as does the autoindex module. Because the
> >> > >> autoindex
> >> > >> > module is inbuilt, it probably gets processed prior to
> >> mod_python
> >> > >> > handler so too late to do the above.
> >> > >> >
> >> > >> > Thus, your only choice would be to provide a fixuphandler
> >> which
> >> > >> undoes
> >> > >> > the SetHandler just for the request against the directory and
> >> > >> triggers
> >> > >> > autoindex instead. Ie.,
> >> > >> >
> >> > >> >  def fixuphandler(req):
> >> > >> >    if req.content_type = "httpd/x-directory":
> >> > >> >      req.handler = "httpd/unix-directory"
> >> > >> >    return apache.OK
> >> > >> >
> >> > >> > Enable this using appropriate PythonFixupHandler directive.
> >> > >> >
> >> > >> > Graham
> >> > >> >
> >> > >> > On 28/05/07, Aaron Gallagher <habnabit@gmail.com> wrote:
> >> > >> >> I get a 404 Not Found error.
> >> > >> >>
> >> > >> >> On May 28, 2007, at 3:22 AM, Graham Dumpleton wrote:
> >> > >> >>
> >> > >> >> > What happens if you return apache.DECLINED.
> >> > >> >> >
> >> > >> >> > Graham
> >> > >> >> >
> >> > >> >> > On 28/05/07, Aaron Gallagher <habnabit@gmail.com> wrote:
> >> > >> >> >>
> >> > >> >> >> Is there a way to tell Apache to give a directory
> >> listing? I'm
> >> > >> >> using
> >> > >> >> >> SetHandler on a directory, and in some cases, I don't need
> >> > >> to do
> >> > >> >> >> any special
> >> > >> >> >> handling, so I'd like Apache to just list the contents
> >> of the
> >> > >> >> >> directory so
> >> > >> >> >> that I don't have to write my own way of doing it.
> >> > >> >> >>
> >> > >> >> >> Just returning apache.OK has Apache send a document of
> >> MIME
> >> > >> time
> >> > >> >> >> httpd/x-directory with content length 0.
> >> > >> >> >>
> >> > >> >> >> Aaron Gallagher
> >> > >> >> >> <habnabit@gmail.com>
> >> > >> >> >>
> >> > >> >> >>
> >> > >> >> >> _______________________________________________
> >> > >> >> >> Mod_python mailing list
> >> > >> >> >> Mod_python@modpython.org
> >> > >> >> >> http://mailman.modpython.org/mailman/listinfo/mod_python
> >> > >> >> >>
> >> > >> >> >>
> >> > >> >>
> >> > >> >> Aaron Gallagher
> >> > >> >> <habnabit@gmail.com>
> >> > >> >>
> >> > >> >>
> >> > >> >>
> >> > >>
> >> > >> Aaron Gallagher
> >> > >> <habnabit@gmail.com>
> >> > >>
> >> > >>
> >> > >>
> >> >
> >> > Aaron Gallagher
> >> > <habnabit@gmail.com>
> >> >
> >> >
> >> > _______________________________________________
> >> > Mod_python mailing list
> >> > Mod_python@modpython.org
> >> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >> >
> >>
>
> Aaron Gallagher
> <habnabit@gmail.com>
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From habnabit at gmail.com  Tue May 29 19:13:00 2007
From: habnabit at gmail.com (Aaron Gallagher)
Date: Tue May 29 19:13:13 2007
Subject: [mod_python] Apache directory listing
In-Reply-To: <88e286470705291559x6fcc686ep158ad5208140c7c6@mail.gmail.com>
References: <641494D0-A3E3-400B-BC16-9A8F2995B2CD@gmail.com>
	<88e286470705280322o21c5f8e1w66b70066838e18a9@mail.gmail.com>
	<AEF6BFBA-38AA-4BFE-85AC-F08B49951CF7@gmail.com>
	<88e286470705280344m39d0f233p62b1b56365f590a3@mail.gmail.com>
	<1759D23B-7ACF-49BD-AF36-F4481639CEE8@gmail.com>
	<88e286470705280422w4e65012o37c9866d43c768a5@mail.gmail.com>
	<38671595-13BC-496F-B178-002D3BEDA60C@gmail.com>
	<88e286470705281356j7698aca6u595b565824b71118@mail.gmail.com>
	<88e286470705281511s3ee1ee5cqffa67f500a463abb@mail.gmail.com>
	<1FCFF8A5-7ABF-45F5-AEE9-58FD822F9782@gmail.com>
	<88e286470705291559x6fcc686ep158ad5208140c7c6@mail.gmail.com>
Message-ID: <B3553137-1D32-4813-864A-8177E782B6A9@gmail.com>


On May 29, 2007, at 3:59 PM, Graham Dumpleton wrote:

> On 30/05/07, Aaron Gallagher <habnabit@gmail.com> wrote:
>> Okay, I had limited success with mod_autoindex, but unfortunately it
>> seems to be impossible to have Apache autoindex the directory.
>
> I'll have a got at doing what I think you are trying to do later. As I
> understand it you want directory index if request against directory,
> otherwise SetHandler (or equivalent) should apply. Yes/No?

That sounds right. The limited success I had was a 404 error page for  
"/directory/index.html" which at least shows that something was  
looking for an index page, though it wouldn't autoindex. I know I  
have Options +Indexes in my <Directory> block, though.

>> Writing my own indexer was pretty simple and it's working well.
>>
>> Now, though, I'm trying to figure out how to catch errors like 401
>> and 403 errors and handle them within my fixuphandler. Is this
>> possible? My fixuphandler is currently using the internal_redirect
>> function to use a custom 404 page, but I'd like to potentially catch
>> all of my errors without using the internal_redirect function.
>>
>> My authenhandler returns 401 or 403 if there's a bad username or
>> password, but it seems that it doesn't go to my fixuphandler but
>> apache generates the error pages on its own. It seems like whenever I
>> return an error code, apache generates an error page.
>>
>> So, I guess my question is how I should catch every error to make
>> custom error pages?
>
> Use the Apache ErrorDocument directive to specify an internal URL for
> the handler which generates the error page. When you return an error
> number as status, Apache will invoke the handler associated with the
> ErrorDocument for you without you need to do the redirect. If you want
> to pass information about the error to the error handler, store it in
> req.notes['error-notes']. That value will then be available in
> req.subprocess_env of error handler under ERROR_NOTE or
> REDIRECT_ERROR_NOTES (cant remember which).

So, it's not possible to do it without the ErrorDocument directive? I  
was hoping that I wouldn't have to use that.

Also, I seem to actually be having bizarre problems with my  
redirects. When I request /a/b/c/d/, my handler catches the bad URL  
and executes this code:
req.internal_redirect('/?__404')
return apache.DONE

What happens is I get a page that has a text/plain mime type with a  
200 response code that looks essentially like this (stripping out a  
lot of HTML):
Page not found: /d/
Page not found: /c/d/
Page not found: /b/c/d/
Page not found: /a/b/c/d/

I found that after the redirect, the handler (which is a  
fixuphandler) doesn't recur, but return apache.DONE, and then another  
handler is called. My only thought could be that this is intrinsic to  
the fixuphandler, but that seems silly. Skipping the redirect and  
just returning 404 seems to work, and it doesn't return four not  
found pages.

What do I need to do to fix this?

> Graham
>
>> On May 28, 2007, at 3:11 PM, Graham Dumpleton wrote:
>>
>> > BTW, SetHandler is only processed in typehandler phase. Thus if you
>> > want to override that, you must be doing it in the fixuphandler  
>> phase.
>> >
>> > Also note that allowing automatic directory listings in  
>> mod_python can
>> > cause issues if there are subdirectories which are also managed in
>> > some way by mod_python. Can't remember whether there is an issue
>> > logged about it or whether I ranted about it on one of the mailing
>> > lists somewhere.
>> >
>> > Graham
>> >
>> > On 29/05/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
>> >> If a phase earlier than response handler phase is providing the
>> >> complete response, it should return apache.DONE and not apache.OK.
>> >> This will stop later phases running.
>> >>
>> >> Graham
>> >>
>> >> On 28/05/07, Aaron Gallagher <habnabit@gmail.com> wrote:
>> >> > I've just moved a lot of my code (including the code that  
>> checks to
>> >> > see if a directory should have its contents listed) from a
>> >> > PythonHandler into a PythonHeaderParserHandler, because after
>> >> looking
>> >> > at the response loop, I determined that PythonFixupHandler was
>> >> > happening too late in the process.
>> >> >
>> >> > It's created some interesting new problems -- my calls to
>> >> > req.internal_redirect aren't working, as the code was set up
>> >> like this:
>> >> > req.internal_redirect(...)
>> >> > return apache.OK
>> >> > I guess this isn't stopping the request, like it used to do. How
>> >> > should I change my code to allow internal redirects?
>> >> >
>> >> > Also, all of your suggestions just act the same way as if I had
>> >> just
>> >> > done return apache.OK.
>> >> >
>> >> >
>> >> > On May 28, 2007, at 4:22 AM, Graham Dumpleton wrote:
>> >> >
>> >> > > On 28/05/07, Aaron Gallagher <habnabit@gmail.com> wrote:
>> >> > >> Okay, I'll try that.
>> >> > >>
>> >> > >> But, what exactly is the purpose of a PythonFixupHandler? The
>> >> > >> documentation doesn't have much to say, but I assume it's for
>> >> doing
>> >> > >> URL rewriting and redirection.
>> >> > >
>> >> > > Potentially. It is one of a number of phases and is a sort of
>> >> catch
>> >> > > all or last chance phase before actual response handler is
>> >> executed.
>> >> > > For a very technical description of the whole Apache request-
>> >> response
>> >> > > loop see:
>> >> > >
>> >> > >  http://www.fmc-modeling.org/projects/apache/html/
>> >> > > 4_4Request_Response_Loop.html
>> >> > >
>> >> > > If you really want to understand how Apache works, that whole
>> >> document
>> >> > > is quite a good read, albeit probably more in depth than most
>> >> people
>> >> > > would care for.
>> >> > >
>> >> > > Graham
>> >> > >
>> >> > >> On May 28, 2007, at 3:44 AM, Graham Dumpleton wrote:
>> >> > >>
>> >> > >> > Arrgghh, mistook mime type for handler.
>> >> > >> >
>> >> > >> > Trying again, although not sure this will work, but might
>> >> be able
>> >> > >> > to say:
>> >> > >> >
>> >> > >> >  req.handler = "httpd/unix-directory"
>> >> > >> >  return apache.DECLINED
>> >> > >> >
>> >> > >> > The reason this might not work is that mod_python registers
>> >> > >> itself as
>> >> > >> > a middle handler as does the autoindex module. Because the
>> >> > >> autoindex
>> >> > >> > module is inbuilt, it probably gets processed prior to
>> >> mod_python
>> >> > >> > handler so too late to do the above.
>> >> > >> >
>> >> > >> > Thus, your only choice would be to provide a fixuphandler
>> >> which
>> >> > >> undoes
>> >> > >> > the SetHandler just for the request against the  
>> directory and
>> >> > >> triggers
>> >> > >> > autoindex instead. Ie.,
>> >> > >> >
>> >> > >> >  def fixuphandler(req):
>> >> > >> >    if req.content_type = "httpd/x-directory":
>> >> > >> >      req.handler = "httpd/unix-directory"
>> >> > >> >    return apache.OK
>> >> > >> >
>> >> > >> > Enable this using appropriate PythonFixupHandler directive.
>> >> > >> >
>> >> > >> > Graham
>> >> > >> >
>> >> > >> > On 28/05/07, Aaron Gallagher <habnabit@gmail.com> wrote:
>> >> > >> >> I get a 404 Not Found error.
>> >> > >> >>
>> >> > >> >> On May 28, 2007, at 3:22 AM, Graham Dumpleton wrote:
>> >> > >> >>
>> >> > >> >> > What happens if you return apache.DECLINED.
>> >> > >> >> >
>> >> > >> >> > Graham
>> >> > >> >> >
>> >> > >> >> > On 28/05/07, Aaron Gallagher <habnabit@gmail.com> wrote:
>> >> > >> >> >>
>> >> > >> >> >> Is there a way to tell Apache to give a directory
>> >> listing? I'm
>> >> > >> >> using
>> >> > >> >> >> SetHandler on a directory, and in some cases, I  
>> don't need
>> >> > >> to do
>> >> > >> >> >> any special
>> >> > >> >> >> handling, so I'd like Apache to just list the contents
>> >> of the
>> >> > >> >> >> directory so
>> >> > >> >> >> that I don't have to write my own way of doing it.
>> >> > >> >> >>
>> >> > >> >> >> Just returning apache.OK has Apache send a document of
>> >> MIME
>> >> > >> time
>> >> > >> >> >> httpd/x-directory with content length 0.
>> >> > >> >> >>
>> >> > >> >> >> Aaron Gallagher
>> >> > >> >> >> <habnabit@gmail.com>
>> >> > >> >> >>
>> >> > >> >> >>
>> >> > >> >> >> _______________________________________________
>> >> > >> >> >> Mod_python mailing list
>> >> > >> >> >> Mod_python@modpython.org
>> >> > >> >> >> http://mailman.modpython.org/mailman/listinfo/ 
>> mod_python
>> >> > >> >> >>
>> >> > >> >> >>
>> >> > >> >>
>> >> > >> >> Aaron Gallagher
>> >> > >> >> <habnabit@gmail.com>
>> >> > >> >>
>> >> > >> >>
>> >> > >> >>
>> >> > >>
>> >> > >> Aaron Gallagher
>> >> > >> <habnabit@gmail.com>
>> >> > >>
>> >> > >>
>> >> > >>
>> >> >
>> >> > Aaron Gallagher
>> >> > <habnabit@gmail.com>
>> >> >
>> >> >
>> >> > _______________________________________________
>> >> > Mod_python mailing list
>> >> > Mod_python@modpython.org
>> >> > http://mailman.modpython.org/mailman/listinfo/mod_python
>> >> >
>> >>
>>
>> Aaron Gallagher
>> <habnabit@gmail.com>
>>
>>
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>

Aaron Gallagher
<habnabit@gmail.com>


From habnabit at gmail.com  Tue May 29 19:22:59 2007
From: habnabit at gmail.com (Aaron Gallagher)
Date: Tue May 29 19:23:08 2007
Subject: [mod_python] Apache directory listing
In-Reply-To: <88e286470705291559x6fcc686ep158ad5208140c7c6@mail.gmail.com>
References: <641494D0-A3E3-400B-BC16-9A8F2995B2CD@gmail.com>
	<88e286470705280322o21c5f8e1w66b70066838e18a9@mail.gmail.com>
	<AEF6BFBA-38AA-4BFE-85AC-F08B49951CF7@gmail.com>
	<88e286470705280344m39d0f233p62b1b56365f590a3@mail.gmail.com>
	<1759D23B-7ACF-49BD-AF36-F4481639CEE8@gmail.com>
	<88e286470705280422w4e65012o37c9866d43c768a5@mail.gmail.com>
	<38671595-13BC-496F-B178-002D3BEDA60C@gmail.com>
	<88e286470705281356j7698aca6u595b565824b71118@mail.gmail.com>
	<88e286470705281511s3ee1ee5cqffa67f500a463abb@mail.gmail.com>
	<1FCFF8A5-7ABF-45F5-AEE9-58FD822F9782@gmail.com>
	<88e286470705291559x6fcc686ep158ad5208140c7c6@mail.gmail.com>
Message-ID: <F620EF0C-5A4D-4704-BD36-357BF5B218A4@gmail.com>

As a bizarre addendum to my last e-mail:

I tried doing /a/b/c/images/ where /images/ is a valid path on my  
server. My giant page of error pages had the directory index of / 
images/ followed by error pages for /c/images/, etc.

Aaron Gallagher
<habnabit@gmail.com>


From graham.dumpleton at gmail.com  Tue May 29 19:23:51 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue May 29 19:23:54 2007
Subject: [mod_python] Apache directory listing
In-Reply-To: <B3553137-1D32-4813-864A-8177E782B6A9@gmail.com>
References: <641494D0-A3E3-400B-BC16-9A8F2995B2CD@gmail.com>
	<88e286470705280344m39d0f233p62b1b56365f590a3@mail.gmail.com>
	<1759D23B-7ACF-49BD-AF36-F4481639CEE8@gmail.com>
	<88e286470705280422w4e65012o37c9866d43c768a5@mail.gmail.com>
	<38671595-13BC-496F-B178-002D3BEDA60C@gmail.com>
	<88e286470705281356j7698aca6u595b565824b71118@mail.gmail.com>
	<88e286470705281511s3ee1ee5cqffa67f500a463abb@mail.gmail.com>
	<1FCFF8A5-7ABF-45F5-AEE9-58FD822F9782@gmail.com>
	<88e286470705291559x6fcc686ep158ad5208140c7c6@mail.gmail.com>
	<B3553137-1D32-4813-864A-8177E782B6A9@gmail.com>
Message-ID: <88e286470705291623v6280f36frd1f5c539ddc25e2f@mail.gmail.com>

On 30/05/07, Aaron Gallagher <habnabit@gmail.com> wrote:
> Also, I seem to actually be having bizarre problems with my
> redirects. When I request /a/b/c/d/, my handler catches the bad URL
> and executes this code:
> req.internal_redirect('/?__404')
> return apache.DONE
>
> What happens is I get a page that has a text/plain mime type with a
> 200 response code that looks essentially like this (stripping out a
> lot of HTML):
> Page not found: /d/
> Page not found: /c/d/
> Page not found: /b/c/d/
> Page not found: /a/b/c/d/
>
> I found that after the redirect, the handler (which is a
> fixuphandler) doesn't recur, but return apache.DONE, and then another
> handler is called. My only thought could be that this is intrinsic to
> the fixuphandler, but that seems silly. Skipping the redirect and
> just returning 404 seems to work, and it doesn't return four not
> found pages.
>
> What do I need to do to fix this?

This is probably the problem with autoindex I briefly mentioned. To do
an index it actually does a sub request as far as the fixup handler
phase for every item which it might list in the index to determine if
it has access rights and should be listing it. If you have handlers
for these phases it will trigger them for the subrequest as well which
might cause issues. One can detect if such a handler is called in
subrequest by looking whether req.prev or req.main (cant remember
which), is not None.

When I get a chance to at least get directory index to week as you
indicate what you want, then we can start stepping through these
others issues.

Graham
From habnabit at gmail.com  Tue May 29 22:06:20 2007
From: habnabit at gmail.com (Aaron Gallagher)
Date: Tue May 29 22:06:33 2007
Subject: [mod_python] Apache directory listing
In-Reply-To: <88e286470705291623v6280f36frd1f5c539ddc25e2f@mail.gmail.com>
References: <641494D0-A3E3-400B-BC16-9A8F2995B2CD@gmail.com>
	<88e286470705280344m39d0f233p62b1b56365f590a3@mail.gmail.com>
	<1759D23B-7ACF-49BD-AF36-F4481639CEE8@gmail.com>
	<88e286470705280422w4e65012o37c9866d43c768a5@mail.gmail.com>
	<38671595-13BC-496F-B178-002D3BEDA60C@gmail.com>
	<88e286470705281356j7698aca6u595b565824b71118@mail.gmail.com>
	<88e286470705281511s3ee1ee5cqffa67f500a463abb@mail.gmail.com>
	<1FCFF8A5-7ABF-45F5-AEE9-58FD822F9782@gmail.com>
	<88e286470705291559x6fcc686ep158ad5208140c7c6@mail.gmail.com>
	<B3553137-1D32-4813-864A-8177E782B6A9@gmail.com>
	<88e286470705291623v6280f36frd1f5c539ddc25e2f@mail.gmail.com>
Message-ID: <12B98D29-1414-4305-BF7F-24E5107E4438@gmail.com>

On May 29, 2007, at 4:23 PM, Graham Dumpleton wrote:

> On 30/05/07, Aaron Gallagher <habnabit@gmail.com> wrote:
>> Also, I seem to actually be having bizarre problems with my
>> redirects. When I request /a/b/c/d/, my handler catches the bad URL
>> and executes this code:
>> req.internal_redirect('/?__404')
>> return apache.DONE
>>
>> What happens is I get a page that has a text/plain mime type with a
>> 200 response code that looks essentially like this (stripping out a
>> lot of HTML):
>> Page not found: /d/
>> Page not found: /c/d/
>> Page not found: /b/c/d/
>> Page not found: /a/b/c/d/
>>
>> I found that after the redirect, the handler (which is a
>> fixuphandler) doesn't recur, but return apache.DONE, and then another
>> handler is called. My only thought could be that this is intrinsic to
>> the fixuphandler, but that seems silly. Skipping the redirect and
>> just returning 404 seems to work, and it doesn't return four not
>> found pages.
>>
>> What do I need to do to fix this?
>
> This is probably the problem with autoindex I briefly mentioned. To do
> an index it actually does a sub request as far as the fixup handler
> phase for every item which it might list in the index to determine if
> it has access rights and should be listing it. If you have handlers
> for these phases it will trigger them for the subrequest as well which
> might cause issues. One can detect if such a handler is called in
> subrequest by looking whether req.prev or req.main (cant remember
> which), is not None.

I just tried this, and whenever I tried to access req.prev or  
req.main (even req.next), the request would be scrapped and a new one  
created, that would get to the same point before starting again. I  
would have thousands of lines of "Debug: preparing to redirect"  
before I would just have to cancel the page from loading.

> When I get a chance to at least get directory index to week as you
> indicate what you want, then we can start stepping through these
> others issues.
>
> Graham

Aaron Gallagher
<habnabit@gmail.com>


From graham.dumpleton at gmail.com  Tue May 29 22:31:08 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue May 29 22:31:14 2007
Subject: [mod_python] Apache directory listing
In-Reply-To: <12B98D29-1414-4305-BF7F-24E5107E4438@gmail.com>
References: <641494D0-A3E3-400B-BC16-9A8F2995B2CD@gmail.com>
	<88e286470705280422w4e65012o37c9866d43c768a5@mail.gmail.com>
	<38671595-13BC-496F-B178-002D3BEDA60C@gmail.com>
	<88e286470705281356j7698aca6u595b565824b71118@mail.gmail.com>
	<88e286470705281511s3ee1ee5cqffa67f500a463abb@mail.gmail.com>
	<1FCFF8A5-7ABF-45F5-AEE9-58FD822F9782@gmail.com>
	<88e286470705291559x6fcc686ep158ad5208140c7c6@mail.gmail.com>
	<B3553137-1D32-4813-864A-8177E782B6A9@gmail.com>
	<88e286470705291623v6280f36frd1f5c539ddc25e2f@mail.gmail.com>
	<12B98D29-1414-4305-BF7F-24E5107E4438@gmail.com>
Message-ID: <88e286470705291931o2d6af656w6590aa625ebac7ed@mail.gmail.com>

Sorry, that doesn't make any sense at all. Are you able to post the
code you are using? This is getting all too hard to follow when one
can only make assumptions about what you are doing.

Graham

On 30/05/07, Aaron Gallagher <habnabit@gmail.com> wrote:
> On May 29, 2007, at 4:23 PM, Graham Dumpleton wrote:
>
> > On 30/05/07, Aaron Gallagher <habnabit@gmail.com> wrote:
> >> Also, I seem to actually be having bizarre problems with my
> >> redirects. When I request /a/b/c/d/, my handler catches the bad URL
> >> and executes this code:
> >> req.internal_redirect('/?__404')
> >> return apache.DONE
> >>
> >> What happens is I get a page that has a text/plain mime type with a
> >> 200 response code that looks essentially like this (stripping out a
> >> lot of HTML):
> >> Page not found: /d/
> >> Page not found: /c/d/
> >> Page not found: /b/c/d/
> >> Page not found: /a/b/c/d/
> >>
> >> I found that after the redirect, the handler (which is a
> >> fixuphandler) doesn't recur, but return apache.DONE, and then another
> >> handler is called. My only thought could be that this is intrinsic to
> >> the fixuphandler, but that seems silly. Skipping the redirect and
> >> just returning 404 seems to work, and it doesn't return four not
> >> found pages.
> >>
> >> What do I need to do to fix this?
> >
> > This is probably the problem with autoindex I briefly mentioned. To do
> > an index it actually does a sub request as far as the fixup handler
> > phase for every item which it might list in the index to determine if
> > it has access rights and should be listing it. If you have handlers
> > for these phases it will trigger them for the subrequest as well which
> > might cause issues. One can detect if such a handler is called in
> > subrequest by looking whether req.prev or req.main (cant remember
> > which), is not None.
>
> I just tried this, and whenever I tried to access req.prev or
> req.main (even req.next), the request would be scrapped and a new one
> created, that would get to the same point before starting again. I
> would have thousands of lines of "Debug: preparing to redirect"
> before I would just have to cancel the page from loading.
>
> > When I get a chance to at least get directory index to week as you
> > indicate what you want, then we can start stepping through these
> > others issues.
> >
> > Graham
>
> Aaron Gallagher
> <habnabit@gmail.com>
>
>
>
From habnabit at gmail.com  Tue May 29 22:35:11 2007
From: habnabit at gmail.com (Aaron Gallagher)
Date: Tue May 29 22:35:22 2007
Subject: [mod_python] Apache directory listing
In-Reply-To: <88e286470705291931o2d6af656w6590aa625ebac7ed@mail.gmail.com>
References: <641494D0-A3E3-400B-BC16-9A8F2995B2CD@gmail.com>
	<88e286470705280422w4e65012o37c9866d43c768a5@mail.gmail.com>
	<38671595-13BC-496F-B178-002D3BEDA60C@gmail.com>
	<88e286470705281356j7698aca6u595b565824b71118@mail.gmail.com>
	<88e286470705281511s3ee1ee5cqffa67f500a463abb@mail.gmail.com>
	<1FCFF8A5-7ABF-45F5-AEE9-58FD822F9782@gmail.com>
	<88e286470705291559x6fcc686ep158ad5208140c7c6@mail.gmail.com>
	<B3553137-1D32-4813-864A-8177E782B6A9@gmail.com>
	<88e286470705291623v6280f36frd1f5c539ddc25e2f@mail.gmail.com>
	<12B98D29-1414-4305-BF7F-24E5107E4438@gmail.com>
	<88e286470705291931o2d6af656w6590aa625ebac7ed@mail.gmail.com>
Message-ID: <2240ED84-D42F-47C4-B2C6-9DF135169512@gmail.com>

		req.log_error('Redirect 3, "%s"' % req.uri, apache.APLOG_DEBUG)
		req.internal_redirect('%s?_404&orig=%s' % (ROOT, escape(os.path.join 
(req.fulluri, page))))
		req.log_error('Redirect 3, "%s" "%s" "%s"' % (req.prev, req.next,  
req.main), apache.APLOG_ERR)
		req.log_error('Redirect 3 done (%s)' % req.fulluri,  
apache.APLOG_DEBUG)
		return apache.DONE

That causes the page to be printed over and over and "Redirect 3" to  
also be printed over and over in the log. The same thing happens if I  
do if req.prev etc. before I print them.

On May 29, 2007, at 7:31 PM, Graham Dumpleton wrote:

> Sorry, that doesn't make any sense at all. Are you able to post the
> code you are using? This is getting all too hard to follow when one
> can only make assumptions about what you are doing.
>
> Graham
>
> On 30/05/07, Aaron Gallagher <habnabit@gmail.com> wrote:
>> On May 29, 2007, at 4:23 PM, Graham Dumpleton wrote:
>>
>> > On 30/05/07, Aaron Gallagher <habnabit@gmail.com> wrote:
>> >> Also, I seem to actually be having bizarre problems with my
>> >> redirects. When I request /a/b/c/d/, my handler catches the bad  
>> URL
>> >> and executes this code:
>> >> req.internal_redirect('/?__404')
>> >> return apache.DONE
>> >>
>> >> What happens is I get a page that has a text/plain mime type  
>> with a
>> >> 200 response code that looks essentially like this (stripping  
>> out a
>> >> lot of HTML):
>> >> Page not found: /d/
>> >> Page not found: /c/d/
>> >> Page not found: /b/c/d/
>> >> Page not found: /a/b/c/d/
>> >>
>> >> I found that after the redirect, the handler (which is a
>> >> fixuphandler) doesn't recur, but return apache.DONE, and then  
>> another
>> >> handler is called. My only thought could be that this is  
>> intrinsic to
>> >> the fixuphandler, but that seems silly. Skipping the redirect and
>> >> just returning 404 seems to work, and it doesn't return four not
>> >> found pages.
>> >>
>> >> What do I need to do to fix this?
>> >
>> > This is probably the problem with autoindex I briefly mentioned.  
>> To do
>> > an index it actually does a sub request as far as the fixup handler
>> > phase for every item which it might list in the index to  
>> determine if
>> > it has access rights and should be listing it. If you have handlers
>> > for these phases it will trigger them for the subrequest as well  
>> which
>> > might cause issues. One can detect if such a handler is called in
>> > subrequest by looking whether req.prev or req.main (cant remember
>> > which), is not None.
>>
>> I just tried this, and whenever I tried to access req.prev or
>> req.main (even req.next), the request would be scrapped and a new one
>> created, that would get to the same point before starting again. I
>> would have thousands of lines of "Debug: preparing to redirect"
>> before I would just have to cancel the page from loading.
>>
>> > When I get a chance to at least get directory index to week as you
>> > indicate what you want, then we can start stepping through these
>> > others issues.
>> >
>> > Graham
>>
>> Aaron Gallagher
>> <habnabit@gmail.com>
>>
>>
>>

Aaron Gallagher
<habnabit@gmail.com>


From graham.dumpleton at gmail.com  Tue May 29 22:41:07 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue May 29 22:41:14 2007
Subject: [mod_python] Apache directory listing
In-Reply-To: <2240ED84-D42F-47C4-B2C6-9DF135169512@gmail.com>
References: <641494D0-A3E3-400B-BC16-9A8F2995B2CD@gmail.com>
	<88e286470705281356j7698aca6u595b565824b71118@mail.gmail.com>
	<88e286470705281511s3ee1ee5cqffa67f500a463abb@mail.gmail.com>
	<1FCFF8A5-7ABF-45F5-AEE9-58FD822F9782@gmail.com>
	<88e286470705291559x6fcc686ep158ad5208140c7c6@mail.gmail.com>
	<B3553137-1D32-4813-864A-8177E782B6A9@gmail.com>
	<88e286470705291623v6280f36frd1f5c539ddc25e2f@mail.gmail.com>
	<12B98D29-1414-4305-BF7F-24E5107E4438@gmail.com>
	<88e286470705291931o2d6af656w6590aa625ebac7ed@mail.gmail.com>
	<2240ED84-D42F-47C4-B2C6-9DF135169512@gmail.com>
Message-ID: <88e286470705291941w7d7d6cenef4d9ef497ce7728@mail.gmail.com>

Don't print values of req.prev, req.next or req.main as when they are
in turn printed they may follow back through the opposite link and
cause a loop. If you really want to print something, print:

  req.prev is None

ie., boolean value of whether it is None or not.

On 30/05/07, Aaron Gallagher <habnabit@gmail.com> wrote:
>                 req.log_error('Redirect 3, "%s"' % req.uri, apache.APLOG_DEBUG)
>                 req.internal_redirect('%s?_404&orig=%s' % (ROOT, escape(os.path.join
> (req.fulluri, page))))
>                 req.log_error('Redirect 3, "%s" "%s" "%s"' % (req.prev, req.next,
> req.main), apache.APLOG_ERR)
>                 req.log_error('Redirect 3 done (%s)' % req.fulluri,
> apache.APLOG_DEBUG)
>                 return apache.DONE
>
> That causes the page to be printed over and over and "Redirect 3" to
> also be printed over and over in the log. The same thing happens if I
> do if req.prev etc. before I print them.
>
> On May 29, 2007, at 7:31 PM, Graham Dumpleton wrote:
>
> > Sorry, that doesn't make any sense at all. Are you able to post the
> > code you are using? This is getting all too hard to follow when one
> > can only make assumptions about what you are doing.
> >
> > Graham
> >
> > On 30/05/07, Aaron Gallagher <habnabit@gmail.com> wrote:
> >> On May 29, 2007, at 4:23 PM, Graham Dumpleton wrote:
> >>
> >> > On 30/05/07, Aaron Gallagher <habnabit@gmail.com> wrote:
> >> >> Also, I seem to actually be having bizarre problems with my
> >> >> redirects. When I request /a/b/c/d/, my handler catches the bad
> >> URL
> >> >> and executes this code:
> >> >> req.internal_redirect('/?__404')
> >> >> return apache.DONE
> >> >>
> >> >> What happens is I get a page that has a text/plain mime type
> >> with a
> >> >> 200 response code that looks essentially like this (stripping
> >> out a
> >> >> lot of HTML):
> >> >> Page not found: /d/
> >> >> Page not found: /c/d/
> >> >> Page not found: /b/c/d/
> >> >> Page not found: /a/b/c/d/
> >> >>
> >> >> I found that after the redirect, the handler (which is a
> >> >> fixuphandler) doesn't recur, but return apache.DONE, and then
> >> another
> >> >> handler is called. My only thought could be that this is
> >> intrinsic to
> >> >> the fixuphandler, but that seems silly. Skipping the redirect and
> >> >> just returning 404 seems to work, and it doesn't return four not
> >> >> found pages.
> >> >>
> >> >> What do I need to do to fix this?
> >> >
> >> > This is probably the problem with autoindex I briefly mentioned.
> >> To do
> >> > an index it actually does a sub request as far as the fixup handler
> >> > phase for every item which it might list in the index to
> >> determine if
> >> > it has access rights and should be listing it. If you have handlers
> >> > for these phases it will trigger them for the subrequest as well
> >> which
> >> > might cause issues. One can detect if such a handler is called in
> >> > subrequest by looking whether req.prev or req.main (cant remember
> >> > which), is not None.
> >>
> >> I just tried this, and whenever I tried to access req.prev or
> >> req.main (even req.next), the request would be scrapped and a new one
> >> created, that would get to the same point before starting again. I
> >> would have thousands of lines of "Debug: preparing to redirect"
> >> before I would just have to cancel the page from loading.
> >>
> >> > When I get a chance to at least get directory index to week as you
> >> > indicate what you want, then we can start stepping through these
> >> > others issues.
> >> >
> >> > Graham
> >>
> >> Aaron Gallagher
> >> <habnabit@gmail.com>
> >>
> >>
> >>
>
> Aaron Gallagher
> <habnabit@gmail.com>
>
>
>
From graham.dumpleton at gmail.com  Tue May 29 22:52:31 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue May 29 22:52:37 2007
Subject: [mod_python] Apache directory listing
In-Reply-To: <88e286470705291941w7d7d6cenef4d9ef497ce7728@mail.gmail.com>
References: <641494D0-A3E3-400B-BC16-9A8F2995B2CD@gmail.com>
	<88e286470705281511s3ee1ee5cqffa67f500a463abb@mail.gmail.com>
	<1FCFF8A5-7ABF-45F5-AEE9-58FD822F9782@gmail.com>
	<88e286470705291559x6fcc686ep158ad5208140c7c6@mail.gmail.com>
	<B3553137-1D32-4813-864A-8177E782B6A9@gmail.com>
	<88e286470705291623v6280f36frd1f5c539ddc25e2f@mail.gmail.com>
	<12B98D29-1414-4305-BF7F-24E5107E4438@gmail.com>
	<88e286470705291931o2d6af656w6590aa625ebac7ed@mail.gmail.com>
	<2240ED84-D42F-47C4-B2C6-9DF135169512@gmail.com>
	<88e286470705291941w7d7d6cenef4d9ef497ce7728@mail.gmail.com>
Message-ID: <88e286470705291952i3e6bd497ncf25128ee0da35ff@mail.gmail.com>

Ignore that, print prev, next, main should just yield object id
information. Will not try and print out anything meaningful.

Your internal redirect must be looping on itself somehow. If this is
your fixup handler, at the start of it add:

  if req.prev is not None:
    return apache.OK
  if req.,ain is not None:
    return apache.OK

This will stop it doing anything in a subrequest.

Graham

On 30/05/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> Don't print values of req.prev, req.next or req.main as when they are
> in turn printed they may follow back through the opposite link and
> cause a loop. If you really want to print something, print:
>
>   req.prev is None
>
> ie., boolean value of whether it is None or not.
>
> On 30/05/07, Aaron Gallagher <habnabit@gmail.com> wrote:
> >                 req.log_error('Redirect 3, "%s"' % req.uri, apache.APLOG_DEBUG)
> >                 req.internal_redirect('%s?_404&orig=%s' % (ROOT, escape(os.path.join
> > (req.fulluri, page))))
> >                 req.log_error('Redirect 3, "%s" "%s" "%s"' % (req.prev, req.next,
> > req.main), apache.APLOG_ERR)
> >                 req.log_error('Redirect 3 done (%s)' % req.fulluri,
> > apache.APLOG_DEBUG)
> >                 return apache.DONE
> >
> > That causes the page to be printed over and over and "Redirect 3" to
> > also be printed over and over in the log. The same thing happens if I
> > do if req.prev etc. before I print them.
> >
> > On May 29, 2007, at 7:31 PM, Graham Dumpleton wrote:
> >
> > > Sorry, that doesn't make any sense at all. Are you able to post the
> > > code you are using? This is getting all too hard to follow when one
> > > can only make assumptions about what you are doing.
> > >
> > > Graham
> > >
> > > On 30/05/07, Aaron Gallagher <habnabit@gmail.com> wrote:
> > >> On May 29, 2007, at 4:23 PM, Graham Dumpleton wrote:
> > >>
> > >> > On 30/05/07, Aaron Gallagher <habnabit@gmail.com> wrote:
> > >> >> Also, I seem to actually be having bizarre problems with my
> > >> >> redirects. When I request /a/b/c/d/, my handler catches the bad
> > >> URL
> > >> >> and executes this code:
> > >> >> req.internal_redirect('/?__404')
> > >> >> return apache.DONE
> > >> >>
> > >> >> What happens is I get a page that has a text/plain mime type
> > >> with a
> > >> >> 200 response code that looks essentially like this (stripping
> > >> out a
> > >> >> lot of HTML):
> > >> >> Page not found: /d/
> > >> >> Page not found: /c/d/
> > >> >> Page not found: /b/c/d/
> > >> >> Page not found: /a/b/c/d/
> > >> >>
> > >> >> I found that after the redirect, the handler (which is a
> > >> >> fixuphandler) doesn't recur, but return apache.DONE, and then
> > >> another
> > >> >> handler is called. My only thought could be that this is
> > >> intrinsic to
> > >> >> the fixuphandler, but that seems silly. Skipping the redirect and
> > >> >> just returning 404 seems to work, and it doesn't return four not
> > >> >> found pages.
> > >> >>
> > >> >> What do I need to do to fix this?
> > >> >
> > >> > This is probably the problem with autoindex I briefly mentioned.
> > >> To do
> > >> > an index it actually does a sub request as far as the fixup handler
> > >> > phase for every item which it might list in the index to
> > >> determine if
> > >> > it has access rights and should be listing it. If you have handlers
> > >> > for these phases it will trigger them for the subrequest as well
> > >> which
> > >> > might cause issues. One can detect if such a handler is called in
> > >> > subrequest by looking whether req.prev or req.main (cant remember
> > >> > which), is not None.
> > >>
> > >> I just tried this, and whenever I tried to access req.prev or
> > >> req.main (even req.next), the request would be scrapped and a new one
> > >> created, that would get to the same point before starting again. I
> > >> would have thousands of lines of "Debug: preparing to redirect"
> > >> before I would just have to cancel the page from loading.
> > >>
> > >> > When I get a chance to at least get directory index to week as you
> > >> > indicate what you want, then we can start stepping through these
> > >> > others issues.
> > >> >
> > >> > Graham
> > >>
> > >> Aaron Gallagher
> > >> <habnabit@gmail.com>
> > >>
> > >>
> > >>
> >
> > Aaron Gallagher
> > <habnabit@gmail.com>
> >
> >
> >
>
From habnabit at gmail.com  Tue May 29 23:33:28 2007
From: habnabit at gmail.com (Aaron Gallagher)
Date: Tue May 29 23:33:39 2007
Subject: [mod_python] Apache directory listing
In-Reply-To: <88e286470705291952i3e6bd497ncf25128ee0da35ff@mail.gmail.com>
References: <641494D0-A3E3-400B-BC16-9A8F2995B2CD@gmail.com>
	<88e286470705281511s3ee1ee5cqffa67f500a463abb@mail.gmail.com>
	<1FCFF8A5-7ABF-45F5-AEE9-58FD822F9782@gmail.com>
	<88e286470705291559x6fcc686ep158ad5208140c7c6@mail.gmail.com>
	<B3553137-1D32-4813-864A-8177E782B6A9@gmail.com>
	<88e286470705291623v6280f36frd1f5c539ddc25e2f@mail.gmail.com>
	<12B98D29-1414-4305-BF7F-24E5107E4438@gmail.com>
	<88e286470705291931o2d6af656w6590aa625ebac7ed@mail.gmail.com>
	<2240ED84-D42F-47C4-B2C6-9DF135169512@gmail.com>
	<88e286470705291941w7d7d6cenef4d9ef497ce7728@mail.gmail.com>
	<88e286470705291952i3e6bd497ncf25128ee0da35ff@mail.gmail.com>
Message-ID: <5D9FEA5B-107F-4535-B9A9-99FFB5F28D93@gmail.com>

On May 29, 2007, at 7:52 PM, Graham Dumpleton wrote:

> Ignore that, print prev, next, main should just yield object id
> information. Will not try and print out anything meaningful.
>
> Your internal redirect must be looping on itself somehow. If this is
> your fixup handler, at the start of it add:
>
>  if req.prev is not None:
>    return apache.OK
>  if req.,ain is not None:
>    return apache.OK
>
> This will stop it doing anything in a subrequest.

Haha, doing that makes the apache child processes sigfault.

> Graham
>
> On 30/05/07, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
>> Don't print values of req.prev, req.next or req.main as when they are
>> in turn printed they may follow back through the opposite link and
>> cause a loop. If you really want to print something, print:
>>
>>   req.prev is None
>>
>> ie., boolean value of whether it is None or not.
>>
>> On 30/05/07, Aaron Gallagher <habnabit@gmail.com> wrote:
>> >                 req.log_error('Redirect 3, "%s"' % req.uri,  
>> apache.APLOG_DEBUG)
>> >                 req.internal_redirect('%s?_404&orig=%s' % (ROOT,  
>> escape(os.path.join
>> > (req.fulluri, page))))
>> >                 req.log_error('Redirect 3, "%s" "%s" "%s"' %  
>> (req.prev, req.next,
>> > req.main), apache.APLOG_ERR)
>> >                 req.log_error('Redirect 3 done (%s)' % req.fulluri,
>> > apache.APLOG_DEBUG)
>> >                 return apache.DONE
>> >
>> > That causes the page to be printed over and over and "Redirect  
>> 3" to
>> > also be printed over and over in the log. The same thing happens  
>> if I
>> > do if req.prev etc. before I print them.
>> >
>> > On May 29, 2007, at 7:31 PM, Graham Dumpleton wrote:
>> >
>> > > Sorry, that doesn't make any sense at all. Are you able to  
>> post the
>> > > code you are using? This is getting all too hard to follow  
>> when one
>> > > can only make assumptions about what you are doing.
>> > >
>> > > Graham
>> > >
>> > > On 30/05/07, Aaron Gallagher <habnabit@gmail.com> wrote:
>> > >> On May 29, 2007, at 4:23 PM, Graham Dumpleton wrote:
>> > >>
>> > >> > On 30/05/07, Aaron Gallagher <habnabit@gmail.com> wrote:
>> > >> >> Also, I seem to actually be having bizarre problems with my
>> > >> >> redirects. When I request /a/b/c/d/, my handler catches  
>> the bad
>> > >> URL
>> > >> >> and executes this code:
>> > >> >> req.internal_redirect('/?__404')
>> > >> >> return apache.DONE
>> > >> >>
>> > >> >> What happens is I get a page that has a text/plain mime type
>> > >> with a
>> > >> >> 200 response code that looks essentially like this (stripping
>> > >> out a
>> > >> >> lot of HTML):
>> > >> >> Page not found: /d/
>> > >> >> Page not found: /c/d/
>> > >> >> Page not found: /b/c/d/
>> > >> >> Page not found: /a/b/c/d/
>> > >> >>
>> > >> >> I found that after the redirect, the handler (which is a
>> > >> >> fixuphandler) doesn't recur, but return apache.DONE, and then
>> > >> another
>> > >> >> handler is called. My only thought could be that this is
>> > >> intrinsic to
>> > >> >> the fixuphandler, but that seems silly. Skipping the  
>> redirect and
>> > >> >> just returning 404 seems to work, and it doesn't return  
>> four not
>> > >> >> found pages.
>> > >> >>
>> > >> >> What do I need to do to fix this?
>> > >> >
>> > >> > This is probably the problem with autoindex I briefly  
>> mentioned.
>> > >> To do
>> > >> > an index it actually does a sub request as far as the fixup  
>> handler
>> > >> > phase for every item which it might list in the index to
>> > >> determine if
>> > >> > it has access rights and should be listing it. If you have  
>> handlers
>> > >> > for these phases it will trigger them for the subrequest as  
>> well
>> > >> which
>> > >> > might cause issues. One can detect if such a handler is  
>> called in
>> > >> > subrequest by looking whether req.prev or req.main (cant  
>> remember
>> > >> > which), is not None.
>> > >>
>> > >> I just tried this, and whenever I tried to access req.prev or
>> > >> req.main (even req.next), the request would be scrapped and a  
>> new one
>> > >> created, that would get to the same point before starting  
>> again. I
>> > >> would have thousands of lines of "Debug: preparing to redirect"
>> > >> before I would just have to cancel the page from loading.
>> > >>
>> > >> > When I get a chance to at least get directory index to week  
>> as you
>> > >> > indicate what you want, then we can start stepping through  
>> these
>> > >> > others issues.
>> > >> >
>> > >> > Graham
>> > >>
>> > >> Aaron Gallagher
>> > >> <habnabit@gmail.com>
>> > >>
>> > >>
>> > >>
>> >
>> > Aaron Gallagher
>> > <habnabit@gmail.com>
>> >
>> >
>> >
>>

Aaron Gallagher
<habnabit@gmail.com>


From graham.dumpleton at gmail.com  Wed May 30 00:18:35 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Wed May 30 00:18:42 2007
Subject: [mod_python] Apache directory listing
In-Reply-To: <5D9FEA5B-107F-4535-B9A9-99FFB5F28D93@gmail.com>
References: <641494D0-A3E3-400B-BC16-9A8F2995B2CD@gmail.com>
	<88e286470705291559x6fcc686ep158ad5208140c7c6@mail.gmail.com>
	<B3553137-1D32-4813-864A-8177E782B6A9@gmail.com>
	<88e286470705291623v6280f36frd1f5c539ddc25e2f@mail.gmail.com>
	<12B98D29-1414-4305-BF7F-24E5107E4438@gmail.com>
	<88e286470705291931o2d6af656w6590aa625ebac7ed@mail.gmail.com>
	<2240ED84-D42F-47C4-B2C6-9DF135169512@gmail.com>
	<88e286470705291941w7d7d6cenef4d9ef497ce7728@mail.gmail.com>
	<88e286470705291952i3e6bd497ncf25128ee0da35ff@mail.gmail.com>
	<5D9FEA5B-107F-4535-B9A9-99FFB5F28D93@gmail.com>
Message-ID: <88e286470705292118x54f50240uabd13d56ecec50fd@mail.gmail.com>

Experiment 1.

Using Apache configuration of:

Alias / /Users/grahamd/mod_python/handlers/

<Directory /Users/grahamd/mod_python/handlers>
Order deny,allow
Allow from all
PythonFixupHandler ~/_handler.py
PythonDebug On
Options +Indexes
</Directory>

Note that I am NOT setting SetHandler as only needed for PythonHandler.

Then have _handler.py file in that directory containing:

from mod_python import apache

def fixuphandler(req):
  apache.log_error('fixuphandler %s' % req.uri)
  return apache.OK

when I access the directory, and it runs autoindex, the log file contains:

[Wed May 30 13:45:38 2007] [error] fixuphandler /
[Wed May 30 13:45:38 2007] [error] fixuphandler /index.html
[Wed May 30 13:45:39 2007] [error] fixuphandler /_handler.py
[Wed May 30 13:45:39 2007] [error] fixuphandler /hello.txt

The web browser contains:

Index of /

    * _handler.py
    * hello.txt

This shows what I mean about how it runs handlers through to
fixuphandler() in a subrequest on each item in the directory. The
reason it does this is to determine if it has access rights to items
it might list. It has asked for /index.html because of DirectoryIndex
being set to that in global Apache scope.

I now change my fixuphandler to:

def fixuphandler(req):
  apache.log_error('fixuphandler %s' % req.uri)
  if req.uri == '/_handler.py':
    return apache.HTTP_FORBIDDEN
  return apache.OK

The extra check is making _handler.py forbidden. As a result, web page
now only shows:

Index of /

    * hello.txt

One can tell that one is in this sort of subrequest because req.main
will be set. One could also query the req.main.handler value. For
example:

def fixuphandler(req):
  apache.log_error('fixuphandler %s' % req.uri)
  if req.main and req.main.handler == 'httpd/unix-directory':
    apache.log_error('in autoindex sub request')
  if req.uri == '/_handler.py':
    return apache.HTTP_FORBIDDEN
  return apache.OK

In the log file I then get:

[Wed May 30 13:56:43 2007] [error] fixuphandler /
[Wed May 30 13:56:43 2007] [error] fixuphandler /index.html
[Wed May 30 13:56:43 2007] [error] in autoindex sub request
[Wed May 30 13:56:43 2007] [error] fixuphandler /_handler.py
[Wed May 30 13:56:43 2007] [error] in autoindex sub request
[Wed May 30 13:56:43 2007] [error] fixuphandler /hello.txt
[Wed May 30 13:56:43 2007] [error] in autoindex sub request

You may want to know it is a sub request to autoindex so as to avoid
sending back your own custom content for the forbidden response. If
you are using ErrorDocument, you wouldn't be sending back your own
content though and so it wouldn't have potential for mucking up a
autoindex generated directory listing.

To have custom error details for a error page produced by
ErrorDocument, set error-notes in req.notes:

def fixuphandler(req):
  apache.log_error('fixuphandler %s' % req.uri)
  if req.main and req.main.handler == 'httpd/unix-directory':
    apache.log_error('in autoindex sub request')
  if req.uri == '/_handler.py':
    req.notes['error-notes'] = 'Sorry, you can't access %s' % req.uri
    return apache.HTTP_FORBIDDEN
  return apache.OK

That value will then come through in variable in req.subprocess_env of
ErrorDocument handler.

Experiment 2

Now change Apache configuration to:

Alias / /Users/grahamd/mod_python/handlers/

<Directory /Users/grahamd/mod_python/handlers>
Order deny,allow
Allow from all
SetHandler mod_python
PythonFixupHandler ~/_handler.py
PythonHandler ~/_handler.py
PythonDebug On
Options +Indexes
</Directory>

Thus, am now using SetHandler.

Also change _handler.py to add:

def handler(req):
  req.content_type = 'text/plain'
  print >> req, req.uri
  print >> req, req.filename
  print >> req, req.path_info
  print >> req, req.args
  return apache.OK

If now access the directory, get in the web browser:

/
/Users/grahamd/mod_python/handlers/

None

Thus, the SetHandler is overriding the directory indexing.

To allow directory indexing to work, but all requests to resources
within directory, change configuration to:

Alias / /Users/grahamd/mod_python/handlers/

<Directory /Users/grahamd/mod_python/handlers>
Order deny,allow
Allow from all
<Files ~ .+>
SetHandler mod_python
</Files>
PythonFixupHandler ~/_handler.py
PythonHandler ~/_handler.py
PythonDebug On
Options +Indexes
</Directory>

Now get a autoindex listing from root directory access, but otherwise
handler is called.

If you have subdirectories though and you wanted directory indexes for
those, this will not work. Thus, put back configuration to:

Alias / /Users/grahamd/mod_python/handlers/

<Directory /Users/grahamd/mod_python/handlers>
Order deny,allow
Allow from all
SetHandler mod_python
PythonFixupHandler ~/_handler.py
PythonHandler ~/_handler.py
PythonDebug On
Options +Indexes
</Directory>

Also now change fixuphandler() to be:

def fixuphandler(req):
  apache.log_error('fixuphandler %s' % req.uri)
  if req.finfo.filetype == apache.APR_DIR:
    req.handler = 'httpd/unix-directory'
  return apache.OK

You can now browse through subdirectories okay using autoindex
generated directory listing.

Anyway, experiment with this slowly adding your extra stuff to it. If
you have problems or don't understand something, post the complete
code file so can see what is happening.

Graham
From habnabit at gmail.com  Wed May 30 01:49:17 2007
From: habnabit at gmail.com (Aaron Gallagher)
Date: Wed May 30 01:49:30 2007
Subject: [mod_python] Apache directory listing
In-Reply-To: <88e286470705292118x54f50240uabd13d56ecec50fd@mail.gmail.com>
References: <641494D0-A3E3-400B-BC16-9A8F2995B2CD@gmail.com>
	<88e286470705291559x6fcc686ep158ad5208140c7c6@mail.gmail.com>
	<B3553137-1D32-4813-864A-8177E782B6A9@gmail.com>
	<88e286470705291623v6280f36frd1f5c539ddc25e2f@mail.gmail.com>
	<12B98D29-1414-4305-BF7F-24E5107E4438@gmail.com>
	<88e286470705291931o2d6af656w6590aa625ebac7ed@mail.gmail.com>
	<2240ED84-D42F-47C4-B2C6-9DF135169512@gmail.com>
	<88e286470705291941w7d7d6cenef4d9ef497ce7728@mail.gmail.com>
	<88e286470705291952i3e6bd497ncf25128ee0da35ff@mail.gmail.com>
	<5D9FEA5B-107F-4535-B9A9-99FFB5F28D93@gmail.com>
	<88e286470705292118x54f50240uabd13d56ecec50fd@mail.gmail.com>
Message-ID: <C4D7CF4C-F980-40F0-87CE-CFFE9ADF4912@gmail.com>

Hah, wow, I guess that explains everything.

I got really frustrated with all of my bizarre problems, so I tried  
testing it on another machine.

Everything worked _perfectly_. No problems whatsoever. Apache  
autoindexed my directories and everything.

The first thing I did was check the versions, and they're both  
running apache 2.0.59 with mod_python 3.3.1. Weird.

I'm going to do a complete reinstall of apache and see if that fixes  
everything on the server. I hope so.


Aaron Gallagher
<habnabit@gmail.com>


From habnabit at gmail.com  Wed May 30 03:27:51 2007
From: habnabit at gmail.com (Aaron Gallagher)
Date: Wed May 30 03:28:03 2007
Subject: [mod_python] Apache directory listing
In-Reply-To: <C4D7CF4C-F980-40F0-87CE-CFFE9ADF4912@gmail.com>
References: <641494D0-A3E3-400B-BC16-9A8F2995B2CD@gmail.com>
	<88e286470705291559x6fcc686ep158ad5208140c7c6@mail.gmail.com>
	<B3553137-1D32-4813-864A-8177E782B6A9@gmail.com>
	<88e286470705291623v6280f36frd1f5c539ddc25e2f@mail.gmail.com>
	<12B98D29-1414-4305-BF7F-24E5107E4438@gmail.com>
	<88e286470705291931o2d6af656w6590aa625ebac7ed@mail.gmail.com>
	<2240ED84-D42F-47C4-B2C6-9DF135169512@gmail.com>
	<88e286470705291941w7d7d6cenef4d9ef497ce7728@mail.gmail.com>
	<88e286470705291952i3e6bd497ncf25128ee0da35ff@mail.gmail.com>
	<5D9FEA5B-107F-4535-B9A9-99FFB5F28D93@gmail.com>
	<88e286470705292118x54f50240uabd13d56ecec50fd@mail.gmail.com>
	<C4D7CF4C-F980-40F0-87CE-CFFE9ADF4912@gmail.com>
Message-ID: <98BF7227-DB03-464B-BA16-F5DEB4ED380E@gmail.com>

I just completely cleaned out my apache install, reinstalled it, and  
it seems to be working, but I'm having problems again, and I've heard  
of other people having the same problem. Every mod_python module I  
try to load will not load, and the error I get is that the modules  
can't be found.

I'm using a .pth file in my site-packages directory, and I can import  
the modules just fine from the interactive interpreter anywhere, and  
mod_python.testhandler is reporting that my module directory is in  
sys.path.

So, what's going on?

On May 29, 2007, at 10:49 PM, Aaron Gallagher wrote:

> Hah, wow, I guess that explains everything.
>
> I got really frustrated with all of my bizarre problems, so I tried  
> testing it on another machine.
>
> Everything worked _perfectly_. No problems whatsoever. Apache  
> autoindexed my directories and everything.
>
> The first thing I did was check the versions, and they're both  
> running apache 2.0.59 with mod_python 3.3.1. Weird.
>
> I'm going to do a complete reinstall of apache and see if that  
> fixes everything on the server. I hope so.

Aaron Gallagher
<habnabit@gmail.com>


From rogerb at rogerbinns.com  Wed May 30 03:40:29 2007
From: rogerb at rogerbinns.com (Roger Binns)
Date: Wed May 30 03:40:34 2007
Subject: [mod_python] Some observations after writing my own modpython
In-Reply-To: <88e286470705282123n6f2caf3ey3c4231ce8b244f06@mail.gmail.com>
References: <465BA139.9020208@rogerbinns.com>
	<88e286470705282123n6f2caf3ey3c4231ce8b244f06@mail.gmail.com>
Message-ID: <465D2A6D.2090101@rogerbinns.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Graham Dumpleton wrote:
> Maybe you would like to review my code for me. :-)
> 
>  http://www.modwsgi.org

I've taken a quick look but am not too familiar with what it is doing.
(Pretty much all the Python wrapping of other libraries I do is to
deliberately ignore Python "standards" and follow what the libraries do
instead :-)

I am somewhat baffled as to why you have the "daemon" mode.  Surely
ProxyPass would be sufficient.  And if it wasn't then fastcgi/scgi
should be.

I'm astounded at how much effort you have put into being compatible
across so many Apache versions and packaging tweaks on the various
distributions.

You've also got a lot of options and complexity for those options, such
as optionally disabling protection against stdio usage and signals.  My
own tastes are towards insisting on standards compliance and not have
more code (and hence more complexity and possibility for bugs).

At line 729 after the PyErr_Fetch, I believe you should use
PyErr_Normalize to set unset value/tracebacks.

The Log_output function has lots of scary string arithmetic and memory
allocations.  Wouldn't the various apr_str functions do the trick?

The if(*msg) in Log_write is redundant since format "s" to
PyArg_ParseTuple will always fill in the char*.

You may find it worthwhile using PyObject_CallFunction instead of
BuildValue and CallObject.  You have one less thing to track refcounts
for and one less line of code.

Input_read also has the string arithmetic and memory allocations.  Why
not use the Python PyString or apr routines for all of those?

For the various objects that have a request_rec*, I don't see how they
deal with outliving the request_req.

A lot of the config values will accept nonsensical values for booleans
because the config routines effectively do a caseless compare for "off"
and treat everything else as on, including "0", "1" etc.  I'd suggest
tightening that up to only accept the values you want rather than
anything.  (You know someday someone will make a configuration mistake
and get unexpected behaviour and take ages to track down that "0" didn't
actually turn something off or "1" didn't turn it on).

On the whole the code is clear and readable.

> All my work on SWIGing the Apache APIs could probably have saved you a
> lot of effort. :-)

Not really since I only wrapped the data and methods I needed which
amounts to about 20 items.  However it was very obvious that an
automated approach to making a wrapper is by far the best way of doing
it.  There are so many very similar things, but with the odd exception
or tweak here and there.

> Is what you have done patches to mod_python, or have you gone and
> written your own Apache module from scratch which is independent of
> mod_python, or uses the exported mod_python optional functions for
> getting access to interpreters? 

It is completely independent started from scratch code.  I didn't bother
with multiple interpreters since all the Python code that runs is mine
and it isn't "hostile".

> Are you intending to post your code anywhere so we can have a look?

Sadly I can't since I don't own it :-(  However it isn't that
interesting because it is subset of Apache apis, only request_rec is
wrapped, only the main interpreter etc.  I also am not constrained by
backwards compatibility for Python (using 2.5) or Apache (using 2.2) or
by an installed base as modpython is.

> And there are a lot more problems than that. Personally, in terms of
> adding more and more access to the Apache API I am far from convinced
> that mod_python is a good starting point. :-)

I certainly chose not to start from mod_python and technically only
needed one more api :-)  It would be useful to look at the modperl code
generator since they must have the meta-information about apis and types
somewhere.

> Trying to cache values,
> especially when they aren't all read only and can be updated by other
> Apache functions, just makes the job of writing a hand coded wrapper
> even more work so I don't begrudge the original author for not doing
> it.

For OOR you just have to stash the Python object pointer somewhere in
the Apache object and so the pool note functions would work.  I don't
see anywhere that values are cached, unless you mean something like
getting the same PyString objects out when setting a setting field.
That certainly is going too far.

This has all been a valuable learning experience and I am very glad to
be able to use Apache for all authentication and authorization.

Roger
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)

iD8DBQFGXSptmOOfHg372QQRAiUiAKCjPbAu0jwCkmhE3lvFrjCwXR8+fACgw1nC
bB6CkpocNG/aSA23JbRQ1S0=
=dqja
-----END PGP SIGNATURE-----
From fidita48 at hotmail.com  Wed May 30 13:03:57 2007
From: fidita48 at hotmail.com (=?iso-8859-1?B?SWRvaWEgVmlsbGFjaeFuIFrhcmF0ZQ==?=)
Date: Wed May 30 13:04:07 2007
Subject: [SPAM] [mod_python] Error
Message-ID: <BAY137-F2991D389EC80E62FDD8DC6D42E0@phx.gbl>

An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070530/000d7164/attachment-0001.html
From ccbean at gmail.com  Wed May 30 14:09:23 2007
From: ccbean at gmail.com (Colin Bean)
Date: Wed May 30 14:09:33 2007
Subject: [SPAM] [mod_python] Error
In-Reply-To: <BAY137-F2991D389EC80E62FDD8DC6D42E0@phx.gbl>
References: <BAY137-F2991D389EC80E62FDD8DC6D42E0@phx.gbl>
Message-ID: <29a6ca010705301109u2be35faav58fce6fb1eeef7c7@mail.gmail.com>

When you say you wrote the program in python 2.4, do you mean using
IDLE under windows?  This is the same as running your script on the
command line, as referred to to by previous posters.

This is expected behavior; your script will not work unless you run it
from within apache, and from your previous example it seems like you
basically got this working.
Running your script locally won't compile it or do anything else
useful; you should focus on deploying your script in apache (start
with your working hello world example).

Running a python script under IDLE may create pyc files, but these are
not necessary to run your original script.

HTH,
Colin


On 5/30/07, Idoia Villaci?n Z?rate <fidita48@hotmail.com> wrote:
>
>
> Maybe I have not explained well my problem. From the beginning I got the
> message Hello world!!! when I wrote my URL.
>
>
>
> I get the error when I write the program in Python 2.4 and when compiling
> (press run module) is when I get the error, ImportError: No module named
> _apache
>
> So what do I have to do, do not compile it?
>
>
>
>
>  ________________________________
>
> From:  "Graham Dumpleton" <graham.dumpleton@gmail.com>
> To:  "Idoia Villaci?n Z?rate" <fidita48@hotmail.com>
> CC:  mod_python@modpython.org
> Subject:  Re: [mod_python] Error
> Date:  Wed, 30 May 2007 08:54:35 +1000
> >So, after all that it is now working after all. I'm confused.
> >
> >Graham
> >
> >On 30/05/07, Idoia Villaci?n Z?rate <fidita48@hotmail.com> wrote:
> >>
> >>
> >>
> >>Hello,
> >>
> >>
> >>
> >>When I acces from my URL,that is
> >>http://localhost/mywebdir/mptest.py, where mptest.py is
> the
> >>following program:
> >>
> >>
> >>
> >>from mod_python import apache
> >>
> >>
> >>
> >>def handler(req):
> >>
> >>     req.content_type = 'text/plain'
> >>
> >>     req.write("Hello World!")
> >>
> >>     return apache.OK
> >>
> >>
> >>
> >>The localhost is DocumentRoot "C:/Archivos de programa/Apache
> >>Software
> >>Foundation/Apache2.2/htdocs", mywebdir is the folder where the file
> >>mptest
> >>is, and I get the message Hello world! And in the error log I get :
> >>
> >>
> >>
> >>[Tue May 29 17:06:49 2007] [notice] mod_python (pid=3844,
> >>interpreter='127.0.0.1'): Importing module 'C:\\Archivos de
> >>programa\\Apache Software
> >>Foundation\\Apache2.2\\htdocs\\mywebdir\\mptest.py'
> >>
> >>
> >>
> >>If I change the code for the one you give me:
> >>print "Content-type: text/html\n\n"
> >>print "Hello, World."
> >>
> >>  When I access to the URL y get a message MOD_PYTHON ERROR, and I
> >>don't get
> >>the Hello world, and in the apache's error lof I get the following:
> >>
> >>
> >>
> >>
> >>[Tue May 29 21:16:56 2007] [error] [client 127.0.0.1] mod_python
> >>(pid=2236,
> >>interpreter='127.0.0.1', phase='PythonHandler', handler='mptest'):
> >>Application error
> >>[Tue May 29 21:16:56 2007] [error] [client 127.0.0.1] ServerName:
> >>'127.0.0.1'
> >>[Tue May 29 21:16:56 2007] [error] [client 127.0.0.1] DocumentRoot:
> >>'C:/Archivos de programa/Apache Software
> >>Foundation/Apache2.2/htdocs'
> >>[Tue May 29 21:16:56 2007] [error] [client 127.0.0.1] URI:
> >>'/mywebdir/mptest.py'
> >>[Tue May 29 21:16:56 2007] [error] [client 127.0.0.1] Location:
> >>None
> >>[Tue May 29 21:16:56 2007] [error] [client 127.0.0.1] Directory:
> >>'C:/Archivos de programa/Apache Software
> >>Foundation/Apache2.2/htdocs/mywebdir/'
> >>[Tue May 29 21:16:56 2007] [error] [client 127.0.0.1] Filename:
> >>'C:/Archivos
> >>de programa/Apache Software
> >>Foundation/Apache2.2/htdocs/mywebdir/mptest.py'
> >>[Tue May 29 21:16:56 2007] [error] [client 127.0.0.1] PathInfo: ''
> >>[Tue May 29 21:16:57 2007] [error] [client 127.0.0.1] Traceback
> >>(most recent
> >>call last):
> >>[Tue May 29 21:16:57 2007] [error] [client 127.0.0.1]   File
> >>"C:\\Python24\\Lib\\site-packages\\mod_python\\importer.py",
> >>line 1537, in HandlerDispatch\n
> >>default=default_handler, arg=req, silent=hlist.silent)
> >>[Tue May 29 21:16:57 2007] [error] [client 127.0.0.1]   File
> >>"C:\\Python24\\Lib\\site-packages\\mod_python\\importer.py",
> >>line 1206, in _process_target\n    object =
> >>apache.resolve_object(module,
> >>object_str, arg, silent=silent)
> >>[Tue May 29 21:16:57 2007] [error] [client 127.0.0.1]   File
> >>"C:\\Python24\\Lib\\site-packages\\mod_python\\apache.py",
> >>line 696, in resolve_object\n    raise AttributeError, s
> >>[Tue May 29 21:16:57 2007] [error] [client 127.0.0.1]
> >>AttributeError: module
> >>'C:\\Archivos de programa\\Apache Software
> >>Foundation\\Apache2.2\\htdocs\\mywebdir\\mptest.py'
> >>contains no 'handler'
> >>
> >>
> >>
> >>
> >>  Thanks
> >>
> >>
> >>  ________________________________
> >>
> >>From:  "Graham Dumpleton" <graham.dumpleton@gmail.com>
> >>To:  "Idoia Villaci?n Z?rate" <fidita48@hotmail.com>
> >>CC:  mod_python@modpython.org
> >>Subject:  Re: [mod_python] Error
> >>Date:  Tue, 29 May 2007 08:20:23 +1000
> >> >Hmmm, no mention of CGI in those bits that may be relevant.
> >> >
> >> >Lets try this a different way. Replace your existing code file
> >>with
> >> >another with the same name but containing:
> >> >
> >> >  print "Content-type: text/html\n\n"
> >> >  print "Hello, World."
> >> >
> >> >When you access the URL you have been using, what is displayed in
> >> >your
> >> >browser and the error logs then?
> >> >
> >> >If this works okay, then it confirms your Apache must be
> >>configured
> >> >for CGI somehow and it is overriding mod_python.
> >> >
> >> >BTW, what URL are you actually using in your browser again. I
> >>don't
> >> >recollect seeing you post what you were using.
> >> >
> >> >You also may want to confirm whether you are indeed setting up
> >> >everything correctly by following alternate instructions in:
> >> >
> >> >
> >>
> >http://www.dscpl.com.au/wiki/ModPython/Articles/GettingModPythonWorking
> >> >
> >> >You will have to get htaccess files working for your Windows box
> >> >though.
> >> >
> >> >Graham
> >> >
> >> >On 29/05/07, Idoia Villaci??n Z??rate <fidita48@hotmail.com>
> >>wrote:
> >> >>
> >> >>
> >> >>
> >> >>Hello,
> >> >>
> >> >>
> >> >>
> >> >>What I have in apache's configuration is the following
> >> >>
> >> >>
> >> >>
> >> >><Directory "C:/Archivos de programa/Apache Software
> >> >>Foundation/Apache2.2/htdocs">
> >> >>
> >> >>     #
> >> >>
> >> >>     # Possible values for the Options directive are "None",
> >>"All",
> >> >>
> >> >>     # or any combination of:
> >> >>
> >> >>     #   Indexes Includes FollowSymLinks SymLinksifOwnerMatch
> >> >>ExecCGI
> >> >>MultiViews
> >> >>
> >> >>     #
> >> >>
> >> >>     # Note that "MultiViews" must be named *explicitly* ---
> >> >>"Options All"
> >> >>
> >> >>     # doesn't give it to you.
> >> >>
> >> >>     #
> >> >>
> >> >>     # The Options directive is both complicated and important.
> >> >>Please see
> >> >>
> >> >>     #
> >> >>http://httpd.apache.org/docs/2.2/mod/core.html#options
> >> >>
> >> >>     # for more information.
> >> >>
> >> >>     #
> >> >>
> >> >>     Options Indexes FollowSymLinks
> >> >>
> >> >>
> >> >>
> >> >>     #
> >> >>
> >> >>     # AllowOverride controls what directives may be placed in
> >> >>.htaccess
> >> >>files.
> >> >>
> >> >>     # It can be "All", "None", or any combination of the
> >>keywords:
> >> >>
> >> >>     #   Options FileInfo AuthConfig Limit
> >> >>
> >> >>     #
> >> >>
> >> >>     AllowOverride None
> >> >>
> >> >>
> >> >>
> >> >>     #
> >> >>
> >> >>     # Controls who can get stuff from this server.
> >> >>
> >> >>     #
> >> >>
> >> >>     Order allow,deny
> >> >>
> >> >>     Allow from all
> >> >>
> >> >>
> >> >>
> >> >></Directory>
> >> >>
> >> >>
> >> >>
> >> >>And finally:
> >> >>
> >> >>
> >> >>
> >> >>#AddHandler cgi-script .cgi
> >> >>
> >> >>
> >> >>
> >> >>Thanks
> >> >>
> >> >>
> >> >>
> >> >>
> >> >>
> >> >>
> >> >>
> >> >>  ________________________________
> >> >>
> >> >>From:  "Graham Dumpleton" <graham.dumpleton@gmail.com>
> >> >>To:  "Idoia Villaci???n Z???rate" <fidita48@hotmail.com>
> >>
> >> >>CC:  mod_python@modpython.org
> >> >>Subject:  Re: [mod_python] Error
> >> >>Date:  Sat, 26 May 2007 21:36:53 +1000
> >> >>
> >> >> >I was hoping for the region of the log file which also showed
> >> >>your
> >> >> >error:
> >> >> >
> >> >> >Traceback (most recent call last):
> >> >> >
> >> >> >  File "C:\Archivos de programa\Apache Software
> >> >> >Foundation\Apache2.2\htdocs\mptest.py", line 1, in ?
> >> >> >
> >> >> >    from mod_python import apache
> >> >> >
> >> >> >  File
> >>
> >>"C:\Python24\Lib\site-packages\mod_python\apache.py",
> >>line
> >> >> >30, in ?
> >> >> >
> >> >> >    import _apache
> >> >> >ImportError: No module named _apache
> >> >> >
> >> >> >embedded within the middle of it.
> >> >> >
> >> >> >Ie., something like:
> >> >> >
> >> >> >[Mon Apr 09 13:30:15 2007] [error] [client 127.0.0.1]
> >>mod_python
> >> >> >(pid=7293, interpreter='grumpy.local', phase='PythonHandler',
> >> >> >handler='paste.modpython'): Application error
> >> >> >[Mon Apr 09 13:30:15 2007] [error] [client 127.0.0.1]
> >>ServerName:
> >> >> >'grumpy.local'[Mon Apr 09 13:30:15 2007] [error] [client
> >> >>127.0.0.1]
> >> >> >DocumentRoot: '/usr/local/apache-2.2/htdocs'
> >> >> >[Mon Apr 09 13:30:15 2007] [error] [client 127.0.0.1] URI:
> >> >> >'/mod_python/hello'[Mon Apr 09 13:30:15 2007] [error] [client
> >> >> >127.0.0.1] Location: '/mod_python/hello'[Mon Apr 09 13:30:15
> >> >>2007]
> >> >> >[error] [client 127.0.0.1] Directory: None
> >> >> >[Mon Apr 09 13:30:15 2007] [error] [client 127.0.0.1]
> >>Filename:
> >> >> >'/usr/local/apache-2.2/htdocs/mod_python'
> >> >> >[Mon Apr 09 13:30:15 2007] [error] [client 127.0.0.1]
> >>PathInfo:
> >> >> >'/hello'
> >> >> >[Mon Apr 09 13:30:15 2007] [error] [client 127.0.0.1]
> >>Traceback
> >> >> >(most
> >> >> >recent call last):
> >> >> >[Mon Apr 09 13:30:15 2007] [error] [client 127.0.0.1]   File
> >> >>
> >>
> >"/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site-packages/mod_python/importer.py",
> >> >> >line 1537, in HandlerDispatch\n
> >> >>default=default_handler, arg=req,
> >> >> >silent=hlist.silent)[Mon Apr 09 13:30:15 2007] [error] [client
> >> >> >127.0.0.1]   File
> >> >>
> >>
> >"/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site-packages/mod_python/importer.py",
> >> >> >line 1229, in _process_target\n    result =
> >> >>_execute_target(config,
> >> >> >req, object, arg)[Mon Apr 09 13:30:15 2007] [error] [client
> >> >> >127.0.0.1]
> >> >> >  File
> >> >>
> >>
> >"/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site-packages/mod_python/importer.py",
> >> >> >line 1128, in _execute_target\n    result = object(arg)[Mon
> >>Apr
> >> >>09
> >> >> >13:30:15 2007] [error] [client 127.0.0.1]   File
> >> >>
> >>
> >"/Library/Python/2.3/site-packages/Paste-1.2.1-py2.3.egg/paste/modpython.py",
> >> >> >line 246, in handler\n    module = __import__(modname,
> >>globals(),
> >> >> >locals(), [''])[Mon Apr 09 13:30:15 2007] [error] [client
> >> >>127.0.0.1]
> >> >> >File "/usr/local/wsgi/scripts/hello.py", line 3, in
> ?\n
> >> >>import
> >> >> >mod_wsgi[Mon Apr 09 13:30:15 2007] [error] [client 127.0.0.1]
> >> >> >ImportError: No module named mod_wsgi
> >> >> >
> >> >> >The thing I just realised though is that your error message
> >>can't
> >> >>be
> >> >> >a
> >> >> >result of a failure of mod_python as the way mod_python logs
> >> >> >tracebacks means that the details would have the timestamp
> >> >> >information
> >> >> >prefixing each line like above. That they don't appear means
> >>your
> >> >> >script is probably most definitely being executed as a CGI
> >>script
> >> >> >and
> >> >> >not by mod_python.
> >> >> >
> >> >> >Thus I would suggest you have a configuration problem with
> >>HTTP.
> >> >> >Specifically, you have CGI scripts enabled for that directory,
> >>or
> >> >> >for
> >> >> >the .py extension.
> >> >> >
> >> >> >What do you have elsewhere in your Apache configuration
> >>relating
> >> >>to
> >> >> >CGI scripts. Do you have anything like:
> >> >> >
> >> >> >  AddHandler cgi-script .py
> >> >> >
> >> >> >or:
> >> >> >
> >> >> >  Options ExecCGI
> >> >> >
> >> >> >Find that section of your configuration and reply-all and
> >>quote
> >> >>it.
> >> >> >
> >> >> >Graham
> >> >> >
> >> >> >
> >> >> >
> >> >> >On 26/05/07, Idoia Villaci??n Z??rate <fidita48@hotmail.com>
> >>
> >> >>wrote:
> >> >> >>
> >> >> >>
> >> >> >>I'm sorry, I didn't know I have to send back the mails, I'll
> >>do
> >> >>it
> >> >> >>from now.
> >> >> >>
> >> >> >>
> >> >> >>
> >> >> >>here I send you the lines of apache's log error:
> >> >> >>
> >> >> >>[Sat May 26 12:42:26 2007] [notice] Apache/2.2.4 (Win32)
> >> >>configured
> >> >> >>--
> >> >> >>resuming normal operations
> >> >> >>
> >> >> >>[Sat May 26 12:42:26 2007] [notice] Server built: Jan  9 2007
> >> >> >>23:17:20
> >> >> >>
> >> >> >>[Sat May 26 12:42:26 2007] [notice] Parent: Created child
> >> >>process
> >> >> >>1604
> >> >> >>
> >> >> >>[Sat May 26 12:42:27 2007] [notice] Child 1604: Child process
> >>is
> >> >> >>running
> >> >> >>
> >> >> >>[Sat May 26 12:42:27 2007] [notice] Child 1604: Acquired the
> >> >>start
> >> >> >>mutex.
> >> >> >>
> >> >> >>[Sat May 26 12:42:27 2007] [notice] Child 1604: Starting 250
> >> >>worker
> >> >> >>threads.
> >> >> >>
> >> >> >>[Sat May 26 12:42:27 2007] [notice] Child 1604: Starting
> >>thread
> >> >>to
> >> >> >>listen on
> >> >> >>port 80.
> >> >> >>
> >> >> >>[Sat May 26 12:59:04 2007] [notice] Parent: Received restart
> >> >>signal
> >> >> >>--
> >> >> >>Restarting the server.
> >> >> >>
> >> >> >>[Sat May 26 12:59:04 2007] [notice] Child 1604: Exit event
> >> >> >>signaled. Child
> >> >> >>process is ending.
> >> >> >>
> >> >> >>[Sat May 26 12:59:04 2007] [notice] Apache/2.2.4 (Win32)
> >> >>configured
> >> >> >>--
> >> >> >>resuming normal operations
> >> >> >>
> >> >> >>[Sat May 26 12:59:04 2007] [notice] Server built: Jan  9 2007
> >> >> >>23:17:20
> >> >> >>
> >> >> >>[Sat May 26 12:59:04 2007] [notice] Parent: Created child
> >> >>process
> >> >> >>5332
> >> >> >>
> >> >> >>[Sat May 26 12:59:05 2007] [error] python_init: Python
> >>version
> >> >> >>mismatch,
> >> >> >>expected '2.4.3', found '2.4.4'.
> >> >> >>
> >> >> >>[Sat May 26 12:59:05 2007] [error] python_init: Python
> >> >>executable
> >> >> >>found
> >> >> >>'C:\\Archivos de programa\\Apache Software
> >> >> >>Foundation\\Apache2.2\\bin\\httpd.exe'.
> >> >> >>
> >> >> >>[Sat May 26 12:59:05 2007] [error] python_init: Python path
> >> >>being
> >> >> >>used
> >> >>
> >>
> >>'C:\\WINDOWS\\system32\\python24.zip;C:\\Python24\\Lib;C:\\Python24\\DLLs;C:\\Python24\\Lib\\lib-tk;;C:\\Archivos
> >> >> >>de programa\\Apache Software Foundation\\Apache2.2\\bin'.
> >> >> >>
> >> >> >>[Sat May 26 12:59:05 2007] [notice] mod_python: Creating 8
> >> >>session
> >> >> >>mutexes
> >> >> >>based on 0 max processes and 250 max threads.
> >> >> >>
> >> >> >>[Sat May 26 12:59:05 2007] [notice] Child 5332: Child process
> >>is
> >> >> >>running
> >> >> >>
> >> >> >>[Sat May 26 12:59:05 2007] [notice] Child 1604: Released the
> >> >>start
> >> >> >>mutex
> >> >> >>
> >> >> >>[Sat May 26 12:59:05 2007] [notice] Child 5332: Acquired the
> >> >>start
> >> >> >>mutex.
> >> >> >>
> >> >> >>[Sat May 26 12:59:05 2007] [notice] Child 5332: Starting 250
> >> >>worker
> >> >> >>threads.
> >> >> >>
> >> >> >>[Sat May 26 12:59:06 2007] [notice] Child 1604: Waiting for
> >>250
> >> >> >>worker
> >> >> >>threads to exit.
> >> >> >>
> >> >> >>[Sat May 26 12:59:06 2007] [notice] Child 1604: All worker
> >> >>threads
> >> >> >>have
> >> >> >>exited.
> >> >> >>
> >> >> >>[Sat May 26 12:59:06 2007] [notice] Child 1604: Child process
> >>is
> >> >> >>exiting
> >> >> >>
> >> >> >>[Sat May 26 12:59:06 2007] [notice] Child 5332: Starting
> >>thread
> >> >>to
> >> >> >>listen on
> >> >> >>port 80.
> >> >> >>
> >> >> >>[Sat May 26 13:00:22 2007] [notice] Parent: Received restart
> >> >>signal
> >> >> >>--
> >> >> >>Restarting the server.
> >> >> >>
> >> >> >>[Sat May 26 13:00:22 2007] [notice] Child 5332: Exit event
> >> >> >>signaled. Child
> >> >> >>process is ending.
> >> >> >>
> >> >> >>[Sat May 26 13:00:22 2007] [notice] Apache/2.2.4 (Win32)
> >> >>configured
> >> >> >>--
> >> >> >>resuming normal operations
> >> >> >>
> >> >> >>[Sat May 26 13:00:22 2007] [notice] Server built: Jan  9 2007
> >> >> >>23:17:20
> >> >> >>
> >> >> >>[Sat May 26 13:00:22 2007] [notice] Parent: Created child
> >> >>process
> >> >> >>3408
> >> >> >>
> >> >> >>[Sat May 26 13:00:22 2007] [error] python_init: Python
> >>version
> >> >> >>mismatch,
> >> >> >>expected '2.4.3', found '2.4.4'.
> >> >> >>
> >> >> >>[Sat May 26 13:00:22 2007] [error] python_init: Python
> >> >>executable
> >> >> >>found
> >> >> >>'C:\\Archivos de programa\\Apache Software
> >> >> >>Foundation\\Apache2.2\\bin\\httpd.exe'.
> >> >> >>
> >> >> >>[Sat May 26 13:00:22 2007] [error] python_init: Python path
> >> >>being
> >> >> >>used
> >> >>
> >>
> >>'C:\\WINDOWS\\system32\\python24.zip;C:\\Python24\\Lib;C:\\Python24\\DLLs;C:\\Python24\\Lib\\lib-tk;;C:\\Archivos
> >> >> >>de programa\\Apache Software Foundation\\Apache2.2\\bin'.
> >> >> >>
> >> >> >>[Sat May 26 13:00:22 2007] [notice] mod_python: Creating 8
> >> >>session
> >> >> >>mutexes
> >> >> >>based on 0 max processes and 250 max threads.
> >> >> >>
> >> >> >>[Sat May 26 13:00:22 2007] [notice] Child 3408: Child process
> >>is
> >> >> >>running
> >> >> >>
> >> >> >>[Sat May 26 13:00:23 2007] [notice] Child 5332: Released the
> >> >>start
> >> >> >>mutex
> >> >> >>
> >> >> >>[Sat May 26 13:00:23 2007] [notice] Child 3408: Acquired the
> >> >>start
> >> >> >>mutex.
> >> >> >>
> >> >> >>[Sat May 26 13:00:23 2007] [notice] Child 3408: Starting 250
> >> >>worker
> >> >> >>threads.
> >> >> >>
> >> >> >>[Sat May 26 13:00:23 2007] [notice] Child 3408: Starting
> >>thread
> >> >>to
> >> >> >>listen on
> >> >> >>port 80.
> >> >> >>
> >> >> >>[Sat May 26 13:00:24 2007] [notice] Child 5332: Waiting for
> >>250
> >> >> >>worker
> >> >> >>threads to exit.
> >> >> >>
> >> >> >>[Sat May 26 13:00:24 2007] [notice] Child 5332: All worker
> >> >>threads
> >> >> >>have
> >> >> >>exited.
> >> >> >>
> >> >> >>[Sat May 26 13:00:24 2007] [notice] Child 5332: Child process
> >>is
> >> >> >>exiting
> >> >> >>
> >> >> >>[Sat May 26 13:06:54 2007] [notice] Parent: Received restart
> >> >>signal
> >> >> >>--
> >> >> >>Restarting the server.
> >> >> >>
> >> >> >>[Sat May 26 13:06:54 2007] [notice] Child 3408: Exit event
> >> >> >>signaled. Child
> >> >> >>process is ending.
> >> >> >>
> >> >> >>[Sat May 26 13:06:54 2007] [notice] Apache/2.2.4 (Win32)
> >> >>configured
> >> >> >>--
> >> >> >>resuming normal operations
> >> >> >>
> >> >> >>[Sat May 26 13:06:54 2007] [notice] Server built: Jan  9 2007
> >> >> >>23:17:20
> >> >> >>
> >> >> >>[Sat May 26 13:06:54 2007] [notice] Parent: Created child
> >> >>process
> >> >> >>6388
> >> >> >>
> >> >> >>[Sat May 26 13:06:54 2007] [error] python_init: Python
> >>version
> >> >> >>mismatch,
> >> >> >>expected '2.4.3', found '2.4.4'.
> >> >> >>
> >> >> >>[Sat May 26 13:06:54 2007] [error] python_init: Python
> >> >>executable
> >> >> >>found
> >> >> >>'C:\\Archivos de programa\\Apache Software
> >> >> >>Foundation\\Apache2.2\\bin\\httpd.exe'.
> >> >> >>
> >> >> >>[Sat May 26 13:06:54 2007] [error] python_init: Python path
> >> >>being
> >> >> >>used
> >> >>
> >>
> >>'C:\\WINDOWS\\system32\\python24.zip;C:\\Python24\\Lib;C:\\Python24\\DLLs;C:\\Python24\\Lib\\lib-tk;;C:\\Archivos
> >> >> >>de programa\\Apache Software Foundation\\Apache2.2\\bin'.
> >> >> >>
> >> >> >>[Sat May 26 13:06:54 2007] [notice] mod_python: Creating 8
> >> >>session
> >> >> >>mutexes
> >> >> >>based on 0 max processes and 250 max threads.
> >> >> >>
> >> >> >>[Sat May 26 13:06:54 2007] [notice] Child 6388: Child process
> >>is
> >> >> >>running
> >> >> >>
> >> >> >>[Sat May 26 13:06:55 2007] [notice] Child 3408: Released the
> >> >>start
> >> >> >>mutex
> >> >> >>
> >> >> >>[Sat May 26 13:06:55 2007] [notice] Child 6388: Acquired the
> >> >>start
> >> >> >>mutex.
> >> >> >>
> >> >> >>[Sat May 26 13:06:55 2007] [notice] Child 6388: Starting 250
> >> >>worker
> >> >> >>threads.
> >> >> >>
> >> >> >>[Sat May 26 13:06:55 2007] [notice] Child 6388: Starting
> >>thread
> >> >>to
> >> >> >>listen on
> >> >> >>port 80.
> >> >> >>
> >> >> >>[Sat May 26 13:06:56 2007] [notice] Child 3408: Waiting for
> >>250
> >> >> >>worker
> >> >> >>threads to exit.
> >> >> >>
> >> >> >>[Sat May 26 13:06:56 2007] [notice] Child 3408: All worker
> >> >>threads
> >> >> >>have
> >> >> >>exited.
> >> >> >>
> >> >> >>[Sat May 26 13:06:56 2007] [notice] Child 3408: Child process
> >>is
> >> >> >>exiting
> >> >> >>
> >> >> >>
> >> >> >>
> >> >> >>Thanks
> >> >> >>
> >> >> >>
> >> >> >>________________________________
> >> >> >>Acepta el reto MSN Premium: Env???a hasta 500 megas diarios
> >>de
> >> >> >>fotos desde
> >> >> >>Hotmail. Desc???rgalo y pru???balo 2 meses gratis.
> >> >>
> >> >>________________________________
> >> >>Acepta el reto MSN Premium: Env???a hasta 500 megas diarios de
> >> >>fotos desde
> >> >>Hotmail. Desc???rgalo y pru???balo 2 meses gratis.
> >>
> >>________________________________
> >>Encuentra una aventura, un romance o al amor de tu vida. Date de
> >>alta
> >>gratis.
>
> ________________________________
> Ofertas y reservas para viajar por todo el mundo. Organiza y contrata tus
> viajes aqu?.
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>

From graham.dumpleton at gmail.com  Wed May 30 18:34:09 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Wed May 30 18:34:16 2007
Subject: [mod_python] Error
In-Reply-To: <BAY137-F2991D389EC80E62FDD8DC6D42E0@phx.gbl>
References: <BAY137-F2991D389EC80E62FDD8DC6D42E0@phx.gbl>
Message-ID: <88e286470705301534u20d59469v6540214ee2b27b29@mail.gmail.com>

Finally I understand what you are talking about. You are trying to
forcibly generate a .pyc file corresponding to the .py file.

The short answer is you can't and even if you could the mod_python
module importer doesn't use them as it doesn't use the standard Python
module importer to load modules.

Graham

On 31/05/07, Idoia Villaci?n Z?rate <fidita48@hotmail.com> wrote:
>
>
> Maybe I have not explained well my problem. From the beginning I got the
> message Hello world!!! when I wrote my URL.
>
>
>
> I get the error when I write the program in Python 2.4 and when compiling
> (press run module) is when I get the error, ImportError: No module named
> _apache
>
> So what do I have to do, do not compile it?
>
>
>
>
>  ________________________________
>
> From:  "Graham Dumpleton" <graham.dumpleton@gmail.com>
> To:  "Idoia Villaci?n Z?rate" <fidita48@hotmail.com>
> CC:  mod_python@modpython.org
> Subject:  Re: [mod_python] Error
> Date:  Wed, 30 May 2007 08:54:35 +1000
> >So, after all that it is now working after all. I'm confused.
> >
> >Graham
> >
> >On 30/05/07, Idoia Villaci?n Z?rate <fidita48@hotmail.com> wrote:
> >>
> >>
> >>
> >>Hello,
> >>
> >>
> >>
> >>When I acces from my URL,that is
> >>http://localhost/mywebdir/mptest.py, where mptest.py is
> the
> >>following program:
> >>
> >>
> >>
> >>from mod_python import apache
> >>
> >>
> >>
> >>def handler(req):
> >>
> >>     req.content_type = 'text/plain'
> >>
> >>     req.write("Hello World!")
> >>
> >>     return apache.OK
> >>
> >>
> >>
> >>The localhost is DocumentRoot "C:/Archivos de programa/Apache
> >>Software
> >>Foundation/Apache2.2/htdocs", mywebdir is the folder where the file
> >>mptest
> >>is, and I get the message Hello world! And in the error log I get :
> >>
> >>
> >>
> >>[Tue May 29 17:06:49 2007] [notice] mod_python (pid=3844,
> >>interpreter='127.0.0.1'): Importing module 'C:\\Archivos de
> >>programa\\Apache Software
> >>Foundation\\Apache2.2\\htdocs\\mywebdir\\mptest.py'
> >>
> >>
> >>
> >>If I change the code for the one you give me:
> >>print "Content-type: text/html\n\n"
> >>print "Hello, World."
> >>
> >>  When I access to the URL y get a message MOD_PYTHON ERROR, and I
> >>don't get
> >>the Hello world, and in the apache's error lof I get the following:
> >>
> >>
> >>
> >>
> >>[Tue May 29 21:16:56 2007] [error] [client 127.0.0.1] mod_python
> >>(pid=2236,
> >>interpreter='127.0.0.1', phase='PythonHandler', handler='mptest'):
> >>Application error
> >>[Tue May 29 21:16:56 2007] [error] [client 127.0.0.1] ServerName:
> >>'127.0.0.1'
> >>[Tue May 29 21:16:56 2007] [error] [client 127.0.0.1] DocumentRoot:
> >>'C:/Archivos de programa/Apache Software
> >>Foundation/Apache2.2/htdocs'
> >>[Tue May 29 21:16:56 2007] [error] [client 127.0.0.1] URI:
> >>'/mywebdir/mptest.py'
> >>[Tue May 29 21:16:56 2007] [error] [client 127.0.0.1] Location:
> >>None
> >>[Tue May 29 21:16:56 2007] [error] [client 127.0.0.1] Directory:
> >>'C:/Archivos de programa/Apache Software
> >>Foundation/Apache2.2/htdocs/mywebdir/'
> >>[Tue May 29 21:16:56 2007] [error] [client 127.0.0.1] Filename:
> >>'C:/Archivos
> >>de programa/Apache Software
> >>Foundation/Apache2.2/htdocs/mywebdir/mptest.py'
> >>[Tue May 29 21:16:56 2007] [error] [client 127.0.0.1] PathInfo: ''
> >>[Tue May 29 21:16:57 2007] [error] [client 127.0.0.1] Traceback
> >>(most recent
> >>call last):
> >>[Tue May 29 21:16:57 2007] [error] [client 127.0.0.1]   File
> >>"C:\\Python24\\Lib\\site-packages\\mod_python\\importer.py",
> >>line 1537, in HandlerDispatch\n
> >>default=default_handler, arg=req, silent=hlist.silent)
> >>[Tue May 29 21:16:57 2007] [error] [client 127.0.0.1]   File
> >>"C:\\Python24\\Lib\\site-packages\\mod_python\\importer.py",
> >>line 1206, in _process_target\n    object =
> >>apache.resolve_object(module,
> >>object_str, arg, silent=silent)
> >>[Tue May 29 21:16:57 2007] [error] [client 127.0.0.1]   File
> >>"C:\\Python24\\Lib\\site-packages\\mod_python\\apache.py",
> >>line 696, in resolve_object\n    raise AttributeError, s
> >>[Tue May 29 21:16:57 2007] [error] [client 127.0.0.1]
> >>AttributeError: module
> >>'C:\\Archivos de programa\\Apache Software
> >>Foundation\\Apache2.2\\htdocs\\mywebdir\\mptest.py'
> >>contains no 'handler'
> >>
> >>
> >>
> >>
> >>  Thanks
> >>
> >>
> >>  ________________________________
> >>
> >>From:  "Graham Dumpleton" <graham.dumpleton@gmail.com>
> >>To:  "Idoia Villaci?n Z?rate" <fidita48@hotmail.com>
> >>CC:  mod_python@modpython.org
> >>Subject:  Re: [mod_python] Error
> >>Date:  Tue, 29 May 2007 08:20:23 +1000
> >> >Hmmm, no mention of CGI in those bits that may be relevant.
> >> >
> >> >Lets try this a different way. Replace your existing code file
> >>with
> >> >another with the same name but containing:
> >> >
> >> >  print "Content-type: text/html\n\n"
> >> >  print "Hello, World."
> >> >
> >> >When you access the URL you have been using, what is displayed in
> >> >your
> >> >browser and the error logs then?
> >> >
> >> >If this works okay, then it confirms your Apache must be
> >>configured
> >> >for CGI somehow and it is overriding mod_python.
> >> >
> >> >BTW, what URL are you actually using in your browser again. I
> >>don't
> >> >recollect seeing you post what you were using.
> >> >
> >> >You also may want to confirm whether you are indeed setting up
> >> >everything correctly by following alternate instructions in:
> >> >
> >> >
> >>
> >http://www.dscpl.com.au/wiki/ModPython/Articles/GettingModPythonWorking
> >> >
> >> >You will have to get htaccess files working for your Windows box
> >> >though.
> >> >
> >> >Graham
> >> >
> >> >On 29/05/07, Idoia Villaci??n Z??rate <fidita48@hotmail.com>
> >>wrote:
> >> >>
> >> >>
> >> >>
> >> >>Hello,
> >> >>
> >> >>
> >> >>
> >> >>What I have in apache's configuration is the following
> >> >>
> >> >>
> >> >>
> >> >><Directory "C:/Archivos de programa/Apache Software
> >> >>Foundation/Apache2.2/htdocs">
> >> >>
> >> >>     #
> >> >>
> >> >>     # Possible values for the Options directive are "None",
> >>"All",
> >> >>
> >> >>     # or any combination of:
> >> >>
> >> >>     #   Indexes Includes FollowSymLinks SymLinksifOwnerMatch
> >> >>ExecCGI
> >> >>MultiViews
> >> >>
> >> >>     #
> >> >>
> >> >>     # Note that "MultiViews" must be named *explicitly* ---
> >> >>"Options All"
> >> >>
> >> >>     # doesn't give it to you.
> >> >>
> >> >>     #
> >> >>
> >> >>     # The Options directive is both complicated and important.
> >> >>Please see
> >> >>
> >> >>     #
> >> >>http://httpd.apache.org/docs/2.2/mod/core.html#options
> >> >>
> >> >>     # for more information.
> >> >>
> >> >>     #
> >> >>
> >> >>     Options Indexes FollowSymLinks
> >> >>
> >> >>
> >> >>
> >> >>     #
> >> >>
> >> >>     # AllowOverride controls what directives may be placed in
> >> >>.htaccess
> >> >>files.
> >> >>
> >> >>     # It can be "All", "None", or any combination of the
> >>keywords:
> >> >>
> >> >>     #   Options FileInfo AuthConfig Limit
> >> >>
> >> >>     #
> >> >>
> >> >>     AllowOverride None
> >> >>
> >> >>
> >> >>
> >> >>     #
> >> >>
> >> >>     # Controls who can get stuff from this server.
> >> >>
> >> >>     #
> >> >>
> >> >>     Order allow,deny
> >> >>
> >> >>     Allow from all
> >> >>
> >> >>
> >> >>
> >> >></Directory>
> >> >>
> >> >>
> >> >>
> >> >>And finally:
> >> >>
> >> >>
> >> >>
> >> >>#AddHandler cgi-script .cgi
> >> >>
> >> >>
> >> >>
> >> >>Thanks
> >> >>
> >> >>
> >> >>
> >> >>
> >> >>
> >> >>
> >> >>
> >> >>  ________________________________
> >> >>
> >> >>From:  "Graham Dumpleton" <graham.dumpleton@gmail.com>
> >> >>To:  "Idoia Villaci???n Z???rate" <fidita48@hotmail.com>
> >>
> >> >>CC:  mod_python@modpython.org
> >> >>Subject:  Re: [mod_python] Error
> >> >>Date:  Sat, 26 May 2007 21:36:53 +1000
> >> >>
> >> >> >I was hoping for the region of the log file which also showed
> >> >>your
> >> >> >error:
> >> >> >
> >> >> >Traceback (most recent call last):
> >> >> >
> >> >> >  File "C:\Archivos de programa\Apache Software
> >> >> >Foundation\Apache2.2\htdocs\mptest.py", line 1, in ?
> >> >> >
> >> >> >    from mod_python import apache
> >> >> >
> >> >> >  File
> >>
> >>"C:\Python24\Lib\site-packages\mod_python\apache.py",
> >>line
> >> >> >30, in ?
> >> >> >
> >> >> >    import _apache
> >> >> >ImportError: No module named _apache
> >> >> >
> >> >> >embedded within the middle of it.
> >> >> >
> >> >> >Ie., something like:
> >> >> >
> >> >> >[Mon Apr 09 13:30:15 2007] [error] [client 127.0.0.1]
> >>mod_python
> >> >> >(pid=7293, interpreter='grumpy.local', phase='PythonHandler',
> >> >> >handler='paste.modpython'): Application error
> >> >> >[Mon Apr 09 13:30:15 2007] [error] [client 127.0.0.1]
> >>ServerName:
> >> >> >'grumpy.local'[Mon Apr 09 13:30:15 2007] [error] [client
> >> >>127.0.0.1]
> >> >> >DocumentRoot: '/usr/local/apache-2.2/htdocs'
> >> >> >[Mon Apr 09 13:30:15 2007] [error] [client 127.0.0.1] URI:
> >> >> >'/mod_python/hello'[Mon Apr 09 13:30:15 2007] [error] [client
> >> >> >127.0.0.1] Location: '/mod_python/hello'[Mon Apr 09 13:30:15
> >> >>2007]
> >> >> >[error] [client 127.0.0.1] Directory: None
> >> >> >[Mon Apr 09 13:30:15 2007] [error] [client 127.0.0.1]
> >>Filename:
> >> >> >'/usr/local/apache-2.2/htdocs/mod_python'
> >> >> >[Mon Apr 09 13:30:15 2007] [error] [client 127.0.0.1]
> >>PathInfo:
> >> >> >'/hello'
> >> >> >[Mon Apr 09 13:30:15 2007] [error] [client 127.0.0.1]
> >>Traceback
> >> >> >(most
> >> >> >recent call last):
> >> >> >[Mon Apr 09 13:30:15 2007] [error] [client 127.0.0.1]   File
> >> >>
> >>
> >"/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site-packages/mod_python/importer.py",
> >> >> >line 1537, in HandlerDispatch\n
> >> >>default=default_handler, arg=req,
> >> >> >silent=hlist.silent)[Mon Apr 09 13:30:15 2007] [error] [client
> >> >> >127.0.0.1]   File
> >> >>
> >>
> >"/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site-packages/mod_python/importer.py",
> >> >> >line 1229, in _process_target\n    result =
> >> >>_execute_target(config,
> >> >> >req, object, arg)[Mon Apr 09 13:30:15 2007] [error] [client
> >> >> >127.0.0.1]
> >> >> >  File
> >> >>
> >>
> >"/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site-packages/mod_python/importer.py",
> >> >> >line 1128, in _execute_target\n    result = object(arg)[Mon
> >>Apr
> >> >>09
> >> >> >13:30:15 2007] [error] [client 127.0.0.1]   File
> >> >>
> >>
> >"/Library/Python/2.3/site-packages/Paste-1.2.1-py2.3.egg/paste/modpython.py",
> >> >> >line 246, in handler\n    module = __import__(modname,
> >>globals(),
> >> >> >locals(), [''])[Mon Apr 09 13:30:15 2007] [error] [client
> >> >>127.0.0.1]
> >> >> >File "/usr/local/wsgi/scripts/hello.py", line 3, in
> ?\n
> >> >>import
> >> >> >mod_wsgi[Mon Apr 09 13:30:15 2007] [error] [client 127.0.0.1]
> >> >> >ImportError: No module named mod_wsgi
> >> >> >
> >> >> >The thing I just realised though is that your error message
> >>can't
> >> >>be
> >> >> >a
> >> >> >result of a failure of mod_python as the way mod_python logs
> >> >> >tracebacks means that the details would have the timestamp
> >> >> >information
> >> >> >prefixing each line like above. That they don't appear means
> >>your
> >> >> >script is probably most definitely being executed as a CGI
> >>script
> >> >> >and
> >> >> >not by mod_python.
> >> >> >
> >> >> >Thus I would suggest you have a configuration problem with
> >>HTTP.
> >> >> >Specifically, you have CGI scripts enabled for that directory,
> >>or
> >> >> >for
> >> >> >the .py extension.
> >> >> >
> >> >> >What do you have elsewhere in your Apache configuration
> >>relating
> >> >>to
> >> >> >CGI scripts. Do you have anything like:
> >> >> >
> >> >> >  AddHandler cgi-script .py
> >> >> >
> >> >> >or:
> >> >> >
> >> >> >  Options ExecCGI
> >> >> >
> >> >> >Find that section of your configuration and reply-all and
> >>quote
> >> >>it.
> >> >> >
> >> >> >Graham
> >> >> >
> >> >> >
> >> >> >
> >> >> >On 26/05/07, Idoia Villaci??n Z??rate <fidita48@hotmail.com>
> >>
> >> >>wrote:
> >> >> >>
> >> >> >>
> >> >> >>I'm sorry, I didn't know I have to send back the mails, I'll
> >>do
> >> >>it
> >> >> >>from now.
> >> >> >>
> >> >> >>
> >> >> >>
> >> >> >>here I send you the lines of apache's log error:
> >> >> >>
> >> >> >>[Sat May 26 12:42:26 2007] [notice] Apache/2.2.4 (Win32)
> >> >>configured
> >> >> >>--
> >> >> >>resuming normal operations
> >> >> >>
> >> >> >>[Sat May 26 12:42:26 2007] [notice] Server built: Jan  9 2007
> >> >> >>23:17:20
> >> >> >>
> >> >> >>[Sat May 26 12:42:26 2007] [notice] Parent: Created child
> >> >>process
> >> >> >>1604
> >> >> >>
> >> >> >>[Sat May 26 12:42:27 2007] [notice] Child 1604: Child process
> >>is
> >> >> >>running
> >> >> >>
> >> >> >>[Sat May 26 12:42:27 2007] [notice] Child 1604: Acquired the
> >> >>start
> >> >> >>mutex.
> >> >> >>
> >> >> >>[Sat May 26 12:42:27 2007] [notice] Child 1604: Starting 250
> >> >>worker
> >> >> >>threads.
> >> >> >>
> >> >> >>[Sat May 26 12:42:27 2007] [notice] Child 1604: Starting
> >>thread
> >> >>to
> >> >> >>listen on
> >> >> >>port 80.
> >> >> >>
> >> >> >>[Sat May 26 12:59:04 2007] [notice] Parent: Received restart
> >> >>signal
> >> >> >>--
> >> >> >>Restarting the server.
> >> >> >>
> >> >> >>[Sat May 26 12:59:04 2007] [notice] Child 1604: Exit event
> >> >> >>signaled. Child
> >> >> >>process is ending.
> >> >> >>
> >> >> >>[Sat May 26 12:59:04 2007] [notice] Apache/2.2.4 (Win32)
> >> >>configured
> >> >> >>--
> >> >> >>resuming normal operations
> >> >> >>
> >> >> >>[Sat May 26 12:59:04 2007] [notice] Server built: Jan  9 2007
> >> >> >>23:17:20
> >> >> >>
> >> >> >>[Sat May 26 12:59:04 2007] [notice] Parent: Created child
> >> >>process
> >> >> >>5332
> >> >> >>
> >> >> >>[Sat May 26 12:59:05 2007] [error] python_init: Python
> >>version
> >> >> >>mismatch,
> >> >> >>expected '2.4.3', found '2.4.4'.
> >> >> >>
> >> >> >>[Sat May 26 12:59:05 2007] [error] python_init: Python
> >> >>executable
> >> >> >>found
> >> >> >>'C:\\Archivos de programa\\Apache Software
> >> >> >>Foundation\\Apache2.2\\bin\\httpd.exe'.
> >> >> >>
> >> >> >>[Sat May 26 12:59:05 2007] [error] python_init: Python path
> >> >>being
> >> >> >>used
> >> >>
> >>
> >>'C:\\WINDOWS\\system32\\python24.zip;C:\\Python24\\Lib;C:\\Python24\\DLLs;C:\\Python24\\Lib\\lib-tk;;C:\\Archivos
> >> >> >>de programa\\Apache Software Foundation\\Apache2.2\\bin'.
> >> >> >>
> >> >> >>[Sat May 26 12:59:05 2007] [notice] mod_python: Creating 8
> >> >>session
> >> >> >>mutexes
> >> >> >>based on 0 max processes and 250 max threads.
> >> >> >>
> >> >> >>[Sat May 26 12:59:05 2007] [notice] Child 5332: Child process
> >>is
> >> >> >>running
> >> >> >>
> >> >> >>[Sat May 26 12:59:05 2007] [notice] Child 1604: Released the
> >> >>start
> >> >> >>mutex
> >> >> >>
> >> >> >>[Sat May 26 12:59:05 2007] [notice] Child 5332: Acquired the
> >> >>start
> >> >> >>mutex.
> >> >> >>
> >> >> >>[Sat May 26 12:59:05 2007] [notice] Child 5332: Starting 250
> >> >>worker
> >> >> >>threads.
> >> >> >>
> >> >> >>[Sat May 26 12:59:06 2007] [notice] Child 1604: Waiting for
> >>250
> >> >> >>worker
> >> >> >>threads to exit.
> >> >> >>
> >> >> >>[Sat May 26 12:59:06 2007] [notice] Child 1604: All worker
> >> >>threads
> >> >> >>have
> >> >> >>exited.
> >> >> >>
> >> >> >>[Sat May 26 12:59:06 2007] [notice] Child 1604: Child process
> >>is
> >> >> >>exiting
> >> >> >>
> >> >> >>[Sat May 26 12:59:06 2007] [notice] Child 5332: Starting
> >>thread
> >> >>to
> >> >> >>listen on
> >> >> >>port 80.
> >> >> >>
> >> >> >>[Sat May 26 13:00:22 2007] [notice] Parent: Received restart
> >> >>signal
> >> >> >>--
> >> >> >>Restarting the server.
> >> >> >>
> >> >> >>[Sat May 26 13:00:22 2007] [notice] Child 5332: Exit event
> >> >> >>signaled. Child
> >> >> >>process is ending.
> >> >> >>
> >> >> >>[Sat May 26 13:00:22 2007] [notice] Apache/2.2.4 (Win32)
> >> >>configured
> >> >> >>--
> >> >> >>resuming normal operations
> >> >> >>
> >> >> >>[Sat May 26 13:00:22 2007] [notice] Server built: Jan  9 2007
> >> >> >>23:17:20
> >> >> >>
> >> >> >>[Sat May 26 13:00:22 2007] [notice] Parent: Created child
> >> >>process
> >> >> >>3408
> >> >> >>
> >> >> >>[Sat May 26 13:00:22 2007] [error] python_init: Python
> >>version
> >> >> >>mismatch,
> >> >> >>expected '2.4.3', found '2.4.4'.
> >> >> >>
> >> >> >>[Sat May 26 13:00:22 2007] [error] python_init: Python
> >> >>executable
> >> >> >>found
> >> >> >>'C:\\Archivos de programa\\Apache Software
> >> >> >>Foundation\\Apache2.2\\bin\\httpd.exe'.
> >> >> >>
> >> >> >>[Sat May 26 13:00:22 2007] [error] python_init: Python path
> >> >>being
> >> >> >>used
> >> >>
> >>
> >>'C:\\WINDOWS\\system32\\python24.zip;C:\\Python24\\Lib;C:\\Python24\\DLLs;C:\\Python24\\Lib\\lib-tk;;C:\\Archivos
> >> >> >>de programa\\Apache Software Foundation\\Apache2.2\\bin'.
> >> >> >>
> >> >> >>[Sat May 26 13:00:22 2007] [notice] mod_python: Creating 8
> >> >>session
> >> >> >>mutexes
> >> >> >>based on 0 max processes and 250 max threads.
> >> >> >>
> >> >> >>[Sat May 26 13:00:22 2007] [notice] Child 3408: Child process
> >>is
> >> >> >>running
> >> >> >>
> >> >> >>[Sat May 26 13:00:23 2007] [notice] Child 5332: Released the
> >> >>start
> >> >> >>mutex
> >> >> >>
> >> >> >>[Sat May 26 13:00:23 2007] [notice] Child 3408: Acquired the
> >> >>start
> >> >> >>mutex.
> >> >> >>
> >> >> >>[Sat May 26 13:00:23 2007] [notice] Child 3408: Starting 250
> >> >>worker
> >> >> >>threads.
> >> >> >>
> >> >> >>[Sat May 26 13:00:23 2007] [notice] Child 3408: Starting
> >>thread
> >> >>to
> >> >> >>listen on
> >> >> >>port 80.
> >> >> >>
> >> >> >>[Sat May 26 13:00:24 2007] [notice] Child 5332: Waiting for
> >>250
> >> >> >>worker
> >> >> >>threads to exit.
> >> >> >>
> >> >> >>[Sat May 26 13:00:24 2007] [notice] Child 5332: All worker
> >> >>threads
> >> >> >>have
> >> >> >>exited.
> >> >> >>
> >> >> >>[Sat May 26 13:00:24 2007] [notice] Child 5332: Child process
> >>is
> >> >> >>exiting
> >> >> >>
> >> >> >>[Sat May 26 13:06:54 2007] [notice] Parent: Received restart
> >> >>signal
> >> >> >>--
> >> >> >>Restarting the server.
> >> >> >>
> >> >> >>[Sat May 26 13:06:54 2007] [notice] Child 3408: Exit event
> >> >> >>signaled. Child
> >> >> >>process is ending.
> >> >> >>
> >> >> >>[Sat May 26 13:06:54 2007] [notice] Apache/2.2.4 (Win32)
> >> >>configured
> >> >> >>--
> >> >> >>resuming normal operations
> >> >> >>
> >> >> >>[Sat May 26 13:06:54 2007] [notice] Server built: Jan  9 2007
> >> >> >>23:17:20
> >> >> >>
> >> >> >>[Sat May 26 13:06:54 2007] [notice] Parent: Created child
> >> >>process
> >> >> >>6388
> >> >> >>
> >> >> >>[Sat May 26 13:06:54 2007] [error] python_init: Python
> >>version
> >> >> >>mismatch,
> >> >> >>expected '2.4.3', found '2.4.4'.
> >> >> >>
> >> >> >>[Sat May 26 13:06:54 2007] [error] python_init: Python
> >> >>executable
> >> >> >>found
> >> >> >>'C:\\Archivos de programa\\Apache Software
> >> >> >>Foundation\\Apache2.2\\bin\\httpd.exe'.
> >> >> >>
> >> >> >>[Sat May 26 13:06:54 2007] [error] python_init: Python path
> >> >>being
> >> >> >>used
> >> >>
> >>
> >>'C:\\WINDOWS\\system32\\python24.zip;C:\\Python24\\Lib;C:\\Python24\\DLLs;C:\\Python24\\Lib\\lib-tk;;C:\\Archivos
> >> >> >>de programa\\Apache Software Foundation\\Apache2.2\\bin'.
> >> >> >>
> >> >> >>[Sat May 26 13:06:54 2007] [notice] mod_python: Creating 8
> >> >>session
> >> >> >>mutexes
> >> >> >>based on 0 max processes and 250 max threads.
> >> >> >>
> >> >> >>[Sat May 26 13:06:54 2007] [notice] Child 6388: Child process
> >>is
> >> >> >>running
> >> >> >>
> >> >> >>[Sat May 26 13:06:55 2007] [notice] Child 3408: Released the
> >> >>start
> >> >> >>mutex
> >> >> >>
> >> >> >>[Sat May 26 13:06:55 2007] [notice] Child 6388: Acquired the
> >> >>start
> >> >> >>mutex.
> >> >> >>
> >> >> >>[Sat May 26 13:06:55 2007] [notice] Child 6388: Starting 250
> >> >>worker
> >> >> >>threads.
> >> >> >>
> >> >> >>[Sat May 26 13:06:55 2007] [notice] Child 6388: Starting
> >>thread
> >> >>to
> >> >> >>listen on
> >> >> >>port 80.
> >> >> >>
> >> >> >>[Sat May 26 13:06:56 2007] [notice] Child 3408: Waiting for
> >>250
> >> >> >>worker
> >> >> >>threads to exit.
> >> >> >>
> >> >> >>[Sat May 26 13:06:56 2007] [notice] Child 3408: All worker
> >> >>threads
> >> >> >>have
> >> >> >>exited.
> >> >> >>
> >> >> >>[Sat May 26 13:06:56 2007] [notice] Child 3408: Child process
> >>is
> >> >> >>exiting
> >> >> >>
> >> >> >>
> >> >> >>
> >> >> >>Thanks
> >> >> >>
> >> >> >>
> >> >> >>________________________________
> >> >> >>Acepta el reto MSN Premium: Env???a hasta 500 megas diarios
> >>de
> >> >> >>fotos desde
> >> >> >>Hotmail. Desc???rgalo y pru???balo 2 meses gratis.
> >> >>
> >> >>________________________________
> >> >>Acepta el reto MSN Premium: Env???a hasta 500 megas diarios de
> >> >>fotos desde
> >> >>Hotmail. Desc???rgalo y pru???balo 2 meses gratis.
> >>
> >>________________________________
> >>Encuentra una aventura, un romance o al amor de tu vida. Date de
> >>alta
> >>gratis.
>
> ________________________________
> Ofertas y reservas para viajar por todo el mundo. Organiza y contrata tus
> viajes aqu?.

From graham.dumpleton at gmail.com  Wed May 30 18:45:45 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Wed May 30 18:45:54 2007
Subject: [mod_python] Apache directory listing
In-Reply-To: <98BF7227-DB03-464B-BA16-F5DEB4ED380E@gmail.com>
References: <641494D0-A3E3-400B-BC16-9A8F2995B2CD@gmail.com>
	<12B98D29-1414-4305-BF7F-24E5107E4438@gmail.com>
	<88e286470705291931o2d6af656w6590aa625ebac7ed@mail.gmail.com>
	<2240ED84-D42F-47C4-B2C6-9DF135169512@gmail.com>
	<88e286470705291941w7d7d6cenef4d9ef497ce7728@mail.gmail.com>
	<88e286470705291952i3e6bd497ncf25128ee0da35ff@mail.gmail.com>
	<5D9FEA5B-107F-4535-B9A9-99FFB5F28D93@gmail.com>
	<88e286470705292118x54f50240uabd13d56ecec50fd@mail.gmail.com>
	<C4D7CF4C-F980-40F0-87CE-CFFE9ADF4912@gmail.com>
	<98BF7227-DB03-464B-BA16-F5DEB4ED380E@gmail.com>
Message-ID: <88e286470705301545v47c67caejae2910b5145e48cc@mail.gmail.com>

Apache runs as a special user. Are your modules and the full directory
path to where they are located readable to others?

On 30/05/07, Aaron Gallagher <habnabit@gmail.com> wrote:
> I just completely cleaned out my apache install, reinstalled it, and
> it seems to be working, but I'm having problems again, and I've heard
> of other people having the same problem. Every mod_python module I
> try to load will not load, and the error I get is that the modules
> can't be found.
>
> I'm using a .pth file in my site-packages directory, and I can import
> the modules just fine from the interactive interpreter anywhere, and
> mod_python.testhandler is reporting that my module directory is in
> sys.path.
>
> So, what's going on?
>
> On May 29, 2007, at 10:49 PM, Aaron Gallagher wrote:
>
> > Hah, wow, I guess that explains everything.
> >
> > I got really frustrated with all of my bizarre problems, so I tried
> > testing it on another machine.
> >
> > Everything worked _perfectly_. No problems whatsoever. Apache
> > autoindexed my directories and everything.
> >
> > The first thing I did was check the versions, and they're both
> > running apache 2.0.59 with mod_python 3.3.1. Weird.
> >
> > I'm going to do a complete reinstall of apache and see if that
> > fixes everything on the server. I hope so.
>
> Aaron Gallagher
> <habnabit@gmail.com>
>
>
>
From graham.dumpleton at gmail.com  Wed May 30 20:22:27 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Wed May 30 20:22:35 2007
Subject: [mod_python] Some observations after writing my own modpython
In-Reply-To: <465D2A6D.2090101@rogerbinns.com>
References: <465BA139.9020208@rogerbinns.com>
	<88e286470705282123n6f2caf3ey3c4231ce8b244f06@mail.gmail.com>
	<465D2A6D.2090101@rogerbinns.com>
Message-ID: <88e286470705301722x5244474fs2d3b2314648e7d0b@mail.gmail.com>

On 30/05/07, Roger Binns <rogerb@rogerbinns.com> wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> Graham Dumpleton wrote:
> > Maybe you would like to review my code for me. :-)
> >
> >  http://www.modwsgi.org
>
> I've taken a quick look but am not too familiar with what it is doing.

Wow, when I suggested that it was more 'tongue in cheek', if you
understand the expression. In other words I never actually expected to
hear anything back from you about it. Much thanks.

> (Pretty much all the Python wrapping of other libraries I do is to
> deliberately ignore Python "standards" and follow what the libraries do
> instead :-)

For Apache, I definitely feel that is the best approach. How
mod_python wraps it differently is a pain as you can't just point
people at the Apache documentation.

> I am somewhat baffled as to why you have the "daemon" mode.  Surely
> ProxyPass would be sufficient.  And if it wasn't then fastcgi/scgi
> should be.

The complaints one keep seeing about fastcgi/scgi is that it is a pain
to setup both in the fact that you need to install separate backend
packages and also in the configuration. You also see various
complaints about it those process will just die or will hang around
and not die.

The whole point of having such a feature in mod_wsgi is so that you
don't have to install a separate backend framework, so the exact same
script file as for embedded mode can be used and to make the
configuration as simple as possible. Also, because Apache creates and
manages the daemon processes just like any other Apache child process,
you are guaranteed that you will not get daemon processes hanging
around and causing problems, plus Apache can restart them
automatically if they die.

Overall, the intent is to make it as secure, simple and uncomplicated
as possible for web hosting companies so they can see it as a viable
option for hosting Python web applications.

This doesn't mean it will be suitable for all use cases, but it goes a
lot further than any other single solution. The only real case where
it still may not be completely suitable for is where a user wants to
be able to run different versions of Python to that which the web
hosting company might want to provide. This is where a ProxyPass or
fastcgi/scgi solution would work, but if using ProxyPass, you could
equally proxy to a second Apache instance for the user, and running as
the user, which is itself running mod_wsgi in embedded mode.

> I'm astounded at how much effort you have put into being compatible
> across so many Apache versions and packaging tweaks on the various
> distributions.
>
> You've also got a lot of options and complexity for those options, such
> as optionally disabling protection against stdio usage and signals.  My
> own tastes are towards insisting on standards compliance and not have
> more code (and hence more complexity and possibility for bugs).

The problem is that WSGI as a standard is incomplete. There is nothing
in the standard to say that applications shouldn't be using things
like standard input and output, but if you don't your WSGI application
isn't strictly portable. Thus I enforce certain rules which promote
portability, but you still have to provide a way out for those people
using some non portable application. Because so many WSGI capable
applications weren't originally designed for WSGI but made to work on
it later, there are plenty of non portable WSGI applications or
applications which do nasty things that interfere with Apache.

Anyway, again, it is all about providing a system which is going to be
safe to use in shared web hosting environments where users can't
create havoc. At the same time, it is configurable enough that people
running their own web servers can change the behaviour if need be.

> At line 729 after the PyErr_Fetch, I believe you should use
> PyErr_Normalize to set unset value/tracebacks.

Presume you mean PyErr_NormalizeException(). Okay, didn't know about
that function so will need to look in to it.

> The Log_output function has lots of scary string arithmetic and memory
> allocations.  Wouldn't the various apr_str functions do the trick?

There are no APR functions in Apache 1.3. It doesn't have some
equivalents as ap_ functions but not as many. Also, the apr_ functions
mean you are using the Apache memory pools. I didn't want to use the
memory pools as then the cumulative memory used is held until the end
of the request, whereas using malloc/free means only hold memory for
just the period I need to.

> The if(*msg) in Log_write is redundant since format "s" to
> PyArg_ParseTuple will always fill in the char*.

True. Probably my paranoid programming style and never remembering
that 's' will not pass a None line 'z' will. :-)

> You may find it worthwhile using PyObject_CallFunction instead of
> BuildValue and CallObject.  You have one less thing to track refcounts
> for and one less line of code.

Probably just did it that way as that is what the basic Python
documentation examples use and so have always done that.

> Input_read also has the string arithmetic and memory allocations.  Why
> not use the Python PyString or apr routines for all of those?

No apr routines for similar reasons to log output. I do use PyString
objects for part of it, but only as the final buffer which I use
traditional memory routines to copy into.

> For the various objects that have a request_rec*, I don't see how they
> deal with outliving the request_req.

They don't and since I keep pushing this idea that mod_wsgi is meant
to be as secure and robust as possible to satisfy web hosting
companies, maybe I should.

Strictly speaking though, a WSGI application should not be retaining
references to the WSGI environment, the start_response function or
anything else provided as part of the request. If it does, then it is
incorrect.

> A lot of the config values will accept nonsensical values for booleans
> because the config routines effectively do a caseless compare for "off"
> and treat everything else as on, including "0", "1" etc.  I'd suggest
> tightening that up to only accept the values you want rather than
> anything.  (You know someday someone will make a configuration mistake
> and get unexpected behaviour and take ages to track down that "0" didn't
> actually turn something off or "1" didn't turn it on).

This just follows what all the core Apache modules do, ie., they all
have very loose checking on configuration values for flags.

> > Trying to cache values,
> > especially when they aren't all read only and can be updated by other
> > Apache functions, just makes the job of writing a hand coded wrapper
> > even more work so I don't begrudge the original author for not doing
> > it.
>
> For OOR you just have to stash the Python object pointer somewhere in
> the Apache object and so the pool note functions would work.  I don't
> see anywhere that values are cached, unless you mean something like
> getting the same PyString objects out when setting a setting field.
> That certainly is going too far.

Maybe I misunderstand what you are talking about, or to what level you
are applying it. What I thought you meant is that if one access an
attribute of request_rec, such as content type, that you create a
Python string object and return it, but that you also remember that
Python string instance so the next time content type is access in same
request, that Python string instance which is being held is return
instead of having to create a new one. The problem I saw with doing
this is that calling ap_set_content_type() changes the content type in
the request, and thus you have to know when things like this can
change values so you discard that cache value. I'll have to go back
and reread what you said about OOR.

Anyway, thanks greatly for reviewing my code and commenting on it.
Just about everyone grabs the code and uses it, rather than digging
into what it does and giving any feedback and how to make it better.

Graham
From berwyn at brush.co.nz  Thu May 31 04:45:42 2007
From: berwyn at brush.co.nz (Berwyn Hoyt)
Date: Thu May 31 04:44:51 2007
Subject: [mod_python] ./configure Py_NewInterpreter error
Message-ID: <465E8B2E.1050407@brush.co.nz>

An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070531/30f5d915/attachment.html
From graham.dumpleton at gmail.com  Thu May 31 05:13:14 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu May 31 05:13:21 2007
Subject: [mod_python] ./configure Py_NewInterpreter error
In-Reply-To: <465E8B2E.1050407@brush.co.nz>
References: <465E8B2E.1050407@brush.co.nz>
Message-ID: <88e286470705310213o562ed222i12adfa3a98862699@mail.gmail.com>

Are you sure your have the python-dev 2.5 package installed. It is not
enough to have just the runtime package installed, you must have the
developer package installed as well.

Graham

On 31/05/07, Berwyn Hoyt <berwyn@brush.co.nz> wrote:
>
>  Howdy.
>
>  I'm having trouble building mod_python under debian python2.5 running
> ./configure.  I'm afraid my ./configure figuring-out skills aren't good
> enough to solve it.
>
>  It works fine under python2.4, but not with python2.5.  Below is the output
> from ./configure.  Thanks.
>
>  # ./configure
>  checking for gcc... gcc
>  checking for C compiler default output file name... a.out
>  checking whether the C compiler works... yes
>  checking whether we are cross compiling... no
>  checking for suffix of executables...
>  checking for suffix of object files... o
>  checking whether we are using the GNU C compiler... yes
>  checking whether gcc accepts -g... yes
>  checking for gcc option to accept ANSI C... none needed
>  checking for ar... ar
>  checking for a BSD-compatible install... /usr/bin/install -c
>  checking whether make sets $(MAKE)... yes
>  checking for main in -lm... yes
>  checking for an ANSI C-conforming const... yes
>  checking your blood pressure... a bit high, but we can proceed
>  configure: checking whether apxs is available...
>  checking for --with-apxs... no
>  checking for apxs in /usr/local/apache/sbin... no
>  checking for apxs in your PATH... checking for apxs... no
>  checking for apxs2 in your PATH... checking for apxs2... /usr/bin/apxs2
>  found /usr/bin/apxs2, we'll use this. Use --with-apxs to specify another.
>  checking Apache version... 2.2.3
>  checking for Apache libexec directory... /usr/lib/apache2/modules
>  checking for Apache include directory... -I/usr/include/apache2
>  checking for --with-python... no
>  checking for python... /usr/bin/python
>  checking Python version... 2.5
>  checking Python install prefix... /usr
>  checking checking where python libraries are installed...
> /usr/lib/python2.5
>  checking for Py_NewInterpreter in -lpython2.5... no
>  configure: error: Can not link to python
>
>
> --
>
>
> Berwyn Hoyt, Senior Hardware Engineer: berwyn@brush.co.nz
>  Ph: +64 3 359 2101; Mobile: +64 21 045 7830
>  Brush Technology: www.brush.co.nz
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
From ben at micropledge.com  Thu May 31 05:42:17 2007
From: ben at micropledge.com (Ben Hoyt)
Date: Thu May 31 05:42:24 2007
Subject: [mod_python] mod_python 3.3 importer with "import" statement
In-Reply-To: <7c93bf1e0705310212h5f9a435fga8d8a1cd0ad983b6@mail.gmail.com>
References: <7c93bf1e0705310212h5f9a435fga8d8a1cd0ad983b6@mail.gmail.com>
Message-ID: <7c93bf1e0705310242ia9e991dh26bc831d6151e291@mail.gmail.com>

Skipped content of type multipart/alternative-------------- next part --------------
MOD_PYTHON ERROR

ProcessId:      1120
Interpreter:    'localhost'

ServerName:     'localhost'
DocumentRoot:   'C:/www'

URI:            '/mpledge/code/code.py/'
Location:       None
Directory:      'C:/www/mpledge/code/'
Filename:       'C:/www/mpledge/code/code.py'
PathInfo:       '/'

Phase:          'PythonHandler'
Handler:        'wsgiref.modpython_gateway::handler'

Traceback (most recent call last):

  File "C:\Program Files\Python25\Lib\site-packages\mod_python\importer.py", line 1537, in HandlerDispatch
    default=default_handler, arg=req, silent=hlist.silent)

  File "C:\Program Files\Python25\Lib\site-packages\mod_python\importer.py", line 1229, in _process_target
    result = _execute_target(config, req, object, arg)

  File "C:\Program Files\Python25\Lib\site-packages\mod_python\importer.py", line 1128, in _execute_target
    result = object(arg)

  File "C:\Program Files\Python25\Lib\wsgiref\modpython_gateway.py", line 206, in handler
    module = apache.import_module(modname)

  File "C:\Program Files\Python25\Lib\site-packages\mod_python\importer.py", line 296, in import_module
    log, import_path)

  File "C:\Program Files\Python25\Lib\site-packages\mod_python\importer.py", line 680, in import_module
    execfile(file, module.__dict__)

  File "c:\www\mpledge\code\code.py", line 32, in <module>
    from logic import errors

ImportError: No module named logic


MODULE CACHE DETAILS

Accessed:       Thu May 31 18:09:34 2007
Generation:     0

_mp_92ececbee5435b025841766fae6fc9e3 {
  FileName:     'c:\\www\\mpledge\\code\\code.py'
  Instance:     1 [IMPORT]
  Generation:   0 [ERROR]
  Modified:     Thu May 31 16:53:42 2007
  Children:     'c:\\www\\mpledge\\code\\web.py'
}

_mp_16d4e7379184f5ca0b609e86bcc77a0d {
  FileName:     'c:\\www\\mpledge\\code\\web.py'
  Instance:     1 [IMPORT]
  Generation:   14
  Modified:     Thu May 31 16:52:21 2007
  Imported:     Thu May 31 18:09:34 2007
  Children:     'c:\\www\\mpledge\\code\\web\\__init__.py'
}

_mp_4d82bdef40723094fa9a12ac52105653 {
  FileName:     'c:\\www\\mpledge\\code\\web\\__init__.py'
  Instance:     1 [IMPORT]
  Generation:   13
  Modified:     Thu May 31 16:51:06 2007
  Imported:     Thu May 31 18:09:34 2007
  Children:     'c:\\www\\mpledge\\code\\web\\cheet.py',
                'c:\\www\\mpledge\\code\\web\\db.py',
                'c:\\www\\mpledge\\code\\web\\debugerror.py',
                'c:\\www\\mpledge\\code\\web\\form.py',
                'c:\\www\\mpledge\\code\\web\\http.py',
                'c:\\www\\mpledge\\code\\web\\httpserver.py',
                'c:\\www\\mpledge\\code\\web\\net.py',
                'c:\\www\\mpledge\\code\\web\\request.py',
                'c:\\www\\mpledge\\code\\web\\template.py',
                'c:\\www\\mpledge\\code\\web\\utils.py',
                'c:\\www\\mpledge\\code\\web\\webapi.py',
                'c:\\www\\mpledge\\code\\web\\wsgi.py'
}

_mp_dbef5984e7a5fb65567ee7c2dd9eb8cf {
  FileName:     'c:\\www\\mpledge\\code\\web\\cheet.py'
  Instance:     1 [IMPORT]
  Generation:   12
  Modified:     Thu May 31 16:39:38 2007
  Imported:     Thu May 31 18:09:34 2007
  Children:     'c:\\www\\mpledge\\code\\web\\net.py',
                'c:\\www\\mpledge\\code\\web\\utils.py',
                'c:\\www\\mpledge\\code\\web\\webapi.py'
}

_mp_96ed61fe9c1535f2d1209eec1d925011 {
  FileName:     'c:\\www\\mpledge\\code\\web\\db.py'
  Instance:     1 [IMPORT]
  Generation:   3
  Modified:     Thu May 31 16:39:38 2007
  Imported:     Thu May 31 18:09:34 2007
  Children:     'c:\\www\\mpledge\\code\\web\\utils.py',
                'c:\\www\\mpledge\\code\\web\\webapi.py'
}

_mp_5c9c3e4aa9d6fcb9a5c8376deef30521 {
  FileName:     'c:\\www\\mpledge\\code\\web\\debugerror.py'
  Instance:     1 [IMPORT]
  Generation:   10
  Modified:     Thu May 31 16:39:38 2007
  Imported:     Thu May 31 18:09:34 2007
  Children:     'c:\\www\\mpledge\\code\\web\\net.py',
                'c:\\www\\mpledge\\code\\web\\template.py',
                'c:\\www\\mpledge\\code\\web\\webapi.py'
}

_mp_b5e7d1edaa7c2286c3f6882f4013e153 {
  FileName:     'c:\\www\\mpledge\\code\\web\\form.py'
  Instance:     1 [IMPORT]
  Generation:   11
  Modified:     Thu May 31 16:39:38 2007
  Imported:     Thu May 31 18:09:34 2007
  Children:     'c:\\www\\mpledge\\code\\web\\net.py',
                'c:\\www\\mpledge\\code\\web\\utils.py',
                'c:\\www\\mpledge\\code\\web\\webapi.py'
}

_mp_5cc0e98f40985783e5d75da78dde0eb3 {
  FileName:     'c:\\www\\mpledge\\code\\web\\http.py'
  Instance:     1 [IMPORT]
  Generation:   5
  Modified:     Thu May 31 16:39:38 2007
  Imported:     Thu May 31 18:09:34 2007
  Children:     'c:\\www\\mpledge\\code\\web\\net.py',
                'c:\\www\\mpledge\\code\\web\\utils.py',
                'c:\\www\\mpledge\\code\\web\\webapi.py'
}

_mp_3073a26d3040dbd1ede021ace10c48ab {
  FileName:     'c:\\www\\mpledge\\code\\web\\httpserver.py'
  Instance:     1 [IMPORT]
  Generation:   6
  Modified:     Thu May 31 16:39:38 2007
  Imported:     Thu May 31 18:09:34 2007
  Children:     'c:\\www\\mpledge\\code\\web\\net.py',
                'c:\\www\\mpledge\\code\\web\\webapi.py'
}

_mp_4fc0030bf00a7fec15179cadba720056 {
  FileName:     'c:\\www\\mpledge\\code\\web\\net.py'
  Instance:     1 [IMPORT]
  Generation:   4
  Modified:     Thu May 31 16:39:38 2007
  Imported:     Thu May 31 18:09:34 2007
}

_mp_1920db1f66725c89b0c0b252dd47a570 {
  FileName:     'c:\\www\\mpledge\\code\\web\\request.py'
  Instance:     1 [IMPORT]
  Generation:   8
  Modified:     Thu May 31 16:39:37 2007
  Imported:     Thu May 31 18:09:34 2007
  Children:     'c:\\www\\mpledge\\code\\web\\http.py',
                'c:\\www\\mpledge\\code\\web\\utils.py',
                'c:\\www\\mpledge\\code\\web\\webapi.py',
                'c:\\www\\mpledge\\code\\web\\wsgi.py'
}

_mp_e673157d09ff43a8173d0e4eccca6080 {
  FileName:     'c:\\www\\mpledge\\code\\web\\template.py'
  Instance:     1 [IMPORT]
  Generation:   9
  Modified:     Thu May 31 16:39:38 2007
  Imported:     Thu May 31 18:09:34 2007
  Children:     'c:\\www\\mpledge\\code\\web\\net.py',
                'c:\\www\\mpledge\\code\\web\\utils.py'
}

_mp_eb56e4287ebfaa8f848afb8f55f35bf0 {
  FileName:     'c:\\www\\mpledge\\code\\web\\utils.py'
  Instance:     1 [IMPORT]
  Generation:   1
  Modified:     Thu May 31 16:39:38 2007
  Imported:     Thu May 31 18:09:34 2007
}

_mp_605875b2ae020f0b32a097bf29e232d6 {
  FileName:     'c:\\www\\mpledge\\code\\web\\webapi.py'
  Instance:     1 [IMPORT]
  Generation:   2
  Modified:     Thu May 31 16:39:38 2007
  Imported:     Thu May 31 18:09:34 2007
  Children:     'c:\\www\\mpledge\\code\\web\\utils.py'
}

_mp_238f4eb283bf2f12e098d5e311adad34 {
  FileName:     'c:\\www\\mpledge\\code\\web\\wsgi.py'
  Instance:     1 [IMPORT]
  Generation:   7
  Modified:     Thu May 31 16:39:37 2007
  Imported:     Thu May 31 18:09:34 2007
  Children:     'c:\\www\\mpledge\\code\\web\\http.py',
                'c:\\www\\mpledge\\code\\web\\httpserver.py',
                'c:\\www\\mpledge\\code\\web\\net.py',
                'c:\\www\\mpledge\\code\\web\\utils.py',
                'c:\\www\\mpledge\\code\\web\\webapi.py'
}

From ben at micropledge.com  Thu May 31 05:46:45 2007
From: ben at micropledge.com (Ben Hoyt)
Date: Thu May 31 05:46:52 2007
Subject: [mod_python] mod_python 3.3 importer with "import" statement
In-Reply-To: <7c93bf1e0705310242ia9e991dh26bc831d6151e291@mail.gmail.com>
References: <7c93bf1e0705310212h5f9a435fga8d8a1cd0ad983b6@mail.gmail.com>
	<7c93bf1e0705310242ia9e991dh26bc831d6151e291@mail.gmail.com>
Message-ID: <7c93bf1e0705310246q2a53ce2aj2a353aa491e5ccaf@mail.gmail.com>

OOPS -- I wasn't supposed to attach that file to that post. I'll try again.
:-)

Hi guys,

We're starting a web site running on mod_python, and we've run into import
problems, specifically using

from DIR import FILE

apache.import_modulewhere DIR is a directory (not a module or package) and
file is a FILE.py file. It works with standard Python importing, but now
that we have multiple virtual servers, we need to use, but we can't quite.

Here's the long gory story:
---------------------

Up till now we've just been using the standard import statement, and it's
worked fine. But now we're running two copies of our Python code-base on two
virtual servers. So there are two files called " code.py" and suchlike in
two different directories, and the imports get confused if the two are out
of sync. All as the docs explain ... because of how sys.modules is stored
without full paths.

So I've just been trying to use the new apache.import_module(), but I'm
running into various problems because we have multiple directories in our
code structure, which looks something like this:

code/
code/code.py  # main file for mod_python usage, imports everything
code/cli.py  # command line "test harness" loader
code/logic/dbase.py
code/logic/errors.py
code/handlers/home.py
code/handlers/users.py
...  # and heaps more files in each of the subdirs

"logic" and "handlers" aren't actual packages, so we thought we'd be okay
using apache.import_module() on code.py, and all the import statements
scattered throughout the code would just work (am I correct in this? if the
top-level import uses import_module, the rest will automatically?).
code.pyis actually run by modpython_gateway.py, a WSGI wrapper for
mod_python that
we modified to use import_module instead of __import__.

But the problem is that it bombs out on statements like:

from logic import errors

with "ImportError: No module named logic"

I guess this is because logic isn't a file/module, it's a directory. Is this
correct? (In .htaccess, I have PythonOption mod_python.importer.path
"['c:/www/mpledge/code']" so it definitely knows where to go, but the import
statement fallback probably doesn't. It won't help if we set sys.path,
because then we're back to the old import problems.)

In short, we're wondering the best way forward using mod_python. The options
we see are:

1) Only ever run one code base. Non-ideal.

2) Override __builtin__.__import__ with our own one that checks if it's a
directory and calls your import_module on the result, e.g.,
import_module('logic/errors'). Would this work?

3) Write a patch to modpython's import_module that adds that functionality.
But I'm guessing there's some good reason it doesn't support this -- is that
correct?

4) Change all our import statements to import_module calls. We have a lot of
them in different forms, so this would be messy. Particularly because we
want it to work in test/command-line mode too. And at the moment with import
statements it works just as well from Apache with code.py and from the
command line with "python -i cli.py". So we'd have to do if/else conditions
around all the imports, for whether it's in cli/test mode or not.

5) Look into FastCGI or something ... but we're not sure we want to go there
at this stage.

Oh, and one more thing, we're also using Cheetah, so I guess we'll have to
change its __import__s to import_module calls too...

What do you think is the best way?

Thanks for your time!

-Ben

P. S. Feel free to check out the "early page" for our website (
http://micropledge.com/). Hopefully we won't be upgrading mod_python or
something when you look. :-)

-- 
Ben Hoyt, +64 21 331 841
http://www.benhoyt.com/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070531/78182dc9/attachment.html
From graham.dumpleton at gmail.com  Thu May 31 06:07:11 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu May 31 06:07:16 2007
Subject: [mod_python] mod_python 3.3 importer with "import" statement
In-Reply-To: <7c93bf1e0705310242ia9e991dh26bc831d6151e291@mail.gmail.com>
References: <7c93bf1e0705310212h5f9a435fga8d8a1cd0ad983b6@mail.gmail.com>
	<7c93bf1e0705310242ia9e991dh26bc831d6151e291@mail.gmail.com>
Message-ID: <88e286470705310307h781cc2a7t2fa9ee9d9df5e93a@mail.gmail.com>

On 31/05/07, Ben Hoyt <ben@micropledge.com> wrote:
> Hi guys,
>
> We're starting a web site running on mod_python, and we've run into import
> problems, specifically using
>
> from DIR import FILE
>
>  apache.import_modulewhere DIR is a directory (not a module or package) and
> file is a FILE.py file. It works with standard Python importing, but now
> that we have multiple virtual servers, we need to use, but we can't quite.
>
> Here's the long gory story:
> ---------------------
>
> Up till now we've just been using the standard import statement, and it's
> worked fine. But now we're running two copies of our Python code-base on two
> virtual servers. So there are two files called " code.py" and suchlike in
> two different directories, and the imports get confused if the two are out
> of sync. All as the docs explain ... because of how sys.modules is stored
> without full paths.

By default VirtualHosts use distinct Python interpreter instances.
Thus, unless you have explicitly set PythonInterpreter explicitly so
the same interpreters is used for both hosts there shouldn't be a
problem if the two virtual hosts use the same module/package name but
different versions obtained from different sys.path directories.

> So I've just been trying to use the new apache.import_module(), but I'm
> running into various problems because we have multiple directories in our
> code structure, which looks something like this:
>
> code/
> code/code.py  # main file for mod_python usage, imports everything
> code/cli.py  # command line "test harness" loader
> code/logic/dbase.py
> code/logic/errors.py
> code/handlers/home.py
> code/handlers/users.py
> ...  # and heaps more files in each of the subdirs
>
> "logic" and "handlers" aren't actual packages, so we thought we'd be okay
> using apache.import_module() on code.py, and all the import statements
> scattered throughout the code would just work (am I correct in this? if the
> top-level import uses import_module, the rest will automatically?). code.py
> is actually run by modpython_gateway.py, a WSGI wrapper for mod_python that
> we modified to use import_module instead of __import__.
>
> But the problem is that it bombs out on statements like:
>
> from logic import errors
>
> with "ImportError: No module named logic"
>
> I guess this is because logic isn't a file/module, it's a directory. Is this
> correct? (In .htaccess, I have PythonOption mod_python.importer.path
> "['c:/www/mpledge/code']" so it definitely knows where to go, but the import
> statement fallback probably doesn't. It won't help if we set sys.path,
> because then we're back to the old import problems.)
>
> In short, we're wondering the best way forward using mod_python. The options
> we see are:
>
> 1) Only ever run one code base. Non-ideal.
>
>  2) Override __builtin__.__import__ with our own one that checks if it's a
> directory and calls your import_module on the result, e.g.,
> import_module('logic/errors'). Would this work?

Overriding import is more complicated than just replacing __import__. ;-)

> 3) Write a patch to modpython's import_module that adds that functionality.
> But I'm guessing there's some good reason it doesn't support this -- is that
> correct?

It wasn't possible to support true Python packages. But then, as
documented apache.import_module() does support pseudo packages using
relative paths. I cant remember why I didn't support the pseudo
packages through import, most likely because the __init__.py file if
it did exist wouldn't get imported and as a result felt that that
might confuse users.

> 4) Change all our import statements to import_module calls. We have a lot of
> them in different forms, so this would be messy. Particularly because we
> want it to work in test/command-line mode too. And at the moment with import
> statements it works just as well from Apache with code.py and from the
> command line with "python -i cli.py". So we'd have to do if/else conditions
> around all the imports, for whether it's in cli/test mode or not.
>
> 5) Look into FastCGI or something ... but we're not sure we want to go there
> at this stage.

I'd suggest other things before that, maybe mod_wsgi perhaps. :-)

> Oh, and one more thing, we're also using Cheetah, so I guess we'll have to
> change its __import__s to import_module calls too...
>
>  What do you think is the best way?

Since your application is designed for WSGI, I would recommend against
using any features which are specific to the mod_python module
importer, whether that be implicit or explicit. The reason for that is
that by doing so your application would then no longer be portable to
other WSGI hosting solutions which cause you more work if you want to
change later. I do acknowledge though that by making it a portable
WSGI application, you have to give up automatic module reloading and
thus would have to restart Apache whenever changes are made.

That said, to make it a portable WSGI application, you would just need
to turn your whole collection of modules into a package. The
__init__.py files can though be all empty. Thus:

micropledge/

micropledge/__init__.py
micropledge/code.py  # main file for mod_python usage, imports everything
micropledge/cli.py  # command line "test harness" loader

micropledge/logic/__init__.py
micropledge/logic/dbase.py
micropledge/logic/errors.py

micropledge/handlers/__init__.py
micropledge/handlers/home.py
micropledge/handlers/users.py

By being a package everything is then using a full dotted path. For
example 'micropledge.logic.errors'. Thus same module name in separate
subdirectories of the one package not a problem.

As for keeping the different versions in different virtual hosts
separate, the use of distinct Python sub interpreters should manage
that as long as the sys.path in each only refers to its own version
and not that of the other virtual host.

Thus, in the first instance, would be investigating why your virtual
hosts would be using the same Python sub interpreter.

Graham
From steino at ccri.net  Thu May 31 11:37:29 2007
From: steino at ccri.net (Olaf Stein)
Date: Thu May 31 11:37:57 2007
Subject: [mod_python] Book or other documentation
Message-ID: <C28463F9.2F5A%steino@ccri.net>

Hi All,

Does anyone know of a book dedicated to either mod_python itself, or a good
book about apache that maybe covers mod_python somewhat in depth. It seems
that everything I find in the net covers the same, simple first steps.

Links to other sources are also appreciated.


Thanks
Olaf


From administrator at leebrown.org  Thu May 31 12:41:47 2007
From: administrator at leebrown.org (Lee Brown)
Date: Thu May 31 12:41:45 2007
Subject: [mod_python] XSLT and mod_python
In-Reply-To: <200705231716.05231.richardlewis@fastmail.co.uk>
References: <B6C73A5E30565245BB6D32B5F5DF7A52120376@sense.emmastraat.pijnacker>
	<200705231716.05231.richardlewis@fastmail.co.uk>
Message-ID: <020101c7a3a2$953cfce0$0301a8c0@uberbox>

Greetings!

With regard to LXML and mod_python, xsl:import works as advertised; the
problem is that errors thrown by the underlying libxslt library aren't
apparent unless mod_python is run with debug turned on.

Best Regards,
Lee E. Brown
(administrator@leebrown.org)

-----Original Message-----
From: mod_python-bounces@modpython.org
[mailto:mod_python-bounces@modpython.org] On Behalf Of Richard Lewis
Sent: Wednesday, May 23, 2007 12:16 PM
To: mod_python@modpython.org
Subject: Re: [mod_python] XSLT and mod_python

...The only problem I've had with it is, I /think/, that its causing
crashing of the mod_python's Python interpreter when you use <xsl:import />.
As I said, I /think/ this is what's causing these crashes, but I'm not sure
yet.


From gambit at alpenjodel.de  Thu May 31 14:10:19 2007
From: gambit at alpenjodel.de (Gambit)
Date: Thu May 31 14:50:20 2007
Subject: [mod_python] Sending text/xml in a POST request gives "501 Method
	not implemented"
Message-ID: <f3n2ou$rle$1@sea.gmane.org>

Hello,

I'm trying to make my mod_python (publisher) based application to talk 
with a service provider who requires me to accept incoming POST request 
with text/xml as Content Type and some XML as the content of the 
request. However these requests are killed by Apache with a 501 "Method 
not implemented" error before they reach my app.

I've been unable to find any information on this issue anywhere. Is my 
Apache misconfigured or perhaps should I provide my own implementation 
of XML over http to Apache and if so how?

Any ideas?

Full error follows:

 > POST /mytest HTTP/1.1
 > User-Agent: curl/7.16.0 (i386-portbld-freebsd6.1) libcurl/7.16.0 
OpenSSL/0.9.7e zlib/1.2.2
 > Host: mydomain.com
 > Accept: */*
 > Content-Type: text/xml
 > Content-Length: 100
 >
< HTTP/1.1 501 Method Not Implemented
< Date: Thu, 31 May 2007 18:01:38 GMT
< Server: Apache/2.0.54 (Fedora) DAV/2 FrontPage/5.0.2.2635 mod_jk/1.2.6 
mod_python/3.1.4 Python/2.4.3 mod_ssl/2.0.54 OpenSSL/0.9.7f 
mod_perl/2.0.1 Perl/v5.8.6
< Allow: GET,HEAD,POST,TRACE
< Content-Length: 217
< Connection: close
< Content-Type: text/html; charset=iso-8859-1
* Closing connection #0
<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN">
<html><head>
<title>501 Method Not Implemented</title>
</head><body>
<h1>Method Not Implemented</h1>
<p>POST to /fundbyphone not supported.<br />
</p>
</body></html>

From graham.dumpleton at gmail.com  Thu May 31 18:14:47 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu May 31 18:14:53 2007
Subject: [mod_python] Sending text/xml in a POST request gives "501 Method
	not implemented"
In-Reply-To: <f3n2ou$rle$1@sea.gmane.org>
References: <f3n2ou$rle$1@sea.gmane.org>
Message-ID: <88e286470705311514i612089fapc00d2bf5328062d4@mail.gmail.com>

On 01/06/07, Gambit <gambit@alpenjodel.de> wrote:
> Hello,
>
> I'm trying to make my mod_python (publisher) based application to talk
> with a service provider who requires me to accept incoming POST request
> with text/xml as Content Type and some XML as the content of the
> request. However these requests are killed by Apache with a 501 "Method
> not implemented" error before they reach my app.
>
> I've been unable to find any information on this issue anywhere.

Is documented here:

  https://issues.apache.org/jira/browse/MODPYTHON-29

> Is my
> Apache misconfigured or perhaps should I provide my own implementation
> of XML over http to Apache and if so how?

No.

> Any ideas?

Some hackish workarounds have been described on the mailing list
before, but would have to think about what can reasonably done again.

Graham
From gambit at alpenjodel.de  Thu May 31 19:26:25 2007
From: gambit at alpenjodel.de (Gambit)
Date: Thu May 31 19:32:52 2007
Subject: [mod_python] Re: Sending text/xml in a POST request gives "501
	Method not implemented"
In-Reply-To: <88e286470705311514i612089fapc00d2bf5328062d4@mail.gmail.com>
References: <f3n2ou$rle$1@sea.gmane.org>
	<88e286470705311514i612089fapc00d2bf5328062d4@mail.gmail.com>
Message-ID: <f3nl9j$tnr$1@sea.gmane.org>

Thanks for the information. This is very helpful, too bad it is bad news.

It seems this is related to the publisher handler rather than either 
Apache or mod_python so I guess it could be possible to write my own 
handler to allow this (which I've never done before, the publisher has 
been good enough to me, until now.)

But... perhaps someone else has already written a custom handler for 
these purposes?

Otherwise I guess I'll have to run a separate process to accept those 
requests, perhaps using Python's BaseHTTPServer...

Regards,

From graham.dumpleton at gmail.com  Thu May 31 19:43:56 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu May 31 19:44:02 2007
Subject: [mod_python] Re: Sending text/xml in a POST request gives "501
	Method not implemented"
In-Reply-To: <f3nl9j$tnr$1@sea.gmane.org>
References: <f3n2ou$rle$1@sea.gmane.org>
	<88e286470705311514i612089fapc00d2bf5328062d4@mail.gmail.com>
	<f3nl9j$tnr$1@sea.gmane.org>
Message-ID: <88e286470705311643w57b64086n291e616ffd7f36e5@mail.gmail.com>

On 01/06/07, Gambit <gambit@alpenjodel.de> wrote:
> Thanks for the information. This is very helpful, too bad it is bad news.
>
> It seems this is related to the publisher handler rather than either
> Apache or mod_python so I guess it could be possible to write my own
> handler to allow this (which I've never done before, the publisher has
> been good enough to me, until now.)
>
> But... perhaps someone else has already written a custom handler for
> these purposes?
>
> Otherwise I guess I'll have to run a separate process to accept those
> requests, perhaps using Python's BaseHTTPServer...

There is no need to use a separate process. Do something like:

  <Location /path/to/xml/consumer>
  SetHandler mod_python
  PythonHandler ~/some/path/to/handler/module.py
  </Location>

If not using mod_python 3.3, the handler would need to refer by module
name rather than path.

You could then write a custom handler of your own for processing just
the post request and still use publisher for everything else.

Graham
From graham.dumpleton at gmail.com  Thu May 31 20:15:58 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu May 31 20:16:04 2007
Subject: [mod_python] ./configure Py_NewInterpreter error & can't import
	permissions & gnu-gcc executable name
In-Reply-To: <465F621B.7070407@pharos.co.nz>
References: <465E8B2E.1050407@brush.co.nz>
	<88e286470705310213o562ed222i12adfa3a98862699@mail.gmail.com>
	<465F621B.7070407@pharos.co.nz>
Message-ID: <88e286470705311715j7a146bd4i69d42283fbd23128@mail.gmail.com>

On 01/06/07, Berwyn Hoyt <berwyn@pharos.co.nz> wrote:
> Ah thanks, Graham.  That solved the Py_NewInterpreter error.
>
> There were a couple of other problems with make which I also had to
> solve.  I'll list them here in case you think any of them need to be
> addressed in the make script:
>
> # For make to work, I had to do this as for some reason
> i486-linux-gnu-gcc didn't exist.  I'm running debian sarge.
> ln -s /usr/bin/i486-linux-gnu-gcc-3.3 /usr/bin/i486-linux-gnu-gcc

That is some problem with your system nothing mod_python can do to fix that. :-)

> #these worked fine:
> make
> make install
>
> #Before I could import mod_python as a normal user, I had to do this:
> chmod ugo+rX  /usr/lib/python2.4/site-packages/mod_python -R
> chmod ugo+rwx /usr/lib/python2.4/site-packages/mod_python/*.py

The umask of the account you used to perform the build/installation is
probably too restrictive. A better umask for the account may be:

  umask 0022

BTW, you should not be giving o+w to the .py file as anyone could then
edit them. Not good considering that Apache when started as root
imports some of those modules as root. Ie., arbitrary person could add
in code which would then execute as root.

Graham

> Cheers,
> Berwyn
>
> Graham Dumpleton wrote:
> > Are you sure your have the python-dev 2.5 package installed. It is not
> > enough to have just the runtime package installed, you must have the
> > developer package installed as well.
> >
> > Graham
> >
> > On 31/05/07, Berwyn Hoyt <berwyn@brush.co.nz> wrote:
> >>
> >>  Howdy.
> >>
> >>  I'm having trouble building mod_python under debian python2.5 running
> >> ./configure.  I'm afraid my ./configure figuring-out skills aren't good
> >> enough to solve it.
> >>
> >>  It works fine under python2.4, but not with python2.5.  Below is the
> >> output
> >> from ./configure.  Thanks.
> >>
> >>  # ./configure
> >>  checking for gcc... gcc
> >>  checking for C compiler default output file name... a.out
> >>  checking whether the C compiler works... yes
> >>  checking whether we are cross compiling... no
> >>  checking for suffix of executables...
> >>  checking for suffix of object files... o
> >>  checking whether we are using the GNU C compiler... yes
> >>  checking whether gcc accepts -g... yes
> >>  checking for gcc option to accept ANSI C... none needed
> >>  checking for ar... ar
> >>  checking for a BSD-compatible install... /usr/bin/install -c
> >>  checking whether make sets $(MAKE)... yes
> >>  checking for main in -lm... yes
> >>  checking for an ANSI C-conforming const... yes
> >>  checking your blood pressure... a bit high, but we can proceed
> >>  configure: checking whether apxs is available...
> >>  checking for --with-apxs... no
> >>  checking for apxs in /usr/local/apache/sbin... no
> >>  checking for apxs in your PATH... checking for apxs... no
> >>  checking for apxs2 in your PATH... checking for apxs2... /usr/bin/apxs2
> >>  found /usr/bin/apxs2, we'll use this. Use --with-apxs to specify
> >> another.
> >>  checking Apache version... 2.2.3
> >>  checking for Apache libexec directory... /usr/lib/apache2/modules
> >>  checking for Apache include directory... -I/usr/include/apache2
> >>  checking for --with-python... no
> >>  checking for python... /usr/bin/python
> >>  checking Python version... 2.5
> >>  checking Python install prefix... /usr
> >>  checking checking where python libraries are installed...
> >> /usr/lib/python2.5
> >>  checking for Py_NewInterpreter in -lpython2.5... no
> >>  configure: error: Can not link to python
> >>
> >>
> >> --
> >>
> >>
> >> Berwyn Hoyt, Senior Hardware Engineer: berwyn@brush.co.nz
> >>  Ph: +64 3 359 2101; Mobile: +64 21 045 7830
> >>  Brush Technology: www.brush.co.nz
> >>
> >> _______________________________________________
> >> Mod_python mailing list
> >> Mod_python@modpython.org
> >> http://mailman.modpython.org/mailman/listinfo/mod_python
> >>
> >>
> >
>
From berwyn at brush.co.nz  Thu May 31 20:22:20 2007
From: berwyn at brush.co.nz (Berwyn Hoyt)
Date: Thu May 31 20:21:33 2007
Subject: [mod_python] ./configure Py_NewInterpreter error & can't import
	permissions & gnu-gcc executable name
In-Reply-To: <88e286470705311715j7a146bd4i69d42283fbd23128@mail.gmail.com>
References: <465E8B2E.1050407@brush.co.nz>	<88e286470705310213o562ed222i12adfa3a98862699@mail.gmail.com>	<465F621B.7070407@pharos.co.nz>
	<88e286470705311715j7a146bd4i69d42283fbd23128@mail.gmail.com>
Message-ID: <465F66B1.7060608@brush.co.nz>

An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070601/a97b1279/attachment-0001.html
