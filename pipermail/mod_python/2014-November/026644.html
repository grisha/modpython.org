<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] TimeOut and mp_conn.read (pywebsocket)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=Re%3A%20%5Bmod_python%5D%20TimeOut%20and%20mp_conn.read%20%28pywebsocket%29&In-Reply-To=%3CCAHb_syvf7YJmUATGynfmSDG9xQ_jG_vAzOSxQsRjBaOAUUTzMw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026643.html">
   <LINK REL="Next"  HREF="026645.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] TimeOut and mp_conn.read (pywebsocket)</H1>
    <B>Grisha Trubetskoy</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=Re%3A%20%5Bmod_python%5D%20TimeOut%20and%20mp_conn.read%20%28pywebsocket%29&In-Reply-To=%3CCAHb_syvf7YJmUATGynfmSDG9xQ_jG_vAzOSxQsRjBaOAUUTzMw%40mail.gmail.com%3E"
       TITLE="[mod_python] TimeOut and mp_conn.read (pywebsocket)">grisha at modpython.org
       </A><BR>
    <I>Mon Nov  3 18:26:38 UTC 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="026643.html">[mod_python] TimeOut and mp_conn.read (pywebsocket)
</A></li>
        <LI>Next message: <A HREF="026645.html">[mod_python] TimeOut and mp_conn.read (pywebsocket)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26644">[ date ]</a>
              <a href="thread.html#26644">[ thread ]</a>
              <a href="subject.html#26644">[ subject ]</a>
              <a href="author.html#26644">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>That seems weird... I'd look for other causes for this - e.g. use something
like tcpdump to see whether the TCP connection is closed from either end
when it returns?

On Mon, Nov 3, 2014 at 11:32 AM, Bram Van Steenlandt &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">bram at diomedia.be</A>&gt;
wrote:

&gt;<i>  Hi Grisha,
</I>&gt;<i>
</I>&gt;<i> ws_stream is the websocket part created by pywebsocket.
</I>&gt;<i>
</I>&gt;<i> In the pywebsocket code it looks like this (_stream_hixie75.py):
</I>&gt;<i>
</I>&gt;<i>         while True:
</I>&gt;<i>             # Read 1 byte.
</I>&gt;<i>             # mp_conn.read will block if no bytes are available.
</I>&gt;<i>             # Timeout is controlled by TimeOut directive of Apache.
</I>&gt;<i>             frame_type_str = self.receive_bytes(1)
</I>&gt;<i>
</I>&gt;<i> self.receive_bytes seems to use:
</I>&gt;<i> read_bytes = self._request.connection.read(length)
</I>&gt;<i>
</I>&gt;<i> Which seems to be:
</I>&gt;<i>  connection.read([*length*])
</I>&gt;<i>
</I>&gt;<i> Reads at most *length* bytes from the client. The read blocks
</I>&gt;<i> indefinitely until there is at least one byte to read. If length is -1,
</I>&gt;<i> keep reading until the socket is closed from the other end (This is known
</I>&gt;<i> as EXHAUSTIVE mode in the http server code).
</I>&gt;<i>
</I>&gt;<i> but Timeout is 60 in apache and the function returns after 1 second if
</I>&gt;<i> there are no bytes to receive.
</I>&gt;<i>
</I>&gt;<i> Bram
</I>&gt;<i> op 03-11-14 16:59, Grisha Trubetskoy schreef:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>  Bram
</I>&gt;<i>
</I>&gt;<i>  What is ws_stream?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>  Grisha
</I>&gt;<i>
</I>&gt;<i> On Mon, Nov 3, 2014 at 9:24 AM, Bram Van Steenlandt &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">bram at diomedia.be</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Hi all,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I've developed a websocket application using mod_python and pywebsocket.
</I>&gt;&gt;<i> It works but I have a problem (I'm using apache22 and mod_python 3.3.1
</I>&gt;&gt;<i> and python 2.6.6).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I'm using request.ws_stream.receive_message() to see if there are
</I>&gt;&gt;<i> messages from the client,
</I>&gt;&gt;<i> this works but always takes one second (between 0.99 and 1.05), I need
</I>&gt;&gt;<i> it to return faster (esp. when there is no message most of the time).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This is suppose to be controlled by the TimeOut config value in apache
</I>&gt;&gt;<i> but this is set to 60... (req.server.timeout is also 60)
</I>&gt;&gt;<i> I would think that the function returns after 60 seconds and not 1 when
</I>&gt;&gt;<i> there is no data, is there another timeout I'm missing ?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Can someone point me in the right direction ?
</I>&gt;&gt;<i> I there a way to set this from inside handler like with regular sockets ?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The pywebsocket package does include a way to work with a
</I>&gt;&gt;<i> messagereceiver (here receiving is done in a thread),
</I>&gt;&gt;<i> this works but it's difficult to debug, I think I would prefer a shorter
</I>&gt;&gt;<i> timeout.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thx
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> mod_python mailing list
</I>&gt;&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python at modpython.org</A>
</I>&gt;&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://mailman.modpython.org/pipermail/mod_python/attachments/20141103/84540e7a/attachment.html">http://mailman.modpython.org/pipermail/mod_python/attachments/20141103/84540e7a/attachment.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026643.html">[mod_python] TimeOut and mp_conn.read (pywebsocket)
</A></li>
	<LI>Next message: <A HREF="026645.html">[mod_python] TimeOut and mp_conn.read (pywebsocket)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26644">[ date ]</a>
              <a href="thread.html#26644">[ thread ]</a>
              <a href="subject.html#26644">[ subject ]</a>
              <a href="author.html#26644">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the mod_python
mailing list</a><br>
</body></html>
