<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] TimeOut and mp_conn.read (pywebsocket)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=Re%3A%20%5Bmod_python%5D%20TimeOut%20and%20mp_conn.read%20%28pywebsocket%29&In-Reply-To=%3C5457AE21.5030405%40diomedia.be%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026642.html">
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] TimeOut and mp_conn.read (pywebsocket)</H1>
    <B>Bram Van Steenlandt</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=Re%3A%20%5Bmod_python%5D%20TimeOut%20and%20mp_conn.read%20%28pywebsocket%29&In-Reply-To=%3C5457AE21.5030405%40diomedia.be%3E"
       TITLE="[mod_python] TimeOut and mp_conn.read (pywebsocket)">bram at diomedia.be
       </A><BR>
    <I>Mon Nov  3 16:32:33 UTC 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="026642.html">[mod_python] TimeOut and mp_conn.read (pywebsocket)
</A></li>
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26643">[ date ]</a>
              <a href="thread.html#26643">[ thread ]</a>
              <a href="subject.html#26643">[ subject ]</a>
              <a href="author.html#26643">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Grisha,

ws_stream is the websocket part created by pywebsocket.

In the pywebsocket code it looks like this (_stream_hixie75.py):

        while True:
            # Read 1 byte.
            # mp_conn.read will block if no bytes are available.
            # Timeout is controlled by TimeOut directive of Apache.
            frame_type_str = self.receive_bytes(1)

self.receive_bytes seems to use:
read_bytes = self._request.connection.read(length)

Which seems to be:

connection.read([/length/])

    Reads at most /length/ bytes from the client. The read blocks
    indefinitely until there is at least one byte to read. If length is
    -1, keep reading until the socket is closed from the other end (This
    is known as EXHAUSTIVE mode in the http server code).


but Timeout is 60 in apache and the function returns after 1 second if
there are no bytes to receive.

Bram
op 03-11-14 16:59, Grisha Trubetskoy schreef:
&gt;<i>
</I>&gt;<i> Bram
</I>&gt;<i>
</I>&gt;<i> What is ws_stream?
</I>&gt;<i>
</I>&gt;<i> Grisha
</I>&gt;<i>
</I>&gt;<i> On Mon, Nov 3, 2014 at 9:24 AM, Bram Van Steenlandt &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">bram at diomedia.be</A>
</I>&gt;<i> &lt;mailto:<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">bram at diomedia.be</A>&gt;&gt; wrote:
</I>&gt;<i>
</I>&gt;<i>     Hi all,
</I>&gt;<i>
</I>&gt;<i>     I've developed a websocket application using mod_python and
</I>&gt;<i>     pywebsocket.
</I>&gt;<i>     It works but I have a problem (I'm using apache22 and mod_python 3.3.1
</I>&gt;<i>     and python 2.6.6).
</I>&gt;<i>
</I>&gt;<i>     I'm using request.ws_stream.receive_message() to see if there are
</I>&gt;<i>     messages from the client,
</I>&gt;<i>     this works but always takes one second (between 0.99 and 1.05), I need
</I>&gt;<i>     it to return faster (esp. when there is no message most of the time).
</I>&gt;<i>
</I>&gt;<i>     This is suppose to be controlled by the TimeOut config value in apache
</I>&gt;<i>     but this is set to 60... (req.server.timeout is also 60)
</I>&gt;<i>     I would think that the function returns after 60 seconds and not 1
</I>&gt;<i>     when
</I>&gt;<i>     there is no data, is there another timeout I'm missing ?
</I>&gt;<i>
</I>&gt;<i>     Can someone point me in the right direction ?
</I>&gt;<i>     I there a way to set this from inside handler like with regular
</I>&gt;<i>     sockets ?
</I>&gt;<i>
</I>&gt;<i>     The pywebsocket package does include a way to work with a
</I>&gt;<i>     messagereceiver (here receiving is done in a thread),
</I>&gt;<i>     this works but it's difficult to debug, I think I would prefer a
</I>&gt;<i>     shorter
</I>&gt;<i>     timeout.
</I>&gt;<i>
</I>&gt;<i>     Thx
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>     _______________________________________________
</I>&gt;<i>     mod_python mailing list
</I>&gt;<i>     <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python at modpython.org</A> &lt;mailto:<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python at modpython.org</A>&gt;
</I>&gt;<i>     <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i>
</I>&gt;<i>
</I>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://mailman.modpython.org/pipermail/mod_python/attachments/20141103/ff8507ec/attachment.html">http://mailman.modpython.org/pipermail/mod_python/attachments/20141103/ff8507ec/attachment.html</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026642.html">[mod_python] TimeOut and mp_conn.read (pywebsocket)
</A></li>
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26643">[ date ]</a>
              <a href="thread.html#26643">[ thread ]</a>
              <a href="subject.html#26643">[ subject ]</a>
              <a href="author.html#26643">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the mod_python
mailing list</a><br>
</body></html>
