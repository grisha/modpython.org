<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] TimeOut and mp_conn.read (pywebsocket)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=Re%3A%20%5Bmod_python%5D%20TimeOut%20and%20mp_conn.read%20%28pywebsocket%29&In-Reply-To=%3C5457D254.5050900%40diomedia.be%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026644.html">
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] TimeOut and mp_conn.read (pywebsocket)</H1>
    <B>Bram Van Steenlandt</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=Re%3A%20%5Bmod_python%5D%20TimeOut%20and%20mp_conn.read%20%28pywebsocket%29&In-Reply-To=%3C5457D254.5050900%40diomedia.be%3E"
       TITLE="[mod_python] TimeOut and mp_conn.read (pywebsocket)">bram at diomedia.be
       </A><BR>
    <I>Mon Nov  3 19:07:00 UTC 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="026644.html">[mod_python] TimeOut and mp_conn.read (pywebsocket)
</A></li>
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26645">[ date ]</a>
              <a href="thread.html#26645">[ thread ]</a>
              <a href="subject.html#26645">[ subject ]</a>
              <a href="author.html#26645">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

The connection remains open for many hours at a time.

it's something like:
while True:
     msg = request.ws_stream.receive_message()
     if msg==&quot;SOMETHING&quot;:
         do other stuff, the client has asked something, maybe send a 
json string to the client, maybe send a command to another program

Thx for your input
Bram


op 03-11-14 19:26, Grisha Trubetskoy schreef:
&gt;<i> That seems weird... I'd look for other causes for this - e.g. use 
</I>&gt;<i> something like tcpdump to see whether the TCP connection is closed 
</I>&gt;<i> from either end when it returns?
</I>&gt;<i>
</I>&gt;<i> On Mon, Nov 3, 2014 at 11:32 AM, Bram Van Steenlandt &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">bram at diomedia.be</A> 
</I>&gt;<i> &lt;mailto:<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">bram at diomedia.be</A>&gt;&gt; wrote:
</I>&gt;<i>
</I>&gt;<i>     Hi Grisha,
</I>&gt;<i>
</I>&gt;<i>     ws_stream is the websocket part created by pywebsocket.
</I>&gt;<i>
</I>&gt;<i>     In the pywebsocket code it looks like this (_stream_hixie75.py):
</I>&gt;<i>
</I>&gt;<i>             while True:
</I>&gt;<i>                 # Read 1 byte.
</I>&gt;<i>                 # mp_conn.read will block if no bytes are available.
</I>&gt;<i>                 # Timeout is controlled by TimeOut directive of Apache.
</I>&gt;<i>                 frame_type_str = self.receive_bytes(1)
</I>&gt;<i>
</I>&gt;<i>     self.receive_bytes seems to use:
</I>&gt;<i>     read_bytes = self._request.connection.read(length)
</I>&gt;<i>
</I>&gt;<i>     Which seems to be:
</I>&gt;<i>
</I>&gt;<i>     connection.read([/length/])
</I>&gt;<i>
</I>&gt;<i>         Reads at most /length/ bytes from the client. The read blocks
</I>&gt;<i>         indefinitely until there is at least one byte to read. If
</I>&gt;<i>         length is -1, keep reading until the socket is closed from the
</I>&gt;<i>         other end (This is known as EXHAUSTIVE mode in the http server
</I>&gt;<i>         code).
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>     but Timeout is 60 in apache and the function returns after 1
</I>&gt;<i>     second if there are no bytes to receive.
</I>&gt;<i>
</I>&gt;<i>     Bram
</I>&gt;<i>     op 03-11-14 16:59, Grisha Trubetskoy schreef:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     Bram
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     What is ws_stream?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     Grisha
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     On Mon, Nov 3, 2014 at 9:24 AM, Bram Van Steenlandt
</I>&gt;&gt;<i>     &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">bram at diomedia.be</A> &lt;mailto:<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">bram at diomedia.be</A>&gt;&gt; wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         Hi all,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         I've developed a websocket application using mod_python and
</I>&gt;&gt;<i>         pywebsocket.
</I>&gt;&gt;<i>         It works but I have a problem (I'm using apache22 and
</I>&gt;&gt;<i>         mod_python 3.3.1
</I>&gt;&gt;<i>         and python 2.6.6).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         I'm using request.ws_stream.receive_message() to see if there are
</I>&gt;&gt;<i>         messages from the client,
</I>&gt;&gt;<i>         this works but always takes one second (between 0.99 and
</I>&gt;&gt;<i>         1.05), I need
</I>&gt;&gt;<i>         it to return faster (esp. when there is no message most of
</I>&gt;&gt;<i>         the time).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         This is suppose to be controlled by the TimeOut config value
</I>&gt;&gt;<i>         in apache
</I>&gt;&gt;<i>         but this is set to 60... (req.server.timeout is also 60)
</I>&gt;&gt;<i>         I would think that the function returns after 60 seconds and
</I>&gt;&gt;<i>         not 1 when
</I>&gt;&gt;<i>         there is no data, is there another timeout I'm missing ?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         Can someone point me in the right direction ?
</I>&gt;&gt;<i>         I there a way to set this from inside handler like with
</I>&gt;&gt;<i>         regular sockets ?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         The pywebsocket package does include a way to work with a
</I>&gt;&gt;<i>         messagereceiver (here receiving is done in a thread),
</I>&gt;&gt;<i>         this works but it's difficult to debug, I think I would
</I>&gt;&gt;<i>         prefer a shorter
</I>&gt;&gt;<i>         timeout.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         Thx
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         _______________________________________________
</I>&gt;&gt;<i>         mod_python mailing list
</I>&gt;&gt;<i>         <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python at modpython.org</A> &lt;mailto:<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python at modpython.org</A>&gt;
</I>&gt;&gt;<i>         <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://mailman.modpython.org/pipermail/mod_python/attachments/20141103/25ce06ba/attachment-0001.html">http://mailman.modpython.org/pipermail/mod_python/attachments/20141103/25ce06ba/attachment-0001.html</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026644.html">[mod_python] TimeOut and mp_conn.read (pywebsocket)
</A></li>
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26645">[ date ]</a>
              <a href="thread.html#26645">[ thread ]</a>
              <a href="subject.html#26645">[ subject ]</a>
              <a href="author.html#26645">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the mod_python
mailing list</a><br>
</body></html>
