<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Concurrence and virtual host interpreter python
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Concurrence%20and%20virtual%20host%20interpreter%20python&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024261.html">
   <LINK REL="Next"  HREF="024259.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Concurrence and virtual host interpreter python</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Pau Freixes</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Concurrence%20and%20virtual%20host%20interpreter%20python&In-Reply-To="
       TITLE="[mod_python] Concurrence and virtual host interpreter python">pfreixes at milnou.net
       </A><BR>
    <I>Fri Sep 28 05:19:33 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="024261.html">[mod_python] memory error
</A></li>
        <LI>Next message: <A HREF="024259.html">[mod_python] Concurrence and virtual host interpreter python
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24252">[ date ]</a>
              <a href="thread.html#24252">[ thread ]</a>
              <a href="subject.html#24252">[ subject ]</a>
              <a href="author.html#24252">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Hi to all, Im new in a list.

Well, this last days I was work for testing and learn how work with multi
thread and multi interpreter environment in embedding python in C
applications, and of course mod_python it's a excellent place for
understand this.

Ok, with my lectures and test with mod_python code, i have a some
questions, somebody can help me for understand this concepts ?

1. I was try multi concurrence in a virtual host python script with this
easy code

def handler(req):

    # Request Content Type
    req.content_type = &quot;text/plain&quot;

    VALUE2 = 1
    for i in range(1,10):
        req.write(&quot;Value is %d\r\n&quot; % VALUE2)
        time.sleep(5)

        # change global variable
        VALUE2 = VALUE2 + 1;


    req.write(&quot;Hellow World&quot;)
    return apache.OK

And my surprise it's that apache only process the next request when the
previous request has been served. !!

I don't understand this strange behavior, because mod_python it's made
for accept concurrent threads in same interpreter, and i test a similar
situation  in a c code and it's possible do run some threads at same
time in same interpreter.

time.sleep(5) it's a pretty situation for python core for change the
context and release GIL and assign to this to other thread. yes ?


2. And de second question it's in similar situation, when you reuse a
interpreter for all request to same virtual host, with this code :

import time

VALUE = 1

def handler(req):
    global VALUE

    # Request Content Type
    req.content_type = &quot;text/plain&quot;

    for i in range(1,10):
        req.write(&quot;Value is %d\r\n&quot; % VALUE)
        time.sleep(5)

        # change global variable
        VALUE = VALUE + 1;


    req.write(&quot;Hellow World&quot;)
    return apache.OK

VALUE it's a global variable for de index.py, and subsequent request for
the same url (<A HREF="http://...../index.py">http://...../index.py</A>) show one incremental value for
VALUE. For example, this two request produced this two results

<A HREF="http://...../index.py">http://...../index.py</A>

Value is 1
Value is 2
Value is 3
Value is 4
Value is 5
Value is 6
Value is 7
Value is 8
Value is 9
Hellow World

<A HREF="http://...../index.py">http://...../index.py</A>

Value is 10
Value is 11
Value is 12
Value is 13
Value is 14
Value is 15
Value is 16
Value is 17
Value is 18
Hellow World


Ok, this situation it's really and i think its very normal because only
callback to handler it's made with the same interpreter and VALUE is
not re assigned to value 1, may be ?

3. And the most important question, why mod_python not use a separate
interpreters for all request ?

Thks to all and sorry for my large email

</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024261.html">[mod_python] memory error
</A></li>
	<LI>Next message: <A HREF="024259.html">[mod_python] Concurrence and virtual host interpreter python
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24252">[ date ]</a>
              <a href="thread.html#24252">[ thread ]</a>
              <a href="subject.html#24252">[ subject ]</a>
              <a href="author.html#24252">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
