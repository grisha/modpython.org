<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Subinterpreters and index.py
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Subinterpreters%20and%20index.py&In-Reply-To=20040702105846.P43763%40onyx.ispol.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015860.html">
   <LINK REL="Next"  HREF="015867.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Subinterpreters and index.py</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Nicolas Lehuen</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Subinterpreters%20and%20index.py&In-Reply-To=20040702105846.P43763%40onyx.ispol.com"
       TITLE="[mod_python] Subinterpreters and index.py">nicolas at lehuen.com
       </A><BR>
    <I>Fri Jul  2 19:57:29 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="015860.html">[mod_python] Subinterpreters and index.py
</A></li>
        <LI>Next message: <A HREF="015867.html">[mod_python] Subinterpreters and index.py
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15861">[ date ]</a>
              <a href="thread.html#15861">[ thread ]</a>
              <a href="subject.html#15861">[ subject ]</a>
              <a href="author.html#15861">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Grisha wrote:
&gt;<i> On Fri, 2 Jul 2004, Nicolas Lehuen wrote:
</I>&gt;<i> 
</I>&gt;<i> &gt; This could be fixed in mod_python.publisher if the module_name was 
</I>&gt;<i> &gt; built using the path part, not only the file part (line 67 of 
</I>&gt;<i> &gt; publisher.py)
</I>&gt;<i> 
</I>&gt;<i> But if someone wanted to use path_info in their application, 
</I>&gt;<i> this wouldn't work.
</I>&gt;<i> 
</I>&gt;<i> &gt; and by loading the module by directly specifying the file 
</I>&gt;<i> to load and 
</I>&gt;<i> &gt; not adding the path of the file to the call to 
</I>&gt;<i> import_module (line 98).
</I>&gt;<i> 
</I>&gt;<i> It's not so much how you load the file as the name you give 
</I>&gt;<i> the module. 
</I>&gt;<i> Right now it is the file name, I suppose it could be made the 
</I>&gt;<i> full path of the file, though there may be some kind of a 
</I>&gt;<i> gotcha with this approach.
</I>
Well, you would need to encode the path in a way that the result is a valid
module name, for example by replacing '/' and '\' by '.', spaces by
underscores and so on. The &quot;so on&quot; can be a bit tricky depending on the OS
(for special characters valid in filenames but not in module names like '.'
or maybe '~') and locale (for accentuated characters) but a simple
re.sub(r'[/\\]','.',re.sub(r'[^a-zA-Z0-9\./\\]','_',file)) can help for a
start.

The funny thing is that apache.import_module already gets the filename from
the module by having a look at its __file__ attribute (line 422 of
apache.py), so there IS a relation between physical files and modules.
import_module only need to make sure that the inverse is true, e.g. by
naming modules according to the full filename (including path).

There may be benefits if modules from subdirs where created within the
module corresponding to the subdir itself, i.e. if mod_python could create
packages corresponding to directories as well as modules corresponding to
files. I don't know. But the beauty of Python and mod_python is that nothing
prevents me or anybody else to give it a try (hence mod_python Servlets).
mod_python gives us access to the internal of Apache, and Python inherently
gives us access to its internals. So if we cannot do precisely what we want
with them, when else can we ?

&gt;<i> Also - have you looked at PythonInterpPerDrectory directive? 
</I>&gt;<i> Could this be the solution to what you're looking for?
</I>&gt;<i> Grisha
</I>
Yeah I've seen it, but this forces me to have all my scripts in the same
directory in order to share data between them. I cannot use subdirectories
in an application if I want to share data with the rest of the application.
For some of my applications, this is a problem, since I like them neatly
packaged.

I'm truly willing to share data between scripts, because that's why I chose
mod_python in the first place. I'm running it under Apache2 with a threading
model, and I wrote a small DBI connection pool module, so I really share my
database connections. Likewise, I have a few objects that are quite costly
to initialize (ternary search trees built from database for speed and search
flexibility), and there really is a benefit to sharing those objects between
all serving threads.

Regards (and kudos for mod_python !),

Nicolas Lehuen

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015860.html">[mod_python] Subinterpreters and index.py
</A></li>
	<LI>Next message: <A HREF="015867.html">[mod_python] Subinterpreters and index.py
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15861">[ date ]</a>
              <a href="thread.html#15861">[ thread ]</a>
              <a href="subject.html#15861">[ subject ]</a>
              <a href="author.html#15861">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
