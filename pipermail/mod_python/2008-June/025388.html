<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Duplicated statements using the publisher handler
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Duplicated%20statements%20using%20the%20publisher%20handler&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025387.html">
   <LINK REL="Next"  HREF="025390.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Duplicated statements using the publisher handler</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Luke Benstead</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Duplicated%20statements%20using%20the%20publisher%20handler&In-Reply-To="
       TITLE="[mod_python] Duplicated statements using the publisher handler">luke at riverhall.co.uk
       </A><BR>
    <I>Mon Jun 23 06:57:30 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="025387.html">[mod_python] Re: mod_python 3.3.1 bug report
</A></li>
        <LI>Next message: <A HREF="025390.html">[mod_python] Duplicated statements using the publisher handler
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25388">[ date ]</a>
              <a href="thread.html#25388">[ thread ]</a>
              <a href="subject.html#25388">[ subject ]</a>
              <a href="author.html#25388">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi all,

I have been getting some weird behaviour from a python script that I
wrote that uses the publisher handler. I'm not sure what is going wrong
to be honest, hopefully someone can point me in the right direction...

My script simply receives POST requests from an automated program on
another server. On receiving the requests the data is validated and then
inserted into a database. The code is quite simple. The problem is that
every time a POST is received, each Python statement seems to be run an
increasing number of times. For example, if I restart Apache, and send a
POST I get the following logged from the script:


2008-06-23 11:29:22,352 scriptname DEBUG    PID:6544 Thread:2964 Request
received: AdvertiserID = [Field('AdvertiserID', 'C46'),
Field('AdvertiserID', 'C1386')]


which is correct. If I resend the POST (e.g. press refresh in the
browser, I get the following added to the log

&#65279;2008-06-23 11:29:22,352 scriptname DEBUG    PID:6544 Thread:2964
Request received: AdvertiserID = [Field('AdvertiserID', 'C46'),
Field('AdvertiserID', 'C1386')]
&#65279;2008-06-23 11:29:22,352 scriptname DEBUG    PID:6544 Thread:2964
Request received: AdvertiserID = [Field('AdvertiserID', 'C46'),
Field('AdvertiserID', 'C1386')]

If I refresh again I get 3 entries, continually increasing. This happens
to every statement in the program. Originally I thought it might just be
the log, but I'm getting primary key database errors where insert
statements are being repeated.

The log writes the process ID and the a thread ID for each request. So I
know it is the SAME request which seems to call each method repeatedly
in order. Here's another example from the log:

2008-06-23 11:29:34,009 &#65279;scriptname DEBUG    PID:6544 Thread:736 List
after cleaning: [Field('AdvertiserID', 'C1386'), Field('AdvertiserID',
'C46')]
2008-06-23 11:29:34,009 &#65279;scriptname DEBUG    PID:6544 Thread:736 List
after cleaning: [Field('AdvertiserID', 'C1386'), Field('AdvertiserID',
'C46')]
2008-06-23 11:29:34,009 &#65279;scriptname DEBUG    PID:6544 Thread:736 Data is
valid
2008-06-23 11:29:34,009 &#65279;scriptname DEBUG    PID:6544 Thread:736 Data is
valid

So it's not as if the script is being run twice one after the other,
it's actually like each statement is called twice.

This is running Apache 2.2 + mod_python 3.3.1 under Windows 2000.

The Apache config uses a rewrite rule to get to the following location
directive:

	&lt;Location &quot;/&#65279;scriptname/&quot;&gt;
		SetHandler mod_python
		PythonHandler mod_python.publisher
		PythonDebug On
	&lt;/Location&gt;

I'd appreciate any help with this, thanks in advance.

Luke.



</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025387.html">[mod_python] Re: mod_python 3.3.1 bug report
</A></li>
	<LI>Next message: <A HREF="025390.html">[mod_python] Duplicated statements using the publisher handler
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25388">[ date ]</a>
              <a href="thread.html#25388">[ thread ]</a>
              <a href="subject.html#25388">[ subject ]</a>
              <a href="author.html#25388">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
