<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Windows performance problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Windows%20performance%20problem&In-Reply-To=88e286470806011849s5a21afecjf29a4def4666663e%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025325.html">
   <LINK REL="Next"  HREF="025337.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Windows performance problem</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>William Chapman</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Windows%20performance%20problem&In-Reply-To=88e286470806011849s5a21afecjf29a4def4666663e%40mail.gmail.com"
       TITLE="[mod_python] Windows performance problem">jeddahbill at gmail.com
       </A><BR>
    <I>Mon Jun  2 14:21:31 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="025325.html">[mod_python] Windows performance problem
</A></li>
        <LI>Next message: <A HREF="025337.html">[mod_python] Windows performance problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25327">[ date ]</a>
              <a href="thread.html#25327">[ thread ]</a>
              <a href="subject.html#25327">[ subject ]</a>
              <a href="author.html#25327">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Graham &amp; Dominique,

Thanks for your responses and fresh insights!

Progress so far:
Per your suggestion, I have tested the Windows XP (x64) &amp; Linux
installations for static file serving performance, and found both to be
equally excellent.  Actually, I think the Windows is even a bit livelier
than the Linux.

Next step I'm considering:
(1) Reinstall Apache, Python, and mod_python, with versions to match those
installed on the Windows side of my alternate host.  Because I generally
always choose the latest versions of everything I install, the older host
machine is probably a version or so behind.  I might learn something there.

Other information about my environment:
My web application uses sqlite (pysqlite binding) - and a few other Python
packages - but sqlite is the only one involved that's a performance driver.
Dominique mentioned the possible impact of other web application software
dependencies.  Because I use sqlite, I'll also include it in the list of
software to reinstall, possibly reverting to an older version.

By the way, I checked the Apache error logs on the (older) test-host and the
mod_python error messages are NOT present.  I believe it's running Apache
2.5.1 versus 2.5.2 on the new (problem) development-host.

Thanks again for your help.  I will post progress to the list.
Hasta la vista, ciao,
-- Bill Chapman

On Sun, Jun 1, 2008 at 6:49 PM, Graham Dumpleton &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">graham.dumpleton at gmail.com</A>&gt;
wrote:

&gt;<i> 2008/6/1 William Chapman &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">jeddahbill at gmail.com</A>&gt;:
</I>&gt;<i> &gt; I'm new to this list, but have been using mod_python successfully for
</I>&gt;<i> three
</I>&gt;<i> &gt; years in a web app served by both Linux (Ubuntu) and Windows (XP sp2
</I>&gt;<i> 32bit
</I>&gt;<i> &gt; AND 64bit).  I use two hosts to serve: one for testing (semi-public); one
</I>&gt;<i> &gt; for development.  Both hosts are dual-boot (Linux/Windows) and will serve
</I>&gt;<i> &gt; the identical web app installation from the same (NTFS file system)
</I>&gt;<i> &gt; directories.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; My problems started when the development host went belly-up and I rebuilt
</I>&gt;<i> &gt; the computer.  The Windows installation was upgraded (?) from 32bit to
</I>&gt;<i> 64bit
</I>&gt;<i> &gt; XP sp2.  (I don't know if going to x64 Windows is part of the problem; I
</I>&gt;<i> &gt; doubt it.)  Upon bringing up the new development host, all went well with
</I>&gt;<i> &gt; the Linux side, but under Windows, the web app is perfroming poorly.  The
</I>&gt;<i> &gt; application accesses take much too long.  Historically, the Windows &amp;
</I>&gt;<i> Linux
</I>&gt;<i> &gt; installations were comparable, and I never had performance complaints.
</I>&gt;<i>  Now,
</I>&gt;<i> &gt; the new Windows installation is 5x to 10x slower than previously.  To
</I>&gt;<i> &gt; emphasize, the mod_python is &quot;working,&quot; but very slowly, and comletely
</I>&gt;<i> &gt; unlike my previous experience with Windows/Apache/mod_python, not to
</I>&gt;<i> mention
</I>&gt;<i> &gt; my current testing host which is fine.
</I>&gt;<i>
</I>&gt;<i> Have you tested speed of serving static files? That is, is it a
</I>&gt;<i> mod_python specific problem or a problem with Apache as a whole?
</I>&gt;<i>
</I>&gt;<i> &gt; The setup (all installed from binaries):
</I>&gt;<i> &gt; Windows XP x64 sp2
</I>&gt;<i> &gt; apache 2.2.8
</I>&gt;<i> &gt; mod_python 3.3.1
</I>&gt;<i> &gt; Python 2.5.2 (installed separately)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Note:  I am not exactly sure of the order in which I installed
</I>&gt;<i> &gt; Apache/mod_python &amp; Python 2.5.  Could this matter?
</I>&gt;<i> &gt; I did uninstall and reinstall mod_python but performance/symptoms didn't
</I>&gt;<i> &gt; seem to change.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The only clues:
</I>&gt;<i> &gt; Three lines together from apache error.log (long lines - STRETCH BROWSER)
</I>&gt;<i> &gt; (file also attached) (also see Graham's email here.):
</I>&gt;<i> &gt; [Fri May 30 17:38:57 2008] [error] python_init: Python version mismatch,
</I>&gt;<i> &gt; expected '2.5', found '2.5.2'.
</I>&gt;<i> &gt; [Fri May 30 17:38:58 2008] [error] python_init: Python executable found
</I>&gt;<i> &gt; 'C:\\Program Files (x86)\\Apache Software
</I>&gt;<i> &gt; Foundation\\Apache2.2\\bin\\httpd.exe'.
</I>&gt;<i> &gt; [Fri May 30 17:38:58 2008] [error] python_init: Python path being used
</I>&gt;<i> &gt;
</I>&gt;<i> 'C:\\WINDOWS\\system32\\python25.zip;C:\\Python25\\Lib;C:\\Python25\\DLLs;C:\\Python25\\Lib\\lib-tk;;C:\\Program
</I>&gt;<i> &gt; Files (x86)\\Apache Software Foundation\\Apache2.2\\bin'.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I have read several of the threads from the list on this subject and am
</I>&gt;<i> &gt; confused about the following points:
</I>&gt;<i> &gt; (1) In the &quot;Python version mismatch&quot; error, the &quot;found&quot; version matches
</I>&gt;<i> the
</I>&gt;<i> &gt; version of Python I installed on the Windows machine.  mod_python
</I>&gt;<i> &quot;expected
</I>&gt;<i> &gt; 2.5&quot;.  Where is that supposed to come from?  I could not find Python 2.5
</I>&gt;<i> at
</I>&gt;<i> &gt; <A HREF="http://python.org.">http://python.org.</A>
</I>&gt;<i>
</I>&gt;<i> You obviously used a prebuilt version of mod_python for Windows. That
</I>&gt;<i> prebuilt version used Python 2.5 when compiled. That is what it means.
</I>&gt;<i>
</I>&gt;<i> &gt; (2) Apparently the &quot;Python version mismatch&quot; error message is not enough
</I>&gt;<i> to
</I>&gt;<i> &gt; stop mod_python from working, because it is &quot;working.&quot;
</I>&gt;<i>
</I>&gt;<i> On Windows, because Python is obtained via a DLL, the warning can be
</I>&gt;<i> ignored as APIs will be compatible. In other words, doesn't matter
</I>&gt;<i> that mod_python was originally compiled for older patch revision.
</I>&gt;<i>
</I>&gt;<i> &gt; (3) The &quot;Python executable found&quot; error message points to
</I>&gt;<i> &gt; &quot;...\\Apache2.2\\bin\\httpd.exe&quot;  This does not look like a &quot;Python
</I>&gt;<i> &gt; executable.&quot;  (?)
</I>&gt;<i>
</I>&gt;<i> Outputing this was thought to be a good idea, but not actually of much
</I>&gt;<i> use. What it is simply showing is that Python is running embedded
</I>&gt;<i> inside of Apache httpd executable. In other words, not standalone
</I>&gt;<i> python.exe.
</I>&gt;<i>
</I>&gt;<i> &gt; (4) The &quot;Python path being used&quot; error message specifies a series of
</I>&gt;<i> paths.
</I>&gt;<i> &gt; Where do those paths come from?  Can I affect those values?
</I>&gt;<i>
</I>&gt;<i> To a degree. See PythonPath directive, although changes may with this
</I>&gt;<i> may not show up in startup messages as they are applied later. You can
</I>&gt;<i> also change it by fiddling Windows registry, but you shouldn't do that
</I>&gt;<i> if you can help it.
</I>&gt;<i>
</I>&gt;<i> &gt; Taken as a
</I>&gt;<i> &gt; whole it doesn't match the system path environment variable I'm able to
</I>&gt;<i> set
</I>&gt;<i> &gt; as a Windows user.
</I>&gt;<i>
</I>&gt;<i> This is not the PATH variable, it is related to Python module search path.
</I>&gt;<i>
</I>&gt;<i> &gt; Random thought: I always thought that mod_python included an embedded
</I>&gt;<i> Python
</I>&gt;<i> &gt; interpreter, but reading suggests mod_python links to Python libraries.
</I>&gt;<i>
</I>&gt;<i> Both observations are true. Python is used in embedded mode, but code
</I>&gt;<i> comes from DLL.
</I>&gt;<i>
</I>&gt;<i> &gt; My analysis:  I suspect that the principle benefit of a mod_python
</I>&gt;<i> &gt; installation is not being realized.  It seems that the interpreter is
</I>&gt;<i> having
</I>&gt;<i> &gt; to be restarted for each access.  Is there another explanation for the
</I>&gt;<i> poor
</I>&gt;<i> &gt; performance?
</I>&gt;<i>
</I>&gt;<i> Your understanding is wrong. A new interpreter is not created on each
</I>&gt;<i> request.
</I>&gt;<i>
</I>&gt;<i> There is obviously still something wrong with your configuration or
</I>&gt;<i> perhaps with the web application which only manifests with this
</I>&gt;<i> configuration.
</I>&gt;<i>
</I>&gt;<i> Start out by seeing if Apache as a whole is working okay by testing
</I>&gt;<i> static file serving.
</I>&gt;<i>
</I>&gt;<i> Graham
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; At any rate I would greatly appreciate any suggestions or insights you
</I>&gt;<i> might
</I>&gt;<i> &gt; have!!
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; With many thanks,
</I>&gt;<i> &gt; -- Bill Chapman
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; Mod_python mailing list
</I>&gt;<i> &gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> &gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080602/d3505a1e/attachment.html">http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080602/d3505a1e/attachment.html</A>
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025325.html">[mod_python] Windows performance problem
</A></li>
	<LI>Next message: <A HREF="025337.html">[mod_python] Windows performance problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25327">[ date ]</a>
              <a href="thread.html#25327">[ thread ]</a>
              <a href="subject.html#25327">[ subject ]</a>
              <a href="author.html#25327">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
