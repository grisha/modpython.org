<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Windows performance problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Windows%20performance%20problem&In-Reply-To=6543521a0806021121t70ad0131gbde82bab8fb57cb0%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025327.html">
   <LINK REL="Next"  HREF="025326.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Windows performance problem</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>William Chapman</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Windows%20performance%20problem&In-Reply-To=6543521a0806021121t70ad0131gbde82bab8fb57cb0%40mail.gmail.com"
       TITLE="[mod_python] Windows performance problem">jeddahbill at gmail.com
       </A><BR>
    <I>Wed Jun  4 13:45:58 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="025327.html">[mod_python] Windows performance problem
</A></li>
        <LI>Next message: <A HREF="025326.html">[mod_python] Windows performance problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25337">[ date ]</a>
              <a href="thread.html#25337">[ thread ]</a>
              <a href="subject.html#25337">[ subject ]</a>
              <a href="author.html#25337">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>A follow-up on my &quot;Windows performance problem&quot;:

The problem was caused by the unexpected performance difference between the
Linux and Windows versions of a JSON package - simplejson.  **** It had
nothing at all to do with mod_python. ****  It turns out that simplejson's
&quot;speedup&quot; feature was not functioning properly with Windows.  To acheive
better performance I needed to convert several performance-critial sections
of my mod_python handler to use cjson instead.

I would like to put in a good word, however, for both the cjson and
simplejson packages.  They are both excellent.  simplejson has more
features, is well documented, and very flexible; cjson is simpler, somewhat
less flexible, and much faster.

Thanks again to Graham and Dominique for keeping me properly focused (away
from mod_python).  Who knows for how long I would have wandered in the
wilderness?!

On Mon, Jun 2, 2008 at 11:21 AM, William Chapman &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">jeddahbill at gmail.com</A>&gt;
wrote:

&gt;<i> Graham &amp; Dominique,
</I>&gt;<i>
</I>&gt;<i> Thanks for your responses and fresh insights!
</I>&gt;<i>
</I>&gt;<i> Progress so far:
</I>&gt;<i> Per your suggestion, I have tested the Windows XP (x64) &amp; Linux
</I>&gt;<i> installations for static file serving performance, and found both to be
</I>&gt;<i> equally excellent.  Actually, I think the Windows is even a bit livelier
</I>&gt;<i> than the Linux.
</I>&gt;<i>
</I>&gt;<i> Next step I'm considering:
</I>&gt;<i> (1) Reinstall Apache, Python, and mod_python, with versions to match those
</I>&gt;<i> installed on the Windows side of my alternate host.  Because I generally
</I>&gt;<i> always choose the latest versions of everything I install, the older host
</I>&gt;<i> machine is probably a version or so behind.  I might learn something there.
</I>&gt;<i>
</I>&gt;<i> Other information about my environment:
</I>&gt;<i> My web application uses sqlite (pysqlite binding) - and a few other Python
</I>&gt;<i> packages - but sqlite is the only one involved that's a performance driver.
</I>&gt;<i> Dominique mentioned the possible impact of other web application software
</I>&gt;<i> dependencies.  Because I use sqlite, I'll also include it in the list of
</I>&gt;<i> software to reinstall, possibly reverting to an older version.
</I>&gt;<i>
</I>&gt;<i> By the way, I checked the Apache error logs on the (older) test-host and
</I>&gt;<i> the mod_python error messages are NOT present.  I believe it's running
</I>&gt;<i> Apache 2.5.1 versus 2.5.2 on the new (problem) development-host.
</I>&gt;<i>
</I>&gt;<i> Thanks again for your help.  I will post progress to the list.
</I>&gt;<i> Hasta la vista, ciao,
</I>&gt;<i> -- Bill Chapman
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Sun, Jun 1, 2008 at 6:49 PM, Graham Dumpleton &lt;
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">graham.dumpleton at gmail.com</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> 2008/6/1 William Chapman &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">jeddahbill at gmail.com</A>&gt;:
</I>&gt;&gt;<i> &gt; I'm new to this list, but have been using mod_python successfully for
</I>&gt;&gt;<i> three
</I>&gt;&gt;<i> &gt; years in a web app served by both Linux (Ubuntu) and Windows (XP sp2
</I>&gt;&gt;<i> 32bit
</I>&gt;&gt;<i> &gt; AND 64bit).  I use two hosts to serve: one for testing (semi-public);
</I>&gt;&gt;<i> one
</I>&gt;&gt;<i> &gt; for development.  Both hosts are dual-boot (Linux/Windows) and will
</I>&gt;&gt;<i> serve
</I>&gt;&gt;<i> &gt; the identical web app installation from the same (NTFS file system)
</I>&gt;&gt;<i> &gt; directories.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; My problems started when the development host went belly-up and I
</I>&gt;&gt;<i> rebuilt
</I>&gt;&gt;<i> &gt; the computer.  The Windows installation was upgraded (?) from 32bit to
</I>&gt;&gt;<i> 64bit
</I>&gt;&gt;<i> &gt; XP sp2.  (I don't know if going to x64 Windows is part of the problem; I
</I>&gt;&gt;<i> &gt; doubt it.)  Upon bringing up the new development host, all went well
</I>&gt;&gt;<i> with
</I>&gt;&gt;<i> &gt; the Linux side, but under Windows, the web app is perfroming poorly.
</I>&gt;&gt;<i>  The
</I>&gt;&gt;<i> &gt; application accesses take much too long.  Historically, the Windows &amp;
</I>&gt;&gt;<i> Linux
</I>&gt;&gt;<i> &gt; installations were comparable, and I never had performance complaints.
</I>&gt;&gt;<i>  Now,
</I>&gt;&gt;<i> &gt; the new Windows installation is 5x to 10x slower than previously.  To
</I>&gt;&gt;<i> &gt; emphasize, the mod_python is &quot;working,&quot; but very slowly, and comletely
</I>&gt;&gt;<i> &gt; unlike my previous experience with Windows/Apache/mod_python, not to
</I>&gt;&gt;<i> mention
</I>&gt;&gt;<i> &gt; my current testing host which is fine.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Have you tested speed of serving static files? That is, is it a
</I>&gt;&gt;<i> mod_python specific problem or a problem with Apache as a whole?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &gt; The setup (all installed from binaries):
</I>&gt;&gt;<i> &gt; Windows XP x64 sp2
</I>&gt;&gt;<i> &gt; apache 2.2.8
</I>&gt;&gt;<i> &gt; mod_python 3.3.1
</I>&gt;&gt;<i> &gt; Python 2.5.2 (installed separately)
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; Note:  I am not exactly sure of the order in which I installed
</I>&gt;&gt;<i> &gt; Apache/mod_python &amp; Python 2.5.  Could this matter?
</I>&gt;&gt;<i> &gt; I did uninstall and reinstall mod_python but performance/symptoms didn't
</I>&gt;&gt;<i> &gt; seem to change.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; The only clues:
</I>&gt;&gt;<i> &gt; Three lines together from apache error.log (long lines - STRETCH
</I>&gt;&gt;<i> BROWSER)
</I>&gt;&gt;<i> &gt; (file also attached) (also see Graham's email here.):
</I>&gt;&gt;<i> &gt; [Fri May 30 17:38:57 2008] [error] python_init: Python version mismatch,
</I>&gt;&gt;<i> &gt; expected '2.5', found '2.5.2'.
</I>&gt;&gt;<i> &gt; [Fri May 30 17:38:58 2008] [error] python_init: Python executable found
</I>&gt;&gt;<i> &gt; 'C:\\Program Files (x86)\\Apache Software
</I>&gt;&gt;<i> &gt; Foundation\\Apache2.2\\bin\\httpd.exe'.
</I>&gt;&gt;<i> &gt; [Fri May 30 17:38:58 2008] [error] python_init: Python path being used
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> 'C:\\WINDOWS\\system32\\python25.zip;C:\\Python25\\Lib;C:\\Python25\\DLLs;C:\\Python25\\Lib\\lib-tk;;C:\\Program
</I>&gt;&gt;<i> &gt; Files (x86)\\Apache Software Foundation\\Apache2.2\\bin'.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; I have read several of the threads from the list on this subject and am
</I>&gt;&gt;<i> &gt; confused about the following points:
</I>&gt;&gt;<i> &gt; (1) In the &quot;Python version mismatch&quot; error, the &quot;found&quot; version matches
</I>&gt;&gt;<i> the
</I>&gt;&gt;<i> &gt; version of Python I installed on the Windows machine.  mod_python
</I>&gt;&gt;<i> &quot;expected
</I>&gt;&gt;<i> &gt; 2.5&quot;.  Where is that supposed to come from?  I could not find Python 2.5
</I>&gt;&gt;<i> at
</I>&gt;&gt;<i> &gt; <A HREF="http://python.org.">http://python.org.</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> You obviously used a prebuilt version of mod_python for Windows. That
</I>&gt;&gt;<i> prebuilt version used Python 2.5 when compiled. That is what it means.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &gt; (2) Apparently the &quot;Python version mismatch&quot; error message is not enough
</I>&gt;&gt;<i> to
</I>&gt;&gt;<i> &gt; stop mod_python from working, because it is &quot;working.&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Windows, because Python is obtained via a DLL, the warning can be
</I>&gt;&gt;<i> ignored as APIs will be compatible. In other words, doesn't matter
</I>&gt;&gt;<i> that mod_python was originally compiled for older patch revision.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &gt; (3) The &quot;Python executable found&quot; error message points to
</I>&gt;&gt;<i> &gt; &quot;...\\Apache2.2\\bin\\httpd.exe&quot;  This does not look like a &quot;Python
</I>&gt;&gt;<i> &gt; executable.&quot;  (?)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Outputing this was thought to be a good idea, but not actually of much
</I>&gt;&gt;<i> use. What it is simply showing is that Python is running embedded
</I>&gt;&gt;<i> inside of Apache httpd executable. In other words, not standalone
</I>&gt;&gt;<i> python.exe.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &gt; (4) The &quot;Python path being used&quot; error message specifies a series of
</I>&gt;&gt;<i> paths.
</I>&gt;&gt;<i> &gt; Where do those paths come from?  Can I affect those values?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> To a degree. See PythonPath directive, although changes may with this
</I>&gt;&gt;<i> may not show up in startup messages as they are applied later. You can
</I>&gt;&gt;<i> also change it by fiddling Windows registry, but you shouldn't do that
</I>&gt;&gt;<i> if you can help it.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &gt; Taken as a
</I>&gt;&gt;<i> &gt; whole it doesn't match the system path environment variable I'm able to
</I>&gt;&gt;<i> set
</I>&gt;&gt;<i> &gt; as a Windows user.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This is not the PATH variable, it is related to Python module search path.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &gt; Random thought: I always thought that mod_python included an embedded
</I>&gt;&gt;<i> Python
</I>&gt;&gt;<i> &gt; interpreter, but reading suggests mod_python links to Python libraries.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Both observations are true. Python is used in embedded mode, but code
</I>&gt;&gt;<i> comes from DLL.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &gt; My analysis:  I suspect that the principle benefit of a mod_python
</I>&gt;&gt;<i> &gt; installation is not being realized.  It seems that the interpreter is
</I>&gt;&gt;<i> having
</I>&gt;&gt;<i> &gt; to be restarted for each access.  Is there another explanation for the
</I>&gt;&gt;<i> poor
</I>&gt;&gt;<i> &gt; performance?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Your understanding is wrong. A new interpreter is not created on each
</I>&gt;&gt;<i> request.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> There is obviously still something wrong with your configuration or
</I>&gt;&gt;<i> perhaps with the web application which only manifests with this
</I>&gt;&gt;<i> configuration.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Start out by seeing if Apache as a whole is working okay by testing
</I>&gt;&gt;<i> static file serving.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Graham
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &gt; At any rate I would greatly appreciate any suggestions or insights you
</I>&gt;&gt;<i> might
</I>&gt;&gt;<i> &gt; have!!
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; With many thanks,
</I>&gt;&gt;<i> &gt; -- Bill Chapman
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; _______________________________________________
</I>&gt;&gt;<i> &gt; Mod_python mailing list
</I>&gt;&gt;<i> &gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;&gt;<i> &gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080604/012653db/attachment.html">http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080604/012653db/attachment.html</A>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025327.html">[mod_python] Windows performance problem
</A></li>
	<LI>Next message: <A HREF="025326.html">[mod_python] Windows performance problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25337">[ date ]</a>
              <a href="thread.html#25337">[ thread ]</a>
              <a href="subject.html#25337">[ subject ]</a>
              <a href="author.html#25337">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
