<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Duplicated statements using the publisher handler
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Duplicated%20statements%20using%20the%20publisher%20handler&In-Reply-To=1214218650.6542.11.camel%40hughes">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025388.html">
   <LINK REL="Next"  HREF="025389.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Duplicated statements using the publisher handler</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Duplicated%20statements%20using%20the%20publisher%20handler&In-Reply-To=1214218650.6542.11.camel%40hughes"
       TITLE="[mod_python] Duplicated statements using the publisher handler">graham.dumpleton at gmail.com
       </A><BR>
    <I>Mon Jun 23 19:39:18 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="025388.html">[mod_python] Duplicated statements using the publisher handler
</A></li>
        <LI>Next message: <A HREF="025389.html">[mod_python] Testing mod_python without having to install it
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25390">[ date ]</a>
              <a href="thread.html#25390">[ thread ]</a>
              <a href="subject.html#25390">[ subject ]</a>
              <a href="author.html#25390">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Log the value of req.connection.id in the request to try and doubly
confirm if it is being done in context of one client connection.

Do you have any fancy rewrite rules in your Apache configuration?

Do you have directory browsing enabled in Apache so you can get
directory listings?

Are you using any Apache authentication scheme?

Graham

2008/6/23 Luke Benstead &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">luke at riverhall.co.uk</A>&gt;:
&gt;<i> Hi all,
</I>&gt;<i>
</I>&gt;<i> I have been getting some weird behaviour from a python script that I
</I>&gt;<i> wrote that uses the publisher handler. I'm not sure what is going wrong
</I>&gt;<i> to be honest, hopefully someone can point me in the right direction...
</I>&gt;<i>
</I>&gt;<i> My script simply receives POST requests from an automated program on
</I>&gt;<i> another server. On receiving the requests the data is validated and then
</I>&gt;<i> inserted into a database. The code is quite simple. The problem is that
</I>&gt;<i> every time a POST is received, each Python statement seems to be run an
</I>&gt;<i> increasing number of times. For example, if I restart Apache, and send a
</I>&gt;<i> POST I get the following logged from the script:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> 2008-06-23 11:29:22,352 scriptname DEBUG    PID:6544 Thread:2964 Request
</I>&gt;<i> received: AdvertiserID = [Field('AdvertiserID', 'C46'),
</I>&gt;<i> Field('AdvertiserID', 'C1386')]
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> which is correct. If I resend the POST (e.g. press refresh in the
</I>&gt;<i> browser, I get the following added to the log
</I>&gt;<i>
</I>&gt;<i> &#65279;2008-06-23 11:29:22,352 scriptname DEBUG    PID:6544 Thread:2964
</I>&gt;<i> Request received: AdvertiserID = [Field('AdvertiserID', 'C46'),
</I>&gt;<i> Field('AdvertiserID', 'C1386')]
</I>&gt;<i> &#65279;2008-06-23 11:29:22,352 scriptname DEBUG    PID:6544 Thread:2964
</I>&gt;<i> Request received: AdvertiserID = [Field('AdvertiserID', 'C46'),
</I>&gt;<i> Field('AdvertiserID', 'C1386')]
</I>&gt;<i>
</I>&gt;<i> If I refresh again I get 3 entries, continually increasing. This happens
</I>&gt;<i> to every statement in the program. Originally I thought it might just be
</I>&gt;<i> the log, but I'm getting primary key database errors where insert
</I>&gt;<i> statements are being repeated.
</I>&gt;<i>
</I>&gt;<i> The log writes the process ID and the a thread ID for each request. So I
</I>&gt;<i> know it is the SAME request which seems to call each method repeatedly
</I>&gt;<i> in order. Here's another example from the log:
</I>&gt;<i>
</I>&gt;<i> 2008-06-23 11:29:34,009 &#65279;scriptname DEBUG    PID:6544 Thread:736 List
</I>&gt;<i> after cleaning: [Field('AdvertiserID', 'C1386'), Field('AdvertiserID',
</I>&gt;<i> 'C46')]
</I>&gt;<i> 2008-06-23 11:29:34,009 &#65279;scriptname DEBUG    PID:6544 Thread:736 List
</I>&gt;<i> after cleaning: [Field('AdvertiserID', 'C1386'), Field('AdvertiserID',
</I>&gt;<i> 'C46')]
</I>&gt;<i> 2008-06-23 11:29:34,009 &#65279;scriptname DEBUG    PID:6544 Thread:736 Data is
</I>&gt;<i> valid
</I>&gt;<i> 2008-06-23 11:29:34,009 &#65279;scriptname DEBUG    PID:6544 Thread:736 Data is
</I>&gt;<i> valid
</I>&gt;<i>
</I>&gt;<i> So it's not as if the script is being run twice one after the other,
</I>&gt;<i> it's actually like each statement is called twice.
</I>&gt;<i>
</I>&gt;<i> This is running Apache 2.2 + mod_python 3.3.1 under Windows 2000.
</I>&gt;<i>
</I>&gt;<i> The Apache config uses a rewrite rule to get to the following location
</I>&gt;<i> directive:
</I>&gt;<i>
</I>&gt;<i>        &lt;Location &quot;/&#65279;scriptname/&quot;&gt;
</I>&gt;<i>                SetHandler mod_python
</I>&gt;<i>                PythonHandler mod_python.publisher
</I>&gt;<i>                PythonDebug On
</I>&gt;<i>        &lt;/Location&gt;
</I>&gt;<i>
</I>&gt;<i> I'd appreciate any help with this, thanks in advance.
</I>&gt;<i>
</I>&gt;<i> Luke.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i>
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025388.html">[mod_python] Duplicated statements using the publisher handler
</A></li>
	<LI>Next message: <A HREF="025389.html">[mod_python] Testing mod_python without having to install it
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25390">[ date ]</a>
              <a href="thread.html#25390">[ thread ]</a>
              <a href="subject.html#25390">[ subject ]</a>
              <a href="author.html#25390">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
