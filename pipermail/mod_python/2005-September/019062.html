<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] PythonImport: Can someone please draw a diagram
	for	this idiot?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20PythonImport%3A%20Can%20someone%20please%20draw%20a%20diagram%0A%09for%09this%20idiot%3F&In-Reply-To=4328DB51.30408%40joreybump.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019055.html">
   <LINK REL="Next"  HREF="019063.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] PythonImport: Can someone please draw a diagram
	for	this idiot?</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Jorey Bump</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20PythonImport%3A%20Can%20someone%20please%20draw%20a%20diagram%0A%09for%09this%20idiot%3F&In-Reply-To=4328DB51.30408%40joreybump.com"
       TITLE="[mod_python] PythonImport: Can someone please draw a diagram
	for	this idiot?">list at joreybump.com
       </A><BR>
    <I>Wed Sep 14 23:39:14 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="019055.html">[mod_python] PythonImport: Can someone please draw a diagram
	for	this idiot?
</A></li>
        <LI>Next message: <A HREF="019063.html">[mod_python] PythonImport: Can someone please draw a diagram
	for	this idiot?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19062">[ date ]</a>
              <a href="thread.html#19062">[ thread ]</a>
              <a href="subject.html#19062">[ subject ]</a>
              <a href="author.html#19062">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Jorey Bump wrote:
&gt;<i> Jim Gallacher wrote:
</I>&gt;&gt;<i> I don't know if this is the correct way, but I tried it and it works:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> import sys
</I>&gt;&gt;<i> mpglobal = sys.modules['mpglobal']
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> def index(req):
</I>&gt;&gt;<i>     req.write('Hello world\n')
</I>&gt;&gt;<i>     req.write(mpglobal.foo)
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> That's very interesting, because due to module caching, the results are 
</I>&gt;<i> the same if you simply do this:
</I>&gt;<i> 
</I>&gt;<i> import mpglobal
</I>&gt;<i> 
</I>&gt;<i> In the published module, when mpglobal is imported, /tmp/atest isn't 
</I>&gt;<i> updated and mpglobal.foo is available, indicating that one could 
</I>&gt;<i> initialize a db connection or variables using PythonImport, yet ensure 
</I>&gt;<i> the module will still work if sys.modules['mpglobal'] isn't available.
</I>
OK, this allows for a simpler test:

# mpglobal.py
# import this with PythonImport
import time
foo = time.strftime('%X %x %Z')

Published module:

# globaltest.py
# access global module without reimporting, due to module caching
import mpglobal
def index():
     return mpglobal.foo

Visit:

  <A HREF="http://host/somedir/globaltest/">http://host/somedir/globaltest/</A>

This will display the time the module was originally imported. Due to 
module caching, the same time will be displayed for multiple requests, 
but eventually the module will be reimported as new child processes 
begin, and different times will be displayed (use multiple browsers to 
see the effect best). This is consistent with the documentation.

As far as I can tell, PythonImport doesn't provide any more persistence 
for dynamically created objects or globals than simply importing the 
module directly in a published module. The documentation implies that 
this directive is mainly useful for initializing time consuming tasks 
before the first request. But isn't that only true directly after 
(re)starting apache? Isn't it the case that subsequent requests cause 
apache to spawn more children, thus reintroducing the delay for the 
first request in that child process?




</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019055.html">[mod_python] PythonImport: Can someone please draw a diagram
	for	this idiot?
</A></li>
	<LI>Next message: <A HREF="019063.html">[mod_python] PythonImport: Can someone please draw a diagram
	for	this idiot?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19062">[ date ]</a>
              <a href="thread.html#19062">[ thread ]</a>
              <a href="subject.html#19062">[ subject ]</a>
              <a href="author.html#19062">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
