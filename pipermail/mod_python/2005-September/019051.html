<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] PythonImport: Can someone please draw a diagram
	for	this idiot?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20PythonImport%3A%20Can%20someone%20please%20draw%20a%20diagram%0A%09for%09this%20idiot%3F&In-Reply-To=4328C8D1.4020300%40joreybump.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019049.html">
   <LINK REL="Next"  HREF="019055.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] PythonImport: Can someone please draw a diagram
	for	this idiot?</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Jim Gallacher</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20PythonImport%3A%20Can%20someone%20please%20draw%20a%20diagram%0A%09for%09this%20idiot%3F&In-Reply-To=4328C8D1.4020300%40joreybump.com"
       TITLE="[mod_python] PythonImport: Can someone please draw a diagram
	for	this idiot?">jg.lists at sympatico.ca
       </A><BR>
    <I>Wed Sep 14 21:49:38 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="019049.html">[mod_python] PythonImport: Can someone please draw a diagram
	for	this idiot?
</A></li>
        <LI>Next message: <A HREF="019055.html">[mod_python] PythonImport: Can someone please draw a diagram
	for	this idiot?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19051">[ date ]</a>
              <a href="thread.html#19051">[ thread ]</a>
              <a href="subject.html#19051">[ subject ]</a>
              <a href="author.html#19051">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Jorey Bump wrote:
&gt;<i> Jim Gallacher wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> In answer to my own in question, PythonImport does work and there is 
</I>&gt;&gt;<i> no bug. Re-reading the docs reveals this small detail which I and 
</I>&gt;&gt;<i> others may have overlooked - the context for the directive. 
</I>&gt;&gt;<i> PythonImport only works in the server config context. Quoting from the 
</I>&gt;&gt;<i> apache docs 
</I>&gt;&gt;<i> (<A HREF="http://httpd.apache.org/docs/2.0/mod/directive-dict.html#Context">http://httpd.apache.org/docs/2.0/mod/directive-dict.html#Context</A>)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &quot;&quot;&quot;
</I>&gt;&gt;<i> server config
</I>&gt;&gt;<i>     This means that the directive may be used in the server 
</I>&gt;&gt;<i> configuration files (e.g., httpd.conf), but not within any 
</I>&gt;&gt;<i> &lt;VirtualHost&gt; or &lt;Directory&gt; containers. It is not allowed in 
</I>&gt;&gt;<i> .htaccess files at all.
</I>&gt;&gt;<i> &quot;&quot;&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I'll update the docs to make this a little more explicit, since it's 
</I>&gt;&gt;<i> easy to overlook. I know I did. :)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Hope that helps.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Yes, it does. For a simple demo, put a module in the default module 
</I>&gt;<i> search path, such as a directory shown in sys.path when running python 
</I>&gt;<i> from the command line. PythonPath directives in httpd.conf will not have 
</I>&gt;<i> taken effect when PythonImport runs (I used 
</I>&gt;<i> /usr/lib/python2.4/site-packages/ for my test).
</I>&gt;<i> 
</I>&gt;<i> # mpglobal.py
</I>&gt;<i> 
</I>&gt;<i> import time
</I>&gt;<i> 
</I>&gt;<i> f = open('tmp/atest', 'w')
</I>&gt;<i> f.write(str(time.time()))
</I>&gt;<i> f.close()
</I>&gt;<i> 
</I>&gt;<i> foo = 'testing'
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Then in httpd.conf (using your own interpreter name):
</I>&gt;<i> 
</I>&gt;<i> PythonImport mpglobal www.example.com
</I>&gt;<i> 
</I>&gt;<i> On Linux, restarting apache creates and/or updates /tmp/atest, verifying 
</I>&gt;<i> that it works.
</I>&gt;<i> 
</I>&gt;<i> But, like the OP, I can't figure out how to access foo (or mpglobal.foo) 
</I>&gt;<i> in my published module.
</I>
I don't know if this is the correct way, but I tried it and it works:

import sys
mpglobal = sys.modules['mpglobal']

def index(req):
     req.write('Hello world\n')
     req.write(mpglobal.foo)

Jim


&gt;<i> Also, here is a better module to run under Publisher to check various 
</I>&gt;<i> settings, including the name of the interpreter (and I remembered to 
</I>&gt;<i> include sys.path this time!):
</I>&gt;<i> 
</I>&gt;<i> &quot;&quot;&quot;
</I>&gt;<i> info.py
</I>&gt;<i> 
</I>&gt;<i> Display various settings/variables under mod_python.publisher.
</I>&gt;<i> 
</I>&gt;<i> Access at:
</I>&gt;<i> 
</I>&gt;<i>  <A HREF="http://host/somedir/info.py/index">http://host/somedir/info.py/index</A>
</I>&gt;<i> 
</I>&gt;<i> or:
</I>&gt;<i> 
</I>&gt;<i>  <A HREF="http://host/somedir/info/">http://host/somedir/info/</A>
</I>&gt;<i> 
</I>&gt;<i> To check form variables, set form action to:
</I>&gt;<i> 
</I>&gt;<i>  <A HREF="http://host/somedir/info.py/showformdata">http://host/somedir/info.py/showformdata</A>
</I>&gt;<i> 
</I>&gt;<i> &quot;&quot;&quot;
</I>&gt;<i> 
</I>&gt;<i> from mod_python import apache
</I>&gt;<i> import os
</I>&gt;<i> import sys
</I>&gt;<i> 
</I>&gt;<i> topdir = []
</I>&gt;<i> for i in dir():
</I>&gt;<i>     topdir.append(i)
</I>&gt;<i> 
</I>&gt;<i> def showformdata(req):
</I>&gt;<i>     formdata = {}
</I>&gt;<i>     if req.form.keys():
</I>&gt;<i>         for key in req.form.keys():
</I>&gt;<i>             formdata[key] = req.form[key]
</I>&gt;<i>         return formdata
</I>&gt;<i>     else:
</I>&gt;<i>         return &quot;no form data&quot;
</I>&gt;<i> 
</I>&gt;<i> def index(req):
</I>&gt;<i>     d = []
</I>&gt;<i>     d.append(&quot;Interpreter Name (req.interpreter):&quot; )
</I>&gt;<i>     d.append(req.interpreter)
</I>&gt;<i>     d.append(&quot;\nsys.path:&quot;)
</I>&gt;<i>     d.append('\n'.join(sys.path))
</I>&gt;<i>     d.append(&quot;\nRequest (req.the_request):&quot;)
</I>&gt;<i>     d.append(req.the_request)
</I>&gt;<i>     d.append(&quot;\nProtocol (req.protocol):&quot;)
</I>&gt;<i>     d.append(req.protocol)
</I>&gt;<i>     d.append(&quot;\nMethod (req.method):&quot;)
</I>&gt;<i>     d.append(req.method)
</I>&gt;<i>     d.append(&quot;\nreq.subprocess_env:&quot;)
</I>&gt;<i>     d.extend([&quot;%s: %s&quot; % (i, req.subprocess_env[i]) for i in 
</I>&gt;<i> req.subprocess_env.keys()])
</I>&gt;<i>     d.append(&quot;\nreq.filename:&quot;)
</I>&gt;<i>     d.append(req.filename)
</I>&gt;<i>     d.append(&quot;\nreq.path_info:&quot;)
</I>&gt;<i>     d.append(req.path_info)
</I>&gt;<i>     d.append(&quot;\nenvironment PATH:&quot;)
</I>&gt;<i>     d.append(os.environ['PATH'])
</I>&gt;<i>     d.append(&quot;\ndir():&quot;)
</I>&gt;<i>     d.extend(topdir)
</I>&gt;<i>     return &quot;\n&quot;.join(d)
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i> 
</I>
</PRE>
















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019049.html">[mod_python] PythonImport: Can someone please draw a diagram
	for	this idiot?
</A></li>
	<LI>Next message: <A HREF="019055.html">[mod_python] PythonImport: Can someone please draw a diagram
	for	this idiot?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19051">[ date ]</a>
              <a href="thread.html#19051">[ thread ]</a>
              <a href="subject.html#19051">[ subject ]</a>
              <a href="author.html#19051">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
