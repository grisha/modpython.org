<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Re: apachectl restart == dead mod_python
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Re%3A%20apachectl%20restart%20%3D%3D%20dead%20mod_python&In-Reply-To=e37d987757c86e27eb5af86e7c8e9fef%40dscpl.com.au">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018986.html">
   <LINK REL="Next"  HREF="018988.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Re: apachectl restart == dead mod_python</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>The Doctor What</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Re%3A%20apachectl%20restart%20%3D%3D%20dead%20mod_python&In-Reply-To=e37d987757c86e27eb5af86e7c8e9fef%40dscpl.com.au"
       TITLE="[mod_python] Re: apachectl restart == dead mod_python">list.mod_python at docwhat.gerf.org
       </A><BR>
    <I>Fri Sep  9 10:57:58 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="018986.html">[mod_python] apachectl restart == dead mod_python
</A></li>
        <LI>Next message: <A HREF="018988.html">[mod_python] mod_python + MySQLdb + Apache strange behavoir
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18995">[ date ]</a>
              <a href="thread.html#18995">[ thread ]</a>
              <a href="subject.html#18995">[ subject ]</a>
              <a href="author.html#18995">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>* Graham Dumpleton (<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">grahamd at dscpl.com.au</A>) [050908 21:06]:
&gt;<i> 
</I>&gt;<i> On 09/09/2005, at 11:43 AM, The Doctor What wrote:
</I>&gt;<i> 
</I>&gt;<i> &gt;Hello!
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;I have apache2 2.0.54, mod_python 3.1.3, python 2.3.5 (Debian
</I>&gt;<i> &gt;Sarge).
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;I can start up apache2 and the mod_python pages work fine.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;However, if I then do apachectl restart, the mod_python pages hang
</I>&gt;<i> &gt;forever.  Frozen.  Eventually I get a timeout message in my browser.
</I>&gt;<i> &gt;The apache children do not die readily and require extra time to
</I>&gt;<i> &gt;clean up. :-(
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;I full stop/start works everytime but in not a desirable solution
</I>&gt;<i> &gt;for a live server with multiple domains.  In addition, I'd have to
</I>&gt;<i> &gt;change all the log rotation stuff, etc.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;I particularly interested in TRAC, but it seems to be a generic
</I>&gt;<i> &gt;problem. I want to get PSE on my server, too.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;Is there some option I'm not including or something?
</I>&gt;<i> 
</I>&gt;<i> Is this happening with a really simple mod_python handler, ie.,
</I>&gt;<i> something like mptest, or something more complicated? Ie., can
</I>&gt;<i> you be sure it isn't the handler code itself is causing the
</I>&gt;<i> problem?
</I>&gt;<i> 
</I>&gt;<i> What mode is Apache running in, &quot;prefork&quot; or &quot;worker&quot;?
</I>&gt;<i> 
</I>&gt;<i> Do you get any messages in the Apache error log file which may be
</I>&gt;<i> pertinent?
</I>
Hi Graham! Thanks for replying. :-)

I set up the mptest.py and got the following behaviour:
  * After setting up the configuration directives, I did a complete
    restart (stop-start). The mptest.py worked correctly.
  * I then did a reload (kill -HUP aka graceful) on apache.
    mptest.py then returned 500s for the first few times, then the
    apache server stopped responding to that page. Other pages work
    fine.  No logs are generated other than access logs.
  * To recover, a full restart is needed (stop-start).  It takes
    work to kill some of the children.  It's obvious that they
    are hung somehow.

See the attached file &quot;experiment&quot; for a full log of my tests.

The apache server is running in &quot;prefork&quot; mode.

Ciao!
-------------- next part --------------
Script started on Fri Sep  9 09:38:53 2005
docwhat % sudo /etc/init.d/apache2 restart
Forcing reload of web server: Apache2.
docwhat % lynx -source <A HREF="http://gerf.org/test/mptest.py">http://gerf.org/test/mptest.py</A>
Hello World!
docwhat % lynx -source <A HREF="http://gerf.org/test/mptest.py">http://gerf.org/test/mptest.py</A>
Hello World!
docwhat % lynx -source <A HREF="http://gerf.org/test/mptest.py">http://gerf.org/test/mptest.py</A>
Hello World!
docwhat % lynx -source <A HREF="http://gerf.org/test/mptest.py">http://gerf.org/test/mptest.py</A>
Hello World!
docwhat % lynx -source <A HREF="http://gerf.org/test/mptest.py">http://gerf.org/test/mptest.py</A>
Hello World!
docwhat % lynx -source <A HREF="http://gerf.org/test/mptest.py">http://gerf.org/test/mptest.py</A>
Hello World!
docwhat % lynx -source <A HREF="http://gerf.org/test/mptest.py">http://gerf.org/test/mptest.py</A>
Hello World!
docwhat % lynx -source <A HREF="http://gerf.org/test/mptest.py">http://gerf.org/test/mptest.py</A>
Hello World!
docwhat % lynx -source <A HREF="http://gerf.org/test/mptest.py">http://gerf.org/test/mptest.py</A>
Hello World!
docwhat % lynx -source <A HREF="http://gerf.org/test/mptest.py">http://gerf.org/test/mptest.py</A>
Hello World!
docwhat % sudo /etc/init.d/apache2 reload
Reloading web server config...done.
docwhat % lynx -source <A HREF="http://gerf.org/test/mptest.py">http://gerf.org/test/mptest.py</A>
&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot;
  &quot;<A HREF="http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;">http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;</A>&gt;
&lt;html xmlns=&quot;<A HREF="http://www.w3.org/1999/xhtml&quot;">http://www.w3.org/1999/xhtml&quot;</A> lang=&quot;en&quot; xml:lang=&quot;en&quot;&gt;
&lt;head&gt;
&lt;title&gt;Server error!&lt;/title&gt;
&lt;link rev=&quot;made&quot; href=&quot;mailto:%5bno%20address%20given%5d&quot; /&gt;
&lt;style type=&quot;text/css&quot;&gt;&lt;!--/*--&gt;&lt;![CDATA[/*&gt;&lt;!--*/ 
    body { color: #000000; background-color: #FFFFFF; }
    a:link { color: #0000CC; }
    p, address {margin-left: 3em;}
    span {font-size: smaller;}
/*]]&gt;*/--&gt;&lt;/style&gt;
&lt;/head&gt;

&lt;body&gt;
&lt;h1&gt;Server error!&lt;/h1&gt;
&lt;p&gt;


  

    The server encountered an internal error and was 
    unable to complete your request. Either the server is
    overloaded or there was an error in a CGI script.

  

&lt;/p&gt;
&lt;p&gt;
If you think this is a server error, please contact
the &lt;a href=&quot;mailto:%5bno%20address%20given%5d&quot;&gt;webmaster&lt;/a&gt;.

&lt;/p&gt;

&lt;h2&gt;Error 500&lt;/h2&gt;
&lt;address&gt;
  &lt;a href=&quot;/&quot;&gt;gerf.org&lt;/a&gt;&lt;br /&gt;
  
  &lt;span&gt;Fri Sep  9 09:39:58 2005&lt;br /&gt;
  Apache/2.0.54 (Debian GNU/Linux) DAV/2 SVN/1.1.4 mod_fastcgi/2.4.2 mod_python/3.1.3 Python/2.3.5 PHP/4.3.10-16 mod_ssl/2.0.54 OpenSSL/0.9.7e&lt;/span&gt;
&lt;/address&gt;
&lt;/body&gt;
&lt;/html&gt;

docwhat % lynx -source <A HREF="http://gerf.org/test/mptest.py">http://gerf.org/test/mptest.py</A>
&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot;
  &quot;<A HREF="http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;">http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;</A>&gt;
&lt;html xmlns=&quot;<A HREF="http://www.w3.org/1999/xhtml&quot;">http://www.w3.org/1999/xhtml&quot;</A> lang=&quot;en&quot; xml:lang=&quot;en&quot;&gt;
&lt;head&gt;
&lt;title&gt;Server error!&lt;/title&gt;
&lt;link rev=&quot;made&quot; href=&quot;mailto:%5bno%20address%20given%5d&quot; /&gt;
&lt;style type=&quot;text/css&quot;&gt;&lt;!--/*--&gt;&lt;![CDATA[/*&gt;&lt;!--*/ 
    body { color: #000000; background-color: #FFFFFF; }
    a:link { color: #0000CC; }
    p, address {margin-left: 3em;}
    span {font-size: smaller;}
/*]]&gt;*/--&gt;&lt;/style&gt;
&lt;/head&gt;

&lt;body&gt;
&lt;h1&gt;Server error!&lt;/h1&gt;
&lt;p&gt;


  

    The server encountered an internal error and was 
    unable to complete your request. Either the server is
    overloaded or there was an error in a CGI script.

  

&lt;/p&gt;
&lt;p&gt;
If you think this is a server error, please contact
the &lt;a href=&quot;mailto:%5bno%20address%20given%5d&quot;&gt;webmaster&lt;/a&gt;.

&lt;/p&gt;

&lt;h2&gt;Error 500&lt;/h2&gt;
&lt;address&gt;
  &lt;a href=&quot;/&quot;&gt;gerf.org&lt;/a&gt;&lt;br /&gt;
  
  &lt;span&gt;Fri Sep  9 09:39:59 2005&lt;br /&gt;
  Apache/2.0.54 (Debian GNU/Linux) DAV/2 SVN/1.1.4 mod_fastcgi/2.4.2 mod_python/3.1.3 Python/2.3.5 PHP/4.3.10-16 mod_ssl/2.0.54 OpenSSL/0.9.7e&lt;/span&gt;
&lt;/address&gt;
&lt;/body&gt;
&lt;/html&gt;

docwhat % lynx -source <A HREF="http://gerf.org/test/mptest.py">http://gerf.org/test/mptest.py</A>
&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot;
  &quot;<A HREF="http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;">http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;</A>&gt;
&lt;html xmlns=&quot;<A HREF="http://www.w3.org/1999/xhtml&quot;">http://www.w3.org/1999/xhtml&quot;</A> lang=&quot;en&quot; xml:lang=&quot;en&quot;&gt;
&lt;head&gt;
&lt;title&gt;Server error!&lt;/title&gt;
&lt;link rev=&quot;made&quot; href=&quot;mailto:%5bno%20address%20given%5d&quot; /&gt;
&lt;style type=&quot;text/css&quot;&gt;&lt;!--/*--&gt;&lt;![CDATA[/*&gt;&lt;!--*/ 
    body { color: #000000; background-color: #FFFFFF; }
    a:link { color: #0000CC; }
    p, address {margin-left: 3em;}
    span {font-size: smaller;}
/*]]&gt;*/--&gt;&lt;/style&gt;
&lt;/head&gt;

&lt;body&gt;
&lt;h1&gt;Server error!&lt;/h1&gt;
&lt;p&gt;


  

    The server encountered an internal error and was 
    unable to complete your request. Either the server is
    overloaded or there was an error in a CGI script.

  

&lt;/p&gt;
&lt;p&gt;
If you think this is a server error, please contact
the &lt;a href=&quot;mailto:%5bno%20address%20given%5d&quot;&gt;webmaster&lt;/a&gt;.

&lt;/p&gt;

&lt;h2&gt;Error 500&lt;/h2&gt;
&lt;address&gt;
  &lt;a href=&quot;/&quot;&gt;gerf.org&lt;/a&gt;&lt;br /&gt;
  
  &lt;span&gt;Fri Sep  9 09:40:00 2005&lt;br /&gt;
  Apache/2.0.54 (Debian GNU/Linux) DAV/2 SVN/1.1.4 mod_fastcgi/2.4.2 mod_python/3.1.3 Python/2.3.5 PHP/4.3.10-16 mod_ssl/2.0.54 OpenSSL/0.9.7e&lt;/span&gt;
&lt;/address&gt;
&lt;/body&gt;
&lt;/html&gt;

docwhat % lynx -source <A HREF="http://gerf.org/test/mptest.py">http://gerf.org/test/mptest.py</A>
&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot;
  &quot;<A HREF="http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;">http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;</A>&gt;
&lt;html xmlns=&quot;<A HREF="http://www.w3.org/1999/xhtml&quot;">http://www.w3.org/1999/xhtml&quot;</A> lang=&quot;en&quot; xml:lang=&quot;en&quot;&gt;
&lt;head&gt;
&lt;title&gt;Server error!&lt;/title&gt;
&lt;link rev=&quot;made&quot; href=&quot;mailto:%5bno%20address%20given%5d&quot; /&gt;
&lt;style type=&quot;text/css&quot;&gt;&lt;!--/*--&gt;&lt;![CDATA[/*&gt;&lt;!--*/ 
    body { color: #000000; background-color: #FFFFFF; }
    a:link { color: #0000CC; }
    p, address {margin-left: 3em;}
    span {font-size: smaller;}
/*]]&gt;*/--&gt;&lt;/style&gt;
&lt;/head&gt;

&lt;body&gt;
&lt;h1&gt;Server error!&lt;/h1&gt;
&lt;p&gt;


  

    The server encountered an internal error and was 
    unable to complete your request. Either the server is
    overloaded or there was an error in a CGI script.

  

&lt;/p&gt;
&lt;p&gt;
If you think this is a server error, please contact
the &lt;a href=&quot;mailto:%5bno%20address%20given%5d&quot;&gt;webmaster&lt;/a&gt;.

&lt;/p&gt;

&lt;h2&gt;Error 500&lt;/h2&gt;
&lt;address&gt;
  &lt;a href=&quot;/&quot;&gt;gerf.org&lt;/a&gt;&lt;br /&gt;
  
  &lt;span&gt;Fri Sep  9 09:40:01 2005&lt;br /&gt;
  Apache/2.0.54 (Debian GNU/Linux) DAV/2 SVN/1.1.4 mod_fastcgi/2.4.2 mod_python/3.1.3 Python/2.3.5 PHP/4.3.10-16 mod_ssl/2.0.54 OpenSSL/0.9.7e&lt;/span&gt;
&lt;/address&gt;
&lt;/body&gt;
&lt;/html&gt;

docwhat % lynx -source <A HREF="http://gerf.org/test/mptest.py">http://gerf.org/test/mptest.py</A>

docwhat % echo I pressed control c, it never came back.
I pressed control c, it never came back.
docwhat % sudo /etc/init.d/apache2 stop
Stopping web server: Apache2.
docwhat % sudo /etc/init.d/apache2 stop
Stopping web server: Apache2 ... no pidfile found! not running?.
docwhat % sudo /etc/init.d/apache2 start
Starting web server: Apache2.
docwhat % lynx -source <A HREF="http://gerf.org/test/mptest.py">http://gerf.org/test/mptest.py</A>
Hello World!
Script done on Fri Sep  9 09:45:58 2005
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018986.html">[mod_python] apachectl restart == dead mod_python
</A></li>
	<LI>Next message: <A HREF="018988.html">[mod_python] mod_python + MySQLdb + Apache strange behavoir
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18995">[ date ]</a>
              <a href="thread.html#18995">[ thread ]</a>
              <a href="subject.html#18995">[ subject ]</a>
              <a href="author.html#18995">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
