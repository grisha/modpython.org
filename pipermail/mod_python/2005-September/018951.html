<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] transhandler setup?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20transhandler%20setup%3F&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018949.html">
   <LINK REL="Next"  HREF="018952.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] transhandler setup?</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20transhandler%20setup%3F&In-Reply-To="
       TITLE="[mod_python] transhandler setup?">grahamd at dscpl.com.au
       </A><BR>
    <I>Thu Sep  1 21:39:08 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="018949.html">[mod_python] transhandler setup?
</A></li>
        <LI>Next message: <A HREF="018952.html">[mod_python] transhandler setup?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18951">[ date ]</a>
              <a href="thread.html#18951">[ thread ]</a>
              <a href="subject.html#18951">[ subject ]</a>
              <a href="author.html#18951">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>IR labs wrote ..
&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> I am not sure whether I should start a new thread, but my issues are 
</I>&gt;<i> not yet solved and the subject line is still partly accurate, so I'll 
</I>&gt;<i> just continue.
</I>&gt;<i> 
</I>&gt;<i> To get my ideas working, I tried both the options that I saw in my last
</I>&gt;<i> post, but I am getting stuck in both.
</I>&gt;<i> 
</I>&gt;<i> Let me start with the one, with which I progressed the most:
</I>&gt;<i> 1. Don't use transhandler. Have a main.py as the PythonHandler for the
</I>&gt;<i> www/root directory.
</I>&gt;<i> 
</I>&gt;<i> &lt;Directory /var/www/root&gt;
</I>&gt;<i>      SetHandler mod_python
</I>&gt;<i>      PythonHandler main
</I>&gt;<i> &lt;/Directory&gt;
</I>&gt;<i> 
</I>&gt;<i> ---- with main.py: ----
</I>&gt;<i> def handler(req):
</I>&gt;<i> 	extension = os.path.splitext(req.filename)[1]
</I>&gt;<i> 	if extension == &quot;.html&quot; or extension == &quot;&quot;:
</I>&gt;<i> 		if not os.path.exists(req.filename):
</I>&gt;<i> 			... (handle further)
</I>&gt;<i> 			return apache.OK
</I>&gt;<i> 		else:
</I>&gt;<i> 			if extension == '':
</I>&gt;<i> 				req.filename = req.filename + &quot;/index.html&quot; # THIS LINE SEEMS NOT
</I>&gt;<i> TO HAVE AN EFFECT
</I>
Correct, it will not. You need to do an internal or external redirect to the URI
corresponding to what you want. For external redirect, you probably want:

  from mod_python import util
  util.redirect(req.uri+'/index.html')

This will send back a status to the browser to tell it to look in the alternate
location.

For an internal redirect, you probably want:

  req.internal_redirect(req.uri+'/index.html')

This will not send a response back to the browser and it will managed internal
to Apache. The downside of this approach is that the same page is returned
under two different URLs, as index.html can also be accessed directly. This
confuses the results of search engines.

&gt;<i> 			return apache.DECLINED
</I>&gt;<i> 	else:
</I>&gt;<i> 		return apache.DECLINED
</I>&gt;<i> 
</I>&gt;<i> When a url is requested for an existent .html file, it works fine: 
</I>&gt;<i> apache serves the .html file itself. However if the url is only the 
</I>&gt;<i> name of a directory, I can't seem to give apache its normal &#150;complete&#150;
</I>&gt;<i> behavior. (E.g. the url www.foobar.com/foo/ (assuming the directory 
</I>&gt;<i> foo/ exists) does not return a directory listing of the contents of 
</I>&gt;<i> that directory nor does it display www.foobar.com/foo/index.html if 
</I>&gt;<i> there is such a file.) And it seems I also can't change the filename 
</I>&gt;<i> anymore in that handler phase. The only solution I found was to put an
</I>&gt;<i> .htaccess file in /foo/ saying &quot;SetHandler none&quot;. But I was actually 
</I>&gt;<i> looking for a way in which I would not need these .htaccess files when
</I>&gt;<i> there is just an index.html present. Is there any way I still can set 
</I>&gt;<i> the filename in this phase?
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Then I thought that maybe transhandler could help me in the end, but I
</I>&gt;<i> got stuck with that one rather soon.
</I>&gt;<i> 2. Using transhandler to set the filename and have it decide what 
</I>&gt;<i> apache should be doing.
</I>&gt;<i> 
</I>&gt;<i> &lt;IfModule mod_python.c&gt;
</I>&gt;<i>      PythonPath &quot;sys.path + ['/var/www/python/']&quot;
</I>&gt;<i>      PythonTransHandler translate
</I>
Try adding here in addition to the above:

  AddHandler mod_python .py
  PythonHandler main

Ie., rather than trying to use req.add_handler(). What happens then?

&gt;<i> &lt;/IfModule&gt;
</I>&gt;<i> 
</I>&gt;<i> ---- and from translate.py: ----
</I>&gt;<i> 
</I>&gt;<i> def transhandler(req):
</I>&gt;<i> 	...
</I>&gt;<i> 	req.filename = '/var/www/python/main.py'
</I>&gt;<i> 	return apache.OK
</I>&gt;<i> 
</I>&gt;<i> The issue I run against is that now apache shows the code from main.py.
</I>&gt;<i> It doesn't execute it, it just shows the code. Despite all the other 
</I>&gt;<i> directives I use (in httpd.conf or .htaccess). Even when I add the line
</I>&gt;<i> 'req.add_handler(&quot;PythonHandler&quot;, &quot;main&quot;)' to the mix, it won't execute
</I>&gt;<i> main.py, just displays its code. Any ideas how to I solve this?
</I>&gt;<i> 
</I>&gt;<i> Many thanks,
</I>&gt;<i> dirk
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On 31-aug-05, at 00:49, Graham Dumpleton wrote:
</I>&gt;<i> 
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On 31/08/2005, at 5:44 AM, IR labs wrote:
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; But thanks for this solution to have everything (also the stuff we 
</I>&gt;<i> &gt;&gt; don't want to handle) handled by the handler in main.py.
</I>&gt;<i> &gt;&gt; My only remaining question now, would be what you recommend?
</I>&gt;<i> &gt;&gt; 1. Don't use the transhandle phase, and have *all* requests handled
</I>&gt;<i> &gt;&gt; by the main PythonHandler, including the ones it shouldn't handle (
</I>&gt;<i> &gt;&gt; apache.DECLINE)
</I>&gt;<i> &gt;&gt; or.
</I>&gt;<i> &gt;&gt; 2. Use the TransHandler phase to discern between real physical 
</I>&gt;<i> &gt;&gt; present files (requests for .html, .css, .js etc. files) and virtual
</I>&gt;<i> &gt;&gt; pages that should be handled by main.py
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; It all depends on exactly what you want to do, as these probably aren't
</I>&gt;<i> &gt; the only alternatives. If you want a request against a directory to be
</I>&gt;<i> &gt; rerouted, look at the DirectoryIndex directive. If you want to reroute
</I>&gt;<i> &gt; a
</I>&gt;<i> &gt; request against a non existent file based on a specific extension type,
</I>&gt;<i> &gt; you may also be able to use mod_rewrite. Finally, there is also the
</I>&gt;<i> &gt; ErrorDocument directive for non existent files as well. All of these
</I>&gt;<i> &gt; might feasibly be harnessed to provide part of the solution and using
</I>&gt;<i> &gt; Python to make the decision may be a more complicated choice than some
</I>&gt;<i> &gt; of Apache's core features designed for this sort of thing.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Graham
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> 
</I>&gt;<i> -----------------------------
</I>&gt;<i> Dirk van Oosterbosch
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">dirk at ixopusada.com</A>
</I>&gt;<i> -----------------------------
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I></PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018949.html">[mod_python] transhandler setup?
</A></li>
	<LI>Next message: <A HREF="018952.html">[mod_python] transhandler setup?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18951">[ date ]</a>
              <a href="thread.html#18951">[ thread ]</a>
              <a href="subject.html#18951">[ subject ]</a>
              <a href="author.html#18951">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
