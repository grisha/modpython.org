<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] PythonImport: Can someone please draw a diagram
	for	this idiot?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20PythonImport%3A%20Can%20someone%20please%20draw%20a%20diagram%0A%09for%09this%20idiot%3F&In-Reply-To=4328BA7F.7040008%40sympatico.ca">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019048.html">
   <LINK REL="Next"  HREF="019051.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] PythonImport: Can someone please draw a diagram
	for	this idiot?</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Jorey Bump</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20PythonImport%3A%20Can%20someone%20please%20draw%20a%20diagram%0A%09for%09this%20idiot%3F&In-Reply-To=4328BA7F.7040008%40sympatico.ca"
       TITLE="[mod_python] PythonImport: Can someone please draw a diagram
	for	this idiot?">list at joreybump.com
       </A><BR>
    <I>Wed Sep 14 21:05:21 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="019048.html">[mod_python] PythonImport: Can someone please draw a diagram
	for	this idiot?
</A></li>
        <LI>Next message: <A HREF="019051.html">[mod_python] PythonImport: Can someone please draw a diagram
	for	this idiot?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19049">[ date ]</a>
              <a href="thread.html#19049">[ thread ]</a>
              <a href="subject.html#19049">[ subject ]</a>
              <a href="author.html#19049">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Jim Gallacher wrote:

&gt;<i> In answer to my own in question, PythonImport does work and there is no 
</I>&gt;<i> bug. Re-reading the docs reveals this small detail which I and others 
</I>&gt;<i> may have overlooked - the context for the directive. PythonImport only 
</I>&gt;<i> works in the server config context. Quoting from the apache docs 
</I>&gt;<i> (<A HREF="http://httpd.apache.org/docs/2.0/mod/directive-dict.html#Context">http://httpd.apache.org/docs/2.0/mod/directive-dict.html#Context</A>)
</I>&gt;<i> 
</I>&gt;<i> &quot;&quot;&quot;
</I>&gt;<i> server config
</I>&gt;<i>     This means that the directive may be used in the server 
</I>&gt;<i> configuration files (e.g., httpd.conf), but not within any &lt;VirtualHost&gt; 
</I>&gt;<i> or &lt;Directory&gt; containers. It is not allowed in .htaccess files at all.
</I>&gt;<i> &quot;&quot;&quot;
</I>&gt;<i> 
</I>&gt;<i> I'll update the docs to make this a little more explicit, since it's 
</I>&gt;<i> easy to overlook. I know I did. :)
</I>&gt;<i> 
</I>&gt;<i> Hope that helps.
</I>
Yes, it does. For a simple demo, put a module in the default module 
search path, such as a directory shown in sys.path when running python 
from the command line. PythonPath directives in httpd.conf will not have 
taken effect when PythonImport runs (I used 
/usr/lib/python2.4/site-packages/ for my test).

# mpglobal.py

import time

f = open('tmp/atest', 'w')
f.write(str(time.time()))
f.close()

foo = 'testing'


Then in httpd.conf (using your own interpreter name):

PythonImport mpglobal www.example.com

On Linux, restarting apache creates and/or updates /tmp/atest, verifying 
that it works.

But, like the OP, I can't figure out how to access foo (or mpglobal.foo) 
in my published module.

Also, here is a better module to run under Publisher to check various 
settings, including the name of the interpreter (and I remembered to 
include sys.path this time!):

&quot;&quot;&quot;
info.py

Display various settings/variables under mod_python.publisher.

Access at:

  <A HREF="http://host/somedir/info.py/index">http://host/somedir/info.py/index</A>

or:

  <A HREF="http://host/somedir/info/">http://host/somedir/info/</A>

To check form variables, set form action to:

  <A HREF="http://host/somedir/info.py/showformdata">http://host/somedir/info.py/showformdata</A>

&quot;&quot;&quot;

from mod_python import apache
import os
import sys

topdir = []
for i in dir():
     topdir.append(i)

def showformdata(req):
     formdata = {}
     if req.form.keys():
         for key in req.form.keys():
             formdata[key] = req.form[key]
         return formdata
     else:
         return &quot;no form data&quot;

def index(req):
     d = []
     d.append(&quot;Interpreter Name (req.interpreter):&quot; )
     d.append(req.interpreter)
     d.append(&quot;\nsys.path:&quot;)
     d.append('\n'.join(sys.path))
     d.append(&quot;\nRequest (req.the_request):&quot;)
     d.append(req.the_request)
     d.append(&quot;\nProtocol (req.protocol):&quot;)
     d.append(req.protocol)
     d.append(&quot;\nMethod (req.method):&quot;)
     d.append(req.method)
     d.append(&quot;\nreq.subprocess_env:&quot;)
     d.extend([&quot;%s: %s&quot; % (i, req.subprocess_env[i]) for i in 
req.subprocess_env.keys()])
     d.append(&quot;\nreq.filename:&quot;)
     d.append(req.filename)
     d.append(&quot;\nreq.path_info:&quot;)
     d.append(req.path_info)
     d.append(&quot;\nenvironment PATH:&quot;)
     d.append(os.environ['PATH'])
     d.append(&quot;\ndir():&quot;)
     d.extend(topdir)
     return &quot;\n&quot;.join(d)

</PRE>

















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019048.html">[mod_python] PythonImport: Can someone please draw a diagram
	for	this idiot?
</A></li>
	<LI>Next message: <A HREF="019051.html">[mod_python] PythonImport: Can someone please draw a diagram
	for	this idiot?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19049">[ date ]</a>
              <a href="thread.html#19049">[ thread ]</a>
              <a href="subject.html#19049">[ subject ]</a>
              <a href="author.html#19049">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
