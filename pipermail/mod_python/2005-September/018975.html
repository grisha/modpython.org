<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] transhandler setup?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20transhandler%20setup%3F&In-Reply-To=7e5aabe58c2c13fb937de754bb28d6f3%40ixopusada.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018961.html">
   <LINK REL="Next"  HREF="018976.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] transhandler setup?</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20transhandler%20setup%3F&In-Reply-To=7e5aabe58c2c13fb937de754bb28d6f3%40ixopusada.com"
       TITLE="[mod_python] transhandler setup?">grahamd at dscpl.com.au
       </A><BR>
    <I>Thu Sep  8 11:38:21 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="018961.html">[mod_python] transhandler setup?
</A></li>
        <LI>Next message: <A HREF="018976.html">[mod_python] transhandler setup?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18975">[ date ]</a>
              <a href="thread.html#18975">[ thread ]</a>
              <a href="subject.html#18975">[ subject ]</a>
              <a href="author.html#18975">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On 05/09/2005, at 3:08 AM, Dirk van Oosterbosch, IR labs wrote:
&gt;<i>
</I>&gt;<i> I mixed up two versions of  main.py  I had laying around. (I modified 
</I>&gt;<i> my translate.py so the  req.filename  becomes  main_from_trans.py , 
</I>&gt;<i> but didn't use that name in the  PythonHandler  directive).
</I>&gt;<i> It does strike me as strange however, that I have to use   
</I>&gt;<i> PythonHander python_main_file   in the apache configuration, when I 
</I>&gt;<i> have the transhandler decide that it should use python_main_file.py as 
</I>&gt;<i> filename. That would mean I can't make the transhandler fork its 
</I>&gt;<i> behavior between different python files as the ones that should become 
</I>&gt;<i> the filename and should be handled in the next phase (handler  that 
</I>&gt;<i> is). (Unless I have it fork to different directories and use different 
</I>&gt;<i> &lt;Directory&gt; configurations, of course)
</I>&gt;<i> ...
</I>&gt;<i> I mean something like:
</I>&gt;<i> -----translate.py:
</I>&gt;<i> def transhandler(req):
</I>&gt;<i> 	...
</I>&gt;<i> 	if fork == 1:
</I>&gt;<i> 		req.filename = &quot;/var/www/python/main_alternative_a.py&quot;
</I>&gt;<i> 	else:
</I>&gt;<i> 		req.filename = &quot;/var/www/python/main_alternative_b.py&quot;
</I>&gt;<i> 	return apache.OK
</I>&gt;<i> -----
</I>&gt;<i> wouldn't work because I would have to say
</I>
You misunderstand what is happening. What is important in respect of
what req.filename is set to is not the full pathname, but just the
extension to the last component of the filename. Ie., the presence of
the &quot;.py&quot; extension. It is this which triggers the execution of the
handler specified by the PythonHandler directive.

Try setting PythonHandler to &quot;main&quot; and then in your transhandler set
set req.filename to either a or b alternative. The main.py handler
will still be executed. In your main.py handler you could then say:

   def handler(req):
     directory,file = os.path.split(req.filename)
     name = os.path.splitext(file)
     module = apache.import_module(name,path=[directory])
     return module.handler(req)

Ie., your main.py then becomes a simple dispatcher which defers to
what ever req.filename is set to.

&gt;<i> Also I found out that if I add
</I>&gt;<i> req.add_handler(&quot;PythonHandler&quot;, &quot;main&quot;)
</I>&gt;<i> to translate.py it executes the handler from main.py twice (you get a 
</I>&gt;<i> double html file) , but only if it can successfully do the first one 
</I>&gt;<i> (set by  req.filename = &quot;/var/www/python/main.py&quot; .
</I>
See the documentation for listing of multiple handlers:

   <A HREF="http://www.modpython.org/live/current/doc-html/dir-handlers-syn.html">http://www.modpython.org/live/current/doc-html/dir-handlers-syn.html</A>

In particular:

   Multiple handlers can be specified on a single line, in which case 
they
   will be called sequentially, from left to right. Same handler 
directives
   can be specified multiple times as well, with the same result - all
   handlers listed will be executed sequentially, from first to last. If
   any handler in the sequence returns a value other than apache.OK, then
   execution of all subsequent handlers is aborted.

Thus, if your had &quot;main&quot; specified for PythonHandler and then had the
transhandler add it again using req.add_handler(), then yes it will be
executed twice if each returns apache.OK.

If you don't specify it in the PythonHandler directive and use just
req.add_handler() will it work. Note that you will still need to 
probably
specify AddHandler for .py extension. If it doesn't work, might be seen
as a shortcoming in Apache/mod_python.

&gt;&gt;<i> For an internal redirect, you probably want:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   req.internal_redirect(req.uri+'/index.html')
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This will not send a response back to the browser and it will managed 
</I>&gt;&gt;<i> internal
</I>&gt;&gt;<i> to Apache.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Question I now have: does anybody know how efficient this internal 
</I>&gt;<i> redirect would be in comparison to a database query?
</I>&gt;<i> For the point is, that with option 1, all the static directories 
</I>&gt;<i> (requests for www.myserver.com/folder) will go through apache twice: 
</I>&gt;<i> (It first is handled by handler in main.py which then decides it 
</I>&gt;<i> should be www.myserver.com/folder/index.html anyway.
</I>&gt;<i> How economically inefficient is that performance wise?
</I>&gt;<i> The alternative, option 2, has the downside of two database queries 
</I>&gt;<i> for every dynamic page: First transhandler checks whether the url 
</I>&gt;<i> exists in the database. Then later, handler again queries the database 
</I>&gt;<i> for this url.
</I>
At a guess, Apache is going to be quicker at servicing a request than
a database query. This would really depend on your setup though.

&gt;<i> Is one of these alternatives much more performance intensive than the 
</I>&gt;<i> other?
</I>&gt;<i> I know I am comparing apples with pears here. The one is an internal 
</I>&gt;<i> redirect handled between mod_python and apache. The other is a 
</I>&gt;<i> database query handled my MySQL and MySQLdb (which is also dependent 
</I>&gt;<i> to how the database is designed and which field are indexed and so 
</I>&gt;<i> on...). Further more the decision between the two options is also 
</I>&gt;<i> dependent on how many these scenarios occur: do I have a lot of static 
</I>&gt;<i> index.html files which are requested by only their directory, or do I 
</I>&gt;<i> serve mostly dynamic pages.
</I>&gt;<i> So indeed the decision won't be just a matter of comparing 
</I>&gt;<i> performances of the two, but if someone can just give me a &quot;handle&quot;...
</I>
You are really just going to have to test each option.

Graham

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018961.html">[mod_python] transhandler setup?
</A></li>
	<LI>Next message: <A HREF="018976.html">[mod_python] transhandler setup?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18975">[ date ]</a>
              <a href="thread.html#18975">[ thread ]</a>
              <a href="subject.html#18975">[ subject ]</a>
              <a href="author.html#18975">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
