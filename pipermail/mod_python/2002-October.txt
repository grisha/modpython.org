From sh at hob.cx  Tue Oct  1 18:02:44 2002
From: sh at hob.cx (Sean Holdsworth)
Date: Fri Jan  9 21:47:03 2004
Subject: [mod_python] Redirect from publisher - again...
Message-ID: <1033491764.10863.57.camel@hag.private.net>

I'm having a problem getting redirects working from a publisher handler.
I've seen the item in the FAQ (and can get redirection from
non-publisher handlers working fine). This issue also seems to crop up
fairly often in the mod_python list. Grisha has answered the question
before with the following example code.

req.headers_out['location'] = 'http://www.modpython.org/'
req.status = apache.HTTP_MOVED_TEMPORARILY
return "You are being redirected to http://www.modpython.org/"

When I run this I get the "You are being redirected..." message
displayed, and it just sits there. I've been trying to get this to work
for a couple of days and am beginning to wonder if it could be an Apache
setting that is causing the problem?

In addition to the publisher handler I have one handler, the
PythonAccessHandler configured. I use this to manage cookies and
redirect to a login page if the client hasn't authenticated. The
login page has a form with an action that causes the handler that
I'm trying to redirect out of to be run.

I'm running Apache 1.3.23 and  mod_python 2.7.8 with python 2.2 on
Mandrake 8.2 Linux. Could someone please run the above code
fragment as a policy handler and confirm that it is just me and my
configuration that has the problem?

Thanks, Sean



From rmunn at pobox.com  Wed Oct  2 01:27:51 2002
From: rmunn at pobox.com (rmunn@pobox.com)
Date: Fri Jan  9 21:47:03 2004
Subject: [mod_python] Patch to allow kwargs in publisher.py
Message-ID: <20021002062751.GA26230@rmunnlfs>

While playing around with my brand new install of mod_python 3.0.0 beta
2, I discovered that publisher.py does not handle the **kwargs syntax in
functions it's dispatching to. Apparently I'm not the only one who wants
that feature added:

http://www.modpython.org/pipermail/mod_python/2002-June/002171.html

It seems like the Right Thing for publisher.py's handler() func to do
would be to check whether the function accepts the **kwargs syntax
before stripping out unexpected args. Presumably if the user asked for
**kwargs-style args to be passed, he is expecting to receive all the
GET/POST arguments in the **kwargs dictionary. It would be intuitive
(it's what I was expecting to happen, actually, and I was surprised that
it didn't) and useful. And since it hadn't been done yet, I went ahead
and did it -- it was surprisingly simple. Here's a patch. It seems to
work fine for me -- I can't say I've given it a foolproof amount of
testing, but every test I threw at it seemed to do what I expected.

-- 
Robin Munn
rmunn@pobox.com


--- lib/python/mod_python/publisher.py	2002-09-12 13:24:05.000000000 -0500
+++ lib/python/mod_python/publisher.py.new	2002-10-02 01:07:46.000000000 -0500
@@ -180,10 +180,17 @@
             fc = object.im_func.func_code
             expected = fc.co_varnames[1:fc.co_argcount]
 
-        # remove unexpected args
-        for name in args.keys():
-            if name not in expected:
-                del args[name]
+        # does it want keyword args?
+        # co_flags & 0x04 is set if a function wants *args syntax
+        # co_flags & 0x08 is set if a function wants **kwargs syntax
+        if fc.co_flags & 0x08:
+            # don't strip unexpected args if function wants **kwargs
+            pass
+        else:
+            # remove unexpected args
+            for name in args.keys():
+                if name not in expected:
+                    del args[name]
 
         result = apply(object, (), args)
 

From rmunn at pobox.com  Wed Oct  2 08:59:13 2002
From: rmunn at pobox.com (rmunn@pobox.com)
Date: Fri Jan  9 21:47:03 2004
Subject: [mod_python] Documentation patch for kwargs change in publisher.py
Message-ID: <20021002135913.GA29104@rmunnlfs>

To go along with my earlier patch adding **kwargs functionality to the
publisher.py dispatcher, here's a documentation patch to keep the docs
up-to-date.

-- 
Robin Munn
rmunn@pobox.com



--- doc-html/hand-pub-alg-args.html	2002-09-24 11:59:13.000000000 -0500
+++ doc-html/hand-pub-alg-args.html.new	2002-10-02 08:52:51.000000000 -0500
@@ -58,7 +58,11 @@
 object expects. This list is compared with names of fields from HTML
 form data submitted by the client via <code>POST</code> or
 <code>GET</code>. Values of fields whose names match the names of callable
-object arguments will be passed as strings.
+object arguments will be passed as strings. Any fields whose names do
+not match the names of callable argument objects will be silently dropped.
+But if the destination callable object has a <code>**kwargs</code> style
+argument, then fields with unmatched names will be passed in the
+<code>**kwargs</code> argument instead.
 
 <P>
 If the destination is not callable or is a class, then its string

From rmunn at pobox.com  Wed Oct  2 09:25:40 2002
From: rmunn at pobox.com (rmunn@pobox.com)
Date: Fri Jan  9 21:47:03 2004
Subject: [mod_python] Documentation patch (another one) for hand-pub-alg-args.html
Message-ID: <20021002142540.GB29104@rmunnlfs>

Having sent in a patch to hand-pub-alg-args.html just now, I realized
that another paragraph would probably be a good idea, to explain why
it's a bad idea to have any fields called req in the HTML request, since
they would be silently dropped in the publisher.py code. I can just see
someone spending days on figuring out what's happening when all his
fields but one are getting passed through kwargs...

So here's another documentation patch. This one supersedes the doc patch
I just sent -- that is, it's meant to be applied to the original
hand-pub-alg-args.html file, not the updated version that my earlier
patch would produce.

-- 
Robin Munn
rmunn@pobox.com




--- doc-html/hand-pub-alg-args.html	2002-09-24 11:59:13.000000000 -0500
+++ doc-html/hand-pub-alg-args.html.new	2002-10-02 09:16:14.000000000 -0500
@@ -58,7 +58,21 @@
 object expects. This list is compared with names of fields from HTML
 form data submitted by the client via <code>POST</code> or
 <code>GET</code>. Values of fields whose names match the names of callable
-object arguments will be passed as strings.
+object arguments will be passed as strings. Any fields whose names do
+not match the names of callable argument objects will be silently dropped.
+But if the destination callable object has a <code>**kwargs</code> style
+argument, then fields with unmatched names will be passed in the
+<code>**kwargs</code> argument instead.
+
+<P>
+Note that the HTML request argument is passed as <code>req</code> to the
+callable object, so if the form data had any field called <code>req</code>,
+that field will be inaccessible in the callable object code. Fields called
+<code>self</code> will also cause problems for instance methods. If you
+absolutely must have a field named <code>self</code>, then you'd be well
+advised to call the first parameter of the instance method something else,
+such as <code>instobj</code>, or some other name that won't conflict with
+any field names.
 
 <P>
 If the destination is not callable or is a class, then its string

From dagurp at heimsnet.is  Wed Oct  2 14:51:21 2002
From: dagurp at heimsnet.is (=?iso-8859-1?Q?Dagur_P=E1ll_Ammendrup?=)
Date: Fri Jan  9 21:47:03 2004
Subject: [mod_python] Webhost with mod_python?
Message-ID: <001401c26a23$3105d2a0$5d016f0a@dagur>

Hi
Does anyone know of a webhost that offers mod_python and MySQL?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20021002/ffe7a433/attachment.htm
From wilk-ml at flibuste.net  Wed Oct  2 22:05:31 2002
From: wilk-ml at flibuste.net (William Dode)
Date: Fri Jan  9 21:47:03 2004
Subject: [mod_python] Webhost with mod_python?
In-Reply-To: <001401c26a23$3105d2a0$5d016f0a@dagur>
References: <001401c26a23$3105d2a0$5d016f0a@dagur>
Message-ID: <87adlwppx0.fsf@flibuste.net>

Dagur P?ll Ammendrup <dagurp@heimsnet.is> writes:

> Hi
> Does anyone know of a webhost that offers mod_python and MySQL?

I would like to know how it's possible to install mod_python in a shared
web hosting when it's not possible to change the user id like suexec and
there is not safe_mod like php...

An other solution ?

-- 
William - http://wikipython.tuxfamily.org


From list-mod_python at empires.org  Wed Oct  2 14:36:40 2002
From: list-mod_python at empires.org (Jeff Davis)
Date: Fri Jan  9 21:47:03 2004
Subject: [mod_python] Webhost with mod_python?
In-Reply-To: <87adlwppx0.fsf@flibuste.net>
References: <001401c26a23$3105d2a0$5d016f0a@dagur> <87adlwppx0.fsf@flibuste.net>
Message-ID: <200210021436.40191.list-mod_python@empires.org>

> Dagur P?ll Ammendrup <dagurp@heimsnet.is> writes:
> > Hi
> > Does anyone know of a webhost that offers mod_python and MySQL?
>
> I would like to know how it's possible to install mod_python in a shared
> web hosting when it's not possible to change the user id like suexec and
> there is not safe_mod like php...
>
> An other solution ?

In apache2 there will exist an MPM called "mpm_perchild" that spawns a 
separate process for each virtualhost under the virtualhost's userid, and 
then each request to that virtualhost spawns a thread. That is the ideal 
solution. Unfortunately, it's not released in any kind of stable way yet.

Regards,
	Jeff Davis





From neel at mediapulse.com  Wed Oct  2 23:32:03 2002
From: neel at mediapulse.com (Michael Neel)
Date: Fri Jan  9 21:47:03 2004
Subject: [mod_python] MySQL Authencation
In-Reply-To: <200210021436.40191.list-mod_python@empires.org>
Message-ID: <000001c26a8d$7102d820$0400a8c0@clapton>

Hi All,

	I was wondering if anyone has done an SQL authencation module
for mod_python, not unlike mod_perl's Apache::DBI::Auth.  I'm looking
for MySQL, but I could work with any module and rewrite what is needed
to switch db's.  I'm also using apache 2.0 and mod_python 3, but I could
work from a 1.3 / 2.7 module.  I just don't want to start from scratch
if I don't need to.  I've tried to get mod_auth_mysql working under
apache 2, but that projects has more forks than the Sunday table so I'm
not quite sure where to ask install questions there.  Worst case I could
move to RedHat 8, which ships with apache 2, mod_python 3, and
mod_mysql_auth - but that seems like a lot of extra work to get SQL
authencation working!

Mike

--
Michael C. Neel
There are only 10 types of people in the world;
those who understand binary and those who don't.


From gbeasley at tsa.ac.za  Thu Oct  3 13:40:20 2002
From: gbeasley at tsa.ac.za (Grant Beasley)
Date: Fri Jan  9 21:47:03 2004
Subject: [mod_python] Problem with AuthenHandler & Apache Configuration
Message-ID: <OOENKCHGJGHILGPAGHGOEELNCEAA.gbeasley@tsa.ac.za>

Hi

I'm trying to set up my website in such a way that the entire website is
protected by an AuthenHandler, and the "cgi" directory (where my mod_python
scripts run) is directed to a publisher (my own modification of the standard
publisher).

To do this, I setup Apache with the following directives:

<Directory "C:/Projects/http/cgi">
  SetHandler python-program
PythonHandler mypub
PythonDebug On
</Directory>

<Directory "C:/Projects/http">
  SetHandler python-program
PythonAuthenHandler authen
	AuthType Basic
	AuthName "Restricted Area"
	require valid-user
PythonLogHandler log
PythonDebug On
</Directory>

I've programmed my authenhandler (for debugging purposes) as follows:
    pw = req.get_basic_auth_pw()
    user = req.connection.user
    f = open("C:\\authendump.txt", "a")
    f.write("""Authen - %s
URI: %s
UNPARSED_URI: %s
THE_REQUEST: %s
PATH_INFO: %s
FILENAME: %s
USER: %s
PW: %s
-----------------
""" % (strftime('%d/%m/%Y %H:%M:%S', localtime()),req.uri, req.unparsed_uri,
req.the_request, req.path_info, req.filename, user, pw))
    if user is not None:
        return apache.OK
    else:
        return apache.HTTP_UNAUTHORIZED
    f.close()

i.e. Just to dump a few variables for inspection.

For a single request, the above configuration gives me the following:

Authen - 03/10/2002 13:31:16
URI: /showuser
UNPARSED_URI: /showuser
THE_REQUEST: GET /cgi/cool/showuser HTTP/1.1
PATH_INFO:
FILENAME: c:/projects/http/showuser
USER: None
PW: None
-----------------
Authen - 03/10/2002 13:31:16
URI: /cgi/cool/showuser
UNPARSED_URI: /cgi/cool/showuser
THE_REQUEST: GET /cgi/cool/showuser HTTP/1.1
PATH_INFO: /showuser
FILENAME: c:/projects/http/cgi/cool
USER: None
PW: None
-----------------
Authen - 03/10/2002 13:31:18
URI: /showuser
UNPARSED_URI: /showuser
THE_REQUEST: GET /cgi/cool/showuser HTTP/1.1
PATH_INFO:
FILENAME: c:/projects/http/showuser
USER: gb
PW: a
-----------------
Authen - 03/10/2002 13:31:18
URI: /cgi/cool/showuser
UNPARSED_URI: /cgi/cool/showuser
THE_REQUEST: GET /cgi/cool/showuser HTTP/1.1
PATH_INFO: /showuser
FILENAME: c:/projects/http/cgi/cool
USER: gb
PW: a
-----------------

In other words the authenhandler code is executing twice, with a different
URI. On inspection of the get_config() and get_dirs(), I can see that it's
executing once for each of the above directives.

What I'd like to know is why this occurs, and how do I prevent it?

Any help appreciated.

Grant Beasley


From neo at https.ru  Thu Oct  3 23:35:43 2002
From: neo at https.ru (Neo Eureka)
Date: Fri Jan  9 21:47:03 2004
Subject: [mod_python] Apache 2.0.42
Message-ID: <11731692471.20021003233543@https.ru>

Hi !

  It seems, BETA2 of mod_python 3 is not compatible with
Apache-2.0.42. It builds successfully, but when apache is asked to
test new configuration it complains about undefined symbol "openpty"
while trying to load mod_python into the server.

  Linux 7.2, Apache-2.0.42, Python-2.2.1.

                                                                Neo

P.S.
  The latest version of Apache recommended by Apache.org is 2.0.43. It
would be cool if mod_python 3 somehow could cope with these versions.


From grisha at modpython.org  Thu Oct  3 16:58:01 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:03 2004
Subject: [mod_python] Documentation patch for kwargs change in publisher.py
In-Reply-To: <20021002135913.GA29104@rmunnlfs>
Message-ID: <Pine.BSF.4.32.0210031656290.1483-100000@eden.ispol.com>

Thanks, I'll add this in.

BTW, the doc-html stuff automatically generated from .tex files in Doc.

On Wed, 2 Oct 2002 rmunn@pobox.com wrote:

> To go along with my earlier patch adding **kwargs functionality to the
> publisher.py dispatcher, here's a documentation patch to keep the docs
> up-to-date.
>
> --
> Robin Munn
> rmunn@pobox.com
>
>
>
> --- doc-html/hand-pub-alg-args.html	2002-09-24 11:59:13.000000000 -0500
> +++ doc-html/hand-pub-alg-args.html.new	2002-10-02 08:52:51.000000000 -0500
> @@ -58,7 +58,11 @@
>  object expects. This list is compared with names of fields from HTML
>  form data submitted by the client via <code>POST</code> or
>  <code>GET</code>. Values of fields whose names match the names of callable
> -object arguments will be passed as strings.
> +object arguments will be passed as strings. Any fields whose names do
> +not match the names of callable argument objects will be silently dropped.
> +But if the destination callable object has a <code>**kwargs</code> style
> +argument, then fields with unmatched names will be passed in the
> +<code>**kwargs</code> argument instead.
>
>  <P>
>  If the destination is not callable or is a class, then its string
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From grisha at modpython.org  Thu Oct  3 17:30:48 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:03 2004
Subject: [mod_python] Problem with AuthenHandler & Apache Configuration
In-Reply-To: <OOENKCHGJGHILGPAGHGOEELNCEAA.gbeasley@tsa.ac.za>
Message-ID: <Pine.BSF.4.32.0210031728430.1483-100000@eden.ispol.com>

Apache does this. It has to give a module a chance to evaluate permissions
at every directory in the path. I do not believe there is much you can do
about this.

Grisha

On Thu, 3 Oct 2002, Grant Beasley wrote:

> Hi
>
> I'm trying to set up my website in such a way that the entire website is
> protected by an AuthenHandler, and the "cgi" directory (where my mod_python
> scripts run) is directed to a publisher (my own modification of the standard
> publisher).
>
> To do this, I setup Apache with the following directives:
>
> <Directory "C:/Projects/http/cgi">
>   SetHandler python-program
> PythonHandler mypub
> PythonDebug On
> </Directory>
>
> <Directory "C:/Projects/http">
>   SetHandler python-program
> PythonAuthenHandler authen
> 	AuthType Basic
> 	AuthName "Restricted Area"
> 	require valid-user
> PythonLogHandler log
> PythonDebug On
> </Directory>
>
> I've programmed my authenhandler (for debugging purposes) as follows:
>     pw = req.get_basic_auth_pw()
>     user = req.connection.user
>     f = open("C:\\authendump.txt", "a")
>     f.write("""Authen - %s
> URI: %s
> UNPARSED_URI: %s
> THE_REQUEST: %s
> PATH_INFO: %s
> FILENAME: %s
> USER: %s
> PW: %s
> -----------------
> """ % (strftime('%d/%m/%Y %H:%M:%S', localtime()),req.uri, req.unparsed_uri,
> req.the_request, req.path_info, req.filename, user, pw))
>     if user is not None:
>         return apache.OK
>     else:
>         return apache.HTTP_UNAUTHORIZED
>     f.close()
>
> i.e. Just to dump a few variables for inspection.
>
> For a single request, the above configuration gives me the following:
>
> Authen - 03/10/2002 13:31:16
> URI: /showuser
> UNPARSED_URI: /showuser
> THE_REQUEST: GET /cgi/cool/showuser HTTP/1.1
> PATH_INFO:
> FILENAME: c:/projects/http/showuser
> USER: None
> PW: None
> -----------------
> Authen - 03/10/2002 13:31:16
> URI: /cgi/cool/showuser
> UNPARSED_URI: /cgi/cool/showuser
> THE_REQUEST: GET /cgi/cool/showuser HTTP/1.1
> PATH_INFO: /showuser
> FILENAME: c:/projects/http/cgi/cool
> USER: None
> PW: None
> -----------------
> Authen - 03/10/2002 13:31:18
> URI: /showuser
> UNPARSED_URI: /showuser
> THE_REQUEST: GET /cgi/cool/showuser HTTP/1.1
> PATH_INFO:
> FILENAME: c:/projects/http/showuser
> USER: gb
> PW: a
> -----------------
> Authen - 03/10/2002 13:31:18
> URI: /cgi/cool/showuser
> UNPARSED_URI: /cgi/cool/showuser
> THE_REQUEST: GET /cgi/cool/showuser HTTP/1.1
> PATH_INFO: /showuser
> FILENAME: c:/projects/http/cgi/cool
> USER: gb
> PW: a
> -----------------
>
> In other words the authenhandler code is executing twice, with a different
> URI. On inspection of the get_config() and get_dirs(), I can see that it's
> executing once for each of the above directives.
>
> What I'd like to know is why this occurs, and how do I prevent it?
>
> Any help appreciated.
>
> Grant Beasley
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From rmunn at pobox.com  Thu Oct  3 16:39:27 2002
From: rmunn at pobox.com (rmunn@pobox.com)
Date: Fri Jan  9 21:47:03 2004
Subject: [mod_python] Documentation patch for kwargs change in publisher.py
In-Reply-To: <Pine.BSF.4.32.0210031656290.1483-100000@eden.ispol.com>
References: <20021002135913.GA29104@rmunnlfs> <Pine.BSF.4.32.0210031656290.1483-100000@eden.ispol.com>
Message-ID: <20021003213927.GB26042@rmunnlfs>

On Thu, Oct 03, 2002 at 04:58:01PM -0400, Gregory (Grisha) Trubetskoy wrote:
> 
> Thanks, I'll add this in.
> 
> BTW, the doc-html stuff automatically generated from .tex files in Doc.
> 
[snip my patch]

Ah. Next time I send in a doc patch I'll patch the .tex files, then.

-- 
Robin Munn
rmunn@pobox.com

From daniel at copyleft.no  Sat Oct  5 01:23:48 2002
From: daniel at copyleft.no (Hr. Daniel Mikkelsen)
Date: Fri Jan  9 21:47:03 2004
Subject: [mod_python] Problems with PYTHONPATH.
Message-ID: <20021005011159.B33688-100000@unity.copyleft.no>

Hi.

I'm experiencing odd behaviour with mod_python and its PYTHONPATH. I'm running
FreeBSD 4.5. I'm not using the port-version of mod_python, since I want use a
separate threadless Python.

Anyway, I've compiled up things, and they basically work. I have my python
version in /local/python-2.2.1-threadless. Mod_python, when ./configuring
detects this from the --with-python=/local/src/Python-2.2.1 I give it.

All very automatic and nice.

But when I fire up Apache with this, things just refuse to work until I add a
symlink from
"/local/python-2.2.1-threadless/lib/python2.2/site-packages/mod_python" to
"/usr/local/lib/python2.2/site-packages".

And when I make my test handler print out sys.path, what I get is the
/usr/local prefixed ones, not the /local/python-2.2.1-threadless ones.

I can't figure out what's going on. The mod_python.so DSO only knows about
/local/python-2.2.1-threadless.

I've worked around this with a PythonPath entry, but I'm very curious as to why
this is happening. Is /usr/local some default prefix Python defaults to? Is
mod_python.so loading /usr/local/lib/python2.2/config/libpython2.2.a somehow by
mistake?

I'm absolutely certain there is only one installation of mod_python on my
system, and that it's configured and compiled with the correct (threadless)
interpreter.

Any help would be appreciated. :)

-- Daniel


From jack_diederich at email.com  Fri Oct  4 20:43:18 2002
From: jack_diederich at email.com (Jack Diederich)
Date: Fri Jan  9 21:47:03 2004
Subject: [mod_python] Problems with PYTHONPATH.
Message-ID: <20021005014318.19386.qmail@email.com>

I had a similar problem when using a user specific python instead of the system wide python with mod_python.
I took the cowards way out and just issued a PythonPath directive in httpd.conf with all the paths I need.

-jack
----- Original Message -----
From: "Hr. Daniel Mikkelsen" <daniel@copyleft.no>
Date: Sat, 5 Oct 2002 01:23:48 +0200 (CEST) 
To: mod_python@modpython.org
Subject: [mod_python] Problems with PYTHONPATH.


> Hi.
> 
> I'm experiencing odd behaviour with mod_python and its PYTHONPATH. I'm running
> FreeBSD 4.5. I'm not using the port-version of mod_python, since I want use a
> separate threadless Python.
> 
> Anyway, I've compiled up things, and they basically work. I have my python
> version in /local/python-2.2.1-threadless. Mod_python, when ./configuring
> detects this from the --with-python=/local/src/Python-2.2.1 I give it.
> 
> All very automatic and nice.
> 
> But when I fire up Apache with this, things just refuse to work until I add a
> symlink from
> "/local/python-2.2.1-threadless/lib/python2.2/site-packages/mod_python" to
> "/usr/local/lib/python2.2/site-packages".
> 
> And when I make my test handler print out sys.path, what I get is the
> /usr/local prefixed ones, not the /local/python-2.2.1-threadless ones.
> 
> I can't figure out what's going on. The mod_python.so DSO only knows about
> /local/python-2.2.1-threadless.
> 
> I've worked around this with a PythonPath entry, but I'm very curious as to why
> this is happening. Is /usr/local some default prefix Python defaults to? Is
> mod_python.so loading /usr/local/lib/python2.2/config/libpython2.2.a somehow by
> mistake?
> 
> I'm absolutely certain there is only one installation of mod_python on my
> system, and that it's configured and compiled with the correct (threadless)
> interpreter.
> 
> Any help would be appreciated. :)
> 
> -- Daniel
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 
> 

-- 
__________________________________________________________
Sign-up for your own FREE Personalized E-mail at Mail.com
http://www.mail.com/?sr=signup


"Free price comparison tool gives you the best prices and cash back!"
http://www.bestbuyfinder.com/download.htm


From piet at cs.uu.nl  Sat Oct  5 13:03:33 2002
From: piet at cs.uu.nl (Piet van Oostrum)
Date: Fri Jan  9 21:47:03 2004
Subject: [mod_python] Apache 2.0.42
In-Reply-To: <11731692471.20021003233543@https.ru>
References: <11731692471.20021003233543@https.ru>
Message-ID: <wzn0pttaey.fsf@cs.uu.nl>

>>>>> Neo Eureka <neo@https.ru> (NE) writes:

NE> Hi !

NE>   It seems, BETA2 of mod_python 3 is not compatible with
NE> Apache-2.0.42. It builds successfully, but when apache is asked to
NE> test new configuration it complains about undefined symbol "openpty"
NE> while trying to load mod_python into the server.

Maybe this previous post will help:

----- Original Message -----
From: "Carl C." <cc@carlc.com>
Subject: Re: [mod_python] Compiling a DSO module for RedHat Linux on ALPHA
64bit.
Guess, what... I FIXED IT...
I had to edit the mod_python's src/Makefile and change the
LIBS=-lm? /usr/src/Python-2.2-no-threads/libpython2.2.a
to
LIBS=-lm? /usr/src/Python-2.2-no-threads/libpython2.2.a -lutil
That -lutil was the magic!
Carl

-- 
Piet van Oostrum <piet@cs.uu.nl>
URL: http://www.cs.uu.nl/~piet [PGP]
Private email: P.van.Oostrum@hccnet.nl



From jack_diederich at email.com  Sat Oct  5 08:10:46 2002
From: jack_diederich at email.com (Jack Diederich)
Date: Fri Jan  9 21:47:04 2004
Subject: [mod_python] Apache 2.0.42
Message-ID: <20021005131050.32347.qmail@email.com>

For me (mod_python 2x, linux, Python 2.2.1) I needed to symlink Modules/Makefile to the root Python Makefile or ./configure would leave out some libraries in the linker line.  I don't remember if libutil was one of them.

I posted that to python-dev@httpd.apache.org, does anyone know if there is a searchable archive, or when there might be one in the future?

-jack
----- Original Message -----
From: Piet van Oostrum <piet@cs.uu.nl>
Date: 05 Oct 2002 13:03:33 +0200 
To: Neo Eureka <neo@https.ru>
Subject: Re: [mod_python] Apache 2.0.42


> >>>>> Neo Eureka <neo@https.ru> (NE) writes:
> 
> NE> Hi !
> 
> NE>   It seems, BETA2 of mod_python 3 is not compatible with
> NE> Apache-2.0.42. It builds successfully, but when apache is asked to
> NE> test new configuration it complains about undefined symbol "openpty"
> NE> while trying to load mod_python into the server.
> 
> Maybe this previous post will help:
> 
> ----- Original Message -----
> From: "Carl C." <cc@carlc.com>
> Subject: Re: [mod_python] Compiling a DSO module for RedHat Linux on ALPHA
> 64bit.
> Guess, what... I FIXED IT...
> I had to edit the mod_python's src/Makefile and change the
> LIBS=-lm  /usr/src/Python-2.2-no-threads/libpython2.2.a
> to
> LIBS=-lm  /usr/src/Python-2.2-no-threads/libpython2.2.a -lutil
> That -lutil was the magic!
> Carl
> 
> -- 
> Piet van Oostrum <piet@cs.uu.nl>
> URL: http://www.cs.uu.nl/~piet [PGP]
> Private email: P.van.Oostrum@hccnet.nl
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 
> 

-- 
__________________________________________________________
Sign-up for your own FREE Personalized E-mail at Mail.com
http://www.mail.com/?sr=signup


"Free price comparison tool gives you the best prices and cash back!"
http://www.bestbuyfinder.com/download.htm


From mateusz at ant.gliwice.pl  Sat Oct  5 15:39:48 2002
From: mateusz at ant.gliwice.pl (Mateusz Korniak)
Date: Fri Jan  9 21:47:04 2004
Subject: [mod_python] Perhaps bug in mod_pythons configure.in ? (python 2.2 and undefined symbol "openpty")
In-Reply-To: <20021005131050.32347.qmail@email.com>
References: <20021005131050.32347.qmail@email.com>
Message-ID: <200210051536.10652.mateusz@ant.gliwice.pl>

On Saturday 05 October 2002 15:10, Jack Diederich wrote:

> > NE>   It seems, BETA2 of mod_python 3 is not compatible with
> > NE> Apache-2.0.42. It builds successfully, but when apache is asked to
> > NE> test new configuration it complains about undefined symbol "openpty"
> > NE> while trying to load mod_python into the server.

> For me (mod_python 2x, linux, Python 2.2.1) I needed to symlink
> Modules/Makefile to the root Python Makefile or ./configure would leave out
> some libraries in the linker line.  I don't remember if libutil was one of
> them.
>
I've run at similar behavior ....
I'm totally ignorant about autoconf/automake stuff but I think problem affects 
python 2.2 bug in configure.in.

2.2 version triggers bad path to Makefile -> python is badly recognaised as 
linked without libs -> symbols are missing.

# set python std library variable
AC_MSG_CHECKING(what libraries Python was linked with)
AC_SUBST(LIBS)
if test -z "$PYTHON_SRC"; then
  PyLIBP=${PyEXEC_INSTALLDIR}/lib/python${PyVERSION}
  PyLIBPL=${PyLIBP}/config
  PyPYTHONLIBS=${PyLIBPL}/libpython${PyVERSION}.a
  PyLIBS=`grep "^LIB[[SMC]]=" ${PyLIBPL}/Makefile | cut -f2 -d= | tr 
'\011\012\015' '   '`
  PyMODLIBS=`grep "^LOCALMODLIBS=" ${PyLIBPL}/Makefile | cut -f2 -d= | tr 
'\011\012\015' '   '`
  PY_LIBS="${PyPYTHONLIBS} ${PyLIBS} ${PyMODLIBS}"
else
  PyPYTHONLIBS=${PYTHON_SRC}/libpython${PyVERSION}.a
  if test ${PyVERSION} = "2.1"; then
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ IMHO This test should be possitive for 2.2 
too

    PyLIBS=`grep "^LIB[[SMC]]=" ${PYTHON_SRC}/Makefile | cut -f2 -d= | tr 
'\011\012\015' '   '`
    PyMODLIBS=`grep "^LOCALMODLIBS=" ${PYTHON_SRC}/Makefile | cut -f2 -d= | tr 
'\011\012\015' '   '`
  else
    PyLIBS=`grep "^LIB[[SMC]]=" ${PYTHON_SRC}/Modules/Makefile | cut -f2 -d= | 
tr '\011\012\015' '   '`
    PyMODLIBS=`grep "^LOCALMODLIBS=" ${PYTHON_SRC}/Modules/Makefile | cut -f2 
-d= | tr '\011\012\015' '   '`
  fi
  PY_LIBS="${PyPYTHONLIBS} ${PyLIBS} ${PyMODLIBS}"
fi


-- 
Mateusz Korniak
"Black holes are where God divided by zero." - Steven Wright



From mateusz at ant.gliwice.pl  Sat Oct  5 15:45:09 2002
From: mateusz at ant.gliwice.pl (Mateusz Korniak)
Date: Fri Jan  9 21:47:04 2004
Subject: [mod_python] Two more fixes to ac/am stuff (patches included)
Message-ID: <200210051545.09369.mateusz@ant.gliwice.pl>

Both taken from PLD distro...

1. Fixes DESTDIR behavior
2. Fixes typo. (IMHO)


-- 
Mateusz Korniak

-------------- next part --------------
A non-text attachment was scrubbed...
Name: apache-mod_python-DESTDIR.patch
Type: text/x-diff
Size: 987 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20021005/e3571cd3/apache-mod_python-DESTDIR.bin
-------------- next part --------------
A non-text attachment was scrubbed...
Name: apache-mod_python-Makefile-in.patch
Type: text/x-diff
Size: 507 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20021005/e3571cd3/apache-mod_python-Makefile-in.bin
From neo at https.ru  Sat Oct  5 23:43:24 2002
From: neo at https.ru (Neo Eureka)
Date: Fri Jan  9 21:47:04 2004
Subject: [mod_python] Missing library in Makefile
In-Reply-To: <wzn0pttaey.fsf@cs.uu.nl>
References: <11731692471.20021003233543@https.ru> <wzn0pttaey.fsf@cs.uu.nl>
Message-ID: <974103440.20021005234324@https.ru>

  Dank U wel !

  This was it!

I think all the problems in configure/make stuff should be corrected
before any other bugs, because such problems prevent not very
experienced users (like me, at the moment) from testing the software
itself.


NE>> Hi !

NE>>   It seems, BETA2 of mod_python 3 is not compatible with
NE>> Apache-2.0.42. It builds successfully, but when apache is asked to
NE>> test new configuration it complains about undefined symbol "openpty"
NE>> while trying to load mod_python into the server.

PvO> Maybe this previous post will help:

PvO> ----- Original Message -----
PvO> From: "Carl C." <cc@carlc.com>
PvO> Subject: Re: [mod_python] Compiling a DSO module for RedHat Linux on ALPHA
PvO> 64bit.
PvO> Guess, what... I FIXED IT...
PvO> I had to edit the mod_python's src/Makefile and change the
PvO> LIBS=-lm? /usr/src/Python-2.2-no-threads/libpython2.2.a
PvO> to
PvO> LIBS=-lm? /usr/src/Python-2.2-no-threads/libpython2.2.a -lutil
PvO> That -lutil was the magic!
PvO> Carl

---
Neo Eureka / mailto:neo@https.ru


From neo at https.ru  Sun Oct  6 18:25:52 2002
From: neo at https.ru (Neo)
Date: Fri Jan  9 21:47:04 2004
Subject: [mod_python] Segfaults... segfaults...
Message-ID: <19513182194.20021006182552@https.ru>

  Hi all !

  I was just playing with mod_python 3 & Apache 2.0.42
(RedHat Linux 7.2). Below are my "mptest.py" file, Apache VH config
and the resuts of the single request:

GET /mptest.py


----------------BEGIN----------------
from mod_python import apache


interp = None

def transhandler(req):
    interp = req.interpreter
    return apache.OK

def handler(req):
    req.write(repr(interp))
    return apache.OK
-----------------END-----------------

Config for virtual host:
----------------BEGIN----------------
<VirtualHost *>
[... skipped ...]

    PythonPath    "..."

    PythonDebug On
    PythonTransHandler mptest
    SetHandler python-program
    PythonHandler mptest

    <Directory "/home/w-https/test-www">
        Options Indexes FollowSymLinks
        AllowOverride None

        Order allow,deny
        Allow from all

        DirectoryIndex index.html index.htm index.html.var

        AddDefaultCharset UTF-8
    </Directory>

[... skipped ...]
</VirtualHost>
-----------------END-----------------

Apache virtualhost log file:
----------------BEGIN----------------
[Sun Oct 06 18:02:44 2002] [info] [client 212.188.98.243] Module bug?
Request filename is missing for URI /mptest.py
-----------------END-----------------

*** I guess "transhandler" in the above example should somehow set
    filename for incoming request for Apache to be happy? But SEGFAULT
    is not the best action to report the error :)

Apache main server log file:
----------------BEGIN----------------
[Sun Oct 06 18:02:45 2002] [notice] child pid 12331 exit signal
Segmentation fault (11) 
-----------------END-----------------


---
Neo Eureka / mailto:neo@https.ru


From michaelteo at bigfoot.com  Mon Oct  7 17:55:51 2002
From: michaelteo at bigfoot.com (Michael Teo)
Date: Fri Jan  9 21:47:04 2004
Subject: [mod_python] Module conflicts on mod_python
Message-ID: <20021007095551.GA4290@bigfoot.com>

Hi, I am fortunate enough to be able deploy mod_python on a commercial web
server. 

However, I am currently being plagued by this problem.
I am running Apache 1.3.27 with mod_python 2.7.8 and python 2.2.1.
Virtualname hosting is enabled on Apache to allow virtual domainname hosting.

Now, say domain A and domain B has some mod_python publisher scripts which
import a session.py script. Only one session.py in either domain A or domain
B is loaded. However, the implementation of session.py is very different in
both domains and this causes a whole lot of errors on either A or B scripts.

Is there a misconfiguration in my httpd.conf, or is that supposed to be the
part of the feature with mod_python ?
Any advice will be greatly appreciated.
Thanks in advance.



The following are the contents of the .htaccess file in the cgi-bin 
directories. PythonPath are modified accordingly to the domainA and domainB.

AddHandler python-program .py .pyc
PythonHandler mod_python.publisher
PythonPath "sys.path + [ '/home/www/domainA/public_html/cgi-bin' ]



-- 
Michael Teo <mailto:michaelteo@bigfoot.com>
http://miketeo.net/
PGP  0x6C846A9C  DB:7D:51:D4:4D:AB:97:79:E4:68:D9:07:94:36:D5:1A:6C:84:6A:9C
     0x6937FB05  08:50:A1:4D:2E:45:58:60:DE:71:1F:30:63:54:EF:7B

From rmunn at pobox.com  Mon Oct  7 09:06:37 2002
From: rmunn at pobox.com (rmunn@pobox.com)
Date: Fri Jan  9 21:47:04 2004
Subject: [mod_python] Module conflicts on mod_python
In-Reply-To: <20021007095551.GA4290@bigfoot.com>
References: <20021007095551.GA4290@bigfoot.com>
Message-ID: <20021007140637.GA5212@rmunnlfs>

On Mon, Oct 07, 2002 at 05:55:51PM +0800, Michael Teo wrote:
> 
> Hi, I am fortunate enough to be able deploy mod_python on a commercial web
> server. 
> 
> However, I am currently being plagued by this problem.
> I am running Apache 1.3.27 with mod_python 2.7.8 and python 2.2.1.
> Virtualname hosting is enabled on Apache to allow virtual domainname hosting.
> 
> Now, say domain A and domain B has some mod_python publisher scripts which
> import a session.py script. Only one session.py in either domain A or domain
> B is loaded. However, the implementation of session.py is very different in
> both domains and this causes a whole lot of errors on either A or B scripts.
> 
> Is there a misconfiguration in my httpd.conf, or is that supposed to be the
> part of the feature with mod_python ?
> Any advice will be greatly appreciated.
> Thanks in advance.
> 
> 
> 
> The following are the contents of the .htaccess file in the cgi-bin 
> directories. PythonPath are modified accordingly to the domainA and domainB.
> 
> AddHandler python-program .py .pyc
> PythonHandler mod_python.publisher
> PythonPath "sys.path + [ '/home/www/domainA/public_html/cgi-bin' ]
> 

Do you have the PythonInterpPerDirectory directive turned on? It would
allow domain A and domain B's scripts to run in separate Python
interpreters with completely separate namespaces, so their session.py
scripts could not conflict with each other. For more information:

http://www.modpython.org/live/mod_python-2.7.8/doc-html/dir-other-ipd.html

-- 
Robin Munn
rmunn@pobox.com
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20021007/bc29ddb4/attachment.bin
From rmunn at pobox.com  Tue Oct  8 12:34:46 2002
From: rmunn at pobox.com (rmunn@pobox.com)
Date: Fri Jan  9 21:47:04 2004
Subject: [mod_python] Segfault when using PythonImport directive
Message-ID: <20021008173446.GB5212@rmunnlfs>

I'm using mod_python 3.0.0 BETA 2 with Apache 2.0.42 and encountering a
segfault every time I try to use the PythonInclude directive. The
segfault occurs even when I try to have Apache do a configuration syntax
check (/usr/apache2/bin/apachectl configtest). I've narrowed it down to
a single PythonInclude line. This is the <Directory> directive in which
the PythonInclude directive appears:


<Directory /var/www/publisher>
    AddHandler python-program .py
    PythonHandler mod_python.publisher
    PythonInterpPerDirective On
    PythonImport globals
</Directory>


If I comment out the "PythonImport globals" line, everything runs fine.

Here's the contents of my /var/www/publisher directory:


rmunn@localhost:/var/www/publisher$ ls -l
total 8
-rw-r--r--    1 rmunn    users          12 Oct  7 19:22 globals.py
-rw-r--r--    1 rmunn    users         133 Oct  8 12:26 tryme.py
rmunn@localhost:/var/www/publisher$ cat globals.py 
foo = 'bar'
rmunn@localhost:/var/www/publisher$ cat tryme.py 
def show(req, name):
    try:
        return str(globals.foo)
    except AttributeError, NameError:
        return str(dir(globals))


As you can see, what I'm trying to do is have some global variables
pre-defined in my mod_python scripts; I plan on using this to accomplish
expensive operations (like opening database connections) once per apache
process child instead of once per request.

Here's the gdb backtrace of my segfault. I'm running httpd -t to only
get a configuration syntax check and it's still failing. Any ideas?


root@localhost:/usr/apache2/conf# gdb ../bin/httpd 
GNU gdb 5.2.1
Copyright 2002 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you
are
welcome to change it and/or distribute copies of it under certain
conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for
details.
This GDB was configured as "i686-pc-linux-gnu"...
(gdb) run -t
Starting program: /usr/apache2/bin/httpd -t
[New Thread 1024 (LWP 29765)]

Program received signal SIGSEGV, Segmentation fault.
[Switching to Thread 1024 (LWP 29765)]
__pthread_mutex_lock (mutex=0x10) at mutex.c:99
99      mutex.c: No such file or directory.
        in mutex.c
(gdb) backtrace full
#0  __pthread_mutex_lock (mutex=0x10) at mutex.c:99
        mutex = (pthread_mutex_t *) 0x10
        self = 0x0
#1  0x403d8f43 in PyThread_acquire_lock (lock=0x0, waitflag=1) at
Python/thread_pthread.h:359
        lock = 0x0
        success = 1078103364
        status = 0
        error = 0
#2  0x403bbb4e in PyEval_AcquireLock () at Python/ceval.c:267
No locals.
#3  0x4037c1b3 in directive_PythonImport (cmd=0xbffffc30,
mconfig=0x80e0958, module=0x80e0e28 "globals") at mod_python.c:1220
        cmd = (cmd_parms *) 0x0
        mconfig = (void *) 0x0
        module = 0x0
#4  0x08067349 in invoke_cmd (cmd=0x4040d154, parms=0xbffffc30,
mconfig=0x80e0958, args=0x80d594f "") at config.c:800
        w = 0x80e0e28 "globals"
        w2 = 0xbffffc30 ""
        w3 = 0x4040d154 "\231n?@\234Á7@"
        errmsg = 0x0
#5  0x08067a53 in ap_walk_config_sub (current=0x80d5928,
parms=0xbffffc30, section_vector=0x80e05f0) at config.c:1082
        dir_config = (void *) 0x4040d154
        retval = 0x4040d154 "\231n?@\234Á7@"
        cmd = (command_rec *) 0x4040d154
        current = (ap_directive_t *) 0x80d5928
        parms = (cmd_parms *) 0xbffffc30
        mod = (module *) 0x4040d2e0
#6  0x08067ad1 in ap_walk_config (current=0x80d5850, parms=0xbffffc30,
section_vector=0x80e05f0) at config.c:1121
        errmsg = 0x0
        current = (ap_directive_t *) 0x80d5928
        parms = (cmd_parms *) 0xbffffc30
        oldconfig = (ap_conf_vector_t *) 0x80b3488
#7  0x08074beb in dirsection (cmd=0xbffffc30, mconfig=0x80b3598,
arg=0x80e0792 "") at core.c:1625
        cmd = (cmd_parms *) 0xbffffc30
        errmsg = 0x0
        endp = 0x80e07e0 ""
        old_overrides = 150
        old_path = 0x0
        conf = (core_dir_config *) 0x80e07e0
        new_dir_conf = (ap_conf_vector_t *) 0x80e05f0
        r = (regex_t *) 0x0
        thiscmd = (command_rec *) 0x8088bec
        err = 0x0
#8  0x08066e6e in invoke_cmd (cmd=0x8088bec, parms=0xbffffc30,
mconfig=0x80b3598, args=0x80d5828 "/var/www/publisher>") at config.c:713
        w = 0x80d5808 "øW\r\b(X\r\b"
        w2 = 0xbffffc30 ""
        w3 = 0x4040d154 "\231n?@\234Á7@"
        errmsg = 0x0
#9  0x08067a53 in ap_walk_config_sub (current=0x80d5808,
parms=0xbffffc30, section_vector=0x80b3488) at config.c:1082
        dir_config = (void *) 0x4040d154
        retval = 0x4040d154 "\231n?@\234Á7@"
        cmd = (command_rec *) 0x8088bec
        current = (ap_directive_t *) 0x80d5808
        parms = (cmd_parms *) 0xbffffc30
        mod = (module *) 0x808ed60
#10 0x08067ad1 in ap_walk_config (current=0x80b49d0, parms=0xbffffc30,
section_vector=0x80b3488) at config.c:1121
        errmsg = 0x0
        current = (ap_directive_t *) 0x80d5808
        parms = (cmd_parms *) 0xbffffc30
        oldconfig = (ap_conf_vector_t *) 0x0
#11 0x080684e0 in ap_process_config_tree (s=0x80b2ec8,
conftree=0x80b49d0, p=0x8098d10, ptemp=0x80c4dc0) at config.c:1583
        s = (server_rec *) 0x4040d154
        p = (apr_pool_t *) 0x8098d10
        ptemp = (apr_pool_t *) 0x0
        errmsg = 0x808defc ""
        parms = {info = 0x0, override = 95, limited = -1,
limited_xmethods = 0x0, xlimited = 0x0, config_file = 0x0, directive =
0x80d5928, pool = 0x8098d10, 
  temp_pool = 0x80c4dc0, server = 0x80b2ec8, path = 0x80e07c8
"/var/www/publisher/", cmd = 0x4040d154, context = 0x80e05f0,
err_directive = 0x0}
#12 0x0806a811 in main (argc=2, argv=0xbffffd44) at main.c:564
        c = 116 't'
        configtestonly = 1
        confname = 0x8086518 "conf/httpd.conf"
        def_server_root = 0x8086528 "/usr/apache2"
        temp_error_log = 0x0
        process = (process_rec *) 0x8096d88
        server_conf = (server_rec *) 0x80b2ec8
        pglobal = (apr_pool_t *) 0x8096d08
        pconf = (apr_pool_t *) 0x8098d10
        plog = (apr_pool_t *) 0x80c2db8
        ptemp = (apr_pool_t *) 0x80c4dc0
        pcommands = (apr_pool_t *) 0x80c0db0
        opt = (apr_getopt_t *) 0x80c0e48
        rv = 0
        mod = (module **) 0x80b2ec8
        optarg = 0x0
        signal_server = (apr_OFN_ap_signal_server_t *) 0x4040d154
<python_commands+264>
#13 0x40189571 in __libc_start_main (main=0x806a370 <main>, argc=2,
ubp_av=0xbffffd44, init=0x805b824 <_init>, fini=0x80812e0 <_fini>,
rtld_fini=0x4000aa24 <_dl_fini>, 
    stack_end=0xbffffd3c) at ../sysdeps/generic/libc-start.c:129
        ubp_av = (char **) 0xbffffd44
        fini = (void (*)()) 0x400154ac <_dl_debug_mask>
        rtld_fini = (void (*)()) 0x80e0e28
        ubp_ev = (char **) 0x0


-- 
Robin Munn
rmunn@pobox.com
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20021008/e6c4c75b/attachment.bin
From neel at mediapulse.com  Tue Oct  8 16:33:19 2002
From: neel at mediapulse.com (Michael C. Neel)
Date: Fri Jan  9 21:47:04 2004
Subject: [mod_python] Segfault when using PythonImport directive
Message-ID: <C0FC22C08B82074A88B50061764157775BC2@johnson.mediapulse.net>

Not addressing the segfault, couldn't you handle globals in the python
program itself?  I do this for database handles my self:

from mod_python import apache
import MySQLdb

db = MySQLdb.connect("yada yada")

def handler(req):
	do cool db stuff with req here

I do this often, and I've checked that each request doesn't generate a
db connection by watching the MySQL number of connects.  One thing to
keep in mind is that a db handle may go stale if not used by some
databases, so be sure to add some code to test out the db handle each
request and reconnect if needed.  The DB API 2.0 spec doesn't define a
ping method like perl's DBI does, so I usually add one myself for this.

Mike

--
Michael C. Neel
Director of Software Development
Mediapulse, Inc.
 

-----Original Message-----
From: rmunn@pobox.com [mailto:rmunn@pobox.com] 
Sent: Tuesday, October 08, 2002 1:35 PM
To: mod_python@modpython.org
Subject: [mod_python] Segfault when using PythonImport directive


I'm using mod_python 3.0.0 BETA 2 with Apache 2.0.42 and encountering a
segfault every time I try to use the PythonInclude directive. The
segfault occurs even when I try to have Apache do a configuration syntax
check (/usr/apache2/bin/apachectl configtest). I've narrowed it down to
a single PythonInclude line. This is the <Directory> directive in which
the PythonInclude directive appears:


<Directory /var/www/publisher>
    AddHandler python-program .py
    PythonHandler mod_python.publisher
    PythonInterpPerDirective On
    PythonImport globals
</Directory>


If I comment out the "PythonImport globals" line, everything runs fine.

Here's the contents of my /var/www/publisher directory:


rmunn@localhost:/var/www/publisher$ ls -l
total 8
-rw-r--r--    1 rmunn    users          12 Oct  7 19:22 globals.py
-rw-r--r--    1 rmunn    users         133 Oct  8 12:26 tryme.py
rmunn@localhost:/var/www/publisher$ cat globals.py 
foo = 'bar'
rmunn@localhost:/var/www/publisher$ cat tryme.py 
def show(req, name):
    try:
        return str(globals.foo)
    except AttributeError, NameError:
        return str(dir(globals))


As you can see, what I'm trying to do is have some global variables
pre-defined in my mod_python scripts; I plan on using this to accomplish
expensive operations (like opening database connections) once per apache
process child instead of once per request.

Here's the gdb backtrace of my segfault. I'm running httpd -t to only
get a configuration syntax check and it's still failing. Any ideas?


root@localhost:/usr/apache2/conf# gdb ../bin/httpd 
GNU gdb 5.2.1
Copyright 2002 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you
are
welcome to change it and/or distribute copies of it under certain
conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for
details.
This GDB was configured as "i686-pc-linux-gnu"...
(gdb) run -t
Starting program: /usr/apache2/bin/httpd -t
[New Thread 1024 (LWP 29765)]

Program received signal SIGSEGV, Segmentation fault.
[Switching to Thread 1024 (LWP 29765)]
__pthread_mutex_lock (mutex=0x10) at mutex.c:99
99      mutex.c: No such file or directory.
        in mutex.c
(gdb) backtrace full
#0  __pthread_mutex_lock (mutex=0x10) at mutex.c:99
        mutex = (pthread_mutex_t *) 0x10
        self = 0x0
#1  0x403d8f43 in PyThread_acquire_lock (lock=0x0, waitflag=1) at
Python/thread_pthread.h:359
        lock = 0x0
        success = 1078103364
        status = 0
        error = 0
#2  0x403bbb4e in PyEval_AcquireLock () at Python/ceval.c:267
No locals.
#3  0x4037c1b3 in directive_PythonImport (cmd=0xbffffc30,
mconfig=0x80e0958, module=0x80e0e28 "globals") at mod_python.c:1220
        cmd = (cmd_parms *) 0x0
        mconfig = (void *) 0x0
        module = 0x0
#4  0x08067349 in invoke_cmd (cmd=0x4040d154, parms=0xbffffc30,
mconfig=0x80e0958, args=0x80d594f "") at config.c:800
        w = 0x80e0e28 "globals"
        w2 = 0xbffffc30 ""
        w3 = 0x4040d154 "\231n?@\234?7@"
        errmsg = 0x0
#5  0x08067a53 in ap_walk_config_sub (current=0x80d5928,
parms=0xbffffc30, section_vector=0x80e05f0) at config.c:1082
        dir_config = (void *) 0x4040d154
        retval = 0x4040d154 "\231n?@\234?7@"
        cmd = (command_rec *) 0x4040d154
        current = (ap_directive_t *) 0x80d5928
        parms = (cmd_parms *) 0xbffffc30
        mod = (module *) 0x4040d2e0
#6  0x08067ad1 in ap_walk_config (current=0x80d5850, parms=0xbffffc30,
section_vector=0x80e05f0) at config.c:1121
        errmsg = 0x0
        current = (ap_directive_t *) 0x80d5928
        parms = (cmd_parms *) 0xbffffc30
        oldconfig = (ap_conf_vector_t *) 0x80b3488
#7  0x08074beb in dirsection (cmd=0xbffffc30, mconfig=0x80b3598,
arg=0x80e0792 "") at core.c:1625
        cmd = (cmd_parms *) 0xbffffc30
        errmsg = 0x0
        endp = 0x80e07e0 ""
        old_overrides = 150
        old_path = 0x0
        conf = (core_dir_config *) 0x80e07e0
        new_dir_conf = (ap_conf_vector_t *) 0x80e05f0
        r = (regex_t *) 0x0
        thiscmd = (command_rec *) 0x8088bec
        err = 0x0
#8  0x08066e6e in invoke_cmd (cmd=0x8088bec, parms=0xbffffc30,
mconfig=0x80b3598, args=0x80d5828 "/var/www/publisher>") at config.c:713
        w = 0x80d5808 "?W\r\b(X\r\b"
        w2 = 0xbffffc30 ""
        w3 = 0x4040d154 "\231n?@\234?7@"
        errmsg = 0x0
#9  0x08067a53 in ap_walk_config_sub (current=0x80d5808,
parms=0xbffffc30, section_vector=0x80b3488) at config.c:1082
        dir_config = (void *) 0x4040d154
        retval = 0x4040d154 "\231n?@\234?7@"
        cmd = (command_rec *) 0x8088bec
        current = (ap_directive_t *) 0x80d5808
        parms = (cmd_parms *) 0xbffffc30
        mod = (module *) 0x808ed60
#10 0x08067ad1 in ap_walk_config (current=0x80b49d0, parms=0xbffffc30,
section_vector=0x80b3488) at config.c:1121
        errmsg = 0x0
        current = (ap_directive_t *) 0x80d5808
        parms = (cmd_parms *) 0xbffffc30
        oldconfig = (ap_conf_vector_t *) 0x0
#11 0x080684e0 in ap_process_config_tree (s=0x80b2ec8,
conftree=0x80b49d0, p=0x8098d10, ptemp=0x80c4dc0) at config.c:1583
        s = (server_rec *) 0x4040d154
        p = (apr_pool_t *) 0x8098d10
        ptemp = (apr_pool_t *) 0x0
        errmsg = 0x808defc ""
        parms = {info = 0x0, override = 95, limited = -1,
limited_xmethods = 0x0, xlimited = 0x0, config_file = 0x0, directive =
0x80d5928, pool = 0x8098d10, 
  temp_pool = 0x80c4dc0, server = 0x80b2ec8, path = 0x80e07c8
"/var/www/publisher/", cmd = 0x4040d154, context = 0x80e05f0,
err_directive = 0x0}
#12 0x0806a811 in main (argc=2, argv=0xbffffd44) at main.c:564
        c = 116 't'
        configtestonly = 1
        confname = 0x8086518 "conf/httpd.conf"
        def_server_root = 0x8086528 "/usr/apache2"
        temp_error_log = 0x0
        process = (process_rec *) 0x8096d88
        server_conf = (server_rec *) 0x80b2ec8
        pglobal = (apr_pool_t *) 0x8096d08
        pconf = (apr_pool_t *) 0x8098d10
        plog = (apr_pool_t *) 0x80c2db8
        ptemp = (apr_pool_t *) 0x80c4dc0
        pcommands = (apr_pool_t *) 0x80c0db0
        opt = (apr_getopt_t *) 0x80c0e48
        rv = 0
        mod = (module **) 0x80b2ec8
        optarg = 0x0
        signal_server = (apr_OFN_ap_signal_server_t *) 0x4040d154
<python_commands+264>
#13 0x40189571 in __libc_start_main (main=0x806a370 <main>, argc=2,
ubp_av=0xbffffd44, init=0x805b824 <_init>, fini=0x80812e0 <_fini>,
rtld_fini=0x4000aa24 <_dl_fini>, 
    stack_end=0xbffffd3c) at ../sysdeps/generic/libc-start.c:129
        ubp_av = (char **) 0xbffffd44
        fini = (void (*)()) 0x400154ac <_dl_debug_mask>
        rtld_fini = (void (*)()) 0x80e0e28
        ubp_ev = (char **) 0x0


-- 
Robin Munn
rmunn@pobox.com


From jack_diederich at email.com  Tue Oct  8 16:03:52 2002
From: jack_diederich at email.com (Jack Diederich)
Date: Fri Jan  9 21:47:04 2004
Subject: [mod_python] Segfault when using PythonImport directive
Message-ID: <20021008210352.6095.qmail@email.com>

Cut N Pasted from a python-dev@httpd.apache.org email last month
since I don't know where an archive would be.

I was talking about mod_python 2.x with apahce 1.x 
But I would be willing to guess it is the same problem.

-jack



you can never garuntee that python_init() will be called only once.
All memory allocated from the original pool is freed before the next
call to python_init()
just having the single python_imports table seems to avoid this for
some reason, but it isn't garunteed (I don't want to know what
happens on USR1).

we need a cleanup func that just resets the python_imports state
between calls to python_init()

/* This func can go anywhere above directive_PythonImports */
void cleanup_python_imports(void *data)
{
  python_imports = NULL;
}
/* This line needs to go in directive_PythonImports in the if block
where we call ap_make_table */
ap_register_cleanup(cmd->pool, NULL,
cleanup_python_imports, ap_null_cleanup);


The end result is that we remake the table if python_init() is called
more than once.  This is OK because the configuration is also reread.
 We don't have to worry about the global 'interpreters' variable
because it is allocated by Python outside of apache's memory
management, but we might have a small memory leak if we get USR1'd
over and over again because it is never Py_DECREF'd in
python_finalize.  On the other hand, Py_Finalize() is probably smart
enough to take of that for us.
----- Original Message -----
From: "Michael C. Neel" <neel@mediapulse.com>
Date: Tue, 8 Oct 2002 16:33:19 -0400 
To: <rmunn@pobox.com>, <mod_python@modpython.org>
Subject: RE: [mod_python] Segfault when using PythonImport directive


> Not addressing the segfault, couldn't you handle globals in the python
> program itself?  I do this for database handles my self:
> 
> from mod_python import apache
> import MySQLdb
> 
> db = MySQLdb.connect("yada yada")
> 
> def handler(req):
> 	do cool db stuff with req here
> 
> I do this often, and I've checked that each request doesn't generate a
> db connection by watching the MySQL number of connects.  One thing to
> keep in mind is that a db handle may go stale if not used by some
> databases, so be sure to add some code to test out the db handle each
> request and reconnect if needed.  The DB API 2.0 spec doesn't define a
> ping method like perl's DBI does, so I usually add one myself for this.
> 
> Mike
> 
> --
> Michael C. Neel
> Director of Software Development
> Mediapulse, Inc.
>  
> 
> -----Original Message-----
> From: rmunn@pobox.com [mailto:rmunn@pobox.com] 
> Sent: Tuesday, October 08, 2002 1:35 PM
> To: mod_python@modpython.org
> Subject: [mod_python] Segfault when using PythonImport directive
> 
> 
> I'm using mod_python 3.0.0 BETA 2 with Apache 2.0.42 and encountering a
> segfault every time I try to use the PythonInclude directive. The
> segfault occurs even when I try to have Apache do a configuration syntax
> check (/usr/apache2/bin/apachectl configtest). I've narrowed it down to
> a single PythonInclude line. This is the <Directory> directive in which
> the PythonInclude directive appears:
> 
> 
> <Directory /var/www/publisher>
>     AddHandler python-program .py
>     PythonHandler mod_python.publisher
>     PythonInterpPerDirective On
>     PythonImport globals
> </Directory>
> 
> 
> If I comment out the "PythonImport globals" line, everything runs fine.
> 
> Here's the contents of my /var/www/publisher directory:
> 
> 
> rmunn@localhost:/var/www/publisher$ ls -l
> total 8
> -rw-r--r--    1 rmunn    users          12 Oct  7 19:22 globals.py
> -rw-r--r--    1 rmunn    users         133 Oct  8 12:26 tryme.py
> rmunn@localhost:/var/www/publisher$ cat globals.py 
> foo = 'bar'
> rmunn@localhost:/var/www/publisher$ cat tryme.py 
> def show(req, name):
>     try:
>         return str(globals.foo)
>     except AttributeError, NameError:
>         return str(dir(globals))
> 
> 
> As you can see, what I'm trying to do is have some global variables
> pre-defined in my mod_python scripts; I plan on using this to accomplish
> expensive operations (like opening database connections) once per apache
> process child instead of once per request.
> 
> Here's the gdb backtrace of my segfault. I'm running httpd -t to only
> get a configuration syntax check and it's still failing. Any ideas?
> 
> 
> root@localhost:/usr/apache2/conf# gdb ../bin/httpd 
> GNU gdb 5.2.1
> Copyright 2002 Free Software Foundation, Inc.
> GDB is free software, covered by the GNU General Public License, and you
> are
> welcome to change it and/or distribute copies of it under certain
> conditions.
> Type "show copying" to see the conditions.
> There is absolutely no warranty for GDB.  Type "show warranty" for
> details.
> This GDB was configured as "i686-pc-linux-gnu"...
> (gdb) run -t
> Starting program: /usr/apache2/bin/httpd -t
> [New Thread 1024 (LWP 29765)]
> 
> Program received signal SIGSEGV, Segmentation fault.
> [Switching to Thread 1024 (LWP 29765)]
> __pthread_mutex_lock (mutex=0x10) at mutex.c:99
> 99      mutex.c: No such file or directory.
>         in mutex.c
> (gdb) backtrace full
> #0  __pthread_mutex_lock (mutex=0x10) at mutex.c:99
>         mutex = (pthread_mutex_t *) 0x10
>         self = 0x0
> #1  0x403d8f43 in PyThread_acquire_lock (lock=0x0, waitflag=1) at
> Python/thread_pthread.h:359
>         lock = 0x0
>         success = 1078103364
>         status = 0
>         error = 0
> #2  0x403bbb4e in PyEval_AcquireLock () at Python/ceval.c:267
> No locals.
> #3  0x4037c1b3 in directive_PythonImport (cmd=0xbffffc30,
> mconfig=0x80e0958, module=0x80e0e28 "globals") at mod_python.c:1220
>         cmd = (cmd_parms *) 0x0
>         mconfig = (void *) 0x0
>         module = 0x0
> #4  0x08067349 in invoke_cmd (cmd=0x4040d154, parms=0xbffffc30,
> mconfig=0x80e0958, args=0x80d594f "") at config.c:800
>         w = 0x80e0e28 "globals"
>         w2 = 0xbffffc30 ""
>         w3 = 0x4040d154 "\231n?@\234?7@"
>         errmsg = 0x0
> #5  0x08067a53 in ap_walk_config_sub (current=0x80d5928,
> parms=0xbffffc30, section_vector=0x80e05f0) at config.c:1082
>         dir_config = (void *) 0x4040d154
>         retval = 0x4040d154 "\231n?@\234?7@"
>         cmd = (command_rec *) 0x4040d154
>         current = (ap_directive_t *) 0x80d5928
>         parms = (cmd_parms *) 0xbffffc30
>         mod = (module *) 0x4040d2e0
> #6  0x08067ad1 in ap_walk_config (current=0x80d5850, parms=0xbffffc30,
> section_vector=0x80e05f0) at config.c:1121
>         errmsg = 0x0
>         current = (ap_directive_t *) 0x80d5928
>         parms = (cmd_parms *) 0xbffffc30
>         oldconfig = (ap_conf_vector_t *) 0x80b3488
> #7  0x08074beb in dirsection (cmd=0xbffffc30, mconfig=0x80b3598,
> arg=0x80e0792 "") at core.c:1625
>         cmd = (cmd_parms *) 0xbffffc30
>         errmsg = 0x0
>         endp = 0x80e07e0 ""
>         old_overrides = 150
>         old_path = 0x0
>         conf = (core_dir_config *) 0x80e07e0
>         new_dir_conf = (ap_conf_vector_t *) 0x80e05f0
>         r = (regex_t *) 0x0
>         thiscmd = (command_rec *) 0x8088bec
>         err = 0x0
> #8  0x08066e6e in invoke_cmd (cmd=0x8088bec, parms=0xbffffc30,
> mconfig=0x80b3598, args=0x80d5828 "/var/www/publisher>") at config.c:713
>         w = 0x80d5808 "?W\r\b(X\r\b"
>         w2 = 0xbffffc30 ""
>         w3 = 0x4040d154 "\231n?@\234?7@"
>         errmsg = 0x0
> #9  0x08067a53 in ap_walk_config_sub (current=0x80d5808,
> parms=0xbffffc30, section_vector=0x80b3488) at config.c:1082
>         dir_config = (void *) 0x4040d154
>         retval = 0x4040d154 "\231n?@\234?7@"
>         cmd = (command_rec *) 0x8088bec
>         current = (ap_directive_t *) 0x80d5808
>         parms = (cmd_parms *) 0xbffffc30
>         mod = (module *) 0x808ed60
> #10 0x08067ad1 in ap_walk_config (current=0x80b49d0, parms=0xbffffc30,
> section_vector=0x80b3488) at config.c:1121
>         errmsg = 0x0
>         current = (ap_directive_t *) 0x80d5808
>         parms = (cmd_parms *) 0xbffffc30
>         oldconfig = (ap_conf_vector_t *) 0x0
> #11 0x080684e0 in ap_process_config_tree (s=0x80b2ec8,
> conftree=0x80b49d0, p=0x8098d10, ptemp=0x80c4dc0) at config.c:1583
>         s = (server_rec *) 0x4040d154
>         p = (apr_pool_t *) 0x8098d10
>         ptemp = (apr_pool_t *) 0x0
>         errmsg = 0x808defc ""
>         parms = {info = 0x0, override = 95, limited = -1,
> limited_xmethods = 0x0, xlimited = 0x0, config_file = 0x0, directive =
> 0x80d5928, pool = 0x8098d10, 
>   temp_pool = 0x80c4dc0, server = 0x80b2ec8, path = 0x80e07c8
> "/var/www/publisher/", cmd = 0x4040d154, context = 0x80e05f0,
> err_directive = 0x0}
> #12 0x0806a811 in main (argc=2, argv=0xbffffd44) at main.c:564
>         c = 116 't'
>         configtestonly = 1
>         confname = 0x8086518 "conf/httpd.conf"
>         def_server_root = 0x8086528 "/usr/apache2"
>         temp_error_log = 0x0
>         process = (process_rec *) 0x8096d88
>         server_conf = (server_rec *) 0x80b2ec8
>         pglobal = (apr_pool_t *) 0x8096d08
>         pconf = (apr_pool_t *) 0x8098d10
>         plog = (apr_pool_t *) 0x80c2db8
>         ptemp = (apr_pool_t *) 0x80c4dc0
>         pcommands = (apr_pool_t *) 0x80c0db0
>         opt = (apr_getopt_t *) 0x80c0e48
>         rv = 0
>         mod = (module **) 0x80b2ec8
>         optarg = 0x0
>         signal_server = (apr_OFN_ap_signal_server_t *) 0x4040d154
> <python_commands+264>
> #13 0x40189571 in __libc_start_main (main=0x806a370 <main>, argc=2,
> ubp_av=0xbffffd44, init=0x805b824 <_init>, fini=0x80812e0 <_fini>,
> rtld_fini=0x4000aa24 <_dl_fini>, 
>     stack_end=0xbffffd3c) at ../sysdeps/generic/libc-start.c:129
>         ubp_av = (char **) 0xbffffd44
>         fini = (void (*)()) 0x400154ac <_dl_debug_mask>
>         rtld_fini = (void (*)()) 0x80e0e28
>         ubp_ev = (char **) 0x0
> 
> 
> -- 
> Robin Munn
> rmunn@pobox.com
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 
> 

-- 
__________________________________________________________
Sign-up for your own FREE Personalized E-mail at Mail.com
http://www.mail.com/?sr=signup


"Free price comparison tool gives you the best prices and cash back!"
http://www.bestbuyfinder.com/download.htm


From grisha at modpython.org  Sat Oct 12 16:08:37 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:04 2004
Subject: [mod_python] Segfaults... segfaults...
In-Reply-To: <19513182194.20021006182552@https.ru>
Message-ID: <Pine.BSF.4.32.0210121602380.17605-100000@eden.ispol.com>

I traced this to a bug in mod_negotiation.c - it didn't like r->fileinfo
being null, I submitted a patch for it, so hopefully it will be fixed in
next release of httpd.

Grisha

On Sun, 6 Oct 2002, Neo wrote:

>
>   Hi all !
>
>   I was just playing with mod_python 3 & Apache 2.0.42
> (RedHat Linux 7.2). Below are my "mptest.py" file, Apache VH config
> and the resuts of the single request:
>
> GET /mptest.py
>
>
> ----------------BEGIN----------------
> from mod_python import apache
>
>
> interp = None
>
> def transhandler(req):
>     interp = req.interpreter
>     return apache.OK
>
> def handler(req):
>     req.write(repr(interp))
>     return apache.OK
> -----------------END-----------------
>
> Config for virtual host:
> ----------------BEGIN----------------
> <VirtualHost *>
> [... skipped ...]
>
>     PythonPath    "..."
>
>     PythonDebug On
>     PythonTransHandler mptest
>     SetHandler python-program
>     PythonHandler mptest
>
>     <Directory "/home/w-https/test-www">
>         Options Indexes FollowSymLinks
>         AllowOverride None
>
>         Order allow,deny
>         Allow from all
>
>         DirectoryIndex index.html index.htm index.html.var
>
>         AddDefaultCharset UTF-8
>     </Directory>
>
> [... skipped ...]
> </VirtualHost>
> -----------------END-----------------
>
> Apache virtualhost log file:
> ----------------BEGIN----------------
> [Sun Oct 06 18:02:44 2002] [info] [client 212.188.98.243] Module bug?
> Request filename is missing for URI /mptest.py
> -----------------END-----------------
>
> *** I guess "transhandler" in the above example should somehow set
>     filename for incoming request for Apache to be happy? But SEGFAULT
>     is not the best action to report the error :)
>
> Apache main server log file:
> ----------------BEGIN----------------
> [Sun Oct 06 18:02:45 2002] [notice] child pid 12331 exit signal
> Segmentation fault (11)
> -----------------END-----------------
>
>
> ---
> Neo Eureka / mailto:neo@https.ru
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From grisha at ispol.com  Tue Oct 15 13:49:40 2002
From: grisha at ispol.com (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:04 2004
Subject: [mod_python] test
Message-ID: <Pine.BSF.4.32.0210151349280.72568-100000@eden.ispol.com>

ignore


From grisha at modpython.org  Tue Oct 15 13:51:38 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:04 2004
Subject: [mod_python] BETA 3
Message-ID: <Pine.BSF.4.32.0210151351150.72568-100000@eden.ispol.com>

BETA3 of MP 3 is available for download from
http://www.apache.org/dist/httpd/modpython/

This release features numerous fixes to problems reported on this and the
dev lists, has been tested on linux, solaris, freebsd and windows, and
even includes an example of a gzip filter.

There is also a windows DLL (actually it's a .so file, following the
Apache convention) in that same directory.

Grisha



From derrick.beery at itd.state.ia.us  Tue Oct 15 14:17:56 2002
From: derrick.beery at itd.state.ia.us (Derrick Beery)
Date: Fri Jan  9 21:47:04 2004
Subject: [mod_python] aix, apxs and apache problem
Message-ID: <00B8F67D177CD411BF7200508B6090FD046BB9FD@its-cn-exchange.its.state.ia.us>

Hello,

I am new to Python and interested in capabilities as a web language. I have
downloaded the source for mod_python-2.7.8. I am attempting to configure it
statically or as a DSO, thus far without complete success. The host is an
RS6000 running AIX 4.3.3 and the web server is Apache 1.3.27.

Using gcc version 2.95.3 20010315 (release)

Python was:

./configure --without-threads --with-gcc

Apache:

./configure --with-layout=custom --enable-module=most --enable-module=so

For mod_python I do:

./configure --with-apache=../apache_1.3.27 --with-apxs=/apache/bin/apxs
--with-python=/usr/local/src/Python-2.2.1

No errors. Well, I did have to link to the Makefile:

cd /usr/local/src/Python-2.2.1/Modules
ln -s /usr/local/src/Python-2.2.1/Makefile Makefile

After that, there were no errors following configure.

I then do:

make dso

There were errors until I I added
-bE:/usr/local/src/Python-2.2.1/Modules/python.exp to apxs script:

my $CFG_LDFLAGS_SHLIB = q(-H512 -T512 -bhalt:4 -bM:SRE -bnoentry
-bI:/apache2/libexec/httpd.exp -bE:/apache2/libexec/httpd.exp
-bE:/usr/local/src/Python-2.2.1/Modules/python.exp -lld -lc); # substituted
via Makefile.tmpl

Then no errors, so I do:

make install (as root)

no errors!

Added the following to DSO section of httpd.conf:

LoadModule python_module libexec/mod_python.so

I then attempt to restart httpd:

/apache/bin/apachectl start

This is what I get:

apachectl restart
/apache2/bin/apachectl restart: configuration broken, ignoring restart
/apache2/bin/apachectl restart: (run 'apachectl configtest' for details)
apachectl configtest
Syntax error on line 205 of /apache/conf/httpd.conf:
Can't locate API module structure `python_module' in file
/apache2/libexec/mod_python.so: Function not implemented (python_module)

When I tried statically, apache builds httpd with Python but If I try to add
PHP I get a TOC size error. Apache and just PHP builds and works great. I
did not test Python only version because even if it worked, I cannot use.

Any advice here would be greatly appreciated.

Derrick

From mort at bork.org  Tue Oct 15 16:31:12 2002
From: mort at bork.org (Martin Hicks)
Date: Fri Jan  9 21:47:04 2004
Subject: [mod_python] Sending args to the python script
Message-ID: <20021015203112.GC28708@bork.org>


Hello,

I want to be able to send args to the script through a src URL.  

e.g.,:

<frame ...  src="script/function?arg=blah&name=hoho">

but this doesn't seem to work.  I'm using the Publisher Handler
and mod_python 2.7.8 on debian-sid.

TIA
mh

-- 
Martin Hicks  ||  mort@bork.org  || PGP/GnuPG: 0x4C7F2BEE
plato up 13 days, 22:28, 13 users,  load average: 0.21, 0.07, 0.02
Great Spirits have always encountered opposition from mediocre minds
						-Albert Einstein
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20021015/063544c1/attachment.bin
From grisha at modpython.org  Tue Oct 15 17:48:20 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:04 2004
Subject: [mod_python] Sending args to the python script
In-Reply-To: <20021015203112.GC28708@bork.org>
Message-ID: <Pine.BSF.4.32.0210151746470.72568-100000@eden.ispol.com>

It should work. See if you have a req.form variable, and try raising it
with PythonDebug On to see what's in it, e.g.:

def function(req):

	raise `req.form`


On Tue, 15 Oct 2002, Martin Hicks wrote:

>
> Hello,
>
> I want to be able to send args to the script through a src URL.
>
> e.g.,:
>
> <frame ...  src="script/function?arg=blah&name=hoho">
>
> but this doesn't seem to work.  I'm using the Publisher Handler
> and mod_python 2.7.8 on debian-sid.
>
> TIA
> mh
>
> --
> Martin Hicks  ||  mort@bork.org  || PGP/GnuPG: 0x4C7F2BEE
> plato up 13 days, 22:28, 13 users,  load average: 0.21, 0.07, 0.02
> Great Spirits have always encountered opposition from mediocre minds
> 						-Albert Einstein
>


From mort at bork.org  Tue Oct 15 18:09:49 2002
From: mort at bork.org (Martin Hicks)
Date: Fri Jan  9 21:47:04 2004
Subject: [mod_python] Sending args to the python script
In-Reply-To: <Pine.BSF.4.32.0210151746470.72568-100000@eden.ispol.com>
References: <20021015203112.GC28708@bork.org> <Pine.BSF.4.32.0210151746470.72568-100000@eden.ispol.com>
Message-ID: <20021015220949.GE28708@bork.org>

On Tue, Oct 15, 2002 at 05:48:20PM -0400, Gregory (Grisha) Trubetskoy wrote:
>
> It should work. See if you have a req.form variable, and try raising it
> with PythonDebug On to see what's in it, e.g.:
> 
> def function(req):
> 
> 	raise `req.form`

Merci, merci.

I didn't know they came in through req.form.

thanks again,
mh

-- 
Martin Hicks  ||  mort@bork.org  || PGP/GnuPG: 0x4C7F2BEE
plato up 14 days, 8 min, 13 users,  load average: 0.38, 0.21, 0.08
Great Spirits have always encountered opposition from mediocre minds
						-Albert Einstein
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20021015/371c76d9/attachment.bin
From jack_diederich at email.com  Wed Oct 16 23:01:12 2002
From: jack_diederich at email.com (Jack Diederich)
Date: Fri Jan  9 21:47:04 2004
Subject: [mod_python] Apache compile HOWTO
Message-ID: <20021017040112.30584.qmail@email.com>

I saw this on freshmeat,
http://freshmeat.net/releases/100481/

and the homepage is here
http://www.delouw.ch/linux/apache.phtml

It is a HOWTO project that includes mod_perl, mod_php and others,
but as yet doesn't include mod_python.

If anyone would submit a writeup for mod_python
it would be good advocacy.

-jackdied
-- 
__________________________________________________________
Sign-up for your own FREE Personalized E-mail at Mail.com
http://www.mail.com/?sr=signup


From vmanera at manord.com  Thu Oct 17 18:40:17 2002
From: vmanera at manord.com (Manera, Villiam)
Date: Fri Jan  9 21:47:04 2004
Subject: [mod_python] strange behavior of mod-python
Message-ID: <52DC70C1C1575C418CB033523A29CF14104870@exchange2000.manord.com>

I'm currently use mod-python 2.7.6 on apache 1.3.26 - windows 2000 with
python 2.2
apache config:
.....
    ScriptAlias /comm/ "E:/script/cgi/comm/"
    ScriptAlias /tecnico/ "E:/script/cgi/tecnico/"
....
<Directory "E:/script/cgi/comm">
        Order Deny,Allow
        Deny from all
        Allow from .....
       ...
    	AddHandler python-program .py
    	PythonHandler mod_python.publisher
	PythonPath "sys.path+['c:/program
files/python22/lib/site-packages/mdnlib', 'c:/program
files/python22/lib/site-packages/HTMLgen','E:/script/cgi/comm']"
    	PythonDebug on
    </Directory>

----------------------------------------------------
all work fine, but sometimes (today 4 time) when a url is typed:
http://sviluppo.manord.com/comm/comm_ocordiu0.py/main?....

I have this behavior from apache:
HTTP 404 - File non trovato (not found)
Internet Explorer 
but the program is still in place, and the only way to force apache to found
the program is restart the apache services,
or make a copy of comm_ocordiu0 in comm_ocordiu1 and then call this one,
but....



this is not a real problem in developement web server, but  today it
happened 4 time, in production is happened 2 time in one month,
and I become in panic.

Any advice here would be greatly appreciated.

Villiam 

From francoislepoutre at compuserve.com  Fri Oct 18 11:37:16 2002
From: francoislepoutre at compuserve.com (=?iso-8859-1?Q?Fran=E7ois_Lepoutre?=)
Date: Fri Jan  9 21:47:04 2004
Subject: [mod_python] strange behavior of mod-python
Message-ID: <01c27689$f23a4f60$LocalHost@seriatim1>

>I use a class for handle a pool of connection to the data base that became
>persistent after the first call,
>and all the progrma that need a connection to the db have to pass through
>this class.

Same for me. Most odbc drivers are not fully threadsafe.

>But why only une program fall in this problem?
>In what way may I check if different trading are competing (my application
>doesn't call
>expressly any thread, mod python do it for me? I don't use multiple
>interpretes)


It all happens under stress only ...

-on apache linux ... when under stress apache forks as many
 interpreters as needed. Each intepreters handle the calls
 in an organised queue.

No race conditions here. Simple !

- on apache win32 ... when under strees apache win32 calls
for a nex thread. EACH THREAD may access all
your persistent python objects.

You need to put code to protect your data under stress.

>The way apache works on
>Anyway if this may be one problem I will start today to move from apache
>1.3.26 to apache 2.0.43
>with mod-python beta 3 (different management of threading), in order to
>check this problem.

I am quite new here. not tested the beta.

I have not tested that. No time at the moment.
Could you keep me informed on the all thing.

I have to maintain two version of our code.

One for linux, simple. The other one for nt/2K
that cares for concurrency.

The truth .. ain't log or complex but that's
extra code anyway.

Can i have one version only on apache 2
with both threading and forking activated ?

>I've to stay on nt/2000 because the odbc driver for my database it is not
>available on linux

Using a multiplatform db with support of both
win32 and *nix is great. We use ASA.
Great on win32. Runs on *nix.

>Thanks for your interest

mod_python is a great product.. worth digging thru.
You're welcome.

Francois

a win32 geek moving multiplatform
thru python/mod_python


-----Messaggio originale-----
Da: Fran?ois Lepoutre [mailto:francoislepoutre@compuserve.com]
Inviato: gioved? 17 ottobre 2002 23.26
A: Manera, Villiam
Oggetto: Re: [mod_python] strange behavior of mod-python


HI,

I love python and like mod_python a lot...
but have had trouble with the mod_python
programming model on nt/2000 because
of threading.

Do you keep db handle or python shared
data structure persistent in the python
interpreter?

If you do, have you made sure that
distinct thread are competing
for the same resource?

Just my two cents...


-----Original Message-----
From: Manera, Villiam <vmanera@manord.com>
To: 'mod_python@modpython.org' <mod_python@modpython.org>
Date: 17 October 2002 19:13
Subject: [mod_python] strange behavior of mod-python


>
>I'm currently use mod-python 2.7.6 on apache 1.3.26 - windows 2000 with
>python 2.2
>apache config:
>.....
>    ScriptAlias /comm/ "E:/script/cgi/comm/"
>    ScriptAlias /tecnico/ "E:/script/cgi/tecnico/"
>....
><Directory "E:/script/cgi/comm">
>        Order Deny,Allow
>        Deny from all
>        Allow from .....
>       ...
>    AddHandler python-program .py
>    PythonHandler mod_python.publisher
> PythonPath "sys.path+['c:/program
>files/python22/lib/site-packages/mdnlib', 'c:/program
>files/python22/lib/site-packages/HTMLgen','E:/script/cgi/comm']"
>    PythonDebug on
>    </Directory>
>
>----------------------------------------------------
>all work fine, but sometimes (today 4 time) when a url is typed:
>http://sviluppo.manord.com/comm/comm_ocordiu0.py/main?....
>
>I have this behavior from apache:
>HTTP 404 - File non trovato (not found)
>Internet Explorer
>but the program is still in place, and the only way to force apache to
found
>the program is restart the apache services,
>or make a copy of comm_ocordiu0 in comm_ocordiu1 and then call this one,
>but....
>
>
>
>this is not a real problem in developement web server, but  today it
>happened 4 time, in production is happened 2 time in one month,
>and I become in panic.
>
>Any advice here would be greatly appreciated.
>
>Villiam
>_______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org
>http://www.modpython.org/mailman/listinfo/mod_python


From francoislepoutre at compuserve.com  Fri Oct 18 14:55:23 2002
From: francoislepoutre at compuserve.com (=?iso-8859-1?Q?Fran=E7ois_Lepoutre?=)
Date: Fri Jan  9 21:47:04 2004
Subject: [mod_python] strange behavior of mod-python
Message-ID: <01c276a5$9f40ca20$2758d3d4@seriatim1>

>I will inform you to apache 2...

Thank you

>VI've found your mail of
>www.modpython.org/pipermail/mod_python/2001-September/001647.html
>that concern this problem. May I try to put "ThreadPerChild" to 1 instead
of
>2 to 50 ?

>I not clearly understood  the problem to doing that: the pb vanishes... and
>performance as well. (pb?)


Yes exactly!

>otherwise have you some example of code to protect  data under stress? I
>don't have any idea to do so.

I am no expert (IT by experience not education).
But python is so simple. I used the following kind
of code (no guarantee on details but you will
get the idea clear).

# at module level (global)
# add this
import threading
my_data_lock =  threading.RLock()

# every time you update your global variables

global my_data_lock
my_data_lock.acquire()

# update your stuff here
# while other thread wait ....

# release the lock
my_data_lock.release

I am sure you could (and should) do it
in a cleaner object-oriented way.
But that solved the threading issue.

Francois
-----Messaggio originale-----
Da: Fran?ois Lepoutre [mailto:francoislepoutre@compuserve.com]
Inviato: venerd? 18 ottobre 2002 11.37
A: Manera, Villiam
Cc: mod_python@modpython.org
Oggetto: Re: [mod_python] strange behavior of mod-python


>I use a class for handle a pool of connection to the data base that became
>persistent after the first call,
>and all the progrma that need a connection to the db have to pass through
>this class.

Same for me. Most odbc drivers are not fully threadsafe.

>But why only une program fall in this problem?
>In what way may I check if different trading are competing (my application
>doesn't call
>expressly any thread, mod python do it for me? I don't use multiple
>interpretes)


It all happens under stress only ...

-on apache linux ... when under stress apache forks as many
interpreters as needed. Each intepreters handle the calls
in an organised queue.

No race conditions here. Simple !

- on apache win32 ... when under strees apache win32 calls
for a nex thread. EACH THREAD may access all
your persistent python objects.

You need to put code to protect your data under stress.

>The way apache works on
>Anyway if this may be one problem I will start today to move from apache
>1.3.26 to apache 2.0.43
>with mod-python beta 3 (different management of threading), in order to
>check this problem.

I am quite new here. not tested the beta.

I have not tested that. No time at the moment.
Could you keep me informed on the all thing.

I have to maintain two version of our code.

One for linux, simple. The other one for nt/2K
that cares for concurrency.

The truth .. ain't log or complex but that's
extra code anyway.

Can i have one version only on apache 2
with both threading and forking activated ?

>I've to stay on nt/2000 because the odbc driver for my database it is not
>available on linux

Using a multiplatform db with support of both
win32 and *nix is great. We use ASA.
Great on win32. Runs on *nix.

>Thanks for your interest

mod_python is a great product.. worth digging thru.
You're welcome.

Francois

a win32 geek moving multiplatform
thru python/mod_python


-----Messaggio originale-----
Da: Fran?ois Lepoutre [mailto:francoislepoutre@compuserve.com]
Inviato: gioved? 17 ottobre 2002 23.26
A: Manera, Villiam
Oggetto: Re: [mod_python] strange behavior of mod-python


HI,

I love python and like mod_python a lot...
but have had trouble with the mod_python
programming model on nt/2000 because
of threading.

Do you keep db handle or python shared
data structure persistent in the python
interpreter?

If you do, have you made sure that
distinct thread are competing
for the same resource?

Just my two cents...


-----Original Message-----
From: Manera, Villiam <vmanera@manord.com>
To: 'mod_python@modpython.org' <mod_python@modpython.org>
Date: 17 October 2002 19:13
Subject: [mod_python] strange behavior of mod-python


>
>I'm currently use mod-python 2.7.6 on apache 1.3.26 - windows 2000 with
>python 2.2
>apache config:
>.....
>    ScriptAlias /comm/ "E:/script/cgi/comm/"
>    ScriptAlias /tecnico/ "E:/script/cgi/tecnico/"
>....
><Directory "E:/script/cgi/comm">
>        Order Deny,Allow
>        Deny from all
>        Allow from .....
>       ...
>    AddHandler python-program .py
>    PythonHandler mod_python.publisher
> PythonPath "sys.path+['c:/program
>files/python22/lib/site-packages/mdnlib', 'c:/program
>files/python22/lib/site-packages/HTMLgen','E:/script/cgi/comm']"
>    PythonDebug on
>    </Directory>
>
>----------------------------------------------------
>all work fine, but sometimes (today 4 time) when a url is typed:
>http://sviluppo.manord.com/comm/comm_ocordiu0.py/main?....
>
>I have this behavior from apache:
>HTTP 404 - File non trovato (not found)
>Internet Explorer
>but the program is still in place, and the only way to force apache to
found
>the program is restart the apache services,
>or make a copy of comm_ocordiu0 in comm_ocordiu1 and then call this one,
>but....
>
>
>
>this is not a real problem in developement web server, but  today it
>happened 4 time, in production is happened 2 time in one month,
>and I become in panic.
>
>Any advice here would be greatly appreciated.
>
>Villiam
>_______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org
>http://www.modpython.org/mailman/listinfo/mod_python


From peter at hawkins.emu.id.au  Sat Oct 19 12:23:07 2002
From: peter at hawkins.emu.id.au (Peter Hawkins)
Date: Fri Jan  9 21:47:04 2004
Subject: [mod_python] Debian packages of mod_python 3.0.0 beta 3
Message-ID: <200210191223.11417.peter@hawkins.emu.id.au>

Hi...

There are some preliminary packages of beta 3 available at:
http://people.debian.org/~peterh/

I disclaim any form of liability for anything these may do to any 
machine you might install them on.

=)
Peter
-- 
peter@hawkins.emu.id.au aka peterh@debian.org
GPG key fingerprint:
C746 38A9 D3E4 A171 FB6A  56D4 5E30 DFCC BE11 F437


From mort at bork.org  Fri Oct 18 23:52:27 2002
From: mort at bork.org (Martin Hicks)
Date: Fri Jan  9 21:47:05 2004
Subject: [mod_python] Redirects
Message-ID: <20021019035227.GK32184@bork.org>


Hello,

I'd like to do a redirect as a result of a certain action in my mod_python 
method.  I.e., rather than returning html, I'd like the user to be redirected to 
the page "blah.html" for example.

How do I accomplish this?

thanks
mh

-- 
Martin Hicks  ||  mort@bork.org  || PGP/GnuPG: 0x4C7F2BEE
plato up 17 days,  5:49, 16 users,  load average: 2.28, 2.20, 2.19
Beer: So much more than just a breakfast drink.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20021018/c8a550a8/attachment.bin
From mort at bork.org  Sat Oct 19 09:50:59 2002
From: mort at bork.org (Martin Hicks)
Date: Fri Jan  9 21:47:05 2004
Subject: [mod_python] Redirects
In-Reply-To: <3DB10378.605355C@sympatico.ca>
References: <20021019035227.GK32184@bork.org> <3DB10378.605355C@sympatico.ca>
Message-ID: <20021019135059.GL32184@bork.org>


On Sat, Oct 19, 2002 at 03:02:16AM -0400, vio wrote:
> Your answer is in the FAQ.


I tried to look in the FAQ before i posted, but it's br0ken.

When I try to search for "redirect" I get:

mod_python FAQ Search Results
Traceback (most recent call last):

  File "/usr/local/www/vhosts/www.modpython.org/FAQ/faqw.py", line 26, in ?
    import faqwiz
  File "/home/grisha/WWW/www.modpython.org/FAQ/faqwiz.py", line 827, in ?
    wiz.go()
  File "/home/grisha/WWW/www.modpython.org/FAQ/faqwiz.py", line 381, in go
    meth()
  File "/home/grisha/WWW/www.modpython.org/FAQ/faqwiz.py", line 447, in 
do_search
    constants
NameError: global name 'constants' is not defined


(times: user 0.567, sys 0.05, ch-user 0, ch-sys 0, real 0.65) 


Other errors occur when you try to view any part of the FAQ.
Can someone please either respond with details on how to do http redirects or 
fix the FAQ :-)

thanks a pile,
mh

-- 
Martin Hicks  ||  mort@bork.org  || PGP/GnuPG: 0x4C7F2BEE
plato up 17 days, 15:47, 16 users,  load average: 0.31, 0.40, 0.27
Great Spirits have always encountered opposition from mediocre minds
						-Albert Einstein
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20021019/f94cd711/attachment.bin
From vmilitaru at sympatico.ca  Sat Oct 19 22:58:58 2002
From: vmilitaru at sympatico.ca (vio)
Date: Fri Jan  9 21:47:05 2004
Subject: [mod_python] Re: Redirects
References: <20021019035227.GK32184@bork.org> <3DB10378.605355C@sympatico.ca> <20021019135059.GL32184@bork.org>
Message-ID: <3DB21BF1.94DDC26B@sympatico.ca>

You do redirection in mod_python with something like this:


def handler(REQUEST):

   _REQUEST = REQUEST._req
...
   _REQUEST.headers_out['location'] = 'http://some_URL.org/...'
   _REQUEST.status = apache.HTTP_MOVED_PERMANENTLY
   _REQUEST.send_http_header()
   raise apache.SERVER_RETURN, apache.OK



Hope this helps,
Vio



From grisha at modpython.org  Sun Oct 20 14:22:53 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:05 2004
Subject: [mod_python] Re: Redirects
In-Reply-To: <3DB21BF1.94DDC26B@sympatico.ca>
Message-ID: <Pine.BSF.4.32.0210201421370.39713-100000@eden.ispol.com>

On Sat, 19 Oct 2002, vio wrote:

> You do redirection in mod_python with something like this:
>
>
> def handler(REQUEST):
>
>    _REQUEST = REQUEST._req

The above line won't work starting with the next version of mod_python...

Grisha


From mort at bork.org  Sun Oct 20 14:29:39 2002
From: mort at bork.org (Martin Hicks)
Date: Fri Jan  9 21:47:05 2004
Subject: [mod_python] Re: Redirects
In-Reply-To: <Pine.BSF.4.32.0210201421370.39713-100000@eden.ispol.com>
References: <3DB21BF1.94DDC26B@sympatico.ca> <Pine.BSF.4.32.0210201421370.39713-100000@eden.ispol.com>
Message-ID: <20021020182939.GJ32501@bork.org>

On Sun, Oct 20, 2002 at 02:22:53PM -0400, Gregory (Grisha) Trubetskoy wrote:
> 
> On Sat, 19 Oct 2002, vio wrote:
> 
> > You do redirection in mod_python with something like this:
> >
> >
> > def handler(REQUEST):
> >
> >    _REQUEST = REQUEST._req
> 
> The above line won't work starting with the next version of mod_python...

What will the new method be in the next version?

thanks
mh

-- 
Martin Hicks  ||  mort@bork.org  || PGP/GnuPG: 0x4C7F2BEE
plato up 18 days, 20:28, 14 users,  load average: 0.15, 0.27, 0.17
Beer: So much more than just a breakfast drink.

From vmilitaru at sympatico.ca  Sun Oct 20 21:01:28 2002
From: vmilitaru at sympatico.ca (vio)
Date: Fri Jan  9 21:47:05 2004
Subject: [mod_python] Re: Redirects
References: <Pine.BSF.4.32.0210201421370.39713-100000@eden.ispol.com>
Message-ID: <3DB351E8.A39B7030@sympatico.ca>

Got you. To be more precise, my little code example was "mod_python/2.7.8
over Apache/1.3.26" friendly.

So I guess you must be referring to mod_python/3 running on apache/2.
Looking foreword to it (sorry I haven't had much time to play with the beta
releases so far ... lazily waiting for the first stable release, I guess, to
migrate to the new generation). If I understand you correcly, no more 'fast
track' access to REQUEST internals (aka. 'XXX._req') :-(. I guess a little
'migration tips to mod_python/3' might become handy, then).

If I may add a coding style suggestion for the new version out of the blue,
it would be to replace all references to 'req' with 'REQUEST' (uppercase
full name). I learned this in Zope long ago, and it sticked with me: it's a
little more verbose, but so much more clean when you look at a source code,
especially true for newcomers. Good ideas deserve to be "borrowed".

Vio


"Gregory (Grisha) Trubetskoy" wrote:

> On Sat, 19 Oct 2002, vio wrote:
>
> > You do redirection in mod_python with something like this:
> >
> >
> > def handler(REQUEST):
> >
> >    _REQUEST = REQUEST._req
>
> The above line won't work starting with the next version of mod_python...
>
> Grisha


From grisha at modpython.org  Mon Oct 21 10:44:47 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:05 2004
Subject: [mod_python] Re: Redirects
In-Reply-To: <3DB351E8.A39B7030@sympatico.ca>
Message-ID: <Pine.BSF.4.32.0210211003570.49241-100000@eden.ispol.com>

On Sun, 20 Oct 2002, vio wrote:

> Got you. To be more precise, my little code example was "mod_python/2.7.8
> over Apache/1.3.26" friendly.
>
> So I guess you must be referring to mod_python/3 running on apache/2.
> Looking foreword to it (sorry I haven't had much time to play with the beta
> releases so far ... lazily waiting for the first stable release, I guess, to
> migrate to the new generation). If I understand you correcly, no more 'fast
> track' access to REQUEST internals (aka. 'XXX._req') :-(. I guess a little
> 'migration tips to mod_python/3' might become handy, then).
>

The _req object came about as a way to make the end-user request object
modifiable. There were two ways of doing it - writing C code to make the
built-in request object accept new members, or simply encapsulate it in a
regular Python object. I hose the latter because it was quicker :)

Mod_python 3 does it correctly - the built-in request object won't need to
be encapsulated, it will be modifiable as is, so there won't be any need
for _req.

BTW, the ._req is undocumented, so if ever anyone used it, it was at their
own risk. And yes, a migration document would be nice, hopefully I can put
something together to that extent.

> If I may add a coding style suggestion for the new version out of the blue,
> it would be to replace all references to 'req' with 'REQUEST' (uppercase
> full name). I learned this in Zope long ago, and it sticked with me: it's a
> little more verbose, but so much more clean when you look at a source code,
> especially true for newcomers. Good ideas deserve to be "borrowed".

I don't like the way Zope names it REQUEST, because to me, a part-time C
programmer, all caps means a symbolic constant, and this convention has
for the most part been followed in Python standard library.

Grisha

>
> Vio
>
>
> "Gregory (Grisha) Trubetskoy" wrote:
>
> > On Sat, 19 Oct 2002, vio wrote:
> >
> > > You do redirection in mod_python with something like this:
> > >
> > >
> > > def handler(REQUEST):
> > >
> > >    _REQUEST = REQUEST._req
> >
> > The above line won't work starting with the next version of mod_python...
> >
> > Grisha
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>



From grisha at modpython.org  Mon Oct 21 10:59:39 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:05 2004
Subject: [mod_python] Redirects
In-Reply-To: <20021019135059.GL32184@bork.org>
Message-ID: <Pine.BSF.4.32.0210211058530.50017-100000@eden.ispol.com>

This's been fixed

On Sat, 19 Oct 2002, Martin Hicks wrote:

>
> On Sat, Oct 19, 2002 at 03:02:16AM -0400, vio wrote:
> > Your answer is in the FAQ.
>
>
> I tried to look in the FAQ before i posted, but it's br0ken.
>
> When I try to search for "redirect" I get:
>
> mod_python FAQ Search Results
> Traceback (most recent call last):
>
>   File "/usr/local/www/vhosts/www.modpython.org/FAQ/faqw.py", line 26, in ?
>     import faqwiz
>   File "/home/grisha/WWW/www.modpython.org/FAQ/faqwiz.py", line 827, in ?
>     wiz.go()
>   File "/home/grisha/WWW/www.modpython.org/FAQ/faqwiz.py", line 381, in go
>     meth()
>   File "/home/grisha/WWW/www.modpython.org/FAQ/faqwiz.py", line 447, in
> do_search
>     constants
> NameError: global name 'constants' is not defined


From eallen41 at charter.net  Mon Oct 21 10:21:38 2002
From: eallen41 at charter.net (Ed Richardson)
Date: Fri Jan  9 21:47:05 2004
Subject: [mod_python] cancel subscription
Message-ID: <001e01c27915$8d89fd20$cf9ba842@charter.net>

password MEXEOX ...  Please remove me from this mailing list... Thx
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20021021/15c9e78c/attachment.htm
From mcassiano at manord.com  Mon Oct 21 17:27:56 2002
From: mcassiano at manord.com (Cassiano, Marco)
Date: Fri Jan  9 21:47:05 2004
Subject: [mod_python] Win mod_python.so not found by Apache
Message-ID: <52DC70C1C1575C418CB033523A29CF140B8D74@exchange2000.manord.com>

Hello everybody.
My configuration is : 

Windows 2000 Server SP3
Apache 2.0.43
Python 2.2.1 by ActiveState
Mod_Python 3.0 Beta 3 

I put the mod_python.so in the ServerRoot/module folder.
I put lib/mod_python folder in the c:/program files/Python22/lib folder

In the Apache httpd.conf I put the line :

LoadModule python_module modules/mod_python.so

When I start the Apache service I always get the error (taken from the
application event):


Event Type:	Error
Event Source:	Apache Service
Event Category:	None
Event ID:	3299
Date:		21/10/2002
Time:		16.49.54
User:		N/A
Computer:	CORSO_MYSQL
Description:
The Apache service named  reported the following error:
>>> Syntax error on line 67 of C:/Program Files/Apache
Group/Apache2/conf/httpd.conf:     . 
The Apache service named  reported the following error:
>>> Cannot load C:/Program Files/Apache Group/Apache2/modules/mod_python.so
into server: 
The specified module could not be found. 



But the mod_python.so file is right there !
What Am I missing ?
Thanks




> Marco Cassiano
> Resp. Reti e Sistemi
> 
> Manifatture del Nord srl
> viale Regina Elena 13-15
> 42100 Reggio Emilia RE
> ITALY
> 
> Tel. +39 0522 508206
> Fax +39 0522 514001
> email : mcassiano@manord.com
> www.pennyblack.com
> 
> 

From barr at cs.cornell.edu  Tue Oct 22 00:53:55 2002
From: barr at cs.cornell.edu (Rimon Barr)
Date: Fri Jan  9 21:47:05 2004
Subject: [mod_python] spyce v1.1.45
In-Reply-To: <Pine.LNX.4.44.0207071930240.8857-100000@pompom.u.cs.cornell.edu>
Message-ID: <Pine.LNX.4.44.0210220024400.3539-100000@pompom.cs.cornell.edu>

SPYCE - Python Server Pages
  v1.1.45 released on 13 Oct 2002.

SPYCE is a webserver plugin that supports simple and efficient
Python-based dynamic HTML scripting. Those who like Python and are
familiar with JSP, or PHP, or ASP, should have a look at this engine. It
allows one to generate dynamic HTML content just as easily, using Python
for the dynamic parts. Its modular design makes it very flexible and
extensible. It supports FastCGI, CGI and mod_python to plugin into Apache
and most other webservers. It can also be used as a command-line utility
for HTML pre-processing or as a web server proxy.

Get it at:
  http://spyce.sourceforge.net

----------

Dear mod_python users,

Spyce works very nicely under mod_python, and it's been a while since I
posted a release announcement to this list (in fact, since v1.1.22, about
two months ago). Here are some of the major highlights. (The full change
log is available at:
http://cvs.sourceforge.net/cgi-bin/viewcvs.cgi/spyce/spyce/CHANGES?rev=HEAD&content-type=text/vnd.viewcvs-markup).

  - refactored the spyce module infrastructure
  - modules accept initialization arguments
  - new modules and improvements:
      toc - table of contents
      transform - output filters/transformations
      compress - dynamic compression
      error - error handling
      stdout - added push() and pop() methods; loaded implicitly
      and lots of others...
  - more accurate/specific runtime error reporting
  - added server-level configuration options
  - spyce now also supports a proxy server mode
  - added spyceDone exception to stop spyce processing
  - rpm improvements and new windows installer
  - compatibility with Python 1.5.2 and up
  - file globbing added to -O command-line option
  - site and documentation revamp
  - live examples on sourceforge
  - lots of bug fixes
  - performance improvements

If you use mod_python, and the last time you checked out Spyce was two
months ago, then please go take a second look. :)
  http://spyce.sourceforge.net

Comments, suggestions and feature requests are welcome.

Enjoy,
Rimon.


From rien at yeepa.org  Tue Oct 22 18:01:18 2002
From: rien at yeepa.org (Adrien Plisson)
Date: Fri Jan  9 21:47:05 2004
Subject: [mod_python] Win mod_python.so not found by Apache
References: <52DC70C1C1575C418CB033523A29CF140B8D74@exchange2000.manord.com>
Message-ID: <001101c279e4$428a4ee0$0a020101@skynet.be>

From: "Cassiano, Marco" <mcassiano@manord.com>
> I put the mod_python.so in the ServerRoot/module folder.
> I put lib/mod_python folder in the c:/program files/Python22/lib folder

shouldn't you put mod_python.dll instead of mod_python.so ?

.so files are "shared object" under un*x and achieve the same functionnality
as a .dll under windows.

--
rien


From grisha at modpython.org  Tue Oct 22 13:20:46 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:05 2004
Subject: [mod_python] Win mod_python.so not found by Apache
In-Reply-To: <001101c279e4$428a4ee0$0a020101@skynet.be>
Message-ID: <20021022131702.O73449-100000@eden.ispol.com>

It is a DLL, but apache httpd people decided to name their dll's with a
.so. Windows doesn't really care what the file is called, so it works just
the same, but this way the name is same on Windows and unices and you get
a nice little red feather as the icon associated with it. :)

On Tue, 22 Oct 2002, Adrien Plisson wrote:

> From: "Cassiano, Marco" <mcassiano@manord.com>
> > I put the mod_python.so in the ServerRoot/module folder.
> > I put lib/mod_python folder in the c:/program files/Python22/lib folder
>
> shouldn't you put mod_python.dll instead of mod_python.so ?
>
> .so files are "shared object" under un*x and achieve the same functionnality
> as a .dll under windows.
>
> --
> rien
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From neo at https.ru  Tue Oct 22 21:23:14 2002
From: neo at https.ru (Neo Eureka)
Date: Fri Jan  9 21:47:05 2004
Subject: [mod_python] Win mod_python.so not found by Apache
In-Reply-To: <52DC70C1C1575C418CB033523A29CF140B8D74@exchange2000.manord.com>
References: <52DC70C1C1575C418CB033523A29CF140B8D74@exchange2000.manord.com>
Message-ID: <5825926840.20021022212314@https.ru>

 Hi all !

CM> Hello everybody.
CM> My configuration is : 

CM> Windows 2000 Server SP3
CM> Apache 2.0.43
CM> Python 2.2.1 by ActiveState
CM> Mod_Python 3.0 Beta 3 

CM> I put the mod_python.so in the ServerRoot/module folder.
CM> I put lib/mod_python folder in the c:/program files/Python22/lib folder

CM> In the Apache httpd.conf I put the line :

CM> LoadModule python_module modules/mod_python.so

CM> When I start the Apache service I always get the error (taken from the
CM> application event):

CM> Event Type:     Error
CM> Event Source:   Apache Service
CM> Event Category: None
CM> Event ID:       3299
CM> Date:           21/10/2002
CM> Time:           16.49.54
CM> User:           N/A
CM> Computer:       CORSO_MYSQL
CM> Description:
CM> The Apache service named  reported the following error:
>>>> Syntax error on line 67 of C:/Program Files/Apache
CM> Group/Apache2/conf/httpd.conf:     . 
CM> The Apache service named  reported the following error:
>>>> Cannot load C:/Program Files/Apache Group/Apache2/modules/mod_python.so
CM> into server: 
CM> The specified module could not be found. 

CM> But the mod_python.so file is right there !
CM> What Am I missing ?
CM> Thanks

  I've run into the same behaviour of BETA3 under WindowsNT/4.0 &
Apache 2.0.43.


--- 
Neo Eureka / mailto:neo@https.ru


From neo at https.ru  Tue Oct 22 21:30:49 2002
From: neo at https.ru (Neo Eureka)
Date: Fri Jan  9 21:47:05 2004
Subject: [mod_python] Win mod_python.so not found by Apache
In-Reply-To: <001101c279e4$428a4ee0$0a020101@skynet.be>
References: <52DC70C1C1575C418CB033523A29CF140B8D74@exchange2000.manord.com>
 <001101c279e4$428a4ee0$0a020101@skynet.be>
Message-ID: <16026381574.20021022213049@https.ru>

AP> From: "Cassiano, Marco" <mcassiano@manord.com>
>> I put the mod_python.so in the ServerRoot/module folder.
>> I put lib/mod_python folder in the c:/program files/Python22/lib folder

AP> shouldn't you put mod_python.dll instead of mod_python.so ?

  No, he should not.


AP> .so files are "shared object" under un*x and achieve the same functionnality
AP> as a .dll under windows.

  Apache 2 under Windows uses ".so" files for loadable modules instead
of ".dll". In fact, these files are DLLs inside, but they look like
Unix shared object files.


AP> --
AP> rien


---
Neo Eureka / mailto:neo@https.ru


From rpinder at usc.edu  Tue Oct 22 11:36:08 2002
From: rpinder at usc.edu (Rich Pinder)
Date: Fri Jan  9 21:47:05 2004
Subject: [mod_python] Permissions Question on Linux
References: <52DC70C1C1575C418CB033523A29CF140B8D74@exchange2000.manord.com>
 <001101c279e4$428a4ee0$0a020101@skynet.be>
Message-ID: <3DB59A98.2030905@usc.edu>

Sorry for the simplicity of this question.

I'm putting together a site that uses Apache and mod_python and kinterbase to insert data into a Firebird 
(Interbase) server.

All the software resides on the same machine.
I've done some preliminary work on win32 machines, but now am configuring the SuSE 8.1 server.

Heres the question:  Are there any good practice guidelines on what specific Linux user account should be 
running (owning) the scripts, and where they should be residing ?  Rather than just getting something together 
that works, I thought I'd see how others do it.

thanks in advance for your thoughts

rich pinder
usc school of medicine


From rrreid at earthlink.net  Wed Oct 23 12:02:22 2002
From: rrreid at earthlink.net (Mr. Robin R. Reid)
Date: Fri Jan  9 21:47:05 2004
Subject: [mod_python] Problems with BETA3 and Solaris 9
Message-ID: <3DB6E42E.9060105@earthlink.net>

I ran the following configuration command

./configure --with-python --with-apxs=/usr/local/apache/bin/apxs

then ran make to completion. make install, however finished with the
following output:

Performing DSO installation.

./install-sh -c src/mod_python.so /usr/local/apache/modules
install:  src/mod_python.so does not exist
make[1]: *** [install_dso] Error 1
make[1]: Leaving directory `/export/home/tools/mod_python-3.0.0-BETA'
make: *** [install] Error 2

Needless to say, this is quite true. I'm running apache 2.0.43 and am using
gcc 3.1, with most of the gnu build tools installed. Being relatively new to
gnu build tools and mod_python, I'm not sure how to proceed.

Thanks in advance for your help.


From grisha at modpython.org  Wed Oct 23 14:39:21 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:05 2004
Subject: [mod_python] Problems with BETA3 and Solaris 9
In-Reply-To: <3DB6E42E.9060105@earthlink.net>
Message-ID: <20021023143337.B22688-100000@eden.ispol.com>

Did make report errors of any kind? It'd be strange if it didn't.

Try this:

Edit src/Makefile.in, change the line:

mod_python.so: $(SRCS)

to

mod_python.so: $(SRCS)  @EPRINTF_HACK@ @FLOATDIDF_HACK@

Then rerun ./configure --with-apxs=/usr/local/apache/bin/apxs

(You don't need the --with-python argument)

Let me know if it fixes it.

P.S. I had problems building and running apache on Solaris 9 and in the
end what fixed was compiling my own gcc from scratch. I used 3.2, but 3.1
should work OK as well. I also had to set LD_LIBRARY_PATH=/usr/local/lib.
I don't know (or don't care) enough about the intricacies of gcc on
Solaris to be able to explain what exactly goes on there, you may not need
those things on your system... :-)

Grisha


On Wed, 23 Oct 2002, Mr. Robin R. Reid wrote:

> I ran the following configuration command
>
> ./configure --with-python --with-apxs=/usr/local/apache/bin/apxs
>
> then ran make to completion. make install, however finished with the
> following output:
>
> Performing DSO installation.
>
> ./install-sh -c src/mod_python.so /usr/local/apache/modules
> install:  src/mod_python.so does not exist
> make[1]: *** [install_dso] Error 1
> make[1]: Leaving directory `/export/home/tools/mod_python-3.0.0-BETA'
> make: *** [install] Error 2
>
> Needless to say, this is quite true. I'm running apache 2.0.43 and am using
> gcc 3.1, with most of the gnu build tools installed. Being relatively new to
> gnu build tools and mod_python, I'm not sure how to proceed.
>
> Thanks in advance for your help.
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From eugene_beast at mail.ru  Thu Oct 24 09:46:16 2002
From: eugene_beast at mail.ru (Eugene Sizikov)
Date: Fri Jan  9 21:47:05 2004
Subject: [mod_python] unicode() conversion troubles with mod_python 3 CVS 27.06.2002
Message-ID: <005b01c27aff$26914920$0bcbefc3@irkutsk.teleross.ru>

Hello all ppl!

I have troubles with unicode conversion with mod_python from RedHat 8.0
distro. The errorlog is:

"
Mod_python error: "PythonHandler mod_python.publisher"

Traceback (most recent call last):

  File "/usr/lib/python2.2/site-packages/mod_python/apache.py", line 285, in
HandlerDispatch
    result = object(req)

  File "/usr/lib/python2.2/site-packages/mod_python/publisher.py", line 175,
in handler
    result = apply(object, (), args)

  File "/var/www/html/teleross/user.py", line 137, in start
    html = '%s [%s]<HR>' % (string_sql_to_html(user.fullname),
Group(user.con, user.gid).fullname) + menu.to_html()

  File "/var/www/html/teleross/utils.py", line 4, in string_sql_to_html
    return unicode(s, 'koi8-r')

  File
"/usr/src/build/143041-i386/install/usr/lib/python2.2/encodings/__init__.py"
, line 51, in search_function

RuntimeError: cannot unmarshal code objects in restricted execution mode
"

So, when it has "unicode(s, 'koi8-r')" it crashes with that interesting
message I can't understand.

Please, help!

Eugene.



From grisha at modpython.org  Thu Oct 24 17:43:20 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:05 2004
Subject: [mod_python] unicode() conversion troubles with mod_python 3
 CVS 27.06.2002
In-Reply-To: <005b01c27aff$26914920$0bcbefc3@irkutsk.teleross.ru>
Message-ID: <20021024174222.Y39970-100000@eden.ispol.com>

In my case upgrading to Python 2.2.2 eliminated all encodings weirdness.

Grisha

On Thu, 24 Oct 2002, Eugene Sizikov wrote:

> Hello all ppl!
>
> I have troubles with unicode conversion with mod_python from RedHat 8.0
> distro. The errorlog is:
>
> "
> Mod_python error: "PythonHandler mod_python.publisher"
>
> Traceback (most recent call last):
>
>   File "/usr/lib/python2.2/site-packages/mod_python/apache.py", line 285, in
> HandlerDispatch
>     result = object(req)
>
>   File "/usr/lib/python2.2/site-packages/mod_python/publisher.py", line 175,
> in handler
>     result = apply(object, (), args)
>
>   File "/var/www/html/teleross/user.py", line 137, in start
>     html = '%s [%s]<HR>' % (string_sql_to_html(user.fullname),
> Group(user.con, user.gid).fullname) + menu.to_html()
>
>   File "/var/www/html/teleross/utils.py", line 4, in string_sql_to_html
>     return unicode(s, 'koi8-r')
>
>   File
> "/usr/src/build/143041-i386/install/usr/lib/python2.2/encodings/__init__.py"
> , line 51, in search_function
>
> RuntimeError: cannot unmarshal code objects in restricted execution mode
> "
>
> So, when it has "unicode(s, 'koi8-r')" it crashes with that interesting
> message I can't understand.
>
> Please, help!
>
> Eugene.
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From robertoschler at hotmail.com  Fri Oct 25 09:47:10 2002
From: robertoschler at hotmail.com (Robert Oschler)
Date: Fri Jan  9 21:47:05 2004
Subject: [mod_python] Web Hosts that support mod_python?
Message-ID: <OE198VBDUfdfdhNzW3l00004a23@hotmail.com>

I've found several web hosting companies that support Python, but haven't found one that supports mod_python?  Anybody got one that you like?

thx

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20021025/120456a7/attachment.htm
From mk at lrn.ru  Fri Oct 25 20:14:22 2002
From: mk at lrn.ru (Michael Krasnovsky)
Date: Fri Jan  9 21:47:05 2004
Subject: [mod_python] Using mod_python and shelve module
Message-ID: <20021025201422.671d02df.mk@lrn.ru>

Hi!

I try using standard python module shelve in my publisher handler, but I
got the error:

Mod_python error: "PythonHandler mod_python.publisher"
Traceback (most recent call last):

  File "/usr/lib/python2.2/site-packages/mod_python/apache.py", line
193, in Dispatch
    result = object(req)

  File "/usr/lib/python2.2/site-packages/mod_python/publisher.py", line
171, in handler
    result = apply(object, (), args)

  File "/home/mk/www/test2.py", line 7, in handle
    sessiondict = shelve.open('/tmp/apptest.session', 'c')

  File "/usr/lib/python2.2/shelve.py", line 158, in open
    return DbfilenameShelf(filename, flag)

  File "/usr/lib/python2.2/shelve.py", line 148, in __init__
    Shelf.__init__(self, anydbm.open(filename, flag))

  File "/usr/lib/python2.2/anydbm.py", line 86, in open
    return mod.open(file, flag, mode)

  File "/usr/lib/python2.2/dbhash.py", line 16, in open
    return bsddb.hashopen(file, flag, mode)

error: (13, 'Permission denied')


What's the problem? I check permissions of /tmp/ directory - it's OK.
BTW, I wrote simple cgi script with using shelve and it works fine.
I run mod_pytnon 2.7.8+Apache 1.3.27 on Linux. Python version 2.2.1.

Thanks for any help.

-- 
Michael Krasnovsky

E mk@lrn.ru

From neel at mediapulse.com  Fri Oct 25 16:37:34 2002
From: neel at mediapulse.com (Michael C. Neel)
Date: Fri Jan  9 21:47:05 2004
Subject: [mod_python] Web Hosts that support mod_python?
Message-ID: <C0FC22C08B82074A88B50061764157775BCF@johnson.mediapulse.net>

I've seen this question asked here a few times, and wondered why we (my
company) doesn't do this.  So I talked it over, and I'll be able to add
mod_python support when requested to an account.  I don't think it will
be advertised on our site, but email me and I can get it setup.  We
already have MySQL available, and I could install albatross as well
since I use it often.

The details:
    
        www.pulsetechnologies.net (which is a division of the company I
work for, www.mediapulse.com)

	  Contact me (Michael Neel) at neel@mediapulse.com) before
getting an account so that I can make sure you go on a mod_python ready
box.  I'll also be the contact for conf file changes and setup for you.

	Any questions, just email me - I don't want to take up post on
the list with spam even if it is for my company =D.

Mike

--
Michael C. Neel
Director of Software Development
Mediapulse, Inc.

 
-----Original Message-----
From: Robert Oschler [mailto:robertoschler@hotmail.com] 
Sent: Friday, October 25, 2002 9:47 AM
To: mod_python
Subject: [mod_python] Web Hosts that support mod_python?


I've found several web hosting companies that support Python, but
haven't found one that supports mod_python?  Anybody got one that you
like?

thx


From neel at mediapulse.com  Sat Oct 26 14:42:44 2002
From: neel at mediapulse.com (Michael Neel)
Date: Fri Jan  9 21:47:05 2004
Subject: [mod_python] Web Hosts that support mod_python?
In-Reply-To: <20021026004231.12422.qmail@email.com>
Message-ID: <000001c27d1f$78d57b30$0400a8c0@clapton>

Jack,

	I think that's it's all of the above.  First would be a lack of
popularity.  Going to apache's website it hard to find any info on
python under apace at all (hopefully this will change soon).  Next, you
do need a python skilled tech guy to admin and understand the mod_python
issues, and I'm guessing he's hard to find right now compared to perl or
php.

	I'm also not sure of those ISP's that offer mod_perl, how many
of them go beyond just using it for "fast CGI".  Allowing someone access
to embed an apache module in any language is a risky option.  Also, to
setup such a module you would need conf file access, and I'm sure most
ISP's don't like that idea either.

	Now the conf file issues may have resolution, but I'm not sure
how feasible it is to do, so I throw this out for feedback.  What it the
module "registered" itself for the hooks it wanted to use?  This way
there would be no need to change a conf file once setup.  Having the
feature in the conf file to restrict which hooks a module could register
for as well might be nice.  Lastly, having a way to call the module in a
url dynamically would help, so that no setup was needed in a conf file
to say where the module was, i.e. /python-bin/myhandler.py would use
myhandler.py as the module which registered hooks on it own, but
/python-bin/other.py would be a completely different handler all on it
own and neither one mentioned in the conf file; just some type of
"<Directory>" config to say that /python-bin was a handler directory and
that those handlers could register for any of the following hooks.

	I don't know of anything that works like the above, so this
would be very new to the apache world.  I'd like to think it would help
in getting more ISP's to support mod_python, but that's just a guess.
Either way, I'd like to know what others think.

Mike
--
Michael C. Neel
Director of Software Development
Mediapulse, Inc.
Mod_python hosting available

-----Original Message-----
From: Jack Diederich [mailto:jack_diederich@email.com] 
Sent: Friday, October 25, 2002 8:43 PM
To: Michael C. Neel
Subject: RE: [mod_python] Web Hosts that support mod_python?


Hi Michael,

Are there any technical reasons why mod_python isn't supported by most
hosting companies, is it just not popular enough to justify support, or
is it just a policy thing?

If it is anything but a policy thing, please throw a post on mod_python.
Technical tweaks could be made, or maybe someone would write a
webhosting mod_python HOWTO to make life easier for hosting providers.

If the answer is lack of popularity, we'll just have to wait a while. I
know quite a few folks up here in Boston that are moving to python or
ruby for rapid web application development from perl or C++. CPU cycles
are so cheap there isn't much reason not to anymore ;)

-jack

> I've seen this question asked here a few times, and wondered why we 
> (my
> company) doesn't do this.  So I talked it over, and I'll be able to
add
> mod_python support when requested to an account.  I don't think it
will
> be advertised on our site, but email me and I can get it setup.  We
> already have MySQL available, and I could install albatross as well
> since I use it often.

-- 
__________________________________________________________
Sign-up for your own FREE Personalized E-mail at Mail.com
http://www.mail.com/?sr=signup



From grisha at modpython.org  Wed Oct 30 11:49:09 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:05 2004
Subject: [mod_python] BETA 4
Message-ID: <20021030114730.C20021-100000@eden.ispol.com>

Beta 4 of mod_python 3.0 is available for download at
http://www.apache.org/dist/httpd/modpython/dev/

Most likely this will be the last beta before the final release of 3.0

Enjoy,

Grisha


From conrad at hep.caltech.edu  Wed Oct 30 10:01:32 2002
From: conrad at hep.caltech.edu (Conrad Steenberg)
Date: Fri Jan  9 21:47:05 2004
Subject: [mod_python] Customized permission denied message?
Message-ID: <1036000892.1707.117.camel@heppc22.hep.caltech.edu>

Hi

Is it possible to generate a customized permission denied message in an
authenhandler?

I'm using mod_python the answer XML-RPC requests and sending back an
XML-RPC denial message is more elegant than the standard text message.

Thanks!

Conrad

-- 
*-----------------------------------------*
| Conrad Steenberg                        |
| Caltech, Mail Code 356-48               |
| Pasadena, CA, 91125                     |
| e-mail: conrad@hep.caltech.edu          |
| Tel: (626) 395-8758                     |
*-----------------------------------------*


From grisha at modpython.org  Wed Oct 30 13:29:26 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:05 2004
Subject: [mod_python] Customized permission denied message?
In-Reply-To: <1036000892.1707.117.camel@heppc22.hep.caltech.edu>
Message-ID: <20021030132631.Y20021-100000@eden.ispol.com>

Yes, the authenhandler (or any handler for that matter) can service the
request to completion by writing whatever needed to the client (also you
may need to set the right status and headers if any) and return
apache.DONE, thereby telling the server that the request is fully serviced
and no other handlers (except for loging and cleanup) will be executed.

Grisha

On 30 Oct 2002, Conrad Steenberg wrote:

> Hi
>
> Is it possible to generate a customized permission denied message in an
> authenhandler?
>
> I'm using mod_python the answer XML-RPC requests and sending back an
> XML-RPC denial message is more elegant than the standard text message.
>
> Thanks!
>
> Conrad
>
> --
> *-----------------------------------------*
> | Conrad Steenberg                        |
> | Caltech, Mail Code 356-48               |
> | Pasadena, CA, 91125                     |
> | e-mail: conrad@hep.caltech.edu          |
> | Tel: (626) 395-8758                     |
> *-----------------------------------------*
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From antonio at memora.com  Thu Oct 31 17:04:30 2002
From: antonio at memora.com (Antonio L Rodriguez)
Date: Fri Jan  9 21:47:05 2004
Subject: [mod_python] Lifecycle of mod_python instances
Message-ID: <BB355965-ED1C-11D6-9578-00039300D690@memora.com>

Forgive me if this is more of an apache process question, but I 
couldn't find it covered clearly in the docs.

When apache boots up (on *NIX) its starts a bunch of children 
processes. Does each child have its own separate image of mod_python 
execution space that is totally separate from the other images?

That is, if I define a global var to measure hit counts in a script and 
then I see this var dance up and down as each of the child processes 
handles the request, do I infer correctly that there are separate 
python interpreters living inside of each child process?

If this is so, I'd be curious how people do global data structures in 
this model, i.e. a database connection pool.

Thanks,

Antonio


From sh at hob.cx  Tue Oct  1 18:02:44 2002
From: sh at hob.cx (Sean Holdsworth)
Date: Fri Jan  9 21:53:10 2004
Subject: [mod_python] Redirect from publisher - again...
Message-ID: <1033491764.10863.57.camel@hag.private.net>

I'm having a problem getting redirects working from a publisher handler.
I've seen the item in the FAQ (and can get redirection from
non-publisher handlers working fine). This issue also seems to crop up
fairly often in the mod_python list. Grisha has answered the question
before with the following example code.

req.headers_out['location'] = 'http://www.modpython.org/'
req.status = apache.HTTP_MOVED_TEMPORARILY
return "You are being redirected to http://www.modpython.org/"

When I run this I get the "You are being redirected..." message
displayed, and it just sits there. I've been trying to get this to work
for a couple of days and am beginning to wonder if it could be an Apache
setting that is causing the problem?

In addition to the publisher handler I have one handler, the
PythonAccessHandler configured. I use this to manage cookies and
redirect to a login page if the client hasn't authenticated. The
login page has a form with an action that causes the handler that
I'm trying to redirect out of to be run.

I'm running Apache 1.3.23 and  mod_python 2.7.8 with python 2.2 on
Mandrake 8.2 Linux. Could someone please run the above code
fragment as a policy handler and confirm that it is just me and my
configuration that has the problem?

Thanks, Sean



From rmunn at pobox.com  Wed Oct  2 01:27:51 2002
From: rmunn at pobox.com (rmunn@pobox.com)
Date: Fri Jan  9 21:53:10 2004
Subject: [mod_python] Patch to allow kwargs in publisher.py
Message-ID: <20021002062751.GA26230@rmunnlfs>

While playing around with my brand new install of mod_python 3.0.0 beta
2, I discovered that publisher.py does not handle the **kwargs syntax in
functions it's dispatching to. Apparently I'm not the only one who wants
that feature added:

http://www.modpython.org/pipermail/mod_python/2002-June/002171.html

It seems like the Right Thing for publisher.py's handler() func to do
would be to check whether the function accepts the **kwargs syntax
before stripping out unexpected args. Presumably if the user asked for
**kwargs-style args to be passed, he is expecting to receive all the
GET/POST arguments in the **kwargs dictionary. It would be intuitive
(it's what I was expecting to happen, actually, and I was surprised that
it didn't) and useful. And since it hadn't been done yet, I went ahead
and did it -- it was surprisingly simple. Here's a patch. It seems to
work fine for me -- I can't say I've given it a foolproof amount of
testing, but every test I threw at it seemed to do what I expected.

-- 
Robin Munn
rmunn@pobox.com


--- lib/python/mod_python/publisher.py	2002-09-12 13:24:05.000000000 -0500
+++ lib/python/mod_python/publisher.py.new	2002-10-02 01:07:46.000000000 -0500
@@ -180,10 +180,17 @@
             fc = object.im_func.func_code
             expected = fc.co_varnames[1:fc.co_argcount]
 
-        # remove unexpected args
-        for name in args.keys():
-            if name not in expected:
-                del args[name]
+        # does it want keyword args?
+        # co_flags & 0x04 is set if a function wants *args syntax
+        # co_flags & 0x08 is set if a function wants **kwargs syntax
+        if fc.co_flags & 0x08:
+            # don't strip unexpected args if function wants **kwargs
+            pass
+        else:
+            # remove unexpected args
+            for name in args.keys():
+                if name not in expected:
+                    del args[name]
 
         result = apply(object, (), args)
 

From rmunn at pobox.com  Wed Oct  2 08:59:13 2002
From: rmunn at pobox.com (rmunn@pobox.com)
Date: Fri Jan  9 21:53:10 2004
Subject: [mod_python] Documentation patch for kwargs change in publisher.py
Message-ID: <20021002135913.GA29104@rmunnlfs>

To go along with my earlier patch adding **kwargs functionality to the
publisher.py dispatcher, here's a documentation patch to keep the docs
up-to-date.

-- 
Robin Munn
rmunn@pobox.com



--- doc-html/hand-pub-alg-args.html	2002-09-24 11:59:13.000000000 -0500
+++ doc-html/hand-pub-alg-args.html.new	2002-10-02 08:52:51.000000000 -0500
@@ -58,7 +58,11 @@
 object expects. This list is compared with names of fields from HTML
 form data submitted by the client via <code>POST</code> or
 <code>GET</code>. Values of fields whose names match the names of callable
-object arguments will be passed as strings.
+object arguments will be passed as strings. Any fields whose names do
+not match the names of callable argument objects will be silently dropped.
+But if the destination callable object has a <code>**kwargs</code> style
+argument, then fields with unmatched names will be passed in the
+<code>**kwargs</code> argument instead.
 
 <P>
 If the destination is not callable or is a class, then its string

From rmunn at pobox.com  Wed Oct  2 09:25:40 2002
From: rmunn at pobox.com (rmunn@pobox.com)
Date: Fri Jan  9 21:53:10 2004
Subject: [mod_python] Documentation patch (another one) for hand-pub-alg-args.html
Message-ID: <20021002142540.GB29104@rmunnlfs>

Having sent in a patch to hand-pub-alg-args.html just now, I realized
that another paragraph would probably be a good idea, to explain why
it's a bad idea to have any fields called req in the HTML request, since
they would be silently dropped in the publisher.py code. I can just see
someone spending days on figuring out what's happening when all his
fields but one are getting passed through kwargs...

So here's another documentation patch. This one supersedes the doc patch
I just sent -- that is, it's meant to be applied to the original
hand-pub-alg-args.html file, not the updated version that my earlier
patch would produce.

-- 
Robin Munn
rmunn@pobox.com




--- doc-html/hand-pub-alg-args.html	2002-09-24 11:59:13.000000000 -0500
+++ doc-html/hand-pub-alg-args.html.new	2002-10-02 09:16:14.000000000 -0500
@@ -58,7 +58,21 @@
 object expects. This list is compared with names of fields from HTML
 form data submitted by the client via <code>POST</code> or
 <code>GET</code>. Values of fields whose names match the names of callable
-object arguments will be passed as strings.
+object arguments will be passed as strings. Any fields whose names do
+not match the names of callable argument objects will be silently dropped.
+But if the destination callable object has a <code>**kwargs</code> style
+argument, then fields with unmatched names will be passed in the
+<code>**kwargs</code> argument instead.
+
+<P>
+Note that the HTML request argument is passed as <code>req</code> to the
+callable object, so if the form data had any field called <code>req</code>,
+that field will be inaccessible in the callable object code. Fields called
+<code>self</code> will also cause problems for instance methods. If you
+absolutely must have a field named <code>self</code>, then you'd be well
+advised to call the first parameter of the instance method something else,
+such as <code>instobj</code>, or some other name that won't conflict with
+any field names.
 
 <P>
 If the destination is not callable or is a class, then its string

From dagurp at heimsnet.is  Wed Oct  2 14:51:21 2002
From: dagurp at heimsnet.is (=?iso-8859-1?Q?Dagur_P=E1ll_Ammendrup?=)
Date: Fri Jan  9 21:53:10 2004
Subject: [mod_python] Webhost with mod_python?
Message-ID: <001401c26a23$3105d2a0$5d016f0a@dagur>

Hi
Does anyone know of a webhost that offers mod_python and MySQL?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20021002/ffe7a433/attachment-0001.htm
From wilk-ml at flibuste.net  Wed Oct  2 22:05:31 2002
From: wilk-ml at flibuste.net (William Dode)
Date: Fri Jan  9 21:53:10 2004
Subject: [mod_python] Webhost with mod_python?
In-Reply-To: <001401c26a23$3105d2a0$5d016f0a@dagur>
References: <001401c26a23$3105d2a0$5d016f0a@dagur>
Message-ID: <87adlwppx0.fsf@flibuste.net>

Dagur P?ll Ammendrup <dagurp@heimsnet.is> writes:

> Hi
> Does anyone know of a webhost that offers mod_python and MySQL?

I would like to know how it's possible to install mod_python in a shared
web hosting when it's not possible to change the user id like suexec and
there is not safe_mod like php...

An other solution ?

-- 
William - http://wikipython.tuxfamily.org


From list-mod_python at empires.org  Wed Oct  2 14:36:40 2002
From: list-mod_python at empires.org (Jeff Davis)
Date: Fri Jan  9 21:53:10 2004
Subject: [mod_python] Webhost with mod_python?
In-Reply-To: <87adlwppx0.fsf@flibuste.net>
References: <001401c26a23$3105d2a0$5d016f0a@dagur> <87adlwppx0.fsf@flibuste.net>
Message-ID: <200210021436.40191.list-mod_python@empires.org>

> Dagur P?ll Ammendrup <dagurp@heimsnet.is> writes:
> > Hi
> > Does anyone know of a webhost that offers mod_python and MySQL?
>
> I would like to know how it's possible to install mod_python in a shared
> web hosting when it's not possible to change the user id like suexec and
> there is not safe_mod like php...
>
> An other solution ?

In apache2 there will exist an MPM called "mpm_perchild" that spawns a 
separate process for each virtualhost under the virtualhost's userid, and 
then each request to that virtualhost spawns a thread. That is the ideal 
solution. Unfortunately, it's not released in any kind of stable way yet.

Regards,
	Jeff Davis





From neel at mediapulse.com  Wed Oct  2 23:32:03 2002
From: neel at mediapulse.com (Michael Neel)
Date: Fri Jan  9 21:53:10 2004
Subject: [mod_python] MySQL Authencation
In-Reply-To: <200210021436.40191.list-mod_python@empires.org>
Message-ID: <000001c26a8d$7102d820$0400a8c0@clapton>

Hi All,

	I was wondering if anyone has done an SQL authencation module
for mod_python, not unlike mod_perl's Apache::DBI::Auth.  I'm looking
for MySQL, but I could work with any module and rewrite what is needed
to switch db's.  I'm also using apache 2.0 and mod_python 3, but I could
work from a 1.3 / 2.7 module.  I just don't want to start from scratch
if I don't need to.  I've tried to get mod_auth_mysql working under
apache 2, but that projects has more forks than the Sunday table so I'm
not quite sure where to ask install questions there.  Worst case I could
move to RedHat 8, which ships with apache 2, mod_python 3, and
mod_mysql_auth - but that seems like a lot of extra work to get SQL
authencation working!

Mike

--
Michael C. Neel
There are only 10 types of people in the world;
those who understand binary and those who don't.


From gbeasley at tsa.ac.za  Thu Oct  3 13:40:20 2002
From: gbeasley at tsa.ac.za (Grant Beasley)
Date: Fri Jan  9 21:53:10 2004
Subject: [mod_python] Problem with AuthenHandler & Apache Configuration
Message-ID: <OOENKCHGJGHILGPAGHGOEELNCEAA.gbeasley@tsa.ac.za>

Hi

I'm trying to set up my website in such a way that the entire website is
protected by an AuthenHandler, and the "cgi" directory (where my mod_python
scripts run) is directed to a publisher (my own modification of the standard
publisher).

To do this, I setup Apache with the following directives:

<Directory "C:/Projects/http/cgi">
  SetHandler python-program
PythonHandler mypub
PythonDebug On
</Directory>

<Directory "C:/Projects/http">
  SetHandler python-program
PythonAuthenHandler authen
	AuthType Basic
	AuthName "Restricted Area"
	require valid-user
PythonLogHandler log
PythonDebug On
</Directory>

I've programmed my authenhandler (for debugging purposes) as follows:
    pw = req.get_basic_auth_pw()
    user = req.connection.user
    f = open("C:\\authendump.txt", "a")
    f.write("""Authen - %s
URI: %s
UNPARSED_URI: %s
THE_REQUEST: %s
PATH_INFO: %s
FILENAME: %s
USER: %s
PW: %s
-----------------
""" % (strftime('%d/%m/%Y %H:%M:%S', localtime()),req.uri, req.unparsed_uri,
req.the_request, req.path_info, req.filename, user, pw))
    if user is not None:
        return apache.OK
    else:
        return apache.HTTP_UNAUTHORIZED
    f.close()

i.e. Just to dump a few variables for inspection.

For a single request, the above configuration gives me the following:

Authen - 03/10/2002 13:31:16
URI: /showuser
UNPARSED_URI: /showuser
THE_REQUEST: GET /cgi/cool/showuser HTTP/1.1
PATH_INFO:
FILENAME: c:/projects/http/showuser
USER: None
PW: None
-----------------
Authen - 03/10/2002 13:31:16
URI: /cgi/cool/showuser
UNPARSED_URI: /cgi/cool/showuser
THE_REQUEST: GET /cgi/cool/showuser HTTP/1.1
PATH_INFO: /showuser
FILENAME: c:/projects/http/cgi/cool
USER: None
PW: None
-----------------
Authen - 03/10/2002 13:31:18
URI: /showuser
UNPARSED_URI: /showuser
THE_REQUEST: GET /cgi/cool/showuser HTTP/1.1
PATH_INFO:
FILENAME: c:/projects/http/showuser
USER: gb
PW: a
-----------------
Authen - 03/10/2002 13:31:18
URI: /cgi/cool/showuser
UNPARSED_URI: /cgi/cool/showuser
THE_REQUEST: GET /cgi/cool/showuser HTTP/1.1
PATH_INFO: /showuser
FILENAME: c:/projects/http/cgi/cool
USER: gb
PW: a
-----------------

In other words the authenhandler code is executing twice, with a different
URI. On inspection of the get_config() and get_dirs(), I can see that it's
executing once for each of the above directives.

What I'd like to know is why this occurs, and how do I prevent it?

Any help appreciated.

Grant Beasley


From neo at https.ru  Thu Oct  3 23:35:43 2002
From: neo at https.ru (Neo Eureka)
Date: Fri Jan  9 21:53:10 2004
Subject: [mod_python] Apache 2.0.42
Message-ID: <11731692471.20021003233543@https.ru>

Hi !

  It seems, BETA2 of mod_python 3 is not compatible with
Apache-2.0.42. It builds successfully, but when apache is asked to
test new configuration it complains about undefined symbol "openpty"
while trying to load mod_python into the server.

  Linux 7.2, Apache-2.0.42, Python-2.2.1.

                                                                Neo

P.S.
  The latest version of Apache recommended by Apache.org is 2.0.43. It
would be cool if mod_python 3 somehow could cope with these versions.


From grisha at modpython.org  Thu Oct  3 16:58:01 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:10 2004
Subject: [mod_python] Documentation patch for kwargs change in publisher.py
In-Reply-To: <20021002135913.GA29104@rmunnlfs>
Message-ID: <Pine.BSF.4.32.0210031656290.1483-100000@eden.ispol.com>

Thanks, I'll add this in.

BTW, the doc-html stuff automatically generated from .tex files in Doc.

On Wed, 2 Oct 2002 rmunn@pobox.com wrote:

> To go along with my earlier patch adding **kwargs functionality to the
> publisher.py dispatcher, here's a documentation patch to keep the docs
> up-to-date.
>
> --
> Robin Munn
> rmunn@pobox.com
>
>
>
> --- doc-html/hand-pub-alg-args.html	2002-09-24 11:59:13.000000000 -0500
> +++ doc-html/hand-pub-alg-args.html.new	2002-10-02 08:52:51.000000000 -0500
> @@ -58,7 +58,11 @@
>  object expects. This list is compared with names of fields from HTML
>  form data submitted by the client via <code>POST</code> or
>  <code>GET</code>. Values of fields whose names match the names of callable
> -object arguments will be passed as strings.
> +object arguments will be passed as strings. Any fields whose names do
> +not match the names of callable argument objects will be silently dropped.
> +But if the destination callable object has a <code>**kwargs</code> style
> +argument, then fields with unmatched names will be passed in the
> +<code>**kwargs</code> argument instead.
>
>  <P>
>  If the destination is not callable or is a class, then its string
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From grisha at modpython.org  Thu Oct  3 17:30:48 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:10 2004
Subject: [mod_python] Problem with AuthenHandler & Apache Configuration
In-Reply-To: <OOENKCHGJGHILGPAGHGOEELNCEAA.gbeasley@tsa.ac.za>
Message-ID: <Pine.BSF.4.32.0210031728430.1483-100000@eden.ispol.com>

Apache does this. It has to give a module a chance to evaluate permissions
at every directory in the path. I do not believe there is much you can do
about this.

Grisha

On Thu, 3 Oct 2002, Grant Beasley wrote:

> Hi
>
> I'm trying to set up my website in such a way that the entire website is
> protected by an AuthenHandler, and the "cgi" directory (where my mod_python
> scripts run) is directed to a publisher (my own modification of the standard
> publisher).
>
> To do this, I setup Apache with the following directives:
>
> <Directory "C:/Projects/http/cgi">
>   SetHandler python-program
> PythonHandler mypub
> PythonDebug On
> </Directory>
>
> <Directory "C:/Projects/http">
>   SetHandler python-program
> PythonAuthenHandler authen
> 	AuthType Basic
> 	AuthName "Restricted Area"
> 	require valid-user
> PythonLogHandler log
> PythonDebug On
> </Directory>
>
> I've programmed my authenhandler (for debugging purposes) as follows:
>     pw = req.get_basic_auth_pw()
>     user = req.connection.user
>     f = open("C:\\authendump.txt", "a")
>     f.write("""Authen - %s
> URI: %s
> UNPARSED_URI: %s
> THE_REQUEST: %s
> PATH_INFO: %s
> FILENAME: %s
> USER: %s
> PW: %s
> -----------------
> """ % (strftime('%d/%m/%Y %H:%M:%S', localtime()),req.uri, req.unparsed_uri,
> req.the_request, req.path_info, req.filename, user, pw))
>     if user is not None:
>         return apache.OK
>     else:
>         return apache.HTTP_UNAUTHORIZED
>     f.close()
>
> i.e. Just to dump a few variables for inspection.
>
> For a single request, the above configuration gives me the following:
>
> Authen - 03/10/2002 13:31:16
> URI: /showuser
> UNPARSED_URI: /showuser
> THE_REQUEST: GET /cgi/cool/showuser HTTP/1.1
> PATH_INFO:
> FILENAME: c:/projects/http/showuser
> USER: None
> PW: None
> -----------------
> Authen - 03/10/2002 13:31:16
> URI: /cgi/cool/showuser
> UNPARSED_URI: /cgi/cool/showuser
> THE_REQUEST: GET /cgi/cool/showuser HTTP/1.1
> PATH_INFO: /showuser
> FILENAME: c:/projects/http/cgi/cool
> USER: None
> PW: None
> -----------------
> Authen - 03/10/2002 13:31:18
> URI: /showuser
> UNPARSED_URI: /showuser
> THE_REQUEST: GET /cgi/cool/showuser HTTP/1.1
> PATH_INFO:
> FILENAME: c:/projects/http/showuser
> USER: gb
> PW: a
> -----------------
> Authen - 03/10/2002 13:31:18
> URI: /cgi/cool/showuser
> UNPARSED_URI: /cgi/cool/showuser
> THE_REQUEST: GET /cgi/cool/showuser HTTP/1.1
> PATH_INFO: /showuser
> FILENAME: c:/projects/http/cgi/cool
> USER: gb
> PW: a
> -----------------
>
> In other words the authenhandler code is executing twice, with a different
> URI. On inspection of the get_config() and get_dirs(), I can see that it's
> executing once for each of the above directives.
>
> What I'd like to know is why this occurs, and how do I prevent it?
>
> Any help appreciated.
>
> Grant Beasley
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From rmunn at pobox.com  Thu Oct  3 16:39:27 2002
From: rmunn at pobox.com (rmunn@pobox.com)
Date: Fri Jan  9 21:53:10 2004
Subject: [mod_python] Documentation patch for kwargs change in publisher.py
In-Reply-To: <Pine.BSF.4.32.0210031656290.1483-100000@eden.ispol.com>
References: <20021002135913.GA29104@rmunnlfs> <Pine.BSF.4.32.0210031656290.1483-100000@eden.ispol.com>
Message-ID: <20021003213927.GB26042@rmunnlfs>

On Thu, Oct 03, 2002 at 04:58:01PM -0400, Gregory (Grisha) Trubetskoy wrote:
> 
> Thanks, I'll add this in.
> 
> BTW, the doc-html stuff automatically generated from .tex files in Doc.
> 
[snip my patch]

Ah. Next time I send in a doc patch I'll patch the .tex files, then.

-- 
Robin Munn
rmunn@pobox.com

From daniel at copyleft.no  Sat Oct  5 01:23:48 2002
From: daniel at copyleft.no (Hr. Daniel Mikkelsen)
Date: Fri Jan  9 21:53:10 2004
Subject: [mod_python] Problems with PYTHONPATH.
Message-ID: <20021005011159.B33688-100000@unity.copyleft.no>

Hi.

I'm experiencing odd behaviour with mod_python and its PYTHONPATH. I'm running
FreeBSD 4.5. I'm not using the port-version of mod_python, since I want use a
separate threadless Python.

Anyway, I've compiled up things, and they basically work. I have my python
version in /local/python-2.2.1-threadless. Mod_python, when ./configuring
detects this from the --with-python=/local/src/Python-2.2.1 I give it.

All very automatic and nice.

But when I fire up Apache with this, things just refuse to work until I add a
symlink from
"/local/python-2.2.1-threadless/lib/python2.2/site-packages/mod_python" to
"/usr/local/lib/python2.2/site-packages".

And when I make my test handler print out sys.path, what I get is the
/usr/local prefixed ones, not the /local/python-2.2.1-threadless ones.

I can't figure out what's going on. The mod_python.so DSO only knows about
/local/python-2.2.1-threadless.

I've worked around this with a PythonPath entry, but I'm very curious as to why
this is happening. Is /usr/local some default prefix Python defaults to? Is
mod_python.so loading /usr/local/lib/python2.2/config/libpython2.2.a somehow by
mistake?

I'm absolutely certain there is only one installation of mod_python on my
system, and that it's configured and compiled with the correct (threadless)
interpreter.

Any help would be appreciated. :)

-- Daniel


From jack_diederich at email.com  Fri Oct  4 20:43:18 2002
From: jack_diederich at email.com (Jack Diederich)
Date: Fri Jan  9 21:53:11 2004
Subject: [mod_python] Problems with PYTHONPATH.
Message-ID: <20021005014318.19386.qmail@email.com>

I had a similar problem when using a user specific python instead of the system wide python with mod_python.
I took the cowards way out and just issued a PythonPath directive in httpd.conf with all the paths I need.

-jack
----- Original Message -----
From: "Hr. Daniel Mikkelsen" <daniel@copyleft.no>
Date: Sat, 5 Oct 2002 01:23:48 +0200 (CEST) 
To: mod_python@modpython.org
Subject: [mod_python] Problems with PYTHONPATH.


> Hi.
> 
> I'm experiencing odd behaviour with mod_python and its PYTHONPATH. I'm running
> FreeBSD 4.5. I'm not using the port-version of mod_python, since I want use a
> separate threadless Python.
> 
> Anyway, I've compiled up things, and they basically work. I have my python
> version in /local/python-2.2.1-threadless. Mod_python, when ./configuring
> detects this from the --with-python=/local/src/Python-2.2.1 I give it.
> 
> All very automatic and nice.
> 
> But when I fire up Apache with this, things just refuse to work until I add a
> symlink from
> "/local/python-2.2.1-threadless/lib/python2.2/site-packages/mod_python" to
> "/usr/local/lib/python2.2/site-packages".
> 
> And when I make my test handler print out sys.path, what I get is the
> /usr/local prefixed ones, not the /local/python-2.2.1-threadless ones.
> 
> I can't figure out what's going on. The mod_python.so DSO only knows about
> /local/python-2.2.1-threadless.
> 
> I've worked around this with a PythonPath entry, but I'm very curious as to why
> this is happening. Is /usr/local some default prefix Python defaults to? Is
> mod_python.so loading /usr/local/lib/python2.2/config/libpython2.2.a somehow by
> mistake?
> 
> I'm absolutely certain there is only one installation of mod_python on my
> system, and that it's configured and compiled with the correct (threadless)
> interpreter.
> 
> Any help would be appreciated. :)
> 
> -- Daniel
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 
> 

-- 
__________________________________________________________
Sign-up for your own FREE Personalized E-mail at Mail.com
http://www.mail.com/?sr=signup


"Free price comparison tool gives you the best prices and cash back!"
http://www.bestbuyfinder.com/download.htm


From piet at cs.uu.nl  Sat Oct  5 13:03:33 2002
From: piet at cs.uu.nl (Piet van Oostrum)
Date: Fri Jan  9 21:53:11 2004
Subject: [mod_python] Apache 2.0.42
In-Reply-To: <11731692471.20021003233543@https.ru>
References: <11731692471.20021003233543@https.ru>
Message-ID: <wzn0pttaey.fsf@cs.uu.nl>

>>>>> Neo Eureka <neo@https.ru> (NE) writes:

NE> Hi !

NE>   It seems, BETA2 of mod_python 3 is not compatible with
NE> Apache-2.0.42. It builds successfully, but when apache is asked to
NE> test new configuration it complains about undefined symbol "openpty"
NE> while trying to load mod_python into the server.

Maybe this previous post will help:

----- Original Message -----
From: "Carl C." <cc@carlc.com>
Subject: Re: [mod_python] Compiling a DSO module for RedHat Linux on ALPHA
64bit.
Guess, what... I FIXED IT...
I had to edit the mod_python's src/Makefile and change the
LIBS=-lm? /usr/src/Python-2.2-no-threads/libpython2.2.a
to
LIBS=-lm? /usr/src/Python-2.2-no-threads/libpython2.2.a -lutil
That -lutil was the magic!
Carl

-- 
Piet van Oostrum <piet@cs.uu.nl>
URL: http://www.cs.uu.nl/~piet [PGP]
Private email: P.van.Oostrum@hccnet.nl



From jack_diederich at email.com  Sat Oct  5 08:10:46 2002
From: jack_diederich at email.com (Jack Diederich)
Date: Fri Jan  9 21:53:11 2004
Subject: [mod_python] Apache 2.0.42
Message-ID: <20021005131050.32347.qmail@email.com>

For me (mod_python 2x, linux, Python 2.2.1) I needed to symlink Modules/Makefile to the root Python Makefile or ./configure would leave out some libraries in the linker line.  I don't remember if libutil was one of them.

I posted that to python-dev@httpd.apache.org, does anyone know if there is a searchable archive, or when there might be one in the future?

-jack
----- Original Message -----
From: Piet van Oostrum <piet@cs.uu.nl>
Date: 05 Oct 2002 13:03:33 +0200 
To: Neo Eureka <neo@https.ru>
Subject: Re: [mod_python] Apache 2.0.42


> >>>>> Neo Eureka <neo@https.ru> (NE) writes:
> 
> NE> Hi !
> 
> NE>   It seems, BETA2 of mod_python 3 is not compatible with
> NE> Apache-2.0.42. It builds successfully, but when apache is asked to
> NE> test new configuration it complains about undefined symbol "openpty"
> NE> while trying to load mod_python into the server.
> 
> Maybe this previous post will help:
> 
> ----- Original Message -----
> From: "Carl C." <cc@carlc.com>
> Subject: Re: [mod_python] Compiling a DSO module for RedHat Linux on ALPHA
> 64bit.
> Guess, what... I FIXED IT...
> I had to edit the mod_python's src/Makefile and change the
> LIBS=-lm  /usr/src/Python-2.2-no-threads/libpython2.2.a
> to
> LIBS=-lm  /usr/src/Python-2.2-no-threads/libpython2.2.a -lutil
> That -lutil was the magic!
> Carl
> 
> -- 
> Piet van Oostrum <piet@cs.uu.nl>
> URL: http://www.cs.uu.nl/~piet [PGP]
> Private email: P.van.Oostrum@hccnet.nl
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 
> 

-- 
__________________________________________________________
Sign-up for your own FREE Personalized E-mail at Mail.com
http://www.mail.com/?sr=signup


"Free price comparison tool gives you the best prices and cash back!"
http://www.bestbuyfinder.com/download.htm


From mateusz at ant.gliwice.pl  Sat Oct  5 15:39:48 2002
From: mateusz at ant.gliwice.pl (Mateusz Korniak)
Date: Fri Jan  9 21:53:11 2004
Subject: [mod_python] Perhaps bug in mod_pythons configure.in ? (python 2.2 and undefined symbol "openpty")
In-Reply-To: <20021005131050.32347.qmail@email.com>
References: <20021005131050.32347.qmail@email.com>
Message-ID: <200210051536.10652.mateusz@ant.gliwice.pl>

On Saturday 05 October 2002 15:10, Jack Diederich wrote:

> > NE>   It seems, BETA2 of mod_python 3 is not compatible with
> > NE> Apache-2.0.42. It builds successfully, but when apache is asked to
> > NE> test new configuration it complains about undefined symbol "openpty"
> > NE> while trying to load mod_python into the server.

> For me (mod_python 2x, linux, Python 2.2.1) I needed to symlink
> Modules/Makefile to the root Python Makefile or ./configure would leave out
> some libraries in the linker line.  I don't remember if libutil was one of
> them.
>
I've run at similar behavior ....
I'm totally ignorant about autoconf/automake stuff but I think problem affects 
python 2.2 bug in configure.in.

2.2 version triggers bad path to Makefile -> python is badly recognaised as 
linked without libs -> symbols are missing.

# set python std library variable
AC_MSG_CHECKING(what libraries Python was linked with)
AC_SUBST(LIBS)
if test -z "$PYTHON_SRC"; then
  PyLIBP=${PyEXEC_INSTALLDIR}/lib/python${PyVERSION}
  PyLIBPL=${PyLIBP}/config
  PyPYTHONLIBS=${PyLIBPL}/libpython${PyVERSION}.a
  PyLIBS=`grep "^LIB[[SMC]]=" ${PyLIBPL}/Makefile | cut -f2 -d= | tr 
'\011\012\015' '   '`
  PyMODLIBS=`grep "^LOCALMODLIBS=" ${PyLIBPL}/Makefile | cut -f2 -d= | tr 
'\011\012\015' '   '`
  PY_LIBS="${PyPYTHONLIBS} ${PyLIBS} ${PyMODLIBS}"
else
  PyPYTHONLIBS=${PYTHON_SRC}/libpython${PyVERSION}.a
  if test ${PyVERSION} = "2.1"; then
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ IMHO This test should be possitive for 2.2 
too

    PyLIBS=`grep "^LIB[[SMC]]=" ${PYTHON_SRC}/Makefile | cut -f2 -d= | tr 
'\011\012\015' '   '`
    PyMODLIBS=`grep "^LOCALMODLIBS=" ${PYTHON_SRC}/Makefile | cut -f2 -d= | tr 
'\011\012\015' '   '`
  else
    PyLIBS=`grep "^LIB[[SMC]]=" ${PYTHON_SRC}/Modules/Makefile | cut -f2 -d= | 
tr '\011\012\015' '   '`
    PyMODLIBS=`grep "^LOCALMODLIBS=" ${PYTHON_SRC}/Modules/Makefile | cut -f2 
-d= | tr '\011\012\015' '   '`
  fi
  PY_LIBS="${PyPYTHONLIBS} ${PyLIBS} ${PyMODLIBS}"
fi


-- 
Mateusz Korniak
"Black holes are where God divided by zero." - Steven Wright



From mateusz at ant.gliwice.pl  Sat Oct  5 15:45:09 2002
From: mateusz at ant.gliwice.pl (Mateusz Korniak)
Date: Fri Jan  9 21:53:11 2004
Subject: [mod_python] Two more fixes to ac/am stuff (patches included)
Message-ID: <200210051545.09369.mateusz@ant.gliwice.pl>

Both taken from PLD distro...

1. Fixes DESTDIR behavior
2. Fixes typo. (IMHO)


-- 
Mateusz Korniak

-------------- next part --------------
A non-text attachment was scrubbed...
Name: apache-mod_python-DESTDIR.patch
Type: text/x-diff
Size: 987 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20021005/e3571cd3/apache-mod_python-DESTDIR-0001.bin
-------------- next part --------------
A non-text attachment was scrubbed...
Name: apache-mod_python-Makefile-in.patch
Type: text/x-diff
Size: 507 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20021005/e3571cd3/apache-mod_python-Makefile-in-0001.bin
From neo at https.ru  Sat Oct  5 23:43:24 2002
From: neo at https.ru (Neo Eureka)
Date: Fri Jan  9 21:53:11 2004
Subject: [mod_python] Missing library in Makefile
In-Reply-To: <wzn0pttaey.fsf@cs.uu.nl>
References: <11731692471.20021003233543@https.ru> <wzn0pttaey.fsf@cs.uu.nl>
Message-ID: <974103440.20021005234324@https.ru>

  Dank U wel !

  This was it!

I think all the problems in configure/make stuff should be corrected
before any other bugs, because such problems prevent not very
experienced users (like me, at the moment) from testing the software
itself.


NE>> Hi !

NE>>   It seems, BETA2 of mod_python 3 is not compatible with
NE>> Apache-2.0.42. It builds successfully, but when apache is asked to
NE>> test new configuration it complains about undefined symbol "openpty"
NE>> while trying to load mod_python into the server.

PvO> Maybe this previous post will help:

PvO> ----- Original Message -----
PvO> From: "Carl C." <cc@carlc.com>
PvO> Subject: Re: [mod_python] Compiling a DSO module for RedHat Linux on ALPHA
PvO> 64bit.
PvO> Guess, what... I FIXED IT...
PvO> I had to edit the mod_python's src/Makefile and change the
PvO> LIBS=-lm? /usr/src/Python-2.2-no-threads/libpython2.2.a
PvO> to
PvO> LIBS=-lm? /usr/src/Python-2.2-no-threads/libpython2.2.a -lutil
PvO> That -lutil was the magic!
PvO> Carl

---
Neo Eureka / mailto:neo@https.ru


From neo at https.ru  Sun Oct  6 18:25:52 2002
From: neo at https.ru (Neo)
Date: Fri Jan  9 21:53:11 2004
Subject: [mod_python] Segfaults... segfaults...
Message-ID: <19513182194.20021006182552@https.ru>

  Hi all !

  I was just playing with mod_python 3 & Apache 2.0.42
(RedHat Linux 7.2). Below are my "mptest.py" file, Apache VH config
and the resuts of the single request:

GET /mptest.py


----------------BEGIN----------------
from mod_python import apache


interp = None

def transhandler(req):
    interp = req.interpreter
    return apache.OK

def handler(req):
    req.write(repr(interp))
    return apache.OK
-----------------END-----------------

Config for virtual host:
----------------BEGIN----------------
<VirtualHost *>
[... skipped ...]

    PythonPath    "..."

    PythonDebug On
    PythonTransHandler mptest
    SetHandler python-program
    PythonHandler mptest

    <Directory "/home/w-https/test-www">
        Options Indexes FollowSymLinks
        AllowOverride None

        Order allow,deny
        Allow from all

        DirectoryIndex index.html index.htm index.html.var

        AddDefaultCharset UTF-8
    </Directory>

[... skipped ...]
</VirtualHost>
-----------------END-----------------

Apache virtualhost log file:
----------------BEGIN----------------
[Sun Oct 06 18:02:44 2002] [info] [client 212.188.98.243] Module bug?
Request filename is missing for URI /mptest.py
-----------------END-----------------

*** I guess "transhandler" in the above example should somehow set
    filename for incoming request for Apache to be happy? But SEGFAULT
    is not the best action to report the error :)

Apache main server log file:
----------------BEGIN----------------
[Sun Oct 06 18:02:45 2002] [notice] child pid 12331 exit signal
Segmentation fault (11) 
-----------------END-----------------


---
Neo Eureka / mailto:neo@https.ru


From michaelteo at bigfoot.com  Mon Oct  7 17:55:51 2002
From: michaelteo at bigfoot.com (Michael Teo)
Date: Fri Jan  9 21:53:11 2004
Subject: [mod_python] Module conflicts on mod_python
Message-ID: <20021007095551.GA4290@bigfoot.com>

Hi, I am fortunate enough to be able deploy mod_python on a commercial web
server. 

However, I am currently being plagued by this problem.
I am running Apache 1.3.27 with mod_python 2.7.8 and python 2.2.1.
Virtualname hosting is enabled on Apache to allow virtual domainname hosting.

Now, say domain A and domain B has some mod_python publisher scripts which
import a session.py script. Only one session.py in either domain A or domain
B is loaded. However, the implementation of session.py is very different in
both domains and this causes a whole lot of errors on either A or B scripts.

Is there a misconfiguration in my httpd.conf, or is that supposed to be the
part of the feature with mod_python ?
Any advice will be greatly appreciated.
Thanks in advance.



The following are the contents of the .htaccess file in the cgi-bin 
directories. PythonPath are modified accordingly to the domainA and domainB.

AddHandler python-program .py .pyc
PythonHandler mod_python.publisher
PythonPath "sys.path + [ '/home/www/domainA/public_html/cgi-bin' ]



-- 
Michael Teo <mailto:michaelteo@bigfoot.com>
http://miketeo.net/
PGP  0x6C846A9C  DB:7D:51:D4:4D:AB:97:79:E4:68:D9:07:94:36:D5:1A:6C:84:6A:9C
     0x6937FB05  08:50:A1:4D:2E:45:58:60:DE:71:1F:30:63:54:EF:7B

From rmunn at pobox.com  Mon Oct  7 09:06:37 2002
From: rmunn at pobox.com (rmunn@pobox.com)
Date: Fri Jan  9 21:53:11 2004
Subject: [mod_python] Module conflicts on mod_python
In-Reply-To: <20021007095551.GA4290@bigfoot.com>
References: <20021007095551.GA4290@bigfoot.com>
Message-ID: <20021007140637.GA5212@rmunnlfs>

On Mon, Oct 07, 2002 at 05:55:51PM +0800, Michael Teo wrote:
> 
> Hi, I am fortunate enough to be able deploy mod_python on a commercial web
> server. 
> 
> However, I am currently being plagued by this problem.
> I am running Apache 1.3.27 with mod_python 2.7.8 and python 2.2.1.
> Virtualname hosting is enabled on Apache to allow virtual domainname hosting.
> 
> Now, say domain A and domain B has some mod_python publisher scripts which
> import a session.py script. Only one session.py in either domain A or domain
> B is loaded. However, the implementation of session.py is very different in
> both domains and this causes a whole lot of errors on either A or B scripts.
> 
> Is there a misconfiguration in my httpd.conf, or is that supposed to be the
> part of the feature with mod_python ?
> Any advice will be greatly appreciated.
> Thanks in advance.
> 
> 
> 
> The following are the contents of the .htaccess file in the cgi-bin 
> directories. PythonPath are modified accordingly to the domainA and domainB.
> 
> AddHandler python-program .py .pyc
> PythonHandler mod_python.publisher
> PythonPath "sys.path + [ '/home/www/domainA/public_html/cgi-bin' ]
> 

Do you have the PythonInterpPerDirectory directive turned on? It would
allow domain A and domain B's scripts to run in separate Python
interpreters with completely separate namespaces, so their session.py
scripts could not conflict with each other. For more information:

http://www.modpython.org/live/mod_python-2.7.8/doc-html/dir-other-ipd.html

-- 
Robin Munn
rmunn@pobox.com
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20021007/bc29ddb4/attachment-0001.bin
From rmunn at pobox.com  Tue Oct  8 12:34:46 2002
From: rmunn at pobox.com (rmunn@pobox.com)
Date: Fri Jan  9 21:53:11 2004
Subject: [mod_python] Segfault when using PythonImport directive
Message-ID: <20021008173446.GB5212@rmunnlfs>

I'm using mod_python 3.0.0 BETA 2 with Apache 2.0.42 and encountering a
segfault every time I try to use the PythonInclude directive. The
segfault occurs even when I try to have Apache do a configuration syntax
check (/usr/apache2/bin/apachectl configtest). I've narrowed it down to
a single PythonInclude line. This is the <Directory> directive in which
the PythonInclude directive appears:


<Directory /var/www/publisher>
    AddHandler python-program .py
    PythonHandler mod_python.publisher
    PythonInterpPerDirective On
    PythonImport globals
</Directory>


If I comment out the "PythonImport globals" line, everything runs fine.

Here's the contents of my /var/www/publisher directory:


rmunn@localhost:/var/www/publisher$ ls -l
total 8
-rw-r--r--    1 rmunn    users          12 Oct  7 19:22 globals.py
-rw-r--r--    1 rmunn    users         133 Oct  8 12:26 tryme.py
rmunn@localhost:/var/www/publisher$ cat globals.py 
foo = 'bar'
rmunn@localhost:/var/www/publisher$ cat tryme.py 
def show(req, name):
    try:
        return str(globals.foo)
    except AttributeError, NameError:
        return str(dir(globals))


As you can see, what I'm trying to do is have some global variables
pre-defined in my mod_python scripts; I plan on using this to accomplish
expensive operations (like opening database connections) once per apache
process child instead of once per request.

Here's the gdb backtrace of my segfault. I'm running httpd -t to only
get a configuration syntax check and it's still failing. Any ideas?


root@localhost:/usr/apache2/conf# gdb ../bin/httpd 
GNU gdb 5.2.1
Copyright 2002 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you
are
welcome to change it and/or distribute copies of it under certain
conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for
details.
This GDB was configured as "i686-pc-linux-gnu"...
(gdb) run -t
Starting program: /usr/apache2/bin/httpd -t
[New Thread 1024 (LWP 29765)]

Program received signal SIGSEGV, Segmentation fault.
[Switching to Thread 1024 (LWP 29765)]
__pthread_mutex_lock (mutex=0x10) at mutex.c:99
99      mutex.c: No such file or directory.
        in mutex.c
(gdb) backtrace full
#0  __pthread_mutex_lock (mutex=0x10) at mutex.c:99
        mutex = (pthread_mutex_t *) 0x10
        self = 0x0
#1  0x403d8f43 in PyThread_acquire_lock (lock=0x0, waitflag=1) at
Python/thread_pthread.h:359
        lock = 0x0
        success = 1078103364
        status = 0
        error = 0
#2  0x403bbb4e in PyEval_AcquireLock () at Python/ceval.c:267
No locals.
#3  0x4037c1b3 in directive_PythonImport (cmd=0xbffffc30,
mconfig=0x80e0958, module=0x80e0e28 "globals") at mod_python.c:1220
        cmd = (cmd_parms *) 0x0
        mconfig = (void *) 0x0
        module = 0x0
#4  0x08067349 in invoke_cmd (cmd=0x4040d154, parms=0xbffffc30,
mconfig=0x80e0958, args=0x80d594f "") at config.c:800
        w = 0x80e0e28 "globals"
        w2 = 0xbffffc30 ""
        w3 = 0x4040d154 "\231n?@\234Á7@"
        errmsg = 0x0
#5  0x08067a53 in ap_walk_config_sub (current=0x80d5928,
parms=0xbffffc30, section_vector=0x80e05f0) at config.c:1082
        dir_config = (void *) 0x4040d154
        retval = 0x4040d154 "\231n?@\234Á7@"
        cmd = (command_rec *) 0x4040d154
        current = (ap_directive_t *) 0x80d5928
        parms = (cmd_parms *) 0xbffffc30
        mod = (module *) 0x4040d2e0
#6  0x08067ad1 in ap_walk_config (current=0x80d5850, parms=0xbffffc30,
section_vector=0x80e05f0) at config.c:1121
        errmsg = 0x0
        current = (ap_directive_t *) 0x80d5928
        parms = (cmd_parms *) 0xbffffc30
        oldconfig = (ap_conf_vector_t *) 0x80b3488
#7  0x08074beb in dirsection (cmd=0xbffffc30, mconfig=0x80b3598,
arg=0x80e0792 "") at core.c:1625
        cmd = (cmd_parms *) 0xbffffc30
        errmsg = 0x0
        endp = 0x80e07e0 ""
        old_overrides = 150
        old_path = 0x0
        conf = (core_dir_config *) 0x80e07e0
        new_dir_conf = (ap_conf_vector_t *) 0x80e05f0
        r = (regex_t *) 0x0
        thiscmd = (command_rec *) 0x8088bec
        err = 0x0
#8  0x08066e6e in invoke_cmd (cmd=0x8088bec, parms=0xbffffc30,
mconfig=0x80b3598, args=0x80d5828 "/var/www/publisher>") at config.c:713
        w = 0x80d5808 "øW\r\b(X\r\b"
        w2 = 0xbffffc30 ""
        w3 = 0x4040d154 "\231n?@\234Á7@"
        errmsg = 0x0
#9  0x08067a53 in ap_walk_config_sub (current=0x80d5808,
parms=0xbffffc30, section_vector=0x80b3488) at config.c:1082
        dir_config = (void *) 0x4040d154
        retval = 0x4040d154 "\231n?@\234Á7@"
        cmd = (command_rec *) 0x8088bec
        current = (ap_directive_t *) 0x80d5808
        parms = (cmd_parms *) 0xbffffc30
        mod = (module *) 0x808ed60
#10 0x08067ad1 in ap_walk_config (current=0x80b49d0, parms=0xbffffc30,
section_vector=0x80b3488) at config.c:1121
        errmsg = 0x0
        current = (ap_directive_t *) 0x80d5808
        parms = (cmd_parms *) 0xbffffc30
        oldconfig = (ap_conf_vector_t *) 0x0
#11 0x080684e0 in ap_process_config_tree (s=0x80b2ec8,
conftree=0x80b49d0, p=0x8098d10, ptemp=0x80c4dc0) at config.c:1583
        s = (server_rec *) 0x4040d154
        p = (apr_pool_t *) 0x8098d10
        ptemp = (apr_pool_t *) 0x0
        errmsg = 0x808defc ""
        parms = {info = 0x0, override = 95, limited = -1,
limited_xmethods = 0x0, xlimited = 0x0, config_file = 0x0, directive =
0x80d5928, pool = 0x8098d10, 
  temp_pool = 0x80c4dc0, server = 0x80b2ec8, path = 0x80e07c8
"/var/www/publisher/", cmd = 0x4040d154, context = 0x80e05f0,
err_directive = 0x0}
#12 0x0806a811 in main (argc=2, argv=0xbffffd44) at main.c:564
        c = 116 't'
        configtestonly = 1
        confname = 0x8086518 "conf/httpd.conf"
        def_server_root = 0x8086528 "/usr/apache2"
        temp_error_log = 0x0
        process = (process_rec *) 0x8096d88
        server_conf = (server_rec *) 0x80b2ec8
        pglobal = (apr_pool_t *) 0x8096d08
        pconf = (apr_pool_t *) 0x8098d10
        plog = (apr_pool_t *) 0x80c2db8
        ptemp = (apr_pool_t *) 0x80c4dc0
        pcommands = (apr_pool_t *) 0x80c0db0
        opt = (apr_getopt_t *) 0x80c0e48
        rv = 0
        mod = (module **) 0x80b2ec8
        optarg = 0x0
        signal_server = (apr_OFN_ap_signal_server_t *) 0x4040d154
<python_commands+264>
#13 0x40189571 in __libc_start_main (main=0x806a370 <main>, argc=2,
ubp_av=0xbffffd44, init=0x805b824 <_init>, fini=0x80812e0 <_fini>,
rtld_fini=0x4000aa24 <_dl_fini>, 
    stack_end=0xbffffd3c) at ../sysdeps/generic/libc-start.c:129
        ubp_av = (char **) 0xbffffd44
        fini = (void (*)()) 0x400154ac <_dl_debug_mask>
        rtld_fini = (void (*)()) 0x80e0e28
        ubp_ev = (char **) 0x0


-- 
Robin Munn
rmunn@pobox.com
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20021008/e6c4c75b/attachment-0001.bin
From neel at mediapulse.com  Tue Oct  8 16:33:19 2002
From: neel at mediapulse.com (Michael C. Neel)
Date: Fri Jan  9 21:53:11 2004
Subject: [mod_python] Segfault when using PythonImport directive
Message-ID: <C0FC22C08B82074A88B50061764157775BC2@johnson.mediapulse.net>

Not addressing the segfault, couldn't you handle globals in the python
program itself?  I do this for database handles my self:

from mod_python import apache
import MySQLdb

db = MySQLdb.connect("yada yada")

def handler(req):
	do cool db stuff with req here

I do this often, and I've checked that each request doesn't generate a
db connection by watching the MySQL number of connects.  One thing to
keep in mind is that a db handle may go stale if not used by some
databases, so be sure to add some code to test out the db handle each
request and reconnect if needed.  The DB API 2.0 spec doesn't define a
ping method like perl's DBI does, so I usually add one myself for this.

Mike

--
Michael C. Neel
Director of Software Development
Mediapulse, Inc.
 

-----Original Message-----
From: rmunn@pobox.com [mailto:rmunn@pobox.com] 
Sent: Tuesday, October 08, 2002 1:35 PM
To: mod_python@modpython.org
Subject: [mod_python] Segfault when using PythonImport directive


I'm using mod_python 3.0.0 BETA 2 with Apache 2.0.42 and encountering a
segfault every time I try to use the PythonInclude directive. The
segfault occurs even when I try to have Apache do a configuration syntax
check (/usr/apache2/bin/apachectl configtest). I've narrowed it down to
a single PythonInclude line. This is the <Directory> directive in which
the PythonInclude directive appears:


<Directory /var/www/publisher>
    AddHandler python-program .py
    PythonHandler mod_python.publisher
    PythonInterpPerDirective On
    PythonImport globals
</Directory>


If I comment out the "PythonImport globals" line, everything runs fine.

Here's the contents of my /var/www/publisher directory:


rmunn@localhost:/var/www/publisher$ ls -l
total 8
-rw-r--r--    1 rmunn    users          12 Oct  7 19:22 globals.py
-rw-r--r--    1 rmunn    users         133 Oct  8 12:26 tryme.py
rmunn@localhost:/var/www/publisher$ cat globals.py 
foo = 'bar'
rmunn@localhost:/var/www/publisher$ cat tryme.py 
def show(req, name):
    try:
        return str(globals.foo)
    except AttributeError, NameError:
        return str(dir(globals))


As you can see, what I'm trying to do is have some global variables
pre-defined in my mod_python scripts; I plan on using this to accomplish
expensive operations (like opening database connections) once per apache
process child instead of once per request.

Here's the gdb backtrace of my segfault. I'm running httpd -t to only
get a configuration syntax check and it's still failing. Any ideas?


root@localhost:/usr/apache2/conf# gdb ../bin/httpd 
GNU gdb 5.2.1
Copyright 2002 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you
are
welcome to change it and/or distribute copies of it under certain
conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for
details.
This GDB was configured as "i686-pc-linux-gnu"...
(gdb) run -t
Starting program: /usr/apache2/bin/httpd -t
[New Thread 1024 (LWP 29765)]

Program received signal SIGSEGV, Segmentation fault.
[Switching to Thread 1024 (LWP 29765)]
__pthread_mutex_lock (mutex=0x10) at mutex.c:99
99      mutex.c: No such file or directory.
        in mutex.c
(gdb) backtrace full
#0  __pthread_mutex_lock (mutex=0x10) at mutex.c:99
        mutex = (pthread_mutex_t *) 0x10
        self = 0x0
#1  0x403d8f43 in PyThread_acquire_lock (lock=0x0, waitflag=1) at
Python/thread_pthread.h:359
        lock = 0x0
        success = 1078103364
        status = 0
        error = 0
#2  0x403bbb4e in PyEval_AcquireLock () at Python/ceval.c:267
No locals.
#3  0x4037c1b3 in directive_PythonImport (cmd=0xbffffc30,
mconfig=0x80e0958, module=0x80e0e28 "globals") at mod_python.c:1220
        cmd = (cmd_parms *) 0x0
        mconfig = (void *) 0x0
        module = 0x0
#4  0x08067349 in invoke_cmd (cmd=0x4040d154, parms=0xbffffc30,
mconfig=0x80e0958, args=0x80d594f "") at config.c:800
        w = 0x80e0e28 "globals"
        w2 = 0xbffffc30 ""
        w3 = 0x4040d154 "\231n?@\234?7@"
        errmsg = 0x0
#5  0x08067a53 in ap_walk_config_sub (current=0x80d5928,
parms=0xbffffc30, section_vector=0x80e05f0) at config.c:1082
        dir_config = (void *) 0x4040d154
        retval = 0x4040d154 "\231n?@\234?7@"
        cmd = (command_rec *) 0x4040d154
        current = (ap_directive_t *) 0x80d5928
        parms = (cmd_parms *) 0xbffffc30
        mod = (module *) 0x4040d2e0
#6  0x08067ad1 in ap_walk_config (current=0x80d5850, parms=0xbffffc30,
section_vector=0x80e05f0) at config.c:1121
        errmsg = 0x0
        current = (ap_directive_t *) 0x80d5928
        parms = (cmd_parms *) 0xbffffc30
        oldconfig = (ap_conf_vector_t *) 0x80b3488
#7  0x08074beb in dirsection (cmd=0xbffffc30, mconfig=0x80b3598,
arg=0x80e0792 "") at core.c:1625
        cmd = (cmd_parms *) 0xbffffc30
        errmsg = 0x0
        endp = 0x80e07e0 ""
        old_overrides = 150
        old_path = 0x0
        conf = (core_dir_config *) 0x80e07e0
        new_dir_conf = (ap_conf_vector_t *) 0x80e05f0
        r = (regex_t *) 0x0
        thiscmd = (command_rec *) 0x8088bec
        err = 0x0
#8  0x08066e6e in invoke_cmd (cmd=0x8088bec, parms=0xbffffc30,
mconfig=0x80b3598, args=0x80d5828 "/var/www/publisher>") at config.c:713
        w = 0x80d5808 "?W\r\b(X\r\b"
        w2 = 0xbffffc30 ""
        w3 = 0x4040d154 "\231n?@\234?7@"
        errmsg = 0x0
#9  0x08067a53 in ap_walk_config_sub (current=0x80d5808,
parms=0xbffffc30, section_vector=0x80b3488) at config.c:1082
        dir_config = (void *) 0x4040d154
        retval = 0x4040d154 "\231n?@\234?7@"
        cmd = (command_rec *) 0x8088bec
        current = (ap_directive_t *) 0x80d5808
        parms = (cmd_parms *) 0xbffffc30
        mod = (module *) 0x808ed60
#10 0x08067ad1 in ap_walk_config (current=0x80b49d0, parms=0xbffffc30,
section_vector=0x80b3488) at config.c:1121
        errmsg = 0x0
        current = (ap_directive_t *) 0x80d5808
        parms = (cmd_parms *) 0xbffffc30
        oldconfig = (ap_conf_vector_t *) 0x0
#11 0x080684e0 in ap_process_config_tree (s=0x80b2ec8,
conftree=0x80b49d0, p=0x8098d10, ptemp=0x80c4dc0) at config.c:1583
        s = (server_rec *) 0x4040d154
        p = (apr_pool_t *) 0x8098d10
        ptemp = (apr_pool_t *) 0x0
        errmsg = 0x808defc ""
        parms = {info = 0x0, override = 95, limited = -1,
limited_xmethods = 0x0, xlimited = 0x0, config_file = 0x0, directive =
0x80d5928, pool = 0x8098d10, 
  temp_pool = 0x80c4dc0, server = 0x80b2ec8, path = 0x80e07c8
"/var/www/publisher/", cmd = 0x4040d154, context = 0x80e05f0,
err_directive = 0x0}
#12 0x0806a811 in main (argc=2, argv=0xbffffd44) at main.c:564
        c = 116 't'
        configtestonly = 1
        confname = 0x8086518 "conf/httpd.conf"
        def_server_root = 0x8086528 "/usr/apache2"
        temp_error_log = 0x0
        process = (process_rec *) 0x8096d88
        server_conf = (server_rec *) 0x80b2ec8
        pglobal = (apr_pool_t *) 0x8096d08
        pconf = (apr_pool_t *) 0x8098d10
        plog = (apr_pool_t *) 0x80c2db8
        ptemp = (apr_pool_t *) 0x80c4dc0
        pcommands = (apr_pool_t *) 0x80c0db0
        opt = (apr_getopt_t *) 0x80c0e48
        rv = 0
        mod = (module **) 0x80b2ec8
        optarg = 0x0
        signal_server = (apr_OFN_ap_signal_server_t *) 0x4040d154
<python_commands+264>
#13 0x40189571 in __libc_start_main (main=0x806a370 <main>, argc=2,
ubp_av=0xbffffd44, init=0x805b824 <_init>, fini=0x80812e0 <_fini>,
rtld_fini=0x4000aa24 <_dl_fini>, 
    stack_end=0xbffffd3c) at ../sysdeps/generic/libc-start.c:129
        ubp_av = (char **) 0xbffffd44
        fini = (void (*)()) 0x400154ac <_dl_debug_mask>
        rtld_fini = (void (*)()) 0x80e0e28
        ubp_ev = (char **) 0x0


-- 
Robin Munn
rmunn@pobox.com


From jack_diederich at email.com  Tue Oct  8 16:03:52 2002
From: jack_diederich at email.com (Jack Diederich)
Date: Fri Jan  9 21:53:11 2004
Subject: [mod_python] Segfault when using PythonImport directive
Message-ID: <20021008210352.6095.qmail@email.com>

Cut N Pasted from a python-dev@httpd.apache.org email last month
since I don't know where an archive would be.

I was talking about mod_python 2.x with apahce 1.x 
But I would be willing to guess it is the same problem.

-jack



you can never garuntee that python_init() will be called only once.
All memory allocated from the original pool is freed before the next
call to python_init()
just having the single python_imports table seems to avoid this for
some reason, but it isn't garunteed (I don't want to know what
happens on USR1).

we need a cleanup func that just resets the python_imports state
between calls to python_init()

/* This func can go anywhere above directive_PythonImports */
void cleanup_python_imports(void *data)
{
  python_imports = NULL;
}
/* This line needs to go in directive_PythonImports in the if block
where we call ap_make_table */
ap_register_cleanup(cmd->pool, NULL,
cleanup_python_imports, ap_null_cleanup);


The end result is that we remake the table if python_init() is called
more than once.  This is OK because the configuration is also reread.
 We don't have to worry about the global 'interpreters' variable
because it is allocated by Python outside of apache's memory
management, but we might have a small memory leak if we get USR1'd
over and over again because it is never Py_DECREF'd in
python_finalize.  On the other hand, Py_Finalize() is probably smart
enough to take of that for us.
----- Original Message -----
From: "Michael C. Neel" <neel@mediapulse.com>
Date: Tue, 8 Oct 2002 16:33:19 -0400 
To: <rmunn@pobox.com>, <mod_python@modpython.org>
Subject: RE: [mod_python] Segfault when using PythonImport directive


> Not addressing the segfault, couldn't you handle globals in the python
> program itself?  I do this for database handles my self:
> 
> from mod_python import apache
> import MySQLdb
> 
> db = MySQLdb.connect("yada yada")
> 
> def handler(req):
> 	do cool db stuff with req here
> 
> I do this often, and I've checked that each request doesn't generate a
> db connection by watching the MySQL number of connects.  One thing to
> keep in mind is that a db handle may go stale if not used by some
> databases, so be sure to add some code to test out the db handle each
> request and reconnect if needed.  The DB API 2.0 spec doesn't define a
> ping method like perl's DBI does, so I usually add one myself for this.
> 
> Mike
> 
> --
> Michael C. Neel
> Director of Software Development
> Mediapulse, Inc.
>  
> 
> -----Original Message-----
> From: rmunn@pobox.com [mailto:rmunn@pobox.com] 
> Sent: Tuesday, October 08, 2002 1:35 PM
> To: mod_python@modpython.org
> Subject: [mod_python] Segfault when using PythonImport directive
> 
> 
> I'm using mod_python 3.0.0 BETA 2 with Apache 2.0.42 and encountering a
> segfault every time I try to use the PythonInclude directive. The
> segfault occurs even when I try to have Apache do a configuration syntax
> check (/usr/apache2/bin/apachectl configtest). I've narrowed it down to
> a single PythonInclude line. This is the <Directory> directive in which
> the PythonInclude directive appears:
> 
> 
> <Directory /var/www/publisher>
>     AddHandler python-program .py
>     PythonHandler mod_python.publisher
>     PythonInterpPerDirective On
>     PythonImport globals
> </Directory>
> 
> 
> If I comment out the "PythonImport globals" line, everything runs fine.
> 
> Here's the contents of my /var/www/publisher directory:
> 
> 
> rmunn@localhost:/var/www/publisher$ ls -l
> total 8
> -rw-r--r--    1 rmunn    users          12 Oct  7 19:22 globals.py
> -rw-r--r--    1 rmunn    users         133 Oct  8 12:26 tryme.py
> rmunn@localhost:/var/www/publisher$ cat globals.py 
> foo = 'bar'
> rmunn@localhost:/var/www/publisher$ cat tryme.py 
> def show(req, name):
>     try:
>         return str(globals.foo)
>     except AttributeError, NameError:
>         return str(dir(globals))
> 
> 
> As you can see, what I'm trying to do is have some global variables
> pre-defined in my mod_python scripts; I plan on using this to accomplish
> expensive operations (like opening database connections) once per apache
> process child instead of once per request.
> 
> Here's the gdb backtrace of my segfault. I'm running httpd -t to only
> get a configuration syntax check and it's still failing. Any ideas?
> 
> 
> root@localhost:/usr/apache2/conf# gdb ../bin/httpd 
> GNU gdb 5.2.1
> Copyright 2002 Free Software Foundation, Inc.
> GDB is free software, covered by the GNU General Public License, and you
> are
> welcome to change it and/or distribute copies of it under certain
> conditions.
> Type "show copying" to see the conditions.
> There is absolutely no warranty for GDB.  Type "show warranty" for
> details.
> This GDB was configured as "i686-pc-linux-gnu"...
> (gdb) run -t
> Starting program: /usr/apache2/bin/httpd -t
> [New Thread 1024 (LWP 29765)]
> 
> Program received signal SIGSEGV, Segmentation fault.
> [Switching to Thread 1024 (LWP 29765)]
> __pthread_mutex_lock (mutex=0x10) at mutex.c:99
> 99      mutex.c: No such file or directory.
>         in mutex.c
> (gdb) backtrace full
> #0  __pthread_mutex_lock (mutex=0x10) at mutex.c:99
>         mutex = (pthread_mutex_t *) 0x10
>         self = 0x0
> #1  0x403d8f43 in PyThread_acquire_lock (lock=0x0, waitflag=1) at
> Python/thread_pthread.h:359
>         lock = 0x0
>         success = 1078103364
>         status = 0
>         error = 0
> #2  0x403bbb4e in PyEval_AcquireLock () at Python/ceval.c:267
> No locals.
> #3  0x4037c1b3 in directive_PythonImport (cmd=0xbffffc30,
> mconfig=0x80e0958, module=0x80e0e28 "globals") at mod_python.c:1220
>         cmd = (cmd_parms *) 0x0
>         mconfig = (void *) 0x0
>         module = 0x0
> #4  0x08067349 in invoke_cmd (cmd=0x4040d154, parms=0xbffffc30,
> mconfig=0x80e0958, args=0x80d594f "") at config.c:800
>         w = 0x80e0e28 "globals"
>         w2 = 0xbffffc30 ""
>         w3 = 0x4040d154 "\231n?@\234?7@"
>         errmsg = 0x0
> #5  0x08067a53 in ap_walk_config_sub (current=0x80d5928,
> parms=0xbffffc30, section_vector=0x80e05f0) at config.c:1082
>         dir_config = (void *) 0x4040d154
>         retval = 0x4040d154 "\231n?@\234?7@"
>         cmd = (command_rec *) 0x4040d154
>         current = (ap_directive_t *) 0x80d5928
>         parms = (cmd_parms *) 0xbffffc30
>         mod = (module *) 0x4040d2e0
> #6  0x08067ad1 in ap_walk_config (current=0x80d5850, parms=0xbffffc30,
> section_vector=0x80e05f0) at config.c:1121
>         errmsg = 0x0
>         current = (ap_directive_t *) 0x80d5928
>         parms = (cmd_parms *) 0xbffffc30
>         oldconfig = (ap_conf_vector_t *) 0x80b3488
> #7  0x08074beb in dirsection (cmd=0xbffffc30, mconfig=0x80b3598,
> arg=0x80e0792 "") at core.c:1625
>         cmd = (cmd_parms *) 0xbffffc30
>         errmsg = 0x0
>         endp = 0x80e07e0 ""
>         old_overrides = 150
>         old_path = 0x0
>         conf = (core_dir_config *) 0x80e07e0
>         new_dir_conf = (ap_conf_vector_t *) 0x80e05f0
>         r = (regex_t *) 0x0
>         thiscmd = (command_rec *) 0x8088bec
>         err = 0x0
> #8  0x08066e6e in invoke_cmd (cmd=0x8088bec, parms=0xbffffc30,
> mconfig=0x80b3598, args=0x80d5828 "/var/www/publisher>") at config.c:713
>         w = 0x80d5808 "?W\r\b(X\r\b"
>         w2 = 0xbffffc30 ""
>         w3 = 0x4040d154 "\231n?@\234?7@"
>         errmsg = 0x0
> #9  0x08067a53 in ap_walk_config_sub (current=0x80d5808,
> parms=0xbffffc30, section_vector=0x80b3488) at config.c:1082
>         dir_config = (void *) 0x4040d154
>         retval = 0x4040d154 "\231n?@\234?7@"
>         cmd = (command_rec *) 0x8088bec
>         current = (ap_directive_t *) 0x80d5808
>         parms = (cmd_parms *) 0xbffffc30
>         mod = (module *) 0x808ed60
> #10 0x08067ad1 in ap_walk_config (current=0x80b49d0, parms=0xbffffc30,
> section_vector=0x80b3488) at config.c:1121
>         errmsg = 0x0
>         current = (ap_directive_t *) 0x80d5808
>         parms = (cmd_parms *) 0xbffffc30
>         oldconfig = (ap_conf_vector_t *) 0x0
> #11 0x080684e0 in ap_process_config_tree (s=0x80b2ec8,
> conftree=0x80b49d0, p=0x8098d10, ptemp=0x80c4dc0) at config.c:1583
>         s = (server_rec *) 0x4040d154
>         p = (apr_pool_t *) 0x8098d10
>         ptemp = (apr_pool_t *) 0x0
>         errmsg = 0x808defc ""
>         parms = {info = 0x0, override = 95, limited = -1,
> limited_xmethods = 0x0, xlimited = 0x0, config_file = 0x0, directive =
> 0x80d5928, pool = 0x8098d10, 
>   temp_pool = 0x80c4dc0, server = 0x80b2ec8, path = 0x80e07c8
> "/var/www/publisher/", cmd = 0x4040d154, context = 0x80e05f0,
> err_directive = 0x0}
> #12 0x0806a811 in main (argc=2, argv=0xbffffd44) at main.c:564
>         c = 116 't'
>         configtestonly = 1
>         confname = 0x8086518 "conf/httpd.conf"
>         def_server_root = 0x8086528 "/usr/apache2"
>         temp_error_log = 0x0
>         process = (process_rec *) 0x8096d88
>         server_conf = (server_rec *) 0x80b2ec8
>         pglobal = (apr_pool_t *) 0x8096d08
>         pconf = (apr_pool_t *) 0x8098d10
>         plog = (apr_pool_t *) 0x80c2db8
>         ptemp = (apr_pool_t *) 0x80c4dc0
>         pcommands = (apr_pool_t *) 0x80c0db0
>         opt = (apr_getopt_t *) 0x80c0e48
>         rv = 0
>         mod = (module **) 0x80b2ec8
>         optarg = 0x0
>         signal_server = (apr_OFN_ap_signal_server_t *) 0x4040d154
> <python_commands+264>
> #13 0x40189571 in __libc_start_main (main=0x806a370 <main>, argc=2,
> ubp_av=0xbffffd44, init=0x805b824 <_init>, fini=0x80812e0 <_fini>,
> rtld_fini=0x4000aa24 <_dl_fini>, 
>     stack_end=0xbffffd3c) at ../sysdeps/generic/libc-start.c:129
>         ubp_av = (char **) 0xbffffd44
>         fini = (void (*)()) 0x400154ac <_dl_debug_mask>
>         rtld_fini = (void (*)()) 0x80e0e28
>         ubp_ev = (char **) 0x0
> 
> 
> -- 
> Robin Munn
> rmunn@pobox.com
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 
> 

-- 
__________________________________________________________
Sign-up for your own FREE Personalized E-mail at Mail.com
http://www.mail.com/?sr=signup


"Free price comparison tool gives you the best prices and cash back!"
http://www.bestbuyfinder.com/download.htm


From grisha at modpython.org  Sat Oct 12 16:08:37 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:11 2004
Subject: [mod_python] Segfaults... segfaults...
In-Reply-To: <19513182194.20021006182552@https.ru>
Message-ID: <Pine.BSF.4.32.0210121602380.17605-100000@eden.ispol.com>

I traced this to a bug in mod_negotiation.c - it didn't like r->fileinfo
being null, I submitted a patch for it, so hopefully it will be fixed in
next release of httpd.

Grisha

On Sun, 6 Oct 2002, Neo wrote:

>
>   Hi all !
>
>   I was just playing with mod_python 3 & Apache 2.0.42
> (RedHat Linux 7.2). Below are my "mptest.py" file, Apache VH config
> and the resuts of the single request:
>
> GET /mptest.py
>
>
> ----------------BEGIN----------------
> from mod_python import apache
>
>
> interp = None
>
> def transhandler(req):
>     interp = req.interpreter
>     return apache.OK
>
> def handler(req):
>     req.write(repr(interp))
>     return apache.OK
> -----------------END-----------------
>
> Config for virtual host:
> ----------------BEGIN----------------
> <VirtualHost *>
> [... skipped ...]
>
>     PythonPath    "..."
>
>     PythonDebug On
>     PythonTransHandler mptest
>     SetHandler python-program
>     PythonHandler mptest
>
>     <Directory "/home/w-https/test-www">
>         Options Indexes FollowSymLinks
>         AllowOverride None
>
>         Order allow,deny
>         Allow from all
>
>         DirectoryIndex index.html index.htm index.html.var
>
>         AddDefaultCharset UTF-8
>     </Directory>
>
> [... skipped ...]
> </VirtualHost>
> -----------------END-----------------
>
> Apache virtualhost log file:
> ----------------BEGIN----------------
> [Sun Oct 06 18:02:44 2002] [info] [client 212.188.98.243] Module bug?
> Request filename is missing for URI /mptest.py
> -----------------END-----------------
>
> *** I guess "transhandler" in the above example should somehow set
>     filename for incoming request for Apache to be happy? But SEGFAULT
>     is not the best action to report the error :)
>
> Apache main server log file:
> ----------------BEGIN----------------
> [Sun Oct 06 18:02:45 2002] [notice] child pid 12331 exit signal
> Segmentation fault (11)
> -----------------END-----------------
>
>
> ---
> Neo Eureka / mailto:neo@https.ru
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From grisha at ispol.com  Tue Oct 15 13:49:40 2002
From: grisha at ispol.com (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:11 2004
Subject: [mod_python] test
Message-ID: <Pine.BSF.4.32.0210151349280.72568-100000@eden.ispol.com>

ignore


From grisha at modpython.org  Tue Oct 15 13:51:38 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:11 2004
Subject: [mod_python] BETA 3
Message-ID: <Pine.BSF.4.32.0210151351150.72568-100000@eden.ispol.com>

BETA3 of MP 3 is available for download from
http://www.apache.org/dist/httpd/modpython/

This release features numerous fixes to problems reported on this and the
dev lists, has been tested on linux, solaris, freebsd and windows, and
even includes an example of a gzip filter.

There is also a windows DLL (actually it's a .so file, following the
Apache convention) in that same directory.

Grisha



From derrick.beery at itd.state.ia.us  Tue Oct 15 14:17:56 2002
From: derrick.beery at itd.state.ia.us (Derrick Beery)
Date: Fri Jan  9 21:53:11 2004
Subject: [mod_python] aix, apxs and apache problem
Message-ID: <00B8F67D177CD411BF7200508B6090FD046BB9FD@its-cn-exchange.its.state.ia.us>

Hello,

I am new to Python and interested in capabilities as a web language. I have
downloaded the source for mod_python-2.7.8. I am attempting to configure it
statically or as a DSO, thus far without complete success. The host is an
RS6000 running AIX 4.3.3 and the web server is Apache 1.3.27.

Using gcc version 2.95.3 20010315 (release)

Python was:

./configure --without-threads --with-gcc

Apache:

./configure --with-layout=custom --enable-module=most --enable-module=so

For mod_python I do:

./configure --with-apache=../apache_1.3.27 --with-apxs=/apache/bin/apxs
--with-python=/usr/local/src/Python-2.2.1

No errors. Well, I did have to link to the Makefile:

cd /usr/local/src/Python-2.2.1/Modules
ln -s /usr/local/src/Python-2.2.1/Makefile Makefile

After that, there were no errors following configure.

I then do:

make dso

There were errors until I I added
-bE:/usr/local/src/Python-2.2.1/Modules/python.exp to apxs script:

my $CFG_LDFLAGS_SHLIB = q(-H512 -T512 -bhalt:4 -bM:SRE -bnoentry
-bI:/apache2/libexec/httpd.exp -bE:/apache2/libexec/httpd.exp
-bE:/usr/local/src/Python-2.2.1/Modules/python.exp -lld -lc); # substituted
via Makefile.tmpl

Then no errors, so I do:

make install (as root)

no errors!

Added the following to DSO section of httpd.conf:

LoadModule python_module libexec/mod_python.so

I then attempt to restart httpd:

/apache/bin/apachectl start

This is what I get:

apachectl restart
/apache2/bin/apachectl restart: configuration broken, ignoring restart
/apache2/bin/apachectl restart: (run 'apachectl configtest' for details)
apachectl configtest
Syntax error on line 205 of /apache/conf/httpd.conf:
Can't locate API module structure `python_module' in file
/apache2/libexec/mod_python.so: Function not implemented (python_module)

When I tried statically, apache builds httpd with Python but If I try to add
PHP I get a TOC size error. Apache and just PHP builds and works great. I
did not test Python only version because even if it worked, I cannot use.

Any advice here would be greatly appreciated.

Derrick

From mort at bork.org  Tue Oct 15 16:31:12 2002
From: mort at bork.org (Martin Hicks)
Date: Fri Jan  9 21:53:11 2004
Subject: [mod_python] Sending args to the python script
Message-ID: <20021015203112.GC28708@bork.org>


Hello,

I want to be able to send args to the script through a src URL.  

e.g.,:

<frame ...  src="script/function?arg=blah&name=hoho">

but this doesn't seem to work.  I'm using the Publisher Handler
and mod_python 2.7.8 on debian-sid.

TIA
mh

-- 
Martin Hicks  ||  mort@bork.org  || PGP/GnuPG: 0x4C7F2BEE
plato up 13 days, 22:28, 13 users,  load average: 0.21, 0.07, 0.02
Great Spirits have always encountered opposition from mediocre minds
						-Albert Einstein
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20021015/063544c1/attachment-0001.bin
From grisha at modpython.org  Tue Oct 15 17:48:20 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:11 2004
Subject: [mod_python] Sending args to the python script
In-Reply-To: <20021015203112.GC28708@bork.org>
Message-ID: <Pine.BSF.4.32.0210151746470.72568-100000@eden.ispol.com>

It should work. See if you have a req.form variable, and try raising it
with PythonDebug On to see what's in it, e.g.:

def function(req):

	raise `req.form`


On Tue, 15 Oct 2002, Martin Hicks wrote:

>
> Hello,
>
> I want to be able to send args to the script through a src URL.
>
> e.g.,:
>
> <frame ...  src="script/function?arg=blah&name=hoho">
>
> but this doesn't seem to work.  I'm using the Publisher Handler
> and mod_python 2.7.8 on debian-sid.
>
> TIA
> mh
>
> --
> Martin Hicks  ||  mort@bork.org  || PGP/GnuPG: 0x4C7F2BEE
> plato up 13 days, 22:28, 13 users,  load average: 0.21, 0.07, 0.02
> Great Spirits have always encountered opposition from mediocre minds
> 						-Albert Einstein
>


From mort at bork.org  Tue Oct 15 18:09:49 2002
From: mort at bork.org (Martin Hicks)
Date: Fri Jan  9 21:53:11 2004
Subject: [mod_python] Sending args to the python script
In-Reply-To: <Pine.BSF.4.32.0210151746470.72568-100000@eden.ispol.com>
References: <20021015203112.GC28708@bork.org> <Pine.BSF.4.32.0210151746470.72568-100000@eden.ispol.com>
Message-ID: <20021015220949.GE28708@bork.org>

On Tue, Oct 15, 2002 at 05:48:20PM -0400, Gregory (Grisha) Trubetskoy wrote:
>
> It should work. See if you have a req.form variable, and try raising it
> with PythonDebug On to see what's in it, e.g.:
> 
> def function(req):
> 
> 	raise `req.form`

Merci, merci.

I didn't know they came in through req.form.

thanks again,
mh

-- 
Martin Hicks  ||  mort@bork.org  || PGP/GnuPG: 0x4C7F2BEE
plato up 14 days, 8 min, 13 users,  load average: 0.38, 0.21, 0.08
Great Spirits have always encountered opposition from mediocre minds
						-Albert Einstein
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20021015/371c76d9/attachment-0001.bin
From jack_diederich at email.com  Wed Oct 16 23:01:12 2002
From: jack_diederich at email.com (Jack Diederich)
Date: Fri Jan  9 21:53:11 2004
Subject: [mod_python] Apache compile HOWTO
Message-ID: <20021017040112.30584.qmail@email.com>

I saw this on freshmeat,
http://freshmeat.net/releases/100481/

and the homepage is here
http://www.delouw.ch/linux/apache.phtml

It is a HOWTO project that includes mod_perl, mod_php and others,
but as yet doesn't include mod_python.

If anyone would submit a writeup for mod_python
it would be good advocacy.

-jackdied
-- 
__________________________________________________________
Sign-up for your own FREE Personalized E-mail at Mail.com
http://www.mail.com/?sr=signup


From vmanera at manord.com  Thu Oct 17 18:40:17 2002
From: vmanera at manord.com (Manera, Villiam)
Date: Fri Jan  9 21:53:11 2004
Subject: [mod_python] strange behavior of mod-python
Message-ID: <52DC70C1C1575C418CB033523A29CF14104870@exchange2000.manord.com>

I'm currently use mod-python 2.7.6 on apache 1.3.26 - windows 2000 with
python 2.2
apache config:
.....
    ScriptAlias /comm/ "E:/script/cgi/comm/"
    ScriptAlias /tecnico/ "E:/script/cgi/tecnico/"
....
<Directory "E:/script/cgi/comm">
        Order Deny,Allow
        Deny from all
        Allow from .....
       ...
    	AddHandler python-program .py
    	PythonHandler mod_python.publisher
	PythonPath "sys.path+['c:/program
files/python22/lib/site-packages/mdnlib', 'c:/program
files/python22/lib/site-packages/HTMLgen','E:/script/cgi/comm']"
    	PythonDebug on
    </Directory>

----------------------------------------------------
all work fine, but sometimes (today 4 time) when a url is typed:
http://sviluppo.manord.com/comm/comm_ocordiu0.py/main?....

I have this behavior from apache:
HTTP 404 - File non trovato (not found)
Internet Explorer 
but the program is still in place, and the only way to force apache to found
the program is restart the apache services,
or make a copy of comm_ocordiu0 in comm_ocordiu1 and then call this one,
but....



this is not a real problem in developement web server, but  today it
happened 4 time, in production is happened 2 time in one month,
and I become in panic.

Any advice here would be greatly appreciated.

Villiam 

From francoislepoutre at compuserve.com  Fri Oct 18 11:37:16 2002
From: francoislepoutre at compuserve.com (=?iso-8859-1?Q?Fran=E7ois_Lepoutre?=)
Date: Fri Jan  9 21:53:11 2004
Subject: [mod_python] strange behavior of mod-python
Message-ID: <01c27689$f23a4f60$LocalHost@seriatim1>

>I use a class for handle a pool of connection to the data base that became
>persistent after the first call,
>and all the progrma that need a connection to the db have to pass through
>this class.

Same for me. Most odbc drivers are not fully threadsafe.

>But why only une program fall in this problem?
>In what way may I check if different trading are competing (my application
>doesn't call
>expressly any thread, mod python do it for me? I don't use multiple
>interpretes)


It all happens under stress only ...

-on apache linux ... when under stress apache forks as many
 interpreters as needed. Each intepreters handle the calls
 in an organised queue.

No race conditions here. Simple !

- on apache win32 ... when under strees apache win32 calls
for a nex thread. EACH THREAD may access all
your persistent python objects.

You need to put code to protect your data under stress.

>The way apache works on
>Anyway if this may be one problem I will start today to move from apache
>1.3.26 to apache 2.0.43
>with mod-python beta 3 (different management of threading), in order to
>check this problem.

I am quite new here. not tested the beta.

I have not tested that. No time at the moment.
Could you keep me informed on the all thing.

I have to maintain two version of our code.

One for linux, simple. The other one for nt/2K
that cares for concurrency.

The truth .. ain't log or complex but that's
extra code anyway.

Can i have one version only on apache 2
with both threading and forking activated ?

>I've to stay on nt/2000 because the odbc driver for my database it is not
>available on linux

Using a multiplatform db with support of both
win32 and *nix is great. We use ASA.
Great on win32. Runs on *nix.

>Thanks for your interest

mod_python is a great product.. worth digging thru.
You're welcome.

Francois

a win32 geek moving multiplatform
thru python/mod_python


-----Messaggio originale-----
Da: Fran?ois Lepoutre [mailto:francoislepoutre@compuserve.com]
Inviato: gioved? 17 ottobre 2002 23.26
A: Manera, Villiam
Oggetto: Re: [mod_python] strange behavior of mod-python


HI,

I love python and like mod_python a lot...
but have had trouble with the mod_python
programming model on nt/2000 because
of threading.

Do you keep db handle or python shared
data structure persistent in the python
interpreter?

If you do, have you made sure that
distinct thread are competing
for the same resource?

Just my two cents...


-----Original Message-----
From: Manera, Villiam <vmanera@manord.com>
To: 'mod_python@modpython.org' <mod_python@modpython.org>
Date: 17 October 2002 19:13
Subject: [mod_python] strange behavior of mod-python


>
>I'm currently use mod-python 2.7.6 on apache 1.3.26 - windows 2000 with
>python 2.2
>apache config:
>.....
>    ScriptAlias /comm/ "E:/script/cgi/comm/"
>    ScriptAlias /tecnico/ "E:/script/cgi/tecnico/"
>....
><Directory "E:/script/cgi/comm">
>        Order Deny,Allow
>        Deny from all
>        Allow from .....
>       ...
>    AddHandler python-program .py
>    PythonHandler mod_python.publisher
> PythonPath "sys.path+['c:/program
>files/python22/lib/site-packages/mdnlib', 'c:/program
>files/python22/lib/site-packages/HTMLgen','E:/script/cgi/comm']"
>    PythonDebug on
>    </Directory>
>
>----------------------------------------------------
>all work fine, but sometimes (today 4 time) when a url is typed:
>http://sviluppo.manord.com/comm/comm_ocordiu0.py/main?....
>
>I have this behavior from apache:
>HTTP 404 - File non trovato (not found)
>Internet Explorer
>but the program is still in place, and the only way to force apache to
found
>the program is restart the apache services,
>or make a copy of comm_ocordiu0 in comm_ocordiu1 and then call this one,
>but....
>
>
>
>this is not a real problem in developement web server, but  today it
>happened 4 time, in production is happened 2 time in one month,
>and I become in panic.
>
>Any advice here would be greatly appreciated.
>
>Villiam
>_______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org
>http://www.modpython.org/mailman/listinfo/mod_python


From francoislepoutre at compuserve.com  Fri Oct 18 14:55:23 2002
From: francoislepoutre at compuserve.com (=?iso-8859-1?Q?Fran=E7ois_Lepoutre?=)
Date: Fri Jan  9 21:53:11 2004
Subject: [mod_python] strange behavior of mod-python
Message-ID: <01c276a5$9f40ca20$2758d3d4@seriatim1>

>I will inform you to apache 2...

Thank you

>VI've found your mail of
>www.modpython.org/pipermail/mod_python/2001-September/001647.html
>that concern this problem. May I try to put "ThreadPerChild" to 1 instead
of
>2 to 50 ?

>I not clearly understood  the problem to doing that: the pb vanishes... and
>performance as well. (pb?)


Yes exactly!

>otherwise have you some example of code to protect  data under stress? I
>don't have any idea to do so.

I am no expert (IT by experience not education).
But python is so simple. I used the following kind
of code (no guarantee on details but you will
get the idea clear).

# at module level (global)
# add this
import threading
my_data_lock =  threading.RLock()

# every time you update your global variables

global my_data_lock
my_data_lock.acquire()

# update your stuff here
# while other thread wait ....

# release the lock
my_data_lock.release

I am sure you could (and should) do it
in a cleaner object-oriented way.
But that solved the threading issue.

Francois
-----Messaggio originale-----
Da: Fran?ois Lepoutre [mailto:francoislepoutre@compuserve.com]
Inviato: venerd? 18 ottobre 2002 11.37
A: Manera, Villiam
Cc: mod_python@modpython.org
Oggetto: Re: [mod_python] strange behavior of mod-python


>I use a class for handle a pool of connection to the data base that became
>persistent after the first call,
>and all the progrma that need a connection to the db have to pass through
>this class.

Same for me. Most odbc drivers are not fully threadsafe.

>But why only une program fall in this problem?
>In what way may I check if different trading are competing (my application
>doesn't call
>expressly any thread, mod python do it for me? I don't use multiple
>interpretes)


It all happens under stress only ...

-on apache linux ... when under stress apache forks as many
interpreters as needed. Each intepreters handle the calls
in an organised queue.

No race conditions here. Simple !

- on apache win32 ... when under strees apache win32 calls
for a nex thread. EACH THREAD may access all
your persistent python objects.

You need to put code to protect your data under stress.

>The way apache works on
>Anyway if this may be one problem I will start today to move from apache
>1.3.26 to apache 2.0.43
>with mod-python beta 3 (different management of threading), in order to
>check this problem.

I am quite new here. not tested the beta.

I have not tested that. No time at the moment.
Could you keep me informed on the all thing.

I have to maintain two version of our code.

One for linux, simple. The other one for nt/2K
that cares for concurrency.

The truth .. ain't log or complex but that's
extra code anyway.

Can i have one version only on apache 2
with both threading and forking activated ?

>I've to stay on nt/2000 because the odbc driver for my database it is not
>available on linux

Using a multiplatform db with support of both
win32 and *nix is great. We use ASA.
Great on win32. Runs on *nix.

>Thanks for your interest

mod_python is a great product.. worth digging thru.
You're welcome.

Francois

a win32 geek moving multiplatform
thru python/mod_python


-----Messaggio originale-----
Da: Fran?ois Lepoutre [mailto:francoislepoutre@compuserve.com]
Inviato: gioved? 17 ottobre 2002 23.26
A: Manera, Villiam
Oggetto: Re: [mod_python] strange behavior of mod-python


HI,

I love python and like mod_python a lot...
but have had trouble with the mod_python
programming model on nt/2000 because
of threading.

Do you keep db handle or python shared
data structure persistent in the python
interpreter?

If you do, have you made sure that
distinct thread are competing
for the same resource?

Just my two cents...


-----Original Message-----
From: Manera, Villiam <vmanera@manord.com>
To: 'mod_python@modpython.org' <mod_python@modpython.org>
Date: 17 October 2002 19:13
Subject: [mod_python] strange behavior of mod-python


>
>I'm currently use mod-python 2.7.6 on apache 1.3.26 - windows 2000 with
>python 2.2
>apache config:
>.....
>    ScriptAlias /comm/ "E:/script/cgi/comm/"
>    ScriptAlias /tecnico/ "E:/script/cgi/tecnico/"
>....
><Directory "E:/script/cgi/comm">
>        Order Deny,Allow
>        Deny from all
>        Allow from .....
>       ...
>    AddHandler python-program .py
>    PythonHandler mod_python.publisher
> PythonPath "sys.path+['c:/program
>files/python22/lib/site-packages/mdnlib', 'c:/program
>files/python22/lib/site-packages/HTMLgen','E:/script/cgi/comm']"
>    PythonDebug on
>    </Directory>
>
>----------------------------------------------------
>all work fine, but sometimes (today 4 time) when a url is typed:
>http://sviluppo.manord.com/comm/comm_ocordiu0.py/main?....
>
>I have this behavior from apache:
>HTTP 404 - File non trovato (not found)
>Internet Explorer
>but the program is still in place, and the only way to force apache to
found
>the program is restart the apache services,
>or make a copy of comm_ocordiu0 in comm_ocordiu1 and then call this one,
>but....
>
>
>
>this is not a real problem in developement web server, but  today it
>happened 4 time, in production is happened 2 time in one month,
>and I become in panic.
>
>Any advice here would be greatly appreciated.
>
>Villiam
>_______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org
>http://www.modpython.org/mailman/listinfo/mod_python


From peter at hawkins.emu.id.au  Sat Oct 19 12:23:07 2002
From: peter at hawkins.emu.id.au (Peter Hawkins)
Date: Fri Jan  9 21:53:12 2004
Subject: [mod_python] Debian packages of mod_python 3.0.0 beta 3
Message-ID: <200210191223.11417.peter@hawkins.emu.id.au>

Hi...

There are some preliminary packages of beta 3 available at:
http://people.debian.org/~peterh/

I disclaim any form of liability for anything these may do to any 
machine you might install them on.

=)
Peter
-- 
peter@hawkins.emu.id.au aka peterh@debian.org
GPG key fingerprint:
C746 38A9 D3E4 A171 FB6A  56D4 5E30 DFCC BE11 F437


From mort at bork.org  Fri Oct 18 23:52:27 2002
From: mort at bork.org (Martin Hicks)
Date: Fri Jan  9 21:53:12 2004
Subject: [mod_python] Redirects
Message-ID: <20021019035227.GK32184@bork.org>


Hello,

I'd like to do a redirect as a result of a certain action in my mod_python 
method.  I.e., rather than returning html, I'd like the user to be redirected to 
the page "blah.html" for example.

How do I accomplish this?

thanks
mh

-- 
Martin Hicks  ||  mort@bork.org  || PGP/GnuPG: 0x4C7F2BEE
plato up 17 days,  5:49, 16 users,  load average: 2.28, 2.20, 2.19
Beer: So much more than just a breakfast drink.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20021018/c8a550a8/attachment-0001.bin
From mort at bork.org  Sat Oct 19 09:50:59 2002
From: mort at bork.org (Martin Hicks)
Date: Fri Jan  9 21:53:12 2004
Subject: [mod_python] Redirects
In-Reply-To: <3DB10378.605355C@sympatico.ca>
References: <20021019035227.GK32184@bork.org> <3DB10378.605355C@sympatico.ca>
Message-ID: <20021019135059.GL32184@bork.org>


On Sat, Oct 19, 2002 at 03:02:16AM -0400, vio wrote:
> Your answer is in the FAQ.


I tried to look in the FAQ before i posted, but it's br0ken.

When I try to search for "redirect" I get:

mod_python FAQ Search Results
Traceback (most recent call last):

  File "/usr/local/www/vhosts/www.modpython.org/FAQ/faqw.py", line 26, in ?
    import faqwiz
  File "/home/grisha/WWW/www.modpython.org/FAQ/faqwiz.py", line 827, in ?
    wiz.go()
  File "/home/grisha/WWW/www.modpython.org/FAQ/faqwiz.py", line 381, in go
    meth()
  File "/home/grisha/WWW/www.modpython.org/FAQ/faqwiz.py", line 447, in 
do_search
    constants
NameError: global name 'constants' is not defined


(times: user 0.567, sys 0.05, ch-user 0, ch-sys 0, real 0.65) 


Other errors occur when you try to view any part of the FAQ.
Can someone please either respond with details on how to do http redirects or 
fix the FAQ :-)

thanks a pile,
mh

-- 
Martin Hicks  ||  mort@bork.org  || PGP/GnuPG: 0x4C7F2BEE
plato up 17 days, 15:47, 16 users,  load average: 0.31, 0.40, 0.27
Great Spirits have always encountered opposition from mediocre minds
						-Albert Einstein
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20021019/f94cd711/attachment-0001.bin
From vmilitaru at sympatico.ca  Sat Oct 19 22:58:58 2002
From: vmilitaru at sympatico.ca (vio)
Date: Fri Jan  9 21:53:12 2004
Subject: [mod_python] Re: Redirects
References: <20021019035227.GK32184@bork.org> <3DB10378.605355C@sympatico.ca> <20021019135059.GL32184@bork.org>
Message-ID: <3DB21BF1.94DDC26B@sympatico.ca>

You do redirection in mod_python with something like this:


def handler(REQUEST):

   _REQUEST = REQUEST._req
...
   _REQUEST.headers_out['location'] = 'http://some_URL.org/...'
   _REQUEST.status = apache.HTTP_MOVED_PERMANENTLY
   _REQUEST.send_http_header()
   raise apache.SERVER_RETURN, apache.OK



Hope this helps,
Vio



From grisha at modpython.org  Sun Oct 20 14:22:53 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:12 2004
Subject: [mod_python] Re: Redirects
In-Reply-To: <3DB21BF1.94DDC26B@sympatico.ca>
Message-ID: <Pine.BSF.4.32.0210201421370.39713-100000@eden.ispol.com>

On Sat, 19 Oct 2002, vio wrote:

> You do redirection in mod_python with something like this:
>
>
> def handler(REQUEST):
>
>    _REQUEST = REQUEST._req

The above line won't work starting with the next version of mod_python...

Grisha


From mort at bork.org  Sun Oct 20 14:29:39 2002
From: mort at bork.org (Martin Hicks)
Date: Fri Jan  9 21:53:12 2004
Subject: [mod_python] Re: Redirects
In-Reply-To: <Pine.BSF.4.32.0210201421370.39713-100000@eden.ispol.com>
References: <3DB21BF1.94DDC26B@sympatico.ca> <Pine.BSF.4.32.0210201421370.39713-100000@eden.ispol.com>
Message-ID: <20021020182939.GJ32501@bork.org>

On Sun, Oct 20, 2002 at 02:22:53PM -0400, Gregory (Grisha) Trubetskoy wrote:
> 
> On Sat, 19 Oct 2002, vio wrote:
> 
> > You do redirection in mod_python with something like this:
> >
> >
> > def handler(REQUEST):
> >
> >    _REQUEST = REQUEST._req
> 
> The above line won't work starting with the next version of mod_python...

What will the new method be in the next version?

thanks
mh

-- 
Martin Hicks  ||  mort@bork.org  || PGP/GnuPG: 0x4C7F2BEE
plato up 18 days, 20:28, 14 users,  load average: 0.15, 0.27, 0.17
Beer: So much more than just a breakfast drink.

From vmilitaru at sympatico.ca  Sun Oct 20 21:01:28 2002
From: vmilitaru at sympatico.ca (vio)
Date: Fri Jan  9 21:53:12 2004
Subject: [mod_python] Re: Redirects
References: <Pine.BSF.4.32.0210201421370.39713-100000@eden.ispol.com>
Message-ID: <3DB351E8.A39B7030@sympatico.ca>

Got you. To be more precise, my little code example was "mod_python/2.7.8
over Apache/1.3.26" friendly.

So I guess you must be referring to mod_python/3 running on apache/2.
Looking foreword to it (sorry I haven't had much time to play with the beta
releases so far ... lazily waiting for the first stable release, I guess, to
migrate to the new generation). If I understand you correcly, no more 'fast
track' access to REQUEST internals (aka. 'XXX._req') :-(. I guess a little
'migration tips to mod_python/3' might become handy, then).

If I may add a coding style suggestion for the new version out of the blue,
it would be to replace all references to 'req' with 'REQUEST' (uppercase
full name). I learned this in Zope long ago, and it sticked with me: it's a
little more verbose, but so much more clean when you look at a source code,
especially true for newcomers. Good ideas deserve to be "borrowed".

Vio


"Gregory (Grisha) Trubetskoy" wrote:

> On Sat, 19 Oct 2002, vio wrote:
>
> > You do redirection in mod_python with something like this:
> >
> >
> > def handler(REQUEST):
> >
> >    _REQUEST = REQUEST._req
>
> The above line won't work starting with the next version of mod_python...
>
> Grisha


From grisha at modpython.org  Mon Oct 21 10:44:47 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:12 2004
Subject: [mod_python] Re: Redirects
In-Reply-To: <3DB351E8.A39B7030@sympatico.ca>
Message-ID: <Pine.BSF.4.32.0210211003570.49241-100000@eden.ispol.com>

On Sun, 20 Oct 2002, vio wrote:

> Got you. To be more precise, my little code example was "mod_python/2.7.8
> over Apache/1.3.26" friendly.
>
> So I guess you must be referring to mod_python/3 running on apache/2.
> Looking foreword to it (sorry I haven't had much time to play with the beta
> releases so far ... lazily waiting for the first stable release, I guess, to
> migrate to the new generation). If I understand you correcly, no more 'fast
> track' access to REQUEST internals (aka. 'XXX._req') :-(. I guess a little
> 'migration tips to mod_python/3' might become handy, then).
>

The _req object came about as a way to make the end-user request object
modifiable. There were two ways of doing it - writing C code to make the
built-in request object accept new members, or simply encapsulate it in a
regular Python object. I hose the latter because it was quicker :)

Mod_python 3 does it correctly - the built-in request object won't need to
be encapsulated, it will be modifiable as is, so there won't be any need
for _req.

BTW, the ._req is undocumented, so if ever anyone used it, it was at their
own risk. And yes, a migration document would be nice, hopefully I can put
something together to that extent.

> If I may add a coding style suggestion for the new version out of the blue,
> it would be to replace all references to 'req' with 'REQUEST' (uppercase
> full name). I learned this in Zope long ago, and it sticked with me: it's a
> little more verbose, but so much more clean when you look at a source code,
> especially true for newcomers. Good ideas deserve to be "borrowed".

I don't like the way Zope names it REQUEST, because to me, a part-time C
programmer, all caps means a symbolic constant, and this convention has
for the most part been followed in Python standard library.

Grisha

>
> Vio
>
>
> "Gregory (Grisha) Trubetskoy" wrote:
>
> > On Sat, 19 Oct 2002, vio wrote:
> >
> > > You do redirection in mod_python with something like this:
> > >
> > >
> > > def handler(REQUEST):
> > >
> > >    _REQUEST = REQUEST._req
> >
> > The above line won't work starting with the next version of mod_python...
> >
> > Grisha
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>



From grisha at modpython.org  Mon Oct 21 10:59:39 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:12 2004
Subject: [mod_python] Redirects
In-Reply-To: <20021019135059.GL32184@bork.org>
Message-ID: <Pine.BSF.4.32.0210211058530.50017-100000@eden.ispol.com>

This's been fixed

On Sat, 19 Oct 2002, Martin Hicks wrote:

>
> On Sat, Oct 19, 2002 at 03:02:16AM -0400, vio wrote:
> > Your answer is in the FAQ.
>
>
> I tried to look in the FAQ before i posted, but it's br0ken.
>
> When I try to search for "redirect" I get:
>
> mod_python FAQ Search Results
> Traceback (most recent call last):
>
>   File "/usr/local/www/vhosts/www.modpython.org/FAQ/faqw.py", line 26, in ?
>     import faqwiz
>   File "/home/grisha/WWW/www.modpython.org/FAQ/faqwiz.py", line 827, in ?
>     wiz.go()
>   File "/home/grisha/WWW/www.modpython.org/FAQ/faqwiz.py", line 381, in go
>     meth()
>   File "/home/grisha/WWW/www.modpython.org/FAQ/faqwiz.py", line 447, in
> do_search
>     constants
> NameError: global name 'constants' is not defined


From eallen41 at charter.net  Mon Oct 21 10:21:38 2002
From: eallen41 at charter.net (Ed Richardson)
Date: Fri Jan  9 21:53:12 2004
Subject: [mod_python] cancel subscription
Message-ID: <001e01c27915$8d89fd20$cf9ba842@charter.net>

password MEXEOX ...  Please remove me from this mailing list... Thx
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20021021/15c9e78c/attachment-0001.htm
From mcassiano at manord.com  Mon Oct 21 17:27:56 2002
From: mcassiano at manord.com (Cassiano, Marco)
Date: Fri Jan  9 21:53:12 2004
Subject: [mod_python] Win mod_python.so not found by Apache
Message-ID: <52DC70C1C1575C418CB033523A29CF140B8D74@exchange2000.manord.com>

Hello everybody.
My configuration is : 

Windows 2000 Server SP3
Apache 2.0.43
Python 2.2.1 by ActiveState
Mod_Python 3.0 Beta 3 

I put the mod_python.so in the ServerRoot/module folder.
I put lib/mod_python folder in the c:/program files/Python22/lib folder

In the Apache httpd.conf I put the line :

LoadModule python_module modules/mod_python.so

When I start the Apache service I always get the error (taken from the
application event):


Event Type:	Error
Event Source:	Apache Service
Event Category:	None
Event ID:	3299
Date:		21/10/2002
Time:		16.49.54
User:		N/A
Computer:	CORSO_MYSQL
Description:
The Apache service named  reported the following error:
>>> Syntax error on line 67 of C:/Program Files/Apache
Group/Apache2/conf/httpd.conf:     . 
The Apache service named  reported the following error:
>>> Cannot load C:/Program Files/Apache Group/Apache2/modules/mod_python.so
into server: 
The specified module could not be found. 



But the mod_python.so file is right there !
What Am I missing ?
Thanks




> Marco Cassiano
> Resp. Reti e Sistemi
> 
> Manifatture del Nord srl
> viale Regina Elena 13-15
> 42100 Reggio Emilia RE
> ITALY
> 
> Tel. +39 0522 508206
> Fax +39 0522 514001
> email : mcassiano@manord.com
> www.pennyblack.com
> 
> 

From barr at cs.cornell.edu  Tue Oct 22 00:53:55 2002
From: barr at cs.cornell.edu (Rimon Barr)
Date: Fri Jan  9 21:53:12 2004
Subject: [mod_python] spyce v1.1.45
In-Reply-To: <Pine.LNX.4.44.0207071930240.8857-100000@pompom.u.cs.cornell.edu>
Message-ID: <Pine.LNX.4.44.0210220024400.3539-100000@pompom.cs.cornell.edu>

SPYCE - Python Server Pages
  v1.1.45 released on 13 Oct 2002.

SPYCE is a webserver plugin that supports simple and efficient
Python-based dynamic HTML scripting. Those who like Python and are
familiar with JSP, or PHP, or ASP, should have a look at this engine. It
allows one to generate dynamic HTML content just as easily, using Python
for the dynamic parts. Its modular design makes it very flexible and
extensible. It supports FastCGI, CGI and mod_python to plugin into Apache
and most other webservers. It can also be used as a command-line utility
for HTML pre-processing or as a web server proxy.

Get it at:
  http://spyce.sourceforge.net

----------

Dear mod_python users,

Spyce works very nicely under mod_python, and it's been a while since I
posted a release announcement to this list (in fact, since v1.1.22, about
two months ago). Here are some of the major highlights. (The full change
log is available at:
http://cvs.sourceforge.net/cgi-bin/viewcvs.cgi/spyce/spyce/CHANGES?rev=HEAD&content-type=text/vnd.viewcvs-markup).

  - refactored the spyce module infrastructure
  - modules accept initialization arguments
  - new modules and improvements:
      toc - table of contents
      transform - output filters/transformations
      compress - dynamic compression
      error - error handling
      stdout - added push() and pop() methods; loaded implicitly
      and lots of others...
  - more accurate/specific runtime error reporting
  - added server-level configuration options
  - spyce now also supports a proxy server mode
  - added spyceDone exception to stop spyce processing
  - rpm improvements and new windows installer
  - compatibility with Python 1.5.2 and up
  - file globbing added to -O command-line option
  - site and documentation revamp
  - live examples on sourceforge
  - lots of bug fixes
  - performance improvements

If you use mod_python, and the last time you checked out Spyce was two
months ago, then please go take a second look. :)
  http://spyce.sourceforge.net

Comments, suggestions and feature requests are welcome.

Enjoy,
Rimon.


From rien at yeepa.org  Tue Oct 22 18:01:18 2002
From: rien at yeepa.org (Adrien Plisson)
Date: Fri Jan  9 21:53:12 2004
Subject: [mod_python] Win mod_python.so not found by Apache
References: <52DC70C1C1575C418CB033523A29CF140B8D74@exchange2000.manord.com>
Message-ID: <001101c279e4$428a4ee0$0a020101@skynet.be>

From: "Cassiano, Marco" <mcassiano@manord.com>
> I put the mod_python.so in the ServerRoot/module folder.
> I put lib/mod_python folder in the c:/program files/Python22/lib folder

shouldn't you put mod_python.dll instead of mod_python.so ?

.so files are "shared object" under un*x and achieve the same functionnality
as a .dll under windows.

--
rien


From grisha at modpython.org  Tue Oct 22 13:20:46 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:12 2004
Subject: [mod_python] Win mod_python.so not found by Apache
In-Reply-To: <001101c279e4$428a4ee0$0a020101@skynet.be>
Message-ID: <20021022131702.O73449-100000@eden.ispol.com>

It is a DLL, but apache httpd people decided to name their dll's with a
.so. Windows doesn't really care what the file is called, so it works just
the same, but this way the name is same on Windows and unices and you get
a nice little red feather as the icon associated with it. :)

On Tue, 22 Oct 2002, Adrien Plisson wrote:

> From: "Cassiano, Marco" <mcassiano@manord.com>
> > I put the mod_python.so in the ServerRoot/module folder.
> > I put lib/mod_python folder in the c:/program files/Python22/lib folder
>
> shouldn't you put mod_python.dll instead of mod_python.so ?
>
> .so files are "shared object" under un*x and achieve the same functionnality
> as a .dll under windows.
>
> --
> rien
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From neo at https.ru  Tue Oct 22 21:23:14 2002
From: neo at https.ru (Neo Eureka)
Date: Fri Jan  9 21:53:12 2004
Subject: [mod_python] Win mod_python.so not found by Apache
In-Reply-To: <52DC70C1C1575C418CB033523A29CF140B8D74@exchange2000.manord.com>
References: <52DC70C1C1575C418CB033523A29CF140B8D74@exchange2000.manord.com>
Message-ID: <5825926840.20021022212314@https.ru>

 Hi all !

CM> Hello everybody.
CM> My configuration is : 

CM> Windows 2000 Server SP3
CM> Apache 2.0.43
CM> Python 2.2.1 by ActiveState
CM> Mod_Python 3.0 Beta 3 

CM> I put the mod_python.so in the ServerRoot/module folder.
CM> I put lib/mod_python folder in the c:/program files/Python22/lib folder

CM> In the Apache httpd.conf I put the line :

CM> LoadModule python_module modules/mod_python.so

CM> When I start the Apache service I always get the error (taken from the
CM> application event):

CM> Event Type:     Error
CM> Event Source:   Apache Service
CM> Event Category: None
CM> Event ID:       3299
CM> Date:           21/10/2002
CM> Time:           16.49.54
CM> User:           N/A
CM> Computer:       CORSO_MYSQL
CM> Description:
CM> The Apache service named  reported the following error:
>>>> Syntax error on line 67 of C:/Program Files/Apache
CM> Group/Apache2/conf/httpd.conf:     . 
CM> The Apache service named  reported the following error:
>>>> Cannot load C:/Program Files/Apache Group/Apache2/modules/mod_python.so
CM> into server: 
CM> The specified module could not be found. 

CM> But the mod_python.so file is right there !
CM> What Am I missing ?
CM> Thanks

  I've run into the same behaviour of BETA3 under WindowsNT/4.0 &
Apache 2.0.43.


--- 
Neo Eureka / mailto:neo@https.ru


From neo at https.ru  Tue Oct 22 21:30:49 2002
From: neo at https.ru (Neo Eureka)
Date: Fri Jan  9 21:53:12 2004
Subject: [mod_python] Win mod_python.so not found by Apache
In-Reply-To: <001101c279e4$428a4ee0$0a020101@skynet.be>
References: <52DC70C1C1575C418CB033523A29CF140B8D74@exchange2000.manord.com>
 <001101c279e4$428a4ee0$0a020101@skynet.be>
Message-ID: <16026381574.20021022213049@https.ru>

AP> From: "Cassiano, Marco" <mcassiano@manord.com>
>> I put the mod_python.so in the ServerRoot/module folder.
>> I put lib/mod_python folder in the c:/program files/Python22/lib folder

AP> shouldn't you put mod_python.dll instead of mod_python.so ?

  No, he should not.


AP> .so files are "shared object" under un*x and achieve the same functionnality
AP> as a .dll under windows.

  Apache 2 under Windows uses ".so" files for loadable modules instead
of ".dll". In fact, these files are DLLs inside, but they look like
Unix shared object files.


AP> --
AP> rien


---
Neo Eureka / mailto:neo@https.ru


From rpinder at usc.edu  Tue Oct 22 11:36:08 2002
From: rpinder at usc.edu (Rich Pinder)
Date: Fri Jan  9 21:53:12 2004
Subject: [mod_python] Permissions Question on Linux
References: <52DC70C1C1575C418CB033523A29CF140B8D74@exchange2000.manord.com>
 <001101c279e4$428a4ee0$0a020101@skynet.be>
Message-ID: <3DB59A98.2030905@usc.edu>

Sorry for the simplicity of this question.

I'm putting together a site that uses Apache and mod_python and kinterbase to insert data into a Firebird 
(Interbase) server.

All the software resides on the same machine.
I've done some preliminary work on win32 machines, but now am configuring the SuSE 8.1 server.

Heres the question:  Are there any good practice guidelines on what specific Linux user account should be 
running (owning) the scripts, and where they should be residing ?  Rather than just getting something together 
that works, I thought I'd see how others do it.

thanks in advance for your thoughts

rich pinder
usc school of medicine


From rrreid at earthlink.net  Wed Oct 23 12:02:22 2002
From: rrreid at earthlink.net (Mr. Robin R. Reid)
Date: Fri Jan  9 21:53:12 2004
Subject: [mod_python] Problems with BETA3 and Solaris 9
Message-ID: <3DB6E42E.9060105@earthlink.net>

I ran the following configuration command

./configure --with-python --with-apxs=/usr/local/apache/bin/apxs

then ran make to completion. make install, however finished with the
following output:

Performing DSO installation.

./install-sh -c src/mod_python.so /usr/local/apache/modules
install:  src/mod_python.so does not exist
make[1]: *** [install_dso] Error 1
make[1]: Leaving directory `/export/home/tools/mod_python-3.0.0-BETA'
make: *** [install] Error 2

Needless to say, this is quite true. I'm running apache 2.0.43 and am using
gcc 3.1, with most of the gnu build tools installed. Being relatively new to
gnu build tools and mod_python, I'm not sure how to proceed.

Thanks in advance for your help.


From grisha at modpython.org  Wed Oct 23 14:39:21 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:12 2004
Subject: [mod_python] Problems with BETA3 and Solaris 9
In-Reply-To: <3DB6E42E.9060105@earthlink.net>
Message-ID: <20021023143337.B22688-100000@eden.ispol.com>

Did make report errors of any kind? It'd be strange if it didn't.

Try this:

Edit src/Makefile.in, change the line:

mod_python.so: $(SRCS)

to

mod_python.so: $(SRCS)  @EPRINTF_HACK@ @FLOATDIDF_HACK@

Then rerun ./configure --with-apxs=/usr/local/apache/bin/apxs

(You don't need the --with-python argument)

Let me know if it fixes it.

P.S. I had problems building and running apache on Solaris 9 and in the
end what fixed was compiling my own gcc from scratch. I used 3.2, but 3.1
should work OK as well. I also had to set LD_LIBRARY_PATH=/usr/local/lib.
I don't know (or don't care) enough about the intricacies of gcc on
Solaris to be able to explain what exactly goes on there, you may not need
those things on your system... :-)

Grisha


On Wed, 23 Oct 2002, Mr. Robin R. Reid wrote:

> I ran the following configuration command
>
> ./configure --with-python --with-apxs=/usr/local/apache/bin/apxs
>
> then ran make to completion. make install, however finished with the
> following output:
>
> Performing DSO installation.
>
> ./install-sh -c src/mod_python.so /usr/local/apache/modules
> install:  src/mod_python.so does not exist
> make[1]: *** [install_dso] Error 1
> make[1]: Leaving directory `/export/home/tools/mod_python-3.0.0-BETA'
> make: *** [install] Error 2
>
> Needless to say, this is quite true. I'm running apache 2.0.43 and am using
> gcc 3.1, with most of the gnu build tools installed. Being relatively new to
> gnu build tools and mod_python, I'm not sure how to proceed.
>
> Thanks in advance for your help.
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From eugene_beast at mail.ru  Thu Oct 24 09:46:16 2002
From: eugene_beast at mail.ru (Eugene Sizikov)
Date: Fri Jan  9 21:53:12 2004
Subject: [mod_python] unicode() conversion troubles with mod_python 3 CVS 27.06.2002
Message-ID: <005b01c27aff$26914920$0bcbefc3@irkutsk.teleross.ru>

Hello all ppl!

I have troubles with unicode conversion with mod_python from RedHat 8.0
distro. The errorlog is:

"
Mod_python error: "PythonHandler mod_python.publisher"

Traceback (most recent call last):

  File "/usr/lib/python2.2/site-packages/mod_python/apache.py", line 285, in
HandlerDispatch
    result = object(req)

  File "/usr/lib/python2.2/site-packages/mod_python/publisher.py", line 175,
in handler
    result = apply(object, (), args)

  File "/var/www/html/teleross/user.py", line 137, in start
    html = '%s [%s]<HR>' % (string_sql_to_html(user.fullname),
Group(user.con, user.gid).fullname) + menu.to_html()

  File "/var/www/html/teleross/utils.py", line 4, in string_sql_to_html
    return unicode(s, 'koi8-r')

  File
"/usr/src/build/143041-i386/install/usr/lib/python2.2/encodings/__init__.py"
, line 51, in search_function

RuntimeError: cannot unmarshal code objects in restricted execution mode
"

So, when it has "unicode(s, 'koi8-r')" it crashes with that interesting
message I can't understand.

Please, help!

Eugene.



From grisha at modpython.org  Thu Oct 24 17:43:20 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:12 2004
Subject: [mod_python] unicode() conversion troubles with mod_python 3
 CVS 27.06.2002
In-Reply-To: <005b01c27aff$26914920$0bcbefc3@irkutsk.teleross.ru>
Message-ID: <20021024174222.Y39970-100000@eden.ispol.com>

In my case upgrading to Python 2.2.2 eliminated all encodings weirdness.

Grisha

On Thu, 24 Oct 2002, Eugene Sizikov wrote:

> Hello all ppl!
>
> I have troubles with unicode conversion with mod_python from RedHat 8.0
> distro. The errorlog is:
>
> "
> Mod_python error: "PythonHandler mod_python.publisher"
>
> Traceback (most recent call last):
>
>   File "/usr/lib/python2.2/site-packages/mod_python/apache.py", line 285, in
> HandlerDispatch
>     result = object(req)
>
>   File "/usr/lib/python2.2/site-packages/mod_python/publisher.py", line 175,
> in handler
>     result = apply(object, (), args)
>
>   File "/var/www/html/teleross/user.py", line 137, in start
>     html = '%s [%s]<HR>' % (string_sql_to_html(user.fullname),
> Group(user.con, user.gid).fullname) + menu.to_html()
>
>   File "/var/www/html/teleross/utils.py", line 4, in string_sql_to_html
>     return unicode(s, 'koi8-r')
>
>   File
> "/usr/src/build/143041-i386/install/usr/lib/python2.2/encodings/__init__.py"
> , line 51, in search_function
>
> RuntimeError: cannot unmarshal code objects in restricted execution mode
> "
>
> So, when it has "unicode(s, 'koi8-r')" it crashes with that interesting
> message I can't understand.
>
> Please, help!
>
> Eugene.
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From robertoschler at hotmail.com  Fri Oct 25 09:47:10 2002
From: robertoschler at hotmail.com (Robert Oschler)
Date: Fri Jan  9 21:53:12 2004
Subject: [mod_python] Web Hosts that support mod_python?
Message-ID: <OE198VBDUfdfdhNzW3l00004a23@hotmail.com>

I've found several web hosting companies that support Python, but haven't found one that supports mod_python?  Anybody got one that you like?

thx

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20021025/120456a7/attachment-0001.htm
From mk at lrn.ru  Fri Oct 25 20:14:22 2002
From: mk at lrn.ru (Michael Krasnovsky)
Date: Fri Jan  9 21:53:12 2004
Subject: [mod_python] Using mod_python and shelve module
Message-ID: <20021025201422.671d02df.mk@lrn.ru>

Hi!

I try using standard python module shelve in my publisher handler, but I
got the error:

Mod_python error: "PythonHandler mod_python.publisher"
Traceback (most recent call last):

  File "/usr/lib/python2.2/site-packages/mod_python/apache.py", line
193, in Dispatch
    result = object(req)

  File "/usr/lib/python2.2/site-packages/mod_python/publisher.py", line
171, in handler
    result = apply(object, (), args)

  File "/home/mk/www/test2.py", line 7, in handle
    sessiondict = shelve.open('/tmp/apptest.session', 'c')

  File "/usr/lib/python2.2/shelve.py", line 158, in open
    return DbfilenameShelf(filename, flag)

  File "/usr/lib/python2.2/shelve.py", line 148, in __init__
    Shelf.__init__(self, anydbm.open(filename, flag))

  File "/usr/lib/python2.2/anydbm.py", line 86, in open
    return mod.open(file, flag, mode)

  File "/usr/lib/python2.2/dbhash.py", line 16, in open
    return bsddb.hashopen(file, flag, mode)

error: (13, 'Permission denied')


What's the problem? I check permissions of /tmp/ directory - it's OK.
BTW, I wrote simple cgi script with using shelve and it works fine.
I run mod_pytnon 2.7.8+Apache 1.3.27 on Linux. Python version 2.2.1.

Thanks for any help.

-- 
Michael Krasnovsky

E mk@lrn.ru

From neel at mediapulse.com  Fri Oct 25 16:37:34 2002
From: neel at mediapulse.com (Michael C. Neel)
Date: Fri Jan  9 21:53:12 2004
Subject: [mod_python] Web Hosts that support mod_python?
Message-ID: <C0FC22C08B82074A88B50061764157775BCF@johnson.mediapulse.net>

I've seen this question asked here a few times, and wondered why we (my
company) doesn't do this.  So I talked it over, and I'll be able to add
mod_python support when requested to an account.  I don't think it will
be advertised on our site, but email me and I can get it setup.  We
already have MySQL available, and I could install albatross as well
since I use it often.

The details:
    
        www.pulsetechnologies.net (which is a division of the company I
work for, www.mediapulse.com)

	  Contact me (Michael Neel) at neel@mediapulse.com) before
getting an account so that I can make sure you go on a mod_python ready
box.  I'll also be the contact for conf file changes and setup for you.

	Any questions, just email me - I don't want to take up post on
the list with spam even if it is for my company =D.

Mike

--
Michael C. Neel
Director of Software Development
Mediapulse, Inc.

 
-----Original Message-----
From: Robert Oschler [mailto:robertoschler@hotmail.com] 
Sent: Friday, October 25, 2002 9:47 AM
To: mod_python
Subject: [mod_python] Web Hosts that support mod_python?


I've found several web hosting companies that support Python, but
haven't found one that supports mod_python?  Anybody got one that you
like?

thx


From neel at mediapulse.com  Sat Oct 26 14:42:44 2002
From: neel at mediapulse.com (Michael Neel)
Date: Fri Jan  9 21:53:12 2004
Subject: [mod_python] Web Hosts that support mod_python?
In-Reply-To: <20021026004231.12422.qmail@email.com>
Message-ID: <000001c27d1f$78d57b30$0400a8c0@clapton>

Jack,

	I think that's it's all of the above.  First would be a lack of
popularity.  Going to apache's website it hard to find any info on
python under apace at all (hopefully this will change soon).  Next, you
do need a python skilled tech guy to admin and understand the mod_python
issues, and I'm guessing he's hard to find right now compared to perl or
php.

	I'm also not sure of those ISP's that offer mod_perl, how many
of them go beyond just using it for "fast CGI".  Allowing someone access
to embed an apache module in any language is a risky option.  Also, to
setup such a module you would need conf file access, and I'm sure most
ISP's don't like that idea either.

	Now the conf file issues may have resolution, but I'm not sure
how feasible it is to do, so I throw this out for feedback.  What it the
module "registered" itself for the hooks it wanted to use?  This way
there would be no need to change a conf file once setup.  Having the
feature in the conf file to restrict which hooks a module could register
for as well might be nice.  Lastly, having a way to call the module in a
url dynamically would help, so that no setup was needed in a conf file
to say where the module was, i.e. /python-bin/myhandler.py would use
myhandler.py as the module which registered hooks on it own, but
/python-bin/other.py would be a completely different handler all on it
own and neither one mentioned in the conf file; just some type of
"<Directory>" config to say that /python-bin was a handler directory and
that those handlers could register for any of the following hooks.

	I don't know of anything that works like the above, so this
would be very new to the apache world.  I'd like to think it would help
in getting more ISP's to support mod_python, but that's just a guess.
Either way, I'd like to know what others think.

Mike
--
Michael C. Neel
Director of Software Development
Mediapulse, Inc.
Mod_python hosting available

-----Original Message-----
From: Jack Diederich [mailto:jack_diederich@email.com] 
Sent: Friday, October 25, 2002 8:43 PM
To: Michael C. Neel
Subject: RE: [mod_python] Web Hosts that support mod_python?


Hi Michael,

Are there any technical reasons why mod_python isn't supported by most
hosting companies, is it just not popular enough to justify support, or
is it just a policy thing?

If it is anything but a policy thing, please throw a post on mod_python.
Technical tweaks could be made, or maybe someone would write a
webhosting mod_python HOWTO to make life easier for hosting providers.

If the answer is lack of popularity, we'll just have to wait a while. I
know quite a few folks up here in Boston that are moving to python or
ruby for rapid web application development from perl or C++. CPU cycles
are so cheap there isn't much reason not to anymore ;)

-jack

> I've seen this question asked here a few times, and wondered why we 
> (my
> company) doesn't do this.  So I talked it over, and I'll be able to
add
> mod_python support when requested to an account.  I don't think it
will
> be advertised on our site, but email me and I can get it setup.  We
> already have MySQL available, and I could install albatross as well
> since I use it often.

-- 
__________________________________________________________
Sign-up for your own FREE Personalized E-mail at Mail.com
http://www.mail.com/?sr=signup



From grisha at modpython.org  Wed Oct 30 11:49:09 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:12 2004
Subject: [mod_python] BETA 4
Message-ID: <20021030114730.C20021-100000@eden.ispol.com>

Beta 4 of mod_python 3.0 is available for download at
http://www.apache.org/dist/httpd/modpython/dev/

Most likely this will be the last beta before the final release of 3.0

Enjoy,

Grisha


From conrad at hep.caltech.edu  Wed Oct 30 10:01:32 2002
From: conrad at hep.caltech.edu (Conrad Steenberg)
Date: Fri Jan  9 21:53:12 2004
Subject: [mod_python] Customized permission denied message?
Message-ID: <1036000892.1707.117.camel@heppc22.hep.caltech.edu>

Hi

Is it possible to generate a customized permission denied message in an
authenhandler?

I'm using mod_python the answer XML-RPC requests and sending back an
XML-RPC denial message is more elegant than the standard text message.

Thanks!

Conrad

-- 
*-----------------------------------------*
| Conrad Steenberg                        |
| Caltech, Mail Code 356-48               |
| Pasadena, CA, 91125                     |
| e-mail: conrad@hep.caltech.edu          |
| Tel: (626) 395-8758                     |
*-----------------------------------------*


From grisha at modpython.org  Wed Oct 30 13:29:26 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:12 2004
Subject: [mod_python] Customized permission denied message?
In-Reply-To: <1036000892.1707.117.camel@heppc22.hep.caltech.edu>
Message-ID: <20021030132631.Y20021-100000@eden.ispol.com>

Yes, the authenhandler (or any handler for that matter) can service the
request to completion by writing whatever needed to the client (also you
may need to set the right status and headers if any) and return
apache.DONE, thereby telling the server that the request is fully serviced
and no other handlers (except for loging and cleanup) will be executed.

Grisha

On 30 Oct 2002, Conrad Steenberg wrote:

> Hi
>
> Is it possible to generate a customized permission denied message in an
> authenhandler?
>
> I'm using mod_python the answer XML-RPC requests and sending back an
> XML-RPC denial message is more elegant than the standard text message.
>
> Thanks!
>
> Conrad
>
> --
> *-----------------------------------------*
> | Conrad Steenberg                        |
> | Caltech, Mail Code 356-48               |
> | Pasadena, CA, 91125                     |
> | e-mail: conrad@hep.caltech.edu          |
> | Tel: (626) 395-8758                     |
> *-----------------------------------------*
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From antonio at memora.com  Thu Oct 31 17:04:30 2002
From: antonio at memora.com (Antonio L Rodriguez)
Date: Fri Jan  9 21:53:12 2004
Subject: [mod_python] Lifecycle of mod_python instances
Message-ID: <BB355965-ED1C-11D6-9578-00039300D690@memora.com>

Forgive me if this is more of an apache process question, but I 
couldn't find it covered clearly in the docs.

When apache boots up (on *NIX) its starts a bunch of children 
processes. Does each child have its own separate image of mod_python 
execution space that is totally separate from the other images?

That is, if I define a global var to measure hit counts in a script and 
then I see this var dance up and down as each of the child processes 
handles the request, do I infer correctly that there are separate 
python interpreters living inside of each child process?

If this is so, I'd be curious how people do global data structures in 
this model, i.e. a database connection pool.

Thanks,

Antonio


From sh at hob.cx  Tue Oct  1 18:02:44 2002
From: sh at hob.cx (Sean Holdsworth)
Date: Fri Jan  9 21:59:41 2004
Subject: [mod_python] Redirect from publisher - again...
Message-ID: <1033491764.10863.57.camel@hag.private.net>

I'm having a problem getting redirects working from a publisher handler.
I've seen the item in the FAQ (and can get redirection from
non-publisher handlers working fine). This issue also seems to crop up
fairly often in the mod_python list. Grisha has answered the question
before with the following example code.

req.headers_out['location'] = 'http://www.modpython.org/'
req.status = apache.HTTP_MOVED_TEMPORARILY
return "You are being redirected to http://www.modpython.org/"

When I run this I get the "You are being redirected..." message
displayed, and it just sits there. I've been trying to get this to work
for a couple of days and am beginning to wonder if it could be an Apache
setting that is causing the problem?

In addition to the publisher handler I have one handler, the
PythonAccessHandler configured. I use this to manage cookies and
redirect to a login page if the client hasn't authenticated. The
login page has a form with an action that causes the handler that
I'm trying to redirect out of to be run.

I'm running Apache 1.3.23 and  mod_python 2.7.8 with python 2.2 on
Mandrake 8.2 Linux. Could someone please run the above code
fragment as a policy handler and confirm that it is just me and my
configuration that has the problem?

Thanks, Sean



From rmunn at pobox.com  Wed Oct  2 01:27:51 2002
From: rmunn at pobox.com (rmunn@pobox.com)
Date: Fri Jan  9 21:59:41 2004
Subject: [mod_python] Patch to allow kwargs in publisher.py
Message-ID: <20021002062751.GA26230@rmunnlfs>

While playing around with my brand new install of mod_python 3.0.0 beta
2, I discovered that publisher.py does not handle the **kwargs syntax in
functions it's dispatching to. Apparently I'm not the only one who wants
that feature added:

http://www.modpython.org/pipermail/mod_python/2002-June/002171.html

It seems like the Right Thing for publisher.py's handler() func to do
would be to check whether the function accepts the **kwargs syntax
before stripping out unexpected args. Presumably if the user asked for
**kwargs-style args to be passed, he is expecting to receive all the
GET/POST arguments in the **kwargs dictionary. It would be intuitive
(it's what I was expecting to happen, actually, and I was surprised that
it didn't) and useful. And since it hadn't been done yet, I went ahead
and did it -- it was surprisingly simple. Here's a patch. It seems to
work fine for me -- I can't say I've given it a foolproof amount of
testing, but every test I threw at it seemed to do what I expected.

-- 
Robin Munn
rmunn@pobox.com


--- lib/python/mod_python/publisher.py	2002-09-12 13:24:05.000000000 -0500
+++ lib/python/mod_python/publisher.py.new	2002-10-02 01:07:46.000000000 -0500
@@ -180,10 +180,17 @@
             fc = object.im_func.func_code
             expected = fc.co_varnames[1:fc.co_argcount]
 
-        # remove unexpected args
-        for name in args.keys():
-            if name not in expected:
-                del args[name]
+        # does it want keyword args?
+        # co_flags & 0x04 is set if a function wants *args syntax
+        # co_flags & 0x08 is set if a function wants **kwargs syntax
+        if fc.co_flags & 0x08:
+            # don't strip unexpected args if function wants **kwargs
+            pass
+        else:
+            # remove unexpected args
+            for name in args.keys():
+                if name not in expected:
+                    del args[name]
 
         result = apply(object, (), args)
 

From rmunn at pobox.com  Wed Oct  2 08:59:13 2002
From: rmunn at pobox.com (rmunn@pobox.com)
Date: Fri Jan  9 21:59:41 2004
Subject: [mod_python] Documentation patch for kwargs change in publisher.py
Message-ID: <20021002135913.GA29104@rmunnlfs>

To go along with my earlier patch adding **kwargs functionality to the
publisher.py dispatcher, here's a documentation patch to keep the docs
up-to-date.

-- 
Robin Munn
rmunn@pobox.com



--- doc-html/hand-pub-alg-args.html	2002-09-24 11:59:13.000000000 -0500
+++ doc-html/hand-pub-alg-args.html.new	2002-10-02 08:52:51.000000000 -0500
@@ -58,7 +58,11 @@
 object expects. This list is compared with names of fields from HTML
 form data submitted by the client via <code>POST</code> or
 <code>GET</code>. Values of fields whose names match the names of callable
-object arguments will be passed as strings.
+object arguments will be passed as strings. Any fields whose names do
+not match the names of callable argument objects will be silently dropped.
+But if the destination callable object has a <code>**kwargs</code> style
+argument, then fields with unmatched names will be passed in the
+<code>**kwargs</code> argument instead.
 
 <P>
 If the destination is not callable or is a class, then its string

From rmunn at pobox.com  Wed Oct  2 09:25:40 2002
From: rmunn at pobox.com (rmunn@pobox.com)
Date: Fri Jan  9 21:59:41 2004
Subject: [mod_python] Documentation patch (another one) for hand-pub-alg-args.html
Message-ID: <20021002142540.GB29104@rmunnlfs>

Having sent in a patch to hand-pub-alg-args.html just now, I realized
that another paragraph would probably be a good idea, to explain why
it's a bad idea to have any fields called req in the HTML request, since
they would be silently dropped in the publisher.py code. I can just see
someone spending days on figuring out what's happening when all his
fields but one are getting passed through kwargs...

So here's another documentation patch. This one supersedes the doc patch
I just sent -- that is, it's meant to be applied to the original
hand-pub-alg-args.html file, not the updated version that my earlier
patch would produce.

-- 
Robin Munn
rmunn@pobox.com




--- doc-html/hand-pub-alg-args.html	2002-09-24 11:59:13.000000000 -0500
+++ doc-html/hand-pub-alg-args.html.new	2002-10-02 09:16:14.000000000 -0500
@@ -58,7 +58,21 @@
 object expects. This list is compared with names of fields from HTML
 form data submitted by the client via <code>POST</code> or
 <code>GET</code>. Values of fields whose names match the names of callable
-object arguments will be passed as strings.
+object arguments will be passed as strings. Any fields whose names do
+not match the names of callable argument objects will be silently dropped.
+But if the destination callable object has a <code>**kwargs</code> style
+argument, then fields with unmatched names will be passed in the
+<code>**kwargs</code> argument instead.
+
+<P>
+Note that the HTML request argument is passed as <code>req</code> to the
+callable object, so if the form data had any field called <code>req</code>,
+that field will be inaccessible in the callable object code. Fields called
+<code>self</code> will also cause problems for instance methods. If you
+absolutely must have a field named <code>self</code>, then you'd be well
+advised to call the first parameter of the instance method something else,
+such as <code>instobj</code>, or some other name that won't conflict with
+any field names.
 
 <P>
 If the destination is not callable or is a class, then its string

From dagurp at heimsnet.is  Wed Oct  2 14:51:21 2002
From: dagurp at heimsnet.is (=?iso-8859-1?Q?Dagur_P=E1ll_Ammendrup?=)
Date: Fri Jan  9 21:59:41 2004
Subject: [mod_python] Webhost with mod_python?
Message-ID: <001401c26a23$3105d2a0$5d016f0a@dagur>

Hi
Does anyone know of a webhost that offers mod_python and MySQL?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20021002/ffe7a433/attachment-0002.htm
From wilk-ml at flibuste.net  Wed Oct  2 22:05:31 2002
From: wilk-ml at flibuste.net (William Dode)
Date: Fri Jan  9 21:59:41 2004
Subject: [mod_python] Webhost with mod_python?
In-Reply-To: <001401c26a23$3105d2a0$5d016f0a@dagur>
References: <001401c26a23$3105d2a0$5d016f0a@dagur>
Message-ID: <87adlwppx0.fsf@flibuste.net>

Dagur P?ll Ammendrup <dagurp@heimsnet.is> writes:

> Hi
> Does anyone know of a webhost that offers mod_python and MySQL?

I would like to know how it's possible to install mod_python in a shared
web hosting when it's not possible to change the user id like suexec and
there is not safe_mod like php...

An other solution ?

-- 
William - http://wikipython.tuxfamily.org


From list-mod_python at empires.org  Wed Oct  2 14:36:40 2002
From: list-mod_python at empires.org (Jeff Davis)
Date: Fri Jan  9 21:59:41 2004
Subject: [mod_python] Webhost with mod_python?
In-Reply-To: <87adlwppx0.fsf@flibuste.net>
References: <001401c26a23$3105d2a0$5d016f0a@dagur> <87adlwppx0.fsf@flibuste.net>
Message-ID: <200210021436.40191.list-mod_python@empires.org>

> Dagur P?ll Ammendrup <dagurp@heimsnet.is> writes:
> > Hi
> > Does anyone know of a webhost that offers mod_python and MySQL?
>
> I would like to know how it's possible to install mod_python in a shared
> web hosting when it's not possible to change the user id like suexec and
> there is not safe_mod like php...
>
> An other solution ?

In apache2 there will exist an MPM called "mpm_perchild" that spawns a 
separate process for each virtualhost under the virtualhost's userid, and 
then each request to that virtualhost spawns a thread. That is the ideal 
solution. Unfortunately, it's not released in any kind of stable way yet.

Regards,
	Jeff Davis





From neel at mediapulse.com  Wed Oct  2 23:32:03 2002
From: neel at mediapulse.com (Michael Neel)
Date: Fri Jan  9 21:59:41 2004
Subject: [mod_python] MySQL Authencation
In-Reply-To: <200210021436.40191.list-mod_python@empires.org>
Message-ID: <000001c26a8d$7102d820$0400a8c0@clapton>

Hi All,

	I was wondering if anyone has done an SQL authencation module
for mod_python, not unlike mod_perl's Apache::DBI::Auth.  I'm looking
for MySQL, but I could work with any module and rewrite what is needed
to switch db's.  I'm also using apache 2.0 and mod_python 3, but I could
work from a 1.3 / 2.7 module.  I just don't want to start from scratch
if I don't need to.  I've tried to get mod_auth_mysql working under
apache 2, but that projects has more forks than the Sunday table so I'm
not quite sure where to ask install questions there.  Worst case I could
move to RedHat 8, which ships with apache 2, mod_python 3, and
mod_mysql_auth - but that seems like a lot of extra work to get SQL
authencation working!

Mike

--
Michael C. Neel
There are only 10 types of people in the world;
those who understand binary and those who don't.


From gbeasley at tsa.ac.za  Thu Oct  3 13:40:20 2002
From: gbeasley at tsa.ac.za (Grant Beasley)
Date: Fri Jan  9 21:59:41 2004
Subject: [mod_python] Problem with AuthenHandler & Apache Configuration
Message-ID: <OOENKCHGJGHILGPAGHGOEELNCEAA.gbeasley@tsa.ac.za>

Hi

I'm trying to set up my website in such a way that the entire website is
protected by an AuthenHandler, and the "cgi" directory (where my mod_python
scripts run) is directed to a publisher (my own modification of the standard
publisher).

To do this, I setup Apache with the following directives:

<Directory "C:/Projects/http/cgi">
  SetHandler python-program
PythonHandler mypub
PythonDebug On
</Directory>

<Directory "C:/Projects/http">
  SetHandler python-program
PythonAuthenHandler authen
	AuthType Basic
	AuthName "Restricted Area"
	require valid-user
PythonLogHandler log
PythonDebug On
</Directory>

I've programmed my authenhandler (for debugging purposes) as follows:
    pw = req.get_basic_auth_pw()
    user = req.connection.user
    f = open("C:\\authendump.txt", "a")
    f.write("""Authen - %s
URI: %s
UNPARSED_URI: %s
THE_REQUEST: %s
PATH_INFO: %s
FILENAME: %s
USER: %s
PW: %s
-----------------
""" % (strftime('%d/%m/%Y %H:%M:%S', localtime()),req.uri, req.unparsed_uri,
req.the_request, req.path_info, req.filename, user, pw))
    if user is not None:
        return apache.OK
    else:
        return apache.HTTP_UNAUTHORIZED
    f.close()

i.e. Just to dump a few variables for inspection.

For a single request, the above configuration gives me the following:

Authen - 03/10/2002 13:31:16
URI: /showuser
UNPARSED_URI: /showuser
THE_REQUEST: GET /cgi/cool/showuser HTTP/1.1
PATH_INFO:
FILENAME: c:/projects/http/showuser
USER: None
PW: None
-----------------
Authen - 03/10/2002 13:31:16
URI: /cgi/cool/showuser
UNPARSED_URI: /cgi/cool/showuser
THE_REQUEST: GET /cgi/cool/showuser HTTP/1.1
PATH_INFO: /showuser
FILENAME: c:/projects/http/cgi/cool
USER: None
PW: None
-----------------
Authen - 03/10/2002 13:31:18
URI: /showuser
UNPARSED_URI: /showuser
THE_REQUEST: GET /cgi/cool/showuser HTTP/1.1
PATH_INFO:
FILENAME: c:/projects/http/showuser
USER: gb
PW: a
-----------------
Authen - 03/10/2002 13:31:18
URI: /cgi/cool/showuser
UNPARSED_URI: /cgi/cool/showuser
THE_REQUEST: GET /cgi/cool/showuser HTTP/1.1
PATH_INFO: /showuser
FILENAME: c:/projects/http/cgi/cool
USER: gb
PW: a
-----------------

In other words the authenhandler code is executing twice, with a different
URI. On inspection of the get_config() and get_dirs(), I can see that it's
executing once for each of the above directives.

What I'd like to know is why this occurs, and how do I prevent it?

Any help appreciated.

Grant Beasley


From neo at https.ru  Thu Oct  3 23:35:43 2002
From: neo at https.ru (Neo Eureka)
Date: Fri Jan  9 21:59:41 2004
Subject: [mod_python] Apache 2.0.42
Message-ID: <11731692471.20021003233543@https.ru>

Hi !

  It seems, BETA2 of mod_python 3 is not compatible with
Apache-2.0.42. It builds successfully, but when apache is asked to
test new configuration it complains about undefined symbol "openpty"
while trying to load mod_python into the server.

  Linux 7.2, Apache-2.0.42, Python-2.2.1.

                                                                Neo

P.S.
  The latest version of Apache recommended by Apache.org is 2.0.43. It
would be cool if mod_python 3 somehow could cope with these versions.


From grisha at modpython.org  Thu Oct  3 16:58:01 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:59:41 2004
Subject: [mod_python] Documentation patch for kwargs change in publisher.py
In-Reply-To: <20021002135913.GA29104@rmunnlfs>
Message-ID: <Pine.BSF.4.32.0210031656290.1483-100000@eden.ispol.com>

Thanks, I'll add this in.

BTW, the doc-html stuff automatically generated from .tex files in Doc.

On Wed, 2 Oct 2002 rmunn@pobox.com wrote:

> To go along with my earlier patch adding **kwargs functionality to the
> publisher.py dispatcher, here's a documentation patch to keep the docs
> up-to-date.
>
> --
> Robin Munn
> rmunn@pobox.com
>
>
>
> --- doc-html/hand-pub-alg-args.html	2002-09-24 11:59:13.000000000 -0500
> +++ doc-html/hand-pub-alg-args.html.new	2002-10-02 08:52:51.000000000 -0500
> @@ -58,7 +58,11 @@
>  object expects. This list is compared with names of fields from HTML
>  form data submitted by the client via <code>POST</code> or
>  <code>GET</code>. Values of fields whose names match the names of callable
> -object arguments will be passed as strings.
> +object arguments will be passed as strings. Any fields whose names do
> +not match the names of callable argument objects will be silently dropped.
> +But if the destination callable object has a <code>**kwargs</code> style
> +argument, then fields with unmatched names will be passed in the
> +<code>**kwargs</code> argument instead.
>
>  <P>
>  If the destination is not callable or is a class, then its string
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From grisha at modpython.org  Thu Oct  3 17:30:48 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:59:42 2004
Subject: [mod_python] Problem with AuthenHandler & Apache Configuration
In-Reply-To: <OOENKCHGJGHILGPAGHGOEELNCEAA.gbeasley@tsa.ac.za>
Message-ID: <Pine.BSF.4.32.0210031728430.1483-100000@eden.ispol.com>

Apache does this. It has to give a module a chance to evaluate permissions
at every directory in the path. I do not believe there is much you can do
about this.

Grisha

On Thu, 3 Oct 2002, Grant Beasley wrote:

> Hi
>
> I'm trying to set up my website in such a way that the entire website is
> protected by an AuthenHandler, and the "cgi" directory (where my mod_python
> scripts run) is directed to a publisher (my own modification of the standard
> publisher).
>
> To do this, I setup Apache with the following directives:
>
> <Directory "C:/Projects/http/cgi">
>   SetHandler python-program
> PythonHandler mypub
> PythonDebug On
> </Directory>
>
> <Directory "C:/Projects/http">
>   SetHandler python-program
> PythonAuthenHandler authen
> 	AuthType Basic
> 	AuthName "Restricted Area"
> 	require valid-user
> PythonLogHandler log
> PythonDebug On
> </Directory>
>
> I've programmed my authenhandler (for debugging purposes) as follows:
>     pw = req.get_basic_auth_pw()
>     user = req.connection.user
>     f = open("C:\\authendump.txt", "a")
>     f.write("""Authen - %s
> URI: %s
> UNPARSED_URI: %s
> THE_REQUEST: %s
> PATH_INFO: %s
> FILENAME: %s
> USER: %s
> PW: %s
> -----------------
> """ % (strftime('%d/%m/%Y %H:%M:%S', localtime()),req.uri, req.unparsed_uri,
> req.the_request, req.path_info, req.filename, user, pw))
>     if user is not None:
>         return apache.OK
>     else:
>         return apache.HTTP_UNAUTHORIZED
>     f.close()
>
> i.e. Just to dump a few variables for inspection.
>
> For a single request, the above configuration gives me the following:
>
> Authen - 03/10/2002 13:31:16
> URI: /showuser
> UNPARSED_URI: /showuser
> THE_REQUEST: GET /cgi/cool/showuser HTTP/1.1
> PATH_INFO:
> FILENAME: c:/projects/http/showuser
> USER: None
> PW: None
> -----------------
> Authen - 03/10/2002 13:31:16
> URI: /cgi/cool/showuser
> UNPARSED_URI: /cgi/cool/showuser
> THE_REQUEST: GET /cgi/cool/showuser HTTP/1.1
> PATH_INFO: /showuser
> FILENAME: c:/projects/http/cgi/cool
> USER: None
> PW: None
> -----------------
> Authen - 03/10/2002 13:31:18
> URI: /showuser
> UNPARSED_URI: /showuser
> THE_REQUEST: GET /cgi/cool/showuser HTTP/1.1
> PATH_INFO:
> FILENAME: c:/projects/http/showuser
> USER: gb
> PW: a
> -----------------
> Authen - 03/10/2002 13:31:18
> URI: /cgi/cool/showuser
> UNPARSED_URI: /cgi/cool/showuser
> THE_REQUEST: GET /cgi/cool/showuser HTTP/1.1
> PATH_INFO: /showuser
> FILENAME: c:/projects/http/cgi/cool
> USER: gb
> PW: a
> -----------------
>
> In other words the authenhandler code is executing twice, with a different
> URI. On inspection of the get_config() and get_dirs(), I can see that it's
> executing once for each of the above directives.
>
> What I'd like to know is why this occurs, and how do I prevent it?
>
> Any help appreciated.
>
> Grant Beasley
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From rmunn at pobox.com  Thu Oct  3 16:39:27 2002
From: rmunn at pobox.com (rmunn@pobox.com)
Date: Fri Jan  9 21:59:42 2004
Subject: [mod_python] Documentation patch for kwargs change in publisher.py
In-Reply-To: <Pine.BSF.4.32.0210031656290.1483-100000@eden.ispol.com>
References: <20021002135913.GA29104@rmunnlfs> <Pine.BSF.4.32.0210031656290.1483-100000@eden.ispol.com>
Message-ID: <20021003213927.GB26042@rmunnlfs>

On Thu, Oct 03, 2002 at 04:58:01PM -0400, Gregory (Grisha) Trubetskoy wrote:
> 
> Thanks, I'll add this in.
> 
> BTW, the doc-html stuff automatically generated from .tex files in Doc.
> 
[snip my patch]

Ah. Next time I send in a doc patch I'll patch the .tex files, then.

-- 
Robin Munn
rmunn@pobox.com

From daniel at copyleft.no  Sat Oct  5 01:23:48 2002
From: daniel at copyleft.no (Hr. Daniel Mikkelsen)
Date: Fri Jan  9 21:59:42 2004
Subject: [mod_python] Problems with PYTHONPATH.
Message-ID: <20021005011159.B33688-100000@unity.copyleft.no>

Hi.

I'm experiencing odd behaviour with mod_python and its PYTHONPATH. I'm running
FreeBSD 4.5. I'm not using the port-version of mod_python, since I want use a
separate threadless Python.

Anyway, I've compiled up things, and they basically work. I have my python
version in /local/python-2.2.1-threadless. Mod_python, when ./configuring
detects this from the --with-python=/local/src/Python-2.2.1 I give it.

All very automatic and nice.

But when I fire up Apache with this, things just refuse to work until I add a
symlink from
"/local/python-2.2.1-threadless/lib/python2.2/site-packages/mod_python" to
"/usr/local/lib/python2.2/site-packages".

And when I make my test handler print out sys.path, what I get is the
/usr/local prefixed ones, not the /local/python-2.2.1-threadless ones.

I can't figure out what's going on. The mod_python.so DSO only knows about
/local/python-2.2.1-threadless.

I've worked around this with a PythonPath entry, but I'm very curious as to why
this is happening. Is /usr/local some default prefix Python defaults to? Is
mod_python.so loading /usr/local/lib/python2.2/config/libpython2.2.a somehow by
mistake?

I'm absolutely certain there is only one installation of mod_python on my
system, and that it's configured and compiled with the correct (threadless)
interpreter.

Any help would be appreciated. :)

-- Daniel


From jack_diederich at email.com  Fri Oct  4 20:43:18 2002
From: jack_diederich at email.com (Jack Diederich)
Date: Fri Jan  9 21:59:42 2004
Subject: [mod_python] Problems with PYTHONPATH.
Message-ID: <20021005014318.19386.qmail@email.com>

I had a similar problem when using a user specific python instead of the system wide python with mod_python.
I took the cowards way out and just issued a PythonPath directive in httpd.conf with all the paths I need.

-jack
----- Original Message -----
From: "Hr. Daniel Mikkelsen" <daniel@copyleft.no>
Date: Sat, 5 Oct 2002 01:23:48 +0200 (CEST) 
To: mod_python@modpython.org
Subject: [mod_python] Problems with PYTHONPATH.


> Hi.
> 
> I'm experiencing odd behaviour with mod_python and its PYTHONPATH. I'm running
> FreeBSD 4.5. I'm not using the port-version of mod_python, since I want use a
> separate threadless Python.
> 
> Anyway, I've compiled up things, and they basically work. I have my python
> version in /local/python-2.2.1-threadless. Mod_python, when ./configuring
> detects this from the --with-python=/local/src/Python-2.2.1 I give it.
> 
> All very automatic and nice.
> 
> But when I fire up Apache with this, things just refuse to work until I add a
> symlink from
> "/local/python-2.2.1-threadless/lib/python2.2/site-packages/mod_python" to
> "/usr/local/lib/python2.2/site-packages".
> 
> And when I make my test handler print out sys.path, what I get is the
> /usr/local prefixed ones, not the /local/python-2.2.1-threadless ones.
> 
> I can't figure out what's going on. The mod_python.so DSO only knows about
> /local/python-2.2.1-threadless.
> 
> I've worked around this with a PythonPath entry, but I'm very curious as to why
> this is happening. Is /usr/local some default prefix Python defaults to? Is
> mod_python.so loading /usr/local/lib/python2.2/config/libpython2.2.a somehow by
> mistake?
> 
> I'm absolutely certain there is only one installation of mod_python on my
> system, and that it's configured and compiled with the correct (threadless)
> interpreter.
> 
> Any help would be appreciated. :)
> 
> -- Daniel
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 
> 

-- 
__________________________________________________________
Sign-up for your own FREE Personalized E-mail at Mail.com
http://www.mail.com/?sr=signup


"Free price comparison tool gives you the best prices and cash back!"
http://www.bestbuyfinder.com/download.htm


From piet at cs.uu.nl  Sat Oct  5 13:03:33 2002
From: piet at cs.uu.nl (Piet van Oostrum)
Date: Fri Jan  9 21:59:42 2004
Subject: [mod_python] Apache 2.0.42
In-Reply-To: <11731692471.20021003233543@https.ru>
References: <11731692471.20021003233543@https.ru>
Message-ID: <wzn0pttaey.fsf@cs.uu.nl>

>>>>> Neo Eureka <neo@https.ru> (NE) writes:

NE> Hi !

NE>   It seems, BETA2 of mod_python 3 is not compatible with
NE> Apache-2.0.42. It builds successfully, but when apache is asked to
NE> test new configuration it complains about undefined symbol "openpty"
NE> while trying to load mod_python into the server.

Maybe this previous post will help:

----- Original Message -----
From: "Carl C." <cc@carlc.com>
Subject: Re: [mod_python] Compiling a DSO module for RedHat Linux on ALPHA
64bit.
Guess, what... I FIXED IT...
I had to edit the mod_python's src/Makefile and change the
LIBS=-lm? /usr/src/Python-2.2-no-threads/libpython2.2.a
to
LIBS=-lm? /usr/src/Python-2.2-no-threads/libpython2.2.a -lutil
That -lutil was the magic!
Carl

-- 
Piet van Oostrum <piet@cs.uu.nl>
URL: http://www.cs.uu.nl/~piet [PGP]
Private email: P.van.Oostrum@hccnet.nl



From jack_diederich at email.com  Sat Oct  5 08:10:46 2002
From: jack_diederich at email.com (Jack Diederich)
Date: Fri Jan  9 21:59:42 2004
Subject: [mod_python] Apache 2.0.42
Message-ID: <20021005131050.32347.qmail@email.com>

For me (mod_python 2x, linux, Python 2.2.1) I needed to symlink Modules/Makefile to the root Python Makefile or ./configure would leave out some libraries in the linker line.  I don't remember if libutil was one of them.

I posted that to python-dev@httpd.apache.org, does anyone know if there is a searchable archive, or when there might be one in the future?

-jack
----- Original Message -----
From: Piet van Oostrum <piet@cs.uu.nl>
Date: 05 Oct 2002 13:03:33 +0200 
To: Neo Eureka <neo@https.ru>
Subject: Re: [mod_python] Apache 2.0.42


> >>>>> Neo Eureka <neo@https.ru> (NE) writes:
> 
> NE> Hi !
> 
> NE>   It seems, BETA2 of mod_python 3 is not compatible with
> NE> Apache-2.0.42. It builds successfully, but when apache is asked to
> NE> test new configuration it complains about undefined symbol "openpty"
> NE> while trying to load mod_python into the server.
> 
> Maybe this previous post will help:
> 
> ----- Original Message -----
> From: "Carl C." <cc@carlc.com>
> Subject: Re: [mod_python] Compiling a DSO module for RedHat Linux on ALPHA
> 64bit.
> Guess, what... I FIXED IT...
> I had to edit the mod_python's src/Makefile and change the
> LIBS=-lm  /usr/src/Python-2.2-no-threads/libpython2.2.a
> to
> LIBS=-lm  /usr/src/Python-2.2-no-threads/libpython2.2.a -lutil
> That -lutil was the magic!
> Carl
> 
> -- 
> Piet van Oostrum <piet@cs.uu.nl>
> URL: http://www.cs.uu.nl/~piet [PGP]
> Private email: P.van.Oostrum@hccnet.nl
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 
> 

-- 
__________________________________________________________
Sign-up for your own FREE Personalized E-mail at Mail.com
http://www.mail.com/?sr=signup


"Free price comparison tool gives you the best prices and cash back!"
http://www.bestbuyfinder.com/download.htm


From mateusz at ant.gliwice.pl  Sat Oct  5 15:39:48 2002
From: mateusz at ant.gliwice.pl (Mateusz Korniak)
Date: Fri Jan  9 21:59:42 2004
Subject: [mod_python] Perhaps bug in mod_pythons configure.in ? (python 2.2 and undefined symbol "openpty")
In-Reply-To: <20021005131050.32347.qmail@email.com>
References: <20021005131050.32347.qmail@email.com>
Message-ID: <200210051536.10652.mateusz@ant.gliwice.pl>

On Saturday 05 October 2002 15:10, Jack Diederich wrote:

> > NE>   It seems, BETA2 of mod_python 3 is not compatible with
> > NE> Apache-2.0.42. It builds successfully, but when apache is asked to
> > NE> test new configuration it complains about undefined symbol "openpty"
> > NE> while trying to load mod_python into the server.

> For me (mod_python 2x, linux, Python 2.2.1) I needed to symlink
> Modules/Makefile to the root Python Makefile or ./configure would leave out
> some libraries in the linker line.  I don't remember if libutil was one of
> them.
>
I've run at similar behavior ....
I'm totally ignorant about autoconf/automake stuff but I think problem affects 
python 2.2 bug in configure.in.

2.2 version triggers bad path to Makefile -> python is badly recognaised as 
linked without libs -> symbols are missing.

# set python std library variable
AC_MSG_CHECKING(what libraries Python was linked with)
AC_SUBST(LIBS)
if test -z "$PYTHON_SRC"; then
  PyLIBP=${PyEXEC_INSTALLDIR}/lib/python${PyVERSION}
  PyLIBPL=${PyLIBP}/config
  PyPYTHONLIBS=${PyLIBPL}/libpython${PyVERSION}.a
  PyLIBS=`grep "^LIB[[SMC]]=" ${PyLIBPL}/Makefile | cut -f2 -d= | tr 
'\011\012\015' '   '`
  PyMODLIBS=`grep "^LOCALMODLIBS=" ${PyLIBPL}/Makefile | cut -f2 -d= | tr 
'\011\012\015' '   '`
  PY_LIBS="${PyPYTHONLIBS} ${PyLIBS} ${PyMODLIBS}"
else
  PyPYTHONLIBS=${PYTHON_SRC}/libpython${PyVERSION}.a
  if test ${PyVERSION} = "2.1"; then
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ IMHO This test should be possitive for 2.2 
too

    PyLIBS=`grep "^LIB[[SMC]]=" ${PYTHON_SRC}/Makefile | cut -f2 -d= | tr 
'\011\012\015' '   '`
    PyMODLIBS=`grep "^LOCALMODLIBS=" ${PYTHON_SRC}/Makefile | cut -f2 -d= | tr 
'\011\012\015' '   '`
  else
    PyLIBS=`grep "^LIB[[SMC]]=" ${PYTHON_SRC}/Modules/Makefile | cut -f2 -d= | 
tr '\011\012\015' '   '`
    PyMODLIBS=`grep "^LOCALMODLIBS=" ${PYTHON_SRC}/Modules/Makefile | cut -f2 
-d= | tr '\011\012\015' '   '`
  fi
  PY_LIBS="${PyPYTHONLIBS} ${PyLIBS} ${PyMODLIBS}"
fi


-- 
Mateusz Korniak
"Black holes are where God divided by zero." - Steven Wright



From mateusz at ant.gliwice.pl  Sat Oct  5 15:45:09 2002
From: mateusz at ant.gliwice.pl (Mateusz Korniak)
Date: Fri Jan  9 21:59:42 2004
Subject: [mod_python] Two more fixes to ac/am stuff (patches included)
Message-ID: <200210051545.09369.mateusz@ant.gliwice.pl>

Both taken from PLD distro...

1. Fixes DESTDIR behavior
2. Fixes typo. (IMHO)


-- 
Mateusz Korniak

-------------- next part --------------
A non-text attachment was scrubbed...
Name: apache-mod_python-DESTDIR.patch
Type: text/x-diff
Size: 987 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20021005/e3571cd3/apache-mod_python-DESTDIR-0002.bin
-------------- next part --------------
A non-text attachment was scrubbed...
Name: apache-mod_python-Makefile-in.patch
Type: text/x-diff
Size: 507 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20021005/e3571cd3/apache-mod_python-Makefile-in-0002.bin
From neo at https.ru  Sat Oct  5 23:43:24 2002
From: neo at https.ru (Neo Eureka)
Date: Fri Jan  9 21:59:42 2004
Subject: [mod_python] Missing library in Makefile
In-Reply-To: <wzn0pttaey.fsf@cs.uu.nl>
References: <11731692471.20021003233543@https.ru> <wzn0pttaey.fsf@cs.uu.nl>
Message-ID: <974103440.20021005234324@https.ru>

  Dank U wel !

  This was it!

I think all the problems in configure/make stuff should be corrected
before any other bugs, because such problems prevent not very
experienced users (like me, at the moment) from testing the software
itself.


NE>> Hi !

NE>>   It seems, BETA2 of mod_python 3 is not compatible with
NE>> Apache-2.0.42. It builds successfully, but when apache is asked to
NE>> test new configuration it complains about undefined symbol "openpty"
NE>> while trying to load mod_python into the server.

PvO> Maybe this previous post will help:

PvO> ----- Original Message -----
PvO> From: "Carl C." <cc@carlc.com>
PvO> Subject: Re: [mod_python] Compiling a DSO module for RedHat Linux on ALPHA
PvO> 64bit.
PvO> Guess, what... I FIXED IT...
PvO> I had to edit the mod_python's src/Makefile and change the
PvO> LIBS=-lm? /usr/src/Python-2.2-no-threads/libpython2.2.a
PvO> to
PvO> LIBS=-lm? /usr/src/Python-2.2-no-threads/libpython2.2.a -lutil
PvO> That -lutil was the magic!
PvO> Carl

---
Neo Eureka / mailto:neo@https.ru


From neo at https.ru  Sun Oct  6 18:25:52 2002
From: neo at https.ru (Neo)
Date: Fri Jan  9 21:59:42 2004
Subject: [mod_python] Segfaults... segfaults...
Message-ID: <19513182194.20021006182552@https.ru>

  Hi all !

  I was just playing with mod_python 3 & Apache 2.0.42
(RedHat Linux 7.2). Below are my "mptest.py" file, Apache VH config
and the resuts of the single request:

GET /mptest.py


----------------BEGIN----------------
from mod_python import apache


interp = None

def transhandler(req):
    interp = req.interpreter
    return apache.OK

def handler(req):
    req.write(repr(interp))
    return apache.OK
-----------------END-----------------

Config for virtual host:
----------------BEGIN----------------
<VirtualHost *>
[... skipped ...]

    PythonPath    "..."

    PythonDebug On
    PythonTransHandler mptest
    SetHandler python-program
    PythonHandler mptest

    <Directory "/home/w-https/test-www">
        Options Indexes FollowSymLinks
        AllowOverride None

        Order allow,deny
        Allow from all

        DirectoryIndex index.html index.htm index.html.var

        AddDefaultCharset UTF-8
    </Directory>

[... skipped ...]
</VirtualHost>
-----------------END-----------------

Apache virtualhost log file:
----------------BEGIN----------------
[Sun Oct 06 18:02:44 2002] [info] [client 212.188.98.243] Module bug?
Request filename is missing for URI /mptest.py
-----------------END-----------------

*** I guess "transhandler" in the above example should somehow set
    filename for incoming request for Apache to be happy? But SEGFAULT
    is not the best action to report the error :)

Apache main server log file:
----------------BEGIN----------------
[Sun Oct 06 18:02:45 2002] [notice] child pid 12331 exit signal
Segmentation fault (11) 
-----------------END-----------------


---
Neo Eureka / mailto:neo@https.ru


From michaelteo at bigfoot.com  Mon Oct  7 17:55:51 2002
From: michaelteo at bigfoot.com (Michael Teo)
Date: Fri Jan  9 21:59:42 2004
Subject: [mod_python] Module conflicts on mod_python
Message-ID: <20021007095551.GA4290@bigfoot.com>

Hi, I am fortunate enough to be able deploy mod_python on a commercial web
server. 

However, I am currently being plagued by this problem.
I am running Apache 1.3.27 with mod_python 2.7.8 and python 2.2.1.
Virtualname hosting is enabled on Apache to allow virtual domainname hosting.

Now, say domain A and domain B has some mod_python publisher scripts which
import a session.py script. Only one session.py in either domain A or domain
B is loaded. However, the implementation of session.py is very different in
both domains and this causes a whole lot of errors on either A or B scripts.

Is there a misconfiguration in my httpd.conf, or is that supposed to be the
part of the feature with mod_python ?
Any advice will be greatly appreciated.
Thanks in advance.



The following are the contents of the .htaccess file in the cgi-bin 
directories. PythonPath are modified accordingly to the domainA and domainB.

AddHandler python-program .py .pyc
PythonHandler mod_python.publisher
PythonPath "sys.path + [ '/home/www/domainA/public_html/cgi-bin' ]



-- 
Michael Teo <mailto:michaelteo@bigfoot.com>
http://miketeo.net/
PGP  0x6C846A9C  DB:7D:51:D4:4D:AB:97:79:E4:68:D9:07:94:36:D5:1A:6C:84:6A:9C
     0x6937FB05  08:50:A1:4D:2E:45:58:60:DE:71:1F:30:63:54:EF:7B

From rmunn at pobox.com  Mon Oct  7 09:06:37 2002
From: rmunn at pobox.com (rmunn@pobox.com)
Date: Fri Jan  9 21:59:42 2004
Subject: [mod_python] Module conflicts on mod_python
In-Reply-To: <20021007095551.GA4290@bigfoot.com>
References: <20021007095551.GA4290@bigfoot.com>
Message-ID: <20021007140637.GA5212@rmunnlfs>

On Mon, Oct 07, 2002 at 05:55:51PM +0800, Michael Teo wrote:
> 
> Hi, I am fortunate enough to be able deploy mod_python on a commercial web
> server. 
> 
> However, I am currently being plagued by this problem.
> I am running Apache 1.3.27 with mod_python 2.7.8 and python 2.2.1.
> Virtualname hosting is enabled on Apache to allow virtual domainname hosting.
> 
> Now, say domain A and domain B has some mod_python publisher scripts which
> import a session.py script. Only one session.py in either domain A or domain
> B is loaded. However, the implementation of session.py is very different in
> both domains and this causes a whole lot of errors on either A or B scripts.
> 
> Is there a misconfiguration in my httpd.conf, or is that supposed to be the
> part of the feature with mod_python ?
> Any advice will be greatly appreciated.
> Thanks in advance.
> 
> 
> 
> The following are the contents of the .htaccess file in the cgi-bin 
> directories. PythonPath are modified accordingly to the domainA and domainB.
> 
> AddHandler python-program .py .pyc
> PythonHandler mod_python.publisher
> PythonPath "sys.path + [ '/home/www/domainA/public_html/cgi-bin' ]
> 

Do you have the PythonInterpPerDirectory directive turned on? It would
allow domain A and domain B's scripts to run in separate Python
interpreters with completely separate namespaces, so their session.py
scripts could not conflict with each other. For more information:

http://www.modpython.org/live/mod_python-2.7.8/doc-html/dir-other-ipd.html

-- 
Robin Munn
rmunn@pobox.com
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20021007/bc29ddb4/attachment-0002.bin
From rmunn at pobox.com  Tue Oct  8 12:34:46 2002
From: rmunn at pobox.com (rmunn@pobox.com)
Date: Fri Jan  9 21:59:42 2004
Subject: [mod_python] Segfault when using PythonImport directive
Message-ID: <20021008173446.GB5212@rmunnlfs>

I'm using mod_python 3.0.0 BETA 2 with Apache 2.0.42 and encountering a
segfault every time I try to use the PythonInclude directive. The
segfault occurs even when I try to have Apache do a configuration syntax
check (/usr/apache2/bin/apachectl configtest). I've narrowed it down to
a single PythonInclude line. This is the <Directory> directive in which
the PythonInclude directive appears:


<Directory /var/www/publisher>
    AddHandler python-program .py
    PythonHandler mod_python.publisher
    PythonInterpPerDirective On
    PythonImport globals
</Directory>


If I comment out the "PythonImport globals" line, everything runs fine.

Here's the contents of my /var/www/publisher directory:


rmunn@localhost:/var/www/publisher$ ls -l
total 8
-rw-r--r--    1 rmunn    users          12 Oct  7 19:22 globals.py
-rw-r--r--    1 rmunn    users         133 Oct  8 12:26 tryme.py
rmunn@localhost:/var/www/publisher$ cat globals.py 
foo = 'bar'
rmunn@localhost:/var/www/publisher$ cat tryme.py 
def show(req, name):
    try:
        return str(globals.foo)
    except AttributeError, NameError:
        return str(dir(globals))


As you can see, what I'm trying to do is have some global variables
pre-defined in my mod_python scripts; I plan on using this to accomplish
expensive operations (like opening database connections) once per apache
process child instead of once per request.

Here's the gdb backtrace of my segfault. I'm running httpd -t to only
get a configuration syntax check and it's still failing. Any ideas?


root@localhost:/usr/apache2/conf# gdb ../bin/httpd 
GNU gdb 5.2.1
Copyright 2002 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you
are
welcome to change it and/or distribute copies of it under certain
conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for
details.
This GDB was configured as "i686-pc-linux-gnu"...
(gdb) run -t
Starting program: /usr/apache2/bin/httpd -t
[New Thread 1024 (LWP 29765)]

Program received signal SIGSEGV, Segmentation fault.
[Switching to Thread 1024 (LWP 29765)]
__pthread_mutex_lock (mutex=0x10) at mutex.c:99
99      mutex.c: No such file or directory.
        in mutex.c
(gdb) backtrace full
#0  __pthread_mutex_lock (mutex=0x10) at mutex.c:99
        mutex = (pthread_mutex_t *) 0x10
        self = 0x0
#1  0x403d8f43 in PyThread_acquire_lock (lock=0x0, waitflag=1) at
Python/thread_pthread.h:359
        lock = 0x0
        success = 1078103364
        status = 0
        error = 0
#2  0x403bbb4e in PyEval_AcquireLock () at Python/ceval.c:267
No locals.
#3  0x4037c1b3 in directive_PythonImport (cmd=0xbffffc30,
mconfig=0x80e0958, module=0x80e0e28 "globals") at mod_python.c:1220
        cmd = (cmd_parms *) 0x0
        mconfig = (void *) 0x0
        module = 0x0
#4  0x08067349 in invoke_cmd (cmd=0x4040d154, parms=0xbffffc30,
mconfig=0x80e0958, args=0x80d594f "") at config.c:800
        w = 0x80e0e28 "globals"
        w2 = 0xbffffc30 ""
        w3 = 0x4040d154 "\231n?@\234Á7@"
        errmsg = 0x0
#5  0x08067a53 in ap_walk_config_sub (current=0x80d5928,
parms=0xbffffc30, section_vector=0x80e05f0) at config.c:1082
        dir_config = (void *) 0x4040d154
        retval = 0x4040d154 "\231n?@\234Á7@"
        cmd = (command_rec *) 0x4040d154
        current = (ap_directive_t *) 0x80d5928
        parms = (cmd_parms *) 0xbffffc30
        mod = (module *) 0x4040d2e0
#6  0x08067ad1 in ap_walk_config (current=0x80d5850, parms=0xbffffc30,
section_vector=0x80e05f0) at config.c:1121
        errmsg = 0x0
        current = (ap_directive_t *) 0x80d5928
        parms = (cmd_parms *) 0xbffffc30
        oldconfig = (ap_conf_vector_t *) 0x80b3488
#7  0x08074beb in dirsection (cmd=0xbffffc30, mconfig=0x80b3598,
arg=0x80e0792 "") at core.c:1625
        cmd = (cmd_parms *) 0xbffffc30
        errmsg = 0x0
        endp = 0x80e07e0 ""
        old_overrides = 150
        old_path = 0x0
        conf = (core_dir_config *) 0x80e07e0
        new_dir_conf = (ap_conf_vector_t *) 0x80e05f0
        r = (regex_t *) 0x0
        thiscmd = (command_rec *) 0x8088bec
        err = 0x0
#8  0x08066e6e in invoke_cmd (cmd=0x8088bec, parms=0xbffffc30,
mconfig=0x80b3598, args=0x80d5828 "/var/www/publisher>") at config.c:713
        w = 0x80d5808 "øW\r\b(X\r\b"
        w2 = 0xbffffc30 ""
        w3 = 0x4040d154 "\231n?@\234Á7@"
        errmsg = 0x0
#9  0x08067a53 in ap_walk_config_sub (current=0x80d5808,
parms=0xbffffc30, section_vector=0x80b3488) at config.c:1082
        dir_config = (void *) 0x4040d154
        retval = 0x4040d154 "\231n?@\234Á7@"
        cmd = (command_rec *) 0x8088bec
        current = (ap_directive_t *) 0x80d5808
        parms = (cmd_parms *) 0xbffffc30
        mod = (module *) 0x808ed60
#10 0x08067ad1 in ap_walk_config (current=0x80b49d0, parms=0xbffffc30,
section_vector=0x80b3488) at config.c:1121
        errmsg = 0x0
        current = (ap_directive_t *) 0x80d5808
        parms = (cmd_parms *) 0xbffffc30
        oldconfig = (ap_conf_vector_t *) 0x0
#11 0x080684e0 in ap_process_config_tree (s=0x80b2ec8,
conftree=0x80b49d0, p=0x8098d10, ptemp=0x80c4dc0) at config.c:1583
        s = (server_rec *) 0x4040d154
        p = (apr_pool_t *) 0x8098d10
        ptemp = (apr_pool_t *) 0x0
        errmsg = 0x808defc ""
        parms = {info = 0x0, override = 95, limited = -1,
limited_xmethods = 0x0, xlimited = 0x0, config_file = 0x0, directive =
0x80d5928, pool = 0x8098d10, 
  temp_pool = 0x80c4dc0, server = 0x80b2ec8, path = 0x80e07c8
"/var/www/publisher/", cmd = 0x4040d154, context = 0x80e05f0,
err_directive = 0x0}
#12 0x0806a811 in main (argc=2, argv=0xbffffd44) at main.c:564
        c = 116 't'
        configtestonly = 1
        confname = 0x8086518 "conf/httpd.conf"
        def_server_root = 0x8086528 "/usr/apache2"
        temp_error_log = 0x0
        process = (process_rec *) 0x8096d88
        server_conf = (server_rec *) 0x80b2ec8
        pglobal = (apr_pool_t *) 0x8096d08
        pconf = (apr_pool_t *) 0x8098d10
        plog = (apr_pool_t *) 0x80c2db8
        ptemp = (apr_pool_t *) 0x80c4dc0
        pcommands = (apr_pool_t *) 0x80c0db0
        opt = (apr_getopt_t *) 0x80c0e48
        rv = 0
        mod = (module **) 0x80b2ec8
        optarg = 0x0
        signal_server = (apr_OFN_ap_signal_server_t *) 0x4040d154
<python_commands+264>
#13 0x40189571 in __libc_start_main (main=0x806a370 <main>, argc=2,
ubp_av=0xbffffd44, init=0x805b824 <_init>, fini=0x80812e0 <_fini>,
rtld_fini=0x4000aa24 <_dl_fini>, 
    stack_end=0xbffffd3c) at ../sysdeps/generic/libc-start.c:129
        ubp_av = (char **) 0xbffffd44
        fini = (void (*)()) 0x400154ac <_dl_debug_mask>
        rtld_fini = (void (*)()) 0x80e0e28
        ubp_ev = (char **) 0x0


-- 
Robin Munn
rmunn@pobox.com
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20021008/e6c4c75b/attachment-0002.bin
From neel at mediapulse.com  Tue Oct  8 16:33:19 2002
From: neel at mediapulse.com (Michael C. Neel)
Date: Fri Jan  9 21:59:42 2004
Subject: [mod_python] Segfault when using PythonImport directive
Message-ID: <C0FC22C08B82074A88B50061764157775BC2@johnson.mediapulse.net>

Not addressing the segfault, couldn't you handle globals in the python
program itself?  I do this for database handles my self:

from mod_python import apache
import MySQLdb

db = MySQLdb.connect("yada yada")

def handler(req):
	do cool db stuff with req here

I do this often, and I've checked that each request doesn't generate a
db connection by watching the MySQL number of connects.  One thing to
keep in mind is that a db handle may go stale if not used by some
databases, so be sure to add some code to test out the db handle each
request and reconnect if needed.  The DB API 2.0 spec doesn't define a
ping method like perl's DBI does, so I usually add one myself for this.

Mike

--
Michael C. Neel
Director of Software Development
Mediapulse, Inc.
 

-----Original Message-----
From: rmunn@pobox.com [mailto:rmunn@pobox.com] 
Sent: Tuesday, October 08, 2002 1:35 PM
To: mod_python@modpython.org
Subject: [mod_python] Segfault when using PythonImport directive


I'm using mod_python 3.0.0 BETA 2 with Apache 2.0.42 and encountering a
segfault every time I try to use the PythonInclude directive. The
segfault occurs even when I try to have Apache do a configuration syntax
check (/usr/apache2/bin/apachectl configtest). I've narrowed it down to
a single PythonInclude line. This is the <Directory> directive in which
the PythonInclude directive appears:


<Directory /var/www/publisher>
    AddHandler python-program .py
    PythonHandler mod_python.publisher
    PythonInterpPerDirective On
    PythonImport globals
</Directory>


If I comment out the "PythonImport globals" line, everything runs fine.

Here's the contents of my /var/www/publisher directory:


rmunn@localhost:/var/www/publisher$ ls -l
total 8
-rw-r--r--    1 rmunn    users          12 Oct  7 19:22 globals.py
-rw-r--r--    1 rmunn    users         133 Oct  8 12:26 tryme.py
rmunn@localhost:/var/www/publisher$ cat globals.py 
foo = 'bar'
rmunn@localhost:/var/www/publisher$ cat tryme.py 
def show(req, name):
    try:
        return str(globals.foo)
    except AttributeError, NameError:
        return str(dir(globals))


As you can see, what I'm trying to do is have some global variables
pre-defined in my mod_python scripts; I plan on using this to accomplish
expensive operations (like opening database connections) once per apache
process child instead of once per request.

Here's the gdb backtrace of my segfault. I'm running httpd -t to only
get a configuration syntax check and it's still failing. Any ideas?


root@localhost:/usr/apache2/conf# gdb ../bin/httpd 
GNU gdb 5.2.1
Copyright 2002 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you
are
welcome to change it and/or distribute copies of it under certain
conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for
details.
This GDB was configured as "i686-pc-linux-gnu"...
(gdb) run -t
Starting program: /usr/apache2/bin/httpd -t
[New Thread 1024 (LWP 29765)]

Program received signal SIGSEGV, Segmentation fault.
[Switching to Thread 1024 (LWP 29765)]
__pthread_mutex_lock (mutex=0x10) at mutex.c:99
99      mutex.c: No such file or directory.
        in mutex.c
(gdb) backtrace full
#0  __pthread_mutex_lock (mutex=0x10) at mutex.c:99
        mutex = (pthread_mutex_t *) 0x10
        self = 0x0
#1  0x403d8f43 in PyThread_acquire_lock (lock=0x0, waitflag=1) at
Python/thread_pthread.h:359
        lock = 0x0
        success = 1078103364
        status = 0
        error = 0
#2  0x403bbb4e in PyEval_AcquireLock () at Python/ceval.c:267
No locals.
#3  0x4037c1b3 in directive_PythonImport (cmd=0xbffffc30,
mconfig=0x80e0958, module=0x80e0e28 "globals") at mod_python.c:1220
        cmd = (cmd_parms *) 0x0
        mconfig = (void *) 0x0
        module = 0x0
#4  0x08067349 in invoke_cmd (cmd=0x4040d154, parms=0xbffffc30,
mconfig=0x80e0958, args=0x80d594f "") at config.c:800
        w = 0x80e0e28 "globals"
        w2 = 0xbffffc30 ""
        w3 = 0x4040d154 "\231n?@\234?7@"
        errmsg = 0x0
#5  0x08067a53 in ap_walk_config_sub (current=0x80d5928,
parms=0xbffffc30, section_vector=0x80e05f0) at config.c:1082
        dir_config = (void *) 0x4040d154
        retval = 0x4040d154 "\231n?@\234?7@"
        cmd = (command_rec *) 0x4040d154
        current = (ap_directive_t *) 0x80d5928
        parms = (cmd_parms *) 0xbffffc30
        mod = (module *) 0x4040d2e0
#6  0x08067ad1 in ap_walk_config (current=0x80d5850, parms=0xbffffc30,
section_vector=0x80e05f0) at config.c:1121
        errmsg = 0x0
        current = (ap_directive_t *) 0x80d5928
        parms = (cmd_parms *) 0xbffffc30
        oldconfig = (ap_conf_vector_t *) 0x80b3488
#7  0x08074beb in dirsection (cmd=0xbffffc30, mconfig=0x80b3598,
arg=0x80e0792 "") at core.c:1625
        cmd = (cmd_parms *) 0xbffffc30
        errmsg = 0x0
        endp = 0x80e07e0 ""
        old_overrides = 150
        old_path = 0x0
        conf = (core_dir_config *) 0x80e07e0
        new_dir_conf = (ap_conf_vector_t *) 0x80e05f0
        r = (regex_t *) 0x0
        thiscmd = (command_rec *) 0x8088bec
        err = 0x0
#8  0x08066e6e in invoke_cmd (cmd=0x8088bec, parms=0xbffffc30,
mconfig=0x80b3598, args=0x80d5828 "/var/www/publisher>") at config.c:713
        w = 0x80d5808 "?W\r\b(X\r\b"
        w2 = 0xbffffc30 ""
        w3 = 0x4040d154 "\231n?@\234?7@"
        errmsg = 0x0
#9  0x08067a53 in ap_walk_config_sub (current=0x80d5808,
parms=0xbffffc30, section_vector=0x80b3488) at config.c:1082
        dir_config = (void *) 0x4040d154
        retval = 0x4040d154 "\231n?@\234?7@"
        cmd = (command_rec *) 0x8088bec
        current = (ap_directive_t *) 0x80d5808
        parms = (cmd_parms *) 0xbffffc30
        mod = (module *) 0x808ed60
#10 0x08067ad1 in ap_walk_config (current=0x80b49d0, parms=0xbffffc30,
section_vector=0x80b3488) at config.c:1121
        errmsg = 0x0
        current = (ap_directive_t *) 0x80d5808
        parms = (cmd_parms *) 0xbffffc30
        oldconfig = (ap_conf_vector_t *) 0x0
#11 0x080684e0 in ap_process_config_tree (s=0x80b2ec8,
conftree=0x80b49d0, p=0x8098d10, ptemp=0x80c4dc0) at config.c:1583
        s = (server_rec *) 0x4040d154
        p = (apr_pool_t *) 0x8098d10
        ptemp = (apr_pool_t *) 0x0
        errmsg = 0x808defc ""
        parms = {info = 0x0, override = 95, limited = -1,
limited_xmethods = 0x0, xlimited = 0x0, config_file = 0x0, directive =
0x80d5928, pool = 0x8098d10, 
  temp_pool = 0x80c4dc0, server = 0x80b2ec8, path = 0x80e07c8
"/var/www/publisher/", cmd = 0x4040d154, context = 0x80e05f0,
err_directive = 0x0}
#12 0x0806a811 in main (argc=2, argv=0xbffffd44) at main.c:564
        c = 116 't'
        configtestonly = 1
        confname = 0x8086518 "conf/httpd.conf"
        def_server_root = 0x8086528 "/usr/apache2"
        temp_error_log = 0x0
        process = (process_rec *) 0x8096d88
        server_conf = (server_rec *) 0x80b2ec8
        pglobal = (apr_pool_t *) 0x8096d08
        pconf = (apr_pool_t *) 0x8098d10
        plog = (apr_pool_t *) 0x80c2db8
        ptemp = (apr_pool_t *) 0x80c4dc0
        pcommands = (apr_pool_t *) 0x80c0db0
        opt = (apr_getopt_t *) 0x80c0e48
        rv = 0
        mod = (module **) 0x80b2ec8
        optarg = 0x0
        signal_server = (apr_OFN_ap_signal_server_t *) 0x4040d154
<python_commands+264>
#13 0x40189571 in __libc_start_main (main=0x806a370 <main>, argc=2,
ubp_av=0xbffffd44, init=0x805b824 <_init>, fini=0x80812e0 <_fini>,
rtld_fini=0x4000aa24 <_dl_fini>, 
    stack_end=0xbffffd3c) at ../sysdeps/generic/libc-start.c:129
        ubp_av = (char **) 0xbffffd44
        fini = (void (*)()) 0x400154ac <_dl_debug_mask>
        rtld_fini = (void (*)()) 0x80e0e28
        ubp_ev = (char **) 0x0


-- 
Robin Munn
rmunn@pobox.com


From jack_diederich at email.com  Tue Oct  8 16:03:52 2002
From: jack_diederich at email.com (Jack Diederich)
Date: Fri Jan  9 21:59:42 2004
Subject: [mod_python] Segfault when using PythonImport directive
Message-ID: <20021008210352.6095.qmail@email.com>

Cut N Pasted from a python-dev@httpd.apache.org email last month
since I don't know where an archive would be.

I was talking about mod_python 2.x with apahce 1.x 
But I would be willing to guess it is the same problem.

-jack



you can never garuntee that python_init() will be called only once.
All memory allocated from the original pool is freed before the next
call to python_init()
just having the single python_imports table seems to avoid this for
some reason, but it isn't garunteed (I don't want to know what
happens on USR1).

we need a cleanup func that just resets the python_imports state
between calls to python_init()

/* This func can go anywhere above directive_PythonImports */
void cleanup_python_imports(void *data)
{
  python_imports = NULL;
}
/* This line needs to go in directive_PythonImports in the if block
where we call ap_make_table */
ap_register_cleanup(cmd->pool, NULL,
cleanup_python_imports, ap_null_cleanup);


The end result is that we remake the table if python_init() is called
more than once.  This is OK because the configuration is also reread.
 We don't have to worry about the global 'interpreters' variable
because it is allocated by Python outside of apache's memory
management, but we might have a small memory leak if we get USR1'd
over and over again because it is never Py_DECREF'd in
python_finalize.  On the other hand, Py_Finalize() is probably smart
enough to take of that for us.
----- Original Message -----
From: "Michael C. Neel" <neel@mediapulse.com>
Date: Tue, 8 Oct 2002 16:33:19 -0400 
To: <rmunn@pobox.com>, <mod_python@modpython.org>
Subject: RE: [mod_python] Segfault when using PythonImport directive


> Not addressing the segfault, couldn't you handle globals in the python
> program itself?  I do this for database handles my self:
> 
> from mod_python import apache
> import MySQLdb
> 
> db = MySQLdb.connect("yada yada")
> 
> def handler(req):
> 	do cool db stuff with req here
> 
> I do this often, and I've checked that each request doesn't generate a
> db connection by watching the MySQL number of connects.  One thing to
> keep in mind is that a db handle may go stale if not used by some
> databases, so be sure to add some code to test out the db handle each
> request and reconnect if needed.  The DB API 2.0 spec doesn't define a
> ping method like perl's DBI does, so I usually add one myself for this.
> 
> Mike
> 
> --
> Michael C. Neel
> Director of Software Development
> Mediapulse, Inc.
>  
> 
> -----Original Message-----
> From: rmunn@pobox.com [mailto:rmunn@pobox.com] 
> Sent: Tuesday, October 08, 2002 1:35 PM
> To: mod_python@modpython.org
> Subject: [mod_python] Segfault when using PythonImport directive
> 
> 
> I'm using mod_python 3.0.0 BETA 2 with Apache 2.0.42 and encountering a
> segfault every time I try to use the PythonInclude directive. The
> segfault occurs even when I try to have Apache do a configuration syntax
> check (/usr/apache2/bin/apachectl configtest). I've narrowed it down to
> a single PythonInclude line. This is the <Directory> directive in which
> the PythonInclude directive appears:
> 
> 
> <Directory /var/www/publisher>
>     AddHandler python-program .py
>     PythonHandler mod_python.publisher
>     PythonInterpPerDirective On
>     PythonImport globals
> </Directory>
> 
> 
> If I comment out the "PythonImport globals" line, everything runs fine.
> 
> Here's the contents of my /var/www/publisher directory:
> 
> 
> rmunn@localhost:/var/www/publisher$ ls -l
> total 8
> -rw-r--r--    1 rmunn    users          12 Oct  7 19:22 globals.py
> -rw-r--r--    1 rmunn    users         133 Oct  8 12:26 tryme.py
> rmunn@localhost:/var/www/publisher$ cat globals.py 
> foo = 'bar'
> rmunn@localhost:/var/www/publisher$ cat tryme.py 
> def show(req, name):
>     try:
>         return str(globals.foo)
>     except AttributeError, NameError:
>         return str(dir(globals))
> 
> 
> As you can see, what I'm trying to do is have some global variables
> pre-defined in my mod_python scripts; I plan on using this to accomplish
> expensive operations (like opening database connections) once per apache
> process child instead of once per request.
> 
> Here's the gdb backtrace of my segfault. I'm running httpd -t to only
> get a configuration syntax check and it's still failing. Any ideas?
> 
> 
> root@localhost:/usr/apache2/conf# gdb ../bin/httpd 
> GNU gdb 5.2.1
> Copyright 2002 Free Software Foundation, Inc.
> GDB is free software, covered by the GNU General Public License, and you
> are
> welcome to change it and/or distribute copies of it under certain
> conditions.
> Type "show copying" to see the conditions.
> There is absolutely no warranty for GDB.  Type "show warranty" for
> details.
> This GDB was configured as "i686-pc-linux-gnu"...
> (gdb) run -t
> Starting program: /usr/apache2/bin/httpd -t
> [New Thread 1024 (LWP 29765)]
> 
> Program received signal SIGSEGV, Segmentation fault.
> [Switching to Thread 1024 (LWP 29765)]
> __pthread_mutex_lock (mutex=0x10) at mutex.c:99
> 99      mutex.c: No such file or directory.
>         in mutex.c
> (gdb) backtrace full
> #0  __pthread_mutex_lock (mutex=0x10) at mutex.c:99
>         mutex = (pthread_mutex_t *) 0x10
>         self = 0x0
> #1  0x403d8f43 in PyThread_acquire_lock (lock=0x0, waitflag=1) at
> Python/thread_pthread.h:359
>         lock = 0x0
>         success = 1078103364
>         status = 0
>         error = 0
> #2  0x403bbb4e in PyEval_AcquireLock () at Python/ceval.c:267
> No locals.
> #3  0x4037c1b3 in directive_PythonImport (cmd=0xbffffc30,
> mconfig=0x80e0958, module=0x80e0e28 "globals") at mod_python.c:1220
>         cmd = (cmd_parms *) 0x0
>         mconfig = (void *) 0x0
>         module = 0x0
> #4  0x08067349 in invoke_cmd (cmd=0x4040d154, parms=0xbffffc30,
> mconfig=0x80e0958, args=0x80d594f "") at config.c:800
>         w = 0x80e0e28 "globals"
>         w2 = 0xbffffc30 ""
>         w3 = 0x4040d154 "\231n?@\234?7@"
>         errmsg = 0x0
> #5  0x08067a53 in ap_walk_config_sub (current=0x80d5928,
> parms=0xbffffc30, section_vector=0x80e05f0) at config.c:1082
>         dir_config = (void *) 0x4040d154
>         retval = 0x4040d154 "\231n?@\234?7@"
>         cmd = (command_rec *) 0x4040d154
>         current = (ap_directive_t *) 0x80d5928
>         parms = (cmd_parms *) 0xbffffc30
>         mod = (module *) 0x4040d2e0
> #6  0x08067ad1 in ap_walk_config (current=0x80d5850, parms=0xbffffc30,
> section_vector=0x80e05f0) at config.c:1121
>         errmsg = 0x0
>         current = (ap_directive_t *) 0x80d5928
>         parms = (cmd_parms *) 0xbffffc30
>         oldconfig = (ap_conf_vector_t *) 0x80b3488
> #7  0x08074beb in dirsection (cmd=0xbffffc30, mconfig=0x80b3598,
> arg=0x80e0792 "") at core.c:1625
>         cmd = (cmd_parms *) 0xbffffc30
>         errmsg = 0x0
>         endp = 0x80e07e0 ""
>         old_overrides = 150
>         old_path = 0x0
>         conf = (core_dir_config *) 0x80e07e0
>         new_dir_conf = (ap_conf_vector_t *) 0x80e05f0
>         r = (regex_t *) 0x0
>         thiscmd = (command_rec *) 0x8088bec
>         err = 0x0
> #8  0x08066e6e in invoke_cmd (cmd=0x8088bec, parms=0xbffffc30,
> mconfig=0x80b3598, args=0x80d5828 "/var/www/publisher>") at config.c:713
>         w = 0x80d5808 "?W\r\b(X\r\b"
>         w2 = 0xbffffc30 ""
>         w3 = 0x4040d154 "\231n?@\234?7@"
>         errmsg = 0x0
> #9  0x08067a53 in ap_walk_config_sub (current=0x80d5808,
> parms=0xbffffc30, section_vector=0x80b3488) at config.c:1082
>         dir_config = (void *) 0x4040d154
>         retval = 0x4040d154 "\231n?@\234?7@"
>         cmd = (command_rec *) 0x8088bec
>         current = (ap_directive_t *) 0x80d5808
>         parms = (cmd_parms *) 0xbffffc30
>         mod = (module *) 0x808ed60
> #10 0x08067ad1 in ap_walk_config (current=0x80b49d0, parms=0xbffffc30,
> section_vector=0x80b3488) at config.c:1121
>         errmsg = 0x0
>         current = (ap_directive_t *) 0x80d5808
>         parms = (cmd_parms *) 0xbffffc30
>         oldconfig = (ap_conf_vector_t *) 0x0
> #11 0x080684e0 in ap_process_config_tree (s=0x80b2ec8,
> conftree=0x80b49d0, p=0x8098d10, ptemp=0x80c4dc0) at config.c:1583
>         s = (server_rec *) 0x4040d154
>         p = (apr_pool_t *) 0x8098d10
>         ptemp = (apr_pool_t *) 0x0
>         errmsg = 0x808defc ""
>         parms = {info = 0x0, override = 95, limited = -1,
> limited_xmethods = 0x0, xlimited = 0x0, config_file = 0x0, directive =
> 0x80d5928, pool = 0x8098d10, 
>   temp_pool = 0x80c4dc0, server = 0x80b2ec8, path = 0x80e07c8
> "/var/www/publisher/", cmd = 0x4040d154, context = 0x80e05f0,
> err_directive = 0x0}
> #12 0x0806a811 in main (argc=2, argv=0xbffffd44) at main.c:564
>         c = 116 't'
>         configtestonly = 1
>         confname = 0x8086518 "conf/httpd.conf"
>         def_server_root = 0x8086528 "/usr/apache2"
>         temp_error_log = 0x0
>         process = (process_rec *) 0x8096d88
>         server_conf = (server_rec *) 0x80b2ec8
>         pglobal = (apr_pool_t *) 0x8096d08
>         pconf = (apr_pool_t *) 0x8098d10
>         plog = (apr_pool_t *) 0x80c2db8
>         ptemp = (apr_pool_t *) 0x80c4dc0
>         pcommands = (apr_pool_t *) 0x80c0db0
>         opt = (apr_getopt_t *) 0x80c0e48
>         rv = 0
>         mod = (module **) 0x80b2ec8
>         optarg = 0x0
>         signal_server = (apr_OFN_ap_signal_server_t *) 0x4040d154
> <python_commands+264>
> #13 0x40189571 in __libc_start_main (main=0x806a370 <main>, argc=2,
> ubp_av=0xbffffd44, init=0x805b824 <_init>, fini=0x80812e0 <_fini>,
> rtld_fini=0x4000aa24 <_dl_fini>, 
>     stack_end=0xbffffd3c) at ../sysdeps/generic/libc-start.c:129
>         ubp_av = (char **) 0xbffffd44
>         fini = (void (*)()) 0x400154ac <_dl_debug_mask>
>         rtld_fini = (void (*)()) 0x80e0e28
>         ubp_ev = (char **) 0x0
> 
> 
> -- 
> Robin Munn
> rmunn@pobox.com
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 
> 

-- 
__________________________________________________________
Sign-up for your own FREE Personalized E-mail at Mail.com
http://www.mail.com/?sr=signup


"Free price comparison tool gives you the best prices and cash back!"
http://www.bestbuyfinder.com/download.htm


From grisha at modpython.org  Sat Oct 12 16:08:37 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:59:42 2004
Subject: [mod_python] Segfaults... segfaults...
In-Reply-To: <19513182194.20021006182552@https.ru>
Message-ID: <Pine.BSF.4.32.0210121602380.17605-100000@eden.ispol.com>

I traced this to a bug in mod_negotiation.c - it didn't like r->fileinfo
being null, I submitted a patch for it, so hopefully it will be fixed in
next release of httpd.

Grisha

On Sun, 6 Oct 2002, Neo wrote:

>
>   Hi all !
>
>   I was just playing with mod_python 3 & Apache 2.0.42
> (RedHat Linux 7.2). Below are my "mptest.py" file, Apache VH config
> and the resuts of the single request:
>
> GET /mptest.py
>
>
> ----------------BEGIN----------------
> from mod_python import apache
>
>
> interp = None
>
> def transhandler(req):
>     interp = req.interpreter
>     return apache.OK
>
> def handler(req):
>     req.write(repr(interp))
>     return apache.OK
> -----------------END-----------------
>
> Config for virtual host:
> ----------------BEGIN----------------
> <VirtualHost *>
> [... skipped ...]
>
>     PythonPath    "..."
>
>     PythonDebug On
>     PythonTransHandler mptest
>     SetHandler python-program
>     PythonHandler mptest
>
>     <Directory "/home/w-https/test-www">
>         Options Indexes FollowSymLinks
>         AllowOverride None
>
>         Order allow,deny
>         Allow from all
>
>         DirectoryIndex index.html index.htm index.html.var
>
>         AddDefaultCharset UTF-8
>     </Directory>
>
> [... skipped ...]
> </VirtualHost>
> -----------------END-----------------
>
> Apache virtualhost log file:
> ----------------BEGIN----------------
> [Sun Oct 06 18:02:44 2002] [info] [client 212.188.98.243] Module bug?
> Request filename is missing for URI /mptest.py
> -----------------END-----------------
>
> *** I guess "transhandler" in the above example should somehow set
>     filename for incoming request for Apache to be happy? But SEGFAULT
>     is not the best action to report the error :)
>
> Apache main server log file:
> ----------------BEGIN----------------
> [Sun Oct 06 18:02:45 2002] [notice] child pid 12331 exit signal
> Segmentation fault (11)
> -----------------END-----------------
>
>
> ---
> Neo Eureka / mailto:neo@https.ru
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From grisha at ispol.com  Tue Oct 15 13:49:40 2002
From: grisha at ispol.com (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:59:42 2004
Subject: [mod_python] test
Message-ID: <Pine.BSF.4.32.0210151349280.72568-100000@eden.ispol.com>

ignore


From grisha at modpython.org  Tue Oct 15 13:51:38 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:59:42 2004
Subject: [mod_python] BETA 3
Message-ID: <Pine.BSF.4.32.0210151351150.72568-100000@eden.ispol.com>

BETA3 of MP 3 is available for download from
http://www.apache.org/dist/httpd/modpython/

This release features numerous fixes to problems reported on this and the
dev lists, has been tested on linux, solaris, freebsd and windows, and
even includes an example of a gzip filter.

There is also a windows DLL (actually it's a .so file, following the
Apache convention) in that same directory.

Grisha



From derrick.beery at itd.state.ia.us  Tue Oct 15 14:17:56 2002
From: derrick.beery at itd.state.ia.us (Derrick Beery)
Date: Fri Jan  9 21:59:42 2004
Subject: [mod_python] aix, apxs and apache problem
Message-ID: <00B8F67D177CD411BF7200508B6090FD046BB9FD@its-cn-exchange.its.state.ia.us>

Hello,

I am new to Python and interested in capabilities as a web language. I have
downloaded the source for mod_python-2.7.8. I am attempting to configure it
statically or as a DSO, thus far without complete success. The host is an
RS6000 running AIX 4.3.3 and the web server is Apache 1.3.27.

Using gcc version 2.95.3 20010315 (release)

Python was:

./configure --without-threads --with-gcc

Apache:

./configure --with-layout=custom --enable-module=most --enable-module=so

For mod_python I do:

./configure --with-apache=../apache_1.3.27 --with-apxs=/apache/bin/apxs
--with-python=/usr/local/src/Python-2.2.1

No errors. Well, I did have to link to the Makefile:

cd /usr/local/src/Python-2.2.1/Modules
ln -s /usr/local/src/Python-2.2.1/Makefile Makefile

After that, there were no errors following configure.

I then do:

make dso

There were errors until I I added
-bE:/usr/local/src/Python-2.2.1/Modules/python.exp to apxs script:

my $CFG_LDFLAGS_SHLIB = q(-H512 -T512 -bhalt:4 -bM:SRE -bnoentry
-bI:/apache2/libexec/httpd.exp -bE:/apache2/libexec/httpd.exp
-bE:/usr/local/src/Python-2.2.1/Modules/python.exp -lld -lc); # substituted
via Makefile.tmpl

Then no errors, so I do:

make install (as root)

no errors!

Added the following to DSO section of httpd.conf:

LoadModule python_module libexec/mod_python.so

I then attempt to restart httpd:

/apache/bin/apachectl start

This is what I get:

apachectl restart
/apache2/bin/apachectl restart: configuration broken, ignoring restart
/apache2/bin/apachectl restart: (run 'apachectl configtest' for details)
apachectl configtest
Syntax error on line 205 of /apache/conf/httpd.conf:
Can't locate API module structure `python_module' in file
/apache2/libexec/mod_python.so: Function not implemented (python_module)

When I tried statically, apache builds httpd with Python but If I try to add
PHP I get a TOC size error. Apache and just PHP builds and works great. I
did not test Python only version because even if it worked, I cannot use.

Any advice here would be greatly appreciated.

Derrick

From mort at bork.org  Tue Oct 15 16:31:12 2002
From: mort at bork.org (Martin Hicks)
Date: Fri Jan  9 21:59:42 2004
Subject: [mod_python] Sending args to the python script
Message-ID: <20021015203112.GC28708@bork.org>


Hello,

I want to be able to send args to the script through a src URL.  

e.g.,:

<frame ...  src="script/function?arg=blah&name=hoho">

but this doesn't seem to work.  I'm using the Publisher Handler
and mod_python 2.7.8 on debian-sid.

TIA
mh

-- 
Martin Hicks  ||  mort@bork.org  || PGP/GnuPG: 0x4C7F2BEE
plato up 13 days, 22:28, 13 users,  load average: 0.21, 0.07, 0.02
Great Spirits have always encountered opposition from mediocre minds
						-Albert Einstein
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20021015/063544c1/attachment-0002.bin
From grisha at modpython.org  Tue Oct 15 17:48:20 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:59:42 2004
Subject: [mod_python] Sending args to the python script
In-Reply-To: <20021015203112.GC28708@bork.org>
Message-ID: <Pine.BSF.4.32.0210151746470.72568-100000@eden.ispol.com>

It should work. See if you have a req.form variable, and try raising it
with PythonDebug On to see what's in it, e.g.:

def function(req):

	raise `req.form`


On Tue, 15 Oct 2002, Martin Hicks wrote:

>
> Hello,
>
> I want to be able to send args to the script through a src URL.
>
> e.g.,:
>
> <frame ...  src="script/function?arg=blah&name=hoho">
>
> but this doesn't seem to work.  I'm using the Publisher Handler
> and mod_python 2.7.8 on debian-sid.
>
> TIA
> mh
>
> --
> Martin Hicks  ||  mort@bork.org  || PGP/GnuPG: 0x4C7F2BEE
> plato up 13 days, 22:28, 13 users,  load average: 0.21, 0.07, 0.02
> Great Spirits have always encountered opposition from mediocre minds
> 						-Albert Einstein
>


From mort at bork.org  Tue Oct 15 18:09:49 2002
From: mort at bork.org (Martin Hicks)
Date: Fri Jan  9 21:59:42 2004
Subject: [mod_python] Sending args to the python script
In-Reply-To: <Pine.BSF.4.32.0210151746470.72568-100000@eden.ispol.com>
References: <20021015203112.GC28708@bork.org> <Pine.BSF.4.32.0210151746470.72568-100000@eden.ispol.com>
Message-ID: <20021015220949.GE28708@bork.org>

On Tue, Oct 15, 2002 at 05:48:20PM -0400, Gregory (Grisha) Trubetskoy wrote:
>
> It should work. See if you have a req.form variable, and try raising it
> with PythonDebug On to see what's in it, e.g.:
> 
> def function(req):
> 
> 	raise `req.form`

Merci, merci.

I didn't know they came in through req.form.

thanks again,
mh

-- 
Martin Hicks  ||  mort@bork.org  || PGP/GnuPG: 0x4C7F2BEE
plato up 14 days, 8 min, 13 users,  load average: 0.38, 0.21, 0.08
Great Spirits have always encountered opposition from mediocre minds
						-Albert Einstein
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20021015/371c76d9/attachment-0002.bin
From jack_diederich at email.com  Wed Oct 16 23:01:12 2002
From: jack_diederich at email.com (Jack Diederich)
Date: Fri Jan  9 21:59:42 2004
Subject: [mod_python] Apache compile HOWTO
Message-ID: <20021017040112.30584.qmail@email.com>

I saw this on freshmeat,
http://freshmeat.net/releases/100481/

and the homepage is here
http://www.delouw.ch/linux/apache.phtml

It is a HOWTO project that includes mod_perl, mod_php and others,
but as yet doesn't include mod_python.

If anyone would submit a writeup for mod_python
it would be good advocacy.

-jackdied
-- 
__________________________________________________________
Sign-up for your own FREE Personalized E-mail at Mail.com
http://www.mail.com/?sr=signup


From vmanera at manord.com  Thu Oct 17 18:40:17 2002
From: vmanera at manord.com (Manera, Villiam)
Date: Fri Jan  9 21:59:42 2004
Subject: [mod_python] strange behavior of mod-python
Message-ID: <52DC70C1C1575C418CB033523A29CF14104870@exchange2000.manord.com>

I'm currently use mod-python 2.7.6 on apache 1.3.26 - windows 2000 with
python 2.2
apache config:
.....
    ScriptAlias /comm/ "E:/script/cgi/comm/"
    ScriptAlias /tecnico/ "E:/script/cgi/tecnico/"
....
<Directory "E:/script/cgi/comm">
        Order Deny,Allow
        Deny from all
        Allow from .....
       ...
    	AddHandler python-program .py
    	PythonHandler mod_python.publisher
	PythonPath "sys.path+['c:/program
files/python22/lib/site-packages/mdnlib', 'c:/program
files/python22/lib/site-packages/HTMLgen','E:/script/cgi/comm']"
    	PythonDebug on
    </Directory>

----------------------------------------------------
all work fine, but sometimes (today 4 time) when a url is typed:
http://sviluppo.manord.com/comm/comm_ocordiu0.py/main?....

I have this behavior from apache:
HTTP 404 - File non trovato (not found)
Internet Explorer 
but the program is still in place, and the only way to force apache to found
the program is restart the apache services,
or make a copy of comm_ocordiu0 in comm_ocordiu1 and then call this one,
but....



this is not a real problem in developement web server, but  today it
happened 4 time, in production is happened 2 time in one month,
and I become in panic.

Any advice here would be greatly appreciated.

Villiam 

From francoislepoutre at compuserve.com  Fri Oct 18 11:37:16 2002
From: francoislepoutre at compuserve.com (=?iso-8859-1?Q?Fran=E7ois_Lepoutre?=)
Date: Fri Jan  9 21:59:43 2004
Subject: [mod_python] strange behavior of mod-python
Message-ID: <01c27689$f23a4f60$LocalHost@seriatim1>

>I use a class for handle a pool of connection to the data base that became
>persistent after the first call,
>and all the progrma that need a connection to the db have to pass through
>this class.

Same for me. Most odbc drivers are not fully threadsafe.

>But why only une program fall in this problem?
>In what way may I check if different trading are competing (my application
>doesn't call
>expressly any thread, mod python do it for me? I don't use multiple
>interpretes)


It all happens under stress only ...

-on apache linux ... when under stress apache forks as many
 interpreters as needed. Each intepreters handle the calls
 in an organised queue.

No race conditions here. Simple !

- on apache win32 ... when under strees apache win32 calls
for a nex thread. EACH THREAD may access all
your persistent python objects.

You need to put code to protect your data under stress.

>The way apache works on
>Anyway if this may be one problem I will start today to move from apache
>1.3.26 to apache 2.0.43
>with mod-python beta 3 (different management of threading), in order to
>check this problem.

I am quite new here. not tested the beta.

I have not tested that. No time at the moment.
Could you keep me informed on the all thing.

I have to maintain two version of our code.

One for linux, simple. The other one for nt/2K
that cares for concurrency.

The truth .. ain't log or complex but that's
extra code anyway.

Can i have one version only on apache 2
with both threading and forking activated ?

>I've to stay on nt/2000 because the odbc driver for my database it is not
>available on linux

Using a multiplatform db with support of both
win32 and *nix is great. We use ASA.
Great on win32. Runs on *nix.

>Thanks for your interest

mod_python is a great product.. worth digging thru.
You're welcome.

Francois

a win32 geek moving multiplatform
thru python/mod_python


-----Messaggio originale-----
Da: Fran?ois Lepoutre [mailto:francoislepoutre@compuserve.com]
Inviato: gioved? 17 ottobre 2002 23.26
A: Manera, Villiam
Oggetto: Re: [mod_python] strange behavior of mod-python


HI,

I love python and like mod_python a lot...
but have had trouble with the mod_python
programming model on nt/2000 because
of threading.

Do you keep db handle or python shared
data structure persistent in the python
interpreter?

If you do, have you made sure that
distinct thread are competing
for the same resource?

Just my two cents...


-----Original Message-----
From: Manera, Villiam <vmanera@manord.com>
To: 'mod_python@modpython.org' <mod_python@modpython.org>
Date: 17 October 2002 19:13
Subject: [mod_python] strange behavior of mod-python


>
>I'm currently use mod-python 2.7.6 on apache 1.3.26 - windows 2000 with
>python 2.2
>apache config:
>.....
>    ScriptAlias /comm/ "E:/script/cgi/comm/"
>    ScriptAlias /tecnico/ "E:/script/cgi/tecnico/"
>....
><Directory "E:/script/cgi/comm">
>        Order Deny,Allow
>        Deny from all
>        Allow from .....
>       ...
>    AddHandler python-program .py
>    PythonHandler mod_python.publisher
> PythonPath "sys.path+['c:/program
>files/python22/lib/site-packages/mdnlib', 'c:/program
>files/python22/lib/site-packages/HTMLgen','E:/script/cgi/comm']"
>    PythonDebug on
>    </Directory>
>
>----------------------------------------------------
>all work fine, but sometimes (today 4 time) when a url is typed:
>http://sviluppo.manord.com/comm/comm_ocordiu0.py/main?....
>
>I have this behavior from apache:
>HTTP 404 - File non trovato (not found)
>Internet Explorer
>but the program is still in place, and the only way to force apache to
found
>the program is restart the apache services,
>or make a copy of comm_ocordiu0 in comm_ocordiu1 and then call this one,
>but....
>
>
>
>this is not a real problem in developement web server, but  today it
>happened 4 time, in production is happened 2 time in one month,
>and I become in panic.
>
>Any advice here would be greatly appreciated.
>
>Villiam
>_______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org
>http://www.modpython.org/mailman/listinfo/mod_python


From francoislepoutre at compuserve.com  Fri Oct 18 14:55:23 2002
From: francoislepoutre at compuserve.com (=?iso-8859-1?Q?Fran=E7ois_Lepoutre?=)
Date: Fri Jan  9 21:59:43 2004
Subject: [mod_python] strange behavior of mod-python
Message-ID: <01c276a5$9f40ca20$2758d3d4@seriatim1>

>I will inform you to apache 2...

Thank you

>VI've found your mail of
>www.modpython.org/pipermail/mod_python/2001-September/001647.html
>that concern this problem. May I try to put "ThreadPerChild" to 1 instead
of
>2 to 50 ?

>I not clearly understood  the problem to doing that: the pb vanishes... and
>performance as well. (pb?)


Yes exactly!

>otherwise have you some example of code to protect  data under stress? I
>don't have any idea to do so.

I am no expert (IT by experience not education).
But python is so simple. I used the following kind
of code (no guarantee on details but you will
get the idea clear).

# at module level (global)
# add this
import threading
my_data_lock =  threading.RLock()

# every time you update your global variables

global my_data_lock
my_data_lock.acquire()

# update your stuff here
# while other thread wait ....

# release the lock
my_data_lock.release

I am sure you could (and should) do it
in a cleaner object-oriented way.
But that solved the threading issue.

Francois
-----Messaggio originale-----
Da: Fran?ois Lepoutre [mailto:francoislepoutre@compuserve.com]
Inviato: venerd? 18 ottobre 2002 11.37
A: Manera, Villiam
Cc: mod_python@modpython.org
Oggetto: Re: [mod_python] strange behavior of mod-python


>I use a class for handle a pool of connection to the data base that became
>persistent after the first call,
>and all the progrma that need a connection to the db have to pass through
>this class.

Same for me. Most odbc drivers are not fully threadsafe.

>But why only une program fall in this problem?
>In what way may I check if different trading are competing (my application
>doesn't call
>expressly any thread, mod python do it for me? I don't use multiple
>interpretes)


It all happens under stress only ...

-on apache linux ... when under stress apache forks as many
interpreters as needed. Each intepreters handle the calls
in an organised queue.

No race conditions here. Simple !

- on apache win32 ... when under strees apache win32 calls
for a nex thread. EACH THREAD may access all
your persistent python objects.

You need to put code to protect your data under stress.

>The way apache works on
>Anyway if this may be one problem I will start today to move from apache
>1.3.26 to apache 2.0.43
>with mod-python beta 3 (different management of threading), in order to
>check this problem.

I am quite new here. not tested the beta.

I have not tested that. No time at the moment.
Could you keep me informed on the all thing.

I have to maintain two version of our code.

One for linux, simple. The other one for nt/2K
that cares for concurrency.

The truth .. ain't log or complex but that's
extra code anyway.

Can i have one version only on apache 2
with both threading and forking activated ?

>I've to stay on nt/2000 because the odbc driver for my database it is not
>available on linux

Using a multiplatform db with support of both
win32 and *nix is great. We use ASA.
Great on win32. Runs on *nix.

>Thanks for your interest

mod_python is a great product.. worth digging thru.
You're welcome.

Francois

a win32 geek moving multiplatform
thru python/mod_python


-----Messaggio originale-----
Da: Fran?ois Lepoutre [mailto:francoislepoutre@compuserve.com]
Inviato: gioved? 17 ottobre 2002 23.26
A: Manera, Villiam
Oggetto: Re: [mod_python] strange behavior of mod-python


HI,

I love python and like mod_python a lot...
but have had trouble with the mod_python
programming model on nt/2000 because
of threading.

Do you keep db handle or python shared
data structure persistent in the python
interpreter?

If you do, have you made sure that
distinct thread are competing
for the same resource?

Just my two cents...


-----Original Message-----
From: Manera, Villiam <vmanera@manord.com>
To: 'mod_python@modpython.org' <mod_python@modpython.org>
Date: 17 October 2002 19:13
Subject: [mod_python] strange behavior of mod-python


>
>I'm currently use mod-python 2.7.6 on apache 1.3.26 - windows 2000 with
>python 2.2
>apache config:
>.....
>    ScriptAlias /comm/ "E:/script/cgi/comm/"
>    ScriptAlias /tecnico/ "E:/script/cgi/tecnico/"
>....
><Directory "E:/script/cgi/comm">
>        Order Deny,Allow
>        Deny from all
>        Allow from .....
>       ...
>    AddHandler python-program .py
>    PythonHandler mod_python.publisher
> PythonPath "sys.path+['c:/program
>files/python22/lib/site-packages/mdnlib', 'c:/program
>files/python22/lib/site-packages/HTMLgen','E:/script/cgi/comm']"
>    PythonDebug on
>    </Directory>
>
>----------------------------------------------------
>all work fine, but sometimes (today 4 time) when a url is typed:
>http://sviluppo.manord.com/comm/comm_ocordiu0.py/main?....
>
>I have this behavior from apache:
>HTTP 404 - File non trovato (not found)
>Internet Explorer
>but the program is still in place, and the only way to force apache to
found
>the program is restart the apache services,
>or make a copy of comm_ocordiu0 in comm_ocordiu1 and then call this one,
>but....
>
>
>
>this is not a real problem in developement web server, but  today it
>happened 4 time, in production is happened 2 time in one month,
>and I become in panic.
>
>Any advice here would be greatly appreciated.
>
>Villiam
>_______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org
>http://www.modpython.org/mailman/listinfo/mod_python


From peter at hawkins.emu.id.au  Sat Oct 19 12:23:07 2002
From: peter at hawkins.emu.id.au (Peter Hawkins)
Date: Fri Jan  9 21:59:43 2004
Subject: [mod_python] Debian packages of mod_python 3.0.0 beta 3
Message-ID: <200210191223.11417.peter@hawkins.emu.id.au>

Hi...

There are some preliminary packages of beta 3 available at:
http://people.debian.org/~peterh/

I disclaim any form of liability for anything these may do to any 
machine you might install them on.

=)
Peter
-- 
peter@hawkins.emu.id.au aka peterh@debian.org
GPG key fingerprint:
C746 38A9 D3E4 A171 FB6A  56D4 5E30 DFCC BE11 F437


From mort at bork.org  Fri Oct 18 23:52:27 2002
From: mort at bork.org (Martin Hicks)
Date: Fri Jan  9 21:59:43 2004
Subject: [mod_python] Redirects
Message-ID: <20021019035227.GK32184@bork.org>


Hello,

I'd like to do a redirect as a result of a certain action in my mod_python 
method.  I.e., rather than returning html, I'd like the user to be redirected to 
the page "blah.html" for example.

How do I accomplish this?

thanks
mh

-- 
Martin Hicks  ||  mort@bork.org  || PGP/GnuPG: 0x4C7F2BEE
plato up 17 days,  5:49, 16 users,  load average: 2.28, 2.20, 2.19
Beer: So much more than just a breakfast drink.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20021018/c8a550a8/attachment-0002.bin
From mort at bork.org  Sat Oct 19 09:50:59 2002
From: mort at bork.org (Martin Hicks)
Date: Fri Jan  9 21:59:43 2004
Subject: [mod_python] Redirects
In-Reply-To: <3DB10378.605355C@sympatico.ca>
References: <20021019035227.GK32184@bork.org> <3DB10378.605355C@sympatico.ca>
Message-ID: <20021019135059.GL32184@bork.org>


On Sat, Oct 19, 2002 at 03:02:16AM -0400, vio wrote:
> Your answer is in the FAQ.


I tried to look in the FAQ before i posted, but it's br0ken.

When I try to search for "redirect" I get:

mod_python FAQ Search Results
Traceback (most recent call last):

  File "/usr/local/www/vhosts/www.modpython.org/FAQ/faqw.py", line 26, in ?
    import faqwiz
  File "/home/grisha/WWW/www.modpython.org/FAQ/faqwiz.py", line 827, in ?
    wiz.go()
  File "/home/grisha/WWW/www.modpython.org/FAQ/faqwiz.py", line 381, in go
    meth()
  File "/home/grisha/WWW/www.modpython.org/FAQ/faqwiz.py", line 447, in 
do_search
    constants
NameError: global name 'constants' is not defined


(times: user 0.567, sys 0.05, ch-user 0, ch-sys 0, real 0.65) 


Other errors occur when you try to view any part of the FAQ.
Can someone please either respond with details on how to do http redirects or 
fix the FAQ :-)

thanks a pile,
mh

-- 
Martin Hicks  ||  mort@bork.org  || PGP/GnuPG: 0x4C7F2BEE
plato up 17 days, 15:47, 16 users,  load average: 0.31, 0.40, 0.27
Great Spirits have always encountered opposition from mediocre minds
						-Albert Einstein
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20021019/f94cd711/attachment-0002.bin
From vmilitaru at sympatico.ca  Sat Oct 19 22:58:58 2002
From: vmilitaru at sympatico.ca (vio)
Date: Fri Jan  9 21:59:43 2004
Subject: [mod_python] Re: Redirects
References: <20021019035227.GK32184@bork.org> <3DB10378.605355C@sympatico.ca> <20021019135059.GL32184@bork.org>
Message-ID: <3DB21BF1.94DDC26B@sympatico.ca>

You do redirection in mod_python with something like this:


def handler(REQUEST):

   _REQUEST = REQUEST._req
...
   _REQUEST.headers_out['location'] = 'http://some_URL.org/...'
   _REQUEST.status = apache.HTTP_MOVED_PERMANENTLY
   _REQUEST.send_http_header()
   raise apache.SERVER_RETURN, apache.OK



Hope this helps,
Vio



From grisha at modpython.org  Sun Oct 20 14:22:53 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:59:43 2004
Subject: [mod_python] Re: Redirects
In-Reply-To: <3DB21BF1.94DDC26B@sympatico.ca>
Message-ID: <Pine.BSF.4.32.0210201421370.39713-100000@eden.ispol.com>

On Sat, 19 Oct 2002, vio wrote:

> You do redirection in mod_python with something like this:
>
>
> def handler(REQUEST):
>
>    _REQUEST = REQUEST._req

The above line won't work starting with the next version of mod_python...

Grisha


From mort at bork.org  Sun Oct 20 14:29:39 2002
From: mort at bork.org (Martin Hicks)
Date: Fri Jan  9 21:59:43 2004
Subject: [mod_python] Re: Redirects
In-Reply-To: <Pine.BSF.4.32.0210201421370.39713-100000@eden.ispol.com>
References: <3DB21BF1.94DDC26B@sympatico.ca> <Pine.BSF.4.32.0210201421370.39713-100000@eden.ispol.com>
Message-ID: <20021020182939.GJ32501@bork.org>

On Sun, Oct 20, 2002 at 02:22:53PM -0400, Gregory (Grisha) Trubetskoy wrote:
> 
> On Sat, 19 Oct 2002, vio wrote:
> 
> > You do redirection in mod_python with something like this:
> >
> >
> > def handler(REQUEST):
> >
> >    _REQUEST = REQUEST._req
> 
> The above line won't work starting with the next version of mod_python...

What will the new method be in the next version?

thanks
mh

-- 
Martin Hicks  ||  mort@bork.org  || PGP/GnuPG: 0x4C7F2BEE
plato up 18 days, 20:28, 14 users,  load average: 0.15, 0.27, 0.17
Beer: So much more than just a breakfast drink.

From vmilitaru at sympatico.ca  Sun Oct 20 21:01:28 2002
From: vmilitaru at sympatico.ca (vio)
Date: Fri Jan  9 21:59:43 2004
Subject: [mod_python] Re: Redirects
References: <Pine.BSF.4.32.0210201421370.39713-100000@eden.ispol.com>
Message-ID: <3DB351E8.A39B7030@sympatico.ca>

Got you. To be more precise, my little code example was "mod_python/2.7.8
over Apache/1.3.26" friendly.

So I guess you must be referring to mod_python/3 running on apache/2.
Looking foreword to it (sorry I haven't had much time to play with the beta
releases so far ... lazily waiting for the first stable release, I guess, to
migrate to the new generation). If I understand you correcly, no more 'fast
track' access to REQUEST internals (aka. 'XXX._req') :-(. I guess a little
'migration tips to mod_python/3' might become handy, then).

If I may add a coding style suggestion for the new version out of the blue,
it would be to replace all references to 'req' with 'REQUEST' (uppercase
full name). I learned this in Zope long ago, and it sticked with me: it's a
little more verbose, but so much more clean when you look at a source code,
especially true for newcomers. Good ideas deserve to be "borrowed".

Vio


"Gregory (Grisha) Trubetskoy" wrote:

> On Sat, 19 Oct 2002, vio wrote:
>
> > You do redirection in mod_python with something like this:
> >
> >
> > def handler(REQUEST):
> >
> >    _REQUEST = REQUEST._req
>
> The above line won't work starting with the next version of mod_python...
>
> Grisha


From grisha at modpython.org  Mon Oct 21 10:44:47 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:59:43 2004
Subject: [mod_python] Re: Redirects
In-Reply-To: <3DB351E8.A39B7030@sympatico.ca>
Message-ID: <Pine.BSF.4.32.0210211003570.49241-100000@eden.ispol.com>

On Sun, 20 Oct 2002, vio wrote:

> Got you. To be more precise, my little code example was "mod_python/2.7.8
> over Apache/1.3.26" friendly.
>
> So I guess you must be referring to mod_python/3 running on apache/2.
> Looking foreword to it (sorry I haven't had much time to play with the beta
> releases so far ... lazily waiting for the first stable release, I guess, to
> migrate to the new generation). If I understand you correcly, no more 'fast
> track' access to REQUEST internals (aka. 'XXX._req') :-(. I guess a little
> 'migration tips to mod_python/3' might become handy, then).
>

The _req object came about as a way to make the end-user request object
modifiable. There were two ways of doing it - writing C code to make the
built-in request object accept new members, or simply encapsulate it in a
regular Python object. I hose the latter because it was quicker :)

Mod_python 3 does it correctly - the built-in request object won't need to
be encapsulated, it will be modifiable as is, so there won't be any need
for _req.

BTW, the ._req is undocumented, so if ever anyone used it, it was at their
own risk. And yes, a migration document would be nice, hopefully I can put
something together to that extent.

> If I may add a coding style suggestion for the new version out of the blue,
> it would be to replace all references to 'req' with 'REQUEST' (uppercase
> full name). I learned this in Zope long ago, and it sticked with me: it's a
> little more verbose, but so much more clean when you look at a source code,
> especially true for newcomers. Good ideas deserve to be "borrowed".

I don't like the way Zope names it REQUEST, because to me, a part-time C
programmer, all caps means a symbolic constant, and this convention has
for the most part been followed in Python standard library.

Grisha

>
> Vio
>
>
> "Gregory (Grisha) Trubetskoy" wrote:
>
> > On Sat, 19 Oct 2002, vio wrote:
> >
> > > You do redirection in mod_python with something like this:
> > >
> > >
> > > def handler(REQUEST):
> > >
> > >    _REQUEST = REQUEST._req
> >
> > The above line won't work starting with the next version of mod_python...
> >
> > Grisha
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>



From grisha at modpython.org  Mon Oct 21 10:59:39 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:59:43 2004
Subject: [mod_python] Redirects
In-Reply-To: <20021019135059.GL32184@bork.org>
Message-ID: <Pine.BSF.4.32.0210211058530.50017-100000@eden.ispol.com>

This's been fixed

On Sat, 19 Oct 2002, Martin Hicks wrote:

>
> On Sat, Oct 19, 2002 at 03:02:16AM -0400, vio wrote:
> > Your answer is in the FAQ.
>
>
> I tried to look in the FAQ before i posted, but it's br0ken.
>
> When I try to search for "redirect" I get:
>
> mod_python FAQ Search Results
> Traceback (most recent call last):
>
>   File "/usr/local/www/vhosts/www.modpython.org/FAQ/faqw.py", line 26, in ?
>     import faqwiz
>   File "/home/grisha/WWW/www.modpython.org/FAQ/faqwiz.py", line 827, in ?
>     wiz.go()
>   File "/home/grisha/WWW/www.modpython.org/FAQ/faqwiz.py", line 381, in go
>     meth()
>   File "/home/grisha/WWW/www.modpython.org/FAQ/faqwiz.py", line 447, in
> do_search
>     constants
> NameError: global name 'constants' is not defined


From eallen41 at charter.net  Mon Oct 21 10:21:38 2002
From: eallen41 at charter.net (Ed Richardson)
Date: Fri Jan  9 21:59:43 2004
Subject: [mod_python] cancel subscription
Message-ID: <001e01c27915$8d89fd20$cf9ba842@charter.net>

password MEXEOX ...  Please remove me from this mailing list... Thx
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20021021/15c9e78c/attachment-0002.htm
From mcassiano at manord.com  Mon Oct 21 17:27:56 2002
From: mcassiano at manord.com (Cassiano, Marco)
Date: Fri Jan  9 21:59:43 2004
Subject: [mod_python] Win mod_python.so not found by Apache
Message-ID: <52DC70C1C1575C418CB033523A29CF140B8D74@exchange2000.manord.com>

Hello everybody.
My configuration is : 

Windows 2000 Server SP3
Apache 2.0.43
Python 2.2.1 by ActiveState
Mod_Python 3.0 Beta 3 

I put the mod_python.so in the ServerRoot/module folder.
I put lib/mod_python folder in the c:/program files/Python22/lib folder

In the Apache httpd.conf I put the line :

LoadModule python_module modules/mod_python.so

When I start the Apache service I always get the error (taken from the
application event):


Event Type:	Error
Event Source:	Apache Service
Event Category:	None
Event ID:	3299
Date:		21/10/2002
Time:		16.49.54
User:		N/A
Computer:	CORSO_MYSQL
Description:
The Apache service named  reported the following error:
>>> Syntax error on line 67 of C:/Program Files/Apache
Group/Apache2/conf/httpd.conf:     . 
The Apache service named  reported the following error:
>>> Cannot load C:/Program Files/Apache Group/Apache2/modules/mod_python.so
into server: 
The specified module could not be found. 



But the mod_python.so file is right there !
What Am I missing ?
Thanks




> Marco Cassiano
> Resp. Reti e Sistemi
> 
> Manifatture del Nord srl
> viale Regina Elena 13-15
> 42100 Reggio Emilia RE
> ITALY
> 
> Tel. +39 0522 508206
> Fax +39 0522 514001
> email : mcassiano@manord.com
> www.pennyblack.com
> 
> 

From barr at cs.cornell.edu  Tue Oct 22 00:53:55 2002
From: barr at cs.cornell.edu (Rimon Barr)
Date: Fri Jan  9 21:59:43 2004
Subject: [mod_python] spyce v1.1.45
In-Reply-To: <Pine.LNX.4.44.0207071930240.8857-100000@pompom.u.cs.cornell.edu>
Message-ID: <Pine.LNX.4.44.0210220024400.3539-100000@pompom.cs.cornell.edu>

SPYCE - Python Server Pages
  v1.1.45 released on 13 Oct 2002.

SPYCE is a webserver plugin that supports simple and efficient
Python-based dynamic HTML scripting. Those who like Python and are
familiar with JSP, or PHP, or ASP, should have a look at this engine. It
allows one to generate dynamic HTML content just as easily, using Python
for the dynamic parts. Its modular design makes it very flexible and
extensible. It supports FastCGI, CGI and mod_python to plugin into Apache
and most other webservers. It can also be used as a command-line utility
for HTML pre-processing or as a web server proxy.

Get it at:
  http://spyce.sourceforge.net

----------

Dear mod_python users,

Spyce works very nicely under mod_python, and it's been a while since I
posted a release announcement to this list (in fact, since v1.1.22, about
two months ago). Here are some of the major highlights. (The full change
log is available at:
http://cvs.sourceforge.net/cgi-bin/viewcvs.cgi/spyce/spyce/CHANGES?rev=HEAD&content-type=text/vnd.viewcvs-markup).

  - refactored the spyce module infrastructure
  - modules accept initialization arguments
  - new modules and improvements:
      toc - table of contents
      transform - output filters/transformations
      compress - dynamic compression
      error - error handling
      stdout - added push() and pop() methods; loaded implicitly
      and lots of others...
  - more accurate/specific runtime error reporting
  - added server-level configuration options
  - spyce now also supports a proxy server mode
  - added spyceDone exception to stop spyce processing
  - rpm improvements and new windows installer
  - compatibility with Python 1.5.2 and up
  - file globbing added to -O command-line option
  - site and documentation revamp
  - live examples on sourceforge
  - lots of bug fixes
  - performance improvements

If you use mod_python, and the last time you checked out Spyce was two
months ago, then please go take a second look. :)
  http://spyce.sourceforge.net

Comments, suggestions and feature requests are welcome.

Enjoy,
Rimon.


From rien at yeepa.org  Tue Oct 22 18:01:18 2002
From: rien at yeepa.org (Adrien Plisson)
Date: Fri Jan  9 21:59:43 2004
Subject: [mod_python] Win mod_python.so not found by Apache
References: <52DC70C1C1575C418CB033523A29CF140B8D74@exchange2000.manord.com>
Message-ID: <001101c279e4$428a4ee0$0a020101@skynet.be>

From: "Cassiano, Marco" <mcassiano@manord.com>
> I put the mod_python.so in the ServerRoot/module folder.
> I put lib/mod_python folder in the c:/program files/Python22/lib folder

shouldn't you put mod_python.dll instead of mod_python.so ?

.so files are "shared object" under un*x and achieve the same functionnality
as a .dll under windows.

--
rien


From grisha at modpython.org  Tue Oct 22 13:20:46 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:59:43 2004
Subject: [mod_python] Win mod_python.so not found by Apache
In-Reply-To: <001101c279e4$428a4ee0$0a020101@skynet.be>
Message-ID: <20021022131702.O73449-100000@eden.ispol.com>

It is a DLL, but apache httpd people decided to name their dll's with a
.so. Windows doesn't really care what the file is called, so it works just
the same, but this way the name is same on Windows and unices and you get
a nice little red feather as the icon associated with it. :)

On Tue, 22 Oct 2002, Adrien Plisson wrote:

> From: "Cassiano, Marco" <mcassiano@manord.com>
> > I put the mod_python.so in the ServerRoot/module folder.
> > I put lib/mod_python folder in the c:/program files/Python22/lib folder
>
> shouldn't you put mod_python.dll instead of mod_python.so ?
>
> .so files are "shared object" under un*x and achieve the same functionnality
> as a .dll under windows.
>
> --
> rien
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From neo at https.ru  Tue Oct 22 21:23:14 2002
From: neo at https.ru (Neo Eureka)
Date: Fri Jan  9 21:59:43 2004
Subject: [mod_python] Win mod_python.so not found by Apache
In-Reply-To: <52DC70C1C1575C418CB033523A29CF140B8D74@exchange2000.manord.com>
References: <52DC70C1C1575C418CB033523A29CF140B8D74@exchange2000.manord.com>
Message-ID: <5825926840.20021022212314@https.ru>

 Hi all !

CM> Hello everybody.
CM> My configuration is : 

CM> Windows 2000 Server SP3
CM> Apache 2.0.43
CM> Python 2.2.1 by ActiveState
CM> Mod_Python 3.0 Beta 3 

CM> I put the mod_python.so in the ServerRoot/module folder.
CM> I put lib/mod_python folder in the c:/program files/Python22/lib folder

CM> In the Apache httpd.conf I put the line :

CM> LoadModule python_module modules/mod_python.so

CM> When I start the Apache service I always get the error (taken from the
CM> application event):

CM> Event Type:     Error
CM> Event Source:   Apache Service
CM> Event Category: None
CM> Event ID:       3299
CM> Date:           21/10/2002
CM> Time:           16.49.54
CM> User:           N/A
CM> Computer:       CORSO_MYSQL
CM> Description:
CM> The Apache service named  reported the following error:
>>>> Syntax error on line 67 of C:/Program Files/Apache
CM> Group/Apache2/conf/httpd.conf:     . 
CM> The Apache service named  reported the following error:
>>>> Cannot load C:/Program Files/Apache Group/Apache2/modules/mod_python.so
CM> into server: 
CM> The specified module could not be found. 

CM> But the mod_python.so file is right there !
CM> What Am I missing ?
CM> Thanks

  I've run into the same behaviour of BETA3 under WindowsNT/4.0 &
Apache 2.0.43.


--- 
Neo Eureka / mailto:neo@https.ru


From neo at https.ru  Tue Oct 22 21:30:49 2002
From: neo at https.ru (Neo Eureka)
Date: Fri Jan  9 21:59:43 2004
Subject: [mod_python] Win mod_python.so not found by Apache
In-Reply-To: <001101c279e4$428a4ee0$0a020101@skynet.be>
References: <52DC70C1C1575C418CB033523A29CF140B8D74@exchange2000.manord.com>
 <001101c279e4$428a4ee0$0a020101@skynet.be>
Message-ID: <16026381574.20021022213049@https.ru>

AP> From: "Cassiano, Marco" <mcassiano@manord.com>
>> I put the mod_python.so in the ServerRoot/module folder.
>> I put lib/mod_python folder in the c:/program files/Python22/lib folder

AP> shouldn't you put mod_python.dll instead of mod_python.so ?

  No, he should not.


AP> .so files are "shared object" under un*x and achieve the same functionnality
AP> as a .dll under windows.

  Apache 2 under Windows uses ".so" files for loadable modules instead
of ".dll". In fact, these files are DLLs inside, but they look like
Unix shared object files.


AP> --
AP> rien


---
Neo Eureka / mailto:neo@https.ru


From rpinder at usc.edu  Tue Oct 22 11:36:08 2002
From: rpinder at usc.edu (Rich Pinder)
Date: Fri Jan  9 21:59:43 2004
Subject: [mod_python] Permissions Question on Linux
References: <52DC70C1C1575C418CB033523A29CF140B8D74@exchange2000.manord.com>
 <001101c279e4$428a4ee0$0a020101@skynet.be>
Message-ID: <3DB59A98.2030905@usc.edu>

Sorry for the simplicity of this question.

I'm putting together a site that uses Apache and mod_python and kinterbase to insert data into a Firebird 
(Interbase) server.

All the software resides on the same machine.
I've done some preliminary work on win32 machines, but now am configuring the SuSE 8.1 server.

Heres the question:  Are there any good practice guidelines on what specific Linux user account should be 
running (owning) the scripts, and where they should be residing ?  Rather than just getting something together 
that works, I thought I'd see how others do it.

thanks in advance for your thoughts

rich pinder
usc school of medicine


From rrreid at earthlink.net  Wed Oct 23 12:02:22 2002
From: rrreid at earthlink.net (Mr. Robin R. Reid)
Date: Fri Jan  9 21:59:43 2004
Subject: [mod_python] Problems with BETA3 and Solaris 9
Message-ID: <3DB6E42E.9060105@earthlink.net>

I ran the following configuration command

./configure --with-python --with-apxs=/usr/local/apache/bin/apxs

then ran make to completion. make install, however finished with the
following output:

Performing DSO installation.

./install-sh -c src/mod_python.so /usr/local/apache/modules
install:  src/mod_python.so does not exist
make[1]: *** [install_dso] Error 1
make[1]: Leaving directory `/export/home/tools/mod_python-3.0.0-BETA'
make: *** [install] Error 2

Needless to say, this is quite true. I'm running apache 2.0.43 and am using
gcc 3.1, with most of the gnu build tools installed. Being relatively new to
gnu build tools and mod_python, I'm not sure how to proceed.

Thanks in advance for your help.


From grisha at modpython.org  Wed Oct 23 14:39:21 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:59:43 2004
Subject: [mod_python] Problems with BETA3 and Solaris 9
In-Reply-To: <3DB6E42E.9060105@earthlink.net>
Message-ID: <20021023143337.B22688-100000@eden.ispol.com>

Did make report errors of any kind? It'd be strange if it didn't.

Try this:

Edit src/Makefile.in, change the line:

mod_python.so: $(SRCS)

to

mod_python.so: $(SRCS)  @EPRINTF_HACK@ @FLOATDIDF_HACK@

Then rerun ./configure --with-apxs=/usr/local/apache/bin/apxs

(You don't need the --with-python argument)

Let me know if it fixes it.

P.S. I had problems building and running apache on Solaris 9 and in the
end what fixed was compiling my own gcc from scratch. I used 3.2, but 3.1
should work OK as well. I also had to set LD_LIBRARY_PATH=/usr/local/lib.
I don't know (or don't care) enough about the intricacies of gcc on
Solaris to be able to explain what exactly goes on there, you may not need
those things on your system... :-)

Grisha


On Wed, 23 Oct 2002, Mr. Robin R. Reid wrote:

> I ran the following configuration command
>
> ./configure --with-python --with-apxs=/usr/local/apache/bin/apxs
>
> then ran make to completion. make install, however finished with the
> following output:
>
> Performing DSO installation.
>
> ./install-sh -c src/mod_python.so /usr/local/apache/modules
> install:  src/mod_python.so does not exist
> make[1]: *** [install_dso] Error 1
> make[1]: Leaving directory `/export/home/tools/mod_python-3.0.0-BETA'
> make: *** [install] Error 2
>
> Needless to say, this is quite true. I'm running apache 2.0.43 and am using
> gcc 3.1, with most of the gnu build tools installed. Being relatively new to
> gnu build tools and mod_python, I'm not sure how to proceed.
>
> Thanks in advance for your help.
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From eugene_beast at mail.ru  Thu Oct 24 09:46:16 2002
From: eugene_beast at mail.ru (Eugene Sizikov)
Date: Fri Jan  9 21:59:43 2004
Subject: [mod_python] unicode() conversion troubles with mod_python 3 CVS 27.06.2002
Message-ID: <005b01c27aff$26914920$0bcbefc3@irkutsk.teleross.ru>

Hello all ppl!

I have troubles with unicode conversion with mod_python from RedHat 8.0
distro. The errorlog is:

"
Mod_python error: "PythonHandler mod_python.publisher"

Traceback (most recent call last):

  File "/usr/lib/python2.2/site-packages/mod_python/apache.py", line 285, in
HandlerDispatch
    result = object(req)

  File "/usr/lib/python2.2/site-packages/mod_python/publisher.py", line 175,
in handler
    result = apply(object, (), args)

  File "/var/www/html/teleross/user.py", line 137, in start
    html = '%s [%s]<HR>' % (string_sql_to_html(user.fullname),
Group(user.con, user.gid).fullname) + menu.to_html()

  File "/var/www/html/teleross/utils.py", line 4, in string_sql_to_html
    return unicode(s, 'koi8-r')

  File
"/usr/src/build/143041-i386/install/usr/lib/python2.2/encodings/__init__.py"
, line 51, in search_function

RuntimeError: cannot unmarshal code objects in restricted execution mode
"

So, when it has "unicode(s, 'koi8-r')" it crashes with that interesting
message I can't understand.

Please, help!

Eugene.



From grisha at modpython.org  Thu Oct 24 17:43:20 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:59:43 2004
Subject: [mod_python] unicode() conversion troubles with mod_python 3
 CVS 27.06.2002
In-Reply-To: <005b01c27aff$26914920$0bcbefc3@irkutsk.teleross.ru>
Message-ID: <20021024174222.Y39970-100000@eden.ispol.com>

In my case upgrading to Python 2.2.2 eliminated all encodings weirdness.

Grisha

On Thu, 24 Oct 2002, Eugene Sizikov wrote:

> Hello all ppl!
>
> I have troubles with unicode conversion with mod_python from RedHat 8.0
> distro. The errorlog is:
>
> "
> Mod_python error: "PythonHandler mod_python.publisher"
>
> Traceback (most recent call last):
>
>   File "/usr/lib/python2.2/site-packages/mod_python/apache.py", line 285, in
> HandlerDispatch
>     result = object(req)
>
>   File "/usr/lib/python2.2/site-packages/mod_python/publisher.py", line 175,
> in handler
>     result = apply(object, (), args)
>
>   File "/var/www/html/teleross/user.py", line 137, in start
>     html = '%s [%s]<HR>' % (string_sql_to_html(user.fullname),
> Group(user.con, user.gid).fullname) + menu.to_html()
>
>   File "/var/www/html/teleross/utils.py", line 4, in string_sql_to_html
>     return unicode(s, 'koi8-r')
>
>   File
> "/usr/src/build/143041-i386/install/usr/lib/python2.2/encodings/__init__.py"
> , line 51, in search_function
>
> RuntimeError: cannot unmarshal code objects in restricted execution mode
> "
>
> So, when it has "unicode(s, 'koi8-r')" it crashes with that interesting
> message I can't understand.
>
> Please, help!
>
> Eugene.
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From robertoschler at hotmail.com  Fri Oct 25 09:47:10 2002
From: robertoschler at hotmail.com (Robert Oschler)
Date: Fri Jan  9 21:59:43 2004
Subject: [mod_python] Web Hosts that support mod_python?
Message-ID: <OE198VBDUfdfdhNzW3l00004a23@hotmail.com>

I've found several web hosting companies that support Python, but haven't found one that supports mod_python?  Anybody got one that you like?

thx

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20021025/120456a7/attachment-0002.htm
From mk at lrn.ru  Fri Oct 25 20:14:22 2002
From: mk at lrn.ru (Michael Krasnovsky)
Date: Fri Jan  9 21:59:43 2004
Subject: [mod_python] Using mod_python and shelve module
Message-ID: <20021025201422.671d02df.mk@lrn.ru>

Hi!

I try using standard python module shelve in my publisher handler, but I
got the error:

Mod_python error: "PythonHandler mod_python.publisher"
Traceback (most recent call last):

  File "/usr/lib/python2.2/site-packages/mod_python/apache.py", line
193, in Dispatch
    result = object(req)

  File "/usr/lib/python2.2/site-packages/mod_python/publisher.py", line
171, in handler
    result = apply(object, (), args)

  File "/home/mk/www/test2.py", line 7, in handle
    sessiondict = shelve.open('/tmp/apptest.session', 'c')

  File "/usr/lib/python2.2/shelve.py", line 158, in open
    return DbfilenameShelf(filename, flag)

  File "/usr/lib/python2.2/shelve.py", line 148, in __init__
    Shelf.__init__(self, anydbm.open(filename, flag))

  File "/usr/lib/python2.2/anydbm.py", line 86, in open
    return mod.open(file, flag, mode)

  File "/usr/lib/python2.2/dbhash.py", line 16, in open
    return bsddb.hashopen(file, flag, mode)

error: (13, 'Permission denied')


What's the problem? I check permissions of /tmp/ directory - it's OK.
BTW, I wrote simple cgi script with using shelve and it works fine.
I run mod_pytnon 2.7.8+Apache 1.3.27 on Linux. Python version 2.2.1.

Thanks for any help.

-- 
Michael Krasnovsky

E mk@lrn.ru

From neel at mediapulse.com  Fri Oct 25 16:37:34 2002
From: neel at mediapulse.com (Michael C. Neel)
Date: Fri Jan  9 21:59:43 2004
Subject: [mod_python] Web Hosts that support mod_python?
Message-ID: <C0FC22C08B82074A88B50061764157775BCF@johnson.mediapulse.net>

I've seen this question asked here a few times, and wondered why we (my
company) doesn't do this.  So I talked it over, and I'll be able to add
mod_python support when requested to an account.  I don't think it will
be advertised on our site, but email me and I can get it setup.  We
already have MySQL available, and I could install albatross as well
since I use it often.

The details:
    
        www.pulsetechnologies.net (which is a division of the company I
work for, www.mediapulse.com)

	  Contact me (Michael Neel) at neel@mediapulse.com) before
getting an account so that I can make sure you go on a mod_python ready
box.  I'll also be the contact for conf file changes and setup for you.

	Any questions, just email me - I don't want to take up post on
the list with spam even if it is for my company =D.

Mike

--
Michael C. Neel
Director of Software Development
Mediapulse, Inc.

 
-----Original Message-----
From: Robert Oschler [mailto:robertoschler@hotmail.com] 
Sent: Friday, October 25, 2002 9:47 AM
To: mod_python
Subject: [mod_python] Web Hosts that support mod_python?


I've found several web hosting companies that support Python, but
haven't found one that supports mod_python?  Anybody got one that you
like?

thx


From neel at mediapulse.com  Sat Oct 26 14:42:44 2002
From: neel at mediapulse.com (Michael Neel)
Date: Fri Jan  9 21:59:43 2004
Subject: [mod_python] Web Hosts that support mod_python?
In-Reply-To: <20021026004231.12422.qmail@email.com>
Message-ID: <000001c27d1f$78d57b30$0400a8c0@clapton>

Jack,

	I think that's it's all of the above.  First would be a lack of
popularity.  Going to apache's website it hard to find any info on
python under apace at all (hopefully this will change soon).  Next, you
do need a python skilled tech guy to admin and understand the mod_python
issues, and I'm guessing he's hard to find right now compared to perl or
php.

	I'm also not sure of those ISP's that offer mod_perl, how many
of them go beyond just using it for "fast CGI".  Allowing someone access
to embed an apache module in any language is a risky option.  Also, to
setup such a module you would need conf file access, and I'm sure most
ISP's don't like that idea either.

	Now the conf file issues may have resolution, but I'm not sure
how feasible it is to do, so I throw this out for feedback.  What it the
module "registered" itself for the hooks it wanted to use?  This way
there would be no need to change a conf file once setup.  Having the
feature in the conf file to restrict which hooks a module could register
for as well might be nice.  Lastly, having a way to call the module in a
url dynamically would help, so that no setup was needed in a conf file
to say where the module was, i.e. /python-bin/myhandler.py would use
myhandler.py as the module which registered hooks on it own, but
/python-bin/other.py would be a completely different handler all on it
own and neither one mentioned in the conf file; just some type of
"<Directory>" config to say that /python-bin was a handler directory and
that those handlers could register for any of the following hooks.

	I don't know of anything that works like the above, so this
would be very new to the apache world.  I'd like to think it would help
in getting more ISP's to support mod_python, but that's just a guess.
Either way, I'd like to know what others think.

Mike
--
Michael C. Neel
Director of Software Development
Mediapulse, Inc.
Mod_python hosting available

-----Original Message-----
From: Jack Diederich [mailto:jack_diederich@email.com] 
Sent: Friday, October 25, 2002 8:43 PM
To: Michael C. Neel
Subject: RE: [mod_python] Web Hosts that support mod_python?


Hi Michael,

Are there any technical reasons why mod_python isn't supported by most
hosting companies, is it just not popular enough to justify support, or
is it just a policy thing?

If it is anything but a policy thing, please throw a post on mod_python.
Technical tweaks could be made, or maybe someone would write a
webhosting mod_python HOWTO to make life easier for hosting providers.

If the answer is lack of popularity, we'll just have to wait a while. I
know quite a few folks up here in Boston that are moving to python or
ruby for rapid web application development from perl or C++. CPU cycles
are so cheap there isn't much reason not to anymore ;)

-jack

> I've seen this question asked here a few times, and wondered why we 
> (my
> company) doesn't do this.  So I talked it over, and I'll be able to
add
> mod_python support when requested to an account.  I don't think it
will
> be advertised on our site, but email me and I can get it setup.  We
> already have MySQL available, and I could install albatross as well
> since I use it often.

-- 
__________________________________________________________
Sign-up for your own FREE Personalized E-mail at Mail.com
http://www.mail.com/?sr=signup



From grisha at modpython.org  Wed Oct 30 11:49:09 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:59:43 2004
Subject: [mod_python] BETA 4
Message-ID: <20021030114730.C20021-100000@eden.ispol.com>

Beta 4 of mod_python 3.0 is available for download at
http://www.apache.org/dist/httpd/modpython/dev/

Most likely this will be the last beta before the final release of 3.0

Enjoy,

Grisha


From conrad at hep.caltech.edu  Wed Oct 30 10:01:32 2002
From: conrad at hep.caltech.edu (Conrad Steenberg)
Date: Fri Jan  9 21:59:43 2004
Subject: [mod_python] Customized permission denied message?
Message-ID: <1036000892.1707.117.camel@heppc22.hep.caltech.edu>

Hi

Is it possible to generate a customized permission denied message in an
authenhandler?

I'm using mod_python the answer XML-RPC requests and sending back an
XML-RPC denial message is more elegant than the standard text message.

Thanks!

Conrad

-- 
*-----------------------------------------*
| Conrad Steenberg                        |
| Caltech, Mail Code 356-48               |
| Pasadena, CA, 91125                     |
| e-mail: conrad@hep.caltech.edu          |
| Tel: (626) 395-8758                     |
*-----------------------------------------*


From grisha at modpython.org  Wed Oct 30 13:29:26 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:59:43 2004
Subject: [mod_python] Customized permission denied message?
In-Reply-To: <1036000892.1707.117.camel@heppc22.hep.caltech.edu>
Message-ID: <20021030132631.Y20021-100000@eden.ispol.com>

Yes, the authenhandler (or any handler for that matter) can service the
request to completion by writing whatever needed to the client (also you
may need to set the right status and headers if any) and return
apache.DONE, thereby telling the server that the request is fully serviced
and no other handlers (except for loging and cleanup) will be executed.

Grisha

On 30 Oct 2002, Conrad Steenberg wrote:

> Hi
>
> Is it possible to generate a customized permission denied message in an
> authenhandler?
>
> I'm using mod_python the answer XML-RPC requests and sending back an
> XML-RPC denial message is more elegant than the standard text message.
>
> Thanks!
>
> Conrad
>
> --
> *-----------------------------------------*
> | Conrad Steenberg                        |
> | Caltech, Mail Code 356-48               |
> | Pasadena, CA, 91125                     |
> | e-mail: conrad@hep.caltech.edu          |
> | Tel: (626) 395-8758                     |
> *-----------------------------------------*
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From antonio at memora.com  Thu Oct 31 17:04:30 2002
From: antonio at memora.com (Antonio L Rodriguez)
Date: Fri Jan  9 21:59:44 2004
Subject: [mod_python] Lifecycle of mod_python instances
Message-ID: <BB355965-ED1C-11D6-9578-00039300D690@memora.com>

Forgive me if this is more of an apache process question, but I 
couldn't find it covered clearly in the docs.

When apache boots up (on *NIX) its starts a bunch of children 
processes. Does each child have its own separate image of mod_python 
execution space that is totally separate from the other images?

That is, if I define a global var to measure hit counts in a script and 
then I see this var dance up and down as each of the child processes 
handles the request, do I infer correctly that there are separate 
python interpreters living inside of each child process?

If this is so, I'd be curious how people do global data structures in 
this model, i.e. a database connection pool.

Thanks,

Antonio


From sh at hob.cx  Tue Oct  1 18:02:44 2002
From: sh at hob.cx (Sean Holdsworth)
Date: Fri Jan  9 22:03:31 2004
Subject: [mod_python] Redirect from publisher - again...
Message-ID: <1033491764.10863.57.camel@hag.private.net>

I'm having a problem getting redirects working from a publisher handler.
I've seen the item in the FAQ (and can get redirection from
non-publisher handlers working fine). This issue also seems to crop up
fairly often in the mod_python list. Grisha has answered the question
before with the following example code.

req.headers_out['location'] = 'http://www.modpython.org/'
req.status = apache.HTTP_MOVED_TEMPORARILY
return "You are being redirected to http://www.modpython.org/"

When I run this I get the "You are being redirected..." message
displayed, and it just sits there. I've been trying to get this to work
for a couple of days and am beginning to wonder if it could be an Apache
setting that is causing the problem?

In addition to the publisher handler I have one handler, the
PythonAccessHandler configured. I use this to manage cookies and
redirect to a login page if the client hasn't authenticated. The
login page has a form with an action that causes the handler that
I'm trying to redirect out of to be run.

I'm running Apache 1.3.23 and  mod_python 2.7.8 with python 2.2 on
Mandrake 8.2 Linux. Could someone please run the above code
fragment as a policy handler and confirm that it is just me and my
configuration that has the problem?

Thanks, Sean



From rmunn at pobox.com  Wed Oct  2 01:27:51 2002
From: rmunn at pobox.com (rmunn@pobox.com)
Date: Fri Jan  9 22:03:31 2004
Subject: [mod_python] Patch to allow kwargs in publisher.py
Message-ID: <20021002062751.GA26230@rmunnlfs>

While playing around with my brand new install of mod_python 3.0.0 beta
2, I discovered that publisher.py does not handle the **kwargs syntax in
functions it's dispatching to. Apparently I'm not the only one who wants
that feature added:

http://www.modpython.org/pipermail/mod_python/2002-June/002171.html

It seems like the Right Thing for publisher.py's handler() func to do
would be to check whether the function accepts the **kwargs syntax
before stripping out unexpected args. Presumably if the user asked for
**kwargs-style args to be passed, he is expecting to receive all the
GET/POST arguments in the **kwargs dictionary. It would be intuitive
(it's what I was expecting to happen, actually, and I was surprised that
it didn't) and useful. And since it hadn't been done yet, I went ahead
and did it -- it was surprisingly simple. Here's a patch. It seems to
work fine for me -- I can't say I've given it a foolproof amount of
testing, but every test I threw at it seemed to do what I expected.

-- 
Robin Munn
rmunn@pobox.com


--- lib/python/mod_python/publisher.py	2002-09-12 13:24:05.000000000 -0500
+++ lib/python/mod_python/publisher.py.new	2002-10-02 01:07:46.000000000 -0500
@@ -180,10 +180,17 @@
             fc = object.im_func.func_code
             expected = fc.co_varnames[1:fc.co_argcount]
 
-        # remove unexpected args
-        for name in args.keys():
-            if name not in expected:
-                del args[name]
+        # does it want keyword args?
+        # co_flags & 0x04 is set if a function wants *args syntax
+        # co_flags & 0x08 is set if a function wants **kwargs syntax
+        if fc.co_flags & 0x08:
+            # don't strip unexpected args if function wants **kwargs
+            pass
+        else:
+            # remove unexpected args
+            for name in args.keys():
+                if name not in expected:
+                    del args[name]
 
         result = apply(object, (), args)
 

From rmunn at pobox.com  Wed Oct  2 08:59:13 2002
From: rmunn at pobox.com (rmunn@pobox.com)
Date: Fri Jan  9 22:03:31 2004
Subject: [mod_python] Documentation patch for kwargs change in publisher.py
Message-ID: <20021002135913.GA29104@rmunnlfs>

To go along with my earlier patch adding **kwargs functionality to the
publisher.py dispatcher, here's a documentation patch to keep the docs
up-to-date.

-- 
Robin Munn
rmunn@pobox.com



--- doc-html/hand-pub-alg-args.html	2002-09-24 11:59:13.000000000 -0500
+++ doc-html/hand-pub-alg-args.html.new	2002-10-02 08:52:51.000000000 -0500
@@ -58,7 +58,11 @@
 object expects. This list is compared with names of fields from HTML
 form data submitted by the client via <code>POST</code> or
 <code>GET</code>. Values of fields whose names match the names of callable
-object arguments will be passed as strings.
+object arguments will be passed as strings. Any fields whose names do
+not match the names of callable argument objects will be silently dropped.
+But if the destination callable object has a <code>**kwargs</code> style
+argument, then fields with unmatched names will be passed in the
+<code>**kwargs</code> argument instead.
 
 <P>
 If the destination is not callable or is a class, then its string

From rmunn at pobox.com  Wed Oct  2 09:25:40 2002
From: rmunn at pobox.com (rmunn@pobox.com)
Date: Fri Jan  9 22:03:31 2004
Subject: [mod_python] Documentation patch (another one) for hand-pub-alg-args.html
Message-ID: <20021002142540.GB29104@rmunnlfs>

Having sent in a patch to hand-pub-alg-args.html just now, I realized
that another paragraph would probably be a good idea, to explain why
it's a bad idea to have any fields called req in the HTML request, since
they would be silently dropped in the publisher.py code. I can just see
someone spending days on figuring out what's happening when all his
fields but one are getting passed through kwargs...

So here's another documentation patch. This one supersedes the doc patch
I just sent -- that is, it's meant to be applied to the original
hand-pub-alg-args.html file, not the updated version that my earlier
patch would produce.

-- 
Robin Munn
rmunn@pobox.com




--- doc-html/hand-pub-alg-args.html	2002-09-24 11:59:13.000000000 -0500
+++ doc-html/hand-pub-alg-args.html.new	2002-10-02 09:16:14.000000000 -0500
@@ -58,7 +58,21 @@
 object expects. This list is compared with names of fields from HTML
 form data submitted by the client via <code>POST</code> or
 <code>GET</code>. Values of fields whose names match the names of callable
-object arguments will be passed as strings.
+object arguments will be passed as strings. Any fields whose names do
+not match the names of callable argument objects will be silently dropped.
+But if the destination callable object has a <code>**kwargs</code> style
+argument, then fields with unmatched names will be passed in the
+<code>**kwargs</code> argument instead.
+
+<P>
+Note that the HTML request argument is passed as <code>req</code> to the
+callable object, so if the form data had any field called <code>req</code>,
+that field will be inaccessible in the callable object code. Fields called
+<code>self</code> will also cause problems for instance methods. If you
+absolutely must have a field named <code>self</code>, then you'd be well
+advised to call the first parameter of the instance method something else,
+such as <code>instobj</code>, or some other name that won't conflict with
+any field names.
 
 <P>
 If the destination is not callable or is a class, then its string

From dagurp at heimsnet.is  Wed Oct  2 14:51:21 2002
From: dagurp at heimsnet.is (=?iso-8859-1?Q?Dagur_P=E1ll_Ammendrup?=)
Date: Fri Jan  9 22:03:31 2004
Subject: [mod_python] Webhost with mod_python?
Message-ID: <001401c26a23$3105d2a0$5d016f0a@dagur>

Hi
Does anyone know of a webhost that offers mod_python and MySQL?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20021002/ffe7a433/attachment-0003.htm
From wilk-ml at flibuste.net  Wed Oct  2 22:05:31 2002
From: wilk-ml at flibuste.net (William Dode)
Date: Fri Jan  9 22:03:31 2004
Subject: [mod_python] Webhost with mod_python?
In-Reply-To: <001401c26a23$3105d2a0$5d016f0a@dagur>
References: <001401c26a23$3105d2a0$5d016f0a@dagur>
Message-ID: <87adlwppx0.fsf@flibuste.net>

Dagur P?ll Ammendrup <dagurp@heimsnet.is> writes:

> Hi
> Does anyone know of a webhost that offers mod_python and MySQL?

I would like to know how it's possible to install mod_python in a shared
web hosting when it's not possible to change the user id like suexec and
there is not safe_mod like php...

An other solution ?

-- 
William - http://wikipython.tuxfamily.org


From list-mod_python at empires.org  Wed Oct  2 14:36:40 2002
From: list-mod_python at empires.org (Jeff Davis)
Date: Fri Jan  9 22:03:31 2004
Subject: [mod_python] Webhost with mod_python?
In-Reply-To: <87adlwppx0.fsf@flibuste.net>
References: <001401c26a23$3105d2a0$5d016f0a@dagur> <87adlwppx0.fsf@flibuste.net>
Message-ID: <200210021436.40191.list-mod_python@empires.org>

> Dagur P?ll Ammendrup <dagurp@heimsnet.is> writes:
> > Hi
> > Does anyone know of a webhost that offers mod_python and MySQL?
>
> I would like to know how it's possible to install mod_python in a shared
> web hosting when it's not possible to change the user id like suexec and
> there is not safe_mod like php...
>
> An other solution ?

In apache2 there will exist an MPM called "mpm_perchild" that spawns a 
separate process for each virtualhost under the virtualhost's userid, and 
then each request to that virtualhost spawns a thread. That is the ideal 
solution. Unfortunately, it's not released in any kind of stable way yet.

Regards,
	Jeff Davis





From neel at mediapulse.com  Wed Oct  2 23:32:03 2002
From: neel at mediapulse.com (Michael Neel)
Date: Fri Jan  9 22:03:31 2004
Subject: [mod_python] MySQL Authencation
In-Reply-To: <200210021436.40191.list-mod_python@empires.org>
Message-ID: <000001c26a8d$7102d820$0400a8c0@clapton>

Hi All,

	I was wondering if anyone has done an SQL authencation module
for mod_python, not unlike mod_perl's Apache::DBI::Auth.  I'm looking
for MySQL, but I could work with any module and rewrite what is needed
to switch db's.  I'm also using apache 2.0 and mod_python 3, but I could
work from a 1.3 / 2.7 module.  I just don't want to start from scratch
if I don't need to.  I've tried to get mod_auth_mysql working under
apache 2, but that projects has more forks than the Sunday table so I'm
not quite sure where to ask install questions there.  Worst case I could
move to RedHat 8, which ships with apache 2, mod_python 3, and
mod_mysql_auth - but that seems like a lot of extra work to get SQL
authencation working!

Mike

--
Michael C. Neel
There are only 10 types of people in the world;
those who understand binary and those who don't.


From gbeasley at tsa.ac.za  Thu Oct  3 13:40:20 2002
From: gbeasley at tsa.ac.za (Grant Beasley)
Date: Fri Jan  9 22:03:31 2004
Subject: [mod_python] Problem with AuthenHandler & Apache Configuration
Message-ID: <OOENKCHGJGHILGPAGHGOEELNCEAA.gbeasley@tsa.ac.za>

Hi

I'm trying to set up my website in such a way that the entire website is
protected by an AuthenHandler, and the "cgi" directory (where my mod_python
scripts run) is directed to a publisher (my own modification of the standard
publisher).

To do this, I setup Apache with the following directives:

<Directory "C:/Projects/http/cgi">
  SetHandler python-program
PythonHandler mypub
PythonDebug On
</Directory>

<Directory "C:/Projects/http">
  SetHandler python-program
PythonAuthenHandler authen
	AuthType Basic
	AuthName "Restricted Area"
	require valid-user
PythonLogHandler log
PythonDebug On
</Directory>

I've programmed my authenhandler (for debugging purposes) as follows:
    pw = req.get_basic_auth_pw()
    user = req.connection.user
    f = open("C:\\authendump.txt", "a")
    f.write("""Authen - %s
URI: %s
UNPARSED_URI: %s
THE_REQUEST: %s
PATH_INFO: %s
FILENAME: %s
USER: %s
PW: %s
-----------------
""" % (strftime('%d/%m/%Y %H:%M:%S', localtime()),req.uri, req.unparsed_uri,
req.the_request, req.path_info, req.filename, user, pw))
    if user is not None:
        return apache.OK
    else:
        return apache.HTTP_UNAUTHORIZED
    f.close()

i.e. Just to dump a few variables for inspection.

For a single request, the above configuration gives me the following:

Authen - 03/10/2002 13:31:16
URI: /showuser
UNPARSED_URI: /showuser
THE_REQUEST: GET /cgi/cool/showuser HTTP/1.1
PATH_INFO:
FILENAME: c:/projects/http/showuser
USER: None
PW: None
-----------------
Authen - 03/10/2002 13:31:16
URI: /cgi/cool/showuser
UNPARSED_URI: /cgi/cool/showuser
THE_REQUEST: GET /cgi/cool/showuser HTTP/1.1
PATH_INFO: /showuser
FILENAME: c:/projects/http/cgi/cool
USER: None
PW: None
-----------------
Authen - 03/10/2002 13:31:18
URI: /showuser
UNPARSED_URI: /showuser
THE_REQUEST: GET /cgi/cool/showuser HTTP/1.1
PATH_INFO:
FILENAME: c:/projects/http/showuser
USER: gb
PW: a
-----------------
Authen - 03/10/2002 13:31:18
URI: /cgi/cool/showuser
UNPARSED_URI: /cgi/cool/showuser
THE_REQUEST: GET /cgi/cool/showuser HTTP/1.1
PATH_INFO: /showuser
FILENAME: c:/projects/http/cgi/cool
USER: gb
PW: a
-----------------

In other words the authenhandler code is executing twice, with a different
URI. On inspection of the get_config() and get_dirs(), I can see that it's
executing once for each of the above directives.

What I'd like to know is why this occurs, and how do I prevent it?

Any help appreciated.

Grant Beasley


From neo at https.ru  Thu Oct  3 23:35:43 2002
From: neo at https.ru (Neo Eureka)
Date: Fri Jan  9 22:03:31 2004
Subject: [mod_python] Apache 2.0.42
Message-ID: <11731692471.20021003233543@https.ru>

Hi !

  It seems, BETA2 of mod_python 3 is not compatible with
Apache-2.0.42. It builds successfully, but when apache is asked to
test new configuration it complains about undefined symbol "openpty"
while trying to load mod_python into the server.

  Linux 7.2, Apache-2.0.42, Python-2.2.1.

                                                                Neo

P.S.
  The latest version of Apache recommended by Apache.org is 2.0.43. It
would be cool if mod_python 3 somehow could cope with these versions.


From grisha at modpython.org  Thu Oct  3 16:58:01 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:03:31 2004
Subject: [mod_python] Documentation patch for kwargs change in publisher.py
In-Reply-To: <20021002135913.GA29104@rmunnlfs>
Message-ID: <Pine.BSF.4.32.0210031656290.1483-100000@eden.ispol.com>

Thanks, I'll add this in.

BTW, the doc-html stuff automatically generated from .tex files in Doc.

On Wed, 2 Oct 2002 rmunn@pobox.com wrote:

> To go along with my earlier patch adding **kwargs functionality to the
> publisher.py dispatcher, here's a documentation patch to keep the docs
> up-to-date.
>
> --
> Robin Munn
> rmunn@pobox.com
>
>
>
> --- doc-html/hand-pub-alg-args.html	2002-09-24 11:59:13.000000000 -0500
> +++ doc-html/hand-pub-alg-args.html.new	2002-10-02 08:52:51.000000000 -0500
> @@ -58,7 +58,11 @@
>  object expects. This list is compared with names of fields from HTML
>  form data submitted by the client via <code>POST</code> or
>  <code>GET</code>. Values of fields whose names match the names of callable
> -object arguments will be passed as strings.
> +object arguments will be passed as strings. Any fields whose names do
> +not match the names of callable argument objects will be silently dropped.
> +But if the destination callable object has a <code>**kwargs</code> style
> +argument, then fields with unmatched names will be passed in the
> +<code>**kwargs</code> argument instead.
>
>  <P>
>  If the destination is not callable or is a class, then its string
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From grisha at modpython.org  Thu Oct  3 17:30:48 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:03:31 2004
Subject: [mod_python] Problem with AuthenHandler & Apache Configuration
In-Reply-To: <OOENKCHGJGHILGPAGHGOEELNCEAA.gbeasley@tsa.ac.za>
Message-ID: <Pine.BSF.4.32.0210031728430.1483-100000@eden.ispol.com>

Apache does this. It has to give a module a chance to evaluate permissions
at every directory in the path. I do not believe there is much you can do
about this.

Grisha

On Thu, 3 Oct 2002, Grant Beasley wrote:

> Hi
>
> I'm trying to set up my website in such a way that the entire website is
> protected by an AuthenHandler, and the "cgi" directory (where my mod_python
> scripts run) is directed to a publisher (my own modification of the standard
> publisher).
>
> To do this, I setup Apache with the following directives:
>
> <Directory "C:/Projects/http/cgi">
>   SetHandler python-program
> PythonHandler mypub
> PythonDebug On
> </Directory>
>
> <Directory "C:/Projects/http">
>   SetHandler python-program
> PythonAuthenHandler authen
> 	AuthType Basic
> 	AuthName "Restricted Area"
> 	require valid-user
> PythonLogHandler log
> PythonDebug On
> </Directory>
>
> I've programmed my authenhandler (for debugging purposes) as follows:
>     pw = req.get_basic_auth_pw()
>     user = req.connection.user
>     f = open("C:\\authendump.txt", "a")
>     f.write("""Authen - %s
> URI: %s
> UNPARSED_URI: %s
> THE_REQUEST: %s
> PATH_INFO: %s
> FILENAME: %s
> USER: %s
> PW: %s
> -----------------
> """ % (strftime('%d/%m/%Y %H:%M:%S', localtime()),req.uri, req.unparsed_uri,
> req.the_request, req.path_info, req.filename, user, pw))
>     if user is not None:
>         return apache.OK
>     else:
>         return apache.HTTP_UNAUTHORIZED
>     f.close()
>
> i.e. Just to dump a few variables for inspection.
>
> For a single request, the above configuration gives me the following:
>
> Authen - 03/10/2002 13:31:16
> URI: /showuser
> UNPARSED_URI: /showuser
> THE_REQUEST: GET /cgi/cool/showuser HTTP/1.1
> PATH_INFO:
> FILENAME: c:/projects/http/showuser
> USER: None
> PW: None
> -----------------
> Authen - 03/10/2002 13:31:16
> URI: /cgi/cool/showuser
> UNPARSED_URI: /cgi/cool/showuser
> THE_REQUEST: GET /cgi/cool/showuser HTTP/1.1
> PATH_INFO: /showuser
> FILENAME: c:/projects/http/cgi/cool
> USER: None
> PW: None
> -----------------
> Authen - 03/10/2002 13:31:18
> URI: /showuser
> UNPARSED_URI: /showuser
> THE_REQUEST: GET /cgi/cool/showuser HTTP/1.1
> PATH_INFO:
> FILENAME: c:/projects/http/showuser
> USER: gb
> PW: a
> -----------------
> Authen - 03/10/2002 13:31:18
> URI: /cgi/cool/showuser
> UNPARSED_URI: /cgi/cool/showuser
> THE_REQUEST: GET /cgi/cool/showuser HTTP/1.1
> PATH_INFO: /showuser
> FILENAME: c:/projects/http/cgi/cool
> USER: gb
> PW: a
> -----------------
>
> In other words the authenhandler code is executing twice, with a different
> URI. On inspection of the get_config() and get_dirs(), I can see that it's
> executing once for each of the above directives.
>
> What I'd like to know is why this occurs, and how do I prevent it?
>
> Any help appreciated.
>
> Grant Beasley
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From rmunn at pobox.com  Thu Oct  3 16:39:27 2002
From: rmunn at pobox.com (rmunn@pobox.com)
Date: Fri Jan  9 22:03:31 2004
Subject: [mod_python] Documentation patch for kwargs change in publisher.py
In-Reply-To: <Pine.BSF.4.32.0210031656290.1483-100000@eden.ispol.com>
References: <20021002135913.GA29104@rmunnlfs> <Pine.BSF.4.32.0210031656290.1483-100000@eden.ispol.com>
Message-ID: <20021003213927.GB26042@rmunnlfs>

On Thu, Oct 03, 2002 at 04:58:01PM -0400, Gregory (Grisha) Trubetskoy wrote:
> 
> Thanks, I'll add this in.
> 
> BTW, the doc-html stuff automatically generated from .tex files in Doc.
> 
[snip my patch]

Ah. Next time I send in a doc patch I'll patch the .tex files, then.

-- 
Robin Munn
rmunn@pobox.com

From daniel at copyleft.no  Sat Oct  5 01:23:48 2002
From: daniel at copyleft.no (Hr. Daniel Mikkelsen)
Date: Fri Jan  9 22:03:31 2004
Subject: [mod_python] Problems with PYTHONPATH.
Message-ID: <20021005011159.B33688-100000@unity.copyleft.no>

Hi.

I'm experiencing odd behaviour with mod_python and its PYTHONPATH. I'm running
FreeBSD 4.5. I'm not using the port-version of mod_python, since I want use a
separate threadless Python.

Anyway, I've compiled up things, and they basically work. I have my python
version in /local/python-2.2.1-threadless. Mod_python, when ./configuring
detects this from the --with-python=/local/src/Python-2.2.1 I give it.

All very automatic and nice.

But when I fire up Apache with this, things just refuse to work until I add a
symlink from
"/local/python-2.2.1-threadless/lib/python2.2/site-packages/mod_python" to
"/usr/local/lib/python2.2/site-packages".

And when I make my test handler print out sys.path, what I get is the
/usr/local prefixed ones, not the /local/python-2.2.1-threadless ones.

I can't figure out what's going on. The mod_python.so DSO only knows about
/local/python-2.2.1-threadless.

I've worked around this with a PythonPath entry, but I'm very curious as to why
this is happening. Is /usr/local some default prefix Python defaults to? Is
mod_python.so loading /usr/local/lib/python2.2/config/libpython2.2.a somehow by
mistake?

I'm absolutely certain there is only one installation of mod_python on my
system, and that it's configured and compiled with the correct (threadless)
interpreter.

Any help would be appreciated. :)

-- Daniel


From jack_diederich at email.com  Fri Oct  4 20:43:18 2002
From: jack_diederich at email.com (Jack Diederich)
Date: Fri Jan  9 22:03:31 2004
Subject: [mod_python] Problems with PYTHONPATH.
Message-ID: <20021005014318.19386.qmail@email.com>

I had a similar problem when using a user specific python instead of the system wide python with mod_python.
I took the cowards way out and just issued a PythonPath directive in httpd.conf with all the paths I need.

-jack
----- Original Message -----
From: "Hr. Daniel Mikkelsen" <daniel@copyleft.no>
Date: Sat, 5 Oct 2002 01:23:48 +0200 (CEST) 
To: mod_python@modpython.org
Subject: [mod_python] Problems with PYTHONPATH.


> Hi.
> 
> I'm experiencing odd behaviour with mod_python and its PYTHONPATH. I'm running
> FreeBSD 4.5. I'm not using the port-version of mod_python, since I want use a
> separate threadless Python.
> 
> Anyway, I've compiled up things, and they basically work. I have my python
> version in /local/python-2.2.1-threadless. Mod_python, when ./configuring
> detects this from the --with-python=/local/src/Python-2.2.1 I give it.
> 
> All very automatic and nice.
> 
> But when I fire up Apache with this, things just refuse to work until I add a
> symlink from
> "/local/python-2.2.1-threadless/lib/python2.2/site-packages/mod_python" to
> "/usr/local/lib/python2.2/site-packages".
> 
> And when I make my test handler print out sys.path, what I get is the
> /usr/local prefixed ones, not the /local/python-2.2.1-threadless ones.
> 
> I can't figure out what's going on. The mod_python.so DSO only knows about
> /local/python-2.2.1-threadless.
> 
> I've worked around this with a PythonPath entry, but I'm very curious as to why
> this is happening. Is /usr/local some default prefix Python defaults to? Is
> mod_python.so loading /usr/local/lib/python2.2/config/libpython2.2.a somehow by
> mistake?
> 
> I'm absolutely certain there is only one installation of mod_python on my
> system, and that it's configured and compiled with the correct (threadless)
> interpreter.
> 
> Any help would be appreciated. :)
> 
> -- Daniel
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 
> 

-- 
__________________________________________________________
Sign-up for your own FREE Personalized E-mail at Mail.com
http://www.mail.com/?sr=signup


"Free price comparison tool gives you the best prices and cash back!"
http://www.bestbuyfinder.com/download.htm


From piet at cs.uu.nl  Sat Oct  5 13:03:33 2002
From: piet at cs.uu.nl (Piet van Oostrum)
Date: Fri Jan  9 22:03:31 2004
Subject: [mod_python] Apache 2.0.42
In-Reply-To: <11731692471.20021003233543@https.ru>
References: <11731692471.20021003233543@https.ru>
Message-ID: <wzn0pttaey.fsf@cs.uu.nl>

>>>>> Neo Eureka <neo@https.ru> (NE) writes:

NE> Hi !

NE>   It seems, BETA2 of mod_python 3 is not compatible with
NE> Apache-2.0.42. It builds successfully, but when apache is asked to
NE> test new configuration it complains about undefined symbol "openpty"
NE> while trying to load mod_python into the server.

Maybe this previous post will help:

----- Original Message -----
From: "Carl C." <cc@carlc.com>
Subject: Re: [mod_python] Compiling a DSO module for RedHat Linux on ALPHA
64bit.
Guess, what... I FIXED IT...
I had to edit the mod_python's src/Makefile and change the
LIBS=-lm? /usr/src/Python-2.2-no-threads/libpython2.2.a
to
LIBS=-lm? /usr/src/Python-2.2-no-threads/libpython2.2.a -lutil
That -lutil was the magic!
Carl

-- 
Piet van Oostrum <piet@cs.uu.nl>
URL: http://www.cs.uu.nl/~piet [PGP]
Private email: P.van.Oostrum@hccnet.nl



From jack_diederich at email.com  Sat Oct  5 08:10:46 2002
From: jack_diederich at email.com (Jack Diederich)
Date: Fri Jan  9 22:03:32 2004
Subject: [mod_python] Apache 2.0.42
Message-ID: <20021005131050.32347.qmail@email.com>

For me (mod_python 2x, linux, Python 2.2.1) I needed to symlink Modules/Makefile to the root Python Makefile or ./configure would leave out some libraries in the linker line.  I don't remember if libutil was one of them.

I posted that to python-dev@httpd.apache.org, does anyone know if there is a searchable archive, or when there might be one in the future?

-jack
----- Original Message -----
From: Piet van Oostrum <piet@cs.uu.nl>
Date: 05 Oct 2002 13:03:33 +0200 
To: Neo Eureka <neo@https.ru>
Subject: Re: [mod_python] Apache 2.0.42


> >>>>> Neo Eureka <neo@https.ru> (NE) writes:
> 
> NE> Hi !
> 
> NE>   It seems, BETA2 of mod_python 3 is not compatible with
> NE> Apache-2.0.42. It builds successfully, but when apache is asked to
> NE> test new configuration it complains about undefined symbol "openpty"
> NE> while trying to load mod_python into the server.
> 
> Maybe this previous post will help:
> 
> ----- Original Message -----
> From: "Carl C." <cc@carlc.com>
> Subject: Re: [mod_python] Compiling a DSO module for RedHat Linux on ALPHA
> 64bit.
> Guess, what... I FIXED IT...
> I had to edit the mod_python's src/Makefile and change the
> LIBS=-lm  /usr/src/Python-2.2-no-threads/libpython2.2.a
> to
> LIBS=-lm  /usr/src/Python-2.2-no-threads/libpython2.2.a -lutil
> That -lutil was the magic!
> Carl
> 
> -- 
> Piet van Oostrum <piet@cs.uu.nl>
> URL: http://www.cs.uu.nl/~piet [PGP]
> Private email: P.van.Oostrum@hccnet.nl
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 
> 

-- 
__________________________________________________________
Sign-up for your own FREE Personalized E-mail at Mail.com
http://www.mail.com/?sr=signup


"Free price comparison tool gives you the best prices and cash back!"
http://www.bestbuyfinder.com/download.htm


From mateusz at ant.gliwice.pl  Sat Oct  5 15:39:48 2002
From: mateusz at ant.gliwice.pl (Mateusz Korniak)
Date: Fri Jan  9 22:03:32 2004
Subject: [mod_python] Perhaps bug in mod_pythons configure.in ? (python 2.2 and undefined symbol "openpty")
In-Reply-To: <20021005131050.32347.qmail@email.com>
References: <20021005131050.32347.qmail@email.com>
Message-ID: <200210051536.10652.mateusz@ant.gliwice.pl>

On Saturday 05 October 2002 15:10, Jack Diederich wrote:

> > NE>   It seems, BETA2 of mod_python 3 is not compatible with
> > NE> Apache-2.0.42. It builds successfully, but when apache is asked to
> > NE> test new configuration it complains about undefined symbol "openpty"
> > NE> while trying to load mod_python into the server.

> For me (mod_python 2x, linux, Python 2.2.1) I needed to symlink
> Modules/Makefile to the root Python Makefile or ./configure would leave out
> some libraries in the linker line.  I don't remember if libutil was one of
> them.
>
I've run at similar behavior ....
I'm totally ignorant about autoconf/automake stuff but I think problem affects 
python 2.2 bug in configure.in.

2.2 version triggers bad path to Makefile -> python is badly recognaised as 
linked without libs -> symbols are missing.

# set python std library variable
AC_MSG_CHECKING(what libraries Python was linked with)
AC_SUBST(LIBS)
if test -z "$PYTHON_SRC"; then
  PyLIBP=${PyEXEC_INSTALLDIR}/lib/python${PyVERSION}
  PyLIBPL=${PyLIBP}/config
  PyPYTHONLIBS=${PyLIBPL}/libpython${PyVERSION}.a
  PyLIBS=`grep "^LIB[[SMC]]=" ${PyLIBPL}/Makefile | cut -f2 -d= | tr 
'\011\012\015' '   '`
  PyMODLIBS=`grep "^LOCALMODLIBS=" ${PyLIBPL}/Makefile | cut -f2 -d= | tr 
'\011\012\015' '   '`
  PY_LIBS="${PyPYTHONLIBS} ${PyLIBS} ${PyMODLIBS}"
else
  PyPYTHONLIBS=${PYTHON_SRC}/libpython${PyVERSION}.a
  if test ${PyVERSION} = "2.1"; then
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ IMHO This test should be possitive for 2.2 
too

    PyLIBS=`grep "^LIB[[SMC]]=" ${PYTHON_SRC}/Makefile | cut -f2 -d= | tr 
'\011\012\015' '   '`
    PyMODLIBS=`grep "^LOCALMODLIBS=" ${PYTHON_SRC}/Makefile | cut -f2 -d= | tr 
'\011\012\015' '   '`
  else
    PyLIBS=`grep "^LIB[[SMC]]=" ${PYTHON_SRC}/Modules/Makefile | cut -f2 -d= | 
tr '\011\012\015' '   '`
    PyMODLIBS=`grep "^LOCALMODLIBS=" ${PYTHON_SRC}/Modules/Makefile | cut -f2 
-d= | tr '\011\012\015' '   '`
  fi
  PY_LIBS="${PyPYTHONLIBS} ${PyLIBS} ${PyMODLIBS}"
fi


-- 
Mateusz Korniak
"Black holes are where God divided by zero." - Steven Wright



From mateusz at ant.gliwice.pl  Sat Oct  5 15:45:09 2002
From: mateusz at ant.gliwice.pl (Mateusz Korniak)
Date: Fri Jan  9 22:03:32 2004
Subject: [mod_python] Two more fixes to ac/am stuff (patches included)
Message-ID: <200210051545.09369.mateusz@ant.gliwice.pl>

Both taken from PLD distro...

1. Fixes DESTDIR behavior
2. Fixes typo. (IMHO)


-- 
Mateusz Korniak

-------------- next part --------------
A non-text attachment was scrubbed...
Name: apache-mod_python-DESTDIR.patch
Type: text/x-diff
Size: 987 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20021005/e3571cd3/apache-mod_python-DESTDIR-0003.bin
-------------- next part --------------
A non-text attachment was scrubbed...
Name: apache-mod_python-Makefile-in.patch
Type: text/x-diff
Size: 507 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20021005/e3571cd3/apache-mod_python-Makefile-in-0003.bin
From neo at https.ru  Sat Oct  5 23:43:24 2002
From: neo at https.ru (Neo Eureka)
Date: Fri Jan  9 22:03:32 2004
Subject: [mod_python] Missing library in Makefile
In-Reply-To: <wzn0pttaey.fsf@cs.uu.nl>
References: <11731692471.20021003233543@https.ru> <wzn0pttaey.fsf@cs.uu.nl>
Message-ID: <974103440.20021005234324@https.ru>

  Dank U wel !

  This was it!

I think all the problems in configure/make stuff should be corrected
before any other bugs, because such problems prevent not very
experienced users (like me, at the moment) from testing the software
itself.


NE>> Hi !

NE>>   It seems, BETA2 of mod_python 3 is not compatible with
NE>> Apache-2.0.42. It builds successfully, but when apache is asked to
NE>> test new configuration it complains about undefined symbol "openpty"
NE>> while trying to load mod_python into the server.

PvO> Maybe this previous post will help:

PvO> ----- Original Message -----
PvO> From: "Carl C." <cc@carlc.com>
PvO> Subject: Re: [mod_python] Compiling a DSO module for RedHat Linux on ALPHA
PvO> 64bit.
PvO> Guess, what... I FIXED IT...
PvO> I had to edit the mod_python's src/Makefile and change the
PvO> LIBS=-lm? /usr/src/Python-2.2-no-threads/libpython2.2.a
PvO> to
PvO> LIBS=-lm? /usr/src/Python-2.2-no-threads/libpython2.2.a -lutil
PvO> That -lutil was the magic!
PvO> Carl

---
Neo Eureka / mailto:neo@https.ru


From neo at https.ru  Sun Oct  6 18:25:52 2002
From: neo at https.ru (Neo)
Date: Fri Jan  9 22:03:32 2004
Subject: [mod_python] Segfaults... segfaults...
Message-ID: <19513182194.20021006182552@https.ru>

  Hi all !

  I was just playing with mod_python 3 & Apache 2.0.42
(RedHat Linux 7.2). Below are my "mptest.py" file, Apache VH config
and the resuts of the single request:

GET /mptest.py


----------------BEGIN----------------
from mod_python import apache


interp = None

def transhandler(req):
    interp = req.interpreter
    return apache.OK

def handler(req):
    req.write(repr(interp))
    return apache.OK
-----------------END-----------------

Config for virtual host:
----------------BEGIN----------------
<VirtualHost *>
[... skipped ...]

    PythonPath    "..."

    PythonDebug On
    PythonTransHandler mptest
    SetHandler python-program
    PythonHandler mptest

    <Directory "/home/w-https/test-www">
        Options Indexes FollowSymLinks
        AllowOverride None

        Order allow,deny
        Allow from all

        DirectoryIndex index.html index.htm index.html.var

        AddDefaultCharset UTF-8
    </Directory>

[... skipped ...]
</VirtualHost>
-----------------END-----------------

Apache virtualhost log file:
----------------BEGIN----------------
[Sun Oct 06 18:02:44 2002] [info] [client 212.188.98.243] Module bug?
Request filename is missing for URI /mptest.py
-----------------END-----------------

*** I guess "transhandler" in the above example should somehow set
    filename for incoming request for Apache to be happy? But SEGFAULT
    is not the best action to report the error :)

Apache main server log file:
----------------BEGIN----------------
[Sun Oct 06 18:02:45 2002] [notice] child pid 12331 exit signal
Segmentation fault (11) 
-----------------END-----------------


---
Neo Eureka / mailto:neo@https.ru


From michaelteo at bigfoot.com  Mon Oct  7 17:55:51 2002
From: michaelteo at bigfoot.com (Michael Teo)
Date: Fri Jan  9 22:03:32 2004
Subject: [mod_python] Module conflicts on mod_python
Message-ID: <20021007095551.GA4290@bigfoot.com>

Hi, I am fortunate enough to be able deploy mod_python on a commercial web
server. 

However, I am currently being plagued by this problem.
I am running Apache 1.3.27 with mod_python 2.7.8 and python 2.2.1.
Virtualname hosting is enabled on Apache to allow virtual domainname hosting.

Now, say domain A and domain B has some mod_python publisher scripts which
import a session.py script. Only one session.py in either domain A or domain
B is loaded. However, the implementation of session.py is very different in
both domains and this causes a whole lot of errors on either A or B scripts.

Is there a misconfiguration in my httpd.conf, or is that supposed to be the
part of the feature with mod_python ?
Any advice will be greatly appreciated.
Thanks in advance.



The following are the contents of the .htaccess file in the cgi-bin 
directories. PythonPath are modified accordingly to the domainA and domainB.

AddHandler python-program .py .pyc
PythonHandler mod_python.publisher
PythonPath "sys.path + [ '/home/www/domainA/public_html/cgi-bin' ]



-- 
Michael Teo <mailto:michaelteo@bigfoot.com>
http://miketeo.net/
PGP  0x6C846A9C  DB:7D:51:D4:4D:AB:97:79:E4:68:D9:07:94:36:D5:1A:6C:84:6A:9C
     0x6937FB05  08:50:A1:4D:2E:45:58:60:DE:71:1F:30:63:54:EF:7B

From rmunn at pobox.com  Mon Oct  7 09:06:37 2002
From: rmunn at pobox.com (rmunn@pobox.com)
Date: Fri Jan  9 22:03:32 2004
Subject: [mod_python] Module conflicts on mod_python
In-Reply-To: <20021007095551.GA4290@bigfoot.com>
References: <20021007095551.GA4290@bigfoot.com>
Message-ID: <20021007140637.GA5212@rmunnlfs>

On Mon, Oct 07, 2002 at 05:55:51PM +0800, Michael Teo wrote:
> 
> Hi, I am fortunate enough to be able deploy mod_python on a commercial web
> server. 
> 
> However, I am currently being plagued by this problem.
> I am running Apache 1.3.27 with mod_python 2.7.8 and python 2.2.1.
> Virtualname hosting is enabled on Apache to allow virtual domainname hosting.
> 
> Now, say domain A and domain B has some mod_python publisher scripts which
> import a session.py script. Only one session.py in either domain A or domain
> B is loaded. However, the implementation of session.py is very different in
> both domains and this causes a whole lot of errors on either A or B scripts.
> 
> Is there a misconfiguration in my httpd.conf, or is that supposed to be the
> part of the feature with mod_python ?
> Any advice will be greatly appreciated.
> Thanks in advance.
> 
> 
> 
> The following are the contents of the .htaccess file in the cgi-bin 
> directories. PythonPath are modified accordingly to the domainA and domainB.
> 
> AddHandler python-program .py .pyc
> PythonHandler mod_python.publisher
> PythonPath "sys.path + [ '/home/www/domainA/public_html/cgi-bin' ]
> 

Do you have the PythonInterpPerDirectory directive turned on? It would
allow domain A and domain B's scripts to run in separate Python
interpreters with completely separate namespaces, so their session.py
scripts could not conflict with each other. For more information:

http://www.modpython.org/live/mod_python-2.7.8/doc-html/dir-other-ipd.html

-- 
Robin Munn
rmunn@pobox.com
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20021007/bc29ddb4/attachment-0003.bin
From rmunn at pobox.com  Tue Oct  8 12:34:46 2002
From: rmunn at pobox.com (rmunn@pobox.com)
Date: Fri Jan  9 22:03:32 2004
Subject: [mod_python] Segfault when using PythonImport directive
Message-ID: <20021008173446.GB5212@rmunnlfs>

I'm using mod_python 3.0.0 BETA 2 with Apache 2.0.42 and encountering a
segfault every time I try to use the PythonInclude directive. The
segfault occurs even when I try to have Apache do a configuration syntax
check (/usr/apache2/bin/apachectl configtest). I've narrowed it down to
a single PythonInclude line. This is the <Directory> directive in which
the PythonInclude directive appears:


<Directory /var/www/publisher>
    AddHandler python-program .py
    PythonHandler mod_python.publisher
    PythonInterpPerDirective On
    PythonImport globals
</Directory>


If I comment out the "PythonImport globals" line, everything runs fine.

Here's the contents of my /var/www/publisher directory:


rmunn@localhost:/var/www/publisher$ ls -l
total 8
-rw-r--r--    1 rmunn    users          12 Oct  7 19:22 globals.py
-rw-r--r--    1 rmunn    users         133 Oct  8 12:26 tryme.py
rmunn@localhost:/var/www/publisher$ cat globals.py 
foo = 'bar'
rmunn@localhost:/var/www/publisher$ cat tryme.py 
def show(req, name):
    try:
        return str(globals.foo)
    except AttributeError, NameError:
        return str(dir(globals))


As you can see, what I'm trying to do is have some global variables
pre-defined in my mod_python scripts; I plan on using this to accomplish
expensive operations (like opening database connections) once per apache
process child instead of once per request.

Here's the gdb backtrace of my segfault. I'm running httpd -t to only
get a configuration syntax check and it's still failing. Any ideas?


root@localhost:/usr/apache2/conf# gdb ../bin/httpd 
GNU gdb 5.2.1
Copyright 2002 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you
are
welcome to change it and/or distribute copies of it under certain
conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for
details.
This GDB was configured as "i686-pc-linux-gnu"...
(gdb) run -t
Starting program: /usr/apache2/bin/httpd -t
[New Thread 1024 (LWP 29765)]

Program received signal SIGSEGV, Segmentation fault.
[Switching to Thread 1024 (LWP 29765)]
__pthread_mutex_lock (mutex=0x10) at mutex.c:99
99      mutex.c: No such file or directory.
        in mutex.c
(gdb) backtrace full
#0  __pthread_mutex_lock (mutex=0x10) at mutex.c:99
        mutex = (pthread_mutex_t *) 0x10
        self = 0x0
#1  0x403d8f43 in PyThread_acquire_lock (lock=0x0, waitflag=1) at
Python/thread_pthread.h:359
        lock = 0x0
        success = 1078103364
        status = 0
        error = 0
#2  0x403bbb4e in PyEval_AcquireLock () at Python/ceval.c:267
No locals.
#3  0x4037c1b3 in directive_PythonImport (cmd=0xbffffc30,
mconfig=0x80e0958, module=0x80e0e28 "globals") at mod_python.c:1220
        cmd = (cmd_parms *) 0x0
        mconfig = (void *) 0x0
        module = 0x0
#4  0x08067349 in invoke_cmd (cmd=0x4040d154, parms=0xbffffc30,
mconfig=0x80e0958, args=0x80d594f "") at config.c:800
        w = 0x80e0e28 "globals"
        w2 = 0xbffffc30 ""
        w3 = 0x4040d154 "\231n?@\234Á7@"
        errmsg = 0x0
#5  0x08067a53 in ap_walk_config_sub (current=0x80d5928,
parms=0xbffffc30, section_vector=0x80e05f0) at config.c:1082
        dir_config = (void *) 0x4040d154
        retval = 0x4040d154 "\231n?@\234Á7@"
        cmd = (command_rec *) 0x4040d154
        current = (ap_directive_t *) 0x80d5928
        parms = (cmd_parms *) 0xbffffc30
        mod = (module *) 0x4040d2e0
#6  0x08067ad1 in ap_walk_config (current=0x80d5850, parms=0xbffffc30,
section_vector=0x80e05f0) at config.c:1121
        errmsg = 0x0
        current = (ap_directive_t *) 0x80d5928
        parms = (cmd_parms *) 0xbffffc30
        oldconfig = (ap_conf_vector_t *) 0x80b3488
#7  0x08074beb in dirsection (cmd=0xbffffc30, mconfig=0x80b3598,
arg=0x80e0792 "") at core.c:1625
        cmd = (cmd_parms *) 0xbffffc30
        errmsg = 0x0
        endp = 0x80e07e0 ""
        old_overrides = 150
        old_path = 0x0
        conf = (core_dir_config *) 0x80e07e0
        new_dir_conf = (ap_conf_vector_t *) 0x80e05f0
        r = (regex_t *) 0x0
        thiscmd = (command_rec *) 0x8088bec
        err = 0x0
#8  0x08066e6e in invoke_cmd (cmd=0x8088bec, parms=0xbffffc30,
mconfig=0x80b3598, args=0x80d5828 "/var/www/publisher>") at config.c:713
        w = 0x80d5808 "øW\r\b(X\r\b"
        w2 = 0xbffffc30 ""
        w3 = 0x4040d154 "\231n?@\234Á7@"
        errmsg = 0x0
#9  0x08067a53 in ap_walk_config_sub (current=0x80d5808,
parms=0xbffffc30, section_vector=0x80b3488) at config.c:1082
        dir_config = (void *) 0x4040d154
        retval = 0x4040d154 "\231n?@\234Á7@"
        cmd = (command_rec *) 0x8088bec
        current = (ap_directive_t *) 0x80d5808
        parms = (cmd_parms *) 0xbffffc30
        mod = (module *) 0x808ed60
#10 0x08067ad1 in ap_walk_config (current=0x80b49d0, parms=0xbffffc30,
section_vector=0x80b3488) at config.c:1121
        errmsg = 0x0
        current = (ap_directive_t *) 0x80d5808
        parms = (cmd_parms *) 0xbffffc30
        oldconfig = (ap_conf_vector_t *) 0x0
#11 0x080684e0 in ap_process_config_tree (s=0x80b2ec8,
conftree=0x80b49d0, p=0x8098d10, ptemp=0x80c4dc0) at config.c:1583
        s = (server_rec *) 0x4040d154
        p = (apr_pool_t *) 0x8098d10
        ptemp = (apr_pool_t *) 0x0
        errmsg = 0x808defc ""
        parms = {info = 0x0, override = 95, limited = -1,
limited_xmethods = 0x0, xlimited = 0x0, config_file = 0x0, directive =
0x80d5928, pool = 0x8098d10, 
  temp_pool = 0x80c4dc0, server = 0x80b2ec8, path = 0x80e07c8
"/var/www/publisher/", cmd = 0x4040d154, context = 0x80e05f0,
err_directive = 0x0}
#12 0x0806a811 in main (argc=2, argv=0xbffffd44) at main.c:564
        c = 116 't'
        configtestonly = 1
        confname = 0x8086518 "conf/httpd.conf"
        def_server_root = 0x8086528 "/usr/apache2"
        temp_error_log = 0x0
        process = (process_rec *) 0x8096d88
        server_conf = (server_rec *) 0x80b2ec8
        pglobal = (apr_pool_t *) 0x8096d08
        pconf = (apr_pool_t *) 0x8098d10
        plog = (apr_pool_t *) 0x80c2db8
        ptemp = (apr_pool_t *) 0x80c4dc0
        pcommands = (apr_pool_t *) 0x80c0db0
        opt = (apr_getopt_t *) 0x80c0e48
        rv = 0
        mod = (module **) 0x80b2ec8
        optarg = 0x0
        signal_server = (apr_OFN_ap_signal_server_t *) 0x4040d154
<python_commands+264>
#13 0x40189571 in __libc_start_main (main=0x806a370 <main>, argc=2,
ubp_av=0xbffffd44, init=0x805b824 <_init>, fini=0x80812e0 <_fini>,
rtld_fini=0x4000aa24 <_dl_fini>, 
    stack_end=0xbffffd3c) at ../sysdeps/generic/libc-start.c:129
        ubp_av = (char **) 0xbffffd44
        fini = (void (*)()) 0x400154ac <_dl_debug_mask>
        rtld_fini = (void (*)()) 0x80e0e28
        ubp_ev = (char **) 0x0


-- 
Robin Munn
rmunn@pobox.com
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20021008/e6c4c75b/attachment-0003.bin
From neel at mediapulse.com  Tue Oct  8 16:33:19 2002
From: neel at mediapulse.com (Michael C. Neel)
Date: Fri Jan  9 22:03:32 2004
Subject: [mod_python] Segfault when using PythonImport directive
Message-ID: <C0FC22C08B82074A88B50061764157775BC2@johnson.mediapulse.net>

Not addressing the segfault, couldn't you handle globals in the python
program itself?  I do this for database handles my self:

from mod_python import apache
import MySQLdb

db = MySQLdb.connect("yada yada")

def handler(req):
	do cool db stuff with req here

I do this often, and I've checked that each request doesn't generate a
db connection by watching the MySQL number of connects.  One thing to
keep in mind is that a db handle may go stale if not used by some
databases, so be sure to add some code to test out the db handle each
request and reconnect if needed.  The DB API 2.0 spec doesn't define a
ping method like perl's DBI does, so I usually add one myself for this.

Mike

--
Michael C. Neel
Director of Software Development
Mediapulse, Inc.
 

-----Original Message-----
From: rmunn@pobox.com [mailto:rmunn@pobox.com] 
Sent: Tuesday, October 08, 2002 1:35 PM
To: mod_python@modpython.org
Subject: [mod_python] Segfault when using PythonImport directive


I'm using mod_python 3.0.0 BETA 2 with Apache 2.0.42 and encountering a
segfault every time I try to use the PythonInclude directive. The
segfault occurs even when I try to have Apache do a configuration syntax
check (/usr/apache2/bin/apachectl configtest). I've narrowed it down to
a single PythonInclude line. This is the <Directory> directive in which
the PythonInclude directive appears:


<Directory /var/www/publisher>
    AddHandler python-program .py
    PythonHandler mod_python.publisher
    PythonInterpPerDirective On
    PythonImport globals
</Directory>


If I comment out the "PythonImport globals" line, everything runs fine.

Here's the contents of my /var/www/publisher directory:


rmunn@localhost:/var/www/publisher$ ls -l
total 8
-rw-r--r--    1 rmunn    users          12 Oct  7 19:22 globals.py
-rw-r--r--    1 rmunn    users         133 Oct  8 12:26 tryme.py
rmunn@localhost:/var/www/publisher$ cat globals.py 
foo = 'bar'
rmunn@localhost:/var/www/publisher$ cat tryme.py 
def show(req, name):
    try:
        return str(globals.foo)
    except AttributeError, NameError:
        return str(dir(globals))


As you can see, what I'm trying to do is have some global variables
pre-defined in my mod_python scripts; I plan on using this to accomplish
expensive operations (like opening database connections) once per apache
process child instead of once per request.

Here's the gdb backtrace of my segfault. I'm running httpd -t to only
get a configuration syntax check and it's still failing. Any ideas?


root@localhost:/usr/apache2/conf# gdb ../bin/httpd 
GNU gdb 5.2.1
Copyright 2002 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you
are
welcome to change it and/or distribute copies of it under certain
conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for
details.
This GDB was configured as "i686-pc-linux-gnu"...
(gdb) run -t
Starting program: /usr/apache2/bin/httpd -t
[New Thread 1024 (LWP 29765)]

Program received signal SIGSEGV, Segmentation fault.
[Switching to Thread 1024 (LWP 29765)]
__pthread_mutex_lock (mutex=0x10) at mutex.c:99
99      mutex.c: No such file or directory.
        in mutex.c
(gdb) backtrace full
#0  __pthread_mutex_lock (mutex=0x10) at mutex.c:99
        mutex = (pthread_mutex_t *) 0x10
        self = 0x0
#1  0x403d8f43 in PyThread_acquire_lock (lock=0x0, waitflag=1) at
Python/thread_pthread.h:359
        lock = 0x0
        success = 1078103364
        status = 0
        error = 0
#2  0x403bbb4e in PyEval_AcquireLock () at Python/ceval.c:267
No locals.
#3  0x4037c1b3 in directive_PythonImport (cmd=0xbffffc30,
mconfig=0x80e0958, module=0x80e0e28 "globals") at mod_python.c:1220
        cmd = (cmd_parms *) 0x0
        mconfig = (void *) 0x0
        module = 0x0
#4  0x08067349 in invoke_cmd (cmd=0x4040d154, parms=0xbffffc30,
mconfig=0x80e0958, args=0x80d594f "") at config.c:800
        w = 0x80e0e28 "globals"
        w2 = 0xbffffc30 ""
        w3 = 0x4040d154 "\231n?@\234?7@"
        errmsg = 0x0
#5  0x08067a53 in ap_walk_config_sub (current=0x80d5928,
parms=0xbffffc30, section_vector=0x80e05f0) at config.c:1082
        dir_config = (void *) 0x4040d154
        retval = 0x4040d154 "\231n?@\234?7@"
        cmd = (command_rec *) 0x4040d154
        current = (ap_directive_t *) 0x80d5928
        parms = (cmd_parms *) 0xbffffc30
        mod = (module *) 0x4040d2e0
#6  0x08067ad1 in ap_walk_config (current=0x80d5850, parms=0xbffffc30,
section_vector=0x80e05f0) at config.c:1121
        errmsg = 0x0
        current = (ap_directive_t *) 0x80d5928
        parms = (cmd_parms *) 0xbffffc30
        oldconfig = (ap_conf_vector_t *) 0x80b3488
#7  0x08074beb in dirsection (cmd=0xbffffc30, mconfig=0x80b3598,
arg=0x80e0792 "") at core.c:1625
        cmd = (cmd_parms *) 0xbffffc30
        errmsg = 0x0
        endp = 0x80e07e0 ""
        old_overrides = 150
        old_path = 0x0
        conf = (core_dir_config *) 0x80e07e0
        new_dir_conf = (ap_conf_vector_t *) 0x80e05f0
        r = (regex_t *) 0x0
        thiscmd = (command_rec *) 0x8088bec
        err = 0x0
#8  0x08066e6e in invoke_cmd (cmd=0x8088bec, parms=0xbffffc30,
mconfig=0x80b3598, args=0x80d5828 "/var/www/publisher>") at config.c:713
        w = 0x80d5808 "?W\r\b(X\r\b"
        w2 = 0xbffffc30 ""
        w3 = 0x4040d154 "\231n?@\234?7@"
        errmsg = 0x0
#9  0x08067a53 in ap_walk_config_sub (current=0x80d5808,
parms=0xbffffc30, section_vector=0x80b3488) at config.c:1082
        dir_config = (void *) 0x4040d154
        retval = 0x4040d154 "\231n?@\234?7@"
        cmd = (command_rec *) 0x8088bec
        current = (ap_directive_t *) 0x80d5808
        parms = (cmd_parms *) 0xbffffc30
        mod = (module *) 0x808ed60
#10 0x08067ad1 in ap_walk_config (current=0x80b49d0, parms=0xbffffc30,
section_vector=0x80b3488) at config.c:1121
        errmsg = 0x0
        current = (ap_directive_t *) 0x80d5808
        parms = (cmd_parms *) 0xbffffc30
        oldconfig = (ap_conf_vector_t *) 0x0
#11 0x080684e0 in ap_process_config_tree (s=0x80b2ec8,
conftree=0x80b49d0, p=0x8098d10, ptemp=0x80c4dc0) at config.c:1583
        s = (server_rec *) 0x4040d154
        p = (apr_pool_t *) 0x8098d10
        ptemp = (apr_pool_t *) 0x0
        errmsg = 0x808defc ""
        parms = {info = 0x0, override = 95, limited = -1,
limited_xmethods = 0x0, xlimited = 0x0, config_file = 0x0, directive =
0x80d5928, pool = 0x8098d10, 
  temp_pool = 0x80c4dc0, server = 0x80b2ec8, path = 0x80e07c8
"/var/www/publisher/", cmd = 0x4040d154, context = 0x80e05f0,
err_directive = 0x0}
#12 0x0806a811 in main (argc=2, argv=0xbffffd44) at main.c:564
        c = 116 't'
        configtestonly = 1
        confname = 0x8086518 "conf/httpd.conf"
        def_server_root = 0x8086528 "/usr/apache2"
        temp_error_log = 0x0
        process = (process_rec *) 0x8096d88
        server_conf = (server_rec *) 0x80b2ec8
        pglobal = (apr_pool_t *) 0x8096d08
        pconf = (apr_pool_t *) 0x8098d10
        plog = (apr_pool_t *) 0x80c2db8
        ptemp = (apr_pool_t *) 0x80c4dc0
        pcommands = (apr_pool_t *) 0x80c0db0
        opt = (apr_getopt_t *) 0x80c0e48
        rv = 0
        mod = (module **) 0x80b2ec8
        optarg = 0x0
        signal_server = (apr_OFN_ap_signal_server_t *) 0x4040d154
<python_commands+264>
#13 0x40189571 in __libc_start_main (main=0x806a370 <main>, argc=2,
ubp_av=0xbffffd44, init=0x805b824 <_init>, fini=0x80812e0 <_fini>,
rtld_fini=0x4000aa24 <_dl_fini>, 
    stack_end=0xbffffd3c) at ../sysdeps/generic/libc-start.c:129
        ubp_av = (char **) 0xbffffd44
        fini = (void (*)()) 0x400154ac <_dl_debug_mask>
        rtld_fini = (void (*)()) 0x80e0e28
        ubp_ev = (char **) 0x0


-- 
Robin Munn
rmunn@pobox.com


From jack_diederich at email.com  Tue Oct  8 16:03:52 2002
From: jack_diederich at email.com (Jack Diederich)
Date: Fri Jan  9 22:03:32 2004
Subject: [mod_python] Segfault when using PythonImport directive
Message-ID: <20021008210352.6095.qmail@email.com>

Cut N Pasted from a python-dev@httpd.apache.org email last month
since I don't know where an archive would be.

I was talking about mod_python 2.x with apahce 1.x 
But I would be willing to guess it is the same problem.

-jack



you can never garuntee that python_init() will be called only once.
All memory allocated from the original pool is freed before the next
call to python_init()
just having the single python_imports table seems to avoid this for
some reason, but it isn't garunteed (I don't want to know what
happens on USR1).

we need a cleanup func that just resets the python_imports state
between calls to python_init()

/* This func can go anywhere above directive_PythonImports */
void cleanup_python_imports(void *data)
{
  python_imports = NULL;
}
/* This line needs to go in directive_PythonImports in the if block
where we call ap_make_table */
ap_register_cleanup(cmd->pool, NULL,
cleanup_python_imports, ap_null_cleanup);


The end result is that we remake the table if python_init() is called
more than once.  This is OK because the configuration is also reread.
 We don't have to worry about the global 'interpreters' variable
because it is allocated by Python outside of apache's memory
management, but we might have a small memory leak if we get USR1'd
over and over again because it is never Py_DECREF'd in
python_finalize.  On the other hand, Py_Finalize() is probably smart
enough to take of that for us.
----- Original Message -----
From: "Michael C. Neel" <neel@mediapulse.com>
Date: Tue, 8 Oct 2002 16:33:19 -0400 
To: <rmunn@pobox.com>, <mod_python@modpython.org>
Subject: RE: [mod_python] Segfault when using PythonImport directive


> Not addressing the segfault, couldn't you handle globals in the python
> program itself?  I do this for database handles my self:
> 
> from mod_python import apache
> import MySQLdb
> 
> db = MySQLdb.connect("yada yada")
> 
> def handler(req):
> 	do cool db stuff with req here
> 
> I do this often, and I've checked that each request doesn't generate a
> db connection by watching the MySQL number of connects.  One thing to
> keep in mind is that a db handle may go stale if not used by some
> databases, so be sure to add some code to test out the db handle each
> request and reconnect if needed.  The DB API 2.0 spec doesn't define a
> ping method like perl's DBI does, so I usually add one myself for this.
> 
> Mike
> 
> --
> Michael C. Neel
> Director of Software Development
> Mediapulse, Inc.
>  
> 
> -----Original Message-----
> From: rmunn@pobox.com [mailto:rmunn@pobox.com] 
> Sent: Tuesday, October 08, 2002 1:35 PM
> To: mod_python@modpython.org
> Subject: [mod_python] Segfault when using PythonImport directive
> 
> 
> I'm using mod_python 3.0.0 BETA 2 with Apache 2.0.42 and encountering a
> segfault every time I try to use the PythonInclude directive. The
> segfault occurs even when I try to have Apache do a configuration syntax
> check (/usr/apache2/bin/apachectl configtest). I've narrowed it down to
> a single PythonInclude line. This is the <Directory> directive in which
> the PythonInclude directive appears:
> 
> 
> <Directory /var/www/publisher>
>     AddHandler python-program .py
>     PythonHandler mod_python.publisher
>     PythonInterpPerDirective On
>     PythonImport globals
> </Directory>
> 
> 
> If I comment out the "PythonImport globals" line, everything runs fine.
> 
> Here's the contents of my /var/www/publisher directory:
> 
> 
> rmunn@localhost:/var/www/publisher$ ls -l
> total 8
> -rw-r--r--    1 rmunn    users          12 Oct  7 19:22 globals.py
> -rw-r--r--    1 rmunn    users         133 Oct  8 12:26 tryme.py
> rmunn@localhost:/var/www/publisher$ cat globals.py 
> foo = 'bar'
> rmunn@localhost:/var/www/publisher$ cat tryme.py 
> def show(req, name):
>     try:
>         return str(globals.foo)
>     except AttributeError, NameError:
>         return str(dir(globals))
> 
> 
> As you can see, what I'm trying to do is have some global variables
> pre-defined in my mod_python scripts; I plan on using this to accomplish
> expensive operations (like opening database connections) once per apache
> process child instead of once per request.
> 
> Here's the gdb backtrace of my segfault. I'm running httpd -t to only
> get a configuration syntax check and it's still failing. Any ideas?
> 
> 
> root@localhost:/usr/apache2/conf# gdb ../bin/httpd 
> GNU gdb 5.2.1
> Copyright 2002 Free Software Foundation, Inc.
> GDB is free software, covered by the GNU General Public License, and you
> are
> welcome to change it and/or distribute copies of it under certain
> conditions.
> Type "show copying" to see the conditions.
> There is absolutely no warranty for GDB.  Type "show warranty" for
> details.
> This GDB was configured as "i686-pc-linux-gnu"...
> (gdb) run -t
> Starting program: /usr/apache2/bin/httpd -t
> [New Thread 1024 (LWP 29765)]
> 
> Program received signal SIGSEGV, Segmentation fault.
> [Switching to Thread 1024 (LWP 29765)]
> __pthread_mutex_lock (mutex=0x10) at mutex.c:99
> 99      mutex.c: No such file or directory.
>         in mutex.c
> (gdb) backtrace full
> #0  __pthread_mutex_lock (mutex=0x10) at mutex.c:99
>         mutex = (pthread_mutex_t *) 0x10
>         self = 0x0
> #1  0x403d8f43 in PyThread_acquire_lock (lock=0x0, waitflag=1) at
> Python/thread_pthread.h:359
>         lock = 0x0
>         success = 1078103364
>         status = 0
>         error = 0
> #2  0x403bbb4e in PyEval_AcquireLock () at Python/ceval.c:267
> No locals.
> #3  0x4037c1b3 in directive_PythonImport (cmd=0xbffffc30,
> mconfig=0x80e0958, module=0x80e0e28 "globals") at mod_python.c:1220
>         cmd = (cmd_parms *) 0x0
>         mconfig = (void *) 0x0
>         module = 0x0
> #4  0x08067349 in invoke_cmd (cmd=0x4040d154, parms=0xbffffc30,
> mconfig=0x80e0958, args=0x80d594f "") at config.c:800
>         w = 0x80e0e28 "globals"
>         w2 = 0xbffffc30 ""
>         w3 = 0x4040d154 "\231n?@\234?7@"
>         errmsg = 0x0
> #5  0x08067a53 in ap_walk_config_sub (current=0x80d5928,
> parms=0xbffffc30, section_vector=0x80e05f0) at config.c:1082
>         dir_config = (void *) 0x4040d154
>         retval = 0x4040d154 "\231n?@\234?7@"
>         cmd = (command_rec *) 0x4040d154
>         current = (ap_directive_t *) 0x80d5928
>         parms = (cmd_parms *) 0xbffffc30
>         mod = (module *) 0x4040d2e0
> #6  0x08067ad1 in ap_walk_config (current=0x80d5850, parms=0xbffffc30,
> section_vector=0x80e05f0) at config.c:1121
>         errmsg = 0x0
>         current = (ap_directive_t *) 0x80d5928
>         parms = (cmd_parms *) 0xbffffc30
>         oldconfig = (ap_conf_vector_t *) 0x80b3488
> #7  0x08074beb in dirsection (cmd=0xbffffc30, mconfig=0x80b3598,
> arg=0x80e0792 "") at core.c:1625
>         cmd = (cmd_parms *) 0xbffffc30
>         errmsg = 0x0
>         endp = 0x80e07e0 ""
>         old_overrides = 150
>         old_path = 0x0
>         conf = (core_dir_config *) 0x80e07e0
>         new_dir_conf = (ap_conf_vector_t *) 0x80e05f0
>         r = (regex_t *) 0x0
>         thiscmd = (command_rec *) 0x8088bec
>         err = 0x0
> #8  0x08066e6e in invoke_cmd (cmd=0x8088bec, parms=0xbffffc30,
> mconfig=0x80b3598, args=0x80d5828 "/var/www/publisher>") at config.c:713
>         w = 0x80d5808 "?W\r\b(X\r\b"
>         w2 = 0xbffffc30 ""
>         w3 = 0x4040d154 "\231n?@\234?7@"
>         errmsg = 0x0
> #9  0x08067a53 in ap_walk_config_sub (current=0x80d5808,
> parms=0xbffffc30, section_vector=0x80b3488) at config.c:1082
>         dir_config = (void *) 0x4040d154
>         retval = 0x4040d154 "\231n?@\234?7@"
>         cmd = (command_rec *) 0x8088bec
>         current = (ap_directive_t *) 0x80d5808
>         parms = (cmd_parms *) 0xbffffc30
>         mod = (module *) 0x808ed60
> #10 0x08067ad1 in ap_walk_config (current=0x80b49d0, parms=0xbffffc30,
> section_vector=0x80b3488) at config.c:1121
>         errmsg = 0x0
>         current = (ap_directive_t *) 0x80d5808
>         parms = (cmd_parms *) 0xbffffc30
>         oldconfig = (ap_conf_vector_t *) 0x0
> #11 0x080684e0 in ap_process_config_tree (s=0x80b2ec8,
> conftree=0x80b49d0, p=0x8098d10, ptemp=0x80c4dc0) at config.c:1583
>         s = (server_rec *) 0x4040d154
>         p = (apr_pool_t *) 0x8098d10
>         ptemp = (apr_pool_t *) 0x0
>         errmsg = 0x808defc ""
>         parms = {info = 0x0, override = 95, limited = -1,
> limited_xmethods = 0x0, xlimited = 0x0, config_file = 0x0, directive =
> 0x80d5928, pool = 0x8098d10, 
>   temp_pool = 0x80c4dc0, server = 0x80b2ec8, path = 0x80e07c8
> "/var/www/publisher/", cmd = 0x4040d154, context = 0x80e05f0,
> err_directive = 0x0}
> #12 0x0806a811 in main (argc=2, argv=0xbffffd44) at main.c:564
>         c = 116 't'
>         configtestonly = 1
>         confname = 0x8086518 "conf/httpd.conf"
>         def_server_root = 0x8086528 "/usr/apache2"
>         temp_error_log = 0x0
>         process = (process_rec *) 0x8096d88
>         server_conf = (server_rec *) 0x80b2ec8
>         pglobal = (apr_pool_t *) 0x8096d08
>         pconf = (apr_pool_t *) 0x8098d10
>         plog = (apr_pool_t *) 0x80c2db8
>         ptemp = (apr_pool_t *) 0x80c4dc0
>         pcommands = (apr_pool_t *) 0x80c0db0
>         opt = (apr_getopt_t *) 0x80c0e48
>         rv = 0
>         mod = (module **) 0x80b2ec8
>         optarg = 0x0
>         signal_server = (apr_OFN_ap_signal_server_t *) 0x4040d154
> <python_commands+264>
> #13 0x40189571 in __libc_start_main (main=0x806a370 <main>, argc=2,
> ubp_av=0xbffffd44, init=0x805b824 <_init>, fini=0x80812e0 <_fini>,
> rtld_fini=0x4000aa24 <_dl_fini>, 
>     stack_end=0xbffffd3c) at ../sysdeps/generic/libc-start.c:129
>         ubp_av = (char **) 0xbffffd44
>         fini = (void (*)()) 0x400154ac <_dl_debug_mask>
>         rtld_fini = (void (*)()) 0x80e0e28
>         ubp_ev = (char **) 0x0
> 
> 
> -- 
> Robin Munn
> rmunn@pobox.com
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 
> 

-- 
__________________________________________________________
Sign-up for your own FREE Personalized E-mail at Mail.com
http://www.mail.com/?sr=signup


"Free price comparison tool gives you the best prices and cash back!"
http://www.bestbuyfinder.com/download.htm


From grisha at modpython.org  Sat Oct 12 16:08:37 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:03:32 2004
Subject: [mod_python] Segfaults... segfaults...
In-Reply-To: <19513182194.20021006182552@https.ru>
Message-ID: <Pine.BSF.4.32.0210121602380.17605-100000@eden.ispol.com>

I traced this to a bug in mod_negotiation.c - it didn't like r->fileinfo
being null, I submitted a patch for it, so hopefully it will be fixed in
next release of httpd.

Grisha

On Sun, 6 Oct 2002, Neo wrote:

>
>   Hi all !
>
>   I was just playing with mod_python 3 & Apache 2.0.42
> (RedHat Linux 7.2). Below are my "mptest.py" file, Apache VH config
> and the resuts of the single request:
>
> GET /mptest.py
>
>
> ----------------BEGIN----------------
> from mod_python import apache
>
>
> interp = None
>
> def transhandler(req):
>     interp = req.interpreter
>     return apache.OK
>
> def handler(req):
>     req.write(repr(interp))
>     return apache.OK
> -----------------END-----------------
>
> Config for virtual host:
> ----------------BEGIN----------------
> <VirtualHost *>
> [... skipped ...]
>
>     PythonPath    "..."
>
>     PythonDebug On
>     PythonTransHandler mptest
>     SetHandler python-program
>     PythonHandler mptest
>
>     <Directory "/home/w-https/test-www">
>         Options Indexes FollowSymLinks
>         AllowOverride None
>
>         Order allow,deny
>         Allow from all
>
>         DirectoryIndex index.html index.htm index.html.var
>
>         AddDefaultCharset UTF-8
>     </Directory>
>
> [... skipped ...]
> </VirtualHost>
> -----------------END-----------------
>
> Apache virtualhost log file:
> ----------------BEGIN----------------
> [Sun Oct 06 18:02:44 2002] [info] [client 212.188.98.243] Module bug?
> Request filename is missing for URI /mptest.py
> -----------------END-----------------
>
> *** I guess "transhandler" in the above example should somehow set
>     filename for incoming request for Apache to be happy? But SEGFAULT
>     is not the best action to report the error :)
>
> Apache main server log file:
> ----------------BEGIN----------------
> [Sun Oct 06 18:02:45 2002] [notice] child pid 12331 exit signal
> Segmentation fault (11)
> -----------------END-----------------
>
>
> ---
> Neo Eureka / mailto:neo@https.ru
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From grisha at ispol.com  Tue Oct 15 13:49:40 2002
From: grisha at ispol.com (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:03:32 2004
Subject: [mod_python] test
Message-ID: <Pine.BSF.4.32.0210151349280.72568-100000@eden.ispol.com>

ignore


From grisha at modpython.org  Tue Oct 15 13:51:38 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:03:32 2004
Subject: [mod_python] BETA 3
Message-ID: <Pine.BSF.4.32.0210151351150.72568-100000@eden.ispol.com>

BETA3 of MP 3 is available for download from
http://www.apache.org/dist/httpd/modpython/

This release features numerous fixes to problems reported on this and the
dev lists, has been tested on linux, solaris, freebsd and windows, and
even includes an example of a gzip filter.

There is also a windows DLL (actually it's a .so file, following the
Apache convention) in that same directory.

Grisha



From derrick.beery at itd.state.ia.us  Tue Oct 15 14:17:56 2002
From: derrick.beery at itd.state.ia.us (Derrick Beery)
Date: Fri Jan  9 22:03:32 2004
Subject: [mod_python] aix, apxs and apache problem
Message-ID: <00B8F67D177CD411BF7200508B6090FD046BB9FD@its-cn-exchange.its.state.ia.us>

Hello,

I am new to Python and interested in capabilities as a web language. I have
downloaded the source for mod_python-2.7.8. I am attempting to configure it
statically or as a DSO, thus far without complete success. The host is an
RS6000 running AIX 4.3.3 and the web server is Apache 1.3.27.

Using gcc version 2.95.3 20010315 (release)

Python was:

./configure --without-threads --with-gcc

Apache:

./configure --with-layout=custom --enable-module=most --enable-module=so

For mod_python I do:

./configure --with-apache=../apache_1.3.27 --with-apxs=/apache/bin/apxs
--with-python=/usr/local/src/Python-2.2.1

No errors. Well, I did have to link to the Makefile:

cd /usr/local/src/Python-2.2.1/Modules
ln -s /usr/local/src/Python-2.2.1/Makefile Makefile

After that, there were no errors following configure.

I then do:

make dso

There were errors until I I added
-bE:/usr/local/src/Python-2.2.1/Modules/python.exp to apxs script:

my $CFG_LDFLAGS_SHLIB = q(-H512 -T512 -bhalt:4 -bM:SRE -bnoentry
-bI:/apache2/libexec/httpd.exp -bE:/apache2/libexec/httpd.exp
-bE:/usr/local/src/Python-2.2.1/Modules/python.exp -lld -lc); # substituted
via Makefile.tmpl

Then no errors, so I do:

make install (as root)

no errors!

Added the following to DSO section of httpd.conf:

LoadModule python_module libexec/mod_python.so

I then attempt to restart httpd:

/apache/bin/apachectl start

This is what I get:

apachectl restart
/apache2/bin/apachectl restart: configuration broken, ignoring restart
/apache2/bin/apachectl restart: (run 'apachectl configtest' for details)
apachectl configtest
Syntax error on line 205 of /apache/conf/httpd.conf:
Can't locate API module structure `python_module' in file
/apache2/libexec/mod_python.so: Function not implemented (python_module)

When I tried statically, apache builds httpd with Python but If I try to add
PHP I get a TOC size error. Apache and just PHP builds and works great. I
did not test Python only version because even if it worked, I cannot use.

Any advice here would be greatly appreciated.

Derrick

From mort at bork.org  Tue Oct 15 16:31:12 2002
From: mort at bork.org (Martin Hicks)
Date: Fri Jan  9 22:03:32 2004
Subject: [mod_python] Sending args to the python script
Message-ID: <20021015203112.GC28708@bork.org>


Hello,

I want to be able to send args to the script through a src URL.  

e.g.,:

<frame ...  src="script/function?arg=blah&name=hoho">

but this doesn't seem to work.  I'm using the Publisher Handler
and mod_python 2.7.8 on debian-sid.

TIA
mh

-- 
Martin Hicks  ||  mort@bork.org  || PGP/GnuPG: 0x4C7F2BEE
plato up 13 days, 22:28, 13 users,  load average: 0.21, 0.07, 0.02
Great Spirits have always encountered opposition from mediocre minds
						-Albert Einstein
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20021015/063544c1/attachment-0003.bin
From grisha at modpython.org  Tue Oct 15 17:48:20 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:03:32 2004
Subject: [mod_python] Sending args to the python script
In-Reply-To: <20021015203112.GC28708@bork.org>
Message-ID: <Pine.BSF.4.32.0210151746470.72568-100000@eden.ispol.com>

It should work. See if you have a req.form variable, and try raising it
with PythonDebug On to see what's in it, e.g.:

def function(req):

	raise `req.form`


On Tue, 15 Oct 2002, Martin Hicks wrote:

>
> Hello,
>
> I want to be able to send args to the script through a src URL.
>
> e.g.,:
>
> <frame ...  src="script/function?arg=blah&name=hoho">
>
> but this doesn't seem to work.  I'm using the Publisher Handler
> and mod_python 2.7.8 on debian-sid.
>
> TIA
> mh
>
> --
> Martin Hicks  ||  mort@bork.org  || PGP/GnuPG: 0x4C7F2BEE
> plato up 13 days, 22:28, 13 users,  load average: 0.21, 0.07, 0.02
> Great Spirits have always encountered opposition from mediocre minds
> 						-Albert Einstein
>


From mort at bork.org  Tue Oct 15 18:09:49 2002
From: mort at bork.org (Martin Hicks)
Date: Fri Jan  9 22:03:32 2004
Subject: [mod_python] Sending args to the python script
In-Reply-To: <Pine.BSF.4.32.0210151746470.72568-100000@eden.ispol.com>
References: <20021015203112.GC28708@bork.org> <Pine.BSF.4.32.0210151746470.72568-100000@eden.ispol.com>
Message-ID: <20021015220949.GE28708@bork.org>

On Tue, Oct 15, 2002 at 05:48:20PM -0400, Gregory (Grisha) Trubetskoy wrote:
>
> It should work. See if you have a req.form variable, and try raising it
> with PythonDebug On to see what's in it, e.g.:
> 
> def function(req):
> 
> 	raise `req.form`

Merci, merci.

I didn't know they came in through req.form.

thanks again,
mh

-- 
Martin Hicks  ||  mort@bork.org  || PGP/GnuPG: 0x4C7F2BEE
plato up 14 days, 8 min, 13 users,  load average: 0.38, 0.21, 0.08
Great Spirits have always encountered opposition from mediocre minds
						-Albert Einstein
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20021015/371c76d9/attachment-0003.bin
From jack_diederich at email.com  Wed Oct 16 23:01:12 2002
From: jack_diederich at email.com (Jack Diederich)
Date: Fri Jan  9 22:03:32 2004
Subject: [mod_python] Apache compile HOWTO
Message-ID: <20021017040112.30584.qmail@email.com>

I saw this on freshmeat,
http://freshmeat.net/releases/100481/

and the homepage is here
http://www.delouw.ch/linux/apache.phtml

It is a HOWTO project that includes mod_perl, mod_php and others,
but as yet doesn't include mod_python.

If anyone would submit a writeup for mod_python
it would be good advocacy.

-jackdied
-- 
__________________________________________________________
Sign-up for your own FREE Personalized E-mail at Mail.com
http://www.mail.com/?sr=signup


From vmanera at manord.com  Thu Oct 17 18:40:17 2002
From: vmanera at manord.com (Manera, Villiam)
Date: Fri Jan  9 22:03:32 2004
Subject: [mod_python] strange behavior of mod-python
Message-ID: <52DC70C1C1575C418CB033523A29CF14104870@exchange2000.manord.com>

I'm currently use mod-python 2.7.6 on apache 1.3.26 - windows 2000 with
python 2.2
apache config:
.....
    ScriptAlias /comm/ "E:/script/cgi/comm/"
    ScriptAlias /tecnico/ "E:/script/cgi/tecnico/"
....
<Directory "E:/script/cgi/comm">
        Order Deny,Allow
        Deny from all
        Allow from .....
       ...
    	AddHandler python-program .py
    	PythonHandler mod_python.publisher
	PythonPath "sys.path+['c:/program
files/python22/lib/site-packages/mdnlib', 'c:/program
files/python22/lib/site-packages/HTMLgen','E:/script/cgi/comm']"
    	PythonDebug on
    </Directory>

----------------------------------------------------
all work fine, but sometimes (today 4 time) when a url is typed:
http://sviluppo.manord.com/comm/comm_ocordiu0.py/main?....

I have this behavior from apache:
HTTP 404 - File non trovato (not found)
Internet Explorer 
but the program is still in place, and the only way to force apache to found
the program is restart the apache services,
or make a copy of comm_ocordiu0 in comm_ocordiu1 and then call this one,
but....



this is not a real problem in developement web server, but  today it
happened 4 time, in production is happened 2 time in one month,
and I become in panic.

Any advice here would be greatly appreciated.

Villiam 

From francoislepoutre at compuserve.com  Fri Oct 18 11:37:16 2002
From: francoislepoutre at compuserve.com (=?iso-8859-1?Q?Fran=E7ois_Lepoutre?=)
Date: Fri Jan  9 22:03:32 2004
Subject: [mod_python] strange behavior of mod-python
Message-ID: <01c27689$f23a4f60$LocalHost@seriatim1>

>I use a class for handle a pool of connection to the data base that became
>persistent after the first call,
>and all the progrma that need a connection to the db have to pass through
>this class.

Same for me. Most odbc drivers are not fully threadsafe.

>But why only une program fall in this problem?
>In what way may I check if different trading are competing (my application
>doesn't call
>expressly any thread, mod python do it for me? I don't use multiple
>interpretes)


It all happens under stress only ...

-on apache linux ... when under stress apache forks as many
 interpreters as needed. Each intepreters handle the calls
 in an organised queue.

No race conditions here. Simple !

- on apache win32 ... when under strees apache win32 calls
for a nex thread. EACH THREAD may access all
your persistent python objects.

You need to put code to protect your data under stress.

>The way apache works on
>Anyway if this may be one problem I will start today to move from apache
>1.3.26 to apache 2.0.43
>with mod-python beta 3 (different management of threading), in order to
>check this problem.

I am quite new here. not tested the beta.

I have not tested that. No time at the moment.
Could you keep me informed on the all thing.

I have to maintain two version of our code.

One for linux, simple. The other one for nt/2K
that cares for concurrency.

The truth .. ain't log or complex but that's
extra code anyway.

Can i have one version only on apache 2
with both threading and forking activated ?

>I've to stay on nt/2000 because the odbc driver for my database it is not
>available on linux

Using a multiplatform db with support of both
win32 and *nix is great. We use ASA.
Great on win32. Runs on *nix.

>Thanks for your interest

mod_python is a great product.. worth digging thru.
You're welcome.

Francois

a win32 geek moving multiplatform
thru python/mod_python


-----Messaggio originale-----
Da: Fran?ois Lepoutre [mailto:francoislepoutre@compuserve.com]
Inviato: gioved? 17 ottobre 2002 23.26
A: Manera, Villiam
Oggetto: Re: [mod_python] strange behavior of mod-python


HI,

I love python and like mod_python a lot...
but have had trouble with the mod_python
programming model on nt/2000 because
of threading.

Do you keep db handle or python shared
data structure persistent in the python
interpreter?

If you do, have you made sure that
distinct thread are competing
for the same resource?

Just my two cents...


-----Original Message-----
From: Manera, Villiam <vmanera@manord.com>
To: 'mod_python@modpython.org' <mod_python@modpython.org>
Date: 17 October 2002 19:13
Subject: [mod_python] strange behavior of mod-python


>
>I'm currently use mod-python 2.7.6 on apache 1.3.26 - windows 2000 with
>python 2.2
>apache config:
>.....
>    ScriptAlias /comm/ "E:/script/cgi/comm/"
>    ScriptAlias /tecnico/ "E:/script/cgi/tecnico/"
>....
><Directory "E:/script/cgi/comm">
>        Order Deny,Allow
>        Deny from all
>        Allow from .....
>       ...
>    AddHandler python-program .py
>    PythonHandler mod_python.publisher
> PythonPath "sys.path+['c:/program
>files/python22/lib/site-packages/mdnlib', 'c:/program
>files/python22/lib/site-packages/HTMLgen','E:/script/cgi/comm']"
>    PythonDebug on
>    </Directory>
>
>----------------------------------------------------
>all work fine, but sometimes (today 4 time) when a url is typed:
>http://sviluppo.manord.com/comm/comm_ocordiu0.py/main?....
>
>I have this behavior from apache:
>HTTP 404 - File non trovato (not found)
>Internet Explorer
>but the program is still in place, and the only way to force apache to
found
>the program is restart the apache services,
>or make a copy of comm_ocordiu0 in comm_ocordiu1 and then call this one,
>but....
>
>
>
>this is not a real problem in developement web server, but  today it
>happened 4 time, in production is happened 2 time in one month,
>and I become in panic.
>
>Any advice here would be greatly appreciated.
>
>Villiam
>_______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org
>http://www.modpython.org/mailman/listinfo/mod_python


From francoislepoutre at compuserve.com  Fri Oct 18 14:55:23 2002
From: francoislepoutre at compuserve.com (=?iso-8859-1?Q?Fran=E7ois_Lepoutre?=)
Date: Fri Jan  9 22:03:32 2004
Subject: [mod_python] strange behavior of mod-python
Message-ID: <01c276a5$9f40ca20$2758d3d4@seriatim1>

>I will inform you to apache 2...

Thank you

>VI've found your mail of
>www.modpython.org/pipermail/mod_python/2001-September/001647.html
>that concern this problem. May I try to put "ThreadPerChild" to 1 instead
of
>2 to 50 ?

>I not clearly understood  the problem to doing that: the pb vanishes... and
>performance as well. (pb?)


Yes exactly!

>otherwise have you some example of code to protect  data under stress? I
>don't have any idea to do so.

I am no expert (IT by experience not education).
But python is so simple. I used the following kind
of code (no guarantee on details but you will
get the idea clear).

# at module level (global)
# add this
import threading
my_data_lock =  threading.RLock()

# every time you update your global variables

global my_data_lock
my_data_lock.acquire()

# update your stuff here
# while other thread wait ....

# release the lock
my_data_lock.release

I am sure you could (and should) do it
in a cleaner object-oriented way.
But that solved the threading issue.

Francois
-----Messaggio originale-----
Da: Fran?ois Lepoutre [mailto:francoislepoutre@compuserve.com]
Inviato: venerd? 18 ottobre 2002 11.37
A: Manera, Villiam
Cc: mod_python@modpython.org
Oggetto: Re: [mod_python] strange behavior of mod-python


>I use a class for handle a pool of connection to the data base that became
>persistent after the first call,
>and all the progrma that need a connection to the db have to pass through
>this class.

Same for me. Most odbc drivers are not fully threadsafe.

>But why only une program fall in this problem?
>In what way may I check if different trading are competing (my application
>doesn't call
>expressly any thread, mod python do it for me? I don't use multiple
>interpretes)


It all happens under stress only ...

-on apache linux ... when under stress apache forks as many
interpreters as needed. Each intepreters handle the calls
in an organised queue.

No race conditions here. Simple !

- on apache win32 ... when under strees apache win32 calls
for a nex thread. EACH THREAD may access all
your persistent python objects.

You need to put code to protect your data under stress.

>The way apache works on
>Anyway if this may be one problem I will start today to move from apache
>1.3.26 to apache 2.0.43
>with mod-python beta 3 (different management of threading), in order to
>check this problem.

I am quite new here. not tested the beta.

I have not tested that. No time at the moment.
Could you keep me informed on the all thing.

I have to maintain two version of our code.

One for linux, simple. The other one for nt/2K
that cares for concurrency.

The truth .. ain't log or complex but that's
extra code anyway.

Can i have one version only on apache 2
with both threading and forking activated ?

>I've to stay on nt/2000 because the odbc driver for my database it is not
>available on linux

Using a multiplatform db with support of both
win32 and *nix is great. We use ASA.
Great on win32. Runs on *nix.

>Thanks for your interest

mod_python is a great product.. worth digging thru.
You're welcome.

Francois

a win32 geek moving multiplatform
thru python/mod_python


-----Messaggio originale-----
Da: Fran?ois Lepoutre [mailto:francoislepoutre@compuserve.com]
Inviato: gioved? 17 ottobre 2002 23.26
A: Manera, Villiam
Oggetto: Re: [mod_python] strange behavior of mod-python


HI,

I love python and like mod_python a lot...
but have had trouble with the mod_python
programming model on nt/2000 because
of threading.

Do you keep db handle or python shared
data structure persistent in the python
interpreter?

If you do, have you made sure that
distinct thread are competing
for the same resource?

Just my two cents...


-----Original Message-----
From: Manera, Villiam <vmanera@manord.com>
To: 'mod_python@modpython.org' <mod_python@modpython.org>
Date: 17 October 2002 19:13
Subject: [mod_python] strange behavior of mod-python


>
>I'm currently use mod-python 2.7.6 on apache 1.3.26 - windows 2000 with
>python 2.2
>apache config:
>.....
>    ScriptAlias /comm/ "E:/script/cgi/comm/"
>    ScriptAlias /tecnico/ "E:/script/cgi/tecnico/"
>....
><Directory "E:/script/cgi/comm">
>        Order Deny,Allow
>        Deny from all
>        Allow from .....
>       ...
>    AddHandler python-program .py
>    PythonHandler mod_python.publisher
> PythonPath "sys.path+['c:/program
>files/python22/lib/site-packages/mdnlib', 'c:/program
>files/python22/lib/site-packages/HTMLgen','E:/script/cgi/comm']"
>    PythonDebug on
>    </Directory>
>
>----------------------------------------------------
>all work fine, but sometimes (today 4 time) when a url is typed:
>http://sviluppo.manord.com/comm/comm_ocordiu0.py/main?....
>
>I have this behavior from apache:
>HTTP 404 - File non trovato (not found)
>Internet Explorer
>but the program is still in place, and the only way to force apache to
found
>the program is restart the apache services,
>or make a copy of comm_ocordiu0 in comm_ocordiu1 and then call this one,
>but....
>
>
>
>this is not a real problem in developement web server, but  today it
>happened 4 time, in production is happened 2 time in one month,
>and I become in panic.
>
>Any advice here would be greatly appreciated.
>
>Villiam
>_______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org
>http://www.modpython.org/mailman/listinfo/mod_python


From peter at hawkins.emu.id.au  Sat Oct 19 12:23:07 2002
From: peter at hawkins.emu.id.au (Peter Hawkins)
Date: Fri Jan  9 22:03:32 2004
Subject: [mod_python] Debian packages of mod_python 3.0.0 beta 3
Message-ID: <200210191223.11417.peter@hawkins.emu.id.au>

Hi...

There are some preliminary packages of beta 3 available at:
http://people.debian.org/~peterh/

I disclaim any form of liability for anything these may do to any 
machine you might install them on.

=)
Peter
-- 
peter@hawkins.emu.id.au aka peterh@debian.org
GPG key fingerprint:
C746 38A9 D3E4 A171 FB6A  56D4 5E30 DFCC BE11 F437


From mort at bork.org  Fri Oct 18 23:52:27 2002
From: mort at bork.org (Martin Hicks)
Date: Fri Jan  9 22:03:33 2004
Subject: [mod_python] Redirects
Message-ID: <20021019035227.GK32184@bork.org>


Hello,

I'd like to do a redirect as a result of a certain action in my mod_python 
method.  I.e., rather than returning html, I'd like the user to be redirected to 
the page "blah.html" for example.

How do I accomplish this?

thanks
mh

-- 
Martin Hicks  ||  mort@bork.org  || PGP/GnuPG: 0x4C7F2BEE
plato up 17 days,  5:49, 16 users,  load average: 2.28, 2.20, 2.19
Beer: So much more than just a breakfast drink.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20021018/c8a550a8/attachment-0003.bin
From mort at bork.org  Sat Oct 19 09:50:59 2002
From: mort at bork.org (Martin Hicks)
Date: Fri Jan  9 22:03:33 2004
Subject: [mod_python] Redirects
In-Reply-To: <3DB10378.605355C@sympatico.ca>
References: <20021019035227.GK32184@bork.org> <3DB10378.605355C@sympatico.ca>
Message-ID: <20021019135059.GL32184@bork.org>


On Sat, Oct 19, 2002 at 03:02:16AM -0400, vio wrote:
> Your answer is in the FAQ.


I tried to look in the FAQ before i posted, but it's br0ken.

When I try to search for "redirect" I get:

mod_python FAQ Search Results
Traceback (most recent call last):

  File "/usr/local/www/vhosts/www.modpython.org/FAQ/faqw.py", line 26, in ?
    import faqwiz
  File "/home/grisha/WWW/www.modpython.org/FAQ/faqwiz.py", line 827, in ?
    wiz.go()
  File "/home/grisha/WWW/www.modpython.org/FAQ/faqwiz.py", line 381, in go
    meth()
  File "/home/grisha/WWW/www.modpython.org/FAQ/faqwiz.py", line 447, in 
do_search
    constants
NameError: global name 'constants' is not defined


(times: user 0.567, sys 0.05, ch-user 0, ch-sys 0, real 0.65) 


Other errors occur when you try to view any part of the FAQ.
Can someone please either respond with details on how to do http redirects or 
fix the FAQ :-)

thanks a pile,
mh

-- 
Martin Hicks  ||  mort@bork.org  || PGP/GnuPG: 0x4C7F2BEE
plato up 17 days, 15:47, 16 users,  load average: 0.31, 0.40, 0.27
Great Spirits have always encountered opposition from mediocre minds
						-Albert Einstein
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20021019/f94cd711/attachment-0003.bin
From vmilitaru at sympatico.ca  Sat Oct 19 22:58:58 2002
From: vmilitaru at sympatico.ca (vio)
Date: Fri Jan  9 22:03:33 2004
Subject: [mod_python] Re: Redirects
References: <20021019035227.GK32184@bork.org> <3DB10378.605355C@sympatico.ca> <20021019135059.GL32184@bork.org>
Message-ID: <3DB21BF1.94DDC26B@sympatico.ca>

You do redirection in mod_python with something like this:


def handler(REQUEST):

   _REQUEST = REQUEST._req
...
   _REQUEST.headers_out['location'] = 'http://some_URL.org/...'
   _REQUEST.status = apache.HTTP_MOVED_PERMANENTLY
   _REQUEST.send_http_header()
   raise apache.SERVER_RETURN, apache.OK



Hope this helps,
Vio



From grisha at modpython.org  Sun Oct 20 14:22:53 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:03:33 2004
Subject: [mod_python] Re: Redirects
In-Reply-To: <3DB21BF1.94DDC26B@sympatico.ca>
Message-ID: <Pine.BSF.4.32.0210201421370.39713-100000@eden.ispol.com>

On Sat, 19 Oct 2002, vio wrote:

> You do redirection in mod_python with something like this:
>
>
> def handler(REQUEST):
>
>    _REQUEST = REQUEST._req

The above line won't work starting with the next version of mod_python...

Grisha


From mort at bork.org  Sun Oct 20 14:29:39 2002
From: mort at bork.org (Martin Hicks)
Date: Fri Jan  9 22:03:33 2004
Subject: [mod_python] Re: Redirects
In-Reply-To: <Pine.BSF.4.32.0210201421370.39713-100000@eden.ispol.com>
References: <3DB21BF1.94DDC26B@sympatico.ca> <Pine.BSF.4.32.0210201421370.39713-100000@eden.ispol.com>
Message-ID: <20021020182939.GJ32501@bork.org>

On Sun, Oct 20, 2002 at 02:22:53PM -0400, Gregory (Grisha) Trubetskoy wrote:
> 
> On Sat, 19 Oct 2002, vio wrote:
> 
> > You do redirection in mod_python with something like this:
> >
> >
> > def handler(REQUEST):
> >
> >    _REQUEST = REQUEST._req
> 
> The above line won't work starting with the next version of mod_python...

What will the new method be in the next version?

thanks
mh

-- 
Martin Hicks  ||  mort@bork.org  || PGP/GnuPG: 0x4C7F2BEE
plato up 18 days, 20:28, 14 users,  load average: 0.15, 0.27, 0.17
Beer: So much more than just a breakfast drink.

From vmilitaru at sympatico.ca  Sun Oct 20 21:01:28 2002
From: vmilitaru at sympatico.ca (vio)
Date: Fri Jan  9 22:03:33 2004
Subject: [mod_python] Re: Redirects
References: <Pine.BSF.4.32.0210201421370.39713-100000@eden.ispol.com>
Message-ID: <3DB351E8.A39B7030@sympatico.ca>

Got you. To be more precise, my little code example was "mod_python/2.7.8
over Apache/1.3.26" friendly.

So I guess you must be referring to mod_python/3 running on apache/2.
Looking foreword to it (sorry I haven't had much time to play with the beta
releases so far ... lazily waiting for the first stable release, I guess, to
migrate to the new generation). If I understand you correcly, no more 'fast
track' access to REQUEST internals (aka. 'XXX._req') :-(. I guess a little
'migration tips to mod_python/3' might become handy, then).

If I may add a coding style suggestion for the new version out of the blue,
it would be to replace all references to 'req' with 'REQUEST' (uppercase
full name). I learned this in Zope long ago, and it sticked with me: it's a
little more verbose, but so much more clean when you look at a source code,
especially true for newcomers. Good ideas deserve to be "borrowed".

Vio


"Gregory (Grisha) Trubetskoy" wrote:

> On Sat, 19 Oct 2002, vio wrote:
>
> > You do redirection in mod_python with something like this:
> >
> >
> > def handler(REQUEST):
> >
> >    _REQUEST = REQUEST._req
>
> The above line won't work starting with the next version of mod_python...
>
> Grisha


From grisha at modpython.org  Mon Oct 21 10:44:47 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:03:33 2004
Subject: [mod_python] Re: Redirects
In-Reply-To: <3DB351E8.A39B7030@sympatico.ca>
Message-ID: <Pine.BSF.4.32.0210211003570.49241-100000@eden.ispol.com>

On Sun, 20 Oct 2002, vio wrote:

> Got you. To be more precise, my little code example was "mod_python/2.7.8
> over Apache/1.3.26" friendly.
>
> So I guess you must be referring to mod_python/3 running on apache/2.
> Looking foreword to it (sorry I haven't had much time to play with the beta
> releases so far ... lazily waiting for the first stable release, I guess, to
> migrate to the new generation). If I understand you correcly, no more 'fast
> track' access to REQUEST internals (aka. 'XXX._req') :-(. I guess a little
> 'migration tips to mod_python/3' might become handy, then).
>

The _req object came about as a way to make the end-user request object
modifiable. There were two ways of doing it - writing C code to make the
built-in request object accept new members, or simply encapsulate it in a
regular Python object. I hose the latter because it was quicker :)

Mod_python 3 does it correctly - the built-in request object won't need to
be encapsulated, it will be modifiable as is, so there won't be any need
for _req.

BTW, the ._req is undocumented, so if ever anyone used it, it was at their
own risk. And yes, a migration document would be nice, hopefully I can put
something together to that extent.

> If I may add a coding style suggestion for the new version out of the blue,
> it would be to replace all references to 'req' with 'REQUEST' (uppercase
> full name). I learned this in Zope long ago, and it sticked with me: it's a
> little more verbose, but so much more clean when you look at a source code,
> especially true for newcomers. Good ideas deserve to be "borrowed".

I don't like the way Zope names it REQUEST, because to me, a part-time C
programmer, all caps means a symbolic constant, and this convention has
for the most part been followed in Python standard library.

Grisha

>
> Vio
>
>
> "Gregory (Grisha) Trubetskoy" wrote:
>
> > On Sat, 19 Oct 2002, vio wrote:
> >
> > > You do redirection in mod_python with something like this:
> > >
> > >
> > > def handler(REQUEST):
> > >
> > >    _REQUEST = REQUEST._req
> >
> > The above line won't work starting with the next version of mod_python...
> >
> > Grisha
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>



From grisha at modpython.org  Mon Oct 21 10:59:39 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:03:33 2004
Subject: [mod_python] Redirects
In-Reply-To: <20021019135059.GL32184@bork.org>
Message-ID: <Pine.BSF.4.32.0210211058530.50017-100000@eden.ispol.com>

This's been fixed

On Sat, 19 Oct 2002, Martin Hicks wrote:

>
> On Sat, Oct 19, 2002 at 03:02:16AM -0400, vio wrote:
> > Your answer is in the FAQ.
>
>
> I tried to look in the FAQ before i posted, but it's br0ken.
>
> When I try to search for "redirect" I get:
>
> mod_python FAQ Search Results
> Traceback (most recent call last):
>
>   File "/usr/local/www/vhosts/www.modpython.org/FAQ/faqw.py", line 26, in ?
>     import faqwiz
>   File "/home/grisha/WWW/www.modpython.org/FAQ/faqwiz.py", line 827, in ?
>     wiz.go()
>   File "/home/grisha/WWW/www.modpython.org/FAQ/faqwiz.py", line 381, in go
>     meth()
>   File "/home/grisha/WWW/www.modpython.org/FAQ/faqwiz.py", line 447, in
> do_search
>     constants
> NameError: global name 'constants' is not defined


From eallen41 at charter.net  Mon Oct 21 10:21:38 2002
From: eallen41 at charter.net (Ed Richardson)
Date: Fri Jan  9 22:03:33 2004
Subject: [mod_python] cancel subscription
Message-ID: <001e01c27915$8d89fd20$cf9ba842@charter.net>

password MEXEOX ...  Please remove me from this mailing list... Thx
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20021021/15c9e78c/attachment-0003.htm
From mcassiano at manord.com  Mon Oct 21 17:27:56 2002
From: mcassiano at manord.com (Cassiano, Marco)
Date: Fri Jan  9 22:03:33 2004
Subject: [mod_python] Win mod_python.so not found by Apache
Message-ID: <52DC70C1C1575C418CB033523A29CF140B8D74@exchange2000.manord.com>

Hello everybody.
My configuration is : 

Windows 2000 Server SP3
Apache 2.0.43
Python 2.2.1 by ActiveState
Mod_Python 3.0 Beta 3 

I put the mod_python.so in the ServerRoot/module folder.
I put lib/mod_python folder in the c:/program files/Python22/lib folder

In the Apache httpd.conf I put the line :

LoadModule python_module modules/mod_python.so

When I start the Apache service I always get the error (taken from the
application event):


Event Type:	Error
Event Source:	Apache Service
Event Category:	None
Event ID:	3299
Date:		21/10/2002
Time:		16.49.54
User:		N/A
Computer:	CORSO_MYSQL
Description:
The Apache service named  reported the following error:
>>> Syntax error on line 67 of C:/Program Files/Apache
Group/Apache2/conf/httpd.conf:     . 
The Apache service named  reported the following error:
>>> Cannot load C:/Program Files/Apache Group/Apache2/modules/mod_python.so
into server: 
The specified module could not be found. 



But the mod_python.so file is right there !
What Am I missing ?
Thanks




> Marco Cassiano
> Resp. Reti e Sistemi
> 
> Manifatture del Nord srl
> viale Regina Elena 13-15
> 42100 Reggio Emilia RE
> ITALY
> 
> Tel. +39 0522 508206
> Fax +39 0522 514001
> email : mcassiano@manord.com
> www.pennyblack.com
> 
> 

From barr at cs.cornell.edu  Tue Oct 22 00:53:55 2002
From: barr at cs.cornell.edu (Rimon Barr)
Date: Fri Jan  9 22:03:33 2004
Subject: [mod_python] spyce v1.1.45
In-Reply-To: <Pine.LNX.4.44.0207071930240.8857-100000@pompom.u.cs.cornell.edu>
Message-ID: <Pine.LNX.4.44.0210220024400.3539-100000@pompom.cs.cornell.edu>

SPYCE - Python Server Pages
  v1.1.45 released on 13 Oct 2002.

SPYCE is a webserver plugin that supports simple and efficient
Python-based dynamic HTML scripting. Those who like Python and are
familiar with JSP, or PHP, or ASP, should have a look at this engine. It
allows one to generate dynamic HTML content just as easily, using Python
for the dynamic parts. Its modular design makes it very flexible and
extensible. It supports FastCGI, CGI and mod_python to plugin into Apache
and most other webservers. It can also be used as a command-line utility
for HTML pre-processing or as a web server proxy.

Get it at:
  http://spyce.sourceforge.net

----------

Dear mod_python users,

Spyce works very nicely under mod_python, and it's been a while since I
posted a release announcement to this list (in fact, since v1.1.22, about
two months ago). Here are some of the major highlights. (The full change
log is available at:
http://cvs.sourceforge.net/cgi-bin/viewcvs.cgi/spyce/spyce/CHANGES?rev=HEAD&content-type=text/vnd.viewcvs-markup).

  - refactored the spyce module infrastructure
  - modules accept initialization arguments
  - new modules and improvements:
      toc - table of contents
      transform - output filters/transformations
      compress - dynamic compression
      error - error handling
      stdout - added push() and pop() methods; loaded implicitly
      and lots of others...
  - more accurate/specific runtime error reporting
  - added server-level configuration options
  - spyce now also supports a proxy server mode
  - added spyceDone exception to stop spyce processing
  - rpm improvements and new windows installer
  - compatibility with Python 1.5.2 and up
  - file globbing added to -O command-line option
  - site and documentation revamp
  - live examples on sourceforge
  - lots of bug fixes
  - performance improvements

If you use mod_python, and the last time you checked out Spyce was two
months ago, then please go take a second look. :)
  http://spyce.sourceforge.net

Comments, suggestions and feature requests are welcome.

Enjoy,
Rimon.


From rien at yeepa.org  Tue Oct 22 18:01:18 2002
From: rien at yeepa.org (Adrien Plisson)
Date: Fri Jan  9 22:03:33 2004
Subject: [mod_python] Win mod_python.so not found by Apache
References: <52DC70C1C1575C418CB033523A29CF140B8D74@exchange2000.manord.com>
Message-ID: <001101c279e4$428a4ee0$0a020101@skynet.be>

From: "Cassiano, Marco" <mcassiano@manord.com>
> I put the mod_python.so in the ServerRoot/module folder.
> I put lib/mod_python folder in the c:/program files/Python22/lib folder

shouldn't you put mod_python.dll instead of mod_python.so ?

.so files are "shared object" under un*x and achieve the same functionnality
as a .dll under windows.

--
rien


From grisha at modpython.org  Tue Oct 22 13:20:46 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:03:33 2004
Subject: [mod_python] Win mod_python.so not found by Apache
In-Reply-To: <001101c279e4$428a4ee0$0a020101@skynet.be>
Message-ID: <20021022131702.O73449-100000@eden.ispol.com>

It is a DLL, but apache httpd people decided to name their dll's with a
.so. Windows doesn't really care what the file is called, so it works just
the same, but this way the name is same on Windows and unices and you get
a nice little red feather as the icon associated with it. :)

On Tue, 22 Oct 2002, Adrien Plisson wrote:

> From: "Cassiano, Marco" <mcassiano@manord.com>
> > I put the mod_python.so in the ServerRoot/module folder.
> > I put lib/mod_python folder in the c:/program files/Python22/lib folder
>
> shouldn't you put mod_python.dll instead of mod_python.so ?
>
> .so files are "shared object" under un*x and achieve the same functionnality
> as a .dll under windows.
>
> --
> rien
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From neo at https.ru  Tue Oct 22 21:23:14 2002
From: neo at https.ru (Neo Eureka)
Date: Fri Jan  9 22:03:33 2004
Subject: [mod_python] Win mod_python.so not found by Apache
In-Reply-To: <52DC70C1C1575C418CB033523A29CF140B8D74@exchange2000.manord.com>
References: <52DC70C1C1575C418CB033523A29CF140B8D74@exchange2000.manord.com>
Message-ID: <5825926840.20021022212314@https.ru>

 Hi all !

CM> Hello everybody.
CM> My configuration is : 

CM> Windows 2000 Server SP3
CM> Apache 2.0.43
CM> Python 2.2.1 by ActiveState
CM> Mod_Python 3.0 Beta 3 

CM> I put the mod_python.so in the ServerRoot/module folder.
CM> I put lib/mod_python folder in the c:/program files/Python22/lib folder

CM> In the Apache httpd.conf I put the line :

CM> LoadModule python_module modules/mod_python.so

CM> When I start the Apache service I always get the error (taken from the
CM> application event):

CM> Event Type:     Error
CM> Event Source:   Apache Service
CM> Event Category: None
CM> Event ID:       3299
CM> Date:           21/10/2002
CM> Time:           16.49.54
CM> User:           N/A
CM> Computer:       CORSO_MYSQL
CM> Description:
CM> The Apache service named  reported the following error:
>>>> Syntax error on line 67 of C:/Program Files/Apache
CM> Group/Apache2/conf/httpd.conf:     . 
CM> The Apache service named  reported the following error:
>>>> Cannot load C:/Program Files/Apache Group/Apache2/modules/mod_python.so
CM> into server: 
CM> The specified module could not be found. 

CM> But the mod_python.so file is right there !
CM> What Am I missing ?
CM> Thanks

  I've run into the same behaviour of BETA3 under WindowsNT/4.0 &
Apache 2.0.43.


--- 
Neo Eureka / mailto:neo@https.ru


From neo at https.ru  Tue Oct 22 21:30:49 2002
From: neo at https.ru (Neo Eureka)
Date: Fri Jan  9 22:03:33 2004
Subject: [mod_python] Win mod_python.so not found by Apache
In-Reply-To: <001101c279e4$428a4ee0$0a020101@skynet.be>
References: <52DC70C1C1575C418CB033523A29CF140B8D74@exchange2000.manord.com>
 <001101c279e4$428a4ee0$0a020101@skynet.be>
Message-ID: <16026381574.20021022213049@https.ru>

AP> From: "Cassiano, Marco" <mcassiano@manord.com>
>> I put the mod_python.so in the ServerRoot/module folder.
>> I put lib/mod_python folder in the c:/program files/Python22/lib folder

AP> shouldn't you put mod_python.dll instead of mod_python.so ?

  No, he should not.


AP> .so files are "shared object" under un*x and achieve the same functionnality
AP> as a .dll under windows.

  Apache 2 under Windows uses ".so" files for loadable modules instead
of ".dll". In fact, these files are DLLs inside, but they look like
Unix shared object files.


AP> --
AP> rien


---
Neo Eureka / mailto:neo@https.ru


From rpinder at usc.edu  Tue Oct 22 11:36:08 2002
From: rpinder at usc.edu (Rich Pinder)
Date: Fri Jan  9 22:03:33 2004
Subject: [mod_python] Permissions Question on Linux
References: <52DC70C1C1575C418CB033523A29CF140B8D74@exchange2000.manord.com>
 <001101c279e4$428a4ee0$0a020101@skynet.be>
Message-ID: <3DB59A98.2030905@usc.edu>

Sorry for the simplicity of this question.

I'm putting together a site that uses Apache and mod_python and kinterbase to insert data into a Firebird 
(Interbase) server.

All the software resides on the same machine.
I've done some preliminary work on win32 machines, but now am configuring the SuSE 8.1 server.

Heres the question:  Are there any good practice guidelines on what specific Linux user account should be 
running (owning) the scripts, and where they should be residing ?  Rather than just getting something together 
that works, I thought I'd see how others do it.

thanks in advance for your thoughts

rich pinder
usc school of medicine


From rrreid at earthlink.net  Wed Oct 23 12:02:22 2002
From: rrreid at earthlink.net (Mr. Robin R. Reid)
Date: Fri Jan  9 22:03:33 2004
Subject: [mod_python] Problems with BETA3 and Solaris 9
Message-ID: <3DB6E42E.9060105@earthlink.net>

I ran the following configuration command

./configure --with-python --with-apxs=/usr/local/apache/bin/apxs

then ran make to completion. make install, however finished with the
following output:

Performing DSO installation.

./install-sh -c src/mod_python.so /usr/local/apache/modules
install:  src/mod_python.so does not exist
make[1]: *** [install_dso] Error 1
make[1]: Leaving directory `/export/home/tools/mod_python-3.0.0-BETA'
make: *** [install] Error 2

Needless to say, this is quite true. I'm running apache 2.0.43 and am using
gcc 3.1, with most of the gnu build tools installed. Being relatively new to
gnu build tools and mod_python, I'm not sure how to proceed.

Thanks in advance for your help.


From grisha at modpython.org  Wed Oct 23 14:39:21 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:03:33 2004
Subject: [mod_python] Problems with BETA3 and Solaris 9
In-Reply-To: <3DB6E42E.9060105@earthlink.net>
Message-ID: <20021023143337.B22688-100000@eden.ispol.com>

Did make report errors of any kind? It'd be strange if it didn't.

Try this:

Edit src/Makefile.in, change the line:

mod_python.so: $(SRCS)

to

mod_python.so: $(SRCS)  @EPRINTF_HACK@ @FLOATDIDF_HACK@

Then rerun ./configure --with-apxs=/usr/local/apache/bin/apxs

(You don't need the --with-python argument)

Let me know if it fixes it.

P.S. I had problems building and running apache on Solaris 9 and in the
end what fixed was compiling my own gcc from scratch. I used 3.2, but 3.1
should work OK as well. I also had to set LD_LIBRARY_PATH=/usr/local/lib.
I don't know (or don't care) enough about the intricacies of gcc on
Solaris to be able to explain what exactly goes on there, you may not need
those things on your system... :-)

Grisha


On Wed, 23 Oct 2002, Mr. Robin R. Reid wrote:

> I ran the following configuration command
>
> ./configure --with-python --with-apxs=/usr/local/apache/bin/apxs
>
> then ran make to completion. make install, however finished with the
> following output:
>
> Performing DSO installation.
>
> ./install-sh -c src/mod_python.so /usr/local/apache/modules
> install:  src/mod_python.so does not exist
> make[1]: *** [install_dso] Error 1
> make[1]: Leaving directory `/export/home/tools/mod_python-3.0.0-BETA'
> make: *** [install] Error 2
>
> Needless to say, this is quite true. I'm running apache 2.0.43 and am using
> gcc 3.1, with most of the gnu build tools installed. Being relatively new to
> gnu build tools and mod_python, I'm not sure how to proceed.
>
> Thanks in advance for your help.
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From eugene_beast at mail.ru  Thu Oct 24 09:46:16 2002
From: eugene_beast at mail.ru (Eugene Sizikov)
Date: Fri Jan  9 22:03:33 2004
Subject: [mod_python] unicode() conversion troubles with mod_python 3 CVS 27.06.2002
Message-ID: <005b01c27aff$26914920$0bcbefc3@irkutsk.teleross.ru>

Hello all ppl!

I have troubles with unicode conversion with mod_python from RedHat 8.0
distro. The errorlog is:

"
Mod_python error: "PythonHandler mod_python.publisher"

Traceback (most recent call last):

  File "/usr/lib/python2.2/site-packages/mod_python/apache.py", line 285, in
HandlerDispatch
    result = object(req)

  File "/usr/lib/python2.2/site-packages/mod_python/publisher.py", line 175,
in handler
    result = apply(object, (), args)

  File "/var/www/html/teleross/user.py", line 137, in start
    html = '%s [%s]<HR>' % (string_sql_to_html(user.fullname),
Group(user.con, user.gid).fullname) + menu.to_html()

  File "/var/www/html/teleross/utils.py", line 4, in string_sql_to_html
    return unicode(s, 'koi8-r')

  File
"/usr/src/build/143041-i386/install/usr/lib/python2.2/encodings/__init__.py"
, line 51, in search_function

RuntimeError: cannot unmarshal code objects in restricted execution mode
"

So, when it has "unicode(s, 'koi8-r')" it crashes with that interesting
message I can't understand.

Please, help!

Eugene.



From grisha at modpython.org  Thu Oct 24 17:43:20 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:03:33 2004
Subject: [mod_python] unicode() conversion troubles with mod_python 3
 CVS 27.06.2002
In-Reply-To: <005b01c27aff$26914920$0bcbefc3@irkutsk.teleross.ru>
Message-ID: <20021024174222.Y39970-100000@eden.ispol.com>

In my case upgrading to Python 2.2.2 eliminated all encodings weirdness.

Grisha

On Thu, 24 Oct 2002, Eugene Sizikov wrote:

> Hello all ppl!
>
> I have troubles with unicode conversion with mod_python from RedHat 8.0
> distro. The errorlog is:
>
> "
> Mod_python error: "PythonHandler mod_python.publisher"
>
> Traceback (most recent call last):
>
>   File "/usr/lib/python2.2/site-packages/mod_python/apache.py", line 285, in
> HandlerDispatch
>     result = object(req)
>
>   File "/usr/lib/python2.2/site-packages/mod_python/publisher.py", line 175,
> in handler
>     result = apply(object, (), args)
>
>   File "/var/www/html/teleross/user.py", line 137, in start
>     html = '%s [%s]<HR>' % (string_sql_to_html(user.fullname),
> Group(user.con, user.gid).fullname) + menu.to_html()
>
>   File "/var/www/html/teleross/utils.py", line 4, in string_sql_to_html
>     return unicode(s, 'koi8-r')
>
>   File
> "/usr/src/build/143041-i386/install/usr/lib/python2.2/encodings/__init__.py"
> , line 51, in search_function
>
> RuntimeError: cannot unmarshal code objects in restricted execution mode
> "
>
> So, when it has "unicode(s, 'koi8-r')" it crashes with that interesting
> message I can't understand.
>
> Please, help!
>
> Eugene.
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From robertoschler at hotmail.com  Fri Oct 25 09:47:10 2002
From: robertoschler at hotmail.com (Robert Oschler)
Date: Fri Jan  9 22:03:33 2004
Subject: [mod_python] Web Hosts that support mod_python?
Message-ID: <OE198VBDUfdfdhNzW3l00004a23@hotmail.com>

I've found several web hosting companies that support Python, but haven't found one that supports mod_python?  Anybody got one that you like?

thx

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20021025/120456a7/attachment-0003.htm
From mk at lrn.ru  Fri Oct 25 20:14:22 2002
From: mk at lrn.ru (Michael Krasnovsky)
Date: Fri Jan  9 22:03:33 2004
Subject: [mod_python] Using mod_python and shelve module
Message-ID: <20021025201422.671d02df.mk@lrn.ru>

Hi!

I try using standard python module shelve in my publisher handler, but I
got the error:

Mod_python error: "PythonHandler mod_python.publisher"
Traceback (most recent call last):

  File "/usr/lib/python2.2/site-packages/mod_python/apache.py", line
193, in Dispatch
    result = object(req)

  File "/usr/lib/python2.2/site-packages/mod_python/publisher.py", line
171, in handler
    result = apply(object, (), args)

  File "/home/mk/www/test2.py", line 7, in handle
    sessiondict = shelve.open('/tmp/apptest.session', 'c')

  File "/usr/lib/python2.2/shelve.py", line 158, in open
    return DbfilenameShelf(filename, flag)

  File "/usr/lib/python2.2/shelve.py", line 148, in __init__
    Shelf.__init__(self, anydbm.open(filename, flag))

  File "/usr/lib/python2.2/anydbm.py", line 86, in open
    return mod.open(file, flag, mode)

  File "/usr/lib/python2.2/dbhash.py", line 16, in open
    return bsddb.hashopen(file, flag, mode)

error: (13, 'Permission denied')


What's the problem? I check permissions of /tmp/ directory - it's OK.
BTW, I wrote simple cgi script with using shelve and it works fine.
I run mod_pytnon 2.7.8+Apache 1.3.27 on Linux. Python version 2.2.1.

Thanks for any help.

-- 
Michael Krasnovsky

E mk@lrn.ru

From neel at mediapulse.com  Fri Oct 25 16:37:34 2002
From: neel at mediapulse.com (Michael C. Neel)
Date: Fri Jan  9 22:03:33 2004
Subject: [mod_python] Web Hosts that support mod_python?
Message-ID: <C0FC22C08B82074A88B50061764157775BCF@johnson.mediapulse.net>

I've seen this question asked here a few times, and wondered why we (my
company) doesn't do this.  So I talked it over, and I'll be able to add
mod_python support when requested to an account.  I don't think it will
be advertised on our site, but email me and I can get it setup.  We
already have MySQL available, and I could install albatross as well
since I use it often.

The details:
    
        www.pulsetechnologies.net (which is a division of the company I
work for, www.mediapulse.com)

	  Contact me (Michael Neel) at neel@mediapulse.com) before
getting an account so that I can make sure you go on a mod_python ready
box.  I'll also be the contact for conf file changes and setup for you.

	Any questions, just email me - I don't want to take up post on
the list with spam even if it is for my company =D.

Mike

--
Michael C. Neel
Director of Software Development
Mediapulse, Inc.

 
-----Original Message-----
From: Robert Oschler [mailto:robertoschler@hotmail.com] 
Sent: Friday, October 25, 2002 9:47 AM
To: mod_python
Subject: [mod_python] Web Hosts that support mod_python?


I've found several web hosting companies that support Python, but
haven't found one that supports mod_python?  Anybody got one that you
like?

thx


From neel at mediapulse.com  Sat Oct 26 14:42:44 2002
From: neel at mediapulse.com (Michael Neel)
Date: Fri Jan  9 22:03:33 2004
Subject: [mod_python] Web Hosts that support mod_python?
In-Reply-To: <20021026004231.12422.qmail@email.com>
Message-ID: <000001c27d1f$78d57b30$0400a8c0@clapton>

Jack,

	I think that's it's all of the above.  First would be a lack of
popularity.  Going to apache's website it hard to find any info on
python under apace at all (hopefully this will change soon).  Next, you
do need a python skilled tech guy to admin and understand the mod_python
issues, and I'm guessing he's hard to find right now compared to perl or
php.

	I'm also not sure of those ISP's that offer mod_perl, how many
of them go beyond just using it for "fast CGI".  Allowing someone access
to embed an apache module in any language is a risky option.  Also, to
setup such a module you would need conf file access, and I'm sure most
ISP's don't like that idea either.

	Now the conf file issues may have resolution, but I'm not sure
how feasible it is to do, so I throw this out for feedback.  What it the
module "registered" itself for the hooks it wanted to use?  This way
there would be no need to change a conf file once setup.  Having the
feature in the conf file to restrict which hooks a module could register
for as well might be nice.  Lastly, having a way to call the module in a
url dynamically would help, so that no setup was needed in a conf file
to say where the module was, i.e. /python-bin/myhandler.py would use
myhandler.py as the module which registered hooks on it own, but
/python-bin/other.py would be a completely different handler all on it
own and neither one mentioned in the conf file; just some type of
"<Directory>" config to say that /python-bin was a handler directory and
that those handlers could register for any of the following hooks.

	I don't know of anything that works like the above, so this
would be very new to the apache world.  I'd like to think it would help
in getting more ISP's to support mod_python, but that's just a guess.
Either way, I'd like to know what others think.

Mike
--
Michael C. Neel
Director of Software Development
Mediapulse, Inc.
Mod_python hosting available

-----Original Message-----
From: Jack Diederich [mailto:jack_diederich@email.com] 
Sent: Friday, October 25, 2002 8:43 PM
To: Michael C. Neel
Subject: RE: [mod_python] Web Hosts that support mod_python?


Hi Michael,

Are there any technical reasons why mod_python isn't supported by most
hosting companies, is it just not popular enough to justify support, or
is it just a policy thing?

If it is anything but a policy thing, please throw a post on mod_python.
Technical tweaks could be made, or maybe someone would write a
webhosting mod_python HOWTO to make life easier for hosting providers.

If the answer is lack of popularity, we'll just have to wait a while. I
know quite a few folks up here in Boston that are moving to python or
ruby for rapid web application development from perl or C++. CPU cycles
are so cheap there isn't much reason not to anymore ;)

-jack

> I've seen this question asked here a few times, and wondered why we 
> (my
> company) doesn't do this.  So I talked it over, and I'll be able to
add
> mod_python support when requested to an account.  I don't think it
will
> be advertised on our site, but email me and I can get it setup.  We
> already have MySQL available, and I could install albatross as well
> since I use it often.

-- 
__________________________________________________________
Sign-up for your own FREE Personalized E-mail at Mail.com
http://www.mail.com/?sr=signup



From grisha at modpython.org  Wed Oct 30 11:49:09 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:03:33 2004
Subject: [mod_python] BETA 4
Message-ID: <20021030114730.C20021-100000@eden.ispol.com>

Beta 4 of mod_python 3.0 is available for download at
http://www.apache.org/dist/httpd/modpython/dev/

Most likely this will be the last beta before the final release of 3.0

Enjoy,

Grisha


From conrad at hep.caltech.edu  Wed Oct 30 10:01:32 2002
From: conrad at hep.caltech.edu (Conrad Steenberg)
Date: Fri Jan  9 22:03:33 2004
Subject: [mod_python] Customized permission denied message?
Message-ID: <1036000892.1707.117.camel@heppc22.hep.caltech.edu>

Hi

Is it possible to generate a customized permission denied message in an
authenhandler?

I'm using mod_python the answer XML-RPC requests and sending back an
XML-RPC denial message is more elegant than the standard text message.

Thanks!

Conrad

-- 
*-----------------------------------------*
| Conrad Steenberg                        |
| Caltech, Mail Code 356-48               |
| Pasadena, CA, 91125                     |
| e-mail: conrad@hep.caltech.edu          |
| Tel: (626) 395-8758                     |
*-----------------------------------------*


From grisha at modpython.org  Wed Oct 30 13:29:26 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:03:33 2004
Subject: [mod_python] Customized permission denied message?
In-Reply-To: <1036000892.1707.117.camel@heppc22.hep.caltech.edu>
Message-ID: <20021030132631.Y20021-100000@eden.ispol.com>

Yes, the authenhandler (or any handler for that matter) can service the
request to completion by writing whatever needed to the client (also you
may need to set the right status and headers if any) and return
apache.DONE, thereby telling the server that the request is fully serviced
and no other handlers (except for loging and cleanup) will be executed.

Grisha

On 30 Oct 2002, Conrad Steenberg wrote:

> Hi
>
> Is it possible to generate a customized permission denied message in an
> authenhandler?
>
> I'm using mod_python the answer XML-RPC requests and sending back an
> XML-RPC denial message is more elegant than the standard text message.
>
> Thanks!
>
> Conrad
>
> --
> *-----------------------------------------*
> | Conrad Steenberg                        |
> | Caltech, Mail Code 356-48               |
> | Pasadena, CA, 91125                     |
> | e-mail: conrad@hep.caltech.edu          |
> | Tel: (626) 395-8758                     |
> *-----------------------------------------*
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From antonio at memora.com  Thu Oct 31 17:04:30 2002
From: antonio at memora.com (Antonio L Rodriguez)
Date: Fri Jan  9 22:03:33 2004
Subject: [mod_python] Lifecycle of mod_python instances
Message-ID: <BB355965-ED1C-11D6-9578-00039300D690@memora.com>

Forgive me if this is more of an apache process question, but I 
couldn't find it covered clearly in the docs.

When apache boots up (on *NIX) its starts a bunch of children 
processes. Does each child have its own separate image of mod_python 
execution space that is totally separate from the other images?

That is, if I define a global var to measure hit counts in a script and 
then I see this var dance up and down as each of the child processes 
handles the request, do I infer correctly that there are separate 
python interpreters living inside of each child process?

If this is so, I'd be curious how people do global data structures in 
this model, i.e. a database connection pool.

Thanks,

Antonio


