<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] stumped by inputfilter infinite repeat
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20stumped%20by%20inputfilter%20infinite%20repeat&In-Reply-To=2cd46e7f0708201539k3e6a101crd55b4a15ad800266%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024137.html">
   <LINK REL="Next"  HREF="024139.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] stumped by inputfilter infinite repeat</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20stumped%20by%20inputfilter%20infinite%20repeat&In-Reply-To=2cd46e7f0708201539k3e6a101crd55b4a15ad800266%40mail.gmail.com"
       TITLE="[mod_python] stumped by inputfilter infinite repeat">graham.dumpleton at gmail.com
       </A><BR>
    <I>Mon Aug 20 18:57:50 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="024137.html">[mod_python] stumped by inputfilter infinite repeat
</A></li>
        <LI>Next message: <A HREF="024139.html">[mod_python] stumped by inputfilter infinite repeat
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24138">[ date ]</a>
              <a href="thread.html#24138">[ thread ]</a>
              <a href="subject.html#24138">[ subject ]</a>
              <a href="author.html#24138">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 21/08/07, Ken Manheimer &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">ken.manheimer at gmail.com</A>&gt; wrote:
&gt;<i> On 8/18/07, Graham Dumpleton &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">graham.dumpleton at gmail.com</A>&gt; wrote:
</I>&gt;<i> &gt; Which version of mod_python and Apache are you using?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The Tramline author suspected there existed a problem in mod_python
</I>&gt;<i> &gt; and/or Apache that caused some issues. They suggest in their
</I>&gt;<i> &gt; documentation a change that should be made to mod_python, although it
</I>&gt;<i> &gt; hasn't been done in official releases as it wouldn't seem to be the
</I>&gt;<i> &gt; correct thing to do. One issue was fixed in filter code in mod_python
</I>&gt;<i> &gt; in recent versions which may have caused issues, but not the same
</I>&gt;<i> &gt; change they suggested. They also felt that certain older versions of
</I>&gt;<i> &gt; Apache may have had some problem.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; For some more details see:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;   <A HREF="https://issues.apache.org/jira/browse/MODPYTHON-76">https://issues.apache.org/jira/browse/MODPYTHON-76</A>
</I>&gt;<i>
</I>&gt;<i> thanks much, graham, for your reply.  i did know about the need to
</I>&gt;<i> inihbit filter.flush() - it's described in the tramline install
</I>&gt;<i> instructions.  i also factored tramline completely out of the picture,
</I>&gt;<i> reproducing the behavior using instead some trivial artifical
</I>&gt;<i> inputfilter and outputfilter functions:
</I>&gt;<i>
</I>&gt;<i>   def inputfilter(filter):
</I>&gt;<i>       &quot;stub input filter&quot;
</I>&gt;<i>       filter.req.log_error(&quot;klm input filter&quot;)
</I>&gt;<i>
</I>&gt;<i>   def outputfilter(filter):
</I>&gt;<i>       &quot;stub output filter&quot;
</I>&gt;<i>       filter.req.log_error(&quot;klm output filter&quot;)
</I>&gt;<i>
</I>&gt;<i> running without pdb enabled but through the rewrite rule i mentioned
</I>&gt;<i> earlier, to Zope, yields an infinite stream of the &quot;klm input filter&quot;
</I>&gt;<i> messages, and no &quot;klm output filter&quot; ones.  (the problem does *not*
</I>&gt;<i> happen when the Zope backend is not running.)
</I>
As I would expect, as the input filter is neither consuming the data
or passing it on. Try something like:

from mod_python import apache

def inputfilter(filter):

    s = filter.read()
    while s:
        filter.write(s)
        s = filter.read()

    if s is None:
        filter.close()

Similar for output filter.

&gt;<i> i did reread the bug report, and it occurred to me to try the current
</I>&gt;<i> apache svn version, as the bug report mentions - an off chance,
</I>&gt;<i> though, since the features of the svn version around the time of the
</I>&gt;<i> bug report should have seen released by now.  unfortunately, that
</I>&gt;<i> works worse.  i'm getting a fatal error trying to run the latest svn
</I>&gt;<i> version with mod_python installed:
</I>&gt;<i>
</I>&gt;<i> httpd: Syntax error on line 116 of /usr/local/apache2/conf/httpd.conf:
</I>&gt;<i> Cannot load /usr/local/apache2/modules/mod_python.so into server:
</I>&gt;<i> /usr/local/apache2/modules/mod_python.so: undefined symbol:
</I>&gt;<i> ap_requires
</I>&gt;<i> err 1:  2811  /usr/local/apache2/bin/apachectl configtest
</I>
Do you have multiple versions of Apache on your system? This error
suggest the mod_python source code has been compiled against a
different version of Apache than you are trying to use it with.

&gt;<i> this obstacle on obstacle is discouraging.  a google search reveals no
</I>&gt;<i> other reports of this particular error, and i have no reason to be
</I>&gt;<i> confident that getting it working would actually improve the original
</I>&gt;<i> inputfilter problem.  i plan to inquire on the tramline and plone
</I>&gt;<i> lists for alternatives.  i am interested to hear insights on this, but
</I>&gt;<i> think i'm better off pursuing other avenues (there's some alpha plone
</I>&gt;<i> accommodations for blobs in the zodb), and if that works, giving up on
</I>&gt;<i> mod_python.
</I>&gt;<i>
</I>&gt;<i> i did solve one interesting incidental problem along the way, that
</I>&gt;<i> might be of value to someone else.  when the interminable inputfilter
</I>&gt;<i> invocation is happening i have to kill apache with a KILL signal (9).
</I>&gt;<i> doing that lead to mutex leaks, soon leading to apache start failures,
</I>&gt;<i> with an error_log complaint like this:
</I>&gt;<i>
</I>&gt;<i> [Fri Aug 17 12:00:00 2007] [error] (28)No space left on device:
</I>&gt;<i> mod_python: Failed to create global mutex 0 of 32 (/tmp/mpmtx125450).
</I>
You need to make sure you kill off the zombie Apache parent processes
as well if any exist. It will only be when they have gone that the
mutexes will be released.

&gt;<i> investigating, i learned about ipcs to report semaphores and ipcrm to
</I>&gt;<i> remove them, and created a little script that did the job for me:
</I>&gt;<i>
</I>&gt;<i> ipcs -s | while read key id garbage; do
</I>&gt;<i>   case &quot;$id&quot; in
</I>&gt;<i>     [0-9]* ) echo -n &quot;$id &quot;
</I>&gt;<i>              ipcrm -s $id;;
</I>&gt;<i>     * ) : ;;
</I>&gt;<i>   esac
</I>&gt;<i> done
</I>&gt;<i>
</I>&gt;<i> handy.
</I>
Hmmm, wont this be dangerous if something is using them. Things other
than Apache use these things.

Graham

&gt;<i> also, in case anyone still thinks attention to mod_python and tramline
</I>&gt;<i> is worthwhile, here are my web server details, from mod_python's
</I>&gt;<i> mpinfo:
</I>&gt;<i>
</I>&gt;<i>   Apache/2.2.4 (Unix) mod_ssl/2.2.4  OpenSSL/0.9.7a  DAV/2  mod_python/3.3.1
</I>&gt;<i>   Python/2.4.3
</I>&gt;<i>
</I>&gt;<i> and host server os and hardware: linux kernel 2.6.9-42.ELsmp on an AMD
</I>&gt;<i> Athlon 64 X2
</I>&gt;<i> Dual Core Processor 4200+.  (it's actually running redhat 4.1, alas.)
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> ken
</I>&gt;<i> <A HREF="http://myriadicity.net">http://myriadicity.net</A>
</I>&gt;<i>
</I>&gt;<i> &gt; On 19/08/07, Ken Manheimer &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">ken.manheimer at gmail.com</A>&gt; wrote:
</I>&gt;<i> &gt; &gt; hi, all.  i'm using mod_python with a downloads/uploads handler,
</I>&gt;<i> &gt; &gt; tramline ( <A HREF="http://infrae.com/products/tramline">http://infrae.com/products/tramline</A> ) with a content
</I>&gt;<i> &gt; &gt; management system (plone).  when the tramline input and output filters
</I>&gt;<i> &gt; &gt; are hooked in (using SetInputFilter and SetOutputFilter) and i visit
</I>&gt;<i> &gt; &gt; the zope/plone site via a redirect, i get infinite repeated calls to
</I>&gt;<i> &gt; &gt; the input filter.  (i can observe the this by setting PythonEnablePdb
</I>&gt;<i> &gt; &gt; - from the perspective of the web browser, no page is returned.)  i
</I>&gt;<i> &gt; &gt; can provide more details, and realize that this may be a tramline
</I>&gt;<i> &gt; &gt; problem, but it seems like a behavior that might be familiar to
</I>&gt;<i> &gt; &gt; mod_python experts, so i thought i'd run it by you all first.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; things like mpinfo and mptest.py work fine.  visiting the regular,
</I>&gt;<i> &gt; &gt; file-based mockup site yields no problems - only the embedded zope
</I>&gt;<i> &gt; &gt; site, via a rewrite rule:
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;   RewriteRule ^/testbed(.*)
</I>&gt;<i> &gt; &gt; <A HREF="http://127.0.0.1:8080/VirtualHostBase/http/%{HTTP_HOST}:80/VirtualHostRoot/_vh_testbed/$1">http://127.0.0.1:8080/VirtualHostBase/http/%{HTTP_HOST}:80/VirtualHostRoot/_vh_testbed/$1</A>
</I>&gt;<i> &gt; &gt; [L,P]
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; (the elaborate VirtualHostRoot stuff is for a zope virtual hosting provision.)
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; does any of this sound familiar to anyone?  suggestions about
</I>&gt;<i> &gt; &gt; debugging it?  (stepping through the input and output filters using
</I>&gt;<i> &gt; &gt; PythonEnablePdb yields little or no illumination - they just keep
</I>&gt;<i> &gt; &gt; getting invoked.  i don't know what to look for tracing added to
</I>&gt;<i> &gt; &gt; importer.py FilterDispatch, which i tried instead of using
</I>&gt;<i> &gt; &gt; PythonEnablePdb.)
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; any help would be appreciated!
</I>&gt;<i>
</I></PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024137.html">[mod_python] stumped by inputfilter infinite repeat
</A></li>
	<LI>Next message: <A HREF="024139.html">[mod_python] stumped by inputfilter infinite repeat
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24138">[ date ]</a>
              <a href="thread.html#24138">[ thread ]</a>
              <a href="subject.html#24138">[ subject ]</a>
              <a href="author.html#24138">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
