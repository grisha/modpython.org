<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Re: Debian bug#433038: mod_python collides with
	mod_php5
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Re%3A%20Debian%20bug%23433038%3A%20mod_python%20collides%20with%0A%09mod_php5&In-Reply-To=20070831065336.GB25027%40mycre.ws">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024179.html">
   <LINK REL="Next"  HREF="024181.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Re: Debian bug#433038: mod_python collides with
	mod_php5</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Re%3A%20Debian%20bug%23433038%3A%20mod_python%20collides%20with%0A%09mod_php5&In-Reply-To=20070831065336.GB25027%40mycre.ws"
       TITLE="[mod_python] Re: Debian bug#433038: mod_python collides with
	mod_php5">graham.dumpleton at gmail.com
       </A><BR>
    <I>Fri Aug 31 04:24:19 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="024179.html">[mod_python] Re: Debian bug#433038: mod_python collides with
	mod_php5
</A></li>
        <LI>Next message: <A HREF="024181.html">[mod_python] Re: Debian bug#433038: mod_python collides with
	mod_php5
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24180">[ date ]</a>
              <a href="thread.html#24180">[ thread ]</a>
              <a href="subject.html#24180">[ subject ]</a>
              <a href="author.html#24180">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 31/08/2007, Robert Edmonds &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">edmonds at debian.org</A>&gt; wrote:
&gt;<i> Graham Dumpleton wrote:
</I>&gt;<i> &gt; More information. In libmhash2 it has:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; lib/.libs/libmhash.a(md5.o):
</I>&gt;<i> &gt; 00000a60 T _MD5Final
</I>&gt;<i> &gt; 00000000 T _MD5Init
</I>&gt;<i> &gt; 00000040 T _MD5Transform
</I>&gt;<i> &gt; 00000940 T _MD5Update
</I>&gt;<i> &gt;          U _mutils_bzero
</I>&gt;<i> &gt;          U _mutils_memcpy
</I>&gt;<i> &gt;          U _mutils_word32nswap
</I>&gt;<i> &gt;          U dyld_stub_binding_helper
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; In Python (&lt;2.5), it has its own md5c.c file. If this is compiled
</I>&gt;<i> &gt; correctly, it should end up with:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 00001288 T __Py_MD5Final
</I>&gt;<i> &gt; 00001174 T __Py_MD5Init
</I>&gt;<i> &gt; 000011b4 T __Py_MD5Update
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Ie., Python should prefix the symbols so there is no clash.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; You should check that this prefixing is actually occurring by doing an
</I>&gt;<i> &gt; nm on md5.so in Python modules directory. If it isn't, that could be
</I>&gt;<i> &gt; the problem.
</I>&gt;<i>
</I>&gt;<i> It looks like this is not the case --
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">edmonds at chase</A>{0}:~$ nm -D /usr/lib/python2.4/lib-dynload/md5.so | grep MD5
</I>&gt;<i> 0000000000001b30 T MD5Final
</I>&gt;<i> 0000000000001380 T MD5Init
</I>&gt;<i> 00000000000013b0 T MD5Transform
</I>&gt;<i> 0000000000001c10 T MD5Update
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">edmonds at chase</A>{0}:~$ nm -D /usr/lib/libmhash.so.2 | grep MD5
</I>&gt;<i> 00000000000069b0 T MD5Final
</I>&gt;<i> 0000000000006200 T MD5Init
</I>&gt;<i> 0000000000006230 T MD5Transform
</I>&gt;<i> 0000000000006a80 T MD5Update
</I>&gt;<i>
</I>&gt;<i> I guess this is the root cause of Debian bug #411487, but it looks like
</I>&gt;<i> the submitter of #433038 still experiences his problem even when
</I>&gt;<i> libmhash is not loaded into the apache process.
</I>
I think I know what may have gone wrong here.

In Python source code there is md5c.c and md5.h. In the md5.h file it has:

/* Rename all exported symbols to avoid conflicts with similarly named
   symbols in some systems' standard C libraries... */

#define MD5Init _Py_MD5Init
#define MD5Update _Py_MD5Update
#define MD5Final _Py_MD5Final

void MD5Init(MD5_CTX *);
void MD5Update(MD5_CTX *, unsigned char *, unsigned int);
void MD5Final(unsigned char [16], MD5_CTX *);

If when the Python package was Debianised, whoever did it added
additional -I flags at the start of the CPPFLAGS passed to the
compiler such that instead of picking up md5.h from the Python source
directory, it picked up one from some system include directory, or
from another package, then the symbols would not have been namespace
prefixed like they should have.

As a result, just for Debian package of Python, the symbols wouldn't
be namespaced and thus why this problem only appears on Linux systems
derived from Debian packages.

The only way therefore of fixing this may be to review the Debian
package build scripts around Python to see if they do do something
with -I as a described. Simple fix may then be to append the -I flags
rather than prepend them. Otherwise, would be necessary to patch
md5c.c in Python source code to move the #defines into it just before
&quot;md5.h&quot; is included. That way the namespace prefixing will occur even
if wrong &quot;md5.h&quot; is included. One would hope though in this case that
the &quot;md5.h&quot; file actually used is compatible with the md5c.c file in
Python.

Graham
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024179.html">[mod_python] Re: Debian bug#433038: mod_python collides with
	mod_php5
</A></li>
	<LI>Next message: <A HREF="024181.html">[mod_python] Re: Debian bug#433038: mod_python collides with
	mod_php5
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24180">[ date ]</a>
              <a href="thread.html#24180">[ thread ]</a>
              <a href="subject.html#24180">[ subject ]</a>
              <a href="author.html#24180">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
