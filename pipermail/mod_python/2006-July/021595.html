<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Session not working with mpm-prefork and only one
	server
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Session%20not%20working%20with%20mpm-prefork%20and%20only%20one%0A%09server&In-Reply-To=44BB57D1.2040901%40kleibi.de">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021594.html">
   <LINK REL="Next"  HREF="021590.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Session not working with mpm-prefork and only one
	server</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Jim Gallacher</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Session%20not%20working%20with%20mpm-prefork%20and%20only%20one%0A%09server&In-Reply-To=44BB57D1.2040901%40kleibi.de"
       TITLE="[mod_python] Session not working with mpm-prefork and only one
	server">jpg at jgassociates.ca
       </A><BR>
    <I>Mon Jul 17 07:53:11 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="021594.html">[mod_python] Session not working with mpm-prefork and only one
	server
</A></li>
        <LI>Next message: <A HREF="021590.html">[mod_python] module reloading
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21595">[ date ]</a>
              <a href="thread.html#21595">[ thread ]</a>
              <a href="subject.html#21595">[ subject ]</a>
              <a href="author.html#21595">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Michael Kleiber wrote:
&gt;<i> 
</I>&gt;&gt;<i> Other people have no problems with sessions when using prefork. You more
</I>&gt;&gt;<i> than likely have some problem with your machine configuration in
</I>&gt;&gt;<i> respect of
</I>&gt;&gt;<i> mutex locks or some other area.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> What version of mod_python  are you using? What command line options did
</I>&gt;&gt;<i> you use when you ran &quot;configure&quot; to build it, or did you use a RPM
</I>&gt;&gt;<i> version?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Also, what sort of data are you trying to put into the session object?
</I>&gt;&gt;<i> Do you
</I>&gt;&gt;<i> have multiple independent instances of Apache running on the same box
</I>&gt;&gt;<i> with both running mod_python?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Graham
</I>&gt;&gt;<i>
</I>&gt;<i> I have tried the packaged version of apache, mod_python etc. of Ubuntu
</I>&gt;<i> Dapper but have also compiled the newest version from source. I used the
</I>&gt;<i> prefork module and wanted to control the started child processes. I used
</I>&gt;<i> the following config:
</I>&gt;<i> 
</I>&gt;<i> &lt;IfModule prefork.c&gt;
</I>&gt;<i> StartServers         1
</I>&gt;<i> MinSpareServers      1
</I>&gt;<i> MaxSpareServers     1 (or 0 I can't remember exactly right now)
</I>&gt;<i> MaxClients          1
</I>&gt;<i> MaxRequestsPerChild  0
</I>&gt;<i> &lt;/IfModule&gt;
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Therefore I only had one child process running and only one mutex was
</I>&gt;<i> created (from apache error log when starting the server). With this not
</I>&gt;<i> even a simple Session() object could be created.
</I>&gt;<i> 
</I>&gt;<i> This was for my local test system where I did not want any extra (not
</I>&gt;<i> needed) child processes. Not a likely config in any real environment but
</I>&gt;<i> it gave me headaches for quite some time.
</I>&gt;<i> 
</I>
Try increasing the MaxClients to 2 or don't lock your sessions. You are
likely only creating one mutex at startup. The number of mutexes created
is based on the StartServers and MaxClients directives up to some
maximum number. Check your error.log at start up to confirm this.

[Mon Jul 17 07:40:58 2006] [notice] mod_python: Creating 8 session
mutexes based on 50 max processes and 0 max threads.

Session requires at least 2 mutexes, one of which is reserved for
locking the dbm file, and the rest for locking the session itself. For
testing you could try turning off locking when you create your session
instance, which should fix the problem.

sess = Session.Session(req, lock=0)

Since will only be making one request at a time when testing you don't
need to worry about any race conditions resulting from making multiple
requests for the same session data.

At times we have recommended that people use a configuration similar to
yours for testing, so I guess we really should increase the minimum
number of locks to 2 instead of 1.

Jim


</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021594.html">[mod_python] Session not working with mpm-prefork and only one
	server
</A></li>
	<LI>Next message: <A HREF="021590.html">[mod_python] module reloading
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21595">[ date ]</a>
              <a href="thread.html#21595">[ thread ]</a>
              <a href="subject.html#21595">[ subject ]</a>
              <a href="author.html#21595">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
