<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] module reloading
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20module%20reloading&In-Reply-To=4FA7039B-9963-4558-B88D-9F18225EFC6E%40math.harvard.edu">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021586.html">
   <LINK REL="Next"  HREF="021587.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] module reloading</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>David MacQuigg</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20module%20reloading&In-Reply-To=4FA7039B-9963-4558-B88D-9F18225EFC6E%40math.harvard.edu"
       TITLE="[mod_python] module reloading">david_macquigg at yahoo.com
       </A><BR>
    <I>Fri Jul 21 12:45:41 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="021586.html">[mod_python] module reloading
</A></li>
        <LI>Next message: <A HREF="021587.html">[mod_python] module reloading
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21645">[ date ]</a>
              <a href="thread.html#21645">[ thread ]</a>
              <a href="subject.html#21645">[ subject ]</a>
              <a href="author.html#21645">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Sorry for the late reply.  I posted this last week, but made a mistake in 
using the wrong return address, which resulted in the message being 
rejected without notice.  I also got no response from 
<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python-owner at modpython.org</A>

At 08:46 PM 7/13/2006 -0400, you wrote:

&gt;<i>I'm having issues with ye olde module reloading.
</I>&gt;<i>
</I>&gt;<i>i.e. modules don't reload, need to restart server, yadda yadda yadda.
</I>&gt;<i>
</I>&gt;<i>Even touching all my .py and .pyc files doesn't seem to help... it
</I>&gt;<i>still seems to require a restart.
</I>&gt;<i>
</I>&gt;<i>I see there have been frequent posts about this issue on this list,
</I>&gt;<i>and it sounds like it's not quite resolved yet.
</I>&gt;<i>
</I>&gt;<i>I'm wondering if there's a simple line or two of code I can add to my
</I>&gt;<i>entry point, before any importing happens, which will clean out the
</I>&gt;<i>module cache? Just unload everything to force a reload of everything?
</I>&gt;<i>That would work quite well for me during development.
</I>
I know very little about mod_python, but let me speculate based on my 
understanding of Python reloads.  There are discussions of module 
importing/reloading in &quot;Learning Python, 2nd ed. pp.266-269, and in &quot;Python 
in a Nutshell&quot;, pp.120-123.  I've also put what I hope is a more clear 
presentation for students at <A HREF="http://purl.net/macquigg/Python/Misc/Reload.htm">http://purl.net/macquigg/Python/Misc/Reload.htm</A>

You could &quot;clean out the module cache&quot; by deleting everything in 
sys.modules.  That would trick your import statements to reload their 
modules instead of referencing existing copies.  You should do this 
explicitly with the reload() function, however, and avoid unintended 
deletion of other modules.

What you are asking for (a general command 'clean out everything but system 
stuff') may be practically impossible.  Take a look at sys.modules.keys(), 
even before loading any of your own modules.  There is a lot of stuff 
there.  The interpreter doesn't keep track of what objects in these modules 
have been referenced/copied/subclassed/instantiated/etc, and now have 
references (bindings) that keep them in memory until the last reference is 
gone, and the garbage collector can do its job.  Reloading a module creates 
new objects in memory, but leaves *as is* any old objects with active 
references.  Example:

import Module1
x1 = Module1.x
reload(Module1)
x2 = Module1.x

x2 now binds the updated object Module1.x, but the old object is still kept 
in memory bound to variable x1.

The only way to ensure a clean update, with no vestiges of an old module, 
is to restart the interpreter session, as IDLE does when you press key F5.

I don't know if it might be possible to restart mod_python without 
restarting Apache.  That could work if it were set up like a Sendmail 
milter.  I edit my milter frequently, and restarting it is easy, with no 
apparent disruption of Sendmail.  Sendmail milters interface via a socket, 
so maybe an &quot;arms length&quot; interface like this would be required between 
mod_python and Apache.

If you are working on a development system, '/etc/init.d/httpd restart' 
should not cause any disruption, and it seems to be just as fast as 
restarting Python.

-- Dave
************************************************************     *
* David MacQuigg, PhD      email: macquigg at open-mail.org   *  *
* President, Open-Mail dot org      phone: USA 520-721-4583   *  *  *
* Postmaster, Box67 dot com                                   *  *  *
*                                 9320 East Mikelyn Lane       * * *
* <A HREF="http://purl.net/macquigg">http://purl.net/macquigg</A>        Tucson, Arizona 85710          *
************************************************************     *

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021586.html">[mod_python] module reloading
</A></li>
	<LI>Next message: <A HREF="021587.html">[mod_python] module reloading
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21645">[ date ]</a>
              <a href="thread.html#21645">[ thread ]</a>
              <a href="subject.html#21645">[ subject ]</a>
              <a href="author.html#21645">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
