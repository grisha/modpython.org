<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] concurrent connections
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20concurrent%20connections&In-Reply-To=1153784004.19449%40dscpl.user.openhosting.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021658.html">
   <LINK REL="Next"  HREF="021660.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] concurrent connections</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Jay Knight</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20concurrent%20connections&In-Reply-To=1153784004.19449%40dscpl.user.openhosting.com"
       TITLE="[mod_python] concurrent connections">jhknight at gmail.com
       </A><BR>
    <I>Mon Jul 24 23:18:57 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="021658.html">[mod_python] concurrent connections
</A></li>
        <LI>Next message: <A HREF="021660.html">[mod_python] concurrent connections
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21659">[ date ]</a>
              <a href="thread.html#21659">[ thread ]</a>
              <a href="subject.html#21659">[ subject ]</a>
              <a href="author.html#21659">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>1.  I was just using firefox when I noticed this behavior.
2. 2.0.58
3. looks like it's prefork
4. StartServers            2
    MinSpareServers         1
    MaxSpareServers         5
    MaxClients             64
    MaxRequestsPerChild  4000
5. 3.1.4

I just now noticed that this behavior only happens when the same URL
is called.  For example, if I have a file test.py in this directory,
and call its url, the mptest.py is still used because it's defined as
the handler.  If I try to load mptest.py and test.py at the same time,
they will both return 5 seconds later, but calling the same URL twice
will invoke the problem.

Everything else running on this server has no trouble with
concurrancy, just these scripts, so I'm guessing it's not apache
itself.

Any more ideas?

Jay K

On 7/24/06, Graham Dumpleton &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">grahamd at dscpl.com.au</A>&gt; wrote:
&gt;<i> Jay Knight wrote ..
</I>&gt;<i> &gt; If you take the hello world example, and add a time.sleep(5) at the
</I>&gt;<i> &gt; beginning... like this:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; -----
</I>&gt;<i> &gt; import time
</I>&gt;<i> &gt; from mod_python import apache
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; def handler(req):
</I>&gt;<i> &gt;     time.sleep(5)
</I>&gt;<i> &gt;     req.content_type = &quot;text/plain&quot;
</I>&gt;<i> &gt;     req.write(&quot;Hello World!&quot;)
</I>&gt;<i> &gt;     return apache.OK
</I>&gt;<i> &gt; -----
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Then request that URL twice, it seems that the second one doesn't
</I>&gt;<i> &gt; start until the first one is completely finished, that is, I can't
</I>&gt;<i> &gt; make them run at the same time.  (And therefore, if I started 20 at
</I>&gt;<i> &gt; about the same time, the last one would not complete until about 100
</I>&gt;<i> &gt; seconds later, etc)  How would I go about making them run at the same
</I>&gt;<i> &gt; time?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I've got a pretty standard mod_python install on gentoo.  The
</I>&gt;<i> &gt; .htaccess for this directory is
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; -----
</I>&gt;<i> &gt; AddHandler mod_python .py
</I>&gt;<i> &gt; PythonHandler mptest
</I>&gt;<i> &gt; PythonDebug On
</I>&gt;<i> &gt; -----
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I know this must be possible.  But I don't know if it is a
</I>&gt;<i> &gt; configuration issue (.htaccess) or something within the code itself
</I>&gt;<i> &gt; (manually forking stuff off to handle multiple connections? bleh).
</I>&gt;<i>
</I>&gt;<i> Apache should handle everything for you so as to allow concurrent
</I>&gt;<i> connections.
</I>&gt;<i>
</I>&gt;<i> Some questions for you.
</I>&gt;<i>
</I>&gt;<i> 1. What client are you using to create the connections and test this?
</I>&gt;<i> Are you sure it isn't the client that is serialising the requests?
</I>&gt;<i>
</I>&gt;<i> One would normally use 'ab&quot; to do such a test. For example:
</I>&gt;<i>
</I>&gt;<i>   ab -n 10 -c 5 <A HREF="http://localhost/some/path">http://localhost/some/path</A>
</I>&gt;<i>
</I>&gt;<i> The '-n' option says 10 requests, with '-c' saying run 5 concurrently.
</I>&gt;<i>
</I>&gt;<i> 2. What version of Apache are you using?
</I>&gt;<i>
</I>&gt;<i> 3. If Apache 2.X, what MPM is compiled in to it, worker or prefork?
</I>&gt;<i>
</I>&gt;<i> You can determine this by going:
</I>&gt;<i>
</I>&gt;<i>   httpd -l
</I>&gt;<i>
</I>&gt;<i> and then looking for either 'worker.c' or 'prefork.c' file being compiled in.
</I>&gt;<i>
</I>&gt;<i> 4. How is Apache configured in respect of number of child processes
</I>&gt;<i> to create etc.
</I>&gt;<i>
</I>&gt;<i> For example:
</I>&gt;<i>
</I>&gt;<i> &lt;IfModule mpm_prefork_module&gt;
</I>&gt;<i>     StartServers          5
</I>&gt;<i>     MinSpareServers       5
</I>&gt;<i>     MaxSpareServers      10
</I>&gt;<i>     MaxClients          150
</I>&gt;<i>     MaxRequestsPerChild   0
</I>&gt;<i> &lt;/IfModule&gt;
</I>&gt;<i>
</I>&gt;<i> or:
</I>&gt;<i>
</I>&gt;<i> &lt;IfModule mpm_worker_module&gt;
</I>&gt;<i>     StartServers          2
</I>&gt;<i>     MaxClients          150
</I>&gt;<i>     MinSpareThreads      25
</I>&gt;<i>     MaxSpareThreads      75
</I>&gt;<i>     ThreadsPerChild      25
</I>&gt;<i>     MaxRequestsPerChild   0
</I>&gt;<i> &lt;/IfModule&gt;
</I>&gt;<i>
</I>&gt;<i> 5. What version of mod_python are you using?
</I>&gt;<i>
</I>&gt;<i> Graham
</I>&gt;<i>
</I></PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021658.html">[mod_python] concurrent connections
</A></li>
	<LI>Next message: <A HREF="021660.html">[mod_python] concurrent connections
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21659">[ date ]</a>
              <a href="thread.html#21659">[ thread ]</a>
              <a href="subject.html#21659">[ subject ]</a>
              <a href="author.html#21659">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
