<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] weird request.connection.remote_ip value
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20weird%20request.connection.remote_ip%20value&In-Reply-To=C36B2D27-E9B9-4BB0-8B71-EB5AF25E6413%40math.harvard.edu">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021559.html">
   <LINK REL="Next"  HREF="021560.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] weird request.connection.remote_ip value</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20weird%20request.connection.remote_ip%20value&In-Reply-To=C36B2D27-E9B9-4BB0-8B71-EB5AF25E6413%40math.harvard.edu"
       TITLE="[mod_python] weird request.connection.remote_ip value">grahamd at dscpl.com.au
       </A><BR>
    <I>Sat Jul  8 23:05:11 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="021559.html">[mod_python] weird request.connection.remote_ip value
</A></li>
        <LI>Next message: <A HREF="021560.html">[mod_python] weird request.connection.remote_ip value
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21561">[ date ]</a>
              <a href="thread.html#21561">[ thread ]</a>
              <a href="subject.html#21561">[ subject ]</a>
              <a href="author.html#21561">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On 09/07/2006, at 12:48 PM, David Harvey wrote:

&gt;<i>
</I>&gt;<i> On Jul 8, 2006, at 10:38 PM, Graham Dumpleton wrote:
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On 09/07/2006, at 12:13 PM, David Harvey wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I'm running mod_python 3.2.8 on Mac OS 10.4.6, python 2.4.3,  
</I>&gt;&gt;&gt;<i> apache 2.2.2, on my desktop machine.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I've got apache set up to load this script:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> ========================= begin
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> from mod_python import apache
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> def handler(request):
</I>&gt;&gt;&gt;<i>     request.write(request.connection.remote_ip)
</I>&gt;&gt;&gt;<i>     return apache.OK
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> ========================= end
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> When I browse to &quot;<A HREF="http://127.0.0.1/&quot;,">http://127.0.0.1/&quot;,</A> the script prints out  
</I>&gt;&gt;&gt;<i> &quot;127.0.0.1&quot; as expected.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> If I connect from a local network, e.g. to &quot;<A HREF="http://192.168.0.6/&quot;">http://192.168.0.6/&quot;</A>  
</I>&gt;&gt;&gt;<i> it prints out &quot;192.168.0.4&quot; (the address of the other machine) as  
</I>&gt;&gt;&gt;<i> expected.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> But when I browse to &quot;<A HREF="http://localhost/&quot;">http://localhost/&quot;</A> from this machine, it  
</I>&gt;&gt;&gt;<i> prints &quot;::1&quot;.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> What does &quot;::1&quot; mean? Why isn't it giving me an IP address?  
</I>&gt;&gt;&gt;<i> Shouldn't I be getting &quot;127.0.0.1&quot; as above? How can I guarantee  
</I>&gt;&gt;&gt;<i> to get an IP address?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This field is populated by apr_sockaddr_ip_get() in Apache Runtime  
</I>&gt;&gt;<i> library. The field
</I>&gt;&gt;<i> can be populated with either IPv4 or IPv6 addresses. On a Mac,  
</I>&gt;&gt;<i> when you use the
</I>&gt;&gt;<i> string &quot;localhost&quot; it is as far as I know actually using an IPv6  
</I>&gt;&gt;<i> connection to Apache and
</I>&gt;&gt;<i> &quot;::1&quot; is what the Mac is using to identify that IPv6 client.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> What do you want the remote IP address for? Depending on what you  
</I>&gt;&gt;<i> want to do,
</I>&gt;&gt;<i> there may be better ways of doing it.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Graham
</I>&gt;<i>
</I>&gt;<i> Basically I want to use it as a temporary username for anonymous  
</I>&gt;<i> visitors who haven't registered for an account. Kind of like how  
</I>&gt;<i> wikipedia does. I was just a bit concerned when I saw &quot;::1&quot;, it  
</I>&gt;<i> made me feel that using remote_ip is not a particularly reliable  
</I>&gt;<i> way to get the request IP address. Do you have any other suggestions?
</I>
What happens if you have two visitors from the same remote machine?  
You might
be better off having the server side generate a random ID which is  
saved back to
the client browser using cookies. You might even use session objects  
and the session
SID then becomes the ID in some way. Am sure others will suggest  
perhaps more
secure ways of doing it.

Graham
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021559.html">[mod_python] weird request.connection.remote_ip value
</A></li>
	<LI>Next message: <A HREF="021560.html">[mod_python] weird request.connection.remote_ip value
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21561">[ date ]</a>
              <a href="thread.html#21561">[ thread ]</a>
              <a href="subject.html#21561">[ subject ]</a>
              <a href="author.html#21561">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
