<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] modpython, mysqldb best paractice
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20modpython%2C%20mysqldb%20best%20paractice&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021624.html">
   <LINK REL="Next"  HREF="021627.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] modpython, mysqldb best paractice</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Martijn Moeling</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20modpython%2C%20mysqldb%20best%20paractice&In-Reply-To="
       TITLE="[mod_python] modpython, mysqldb best paractice">martijn at xs4us.nu
       </A><BR>
    <I>Wed Jul 19 05:41:55 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="021624.html">[mod_python] mod_python calls the wrong python executable
</A></li>
        <LI>Next message: <A HREF="021627.html">[mod_python] modpython, mysqldb best paractice
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21623">[ date ]</a>
              <a href="thread.html#21623">[ thread ]</a>
              <a href="subject.html#21623">[ subject ]</a>
              <a href="author.html#21623">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi all,

 

I started the development of a specific kind of CMS over 2 years ago,
and due to sparse documentation I am still puzzled about a few things.

Basically it consist of one .py and a mysqldatabase with all the data
and templates, ALL pages are generated on the fly.

 

First of all I am confused about PythonInterPerDirectory and
PythonInterpPerDirectory

In the way I use modpython.

 

My apache has no configured virtual hosts since my CMS can handle this
on its own by looking at req.host

On one site which is running on my system ( <A HREF="http://www.mkbok.nl">http://www.mkbok.nl</A>
&lt;<A HREF="http://www.mkbok.nl/">http://www.mkbok.nl/</A>&gt;  ) we use different subdomains, so basically 

the page to be build is derived from the req.host (e.g.
xxx.yyy.mkbok.nl) where xxx and yyy are variable. 

This is done by DNS records like   *     A      ip1.ip2.ip3.ip4

 

My next problem seems mysql and mysqldb.

Since I do not know which website is requested (multiple are running on
that server) I open a database connection, do my stuff and close the
connection, 

Again the database selection comes from req.host, and here the
domainname is used for database selection.

 

The system runs extremely well, but once in a while the webserver
becomes so busy that it does not respond to page request anymore. 

We suspect that mysql is the problem here since the only thing we can
see is mysql is consuming more and more swapspace and at some point it
runs out of resources and starts looping. At that point the system
(Linux) keeps running but with a 100% cpu utilization and we are unable
to login and investigate. 

So logging in to the UPS remotely and power down the system by virtually
unplugging the cable is the only (and BAD) solution.

 

So what is best practice when you have to connect to mysql with mysqldb
in a mod_python environment keeping in mind that the database connection
has to be build every time a visitor requests a page? Think in terms of
a &quot;globally&quot; available db or db.cursor connection.

Since global variables are troublesome in the .py contaning the handler
I use a class from which an instance is created every time a client
connects and the DB connection is global to that class, ist that wrong?

 

What happenens if mod_python finds an error before my mysqldb connection
is closed (not that this happenes a lot, but it does happen, sorry)

 

Also I do not understand the req.register_cleanup() method, what is
cleaned up and what not?

 

Martijn

  

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060719/40cc3f3f/attachment-0001.html">http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060719/40cc3f3f/attachment-0001.html</A>
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021624.html">[mod_python] mod_python calls the wrong python executable
</A></li>
	<LI>Next message: <A HREF="021627.html">[mod_python] modpython, mysqldb best paractice
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21623">[ date ]</a>
              <a href="thread.html#21623">[ thread ]</a>
              <a href="subject.html#21623">[ subject ]</a>
              <a href="author.html#21623">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
