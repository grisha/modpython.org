<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] apache.DECLINED not working as expected
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20apache.DECLINED%20not%20working%20as%20expected&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021533.html">
   <LINK REL="Next"  HREF="021535.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] apache.DECLINED not working as expected</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20apache.DECLINED%20not%20working%20as%20expected&In-Reply-To="
       TITLE="[mod_python] apache.DECLINED not working as expected">grahamd at dscpl.com.au
       </A><BR>
    <I>Sun Jul  2 18:16:32 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="021533.html">[mod_python] apache.DECLINED not working as expected
</A></li>
        <LI>Next message: <A HREF="021535.html">[mod_python] MySQL Session implementation?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21534">[ date ]</a>
              <a href="thread.html#21534">[ thread ]</a>
              <a href="subject.html#21534">[ subject ]</a>
              <a href="author.html#21534">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>webograph wrote ..
&gt;<i> hi,
</I>&gt;<i> 
</I>&gt;<i> i'm currently implementing a server that provides downsampled and
</I>&gt;<i> cropped versions of available images.
</I>&gt;<i> the idea is to have a regular directory structure and a python handler
</I>&gt;<i> that does (in pseudocode):
</I>&gt;<i> 
</I>&gt;<i> if exists(requested_file):
</I>&gt;<i>     return apache.DECLINED
</I>&gt;<i> 
</I>&gt;<i> image=open(original(requested_file))
</I>&gt;<i> image=image.scale_down()
</I>&gt;<i> image.save(requested_file)
</I>&gt;<i> 
</I>&gt;<i> return apache.DECLINED
</I>&gt;<i> 
</I>&gt;<i> the problem is that i always get a 404 when i request a file that has
</I>&gt;<i> just been created; it's not a timing problem.
</I>&gt;<i> 
</I>&gt;<i> i've solved it using a req.internal_redirect, but i don't think that
</I>&gt;<i> that is the ideal solution
</I>
The short answer is to use req.sendfile() to have your handler respond
with the actual content of the file. You will need to ensure you set
any appropriate content type before making the call though. Thus
your code might read:

  if not exists(requested_file):
    image=open(original(requested_file))
    image=image.scale_down()
    image.save(requested_file)

  req.content_type = &quot;...&quot;
  req.sendfile(requested_file)

  return apache.OK

Returning apache.DECLINED in order to have Apache default handler
return the file may not be the most reliable way of doing things
especially when the file didn't exist before hand and if MultiViews
is enabled and comes into play.

Graham
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021533.html">[mod_python] apache.DECLINED not working as expected
</A></li>
	<LI>Next message: <A HREF="021535.html">[mod_python] MySQL Session implementation?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21534">[ date ]</a>
              <a href="thread.html#21534">[ thread ]</a>
              <a href="subject.html#21534">[ subject ]</a>
              <a href="author.html#21534">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
