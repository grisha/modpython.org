<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Thread stopping and asynchronous calls
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Thread%20stopping%20and%20asynchronous%20calls&In-Reply-To=7.0.0.16.2.20071116165857.024bfe88%40bbn.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024455.html">
   <LINK REL="Next"  HREF="024457.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Thread stopping and asynchronous calls</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Thread%20stopping%20and%20asynchronous%20calls&In-Reply-To=7.0.0.16.2.20071116165857.024bfe88%40bbn.com"
       TITLE="[mod_python] Thread stopping and asynchronous calls">graham.dumpleton at gmail.com
       </A><BR>
    <I>Fri Nov 16 17:22:19 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="024455.html">[mod_python] Thread stopping and asynchronous calls
</A></li>
        <LI>Next message: <A HREF="024457.html">[mod_python] How declared correctly the way in the pg.html to the
	apache server can resolv the script python correctly
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24456">[ date ]</a>
              <a href="thread.html#24456">[ thread ]</a>
              <a href="subject.html#24456">[ subject ]</a>
              <a href="author.html#24456">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Apache will kill of child processes based on exceeding
MaxRequestsPerChild. Also, if it has to create additional processes to
meet demand, when demand drops off, it randomly kills of processes to
drop back to idle state number of processes.

Graham

On 17/11/2007, Chris Guin &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">cguin at bbn.com</A>&gt; wrote:
&gt;<i> The idea isn't to have multiple processes, but just one - I guess the
</I>&gt;<i> big obvious thing I didn't think about was that there's no reason to
</I>&gt;<i> have the thread running within the python interpreter started up from
</I>&gt;<i> Apache.  Since it's already communicating via database messages, I
</I>&gt;<i> should just figure out how to separate it from mod_python/Apache-land
</I>&gt;<i> and run it stand alone.  I wasn't aware that Apache would forcibly
</I>&gt;<i> terminate one of its own processes - that would certainly explain the
</I>&gt;<i> behavior, although why it would do that in the thick of a lot of
</I>&gt;<i> requests isn't obvious to me.
</I>&gt;<i>
</I>&gt;<i> Thanks for your patience,
</I>&gt;<i> Chris
</I>&gt;<i>
</I>&gt;<i> At 04:51 PM 11/16/2007, you wrote:
</I>&gt;<i> &gt;Huh, are you saying that you are creating a listener socket in the
</I>&gt;<i> &gt;Apache child process from mod_python. You can't really do this as
</I>&gt;<i> &gt;Apache is a multi processor web server and you cant have multiple
</I>&gt;<i> &gt;processes creating a listener socket on the same port. Thus all but
</I>&gt;<i> &gt;the first Apache child process would fail. When that process gets
</I>&gt;<i> &gt;recycled by Apache, none of the other Apache child processes would
</I>&gt;<i> &gt;take over and thus no listener anymore.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;Graham
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;On 17/11/2007, Chris Guin &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">cguin at bbn.com</A>&gt; wrote:
</I>&gt;<i> &gt; &gt; I've been working on a custom chat server for Django (using
</I>&gt;<i> &gt; &gt; mod_python), but have been hugely frustrated with the behavior of my
</I>&gt;<i> &gt; &gt; &quot;listening thread.&quot;  The thread stops at either the time.sleep() or
</I>&gt;<i> &gt; &gt; select.select() call and never returns - usually when a lot of
</I>&gt;<i> &gt; &gt; asynchronous requests are being answered by the server, although not
</I>&gt;<i> &gt; &gt; always (even with one or two browsers left running over night, the
</I>&gt;<i> &gt; &gt; thread will eventually stop).  Increasing the frequency of the async
</I>&gt;<i> &gt; &gt; requests or increasing the number of browsers raises the chance of
</I>&gt;<i> &gt; &gt; stoppage to near certain levels - but there's still a high random
</I>&gt;<i> &gt; factor to it.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; I have guaranteed that there is only one &quot;listening thread&quot; running
</I>&gt;<i> &gt; &gt; at any time, and have commented out all database and network accesses
</I>&gt;<i> &gt; &gt; (so my listening thread is just printing out debug statements and
</I>&gt;<i> &gt; &gt; calling time.sleep() and my AJAX calls only retrieve random
</I>&gt;<i> &gt; &gt; numbers).  The problem still occurs, and in the same manner.  Nor is
</I>&gt;<i> &gt; &gt; it a gradual slowdown - time.sleep() takes the correct number of
</I>&gt;<i> &gt; &gt; seconds to return right up until the time it fails to return at all.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; When Apache starts up it says: &quot;mod_python: Creating 8 session
</I>&gt;<i> &gt; &gt; mutexes based on 256 max processes and 0 max threads.&quot;  This looks a
</I>&gt;<i> &gt; &gt; little suspicious - is there a mod_python setting that I have
</I>&gt;<i> &gt; &gt; incorrect?  My understanding of the workings of mod_python is fairly
</I>&gt;<i> &gt; &gt; weak, so this may not even the right group to be posting to.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Thanks for any help you could give,
</I>&gt;<i> &gt; &gt; Chris Guin
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; _______________________________________________
</I>&gt;<i> &gt; &gt; Mod_python mailing list
</I>&gt;<i> &gt; &gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> &gt; &gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i> &gt; &gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I></PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024455.html">[mod_python] Thread stopping and asynchronous calls
</A></li>
	<LI>Next message: <A HREF="024457.html">[mod_python] How declared correctly the way in the pg.html to the
	apache server can resolv the script python correctly
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24456">[ date ]</a>
              <a href="thread.html#24456">[ thread ]</a>
              <a href="subject.html#24456">[ subject ]</a>
              <a href="author.html#24456">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
