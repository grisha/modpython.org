<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Session Hanging Problems
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Session%20Hanging%20Problems&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024510.html">
   <LINK REL="Next"  HREF="024512.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Session Hanging Problems</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Harish Agarwal</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Session%20Hanging%20Problems&In-Reply-To="
       TITLE="[mod_python] Session Hanging Problems">harish at octopart.com
       </A><BR>
    <I>Mon Nov 26 13:39:27 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="024510.html">[mod_python] Mac OS X Leopard upset my mod_python test bed.
</A></li>
        <LI>Next message: <A HREF="024512.html">[mod_python] Session Hanging Problems
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24511">[ date ]</a>
              <a href="thread.html#24511">[ thread ]</a>
              <a href="subject.html#24511">[ subject ]</a>
              <a href="author.html#24511">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm using session handling with ModPython 3.3.1.  Originally I was  
using DbmSession and have since transitioned to a custom MySQL Session  
handler.  With both session types, however, I've noticed that session  
initialization intermittently hangs (not forever, but takes as long as  
four minutes to complete), at a low-ish (a handful of times every  
hour, while receiving, say, on order of a thousand or so requests  
every hour) frequency which seems to scale with the amount of traffic  
we're receiving.  I had read that long DbmSession cleanups can cause  
problems, which is why I transitioned to the MySQL system, which takes  
&lt; 1 second to complete, but I'm still noticing the long session init  
times.


I put some debugging statements into the code and it seems to be  
related to session locking.  In particular, it is this function call  
in the lock method of the BaseSession class:


_apache._global_lock(self._req.server, self._sid)


which is taking some time to complete. I'm not familiar with  
_apache._global_lock (is it used to apply a mutex lock to the  
session?) and am having trouble finding information describing its  
usage - but it seems likely that this is the root cause.  In the past  
I've had problems with session locking but have since transitioned the  
code to ensure that only one session is created per request, as such:

if not hasattr(req,'session'):
             req.session = Session.MySQLSession(req)


Can anyone tell me if this kind of behavior is normal or is indicative  
of some common configuration or coding error?  Any help would be  
greatly appreciated.

Thanks,
-Harish
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024510.html">[mod_python] Mac OS X Leopard upset my mod_python test bed.
</A></li>
	<LI>Next message: <A HREF="024512.html">[mod_python] Session Hanging Problems
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24511">[ date ]</a>
              <a href="thread.html#24511">[ thread ]</a>
              <a href="subject.html#24511">[ subject ]</a>
              <a href="author.html#24511">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
