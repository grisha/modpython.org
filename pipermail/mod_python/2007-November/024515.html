<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Session Hanging Problems
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Session%20Hanging%20Problems&In-Reply-To=FAE275BD-DC2B-433E-B2C2-21C6AE67AA28%40gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024516.html">
   <LINK REL="Next"  HREF="024517.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Session Hanging Problems</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>David Janes</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Session%20Hanging%20Problems&In-Reply-To=FAE275BD-DC2B-433E-B2C2-21C6AE67AA28%40gmail.com"
       TITLE="[mod_python] Session Hanging Problems">davidjanes at blogmatrix.com
       </A><BR>
    <I>Mon Nov 26 14:50:01 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="024516.html">[mod_python] Session Hanging Problems
</A></li>
        <LI>Next message: <A HREF="024517.html">[mod_python] Session Hanging Problems
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24515">[ date ]</a>
              <a href="thread.html#24515">[ thread ]</a>
              <a href="subject.html#24515">[ subject ]</a>
              <a href="author.html#24515">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'd be certainly interested in a non-mod_python session handler, since
I'm suspecting we'll be going to a non-Apache solution soon (since we
don't really take advantage of any Apache features right now) and we
were considering writing a generic one -- or adapting mod_python's
handlers.

On the other hand as Harish notes, it would be good to solve the
problem for mod_python as mod_python's been very good to us! I'm
wondering if there's any need at all to touch the Apache global lock
anyway, or if it can worked around another way.

Regards, etc...

PS: this is what I'm working on right now:
<A HREF="http://www.onaswarm.com">http://www.onaswarm.com</A>

On Nov 26, 2007 2:21 PM, David Lenwell &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">dlenwell at gmail.com</A>&gt; wrote:
&gt;<i> yeah .. its very broken for me too .. What I am working on is my own
</I>&gt;<i> session handler.. I don't feel that mysql is a valid replacement
</I>&gt;<i> because it puts unnecessary load on your database server.
</I>&gt;<i>
</I>&gt;<i> We are debating on open sourcing the code I am working on. if I win
</I>&gt;<i> the argument that open source can be good for us then I will
</I>&gt;<i> contribute my code to the project.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Nov 26, 2007, at 10:55 AM, David Janes wrote:
</I>&gt;<i>
</I>&gt;<i> &gt; All I can say is &quot;we too&quot; -- we're using FileSession. We have not been
</I>&gt;<i> &gt; able to come up with a cure, though we've minimized use of sessions
</I>&gt;<i> &gt; which brings the frequency down significantly.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Regards, etc...
</I>&gt;<i> &gt; David
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On Nov 26, 2007 1:39 PM, Harish Agarwal &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">harish at octopart.com</A>&gt; wrote:
</I>&gt;<i> &gt;&gt; I'm using session handling with ModPython 3.3.1.  Originally I was
</I>&gt;<i> &gt;&gt; using DbmSession and have since transitioned to a custom MySQL
</I>&gt;<i> &gt;&gt; Session
</I>&gt;<i> &gt;&gt; handler.  With both session types, however, I've noticed that session
</I>&gt;<i> &gt;&gt; initialization intermittently hangs (not forever, but takes as long
</I>&gt;<i> &gt;&gt; as
</I>&gt;<i> &gt;&gt; four minutes to complete), at a low-ish (a handful of times every
</I>&gt;<i> &gt;&gt; hour, while receiving, say, on order of a thousand or so requests
</I>&gt;<i> &gt;&gt; every hour) frequency which seems to scale with the amount of traffic
</I>&gt;<i> &gt;&gt; we're receiving.  I had read that long DbmSession cleanups can cause
</I>&gt;<i> &gt;&gt; problems, which is why I transitioned to the MySQL system, which
</I>&gt;<i> &gt;&gt; takes
</I>&gt;<i> &gt;&gt; &lt; 1 second to complete, but I'm still noticing the long session init
</I>&gt;<i> &gt;&gt; times.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; I put some debugging statements into the code and it seems to be
</I>&gt;<i> &gt;&gt; related to session locking.  In particular, it is this function call
</I>&gt;<i> &gt;&gt; in the lock method of the BaseSession class:
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; _apache._global_lock(self._req.server, self._sid)
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; which is taking some time to complete. I'm not familiar with
</I>&gt;<i> &gt;&gt; _apache._global_lock (is it used to apply a mutex lock to the
</I>&gt;<i> &gt;&gt; session?) and am having trouble finding information describing its
</I>&gt;<i> &gt;&gt; usage - but it seems likely that this is the root cause.  In the past
</I>&gt;<i> &gt;&gt; I've had problems with session locking but have since transitioned
</I>&gt;<i> &gt;&gt; the
</I>&gt;<i> &gt;&gt; code to ensure that only one session is created per request, as such:
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; if not hasattr(req,'session'):
</I>&gt;<i> &gt;&gt;             req.session = Session.MySQLSession(req)
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Can anyone tell me if this kind of behavior is normal or is
</I>&gt;<i> &gt;&gt; indicative
</I>&gt;<i> &gt;&gt; of some common configuration or coding error?  Any help would be
</I>&gt;<i> &gt;&gt; greatly appreciated.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Thanks,
</I>&gt;<i> &gt;&gt; -Harish
</I>&gt;<i> &gt;&gt; _______________________________________________
</I>&gt;<i> &gt;&gt; Mod_python mailing list
</I>&gt;<i> &gt;&gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> &gt;&gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; --
</I>&gt;<i> &gt; David Janes
</I>&gt;<i> &gt; Founder, BlogMatrix
</I>&gt;<i> &gt; <A HREF="http://www.blogmatrix.com">http://www.blogmatrix.com</A>
</I>&gt;<i> &gt; <A HREF="http://blogmatrix.blogmatrix.com">http://blogmatrix.blogmatrix.com</A>
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; Mod_python mailing list
</I>&gt;<i> &gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> &gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i>
</I>&gt;<i>
</I>


-- 
David Janes
Founder, BlogMatrix
<A HREF="http://www.blogmatrix.com">http://www.blogmatrix.com</A>
<A HREF="http://blogmatrix.blogmatrix.com">http://blogmatrix.blogmatrix.com</A>
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024516.html">[mod_python] Session Hanging Problems
</A></li>
	<LI>Next message: <A HREF="024517.html">[mod_python] Session Hanging Problems
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24515">[ date ]</a>
              <a href="thread.html#24515">[ thread ]</a>
              <a href="subject.html#24515">[ subject ]</a>
              <a href="author.html#24515">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
