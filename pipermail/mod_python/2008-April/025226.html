<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] psp.redirect versus sessions: desired behavior?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20psp.redirect%20versus%20sessions%3A%20desired%20behavior%3F&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025236.html">
   <LINK REL="Next"  HREF="025230.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] psp.redirect versus sessions: desired behavior?</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Jim Geist</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20psp.redirect%20versus%20sessions%3A%20desired%20behavior%3F&In-Reply-To="
       TITLE="[mod_python] psp.redirect versus sessions: desired behavior?">jimge at rodentia.net
       </A><BR>
    <I>Thu Apr 24 01:05:07 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="025236.html">[mod_python] Best way to have an unique_id per request
</A></li>
        <LI>Next message: <A HREF="025230.html">[mod_python] Sendfile &amp; request answer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25226">[ date ]</a>
              <a href="thread.html#25226">[ thread ]</a>
              <a href="subject.html#25226">[ subject ]</a>
              <a href="author.html#25226">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I was trying to figure out why my session data was getting lost, and I  
came across some interesting behavior. Code snippet:

	# processing POST data from a form
	if login_success():
		session[&quot;userid&quot;] = userid
		psp.redirect(&quot;loggedin.psp&quot;)

in loggedin.psp

userid = session[&quot;userid&quot;]		# Whoops! KeyError!

Under normal circumstances, the psp run method does a session save  
automatically, but it wasn't happening here. Digging through the  
source reveals that this is because redirect raises  
apache.SERVER_RETURN, and the run code doesn't call session.save() if  
the page raises any exceptions.

  I can see in the general case that an argument could be made for not  
saving session data in the exception case; if an exception makes it  
back into psp, then something has probably gone wrong with page  
processing. But in this case, doing the save seems like desired  
behavior, otherwise code like the above, which seems reasonable,  
silently has different behavior from the normal case. The fact that  
the save isn't done is a byproduct of redirect internally using an  
exception to implement its early exit behavior, which isn't obvious  
from the interface level.

So, feature or bug?

-- Jim
</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025236.html">[mod_python] Best way to have an unique_id per request
</A></li>
	<LI>Next message: <A HREF="025230.html">[mod_python] Sendfile &amp; request answer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25226">[ date ]</a>
              <a href="thread.html#25226">[ thread ]</a>
              <a href="subject.html#25226">[ subject ]</a>
              <a href="author.html#25226">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
