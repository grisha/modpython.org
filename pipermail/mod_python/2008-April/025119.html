<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] old libexpat shared library
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20old%20libexpat%20shared%20library&In-Reply-To=88e286470804060314l33d4aabdrdbde793c7ebf341a%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025118.html">
   <LINK REL="Next"  HREF="025121.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] old libexpat shared library</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Luyi Chen</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20old%20libexpat%20shared%20library&In-Reply-To=88e286470804060314l33d4aabdrdbde793c7ebf341a%40mail.gmail.com"
       TITLE="[mod_python] old libexpat shared library">lychen1109 at gmail.com
       </A><BR>
    <I>Sun Apr  6 12:19:05 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="025118.html">[mod_python] old libexpat shared library
</A></li>
        <LI>Next message: <A HREF="025121.html">[mod_python] old libexpat shared library
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25119">[ date ]</a>
              <a href="thread.html#25119">[ thread ]</a>
              <a href="subject.html#25119">[ subject ]</a>
              <a href="author.html#25119">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks Graham,

I am almost done, but still need one more step. Here's what I did:

1) I installed Apache2.2.6 included apr
2) When I tried to install the included version of apr-util, I got the
following error
libtool: install: error: cannot install `libaprutil-1.la' to a
directory not ending in /usr/local/apache2/lib

A little Googling shows someone else also meet the problem, but
without finding the reason.

3) So I downloaded apr-util-1.2.12 from Apache website, and installed
it without problem.
4) I compiled Apache again with options pointing to the formerly
installed apr and apr-util
5) Now, when I ldd httpd, I got the following info

        libz.so.1 =&gt; /usr/lib/libz.so.1 (0x00002aebe6011000)
        libm.so.6 =&gt; /lib/libm.so.6 (0x00002aebe6127000)
        libaprutil-1.so.0 =&gt;
/usr/local/apr-util-httpd//lib/libaprutil-1.so.0 (0x00002aebe62ac000)
        libexpat.so.1 =&gt; /usr/lib/libexpat.so.1 (0x00002aebe63c4000)
        libapr-1.so.0 =&gt; /usr/local/apache2/lib/libapr-1.so.0
(0x00002aebe64e8000)
        librt.so.1 =&gt; /lib/librt.so.1 (0x00002aebe6610000)
        libcrypt.so.1 =&gt; /lib/libcrypt.so.1 (0x00002aebe6718000)
        libpthread.so.0 =&gt; /lib/libpthread.so.0 (0x00002aebe684c000)
        libdl.so.2 =&gt; /lib/libdl.so.2 (0x00002aebe6961000)
        libc.so.6 =&gt; /lib/libc.so.6 (0x00002aebe6a63000)
        /lib64/ld-linux-x86-64.so.2 (0x00002aebe5efa000)

This seems good, because the libexpat in my /usr/lib directory is the right one.

6) I restarted Apache
7) I checked runtime context of Apache, then I got this

$ ps aux | grep http | head -3
root      4757  0.0  3.9  47972 10212 ?        Ss   Apr04   0:00
/usr/local/apache2/bin/httpd -k restart
apache   29984  0.0  3.4  48104  8992 ?        S    23:31   0:00
/usr/local/apache2/bin/httpd -k restart
apache   29985  0.0  3.2  47972  8580 ?        S    23:31   0:00
/usr/local/apache2/bin/httpd -k restart

$ sudo /usr/sbin/lsof -p 4757 | grep expat
httpd   4757 root  mem    REG     8,1    397288 1183944
/usr/local/apache2/lib/libexpat.so.0.1.0
httpd   4757 root  mem    REG     8,1    143944 1115945
/usr/lib/libexpat.so.1.0.0

Here's the problem: the runtime Apache still loads two version of
libexpat. And the Segmentation fault error still hits me as expected.

After I recompiled Apache, the original libexpat.so.0.1.0 still sits
in Apache lib directory. According to the ldd httpd result, it's not
needed anymore.

My question is why does it still loaded? Does simply deleting them an
elegant way to solve it?

Luyi






On Sun, Apr 6, 2008 at 6:14 PM, Graham Dumpleton
&lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">graham.dumpleton at gmail.com</A>&gt; wrote:
&gt;<i> Try getting the following option passed through to configure of apr-util:
</I>&gt;<i>
</I>&gt;<i>   --with-expat=/usr
</I>&gt;<i>
</I>&gt;<i>  Can't remember if top level Apache configure will pass it through automatically.
</I>&gt;<i>
</I>&gt;<i>  Think that is the correct directory to give as argument.
</I>&gt;<i>
</I>&gt;<i>  Graham
</I>&gt;<i>
</I>&gt;<i>  2008/4/6 Luyi Chen &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">lychen1109 at gmail.com</A>&gt;:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; Thanks Graham,
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  Here's the info:
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  $ ldd /usr/local/apache2/bin/httpd
</I>&gt;<i>  &gt;         libz.so.1 =&gt; /usr/lib/libz.so.1 (0x00002b02938de000)
</I>&gt;<i>  &gt;         libm.so.6 =&gt; /lib/libm.so.6 (0x00002b02939f4000)
</I>&gt;<i>  &gt;         libaprutil-1.so.0 =&gt; /usr/local/apache2/lib/libaprutil-1.so.0
</I>&gt;<i>  &gt;  (0x00002b0293b79000)
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;         libexpat.so.0 =&gt; /usr/local/apache2/lib/libexpat.so.0
</I>&gt;<i>  &gt;  (0x00002b0293c91000)
</I>&gt;<i>  &gt;         libexpat.so.1 =&gt; /usr/lib/libexpat.so.1 (0x00002b0293db3000)
</I>&gt;<i>  &gt;         libapr-1.so.0 =&gt; /usr/local/apache2/lib/libapr-1.so.0
</I>&gt;<i>  &gt;  (0x00002b0293ed6000)
</I>&gt;<i>  &gt;         librt.so.1 =&gt; /lib/librt.so.1 (0x00002b0293ffe000)
</I>&gt;<i>  &gt;         libcrypt.so.1 =&gt; /lib/libcrypt.so.1 (0x00002b0294107000)
</I>&gt;<i>  &gt;         libpthread.so.0 =&gt; /lib/libpthread.so.0 (0x00002b029423a000)
</I>&gt;<i>  &gt;         libdl.so.2 =&gt; /lib/libdl.so.2 (0x00002b029434f000)
</I>&gt;<i>  &gt;         libc.so.6 =&gt; /lib/libc.so.6 (0x00002b0294452000)
</I>&gt;<i>  &gt;         /lib64/ld-linux-x86-64.so.2 (0x00002b02937c7000)
</I>&gt;<i>  &gt;  $ ldd /usr/lib/libz.so.1
</I>&gt;<i>  &gt;         libc.so.6 =&gt; /lib/libc.so.6 (0x00002b2764dc5000)
</I>&gt;<i>  &gt;         /lib64/ld-linux-x86-64.so.2 (0x0000555555554000)
</I>&gt;<i>  &gt;  $ ldd /lib/libm.so.6
</I>&gt;<i>  &gt;         libc.so.6 =&gt; /lib/libc.so.6 (0x00002b8bf9a3c000)
</I>&gt;<i>  &gt;         /lib/ld-linux-x86-64.so.2 =&gt; /lib64/ld-linux-x86-64.so.2
</I>&gt;<i>  &gt;  (0x0000555555554000)
</I>&gt;<i>  &gt;  $ ldd /usr/local/apache2/lib/libaprutil-1.so.0
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;         libexpat.so.0 =&gt; /usr/local/apache2/lib/libexpat.so.0
</I>&gt;<i>  &gt;  (0x00002b61001d0000)
</I>&gt;<i>  &gt;         libapr-1.so.0 =&gt; /usr/local/apache2/lib/libapr-1.so.0
</I>&gt;<i>  &gt;  (0x00002b61002f2000)
</I>&gt;<i>  &gt;         librt.so.1 =&gt; /lib/librt.so.1 (0x00002b610041e000)
</I>&gt;<i>  &gt;         libcrypt.so.1 =&gt; /lib/libcrypt.so.1 (0x00002b6100526000)
</I>&gt;<i>  &gt;         libpthread.so.0 =&gt; /lib/libpthread.so.0 (0x00002b610065a000)
</I>&gt;<i>  &gt;         libdl.so.2 =&gt; /lib/libdl.so.2 (0x00002b610076f000)
</I>&gt;<i>  &gt;         libc.so.6 =&gt; /lib/libc.so.6 (0x00002b6100871000)
</I>&gt;<i>  &gt;         /lib64/ld-linux-x86-64.so.2 (0x0000555555554000)
</I>&gt;<i>  &gt;  $ ldd /usr/local/apache2/lib/libexpat.so.0
</I>&gt;<i>  &gt;         libc.so.6 =&gt; /lib/libc.so.6 (0x00002af851439000)
</I>&gt;<i>  &gt;         /lib64/ld-linux-x86-64.so.2 (0x0000555555554000)
</I>&gt;<i>  &gt;  $ ldd /usr/lib/libexpat.so.1
</I>&gt;<i>  &gt;         libc.so.6 =&gt; /lib/libc.so.6 (0x00002b96d0162000)
</I>&gt;<i>  &gt;         /lib64/ld-linux-x86-64.so.2 (0x0000555555554000)
</I>&gt;<i>  &gt;  $ ldd /usr/local/apache2/lib/libapr-1.so.0
</I>&gt;<i>  &gt;         librt.so.1 =&gt; /lib/librt.so.1 (0x00002ba649f41000)
</I>&gt;<i>  &gt;         libcrypt.so.1 =&gt; /lib/libcrypt.so.1 (0x00002ba64a04a000)
</I>&gt;<i>  &gt;         libpthread.so.0 =&gt; /lib/libpthread.so.0 (0x00002ba64a17d000)
</I>&gt;<i>  &gt;         libdl.so.2 =&gt; /lib/libdl.so.2 (0x00002ba64a292000)
</I>&gt;<i>  &gt;         libc.so.6 =&gt; /lib/libc.so.6 (0x00002ba64a395000)
</I>&gt;<i>  &gt;         /lib64/ld-linux-x86-64.so.2 (0x0000555555554000)
</I>&gt;<i>  &gt;  $ ldd /lib/librt.so.1
</I>&gt;<i>  &gt;         libc.so.6 =&gt; /lib/libc.so.6 (0x00002aab3a499000)
</I>&gt;<i>  &gt;         libpthread.so.0 =&gt; /lib/libpthread.so.0 (0x00002aab3a6d3000)
</I>&gt;<i>  &gt;         /lib/ld-linux-x86-64.so.2 =&gt; /lib64/ld-linux-x86-64.so.2
</I>&gt;<i>  &gt;  (0x0000555555554000)
</I>&gt;<i>  &gt;  $ ldd /lib/libcrypt.so.1
</I>&gt;<i>  &gt;         libc.so.6 =&gt; /lib/libc.so.6 (0x00002ae20b9dd000)
</I>&gt;<i>  &gt;         /lib/ld-linux-x86-64.so.2 =&gt; /lib64/ld-linux-x86-64.so.2
</I>&gt;<i>  &gt;  (0x0000555555554000)
</I>&gt;<i>  &gt;  $ ldd /lib/libpthread.so.0
</I>&gt;<i>  &gt;         libc.so.6 =&gt; /lib/libc.so.6 (0x00002b15ada6d000)
</I>&gt;<i>  &gt;         /lib/ld-linux-x86-64.so.2 =&gt; /lib64/ld-linux-x86-64.so.2
</I>&gt;<i>  &gt;  (0x0000555555554000)
</I>&gt;<i>  &gt;  $ ldd /lib/libdl.so.2
</I>&gt;<i>  &gt;         libc.so.6 =&gt; /lib/libc.so.6 (0x00002b4f78de5000)
</I>&gt;<i>  &gt;         /lib/ld-linux-x86-64.so.2 =&gt; /lib64/ld-linux-x86-64.so.2
</I>&gt;<i>  &gt;  (0x0000555555554000)
</I>&gt;<i>  &gt;  $ ldd /lib/libc.so.6
</I>&gt;<i>  &gt;         /lib/ld-linux-x86-64.so.2 (0x00002b7744489000)
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  My own analysis is that apr-util depends on the old version of
</I>&gt;<i>  &gt;  libexpat. So I checked Apache installation doc, and found that I can
</I>&gt;<i>  &gt;  use --with-included-apr to force Apache use the bundled apr. Since my
</I>&gt;<i>  &gt;  os (Ubuntu 6.06) is an old version, I thought this is very likely to
</I>&gt;<i>  &gt;  be the cause.
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  I tried to recompile Apache with the --with-included-apr option,
</I>&gt;<i>  &gt;  here's my newest config.nice
</I>&gt;<i>  &gt;  #! /bin/sh
</I>&gt;<i>  &gt;  #
</I>&gt;<i>  &gt;  # Created by configure
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  &quot;./configure&quot; \
</I>&gt;<i>  &gt;  &quot;--prefix=/usr/local/apache2&quot; \
</I>&gt;<i>  &gt;  &quot;--enable-proxy&quot; \
</I>&gt;<i>  &gt;  &quot;--enable-proxy-http&quot; \
</I>&gt;<i>  &gt;  &quot;--enable-proxy-balancer&quot; \
</I>&gt;<i>  &gt;  &quot;--enable-dav&quot; \
</I>&gt;<i>  &gt;  &quot;--enable-rewrite&quot; \
</I>&gt;<i>  &gt;  &quot;--enable-deflate&quot; \
</I>&gt;<i>  &gt;  &quot;--with-included-apr&quot; \
</I>&gt;<i>  &gt;  &quot;$@&quot;
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  But it didn't solve the problem. The above information from ldd
</I>&gt;<i>  &gt;  command is actually after I recompiled Apache, which is unchanged.
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  The libexpat on my OS is the latest version, because I have runned this command:
</I>&gt;<i>  &gt;  apt-get install libexpat1
</I>&gt;<i>  &gt;  And it says it's already the newest version, which is 1.95.8-3
</I>&gt;<i>  &gt;  according to the ubuntu's pachage directory.
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  Luyi
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  On Sun, Apr 6, 2008 at 3:09 PM, Graham Dumpleton
</I>&gt;<i>  &gt;  &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">graham.dumpleton at gmail.com</A>&gt; wrote:
</I>&gt;<i>  &gt;  &gt; 2008/4/5 Luyi Chen &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">lychen1109 at gmail.com</A>&gt;:
</I>&gt;<i>  &gt;  &gt;
</I>&gt;<i>  &gt;  &gt; &gt; Hi,
</I>&gt;<i>  &gt;  &gt;  &gt;
</I>&gt;<i>  &gt;  &gt;  &gt;  I am trying to make mod_python working on Apache 2.2.6, ubuntu dapper
</I>&gt;<i>  &gt;  &gt;  &gt;  6.06. But I was hit by the problem of wrong expat library issue, as
</I>&gt;<i>  &gt;  &gt;  &gt;  stated by Graham Dumpleton, on this page
</I>&gt;<i>  &gt;  &gt;  &gt;  <A HREF="http://www.dscpl.com.au/wiki/ModPython/Articles/ExpatCausingApacheCrash">http://www.dscpl.com.au/wiki/ModPython/Articles/ExpatCausingApacheCrash</A>
</I>&gt;<i>  &gt;  &gt;  &gt;
</I>&gt;<i>  &gt;  &gt;  &gt;  I am using a custom compiled Apache2 in /usr/local/apache2, so I
</I>&gt;<i>  &gt;  &gt;  &gt;  checked version of libexpat with the following line,
</I>&gt;<i>  &gt;  &gt;  &gt;
</I>&gt;<i>  &gt;  &gt;  &gt;  ldd /usr/local/apache2/bin/httpd
</I>&gt;<i>  &gt;  &gt;  &gt;
</I>&gt;<i>  &gt;  &gt;  &gt;  in the result there're two lines
</I>&gt;<i>  &gt;  &gt;  &gt;   libexpat.so.0 =&gt; /usr/local/apache2/lib/libexpat.so.0 (0x00002b4f4e1c5000)
</I>&gt;<i>  &gt;  &gt;  &gt;   libexpat.so.1 =&gt; /usr/lib/libexpat.so.1 (0x00002b4f4e2e7000)
</I>&gt;<i>  &gt;  &gt;
</I>&gt;<i>  &gt;  &gt;  If you have this, then something is quite broken with your Apache
</I>&gt;<i>  &gt;  &gt;  httpd to start with, before even mod_python is loaded.
</I>&gt;<i>  &gt;  &gt;
</I>&gt;<i>  &gt;  &gt;  What is the full 'ldd' output from running it against 'httpd'.
</I>&gt;<i>  &gt;  &gt;
</I>&gt;<i>  &gt;  &gt;  Also go through each of the .so file it is dependent upon and run
</I>&gt;<i>  &gt;  &gt;  'ldd' on them as well and post all the results.
</I>&gt;<i>  &gt;  &gt;
</I>&gt;<i>  &gt;  &gt;  As far as I can tell, one of the .so files depended on by httpd is
</I>&gt;<i>  &gt;  &gt;  itself dependent on libexpat (a different version), as I can't see
</I>&gt;<i>  &gt;  &gt;  otherwise how you can get an executable dependent on two different
</I>&gt;<i>  &gt;  &gt;  versions of a shared library.
</I>&gt;<i>  &gt;  &gt;
</I>&gt;<i>  &gt;  &gt;  Graham
</I>&gt;<i>  &gt;  &gt;
</I>&gt;<i>  &gt;  &gt;
</I>&gt;<i>  &gt;  &gt;  &gt;  The one in /usr/local/apache2/lib is an old version 1.95.2, while the
</I>&gt;<i>  &gt;  &gt;  &gt;  one in /usr/lib is 1.95.8, which is identical to the version of
</I>&gt;<i>  &gt;  &gt;  &gt;  libexpat used by python.
</I>&gt;<i>  &gt;  &gt;  &gt;
</I>&gt;<i>  &gt;  &gt;  &gt;  How do I tell Apache to use the new version of libexpat only?
</I>&gt;<i>  &gt;  &gt;  &gt;
</I>&gt;<i>  &gt;  &gt;  &gt;  Luyi
</I>&gt;<i>  &gt;  &gt;  &gt;  _______________________________________________
</I>&gt;<i>  &gt;  &gt;  &gt;  Mod_python mailing list
</I>&gt;<i>  &gt;  &gt;  &gt;  <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i>  &gt;  &gt;  &gt;  <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i>  &gt;  &gt;  &gt;
</I>&gt;<i>  &gt;  &gt;
</I>&gt;<i>  &gt;
</I>&gt;<i>
</I></PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025118.html">[mod_python] old libexpat shared library
</A></li>
	<LI>Next message: <A HREF="025121.html">[mod_python] old libexpat shared library
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25119">[ date ]</a>
              <a href="thread.html#25119">[ thread ]</a>
              <a href="subject.html#25119">[ subject ]</a>
              <a href="author.html#25119">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
