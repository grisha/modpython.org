<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Proxy + Tomcat filter problems
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Proxy%20%2B%20Tomcat%20filter%20problems&In-Reply-To=4834c71e0804170320y765408d4r7c93efe9eb3f4545%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025206.html">
   <LINK REL="Next"  HREF="025208.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Proxy + Tomcat filter problems</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Proxy%20%2B%20Tomcat%20filter%20problems&In-Reply-To=4834c71e0804170320y765408d4r7c93efe9eb3f4545%40mail.gmail.com"
       TITLE="[mod_python] Proxy + Tomcat filter problems">graham.dumpleton at gmail.com
       </A><BR>
    <I>Thu Apr 17 08:16:09 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="025206.html">[mod_python] Proxy + Tomcat filter problems
</A></li>
        <LI>Next message: <A HREF="025208.html">[mod_python] Proxy + Tomcat filter problems
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25207">[ date ]</a>
              <a href="thread.html#25207">[ thread ]</a>
              <a href="subject.html#25207">[ subject ]</a>
              <a href="author.html#25207">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>2008/4/17 Rados&#322;aw Rymaszewski &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">rrymaszewski at contentforces.pl</A>&gt;:
&gt;<i> Hello
</I>&gt;<i>
</I>&gt;<i> I was trying to find out solution for my problem but there were no answers,
</I>&gt;<i> so I decided to write here.
</I>&gt;<i>
</I>&gt;<i> We are using mod_python filters for our system
</I>&gt;<i>
</I>&gt;<i> Infrastructure description:
</I>&gt;<i>
</I>&gt;<i> INTERNET &lt;---&gt; APACHE 2.8.3 with mod_python 3.3.1 + output filters &lt;--&gt;
</I>&gt;<i> Apache proxy module &lt;--&gt; TOMCAT 5.5.2x
</I>&gt;<i>
</I>&gt;<i> our filters concat chunked content from tomcat and write to client whole
</I>&gt;<i> changed content. It's important for us to get whole response from tomcat and
</I>&gt;<i> after it process.
</I>&gt;<i>
</I>&gt;<i> problem is when filter.read() reach last byte (filter.read() == None) then
</I>&gt;<i> there is no possibility to overwrite request headers.
</I>&gt;<i>
</I>&gt;<i> There is no such problem during reading content and when we serve static
</I>&gt;<i> pages from apache www server.
</I>&gt;<i>
</I>&gt;<i> mod_python receive such headers
</I>&gt;<i>
</I>&gt;<i> 1 chunk
</I>&gt;<i>
</I>&gt;<i> [Wed Apr 16 05:52:15 2008] [error] {'Via': '1.1 domain', 'Set-Cookie':
</I>&gt;<i> 'JSESSIONID=sessionXXX; Path=/path', 'Date': 'Fri, 18 Apr 2008 19:47:06
</I>&gt;<i> GMT', 'Cache-Control': 'no-store', 'Cache-Control': 'no-cache', 'Expires':
</I>&gt;<i> 'Thu, 01 Jan 1970 00:00:00 GMT', 'Pragma': 'No-cache', 'Server':
</I>&gt;<i> 'Apache-Coyote'}
</I>&gt;<i>
</I>&gt;<i> 2 chunk
</I>&gt;<i>
</I>&gt;<i> [Wed Apr 16 05:52:15 2008] [error] {'Content-Type': 'text/plain',
</I>&gt;<i> 'Transfer-Encoding': 'chunked', 'Connection': 'Keep-Alive', 'Keep-Alive':
</I>&gt;<i> 'timeout=15, max=100', 'Via': '1.1 domain', 'Set-Cookie':
</I>&gt;<i> 'JSESSIONID=sessionXXX; Path=/path', 'Cache-Control': 'No-cache', 'Expires':
</I>&gt;<i> '0', 'Pragma': 'No-cache'}
</I>&gt;<i>
</I>&gt;<i> 3 chunk
</I>&gt;<i>
</I>&gt;<i>  [Wed Apr 16 05:52:15 2008] [error] {'Content-Type': 'text/plain',
</I>&gt;<i> 'Transfer-Encoding': 'chunked', 'Connection': 'Keep-Alive', 'Keep-Alive':
</I>&gt;<i> 'timeout=15, max=100', 'Via': '1.1 domain', 'Set-Cookie':
</I>&gt;<i> 'JSESSIONID=sessionXXX; Path=/path', 'Cache-Control': 'No-cache', 'Expires':
</I>&gt;<i> '0', 'Pragma': 'No-cache'}
</I>&gt;<i>
</I>&gt;<i> when I finish process on first or second chunk I can modify headers without
</I>&gt;<i> any problems. after third one there is no such possibility
</I>&gt;<i>
</I>&gt;<i> Do You know what could be wrong ?
</I>
As soon as any filter following yours has caused any chunk of data to
be written back to client, it is too late to change headers. This is
because headers are sent before the data.

Thus, headers can only be reliably changed upon reading first chunk
and before it is written to next filter. Only other choice is to
buffer the whole content in your filter, fixup any headers based on
that content and then write the whole content.

Graham

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025206.html">[mod_python] Proxy + Tomcat filter problems
</A></li>
	<LI>Next message: <A HREF="025208.html">[mod_python] Proxy + Tomcat filter problems
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25207">[ date ]</a>
              <a href="thread.html#25207">[ thread ]</a>
              <a href="subject.html#25207">[ subject ]</a>
              <a href="author.html#25207">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
