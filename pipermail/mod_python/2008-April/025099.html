<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Mod_python &amp; cPickle / saving Instances
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Mod_python%20%26%20cPickle%20/%20saving%20Instances&In-Reply-To=5213E58D85BC414998FA553C701E386C0EDD046B83%40SGBD012511.dlrmail.ad.delarue.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025098.html">
   <LINK REL="Next"  HREF="025100.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Mod_python &amp; cPickle / saving Instances</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Mod_python%20%26%20cPickle%20/%20saving%20Instances&In-Reply-To=5213E58D85BC414998FA553C701E386C0EDD046B83%40SGBD012511.dlrmail.ad.delarue.com"
       TITLE="[mod_python] Mod_python &amp; cPickle / saving Instances">graham.dumpleton at gmail.com
       </A><BR>
    <I>Tue Apr  1 07:26:09 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="025098.html">[mod_python] Mod_python &amp; cPickle / saving Instances
</A></li>
        <LI>Next message: <A HREF="025100.html">[mod_python] Mod_python &amp; cPickle / saving Instances
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25099">[ date ]</a>
              <a href="thread.html#25099">[ thread ]</a>
              <a href="subject.html#25099">[ subject ]</a>
              <a href="author.html#25099">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 01/04/2008, <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Dominique.Holzwarth at ch.delarue.com</A>
&lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Dominique.Holzwarth at ch.delarue.com</A>&gt; wrote:
&gt;<i> Hello Graham
</I>&gt;<i>
</I>&gt;<i>  I've read your article and just want to clarify if I understood it the right way :-)
</I>&gt;<i>  So basicly instance objects shouldn't (or rather can't) be stored in a session object (and also using pickle directly won't work) due to the new mod_python module importer?
</I>
Complex user defined types from code files which are candidates for
mod_python module reloading can't be used.

&gt;<i>  Pickle would work tho, if I add my own modules to the PYTHONPATH (sys.modules thingy) so that they are loaded by the standard python module loader? Is that correct?
</I>
Correct. Those in normal Python modules picked up from sys.path can be used.

In general though recommend only using basic Python types,
dictionaries, lists etc. This is though just to avoid potential for
problem, not that there is still a problem. Just make sure stuff you
want to pickle is in modules on sys.path.

&gt;<i>  However, using the standard python module loader for own modules will cause some mod_python problems as stated in <A HREF="http://www.dscpl.com.au/wiki/ModPython/Articles/ModuleImportingIsBroken">http://www.dscpl.com.au/wiki/ModPython/Articles/ModuleImportingIsBroken</A> ?
</I>
Which things in particular are you talking about? The problems in that
document refer to pre mod_python 3.3.1. I can't think of any specific
issues with use of standard modules that would cause a problem for you
in mod_python 3.3.1.

Graham

&gt;<i>  If that's really the current state then I guess I have to do some redesign in order to not use instance object serialisation... :-/
</I>&gt;<i>
</I>&gt;<i>  Thanks for the quick answer,
</I>&gt;<i>  Dominique
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>  -----Original Message-----
</I>&gt;<i>  From: Graham Dumpleton [mailto:<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">graham.dumpleton at gmail.com</A>]
</I>&gt;<i>  Sent: Dienstag, 1. April 2008 11:57
</I>&gt;<i>  To: Holzwarth, Dominique (Berne Bauhaus)
</I>&gt;<i>  Cc: <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python at modpython.org</A>
</I>&gt;<i>  Subject: Re: [mod_python] Mod_python &amp; cPickle / saving Instances
</I>&gt;<i>
</I>&gt;<i>  Read:
</I>&gt;<i>
</I>&gt;<i>   <A HREF="http://www.dscpl.com.au/wiki/ModPython/Articles/IssuesWithSessionObjects">http://www.dscpl.com.au/wiki/ModPython/Articles/IssuesWithSessionObjects</A>
</I>&gt;<i>
</I>&gt;<i>  Graham
</I>&gt;<i>
</I>&gt;<i>  On 01/04/2008, <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Dominique.Holzwarth at ch.delarue.com</A>
</I>&gt;<i>  &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Dominique.Holzwarth at ch.delarue.com</A>&gt; wrote:
</I>&gt;<i>  &gt; Hey Guys
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  I was just playing around with the cPickle module to save some instance objects into binary files and 'offline' (normal python interpreter on local machine) it all works fine. However, when I try to do the same things under apache with mod_python I get a mod_python specific error...
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  Here are my testing files:
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  Pickletest.py
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt; **********************************************************************
</I>&gt;<i>  &gt; *********************************************
</I>&gt;<i>  &gt;  from mod_python import apache
</I>&gt;<i>  &gt;  from mod_python import Session
</I>&gt;<i>  &gt;  import cPickle, pickle
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  myModule = apache.import_module('~/test/dummyclass.py')
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  secretText = &quot;hallo&quot;
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  def index(req):
</I>&gt;<i>  &gt;     req.session = Session.FileSession(req, secret=secretText)
</I>&gt;<i>  &gt;     if req.session.is_new():
</I>&gt;<i>  &gt;         myInstance = myModule.myClass()
</I>&gt;<i>  &gt;         myInstance.hit()
</I>&gt;<i>  &gt;         hits = str(myInstance.hitCounter)
</I>&gt;<i>  &gt;         myOtherInstance = myModule.myOtherClass()
</I>&gt;<i>  &gt;         myOtherInstance.hit()
</I>&gt;<i>  &gt;         randNum = str(myOtherInstance.randomNumber)
</I>&gt;<i>  &gt;         file = open('C:\\Program Files\\Apache Software Foundation\\Apache2.2\\test\\myInstances.pkl','wb')
</I>&gt;<i>  &gt;         cPickle.dump((myInstance, myOtherInstance), file)
</I>&gt;<i>  &gt;         file.close()
</I>&gt;<i>  &gt;         req.session.save()
</I>&gt;<i>  &gt;         return &quot;Hits: &quot;+hits+&quot; Random Number: &quot;+randNum
</I>&gt;<i>  &gt;     else:
</I>&gt;<i>  &gt;         file = open('C:\\Program Files\\Apache Software Foundation\\Apache2.2\\test\\myInstances.pkl','rb')
</I>&gt;<i>  &gt;         (myInstance, myOtherInstance) = cPickle.load(file)
</I>&gt;<i>  &gt;         file.close()
</I>&gt;<i>  &gt;         myInstance.hit()
</I>&gt;<i>  &gt;         myOtherInstance.hit()
</I>&gt;<i>  &gt;         hits = str(myInstance.hitCounter)
</I>&gt;<i>  &gt;         randNumber = str(myOtherInstance.randomNumber)
</I>&gt;<i>  &gt;         req.session['myInstances'] = (myInstance, myOtherInstance)
</I>&gt;<i>  &gt;         file = open('C:\\Program Files\\Apache Software Foundation\\Apache2.2\\test\\myInstances.pkl','wb')
</I>&gt;<i>  &gt;         cPickle.dump((myInstance, myOtherInstance), file)
</I>&gt;<i>  &gt;         file.close()
</I>&gt;<i>  &gt;         req.session.save()
</I>&gt;<i>  &gt;         return &quot;Hits: &quot;+hits+&quot; Random Number: &quot;+randNum+&quot; old session&quot;
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt; **********************************************************************
</I>&gt;<i>  &gt; *********************************************
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  This script does nothing more than saving / loading instance objects and displaying some sort of 'hit counter'
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  Dummyclass.py
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt; **********************************************************************
</I>&gt;<i>  &gt; *********************************************
</I>&gt;<i>  &gt;  import random
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  class myClass:
</I>&gt;<i>  &gt;     def __init__(self):
</I>&gt;<i>  &gt;         self.attribute = 1
</I>&gt;<i>  &gt;         self.text = &quot;hello world&quot;
</I>&gt;<i>  &gt;         self.hitCounter = 0
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;     def hit(self):
</I>&gt;<i>  &gt;         self.hitCounter += 1
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  class myOtherClass:
</I>&gt;<i>  &gt;     def __init__(self):
</I>&gt;<i>  &gt;         self.otherAttribute = 2
</I>&gt;<i>  &gt;         self.otherText = &quot;goodbye world&quot;
</I>&gt;<i>  &gt;         self.randomNumber = 0
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;     def hit(self):
</I>&gt;<i>  &gt;         self.randomNumber = random.randint(0, 1000)
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt; **********************************************************************
</I>&gt;<i>  &gt; *********************************************
</I>&gt;<i>  &gt;  Defines some useless classes, of which instance objects should be
</I>&gt;<i>  &gt; stored :-)
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  The script manages to write the *.pkl file which looks like this:
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  myInstances.pkl
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt; **********************************************************************
</I>&gt;<i>  &gt; *********************************************
</I>&gt;<i>  &gt;  ((i_mp_bee88a136571a696398a0eb82b06eeb3
</I>&gt;<i>  &gt;  myClass
</I>&gt;<i>  &gt;  p1
</I>&gt;<i>  &gt;  (dp2
</I>&gt;<i>  &gt;  S'attribute'
</I>&gt;<i>  &gt;  p3
</I>&gt;<i>  &gt;  I1
</I>&gt;<i>  &gt;  sS'hitCounter'
</I>&gt;<i>  &gt;  p4
</I>&gt;<i>  &gt;  I1
</I>&gt;<i>  &gt;  sS'text'
</I>&gt;<i>  &gt;  p5
</I>&gt;<i>  &gt;  S'hello world'
</I>&gt;<i>  &gt;  p6
</I>&gt;<i>  &gt;  sb(i_mp_bee88a136571a696398a0eb82b06eeb3
</I>&gt;<i>  &gt;  myOtherClass
</I>&gt;<i>  &gt;  p7
</I>&gt;<i>  &gt;  (dp8
</I>&gt;<i>  &gt;  S'otherText'
</I>&gt;<i>  &gt;  p9
</I>&gt;<i>  &gt;  S'goodbye world'
</I>&gt;<i>  &gt;  p10
</I>&gt;<i>  &gt;  sS'otherAttribute'
</I>&gt;<i>  &gt;  p11
</I>&gt;<i>  &gt;  I2
</I>&gt;<i>  &gt;  sS'randomNumber'
</I>&gt;<i>  &gt;  p12
</I>&gt;<i>  &gt;  I105
</I>&gt;<i>  &gt;  sbt.
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt; **********************************************************************
</I>&gt;<i>  &gt; *********************************************
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  As I understand the pickle-algorithm this file looks as intended except for the i_mp_bee88a136571a696398a0eb82b06eeb3 which normaly would be the name of the module. Obviously the module name is converted into some mod_python GUID thingy...
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  The error message i get is the following:
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  MOD_PYTHON ERROR
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  ProcessId:      3784
</I>&gt;<i>  &gt;  Interpreter:    'xx'
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  ServerName:     'xx'
</I>&gt;<i>  &gt;  DocumentRoot:   'C:/Program Files/Apache Software Foundation/Apache2.2/htdocs'
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  URI:            '/python/test/pickletest.py'
</I>&gt;<i>  &gt;  Location:       None
</I>&gt;<i>  &gt;  Directory:      'C:/Program Files/Apache Software Foundation/Apache2.2/htdocs/python/'
</I>&gt;<i>  &gt;  Filename:       'C:\\Program Files\\Apache Software Foundation\\Apache2.2\\htdocs\\python\\test\\pickletest.py'
</I>&gt;<i>  &gt;  PathInfo:       ''
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  Phase:          'PythonHandler'
</I>&gt;<i>  &gt;  Handler:        'mod_python.publisher'
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  Traceback (most recent call last):
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;   File &quot;C:\Program Files\Python25\lib\site-packages\mod_python\importer.py&quot;, line 1537, in HandlerDispatch
</I>&gt;<i>  &gt;     default=default_handler, arg=req, silent=hlist.silent)
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;   File &quot;C:\Program Files\Python25\lib\site-packages\mod_python\importer.py&quot;, line 1229, in _process_target
</I>&gt;<i>  &gt;     result = _execute_target(config, req, object, arg)
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;   File &quot;C:\Program Files\Python25\lib\site-packages\mod_python\importer.py&quot;, line 1128, in _execute_target
</I>&gt;<i>  &gt;     result = object(arg)
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;   File &quot;C:\Program Files\Python25\lib\site-packages\mod_python\publisher.py&quot;, line 213, in handler
</I>&gt;<i>  &gt;     published = publish_object(req, object)
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;   File &quot;C:\Program Files\Python25\lib\site-packages\mod_python\publisher.py&quot;, line 425, in publish_object
</I>&gt;<i>  &gt;     return publish_object(req,util.apply_fs_data(object, req.form,
</I>&gt;<i>  &gt; req=req))
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;   File &quot;C:\Program Files\Python25\lib\site-packages\mod_python\util.py&quot;, line 554, in apply_fs_data
</I>&gt;<i>  &gt;     return object(**args)
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;   File &quot;C:\Program Files\Apache Software Foundation\Apache2.2\htdocs\python\test\pickletest.py&quot;, line 25, in index
</I>&gt;<i>  &gt;     (myInstance, myOtherInstance) = cPickle.load(file)
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  ImportError: No module named _mp_bee88a136571a696398a0eb82b06eeb3
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  MODULE CACHE DETAILS
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  Accessed:       Tue Apr 01 11:05:33 2008
</I>&gt;<i>  &gt;  Generation:     26
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  _mp_bee88a136571a696398a0eb82b06eeb3 {
</I>&gt;<i>  &gt;   FileName:     'C:\\Program Files\\Apache Software Foundation\\Apache2.2\\htdocs\\python\\test\\dummyclass.py'
</I>&gt;<i>  &gt;   Instance:     1
</I>&gt;<i>  &gt;   Generation:   13
</I>&gt;<i>  &gt;   Modified:     Tue Apr 01 09:59:54 2008
</I>&gt;<i>  &gt;   Imported:     Tue Apr 01 10:05:22 2008
</I>&gt;<i>  &gt;  }
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  _mp_754c5030ce462c9ea7741cb6f66d6cc1 {
</I>&gt;<i>  &gt;   FileName:     'C:\\Program Files\\Apache Software Foundation\\Apache2.2\\htdocs\\python\\test\\pickletest.py'
</I>&gt;<i>  &gt;   Instance:     13
</I>&gt;<i>  &gt;   Generation:   26
</I>&gt;<i>  &gt;   Modified:     Tue Apr 01 10:56:58 2008
</I>&gt;<i>  &gt;   Imported:     Tue Apr 01 10:57:10 2008
</I>&gt;<i>  &gt;   Children:     'C:\\Program Files\\Apache Software Foundation\\Apache2.2\\htdocs\\python\\test\\dummyclass.py'
</I>&gt;<i>  &gt;  }
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  Is there a way how to use cPickle AND mod_python together? I also
</I>&gt;<i>  &gt; tried to use the session mechanism instead of the pickle mechanism to
</I>&gt;<i>  &gt; store instance objects in a binary file but that doesn't seem to work
</I>&gt;<i>  &gt; either (if I do a req.session['myInstances'] = (myInstance,
</I>&gt;<i>  &gt; myOtherInstance) then the session doesn't seem to be saved properly
</I>&gt;<i>  &gt; and thus, everytime I hit on browser-reload a new session is
</I>&gt;<i>  &gt; generated...)
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  Would be really great if someone could help me with this!
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  Greetings Dominique
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  _______________________________________________
</I>&gt;<i>  &gt;  Mod_python mailing list
</I>&gt;<i>  &gt;  <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i>  &gt;  <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i>  &gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I></PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025098.html">[mod_python] Mod_python &amp; cPickle / saving Instances
</A></li>
	<LI>Next message: <A HREF="025100.html">[mod_python] Mod_python &amp; cPickle / saving Instances
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25099">[ date ]</a>
              <a href="thread.html#25099">[ thread ]</a>
              <a href="subject.html#25099">[ subject ]</a>
              <a href="author.html#25099">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
