<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Mod_python &amp; cPickle / saving Instances
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Mod_python%20%26%20cPickle%20/%20saving%20Instances&In-Reply-To=88e286470804010257k193e2d6csfdc9c0fd3a3eddc3%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025097.html">
   <LINK REL="Next"  HREF="025099.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Mod_python &amp; cPickle / saving Instances</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Dominique.Holzwarth at ch.delarue.com</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Mod_python%20%26%20cPickle%20/%20saving%20Instances&In-Reply-To=88e286470804010257k193e2d6csfdc9c0fd3a3eddc3%40mail.gmail.com"
       TITLE="[mod_python] Mod_python &amp; cPickle / saving Instances">Dominique.Holzwarth at ch.delarue.com
       </A><BR>
    <I>Tue Apr  1 07:05:52 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="025097.html">[mod_python] Mod_python &amp; cPickle / saving Instances
</A></li>
        <LI>Next message: <A HREF="025099.html">[mod_python] Mod_python &amp; cPickle / saving Instances
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25098">[ date ]</a>
              <a href="thread.html#25098">[ thread ]</a>
              <a href="subject.html#25098">[ subject ]</a>
              <a href="author.html#25098">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello Graham

I've read your article and just want to clarify if I understood it the right way :-)
So basicly instance objects shouldn't (or rather can't) be stored in a session object (and also using pickle directly won't work) due to the new mod_python module importer?
Pickle would work tho, if I add my own modules to the PYTHONPATH (sys.modules thingy) so that they are loaded by the standard python module loader? Is that correct?

However, using the standard python module loader for own modules will cause some mod_python problems as stated in <A HREF="http://www.dscpl.com.au/wiki/ModPython/Articles/ModuleImportingIsBroken">http://www.dscpl.com.au/wiki/ModPython/Articles/ModuleImportingIsBroken</A> ?

If that's really the current state then I guess I have to do some redesign in order to not use instance object serialisation... :-/

Thanks for the quick answer,
Dominique

-----Original Message-----
From: Graham Dumpleton [mailto:<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">graham.dumpleton at gmail.com</A>]
Sent: Dienstag, 1. April 2008 11:57
To: Holzwarth, Dominique (Berne Bauhaus)
Cc: <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python at modpython.org</A>
Subject: Re: [mod_python] Mod_python &amp; cPickle / saving Instances

Read:

  <A HREF="http://www.dscpl.com.au/wiki/ModPython/Articles/IssuesWithSessionObjects">http://www.dscpl.com.au/wiki/ModPython/Articles/IssuesWithSessionObjects</A>

Graham

On 01/04/2008, <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Dominique.Holzwarth at ch.delarue.com</A>
&lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Dominique.Holzwarth at ch.delarue.com</A>&gt; wrote:
&gt;<i> Hey Guys
</I>&gt;<i>
</I>&gt;<i>  I was just playing around with the cPickle module to save some instance objects into binary files and 'offline' (normal python interpreter on local machine) it all works fine. However, when I try to do the same things under apache with mod_python I get a mod_python specific error...
</I>&gt;<i>
</I>&gt;<i>  Here are my testing files:
</I>&gt;<i>
</I>&gt;<i>  Pickletest.py
</I>&gt;<i>
</I>&gt;<i> **********************************************************************
</I>&gt;<i> *********************************************
</I>&gt;<i>  from mod_python import apache
</I>&gt;<i>  from mod_python import Session
</I>&gt;<i>  import cPickle, pickle
</I>&gt;<i>
</I>&gt;<i>  myModule = apache.import_module('~/test/dummyclass.py')
</I>&gt;<i>
</I>&gt;<i>  secretText = &quot;hallo&quot;
</I>&gt;<i>
</I>&gt;<i>  def index(req):
</I>&gt;<i>     req.session = Session.FileSession(req, secret=secretText)
</I>&gt;<i>     if req.session.is_new():
</I>&gt;<i>         myInstance = myModule.myClass()
</I>&gt;<i>         myInstance.hit()
</I>&gt;<i>         hits = str(myInstance.hitCounter)
</I>&gt;<i>         myOtherInstance = myModule.myOtherClass()
</I>&gt;<i>         myOtherInstance.hit()
</I>&gt;<i>         randNum = str(myOtherInstance.randomNumber)
</I>&gt;<i>         file = open('C:\\Program Files\\Apache Software Foundation\\Apache2.2\\test\\myInstances.pkl','wb')
</I>&gt;<i>         cPickle.dump((myInstance, myOtherInstance), file)
</I>&gt;<i>         file.close()
</I>&gt;<i>         req.session.save()
</I>&gt;<i>         return &quot;Hits: &quot;+hits+&quot; Random Number: &quot;+randNum
</I>&gt;<i>     else:
</I>&gt;<i>         file = open('C:\\Program Files\\Apache Software Foundation\\Apache2.2\\test\\myInstances.pkl','rb')
</I>&gt;<i>         (myInstance, myOtherInstance) = cPickle.load(file)
</I>&gt;<i>         file.close()
</I>&gt;<i>         myInstance.hit()
</I>&gt;<i>         myOtherInstance.hit()
</I>&gt;<i>         hits = str(myInstance.hitCounter)
</I>&gt;<i>         randNumber = str(myOtherInstance.randomNumber)
</I>&gt;<i>         req.session['myInstances'] = (myInstance, myOtherInstance)
</I>&gt;<i>         file = open('C:\\Program Files\\Apache Software Foundation\\Apache2.2\\test\\myInstances.pkl','wb')
</I>&gt;<i>         cPickle.dump((myInstance, myOtherInstance), file)
</I>&gt;<i>         file.close()
</I>&gt;<i>         req.session.save()
</I>&gt;<i>         return &quot;Hits: &quot;+hits+&quot; Random Number: &quot;+randNum+&quot; old session&quot;
</I>&gt;<i>
</I>&gt;<i> **********************************************************************
</I>&gt;<i> *********************************************
</I>&gt;<i>
</I>&gt;<i>  This script does nothing more than saving / loading instance objects and displaying some sort of 'hit counter'
</I>&gt;<i>
</I>&gt;<i>  Dummyclass.py
</I>&gt;<i>
</I>&gt;<i> **********************************************************************
</I>&gt;<i> *********************************************
</I>&gt;<i>  import random
</I>&gt;<i>
</I>&gt;<i>  class myClass:
</I>&gt;<i>     def __init__(self):
</I>&gt;<i>         self.attribute = 1
</I>&gt;<i>         self.text = &quot;hello world&quot;
</I>&gt;<i>         self.hitCounter = 0
</I>&gt;<i>
</I>&gt;<i>     def hit(self):
</I>&gt;<i>         self.hitCounter += 1
</I>&gt;<i>
</I>&gt;<i>  class myOtherClass:
</I>&gt;<i>     def __init__(self):
</I>&gt;<i>         self.otherAttribute = 2
</I>&gt;<i>         self.otherText = &quot;goodbye world&quot;
</I>&gt;<i>         self.randomNumber = 0
</I>&gt;<i>
</I>&gt;<i>     def hit(self):
</I>&gt;<i>         self.randomNumber = random.randint(0, 1000)
</I>&gt;<i>
</I>&gt;<i> **********************************************************************
</I>&gt;<i> *********************************************
</I>&gt;<i>  Defines some useless classes, of which instance objects should be
</I>&gt;<i> stored :-)
</I>&gt;<i>
</I>&gt;<i>  The script manages to write the *.pkl file which looks like this:
</I>&gt;<i>
</I>&gt;<i>  myInstances.pkl
</I>&gt;<i>
</I>&gt;<i> **********************************************************************
</I>&gt;<i> *********************************************
</I>&gt;<i>  ((i_mp_bee88a136571a696398a0eb82b06eeb3
</I>&gt;<i>  myClass
</I>&gt;<i>  p1
</I>&gt;<i>  (dp2
</I>&gt;<i>  S'attribute'
</I>&gt;<i>  p3
</I>&gt;<i>  I1
</I>&gt;<i>  sS'hitCounter'
</I>&gt;<i>  p4
</I>&gt;<i>  I1
</I>&gt;<i>  sS'text'
</I>&gt;<i>  p5
</I>&gt;<i>  S'hello world'
</I>&gt;<i>  p6
</I>&gt;<i>  sb(i_mp_bee88a136571a696398a0eb82b06eeb3
</I>&gt;<i>  myOtherClass
</I>&gt;<i>  p7
</I>&gt;<i>  (dp8
</I>&gt;<i>  S'otherText'
</I>&gt;<i>  p9
</I>&gt;<i>  S'goodbye world'
</I>&gt;<i>  p10
</I>&gt;<i>  sS'otherAttribute'
</I>&gt;<i>  p11
</I>&gt;<i>  I2
</I>&gt;<i>  sS'randomNumber'
</I>&gt;<i>  p12
</I>&gt;<i>  I105
</I>&gt;<i>  sbt.
</I>&gt;<i>
</I>&gt;<i> **********************************************************************
</I>&gt;<i> *********************************************
</I>&gt;<i>
</I>&gt;<i>  As I understand the pickle-algorithm this file looks as intended except for the i_mp_bee88a136571a696398a0eb82b06eeb3 which normaly would be the name of the module. Obviously the module name is converted into some mod_python GUID thingy...
</I>&gt;<i>
</I>&gt;<i>  The error message i get is the following:
</I>&gt;<i>
</I>&gt;<i>  MOD_PYTHON ERROR
</I>&gt;<i>
</I>&gt;<i>  ProcessId:      3784
</I>&gt;<i>  Interpreter:    'xx'
</I>&gt;<i>
</I>&gt;<i>  ServerName:     'xx'
</I>&gt;<i>  DocumentRoot:   'C:/Program Files/Apache Software Foundation/Apache2.2/htdocs'
</I>&gt;<i>
</I>&gt;<i>  URI:            '/python/test/pickletest.py'
</I>&gt;<i>  Location:       None
</I>&gt;<i>  Directory:      'C:/Program Files/Apache Software Foundation/Apache2.2/htdocs/python/'
</I>&gt;<i>  Filename:       'C:\\Program Files\\Apache Software Foundation\\Apache2.2\\htdocs\\python\\test\\pickletest.py'
</I>&gt;<i>  PathInfo:       ''
</I>&gt;<i>
</I>&gt;<i>  Phase:          'PythonHandler'
</I>&gt;<i>  Handler:        'mod_python.publisher'
</I>&gt;<i>
</I>&gt;<i>  Traceback (most recent call last):
</I>&gt;<i>
</I>&gt;<i>   File &quot;C:\Program Files\Python25\lib\site-packages\mod_python\importer.py&quot;, line 1537, in HandlerDispatch
</I>&gt;<i>     default=default_handler, arg=req, silent=hlist.silent)
</I>&gt;<i>
</I>&gt;<i>   File &quot;C:\Program Files\Python25\lib\site-packages\mod_python\importer.py&quot;, line 1229, in _process_target
</I>&gt;<i>     result = _execute_target(config, req, object, arg)
</I>&gt;<i>
</I>&gt;<i>   File &quot;C:\Program Files\Python25\lib\site-packages\mod_python\importer.py&quot;, line 1128, in _execute_target
</I>&gt;<i>     result = object(arg)
</I>&gt;<i>
</I>&gt;<i>   File &quot;C:\Program Files\Python25\lib\site-packages\mod_python\publisher.py&quot;, line 213, in handler
</I>&gt;<i>     published = publish_object(req, object)
</I>&gt;<i>
</I>&gt;<i>   File &quot;C:\Program Files\Python25\lib\site-packages\mod_python\publisher.py&quot;, line 425, in publish_object
</I>&gt;<i>     return publish_object(req,util.apply_fs_data(object, req.form,
</I>&gt;<i> req=req))
</I>&gt;<i>
</I>&gt;<i>   File &quot;C:\Program Files\Python25\lib\site-packages\mod_python\util.py&quot;, line 554, in apply_fs_data
</I>&gt;<i>     return object(**args)
</I>&gt;<i>
</I>&gt;<i>   File &quot;C:\Program Files\Apache Software Foundation\Apache2.2\htdocs\python\test\pickletest.py&quot;, line 25, in index
</I>&gt;<i>     (myInstance, myOtherInstance) = cPickle.load(file)
</I>&gt;<i>
</I>&gt;<i>  ImportError: No module named _mp_bee88a136571a696398a0eb82b06eeb3
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>  MODULE CACHE DETAILS
</I>&gt;<i>
</I>&gt;<i>  Accessed:       Tue Apr 01 11:05:33 2008
</I>&gt;<i>  Generation:     26
</I>&gt;<i>
</I>&gt;<i>  _mp_bee88a136571a696398a0eb82b06eeb3 {
</I>&gt;<i>   FileName:     'C:\\Program Files\\Apache Software Foundation\\Apache2.2\\htdocs\\python\\test\\dummyclass.py'
</I>&gt;<i>   Instance:     1
</I>&gt;<i>   Generation:   13
</I>&gt;<i>   Modified:     Tue Apr 01 09:59:54 2008
</I>&gt;<i>   Imported:     Tue Apr 01 10:05:22 2008
</I>&gt;<i>  }
</I>&gt;<i>
</I>&gt;<i>  _mp_754c5030ce462c9ea7741cb6f66d6cc1 {
</I>&gt;<i>   FileName:     'C:\\Program Files\\Apache Software Foundation\\Apache2.2\\htdocs\\python\\test\\pickletest.py'
</I>&gt;<i>   Instance:     13
</I>&gt;<i>   Generation:   26
</I>&gt;<i>   Modified:     Tue Apr 01 10:56:58 2008
</I>&gt;<i>   Imported:     Tue Apr 01 10:57:10 2008
</I>&gt;<i>   Children:     'C:\\Program Files\\Apache Software Foundation\\Apache2.2\\htdocs\\python\\test\\dummyclass.py'
</I>&gt;<i>  }
</I>&gt;<i>
</I>&gt;<i>  Is there a way how to use cPickle AND mod_python together? I also
</I>&gt;<i> tried to use the session mechanism instead of the pickle mechanism to
</I>&gt;<i> store instance objects in a binary file but that doesn't seem to work
</I>&gt;<i> either (if I do a req.session['myInstances'] = (myInstance,
</I>&gt;<i> myOtherInstance) then the session doesn't seem to be saved properly
</I>&gt;<i> and thus, everytime I hit on browser-reload a new session is
</I>&gt;<i> generated...)
</I>&gt;<i>
</I>&gt;<i>  Would be really great if someone could help me with this!
</I>&gt;<i>
</I>&gt;<i>  Greetings Dominique
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>  _______________________________________________
</I>&gt;<i>  Mod_python mailing list
</I>&gt;<i>  <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i>  <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i>
</I>


</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025097.html">[mod_python] Mod_python &amp; cPickle / saving Instances
</A></li>
	<LI>Next message: <A HREF="025099.html">[mod_python] Mod_python &amp; cPickle / saving Instances
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25098">[ date ]</a>
              <a href="thread.html#25098">[ thread ]</a>
              <a href="subject.html#25098">[ subject ]</a>
              <a href="author.html#25098">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
