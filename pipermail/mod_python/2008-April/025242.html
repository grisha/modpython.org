<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Re: Problem with mod_proxy + inputfilter + headers_in
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Re%3A%20Problem%20with%20mod_proxy%20%2B%20inputfilter%20%2B%20headers_in&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025241.html">
   <LINK REL="Next"  HREF="025244.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Re: Problem with mod_proxy + inputfilter + headers_in</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Emyr Thomas</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Re%3A%20Problem%20with%20mod_proxy%20%2B%20inputfilter%20%2B%20headers_in&In-Reply-To="
       TITLE="[mod_python] Re: Problem with mod_proxy + inputfilter + headers_in">emyr.thomas at gmail.com
       </A><BR>
    <I>Mon Apr 28 09:55:27 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="025241.html">[mod_python] deadlock when using mod_python + simplified GIL -
	e.g. swig wrapper of xapian (MODPYTHON-217)
</A></li>
        <LI>Next message: <A HREF="025244.html">[mod_python] Re: Problem with mod_proxy + inputfilter + headers_in
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25242">[ date ]</a>
              <a href="thread.html#25242">[ thread ]</a>
              <a href="subject.html#25242">[ subject ]</a>
              <a href="author.html#25242">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Graham, out of interest, has this always been the case with mod_python, or 
was this behavious introduced in a particular release?

Thanks

--Emyr

&quot;Graham Dumpleton&quot; 
&lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">graham.dumpleton at gmail.com</A>&gt; wrote in message 
news:<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">88e286470704191453o5b0b3c08u77b14064c1f58950 at mail.gmail.com...</A>
&gt;<i> You can't use a mod_python input filter to modify incoming headers. If
</I>&gt;<i> the changes to the headers aren't intended to influence the behaviour
</I>&gt;<i> of what Apache does during access, authentication, authorisation and
</I>&gt;<i> type checking phases, use a PythonFixupHandler to update any headers
</I>&gt;<i> to then be used by the actual response handler.
</I>&gt;<i>
</I>&gt;<i> Note, provided you are using mod_python 3.3, you can actually use
</I>&gt;<i> mod_python to trigger the proxying as well. See:
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://issues.apache.org/jira/browse/MODPYTHON-141">http://issues.apache.org/jira/browse/MODPYTHON-141</A>
</I>&gt;<i>
</I>&gt;<i> Graham
</I>&gt;<i>
</I>&gt;<i> On 20/04/07, indyone ;o) &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">indyone at gmail.com</A>&gt; 
</I>&gt;<i> wrote:
</I>&gt;&gt;<i> Hi list,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I'm trying to get the headers_in from the client, and after 
</I>&gt;&gt;<i> changing/adding
</I>&gt;&gt;<i> some headers i would like to pass them to the backend server.
</I>&gt;&gt;<i> I'm using Apache/2.0.55 (Win32) mod_python/3.1.3 Python/2.3.5
</I>&gt;&gt;<i> The problem is that the headers are sent to the backend unchanged when 
</I>&gt;&gt;<i> using
</I>&gt;&gt;<i> this simple input filter:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> def inputfilter(filter):
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     filter.req.headers_in['X-MyHeader'] = 'Test'
</I>&gt;&gt;<i>     if filter.req.main is not None:
</I>&gt;&gt;<i>         filter.pass_on()
</I>&gt;&gt;<i>         return
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     filter.req.log_error('Start %s' % filter.req.uri)
</I>&gt;&gt;<i>     s = filter.read()
</I>&gt;&gt;<i>     while s:
</I>&gt;&gt;<i>         filter.write(s)
</I>&gt;&gt;<i>         s = filter.read()
</I>&gt;&gt;<i>     if s is None:
</I>&gt;&gt;<i>         filter.close()
</I>&gt;&gt;<i>         filter.req.log_error('End %s' % filter.req.uri)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     filter.req.log_error('%s' % filter.req.headers_in)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> and Apache logs:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> [Thu Apr 19 18:17:28 2007] [error] [client 127.0.0.1] Start /, referer:
</I>&gt;&gt;<i> <A HREF="http://localhost/">http://localhost/</A>
</I>&gt;&gt;<i> [Thu Apr 19 18:17:28 2007] [error] [client 127.0.0.1] End /, referer:
</I>&gt;&gt;<i> <A HREF="http://localhost/">http://localhost/</A>
</I>&gt;&gt;<i> [Thu Apr 19 18:17:28 2007] [error] [client 127.0.0.1] {'X-MyHeader': 
</I>&gt;&gt;<i> 'Test',
</I>&gt;&gt;<i> 'X-Forwarded-Server': 'luna', 'X-Forwarded-Host': 'localhost',
</I>&gt;&gt;<i> 'X-Forwarded-For': ' 127.0.0.1', 'Max-Forwards': '10', 'Cookie': 
</I>&gt;&gt;<i> 'wstyle=;
</I>&gt;&gt;<i> __ac=&quot;YWRtaW46bWF0cml4&quot;;
</I>&gt;&gt;<i> tree-s=&quot;eJzT0MgpMOQKVneEAKcAN19bda4CI67EkgJjLj0AegYHmA&quot;',
</I>&gt;&gt;<i> 'Referer': ' <A HREF="http://localhost/',">http://localhost/',</A> 'Accept-Charset':
</I>&gt;&gt;<i> 'ISO-8859-7,utf-8;q=0.7,*;q=0.7', 'Accept-Encoding': 'gzip,deflate',
</I>&gt;&gt;<i> 'Accept-Language': 'el,en-us;q=0.7 ,en;q=0.3', 'Accept':
</I>&gt;&gt;<i> 'text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5',
</I>&gt;&gt;<i> 'User-Agent': 'Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv: 
</I>&gt;&gt;<i> 1.8.0.8)
</I>&gt;&gt;<i> Gecko/20061030 SeaMonkey/1.0.6', 'Host': 'localhost'}, referer:
</I>&gt;&gt;<i> <A HREF="http://localhost/">http://localhost/</A>
</I>&gt;&gt;<i> ...(multiple times)...
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Which is right i think... But my backend server gets this request:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> GET
</I>&gt;&gt;<i> /VirtualHostBase/http/localhost:80/Editorial/VirtualHostRoot/
</I>&gt;&gt;<i> HTTP/1.1
</I>&gt;&gt;<i> Host: localhost:8081
</I>&gt;&gt;<i> User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.0.8)
</I>&gt;&gt;<i> Gecko/20061030 SeaMonkey/1.0.6
</I>&gt;&gt;<i> Accept:
</I>&gt;&gt;<i> text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5
</I>&gt;&gt;<i> Accept-Language: el,en-us;q=0.7,en;q=0.3
</I>&gt;&gt;<i> Accept-Encoding: gzip,deflate
</I>&gt;&gt;<i> Accept-Charset: ISO-8859-7,utf-8;q= 0.7,*;q=0.7
</I>&gt;&gt;<i> Referer: <A HREF="http://localhost/">http://localhost/</A>
</I>&gt;&gt;<i> Cookie: wstyle=; __ac=&quot;YWRtaW46bWF0cml4&quot;;
</I>&gt;&gt;<i> tree-s=&quot;eJzT0MgpMOQKVneEAKcAN19bda4CI67EkgJjLj0AegYHmA&quot;
</I>&gt;&gt;<i> Max-Forwards: 10
</I>&gt;&gt;<i> X-Forwarded-For: 127.0.0.1
</I>&gt;&gt;<i> X-Forwarded-Host: localhost
</I>&gt;&gt;<i> X-Forwarded-Server: luna
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thank you in advance,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Ioannis Stavrinos
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> Mod_python mailing list
</I>&gt;&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 
</I>


</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025241.html">[mod_python] deadlock when using mod_python + simplified GIL -
	e.g. swig wrapper of xapian (MODPYTHON-217)
</A></li>
	<LI>Next message: <A HREF="025244.html">[mod_python] Re: Problem with mod_proxy + inputfilter + headers_in
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25242">[ date ]</a>
              <a href="thread.html#25242">[ thread ]</a>
              <a href="subject.html#25242">[ subject ]</a>
              <a href="author.html#25242">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
