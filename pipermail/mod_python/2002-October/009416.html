<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] strange behavior of mod-python
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20strange%20behavior%20of%20mod-python&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009415.html">
   <LINK REL="Next"  HREF="009418.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
<table border=0 width="100%"><tr><td valign="top">
   <H1>[mod_python] strange behavior of mod-python</H1>
    <B>Fran&#231;ois Lepoutre</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20strange%20behavior%20of%20mod-python&In-Reply-To="
       TITLE="[mod_python] strange behavior of mod-python">francoislepoutre at compuserve.com
       </A><BR>
    <I>Fri Oct 18 14:55:23 EST 2002</I>
    <P><UL>
        <LI>Previous message: <A HREF="009415.html">[mod_python] strange behavior of mod-python
</A></li>
        <LI>Next message: <A HREF="009418.html">[mod_python] Redirects
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9416">[ date ]</a>
              <a href="thread.html#9416">[ thread ]</a>
              <a href="subject.html#9416">[ subject ]</a>
              <a href="author.html#9416">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i>I will inform you to apache 2...
</I>
Thank you

&gt;<i>VI've found your mail of
</I>&gt;<i>www.modpython.org/pipermail/mod_python/2001-September/001647.html
</I>&gt;<i>that concern this problem. May I try to put &quot;ThreadPerChild&quot; to 1 instead
</I>of
&gt;<i>2 to 50 ?
</I>
&gt;<i>I not clearly understood  the problem to doing that: the pb vanishes... and
</I>&gt;<i>performance as well. (pb?)
</I>

Yes exactly!

&gt;<i>otherwise have you some example of code to protect  data under stress? I
</I>&gt;<i>don't have any idea to do so.
</I>
I am no expert (IT by experience not education).
But python is so simple. I used the following kind
of code (no guarantee on details but you will
get the idea clear).

# at module level (global)
# add this
import threading
my_data_lock =  threading.RLock()

# every time you update your global variables

global my_data_lock
my_data_lock.acquire()

# update your stuff here
# while other thread wait ....

# release the lock
my_data_lock.release

I am sure you could (and should) do it
in a cleaner object-oriented way.
But that solved the threading issue.

Francois
-----Messaggio originale-----
Da: Fran&#231;ois Lepoutre [mailto:<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">francoislepoutre at compuserve.com</A>]
Inviato: venerd&#236; 18 ottobre 2002 11.37
A: Manera, Villiam
Cc: <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python at modpython.org</A>
Oggetto: Re: [mod_python] strange behavior of mod-python


&gt;<i>I use a class for handle a pool of connection to the data base that became
</I>&gt;<i>persistent after the first call,
</I>&gt;<i>and all the progrma that need a connection to the db have to pass through
</I>&gt;<i>this class.
</I>
Same for me. Most odbc drivers are not fully threadsafe.

&gt;<i>But why only une program fall in this problem?
</I>&gt;<i>In what way may I check if different trading are competing (my application
</I>&gt;<i>doesn't call
</I>&gt;<i>expressly any thread, mod python do it for me? I don't use multiple
</I>&gt;<i>interpretes)
</I>

It all happens under stress only ...

-on apache linux ... when under stress apache forks as many
interpreters as needed. Each intepreters handle the calls
in an organised queue.

No race conditions here. Simple !

- on apache win32 ... when under strees apache win32 calls
for a nex thread. EACH THREAD may access all
your persistent python objects.

You need to put code to protect your data under stress.

&gt;<i>The way apache works on
</I>&gt;<i>Anyway if this may be one problem I will start today to move from apache
</I>&gt;<i>1.3.26 to apache 2.0.43
</I>&gt;<i>with mod-python beta 3 (different management of threading), in order to
</I>&gt;<i>check this problem.
</I>
I am quite new here. not tested the beta.

I have not tested that. No time at the moment.
Could you keep me informed on the all thing.

I have to maintain two version of our code.

One for linux, simple. The other one for nt/2K
that cares for concurrency.

The truth .. ain't log or complex but that's
extra code anyway.

Can i have one version only on apache 2
with both threading and forking activated ?

&gt;<i>I've to stay on nt/2000 because the odbc driver for my database it is not
</I>&gt;<i>available on linux
</I>
Using a multiplatform db with support of both
win32 and *nix is great. We use ASA.
Great on win32. Runs on *nix.

&gt;<i>Thanks for your interest
</I>
mod_python is a great product.. worth digging thru.
You're welcome.

Francois

a win32 geek moving multiplatform
thru python/mod_python


-----Messaggio originale-----
Da: Fran&#231;ois Lepoutre [mailto:<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">francoislepoutre at compuserve.com</A>]
Inviato: gioved&#236; 17 ottobre 2002 23.26
A: Manera, Villiam
Oggetto: Re: [mod_python] strange behavior of mod-python


HI,

I love python and like mod_python a lot...
but have had trouble with the mod_python
programming model on nt/2000 because
of threading.

Do you keep db handle or python shared
data structure persistent in the python
interpreter?

If you do, have you made sure that
distinct thread are competing
for the same resource?

Just my two cents...


-----Original Message-----
From: Manera, Villiam &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">vmanera at manord.com</A>&gt;
To: '<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python at modpython.org</A>' &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python at modpython.org</A>&gt;
Date: 17 October 2002 19:13
Subject: [mod_python] strange behavior of mod-python


&gt;<i>
</I>&gt;<i>I'm currently use mod-python 2.7.6 on apache 1.3.26 - windows 2000 with
</I>&gt;<i>python 2.2
</I>&gt;<i>apache config:
</I>&gt;<i>.....
</I>&gt;<i>    ScriptAlias /comm/ &quot;E:/script/cgi/comm/&quot;
</I>&gt;<i>    ScriptAlias /tecnico/ &quot;E:/script/cgi/tecnico/&quot;
</I>&gt;<i>....
</I>&gt;<i>&lt;Directory &quot;E:/script/cgi/comm&quot;&gt;
</I>&gt;<i>        Order Deny,Allow
</I>&gt;<i>        Deny from all
</I>&gt;<i>        Allow from .....
</I>&gt;<i>       ...
</I>&gt;<i>    AddHandler python-program .py
</I>&gt;<i>    PythonHandler mod_python.publisher
</I>&gt;<i> PythonPath &quot;sys.path+['c:/program
</I>&gt;<i>files/python22/lib/site-packages/mdnlib', 'c:/program
</I>&gt;<i>files/python22/lib/site-packages/HTMLgen','E:/script/cgi/comm']&quot;
</I>&gt;<i>    PythonDebug on
</I>&gt;<i>    &lt;/Directory&gt;
</I>&gt;<i>
</I>&gt;<i>----------------------------------------------------
</I>&gt;<i>all work fine, but sometimes (today 4 time) when a url is typed:
</I>&gt;<i><A HREF="http://sviluppo.manord.com/comm/comm_ocordiu0.py/main?....">http://sviluppo.manord.com/comm/comm_ocordiu0.py/main?....</A>
</I>&gt;<i>
</I>&gt;<i>I have this behavior from apache:
</I>&gt;<i>HTTP 404 - File non trovato (not found)
</I>&gt;<i>Internet Explorer
</I>&gt;<i>but the program is still in place, and the only way to force apache to
</I>found
&gt;<i>the program is restart the apache services,
</I>&gt;<i>or make a copy of comm_ocordiu0 in comm_ocordiu1 and then call this one,
</I>&gt;<i>but....
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>this is not a real problem in developement web server, but  today it
</I>&gt;<i>happened 4 time, in production is happened 2 time in one month,
</I>&gt;<i>and I become in panic.
</I>&gt;<i>
</I>&gt;<i>Any advice here would be greatly appreciated.
</I>&gt;<i>
</I>&gt;<i>Villiam
</I>&gt;<i>_______________________________________________
</I>&gt;<i>Mod_python mailing list
</I>&gt;<i><A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i><A HREF="http://www.modpython.org/mailman/listinfo/mod_python">http://www.modpython.org/mailman/listinfo/mod_python</A>
</I>

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009415.html">[mod_python] strange behavior of mod-python
</A></li>
	<LI>Next message: <A HREF="009418.html">[mod_python] Redirects
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9416">[ date ]</a>
              <a href="thread.html#9416">[ thread ]</a>
              <a href="subject.html#9416">[ subject ]</a>
              <a href="author.html#9416">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
