<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] mod_python session/form based user authentication
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20mod_python%20session/form%20based%20user%20authentication&In-Reply-To=a595de7a0903300623t21d39f9ch4eaa8bf7006d261b%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026140.html">
   <LINK REL="Next"  HREF="026125.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] mod_python session/form based user authentication</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>bruce bushby</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20mod_python%20session/form%20based%20user%20authentication&In-Reply-To=a595de7a0903300623t21d39f9ch4eaa8bf7006d261b%40mail.gmail.com"
       TITLE="[mod_python] mod_python session/form based user authentication">bruce.bushby at googlemail.com
       </A><BR>
    <I>Mon Mar 30 11:06:32 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="026140.html">[mod_python] mod_python session/form based user authentication
</A></li>
        <LI>Next message: <A HREF="026125.html">[mod_python] Reloading PSP sometimes shows old pages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26141">[ date ]</a>
              <a href="thread.html#26141">[ thread ]</a>
              <a href="subject.html#26141">[ subject ]</a>
              <a href="author.html#26141">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm a complete novice but from what I've seen I really enjoy mod_python,
mostly because I'm hacking about at home, hosting
on my broadband and don't need anything more then the most simple solution
possible.

However, if I were tasked with developing a large commercial web app in
python, I would adopt mod_wsgi, so to me I see both modules having a long
life. I'd go so far as to say that the python language and the wsgi spec
need mod_python. I'm surprised there was a need for &quot;PEP 333&quot;
when there appears to be very little interest in mod_python. I say very
little interest because when compared to php, mod_python uptake is
neglegable
which surprises me because php as a language can hardly compare to python.





On Mon, Mar 30, 2009 at 2:23 PM, Clodoaldo Pinto Neto &lt;
<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">clodoaldo.pinto.neto at gmail.com</A>&gt; wrote:

&gt;<i> 2009/3/30 Graham Dumpleton &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">graham.dumpleton at gmail.com</A>&gt;:
</I>&gt;<i> &gt; 2009/3/30 bruce bushby &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">bruce.bushby at googlemail.com</A>&gt;:
</I>&gt;<i> &gt;&gt; Hi Graeme
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Thanks for the feedback. The issue I've been stuck with ( for 3 months
</I>&gt;<i> now)
</I>&gt;<i> &gt;&gt; is how to prevent the &quot;browser pop-up&quot;  user/password dialog box.
</I>&gt;<i> &gt;&gt; I've tried so many combinations, but every time I have &quot;AuthType
</I>&gt;<i> &gt;&gt; Basic/Require valid-user&quot; set, the browser pops up the login dialog box
</I>&gt;<i> but
</I>&gt;<i> &gt;&gt; I want
</I>&gt;<i> &gt;&gt; &quot;html form login/authentication&quot;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Try setting:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;  AuthBasicAuthoritative Off
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; in Apache configuration.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; But then, if you aren't setting AuthType to be Basic, this shouldn't
</I>&gt;<i> &gt; be an issue.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;&gt; req.user = &quot;nobody&quot; was set as a place holder because without it I get:
</I>&gt;<i> &gt;&gt;   [ req-&gt;user is NULL. Assign something to req.user if returning OK to
</I>&gt;<i> avoid
</I>&gt;<i> &gt;&gt; this error ]
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Even as a place holder, didn't need to be set in all cases and could
</I>&gt;<i> &gt; cause an issue if there were multiple authentication handlers being
</I>&gt;<i> &gt; executed.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;&gt; I've just tried the following:
</I>&gt;<i> &gt;&gt; AuthType session
</I>&gt;<i> &gt;&gt; AuthName &quot;members&quot;
</I>&gt;<i> &gt;&gt; Require valid-session
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The Require isn't much point if you haven't written an authorization
</I>&gt;<i> &gt; handler that understands valid-session.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;&gt; ...and it works......but only if I &quot;set req.user = nobody&quot; as a temp
</I>&gt;<i> place
</I>&gt;<i> &gt;&gt; holder...or I get the req-&gt;user is NULL error
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; I'll admit I don't have a clue....I got this far by trial and error,
</I>&gt;<i> which
</I>&gt;<i> &gt;&gt; is not very efficient.....I'm waiting for your book ...hint hint :))
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I will not be writing a book on mod_python. IMHO mod_python is dying
</I>&gt;<i> &gt; and the quicker people stop using it and shift to WSGI based Python
</I>&gt;<i> &gt; web applications the better.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The only problem in saying that is the alternatives don't support
</I>&gt;<i>
</I>&gt;<i> I think there is one more problem in saying that. The number of people
</I>&gt;<i> insisting in using mod_python shows that there is a place for
</I>&gt;<i> something simple like the publisher handler. Even so long time after
</I>&gt;<i> the alternatives have been available and so long time after the
</I>&gt;<i> alternatives advocates have been saying they are much better still
</I>&gt;<i> many of the beginners don't embrace them. And tool kits like Werkzeug
</I>&gt;<i> are not those beginners expected answer. The tendency of the
</I>&gt;<i> frameworks authors trying to get them as complex as possible also do
</I>&gt;<i> not help.
</I>&gt;<i>
</I>&gt;<i> Developers (the good ones) love simplicity. My mod_python/CGI tutorial
</I>&gt;<i> is still growing in visits and CGI is still the visits champion! Not
</I>&gt;<i> saying mod_python should be kept alive, just that there is a clearly
</I>&gt;<i> delimited space for something like the publisher and trying to steer
</I>&gt;<i> the simplicity seekers out of that is not really productive. I'm
</I>&gt;<i> afraid they will just feel like there is no point in going with
</I>&gt;<i> python.
</I>&gt;<i>
</I>&gt;<i> Regards, Clodoaldo
</I>&gt;<i>
</I>&gt;<i> &gt; writing Apache input/output filters nor custom session based
</I>&gt;<i> &gt; authetication/authorisation schemes that cover multiple applications.
</I>&gt;<i> &gt; The latter though will be supported in Apache 2.4 though through
</I>&gt;<i> &gt; mod_session, so no need to be fiddling within using mod_python at that
</I>&gt;<i> &gt; point. You could also right now just use:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;  <A HREF="http://www.openfusion.com.au/labs/mod_auth_tkt/">http://www.openfusion.com.au/labs/mod_auth_tkt/</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;&gt; Is there a secret to prevent the &quot;browser password pop-up box&quot; and
</I>&gt;<i> redirect
</I>&gt;<i> &gt;&gt; to a html login page? I've spent 3 months
</I>&gt;<i> &gt;&gt; googling and can't find a simple example.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; For a working form/session based authentication handler, that is that
</I>&gt;<i> &gt; I presume it still works, see:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;  <A HREF="http://www.modpython.org/pipermail/mod_python/2006-May/021172.html">http://www.modpython.org/pipermail/mod_python/2006-May/021172.html</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The correct attachment address is:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> <A HREF="http://www.modpython.org/pipermail/mod_python/attachments/20060520/813620d0/sessionmanager.tar.gz">http://www.modpython.org/pipermail/mod_python/attachments/20060520/813620d0/sessionmanager.tar.gz</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; See the .htaccess file as to how it all ties together. The _session.py
</I>&gt;<i> &gt; file is also extensively documented.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Graham
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Thanks again
</I>&gt;<i> &gt;&gt; Bruce
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; On Sun, Mar 29, 2009 at 11:23 PM, Graham Dumpleton
</I>&gt;<i> &gt;&gt; &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">graham.dumpleton at gmail.com</A>&gt; wrote:
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; 2009/3/29 bruce bushby &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">bruce.bushby at googlemail.com</A>&gt;:
</I>&gt;<i> &gt;&gt;&gt; &gt; Hi
</I>&gt;<i> &gt;&gt;&gt; &gt;
</I>&gt;<i> &gt;&gt;&gt; &gt; I've been struggling to implement form based user authentication for
</I>&gt;<i> &gt;&gt;&gt; &gt; some
</I>&gt;<i> &gt;&gt;&gt; &gt; time now so I'm posting my progress in the hope that
</I>&gt;<i> &gt;&gt;&gt; &gt; more experienced members will comment and any new starters will save
</I>&gt;<i> &gt;&gt;&gt; &gt; themselves some time.
</I>&gt;<i> &gt;&gt;&gt; &gt;
</I>&gt;<i> &gt;&gt;&gt; &gt; A big thanks to John Calixto for getting back to me and suggesting
</I>&gt;<i> &gt;&gt;&gt; &gt; &quot;AuthType
</I>&gt;<i> &gt;&gt;&gt; &gt; wgtiauth&quot; and &quot;Require wgti-user&quot;
</I>&gt;<i> &gt;&gt;&gt; &gt;
</I>&gt;<i> &gt;&gt;&gt; &gt;
</I>&gt;<i> &gt;&gt;&gt; &gt; The example works as follows:
</I>&gt;<i> &gt;&gt;&gt; &gt; - Attempt to access the protected area gets intercepted by
</I>&gt;<i> &gt;&gt;&gt; &gt; authenhandler, if
</I>&gt;<i> &gt;&gt;&gt; &gt; not authorized redirect to login, if login successful, continue to
</I>&gt;<i> &gt;&gt;&gt; &gt; original
</I>&gt;<i> &gt;&gt;&gt; &gt; url.
</I>&gt;<i> &gt;&gt;&gt; &gt;
</I>&gt;<i> &gt;&gt;&gt; &gt; ...
</I>&gt;<i> &gt;&gt;&gt; &gt;
</I>&gt;<i> &gt;&gt;&gt; &gt; def authenhandler(req):
</I>&gt;<i> &gt;&gt;&gt; &gt;         req.user = &quot;nobody&quot;
</I>&gt;<i> &gt;&gt;&gt; &gt;         req.session = Session.DbmSession(req)
</I>&gt;<i> &gt;&gt;&gt; &gt;
</I>&gt;<i> &gt;&gt;&gt; &gt;         if req.session.is_new():
</I>&gt;<i> &gt;&gt;&gt; &gt;                 req.session['referer'] = &quot;<A HREF="http://mysite&quot;">http://mysite&quot;</A> +
</I>&gt;<i> &gt;&gt;&gt; &gt; req.unparsed_uri
</I>&gt;<i> &gt;&gt;&gt; &gt;                 req.session.save()
</I>&gt;<i> &gt;&gt;&gt; &gt;                 util.redirect(req,&quot;<A HREF="http://mysite/login&quot;">http://mysite/login&quot;</A>)
</I>&gt;<i> &gt;&gt;&gt; &gt;
</I>&gt;<i> &gt;&gt;&gt; &gt;         if req.session.has_key('authstatus') and
</I>&gt;<i> &gt;&gt;&gt; &gt; req.session['authstatus']
</I>&gt;<i> &gt;&gt;&gt; &gt; == &quot;authenticated&quot;:
</I>&gt;<i> &gt;&gt;&gt; &gt;                 return apache.OK
</I>&gt;<i> &gt;&gt;&gt; &gt;
</I>&gt;<i> &gt;&gt;&gt; &gt;         return apache.HTTP_UNAUTHORIZED
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; Technically this is incorrect/incomplete.
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; 1. An authentication handler should be checking whether it is the
</I>&gt;<i> &gt;&gt;&gt; handler that should run for the AuthType used. Thus should have the
</I>&gt;<i> &gt;&gt;&gt; following check as first thing done:
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;  if req.auth_type() != 'wgtiauth':
</I>&gt;<i> &gt;&gt;&gt;    return apache.DECLINED
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; 2. If the authentication handler successfully authenticated user, only
</I>&gt;<i> &gt;&gt;&gt; then should it be setting req.user. It should not be doing it all the
</I>&gt;<i> &gt;&gt;&gt; time even if authentication failed. It is not technically a good idea
</I>&gt;<i> &gt;&gt;&gt; to be setting it to 'nobody' and it should really be the actual user
</I>&gt;<i> &gt;&gt;&gt; name. That way you can then use other Apache directives such as
</I>&gt;<i> &gt;&gt;&gt; 'Require user'.
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; 3. If the authentication handler was successful, it should be setting
</I>&gt;<i> &gt;&gt;&gt; req.ap_auth_type to be the authentication type.
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;  req.ap_auth_type = req.auth_type()
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; &gt; def authzhandler(req):
</I>&gt;<i> &gt;&gt;&gt; &gt;         if req.user:
</I>&gt;<i> &gt;&gt;&gt; &gt;                 return apache.OK
</I>&gt;<i> &gt;&gt;&gt; &gt;
</I>&gt;<i> &gt;&gt;&gt; &gt;         return apache.HTTP_UNAUTHORIZED
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; Your whole authorisation handler is not needed, so get rid of:
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;                Require wgti-user
</I>&gt;<i> &gt;&gt;&gt;                PythonAuthzHandler authsession
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; and replace it with:
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;                Require valid-user
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; As I said before though, you should only be setting req.user if user
</I>&gt;<i> &gt;&gt;&gt; authenticated properly.
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; Graham
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; Mod_python mailing list
</I>&gt;<i> &gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> &gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20090330/d448c0ed/attachment.html">http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20090330/d448c0ed/attachment.html</A>
</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026140.html">[mod_python] mod_python session/form based user authentication
</A></li>
	<LI>Next message: <A HREF="026125.html">[mod_python] Reloading PSP sometimes shows old pages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26141">[ date ]</a>
              <a href="thread.html#26141">[ thread ]</a>
              <a href="subject.html#26141">[ subject ]</a>
              <a href="author.html#26141">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
