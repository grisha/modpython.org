<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] mod_python session/form based user authentication
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20mod_python%20session/form%20based%20user%20authentication&In-Reply-To=e9fd6bd0903290417n6bd432b2m678e3768188b8800%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026117.html">
   <LINK REL="Next"  HREF="026121.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] mod_python session/form based user authentication</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20mod_python%20session/form%20based%20user%20authentication&In-Reply-To=e9fd6bd0903290417n6bd432b2m678e3768188b8800%40mail.gmail.com"
       TITLE="[mod_python] mod_python session/form based user authentication">graham.dumpleton at gmail.com
       </A><BR>
    <I>Sun Mar 29 18:23:15 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="026117.html">[mod_python] mod_python session/form based user authentication
</A></li>
        <LI>Next message: <A HREF="026121.html">[mod_python] mod_python session/form based user authentication
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26118">[ date ]</a>
              <a href="thread.html#26118">[ thread ]</a>
              <a href="subject.html#26118">[ subject ]</a>
              <a href="author.html#26118">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>2009/3/29 bruce bushby &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">bruce.bushby at googlemail.com</A>&gt;:
&gt;<i> Hi
</I>&gt;<i>
</I>&gt;<i> I've been struggling to implement form based user authentication for some
</I>&gt;<i> time now so I'm posting my progress in the hope that
</I>&gt;<i> more experienced members will comment and any new starters will save
</I>&gt;<i> themselves some time.
</I>&gt;<i>
</I>&gt;<i> A big thanks to John Calixto for getting back to me and suggesting &quot;AuthType
</I>&gt;<i> wgtiauth&quot; and &quot;Require wgti-user&quot;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> The example works as follows:
</I>&gt;<i> - Attempt to access the protected area gets intercepted by authenhandler, if
</I>&gt;<i> not authorized redirect to login, if login successful, continue to original
</I>&gt;<i> url.
</I>&gt;<i>
</I>&gt;<i> ...
</I>&gt;<i>
</I>&gt;<i> def authenhandler(req):
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160; req.user = &quot;nobody&quot;
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160; req.session = Session.DbmSession(req)
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160; if req.session.is_new():
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; req.session['referer'] = &quot;<A HREF="http://mysite&quot;">http://mysite&quot;</A> + req.unparsed_uri
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; req.session.save()
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; util.redirect(req,&quot;<A HREF="http://mysite/login&quot;">http://mysite/login&quot;</A>)
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160; if req.session.has_key('authstatus') and req.session['authstatus']
</I>&gt;<i> == &quot;authenticated&quot;:
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; return apache.OK
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160; return apache.HTTP_UNAUTHORIZED
</I>
Technically this is incorrect/incomplete.

1. An authentication handler should be checking whether it is the
handler that should run for the AuthType used. Thus should have the
following check as first thing done:

  if req.auth_type() != 'wgtiauth':
    return apache.DECLINED

2. If the authentication handler successfully authenticated user, only
then should it be setting req.user. It should not be doing it all the
time even if authentication failed. It is not technically a good idea
to be setting it to 'nobody' and it should really be the actual user
name. That way you can then use other Apache directives such as
'Require user'.

3. If the authentication handler was successful, it should be setting
req.ap_auth_type to be the authentication type.

  req.ap_auth_type = req.auth_type()

&gt;<i> def authzhandler(req):
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160; if req.user:
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; return apache.OK
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160; return apache.HTTP_UNAUTHORIZED
</I>
Your whole authorisation handler is not needed, so get rid of:

                Require wgti-user
                PythonAuthzHandler authsession

and replace it with:

                Require valid-user

As I said before though, you should only be setting req.user if user
authenticated properly.

Graham

</PRE>






















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026117.html">[mod_python] mod_python session/form based user authentication
</A></li>
	<LI>Next message: <A HREF="026121.html">[mod_python] mod_python session/form based user authentication
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26118">[ date ]</a>
              <a href="thread.html#26118">[ thread ]</a>
              <a href="subject.html#26118">[ subject ]</a>
              <a href="author.html#26118">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
