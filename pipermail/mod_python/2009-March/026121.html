<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] mod_python session/form based user authentication
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20mod_python%20session/form%20based%20user%20authentication&In-Reply-To=88e286470903291523h31169aebi5230cc2632f14a7%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026118.html">
   <LINK REL="Next"  HREF="026122.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] mod_python session/form based user authentication</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>bruce bushby</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20mod_python%20session/form%20based%20user%20authentication&In-Reply-To=88e286470903291523h31169aebi5230cc2632f14a7%40mail.gmail.com"
       TITLE="[mod_python] mod_python session/form based user authentication">bruce.bushby at googlemail.com
       </A><BR>
    <I>Sun Mar 29 21:43:40 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="026118.html">[mod_python] mod_python session/form based user authentication
</A></li>
        <LI>Next message: <A HREF="026122.html">[mod_python] mod_python session/form based user authentication
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26121">[ date ]</a>
              <a href="thread.html#26121">[ thread ]</a>
              <a href="subject.html#26121">[ subject ]</a>
              <a href="author.html#26121">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Graeme

Thanks for the feedback. The issue I've been stuck with ( for 3 months now)
is how to prevent the &quot;browser pop-up&quot;  user/password dialog box.
I've tried so many combinations, but every time I have &quot;AuthType
Basic/Require valid-user&quot; set, the browser pops up the login dialog box but
I want
&quot;html form login/authentication&quot;

req.user = &quot;nobody&quot; was set as a place holder because without it I get:
  [ req-&gt;user is NULL. Assign something to req.user if returning OK to avoid
this error ]

I've just tried the following:
AuthType session
AuthName &quot;members&quot;
Require valid-session

...and it works......but only if I &quot;set req.user = nobody&quot; as a temp place
holder...or I get the req-&gt;user is NULL error


I'll admit I don't have a clue....I got this far by trial and error, which
is not very efficient.....I'm waiting for your book ...hint hint :))

Is there a secret to prevent the &quot;browser password pop-up box&quot; and redirect
to a html login page? I've spent 3 months
googling and can't find a simple example.

Thanks again
Bruce













On Sun, Mar 29, 2009 at 11:23 PM, Graham Dumpleton &lt;
<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">graham.dumpleton at gmail.com</A>&gt; wrote:

&gt;<i> 2009/3/29 bruce bushby &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">bruce.bushby at googlemail.com</A>&gt;:
</I>&gt;<i> &gt; Hi
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I've been struggling to implement form based user authentication for some
</I>&gt;<i> &gt; time now so I'm posting my progress in the hope that
</I>&gt;<i> &gt; more experienced members will comment and any new starters will save
</I>&gt;<i> &gt; themselves some time.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; A big thanks to John Calixto for getting back to me and suggesting
</I>&gt;<i> &quot;AuthType
</I>&gt;<i> &gt; wgtiauth&quot; and &quot;Require wgti-user&quot;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The example works as follows:
</I>&gt;<i> &gt; - Attempt to access the protected area gets intercepted by authenhandler,
</I>&gt;<i> if
</I>&gt;<i> &gt; not authorized redirect to login, if login successful, continue to
</I>&gt;<i> original
</I>&gt;<i> &gt; url.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ...
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; def authenhandler(req):
</I>&gt;<i> &gt;         req.user = &quot;nobody&quot;
</I>&gt;<i> &gt;         req.session = Session.DbmSession(req)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;         if req.session.is_new():
</I>&gt;<i> &gt;                 req.session['referer'] = &quot;<A HREF="http://mysite&quot;">http://mysite&quot;</A> +
</I>&gt;<i> req.unparsed_uri
</I>&gt;<i> &gt;                 req.session.save()
</I>&gt;<i> &gt;                 util.redirect(req,&quot;<A HREF="http://mysite/login&quot;">http://mysite/login&quot;</A>)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;         if req.session.has_key('authstatus') and
</I>&gt;<i> req.session['authstatus']
</I>&gt;<i> &gt; == &quot;authenticated&quot;:
</I>&gt;<i> &gt;                 return apache.OK
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;         return apache.HTTP_UNAUTHORIZED
</I>&gt;<i>
</I>&gt;<i> Technically this is incorrect/incomplete.
</I>&gt;<i>
</I>&gt;<i> 1. An authentication handler should be checking whether it is the
</I>&gt;<i> handler that should run for the AuthType used. Thus should have the
</I>&gt;<i> following check as first thing done:
</I>&gt;<i>
</I>&gt;<i>  if req.auth_type() != 'wgtiauth':
</I>&gt;<i>    return apache.DECLINED
</I>&gt;<i>
</I>&gt;<i> 2. If the authentication handler successfully authenticated user, only
</I>&gt;<i> then should it be setting req.user. It should not be doing it all the
</I>&gt;<i> time even if authentication failed. It is not technically a good idea
</I>&gt;<i> to be setting it to 'nobody' and it should really be the actual user
</I>&gt;<i> name. That way you can then use other Apache directives such as
</I>&gt;<i> 'Require user'.
</I>&gt;<i>
</I>&gt;<i> 3. If the authentication handler was successful, it should be setting
</I>&gt;<i> req.ap_auth_type to be the authentication type.
</I>&gt;<i>
</I>&gt;<i>  req.ap_auth_type = req.auth_type()
</I>&gt;<i>
</I>&gt;<i> &gt; def authzhandler(req):
</I>&gt;<i> &gt;         if req.user:
</I>&gt;<i> &gt;                 return apache.OK
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;         return apache.HTTP_UNAUTHORIZED
</I>&gt;<i>
</I>&gt;<i> Your whole authorisation handler is not needed, so get rid of:
</I>&gt;<i>
</I>&gt;<i>                Require wgti-user
</I>&gt;<i>                PythonAuthzHandler authsession
</I>&gt;<i>
</I>&gt;<i> and replace it with:
</I>&gt;<i>
</I>&gt;<i>                Require valid-user
</I>&gt;<i>
</I>&gt;<i> As I said before though, you should only be setting req.user if user
</I>&gt;<i> authenticated properly.
</I>&gt;<i>
</I>&gt;<i> Graham
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20090330/40f1a49a/attachment.html">http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20090330/40f1a49a/attachment.html</A>
</PRE>




















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026118.html">[mod_python] mod_python session/form based user authentication
</A></li>
	<LI>Next message: <A HREF="026122.html">[mod_python] mod_python session/form based user authentication
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26121">[ date ]</a>
              <a href="thread.html#26121">[ thread ]</a>
              <a href="subject.html#26121">[ subject ]</a>
              <a href="author.html#26121">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
