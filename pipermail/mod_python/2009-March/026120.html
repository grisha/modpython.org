<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] multiple processing of the same python script by the
	handler
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20multiple%20processing%20of%20the%20same%20python%20script%20by%20the%0A%09handler&In-Reply-To=200903292215.31384.webmaster%40world-vr.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026119.html">
   <LINK REL="Next"  HREF="026154.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] multiple processing of the same python script by the
	handler</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20multiple%20processing%20of%20the%20same%20python%20script%20by%20the%0A%09handler&In-Reply-To=200903292215.31384.webmaster%40world-vr.com"
       TITLE="[mod_python] multiple processing of the same python script by the
	handler">graham.dumpleton at gmail.com
       </A><BR>
    <I>Sun Mar 29 21:33:46 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="026119.html">[mod_python] multiple processing of the same python script by the
	handler
</A></li>
        <LI>Next message: <A HREF="026154.html">[mod_python] multiple processing of the same python script by the
	handler
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26120">[ date ]</a>
              <a href="thread.html#26120">[ thread ]</a>
              <a href="subject.html#26120">[ subject ]</a>
              <a href="author.html#26120">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>2009/3/30 David Sfiligoi &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">webmaster at world-vr.com</A>&gt;:
&gt;<i> Hi Graham,
</I>&gt;<i>
</I>&gt;<i> Yes I agree defining my logger outside the mod python handler was a bad idea.
</I>&gt;<i> Using the req.log_error works of course. &#160;Obviously if I wanted integrate
</I>&gt;<i> this into all the other apps that revolve around those logs, i'd have to
</I>&gt;<i> write a converter or change each apps which parses the log data.
</I>&gt;<i>
</I>&gt;<i> I'd like to understand this a bit better, perhaps I have the wrong basic idea
</I>&gt;<i> on how the python handler works in overall, but if I install the log handler
</I>&gt;<i> in the handler function and delete the log objects before ending, shouldn't
</I>&gt;<i> that take care of the multiple logging issue?
</I>&gt;<i>
</I>&gt;<i> Or are you saying that each piece of code that should not produce multiple
</I>&gt;<i> entries of the same thing should really be inside a module so I can let
</I>&gt;<i> import_module() take care of it?
</I>
Put logging initialisation in a completely separate module outside of
document tree and not inside of the handler code files. Setup
PythonPath if need be where that separate module is located,  and then
have handler code files import that module from that other location.

This should ensure that the logging initialisation code is imported
and run only once per process. If you intentionally then change the
logging initialisation module code, you will need to restart Apache.

&gt;<i> Im seeing the same 'multiplicity' issue when I open a socket while in handler
</I>&gt;<i> function. This is really what trigger the question.
</I>
That I can't explain at this point. I was assuming that your
duplicated logging may have been confusing the issue.

&gt;<i> Thanks,
</I>&gt;<i>
</I>&gt;<i> David
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Sunday 29 March 2009 05:45:01 am Graham Dumpleton wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> If you change a mod_python handler script, it will be automatically
</I>&gt;&gt;<i> reloaded. This would be a problem in your code as you installed a log
</I>&gt;&gt;<i> handler each time it is loaded into the same process. Having multiple
</I>&gt;&gt;<i> instances of the log handler installed would result in the same
</I>&gt;&gt;<i> information possibly being logged multiple times.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I would suggest you add inside your handler script:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &#160; req.log_error(&quot;I have been called&quot;)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> If that appears twice in the Apache error log file then I would be
</I>&gt;&gt;<i> concerned, otherwise I would say the problem is with your use of the
</I>&gt;&gt;<i> logging module.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Also read about import_module() in:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &#160; <A HREF="http://www.modpython.org/live/current/doc-html/pyapi-apmeth.html">http://www.modpython.org/live/current/doc-html/pyapi-apmeth.html</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> as it explains a bit about module reloading and the way to preserve
</I>&gt;&gt;<i> global data or avoid stuff which performs additive operations each
</I>&gt;&gt;<i> time it is loaded.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Graham
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>
</PRE>


















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026119.html">[mod_python] multiple processing of the same python script by the
	handler
</A></li>
	<LI>Next message: <A HREF="026154.html">[mod_python] multiple processing of the same python script by the
	handler
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26120">[ date ]</a>
              <a href="thread.html#26120">[ thread ]</a>
              <a href="subject.html#26120">[ subject ]</a>
              <a href="author.html#26120">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
