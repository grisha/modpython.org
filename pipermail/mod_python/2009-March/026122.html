<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] mod_python session/form based user authentication
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20mod_python%20session/form%20based%20user%20authentication&In-Reply-To=e9fd6bd0903291843r7822d84fmbec0a93ce9a3480d%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026121.html">
   <LINK REL="Next"  HREF="026140.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] mod_python session/form based user authentication</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20mod_python%20session/form%20based%20user%20authentication&In-Reply-To=e9fd6bd0903291843r7822d84fmbec0a93ce9a3480d%40mail.gmail.com"
       TITLE="[mod_python] mod_python session/form based user authentication">graham.dumpleton at gmail.com
       </A><BR>
    <I>Sun Mar 29 23:16:58 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="026121.html">[mod_python] mod_python session/form based user authentication
</A></li>
        <LI>Next message: <A HREF="026140.html">[mod_python] mod_python session/form based user authentication
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26122">[ date ]</a>
              <a href="thread.html#26122">[ thread ]</a>
              <a href="subject.html#26122">[ subject ]</a>
              <a href="author.html#26122">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>2009/3/30 bruce bushby &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">bruce.bushby at googlemail.com</A>&gt;:
&gt;<i> Hi Graeme
</I>&gt;<i>
</I>&gt;<i> Thanks for the feedback. The issue I've been stuck with ( for 3 months now)
</I>&gt;<i> is how to prevent the &quot;browser pop-up&quot;&#160; user/password dialog box.
</I>&gt;<i> I've tried so many combinations, but every time I have &quot;AuthType
</I>&gt;<i> Basic/Require valid-user&quot; set, the browser pops up the login dialog box but
</I>&gt;<i> I want
</I>&gt;<i> &quot;html form login/authentication&quot;
</I>
Try setting:

  AuthBasicAuthoritative Off

in Apache configuration.

But then, if you aren't setting AuthType to be Basic, this shouldn't
be an issue.

&gt;<i> req.user = &quot;nobody&quot; was set as a place holder because without it I get:
</I>&gt;<i> &#160; [ req-&gt;user is NULL. Assign something to req.user if returning OK to avoid
</I>&gt;<i> this error ]
</I>
Even as a place holder, didn't need to be set in all cases and could
cause an issue if there were multiple authentication handlers being
executed.

&gt;<i> I've just tried the following:
</I>&gt;<i> AuthType session
</I>&gt;<i> AuthName &quot;members&quot;
</I>&gt;<i> Require valid-session
</I>
The Require isn't much point if you haven't written an authorization
handler that understands valid-session.

&gt;<i> ...and it works......but only if I &quot;set req.user = nobody&quot; as a temp place
</I>&gt;<i> holder...or I get the req-&gt;user is NULL error
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I'll admit I don't have a clue....I got this far by trial and error, which
</I>&gt;<i> is not very efficient.....I'm waiting for your book ...hint hint :))
</I>
I will not be writing a book on mod_python. IMHO mod_python is dying
and the quicker people stop using it and shift to WSGI based Python
web applications the better.

The only problem in saying that is the alternatives don't support
writing Apache input/output filters nor custom session based
authetication/authorisation schemes that cover multiple applications.
The latter though will be supported in Apache 2.4 though through
mod_session, so no need to be fiddling within using mod_python at that
point. You could also right now just use:

  <A HREF="http://www.openfusion.com.au/labs/mod_auth_tkt/">http://www.openfusion.com.au/labs/mod_auth_tkt/</A>

&gt;<i> Is there a secret to prevent the &quot;browser password pop-up box&quot; and redirect
</I>&gt;<i> to a html login page? I've spent 3 months
</I>&gt;<i> googling and can't find a simple example.
</I>
For a working form/session based authentication handler, that is that
I presume it still works, see:

  <A HREF="http://www.modpython.org/pipermail/mod_python/2006-May/021172.html">http://www.modpython.org/pipermail/mod_python/2006-May/021172.html</A>

The correct attachment address is:

  <A HREF="http://www.modpython.org/pipermail/mod_python/attachments/20060520/813620d0/sessionmanager.tar.gz">http://www.modpython.org/pipermail/mod_python/attachments/20060520/813620d0/sessionmanager.tar.gz</A>

See the .htaccess file as to how it all ties together. The _session.py
file is also extensively documented.

Graham

&gt;<i>
</I>&gt;<i> Thanks again
</I>&gt;<i> Bruce
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Sun, Mar 29, 2009 at 11:23 PM, Graham Dumpleton
</I>&gt;<i> &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">graham.dumpleton at gmail.com</A>&gt; wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 2009/3/29 bruce bushby &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">bruce.bushby at googlemail.com</A>&gt;:
</I>&gt;&gt;<i> &gt; Hi
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; I've been struggling to implement form based user authentication for
</I>&gt;&gt;<i> &gt; some
</I>&gt;&gt;<i> &gt; time now so I'm posting my progress in the hope that
</I>&gt;&gt;<i> &gt; more experienced members will comment and any new starters will save
</I>&gt;&gt;<i> &gt; themselves some time.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; A big thanks to John Calixto for getting back to me and suggesting
</I>&gt;&gt;<i> &gt; &quot;AuthType
</I>&gt;&gt;<i> &gt; wgtiauth&quot; and &quot;Require wgti-user&quot;
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; The example works as follows:
</I>&gt;&gt;<i> &gt; - Attempt to access the protected area gets intercepted by
</I>&gt;&gt;<i> &gt; authenhandler, if
</I>&gt;&gt;<i> &gt; not authorized redirect to login, if login successful, continue to
</I>&gt;&gt;<i> &gt; original
</I>&gt;&gt;<i> &gt; url.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; ...
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; def authenhandler(req):
</I>&gt;&gt;<i> &gt; &#160;&#160;&#160;&#160;&#160;&#160;&#160; req.user = &quot;nobody&quot;
</I>&gt;&gt;<i> &gt; &#160;&#160;&#160;&#160;&#160;&#160;&#160; req.session = Session.DbmSession(req)
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; &#160;&#160;&#160;&#160;&#160;&#160;&#160; if req.session.is_new():
</I>&gt;&gt;<i> &gt; &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; req.session['referer'] = &quot;<A HREF="http://mysite&quot;">http://mysite&quot;</A> +
</I>&gt;&gt;<i> &gt; req.unparsed_uri
</I>&gt;&gt;<i> &gt; &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; req.session.save()
</I>&gt;&gt;<i> &gt; &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; util.redirect(req,&quot;<A HREF="http://mysite/login&quot;">http://mysite/login&quot;</A>)
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; &#160;&#160;&#160;&#160;&#160;&#160;&#160; if req.session.has_key('authstatus') and
</I>&gt;&gt;<i> &gt; req.session['authstatus']
</I>&gt;&gt;<i> &gt; == &quot;authenticated&quot;:
</I>&gt;&gt;<i> &gt; &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; return apache.OK
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; &#160;&#160;&#160;&#160;&#160;&#160;&#160; return apache.HTTP_UNAUTHORIZED
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Technically this is incorrect/incomplete.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 1. An authentication handler should be checking whether it is the
</I>&gt;&gt;<i> handler that should run for the AuthType used. Thus should have the
</I>&gt;&gt;<i> following check as first thing done:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &#160;if req.auth_type() != 'wgtiauth':
</I>&gt;&gt;<i> &#160; &#160;return apache.DECLINED
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 2. If the authentication handler successfully authenticated user, only
</I>&gt;&gt;<i> then should it be setting req.user. It should not be doing it all the
</I>&gt;&gt;<i> time even if authentication failed. It is not technically a good idea
</I>&gt;&gt;<i> to be setting it to 'nobody' and it should really be the actual user
</I>&gt;&gt;<i> name. That way you can then use other Apache directives such as
</I>&gt;&gt;<i> 'Require user'.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 3. If the authentication handler was successful, it should be setting
</I>&gt;&gt;<i> req.ap_auth_type to be the authentication type.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &#160;req.ap_auth_type = req.auth_type()
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &gt; def authzhandler(req):
</I>&gt;&gt;<i> &gt; &#160;&#160;&#160;&#160;&#160;&#160;&#160; if req.user:
</I>&gt;&gt;<i> &gt; &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; return apache.OK
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; &#160;&#160;&#160;&#160;&#160;&#160;&#160; return apache.HTTP_UNAUTHORIZED
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Your whole authorisation handler is not needed, so get rid of:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;Require wgti-user
</I>&gt;&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;PythonAuthzHandler authsession
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> and replace it with:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;Require valid-user
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> As I said before though, you should only be setting req.user if user
</I>&gt;&gt;<i> authenticated properly.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Graham
</I>&gt;<i>
</I>&gt;<i>
</I>
</PRE>





















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026121.html">[mod_python] mod_python session/form based user authentication
</A></li>
	<LI>Next message: <A HREF="026140.html">[mod_python] mod_python session/form based user authentication
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26122">[ date ]</a>
              <a href="thread.html#26122">[ thread ]</a>
              <a href="subject.html#26122">[ subject ]</a>
              <a href="author.html#26122">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
