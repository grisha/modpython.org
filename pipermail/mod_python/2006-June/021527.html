<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Problem with Mod Python Appending HTML
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Problem%20with%20Mod%20Python%20Appending%20HTML&In-Reply-To=1151621615.22773.8.camel%40localhost">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021525.html">
   <LINK REL="Next"  HREF="021519.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Problem with Mod Python Appending HTML</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Jim Gallacher</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Problem%20with%20Mod%20Python%20Appending%20HTML&In-Reply-To=1151621615.22773.8.camel%40localhost"
       TITLE="[mod_python] Problem with Mod Python Appending HTML">jpg at jgassociates.ca
       </A><BR>
    <I>Thu Jun 29 19:39:53 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="021525.html">[mod_python] Problem with Mod Python Appending HTML
</A></li>
        <LI>Next message: <A HREF="021519.html">[mod_python] &quot;Internal Server Error&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21527">[ date ]</a>
              <a href="thread.html#21527">[ thread ]</a>
              <a href="subject.html#21527">[ subject ]</a>
              <a href="author.html#21527">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Max Luebbe wrote:
&gt;<i> I think I understand what you are talking about but still can't get what
</I>&gt;<i> I'm looking for to work. When I use apache.DONE instead of apache.OK, no
</I>&gt;<i> further html is generated,
</I>
But isn't that precisely the problem you are trying to solve?

&gt;<i> and when I submit the form created by the
</I>&gt;<i> displayAccountOptions function, it redisplays the same page, just
</I>&gt;<i> without any css to make it look presentable. This is also not
</I>&gt;<i> acceptable.
</I>
My guess is you are using relative urls for your form action and
stylesheet. Check your apache access log and check what is actually
being requested. My guess is you'll see something like
GET /some/directory/yourscript.py/commitChanges/yourstylesheet.css
but what you really want is /some/directory/yourstylesheet.css.


&gt;<i> This is an authenhandler
</I>&gt;<i> Here's a cut version of the code:
</I>&gt;<i> 
</I>&gt;<i> def authenhandler(req):
</I>&gt;<i> 	'''Point of entry for this script.'''
</I>&gt;<i> 
</I>&gt;<i> 	# Get Authentication information from the user
</I>&gt;<i> 	password = req.get_basic_auth_pw()
</I>&gt;<i> 	user = req.user
</I>&gt;<i> 
</I>&gt;<i> 	# Check user info against the database
</I>&gt;<i> 	db = anydbm.open(accountsDBPath, 'r')
</I>&gt;<i> 	if not db.has_key(user):
</I>&gt;<i> 		return apache.HTTP_UNAUTHORIZED
</I>&gt;<i> 	else:
</I>&gt;<i> 		record = db[user]
</I>&gt;<i> 		# Decode entry
</I>&gt;<i> 		initRecord = RECORD_SIZE * ['0']
</I>&gt;<i> 		data = eval(db.setdefault(user, initRecord)) 
</I>&gt;<i> 		# Check Password
</I>&gt;<i> 		if not password == data[PASSWORD_HASH]:
</I>&gt;<i> 			db.close()
</I>&gt;<i> 			return apache.HTTP_UNAUTHORIZED
</I>&gt;<i> 
</I>&gt;<i> 		# User is authorized!
</I>&gt;<i> 		record = {}
</I>&gt;<i> 		record['loginName'] = user
</I>&gt;<i> 		record['firstName'] = data[FIRST_NAME]
</I>&gt;<i> 		record['lastName'] = data[LAST_NAME]
</I>&gt;<i> 		record['forwardingAddress'] = data[FORWARDING_ADDRESS]
</I>&gt;<i> 
</I>&gt;<i> 		db.close()
</I>&gt;<i> 		displayAccountOptions(req,user,record)
</I>&gt;<i> 		return apache.OK
</I>&gt;<i> 
</I>&gt;<i> displayAccountOptions displays an html form that posts to another
</I>&gt;<i> function called commitChanges, that displays additional html.
</I>&gt;<i> 
</I>&gt;<i> The html produced by commitChanges is getting appended to the html
</I>&gt;<i> generated by displayAccountOptions, which is what not what I want.
</I>&gt;<i> 
</I>&gt;<i> Does this clarify things?
</I>
Not really. ;)

&gt;<i> Would I be better served by just implementing my own password system for
</I>&gt;<i> accessing my database (using password fields in a form) instead of using
</I>&gt;<i> the authentication methods? 
</I>
I'd leave your auth code in the authenhandler, but move
displayAccountOptions into your request handler as I don't see that it
is actually required for authentication.

    req.record = {}
    req.record['loginName'] = user
    req.record['firstName'] = data[FIRST_NAME]
    req.record['lastName'] = data[LAST_NAME]
    req.record['forwardingAddress'] = data[FORWARDING_ADDRESS]

That way the db record is available for the request handler. I don't see
what handler you are using, but if it's publisher you could then have
separate methods for displayAccountOptions and commitChanges.

Jim

&gt;<i> On Wed, 2006-06-28 at 18:30 -0400, Graham Dumpleton wrote:
</I>&gt;&gt;<i> Max Luebbe wrote ..
</I>&gt;&gt;&gt;<i> I am having problems with my mod_python scripts appending HTML together,
</I>&gt;&gt;&gt;<i> when having req.write() create a new page is what I am after.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I have an authentication handler for a blank html page that queries a
</I>&gt;&gt;&gt;<i> database for a user/pass, and then generates HTML based off of who
</I>&gt;&gt;&gt;<i> logged in.
</I>&gt;&gt;<i> When you say you have a &quot;authentication handler&quot;, do you mean that it
</I>&gt;&gt;<i> is triggered by PythonAuthenHandler directive. If it is and you are returning
</I>&gt;&gt;<i> HTML from it and it represents the complete response for the request,
</I>&gt;&gt;<i> you must return apache.DONE and not apache.OK. If you do not return
</I>&gt;&gt;<i> apache.DONE, the content handler will still be executed and thus any
</I>&gt;&gt;<i> HTML that the content handler itself generates will be appended to the
</I>&gt;&gt;<i> result.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The only other time you would likely see HTML from two places being
</I>&gt;&gt;<i> concatenated together, is when you are generating HTML but then returning
</I>&gt;&gt;<i> an error status such as apache.HTTP_UNAUTHORIZED. In other words, 
</I>&gt;&gt;<i> you were wanting to generate a custom error response page. If you simply
</I>&gt;&gt;<i> return apache.HTTP_UNAUTHORIZED in that situation, then Apache will
</I>&gt;&gt;<i> still go on to generate an error document page which gets appended to
</I>&gt;&gt;<i> your output. In that situation you should instead use:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   req.status = apache.HTTP_UNAUTHORIZED
</I>&gt;&gt;<i>   # generate HTML
</I>&gt;&gt;<i>   return apache.OK
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> If this is a handler other than PythonHandler, again, you should be
</I>&gt;&gt;<i> returning apache.DONE and not apache.OK.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I would suggest that you post what your Apache configuration directives
</I>&gt;&gt;<i> are so it is clear what handlers are being executed and in what phases.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Show a cut done version of what your handlers are doing would also
</I>&gt;&gt;<i> be helpful.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Graham
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> The HTML generated is a form, and the user information is used to
</I>&gt;&gt;&gt;<i> populate the default values. When the user submits the form, and my
</I>&gt;&gt;&gt;<i> formHandler is called, the HTML it generates is appended to the current
</I>&gt;&gt;&gt;<i> page, instead of starting a new one. I have &lt;html&gt; and &lt;/html&gt; tags at
</I>&gt;&gt;&gt;<i> the appropriate places to mark where documents are starting and
</I>&gt;&gt;&gt;<i> stopping.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I did not have this problem on any of the other pages/scripts I have
</I>&gt;&gt;&gt;<i> written, and I think that adding authentication into the mix is the
</I>&gt;&gt;&gt;<i> variable in the equation.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> What I am after is the following sequence:
</I>&gt;&gt;&gt;<i> (1) user login 
</I>&gt;&gt;&gt;<i> (2) new page w/form with default fields grabbed from db (generated html)
</I>&gt;&gt;&gt;<i> (3) another new page w/confirmation info (values and corrections from
</I>&gt;&gt;&gt;<i> form) (generated html)
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Any suggestions?
</I>&gt;&gt;&gt;<i> I would greatly appreciate any help I could get.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> -- 
</I>&gt;&gt;&gt;<i> Max Luebbe &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">max.luebbe at gmail.com</A>&gt;
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;<i> Mod_python mailing list
</I>&gt;&gt;&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;&gt;&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021525.html">[mod_python] Problem with Mod Python Appending HTML
</A></li>
	<LI>Next message: <A HREF="021519.html">[mod_python] &quot;Internal Server Error&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21527">[ date ]</a>
              <a href="thread.html#21527">[ thread ]</a>
              <a href="subject.html#21527">[ subject ]</a>
              <a href="author.html#21527">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
