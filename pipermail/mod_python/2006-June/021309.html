<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] erratic import errors with mod_python
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20erratic%20import%20errors%20with%20mod_python&In-Reply-To=20060603183600.GA13085%40ling.osu.edu">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021306.html">
   <LINK REL="Next"  HREF="021310.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] erratic import errors with mod_python</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Jim Gallacher</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20erratic%20import%20errors%20with%20mod_python&In-Reply-To=20060603183600.GA13085%40ling.osu.edu"
       TITLE="[mod_python] erratic import errors with mod_python">jpg at jgassociates.ca
       </A><BR>
    <I>Sun Jun  4 10:18:53 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="021306.html">[mod_python] erratic import errors with mod_python
</A></li>
        <LI>Next message: <A HREF="021310.html">[mod_python] Destructors called more than Constructors
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21309">[ date ]</a>
              <a href="thread.html#21309">[ thread ]</a>
              <a href="subject.html#21309">[ subject ]</a>
              <a href="author.html#21309">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Detmar Meurers wrote:
&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> I'm using mod_python's publisher handler to load a .py file using
</I>&gt;<i> the usual
</I>&gt;<i> 
</I>&gt;<i> AddHandler python-program .py
</I>&gt;<i> PythonHandler mod_python.publisher
</I>&gt;<i> PythonDebug On
</I>&gt;<i> 
</I>&gt;<i> .htaccess specification in the directory in which the .py file
</I>&gt;<i> resides. That .py file imports some other modules, both standard ones
</I>&gt;<i> and some auxiliary functions I wrote and put into a separate file.
</I>&gt;<i> 
</I>&gt;<i> Usually the code executes fine, but every five or so times the page
</I>&gt;<i> is loaded (without changing anything, e.g. just doing several
</I>&gt;<i> reloads in a row), I get the error that mod_python for some reason
</I>&gt;<i> cannot find one of the modules that is being imported (namely the
</I>&gt;<i> file with the auxiliary functions, called tagarela_util.py, which is
</I>&gt;<i> in the same directory). I'm including an example error message
</I>&gt;<i> below.
</I>&gt;<i> 
</I>&gt;<i> This error never seems to appear for the standard modules I import,
</I>&gt;<i> (or when I put that file into the python2.4/site-packages which is 
</I>&gt;<i> in sys.path), so I suspect that it has something to do with the way
</I>&gt;<i> mod_python seems to use the .htaccess files to determine which
</I>&gt;<i> directory to add to the sys.path?
</I>&gt;<i> 
</I>&gt;<i> I very much hope someone can explain this erratic behavior and how I
</I>&gt;<i> can fix it - as it stands the only way I found to avoid these
</I>&gt;<i> occasional errors arising when importing modules is to put
</I>&gt;<i> everything into the same file, i.e. to avoid importing modules,
</I>&gt;<i> which naturally leads to massive code duplication and
</I>&gt;<i> non-modularity.
</I>&gt;<i> 
</I>&gt;<i> Any suggestions would be much appreciated!
</I>&gt;<i> 
</I>&gt;<i> Best,
</I>&gt;<i> Detmar
</I>&gt;<i> 
</I>&gt;<i> --
</I>&gt;<i> Detmar Meurers, Associate Professor, Dept. of Linguistics, OSU
</I>&gt;<i> 201a Oxley Hall, 1712 Neil Avenue, Columbus OH 43210-1298, USA
</I>&gt;<i> <A HREF="http://ling.osu.edu/~dm/">http://ling.osu.edu/~dm/</A>                 GnuPG key on web page
</I>&gt;<i> 
</I>&gt;<i> ****Server used:
</I>&gt;<i> 
</I>&gt;<i> 'SERVER_SOFTWARE': 'Apache/2.2.0 (Unix) mod_ssl/2.2.0 OpenSSL/0.9.8a DAV/2 mod_python/3.2.8 Python/2.4.2'
</I>&gt;<i> 
</I>&gt;<i> (Errors appears with a variety of browsers, so seems to be independent
</I>&gt;<i> of that.) 
</I>&gt;<i> 
</I>&gt;<i> ****Error message:
</I>&gt;<i> 
</I>&gt;<i> Mod_python error: &quot;PythonHandler mod_python.publisher&quot;
</I>&gt;<i> 
</I>&gt;<i> Traceback (most recent call last):
</I>&gt;<i> 
</I>&gt;<i>   File &quot;/opt/local/lib/python2.4/site-packages/mod_python/apache.py&quot;, line 299, in HandlerDispatch
</I>&gt;<i>     result = object(req)
</I>&gt;<i> 
</I>&gt;<i>   File &quot;/opt/local/lib/python2.4/site-packages/mod_python/publisher.py&quot;, line 204, in handler
</I>&gt;<i>     module = page_cache[req]
</I>&gt;<i> 
</I>&gt;<i>   File &quot;/opt/local/lib/python2.4/site-packages/mod_python/cache.py&quot;, line 82, in __getitem__
</I>&gt;<i>     return self._checkitem(name)[2]
</I>&gt;<i> 
</I>&gt;<i>   File &quot;/opt/local/lib/python2.4/site-packages/mod_python/cache.py&quot;, line 124, in _checkitem
</I>&gt;<i>     value = self.build(key, name, opened, entry)
</I>&gt;<i> 
</I>&gt;<i>   File &quot;/opt/local/lib/python2.4/site-packages/mod_python/publisher.py&quot;, line 77, in build
</I>&gt;<i>     return ModuleCache.build(self, key, req, opened, entry)
</I>&gt;<i> 
</I>&gt;<i>   File &quot;/opt/local/lib/python2.4/site-packages/mod_python/cache.py&quot;, line 371, in build
</I>&gt;<i>     exec opened in module.__dict__
</I>&gt;<i> 
</I>&gt;<i>   File &quot;/home/dm/public_html/icall/tagarela/activities/Reading/index.py&quot;, line 3, in ?
</I>&gt;<i>     from tagarela_util import _get_session, _file2string
</I>&gt;<i> 
</I>&gt;<i> ImportError: No module named tagarela_util
</I>
Is it possible that targarel_util is being imported by the standard 
python import statement, as well as by publisher? The importer is being 
revamped for 3.3 and will hopefully take care of this sort of problem, 
but I think the best plan is to move your util files outside of the 
document tree. Use PythonPath &quot;['/path/to/your/utils'] + sys.path&quot; and a 
standard &quot;import targarela_util&quot;. The drawback here is that these 
modules won't get re-imported if they change, necessitating an Apache 
restart. In practice I don't find this to be a huge burden since my 
support files seldom change on the production machine.

Jim



</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021306.html">[mod_python] erratic import errors with mod_python
</A></li>
	<LI>Next message: <A HREF="021310.html">[mod_python] Destructors called more than Constructors
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21309">[ date ]</a>
              <a href="thread.html#21309">[ thread ]</a>
              <a href="subject.html#21309">[ subject ]</a>
              <a href="author.html#21309">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
