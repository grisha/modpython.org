<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Problem with Mod Python Appending HTML
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Problem%20with%20Mod%20Python%20Appending%20HTML&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021524.html">
   <LINK REL="Next"  HREF="021528.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Problem with Mod Python Appending HTML</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Problem%20with%20Mod%20Python%20Appending%20HTML&In-Reply-To="
       TITLE="[mod_python] Problem with Mod Python Appending HTML">grahamd at dscpl.com.au
       </A><BR>
    <I>Thu Jun 29 19:24:46 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="021524.html">[mod_python] COM errors on Win2K3
</A></li>
        <LI>Next message: <A HREF="021528.html">[Fwd: Re: [mod_python] Re: Mike's psp upload]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21526">[ date ]</a>
              <a href="thread.html#21526">[ thread ]</a>
              <a href="subject.html#21526">[ subject ]</a>
              <a href="author.html#21526">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Max Luebbe wrote ..
&gt;<i> I think I understand what you are talking about but still can't get what
</I>&gt;<i> I'm looking for to work. When I use apache.DONE instead of apache.OK, no
</I>&gt;<i> further html is generated, and when I submit the form created by the
</I>&gt;<i> displayAccountOptions function, it redisplays the same page, just
</I>&gt;<i> without any css to make it look presentable. This is also not
</I>&gt;<i> acceptable.
</I>&gt;<i> 
</I>&gt;<i> This is an authenhandler
</I>&gt;<i> Here's a cut version of the code:
</I>&gt;<i> 
</I>&gt;<i> def authenhandler(req):
</I>&gt;<i> 	'''Point of entry for this script.'''
</I>&gt;<i> 
</I>&gt;<i> 	# Get Authentication information from the user
</I>&gt;<i> 	password = req.get_basic_auth_pw()
</I>&gt;<i> 	user = req.user
</I>&gt;<i> 
</I>&gt;<i> 	# Check user info against the database
</I>&gt;<i> 	db = anydbm.open(accountsDBPath, 'r')
</I>&gt;<i> 	if not db.has_key(user):
</I>&gt;<i> 		return apache.HTTP_UNAUTHORIZED
</I>&gt;<i> 	else:
</I>&gt;<i> 		record = db[user]
</I>&gt;<i> 		# Decode entry
</I>&gt;<i> 		initRecord = RECORD_SIZE * ['0']
</I>&gt;<i> 		data = eval(db.setdefault(user, initRecord)) 
</I>&gt;<i> 		# Check Password
</I>&gt;<i> 		if not password == data[PASSWORD_HASH]:
</I>&gt;<i> 			db.close()
</I>&gt;<i> 			return apache.HTTP_UNAUTHORIZED
</I>&gt;<i> 
</I>&gt;<i> 		# User is authorized!
</I>&gt;<i> 		record = {}
</I>&gt;<i> 		record['loginName'] = user
</I>&gt;<i> 		record['firstName'] = data[FIRST_NAME]
</I>&gt;<i> 		record['lastName'] = data[LAST_NAME]
</I>&gt;<i> 		record['forwardingAddress'] = data[FORWARDING_ADDRESS]
</I>&gt;<i> 
</I>&gt;<i> 		db.close()
</I>&gt;<i> 		displayAccountOptions(req,user,record)
</I>&gt;<i> 		return apache.OK
</I>&gt;<i> 
</I>&gt;<i> displayAccountOptions displays an html form that posts to another
</I>&gt;<i> function called commitChanges, that displays additional html.
</I>&gt;<i> 
</I>&gt;<i> The html produced by commitChanges is getting appended to the html
</I>&gt;<i> generated by displayAccountOptions, which is what not what I want.
</I>&gt;<i> 
</I>&gt;<i> Does this clarify things?
</I>
Not entirely.

&gt;<i> Would I be better served by just implementing my own password system for
</I>&gt;<i> accessing my database (using password fields in a form) instead of using
</I>&gt;<i> the authentication methods? 
</I>
First off, use of basic authentication is not intrinsically linked with
authenhandler in the sense that form/session based authentication
mechanisms can still use an authenhandler, although having not
yet available mod_python 3.3 helps. :-)

That said, my main comment is that when using basic authentication
as you are, one would not generally be generating a HTML page from the
authenhandler. Instead the authenhandler would simply be verifying
the user has appropriate access privileges and then the content handler
for whatever URL was requested would be executed to deliver up the
actual response. Thus I don't understand what you are trying to do by
way of highjacking the normal process by which URLs match to handlers
in order to produce some special account options page when the
user credentials are accepted.

If what you are trying to do is recognise the first time a user requests
access for a session that they be sent to a special page, then what
would normally be done is to issue a redirect response to send them
to that other page. That other page would then perhaps provide a
link to allow them then to get back to the page they wanted. To do
all this though would required use of sessions for it to work properly
as you need to retain some state so you know when first access occurs
and what page user should be sent back to after reviewing their
account options page.

Thus I think the general approach you are using is possibly the
wrong way of going about it anyway. As to you actual problem
of concatenated HTML, can tell from the above and really need to
see what displayAccountOptions() and commitChanges() are doing.

Graham

&gt;<i> On Wed, 2006-06-28 at 18:30 -0400, Graham Dumpleton wrote:
</I>&gt;<i> &gt; Max Luebbe wrote ..
</I>&gt;<i> &gt; &gt; I am having problems with my mod_python scripts appending HTML together,
</I>&gt;<i> &gt; &gt; when having req.write() create a new page is what I am after.
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; &gt; I have an authentication handler for a blank html page that queries
</I>&gt;<i> a
</I>&gt;<i> &gt; &gt; database for a user/pass, and then generates HTML based off of who
</I>&gt;<i> &gt; &gt; logged in.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; When you say you have a &quot;authentication handler&quot;, do you mean that it
</I>&gt;<i> &gt; is triggered by PythonAuthenHandler directive. If it is and you are returning
</I>&gt;<i> &gt; HTML from it and it represents the complete response for the request,
</I>&gt;<i> &gt; you must return apache.DONE and not apache.OK. If you do not return
</I>&gt;<i> &gt; apache.DONE, the content handler will still be executed and thus any
</I>&gt;<i> &gt; HTML that the content handler itself generates will be appended to the
</I>&gt;<i> &gt; result.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; The only other time you would likely see HTML from two places being
</I>&gt;<i> &gt; concatenated together, is when you are generating HTML but then returning
</I>&gt;<i> &gt; an error status such as apache.HTTP_UNAUTHORIZED. In other words, 
</I>&gt;<i> &gt; you were wanting to generate a custom error response page. If you simply
</I>&gt;<i> &gt; return apache.HTTP_UNAUTHORIZED in that situation, then Apache will
</I>&gt;<i> &gt; still go on to generate an error document page which gets appended to
</I>&gt;<i> &gt; your output. In that situation you should instead use:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt;   req.status = apache.HTTP_UNAUTHORIZED
</I>&gt;<i> &gt;   # generate HTML
</I>&gt;<i> &gt;   return apache.OK
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; If this is a handler other than PythonHandler, again, you should be
</I>&gt;<i> &gt; returning apache.DONE and not apache.OK.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; I would suggest that you post what your Apache configuration directives
</I>&gt;<i> &gt; are so it is clear what handlers are being executed and in what phases.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Show a cut done version of what your handlers are doing would also
</I>&gt;<i> &gt; be helpful.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Graham
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; &gt; The HTML generated is a form, and the user information is used to
</I>&gt;<i> &gt; &gt; populate the default values. When the user submits the form, and my
</I>&gt;<i> &gt; &gt; formHandler is called, the HTML it generates is appended to the current
</I>&gt;<i> &gt; &gt; page, instead of starting a new one. I have &lt;html&gt; and &lt;/html&gt; tags
</I>&gt;<i> at
</I>&gt;<i> &gt; &gt; the appropriate places to mark where documents are starting and
</I>&gt;<i> &gt; &gt; stopping.
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; &gt; I did not have this problem on any of the other pages/scripts I have
</I>&gt;<i> &gt; &gt; written, and I think that adding authentication into the mix is the
</I>&gt;<i> &gt; &gt; variable in the equation.
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; &gt; What I am after is the following sequence:
</I>&gt;<i> &gt; &gt; (1) user login 
</I>&gt;<i> &gt; &gt; (2) new page w/form with default fields grabbed from db (generated
</I>&gt;<i> html)
</I>&gt;<i> &gt; &gt; (3) another new page w/confirmation info (values and corrections from
</I>&gt;<i> &gt; &gt; form) (generated html)
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; &gt; Any suggestions?
</I>&gt;<i> &gt; &gt; I would greatly appreciate any help I could get.
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; &gt; -- 
</I>&gt;<i> &gt; &gt; Max Luebbe &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">max.luebbe at gmail.com</A>&gt;
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; &gt; _______________________________________________
</I>&gt;<i> &gt; &gt; Mod_python mailing list
</I>&gt;<i> &gt; &gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> &gt; &gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i> -- 
</I>&gt;<i> Max Luebbe &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">max.luebbe at gmail.com</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I></PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021524.html">[mod_python] COM errors on Win2K3
</A></li>
	<LI>Next message: <A HREF="021528.html">[Fwd: Re: [mod_python] Re: Mike's psp upload]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21526">[ date ]</a>
              <a href="thread.html#21526">[ thread ]</a>
              <a href="subject.html#21526">[ subject ]</a>
              <a href="author.html#21526">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
