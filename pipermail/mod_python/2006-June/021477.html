<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Seg Fault when using session object
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Seg%20Fault%20when%20using%20session%20object&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021476.html">
   <LINK REL="Next"  HREF="021478.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Seg Fault when using session object</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Seg%20Fault%20when%20using%20session%20object&In-Reply-To="
       TITLE="[mod_python] Seg Fault when using session object">grahamd at dscpl.com.au
       </A><BR>
    <I>Sun Jun 25 20:13:38 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="021476.html">[mod_python] Seg Fault when using session object
</A></li>
        <LI>Next message: <A HREF="021478.html">[mod_python] Seg Fault when using session object
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21477">[ date ]</a>
              <a href="thread.html#21477">[ thread ]</a>
              <a href="subject.html#21477">[ subject ]</a>
              <a href="author.html#21477">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Emlyn Jones wrote ..
&gt;<i> Hello,
</I>&gt;<i> I've got this simple piece of mod_python/psp; If I uncomment the foo=session
</I>&gt;<i> line I get a seg fault. Has anyone seen this before and can direct me towards
</I>&gt;<i> finding out what the problem is please?
</I>&gt;<i> I'm running Apache/2.0.50, mod_python 3.2.8 and Python 2.4.
</I>&gt;<i> I've confirmed that it isn't the known expat and mysql/php problems.
</I>&gt;<i> 
</I>&gt;<i> &lt;%
</I>&gt;<i> #foo = session
</I>&gt;<i> done_login = False
</I>&gt;<i> if(form.has_key(&quot;username&quot;)):
</I>&gt;<i> 	username = form[&quot;username&quot;]
</I>&gt;<i> 	password = form[&quot;password&quot;]
</I>&gt;<i> 	req.write(&quot;%s&quot; % (username,))
</I>&gt;<i> %&gt;
</I>
What PSP does is that if it sees that the variable &quot;session&quot; is referenced
from inside of PSP code, then it will do what is necessary to create the
session, or if the session already exists, it will retrieve it from the 
session database.

Two problems could be occurring here. The first is that if this is occurring
on the very first time the session needs to be created, that the session
database it tries to use is corrupt in some way and therefore crashing.
The second is that the session already exists in the database, but something
was stored in the session object that probably shouldn't have and when the
session object is being restored, it is triggering some code (possibly C
code) which is then subsequently crashing.

First thing you need to do is get out of PSP and write a simple handler that
creates a session object just to validate that sessions work and that the
session database is okay. Use a handler such as:

  from mod_python import Session
  from mod_python import apache

  def handler(req):
    session = Session.Session(req)
    session['data'] = 1
    session.save()
    req.content_type = 'text/plain'
    req.write('hello')
    return apache .OK

If this dies, then there is possibly a problem with the session
database, or your Python DBM modules are stuffed somehow. You need to
work out what type of session database is being used. It will probably
be DBM database and it will be stored in &quot;/tmp&quot; as &quot;/tmp/mp_sess.dbm&quot;. I
am guessing you aren't on Win32 as in that case an in memory session
database is being used and it would be almost impossible to crash. Which
is might be is dictated by the MPM which Apache was configured with.

Assuming it is DBM, check who owns the database in &quot;/tmp&quot;. The owner
should match the user that Apache runs as. If you have multiple versions
of Apache running and they run as different users, you could have problems
because of that. If it is the wrong user and you only have one Apache
instance, you could try deleting the database and restarting Apache.
If you have multiple versions of Apache running as different users, you
may have to use PythonOption to change location where session database
is stored. See documentation for mod_python.

If this is all okay, may be what you are storing in the session object. This
is where you need to show your code as to what you are sticking in the
session object before we can really comment. Also read:

  <A HREF="http://www.dscpl.com.au/articles/modpython-005.html">http://www.dscpl.com.au/articles/modpython-005.html</A>

Graham


</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021476.html">[mod_python] Seg Fault when using session object
</A></li>
	<LI>Next message: <A HREF="021478.html">[mod_python] Seg Fault when using session object
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21477">[ date ]</a>
              <a href="thread.html#21477">[ thread ]</a>
              <a href="subject.html#21477">[ subject ]</a>
              <a href="author.html#21477">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
