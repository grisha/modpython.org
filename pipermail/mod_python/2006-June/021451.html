<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] File Sessions security problem?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20File%20Sessions%20security%20problem%3F&In-Reply-To=1150929078.380%40dscpl.user.openhosting.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021449.html">
   <LINK REL="Next"  HREF="021450.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] File Sessions security problem?</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Jim Gallacher</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20File%20Sessions%20security%20problem%3F&In-Reply-To=1150929078.380%40dscpl.user.openhosting.com"
       TITLE="[mod_python] File Sessions security problem?">jpg at jgassociates.ca
       </A><BR>
    <I>Thu Jun 22 08:47:54 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="021449.html">[mod_python] File Sessions security problem?
</A></li>
        <LI>Next message: <A HREF="021450.html">[mod_python] CAPCHA
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21451">[ date ]</a>
              <a href="thread.html#21451">[ thread ]</a>
              <a href="subject.html#21451">[ subject ]</a>
              <a href="author.html#21451">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Graham Dumpleton wrote:
&gt;<i> marinus van aswegen wrote ..
</I>&gt;&gt;<i> Hi
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I have been playing with mod_python (ubuntu std, breezy build) and I
</I>&gt;&gt;<i> noticed that the sessions db is stored in the /tmp dir with
</I>&gt;&gt;<i> permissions that will permit any user to read the file. I'm not to
</I>&gt;&gt;<i> happy with this since I store some very sensitive info in the session
</I>&gt;&gt;<i> object.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> It's easy to chmod it, but perhaps it would be better to create the
</I>&gt;&gt;<i> file with more restrictive permissions?
</I>&gt;<i> 
</I>&gt;<i> The FileSession code uses file() to create the file. As such the file
</I>&gt;<i> permissions are dictated by the umask of the user that Apache runs as.
</I>&gt;<i> 
</I>&gt;<i> Unfortunately file() doesn't allow a more constrained umask to be
</I>&gt;<i> provided when creating a file and calling os.chmod() after the fact
</I>&gt;<i> still allows a window, albeit small, where things could be done with the
</I>&gt;<i> file.
</I>&gt;<i> 
</I>&gt;<i> Thus, the code should perhaps instead us os.open(). Thus something like:
</I>&gt;<i> 
</I>&gt;<i>   os.open(filename, os.O_RDWR | os.O_CREAT, 0600)
</I>&gt;<i> 
</I>&gt;<i> But then that returns a file descriptor ID and not a file like object
</I>&gt;<i> and it can't just be passed straight into cPickle.dump(), thus before
</I>&gt;<i> doing that, probably need to send it through os.fdopen() to create
</I>&gt;<i> a file like object.
</I>&gt;<i> 
</I>&gt;<i> Anyway, doing this would allow one to constrain the umask.
</I>
I think there may be some confusion here. Is Marinus referring to 
FileSession files, or the db file created by DbmSession?

In the case of FileSession, the individual files are arranged in a 
directory structure under the main session directory (mp_sess by 
default). Mp_sess and its subdirectories are created with mode 0750, so 
although the individual files may be world readable their parent 
directories are not.

The dbm file created by DbmSession is indeed created world readable. I 
actually thought this had been fixed early in 3.2, but the code does not 
lie - it's still using the default anydbm default mode. I'll fix this 
unless anyone can see a reason why we are currently not passing the file 
creation mode to the dbm open() call.

As a temporary workaround and you are using mod_python 3.2.8, you could use:

   PythonOption session_directory /path/to/some/directory

to specify the location where the db file is created, and set the 
permissions of /path/to/some/directory to 0700.

Jim
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021449.html">[mod_python] File Sessions security problem?
</A></li>
	<LI>Next message: <A HREF="021450.html">[mod_python] CAPCHA
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21451">[ date ]</a>
              <a href="thread.html#21451">[ thread ]</a>
              <a href="subject.html#21451">[ subject ]</a>
              <a href="author.html#21451">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
