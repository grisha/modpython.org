<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Tiny patch for better apr_stat usage in sendfile
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Tiny%20patch%20for%20better%20apr_stat%20usage%20in%20sendfile&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021342.html">
   <LINK REL="Next"  HREF="021331.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Tiny patch for better apr_stat usage in sendfile</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Tiny%20patch%20for%20better%20apr_stat%20usage%20in%20sendfile&In-Reply-To="
       TITLE="[mod_python] Tiny patch for better apr_stat usage in sendfile">grahamd at dscpl.com.au
       </A><BR>
    <I>Tue Jun  6 11:04:08 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="021342.html">[mod_python] running templates, was segmentation fault
</A></li>
        <LI>Next message: <A HREF="021331.html">[mod_python] Tiny patch for better apr_stat usage in sendfile
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21329">[ date ]</a>
              <a href="thread.html#21329">[ thread ]</a>
              <a href="subject.html#21329">[ subject ]</a>
              <a href="author.html#21329">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Sergey A. Lipnevich wrote ..
&gt;<i> Hi All,
</I>&gt;<i> 
</I>&gt;<i> I'd like to offer the following patch for 3.2.8's sendfile function that
</I>&gt;<i> asks APR to provide less information about a file (which is beneficial
</I>&gt;<i> on Windows as APR doesn't have to construct POSIX protection flags),
</I>&gt;<i> because the only field in use becomes file size. Incidentally, it also
</I>&gt;<i> allows mod_python (plus Apache 2.2 patch) to work with the following
</I>&gt;<i> tweak for APR 1.2.7 (required for Subversion), under Windows and Apache
</I>&gt;<i> 2.2.2: <A HREF="http://article.gmane.org/gmane.comp.apache.apr.devel/9389/.">http://article.gmane.org/gmane.comp.apache.apr.devel/9389/.</A>
</I>&gt;<i> 
</I>&gt;<i> I didn't test the patch on anything but Windows XP. The error I was
</I>&gt;<i> getting with the setup above was &quot;Could not stat file for reading.&quot;
</I>&gt;<i> I also have to mention that the whole thing was compiled with VS 2005
</I>&gt;<i> compiler to support Python 2.4, although I think it's not relevant for
</I>&gt;<i> the patch attached.
</I>&gt;<i> 
</I>&gt;<i> I hope all this patch citing is not too confusing :-).
</I>
Part of this patch may break UNIX systems. Specifically, when target is a
symbolic link, the size returned will be the length of the filename and
not the size of the target file when SIZE and not NORM is used. Thus
an incorrect amount of data is sent back.

Since I am on holidays I can't check into it any further at the moment.
If your truly believe there is a problem there to be fixed, log an issue
report on JIRA for mod_python to ensure it is addressed later.

  <A HREF="http://issues.apache.org/jira/browse/MODPYTHON">http://issues.apache.org/jira/browse/MODPYTHON</A>

Graham
</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021342.html">[mod_python] running templates, was segmentation fault
</A></li>
	<LI>Next message: <A HREF="021331.html">[mod_python] Tiny patch for better apr_stat usage in sendfile
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21329">[ date ]</a>
              <a href="thread.html#21329">[ thread ]</a>
              <a href="subject.html#21329">[ subject ]</a>
              <a href="author.html#21329">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
