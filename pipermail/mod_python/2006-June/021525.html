<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Problem with Mod Python Appending HTML
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Problem%20with%20Mod%20Python%20Appending%20HTML&In-Reply-To=1151533832.16981%40dscpl.user.openhosting.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021518.html">
   <LINK REL="Next"  HREF="021527.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Problem with Mod Python Appending HTML</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Max Luebbe</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Problem%20with%20Mod%20Python%20Appending%20HTML&In-Reply-To=1151533832.16981%40dscpl.user.openhosting.com"
       TITLE="[mod_python] Problem with Mod Python Appending HTML">max.luebbe at gmail.com
       </A><BR>
    <I>Thu Jun 29 18:53:35 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="021518.html">[mod_python] Problem with Mod Python Appending HTML
</A></li>
        <LI>Next message: <A HREF="021527.html">[mod_python] Problem with Mod Python Appending HTML
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21525">[ date ]</a>
              <a href="thread.html#21525">[ thread ]</a>
              <a href="subject.html#21525">[ subject ]</a>
              <a href="author.html#21525">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I think I understand what you are talking about but still can't get what
I'm looking for to work. When I use apache.DONE instead of apache.OK, no
further html is generated, and when I submit the form created by the
displayAccountOptions function, it redisplays the same page, just
without any css to make it look presentable. This is also not
acceptable.

This is an authenhandler
Here's a cut version of the code:

def authenhandler(req):
	'''Point of entry for this script.'''

	# Get Authentication information from the user
	password = req.get_basic_auth_pw()
	user = req.user

	# Check user info against the database
	db = anydbm.open(accountsDBPath, 'r')
	if not db.has_key(user):
		return apache.HTTP_UNAUTHORIZED
	else:
		record = db[user]
		# Decode entry
		initRecord = RECORD_SIZE * ['0']
		data = eval(db.setdefault(user, initRecord)) 
		# Check Password
		if not password == data[PASSWORD_HASH]:
			db.close()
			return apache.HTTP_UNAUTHORIZED

		# User is authorized!
		record = {}
		record['loginName'] = user
		record['firstName'] = data[FIRST_NAME]
		record['lastName'] = data[LAST_NAME]
		record['forwardingAddress'] = data[FORWARDING_ADDRESS]

		db.close()
		displayAccountOptions(req,user,record)
		return apache.OK

displayAccountOptions displays an html form that posts to another
function called commitChanges, that displays additional html.

The html produced by commitChanges is getting appended to the html
generated by displayAccountOptions, which is what not what I want.

Does this clarify things?

Would I be better served by just implementing my own password system for
accessing my database (using password fields in a form) instead of using
the authentication methods? 

On Wed, 2006-06-28 at 18:30 -0400, Graham Dumpleton wrote:
&gt;<i> Max Luebbe wrote ..
</I>&gt;<i> &gt; I am having problems with my mod_python scripts appending HTML together,
</I>&gt;<i> &gt; when having req.write() create a new page is what I am after.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; I have an authentication handler for a blank html page that queries a
</I>&gt;<i> &gt; database for a user/pass, and then generates HTML based off of who
</I>&gt;<i> &gt; logged in.
</I>&gt;<i> 
</I>&gt;<i> When you say you have a &quot;authentication handler&quot;, do you mean that it
</I>&gt;<i> is triggered by PythonAuthenHandler directive. If it is and you are returning
</I>&gt;<i> HTML from it and it represents the complete response for the request,
</I>&gt;<i> you must return apache.DONE and not apache.OK. If you do not return
</I>&gt;<i> apache.DONE, the content handler will still be executed and thus any
</I>&gt;<i> HTML that the content handler itself generates will be appended to the
</I>&gt;<i> result.
</I>&gt;<i> 
</I>&gt;<i> The only other time you would likely see HTML from two places being
</I>&gt;<i> concatenated together, is when you are generating HTML but then returning
</I>&gt;<i> an error status such as apache.HTTP_UNAUTHORIZED. In other words, 
</I>&gt;<i> you were wanting to generate a custom error response page. If you simply
</I>&gt;<i> return apache.HTTP_UNAUTHORIZED in that situation, then Apache will
</I>&gt;<i> still go on to generate an error document page which gets appended to
</I>&gt;<i> your output. In that situation you should instead use:
</I>&gt;<i> 
</I>&gt;<i>   req.status = apache.HTTP_UNAUTHORIZED
</I>&gt;<i>   # generate HTML
</I>&gt;<i>   return apache.OK
</I>&gt;<i> 
</I>&gt;<i> If this is a handler other than PythonHandler, again, you should be
</I>&gt;<i> returning apache.DONE and not apache.OK.
</I>&gt;<i> 
</I>&gt;<i> I would suggest that you post what your Apache configuration directives
</I>&gt;<i> are so it is clear what handlers are being executed and in what phases.
</I>&gt;<i> 
</I>&gt;<i> Show a cut done version of what your handlers are doing would also
</I>&gt;<i> be helpful.
</I>&gt;<i> 
</I>&gt;<i> Graham
</I>&gt;<i> 
</I>&gt;<i> &gt; The HTML generated is a form, and the user information is used to
</I>&gt;<i> &gt; populate the default values. When the user submits the form, and my
</I>&gt;<i> &gt; formHandler is called, the HTML it generates is appended to the current
</I>&gt;<i> &gt; page, instead of starting a new one. I have &lt;html&gt; and &lt;/html&gt; tags at
</I>&gt;<i> &gt; the appropriate places to mark where documents are starting and
</I>&gt;<i> &gt; stopping.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; I did not have this problem on any of the other pages/scripts I have
</I>&gt;<i> &gt; written, and I think that adding authentication into the mix is the
</I>&gt;<i> &gt; variable in the equation.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; What I am after is the following sequence:
</I>&gt;<i> &gt; (1) user login 
</I>&gt;<i> &gt; (2) new page w/form with default fields grabbed from db (generated html)
</I>&gt;<i> &gt; (3) another new page w/confirmation info (values and corrections from
</I>&gt;<i> &gt; form) (generated html)
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Any suggestions?
</I>&gt;<i> &gt; I would greatly appreciate any help I could get.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; -- 
</I>&gt;<i> &gt; Max Luebbe &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">max.luebbe at gmail.com</A>&gt;
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; Mod_python mailing list
</I>&gt;<i> &gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> &gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>-- 
Max Luebbe &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">max.luebbe at gmail.com</A>&gt;

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021518.html">[mod_python] Problem with Mod Python Appending HTML
</A></li>
	<LI>Next message: <A HREF="021527.html">[mod_python] Problem with Mod Python Appending HTML
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21525">[ date ]</a>
              <a href="thread.html#21525">[ thread ]</a>
              <a href="subject.html#21525">[ subject ]</a>
              <a href="author.html#21525">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
