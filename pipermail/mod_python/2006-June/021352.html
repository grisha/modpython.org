<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] differentiate from where comes the request to a file
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20differentiate%20from%20where%20comes%20the%20request%20to%20a%20file&In-Reply-To=5c06fa770606090722g689a0b0fv356b8e44bc28b031%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021351.html">
   <LINK REL="Next"  HREF="021353.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] differentiate from where comes the request to a file</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Jorey Bump</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20differentiate%20from%20where%20comes%20the%20request%20to%20a%20file&In-Reply-To=5c06fa770606090722g689a0b0fv356b8e44bc28b031%40mail.gmail.com"
       TITLE="[mod_python] differentiate from where comes the request to a file">list at joreybump.com
       </A><BR>
    <I>Fri Jun  9 11:04:38 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="021351.html">[mod_python] differentiate from where comes the request to a file
</A></li>
        <LI>Next message: <A HREF="021353.html">[mod_python] differentiate from where comes the request to a file
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21352">[ date ]</a>
              <a href="thread.html#21352">[ thread ]</a>
              <a href="subject.html#21352">[ subject ]</a>
              <a href="author.html#21352">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>To expand on Deron's advice:

You can store your download files outside of the DocumentRoot, and 
create symlinks or obfuscated URLs in a location accessible within your 
site. If you create an md5sum based on connection information, you can 
use that as part of the URL for the file download. I'd lean towards 
managing this in a handler, as Deron suggested, but if that's beyond 
you, the symlink approach is relatively simple and it would be nearly 
impossible to guess the URL.

If the download location is in the same authentication realm as the PSP 
page, you would also have that as an additional protection.

Deron Meranda wrote:
&gt;<i> On 6/9/06, Rui Miguel Justino &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">rmcjustino at gmail.com</A>&gt; wrote:
</I>&gt;&gt;<i> Is it possible to differentiate between a request to a file of type
</I>&gt;&gt;<i> (pdf,png, etc) made by a psp page and a direct request made by a user 
</I>&gt;&gt;<i> who is
</I>&gt;&gt;<i> trying to access directly to this files?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Sorry  if it is confuse. The purpose here is to only give access to files
</I>&gt;&gt;<i> for users who have authenticate to the application, but Even those users
</I>&gt;&gt;<i> will only have access to files that show up in the 
</I>&gt;&gt;<i> application(webpage). And
</I>&gt;&gt;<i> if those users are trying to guess file names they ill not have access to
</I>&gt;&gt;<i> the files.
</I>&gt;<i> 
</I>&gt;<i> As Nicolas said, usually the Referer header is used as a simple check.
</I>&gt;<i> That can even be done using just Apache directives with no mod_python
</I>&gt;<i> work if you want.
</I>&gt;<i> 
</I>&gt;<i> However, if you're willing to put in more work and you don't want
</I>&gt;<i> to actually use authentication, you can make use of dynamically
</I>&gt;<i> generated hard-to-guess URLs for your images.
</I>&gt;<i> 
</I>&gt;<i> Essentially when you output the HTML page which contains the
</I>&gt;<i> &lt;img&gt; link (or other linking element) you generate URLs with
</I>&gt;<i> lots of random characters.  Then either record those URLs in
</I>&gt;<i> a database of sorts, or perhaps encrypt or sign them (the standard
</I>&gt;<i> Python 'hmac' module may be useful).  And finally have a mod_python
</I>&gt;<i> handler accept all those URLs and serve the file contents only if
</I>&gt;<i> the URL verification works.  Eventually you remove the valid
</I>&gt;<i> URLs from your database (or they expire if you recorded a
</I>&gt;<i> date in them before HMAC signing).
</I>&gt;<i> 
</I>&gt;<i> There's lots of details I left out, but it should give you the idea.
</I>
</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021351.html">[mod_python] differentiate from where comes the request to a file
</A></li>
	<LI>Next message: <A HREF="021353.html">[mod_python] differentiate from where comes the request to a file
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21352">[ date ]</a>
              <a href="thread.html#21352">[ thread ]</a>
              <a href="subject.html#21352">[ subject ]</a>
              <a href="author.html#21352">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
