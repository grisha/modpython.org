<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] differentiate from where comes the request to a file
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20differentiate%20from%20where%20comes%20the%20request%20to%20a%20file&In-Reply-To=5a8adb670606090806r131472f7gf789dd5a4c9abce2%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021353.html">
   <LINK REL="Next"  HREF="021358.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] differentiate from where comes the request to a file</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Mike Looijmans</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20differentiate%20from%20where%20comes%20the%20request%20to%20a%20file&In-Reply-To=5a8adb670606090806r131472f7gf789dd5a4c9abce2%40mail.gmail.com"
       TITLE="[mod_python] differentiate from where comes the request to a file">nlv11281 at natlab.research.philips.com
       </A><BR>
    <I>Mon Jun 12 02:51:57 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="021353.html">[mod_python] differentiate from where comes the request to a file
</A></li>
        <LI>Next message: <A HREF="021358.html">[mod_python] 3.2.8 - Memory leaks with   util.FieldStorage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21360">[ date ]</a>
              <a href="thread.html#21360">[ thread ]</a>
              <a href="subject.html#21360">[ subject ]</a>
              <a href="author.html#21360">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Implementing an authentication handler is not so hard. You could also 
use a random(ish) cookie for authentication (only supply the file when 
the user has a cookie from an earlier request).

Another option is to embed that cookie in the file path, e.g. you make 
links like:
  <A HREF="http://myserver.my.domain/myplace/SGTY134S45SFT/document.pdf">http://myserver.my.domain/myplace/SGTY134S45SFT/document.pdf</A>
A python handler verifies the weird 'SGTY134S45SFT' part of the request 
and uses the sendfile function if that checks out ok. Tip: Make sure 
that the generation creates the same code the next time the same user 
requests the same file (e.g. MD5 of soem secret, filename, IP address 
and user name).  This makes it possible for him to still cache the result.


On intranet networks, using something like SPNEGO for authentication is 
very user friendly as your users need only login to a Windows or Linux 
machine once, and need not type passwords or anything to authenticate 
(when using IE or Firefox). The administrative part is a pain to setup, 
but fortunately, that is a task system management must do and not the 
web master... It makes authentication as simple as just reading the 
req.user string value.



--
Mike Looijmans
Philips Natlab / Topic Automation


Rui Miguel Justino wrote:
&gt;<i> Hello,
</I>&gt;<i> Thanks for the quick replies.I have been on this subject for the last 
</I>&gt;<i> couple of days, and did not find a good answer to this. My project will 
</I>&gt;<i> be in top of a python platform so is good to hear the opinion of people 
</I>&gt;<i> who also understand the basics(apache).
</I>&gt;<i> 
</I>&gt;<i> I'm looking for some type of solution that is secure and easy to 
</I>&gt;<i> implement and don't bring a bigger cost to the rest of the application. 
</I>&gt;<i> I will look with more attention to the directions you both have pointed 
</I>&gt;<i> out, I will definitively have to use authentication and then i can 
</I>&gt;<i> probably control the access to files with Referer Header. I will study 
</I>&gt;<i> the viability of it.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On 6/9/06, *Deron Meranda* &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">deron.meranda at gmail.com</A> 
</I>&gt;<i> &lt;mailto:<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">deron.meranda at gmail.com</A>&gt;&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i>     On 6/9/06, Rui Miguel Justino &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">rmcjustino at gmail.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">rmcjustino at gmail.com</A>&gt;&gt; wrote:
</I>&gt;<i>      &gt; Is it possible to differentiate between a request to a file of type
</I>&gt;<i>      &gt; (pdf,png, etc) made by a psp page and a direct request made by a
</I>&gt;<i>     user who is
</I>&gt;<i>      &gt; trying to access directly to this files?
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; Sorry  if it is confuse. The purpose here is to only give access
</I>&gt;<i>     to files
</I>&gt;<i>      &gt; for users who have authenticate to the application, but Even
</I>&gt;<i>     those users
</I>&gt;<i>      &gt; will only have access to files that show up in the
</I>&gt;<i>     application(webpage). And
</I>&gt;<i>      &gt; if those users are trying to guess file names they ill not have
</I>&gt;<i>     access to
</I>&gt;<i>      &gt; the files.
</I>&gt;<i> 
</I>&gt;<i>     As Nicolas said, usually the Referer header is used as a simple check.
</I>&gt;<i>     That can even be done using just Apache directives with no mod_python
</I>&gt;<i>     work if you want.
</I>&gt;<i> 
</I>&gt;<i>     However, if you're willing to put in more work and you don't want
</I>&gt;<i>     to actually use authentication, you can make use of dynamically
</I>&gt;<i>     generated hard-to-guess URLs for your images.
</I>&gt;<i> 
</I>&gt;<i>     Essentially when you output the HTML page which contains the
</I>&gt;<i>     &lt;img&gt; link (or other linking element) you generate URLs with
</I>&gt;<i>     lots of random characters.  Then either record those URLs in
</I>&gt;<i>     a database of sorts, or perhaps encrypt or sign them (the standard
</I>&gt;<i>     Python 'hmac' module may be useful).  And finally have a mod_python
</I>&gt;<i>     handler accept all those URLs and serve the file contents only if
</I>&gt;<i>     the URL verification works.  Eventually you remove the valid
</I>&gt;<i>     URLs from your database (or they expire if you recorded a
</I>&gt;<i>     date in them before HMAC signing).
</I>&gt;<i> 
</I>&gt;<i>     There's lots of details I left out, but it should give you the idea.
</I>&gt;<i>     --
</I>&gt;<i>     Deron Meranda
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> ------------------------------------------------------------------------
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021353.html">[mod_python] differentiate from where comes the request to a file
</A></li>
	<LI>Next message: <A HREF="021358.html">[mod_python] 3.2.8 - Memory leaks with   util.FieldStorage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21360">[ date ]</a>
              <a href="thread.html#21360">[ thread ]</a>
              <a href="subject.html#21360">[ subject ]</a>
              <a href="author.html#21360">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
