From java_dev at nilling.nl  Sun Jan  2 05:48:12 2005
From: java_dev at nilling.nl (Johan C. =?ISO-8859-15?Q?St=F6ver?=)
Date: Sun Jan  2 05:50:25 2005
Subject: [mod_python] Problem getting mptest.py to work
In-Reply-To: <ca7c50804123021417c458dc5@mail.gmail.com>
References: <ca7c5080412300530dea3445@mail.gmail.com>
	<BB8ADDF8-5A6A-11D9-8E7F-000393A6AE96@banta-im.com>
	<ca7c50804123021417c458dc5@mail.gmail.com>
Message-ID: <20050102114812.4a7d0000.java_dev@nilling.nl>

add req.content_type="text/html" before rew.write("Hellor World") 

Johan

On Thu, 30 Dec 2004 23:41:09 -0600
Jacob Martinson <dr.martinson@gmail.com> wrote:

> I copied & paisted from the manual...
> 
> root@batman:/var/www/py
> $ cat mptest.py 
> from mod_python import apache
> 
> def handler(req):
>     req.write("Hello World!")
>     return apache.OK
> root@batman:/var/www/py
> $ ls -lh mptest.py 
> -rwxr-xr-x  1 root root 100 2004-12-30 06:10 mptest.py
> 
> 
> On Thu, 30 Dec 2004 08:57:24 -0500, Matthew Krom <mkrom@banta-im.com> wrote:
> > I had a similar problem yesterday -- Apache was displaying the source
> > of the file when I asked for it (sounds similar to your symptom).
> > 
> > The cause in my case was that my py file (mptest.py in your case) did
> > not have a method "def handler(req):".  In my case, I mis-spelled it as
> > "def handle(req)".
> > 
> > Perhaps if mod_python cannot find a handler method, it gives up, and
> > Apache takes over and just serves the source file?
> > 
> > Matt
> > 
> > 
> > > Hello All,
> > >
> > > I'm not a python or apache expert but have set up modpython versions 2
> > > and 3 in the past with varying degrees of success...
> > >
> > > mptest.py is generating the "Hello World" message, but apache is
> > > sending a file named "mptest.py" with "hello world" in it, rather than
> > > sending it in a form where the browser will recognize it directly.
> > >
> > > Firefox, Internet Explorer and lynx will not display it directly, but
> > > will offer to open it with "less".  Another text browser "links" opens
> > > it directly.
> > >
> > > Details of my system:
> > >
> > > debian linux (sarge)
> > > apache - 2.0.52
> > > python - 2.3.4
> > > modpython - 3.1.3
> > >
> > > At the end of my apache2.conf, I have this from the install guide:
> > >
> > > <Directory /var/www/py>
> > >    AddHandler mod_python .py
> > >    PythonHandler mptest
> > >    PythonDebug On
> > > </Directory>
> > >
> > > The module is getting loaded from a string of config file includes,
> > > but I'm pretty sure it is loading because I get this line in the error
> > > log:
> > >
> > > [Thu Dec 30 06:44:00 2004] [notice] mod_python: (Re)importing module
> > > 'mptest'
> > >
> > > Am I missing something?
> > >
> > > Thanks!!!
> > >
> > > -jacob
> > > _______________________________________________
> > > Mod_python mailing list
> > > Mod_python@modpython.org
> > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > >
> > 
> >
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python


-- 
Nilling Software Design
Postbus 43
2280 AA  Rijswijk ZH
w: http://www.nilling.nl
From jbward at berkeley.edu  Mon Jan  3 15:53:40 2005
From: jbward at berkeley.edu (John Ward)
Date: Mon Jan  3 15:52:20 2005
Subject: [mod_python] Newbie Publisher Handler questions
In-Reply-To: <41D2D968.6050703@joreybump.com>
References: <521C6E5D-5964-11D9-A6F9-000393798102@berkeley.edu>
	<521C6E5D-5964-11D9-A6F9-000393798102@berkeley.edu>
Message-ID: <5.2.1.1.2.20050103125043.01bb7e88@calmail.berkeley.edu>

Hi Jorey,

Thanks for the reply.  This information is helpful.  I wasn't familiar with 
the 'sets' module so I'll take a look at it.

Thanks again.

John



At 11:20 AM 12/29/2004 -0500, Jorey Bump wrote:
>John Ward wrote:
>
>>1. With mod_python, do I no longer have to worry about limiting the path 
>>available to the script?  (I do my best to maintain an appropriate level 
>>of paranoia, so one thing I'd like to learn is what security mod_python 
>>handles for me and what security I need to write into my scripts.)
>
>Frankly, I'd leave the path alone. Depending on your environment, it could 
>affect other users or applications. For example, if I set the environment 
>path using mod_python in a virtual host, it also changes the path for perl 
>CGI scripts, where the correct path is more likely to matter. It may seem 
>fine in an environment you control, but makes your application less 
>portable. If you must use popen, set up a variable that contains the 
>complete path to your binary,  and change that when you deploy it 
>somewhere else. With that said, your mod_python applications will have the 
>same rights as the apache user, so plan accordingly.
>
>For mod_python newbies, here's a simple module to show your path, using 
>the publisher handler:
>
># path.py
>import os
>
>def show(req):
>         # uncomment to set path
>         # os.environ['PATH'] = '/usr/bin:/bin'
>         return os.environ['PATH']
>
>Access it via http://host/path.py/show
>
>>2. How do mod_python programmers typically handle sanitizing form input?
>
>For me, this depends on the intended use of the data, and also partly on 
>the version of python. For simple validation, I might turn the input into 
>a list and check the members for illegal characters. The sets module 
>introduced in python 2.3 is now a built-in in 2.4, making this a trivial 
>task. But if your application might run under older versions of python, 
>you'll have to use something a bit more universal.
>
>For database input, I use placeholders, somewhere along these lines:
>
>     query = """INSERT INTO users ( name, quest ) VALUES ( %s, %s )"""
>     cursor = dbh.cursor()
>     cursor.execute(query, (req.formdata['name'], req.formdata['quest']))
>
>Note that this is *not* typical python string replacement. This construct 
>allows you to send any VALUE string to the database, with necessary 
>escapes inserted behind the scenes. It's very handy. You are encouraged to 
>find out more about python and placeholders for your db and test it on 
>your platform (I found a lot of misleading info, but the form above works 
>best for me when using MySQLdb).
>
>>3. Assuming one has an SMTP server listening on localhost, what is the 
>>recommended way to add messages to the mail queue?
>
>I prefer smtplib because it's portable, powerful, and offers excellent 
>error handling. Of course, if you want the message queued instead of sent 
>immediately, you'll need to configure your SMTP daemon to do so. You could 
>do this for the MSA on port 587 to avoid running a separate instance.
>
>>4. When writing CGI scripts in Perl using CGI.pm, one has the option of 
>>limiting the size of POSTs by setting a value for the '$MAX_POST' 
>>variable.  Is there a way to do this using mod_python?  Or is this even 
>>something I need to worry about?
>
>I haven't run into a need for this, but I do have some textarea form 
>inputs that I'm concerned about, so I'd be interested if this is possible, 
>as well.
>
>
>_______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org
>http://mailman.modpython.org/mailman/listinfo/mod_python

From arnaudsj at mac.com  Thu Jan  6 00:12:37 2005
From: arnaudsj at mac.com (=?ISO-8859-1?Q?S=E9bastien_Arnaud?=)
Date: Thu Jan  6 00:12:44 2005
Subject: [mod_python] Disable .py file serving in Apache
Message-ID: <94D29F26-5FA1-11D9-A50F-003065966802@mac.com>

Hi,

I am running blank tonight on this simple question: "How can I make 
sure that apache will never serve a .py file as is?"

I have a config like this:

	<Directory /my/dir/>
			DirectoryIndex index.htm
			AddHandler mod_python .html
			PythonHandler ZPYWmc
			[...]
			PythonDebug On
			PythonAutoReload On
	</Directory>

Basically all the .html will be looking at my handler ZPYWmc.py to know 
what to do. All the .htm will be served as normal static files in 
/my/dir. How can I make sure Apache does not serve /my/dir/ZPYWmc.py 
from a simple HTTP request and show my source code to the world?

Thanks!

S?bastien


-------------- next part --------------
A non-text attachment was scrubbed...
Name: PGP.sig
Type: application/pgp-signature
Size: 155 bytes
Desc: This is a digitally signed message part
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050105/6d884372/PGP.bin
From grahamd at dscpl.com.au  Thu Jan  6 00:46:39 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Jan  6 00:46:43 2005
Subject: [mod_python] Disable .py file serving in Apache
In-Reply-To: <94D29F26-5FA1-11D9-A50F-003065966802@mac.com>
Message-ID: <1104990389.31840@dscpl.com.au>

On Jan 05 23:12, =?ISO-8859-1?Q?S=E9bastien_Arnaud?= <arnaudsj@mac.com> wrote:
>
> Subject: [mod_python] Disable .py file serving in Apache
>
> Hi,
> 
> I am running blank tonight on this simple question: "How can I make 
> sure that apache will never serve a .py file as is?"
> 
> I have a config like this:
> 
> 	<Directory /my/dir/>
> 			DirectoryIndex index.htm
> 			AddHandler mod_python .html
> 			PythonHandler ZPYWmc
> 			[...]
> 			PythonDebug On
> 			PythonAutoReload On
> 	</Directory>
> 
> Basically all the .html will be looking at my handler ZPYWmc.py to know 
> what to do. All the .htm will be served as normal static files in 
> /my/dir. How can I make sure Apache does not serve /my/dir/ZPYWmc.py 
> from a simple HTTP request and show my source code to the world?

Try something like

  <Files *.py>
  Order allow,deny
  deny from all
  </Files>

--
Graham Dumpleton (grahamd@dscpl.com.au)

From simonwittber at gmail.com  Thu Jan  6 01:30:41 2005
From: simonwittber at gmail.com (Simon Wittber)
Date: Thu Jan  6 01:30:43 2005
Subject: [mod_python] importing from a PSP file
Message-ID: <4e4a11f80501052230297c516d@mail.gmail.com>

We've just started using mod-python PSP, so please excuse my ignorance. 

I found that I cannot import modules which exist in the same folder as
the psp file being served by apache.

eg:
The file:

/home/simon/public_html/test.psp

cannot import:

/home/simon/public_html/package/module.py

unless the path '/home/simon/public_html' is sys.path.appended at the
top of the psp page.

To get around this problem, I added the following lines:

cwd = str(os.path.split(self.filename)[0])
sys.path.append(cwd)

under line 207 in '/usr/lib/python2.3/site-packages/mod_python/psp.py'
which cleared up the problem.

Has anyone else come up against this problem? Does another (better)
solution already exist somewhere else in mod-python?

Sw.
From grahamd at dscpl.com.au  Thu Jan  6 04:08:29 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Jan  6 04:08:39 2005
Subject: [mod_python] importing from a PSP file
In-Reply-To: <4e4a11f80501052230297c516d@mail.gmail.com>
References: <4e4a11f80501052230297c516d@mail.gmail.com>
Message-ID: <87F28C39-5FC2-11D9-8535-000393DCF16E@dscpl.com.au>


On 06/01/2005, at 5:30 PM, Simon Wittber wrote:

> We've just started using mod-python PSP, so please excuse my ignorance.
>
> I found that I cannot import modules which exist in the same folder as
> the psp file being served by apache.
>
> eg:
> The file:
>
> /home/simon/public_html/test.psp
>
> cannot import:
>
> /home/simon/public_html/package/module.py
>
> unless the path '/home/simon/public_html' is sys.path.appended at the
> top of the psp page.
>
> To get around this problem, I added the following lines:
>
> cwd = str(os.path.split(self.filename)[0])
> sys.path.append(cwd)

You would need to be very careful with doing this as every request
against that resource would extend sys.path. You should at least
check it isn't in sys.path already. Extending sys.path can also
be problematic in a threaded environment as would exist in Apache
on Windows and if worker MPM is used on UNIX.

BTW, why the str() conversion? It should already be a string unless
there is something I am missing about Unicode strings.

> under line 207 in '/usr/lib/python2.3/site-packages/mod_python/psp.py'
> which cleared up the problem.
>
> Has anyone else come up against this problem? Does another (better)
> solution already exist somewhere else in mod-python?

Both the standard Python "import" directive and the mod_python
import_module() method use the "imp" module which will only look
for modules in sys.path. Thus the problem as you understand it.
Another problem with this, especially if you put your directory
last is that it may pick up a module of the same name from a
place elsewhere on the search path before it even gets to your
directory. Ie., not your module, but something else. This is a
source of various problems in mod_python.

If you want to look at other alternatives, you might look at the
module loading and caching system in the Vampire extension
package for mod_python. In Vampire things work a bit differently
and you must actually specify the specific directory that the
module of interest is in. Ie., sys.path is ignored. This is done
specifically to avoid the problems of having to set sys.path and
of potentially finding the wrong module.

Thus your code would be written as:

   import vampire

   directory = os.path.join(os.path.split(self.filename)[0],"package")
   module = vampire.importModule(directory,"module")

   module.dosomething()

Note that this requires you to be loading a specific module file,
it can't load a module laid out as a package.

Vampire can be found at:

   http://www.dscpl.com.au/projects/vampire

Note that I haven't done anything proper in PSP, so don't know how
practical it is to try and make use of the Vampire module loading
system. :-)

--
Graham Dumpleton (grahamd@dscpl.com.au)

From simonwittber at gmail.com  Thu Jan  6 07:54:09 2005
From: simonwittber at gmail.com (Simon Wittber)
Date: Thu Jan  6 07:54:11 2005
Subject: [mod_python] importing from a PSP file
In-Reply-To: <87F28C39-5FC2-11D9-8535-000393DCF16E@dscpl.com.au>
References: <4e4a11f80501052230297c516d@mail.gmail.com>
	<87F28C39-5FC2-11D9-8535-000393DCF16E@dscpl.com.au>
Message-ID: <4e4a11f805010604546e53c0c7@mail.gmail.com>

> You would need to be very careful with doing this as every request
> against that resource would extend sys.path. You should at least
> check it isn't in sys.path already. Extending sys.path can also
> be problematic in a threaded environment as would exist in Apache
> on Windows and if worker MPM is used on UNIX.

Ahh yes, as the sys module remains in memory, the sys.path list will
keep extending forever until apache shuts down... thanks for the heads
up.

Sw.
From list at joreybump.com  Thu Jan  6 09:01:49 2005
From: list at joreybump.com (Jorey Bump)
Date: Thu Jan  6 09:01:54 2005
Subject: [mod_python] importing from a PSP file
In-Reply-To: <4e4a11f80501052230297c516d@mail.gmail.com>
References: <4e4a11f80501052230297c516d@mail.gmail.com>
Message-ID: <41DD44CD.9080901@joreybump.com>

Simon Wittber wrote:

> I found that I cannot import modules which exist in the same folder as
> the psp file being served by apache.
> 
> eg:
> The file:
> 
> /home/simon/public_html/test.psp
> 
> cannot import:
> 
> /home/simon/public_html/package/module.py

No surprise, this doesn't work in Python, either.

> unless the path '/home/simon/public_html' is sys.path.appended at the
> top of the psp page.

Just make the subdirectory a package:

  cd /home/simon/public_html/package/
  touch __init__.py

Now, anything running from /home/simon/public_html/ can do this:

  import package.module

Obviously, you should choose unique names for your packages (and even 
modules) in order to avoid polluting the namespace.

> To get around this problem, I added the following lines:
> 
> cwd = str(os.path.split(self.filename)[0])
> sys.path.append(cwd)
> 
> under line 207 in '/usr/lib/python2.3/site-packages/mod_python/psp.py'
> which cleared up the problem.

Resist the temptation to alter mod_python if you're a newbie. Not only 
will you probably hose your installation, but noone will be able to help 
you if you are working from a nonstandard code base.

> Has anyone else come up against this problem? Does another (better)
> solution already exist somewhere else in mod-python?

See above, or simply put your module in the same directory as the 
importing module.

The same rules (generally) apply to mod_python as to running a single 
interpreter from the command line. Don't make the mistake of treating it 
like HTML, PHP, CGI, or anything else, for that matter. The embedded 
interpreter makes mod_python very powerful, and whenever people try to 
"fix" it to match their expectations, they tend to weaken it. Almost all 
of the problems you will encounter have a simple Python solution, and 
there is rarely an analog to the technology/language you're trying to 
replace.





From simonwittber at gmail.com  Thu Jan  6 10:31:46 2005
From: simonwittber at gmail.com (Simon Wittber)
Date: Thu Jan  6 10:31:48 2005
Subject: [mod_python] importing from a PSP file
In-Reply-To: <41DD44CD.9080901@joreybump.com>
References: <4e4a11f80501052230297c516d@mail.gmail.com>
	<41DD44CD.9080901@joreybump.com>
Message-ID: <4e4a11f8050106073149a1ad2a@mail.gmail.com>

> > /home/simon/public_html/package/module.py
> 
> No surprise, this doesn't work in Python, either.

The example I provided was contrived, designed to illustrate my
problem. I had created the package correctly, as you describe below.
The package is designed to be installed using a distutils setup.py
script. I need the package in each developer's public_html directory
so that each individual developer can modifiy parts of the package and
only effect their development environment, (we are all working on a
single linux box) and not the entire server. Changes to the package
are merged using SVN. The package will eventually be deployed to
production using distutils.

> Just make the subdirectory a package:
> 
>   cd /home/simon/public_html/package/
>   touch __init__.py
> 

> Now, anything running from /home/simon/public_html/ can do this:
> 
>   import package.module

It seems, with the standard PSP handler, that this statement is
incorrect. This is because psp.py loads and exec's the .psp file, and
psp.py has a different current working directory to the .psp file.
Therefore, the directory which contains the .psp file, is not in
sys.path.

> The same rules (generally) apply to mod_python as to running a single
> interpreter from the command line. 
 
Except, it seems, files which are processed by the PSP handler. PSP
files will not import modules or packages which exist in the same
directory as the PSP file, unless of course, the .psp filepath exists
in sys.path. Whether this is a bug or not, depends on one's point of
view. Personally, I believe .psp files should be able to import python
modules and packages from .psp file's directory, hence the psp.py
hack.

Sw.
From simonwittber at gmail.com  Thu Jan  6 10:38:03 2005
From: simonwittber at gmail.com (Simon Wittber)
Date: Thu Jan  6 10:38:05 2005
Subject: [mod_python] importing from a PSP file
In-Reply-To: <4e4a11f8050106073149a1ad2a@mail.gmail.com>
References: <4e4a11f80501052230297c516d@mail.gmail.com>
	<41DD44CD.9080901@joreybump.com>
	<4e4a11f8050106073149a1ad2a@mail.gmail.com>
Message-ID: <4e4a11f8050106073862b98e79@mail.gmail.com>

> script. I need the package in each developer's public_html directory
> so that each individual developer can modifiy parts of the package and
> only effect their development environment, (we are all working on a
> single linux box) and not the entire server. Changes to the package

It is obvious to me now that the above scenario cannot be achieved,
unless each developer has a unique package name, or each developer has
their own apache process.

We're all actually sharing the same interpreter, which I've just come
to understand!

Thanks for the feedback.

Sw.
From Administrator at leebrown.org  Thu Jan  6 11:31:09 2005
From: Administrator at leebrown.org (Lee E. Brown)
Date: Thu Jan  6 11:31:39 2005
Subject: [mod_python] importing from a PSP file
References: <4e4a11f80501052230297c516d@mail.gmail.com><41DD44CD.9080901@joreybump.com><4e4a11f8050106073149a1ad2a@mail.gmail.com>
	<4e4a11f8050106073862b98e79@mail.gmail.com>
Message-ID: <005001c4f40d$2129db80$0202a8c0@UberBox>

Greetings!

I don't know if this will help you or not, but mod_python actually uses 
subinterpreters, each of which have their own namespace separate from the 
main interpreter.

The default behavior is to create a subinterpreter for each virtual host on 
the server.  However, you can use the PythonInterpPerDirectory directive so 
that each directory accessed gets its own namespace based on the absolute 
path of the directory being accessed.  Or you can use the 
PythonInterpPerDirective directive to create a namespace based on the 
directory where the Python*Handler was found.  You can also use the 
PythonInterpreter directive to force the namespace to be based on a supplied 
string.

If you use one of the above means to give each developer his/her own 
subinterpreter, you can then initialize a proper sys.path statement for each 
interpreter allowing access to the needed files without polluting other 
developer's namespaces or overflowing the main interpreter's sys.path 
variable.

Best Regards,
Lee E. Brown

----- Original Message ----- 
From: "Simon Wittber" <simonwittber@gmail.com>
Cc: <mod_python@modpython.org>
Sent: Thursday, January 06, 2005 10:38 AM
Subject: Re: [mod_python] importing from a PSP file


> We're all actually sharing the same interpreter, which I've just come
> to understand!

From grisha at modpython.org  Thu Jan  6 12:26:40 2005
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Thu Jan  6 12:26:46 2005
Subject: [mod_python] importing from a PSP file
In-Reply-To: <4e4a11f8050106073862b98e79@mail.gmail.com>
References: <4e4a11f80501052230297c516d@mail.gmail.com>
	<41DD44CD.9080901@joreybump.com>
	<4e4a11f8050106073149a1ad2a@mail.gmail.com>
	<4e4a11f8050106073862b98e79@mail.gmail.com>
Message-ID: <20050106122534.T6151@grisha.dyndns.org>


Simon -

Take a look at the PythonInterp* directives, it may still be possible to 
achieve what you need.

Grisha

On Thu, 6 Jan 2005, Simon Wittber wrote:

>> script. I need the package in each developer's public_html directory
>> so that each individual developer can modifiy parts of the package and
>> only effect their development environment, (we are all working on a
>> single linux box) and not the entire server. Changes to the package
>
> It is obvious to me now that the above scenario cannot be achieved,
> unless each developer has a unique package name, or each developer has
> their own apache process.
>
> We're all actually sharing the same interpreter, which I've just come
> to understand!
>
> Thanks for the feedback.
>
> Sw.
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From list at joreybump.com  Thu Jan  6 13:51:26 2005
From: list at joreybump.com (Jorey Bump)
Date: Thu Jan  6 13:51:30 2005
Subject: [mod_python] importing from a PSP file
In-Reply-To: <005001c4f40d$2129db80$0202a8c0@UberBox>
References: <4e4a11f80501052230297c516d@mail.gmail.com><41DD44CD.9080901@joreybump.com><4e4a11f8050106073149a1ad2a@mail.gmail.com>	<4e4a11f8050106073862b98e79@mail.gmail.com>
	<005001c4f40d$2129db80$0202a8c0@UberBox>
Message-ID: <41DD88AE.5010000@joreybump.com>

I do what Lee outlines, only I use the default behaviour with a single 
user per VirtualHost arrangement.

Assuming the DocumentRoot is /var/www/domain/site, I extend the path for 
that VirtualHost with this line in http.conf:

  PythonPath "sys.path + ['/var/www/domain/python']"

Now the user/host has a private package repository that is outside the 
DocumentRoot, which also helps to secure sensitive data (in a somewhat 
limited sense). If you are able to use VirtualHosts, there is no reason 
that prevents you from designating a /home/user/public_html directory as 
the DocumentRoot. Keep in mind that the /home/user/python directory will 
need the same type of world-readable permissions in order to work 
(Therein lies the security limitation: other system users will be able 
to read the files. Nonetheless it does offer advantages in a controlled 
environment).

Lee E. Brown wrote:

> Greetings!
> 
> I don't know if this will help you or not, but mod_python actually uses 
> subinterpreters, each of which have their own namespace separate from 
> the main interpreter.
> 
> The default behavior is to create a subinterpreter for each virtual host 
> on the server.  However, you can use the PythonInterpPerDirectory 
> directive so that each directory accessed gets its own namespace based 
> on the absolute path of the directory being accessed.  Or you can use 
> the PythonInterpPerDirective directive to create a namespace based on 
> the directory where the Python*Handler was found.  You can also use the 
> PythonInterpreter directive to force the namespace to be based on a 
> supplied string.
> 
> If you use one of the above means to give each developer his/her own 
> subinterpreter, you can then initialize a proper sys.path statement for 
> each interpreter allowing access to the needed files without polluting 
> other developer's namespaces or overflowing the main interpreter's 
> sys.path variable.
> 
> Best Regards,
> Lee E. Brown
> 
> ----- Original Message ----- From: "Simon Wittber" <simonwittber@gmail.com>
> Cc: <mod_python@modpython.org>
> Sent: Thursday, January 06, 2005 10:38 AM
> Subject: Re: [mod_python] importing from a PSP file
> 
> 
>> We're all actually sharing the same interpreter, which I've just come
>> to understand!
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From grahamd at dscpl.com.au  Thu Jan  6 16:18:16 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Jan  6 16:18:19 2005
Subject: [mod_python] importing from a PSP file
In-Reply-To: <005001c4f40d$2129db80$0202a8c0@UberBox>
Message-ID: <1105046292.22213@dscpl.com.au>

On Jan 06 11:31, "Lee E. Brown" <Administrator@leebrown.org> wrote:
>
> Subject: Re: [mod_python] importing from a PSP file
>
> Greetings!
> 
> I don't know if this will help you or not, but mod_python actually uses 
> subinterpreters, each of which have their own namespace separate from the 
> main interpreter.
> 
> The default behavior is to create a subinterpreter for each virtual host on 
> the server.  However, you can use the PythonInterpPerDirectory directive so 
> that each directory accessed gets its own namespace based on the absolute 
> path of the directory being accessed.  Or you can use the 
> PythonInterpPerDirective directive to create a namespace based on the 
> directory where the Python*Handler was found.  You can also use the 
> PythonInterpreter directive to force the namespace to be based on a supplied 
> string.

Note that PythonInterpPerDirectory has a bug in it which may generate
strange results. See:

  http://www.modpython.org/pipermail/mod_python/2004-November/016788.html

In short, requests against the directory and a file in the directory map
to different interpreters when they should be the same. This makes it
hard to have a default index page served up when directory is accessed.

--
Graham Dumpleton (grahamd@dscpl.com.au)
From simonwittber at gmail.com  Thu Jan  6 19:52:13 2005
From: simonwittber at gmail.com (Simon Wittber)
Date: Thu Jan  6 19:52:15 2005
Subject: [mod_python] importing from a PSP file
In-Reply-To: <1105046292.22213@dscpl.com.au>
References: <005001c4f40d$2129db80$0202a8c0@UberBox>
	<1105046292.22213@dscpl.com.au>
Message-ID: <4e4a11f8050106165241b8583c@mail.gmail.com>

> > I don't know if this will help you or not, but mod_python actually uses
> > subinterpreters, each of which have their own namespace separate from the
> > main interpreter.

Brilliant! Just what I need.

> In short, requests against the directory and a file in the directory map
> to different interpreters when they should be the same. This makes it
> hard to have a default index page served up when directory is accessed.

Fortunately we do not use index.psp files, so it seems this bug won't effect us.

To summarise:

The final 3 lines I added after line 207 in psp.py are:

cwd = os.path.split(self.filename)[0]
if cwd not in sys.path:
    sys.path.append(cwd)

This allows (along with the PythonInterpPerDirectory driective)
multiple developers, on the same machine, to import different packages
(which reside in the same folder as the .psp file) of the same name
into .psp pages which are served from their public_html folders.

Thanks for the assistance.

Sw.
From grahamd at dscpl.com.au  Thu Jan  6 21:51:36 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Jan  6 21:51:41 2005
Subject: [mod_python] importing from a PSP file
In-Reply-To: <4e4a11f8050106165241b8583c@mail.gmail.com>
Message-ID: <1105066289.55784@dscpl.com.au>

On Jan 07 08:52, Simon Wittber <simonwittber@gmail.com> wrote:
>
> Subject: Re: [mod_python] importing from a PSP file
>
> > > I don't know if this will help you or not, but mod_python actually uses
> > > subinterpreters, each of which have their own namespace separate from the
> > > main interpreter.
> 
> Brilliant! Just what I need.
> 
> > In short, requests against the directory and a file in the directory map
> > to different interpreters when they should be the same. This makes it
> > hard to have a default index page served up when directory is accessed.
> 
> Fortunately we do not use index.psp files, so it seems this bug won't effect us.
> 
> To summarise:
> 
> The final 3 lines I added after line 207 in psp.py are:
> 
> cwd = os.path.split(self.filename)[0]
> if cwd not in sys.path:
>     sys.path.append(cwd)
> 
> This allows (along with the PythonInterpPerDirectory driective)
> multiple developers, on the same machine, to import different packages
> (which reside in the same folder as the .psp file) of the same name
> into .psp pages which are served from their public_html folders.

There isn't a need to be changing psp.py at all and changing it isn't a
good idea as others have said. For the path bit, use PythonPath directive
in the users htaccess file instead. Out of the options mentioned as to
separate interpreters, use PythonInterpPerDirective instead of the
PythonInterpPerDirectory option.

Thus, a users .htaccess file in their public_html directory would read
something like:

  AddHandler mod_python .psp
  PythonInterpPerDirective On
  PythonHandler mod_python.psp
  PythonPath "sys.path+'/home/simon/public_html/package'"

Or in httpd.conf, as:

  <Directory /home/simon/public_html>
  AddHandler mod_python .psp
  PythonInterpPerDirective On
  PythonHandler mod_python.psp
  PythonPath "sys.path+'/home/simon/public_html/package'"
  </Directory>

In someone elses directory, just change the PythonPath setting as is
appropriate for their version of the above.

What this would then give you is a separate interpreter for stuff rooted
at the top of each persons public_html directory. Further, the Python
path would include the "package" subdirectory of the public_html
directory.

The reason for not using PythonInterpPerDirectory, besides the bug, is
that if subdirectories were created, under public_html which have .psp
files, each of those directories would have a separate interpreter as well.
Using PythonInterpPerDirective means the whole directory hierarchy
under public_html would share the same one for that one user.

--
Graham Dumpleton (grahamd@dscpl.com.au)
From rhay at real.com  Fri Jan  7 18:44:07 2005
From: rhay at real.com (Russell Hay)
Date: Fri Jan  7 18:46:23 2005
Subject: [mod_python] Apache 2.0.52, Python 2.4 and mod_python 3.1.3,
 core dump while starting under FreeBSD
Message-ID: <41DF1EC7.1000706@real.com>

mod_python-3.1.3 on FreeBSD with Apache 2.0.52

OS Information:

FreeBSD shell.b0b.net 5.2.1-RELEASE-p8 FreeBSD 5.2.1-RELEASE-p8 #0: Wed 
May 26 11:03:54 PDT 2004     
root@shell.b0b.net:/usr/obj/usr/src/sys/GENERIC  i386

Apache Information:

Server version: Apache/2.0.52
Server built:   Jan  7 2005 15:05:19
Server's Module Magic Number: 20020903:9
Architecture:   32-bit
Server compiled with....
 -D APACHE_MPM_DIR="server/mpm/prefork"
 -D APR_HAS_SENDFILE
 -D APR_HAS_MMAP
 -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)
 -D APR_USE_FLOCK_SERIALIZE
 -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT
 -D APR_HAS_OTHER_CHILD
 -D AP_HAVE_RELIABLE_PIPED_LOGS
 -D HTTPD_ROOT="/usr/local"
 -D SUEXEC_BIN="/usr/local/bin/suexec"
 -D DEFAULT_PIDLOG="/var/run/httpd.pid"
 -D DEFAULT_SCOREBOARD="/var/run/apache_runtime_status"
 -D DEFAULT_LOCKFILE="/var/run/accept.lock"
 -D DEFAULT_ERRORLOG="/var/log/httpd-error.log"
 -D AP_TYPES_CONFIG_FILE="etc/apache2/mime.types"
 -D SERVER_CONFIG_FILE="etc/apache2/httpd.conf"

Python version 2.4, I've tried having it compiled with and without 
thread support.

When I try to start apache with mod_python loading as a .so, I get the 
following:

[Fri Jan 07 15:38:48 2005] [notice] child pid 87015 exit signal 
Segmentation fault (11)
[Fri Jan 07 15:38:48 2005] [notice] child pid 87014 exit signal 
Segmentation fault (11)
[Fri Jan 07 15:38:48 2005] [notice] child pid 87013 exit signal 
Segmentation fault (11)
[Fri Jan 07 15:38:48 2005] [notice] child pid 87012 exit signal 
Segmentation fault (11)
[Fri Jan 07 15:38:48 2005] [notice] child pid 87011 exit signal 
Segmentation fault (11)
[Fri Jan 07 15:38:48 2005] [notice] child pid 87010 exit signal 
Segmentation fault (11)
[Fri Jan 07 15:38:48 2005] [notice] child pid 87009 exit signal 
Segmentation fault (11)

And this is repeated over and over until the server "gives up"

if I run httpd with -X, it doesn't segfault, so I'm thinking it probably 
has something to do with the mpm, but as you see, I'm using a Prefork 
version of apache, so it should be fine.  Has anyone else had this 
happen?  Has anyone found a work around?
From jryan at qutang.net  Fri Jan  7 19:37:56 2005
From: jryan at qutang.net (Justin Ryan)
Date: Fri Jan  7 19:38:00 2005
Subject: [mod_python] Apache 2.0.52, Python 2.4 and mod_python 3.1.3,
	core dump while starting under FreeBSD
In-Reply-To: <41DF1EC7.1000706@real.com>
References: <41DF1EC7.1000706@real.com>
Message-ID: <8A46C606-610D-11D9-B977-000D93AD1DB8@qutang.net>

Howdy Russel!!!

>
> When I try to start apache with mod_python loading as a .so, I get the 
> following:
>
> [Fri Jan 07 15:38:48 2005] [notice] child pid 87015 exit signal 
> Segmentation fault (11)
> [Fri Jan 07 15:38:48 2005] [notice] child pid 87014 exit signal 
> Segmentation fault (11)
> [Fri Jan 07 15:38:48 2005] [notice] child pid 87013 exit signal 
> Segmentation fault (11)
> [Fri Jan 07 15:38:48 2005] [notice] child pid 87012 exit signal 
> Segmentation fault (11)
> [Fri Jan 07 15:38:48 2005] [notice] child pid 87011 exit signal 
> Segmentation fault (11)
> [Fri Jan 07 15:38:48 2005] [notice] child pid 87010 exit signal 
> Segmentation fault (11)
> [Fri Jan 07 15:38:48 2005] [notice] child pid 87009 exit signal 
> Segmentation fault (11)
>

Remember what signal 11 means:

   (a) hardware

   (b) linker

check / replace / rebuild / test

can you boot this drive in another machine?

did this recently start happening?

is this a new configuration?

did you build mod_python yourself?  have you tried building out of 
ports?

Cheers!

-=JR

From rhay at real.com  Fri Jan  7 20:07:15 2005
From: rhay at real.com (Russell Hay)
Date: Fri Jan  7 20:09:31 2005
Subject: [mod_python] Apache 2.0.52, Python 2.4 and mod_python 3.1.3,
	core dump while starting under FreeBSD
In-Reply-To: <8A46C606-610D-11D9-B977-000D93AD1DB8@qutang.net>
References: <41DF1EC7.1000706@real.com>
	<8A46C606-610D-11D9-B977-000D93AD1DB8@qutang.net>
Message-ID: <41DF3243.8070402@real.com>

Justin Ryan wrote:

>
> Remember what signal 11 means:
>
>   (a) hardware
>
>   (b) linker
>
> check / replace / rebuild / test
>
> can you boot this drive in another machine?
>
> did this recently start happening?
>
> is this a new configuration?
>
> did you build mod_python yourself?  have you tried building out of ports?
>
> Cheers!
>
> -=JR
>
>
>
Justin,

I can't really take the drive out of the machine, as this is providing a 
number of services to my network, so trying it from another machine 
might be impossible.  This is a brand new configuration for mod_python 
running on a server that's been running apache (without incedent) for a 
few years now (obviously apache has been upgraded through the years has 
as the OS).  All of the software is out of the ports collection, mostly 
using the default options for each piece.  I'll try to rebuild 
everything from scratch and see how that goes.
From erik at ekhagen.org  Fri Jan  7 20:23:08 2005
From: erik at ekhagen.org (Erik Billing)
Date: Fri Jan  7 20:23:08 2005
Subject: [mod_python] Installing mod_python without root-permissions.
In-Reply-To: <1105066289.55784@dscpl.com.au>
References: <1105066289.55784@dscpl.com.au>
Message-ID: <41DF35FC.6090000@ekhagen.org>


Greetings. I wonder if it?s possible to install mod_python on a debian 
system with Apache, without having root-permissions.

I?m currently developing a web-service using standard python-cgi 
scripts, but my application is now getting too heavy for it to work well 
as a cgi and I?ve started too look around for an alternative. Mod_python 
clearly seams to be a great solution, but there is one problem. I intend 
to host the service with a web-server provider that does not support 
mod_python. I have a shell-account thaw, and I am allowed to compile and 
install my own applications there, so I was hoping it would in some way 
be possible to load install mod_python on a user-specific basis.

As I half-expect this not to be possible, I still have too ask. And if 
anybody knows any other way to achieve an alternative to python-cgi, 
that doesn?t involve apache modules which requires root-permissions, it 
would be greatly appreciated. I have access to Tomcat and have some kind 
of thought of using JSP through JPython, but since I?m not so much into 
JSP I would really need a kick in the right direction.

Regards ..Erik Billing (erik@ekhagen.org)
From list at joreybump.com  Fri Jan  7 21:45:24 2005
From: list at joreybump.com (Jorey Bump)
Date: Fri Jan  7 21:45:29 2005
Subject: [mod_python] Installing mod_python without root-permissions.
In-Reply-To: <41DF35FC.6090000@ekhagen.org>
References: <1105066289.55784@dscpl.com.au> <41DF35FC.6090000@ekhagen.org>
Message-ID: <41DF4944.5030300@joreybump.com>

Erik Billing wrote:

> Greetings. I wonder if it?s possible to install mod_python on a debian 
> system with Apache, without having root-permissions.

You are unlikely to be able to get it to work with your provider's 
instance of apache, but it *might* be possible to compile your own 
apache/python/mod_python and run it on an alternate port.

Potential problems:

- Necessary build tools and libraries inaccessible or not installed
- Provider may not like to see users run services on alternate ports
- Firewall may prevent incoming connections to unprivileged (high) ports
- Obviously, you will need to use http://host:1234/foo.py/bar syntax

Advantages:

- You can install the latest versions
- You can restart apache as needed (common when first using mod_python)
- You can configure/customize apache to your heart's content
- You don't have to use tomcat/JSP (hooray!)

With that said, Debian makes mod_python easy to install. I have 
production machines still using Woody, and the mod_python package works 
extremely well. It only requires a few edits to httpd.conf to get 
running after you apt-get it. It's a shame they won't install it for you 
(although it is nice to tweak httpd.conf yourself).

The truth is, you should build a server at home and get acquainted with 
mod_python before you commit yourself to a hosting arrangement. You may 
find server colocation more to your liking. I prefer to run mod_python 
in a tightly controlled (read "non-multiuser") environment.


> I?m currently developing a web-service using standard python-cgi 
> scripts, but my application is now getting too heavy for it to work well 
> as a cgi and I?ve started too look around for an alternative. Mod_python 
> clearly seams to be a great solution, but there is one problem. I intend 
> to host the service with a web-server provider that does not support 
> mod_python. I have a shell-account thaw, and I am allowed to compile and 
> install my own applications there, so I was hoping it would in some way 
> be possible to load install mod_python on a user-specific basis.
> 
> As I half-expect this not to be possible, I still have too ask. And if 
> anybody knows any other way to achieve an alternative to python-cgi, 
> that doesn?t involve apache modules which requires root-permissions, it 
> would be greatly appreciated. I have access to Tomcat and have some kind 
> of thought of using JSP through JPython, but since I?m not so much into 
> JSP I would really need a kick in the right direction.
> 
> Regards ..Erik Billing (erik@ekhagen.org)
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From erik.billing at gmail.com  Sat Jan  8 07:33:31 2005
From: erik.billing at gmail.com (Erik Billing)
Date: Sat Jan  8 07:33:33 2005
Subject: [mod_python] Installing mod_python without root-permissions.
Message-ID: <53f8910d050108043359cac7c4@mail.gmail.com>

Thanx for your extensive answer. And yes, I've had some thoughts of
setting up my own server at the account, but I think the second
problem you point out will be the killing one. The provider will for
shore not like user-specific servers hanging around eating system
resources. I have a server at home that I could use, but it would be
very nice to be able to guarantee a better uptime than I can do with
that one.

So I guess I should just should have a look at the Jyton/JSP solution
anyway, I don't really like it either, but who knows, maybe it could
be a good thing.

..Erik

On Fri, 07 Jan 2005 21:45:24 -0500, Jorey Bump <list@joreybump.com> wrote:
> Erik Billing wrote:
>
> > Greetings. I wonder if it's possible to install mod_python on a debian
> > system with Apache, without having root-permissions.
>
> You are unlikely to be able to get it to work with your provider's
> instance of apache, but it *might* be possible to compile your own
> apache/python/mod_python and run it on an alternate port.
>
> Potential problems:
>
> - Necessary build tools and libraries inaccessible or not installed
> - Provider may not like to see users run services on alternate ports
> - Firewall may prevent incoming connections to unprivileged (high) ports
> - Obviously, you will need to use http://host:1234/foo.py/bar syntax
>
> Advantages:
>
> - You can install the latest versions
> - You can restart apache as needed (common when first using mod_python)
> - You can configure/customize apache to your heart's content
> - You don't have to use tomcat/JSP (hooray!)
>
> With that said, Debian makes mod_python easy to install. I have
> production machines still using Woody, and the mod_python package works
> extremely well. It only requires a few edits to httpd.conf to get
> running after you apt-get it. It's a shame they won't install it for you
> (although it is nice to tweak httpd.conf yourself).
>
> The truth is, you should build a server at home and get acquainted with
> mod_python before you commit yourself to a hosting arrangement. You may
> find server colocation more to your liking. I prefer to run mod_python
> in a tightly controlled (read "non-multiuser") environment.
>
>
> > I'm currently developing a web-service using standard python-cgi
> > scripts, but my application is now getting too heavy for it to work well
> > as a cgi and I've started too look around for an alternative. Mod_python
> > clearly seams to be a great solution, but there is one problem. I intend
> > to host the service with a web-server provider that does not support
> > mod_python. I have a shell-account thaw, and I am allowed to compile and
> > install my own applications there, so I was hoping it would in some way
> > be possible to load install mod_python on a user-specific basis.
> >
> > As I half-expect this not to be possible, I still have too ask. And if
> > anybody knows any other way to achieve an alternative to python-cgi,
> > that doesn't involve apache modules which requires root-permissions, it
> > would be greatly appreciated. I have access to Tomcat and have some kind
> > of thought of using JSP through JPython, but since I'm not so much into
> > JSP I would really need a kick in the right direction.
> >
> > Regards ..Erik Billing (erik@ekhagen.org)
From volodya at real.samuraj.org  Sat Jan  8 11:59:07 2005
From: volodya at real.samuraj.org (Volodya)
Date: Sat Jan  8 11:59:36 2005
Subject: [mod_python] Re: problem installing mod_python-3.1.3 with Python
	2.4
In-Reply-To: <20041205203630.AE7531FA96F@postfix4-1.free.fr>
References: <DBBA2C22AB83D711BBBC0008C75DC954152F5AEF@BRSAOMXMP02.sp.bra.bkb.com>
	<20041205203630.AE7531FA96F@postfix4-1.free.fr>
Message-ID: <20050108165907.GM26383@debian.mki-btc.com>

On Sun, Dec 05, 2004 at 09:36:30PM +0100, Nicolas Lehuen wrote:
> > The biggest difficulty I hit was that Python 2.4 (the standard 
> > binary) is built with MSVC 7.1, so extensions also have to be built with
> that version (or with mingw, which can build MSVC-7.1 compatible binaries).
> > As I don't have MSVC 7.1, and can't work out how to build Apache, or at
> least enough of it to compile
> > mod_python, with mingw, I'm stuck.
> >
> > I would *really* appreciate a Python 2.4 binary of mod_python... 
> >
> > Paul. 
> 
> OK, I've managed to rebuild mod_python.so for Win32 with Python 2.4 support,
> and it seems to work properly. If you want the binary version, write me and
> I'll send it to you. Note that I've tried it on Apache 2.0.52 compiled with
> VC 7.1 too, so your mileage may vary if you have the standard build of
> Apache.
> 
> The problem is that I could not rebuild _psp.pyd, so PSP pages are not
> working for now. Until now, I only needed to rebuild mod_python.so since the
> patches I wrote were targeting this module, so I've just noticed that
> building _psp.pyd is not as straightforward as building mod_python.so,
> mainly because there are no project file or setup.py for this. It seems that
> the subversion repository misses something there. Grisha, can you tell us
> how to rebuild _psp.pyd ?
> 

I've just compiled (VS 2003) mod_python from svn/trunk and it seems to work fine
with apache 2.0.52 (self compiled too). I created VC-project file for
_psp.pyd and it seems to work too.

What i've done to make _psp.pyd :

  - Created empty win32 dll-project, added all psp-related *.c and *.h
    files, added include/libs dirs of Python 2.4 to project.

  - Removed #inclusion of <unistd.h>

  - edited definition of init_psp functio to:
    __declspec(dllexport) void init_psp(void);



From pit.grinja at gmx.de  Sun Jan  9 04:14:34 2005
From: pit.grinja at gmx.de (pit.grinja@gmx.de)
Date: Sun Jan  9 04:14:37 2005
Subject: [mod_python] CSS not processed in PSP stylesheet
Message-ID: <20369.1105262074@www1.gmx.net>

Hello,
I have recently started to explore Server-side scripting with modpython, and
I am really impressed by its features. Without mod_python, things would have
been much more difficult.
However, I have a problem when applying a stylesheet to an XHTML page that
is dynamically generated via PSP. Here are the directives for my
directories:

#------------------------------------------------
DocumentRoot "C:/Programme/Apache/Apache2/htdocs"
#------------------------------------------------
<Directory />
    Options FollowSymLinks
    AllowOverride None
</Directory>
#------------------------------------------------
<Directory "C:/Programme/Apache/Apache2/htdocs">
    Options Indexes FollowSymLinks Multiviews ExecCGI
    AllowOverride None
    Order allow,deny
    Allow from all
</Directory>
#------------------------------------------------
<Directory "C:/Programme/Apache/Apache2/htdocs/pypublisher">
    AddHandler mod_python .py
    PythonHandler mod_python.publisher
    PythonDebug On
    Options Indexes FollowSymLinks Multiviews ExecCGI
    AllowOverride None
    Order allow,deny
    Allow from all
</Directory>
#------------------------------------------------
<Directory "C:/Programme/Apache/Apache2/htdocs/stylesheets">
    SetHandler None
</Directory>

In the directory /pypublisher, I have a html file with a form. This form
calls a *.py file which in turn uses the PSP module to generate the contents
from an XHTML template file.
The XHTML should be formatted via a CSS, but it is ignored. I browsed
through the archive and found that this error is caused by to main reasons:
1. The request for the CSS file is eaten up by a handler.
2. The CSS file is not found because the URI of a dynamically generated file
is not the same as that of a "static" one and thus the relative URI defined
in the template points to nothing.
For these reasons, I placed the stylesheets in my DocumentRoot and didn?t
define a handler. But it is still not working. What am I doing wrong?
The script contents are as follows:
#the file with the form
<html>
<form action="psptest.py/go" method="POST">
<input type="submit" width="200" height="50" value="Go"/>
</form>
</html>
#the python script psptest.py
from mod_python import psp

def go(req):
    req.content_type = 'text/html'
    template = psp.PSP(req,filename="template.xhtm")
    template.run(req.form)
#the xhtml template template.xhtm
<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/css" href="/standard.css"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"/dtds/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<title>modpython Template test</title>
</head>
<body>
Hello World!
</body>
</html>
#
Additional comment:
When I copy-paste the content of the generated file into a new file,
it is correctly displayed in the browser.
Many thanks for your advice
Piet
(Mod_python 3.1.3.0, WinMe, Python 2.3.4, Apache 2.0.50)

-- 
+++ GMX - die erste Adresse f?r Mail, Message, More +++
1 GB Mailbox bereits in GMX FreeMail http://www.gmx.net/de/go/mail
From manfred.stienstra at dwerg.net  Sun Jan  9 05:04:03 2005
From: manfred.stienstra at dwerg.net (Manfred Stienstra)
Date: Sun Jan  9 05:04:11 2005
Subject: [mod_python] CSS not processed in PSP stylesheet
In-Reply-To: <20369.1105262074@www1.gmx.net>
References: <20369.1105262074@www1.gmx.net>
Message-ID: <1105265043.14782.20.camel@ack.dwerg.net>

On Sun, 2005-01-09 at 10:14 +0100, pit.grinja@gmx.de wrote:
> <Directory "C:/Programme/Apache/Apache2/htdocs/stylesheets">
>     SetHandler None
> </Directory>

Here you define your directory with stylesheets. This will
become /stylesheets on your server.

> #the xhtml template template.xhtm
> <?xml version="1.0" encoding="UTF-8"?>
> <?xml-stylesheet type="text/css" href="/standard.css"?>

But here you tell the browser that it is in the / directory. Please note
that you're treating the html file as xml, but sending 'text/html' as a
content-type. I'm not sure if every browser is going to be very happy
with this. It might be better to use <link rel="stylesheet"
type="text/css" href="/stylesheets/standard.css" />.

You can easily test if the request is 'eaten up' by the handler by doing
a request for the css in your browser and see what you get back.

Manfred


From JFeghhi at visa.com  Sun Jan  9 14:27:54 2005
From: JFeghhi at visa.com (Feghhi, Jalil)
Date: Sun Jan  9 14:28:35 2005
Subject: [mod_python] Issue w/ Internal Redirect and Sessions
Message-ID: <8C53AAFA2050EE40BDCDB9455DA7D63401911571@sw720ex020.visa.com>


I have noticed if I do an internal redirect (using the internal_redirect
method in request object) from a psp page to another psp page, I get
into a dead lock if both pages have used the session object. When I
remove it from one of psp pages, everything works. It seems to me that
this is because the second page want to lock the session object and
cannot. Is that 

Is this the way it is supposed to be? 

I am trying to send all my requests to a dispacher.psp and then do an
internal redirect but I need the session objects in both my psp pages.
What is the right way to implement something like this?

Thanks,

-Jalil


-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050109/879334d1/attachment.html
From sanders at apache.org  Sun Jan  9 17:10:06 2005
From: sanders at apache.org (Scott Sanders)
Date: Sun Jan  9 17:10:09 2005
Subject: [mod_python] Issue w/ Internal Redirect and Sessions
In-Reply-To: <8C53AAFA2050EE40BDCDB9455DA7D63401911571@sw720ex020.visa.com>
References: <8C53AAFA2050EE40BDCDB9455DA7D63401911571@sw720ex020.visa.com>
Message-ID: <383A7A7E-628B-11D9-8785-000A95D2D288@apache.org>

You need to unlock the session before doing an internal redirect.  The 
session only gets unlocked at the end of the request in which it is 
created, which will not happen with an internal redirect, thus the 
lockup.

Scott

On Jan 9, 2005, at 11:27 AM, Feghhi, Jalil wrote:

>
>
> I have noticed if I do an internal redirect (using the 
> internal_redirect method in request object) from a psp page to another 
> psp page, I get into a dead lock if both pages have used the session 
> object. When I remove it from one of psp pages, everything works. It 
> seems to me that this is because the second page want to lock the 
> session object and cannot. Is that
>
>  Is this the way it is supposed to be?
>
>  I am trying to send all my requests to a dispacher.psp and then do an 
> internal redirect but I need the session objects in both my psp pages. 
> What is the right way to implement something like this?
>
> Thanks,
>
> -Jalil
>
>  _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: text/enriched
Size: 1417 bytes
Desc: not available
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050109/e6c4e98e/attachment.bin
From sanders at apache.org  Sun Jan  9 17:51:35 2005
From: sanders at apache.org (Scott Sanders)
Date: Sun Jan  9 17:51:35 2005
Subject: [mod_python] Issue w/ Internal Redirect and Sessions
In-Reply-To: <8C53AAFA2050EE40BDCDB9455DA7D63401911575@sw720ex020.visa.com>
References: <8C53AAFA2050EE40BDCDB9455DA7D63401911575@sw720ex020.visa.com>
Message-ID: <036B2A27-6291-11D9-8785-000A95D2D288@apache.org>

I would assume that you can just say session.unlock() before you 
redirect.

I haven't used PSP though, so you'll just have to try it.

On Jan 9, 2005, at 2:44 PM, Feghhi, Jalil wrote:

> Scott,
> ?
> How do I do it from psp code? In my psp code, I have simply added the 
> global variable 'session' and I think mod-python just creates the 
> session that way. Any way I can control it from psp?
> ?
> -Jalil
>
>
> From: Scott Sanders [mailto:sanders@apache.org]
>  Sent: Sunday, January 09, 2005 2:10 PM
> To: Feghhi, Jalil
> Cc: mod_python@modpython.org
> Subject: Re: [mod_python] Issue w/ Internal Redirect and Sessions
>
>
> You need to unlock the session before doing an internal redirect. The 
> session only gets unlocked at the end of the request in which it is 
> created, which will not happen with an internal redirect, thus the 
> lockup.
>
>
>
>  Scott
>
>
>
>  On Jan 9, 2005, at 11:27 AM, Feghhi, Jalil wrote:
>
>
>
>
>
>  I have noticed if I do an internal redirect (using the 
> internal_redirect method in request object) from a psp page to another 
> psp page, I get into a dead lock if both pages have used the session 
> object. When I remove it from one of psp pages, everything works. It 
> seems to me that this is because the second page want to lock the 
> session object and cannot. Is that
>
>
>
> Is this the way it is supposed to be?
>
>
>
> I am trying to send all my requests to a dispacher.psp and then do an 
> internal redirect but I need the session objects in both my psp pages. 
> What is the right way to implement something like this?
>
>
>
> Thanks,
>
>
>
> -Jalil
>
>
>
> _______________________________________________
>
>  Mod_python mailing list
>
>  Mod_python@modpython.org
>
>  http://mailman.modpython.org/mailman/listinfo/mod_python
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: text/enriched
Size: 3029 bytes
Desc: not available
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050109/108739b2/attachment.bin
From pit.grinja at gmx.de  Mon Jan 10 12:33:37 2005
From: pit.grinja at gmx.de (pit.grinja@gmx.de)
Date: Mon Jan 10 12:33:39 2005
Subject: [mod_python] CSS not processed in PSP
	stylesheet&In-Reply-To=20369.1105262074@www1.gmx.net
Message-ID: <3889.1105378417@www50.gmx.net>

Hello Manfred.
Many thanks for your hints. In fact, the problem had nothing to do with an
incorrect path, and the content type 'text/html' is in principle ok. The
problem seems to be the combination of the content type AND the xml
declaration. It turned out that the directly opening the file in mozilla did
not give the expected results (<b>sometext</b>,<i>someother</i>,<br />...
parts were ignored if not defined in the css). After lots of
experimentation, I found that all what is needed is the following tag as a
child of the head-tag:
<meta content="application/xhtml+xml"/>.
Now I have a file that is well-formed, valid and correctly rendered in the
browser with respect to the standard html tags.
Piet

-- 
+++ Sparen Sie mit GMX DSL +++ http://www.gmx.net/de/go/dsl
AKTION fr Wechsler: DSL-Tarife ab 3,99 EUR/Monat + Startguthaben
From grisha at modpython.org  Mon Jan 10 15:23:49 2005
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Mon Jan 10 15:24:08 2005
Subject: [mod_python] Installing mod_python without root-permissions.
In-Reply-To: <41DF35FC.6090000@ekhagen.org>
References: <1105066289.55784@dscpl.com.au> <41DF35FC.6090000@ekhagen.org>
Message-ID: <20050110152014.J86456@grisha.dyndns.org>



On Sat, 8 Jan 2005, Erik Billing wrote:

> I intend to host the service with a web-server provider that does not 
> support mod_python.

Just curious - any reason why? There are quite a few virtual private 
server providers out there (<plug>openhosting.com</plug> one of them) that 
offer you complete root access at prices competetive with the "old style" 
hosting accounts where you just get some web space.

Grisha
From manfred.stienstra at dwerg.net  Mon Jan 10 17:03:22 2005
From: manfred.stienstra at dwerg.net (Manfred Stienstra)
Date: Mon Jan 10 17:03:27 2005
Subject: [mod_python] Installing mod_python without root-permissions.
In-Reply-To: <41DF4944.5030300@joreybump.com>
References: <1105066289.55784@dscpl.com.au> <41DF35FC.6090000@ekhagen.org>
	<41DF4944.5030300@joreybump.com>
Message-ID: <1105394602.1332.4.camel@ack.dwerg.net>

On Fri, 2005-01-07 at 21:45 -0500, Jorey Bump wrote:
> - Obviously, you will need to use http://host:1234/foo.py/bar syntax

But you could proxy all the request through mod_proxy, mod_rewrite or a
script.

Manfred

From gustavo.cordova at q-voz.com  Mon Jan 10 18:10:14 2005
From: gustavo.cordova at q-voz.com (Gustavo =?utf-8?q?C=C3=B3rdova_Avila?=)
Date: Mon Jan 10 18:02:45 2005
Subject: [mod_python] Installing mod_python without root-permissions.
In-Reply-To: <1105394602.1332.4.camel@ack.dwerg.net>
References: <1105066289.55784@dscpl.com.au> <41DF4944.5030300@joreybump.com>
	<1105394602.1332.4.camel@ack.dwerg.net>
Message-ID: <200501101710.14242.gustavo.cordova@q-voz.com>

On Monday 10 January 2005 16:03, Manfred Stienstra wrote:
> On Fri, 2005-01-07 at 21:45 -0500, Jorey Bump wrote:
> > - Obviously, you will need to use http://host:1234/foo.py/bar
> > syntax

Maybe I'm being dense, but ... why?

If the op configures his own private apache and mod_python, I fail to 
see why he'll need to use that particular convention.

I'd simply:

<Location /application>
 Set-Handler python-program
 PythonPath "[\"/app/module/location\"] + sys.path"
 PythonHandler appmodule
</Location>

and in appmodule.py:

BASE = "/application/"
BASE_LEN = len(BASE)

def handler(req):
 if req.uri.startswith("/application/"):
  #
  # Remove the leading /application/ from uri.
  #
  my_uri = req.uri[BASE_LEN:]

  #
  # handle the request in whatever way.
  #
  return apache.OK

 else:
  # request not meant for us.
  return apache.DECLINED

So.... if you'll please clarify why the previous uglified URI is 
required.... I'll just stfu. :-)

-gus
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050110/37e73744/attachment.html
From bje at apnic.net  Mon Jan 10 18:12:32 2005
From: bje at apnic.net (Byron Ellacott)
Date: Mon Jan 10 18:10:09 2005
Subject: [mod_python] CSS not processed in
	PSP	stylesheet&In-Reply-To=20369.1105262074@www1.gmx.net
In-Reply-To: <3889.1105378417@www50.gmx.net>
References: <3889.1105378417@www50.gmx.net>
Message-ID: <41E30BE0.1050003@apnic.net>

pit.grinja@gmx.de wrote:
> Many thanks for your hints. In fact, the problem had nothing to do with an
> incorrect path, and the content type 'text/html' is in principle ok. The
> problem seems to be the combination of the content type AND the xml
> declaration. It turned out that the directly opening the file in mozilla did
> not give the expected results (<b>sometext</b>,<i>someother</i>,<br />...
> parts were ignored if not defined in the css). After lots of
> experimentation, I found that all what is needed is the following tag as a
> child of the head-tag:
> <meta content="application/xhtml+xml"/>.

There are a couple of caveats to beware of here.  First, as you have 
probably surmised, <?xml-stylesheet ...?> is only valid in an XML 
document, which text/html is not.  Even if you send an XHTML document, 
complete with a <?xml ...?> opener, browsers will /not/ treat it as an 
XHTML document.  This is trivial to demonstrate with the following page:

---------------------
<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
         "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
   <head>
     <title>Test page</title>
   </head>
   <body>
     <p>
       <script type="text/javascript">
           document.write('Hello, World!');
       </script>
     </p>
   </body>
</html>
--------------------

If you serve this file up as text/html, you will get a blank page with 
'Hello, World!' on it.  If you serve this file up as 
application/xhtml+xml, you will get a blank page.  This is because an 
XHTML document is parsed differently; a DOM tree is built before 
anything is interpreted, to ensure the document is valid, and so the 
document.write does not happen until after the parse, when it's too late 
to add anything new to the parse.

Also, Internet Explorer will ask if you wish to save the file to disk, 
since it does not recognise XHTML.

Since you have direct control over the MIME type you're sending, I would 
recommend that you send the correct MIME type directly, rather than 
relying on a <meta ...> element.

Also note that in the example you gave, your DOCTYPE was not entirely 
correct -- the system should not be a relative URL, it should be the 
absolute URL pointing to the w3c's dtd for XHTML.  I use XHTML Strict 
when I produce XHTML.

> Now I have a file that is well-formed, valid and correctly rendered in the
> browser with respect to the standard html tags.

Beware well-formedness and validity with XHTML.  If you do not send the 
correct content-type to the w3c's validator, your page will not be 
validated as XHTML!  Also beware the subtle differences in how CSS 
applies to XHTML documents compared to HTML.  Most notably, XHTML 
elements are case sensitive, so your CSS selectors must be all lower 
case.  Also, CSS attributes you would normally apply to a body element 
must instead be applied to an html element.

Finally, it bears repeating: Internet Explorer, all versions, does not 
recognise XHTML.  As far as I know, it never will.  If you need to 
support IE, you are far better off producing HTML4.01 Strict than XHTML1 
Transitional, since HTML4.01 Strict is understood by all browsers with 
its correct MIME type.

See http://www.hixie.ch/advocacy/xhtml for an explanation of XHTML and 
HTML differences, and why XHTML should never be sent as "text/html".

-- 
bje
From list at joreybump.com  Mon Jan 10 19:34:25 2005
From: list at joreybump.com (Jorey Bump)
Date: Mon Jan 10 19:34:29 2005
Subject: [mod_python] Installing mod_python without root-permissions.
In-Reply-To: <200501101710.14242.gustavo.cordova@q-voz.com>
References: <1105066289.55784@dscpl.com.au>
	<41DF4944.5030300@joreybump.com>	<1105394602.1332.4.camel@ack.dwerg.net>
	<200501101710.14242.gustavo.cordova@q-voz.com>
Message-ID: <41E31F11.3050409@joreybump.com>

Gustavo C?rdova Avila wrote:
> On Monday 10 January 2005 16:03, Manfred Stienstra wrote:
> 
>  > On Fri, 2005-01-07 at 21:45 -0500, Jorey Bump wrote:
> 
>  > > - Obviously, you will need to use http://host:1234/foo.py/bar
> 
>  > > syntax
> 
> Maybe I'm being dense, but ... why?
> 
> If the op configures his own private apache and mod_python, I fail to 
> see why he'll need to use that particular convention.

He's an ordinary user without root privileges, so he can only run apache 
on an unprivileged port.
From list at joreybump.com  Mon Jan 10 20:23:36 2005
From: list at joreybump.com (Jorey Bump)
Date: Mon Jan 10 20:23:40 2005
Subject: [mod_python] Installing mod_python without root-permissions.
In-Reply-To: <1105394602.1332.4.camel@ack.dwerg.net>
References: <1105066289.55784@dscpl.com.au>
	<41DF35FC.6090000@ekhagen.org>	<41DF4944.5030300@joreybump.com>
	<1105394602.1332.4.camel@ack.dwerg.net>
Message-ID: <41E32A98.1080200@joreybump.com>

Manfred Stienstra wrote:

> On Fri, 2005-01-07 at 21:45 -0500, Jorey Bump wrote:
> 
>>- Obviously, you will need to use http://host:1234/foo.py/bar syntax
> 
> 
> But you could proxy all the request through mod_proxy, mod_rewrite or a
> script.

There's no harm in running the application on an unprivileged port, as 
long as the user can access it from a page in the main apache instance. 
A link is a link, once a user reaches the site. I've done this with 
mod_perl applications, where I've had to compile and run apache, perl, 
and mod_perl as an ordinary user to get features that weren't available 
from the stock environment. There was no inconvenience to the end user.

The OP's options are limited by what he can do without root privileges, 
and how much the admin is willing to do to help (including installing 
modules or modifying the configuration in the main apache instance).
From python at dan-olsen.net  Tue Jan 11 13:18:44 2005
From: python at dan-olsen.net (Dan R. Olsen III)
Date: Tue Jan 11 13:19:15 2005
Subject: [mod_python] Mod_pythong quit working
Message-ID: <41E41884.4080708@dan-olsen.net>

I had a mod_python file that I was working on a few days ago. Now, when 
I type in the URL nothing happens. The browser just stays on the page it 
was already on. I haven't made any changes to the file or the system.

I am using Fedora Core 2 with Apache 1.3 and mod_python 2.7. Any ideas?

From manfred.stienstra at dwerg.net  Tue Jan 11 14:11:13 2005
From: manfred.stienstra at dwerg.net (Manfred Stienstra)
Date: Tue Jan 11 14:11:21 2005
Subject: [mod_python] Mod_pythong quit working
In-Reply-To: <41E41884.4080708@dan-olsen.net>
References: <41E41884.4080708@dan-olsen.net>
Message-ID: <1105470673.1340.11.camel@ack.dwerg.net>

On Tue, 2005-01-11 at 11:18 -0700, Dan R. Olsen III wrote:
> I had a mod_python file that I was working on a few days ago. Now, when 
> I type in the URL nothing happens. The browser just stays on the page it 
> was already on. I haven't made any changes to the file or the system.
> 
> I am using Fedora Core 2 with Apache 1.3 and mod_python 2.7. Any ideas?

It seems to be broken! Have you tried fixing it in any way? Restarting
apache? Echoing a simple string to the browser etc...

From python at dan-olsen.net  Tue Jan 11 14:16:59 2005
From: python at dan-olsen.net (Dan R. Olsen III)
Date: Tue Jan 11 14:17:24 2005
Subject: [mod_python] Mod_python quit working
In-Reply-To: <1105470673.1340.11.camel@ack.dwerg.net>
References: <41E41884.4080708@dan-olsen.net>
	<1105470673.1340.11.camel@ack.dwerg.net>
Message-ID: <41E4262B.9060501@dan-olsen.net>

Manfred Stienstra wrote:
> On Tue, 2005-01-11 at 11:18 -0700, Dan R. Olsen III wrote:
> 
>>I had a mod_python file that I was working on a few days ago. Now, when 
>>I type in the URL nothing happens. The browser just stays on the page it 
>>was already on. I haven't made any changes to the file or the system.
>>
>>I am using Fedora Core 2 with Apache 1.3 and mod_python 2.7. Any ideas?
> 
> 
> It seems to be broken! Have you tried fixing it in any way? Restarting
> apache? Echoing a simple string to the browser etc...

Yes, I've restarted Apache and I have echoed a simple string and niether 
of those have worked.

> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
From manfred.stienstra at dwerg.net  Tue Jan 11 14:27:56 2005
From: manfred.stienstra at dwerg.net (Manfred Stienstra)
Date: Tue Jan 11 14:28:02 2005
Subject: [mod_python] Mod_python quit working
In-Reply-To: <41E4262B.9060501@dan-olsen.net>
References: <41E41884.4080708@dan-olsen.net>
	<1105470673.1340.11.camel@ack.dwerg.net>
	<41E4262B.9060501@dan-olsen.net>
Message-ID: <1105471676.1332.13.camel@ack.dwerg.net>

On Tue, 2005-01-11 at 12:16 -0700, Dan R. Olsen III wrote:
> Manfred Stienstra wrote:
> > On Tue, 2005-01-11 at 11:18 -0700, Dan R. Olsen III wrote:
> > 
> >>I had a mod_python file that I was working on a few days ago. Now, when 
> >>I type in the URL nothing happens. The browser just stays on the page it 
> >>was already on. I haven't made any changes to the file or the system.
> >>
> >>I am using Fedora Core 2 with Apache 1.3 and mod_python 2.7. Any ideas?
> > 
> > 
> > It seems to be broken! Have you tried fixing it in any way? Restarting
> > apache? Echoing a simple string to the browser etc...
> 
> Yes, I've restarted Apache and I have echoed a simple string and niether 
> of those have worked.

Try getting the page with 'wget', see what headers you get back and if
there is any content.

Manfred

From python at dan-olsen.net  Tue Jan 11 14:40:32 2005
From: python at dan-olsen.net (Dan R. Olsen III)
Date: Tue Jan 11 14:41:25 2005
Subject: [mod_python] Mod_python quit working
In-Reply-To: <1105471676.1332.13.camel@ack.dwerg.net>
References: <41E41884.4080708@dan-olsen.net>
	<1105470673.1340.11.camel@ack.dwerg.net>
	<41E4262B.9060501@dan-olsen.net>
	<1105471676.1332.13.camel@ack.dwerg.net>
Message-ID: <41E42BB0.6040201@dan-olsen.net>

>>>
>>>>I had a mod_python file that I was working on a few days ago. Now, when 
>>>>I type in the URL nothing happens. The browser just stays on the page it 
>>>>was already on. I haven't made any changes to the file or the system.
>>>>I am using Fedora Core 2 with Apache 1.3 and mod_python 2.7. Any ideas?

>>>It seems to be broken! Have you tried fixing it in any way? Restarting
>>>apache? Echoing a simple string to the browser etc...

>>Yes, I've restarted Apache and I have echoed a simple string and niether 
>>of those have worked.

> Try getting the page with 'wget', see what headers you get back and if
> there is any content.

I get the following:

--12:38:00--  http://dev.eclab.byu.edu/rose.py
            => `rose.py'
Resolving dev.eclab.byu.edu... 128.187.170.133
Connecting to dev.eclab.byu.edu[128.187.170.133]:80... connected.
HTTP request sent, awaiting response...
12:38:00 ERROR -1: No data received.

Why would it all of a sudden be receiving not data?
From manfred.stienstra at dwerg.net  Tue Jan 11 14:57:42 2005
From: manfred.stienstra at dwerg.net (Manfred Stienstra)
Date: Tue Jan 11 14:57:49 2005
Subject: [mod_python] Mod_python quit working
In-Reply-To: <41E42BB0.6040201@dan-olsen.net>
References: <41E41884.4080708@dan-olsen.net>
	<1105470673.1340.11.camel@ack.dwerg.net>
	<41E4262B.9060501@dan-olsen.net>
	<1105471676.1332.13.camel@ack.dwerg.net>
	<41E42BB0.6040201@dan-olsen.net>
Message-ID: <1105473462.1336.18.camel@ack.dwerg.net>

On Tue, 2005-01-11 at 12:40 -0700, Dan R. Olsen III wrote:
> >>Yes, I've restarted Apache and I have echoed a simple string and niether 
> >>of those have worked.
> 
> > Try getting the page with 'wget', see what headers you get back and if
> > there is any content.
> 
> I get the following:
> 
> --12:38:00--  http://dev.eclab.byu.edu/rose.py
>             => `rose.py'
> Resolving dev.eclab.byu.edu... 128.187.170.133
> Connecting to dev.eclab.byu.edu[128.187.170.133]:80... connected.
> HTTP request sent, awaiting response...
> 12:38:00 ERROR -1: No data received.

What does it say in the apache logs?

From nicolas.lehuen at gmail.com  Tue Jan 11 15:03:07 2005
From: nicolas.lehuen at gmail.com (Nicolas Lehuen)
Date: Tue Jan 11 15:03:09 2005
Subject: [mod_python] Mod_python quit working
In-Reply-To: <41E42BB0.6040201@dan-olsen.net>
References: <41E41884.4080708@dan-olsen.net>
	<1105470673.1340.11.camel@ack.dwerg.net>
	<41E4262B.9060501@dan-olsen.net>
	<1105471676.1332.13.camel@ack.dwerg.net>
	<41E42BB0.6040201@dan-olsen.net>
Message-ID: <c298f2d7050111120346dd2204@mail.gmail.com>

On Tue, 11 Jan 2005 12:40:32 -0700, Dan R. Olsen III
<python@dan-olsen.net> wrote:
> >>>
> >>>>I had a mod_python file that I was working on a few days ago. Now, when
> >>>>I type in the URL nothing happens. The browser just stays on the page it
> >>>>was already on. I haven't made any changes to the file or the system.
> >>>>I am using Fedora Core 2 with Apache 1.3 and mod_python 2.7. Any ideas?
> 
> >>>It seems to be broken! Have you tried fixing it in any way? Restarting
> >>>apache? Echoing a simple string to the browser etc...
> 
> >>Yes, I've restarted Apache and I have echoed a simple string and niether
> >>of those have worked.
> 
> > Try getting the page with 'wget', see what headers you get back and if
> > there is any content.
> 
> I get the following:
> 
> --12:38:00--  http://dev.eclab.byu.edu/rose.py
>             => `rose.py'
> Resolving dev.eclab.byu.edu... 128.187.170.133
> Connecting to dev.eclab.byu.edu[128.187.170.133]:80... connected.
> HTTP request sent, awaiting response...
> 12:38:00 ERROR -1: No data received.
> 
> Why would it all of a sudden be receiving not data?

Do you have something in your error.log file ?

The file is normally in $APACHE/logs and it may contain interesting
informations about what's happening.

Is everything OK in your logging system ? Do you have enough free
space on the partition which contains the logs ?

Regards,
Nicolas
From python at dan-olsen.net  Tue Jan 11 15:05:31 2005
From: python at dan-olsen.net (Dan R. Olsen III)
Date: Tue Jan 11 15:07:10 2005
Subject: [mod_python] Mod_python quit working
In-Reply-To: <1105473462.1336.18.camel@ack.dwerg.net>
References: <41E41884.4080708@dan-olsen.net>
	<1105470673.1340.11.camel@ack.dwerg.net>
	<41E4262B.9060501@dan-olsen.net>
	<1105471676.1332.13.camel@ack.dwerg.net>
	<41E42BB0.6040201@dan-olsen.net>
	<1105473462.1336.18.camel@ack.dwerg.net>
Message-ID: <41E4318B.7080809@dan-olsen.net>


>>>>Yes, I've restarted Apache and I have echoed a simple string and niether 
>>>>of those have worked.
>>
>>>Try getting the page with 'wget', see what headers you get back and if
>>>there is any content.
>>
>>I get the following:
>>
>>--12:38:00--  http://dev.eclab.byu.edu/rose.py
>>            => `rose.py'
>>Resolving dev.eclab.byu.edu... 128.187.170.133
>>Connecting to dev.eclab.byu.edu[128.187.170.133]:80... connected.
>>HTTP request sent, awaiting response...
>>12:38:00 ERROR -1: No data received.
> 
> 
> What does it say in the apache logs?

[Tue Jan 11 06:03:25 2005] [notice] mod_python: (Re)importing rose from None
[Tue Jan 11 06:03:25 2005] [notice] mod_python: (Re)importing rose from None
[Tue Jan 11 06:03:25 2005] [notice] child pid 2243 exit signal 
Segmentation fault (11)
[Tue Jan 11 06:03:25 2005] [notice] child pid 8161 exit signal 
Segmentation fault (11)
[Tue Jan 11 06:03:33 2005] [notice] mod_python: (Re)importing rose from None
[Tue Jan 11 06:03:33 2005] [notice] child pid 2245 exit signal 
Segmentation fault (11)
From manfred.stienstra at dwerg.net  Tue Jan 11 15:37:58 2005
From: manfred.stienstra at dwerg.net (Manfred Stienstra)
Date: Tue Jan 11 15:38:06 2005
Subject: [mod_python] Mod_python quit working
In-Reply-To: <41E4318B.7080809@dan-olsen.net>
References: <41E41884.4080708@dan-olsen.net>
	<1105470673.1340.11.camel@ack.dwerg.net>
	<41E4262B.9060501@dan-olsen.net>
	<1105471676.1332.13.camel@ack.dwerg.net>
	<41E42BB0.6040201@dan-olsen.net>
	<1105473462.1336.18.camel@ack.dwerg.net>
	<41E4318B.7080809@dan-olsen.net>
Message-ID: <1105475878.1355.24.camel@ack.dwerg.net>

On Tue, 2005-01-11 at 13:05 -0700, Dan R. Olsen III wrote:
> >>>>Yes, I've restarted Apache and I have echoed a simple string and niether 
> >>>>of those have worked.

So you're able to run simple scripts, can you please tell something more
about the script that isn't working... can you eliminated any of the
imported libraries as being the cause of the crash? Have you tried
running parts of the script? Does the script (or parts of the script)
work from the commandline? Have you updated any of the libraries used in
the script?

From christopher.jackson at gmail.com  Tue Jan 11 16:23:06 2005
From: christopher.jackson at gmail.com (Chris Jackson)
Date: Tue Jan 11 16:23:08 2005
Subject: [mod_python] Session management
Message-ID: <4d11484d050111132357e697f1@mail.gmail.com>

<myconfig>
mod_python version = 3.1.3
Apache version = 2.0.52
python version = 2.4
</myconfig>

My goal is to allow the creation of multiple, separate sessions, as
well as create global variables which all sessions have access to. 
I'm having trouble understanding how to use mod_python.Session even
after looking at the available documentation.  In particular, i'm
concerned with where to put "sess = Session(req)."

I'm a little fuzzy on the memory space or variable scoping.  Apache
runs multiple threads, and there's a single embedded python
interpreter.  When multiple requests from different locations hit my
mod_python page, all these requests get processed under the same
interpreter?  I want to use sessions because I think some of the data
is being overlapped/shared between different requests, but I want data
to be rationed out in sessions and some data still shared between
sessions such as a database connection object.

Any help on this will be much appreciated.

~= Chris =~
From davidbadawi at yahoo.com  Tue Jan 11 16:48:41 2005
From: davidbadawi at yahoo.com (David Y. Badawi)
Date: Tue Jan 11 16:48:43 2005
Subject: [mod_python] Looking for interested python/mod_python expert to
	help with some contract work
In-Reply-To: <1105475878.1355.24.camel@ack.dwerg.net>
Message-ID: <20050111214841.53582.qmail@web51007.mail.yahoo.com>

Hello all,
 
Grisha Trubetskoy kindly referred me to this board to post this message.
 
I have a relatively small-what I hope is a contained project- for someone who is interested. Looking for someone who can craft efficient logic in python and use mod_python. Considering moving my in office web application to mod_python. Initially looking for an interested contractor. If all goes well, plan to send more work your way. For further info:
 
http://www.eyenova.com/icons/Project.doc
 
http://www.eyenova.com/icons/project.gif
 
Let me know by email if you are interested or have questions.
 
Thanks in advance.
 
David

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050111/aa544af3/attachment.html
From christopher.jackson at gmail.com  Tue Jan 11 16:59:46 2005
From: christopher.jackson at gmail.com (Chris Jackson)
Date: Tue Jan 11 16:59:48 2005
Subject: [mod_python] mod_python.Session returns Dictionary?
Message-ID: <4d11484d05011113595eb23b7@mail.gmail.com>

I read that mod_python.Session returns a subclass of dict.  Therefore, if I do:

sess = Session(req)

then I should be able to do: 

sess['mykey'] = myvalue right?

Furthermore if myvalue was a class with methods, then I could do:

sess['mykey'].mymethod() right?

~= Chris =~
From manfred.stienstra at dwerg.net  Tue Jan 11 17:49:27 2005
From: manfred.stienstra at dwerg.net (Manfred Stienstra)
Date: Tue Jan 11 17:49:32 2005
Subject: [mod_python] mod_python.Session returns Dictionary?
In-Reply-To: <4d11484d05011113595eb23b7@mail.gmail.com>
References: <4d11484d05011113595eb23b7@mail.gmail.com>
Message-ID: <1105483767.1332.37.camel@ack.dwerg.net>

On Tue, 2005-01-11 at 16:59 -0500, Chris Jackson wrote:
> I read that mod_python.Session returns a subclass of dict.  Therefore, if I do:
> 
> sess = Session(req)
> 
> then I should be able to do: 
> 
> sess['mykey'] = myvalue right?
> 
> Furthermore if myvalue was a class with methods, then I could do:
> 
> sess['mykey'].mymethod() right?

I think you mean an object, I don't see any reasons to put a class in
the session. But I believe you can do this as long as the class is
serializeable.

From manfred.stienstra at dwerg.net  Tue Jan 11 18:14:36 2005
From: manfred.stienstra at dwerg.net (Manfred Stienstra)
Date: Tue Jan 11 18:14:42 2005
Subject: [mod_python] Session management
In-Reply-To: <4d11484d050111132357e697f1@mail.gmail.com>
References: <4d11484d050111132357e697f1@mail.gmail.com>
Message-ID: <1105485276.1332.47.camel@ack.dwerg.net>

On Tue, 2005-01-11 at 16:23 -0500, Chris Jackson wrote:
> My goal is to allow the creation of multiple, separate sessions, as
> well as create global variables which all sessions have access to. 
> I'm having trouble understanding how to use mod_python.Session even
> after looking at the available documentation.  In particular, i'm
> concerned with where to put "sess = Session(req)."

Somewhere in your handler, but not outside the handler function.

> I'm a little fuzzy on the memory space or variable scoping.  Apache
> runs multiple threads, and there's a single embedded python
> interpreter.  When multiple requests from different locations hit my
> mod_python page, all these requests get processed under the same
> interpreter?  I want to use sessions because I think some of the data
> is being overlapped/shared between different requests, but I want data
> to be rationed out in sessions and some data still shared between
> sessions such as a database connection object.

Depending on what type of apache configuration you run, one or more
interpreters will be used. Sometimes interpreters die and new ones get
created. The general assumption is dat you will never get the same
interpreter. If you want to keep objects on an interpreter, you have to
create them in the scope of the interpreter (so outside any functions).

Word of caution: don't put things like file objects or database objects
in the session object. You never know when someone created a new
request, so that object might not be valid any more.

More on this:
http://www.modpython.org/FAQ/faqw.py?req=show&file=faq03.018.htp

For your database needs:
http://www.modpython.org/FAQ/faqw.py?req=show&file=faq03.003.htp

From christopher.jackson at gmail.com  Tue Jan 11 18:29:43 2005
From: christopher.jackson at gmail.com (Chris Jackson)
Date: Tue Jan 11 18:29:46 2005
Subject: [mod_python] Session management
In-Reply-To: <1105485276.1332.47.camel@ack.dwerg.net>
References: <4d11484d050111132357e697f1@mail.gmail.com>
	<1105485276.1332.47.camel@ack.dwerg.net>
Message-ID: <4d11484d050111152919da5412@mail.gmail.com>

Thanks.  Yes, I'm experimenting with it now.  

~= Chris =~


On Wed, 12 Jan 2005 00:14:36 +0100, Manfred Stienstra
<manfred.stienstra@dwerg.net> wrote:
> On Tue, 2005-01-11 at 16:23 -0500, Chris Jackson wrote:
> > My goal is to allow the creation of multiple, separate sessions, as
> > well as create global variables which all sessions have access to.
> > I'm having trouble understanding how to use mod_python.Session even
> > after looking at the available documentation.  In particular, i'm
> > concerned with where to put "sess = Session(req)."
> 
> Somewhere in your handler, but not outside the handler function.
> 
> > I'm a little fuzzy on the memory space or variable scoping.  Apache
> > runs multiple threads, and there's a single embedded python
> > interpreter.  When multiple requests from different locations hit my
> > mod_python page, all these requests get processed under the same
> > interpreter?  I want to use sessions because I think some of the data
> > is being overlapped/shared between different requests, but I want data
> > to be rationed out in sessions and some data still shared between
> > sessions such as a database connection object.
> 
> Depending on what type of apache configuration you run, one or more
> interpreters will be used. Sometimes interpreters die and new ones get
> created. The general assumption is dat you will never get the same
> interpreter. If you want to keep objects on an interpreter, you have to
> create them in the scope of the interpreter (so outside any functions).
> 
> Word of caution: don't put things like file objects or database objects
> in the session object. You never know when someone created a new
> request, so that object might not be valid any more.
> 
> More on this:
> http://www.modpython.org/FAQ/faqw.py?req=show&file=faq03.018.htp
> 
> For your database needs:
> http://www.modpython.org/FAQ/faqw.py?req=show&file=faq03.003.htp
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From trevor at thennion.demon.co.uk  Tue Jan 11 18:42:54 2005
From: trevor at thennion.demon.co.uk (Trevor Hennion)
Date: Tue Jan 11 18:42:58 2005
Subject: [mod_python] Looking for interested python/mod_python expert to
	help with some contract work
In-Reply-To: <20050111214841.53582.qmail@web51007.mail.yahoo.com>
References: <20050111214841.53582.qmail@web51007.mail.yahoo.com>
Message-ID: <200501112342.54691.trevor@thennion.demon.co.uk>

On Tuesday 11 January 2005 21:48, David Y. Badawi wrote:
> Hello all,
>
> Grisha Trubetskoy kindly referred me to this board to post this message.
>
> I have a relatively small-what I hope is a contained project- for someone
> who is interested. Looking for someone who can craft efficient logic in
> python and use mod_python. Considering moving my in office web application
> to mod_python. Initially looking for an interested contractor. If all goes
> well, plan to send more work your way. For further info:
>
> http://www.eyenova.com/icons/Project.doc
>
> http://www.eyenova.com/icons/project.gif
>
> Let me know by email if you are interested or have questions.
>
> Thanks in advance.
>
> David

David,

I would be very keen to program this for you. I am based in the UK, have been 
a full-time Systems Administrator for the last 4 years. Looking after 18 
servers - a mix of mainly Linux, Solaris, Aix, HP-UX and a couple of Windows 
servers, and 30 desktops and laptop users.  Recently gone to 1 day a week as 
the company were making people redundant, and I decided to try to progress 
other ideas instead of waiting for the chop. Now working from home for the 
other days.
Having been using Python as my main language - developing a project accessing 
a Mysql database. Using Postgresql on another project. Have my own network 
including Apache webserver with mod_python running on it, Mysql, Postgresql 
etc and a virtual server account with Openhosting - Grisha Trubetskoy's 
company, as that has mod_python running on it.

It is rather late here in the UK - 23:38, and I'm doing my one day a week in 
the office tomorrow. Will try and find time to consider a project plan.

Off the top of my head - the first pass should be kept simple - looking at the 
concepts to allow re-useability of code and scaleability - so several 
iterations. As I already have some small income would not be looking at too 
much for that part. Also allows you to get a feel for me. Can base some of it 
on the work I'm already doing - just need to change the db module.

Will email with some more ideas tommorrow evening - that is if you can work 
with someone in the UK?.

Regards

Trevor Hennion
http://www.infocentrality.co.uk
ps - that site has only just been put up with a lot of work still to do.
From christopher.jackson at gmail.com  Tue Jan 11 19:00:35 2005
From: christopher.jackson at gmail.com (Chris Jackson)
Date: Tue Jan 11 19:00:36 2005
Subject: [mod_python] Session management
In-Reply-To: <1105485276.1332.47.camel@ack.dwerg.net>
References: <4d11484d050111132357e697f1@mail.gmail.com>
	<1105485276.1332.47.camel@ack.dwerg.net>
Message-ID: <4d11484d050111160027353a07@mail.gmail.com>

> Depending on what type of apache configuration you run, one or more
> interpreters will be used. Sometimes interpreters die and new ones get
> created. 

Hmm...it's interesting you say that somtimes the interpreters die and
new ones get created because I'm running into a "problem" where I will
test a mod_python page and it will works perfectly several times again
and again, but then i'll test it out again, and the interpreter seems
to "forget" the values.  I'll keep testing the page with the same
values, and then the page will work again.

It's almost as if the interpreter had temporary amnesia, or was in the
process of dumping values from one interpreter into another
interpreter, which seems to happen more often than desired.

Is anyone familiar with this behavior?
From raniz at gmx.net  Tue Jan 11 20:11:54 2005
From: raniz at gmx.net (Daniel Raneland)
Date: Tue Jan 11 19:09:44 2005
Subject: [mod_python] Importing files in the same directory
Message-ID: <200501120211.54157.raniz@gmx.net>

Hi,

When trying to import a file named imagefinder.py which lies in the same 
directory as my .psp-file I get an error saying that the module does not 
exist. Importing global modules works, and the file imports OK if I invoke 
python i that dir.

/Raniz
From craig.warren at encorp.com  Tue Jan 11 19:55:57 2005
From: craig.warren at encorp.com (Craig Warren)
Date: Tue Jan 11 19:56:20 2005
Subject: [mod_python] AttributeError: 'module' object has no attribute 
Message-ID: <41E4759D.5040903@encorp.com>

I am getting the following error (only sometimes)

[Tue Jan 11 17:46:02 2005] [error] [client 10.1.3.34] PythonHandler 
mod_python.psp: AttributeError: 'module' object has no attribute 'node', 
referer: https://tsws/trane/tswsv2/admin/hardware_setup.psp

This error only happens every once in awhile, then when it happens it 
will happen a few times in a row then it will work!

I have a page called "hardware_setup.psp" that at the top imports a 
module that I have place in site-packages
site-packages files

[cwarren@lapbob site-packages]$ ls -la mod_framework/
total 60
drwxrwxr-x  2 cwarren cwarren  4096 Jan 11 17:46 .
drwxr-xr-x  7 cwarren cwarren  4096 Dec 28 13:17 ..
-rw-rw-r--  1 cwarren cwarren    52 Jan  5 09:47 __init__.py
-rw-rw-r--  1 cwarren cwarren  1297 Jan  5 09:47 mpx_exceptions.py
-rw-r--r--  1 cwarren cwarren 35780 Jan  5 09:47 node.py
-rw-rw-r--  1 cwarren cwarren   132 Jan  5 09:47 utils.py
-rw-rw-r--  1 cwarren cwarren  2261 Jan  5 09:47 xmlrpc.py

__init__.py has the following in it

[cwarren@lapbob site-packages]$ cat mod_framework/__init__.py
__all__ = ['node','xmlrpc','utils','mpx_exceptions']


My psp file has at the top
<%
import mod_framework.node
.
.
.
tsws = mod_framework.node.as_node(tsws_node)
%>

and the line that it fails on is

tsws = mod_framework.node.as_node(tsws_node)

We are using python2.4 and mod_python 3.1.3


It works a lot of the times, just sometimes it doesn't

any help would be appreciated,

Thanks,
 Craig


From ccurvey at earthlink.net  Tue Jan 11 20:01:05 2005
From: ccurvey at earthlink.net (Chris Curvey)
Date: Tue Jan 11 19:57:24 2005
Subject: [mod_python] Session management
In-Reply-To: <4d11484d050111160027353a07@mail.gmail.com>
References: <4d11484d050111132357e697f1@mail.gmail.com>	<1105485276.1332.47.camel@ack.dwerg.net>
	<4d11484d050111160027353a07@mail.gmail.com>
Message-ID: <41E476D1.3090404@earthlink.net>

Chris Jackson wrote:

>>Depending on what type of apache configuration you run, one or more
>>interpreters will be used. Sometimes interpreters die and new ones get
>>created. 
>>    
>>
>
>Hmm...it's interesting you say that somtimes the interpreters die and
>new ones get created because I'm running into a "problem" where I will
>test a mod_python page and it will works perfectly several times again
>and again, but then i'll test it out again, and the interpreter seems
>to "forget" the values.  I'll keep testing the page with the same
>values, and then the page will work again.
>
>It's almost as if the interpreter had temporary amnesia, or was in the
>process of dumping values from one interpreter into another
>interpreter, which seems to happen more often than desired.
>
>Is anyone familiar with this behavior?
>  
>
Yes, that's the hallmark of getting a different interpreter.  If you 
need to hold "state" information, you need to store it somewhere else 
(like in the session, or on the filesystem, or in a database).  In other 
words, this would be the WRONG way to do things

class Foo:
    def doFirstThing(self):
        self.firstThingDone = true

    def doSecondThing(self):
        if not self.firstThingDone:
            raise Exception
        else:
             # do real work

Because when the call comes in to doSecondThing(), you can't count on 
getting the same instance of Foo that you got when you called 
doFirstThing().

>_______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org
>http://mailman.modpython.org/mailman/listinfo/mod_python
>
>  
>

From mamading at gmail.com  Tue Jan 11 21:35:00 2005
From: mamading at gmail.com (Mamading Ceesay)
Date: Tue Jan 11 21:35:01 2005
Subject: [mod_python] Fwd: Calling Experienced UK-based
	mod_python/PostgreSQL Web Developers
In-Reply-To: <57a9359704122417491096d83c@mail.gmail.com>
References: <57a9359704122417491096d83c@mail.gmail.com>
Message-ID: <57a9359705011118357230f66e@mail.gmail.com>

Hi,

Apologies for resending this, but since it may have been overlooked
during the holiday period and people are back to work now ...

---------- Forwarded message ----------
From: Mamading Ceesay <mamading@gmail.com>
Date: Sat, 25 Dec 2004 01:49:47 +0000
Subject: Calling Experienced UK-based mod_python/PostgreSQL Web Developers
To: mod_python@modpython.org


Merry Christmas folks,

I'm looking to hear from experienced UK-based mod_python/PostgreSQL
web developers to work alongside myself as part of a team on a project
in the New Year.  We'll be looking to pay a negotiated rate to
suitable developers as well as a share of future revenues generated as
a result of the project:

We are looking for developers with the following profile:
* solid experience of building high-performance, scalable
mod_python/PostgreSQL-based web applications required
* excellent PostgreSQL database design and development skills required
* high level of Python programming proficiency required
* expertise in production-level mod_python web applications required
* ability to review existing codebase, architecture and database
schemas required
* familiarity with pyunit/doctest highly desired
* experience of Clearsilver templating desired

Please contact me directly offlist with a copy of your CV and details
of your availability.

We are not in a position to provide visas/permits, so EU residents only please.

Regards,
Mamading Ceesay
From esj at wwd.ca  Tue Jan 11 22:30:23 2005
From: esj at wwd.ca (Eric St-Jean)
Date: Tue Jan 11 22:30:34 2005
Subject: [mod_python] capturing uploaded file with progress info...
Message-ID: <41E499CF.9020909@wwd.ca>

Hi,
sorry if this is has been covered, but i tried looking through this 
mailing list and google and usenet, but couldn't find anything 
satisfactory...
i have a form, to upload a file to the server through mod_python/apache, 
on a debian stable server (apache 1.3.26-0woody6, mod_python 
2.7.8-0.0woody2, i386). it works perfectly fine.
i figured out how, when the client clicks on Submit, to get a popup to 
open which fetches a different webpage, along with state info sent with 
POST.
my idea was to get this other page to reload every x seconds, and it 
would show succintly how the upload was going (%, speed basically), just 
to give some feedback for large files.

But...

a- i have no idea - and i've really looked in a lot of places and tried 
many things! - how to get information on how much data has been 
transferred, and how much the client said there would be! actually: i 
know how much he said there would be, as i have a headerparserhandler 
which sees the Content-Length; but i don't know how to get the current 
amount of data transferred

b- in the end, i get a file object, but i can't just move it (is it a 
pipe? a socket?), so i need to make a copy; this all seems very 
wasteful, to have apache get the file, put it in a tmp place, then me in 
mod_python copy the entire file over, and later on apache deleting its 
temp file...

Through some debugging, i saw that my headerparserhandler does see the 
request as the file transfer begins, but my pythonhandler - the one 
which sees the form data, and hence the file object - only sees the 
request once the transfer is over. What's more, the client only gets the 
reply after all this is done - doing req.send_http_header and req.write 
in the headerparserhandler doesn't actually get apache to send the 
headers and the first bit of a webpage until the whole file got in.

I suspect that many of the above statements are either obvious to most 
of you, or painfully wrong... i desperately need some pointers. I would 
rather not have to go to apache 2.0 if i don't have to, but please do 
tell me if that's the only way i'll get what i want... it might be the 
kick i needed to upgrade.

can anyone give me a quick hand? a functional code example perhaps??? it 
would so immensely appreciated.

thank you very much!

-- 
______________________________
Eric St-Jean        esj@wwd.ca



From christopher.jackson at gmail.com  Tue Jan 11 22:40:49 2005
From: christopher.jackson at gmail.com (Chris Jackson)
Date: Tue Jan 11 22:40:51 2005
Subject: [mod_python] Session management
In-Reply-To: <41E476D1.3090404@earthlink.net>
References: <4d11484d050111132357e697f1@mail.gmail.com>
	<1105485276.1332.47.camel@ack.dwerg.net>
	<4d11484d050111160027353a07@mail.gmail.com>
	<41E476D1.3090404@earthlink.net>
Message-ID: <4d11484d050111194046edd6aa@mail.gmail.com>

Yes, I store the information inside of session variable, but ti's the
session variable itself that dissapears and comes back.

~= Chris =~


On Tue, 11 Jan 2005 20:01:05 -0500, Chris Curvey <ccurvey@earthlink.net> wrote:
> Chris Jackson wrote:
> 
> >>Depending on what type of apache configuration you run, one or more
> >>interpreters will be used. Sometimes interpreters die and new ones get
> >>created.
> >>
> >>
> >
> >Hmm...it's interesting you say that somtimes the interpreters die and
> >new ones get created because I'm running into a "problem" where I will
> >test a mod_python page and it will works perfectly several times again
> >and again, but then i'll test it out again, and the interpreter seems
> >to "forget" the values.  I'll keep testing the page with the same
> >values, and then the page will work again.
> >
> >It's almost as if the interpreter had temporary amnesia, or was in the
> >process of dumping values from one interpreter into another
> >interpreter, which seems to happen more often than desired.
> >
> >Is anyone familiar with this behavior?
> >
> >
> Yes, that's the hallmark of getting a different interpreter.  If you
> need to hold "state" information, you need to store it somewhere else
> (like in the session, or on the filesystem, or in a database).  In other
> words, this would be the WRONG way to do things
> 
> class Foo:
>     def doFirstThing(self):
>         self.firstThingDone = true
> 
>     def doSecondThing(self):
>         if not self.firstThingDone:
>             raise Exception
>         else:
>              # do real work
> 
> Because when the call comes in to doSecondThing(), you can't count on
> getting the same instance of Foo that you got when you called
> doFirstThing().
> 
> >_______________________________________________
> >Mod_python mailing list
> >Mod_python@modpython.org
> >http://mailman.modpython.org/mailman/listinfo/mod_python
> >
> >
> >
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From kawai at iij.ad.jp  Tue Jan 11 22:55:47 2005
From: kawai at iij.ad.jp (Hiroaki KAWAI)
Date: Tue Jan 11 22:55:51 2005
Subject: [mod_python] Session management
In-Reply-To: <4d11484d050111160027353a07@mail.gmail.com>
References: <4d11484d050111160027353a07@mail.gmail.com>
Message-ID: <200501120355.j0C3tlp6029512@jc-smtp.iij.ad.jp>

> > Depending on what type of apache configuration you run, one or more
> > interpreters will be used. Sometimes interpreters die and new ones get
> > created. 
> 
> Hmm...it's interesting you say that somtimes the interpreters die and
> new ones get created because I'm running into a "problem" where I will
> test a mod_python page and it will works perfectly several times again
> and again, but then i'll test it out again, and the interpreter seems
> to "forget" the values.  I'll keep testing the page with the same
> values, and then the page will work again.

One interpreter is created per one apache child process. If you're running 
prefork MPM (and set MaxRequestsPerChild or have multiple spare child 
servers), you're posting a HTTP request sometimes to the same interpreter, 
sometimes to other interpreter. 
I think one of 'inter-process' techniques is useful for what you're 
trying.
# If I'm saying wrong, someone please correct. :-)

---Hiroaki Kawai

From christopher.jackson at gmail.com  Wed Jan 12 00:19:50 2005
From: christopher.jackson at gmail.com (Chris Jackson)
Date: Wed Jan 12 00:19:52 2005
Subject: [mod_python] Session management
In-Reply-To: <200501120355.j0C3tlp6029512@jc-smtp.iij.ad.jp>
References: <4d11484d050111160027353a07@mail.gmail.com>
	<200501120355.j0C3tlp6029512@jc-smtp.iij.ad.jp>
Message-ID: <4d11484d05011121195e400d4b@mail.gmail.com>

Ah, that makes sense...Now I just need to find which "inter-process"
technique I should be using in order to maintain consistency ;)

~= Chris =~


On Wed, 12 Jan 2005 12:55:47 +0900, Hiroaki KAWAI <kawai@iij.ad.jp> wrote:
> > > Depending on what type of apache configuration you run, one or more
> > > interpreters will be used. Sometimes interpreters die and new ones get
> > > created.
> >
> > Hmm...it's interesting you say that somtimes the interpreters die and
> > new ones get created because I'm running into a "problem" where I will
> > test a mod_python page and it will works perfectly several times again
> > and again, but then i'll test it out again, and the interpreter seems
> > to "forget" the values.  I'll keep testing the page with the same
> > values, and then the page will work again.
> 
> One interpreter is created per one apache child process. If you're running
> prefork MPM (and set MaxRequestsPerChild or have multiple spare child
> servers), you're posting a HTTP request sometimes to the same interpreter,
> sometimes to other interpreter.
> I think one of 'inter-process' techniques is useful for what you're
> trying.
> # If I'm saying wrong, someone please correct. :-)
> 
> ---Hiroaki Kawai
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From dmkurilov at mail.ru  Wed Jan 12 01:21:17 2005
From: dmkurilov at mail.ru (=?koi8-r?Q?=E4=CD=C9=D4=D2=C9=CA=20=EB=D5=D2=C9=CC=CF=D7=20?=)
Date: Wed Jan 12 01:21:20 2005
Subject: [mod_python] sessions don't work
Message-ID: <E1Cobsb-000IxT-00.dmkurilov-mail-ru@f10.mail.ru>

Hello!

I'm getting started to learn modpython. I have done everything as said in docs.


So, I can use apache and util, but when I'd tryed to use Session:
================================================
from mod_python import apache
from mod_python import util
from mod_python import Session

def handler(req):
        sess=Session.Session(req)
        req.content_type = "text/html"
        fk = util.FieldStorage(req)
        req.write("OK")
        return apache.OK
================================================



I get error:
================================================
Mod_python error: "PythonHandler new"

Traceback (most recent call last):

  File "/usr/local/lib/python2.3/site-packages/mod_python/apache.py", line 299, in HandlerDispatch
    result = object(req)

  File "/usr/local/www/billing/new/new.py", line 23, in handler
    req.content_type = "text/html"

AttributeError: 'module' object has no attribute 'BaseSession'
================================================




Temporally, I've solve this problem by adding <input name="id" type="hidden" value="%(id)s"> in every form on site. But it's not good solution.

Please, give me an advise how to solve this problem...

Thank you,
Dmitriy Kurilov.
dmkurilov at mail . ru 
From dmkurilov at mail.ru  Wed Jan 12 07:38:01 2005
From: dmkurilov at mail.ru (Dmitriy Kurilov)
Date: Wed Jan 12 07:38:04 2005
Subject: [mod_python] sessions don't work
In-Reply-To: <E1Cobsb-000IxT-00.dmkurilov-mail-ru@f10.mail.ru>
Message-ID: <E1CohlB-000GSR-00.dmkurilov-mail-ru@f31.mail.ru>

> 
> Hello!
> 
> I'm getting started to learn modpython. I have done everything as said in docs.
> 
> 
> So, I can use apache and util, but when I'd tryed to use Session:
> ================================================
> from mod_python import apache
> from mod_python import util
> from mod_python import Session
> 
> def handler(req):
>         sess=Session.Session(req)
>         req.content_type = "text/html"
>         fk = util.FieldStorage(req)
>         req.write("OK")
>         return apache.OK
> ================================================
> 
> 
> 
> I get error:
> ================================================
> Mod_python error: "PythonHandler new"
> 
> Traceback (most recent call last):
> 
>   File "/usr/local/lib/python2.3/site-packages/mod_python/apache.py", line 299, in HandlerDispatch
>     result = object(req)
> 
>   File "/usr/local/www/billing/new/new.py", line 23, in handler
>     req.content_type = "text/html"
> 
> AttributeError: 'module' object has no attribute 'BaseSession'
> ================================================
> 
> 
> 
> 
> Temporally, I've solve this problem by adding <input name="id" type="hidden" value="%(id)s"> in every form on site. But it's not good solution.
> 
> Please, give me an advise how to solve this problem...

So, I've solved my little problem. The problem is the Apache was built without THREADS. I'd build one:
================================================
make WITH_THREADS=yes install clean
================================================
and everything began work fine. If someone  face this problem  I hope this may be usefull.

Luck!
From ron at udel.edu  Tue Jan 11 16:39:55 2005
From: ron at udel.edu (Ron Reisor)
Date: Wed Jan 12 08:52:10 2005
Subject: [mod_python] Session management
In-Reply-To: <4d11484d050111132357e697f1@mail.gmail.com>
References: <4d11484d050111132357e697f1@mail.gmail.com>
Message-ID: <Pine.OSX.4.61.0501111636020.526@zim.nss.udel.edu>

Chris,

    Make "sess" be local to your handler function.  That function is called 
to handle one request. So, create the "sess" reference early in the 
function, do stuff with it to retrieve or update information, then make 
sure you do a "sess.save()" before the handler function exits.

cheers,

Ron


On Tue, 11 Jan 2005, Chris Jackson wrote:

> <myconfig>
> mod_python version = 3.1.3
> Apache version = 2.0.52
> python version = 2.4
> </myconfig>
>
> My goal is to allow the creation of multiple, separate sessions, as
> well as create global variables which all sessions have access to.
> I'm having trouble understanding how to use mod_python.Session even
> after looking at the available documentation.  In particular, i'm
> concerned with where to put "sess = Session(req)."
>
> I'm a little fuzzy on the memory space or variable scoping.  Apache
> runs multiple threads, and there's a single embedded python
> interpreter.  When multiple requests from different locations hit my
> mod_python page, all these requests get processed under the same
> interpreter?  I want to use sessions because I think some of the data
> is being overlapped/shared between different requests, but I want data
> to be rationed out in sessions and some data still shared between
> sessions such as a database connection object.
>
> Any help on this will be much appreciated.
>
> ~= Chris =~
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>

Ron Reisor <ron@udel.edu> (RWR3)
University of Delaware Information Technologies/Network and Systems Services
Computing Center/192 South Chapel Street/Newark DE, 19716
pgp finger print: 0D 73 06 6F D3 6A 99 D3  F5 D5 6E FF 3B B9 7C 2C
From kawai at iij.ad.jp  Wed Jan 12 09:48:39 2005
From: kawai at iij.ad.jp (Hiroaki KAWAI)
Date: Wed Jan 12 09:48:46 2005
Subject: [mod_python] Session management
In-Reply-To: <4d11484d05011121195e400d4b@mail.gmail.com>
References: <4d11484d05011121195e400d4b@mail.gmail.com>
Message-ID: <200501121448.j0CEme4G020515@jc-smtp.iij.ad.jp>

Of cource, most popular and easiest way is to use Session module.
Session will store the information somewhere in 'session storage' that
the module knows how to get it, and the actual mechanism is hidden. 
# i.e., inter-process communication via file or database.

So, make sure that you save the session information to the session
storage in each request processing as Ron says. ;-)


Chris Jackson <christopher.jackson@gmail.com> wrote:
> Ah, that makes sense...Now I just need to find which "inter-process"
> technique I should be using in order to maintain consistency ;)
> 
> ~= Chris =~
> 
> 
> On Wed, 12 Jan 2005 12:55:47 +0900, Hiroaki KAWAI <kawai@iij.ad.jp> wrote:
> > > > Depending on what type of apache configuration you run, one or more
> > > > interpreters will be used. Sometimes interpreters die and new ones get
> > > > created.
> > >
> > > Hmm...it's interesting you say that somtimes the interpreters die and
> > > new ones get created because I'm running into a "problem" where I will
> > > test a mod_python page and it will works perfectly several times again
> > > and again, but then i'll test it out again, and the interpreter seems
> > > to "forget" the values.  I'll keep testing the page with the same
> > > values, and then the page will work again.
> > 
> > One interpreter is created per one apache child process. If you're running
> > prefork MPM (and set MaxRequestsPerChild or have multiple spare child
> > servers), you're posting a HTTP request sometimes to the same interpreter,
> > sometimes to other interpreter.
> > I think one of 'inter-process' techniques is useful for what you're
> > trying.
> > # If I'm saying wrong, someone please correct. :-)
> > 
> > ---Hiroaki Kawai
> > 
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >

---Hiroaki Kawai

From mdragon at rackspace.com  Wed Jan 12 17:55:00 2005
From: mdragon at rackspace.com (Monsyne Dragon)
Date: Wed Jan 12 17:57:08 2005
Subject: [mod_python] Mod_python quit working
In-Reply-To: <41E4318B.7080809@dan-olsen.net>
References: <41E41884.4080708@dan-olsen.net>	<1105470673.1340.11.camel@ack.dwerg.net>	<41E4262B.9060501@dan-olsen.net>	<1105471676.1332.13.camel@ack.dwerg.net>	<41E42BB0.6040201@dan-olsen.net>	<1105473462.1336.18.camel@ack.dwerg.net>
	<41E4318B.7080809@dan-olsen.net>
Message-ID: <41E5AAC4.1000200@rackspace.com>

Dan R. Olsen III wrote:

>
>>>>> Yes, I've restarted Apache and I have echoed a simple string and 
>>>>> niether of those have worked.
>>>>
>>>
>>>> Try getting the page with 'wget', see what headers you get back and if
>>>> there is any content.
>>>
>>>
>>> I get the following:
>>>
>>> --12:38:00--  http://dev.eclab.byu.edu/rose.py
>>>            => `rose.py'
>>> Resolving dev.eclab.byu.edu... 128.187.170.133
>>> Connecting to dev.eclab.byu.edu[128.187.170.133]:80... connected.
>>> HTTP request sent, awaiting response...
>>> 12:38:00 ERROR -1: No data received.
>>
>>
>>
>> What does it say in the apache logs?
>
>
> [Tue Jan 11 06:03:25 2005] [notice] mod_python: (Re)importing rose 
> from None
> [Tue Jan 11 06:03:25 2005] [notice] mod_python: (Re)importing rose 
> from None
> [Tue Jan 11 06:03:25 2005] [notice] child pid 2243 exit signal 
> Segmentation fault (11)
> [Tue Jan 11 06:03:25 2005] [notice] child pid 8161 exit signal 
> Segmentation fault (11)
> [Tue Jan 11 06:03:33 2005] [notice] mod_python: (Re)importing rose 
> from None
> [Tue Jan 11 06:03:33 2005] [notice] child pid 2245 exit signal 
> Segmentation fault (11)

This is likely a hardware issue.  Possibly RAM going bad, (or possibly 
even a dead CPU fan!)
When you hit the page the server process is having it's memory corrupted 
(thus the Signal 11 segfault),
and dies w/ no reply.


--   M. Dragon

From grahamd at dscpl.com.au  Wed Jan 12 18:48:15 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Jan 12 18:48:22 2005
Subject: [mod_python] Mod_python quit working
Message-ID: <1105573695.6284@dscpl.user.openhosting.com>

Monsyne Dragon wrote ..
> >> What does it say in the apache logs?
> >
> >
> > [Tue Jan 11 06:03:25 2005] [notice] mod_python: (Re)importing rose 
> > from None
> > [Tue Jan 11 06:03:25 2005] [notice] mod_python: (Re)importing rose 
> > from None
> > [Tue Jan 11 06:03:25 2005] [notice] child pid 2243 exit signal 
> > Segmentation fault (11)
> > [Tue Jan 11 06:03:25 2005] [notice] child pid 8161 exit signal 
> > Segmentation fault (11)
> > [Tue Jan 11 06:03:33 2005] [notice] mod_python: (Re)importing rose 
> > from None
> > [Tue Jan 11 06:03:33 2005] [notice] child pid 2245 exit signal 
> > Segmentation fault (11)
> 
> This is likely a hardware issue.  Possibly RAM going bad, (or possibly
> even a dead CPU fan!)
> When you hit the page the server process is having it's memory corrupted
> (thus the Signal 11 segfault),
> and dies w/ no reply.

Lets be realistic here. If there were hardware issues it is likely to manifest
randomly and not be repeatable and more than likely the operating system
as a whole would have crashed somewhat earlier than this point.

I really don't get this blaming the hardware thing. This is the second time
I have seen this recently given as a solution to a segmentation fault problem.
This isn't helpful. Do you not understand what causes segmentation faults
in the first place?

Sorry, I just had to say this and if my day was going any worse I wouldn't
have been so polite about it. :-)

Now, can we go backwards on this a bit and try and debug this in a more
sensible way.

First off, everything was supposedly working okay and then it started
having this problem. Restarts of Apache didn't appear to fix anything.
Even returning a simple string didn't appear to work.

I am making an assumption here that the simple string was being returned
from a mod_python handler. Instead of worrying about that for the moment,
can the original poster answer the following questions.

1. Does a normal static web page served up from a directory nothing to
do with the mod_python area work? If it does, then Apache itself isn't
necessarily stuffed.

2. How have you set up your httpd.conf/htaccess file to enable use of
mod_python in the directory you are accessing and is causing the problem?
Post the actual directives you put in the config file here otherwise we
would be guessing. Let us work out if you are doing anything strange.

3. If you comment out all your existing config file entries for enabling
mod_python in that directory (or any directories for that matter) and go
back to square one and in a new directory, setup a bog standard mptest.py
example as per mod_python documentation, does it work? Ie., take out
of the picture any of your own personalised handlers.

Once you have done that and if you can get a simple mptest.py working
in clean area, then looking at your particular code at what dependencies
it has would be appropriate.

Overall, segmentation faults in mod_python are more likely to be caused
by Apache, mod_python and Python being built with differing ideas of
how threading is supposed to be enabled. Another possibility is that
differing Apache extension modules have been built against different
versions of shared libraries. A good example where this often happens is
the expat library, since it can be loded by Python code running under
mod_python and PHP code running in the same Apache process. If a
different version of expat is used, something might crash if data layouts
are different.

Anyway, if the original poster can try and answer the above you might
perhaps get some more useful feedback.


From mdragon at rackspace.com  Wed Jan 12 20:31:54 2005
From: mdragon at rackspace.com (Monsyne Dragon)
Date: Wed Jan 12 20:33:48 2005
Subject: [mod_python] Mod_python quit working
In-Reply-To: <1105573695.6284@dscpl.user.openhosting.com>
References: <1105573695.6284@dscpl.user.openhosting.com>
Message-ID: <41E5CF8A.5080001@rackspace.com>

Graham Dumpleton wrote:

>Lets be realistic here. If there were hardware issues it is likely to manifest
>randomly and not be repeatable and more than likely the operating system
>as a whole would have crashed somewhat earlier than this point.
>  
>
Not really.  Such hardware glitches can manifest in exactly this way.
The canonocal example of this is a linux system which seems to work 
fine, but cannot recompile the linux kernel because gcc always dies w/ a 
sig11
(I've actually seen this, and the problem was a dying CPU fan.  
Increased CPU load caused it to overheat (but only when loaded), and the 
gcc processes became  nice fat
targets for the resultant menory glitches because of the amount,  and 
way, gcc uses memory.  To crash the OS, the sporadic glitch would have 
to hit a kernel mem structure, which is
a smaller target. )  Typically,  if this sort of thing is due to a 
hardware glitch, its due to bad memory, or overheating. Either one can 
cause sporadic memory corruption,  and if that
garbles a pointer,  then you will often get a segfault when something 
tries to dereference it.

The one BIG caveat that I must add to this, tho, is that a hardware 
glitch should only be a main suspect _IF_ (and only if) what the 
origional poster said about the situation, is true, namely that this is 
a box that has been previously working for some time, and NOTHING,  I 
mean _NOTHING_ was changed on it software-wise.  (and the usual 
suspects, like diskspace, etc, have been eliminated.)

>I really don't get this blaming the hardware thing. This is the second time
>I have seen this recently given as a solution to a segmentation fault problem.
>This isn't helpful. Do you not understand what causes segmentation faults
>in the first place?
>
>  
>
Erm, yes, I do understand segfaults quite well.   The reason it is 
mentioned in this context is that this sort of thing is not uncommon, 
especially on cheaper hardware, which, today, is most of it.

>Sorry, I just had to say this and if my day was going any worse I wouldn't
>have been so polite about it. :-)
>
>  
>
Politeness is good :>  It tends to have a way of keeping days from 
getting worse, when they are not going good.
(Message brought to you by my mom, font of all wisdom since 1967 :> )

>Now, can we go backwards on this a bit and try and debug this in a more
>sensible way.
>
>First off, everything was supposedly working okay and then it started
>having this problem. Restarts of Apache didn't appear to fix anything.
>Even returning a simple string didn't appear to work.
>
>I am making an assumption here that the simple string was being returned
>from a mod_python handler. Instead of worrying about that for the moment,
>can the original poster answer the following questions.
>
>1. Does a normal static web page served up from a directory nothing to
>do with the mod_python area work? If it does, then Apache itself isn't
>necessarily stuffed.
>
>2. How have you set up your httpd.conf/htaccess file to enable use of
>mod_python in the directory you are accessing and is causing the problem?
>Post the actual directives you put in the config file here otherwise we
>would be guessing. Let us work out if you are doing anything strange.
>
>3. If you comment out all your existing config file entries for enabling
>mod_python in that directory (or any directories for that matter) and go
>back to square one and in a new directory, setup a bog standard mptest.py
>example as per mod_python documentation, does it work? Ie., take out
>of the picture any of your own personalised handlers.
>
>Once you have done that and if you can get a simple mptest.py working
>in clean area, then looking at your particular code at what dependencies
>it has would be appropriate.
>
>Overall, segmentation faults in mod_python are more likely to be caused
>by Apache, mod_python and Python being built with differing ideas of
>how threading is supposed to be enabled. Another possibility is that
>differing Apache extension modules have been built against different
>versions of shared libraries. A good example where this often happens is
>the expat library, since it can be loded by Python code running under
>mod_python and PHP code running in the same Apache process. If a
>different version of expat is used, something might crash if data layouts
>are different.
>
>Anyway, if the original poster can try and answer the above you might
>perhaps get some more useful feedback.
>
>
>  
>
Good suggestions too.

-- M. Dragon

From craig.warren at encorp.com  Thu Jan 13 11:23:03 2005
From: craig.warren at encorp.com (Craig Warren)
Date: Thu Jan 13 11:25:19 2005
Subject: [mod_python] Cookie patch
Message-ID: <41E6A067.5070307@encorp.com>

I found an error while with Cookie module.  When the cookie module 
parses a cookie, if that cooke has $Version or $Path in it you get an 
error. My cookie is coming from a java libaray, that puts $Version and 
$Path in it.
example ="Cookie: $Version=0; pysid=34a9b38c34;$Path=/"
  

RFC 2109 mentions $Version and $Path in Section 4.4

http://www.faqs.org/rfcs/rfc2109.html

4.4  How an Origin Server Interprets the Cookie Header

   A user agent returns much of the information in the Set-Cookie header
   to the origin server when the Path attribute matches that of a new
   request.  When it receives a Cookie header, the origin server should
   treat cookies with NAMEs whose prefix is $ specially, as an attribute
   for the adjacent cookie.  The value for such a NAME is to be
   interpreted as applying to the lexically (left-to-right) most recent
   cookie whose name does not have the $ prefix.  If there is no
   previous cookie, the value applies to the cookie mechanism as a
   whole.  For example, consider the cookie

   Cookie: $Version="1"; Customer="WILE_E_COYOTE";
           $Path="/acme"

   $Version applies to the cookie mechanism as a whole (and gives the
   version number for the cookie mechanism).  $Path is an attribute
   whose value (/acme) defines the Path attribute that was used when the
   Customer cookie was defined in a Set-Cookie response header.


In Cookie.py it looks like the code was in place to deal with $Version 
and $Path, but not finished

from  _parse_cookie()
line ~321
 /*l_key = key.lower()
       
        if (l_key in valid or key[0] == '$'):
           
            # "internal" attribute, add to cookie

            if l_key == "max-age":
                l_key = "max_age"
            setattr(c, l_key, val)
*/
 The above code checks for the $, but doesn't do anything with it and in 
fact when it tries to do a setattr with $Version or $Path, you get an error.

I modified the function to be

/*l_key = key.lower()
       
        if (l_key in valid or key[0] == '$'):
           
            # "internal" attribute, add to cookie

            if l_key == "max-age":
                l_key = "max_age"
           ** if key[0] == '$':
                l_key = l_key[1:]
            setattr(c, l_key, val)*
/

Don't know if this is exactly the correct fix, but it works for me and I 
thought that I would email the list.  I tried to subscribe to 
python-dev@httpd.apache.org, but haven't gotten a response back yet, I 
CC this message to python-dev@httpd.apache.org also.

Craig Warren

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050113/8c5309fd/attachment.html
From esj at wwd.ca  Thu Jan 13 12:04:11 2005
From: esj at wwd.ca (Eric St-Jean)
Date: Thu Jan 13 12:04:09 2005
Subject: [mod_python] capturing uploaded file with progress info...
In-Reply-To: <41E499CF.9020909@wwd.ca>
References: <41E499CF.9020909@wwd.ca>
Message-ID: <41E6AA0B.2060208@wwd.ca>

answering to myself, i might have found a way: use a PUT method in the 
form to upload the file to a specific place on the server, and when the 
client's popup reloads, i just check the size of the file so far. i'd 
use an authhandler to check each PUT request to make sure i was waiting 
for it. i haven't tried it yet, but it sounds feasible.

does anyone have any comments? code examples? experiences?
it would be much appreciated...

i also saw that i could do this in mod_python 3 with an input filter, 
but i'd prefer something that works with apache 1.x as well, if i can 
help it, as many many people, including myself, have been sticking with it.

thank you!

Eric St-Jean wrote:

> i have a form, to upload a file to the server through 
> mod_python/apache, on a debian stable server (apache 1.3.26-0woody6, 
> mod_python 2.7.8-0.0woody2, i386). it works perfectly fine.

(snip)

> a- i have no idea - and i've really looked in a lot of places and 
> tried many things! - how to get information on how much data has been 
> transferred, and how much the client said there would be! actually: i 
> know how much he said there would be, as i have a headerparserhandler 
> which sees the Content-Length; but i don't know how to get the current 
> amount of data transferred
>
> b- in the end, i get a file object, but i can't just move it (is it a 
> pipe? a socket?), so i need to make a copy; this all seems very 
> wasteful, to have apache get the file, put it in a tmp place, then me 
> in mod_python copy the entire file over, and later on apache deleting 
> its temp file...

(snip)

-- 
_____________________________________________________________________
?ric St-Jean                           eric.st-jean@carmensystems.com
               Modeling Engineer, Carmen Systems Ltd.
       1800 McGill College Avenue, Montreal, QC, Canada H3A 3J6
+1(514)282-1800 ext.116 http://carmensystems.com  fax +1(514)282-1750

From nicolas.lehuen at gmail.com  Thu Jan 13 12:48:08 2005
From: nicolas.lehuen at gmail.com (Nicolas Lehuen)
Date: Thu Jan 13 12:48:10 2005
Subject: [mod_python] Cookie patch
In-Reply-To: <41E6A067.5070307@encorp.com>
References: <41E6A067.5070307@encorp.com>
Message-ID: <c298f2d7050113094866ad223c@mail.gmail.com>

On Thu, 13 Jan 2005 09:23:03 -0700, Craig Warren
<craig.warren@encorp.com> wrote:
>  I found an error while with Cookie module.  When the cookie module parses a
> cookie, if that cooke has $Version or $Path in it you get an error. My
> cookie is coming from a java libaray, that puts $Version and $Path in it.
>  example ="Cookie: $Version=0; pysid=34a9b38c34;$Path=/"
>     
>  
>  RFC 2109 mentions $Version and $Path in Section 4.4
>  http://www.faqs.org/rfcs/rfc2109.html 4.4 How an Origin Server Interprets
> the Cookie Header A user agent returns much of the information in the
> Set-Cookie header to the origin server when the Path attribute matches that
> of a new request. When it receives a Cookie header, the origin server should
> treat cookies with NAMEs whose prefix is $ specially, as an attribute for
> the adjacent cookie. The value for such a NAME is to be interpreted as
> applying to the lexically (left-to-right) most recent cookie whose name does
> not have the $ prefix. If there is no previous cookie, the value applies to
> the cookie mechanism as a whole. For example, consider the cookie Cookie:
> $Version="1"; Customer="WILE_E_COYOTE"; $Path="/acme" $Version applies to
> the cookie mechanism as a whole (and gives the version number for the cookie
> mechanism). $Path is an attribute whose value (/acme) defines the Path
> attribute that was used when the Customer cookie was defined in a Set-Cookie
> response header. In Cookie.py it looks like the code was in place to deal
> with $Version and $Path, but not finished
>  
>  from  _parse_cookie()
>  line ~321
>   l_key = key.lower()
>          
>          if (l_key in valid or key[0] == '$'):
>              
>              # "internal" attribute, add to cookie
>  
>              if l_key == "max-age":
>                  l_key = "max_age"
>              setattr(c, l_key, val)
>  
>   The above code checks for the $, but doesn't do anything with it and in
> fact when it tries to do a setattr with $Version or $Path, you get an error.
>  
>  I modified the function to be
>  
>  l_key = key.lower()
>          
>          if (l_key in valid or key[0] == '$'):
>              
>              # "internal" attribute, add to cookie
>  
>              if l_key == "max-age":
>                  l_key = "max_age"
>              if key[0] == '$':
>                  l_key = l_key[1:]
>              setattr(c, l_key, val)
>  
>  
>  Don't know if this is exactly the correct fix, but it works for me and I
> thought that I would email the list.  I tried to subscribe to
> python-dev@httpd.apache.org, but haven't gotten a response back yet, I CC
> this message to python-dev@httpd.apache.org also.
>  
>  Craig Warren

Hi,

Yeah, your fix seems correct.

The Cookie class has a metaclass which defines slots, so you cannot
have arbitrary attribute names. The only valid attributes names are
defined on line 58 ( _valid_attr =...) of Cookie.py, and the version
and path attributes do not begin with a $. So the attribute names
which are parsed in _parse_cookie() must have their initial $ removed.

The problem of the current code is that the _valid_attr check is
useless, but it's not totally spec compliant since the valid attribute
coming first (as the $Version attribute) should be applied to all
cookies. So I rewrote the whole function like this :

def _parse_cookie(str, Class):
    # XXX problem is we should allow duplicate
    # strings
    result = {}

    all_cookies_attribute = {}

    valid = Cookie._valid_attr

    c = None
    matchIter = _cookiePattern.finditer(str)

    for match in matchIter:

        key, val = match.group("key"), match.group("val")

        # we will check whether the cookie name is a valid attribute name
        # for the previous cookie.
        l_key = key.lower()
        # fix from Craig Warren
        if l_key[0]=='$':
            l_key=l_key[1:]
        if l_key == "max-age":
            l_key = "max_age"
        
        if l_key in valid:
            if not c:
                # 'global' attribute, will be added to all cookies
                all_cookies_attribute[l_key]=val
            else:
                # "internal" attribute, add to cookie
                setattr(c, l_key, val)
        else:
            # start a new cookie
            # we don't use l_key so that we keep the initial name
            # this way we are consistent with the creation of the first cookie
            # as done in the previous version of the function
            c = Class(key, val)

            # XXX this is a bit heavyweight since usually we'll have only 0 or 1
            # global attribute...
            for key, val in all_cookies_attribute.items():
                setattr(c,key,val)

            result[key] = c

    return result

Since you've already set up a testing environment, can you test this
new version of the parsing function ? If it works, I'll check it in.

Regards,
Nicolas
From nicolas.lehuen at gmail.com  Thu Jan 13 12:50:20 2005
From: nicolas.lehuen at gmail.com (Nicolas Lehuen)
Date: Thu Jan 13 12:50:23 2005
Subject: [mod_python] Cookie patch
In-Reply-To: <c298f2d7050113094866ad223c@mail.gmail.com>
References: <41E6A067.5070307@encorp.com>
	<c298f2d7050113094866ad223c@mail.gmail.com>
Message-ID: <c298f2d705011309506dcc836f@mail.gmail.com>

On Thu, 13 Jan 2005 18:48:08 +0100, Nicolas Lehuen
<nicolas.lehuen@gmail.com> wrote:
> On Thu, 13 Jan 2005 09:23:03 -0700, Craig Warren
> <craig.warren@encorp.com> wrote:
> >  I found an error while with Cookie module.  When the cookie module parses a
> > cookie, if that cooke has $Version or $Path in it you get an error. My
> > cookie is coming from a java libaray, that puts $Version and $Path in it.
> >  example ="Cookie: $Version=0; pysid=34a9b38c34;$Path=/"
> >
> >
> >  RFC 2109 mentions $Version and $Path in Section 4.4
> >  http://www.faqs.org/rfcs/rfc2109.html 4.4 How an Origin Server Interprets
> > the Cookie Header A user agent returns much of the information in the
> > Set-Cookie header to the origin server when the Path attribute matches that
> > of a new request. When it receives a Cookie header, the origin server should
> > treat cookies with NAMEs whose prefix is $ specially, as an attribute for
> > the adjacent cookie. The value for such a NAME is to be interpreted as
> > applying to the lexically (left-to-right) most recent cookie whose name does
> > not have the $ prefix. If there is no previous cookie, the value applies to
> > the cookie mechanism as a whole. For example, consider the cookie Cookie:
> > $Version="1"; Customer="WILE_E_COYOTE"; $Path="/acme" $Version applies to
> > the cookie mechanism as a whole (and gives the version number for the cookie
> > mechanism). $Path is an attribute whose value (/acme) defines the Path
> > attribute that was used when the Customer cookie was defined in a Set-Cookie
> > response header. In Cookie.py it looks like the code was in place to deal
> > with $Version and $Path, but not finished
> >
> >  from  _parse_cookie()
> >  line ~321
> >   l_key = key.lower()
> >
> >          if (l_key in valid or key[0] == '$'):
> >
> >              # "internal" attribute, add to cookie
> >
> >              if l_key == "max-age":
> >                  l_key = "max_age"
> >              setattr(c, l_key, val)
> >
> >   The above code checks for the $, but doesn't do anything with it and in
> > fact when it tries to do a setattr with $Version or $Path, you get an error.
> >
> >  I modified the function to be
> >
> >  l_key = key.lower()
> >
> >          if (l_key in valid or key[0] == '$'):
> >
> >              # "internal" attribute, add to cookie
> >
> >              if l_key == "max-age":
> >                  l_key = "max_age"
> >              if key[0] == '$':
> >                  l_key = l_key[1:]
> >              setattr(c, l_key, val)
> >
> >
> >  Don't know if this is exactly the correct fix, but it works for me and I
> > thought that I would email the list.  I tried to subscribe to
> > python-dev@httpd.apache.org, but haven't gotten a response back yet, I CC
> > this message to python-dev@httpd.apache.org also.
> >
> >  Craig Warren
> 
> Hi,
> 
> Yeah, your fix seems correct.
> 
> The Cookie class has a metaclass which defines slots, so you cannot
> have arbitrary attribute names. The only valid attributes names are
> defined on line 58 ( _valid_attr =...) of Cookie.py, and the version
> and path attributes do not begin with a $. So the attribute names
> which are parsed in _parse_cookie() must have their initial $ removed.
> 
> The problem of the current code is that the _valid_attr check is
> useless, but it's not totally spec compliant since the valid attribute
> coming first (as the $Version attribute) should be applied to all
> cookies. So I rewrote the whole function like this :
> 
> def _parse_cookie(str, Class):
>     # XXX problem is we should allow duplicate
>     # strings
>     result = {}
> 
>     all_cookies_attribute = {}
> 
>     valid = Cookie._valid_attr
> 
>     c = None
>     matchIter = _cookiePattern.finditer(str)
> 
>     for match in matchIter:
> 
>         key, val = match.group("key"), match.group("val")
> 
>         # we will check whether the cookie name is a valid attribute name
>         # for the previous cookie.
>         l_key = key.lower()
>         # fix from Craig Warren
>         if l_key[0]=='$':
>             l_key=l_key[1:]
>         if l_key == "max-age":
>             l_key = "max_age"
>         
>         if l_key in valid:
>             if not c:
>                 # 'global' attribute, will be added to all cookies
>                 all_cookies_attribute[l_key]=val
>             else:
>                 # "internal" attribute, add to cookie
>                 setattr(c, l_key, val)
>         else:
>             # start a new cookie
>             # we don't use l_key so that we keep the initial name
>             # this way we are consistent with the creation of the first cookie
>             # as done in the previous version of the function
>             c = Class(key, val)
> 
>             # XXX this is a bit heavyweight since usually we'll have only 0 or 1
>             # global attribute...
>             for key, val in all_cookies_attribute.items():
>                 setattr(c,key,val)
> 
>             result[key] = c
> 
>     return result
> 
> Since you've already set up a testing environment, can you test this
> new version of the parsing function ? If it works, I'll check it in.
> 
> Regards,
> Nicolas
> 

Woops sorry, I found a bug *before* the test... The iteration on
all_cookies_attribute at the end of the method will overwrite the key
value. So the new version is really :

def _parse_cookie(str, Class):
    # XXX problem is we should allow duplicate
    # strings
    result = {}

    all_cookies_attribute = {}

    valid = Cookie._valid_attr

    c = None
    matchIter = _cookiePattern.finditer(str)

    for match in matchIter:

        key, val = match.group("key"), match.group("val")

        # we will check whether the cookie name is a valid attribute name
        # for the previous cookie.
        l_key = key.lower()
        # fix from Craig Warren
        if l_key[0]=='$':
            l_key=l_key[1:]
        if l_key == "max-age":
            l_key = "max_age"
        
        if l_key in valid:
            if not c:
                # 'global' attribute, will be added to all cookies
                all_cookies_attribute[l_key]=val
            else:
                # "internal" attribute, add to cookie
                setattr(c, l_key, val)
        else:
            # start a new cookie
            # we don't use l_key so that we keep the initial name
            # this way we are consistent with the creation of the first cookie
            # as done in the previous version of the function
            c = Class(key, val)
            result[key] = c

            # XXX this is a bit heavyweight since usually we'll have only 0 or 1
            # global attribute...
            for key, val in all_cookies_attribute.items():
                setattr(c,key,val)

    return result
From craig.warren at encorp.com  Thu Jan 13 14:44:36 2005
From: craig.warren at encorp.com (Craig Warren)
Date: Thu Jan 13 14:49:11 2005
Subject: [mod_python] Cookie patch
In-Reply-To: <c298f2d7050113094866ad223c@mail.gmail.com>
References: <41E6A067.5070307@encorp.com>
	<c298f2d7050113094866ad223c@mail.gmail.com>
Message-ID: <41E6CFA4.4090604@encorp.com>

Skipped content of type multipart/alternative-------------- next part --------------
 #
 # Copyright 2004 Apache Software Foundation 
 # 
 # Licensed under the Apache License, Version 2.0 (the "License"); you
 # may not use this file except in compliance with the License.  You
 # may obtain a copy of the License at
 #
 #      http://www.apache.org/licenses/LICENSE-2.0
 #
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
 # implied.  See the License for the specific language governing
 # permissions and limitations under the License.
 #
 # Originally developed by Gregory Trubetskoy.
 #
 # $Id: Cookie.py,v 1.11 2004/02/16 19:47:27 grisha Exp $

"""

This module contains classes to support HTTP State Management
Mechanism, also known as Cookies. The classes provide simple
ways for creating, parsing and digitally signing cookies, as
well as the ability to store simple Python objects in Cookies
(using marshalling).

The behaviour of the classes is designed to be most useful
within mod_python applications.

The current state of HTTP State Management standardization is
rather unclear. It appears that the de-facto standard is the
original Netscape specification, even though already two RFC's
have been put out (RFC2109 (1997) and RFC2965 (2000)). The
RFC's add a couple of useful features (e.g. using Max-Age instead
of Expires, but my limited tests show that Max-Age is ignored
by the two browsers tested (IE and Safari). As a result of this,
perhaps trying to be RFC-compliant (by automatically providing
Max-Age and Version) could be a waste of cookie space...

"""

import time
import re
import hmac
import marshal
import base64

#import apache

class CookieError(Exception):
    pass

class metaCookie(type):

    def __new__(cls, clsname, bases, clsdict):

        _valid_attr = (
            "version", "path", "domain", "secure",
            "comment", "expires", "max_age",
            # RFC 2965
            "commentURL", "discard", "port",)

       # _valid_attr + property values
        # (note __slots__ is a new Python feature, it
        # prevents any other attribute from being set)
        __slots__ = _valid_attr + ("name", "value", "_value",
                                   "_expires", "__data__")

        clsdict["_valid_attr"] = _valid_attr
        clsdict["__slots__"] = __slots__

        def set_expires(self, value):

            if type(value) == type(""):
                # if it's a string, it should be
                # valid format as per Netscape spec
                try:
                    t = time.strptime(value, "%a, %d-%b-%Y %H:%M:%S GMT")
                except ValueError:
                    raise ValueError, "Invalid expires time: %s" % value
                t = time.mktime(t)
            else:
                # otherwise assume it's a number
                # representing time as from time.time()
                t = value
                value = time.strftime("%a, %d-%b-%Y %H:%M:%S GMT",
                                      time.gmtime(t))

            self._expires = "%s" % value

        def get_expires(self):
            return self._expires

        clsdict["expires"] = property(fget=get_expires, fset=set_expires)

        return type.__new__(cls, clsname, bases, clsdict)

class Cookie(object):
    """
    This class implements the basic Cookie functionality. Note that
    unlike the Python Standard Library Cookie class, this class represents
    a single cookie (not a list of Morsels).
    """

    __metaclass__ = metaCookie

    def parse(Class, str):
        """
        Parse a Cookie or Set-Cookie header value, and return
        a dict of Cookies. Note: the string should NOT include the
        header name, only the value.
        """

        dict = _parse_cookie(str, Class)
        return dict

    parse = classmethod(parse)

    def __init__(self, name, value, **kw):

        """
        This constructor takes at least a name and value as the
        arguments, as well as optionally any of allowed cookie attributes
        as defined in the existing cookie standards. 
        """
        self.name, self.value = name, value

        for k in kw:
            setattr(self, k.lower(), kw[k])

        # subclasses can use this for internal stuff
        self.__data__ = {}


    def __str__(self):

        """
        Provides the string representation of the Cookie suitable for
        sending to the browser. Note that the actual header name will
        not be part of the string.

        This method makes no attempt to automatically double-quote
        strings that contain special characters, even though the RFC's
        dictate this. This is because doing so seems to confuse most
        browsers out there.
        """
        
        result = ["%s=%s" % (self.name, self.value)]
        for name in self._valid_attr:
            if hasattr(self, name):
                if name in ("secure", "discard"):
                    result.append(name)
                else:
                    result.append("%s=%s" % (name, getattr(self, name)))
        return "; ".join(result)
    
    def __repr__(self):
        return '<%s: %s>' % (self.__class__.__name__,
                                str(self))
    

class SignedCookie(Cookie):
    """
    This is a variation of Cookie that provides automatic
    cryptographic signing of cookies and verification. It uses
    the HMAC support in the Python standard library. This ensures
    that the cookie has not been tamprered with on the client side.

    Note that this class does not encrypt cookie data, thus it
    is still plainly visible as part of the cookie.
    """

    def parse(Class, s, secret):

        dict = _parse_cookie(s, Class)

        for k in dict:
            c = dict[k]
            try:
                c.unsign(secret)
            except CookieError:
                # downgrade to Cookie
                dict[k] = Cookie.parse(Cookie.__str__(c))[k]
        
        return dict

    parse = classmethod(parse)

    def __init__(self, name, value, secret=None, **kw):
        Cookie.__init__(self, name, value, **kw)

        self.__data__["secret"] = secret

    def hexdigest(self, str):
        if not self.__data__["secret"]:
            raise CookieError, "Cannot sign without a secret"
        _hmac = hmac.new(self.__data__["secret"], self.name)
        _hmac.update(str)
        return _hmac.hexdigest()

    def __str__(self):
        
        result = ["%s=%s%s" % (self.name, self.hexdigest(self.value),
                               self.value)]
        for name in self._valid_attr:
            if hasattr(self, name):
                if name in ("secure", "discard"):
                    result.append(name)
                else:
                    result.append("%s=%s" % (name, getattr(self, name)))
        return "; ".join(result)

    def unsign(self, secret):

        sig, val = self.value[:32], self.value[32:]

        mac = hmac.new(secret, self.name)
        mac.update(val)

        if mac.hexdigest() == sig:
            self.value = val
            self.__data__["secret"] = secret
        else:
            raise CookieError, "Incorrectly Signed Cookie: %s=%s" % (self.name, self.value)


class MarshalCookie(SignedCookie):

    """
    This is a variation of SignedCookie that can store more than
    just strings. It will automatically marshal the cookie value,
    therefore any marshallable object can be used as value.

    The standard library Cookie module provides the ability to pickle
    data, which is a major security problem. It is believed that unmarshalling
    (as opposed to unpickling) is safe, yet we still err on the side of caution
    which is why this class is a subclass of SignedCooke making sure what
    we are about to unmarshal passes the digital signature test.

    Here is a link to a sugesstion that marshalling is safer than unpickling
    http://groups.google.com/groups?hl=en&lr=&ie=UTF-8&selm=7xn0hcugmy.fsf%40ruckus.brouhaha.com
    """

    def parse(Class, s, secret):

        dict = _parse_cookie(s, Class)

        for k in dict:
            c = dict[k]
            try:
                c.unmarshal(secret)
            except (CookieError, ValueError):
                # downgrade to Cookie
                dict[k] = Cookie.parse(Cookie.__str__(c))[k]

        return dict

    parse = classmethod(parse)

    def __str__(self):
        
        m = base64.encodestring(marshal.dumps(self.value))[:-1]

        result = ["%s=%s%s" % (self.name, self.hexdigest(m), m)]
        for name in self._valid_attr:
            if hasattr(self, name):
                if name in ("secure", "discard"):
                    result.append(name)
                else:
                    result.append("%s=%s" % (name, getattr(self, name)))
        return "; ".join(result)

    def unmarshal(self, secret):

        self.unsign(secret)
        self.value = marshal.loads(base64.decodestring(self.value))



# This is a simplified and in some places corrected
# (at least I think it is) pattern from standard lib Cookie.py

_cookiePattern = re.compile(
    r"(?x)"                       # Verbose pattern
    r"[,\ ]*"                        # space/comma (RFC2616 4.2) before attr-val is eaten
    r"(?P<key>"                   # Start of group 'key'
    r"[^;\ =]+"                     # anything but ';', ' ' or '='
    r")"                          # End of group 'key'
    r"\ *(=\ *)?"                 # a space, then may be "=", more space
    r"(?P<val>"                   # Start of group 'val'
    r'"(?:[^\\"]|\\.)*"'            # a doublequoted string
    r"|"                            # or
    r"[^;]*"                        # any word or empty string
    r")"                          # End of group 'val'
    r"\s*;?"                      # probably ending in a semi-colon
    )

def _parse_cookie(str, Class):
    # XXX problem is we should allow duplicate
    # strings
    result = {}
    all_cookies_attribute = {}

    valid = Cookie._valid_attr

    c = None
    matchIter = _cookiePattern.finditer(str)

    for match in matchIter:

        key, val = match.group("key"), match.group("val")

        # we will check whether the cookie name is a valid attribute name
        # for the previous cookie.
        l_key = key.lower()
        # fix from Craig Warren
        if l_key[0]=='$':
            l_key=l_key[1:]
        if l_key == "max-age":
            l_key = "max_age"
        
        if l_key in valid:
            if not c:
                # 'global' attribute, will be added to all cookies
                all_cookies_attribute[l_key]=val
            else:
                # "internal" attribute, add to cookie
                setattr(c, l_key, val)
        else:
            # start a new cookie
            # we don't use l_key so that we keep the initial name
            # this way we are consistent with the creation of the first cookie
            # as done in the previous version of the function
            c = Class(key, val)

            # XXX this is a bit heavyweight since usually we'll have only 0 or 1
            # global attribute...
            for key, val in all_cookies_attribute.items():
                setattr(c,key,val)

            result[key] = c

    return result


def _parse_cookie_new(str, Class):
    # XXX problem is we should allow duplicate
    # strings
    result = {}
    all_cookies_attribute = {}

    valid = Cookie._valid_attr

    c = None
    matchIter = _cookiePattern.finditer(str)

    for match in matchIter:

        key, val = match.group("key"), match.group("val")

        # we will check whether the cookie name is a valid attribute name
        # for the previous cookie.
        l_key = key.lower()
        # fix from Craig Warren
        if l_key[0]=='$':
            l_key=l_key[1:]
        if l_key == "max-age":
            l_key = "max_age"

        c = Class(key,l_key)
        
        if l_key in valid:
            if key[0] == '$':
                all_cookies_attribute[l_key]=val
            elif c == None:
                c = Class(key,l_key)
            else:
                setattr(c, l_key, val)
        else:
            # start a new cookie
            # we don't use l_key so that we keep the initial name
            # this way we are consistent with the creation of the first cookie
            # as done in the previous version of the function
            c = Class(key, val)

            # XXX this is a bit heavyweight since usually we'll have only 0 or 1
            # global attribute...
            for key, val in all_cookies_attribute.items():
                setattr(c,key,val)

            result[key] = c

    return result

def _parse_cookie_my(str, Class):

    # XXX problem is we should allow duplicate
    # strings
    result = {}

    # max-age is a problem because of the '-'
    # XXX there should be a more elegant way
    valid = Cookie._valid_attr + ("max-age",)

    c = None
    matchIter = _cookiePattern.finditer(str)

    for match in matchIter:

        key, val = match.group("key"), match.group("val")

        if not c:
            # new cookie
            c = Class(key, val)
            result[key] = c

        l_key = key.lower()
        
        if (l_key in valid or key[0] == '$'):
            
            # "internal" attribute, add to cookie

            if l_key == "max-age":
                l_key = "max_age"
            if key[0] == '$':
                l_key = l_key[1:]
            setattr(c, l_key, val)

        else:
            # start a new cookie
            c = Class(l_key, val)
            result[l_key] = c

    return result

def add_cookie(req, cookie, value="", **kw):
    """
    Sets a cookie in outgoing headers and adds a cache
    directive so that caches don't cache the cookie.
    """

    # is this a cookie?
    if not isinstance(cookie, Cookie):

        # make a cookie
        cookie = Cookie(cookie, value, **kw)
        
    if not req.headers_out.has_key("Set-Cookie"):
        req.headers_out.add("Cache-Control", 'no-cache="set-cookie"')

    req.headers_out.add("Set-Cookie", str(cookie))

def get_cookies(req, Class=Cookie, **kw):
    """
    A shorthand for retrieveing and parsing cookies given
    a Cookie class. The class must be one of the classes from
    this module.
    """
    
    if not req.headers_in.has_key("cookie"):
        return {}

    cookies = req.headers_in["cookie"]
    if type(cookies) == type([]):
        cookies = '; '.join(cookies)

    return Class.parse(cookies, **kw)

-------------- next part --------------
from Cookie import _parse_cookie,_parse_cookie_my,Cookie

def print_cookies(c):
    print 'Cookies'
    for k in c.keys():
        print c[k]
    print 

c1 = 'test=1;bob=1;$Version=0;$Path=/'
c2 = '$Version=0;$Path=/;test=1'
c3 = 'test=1;$Version=0;bob=1;$Path=/'

tests = [c1,c2,c3]
for t in tests:
    c = _parse_cookie(t,Cookie)
    print 'TEST'
    print ' --------------------------------------------------'
    print 'New Funtion'
    print 'Cookie:%s' % t
    print_cookies(c)

    c = _parse_cookie_my(t,Cookie)
    print 'My function Old with my fix'
    print 'Cookie:%s' % t
    print_cookies(c)
    print ' --------------------------------------------------'
    print



From nicolas.lehuen at gmail.com  Thu Jan 13 15:27:54 2005
From: nicolas.lehuen at gmail.com (Nicolas Lehuen)
Date: Thu Jan 13 15:27:56 2005
Subject: [mod_python] Cookie patch
In-Reply-To: <41E6CFA4.4090604@encorp.com>
References: <41E6A067.5070307@encorp.com>
	<c298f2d7050113094866ad223c@mail.gmail.com>
	<41E6CFA4.4090604@encorp.com>
Message-ID: <c298f2d705011312274e079159@mail.gmail.com>

On Thu, 13 Jan 2005 12:44:36 -0700, Craig Warren
<craig.warren@encorp.com> wrote:
> Not quite sure this is correct above, I have a hard time
> with the spec though..
>  
>  But the problem I see is depending on the order of the value name pairs you
> can get different results.
>  
>  The first time though the loop will always put the l_key in the
> all_cookies_attribute, then depending on the order, it will put the
> attributes of the all_cookies_attribute on the next cookies
>  
>  [cwarren@lapbob mod_python]$ python cookie_test.py
>  TEST
>   --------------------------------------------------
>  New Funtion
>  Cookie:test=1;bob=1;$Version=0;$Path=/
>  Cookies
>  test=1
>  bob=1; version=0; path=/
>   
>  My function Old with my fix
>  Cookie:test=1;bob=1;$Version=0;$Path=/
>  Cookies
>  test=1
>  bob=1; version=0; path=/
>   
>   --------------------------------------------------
>   
>  TEST
>   --------------------------------------------------
>  New Funtion
>  Cookie:$Version=0;$Path=/;test=1
>  Cookies
>  test=1; version=0; path=/
>   
>  My function Old with my fix
>  Cookie:$Version=0;$Path=/;test=1
>  Cookies
>  $Version=0; version=0; path=/
>  test=1
>   
>   --------------------------------------------------
>   
>  TEST
>   --------------------------------------------------
>  New Funtion
>  Cookie:test=1;$Version=0;bob=1;$Path=/
>  Cookies
>  test=1; version=0
>  bob=1; path=/
>   
>  My function Old with my fix
>  Cookie:test=1;$Version=0;bob=1;$Path=/
>  Cookies
>  test=1; version=0
>  bob=1; path=/
>   
>   --------------------------------------------------
>   
>  [cwarren@lapbob mod_python]$
>  
>  
>  Maybe only set the "global" attributes to all cookies if it has a "$" in
> front of it, so you would have to collect those the first time through the
> loop then add them afterwards to each Cookie.  But like I said I don't quite
> understand the spec very well.
[...]

Well, the spec is pretty thin on the subject indeed, but what I
understand is that the result MUST depend on the order in which the
attributes are written. For example :

Cookie: $Version=1;test=2;$Path=/
==> a single Cookie with key=='test', value=='2' and attributes
version=='1' and path=='/'

Cookie: $Version=1;test1=2;$Path=/;test2=3;$Path=/foo
==> two Cookies :
 - one with key=='test1', value=='2', version=='1' and path=='/'
 - one with key=='test2', value=='3', version=='1' and path=='/foo'

Cookie: test1=2;$Path=/;$Version=1;test2=3;$Path=/foo;$Version=2
==> two Cookies :
 - one with key=='test1', value=='2', version=='1' and path=='/'
 - one with key=='test2', value=='3', version=='2' and path=='/foo'

Cookie: $Version=2;$Path='/fubar';test1=2;test2=3;$Path=/foo;$Version=1;test3=4;$Path=/bar;$Version=4
==> three Cookies :
 - one with key=='test1', value=='2', version=='2' and path=='/fubar'
 - one with key=='test2', value=='3', version=='1' and path=='/foo'
 - one with key=='test3', value=='4', version=='4' and path=='/bar'

To sum up, from what I understand, attributes are written like cookies
whose name start by a dollar sign, and they apply to the rightmost
preceding cookie.

Attributes that are at the beginning of the Cookie header are 'global'
attributes, used to describe the cookie 'baking' mechanism, like the
Version attributes does. Here I chose to put those attributes in each
Cookie, since I don't see any better way to return the information to
the API user (maybe in a Cookies collection ?).

I wrote a few tests and I checked that the new function does follow
this interpretation of the RFC. The problem is that I'm not 100% sure
that it's meant to be interpreted this way... I'll check in other
Cookies implementations (in Python or Java) to make sure.

Regards,
Nicolas
From craig.warren at encorp.com  Thu Jan 13 15:36:10 2005
From: craig.warren at encorp.com (Craig Warren)
Date: Thu Jan 13 15:39:36 2005
Subject: [mod_python] Cookie patch
In-Reply-To: <c298f2d705011312274e079159@mail.gmail.com>
References: <41E6A067.5070307@encorp.com>	
	<c298f2d7050113094866ad223c@mail.gmail.com>	
	<41E6CFA4.4090604@encorp.com>
	<c298f2d705011312274e079159@mail.gmail.com>
Message-ID: <41E6DBBA.3000506@encorp.com>

Nicolas Lehuen wrote:

>On Thu, 13 Jan 2005 12:44:36 -0700, Craig Warren
><craig.warren@encorp.com> wrote:
>  
>
>>Not quite sure this is correct above, I have a hard time
>>with the spec though..
>> 
>> But the problem I see is depending on the order of the value name pairs you
>>can get different results.
>> 
>> The first time though the loop will always put the l_key in the
>>all_cookies_attribute, then depending on the order, it will put the
>>attributes of the all_cookies_attribute on the next cookies
>> 
>> [cwarren@lapbob mod_python]$ python cookie_test.py
>> TEST
>>  --------------------------------------------------
>> New Funtion
>> Cookie:test=1;bob=1;$Version=0;$Path=/
>> Cookies
>> test=1
>> bob=1; version=0; path=/
>>  
>> My function Old with my fix
>> Cookie:test=1;bob=1;$Version=0;$Path=/
>> Cookies
>> test=1
>> bob=1; version=0; path=/
>>  
>>  --------------------------------------------------
>>  
>> TEST
>>  --------------------------------------------------
>> New Funtion
>> Cookie:$Version=0;$Path=/;test=1
>> Cookies
>> test=1; version=0; path=/
>>  
>> My function Old with my fix
>> Cookie:$Version=0;$Path=/;test=1
>> Cookies
>> $Version=0; version=0; path=/
>> test=1
>>  
>>  --------------------------------------------------
>>  
>> TEST
>>  --------------------------------------------------
>> New Funtion
>> Cookie:test=1;$Version=0;bob=1;$Path=/
>> Cookies
>> test=1; version=0
>> bob=1; path=/
>>  
>> My function Old with my fix
>> Cookie:test=1;$Version=0;bob=1;$Path=/
>> Cookies
>> test=1; version=0
>> bob=1; path=/
>>  
>>  --------------------------------------------------
>>  
>> [cwarren@lapbob mod_python]$
>> 
>> 
>> Maybe only set the "global" attributes to all cookies if it has a "$" in
>>front of it, so you would have to collect those the first time through the
>>loop then add them afterwards to each Cookie.  But like I said I don't quite
>>understand the spec very well.
>>    
>>
>[...]
>
>Well, the spec is pretty thin on the subject indeed, but what I
>understand is that the result MUST depend on the order in which the
>attributes are written. For example :
>
>Cookie: $Version=1;test=2;$Path=/
>==> a single Cookie with key=='test', value=='2' and attributes
>version=='1' and path=='/'
>
>Cookie: $Version=1;test1=2;$Path=/;test2=3;$Path=/foo
>==> two Cookies :
> - one with key=='test1', value=='2', version=='1' and path=='/'
> - one with key=='test2', value=='3', version=='1' and path=='/foo'
>
>Cookie: test1=2;$Path=/;$Version=1;test2=3;$Path=/foo;$Version=2
>==> two Cookies :
> - one with key=='test1', value=='2', version=='1' and path=='/'
> - one with key=='test2', value=='3', version=='2' and path=='/foo'
>
>Cookie: $Version=2;$Path='/fubar';test1=2;test2=3;$Path=/foo;$Version=1;test3=4;$Path=/bar;$Version=4
>==> three Cookies :
> - one with key=='test1', value=='2', version=='2' and path=='/fubar'
> - one with key=='test2', value=='3', version=='1' and path=='/foo'
> - one with key=='test3', value=='4', version=='4' and path=='/bar'
>
>To sum up, from what I understand, attributes are written like cookies
>whose name start by a dollar sign, and they apply to the rightmost
>preceding cookie.
>
>Attributes that are at the beginning of the Cookie header are 'global'
>attributes, used to describe the cookie 'baking' mechanism, like the
>Version attributes does. Here I chose to put those attributes in each
>Cookie, since I don't see any better way to return the information to
>the API user (maybe in a Cookies collection ?).
>
>I wrote a few tests and I checked that the new function does follow
>this interpretation of the RFC. The problem is that I'm not 100% sure
>that it's meant to be interpreted this way... I'll check in other
>Cookies implementations (in Python or Java) to make sure.
>
>Regards,
>Nicolas
>  
>
Sounds good. I will give your new function a try and let you know,  
Thanks for your work.

Craig

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050113/adff53c9/attachment.html
From nicolas.lehuen at gmail.com  Thu Jan 13 15:45:18 2005
From: nicolas.lehuen at gmail.com (Nicolas Lehuen)
Date: Thu Jan 13 15:45:20 2005
Subject: [mod_python] Cookie patch
In-Reply-To: <c298f2d705011312274e079159@mail.gmail.com>
References: <41E6A067.5070307@encorp.com>
	<c298f2d7050113094866ad223c@mail.gmail.com>
	<41E6CFA4.4090604@encorp.com>
	<c298f2d705011312274e079159@mail.gmail.com>
Message-ID: <c298f2d7050113124537d427e0@mail.gmail.com>

I wrote :
> I wrote a few tests and I checked that the new function does follow
> this interpretation of the RFC. The problem is that I'm not 100% sure
> that it's meant to be interpreted this way... I'll check in other
> Cookies implementations (in Python or Java) to make sure.

See the getCookies() method in :

http://cvs.sourceforge.net/viewcvs.py/jetty/Jetty/src/org/mortbay/http/HttpRequest.java?rev=1.85&view=markup

This is from Jetty (http://jetty.mortbay.org/jetty/index.html), a
pretty nice HTTP server written in 100% Java, with nearly 7 years of
history...

The code uses the $version header if available as front attribute.
Other front attributes are ignored. The $path and $domain attributes
are parsed and applied to the rightmost preceding cookie. Other
attributes are just ignored

So judging from Jetty's implementation, this new parsing function does the job.

If you're OK with it I'll commit it in Subversion.

Regards,
Nicolas
From joe+gmane at sunstarsys.com  Thu Jan 13 15:56:56 2005
From: joe+gmane at sunstarsys.com (Joe Schaefer)
Date: Thu Jan 13 15:57:11 2005
Subject: [mod_python] Re: Cookie patch
References: <41E6A067.5070307@encorp.com>
	<c298f2d7050113094866ad223c@mail.gmail.com>
	<41E6CFA4.4090604@encorp.com>
	<c298f2d705011312274e079159@mail.gmail.com>
Message-ID: <87is61xd2f.fsf@gemini.sunstarsys.com>

Nicolas Lehuen <nicolas.lehuen@gmail.com>
writes: 

[...]

> Cookie: test1=2;$Path=/;$Version=1;test2=3;$Path=/foo;$Version=2
> ==> two Cookies :
>  - one with key=='test1', value=='2', version=='1' and path=='/'
>  - one with key=='test2', value=='3', version=='2' and path=='/foo'

Apologies for delurking ourside my normal domain, but the above 
test doesn't make much sense to me.  AIUI, $Version is supposed to 
describe the protocol (headers), not the individual cookies.  
Here's the 2109 BNF:

   cookie          =       "Cookie:" cookie-version
                           1*((";" | ",") cookie-value)


There's no universally-accepted way to mix Netscape cookies 
with the RFC-based ($Version=1) cookies within the same HTTP 
request.  At some point the IETF tried to produce an errata
document to address this, but IIRC failed to achieve consensus
on a resolution.


-- 
Joe Schaefer

From christopher.jackson at gmail.com  Thu Jan 13 16:35:05 2005
From: christopher.jackson at gmail.com (Chris Jackson)
Date: Thu Jan 13 16:35:08 2005
Subject: [mod_python] Session management
In-Reply-To: <200501121448.j0CEme4G020515@jc-smtp.iij.ad.jp>
References: <4d11484d05011121195e400d4b@mail.gmail.com>
	<200501121448.j0CEme4G020515@jc-smtp.iij.ad.jp>
Message-ID: <4d11484d050113133563aacc01@mail.gmail.com>

Hmm... the session object is still dropping (being lost) , the
recovered (being remember) from time to time.

Brief view of the Publisher Handler setup.
*Note the sess variable is not visible to other functions unless
declared globally.

[Global Space]
sess = None

def login(req):
   global sess
   sess = Session(req)
   sess['this']  = 'that'
   ...<more code>...
   sess.save()
   return

def otherFunc(req):
    global sess
    sess = Session(req)  # tested with and without this line (correct?)
    sess.load()
    ...<more code>...
    sess.save()
    return

I can see the session being written to a file in a serialized way in /tmp
    mp_sess.dbm.bak
    mp_sess.dbm.dat
    mp_sess.dbm.dir

I've also executed a:

    watch -d 'ls -l /tmp/mp*'

And upon creating new sessions...via separate browsers... I have seen the file
size fo the above files grow in real-time, which means that data is in
fact being added to the sessions which are partly human-readable.

However, the problem I'm having is that occasionally when
transitioning to other pages such as http://mysite.com/otherFunc,

will return 'NoneType' object has no attribute 'load'  # referring to
the sess object.

So I click the [BACK] button in the browser and re-submit the data. 
After about 7 times, the script all of a sudden recognizes the sess
object.  Sometimes this error does not happend and loads on the first
try. How can I prevent this behavior?

~= Chris =~


On Wed, 12 Jan 2005 23:48:39 +0900, Hiroaki KAWAI <kawai@iij.ad.jp> wrote:
> Of cource, most popular and easiest way is to use Session module.
> Session will store the information somewhere in 'session storage' that
> the module knows how to get it, and the actual mechanism is hidden.
> # i.e., inter-process communication via file or database.
> 
> So, make sure that you save the session information to the session
> storage in each request processing as Ron says. ;-)
> 
> 
> Chris Jackson <christopher.jackson@gmail.com> wrote:
> > Ah, that makes sense...Now I just need to find which "inter-process"
> > technique I should be using in order to maintain consistency ;)
> >
> > ~= Chris =~
> >
> >
> > On Wed, 12 Jan 2005 12:55:47 +0900, Hiroaki KAWAI <kawai@iij.ad.jp> wrote:
> > > > > Depending on what type of apache configuration you run, one or more
> > > > > interpreters will be used. Sometimes interpreters die and new ones get
> > > > > created.
> > > >
> > > > Hmm...it's interesting you say that somtimes the interpreters die and
> > > > new ones get created because I'm running into a "problem" where I will
> > > > test a mod_python page and it will works perfectly several times again
> > > > and again, but then i'll test it out again, and the interpreter seems
> > > > to "forget" the values.  I'll keep testing the page with the same
> > > > values, and then the page will work again.
> > >
> > > One interpreter is created per one apache child process. If you're running
> > > prefork MPM (and set MaxRequestsPerChild or have multiple spare child
> > > servers), you're posting a HTTP request sometimes to the same interpreter,
> > > sometimes to other interpreter.
> > > I think one of 'inter-process' techniques is useful for what you're
> > > trying.
> > > # If I'm saying wrong, someone please correct. :-)
> > >
> > > ---Hiroaki Kawai
> > >
> > > _______________________________________________
> > > Mod_python mailing list
> > > Mod_python@modpython.org
> > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > >
> 
> ---Hiroaki Kawai
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From terry.macdonald at dsl.pipex.com  Thu Jan 13 18:26:08 2005
From: terry.macdonald at dsl.pipex.com (Terry MacDonald)
Date: Thu Jan 13 18:26:12 2005
Subject: [mod_python] Mod_python quit working
In-Reply-To: <41E5CF8A.5080001@rackspace.com>
References: <1105573695.6284@dscpl.user.openhosting.com>
	<41E5CF8A.5080001@rackspace.com>
Message-ID: <1105658768.8224.8.camel@bigmac.taumu.com>

Skipped content of type multipart/alternative-------------- next part --------------
A non-text attachment was scrubbed...
Name: rule-blue-right.png
Type: image/png
Size: 207 bytes
Desc: not available
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050113/43f42ce9/rule-blue-right-0001.png
-------------- next part --------------
A non-text attachment was scrubbed...
Name: transparent.png
Type: image/png
Size: 144 bytes
Desc: not available
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050113/43f42ce9/transparent-0001.png
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rule-blue-center.png
Type: image/png
Size: 160 bytes
Desc: not available
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050113/43f42ce9/rule-blue-center-0001.png
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rule-blue-left.png
Type: image/png
Size: 207 bytes
Desc: not available
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050113/43f42ce9/rule-blue-left-0001.png
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smiley-3.png
Type: image/png
Size: 819 bytes
Desc: not available
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050113/43f42ce9/smiley-3-0001.png
From kawai at iij.ad.jp  Fri Jan 14 00:22:50 2005
From: kawai at iij.ad.jp (Hiroaki KAWAI)
Date: Fri Jan 14 00:22:56 2005
Subject: [mod_python] Session management
In-Reply-To: <4d11484d050113133563aacc01@mail.gmail.com>
References: <4d11484d050113133563aacc01@mail.gmail.com>
Message-ID: <200501140522.j0E5MpOc026875@jc-smtp.iij.ad.jp>

Please don't put sess in global scope as Manfred Stienstra mentioned 
previously. That scope is module scope, one in one interpreter.

Every function that use session would be like this:

def func(req):
	sess=Session(req) # you always need this line.
	sess.load()
	# do something
	sess.save()
	return "something"

The problem you encountered was:
- send request to httpd
- new python interpreter is created (httpd child process 
  is creatated)
- your python module for Publisher Handler loaded.
- call otherFunc at the first time.
- if you drop "sess=Session(req)", sess.load() is passed, which means
  NoneType type ojbect method call.


> Hmm... the session object is still dropping (being lost) , the
> recovered (being remember) from time to time.
> 
> Brief view of the Publisher Handler setup.
> *Note the sess variable is not visible to other functions unless
> declared globally.
> 
> [Global Space]
> sess = None
> 
> def login(req):
>    global sess
>    sess = Session(req)
>    sess['this']  = 'that'
>    ...<more code>...
>    sess.save()
>    return
> 
> def otherFunc(req):
>     global sess
>     sess = Session(req)  # tested with and without this line (correct?)
>     sess.load()
>     ...<more code>...
>     sess.save()
>     return
> 
> I can see the session being written to a file in a serialized way in /tmp
>     mp_sess.dbm.bak
>     mp_sess.dbm.dat
>     mp_sess.dbm.dir
> 
> I've also executed a:
> 
>     watch -d 'ls -l /tmp/mp*'
> 
> And upon creating new sessions...via separate browsers... I have seen the file
> size fo the above files grow in real-time, which means that data is in
> fact being added to the sessions which are partly human-readable.
> 
> However, the problem I'm having is that occasionally when
> transitioning to other pages such as http://mysite.com/otherFunc,
> 
> will return 'NoneType' object has no attribute 'load'  # referring to
> the sess object.
> 
> So I click the [BACK] button in the browser and re-submit the data. 
> After about 7 times, the script all of a sudden recognizes the sess
> object.  Sometimes this error does not happend and loads on the first
> try. How can I prevent this behavior?
> 
> ~= Chris =~
> 
> 
> On Wed, 12 Jan 2005 23:48:39 +0900, Hiroaki KAWAI <kawai@iij.ad.jp> wrote:
> > Of cource, most popular and easiest way is to use Session module.
> > Session will store the information somewhere in 'session storage' that
> > the module knows how to get it, and the actual mechanism is hidden.
> > # i.e., inter-process communication via file or database.
> > 
> > So, make sure that you save the session information to the session
> > storage in each request processing as Ron says. ;-)
> > 
> > 
> > Chris Jackson <christopher.jackson@gmail.com> wrote:
> > > Ah, that makes sense...Now I just need to find which "inter-process"
> > > technique I should be using in order to maintain consistency ;)
> > >
> > > ~= Chris =~
> > >
> > >
> > > On Wed, 12 Jan 2005 12:55:47 +0900, Hiroaki KAWAI <kawai@iij.ad.jp> wrote:
> > > > > > Depending on what type of apache configuration you run, one or more
> > > > > > interpreters will be used. Sometimes interpreters die and new ones get
> > > > > > created.
> > > > >
> > > > > Hmm...it's interesting you say that somtimes the interpreters die and
> > > > > new ones get created because I'm running into a "problem" where I will
> > > > > test a mod_python page and it will works perfectly several times again
> > > > > and again, but then i'll test it out again, and the interpreter seems
> > > > > to "forget" the values.  I'll keep testing the page with the same
> > > > > values, and then the page will work again.
> > > >
> > > > One interpreter is created per one apache child process. If you're running
> > > > prefork MPM (and set MaxRequestsPerChild or have multiple spare child
> > > > servers), you're posting a HTTP request sometimes to the same interpreter,
> > > > sometimes to other interpreter.
> > > > I think one of 'inter-process' techniques is useful for what you're
> > > > trying.
> > > > # If I'm saying wrong, someone please correct. :-)
> > > >
> > > > ---Hiroaki Kawai
> > > >
> > > > _______________________________________________
> > > > Mod_python mailing list
> > > > Mod_python@modpython.org
> > > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > > >
> > 
> > ---Hiroaki Kawai
> > 
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >

From nicolas.lehuen at gmail.com  Fri Jan 14 02:03:56 2005
From: nicolas.lehuen at gmail.com (Nicolas Lehuen)
Date: Fri Jan 14 02:03:59 2005
Subject: [mod_python] Re: Cookie patch
In-Reply-To: <87is61xd2f.fsf@gemini.sunstarsys.com>
References: <41E6A067.5070307@encorp.com>
	<c298f2d7050113094866ad223c@mail.gmail.com>
	<41E6CFA4.4090604@encorp.com>
	<c298f2d705011312274e079159@mail.gmail.com>
	<87is61xd2f.fsf@gemini.sunstarsys.com>
Message-ID: <c298f2d7050113230331cafab8@mail.gmail.com>

On Thu, 13 Jan 2005 15:56:56 -0500, Joe Schaefer
<joe+gmane@sunstarsys.com> wrote:
> Nicolas Lehuen <nicolas.lehuen@gmail.com>
> writes:
> 
> [...]
> 
> > Cookie: test1=2;$Path=/;$Version=1;test2=3;$Path=/foo;$Version=2
> > ==> two Cookies :
> >  - one with key=='test1', value=='2', version=='1' and path=='/'
> >  - one with key=='test2', value=='3', version=='2' and path=='/foo'
> 
> Apologies for delurking ourside my normal domain, but the above
> test doesn't make much sense to me.  AIUI, $Version is supposed to
> describe the protocol (headers), not the individual cookies.
> Here's the 2109 BNF:
> 
>    cookie          =       "Cookie:" cookie-version
>                            1*((";" | ",") cookie-value)

Yeah, the test doesn't makes sense, it was just to check the algorithm
and the fact that you could define multiple attributes for the same
cookie. I should have used $domain instead :

Cookie: test1=2;$Path=/;$Domain=foo.com;test2=3;$Path=/foo;$Domain=bar.foo.com
==> two Cookies :
 - one with key=='test1', value=='2', domain=='foo.com' and path=='/'
 - one with key=='test2', value=='3', domain=='bar.foo.com' and path=='/foo'

You've got a point here : both the new and old _parse_cookie function
do not follow the BNF definition :

   cookie          =       "Cookie:" cookie-version
                           1*((";" | ",") cookie-value)
   cookie-value    =       NAME "=" VALUE [";" path] [";" domain]
   cookie-version  =       "$Version" "=" value
   NAME            =       attr
   VALUE           =       value
   path            =       "$Path" "=" value
   domain          =       "$Domain" "=" value

Looking from this definition,  only $Path and $Domain attributes are
allowed. mod_python accepts more attributes. The question is, should
we be liberal in what we accept (and strict  in what we produce, of
course) ? I think so.

> There's no universally-accepted way to mix Netscape cookies
> with the RFC-based ($Version=1) cookies within the same HTTP
> request.  At some point the IETF tried to produce an errata
> document to address this, but IIRC failed to achieve consensus
> on a resolution.

That's another reason to be as liberal as we can without breaking anything.

Regards,
Nicolas
From bl at netgroup.dk  Fri Jan 14 01:36:39 2005
From: bl at netgroup.dk (Bo Lorentsen)
Date: Fri Jan 14 02:42:46 2005
Subject: [mod_python] Mod_python quit working
In-Reply-To: <1105573695.6284@dscpl.user.openhosting.com>
References: <1105573695.6284@dscpl.user.openhosting.com>
Message-ID: <41E76877.3080300@netgroup.dk>

Graham Dumpleton wrote:

>Now, can we go backwards on this a bit and try and debug this in a more
>sensible way.
>  
>
Hi, I have tried the same problem too ... and the reason was a conflict 
between too versions of libs (indirect loaded by python modules), loaded 
into apache.

So my first question must be ... how does a simple "hello, world" work, 
and if it work, what kind of module do you import ?

/BL

From joe+gmane at sunstarsys.com  Fri Jan 14 09:06:45 2005
From: joe+gmane at sunstarsys.com (Joe Schaefer)
Date: Fri Jan 14 09:06:53 2005
Subject: [mod_python] Re: Cookie patch
References: <41E6A067.5070307@encorp.com>
	<c298f2d7050113094866ad223c@mail.gmail.com>
	<41E6CFA4.4090604@encorp.com>
	<c298f2d705011312274e079159@mail.gmail.com>
	<87is61xd2f.fsf@gemini.sunstarsys.com>
	<c298f2d7050113230331cafab8@mail.gmail.com>
Message-ID: <87acrcksui.fsf@gemini.sunstarsys.com>

Nicolas Lehuen <nicolas.lehuen@gmail.com>
writes: 

[...]

> Looking from this definition,  only $Path and $Domain attributes are
> allowed. mod_python accepts more attributes. The question is, should
> we be liberal in what we accept (and strict  in what we produce, of
> course) ? I think so.

+1.  RFC 2965 (which supercedes 2109) defines a few additional attributes.

>> There's no universally-accepted way to mix Netscape cookies
>> with the RFC-based ($Version=1) cookies within the same HTTP
>> request.  At some point the IETF tried to produce an errata
>> document to address this, but IIRC failed to achieve consensus
>> on a resolution.
>
> That's another reason to be as liberal as we can without breaking
> anything. 

True enough.  There are also a few security-related comments
in the specs that you might want to factor in, but simply doing 
what other implementations do (jetty, or zope perhaps) is a good 
plan. Though as you might guess, I'd still like to see apreq become
useable by mod_python hackers someday ;-).

-- 
Joe Schaefer

From grisha at modpython.org  Fri Jan 14 13:02:26 2005
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan 14 13:02:47 2005
Subject: [mod_python] Cookie patch
In-Reply-To: <c298f2d7050113094866ad223c@mail.gmail.com>
References: <41E6A067.5070307@encorp.com>
	<c298f2d7050113094866ad223c@mail.gmail.com>
Message-ID: <20050114125845.C66431@grisha.dyndns.org>


Just a sidenote on this cookie stuff - just because there is an RFC, 
doesn't mean there is a standard, I had to learn this the hard way.

When making changes to the cookie code we need to make sure it actually 
works, rather than is RFC compliant, which is easier said than done. Most 
browsers out there only support the Netscape cookies (not the RFC) and the 
Netscape "standard" leaves some things to interpretation so behavior at 
times varies between browsers.

Grisha



On Thu, 13 Jan 2005, Nicolas Lehuen wrote:

> On Thu, 13 Jan 2005 09:23:03 -0700, Craig Warren
> <craig.warren@encorp.com> wrote:
>>  I found an error while with Cookie module.  When the cookie module parses a
>> cookie, if that cooke has $Version or $Path in it you get an error. My
>> cookie is coming from a java libaray, that puts $Version and $Path in it.
>>  example ="Cookie: $Version=0; pysid=34a9b38c34;$Path=/"
>>
>>
>>  RFC 2109 mentions $Version and $Path in Section 4.4
>>  http://www.faqs.org/rfcs/rfc2109.html 4.4 How an Origin Server Interprets
>> the Cookie Header A user agent returns much of the information in the
>> Set-Cookie header to the origin server when the Path attribute matches that
>> of a new request. When it receives a Cookie header, the origin server should
>> treat cookies with NAMEs whose prefix is $ specially, as an attribute for
>> the adjacent cookie. The value for such a NAME is to be interpreted as
>> applying to the lexically (left-to-right) most recent cookie whose name does
>> not have the $ prefix. If there is no previous cookie, the value applies to
>> the cookie mechanism as a whole. For example, consider the cookie Cookie:
>> $Version="1"; Customer="WILE_E_COYOTE"; $Path="/acme" $Version applies to
>> the cookie mechanism as a whole (and gives the version number for the cookie
>> mechanism). $Path is an attribute whose value (/acme) defines the Path
>> attribute that was used when the Customer cookie was defined in a Set-Cookie
>> response header. In Cookie.py it looks like the code was in place to deal
>> with $Version and $Path, but not finished
>>
>>  from  _parse_cookie()
>>  line ~321
>>   l_key = key.lower()
>>
>>          if (l_key in valid or key[0] == '$'):
>>
>>              # "internal" attribute, add to cookie
>>
>>              if l_key == "max-age":
>>                  l_key = "max_age"
>>              setattr(c, l_key, val)
>>
>>   The above code checks for the $, but doesn't do anything with it and in
>> fact when it tries to do a setattr with $Version or $Path, you get an error.
>>
>>  I modified the function to be
>>
>>  l_key = key.lower()
>>
>>          if (l_key in valid or key[0] == '$'):
>>
>>              # "internal" attribute, add to cookie
>>
>>              if l_key == "max-age":
>>                  l_key = "max_age"
>>              if key[0] == '$':
>>                  l_key = l_key[1:]
>>              setattr(c, l_key, val)
>>
>>
>>  Don't know if this is exactly the correct fix, but it works for me and I
>> thought that I would email the list.  I tried to subscribe to
>> python-dev@httpd.apache.org, but haven't gotten a response back yet, I CC
>> this message to python-dev@httpd.apache.org also.
>>
>>  Craig Warren
>
> Hi,
>
> Yeah, your fix seems correct.
>
> The Cookie class has a metaclass which defines slots, so you cannot
> have arbitrary attribute names. The only valid attributes names are
> defined on line 58 ( _valid_attr =...) of Cookie.py, and the version
> and path attributes do not begin with a $. So the attribute names
> which are parsed in _parse_cookie() must have their initial $ removed.
>
> The problem of the current code is that the _valid_attr check is
> useless, but it's not totally spec compliant since the valid attribute
> coming first (as the $Version attribute) should be applied to all
> cookies. So I rewrote the whole function like this :
>
> def _parse_cookie(str, Class):
>    # XXX problem is we should allow duplicate
>    # strings
>    result = {}
>
>    all_cookies_attribute = {}
>
>    valid = Cookie._valid_attr
>
>    c = None
>    matchIter = _cookiePattern.finditer(str)
>
>    for match in matchIter:
>
>        key, val = match.group("key"), match.group("val")
>
>        # we will check whether the cookie name is a valid attribute name
>        # for the previous cookie.
>        l_key = key.lower()
>        # fix from Craig Warren
>        if l_key[0]=='$':
>            l_key=l_key[1:]
>        if l_key == "max-age":
>            l_key = "max_age"
>
>        if l_key in valid:
>            if not c:
>                # 'global' attribute, will be added to all cookies
>                all_cookies_attribute[l_key]=val
>            else:
>                # "internal" attribute, add to cookie
>                setattr(c, l_key, val)
>        else:
>            # start a new cookie
>            # we don't use l_key so that we keep the initial name
>            # this way we are consistent with the creation of the first cookie
>            # as done in the previous version of the function
>            c = Class(key, val)
>
>            # XXX this is a bit heavyweight since usually we'll have only 0 or 1
>            # global attribute...
>            for key, val in all_cookies_attribute.items():
>                setattr(c,key,val)
>
>            result[key] = c
>
>    return result
>
> Since you've already set up a testing environment, can you test this
> new version of the parsing function ? If it works, I'll check it in.
>
> Regards,
> Nicolas
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From christopher.jackson at gmail.com  Fri Jan 14 13:31:56 2005
From: christopher.jackson at gmail.com (Chris Jackson)
Date: Fri Jan 14 13:31:59 2005
Subject: [mod_python] Session management
In-Reply-To: <200501140522.j0E5MpOc026875@jc-smtp.iij.ad.jp>
References: <4d11484d050113133563aacc01@mail.gmail.com>
	<200501140522.j0E5MpOc026875@jc-smtp.iij.ad.jp>
Message-ID: <4d11484d05011410316dd03b33@mail.gmail.com>

This seems correct however, if in "func" I create a session {key:value}

...
e.g. sess['mykey'] = myvalue
sess.save()
...

Then, when I get to "otherFunc" and try to access sess['mykey'], 
I get a KeyError because it has created a new sess object.

The solution I'm trying to do now is pass around the sess.id() to each function,
and then create new sessions based on this sess.id()

sess = Session(req, sessid, None, 1800, 1)

Unless there is some other way so that I do not get KeyErrors.  Also
note that at the end of each function i'm using
req.internal_redirect(...). I don't know if the internal_redirect is a
problem or not.

~= Chris =~


On Fri, 14 Jan 2005 14:22:50 +0900, Hiroaki KAWAI <kawai@iij.ad.jp> wrote:
> Please don't put sess in global scope as Manfred Stienstra mentioned
> previously. That scope is module scope, one in one interpreter.
> 
> Every function that use session would be like this:
> 
> def func(req):
>         sess=Session(req) # you always need this line.
>         sess.load()
>         # do something
>         sess.save()
>         return "something"
> 
> The problem you encountered was:
> - send request to httpd
> - new python interpreter is created (httpd child process
>   is creatated)
> - your python module for Publisher Handler loaded.
> - call otherFunc at the first time.
> - if you drop "sess=Session(req)", sess.load() is passed, which means
>   NoneType type ojbect method call.
> 
> 
> > Hmm... the session object is still dropping (being lost) , the
> > recovered (being remember) from time to time.
> >
> > Brief view of the Publisher Handler setup.
> > *Note the sess variable is not visible to other functions unless
> > declared globally.
> >
> > [Global Space]
> > sess = None
> >
> > def login(req):
> >    global sess
> >    sess = Session(req)
> >    sess['this']  = 'that'
> >    ...<more code>...
> >    sess.save()
> >    return
> >
> > def otherFunc(req):
> >     global sess
> >     sess = Session(req)  # tested with and without this line (correct?)
> >     sess.load()
> >     ...<more code>...
> >     sess.save()
> >     return
> >
> > I can see the session being written to a file in a serialized way in /tmp
> >     mp_sess.dbm.bak
> >     mp_sess.dbm.dat
> >     mp_sess.dbm.dir
> >
> > I've also executed a:
> >
> >     watch -d 'ls -l /tmp/mp*'
> >
> > And upon creating new sessions...via separate browsers... I have seen the file
> > size fo the above files grow in real-time, which means that data is in
> > fact being added to the sessions which are partly human-readable.
> >
> > However, the problem I'm having is that occasionally when
> > transitioning to other pages such as http://mysite.com/otherFunc,
> >
> > will return 'NoneType' object has no attribute 'load'  # referring to
> > the sess object.
> >
> > So I click the [BACK] button in the browser and re-submit the data.
> > After about 7 times, the script all of a sudden recognizes the sess
> > object.  Sometimes this error does not happend and loads on the first
> > try. How can I prevent this behavior?
> >
> > ~= Chris =~
> >
> >
> > On Wed, 12 Jan 2005 23:48:39 +0900, Hiroaki KAWAI <kawai@iij.ad.jp> wrote:
> > > Of cource, most popular and easiest way is to use Session module.
> > > Session will store the information somewhere in 'session storage' that
> > > the module knows how to get it, and the actual mechanism is hidden.
> > > # i.e., inter-process communication via file or database.
> > >
> > > So, make sure that you save the session information to the session
> > > storage in each request processing as Ron says. ;-)
> > >
> > >
> > > Chris Jackson <christopher.jackson@gmail.com> wrote:
> > > > Ah, that makes sense...Now I just need to find which "inter-process"
> > > > technique I should be using in order to maintain consistency ;)
> > > >
> > > > ~= Chris =~
> > > >
> > > >
> > > > On Wed, 12 Jan 2005 12:55:47 +0900, Hiroaki KAWAI <kawai@iij.ad.jp> wrote:
> > > > > > > Depending on what type of apache configuration you run, one or more
> > > > > > > interpreters will be used. Sometimes interpreters die and new ones get
> > > > > > > created.
> > > > > >
> > > > > > Hmm...it's interesting you say that somtimes the interpreters die and
> > > > > > new ones get created because I'm running into a "problem" where I will
> > > > > > test a mod_python page and it will works perfectly several times again
> > > > > > and again, but then i'll test it out again, and the interpreter seems
> > > > > > to "forget" the values.  I'll keep testing the page with the same
> > > > > > values, and then the page will work again.
> > > > >
> > > > > One interpreter is created per one apache child process. If you're running
> > > > > prefork MPM (and set MaxRequestsPerChild or have multiple spare child
> > > > > servers), you're posting a HTTP request sometimes to the same interpreter,
> > > > > sometimes to other interpreter.
> > > > > I think one of 'inter-process' techniques is useful for what you're
> > > > > trying.
> > > > > # If I'm saying wrong, someone please correct. :-)
> > > > >
> > > > > ---Hiroaki Kawai
> > > > >
> > > > > _______________________________________________
> > > > > Mod_python mailing list
> > > > > Mod_python@modpython.org
> > > > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > > > >
> > >
> > > ---Hiroaki Kawai
> > >
> > > _______________________________________________
> > > Mod_python mailing list
> > > Mod_python@modpython.org
> > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > >
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From christopher.jackson at gmail.com  Fri Jan 14 17:06:59 2005
From: christopher.jackson at gmail.com (Chris Jackson)
Date: Fri Jan 14 17:07:02 2005
Subject: [mod_python] Session management
In-Reply-To: <4d11484d05011410316dd03b33@mail.gmail.com>
References: <4d11484d050113133563aacc01@mail.gmail.com>
	<200501140522.j0E5MpOc026875@jc-smtp.iij.ad.jp>
	<4d11484d05011410316dd03b33@mail.gmail.com>
Message-ID: <4d11484d05011414063dabad4f@mail.gmail.com>

Okay, after playing with passing the session id around, I have been
making successful progress.

A couple of observations....

1. As stated earlier, whenever I perform a sess = Session(req), a
new session is created with new values.  But I only want this to happen once;
Subsequent calls to Session(...) should use the previous session
values. Inter-process techniques which Session() makes transparent via
file processes/pickling is good at this, except I need the correct
session id in order to use the same session.

2. I added a sessid parameter to my handler functions so that when the
handler gets called a sessid will be passed to it, so that

sess = Session(req, sessid, None, 1800, 0) 

works.  Also, note the 0 for the lock.  Attempting to put this value
to a 1 results in the page hanging because only one session object is
allowed to be instantiated at a time, but I have multiple objects
floating around.

3. The first called to otherFunc(..., sessid=""), I can insert the
sessid manually,
but if I attempt to do this through a user input form...I run into a
problem.  The solution I used is to create an <input type="hidden"...>
field, with a value of the sessid being passed through the PSP
template.

<input type="hidden" name="sessid" value="<%=sessid%>">

And of course this PSP template uses POST so that no one can steal a
session id and hence a session.

This seems to be working for me, for the results I'm looking for.  If
I have holes or if I've overlooked something, then please offer a
critique.

Thanks for all the help and comments.

~= Chris =~ 


On Fri, 14 Jan 2005 13:31:56 -0500, Chris Jackson
<christopher.jackson@gmail.com> wrote:
> This seems correct however, if in "func" I create a session {key:value}
> 
> ...
> e.g. sess['mykey'] = myvalue
> sess.save()
> ...
> 
> Then, when I get to "otherFunc" and try to access sess['mykey'],
> I get a KeyError because it has created a new sess object.
> 
> The solution I'm trying to do now is pass around the sess.id() to each function,
> and then create new sessions based on this sess.id()
> 
> sess = Session(req, sessid, None, 1800, 1)
> 
> Unless there is some other way so that I do not get KeyErrors.  Also
> note that at the end of each function i'm using
> req.internal_redirect(...). I don't know if the internal_redirect is a
> problem or not.
> 
> ~= Chris =~
> 
> 
> On Fri, 14 Jan 2005 14:22:50 +0900, Hiroaki KAWAI <kawai@iij.ad.jp> wrote:
> > Please don't put sess in global scope as Manfred Stienstra mentioned
> > previously. That scope is module scope, one in one interpreter.
> >
> > Every function that use session would be like this:
> >
> > def func(req):
> >         sess=Session(req) # you always need this line.
> >         sess.load()
> >         # do something
> >         sess.save()
> >         return "something"
> >
> > The problem you encountered was:
> > - send request to httpd
> > - new python interpreter is created (httpd child process
> >   is creatated)
> > - your python module for Publisher Handler loaded.
> > - call otherFunc at the first time.
> > - if you drop "sess=Session(req)", sess.load() is passed, which means
> >   NoneType type ojbect method call.
> >
> >
> > > Hmm... the session object is still dropping (being lost) , the
> > > recovered (being remember) from time to time.
> > >
> > > Brief view of the Publisher Handler setup.
> > > *Note the sess variable is not visible to other functions unless
> > > declared globally.
> > >
> > > [Global Space]
> > > sess = None
> > >
> > > def login(req):
> > >    global sess
> > >    sess = Session(req)
> > >    sess['this']  = 'that'
> > >    ...<more code>...
> > >    sess.save()
> > >    return
> > >
> > > def otherFunc(req):
> > >     global sess
> > >     sess = Session(req)  # tested with and without this line (correct?)
> > >     sess.load()
> > >     ...<more code>...
> > >     sess.save()
> > >     return
> > >
> > > I can see the session being written to a file in a serialized way in /tmp
> > >     mp_sess.dbm.bak
> > >     mp_sess.dbm.dat
> > >     mp_sess.dbm.dir
> > >
> > > I've also executed a:
> > >
> > >     watch -d 'ls -l /tmp/mp*'
> > >
> > > And upon creating new sessions...via separate browsers... I have seen the file
> > > size fo the above files grow in real-time, which means that data is in
> > > fact being added to the sessions which are partly human-readable.
> > >
> > > However, the problem I'm having is that occasionally when
> > > transitioning to other pages such as http://mysite.com/otherFunc,
> > >
> > > will return 'NoneType' object has no attribute 'load'  # referring to
> > > the sess object.
> > >
> > > So I click the [BACK] button in the browser and re-submit the data.
> > > After about 7 times, the script all of a sudden recognizes the sess
> > > object.  Sometimes this error does not happend and loads on the first
> > > try. How can I prevent this behavior?
> > >
> > > ~= Chris =~
> > >
> > >
> > > On Wed, 12 Jan 2005 23:48:39 +0900, Hiroaki KAWAI <kawai@iij.ad.jp> wrote:
> > > > Of cource, most popular and easiest way is to use Session module.
> > > > Session will store the information somewhere in 'session storage' that
> > > > the module knows how to get it, and the actual mechanism is hidden.
> > > > # i.e., inter-process communication via file or database.
> > > >
> > > > So, make sure that you save the session information to the session
> > > > storage in each request processing as Ron says. ;-)
> > > >
> > > >
> > > > Chris Jackson <christopher.jackson@gmail.com> wrote:
> > > > > Ah, that makes sense...Now I just need to find which "inter-process"
> > > > > technique I should be using in order to maintain consistency ;)
> > > > >
> > > > > ~= Chris =~
> > > > >
> > > > >
> > > > > On Wed, 12 Jan 2005 12:55:47 +0900, Hiroaki KAWAI <kawai@iij.ad.jp> wrote:
> > > > > > > > Depending on what type of apache configuration you run, one or more
> > > > > > > > interpreters will be used. Sometimes interpreters die and new ones get
> > > > > > > > created.
> > > > > > >
> > > > > > > Hmm...it's interesting you say that somtimes the interpreters die and
> > > > > > > new ones get created because I'm running into a "problem" where I will
> > > > > > > test a mod_python page and it will works perfectly several times again
> > > > > > > and again, but then i'll test it out again, and the interpreter seems
> > > > > > > to "forget" the values.  I'll keep testing the page with the same
> > > > > > > values, and then the page will work again.
> > > > > >
> > > > > > One interpreter is created per one apache child process. If you're running
> > > > > > prefork MPM (and set MaxRequestsPerChild or have multiple spare child
> > > > > > servers), you're posting a HTTP request sometimes to the same interpreter,
> > > > > > sometimes to other interpreter.
> > > > > > I think one of 'inter-process' techniques is useful for what you're
> > > > > > trying.
> > > > > > # If I'm saying wrong, someone please correct. :-)
> > > > > >
> > > > > > ---Hiroaki Kawai
> > > > > >
> > > > > > _______________________________________________
> > > > > > Mod_python mailing list
> > > > > > Mod_python@modpython.org
> > > > > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > > > > >
> > > >
> > > > ---Hiroaki Kawai
> > > >
> > > > _______________________________________________
> > > > Mod_python mailing list
> > > > Mod_python@modpython.org
> > > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > > >
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
>
From grahamd at dscpl.com.au  Fri Jan 14 18:27:11 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Fri Jan 14 18:27:15 2005
Subject: [mod_python] Mod_python quit working
In-Reply-To: <41E76877.3080300@netgroup.dk>
Message-ID: <D0CC5BAE-6683-11D9-9892-000393BB31F6@dscpl.com.au>


On Friday, January 14, 2005, at 05:36  PM, Bo Lorentsen wrote:

> Graham Dumpleton wrote:
>
>> Now, can we go backwards on this a bit and try and debug this in a 
>> more
>> sensible way.
>>
> Hi, I have tried the same problem too ... and the reason was a 
> conflict between too versions of libs (indirect loaded by python 
> modules), loaded into apache.
>
> So my first question must be ... how does a simple "hello, world" 
> work, and if it work, what kind of module do you import ?

Do you really want to know "how does it work", or how to set one up?

The documentation has a description of setting up a test at:

   http://www.modpython.org/live/current/doc-html/inst-testing.html

I just wish that this would describe the handler as shown in:

   http://www.modpython.org/live/current/doc-html/pyapi-handler.html

Ie., return an explicit content type so that one isn't at the
mercy of how Apache may be configured for its default content
type when none is defined.

Another trap is that people read this 3.1.X documentation and
try it with 2.7.X and find it doesn't work as necessarily as
expected if they modify it to return HTML. This is because in 3.1.X
it will automatically flush out headers when first write()
occurs whereas with 2.7.X you have to flush them explicitly.
There is also the fact that in 2.7.X you must use python-program
and not mod_python when using AddHandler/SetHandler.

Anyway, occurs to me that it would make a great deal of sense to
include with mod_python module itself some test handlers. Thus,
instead of relying on people to create their own test handler when
first checking to see if their installation works, have them point
at that included in mod_python itself. Ie.,

     <Directory /some/directory/htdocs/test>
         SetHandler mod_python
         PythonHandler mod_python.testing
         PythonDebug On
     </Directory>

One could actually provide a number of different tests for different
basic functionality of mod_python. The default could be a really
basic test, but others selected by using "::name", could return
information from the "req" object, interpreters or Apache state
and config etc. One might even be able to have tests for Session's
and other higher level functionality.

By including some inbuilt tests like this, you avoid issues arising
because of people not following the instructions properly as to where
to put the "mptest.py" content handler and what to put in it.

Anyone think this is a reasonable suggestion? any suggestions as to
some useful basic test handlers which could be created? Wouldn't be
too hard to bring a few such tests together into a simple package
which gets installed under mod_python.testing. Initially this could
be standalone but might be incorporated into mod_python proper later.


--
Graham Dumpleton (grahamd@dscpl.com.au)

From almad at include.cz  Sun Jan 16 19:19:28 2005
From: almad at include.cz (Lukas Linhart)
Date: Sun Jan 16 19:19:33 2005
Subject: [mod_python] Session initializatin failes - unsubscriptable object
Message-ID: <200501170119.28940.almad@include.cz>

Hello, 

i've started playing with mod_python again...and I'm unable to create Sessions 
- initialization create some strange output I don't quite understand; I tried 
to control Cookie.py, but I hasn't found anything helpful (I'm not very 
skilled this way). 

Do You have any suggestions? 

Thanks for help, 

Almad

=== info ===
[ebuild   R   ] net-www/apache-2.0.52-r1  +berkdb -debug -doc +gdbm -ipv6 
-ldap +ssl -static +threads 0 kB
[ebuild   R   ] dev-python/mod_python-3.1.3  0 kB
[ebuild   R   ] dev-lang/python-2.3.4  +X +berkdb -bootstrap -build -debug 
-doc +gdbm +ipv6* +ncurses +readline +ssl +tcltk -ucs2 0 kB


=== script ===
#!/usr/bin/env python
# -*- coding: utf-8 -*-
from mod_python import Session

def index(req):
 req.content_type = "text/plain"
 req.write("New session")
 relace = Session.Session(req)
 req.write("Content")
=== end of script ===


=== output ===
New session
<pre>
Mod_python error: "PythonHandler mod_python.publisher"

Traceback (most recent call last):

  File "/usr/lib/python2.3/site-packages/mod_python/apache.py", line 299, in 
HandlerDispatch
    result = object(req)

  File "/usr/lib/python2.3/site-packages/mod_python/publisher.py", line 136, 
in handler
    result = util.apply_fs_data(object, req.form, req=req)

  File "/usr/lib/python2.3/site-packages/mod_python/util.py", line 361, in 
apply_fs_data
    return object(**args)

  File "/var/www/webroot/pythontest/index.py", line 8, in index
    req.write("New session")

  File "/usr/lib/python2.3/site-packages/mod_python/Session.py", line 389, in 
Session
    timeout=timeout, lock=lock)

  File "/usr/lib/python2.3/site-packages/mod_python/Session.py", line 294, in 
__init__
    timeout=timeout, lock=lock)

  File "/usr/lib/python2.3/site-packages/mod_python/Session.py", line 132, in 
__init__
    Cookie.add_cookie(self._req, self.make_cookie())

  File "/usr/lib/python2.3/site-packages/mod_python/Session.py", line 160, in 
make_cookie
    c.path = dirpath[len(docroot):]

TypeError: unsubscriptable object

</pre>
=== end of output ===
-- 

Lukas "Almad" Linhart

[:: http://www.Include.cz/ ::]
[:: Including Your wishes ::]
[:: PGP/GNUPg key: http://download.almad.net/pubkey.asc ::]
From unselfishly at gmail.com  Mon Jan 17 01:21:11 2005
From: unselfishly at gmail.com (Keerati Inochanon)
Date: Mon Jan 17 01:21:13 2005
Subject: [mod_python] mod_python + vampire + psp
Message-ID: <b16e3ab705011622219d144e9@mail.gmail.com>

Hi,

I am a couple-of-day old python programmer. I decided to give a shot
at mod_python. I successfully installed mod_python, but I am still
trying to work with vampire. I would like psp files to be able to call
functions in other modules (ie. a .py file). Before installing
vampire, I was able to do this by calling filename/function (eg. <form
action="authentication/login" method="post" name="doe"> ) . If I do
the same thing now, it will give me a 404 file not found error.
Putting http://domain/filename/function in the location bar will not
work either.

This is my <Directory> tag in apache
<Directory "C:\program files\Apache Group\Apache2\htdocs\mapserver">
	PythonOption VampireDirectoryIndex index.html
	SetHandler python-program
	PythonHandler vampire
	PythonOption VampireDefaultHandlers On
        PythonDebug On
	<Files ~ "^\.vampire">
		Order allow,deny
		deny from all
	</Files>
</Directory>

I am using the .vampire and default-handlers.py as provided with the
source as the default content handler. Vampire is now mapping html
extension to psp. The psp file snippet is below:

<html>
<form action="authentication/login" method="post" name="auth">
  Username: <input type="text" name="username"></input><br>
  Password: <input type="password" name="password"></input><br>
  <input type="hidden" name="isFirst" value="False"></input>
  <input type="submit" value="Login">
</form>
</html>

Any help will be much appreciated. Thank you very much!

Keerati Inochanon
From grahamd at dscpl.com.au  Mon Jan 17 01:50:59 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon Jan 17 01:51:12 2005
Subject: [mod_python] mod_python + vampire + psp
Message-ID: <1105944659.29542@dscpl.user.openhosting.com>

Keerati Inochanon wrote ..
> Hi,
> 
> I am a couple-of-day old python programmer. I decided to give a shot
> at mod_python. I successfully installed mod_python, but I am still
> trying to work with vampire. I would like psp files to be able to call
> functions in other modules (ie. a .py file). Before installing
> vampire, I was able to do this by calling filename/function (eg. <form
> action="authentication/login" method="post" name="doe"> ) . If I do
> the same thing now, it will give me a 404 file not found error.
> Putting http://domain/filename/function in the location bar will not
> work either.
> 
> This is my <Directory> tag in apache
> <Directory "C:\program files\Apache Group\Apache2\htdocs\mapserver">
> 	PythonOption VampireDirectoryIndex index.html
> 	SetHandler python-program
> 	PythonHandler vampire
> 	PythonOption VampireDefaultHandlers On
>         PythonDebug On
> 	<Files ~ "^\.vampire">
> 		Order allow,deny
> 		deny from all
> 	</Files>
> </Directory>
> 
> I am using the .vampire and default-handlers.py as provided with the
> source as the default content handler. Vampire is now mapping html
> extension to psp. The psp file snippet is below:
> 
> <html>
> <form action="authentication/login" method="post" name="auth">
>   Username: <input type="text" name="username"></input><br>
>   Password: <input type="password" name="password"></input><br>
>   <input type="hidden" name="isFirst" value="False"></input>
>   <input type="submit" value="Login">
> </form>
> </html>
> 
> Any help will be much appreciated. Thank you very much!

The form is merely a POST against a URL, specifically "authentication/login".
Using Vampire, you should therefore have a file:

  authentication/login.py

In this file it would have a handler defined as:

  def handler(req,username,password,isFirst):
    ...

The method is just "handler()" in this case, as the URL being posted against
has no extension on it.

At least that is how it should work. I'll test it when I get home and post again
then.

--
Graham Dumpleton (grahamd@dscpl.com.au)
From grahamd at dscpl.com.au  Mon Jan 17 03:30:45 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon Jan 17 03:31:53 2005
Subject: [mod_python] mod_python + vampire + psp
In-Reply-To: <1105944659.29542@dscpl.user.openhosting.com>
References: <1105944659.29542@dscpl.user.openhosting.com>
Message-ID: <153011FF-6862-11D9-8E12-000393DCF16E@dscpl.com.au>


On 17/01/2005, at 5:50 PM, Graham Dumpleton wrote:

> Keerati Inochanon wrote ..
>> Hi,
>>
>> I am a couple-of-day old python programmer. I decided to give a shot
>> at mod_python. I successfully installed mod_python, but I am still
>> trying to work with vampire. I would like psp files to be able to call
>> functions in other modules (ie. a .py file). Before installing
>> vampire, I was able to do this by calling filename/function (eg. <form
>> action="authentication/login" method="post" name="doe"> ) . If I do
>> the same thing now, it will give me a 404 file not found error.
>> Putting http://domain/filename/function in the location bar will not
>> work either.
>>
>> ...
>>
>> I am using the .vampire and default-handlers.py as provided with the
>> source as the default content handler. Vampire is now mapping html
>> extension to psp. The psp file snippet is below:
>>
>> <html>
>> <form action="authentication/login" method="post" name="auth">
>>   Username: <input type="text" name="username"></input><br>
>>   Password: <input type="password" name="password"></input><br>
>>   <input type="hidden" name="isFirst" value="False"></input>
>>   <input type="submit" value="Login">
>> </form>
>> </html>
>>
>> Any help will be much appreciated. Thank you very much!
>
> The form is merely a POST against a URL, specifically 
> "authentication/login".
> Using Vampire, you should therefore have a file:
>
>   authentication/login.py
>
> In this file it would have a handler defined as:
>
>   def handler(req,username,password,isFirst):
>     ...
>
> The method is just "handler()" in this case, as the URL being posted 
> against
> has no extension on it.
>
> At least that is how it should work. I'll test it when I get home and 
> post again
> then.

Have twigged now on what you are doing differently.

When using PSP directly, your login handler was being implemented in
the style expected by mod_python.publisher. That is, for 
"authentication/login"
you would have had a file called "authentication.py" with a function in
it called "login".

In Vampire, it does not use the mod_python.publisher style of mapping 
URLs to
actual files. In mod_python.publisher generally all but the last part 
of the
URL identifies the path to the file and the last part identifies the 
method
within the file.

In Vampire, the whole URL (or as much as possible) is used to identify 
the
path to the file. Any extra is supplied in the "req" object as 
"path_info".
The method executed in the file will be handler(), or if the last 
component
on the URL used to identify the file has an extension, the 
handler_extn(),
method where "extn" is replaced with the actual extension.

What this means is that when using mod_python.publisher, there can be
multiple methods in the same code file which are associated with 
different
resource URLs. If an extension is used and AddHandler is set 
appropriately,
the extension has no real meaning.

In Vampire, each code file only has methods related to one specific 
resource.
There may however be different methods for delivering up the resource in
different formats. Which is called is dictated by the extension used in 
the
URL.

Thus in Vampire, mapping to functions is different. The other thing to 
know
is that the handler functions in Vampire follow the standard mod_python
form. That is, its return value is a status value. In 
mod_python.publisher
the return value will be the actual content, which if not HTML, will be
converted to HTML. If a specific status has to be returned an exception 
is
instead raised.

Note though that Vampire supports the mod_python.publisher like 
extension
of being able to accept form parameters as method parameters of the
handler method. In doing this though, it is mandatory that the first
argument of the handler method still be the "req" object whereas in
mod_python.publisher accepting the req object is optional and could be
placed in any position.

That said, if the only method in authentication.py to be called via a
URL is login(), you could instead renamed authentication.py to login.py
and change the method from login() to handler() and the the action in
form would just be "login". You obviously still need change the 
handler()
method to be implemented more in the form of a standard handler and not
a mod_python.publisher method.

Hope this helps.

--
Graham Dumpleton (grahamd@dscpl.com.au)

From SAiello at Jentoo.com  Mon Jan 17 05:36:59 2005
From: SAiello at Jentoo.com (SAiello@Jentoo.com)
Date: Mon Jan 17 06:49:55 2005
Subject: [mod_python] Sending files
Message-ID: <200501170536.59273.SAiello@Jentoo.com>

Hello All,

I was wondering if there was a better way to send file through mod_python 
than:

file=open('example.mp3', 'r')
req.conent_type='audio/mpeg'
req.write(file.read())
file.close()

Just from the simple use I have done, this manner of sending files seems to be 
slow. Any suggestions ?

Thanks,
From nicolas.lehuen at gmail.com  Mon Jan 17 07:12:31 2005
From: nicolas.lehuen at gmail.com (Nicolas Lehuen)
Date: Mon Jan 17 07:12:34 2005
Subject: [mod_python] Sending files
In-Reply-To: <200501170536.59273.SAiello@Jentoo.com>
References: <200501170536.59273.SAiello@Jentoo.com>
Message-ID: <c298f2d70501170412659fd2fb@mail.gmail.com>

Hi,

I've never tried it, but have a look at the req.sendfile() method :

http://www.modpython.org/live/current/doc-html/pyapi-mprequest-meth.html

"This function provides the most efficient way to send a file to the client."

Regards,
Nicolas


On Mon, 17 Jan 2005 05:36:59 -0500, SAiello@Jentoo.com
<SAiello@jentoo.com> wrote:
> Hello All,
> 
> I was wondering if there was a better way to send file through mod_python
> than:
> 
> file=open('example.mp3', 'r')
> req.conent_type='audio/mpeg'
> req.write(file.read())
> file.close()
> 
> Just from the simple use I have done, this manner of sending files seems to be
> slow. Any suggestions ?
> 
> Thanks,
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From SAiello at Jentoo.com  Mon Jan 17 06:11:03 2005
From: SAiello at Jentoo.com (SAiello@Jentoo.com)
Date: Mon Jan 17 07:23:57 2005
Subject: [mod_python] Sending files
In-Reply-To: <c298f2d70501170412659fd2fb@mail.gmail.com>
References: <200501170536.59273.SAiello@Jentoo.com>
	<c298f2d70501170412659fd2fb@mail.gmail.com>
Message-ID: <200501170611.03384.SAiello@Jentoo.com>

Thanks for the pointer, I missed that method in the documentation...

On Monday 17 January 2005 07:12 am, Nicolas Lehuen wrote:
> Hi,
>
> I've never tried it, but have a look at the req.sendfile() method :
>
> http://www.modpython.org/live/current/doc-html/pyapi-mprequest-meth.html
>
> "This function provides the most efficient way to send a file to the
> client."
>
> Regards,
> Nicolas
>
>
> On Mon, 17 Jan 2005 05:36:59 -0500, SAiello@Jentoo.com
>
> <SAiello@jentoo.com> wrote:
> > Hello All,
> >
> > I was wondering if there was a better way to send file through mod_python
> > than:
> >
> > file=open('example.mp3', 'r')
> > req.conent_type='audio/mpeg'
> > req.write(file.read())
> > file.close()
> >
> > Just from the simple use I have done, this manner of sending files seems
> > to be slow. Any suggestions ?
> >
> > Thanks,
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
From unselfishly at gmail.com  Mon Jan 17 09:21:05 2005
From: unselfishly at gmail.com (Keerati Inochanon)
Date: Mon Jan 17 09:21:07 2005
Subject: [mod_python] mod_python + vampire + psp
In-Reply-To: <153011FF-6862-11D9-8E12-000393DCF16E@dscpl.com.au>
References: <1105944659.29542@dscpl.user.openhosting.com>
	<153011FF-6862-11D9-8E12-000393DCF16E@dscpl.com.au>
Message-ID: <b16e3ab705011706211888275b@mail.gmail.com>

That explains a whole lot why some of the things I did worked (and
some did not). I have an idea now how to make my code works properly.
Thank you very much!


On Mon, 17 Jan 2005 19:30:45 +1100, Graham Dumpleton
<grahamd@dscpl.com.au> wrote:
> 
> On 17/01/2005, at 5:50 PM, Graham Dumpleton wrote:
> 
> > Keerati Inochanon wrote ..
> >> Hi,
> >>
> >> I am a couple-of-day old python programmer. I decided to give a shot
> >> at mod_python. I successfully installed mod_python, but I am still
> >> trying to work with vampire. I would like psp files to be able to call
> >> functions in other modules (ie. a .py file). Before installing
> >> vampire, I was able to do this by calling filename/function (eg. <form
> >> action="authentication/login" method="post" name="doe"> ) . If I do
> >> the same thing now, it will give me a 404 file not found error.
> >> Putting http://domain/filename/function in the location bar will not
> >> work either.
> >>
> >> ...
> >>
> >> I am using the .vampire and default-handlers.py as provided with the
> >> source as the default content handler. Vampire is now mapping html
> >> extension to psp. The psp file snippet is below:
> >>
> >> <html>
> >> <form action="authentication/login" method="post" name="auth">
> >>   Username: <input type="text" name="username"></input><br>
> >>   Password: <input type="password" name="password"></input><br>
> >>   <input type="hidden" name="isFirst" value="False"></input>
> >>   <input type="submit" value="Login">
> >> </form>
> >> </html>
> >>
> >> Any help will be much appreciated. Thank you very much!
> >
> > The form is merely a POST against a URL, specifically
> > "authentication/login".
> > Using Vampire, you should therefore have a file:
> >
> >   authentication/login.py
> >
> > In this file it would have a handler defined as:
> >
> >   def handler(req,username,password,isFirst):
> >     ...
> >
> > The method is just "handler()" in this case, as the URL being posted
> > against
> > has no extension on it.
> >
> > At least that is how it should work. I'll test it when I get home and
> > post again
> > then.
> 
> Have twigged now on what you are doing differently.
> 
> When using PSP directly, your login handler was being implemented in
> the style expected by mod_python.publisher. That is, for
> "authentication/login"
> you would have had a file called "authentication.py" with a function in
> it called "login".
> 
> In Vampire, it does not use the mod_python.publisher style of mapping
> URLs to
> actual files. In mod_python.publisher generally all but the last part
> of the
> URL identifies the path to the file and the last part identifies the
> method
> within the file.
> 
> In Vampire, the whole URL (or as much as possible) is used to identify
> the
> path to the file. Any extra is supplied in the "req" object as
> "path_info".
> The method executed in the file will be handler(), or if the last
> component
> on the URL used to identify the file has an extension, the
> handler_extn(),
> method where "extn" is replaced with the actual extension.
> 
> What this means is that when using mod_python.publisher, there can be
> multiple methods in the same code file which are associated with
> different
> resource URLs. If an extension is used and AddHandler is set
> appropriately,
> the extension has no real meaning.
> 
> In Vampire, each code file only has methods related to one specific
> resource.
> There may however be different methods for delivering up the resource in
> different formats. Which is called is dictated by the extension used in
> the
> URL.
> 
> Thus in Vampire, mapping to functions is different. The other thing to
> know
> is that the handler functions in Vampire follow the standard mod_python
> form. That is, its return value is a status value. In
> mod_python.publisher
> the return value will be the actual content, which if not HTML, will be
> converted to HTML. If a specific status has to be returned an exception
> is
> instead raised.
> 
> Note though that Vampire supports the mod_python.publisher like
> extension
> of being able to accept form parameters as method parameters of the
> handler method. In doing this though, it is mandatory that the first
> argument of the handler method still be the "req" object whereas in
> mod_python.publisher accepting the req object is optional and could be
> placed in any position.
> 
> That said, if the only method in authentication.py to be called via a
> URL is login(), you could instead renamed authentication.py to login.py
> and change the method from login() to handler() and the the action in
> form would just be "login". You obviously still need change the
> handler()
> method to be implemented more in the form of a standard handler and not
> a mod_python.publisher method.
> 
> Hope this helps.
> 
> --
> Graham Dumpleton (grahamd@dscpl.com.au)
> 
>
From dan at dan-olsen.net  Mon Jan 17 16:32:31 2005
From: dan at dan-olsen.net (Dan R. Olsen III)
Date: Mon Jan 17 16:32:53 2005
Subject: [mod_python] DBXML
Message-ID: <4B59E8BD-68CF-11D9-B4B2-000D936BEB8C@dan-olsen.net>

Has anyone had any success with Berkeley XML database and mod_python?

From berry.groenendijk at gmail.com  Mon Jan 17 17:06:55 2005
From: berry.groenendijk at gmail.com (berry groenendijk)
Date: Mon Jan 17 17:06:58 2005
Subject: [mod_python] DBXML
In-Reply-To: <4B59E8BD-68CF-11D9-B4B2-000D936BEB8C@dan-olsen.net>
References: <4B59E8BD-68CF-11D9-B4B2-000D936BEB8C@dan-olsen.net>
Message-ID: <680bcd95050117140612379309@mail.gmail.com>

I think I know what you mean. I have installed Berkeley DB XML 2.0.9
(on Fedora Core 3, AMD64). I want to use it as a xml store for my
website. I also use mpservlets
(http://home.comcast.net/~d.popowich/mpservlets/) on my website. I
just love this extension to mod_python.

But, I am still unable to get bdbxml to work together with mod_python.
Especially instantiating XmlManager() seems to fail. It just doesn't
give any results back. When I use the same python code in a python
shell it works great. But, from within mod_python it just does not
seem to work.

Perhaps we can help each other to get bdbxml working with mod_python...

-- 
Berry Groenendijk
http://www.bersie.de
From azaroth at liverpool.ac.uk  Mon Jan 17 18:24:00 2005
From: azaroth at liverpool.ac.uk (Dr Robert Sanderson)
Date: Mon Jan 17 18:22:14 2005
Subject: [mod_python] DBXML
In-Reply-To: <680bcd95050117140612379309@mail.gmail.com>
References: <4B59E8BD-68CF-11D9-B4B2-000D936BEB8C@dan-olsen.net>
	<680bcd95050117140612379309@mail.gmail.com>
Message-ID: <Pine.LNX.4.61.0501172233180.13367@localhost.localdomain>

> But, I am still unable to get bdbxml to work together with mod_python.
> Especially instantiating XmlManager() seems to fail. It just doesn't
> give any results back. When I use the same python code in a python
> shell it works great. But, from within mod_python it just does not
> seem to work.
> Perhaps we can help each other to get bdbxml working with mod_python...

Probably the same reason that I've had trouble in the past doing something 
very similar...

The trouble I had was different versions of expat conflicting.

Python comes with one version, Apache with one, and bdbxml probably has a 
third.  If they're different versions, things fail hideously.

Rob


       ,'/:.          Dr Robert Sanderson (azaroth@liverpool.ac.uk)
     ,'-/::::.        http://www.o-r-g.org/~azaroth/
   ,'--/::(@)::.      Dept. of Computer Science, Room 805
,'---/::::::::::.    University of Liverpool
____/:::::::::::::.  L5R Shop: http://www.cardsnotwords.com/
I L L U M I N A T I
From mamading at gmail.com  Mon Jan 17 21:43:45 2005
From: mamading at gmail.com (Mamading Ceesay)
Date: Mon Jan 17 21:43:50 2005
Subject: [mod_python] DBXML
In-Reply-To: <Pine.LNX.4.61.0501172233180.13367@localhost.localdomain>
References: <4B59E8BD-68CF-11D9-B4B2-000D936BEB8C@dan-olsen.net>
	<680bcd95050117140612379309@mail.gmail.com>
	<Pine.LNX.4.61.0501172233180.13367@localhost.localdomain>
Message-ID: <57a9359705011718431c78486e@mail.gmail.com>

On Mon, 17 Jan 2005 23:24:00 +0000 (GMT), Dr Robert Sanderson
<azaroth@liverpool.ac.uk> wrote:
> 
> Probably the same reason that I've had trouble in the past doing something
> very similar...
> 
> The trouble I had was different versions of expat conflicting.
> 
> Python comes with one version, Apache with one, and bdbxml probably has a
> third.  If they're different versions, things fail hideously.
> 

So how did you solve it, if you did.  The two obvious potential
solutions given that situation are:

1) Remove the binary packages, compile a dynamically linked expat and
then recompile the other packages against it.

2) Alternatively, remove the binary packages and recompile them
statically linked against the same version of expat.  To be honest,
I'm a bit dubious about this option.

Regards,
Mamading
From eddielee at tropicsoft.com  Mon Jan 17 22:21:55 2005
From: eddielee at tropicsoft.com (Eddie Diener)
Date: Mon Jan 17 22:23:01 2005
Subject: [mod_python] Mod_python for  Python 2.4
Message-ID: <001201c4fd0c$dd3af540$02fea8c0@eldiener>

Is there a mod_python version which will work with Python 2.4 ?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050117/944b9ad1/attachment.html
From azaroth at liverpool.ac.uk  Tue Jan 18 05:50:42 2005
From: azaroth at liverpool.ac.uk (Dr Robert Sanderson)
Date: Tue Jan 18 05:48:52 2005
Subject: [mod_python] DBXML
In-Reply-To: <57a9359705011718431c78486e@mail.gmail.com>
References: <4B59E8BD-68CF-11D9-B4B2-000D936BEB8C@dan-olsen.net>
	<680bcd95050117140612379309@mail.gmail.com>
	<Pine.LNX.4.61.0501172233180.13367@localhost.localdomain>
	<57a9359705011718431c78486e@mail.gmail.com>
Message-ID: <Pine.LNX.4.61.0501181048090.14126@localhost.localdomain>


>> The trouble I had was different versions of expat conflicting.
>> Python comes with one version, Apache with one, and bdbxml probably has a
>> third.  If they're different versions, things fail hideously.

> So how did you solve it, if you did.  The two obvious potential
> solutions given that situation are:

I removed the expats from Python and 4Suite and compiled them against the 
same version as Apache :/

Thankfully as of Python 2.4 and 4Suite 1.0a4 they all use the latest 
version of expat, so it doesn't fail any more.

If bdbxml doesn't use the latest, you could always ask the developers (who 
I've had nothing but good experiences with in the past) to update it.


Rob

       ,'/:.          Dr Robert Sanderson (azaroth@liverpool.ac.uk)
     ,'-/::::.        http://www.o-r-g.org/~azaroth/
   ,'--/::(@)::.      Dept. of Computer Science, Room 805
,'---/::::::::::.    University of Liverpool
____/:::::::::::::.  L5R Shop: http://www.cardsnotwords.com/
I L L U M I N A T I
From igor at rulim.de  Tue Jan 18 10:21:04 2005
From: igor at rulim.de (Igor Stroh)
Date: Tue Jan 18 10:21:09 2005
Subject: [mod_python] Serving FS data
Message-ID: <41ED2960.9050604@rulim.de>

Hi there,

I'm looking for a way to serve files from the filesystem
through mod_python. Right now I'm just doing stuff like
request.write(file(<path>).read())
but this is obviously quite expensive when the files are
big, since they're dumped at once into memory...
The whole thing would be ways faster if there would be
a way to just "pipe" those files through mod_python
directly to apache, i.e. just by pointing to a path
or a file descriptor... Any ideas?

TIA,
Igor
From nicolas.lehuen at gmail.com  Tue Jan 18 10:46:57 2005
From: nicolas.lehuen at gmail.com (Nicolas Lehuen)
Date: Tue Jan 18 10:47:00 2005
Subject: [mod_python] Serving FS data
In-Reply-To: <41ED2960.9050604@rulim.de>
References: <41ED2960.9050604@rulim.de>
Message-ID: <c298f2d7050118074638900e24@mail.gmail.com>

Use req.sendfile(). See :

http://www.modpython.org/pipermail/mod_python/2005-January/017118.html

Maybe we should add this to the FAQ (http://www.modpython.org/FAQ/faqw.py) ?

Regards,

Nicolas


On Tue, 18 Jan 2005 16:21:04 +0100, Igor Stroh <igor@rulim.de> wrote:
> Hi there,
> 
> I'm looking for a way to serve files from the filesystem
> through mod_python. Right now I'm just doing stuff like
> request.write(file(<path>).read())
> but this is obviously quite expensive when the files are
> big, since they're dumped at once into memory...
> The whole thing would be ways faster if there would be
> a way to just "pipe" those files through mod_python
> directly to apache, i.e. just by pointing to a path
> or a file descriptor... Any ideas?
> 
> TIA,
> Igor
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From jwallace at woti.com  Tue Jan 18 11:22:53 2005
From: jwallace at woti.com (John R. Wallace)
Date: Tue Jan 18 11:22:59 2005
Subject: [mod_python] Threads running in restricted mode?
Message-ID: <1106065373.302.15.camel@nelson.woti.com>

Hello all,

I am using both threads and mod_python in my current project, and it
appears that any new threads that I start are running in restricted mode
by default.  I was wondering if anyone has ever seen this, and/or how I
can get my threads to run in "normal" mode, so that they have access to
things like the file() constructor, for example.

Below is a small toy example that illustrates the problem that I am
having:

-----------------------
from mod_python import apache, util
import threading
import os

def run(request):
    try:
        os.system("ls")
        x = file("/tmp/test", "w")
        x.write("Writing!  look at me!")
        x.close()
    except Exception, e:
        request.write("Oh no, exception in thread! " + str(e) + "\n")

def handler(request):    

    request.content_type = "text/plain"    
    request.send_http_header()


    thread = threading.Thread(target=run, args=(request,))
    thread.start()
    thread.join()
    
    try:
        x = file("/tmp/test", "w")
        x.write("Writing!  look at me!")
        request.write("Wrote to file")
        x.close()
    except Exception, e:
        request.write("Oh no, exception! " + str(e) + "\n")

    return apache.OK

------------------

Running this code will result in:
Oh no, exception in thread! file() constructor not accessible in
restricted mode
Wrote to file

anyone have any brilliant ideas on how to disable the restricted mode?

BTW, if you've read this far, I'm running mod_python 3.1.3, Python 2.4, and apache 2.0.52

Thank you for your help,

John


From christopher.jackson at gmail.com  Tue Jan 18 11:28:05 2005
From: christopher.jackson at gmail.com (Chris Jackson)
Date: Tue Jan 18 11:28:08 2005
Subject: [mod_python] Mod_python for Python 2.4
In-Reply-To: <001201c4fd0c$dd3af540$02fea8c0@eldiener>
References: <001201c4fd0c$dd3af540$02fea8c0@eldiener>
Message-ID: <4d11484d05011808285d1974f4@mail.gmail.com>

The latest version will work just fine..  here's what I use:

mod_python version = 3.1.3
Apache version = 2.0.52
python version = 2.4

~= Chris =~


On Mon, 17 Jan 2005 22:21:55 -0500, Eddie Diener
<eddielee@tropicsoft.com> wrote:
>  
> Is there a mod_python version which will work with Python 2.4 ? 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 
> 
>
From kamil at nvstudio.pl  Tue Jan 18 11:35:41 2005
From: kamil at nvstudio.pl (Kamil Niechajewicz)
Date: Tue Jan 18 11:35:15 2005
Subject: [mod_python] mod_python release?
Message-ID: <41ED3ADD.1080705@nvstudio.pl>

Soon there will be year since the last release of mod_python. I wanted
to ask anyone, whether this project is actually 'closed' and will not be
developed in the nearest future, or there will be any new release or
bug fix soon? I don't believe that there are no major/minor bugs waiting
to be fixed..

Best regards,
K.
From nicolas.lehuen at gmail.com  Tue Jan 18 11:57:02 2005
From: nicolas.lehuen at gmail.com (Nicolas Lehuen)
Date: Tue Jan 18 11:57:07 2005
Subject: [mod_python] mod_python release?
In-Reply-To: <41ED3ADD.1080705@nvstudio.pl>
References: <41ED3ADD.1080705@nvstudio.pl>
Message-ID: <c298f2d7050118085713531f2@mail.gmail.com>

Hi,

mod_python is still developed, mostly for bug fixes right now (no new
feature seems to be planned). You can checkout the latest development
version of mod_python at the Subversion repository :

http://svn.apache.org/repos/asf/httpd/mod_python/trunk

Subversion is the new CVS. For more information about Subversion, see
http://subversion.tigris.org/.

As a reminder, we now have a JIRA bug tracking system here :

http://issues.apache.org/jira/browse/MODPYTHON?report=select

As for an official release, let's ask Grisha... Maybe it's time for
the 3.1.4 version ?

Regards,
Nicolas

On Tue, 18 Jan 2005 17:35:41 +0100, Kamil Niechajewicz
<kamil@nvstudio.pl> wrote:
> Soon there will be year since the last release of mod_python. I wanted
> to ask anyone, whether this project is actually 'closed' and will not be
> developed in the nearest future, or there will be any new release or
> bug fix soon? I don't believe that there are no major/minor bugs waiting
> to be fixed..
> 
> Best regards,
> K.
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From sanders at apache.org  Tue Jan 18 12:17:39 2005
From: sanders at apache.org (Scott Sanders)
Date: Tue Jan 18 12:17:46 2005
Subject: [mod_python] mod_python release?
In-Reply-To: <c298f2d7050118085713531f2@mail.gmail.com>
References: <41ED3ADD.1080705@nvstudio.pl>
	<c298f2d7050118085713531f2@mail.gmail.com>
Message-ID: <41ED44B3.1060509@apache.org>



Nicolas Lehuen wrote:

>As for an official release, let's ask Grisha... Maybe it's time for
>the 3.1.4 version ?
>
I would say let's release soon, though we should also get more of the 
patches into source control first.

Scott
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050118/05596bdd/attachment.html
From grisha at modpython.org  Tue Jan 18 12:41:00 2005
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Tue Jan 18 12:41:12 2005
Subject: [mod_python] mod_python release?
In-Reply-To: <41ED44B3.1060509@apache.org>
References: <41ED3ADD.1080705@nvstudio.pl>
	<c298f2d7050118085713531f2@mail.gmail.com>
	<41ED44B3.1060509@apache.org>
Message-ID: <20050118123811.J52034@grisha.dyndns.org>


+1 on getting more patches. To answer the original question - there hasn't 
been new releases because the development has been slow and there hasn't 
been any compelling reason to make a release (e.g. security problem). I'm 
not too worried about release frequency.

Grisha

On Tue, 18 Jan 2005, Scott Sanders wrote:

>
>
> Nicolas Lehuen wrote:
>
>> As for an official release, let's ask Grisha... Maybe it's time for
>> the 3.1.4 version ?
>> 
> I would say let's release soon, though we should also get more of the patches 
> into source control first.
>
> Scott
>
From nick at dd.revealed.net  Tue Jan 18 12:52:02 2005
From: nick at dd.revealed.net (Nick)
Date: Tue Jan 18 12:52:21 2005
Subject: [mod_python] mod_python release?
In-Reply-To: <20050118123811.J52034@grisha.dyndns.org>
References: <41ED3ADD.1080705@nvstudio.pl>	<c298f2d7050118085713531f2@mail.gmail.com>	<41ED44B3.1060509@apache.org>
	<20050118123811.J52034@grisha.dyndns.org>
Message-ID: <41ED4CC2.8070703@dd.revealed.net>

Speaking of patches, this one been fixed?

"connobject.c" 422
     {"local_ip",           T_STRING,    OFF(remote_ip),          RO},
     {"local_host",         T_STRING,    OFF(remote_host),        RO},

Should be OFF(local_ip) and OFF(local_host) here.

Nick

Gregory (Grisha) Trubetskoy wrote:
> 
> +1 on getting more patches. To answer the original question - there 
> hasn't been new releases because the development has been slow and there 
> hasn't been any compelling reason to make a release (e.g. security 
> problem). I'm not too worried about release frequency.
> 
> Grisha
> 
> On Tue, 18 Jan 2005, Scott Sanders wrote:
> 
>>
>>
>> Nicolas Lehuen wrote:
>>
>>> As for an official release, let's ask Grisha... Maybe it's time for
>>> the 3.1.4 version ?
>>>
>> I would say let's release soon, though we should also get more of the 
>> patches into source control first.
>>
>> Scott
>>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From nicolas.lehuen at gmail.com  Tue Jan 18 12:59:46 2005
From: nicolas.lehuen at gmail.com (Nicolas Lehuen)
Date: Tue Jan 18 12:59:48 2005
Subject: [mod_python] mod_python release?
In-Reply-To: <20050118123811.J52034@grisha.dyndns.org>
References: <41ED3ADD.1080705@nvstudio.pl>
	<c298f2d7050118085713531f2@mail.gmail.com>
	<41ED44B3.1060509@apache.org>
	<20050118123811.J52034@grisha.dyndns.org>
Message-ID: <c298f2d705011809593008e079@mail.gmail.com>

Judging from 

http://www.apache.org/~jim/committers.html

we are 6 with commiters right on httpd-python. Maybe we could do
something like a mod_python bug day soon and commit some of the
patches that were published on this mailing list ? I suggest all 6
commiters register themselves on the JIRA bug repository
(http://issues.apache.org/jira/browse/MODPYTHON?report=select), so
that we can assign bugs to each others.

Regards,
Nicolas


On Tue, 18 Jan 2005 12:41:00 -0500 (EST), Gregory (Grisha) Trubetskoy
<grisha@modpython.org> wrote:
> 
> +1 on getting more patches. To answer the original question - there hasn't
> been new releases because the development has been slow and there hasn't
> been any compelling reason to make a release (e.g. security problem). I'm
> not too worried about release frequency.
> 
> Grisha
> 
> On Tue, 18 Jan 2005, Scott Sanders wrote:
> 
> >
> >
> > Nicolas Lehuen wrote:
> >
> >> As for an official release, let's ask Grisha... Maybe it's time for
> >> the 3.1.4 version ?
> >>
> > I would say let's release soon, though we should also get more of the patches
> > into source control first.
> >
> > Scott
> >
>
From nicolas.lehuen at gmail.com  Tue Jan 18 13:15:01 2005
From: nicolas.lehuen at gmail.com (Nicolas Lehuen)
Date: Tue Jan 18 13:19:33 2005
Subject: [mod_python] mod_python release?
In-Reply-To: <41ED4CC2.8070703@dd.revealed.net>
References: <41ED3ADD.1080705@nvstudio.pl>
	<c298f2d7050118085713531f2@mail.gmail.com>
	<41ED44B3.1060509@apache.org>
	<20050118123811.J52034@grisha.dyndns.org>
	<41ED4CC2.8070703@dd.revealed.net>
Message-ID: <c298f2d705011810156ffe2dee@mail.gmail.com>

Yeah, this one has been fixed by Grisha on Jul, 06 2004. But it's not
in the 3.1.3 release, this is one of the fixes that needs to be
released.

Regards,
Nicolas

On Tue, 18 Jan 2005 11:52:02 -0600, Nick <nick@dd.revealed.net> wrote:
> Speaking of patches, this one been fixed?
> 
> "connobject.c" 422
>      {"local_ip",           T_STRING,    OFF(remote_ip),          RO},
>      {"local_host",         T_STRING,    OFF(remote_host),        RO},
> 
> Should be OFF(local_ip) and OFF(local_host) here.
> 
> Nick
> 
> Gregory (Grisha) Trubetskoy wrote:
> >
> > +1 on getting more patches. To answer the original question - there
> > hasn't been new releases because the development has been slow and there
> > hasn't been any compelling reason to make a release (e.g. security
> > problem). I'm not too worried about release frequency.
> >
> > Grisha
> >
> > On Tue, 18 Jan 2005, Scott Sanders wrote:
> >
> >>
> >>
> >> Nicolas Lehuen wrote:
> >>
> >>> As for an official release, let's ask Grisha... Maybe it's time for
> >>> the 3.1.4 version ?
> >>>
> >> I would say let's release soon, though we should also get more of the
> >> patches into source control first.
> >>
> >> Scott
> >>
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From igor at rulim.de  Tue Jan 18 13:27:34 2005
From: igor at rulim.de (Igor Stroh)
Date: Tue Jan 18 13:27:41 2005
Subject: [mod_python] Serving FS data
In-Reply-To: <c298f2d7050118074638900e24@mail.gmail.com>
References: <41ED2960.9050604@rulim.de>
	<c298f2d7050118074638900e24@mail.gmail.com>
Message-ID: <41ED5516.9090205@rulim.de>

Hi,
Nicolas Lehuen wrote:
> Use req.sendfile(). See :
> 
> http://www.modpython.org/pipermail/mod_python/2005-January/017118.html
> 
> Maybe we should add this to the FAQ (http://www.modpython.org/FAQ/faqw.py) ?
> 
> Regards,

Thanks, works like a charm :)

Cheers,
Igor
From murat.ozsoyler at isnet.net.tr  Tue Jan 18 13:41:33 2005
From: murat.ozsoyler at isnet.net.tr (=?ISO-8859-9?Q?Murat_=D6zs=F6yler?=)
Date: Tue Jan 18 13:41:46 2005
Subject: [Fwd: Re: [mod_python] Mod_python for Python 2.4]
Message-ID: <41ED585D.401@isnet.net.tr>

unfortunately installation stops complaining that it can not find Python 
2.3 in the registry. 

-------- Original Message --------
Subject: 	Re: [mod_python] Mod_python for Python 2.4
Date: 	Tue, 18 Jan 2005 20:13:44 +0200
From: 	Murat ?zs?yler <murat.ozsoyler@isnet.net.tr>
To: 	Chris Jackson <christopher.jackson@gmail.com>
References: 	<001201c4fd0c$dd3af540$02fea8c0@eldiener> 
<4d11484d05011808285d1974f4@mail.gmail.com> 
<41ED4D58.20801@isnet.net.tr> <4d11484d050118095848aad07f@mail.gmail.com>



I'll try it. Thnks.

Regards,

Murat

Chris Jackson wrote:

>You should be able to do this with no problem at all, although I
>haven't tried this on Windows.  You may have to adjust your
>$PYTHONHOME and $PATH environmental variables.
>
>~= Chris =~
>
>
>On Tue, 18 Jan 2005 19:54:32 +0200, Murat ?zs?yler
><murat.ozsoyler@isnet.net.tr> wrote:
>  
>
>>Chris,
>>
>>Thanks for your reply,
>>
>>the URL for windows version contains py2.3.  I haven't tried to install
>>it onto Python 2.4 though. And I haven't got VC 7.1 to build from sources.
>>
>>Can I install current download onto Pyhon 2.4 anyway?
>>
>>TIA
>>
>>Murat
>>
>>Chris Jackson wrote:
>>
>>    
>>
>>>The latest version will work just fine..  here's what I use:
>>>
>>>mod_python version = 3.1.3
>>>Apache version = 2.0.52
>>>python version = 2.4
>>>
>>>~= Chris =~
>>>
>>>
>>>On Mon, 17 Jan 2005 22:21:55 -0500, Eddie Diener
>>><eddielee@tropicsoft.com> wrote:
>>>
>>>
>>>      
>>>
>>>>Is there a mod_python version which will work with Python 2.4 ?
>>>>_______________________________________________
>>>>Mod_python mailing list
>>>>Mod_python@modpython.org
>>>>http://mailman.modpython.org/mailman/listinfo/mod_python
>>>>
>>>>
>>>>
>>>>
>>>>
>>>>        
>>>>
>>>_______________________________________________
>>>Mod_python mailing list
>>>Mod_python@modpython.org
>>>http://mailman.modpython.org/mailman/listinfo/mod_python
>>>
>>>
>>>
>>>      
>>>
>>    
>>
>
>  
>





From grahamd at dscpl.com.au  Tue Jan 18 16:45:48 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Jan 18 16:46:45 2005
Subject: [mod_python] Serving FS data
In-Reply-To: <c298f2d7050118074638900e24@mail.gmail.com>
Message-ID: <508A606A-699A-11D9-A657-000393BB31F6@dscpl.com.au>

If you are using "SetHandler" to intercept all requests falling
below a directory and the raw files you want to send back are
under this directory with the correct location corresponding to
the request already, there are a couple of other things that
may also be appropriate.

First off, you can simply put:

   return apache.DECLINED

in your handler for any specific request you aren't doing anything
special for.

Doing this, control gets passed back to Apache and it will use
the standard mechanisms for returning the contents of any file
it finds at the location identified by the URL.

Second is that if all the files that need to be sent back use the
same extension, you can avoid triggering off mod_python in the
first place, by having in your httpd.conf/htaccess file something
like:

   SetHandler mymodule

   <Files *.jpg>
   SetHandler None
   </Files>

This one is also useful where you are also using PHP.

   SetHandler mymodule

   <Files *.php>
   SetHandler None
   </Files>

Doing this, you can mix PHP and mod_python stuff in the one directory
which can be handy if wanting to slowly migrate stuff from PHP to
mod_python. :-)

Graham


On Wednesday, January 19, 2005, at 02:46  AM, Nicolas Lehuen wrote:

> Use req.sendfile(). See :
>
> http://www.modpython.org/pipermail/mod_python/2005-January/017118.html
>
> Maybe we should add this to the FAQ 
> (http://www.modpython.org/FAQ/faqw.py) ?
>
> Regards,
>
> Nicolas
>
>
> On Tue, 18 Jan 2005 16:21:04 +0100, Igor Stroh <igor@rulim.de> wrote:
>> Hi there,
>>
>> I'm looking for a way to serve files from the filesystem
>> through mod_python. Right now I'm just doing stuff like
>> request.write(file(<path>).read())
>> but this is obviously quite expensive when the files are
>> big, since they're dumped at once into memory...
>> The whole thing would be ways faster if there would be
>> a way to just "pipe" those files through mod_python
>> directly to apache, i.e. just by pointing to a path
>> or a file descriptor... Any ideas?
>>
>> TIA,
>> Igor
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From almad at include.cz  Tue Jan 18 18:08:12 2005
From: almad at include.cz (Lukas Linhart)
Date: Tue Jan 18 18:08:26 2005
Subject: [mod_python] Publisher Session not functional (?)
Message-ID: <200501190008.20354.almad@include.cz>

Hello, 

I've done some further research and test this code on more configurations: 

#!/usr/bin/env python
# -*- coding: iso-8859-2 -*-
from mod_python import Session

def index(req):
 relace = Session.Session(req)
 req.write(relace.id())


I've tested it on more configurations and Python/mod_python/apache versions, 
but I always get this output (on the end of the mail). 
Is something wrong with the code, configurations or it's bug of 
mod_python.publisher? 

Thanks for any hints, 

-- 

Lukas "Almad" Linhart

[:: http://www.Include.cz/ ::]
[:: Including Your wishes ::]
[:: PGP/GNUPg key: http://download.almad.net/pubkey.asc ::]

=== output ===
Mod_python error: "PythonHandler mod_python.publisher"

Traceback (most recent call last):

  File "/usr/lib/python2.3/site-packages/mod_python/apache.py", line 299, in 
HandlerDispatch
    result = object(req)

  File "/usr/lib/python2.3/site-packages/mod_python/publisher.py", line 136, 
in handler
    result = util.apply_fs_data(object, req.form, req=req)

  File "/usr/lib/python2.3/site-packages/mod_python/util.py", line 361, in 
apply_fs_data
    return object(**args)

  File "/var/data/web/almad.net/pokus.py", line 8, in index
    relace = Session.Session(req)

  File "/usr/lib/python2.3/site-packages/mod_python/Session.py", line 389, in 
Session
    timeout=timeout, lock=lock)

  File "/usr/lib/python2.3/site-packages/mod_python/Session.py", line 294, in 
__init__
    timeout=timeout, lock=lock)

  File "/usr/lib/python2.3/site-packages/mod_python/Session.py", line 132, in 
__init__
    Cookie.add_cookie(self._req, self.make_cookie())

  File "/usr/lib/python2.3/site-packages/mod_python/Session.py", line 160, in 
make_cookie
    c.path = dirpath[len(docroot):]

TypeError: unsubscriptable object
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 190 bytes
Desc: not available
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050119/1f97971f/attachment.bin
From grahamd at dscpl.com.au  Tue Jan 18 18:42:44 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Jan 18 18:43:51 2005
Subject: [mod_python] mod_python release?
Message-ID: <1106091764.16832@dscpl.user.openhosting.com>

Nicolas Lehuen wrote ..
> Judging from 
> 
> http://www.apache.org/~jim/committers.html
> 
> we are 6 with commiters right on httpd-python. Maybe we could do
> something like a mod_python bug day soon and commit some of the
> patches that were published on this mailing list ? I suggest all 6
> commiters register themselves on the JIRA bug repository
> (http://issues.apache.org/jira/browse/MODPYTHON?report=select), so
> that we can assign bugs to each others.

Just for the record, here are my set of six bugs which I have posted about
over the last few months. I don't follow what is in CVS so have no idea
which ones anything has been done about. One is mentioned in the bug
repository, but the listed fix for it will only work with more recent versions
of Python, thus precluding people from using mod_python with Python 2.1.
My later fix would have worked with Python 2.1 as well.

The bugs as I have reported them are below. Anyone want to comment on
whether they have been addressed.

1. Both mod_python 2.7.10 and 3.1.3 will not work with the standard
version of Python which is shipped with MAC OS X. This is because the
Python library when loaded thinks it is already initialised when it isn't.
I supplied a fix for this in the prior posts.

  http://www.modpython.org/pipermail/mod_python/2004-August/015994.html
  http://www.modpython.org/pipermail/mod_python/2004-September/016507.html

2. The apache.import_module() module is not sufficiently thread lock
protected. This means that it is possible for multiple threads to load
distinct copies of a module at the same time. This one is in the bug
repository as:

  http://issues.apache.org/jira/browse/MODPYTHON-2

The fix there will only work with Python 2.2 or later. My later post
suggested alternate fix. Make sure followup is noted though as should
use RLock and not Lock.

  http://www.modpython.org/pipermail/mod_python/2004-October/016644.html
  http://www.modpython.org/pipermail/mod_python/2004-October/016645.html

3. If using a multithreaded MPM, if on startup of process there is large
number of accesses, it is possible that multiple interpreters can be
created for the same named interpreter. Fix was supplied.

  http://www.modpython.org/pipermail/mod_python/2004-October/016634.html

4. The value for config_dir is not setup correctly by mod_python on
Win32 platforms as it makes wrong assumption that Apache passes
through paths in DOS style when it actually uses POSIX style. Fix
was supplied.

  http://www.modpython.org/pipermail/mod_python/2004-November/016784.html

5. The interpreter name wasn't being set correctly when the directive
PythonInterpPerDirectory was being used. Described problem but did
not supply a fix.

  http://www.modpython.org/pipermail/mod_python/2004-November/016788.html

6. Not really a bug but an issue of sorts. That is, that once a option is
set using PythonOption, there is no way to unset it, nor is there a way
of setting an option to an empty string.

  http://www.modpython.org/pipermail/mod_python/2004-October/016562.html

I think that was all the things I found. I supply the fixes for a couple of
these along with Vampire since I think they can be reasonably serious
if you are using multithreading.

  http://www.dscpl.com.au/projects/vampire/PATCHES

The others I have workarounds in my code so as to avoid the problems.

Anyway, though I better review these in cases they have fallen through
the cracks.

--
Graham Dumpleton (grahamd@dscpl.com.au)

From christopher.jackson at gmail.com  Tue Jan 18 23:26:57 2005
From: christopher.jackson at gmail.com (Chris Jackson)
Date: Tue Jan 18 23:27:03 2005
Subject: [mod_python] Publisher Session not functional (?)
In-Reply-To: <200501190008.20354.almad@include.cz>
References: <200501190008.20354.almad@include.cz>
Message-ID: <4d11484d05011820265e9f80b0@mail.gmail.com>

What does your Apache configuration directive look for the Python section?

<Directory ....>
...
</Directory...>

~= Chris =~

On Wed, 19 Jan 2005 00:08:12 +0100, Lukas Linhart <almad@include.cz> wrote:
> Hello,
> 
> I've done some further research and test this code on more configurations:
> 
> #!/usr/bin/env python
> # -*- coding: iso-8859-2 -*-
> from mod_python import Session
> 
> def index(req):
>  relace = Session.Session(req)
>  req.write(relace.id())
> 
> I've tested it on more configurations and Python/mod_python/apache versions,
> but I always get this output (on the end of the mail).
> Is something wrong with the code, configurations or it's bug of
> mod_python.publisher?
> 
> Thanks for any hints,
> 
> --
> 
> Lukas "Almad" Linhart
> 
> [:: http://www.Include.cz/ ::]
> [:: Including Your wishes ::]
> [:: PGP/GNUPg key: http://download.almad.net/pubkey.asc ::]
> 
> === output ===
> Mod_python error: "PythonHandler mod_python.publisher"
> 
> Traceback (most recent call last):
> 
>   File "/usr/lib/python2.3/site-packages/mod_python/apache.py", line 299, in
> HandlerDispatch
>     result = object(req)
> 
>   File "/usr/lib/python2.3/site-packages/mod_python/publisher.py", line 136,
> in handler
>     result = util.apply_fs_data(object, req.form, req=req)
> 
>   File "/usr/lib/python2.3/site-packages/mod_python/util.py", line 361, in
> apply_fs_data
>     return object(**args)
> 
>   File "/var/data/web/almad.net/pokus.py", line 8, in index
>     relace = Session.Session(req)
> 
>   File "/usr/lib/python2.3/site-packages/mod_python/Session.py", line 389, in
> Session
>     timeout=timeout, lock=lock)
> 
>   File "/usr/lib/python2.3/site-packages/mod_python/Session.py", line 294, in
> __init__
>     timeout=timeout, lock=lock)
> 
>   File "/usr/lib/python2.3/site-packages/mod_python/Session.py", line 132, in
> __init__
>     Cookie.add_cookie(self._req, self.make_cookie())
> 
>   File "/usr/lib/python2.3/site-packages/mod_python/Session.py", line 160, in
> make_cookie
>     c.path = dirpath[len(docroot):]
> 
> TypeError: unsubscriptable object
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 
> 
> 
>
From jspies at sun.ac.za  Wed Jan 19 05:13:14 2005
From: jspies at sun.ac.za (Johann Spies)
Date: Wed Jan 19 05:13:22 2005
Subject: [mod_python] Getting mptest.py to work
Message-ID: <20050119101314.GI8887@sun.ac.za>

This is my first question on the list.  I have seen messages in the
archive (using google) asking the same thing, but nothing that
indicated a solution.

My system:  Debian Sid with 

libapache2-mod-pyth 3.1.3-2.2
apache2             2.0.52-3 
python2.3           2.3.4-19


I have created /var/www/test with the following files:

.htaccess:

<Directory /var/www/test/>
   AddHandler mod_python .py
   PythonHandler mptest
   PythonDebug On
</Directory>

and 

mptest.py:

from mod_python import apache


def handler(req):
    req.content_type="text/html"
    req.write("Hello World!")
    return apache.OK

                                            
 I have added the 'req.content_type="text/html"' part after a
 suggestion somewhere to a user with a similar problem than mine, but
 that did not make any difference.

Apache does not produce any error message about this setup.  It just
does not use mod-python and Firefox does not know what to do with the
file mptest.py

O, and I have this in /etc/apache2/mods-enabled:

drwxr-xr-x  8 root root 4096 2005-01-18 16:22 ..
lrwxrwxrwx  1 root root   38 2005-01-18 16:34 cache.load -> /etc/apache2/mods-available/cache.load
lrwxrwxrwx  1 root root   37 2005-01-18 16:22 cgid.conf -> /etc/apache2/mods-available/cgid.conf
lrwxrwxrwx  1 root root   37 2005-01-18 16:22 cgid.load -> /etc/apache2/mods-available/cgid.load
lrwxrwxrwx  1 root root   33 2005-01-18 16:36 mod_python.load -> ../mods-available/mod_python.load
lrwxrwxrwx  1 root root   43 2005-01-18 16:22 proxy_html.load -> /etc/apache2/mods-available/proxy_html.load
lrwxrwxrwx  1 root root   40 2005-01-18 16:32 rewrite.load -> /etc/apache2/mods-available/rewrite.load
lrwxrwxrwx  1 root root   40 2005-01-18 16:22 userdir.conf -> /etc/apache2/mods-available/userdir.conf
lrwxrwxrwx  1 root root   40 2005-01-18 16:22 userdir.load -> /etc/apache2/mods-available/userdir.load
lrwxrwxrwx  1 root root   44 2005-01-18 16:33 vhost_alias.load -> /etc/apache2/mods-available/vhost_alias.load


How do I progress from here?

Regards
Johann

-- 
Johann Spies          Telefoon: 021-808 4036
Informasietegnologie, Universiteit van Stellenbosch

     "The LORD is my strength and song, and he is become my 
      salvation; he is my God, and I will prepare him an 
      habitation; my father's God, and I will exalt him."   
                       Exodus 15:2 
From grahamd at dscpl.com.au  Wed Jan 19 05:28:16 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Jan 19 05:28:27 2005
Subject: [mod_python] Getting mptest.py to work
In-Reply-To: <20050119101314.GI8887@sun.ac.za>
References: <20050119101314.GI8887@sun.ac.za>
Message-ID: <D4D5C2DC-6A04-11D9-8268-000393DCF16E@dscpl.com.au>


On 19/01/2005, at 9:13 PM, Johann Spies wrote:

> This is my first question on the list.  I have seen messages in the
> archive (using google) asking the same thing, but nothing that
> indicated a solution.
>
> My system:  Debian Sid with
>
> libapache2-mod-pyth 3.1.3-2.2
> apache2             2.0.52-3
> python2.3           2.3.4-19
>
>
> I have created /var/www/test with the following files:
>
> .htaccess:
>
> <Directory /var/www/test/>
>    AddHandler mod_python .py
>    PythonHandler mptest
>    PythonDebug On
> </Directory>
>

If you are configuring things in the .htaccess file, you do not need the
<Directory> directive around the statements. Ie., use just:

   AddHandler mod_python .py
   PythonHandler mptest
   PythonDebug On

Start with making that change, if still no luck, restart Apache and look
in its error log file to see what it produces on startup, you should see
something like:

   [Wed Jan 19 21:25:33 2005] [notice] mod_python: Creating 32 session 
mutexes based on 6 max processes and 25 max threads.
   [Wed Jan 19 21:25:34 2005] [notice] Apache/2.0.51 (Unix) 
mod_python/3.1.3 Python/2.3 configured -- resuming normal operations

I am using threads, if just using prefork then the messages will be 
different.
The point is though that you should see something there by mod_python.

If you don't even see that, mod_python not being loaded. If it wasn't 
being
loaded, the request against directory with above .htaccess file would 
most
like return a 500 internal server error.

> and
>
> mptest.py:
>
> from mod_python import apache
>
>
> def handler(req):
>     req.content_type="text/html"
>     req.write("Hello World!")
>     return apache.OK
>
>
>  I have added the 'req.content_type="text/html"' part after a
>  suggestion somewhere to a user with a similar problem than mine, but
>  that did not make any difference.
>
> Apache does not produce any error message about this setup.  It just
> does not use mod-python and Firefox does not know what to do with the
> file mptest.py
>
> O, and I have this in /etc/apache2/mods-enabled:
>
> drwxr-xr-x  8 root root 4096 2005-01-18 16:22 ..
> lrwxrwxrwx  1 root root   38 2005-01-18 16:34 cache.load -> 
> /etc/apache2/mods-available/cache.load
> lrwxrwxrwx  1 root root   37 2005-01-18 16:22 cgid.conf -> 
> /etc/apache2/mods-available/cgid.conf
> lrwxrwxrwx  1 root root   37 2005-01-18 16:22 cgid.load -> 
> /etc/apache2/mods-available/cgid.load
> lrwxrwxrwx  1 root root   33 2005-01-18 16:36 mod_python.load -> 
> ../mods-available/mod_python.load
> lrwxrwxrwx  1 root root   43 2005-01-18 16:22 proxy_html.load -> 
> /etc/apache2/mods-available/proxy_html.load
> lrwxrwxrwx  1 root root   40 2005-01-18 16:32 rewrite.load -> 
> /etc/apache2/mods-available/rewrite.load
> lrwxrwxrwx  1 root root   40 2005-01-18 16:22 userdir.conf -> 
> /etc/apache2/mods-available/userdir.conf
> lrwxrwxrwx  1 root root   40 2005-01-18 16:22 userdir.load -> 
> /etc/apache2/mods-available/userdir.load
> lrwxrwxrwx  1 root root   44 2005-01-18 16:33 vhost_alias.load -> 
> /etc/apache2/mods-available/vhost_alias.load
>
>
> How do I progress from here?
>
> Regards
> Johann
>
> -- 
> Johann Spies          Telefoon: 021-808 4036
> Informasietegnologie, Universiteit van Stellenbosch
>
>      "The LORD is my strength and song, and he is become my
>       salvation; he is my God, and I will prepare him an
>       habitation; my father's God, and I will exalt him."
>                        Exodus 15:2
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From jspies at sun.ac.za  Wed Jan 19 05:40:40 2005
From: jspies at sun.ac.za (Johann Spies)
Date: Wed Jan 19 05:40:42 2005
Subject: [mod_python] Getting mptest.py to work
In-Reply-To: <D4D5C2DC-6A04-11D9-8268-000393DCF16E@dscpl.com.au>
References: <20050119101314.GI8887@sun.ac.za>
	<D4D5C2DC-6A04-11D9-8268-000393DCF16E@dscpl.com.au>
Message-ID: <20050119104040.GL8887@sun.ac.za>

On Wed, Jan 19, 2005 at 09:28:16PM +1100, Graham Dumpleton wrote:

> If you are configuring things in the .htaccess file, you do not need the
> <Directory> directive around the statements. Ie., use just:
> 
>   AddHandler mod_python .py
>   PythonHandler mptest
>   PythonDebug On
> 
> Start with making that change, 

Thanks.  I have made the change but there is no difference in
behaviour.

> if still no luck, restart Apache and look
> in its error log file to see what it produces on startup, you should see
> something like:
> 
>   [Wed Jan 19 21:25:33 2005] [notice] mod_python: Creating 32 session 
> mutexes based on 6 max processes and 25 max threads.
>   [Wed Jan 19 21:25:34 2005] [notice] Apache/2.0.51 (Unix) 
> mod_python/3.1.3 Python/2.3 configured -- resuming normal operations

This is what my error log is showing:

[Wed Jan 19 12:32:56 2005] [notice] SIGHUP received.  Attempting to
restart
[Wed Jan 19 12:32:57 2005] [notice] mod_python: Creating 32 session
mutexes based on 3 max processes and 25 max threads.
[Wed Jan 19 12:32:57 2005] [notice] Apache/2.0.52 (Debian GNU/Linux)
mod_python/3.1.3 Python/2.3.4 proxy_html/2.4 configured -- resuming
normal operations

There is no error message referring to mptest.py

Regards
Johann
-- 
Johann Spies          Telefoon: 021-808 4036
Informasietegnologie, Universiteit van Stellenbosch

     "The LORD is my strength and song, and he is become my 
      salvation; he is my God, and I will prepare him an 
      habitation; my father's God, and I will exalt him."   
                       Exodus 15:2 
From grahamd at dscpl.com.au  Wed Jan 19 06:03:44 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Jan 19 06:03:53 2005
Subject: [mod_python] Getting mptest.py to work
In-Reply-To: <20050119104040.GL8887@sun.ac.za>
References: <20050119101314.GI8887@sun.ac.za>
	<D4D5C2DC-6A04-11D9-8268-000393DCF16E@dscpl.com.au>
	<20050119104040.GL8887@sun.ac.za>
Message-ID: <C9469C7E-6A09-11D9-8268-000393DCF16E@dscpl.com.au>


On 19/01/2005, at 9:40 PM, Johann Spies wrote:

> On Wed, Jan 19, 2005 at 09:28:16PM +1100, Graham Dumpleton wrote:
>
>> If you are configuring things in the .htaccess file, you do not need 
>> the
>> <Directory> directive around the statements. Ie., use just:
>>
>>   AddHandler mod_python .py
>>   PythonHandler mptest
>>   PythonDebug On
>>
>> Start with making that change,
>
> Thanks.  I have made the change but there is no difference in
> behaviour.
>

Do a sanity check to see if the .htaccess file is actually being read.
One can use another feature of mod_python to check this. Add:

   PythonOption Name

If mod_python is working okay and the .htaccess file is being read,
this should cause a 500 server error to be returned as a value for
option hasn't been supplied.

If you don't see this, then might be that main httpd.conf file not
configured to allow .htaccess in that part of directory hierarchy,
although, not sure if that is possible.

Next step might be to use the original <Directory> directive block
you had and put it in the main httpd.conf in an appropriate spot
to see if that makes a difference.

BTW, in your content handler, use "text/plain" and not "text/html"
as it isn't actually HTML.

From raniz at gmx.net  Wed Jan 19 08:07:28 2005
From: raniz at gmx.net (Daniel Raneland)
Date: Wed Jan 19 07:04:21 2005
Subject: [mod_python] Scripts executed in /
Message-ID: <200501191407.28650.raniz@gmx.net>

Hi.

I noticed that all my scripts are run in / and not in the directory where the 
script resides...

A simple os.listdir( '.' ) returned this:
['bin', 'dev', 'etc', 'lib', 'mnt', 'opt', 'tmp', 'sys', 'var', 'usr', 'boot', 
'home', 'proc', 'sbin', 'root', 'stage1-x86-2004.3.tar.bz2', '.viminfo', 
'.bash_history', '.reiserfs_priv']

This causes some problems... such as not being able to import files in the 
same dir as the script, and not being able to open files and directories 
without giving an absolute path.

Is there any way to change this via a configuration setting or is it 
hard-coded into mod_python?

Regards,
/Raniz
From jspies at sun.ac.za  Wed Jan 19 07:21:55 2005
From: jspies at sun.ac.za (Johann Spies)
Date: Wed Jan 19 07:21:59 2005
Subject: [mod_python] Getting mptest.py to work
In-Reply-To: <C9469C7E-6A09-11D9-8268-000393DCF16E@dscpl.com.au>
References: <20050119101314.GI8887@sun.ac.za>
	<D4D5C2DC-6A04-11D9-8268-000393DCF16E@dscpl.com.au>
	<20050119104040.GL8887@sun.ac.za>
	<C9469C7E-6A09-11D9-8268-000393DCF16E@dscpl.com.au>
Message-ID: <20050119122155.GN8887@sun.ac.za>

Dear Graham,

Thanks for your patience and help.  As you can see I have a lot to
learn about apache and related products.

On Wed, Jan 19, 2005 at 10:03:44PM +1100, Graham Dumpleton wrote:
> 
> Do a sanity check to see if the .htaccess file is actually being read.
> One can use another feature of mod_python to check this. Add:
> 
>   PythonOption Name
> 
> If mod_python is working okay and the .htaccess file is being read,
> this should cause a 500 server error to be returned as a value for
> option hasn't been supplied.

This did not produce any error or success.

> 
> If you don't see this, then might be that main httpd.conf file not
> configured to allow .htaccess in that part of directory hierarchy,
> although, not sure if that is possible.
> 
> Next step might be to use the original <Directory> directive block
> you had and put it in the main httpd.conf in an appropriate spot
> to see if that makes a difference.

So I  created a file in /etc/apache2/sites-enabled with the following
content:

<Directory /var/www/test/>
   AddHandler mod_python .py
   PythonHandler mptest
   PythonDebug On
</Directory>
 
And now I get the 500 server error when I click on mptest.py (just in
the browser - nothing in /var/log/apache2/error.log) after a
considerable period of time. Going just to http://localhost/test/
results in a directory being displayed with no error message.

Regards
Johann

-- 
Johann Spies          Telefoon: 021-808 4036
Informasietegnologie, Universiteit van Stellenbosch

     "The LORD is my strength and song, and he is become my 
      salvation; he is my God, and I will prepare him an 
      habitation; my father's God, and I will exalt him."   
                       Exodus 15:2 
From christopher.jackson at gmail.com  Wed Jan 19 13:10:13 2005
From: christopher.jackson at gmail.com (Chris Jackson)
Date: Wed Jan 19 13:10:15 2005
Subject: [mod_python] Publisher Session not functional (?)
In-Reply-To: <200501191231.34883.almad@include.cz>
References: <200501190008.20354.almad@include.cz>
	<4d11484d05011820265e9f80b0@mail.gmail.com>
	<200501191231.34883.almad@include.cz>
Message-ID: <4d11484d05011910105d2729a6@mail.gmail.com>

I noticed that your "DirectoryIndex" is called zapisnik.py, however your handler
is called index.  You can probably exclude the DirectoryIndex option,
and also do no worry about putting the .pyc extensions on your
options.

~= Chris =~



On Wed, 19 Jan 2005 12:31:28 +0100, Lukas Linhart <almad@include.cz> wrote:
> E-mail Chris Jackson ze dne Wed 19. of January 2005 05:26:
> > What does your Apache configuration directive look for the Python section?
> >
> > <Directory ....>
> > ...
> > </Directory...>
> >
> > ~= Chris =~
> 
> Sorry, I forgot:
> 
> <VirtualHost 81.0.234.91>
>   ServerName almad.net
>   ServerAlias www.almad.net
>   DocumentRoot /var/data/web/almad.net
>   DirectoryIndex zapisnik.pyc
>   AddHandler mod_python .py .pyc
>   PythonHandler mod_python.publisher
>   PythonDebug On
> </VirtualHost>
> 
> --
> 
> Lukas "Almad" Linhart
> 
> [:: http://www.Include.cz/ ::]
> [:: Including Your wishes ::]
> [:: PGP/GNUPg key: http://download.almad.net/pubkey.asc ::]
> 
> 
> 

[Original Message]

Hello,

I've done some further research and test this code on more configurations:

#!/usr/bin/env python
# -*- coding: iso-8859-2 -*-
from mod_python import Session

def index(req):
relace = Session.Session(req)
req.write(relace.id())

I've tested it on more configurations and Python/mod_python/apache versions,
but I always get this output (on the end of the mail).
Is something wrong with the code, configurations or it's bug of
mod_python.publisher?

Thanks for any hints,

--

Lukas "Almad" Linhart
From rdavisunr at yahoo.com  Wed Jan 19 13:20:25 2005
From: rdavisunr at yahoo.com (Robert Thomas Davis)
Date: Wed Jan 19 13:20:26 2005
Subject: [mod_python] populate user name in login prompt (for session)
Message-ID: <20050119182025.34322.qmail@web81209.mail.yahoo.com>

Hey all

My site requires a password to be accessed...I do not
really care what the user name is.  Thus, I would like
to populate the login prompt with a default name, like
user or admin, etc.  Is this possible or is it
possible to just prompt for a password and nothing
else?  I have included the code I am using (this code
was clipped from an earlier post and modified).

Thanks

Rob

def __auth__(req, user, passwd):

     # removed check for user=USER

     if passwd == PASS:
             # user has successfully authenticated
             sess = Session(req)

             if sess.has_key('max_inactive'):
                     # this is an existing session

                     # check length of inactivity
                     elapsed = time.time() -
sess['last']

                     # reset timer for next request
                     sess['last'] = time.time()
                     sess.save()

                     # compare elapsed inactivity to
maximum allowed
                     if elapsed >
sess['max_inactive']:
                             # it's been too long

                             # uncomment to delete
session (optional)
                             sess.delete()

                             # force user to
reauthenticate
                             return 0
                     else:
                             # still within time limit
                             #
req.write("Authorized.\n\n")

                             # allow user to continue
                             return 1
             else:
                     # this must be a new session, so
set session variables

                     # set maximum inactivity allowed,
in seconds
                     sess['max_inactive'] = 500

                     # initialize timer
                     sess['last'] = time.time()

                     sess.save()

                     # do new session stuff here
                     # req.write("Session
started.\n\n")

                     # allow user to continue
                     return 1
     else:
             # wrong user or password, force user to
reauthenticate
             return 0


From christopher.jackson at gmail.com  Wed Jan 19 13:23:23 2005
From: christopher.jackson at gmail.com (Chris Jackson)
Date: Wed Jan 19 13:23:25 2005
Subject: [mod_python] Scripts executed in /
In-Reply-To: <200501191407.28650.raniz@gmx.net>
References: <200501191407.28650.raniz@gmx.net>
Message-ID: <4d11484d050119102337b5c6@mail.gmail.com>

Where is your apache installation and python installation located?

~= Chris =~


On Wed, 19 Jan 2005 14:07:28 +0100, Daniel Raneland <raniz@gmx.net> wrote:
> Hi.
> 
> I noticed that all my scripts are run in / and not in the directory where the
> script resides...
> 
> A simple os.listdir( '.' ) returned this:
> ['bin', 'dev', 'etc', 'lib', 'mnt', 'opt', 'tmp', 'sys', 'var', 'usr', 'boot',
> 'home', 'proc', 'sbin', 'root', 'stage1-x86-2004.3.tar.bz2', '.viminfo',
> '.bash_history', '.reiserfs_priv']
> 
> This causes some problems... such as not being able to import files in the
> same dir as the script, and not being able to open files and directories
> without giving an absolute path.
> 
> Is there any way to change this via a configuration setting or is it
> hard-coded into mod_python?
> 
> Regards,
> /Raniz
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From christopher.jackson at gmail.com  Wed Jan 19 13:43:05 2005
From: christopher.jackson at gmail.com (Chris Jackson)
Date: Wed Jan 19 13:43:06 2005
Subject: [mod_python] populate user name in login prompt (for session)
In-Reply-To: <20050119182025.34322.qmail@web81209.mail.yahoo.com>
References: <20050119182025.34322.qmail@web81209.mail.yahoo.com>
Message-ID: <4d11484d050119104325822d94@mail.gmail.com>

You could just use Apache Authentication.  They have an automatic
login popup, and then your PythonAuthenHandler can pick up the
username and password that was entered.

~= Chris =~


On Wed, 19 Jan 2005 10:20:25 -0800 (PST), Robert Thomas Davis
<rdavisunr@yahoo.com> wrote:
> Hey all
> 
> My site requires a password to be accessed...I do not
> really care what the user name is.  Thus, I would like
> to populate the login prompt with a default name, like
> user or admin, etc.  Is this possible or is it
> possible to just prompt for a password and nothing
> else?  I have included the code I am using (this code
> was clipped from an earlier post and modified).
> 
> Thanks
> 
> Rob
> 
> def __auth__(req, user, passwd):
> 
>      # removed check for user=USER
> 
>      if passwd == PASS:
>              # user has successfully authenticated
>              sess = Session(req)
> 
>              if sess.has_key('max_inactive'):
>                      # this is an existing session
> 
>                      # check length of inactivity
>                      elapsed = time.time() -
> sess['last']
> 
>                      # reset timer for next request
>                      sess['last'] = time.time()
>                      sess.save()
> 
>                      # compare elapsed inactivity to
> maximum allowed
>                      if elapsed >
> sess['max_inactive']:
>                              # it's been too long
> 
>                              # uncomment to delete
> session (optional)
>                              sess.delete()
> 
>                              # force user to
> reauthenticate
>                              return 0
>                      else:
>                              # still within time limit
>                              #
> req.write("Authorized.\n\n")
> 
>                              # allow user to continue
>                              return 1
>              else:
>                      # this must be a new session, so
> set session variables
> 
>                      # set maximum inactivity allowed,
> in seconds
>                      sess['max_inactive'] = 500
> 
>                      # initialize timer
>                      sess['last'] = time.time()
> 
>                      sess.save()
> 
>                      # do new session stuff here
>                      # req.write("Session
> started.\n\n")
> 
>                      # allow user to continue
>                      return 1
>      else:
>              # wrong user or password, force user to
> reauthenticate
>              return 0
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From nick at dd.revealed.net  Wed Jan 19 13:44:57 2005
From: nick at dd.revealed.net (Nick)
Date: Wed Jan 19 13:45:07 2005
Subject: [mod_python] populate user name in login prompt (for session)
In-Reply-To: <20050119182025.34322.qmail@web81209.mail.yahoo.com>
References: <20050119182025.34322.qmail@web81209.mail.yahoo.com>
Message-ID: <41EEAAA9.9000908@dd.revealed.net>

You can ignore the user name if you choose; but prefilling the 
authentication dialog, that's a browser thing.

Nick

Robert Thomas Davis wrote:
> Hey all
> 
> My site requires a password to be accessed...I do not
> really care what the user name is.  Thus, I would like
> to populate the login prompt with a default name, like
> user or admin, etc.  Is this possible or is it
> possible to just prompt for a password and nothing
> else?  I have included the code I am using (this code
> was clipped from an earlier post and modified).
> 
> Thanks
> 
> Rob
> 
> def __auth__(req, user, passwd):
> 
>      # removed check for user=USER
> 
>      if passwd == PASS:
>              # user has successfully authenticated
>              sess = Session(req)
> 
>              if sess.has_key('max_inactive'):
>                      # this is an existing session
> 
>                      # check length of inactivity
>                      elapsed = time.time() -
> sess['last']
> 
>                      # reset timer for next request
>                      sess['last'] = time.time()
>                      sess.save()
> 
>                      # compare elapsed inactivity to
> maximum allowed
>                      if elapsed >
> sess['max_inactive']:
>                              # it's been too long
> 
>                              # uncomment to delete
> session (optional)
>                              sess.delete()
> 
>                              # force user to
> reauthenticate
>                              return 0
>                      else:
>                              # still within time limit
>                              #
> req.write("Authorized.\n\n")
> 
>                              # allow user to continue
>                              return 1
>              else:
>                      # this must be a new session, so
> set session variables
> 
>                      # set maximum inactivity allowed,
> in seconds
>                      sess['max_inactive'] = 500
> 
>                      # initialize timer
>                      sess['last'] = time.time()
> 
>                      sess.save()
> 
>                      # do new session stuff here
>                      # req.write("Session
> started.\n\n")
> 
>                      # allow user to continue
>                      return 1
>      else:
>              # wrong user or password, force user to
> reauthenticate
>              return 0
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From christopher.jackson at gmail.com  Wed Jan 19 13:45:59 2005
From: christopher.jackson at gmail.com (Chris Jackson)
Date: Wed Jan 19 13:46:02 2005
Subject: [mod_python] Publisher Session not functional (?)
In-Reply-To: <200501191940.27120.almad@include.cz>
References: <200501190008.20354.almad@include.cz>
	<200501191231.34883.almad@include.cz>
	<4d11484d05011910105d2729a6@mail.gmail.com>
	<200501191940.27120.almad@include.cz>
Message-ID: <4d11484d05011910454907a278@mail.gmail.com>

[adding mod_python]


On Wed, 19 Jan 2005 19:40:26 +0100, Lukas Linhart <almad@include.cz> wrote:
> E-mail Chris Jackson ze dne Wed 19. of January 2005 19:10:
> > I noticed that your "DirectoryIndex" is called zapisnik.py, however your
> > handler is called index.  You can probably exclude the DirectoryIndex
> > option, and also do no worry about putting the .pyc extensions on your
> > options.
> >
> > ~= Chris =~
> 
> DirectoryIndex is inherited from apache config.
> However, output I send was from file pokus.py, extecuted by
> http://almad.net/pokus.py or http://almad.net/pokus.py/index - both gave same
> output.
> 
> Thanks,
> 
> --
> 
> Lukas "Almad" Linhart
> 
> [:: http://www.Include.cz/ ::]
> [:: Including Your wishes ::]
> [:: PGP/GNUPg key: http://download.almad.net/pubkey.asc ::]
>
From grahamd at dscpl.com.au  Wed Jan 19 14:33:40 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Jan 19 14:33:49 2005
Subject: [mod_python] Getting mptest.py to work
In-Reply-To: <20050119122155.GN8887@sun.ac.za>
References: <20050119101314.GI8887@sun.ac.za>
	<D4D5C2DC-6A04-11D9-8268-000393DCF16E@dscpl.com.au>
	<20050119104040.GL8887@sun.ac.za>
	<C9469C7E-6A09-11D9-8268-000393DCF16E@dscpl.com.au>
	<20050119122155.GN8887@sun.ac.za>
Message-ID: <05FD9477-6A51-11D9-8268-000393DCF16E@dscpl.com.au>


On 19/01/2005, at 11:21 PM, Johann Spies wrote:

> Dear Graham,
>
> Thanks for your patience and help.  As you can see I have a lot to
> learn about apache and related products.
>
> On Wed, Jan 19, 2005 at 10:03:44PM +1100, Graham Dumpleton wrote:
>>
>> Do a sanity check to see if the .htaccess file is actually being read.
>> One can use another feature of mod_python to check this. Add:
>>
>>   PythonOption Name
>>
>> If mod_python is working okay and the .htaccess file is being read,
>> this should cause a 500 server error to be returned as a value for
>> option hasn't been supplied.
>
> This did not produce any error or success.

I can only guess then that the permissions on the .htaccess file
didn't include read access to others. The file needs to be readable
by the user Apache runs under. This isn't usually root so the file
needs to be readable to others or have group membership and readership
for group that Apache runs as.

>>
>> If you don't see this, then might be that main httpd.conf file not
>> configured to allow .htaccess in that part of directory hierarchy,
>> although, not sure if that is possible.
>>
>> Next step might be to use the original <Directory> directive block
>> you had and put it in the main httpd.conf in an appropriate spot
>> to see if that makes a difference.
>
> So I  created a file in /etc/apache2/sites-enabled with the following
> content:
>
> <Directory /var/www/test/>
>    AddHandler mod_python .py
>    PythonHandler mptest
>    PythonDebug On
> </Directory>
>
> And now I get the 500 server error when I click on mptest.py (just in
> the browser - nothing in /var/log/apache2/error.log) after a
> considerable period of time. Going just to http://localhost/test/
> results in a directory being displayed with no error message.
>

Use:

   http://localhost/test/foo.py

Only requests which have a ".py" extension will be routed through the
handler. Ie., the "foo" bit doesn't matter as long as ends in ".py".

To have directory access also, or any extension for that matter, map
to handler, you need to look at using "SetHandler" instead of
"AddHandler" Ie.,

   SetHandler mod_python


From lekatsas at gmail.com  Wed Jan 19 17:19:49 2005
From: lekatsas at gmail.com (Haris Lekatsas)
Date: Wed Jan 19 17:19:50 2005
Subject: [mod_python] preserving the session across subdomains
Message-ID: <1848e5f10501191419230a3242@mail.gmail.com>

Hello,

I have a couple of domains that could be hosted in the same or even
different machines, e.g. sub1.mydomain.com and sub2.mydomain.com and
in of them I initiate a session using the Session module. I would like
to maintain the session across these two domains so when a surfer goes
from one to another his session remains intact. Is it possible to do
this with the Session module? or do I need to use Cookies explicitly?

Thanks,
Haris Lekatsas
From bas at vandorp.nu  Wed Jan 19 18:39:01 2005
From: bas at vandorp.nu (Bas van Dorp)
Date: Wed Jan 19 18:39:04 2005
Subject: [mod_python] mptest.py works, other .py files don't
Message-ID: <1106177941.11185.46.camel@fons>

Hi,

I have the following configuration running:

Apache/2.0.52 (FreeBSD) PHP/5.0.3 mod_python/3.1.3 Python/2.3.4 Server 

I have this apache configuration:

==> httpd.conf:

<Directory /home/www/basd/python>
    AddHandler mod_python .py
    PythonHandler mptest
    PythonDebug On
</Directory>

DocumentRoot "/home/www/"


==> mptest.py:
from mod_python import apache

def handler(req):
    req.write("Hello World!")
    return apache.OK


Guess what? This works :-)) However, when I rename this file to
mptest2.py, I get this:

Mod_python error: "PythonHandler mptest"

Traceback (most recent call last):

  File "/usr/local/lib/python2.3/site-packages/mod_python/apache.py", line 287, in HandlerDispatch
    log=debug)

  File "/usr/local/lib/python2.3/site-packages/mod_python/apache.py", line 454, in import_module
    f, p, d = imp.find_module(parts[i], path)

ImportError: No module named mptest


This was not what I expected. I've read this over and over:
http://www.modpython.org/live/current/doc-html/tut-what-it-do.html

The last paragraph explicitly states that the name of my python script
doesn't matter. I probably missed something... I've tried a lot of
things, but I still get errors. I seem to be able to make mod_python to
execute only the scripts I specify in httpd.conf, and nothing else.
Specifying multiple files in httpd.conf also gives interesting results.
For example: 

==> httpd.conf:
<Directory /home/www/basd/python>
    AddHandler mod_python .py
    PythonHandler mptest
    PythonHandler mptest2
    PythonDebug On
</Directory>

==> mptest.py:
from mod_python import apache

def handler(req):
    req.write("Hello World!")
    return apache.OK

==> mptest2.py:
from mod_python import apache

def handler(req):
    req.write("Hello Universe!")
    return apache.OK


Whether I point my browser to mptest.py or mptest2.py, I get the same
result:

Hello World!Hello Universe!


I don't get it. I would like to tell Apache to parse all .py scripts in
certain directories, just like I do with .php scripts. But how?

Greetings and thanks in advance,

Bas

From sanders at apache.org  Wed Jan 19 18:40:08 2005
From: sanders at apache.org (Scott Sanders)
Date: Wed Jan 19 18:40:11 2005
Subject: [mod_python] How do you make a subrequest?
Message-ID: <73C80BAD-6A73-11D9-81CD-000A95D2D288@apache.org>

I want to make a subrequest to a URI, but not as a redirect, more like 
an include.  The sub request would return the result of the request as 
a string.  Is there a way to do this?  I assume it is doable in the 
Apache API.  Even a pointer to some other apache module's c code that 
does it would be helpful.

Thanks
Scott Sanders

From nicolas.lehuen at gmail.com  Wed Jan 19 19:03:53 2005
From: nicolas.lehuen at gmail.com (Nicolas Lehuen)
Date: Wed Jan 19 19:03:55 2005
Subject: [mod_python] mptest.py works, other .py files don't
In-Reply-To: <1106177941.11185.46.camel@fons>
References: <1106177941.11185.46.camel@fons>
Message-ID: <c298f2d705011916032e707b99@mail.gmail.com>

On Thu, 20 Jan 2005 00:39:01 +0100, Bas van Dorp <bas@vandorp.nu> wrote:
[...]
> Guess what? This works :-)) However, when I rename this file to
> mptest2.py, I get this:
> 
> Mod_python error: "PythonHandler mptest"
> 
> Traceback (most recent call last):
> 
>   File "/usr/local/lib/python2.3/site-packages/mod_python/apache.py", line 287, in HandlerDispatch
>     log=debug)
> 
>   File "/usr/local/lib/python2.3/site-packages/mod_python/apache.py", line 454, in import_module
>     f, p, d = imp.find_module(parts[i], path)
> 
> ImportError: No module named mptest
> 
> This was not what I expected. I've read this over and over:
> http://www.modpython.org/live/current/doc-html/tut-what-it-do.html
> 
> The last paragraph explicitly states that the name of my python script
> doesn't matter. I probably missed something... I've tried a lot of
> things, but I still get errors. I seem to be able to make mod_python to
> execute only the scripts I specify in httpd.conf, and nothing else.
> Specifying multiple files in httpd.conf also gives interesting results.
> For example:
> 
> ==> httpd.conf:
> <Directory /home/www/basd/python>
>     AddHandler mod_python .py
>     PythonHandler mptest
>     PythonHandler mptest2
>     PythonDebug On
> </Directory>
> 
> ==> mptest.py:
> from mod_python import apache
> 
> def handler(req):
>     req.write("Hello World!")
>     return apache.OK
> 
> ==> mptest2.py:
> from mod_python import apache
> 
> def handler(req):
>     req.write("Hello Universe!")
>     return apache.OK
> 
> Whether I point my browser to mptest.py or mptest2.py, I get the same
> result:
> 
> Hello World!Hello Universe!
> 
> I don't get it. I would like to tell Apache to parse all .py scripts in
> certain directories, just like I do with .php scripts. But how?
> 
> Greetings and thanks in advance,
> 
> Bas

The name of the .py file in the URL doesn't matters, but the name of
the PythonHandler does. I think we should change the doc because
you're not the first to be confused about this.

The configuration file reads like this :

# for directory /home/www/basd/python
# which is accessed through something like http://localhost/basd/python
<Directory /home/www/basd/python>
     # any filename ending by .py must be handled by mod_python
     AddHandler mod_python .py
     # mod_python will call the handler function defined in the mptest module
     # which will be imported from the /home/www/basd/python
directory, hence from
     # /home/www/basd/python/mptest.py
     PythonHandler mptest
     # add debug information i.e. outputs stack traces to the client
     PythonDebug On
 </Directory>

Now I hope it's clear : with this configuration, the module with then
handler() function MUST be in /home/www/basd/python/mptest.py. But you
can test the module by requesting ANY URL provided it ends with .py :

http://localhost/basd/python/foo.py
http://localhost/basd/python/bar.py

And so on. Naturally, this test handler won't lead you very far... To
build your real application, you'll have to write some Python or PSP
code for each and every page or function your site provide.

What you need, therefore, is a dispatching handler function, which
knows where to find the code for the various pages of your
application. That's what you get with the builtin mod_python.publisher
handler (which is described in the documentation), or other handlers,
like the one provided by spin-off projects like mod_python servlets
(MPS), Vampire, etc.

I hope this helps,
Regards,
Nicolas
From grahamd at dscpl.com.au  Wed Jan 19 19:45:21 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Jan 19 19:45:23 2005
Subject: [mod_python] mptest.py works, other .py files don't
Message-ID: <1106181921.8508@dscpl.user.openhosting.com>

Bas van Dorp wrote ..
> I don't get it. I would like to tell Apache to parse all .py scripts in
> certain directories, just like I do with .php scripts. But how?

The closest analogy to that will be what is supported by Vampire.

  http://www.dscpl.com.au/projects/vampire

Your config would be:

  SetHandler mod_python
  PythonHandler vampire
  PythonDebug On

You can then stick any type of file, eg. .html, .jpg etc, into the directory
or any subdirectories. Those files will be served up normally.

At the same time, if you have .py files, they can potentially intercept a
request for a resource with the same basename. For example, if a request
is for "foo.html" and you have a Python file "foo.py", if the Python file
defines "handler_html()", then that method will be called to generate
the response. Note that "foo.html" didn't have to exist in doing that,
ie., could be purely generated content. Alternatively, if could read in
a physical "foo.html" and modify it in some way and return it. Ie., fill
out template data.

Unlike with mod_python.publisher where the methods for different
resources are generally all in the one code file, when using Vampire
each Python file relates to a specific resource. There can be multiple
methods in a Python file in Vampire, but this is only done when a
resource can be represented in multiple formats.

Also, in Vampire, the methods are basically standard mod_python
content handlers whereas with mod_python.publisher, how data and
status is returned is different.

Have fun.

Graham
From god at skri.org  Wed Jan 19 21:01:23 2005
From: god at skri.org (Simon Kesenci)
Date: Wed Jan 19 21:02:53 2005
Subject: [mod_python] CWD in PythonPath
Message-ID: <2F9053F4-6A87-11D9-A6AD-000393CA53DC@skri.org>

There doesn't appear to be a way to put the current working directory 
in the path using the PythonPath directive.  It does fine when a module 
in the directory in question is named in a handler directive when 
PythonPath is not set.  But when I do set PythonPath, it can only pick 
up modules in directories explicitly named in the path.

I currently have
PythonPath "sys.path + ['/home/www/import']"
as the directive, but I have also tried expanding sys.path out in the 
directive with both '' and '.'.  Still not luck.

--S.

From grahamd at dscpl.com.au  Wed Jan 19 21:26:31 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Jan 19 21:26:33 2005
Subject: [mod_python] CWD in PythonPath
Message-ID: <1106187991.23536@dscpl.user.openhosting.com>

Simon Kesenci wrote ..
> There doesn't appear to be a way to put the current working directory 
> in the path using the PythonPath directive.  It does fine when a module
> in the directory in question is named in a handler directive when 
> PythonPath is not set.  But when I do set PythonPath, it can only pick
> up modules in directories explicitly named in the path.
> 
> I currently have
> PythonPath "sys.path + ['/home/www/import']"
> as the directive, but I have also tried expanding sys.path out in the 
> directive with both '' and '.'.  Still not luck.

It is always a bit hard to know what people are trying to achieve when
they start talking about import problems, but you might look at the
method:

  apache.import_module()

One of the possible arguments to it is the search path to use. Ie.,
overrides sys.path. You could therefore construct a path which
includes sys.path and any other place you want to look just for that
import.

Be warned though that import_module() has its problems as well,
but it is the only other option in mod_python at the moment. Some
other packages provide their own module import mechanisms to
get around some of its shortcomings, but whether they may be
appropriate is going to be dependent on what you are trying to
do and what handler mechanisms you may or may not be using, eg.
PSP, mod_python.publisher etc.

Graham
From grisha at modpython.org  Wed Jan 19 21:56:17 2005
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Wed Jan 19 21:56:25 2005
Subject: [mod_python] How do you make a subrequest?
In-Reply-To: <73C80BAD-6A73-11D9-81CD-000A95D2D288@apache.org>
References: <73C80BAD-6A73-11D9-81CD-000A95D2D288@apache.org>
Message-ID: <20050119215244.O79753@grisha.dyndns.org>


Sounds exactly like what req.internal_redirect() does.

Or if your goal is to somehow transform the output of the [sub] request, 
then might a filter be the answer?

Grisha

On Wed, 19 Jan 2005, Scott Sanders wrote:

> I want to make a subrequest to a URI, but not as a redirect, more like an 
> include.  The sub request would return the result of the request as a string. 
> Is there a way to do this?  I assume it is doable in the Apache API.  Even a 
> pointer to some other apache module's c code that does it would be helpful.
>
> Thanks
> Scott Sanders
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From gnb at itga.com.au  Wed Jan 19 22:01:35 2005
From: gnb at itga.com.au (Gregory Bond)
Date: Wed Jan 19 22:01:57 2005
Subject: [mod_python] Scripts executed in /
In-Reply-To: <200501191407.28650.raniz@gmx.net>
References: <200501191407.28650.raniz@gmx.net>
Message-ID: <41EF1F0F.8010003@itga.com.au>

Daniel Raneland wrote:

>Hi.
>
>I noticed that all my scripts are run in / and not in the directory where the 
>script resides...
>

http://www.modpython.org/FAQ/faqw.py?req=show&file=faq03.006.htp
From dpopowich at comcast.net  Thu Jan 20 09:10:08 2005
From: dpopowich at comcast.net (Daniel Popowich)
Date: Thu Jan 20 09:10:16 2005
Subject: [mod_python] mptest.py works, other .py files don't
In-Reply-To: <c298f2d705011916032e707b99@mail.gmail.com>
References: <1106177941.11185.46.camel@fons>
	<c298f2d705011916032e707b99@mail.gmail.com>
Message-ID: <16879.48064.353956.173966@greenmonster.local>


> What you need, therefore, is a dispatching handler function, which
> knows where to find the code for the various pages of your
> application. That's what you get with the builtin mod_python.publisher
> handler (which is described in the documentation), or other handlers,
> like the one provided by spin-off projects like mod_python servlets
> (MPS), Vampire, etc.

Yes, there does seem to be a need for a central dispatching function:
just look at the preponderance of solutions, as you state.  Other
anecdotal evidence is the number of questions regarding "how do I
import..." and "what's my cwd" on this list.

When writing mpservlets I wanted to use SetHandler for whole
directory hierarchies, but immediately ran into trouble with
importing servlet code.  That's when I brewed my own solution: create
a cache, "full path of filename"=>"code object", using the pyhton
builtin function, execfile, to create the code object.  Subsequent
requests for the same servlet grab it from the cache.

Could there be a meeting of the minds, as it were, and develop a
common function to meet the needs of many, if not all?

Meanwhile...if you're looking for a handler that has one solution to
this problem and if you want to code your pages using OO techniques,
take a look at mod_python servlets (mpservlets).  Link below.  There's
a link on the homepage to a live tutorial where you can view the
source as you go.  The tutorial is included in the download, too.

Cheers,

Daniel Popowich
-----------------------------------------------
http://home.comcast.net/~d.popowich/mpservlets/
From sanders at apache.org  Thu Jan 20 14:07:19 2005
From: sanders at apache.org (Scott Sanders)
Date: Thu Jan 20 14:07:26 2005
Subject: [mod_python] How do you make a subrequest?
In-Reply-To: <20050119215244.O79753@grisha.dyndns.org>
References: <73C80BAD-6A73-11D9-81CD-000A95D2D288@apache.org>
	<20050119215244.O79753@grisha.dyndns.org>
Message-ID: <819F4FA6-6B16-11D9-81CD-000A95D2D288@apache.org>

I don't think that is what req.internal_redirect() does.  I want the 
main request and the sub request to participate in the output, for 
example, a server side include:

Main request puts out the html header information, then calls a sub 
request to put out the menu html, then the main request takes over 
again and outputs the rest of the page, etc.

I really need the sub request to return it content to me, and not to 
the user.  With internal_redirect(), the original request loses control 
over the process, when I would like it to participate again.

Scott

On Jan 19, 2005, at 6:56 PM, Gregory (Grisha) Trubetskoy wrote:

>
> Sounds exactly like what req.internal_redirect() does.
>
> Or if your goal is to somehow transform the output of the [sub] 
> request, then might a filter be the answer?
>
> Grisha
>
> On Wed, 19 Jan 2005, Scott Sanders wrote:
>
>> I want to make a subrequest to a URI, but not as a redirect, more 
>> like an include.  The sub request would return the result of the 
>> request as a string. Is there a way to do this?  I assume it is 
>> doable in the Apache API.  Even a pointer to some other apache 
>> module's c code that does it would be helpful.
>>
>> Thanks
>> Scott Sanders
>>
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>

From pf_moore at yahoo.co.uk  Thu Jan 20 14:36:13 2005
From: pf_moore at yahoo.co.uk (Paul Moore)
Date: Thu Jan 20 14:36:23 2005
Subject: [mod_python] Re: [Fwd: Re: Mod_python for Python 2.4]
References: <41ED585D.401@isnet.net.tr>
Message-ID: <uacr37v0y.fsf@yahoo.co.uk>

Murat ?zs?yler <murat.ozsoyler@isnet.net.tr> writes:

> unfortunately installation stops complaining that it can not find Python 
> 2.3 in the registry. 

On Windows, you need extension binaries compiled specifically for the
version of Python you are using. As far as I know, no Python
2.4-compatible binaries are publicly available for mod_python on
Windows at this point in time.

Paul.
-- 
The only reason some people get lost in thought is because it's
unfamiliar territory -- Paul Fix

From nicolas.lehuen at gmail.com  Thu Jan 20 14:52:26 2005
From: nicolas.lehuen at gmail.com (Nicolas Lehuen)
Date: Thu Jan 20 14:52:28 2005
Subject: [mod_python] How do you make a subrequest?
In-Reply-To: <819F4FA6-6B16-11D9-81CD-000A95D2D288@apache.org>
References: <73C80BAD-6A73-11D9-81CD-000A95D2D288@apache.org>
	<20050119215244.O79753@grisha.dyndns.org>
	<819F4FA6-6B16-11D9-81CD-000A95D2D288@apache.org>
Message-ID: <c298f2d705012011527762de6e@mail.gmail.com>

On Thu, 20 Jan 2005 11:07:19 -0800, Scott Sanders <sanders@apache.org> wrote:
> I don't think that is what req.internal_redirect() does.  I want the
> main request and the sub request to participate in the output, for
> example, a server side include:
> 
> Main request puts out the html header information, then calls a sub
> request to put out the menu html, then the main request takes over
> again and outputs the rest of the page, etc.
> 
> I really need the sub request to return it content to me, and not to
> the user.  With internal_redirect(), the original request loses control
> over the process, when I would like it to participate again.
> 
> Scott

I wonder if this would be best solved by a mod_python level method
such as req.include_request or by a higher-level page composition
framework.

In the Java world, they solved it by a Portlet framework built above
the Servlet framework, but they may have chosen the high-level route
because it was too late to do thorough changes to the servlet API.

There is a problem if you want to compose pages from "patches" (in the
sense that your page becomes a "patchwork") built by different
handlers (I assume that's what you mean by "subrequest"). Low-level
handlers are supposed to respond to an HTTP request and build an HTTP
message in response.

Typically, a handler will write on the request output stream. That's
not really a problem if you call the subrequest handlers at the
precise place you want them inserted into the patchwork, but there
still remains a problem with HTTP headers. So you could build a mock
request object, ask mod_python for the proper handler for a given
internal URI, run it with the mock request object and decide what you
do with its output HTTP headers and the generated content (typically,
discard the HTTP headers other than Set-Cookie and output the content
on the connection).

It could work, but it feels a bit like a hack, and I think that's why
the Java people opted for an independent content composition framework
(the Portlet API).

On the other hand, you can already do what you want by yourself,
without touching any part of mod_python, just by putting your various
patches in shared modules, importing those modules in the various
published modules or PSP pages, call your patches and expect them to
return a string to be included in your current document. What's the
problem with this approach ?

Regards,
Nicolas
From nick at dd.revealed.net  Thu Jan 20 15:03:07 2005
From: nick at dd.revealed.net (Nick)
Date: Thu Jan 20 15:03:31 2005
Subject: [mod_python] How do you make a subrequest?
In-Reply-To: <c298f2d705012011527762de6e@mail.gmail.com>
References: <73C80BAD-6A73-11D9-81CD-000A95D2D288@apache.org>	<20050119215244.O79753@grisha.dyndns.org>	<819F4FA6-6B16-11D9-81CD-000A95D2D288@apache.org>
	<c298f2d705012011527762de6e@mail.gmail.com>
Message-ID: <41F00E7B.8040700@dd.revealed.net>

You could just use urllib(2) to make requests back to the server to get the 
output from the page you want.  Not pretty, but it'll get the job done.

Nick

Nicolas Lehuen wrote:
> On Thu, 20 Jan 2005 11:07:19 -0800, Scott Sanders <sanders@apache.org> wrote:
> 
>>I don't think that is what req.internal_redirect() does.  I want the
>>main request and the sub request to participate in the output, for
>>example, a server side include:
>>
>>Main request puts out the html header information, then calls a sub
>>request to put out the menu html, then the main request takes over
>>again and outputs the rest of the page, etc.
>>
>>I really need the sub request to return it content to me, and not to
>>the user.  With internal_redirect(), the original request loses control
>>over the process, when I would like it to participate again.
>>
>>Scott
> 
> 
> I wonder if this would be best solved by a mod_python level method
> such as req.include_request or by a higher-level page composition
> framework.
> 
> In the Java world, they solved it by a Portlet framework built above
> the Servlet framework, but they may have chosen the high-level route
> because it was too late to do thorough changes to the servlet API.
> 
> There is a problem if you want to compose pages from "patches" (in the
> sense that your page becomes a "patchwork") built by different
> handlers (I assume that's what you mean by "subrequest"). Low-level
> handlers are supposed to respond to an HTTP request and build an HTTP
> message in response.
> 
> Typically, a handler will write on the request output stream. That's
> not really a problem if you call the subrequest handlers at the
> precise place you want them inserted into the patchwork, but there
> still remains a problem with HTTP headers. So you could build a mock
> request object, ask mod_python for the proper handler for a given
> internal URI, run it with the mock request object and decide what you
> do with its output HTTP headers and the generated content (typically,
> discard the HTTP headers other than Set-Cookie and output the content
> on the connection).
> 
> It could work, but it feels a bit like a hack, and I think that's why
> the Java people opted for an independent content composition framework
> (the Portlet API).
> 
> On the other hand, you can already do what you want by yourself,
> without touching any part of mod_python, just by putting your various
> patches in shared modules, importing those modules in the various
> published modules or PSP pages, call your patches and expect them to
> return a string to be included in your current document. What's the
> problem with this approach ?
> 
> Regards,
> Nicolas
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From bl at netgroup.dk  Thu Jan 20 17:00:23 2005
From: bl at netgroup.dk (Bo Lorentsen)
Date: Thu Jan 20 17:00:27 2005
Subject: [mod_python] PythonOption access
Message-ID: <41F029F7.9030502@netgroup.dk>

Hi ...

I am a quite happy mod_python user (writting a payment system), and I 
really like the combination of a OO language like python and a web 
server like apache2. There have only been two real issues, I have been 
annoyed about. One is the missing possibility to reload a imported 
module on update, and the other is the PythonOption access.

Will it be possible to access PythonOptions like log_error in a more 
global context (log_error is a function on the apache module), so that 
global values can get there init value on module init and NOT on the 
first incomming request ? I have some code that work around this, but 
its not pretty, and I like things to be so, and I don't understand why 
it has to be a method on the request module.

Is this completely impossible ?

/BL
From fumanchu at amor.org  Thu Jan 20 17:14:16 2005
From: fumanchu at amor.org (Robert Brewer)
Date: Thu Jan 20 17:17:24 2005
Subject: [mod_python] PythonOption access
Message-ID: <3A81C87DC164034AA4E2DDFE11D258E3398231@exchange.hqamor.amorhq.net>

Bo Lorentsen wrote:
> Will it be possible to access PythonOptions like log_error in a more 
> global context (log_error is a function on the apache 
> module), so that 
> global values can get there init value on module init and NOT on the 
> first incomming request ? I have some code that work around this, but 
> its not pretty, and I like things to be so, and I don't 
> understand why 
> it has to be a method on the request module.
> 
> Is this completely impossible ?

Not at all. Use the PythonImport directive to load a "global" module
when Apache starts, and have that module inspect and preserve
PythonOption values.


Robert Brewer
MIS
Amor Ministries
fumanchu@amor.org

From grahamd at dscpl.com.au  Thu Jan 20 17:37:45 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Jan 20 17:37:47 2005
Subject: [mod_python] PythonOption access
Message-ID: <1106260665.4498@dscpl.user.openhosting.com>

Bo Lorentsen wrote ..
> Hi ...
> 
> I am a quite happy mod_python user (writting a payment system), and I 
> really like the combination of a OO language like python and a web 
> server like apache2. There have only been two real issues, I have been
> annoyed about. One is the missing possibility to reload a imported 
> module on update, and the other is the PythonOption access.
> 
> Will it be possible to access PythonOptions like log_error in a more 
> global context (log_error is a function on the apache module), so that
> global values can get there init value on module init and NOT on the 
> first incomming request ? I have some code that work around this, but 
> its not pretty, and I like things to be so, and I don't understand why
> it has to be a method on the request module.
> 
> Is this completely impossible ?

If I understand your issue with PythonOption correctly, the underlying
reason that get_options() is only available through the request object
is most likely that the set of options returned is dependent on the URL
accessed. That is, they aren't strictly global and thus fixed.

Take for example a .htaccess file containing:

  PythonOption A 1
  PythonOption B 2

If a URL request maps to a file in that directory, get_options() will return:

  A =1 
  B =2

If you have a subdirectory with another .htaccess file containing:

  PythonOption B 3
  PythonOption C 4

If a URL request maps to a file in that subdirectory, get_options() will
return:

  A = 1
  B = 3
  C = 4

That is, the options from the parent directory are first inherited and
then overridden by any local to that directory sharing the same
name. Thus, all dependent on context and not global and fixed.

In terms of how to have global fixed options, what most people
probably do is have a special config module somewhere which
defines all their options as standard Python variables. Thus your
module simply imports the config module and accesses the
variables.

As to module reloading, there is the apache.import_module()
method. This is used to load the content handler defined by the
PythonHandler directive and if auto reload is turned on it will
be reloaded if that Python file changes. It will not however reload
a top level content handler if what is changed is something that
that content handler had in turn imported using "import".

One can use import_module() in a content handler instead of
"import", but needs to be done inside of actual handler() method
and there are still various problems with doing that. Vampire
tries to do a bit better job as far as the module importing system
goes to avoid these problems. It may or may not be useful to you.

If you want to explore the options better, you would be best off
posting some code examples of how you are achieving what you
want now.

Graham
From grahamd at dscpl.com.au  Thu Jan 20 17:47:41 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Jan 20 17:47:43 2005
Subject: [mod_python] PythonOption access
Message-ID: <1106261261.5933@dscpl.user.openhosting.com>

Robert Brewer wrote ..
> Bo Lorentsen wrote:
> > Will it be possible to access PythonOptions like log_error in a more
> > global context (log_error is a function on the apache 
> > module), so that 
> > global values can get there init value on module init and NOT on the
> > first incomming request ? I have some code that work around this, but
> > its not pretty, and I like things to be so, and I don't 
> > understand why 
> > it has to be a method on the request module.
> > 
> > Is this completely impossible ?
> 
> Not at all. Use the PythonImport directive to load a "global" module
> when Apache starts, and have that module inspect and preserve
> PythonOption values.

Hmmm, to access any options at this point would be dependent on
using the apache.config_tree() method. In that case, he could access
that from any module as part of the init of the module being loaded
and wouldn't have to use PythonImport.

Forgot about apache.config_tree() when I made my last post, probably
because I never use it, preferring to do everything in .htaccess files
instead. Not even sure what it returns. :-)

  config_tree()
    Returns the server-level configuration tree. This tree does not
    include directives from .htaccess files. This is a copy of  the tree,
    modifying it has no effect on the actual configuration.

Graham
From grahamd at dscpl.com.au  Thu Jan 20 19:54:43 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Jan 20 19:54:45 2005
Subject: [mod_python] PythonOption access
Message-ID: <1106268883.24610@dscpl.user.openhosting.com>

Bo Lorentsen wrote ..
> Will it be possible to access PythonOptions like log_error in a more 
> global context (log_error is a function on the apache module), so that
> global values can get there init value on module init and NOT on the 
> first incomming request ? I have some code that work around this, but 
> its not pretty, and I like things to be so, and I don't understand why
> it has to be a method on the request module.
> 
> Is this completely impossible ?

Having a bit more of a think about this, it wouldn't be too hard for me to
implement a relatively clean mechanism which would allow access to the
request object when loading a module, in the Vampire package I provide.

In Vampire, it uses its own module caching and import system and thus I
have more control over this process. At the moment the prototype for the
module import function is "importModule(name,path)". That is, the input
arguments are the name of the module, and the specific directory in which
that module is expected to be located.

The module importing mechanism in Vampire doesn't use the "imp"
module and instead uses "execfile()". As such, the code already creates
a module object into which the code file is executed in order to achieve
the same affect as an import. Ie.,

        module = imp.new_module(label)
        module.__file__ = file
        execfile(file,module.__dict__)

If the import function took an optional "req" object, I could place this
into the empty module prior to running execfile() and then remove
it afterwards. Ie.,

        module = imp.new_module(label)
        module.__file__ = file
        module.__req__ = req
        execfile(file,module.__dict__)
        del module.__dict__["__req__"]

The only other change would be where the code uses the import
function to load in content handlers, it would need to pass req.

That way the "req" object could be available just for the period of the
initialisation phase of an import. You probably wouldn't want to
cache the req object as it applies to a specific request as the cached
module would outlive it. You also wouldn't want to be relying on
information specific to a request. You could access the PythonOption
values, although you may want to avoid values set in .htaccess files
and go for ones you know are set in the httpd.conf file.

Anyway, in the end, this would allow you to do something like the
following in a content handler.

  from mod_python import apache

  if __req__ != None:
    options = __req__.get_options()
    if options.has_key("debug") and options["debug"]:
      apache.log_error(...)

Is this the sort of thing you were wanting, or have I misunderstood?

Overall I am not sure that this is a good idea or not. It has both good
points and bad points.

Maybe it shouldn't use an actual req object, but a new object which
incorporates some of what req provides, dropping stuff that may be
more specific to a particular request. Thus you might provide some
information about the server and python options, although not sure
how you deal with the issue of .htaccess level options being different
based on URL used for original request.

Anyway, worth thinking about some more.

Graham

From bl at netgroup.dk  Fri Jan 21 02:05:31 2005
From: bl at netgroup.dk (Bo Lorentsen)
Date: Fri Jan 21 03:40:59 2005
Subject: [mod_python] PythonOption access
In-Reply-To: <1106268883.24610@dscpl.user.openhosting.com>
References: <1106268883.24610@dscpl.user.openhosting.com>
Message-ID: <41F0A9BB.1080703@netgroup.dk>

Graham Dumpleton wrote:

>Having a bit more of a think about this, it wouldn't be too hard for me to
>implement a relatively clean mechanism which would allow access to the
>request object when loading a module, in the Vampire package I provide.
>  
>
First, thanks for all the input ...

I am not aware of what the "Vampire" module are, one of Your projects ?

>If the import function took an optional "req" object, I could place this
>into the empty module prior to running execfile() and then remove
>it afterwards. Ie.,
>
>        module = imp.new_module(label)
>        module.__file__ = file
>        module.__req__ = req
>        execfile(file,module.__dict__)
>        del module.__dict__["__req__"]
>  
>
So this is performed in the "python module loader", i guess ?

I am using the PythonHandler directly myself, and I guess this is more 
"low level", so control at this level are not possible ?

>That way the "req" object could be available just for the period of the
>initialisation phase of an import. You probably wouldn't want to
>cache the req object as it applies to a specific request as the cached
>module would outlive it. You also wouldn't want to be relying on
>information specific to a request. You could access the PythonOption
>values, although you may want to avoid values set in .htaccess files
>and go for ones you know are set in the httpd.conf file.
>  
>
Hmm, I know what You mean, but on the other hand ... I don't use one 
python script for more than one URL, and if I am, the script still 
remains in the same physical path in relation to the web server, anyway. 
Or are we talking about two different things ?

>Anyway, in the end, this would allow you to do something like the
>following in a content handler.
>
>  from mod_python import apache
>
>  if __req__ != None:
>    options = __req__.get_options()
>    if options.has_key("debug") and options["debug"]:
>      apache.log_error(...)
>  
>
Only ... I dislike the "if" :-)

I hoped for something like :

   from mod_python import apache

   pram = apache.get_option( 'custom_param' )

   ...

This is without the "if" as the only problem left will be that 
"custom_param" don't exist. I think the "__req__" object is a bad idea, 
as this is not a request situation, but module initialization. We know 
where the script is (and the .htaccess file), but no request have been 
send (well it has, but we need not to know about this in the "global" 
context !).

Anyway, this is how I dream about it :-)

>Is this the sort of thing you were wanting, or have I misunderstood?
>  
>
Yeps, with some corrections :-)

>Overall I am not sure that this is a good idea or not. It has both good
>points and bad points.
>  
>
I think I know what you mean. It is a "nice to have" thing and I already 
have a work around for this. But in my search for perfection :-)

>Maybe it shouldn't use an actual req object, but a new object which
>incorporates some of what req provides, dropping stuff that may be
>more specific to a particular request.
>
Thats my point :-)

>Thus you might provide some
>information about the server and python options, although not sure
>how you deal with the issue of .htaccess level options being different
>based on URL used for original request.
>  
>
Well there is tho kinds of URL's there is physical and abstract (as I 
understand it). Physical URL ends up mapped onto a physical path on the 
disk (by apache), and therefor know where to load a .htaccess file (and 
the document), but an abstract ends up in a PythonHandler, that takes 
care of the rest.

The abstract URL handler will only be able to load the .htaccess file in 
the dir where it lives, but no config change depends on the URL, as long 
as it ends up in our handler.

Hmm, hope this makes sense. Anyway, I don't see any problems regarding 
configuration and different URL's, but I may be missing somthing.

>Anyway, worth thinking about some more.
>  
>
Nice.

Anyway, python is a fantastic web script if you like your code to be 
readable :-)

/BL

From bl at netgroup.dk  Fri Jan 21 02:07:43 2005
From: bl at netgroup.dk (Bo Lorentsen)
Date: Fri Jan 21 03:41:01 2005
Subject: [mod_python] PythonOption access
In-Reply-To: <3A81C87DC164034AA4E2DDFE11D258E3398231@exchange.hqamor.amorhq.net>
References: <3A81C87DC164034AA4E2DDFE11D258E3398231@exchange.hqamor.amorhq.net>
Message-ID: <41F0AA3F.4030308@netgroup.dk>

Robert Brewer wrote:

>Not at all. Use the PythonImport directive to load a "global" module
>when Apache starts, and have that module inspect and preserve
>PythonOption values.
>  
>
How would I inspect "PythonOption" values from a PythonImport'ed module 
? I still have no access to the "req" object given to the handlers, otr 
even parts of it !

/BL

From grahamd at dscpl.com.au  Fri Jan 21 05:10:54 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Fri Jan 21 05:11:04 2005
Subject: [mod_python] PythonOption access
In-Reply-To: <41F0A9BB.1080703@netgroup.dk>
References: <1106268883.24610@dscpl.user.openhosting.com>
	<41F0A9BB.1080703@netgroup.dk>
Message-ID: <BCA8A7C9-6B94-11D9-8E9B-000393DCF16E@dscpl.com.au>


On 21/01/2005, at 6:05 PM, Bo Lorentsen wrote:

> Graham Dumpleton wrote:
>
> I am not aware of what the "Vampire" module are, one of Your projects ?

Project site is:

   http://www.dscpl.com.au/projects/vampire

>> If the import function took an optional "req" object, I could place 
>> this
>> into the empty module prior to running execfile() and then remove
>> it afterwards. Ie.,
>>
>>        module = imp.new_module(label)
>>        module.__file__ = file
>>        module.__req__ = req
>>        execfile(file,module.__dict__)
>>        del module.__dict__["__req__"]
>>
> So this is performed in the "python module loader", i guess ?

Yes, but as explained, we aren't using "import" here or even the "imp" 
module.
Would make more sense if you got down Vampire and had a dig around in it
as to how it handles module importing.

> I am using the PythonHandler directly myself, and I guess this is more 
> "low level", so control at this level are not possible ?

This level of control is possible. This wasn't theoretical and is 
entirely
practical thing that can be done in Vampire.

>> That way the "req" object could be available just for the period of 
>> the
>> initialisation phase of an import. You probably wouldn't want to
>> cache the req object as it applies to a specific request as the cached
>> module would outlive it. You also wouldn't want to be relying on
>> information specific to a request. You could access the PythonOption
>> values, although you may want to avoid values set in .htaccess files
>> and go for ones you know are set in the httpd.conf file.
>>
> Hmm, I know what You mean, but on the other hand ... I don't use one 
> python script for more than one URL, and if I am, the script still 
> remains in the same physical path in relation to the web server, 
> anyway. Or are we talking about two different things ?

If one using the module import system for sub imports in a content 
handler
then one can theoretically have common modules which are imported based 
on
different URL request. When doing a sub import though, one might not 
necessarily
pass through the req to sub imports.

Anyway, one Python file per URL is good, or one Python file per 
resource. This
is actually exactly what Vampire promotes and makes easy to achieve.

>> Anyway, in the end, this would allow you to do something like the
>> following in a content handler.
>>
>>  from mod_python import apache
>>
>>  if __req__ != None:
>>    options = __req__.get_options()
>>    if options.has_key("debug") and options["debug"]:
>>      apache.log_error(...)
>>
> Only ... I dislike the "if" :-)
>
> I hoped for something like :
>
>   from mod_python import apache
>
>   pram = apache.get_option( 'custom_param' )
>
>   ...
>
> This is without the "if" as the only problem left will be that 
> "custom_param" don't exist. I think the "__req__" object is a bad 
> idea, as this is not a request situation, but module initialization. 
> We know where the script is (and the .htaccess file), but no request 
> have been send (well it has, but we need not to know about this in the 
> "global" context !).
>
> Anyway, this is how I dream about it :-)

The "if" on __req__ can be avoided when it is a content handler being 
loaded
by the top level PythonHandler dispatcher as it would guarantee it is 
set.
In mod_python 3.1.X, get() can take a default parameter if not set, so 
could
just have:

   param = __req__.get_options().get("custom_param","0")

>> Overall I am not sure that this is a good idea or not. It has both 
>> good
>> points and bad points.
>>
> I think I know what you mean. It is a "nice to have" thing and I 
> already have a work around for this. But in my search for perfection 
> :-)

This whole idea actually fits in quite well with stuff I
have done with Vampire with configuration files outside of .htaccess 
mechanism
and automatic search mechanisms to find inherited config. It has always 
been
a shortcoming that one could only do the config search from inside 
execution
of request handler as one need the req object. With the scheme talked 
about
here, I can extend ability to access the config during module import 
phase.

Anyway, I can hope you find Vampire closer to perfection. :-)

>> Maybe it shouldn't use an actual req object, but a new object which
>> incorporates some of what req provides, dropping stuff that may be
>> more specific to a particular request.
>>
> Thats my point :-)

Possibly not complete, but the things from req it would/could have are:

   hlist
   interpreter
   server
   get_options()
   get_config()
   document_root()

This means there is nothing which could be used to write data back to 
the remote
client.

Figured I could call it __info__ and not __req__ when populated into the
namespace of the module when loading.

>> Thus you might provide some
>> information about the server and python options, although not sure
>> how you deal with the issue of .htaccess level options being different
>> based on URL used for original request.
>>
> Well there is tho kinds of URL's there is physical and abstract (as I 
> understand it). Physical URL ends up mapped onto a physical path on 
> the disk (by apache), and therefor know where to load a .htaccess file 
> (and the document), but an abstract ends up in a PythonHandler, that 
> takes care of the rest.
>
> The abstract URL handler will only be able to load the .htaccess file 
> in the dir where it lives, but no config change depends on the URL, as 
> long as it ends up in our handler.
>
> Hmm, hope this makes sense. Anyway, I don't see any problems regarding 
> configuration and different URL's, but I may be missing somthing.

Yeah, makes sense. In Vampire, the PythonHandler is set to a module not 
even
in the directory hierarchy. It handles the dispatch against actual 
content
handlers in directory hierarchy. Because actual content handlers are 
spread
over the directory hierarchy under the root managed by Vampire, the 
.htaccess
in sub directories come into play because there is still a physical 
correspondance
with URL namespace and Apache just sorts it out the right way.

This probably doesn't make much sense they way I have explained it 
though. You
would really need to play with Vampire to understand.

Anyway, having explored this a but, am certainly going to implement 
such a
mechanism in Vampire.

Graham

From grahamd at dscpl.com.au  Fri Jan 21 05:59:30 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Fri Jan 21 05:59:37 2005
Subject: [mod_python] PythonOption access
In-Reply-To: <BCA8A7C9-6B94-11D9-8E9B-000393DCF16E@dscpl.com.au>
References: <1106268883.24610@dscpl.user.openhosting.com>
	<41F0A9BB.1080703@netgroup.dk>
	<BCA8A7C9-6B94-11D9-8E9B-000393DCF16E@dscpl.com.au>
Message-ID: <863CD6AB-6B9B-11D9-8E9B-000393DCF16E@dscpl.com.au>


On 21/01/2005, at 9:10 PM, Graham Dumpleton wrote:
>>> Maybe it shouldn't use an actual req object, but a new object which
>>> incorporates some of what req provides, dropping stuff that may be
>>> more specific to a particular request.
>>>
>> Thats my point :-)
>
> Possibly not complete, but the things from req it would/could have are:
>
>   hlist
>   interpreter
>   server
>   get_options()
>   get_config()
>   document_root()
>
> This means there is nothing which could be used to write data back to 
> the remote
> client.
>
> Figured I could call it __info__ and not __req__ when populated into 
> the
> namespace of the module when loading.
>
> ...
>
> Anyway, having explored this a but, am certainly going to implement 
> such a
> mechanism in Vampire.

Okay, all implemented. Took about 2 dozen lines, but I had some extra
complexity to deal with related to lookup and caching of configuration
files in Vampire. :-)

An example content handler I have now starts as:

   import vampire
   import types

   from mod_python import apache

   if __info__.get_config().get("PythonDebug","0") == "1":
     apache.log_error("loading",apache.APLOG_NOERRNO|apache.APLOG_ERR)

   config = vampire.loadConfig(__info__,".vampire")
   modules = config.get("Modules","common")
   module = vampire.importModule("python-utils",modules)

   def handler(req):
     ...

The cut down req object is setup in __info__ just during module import.
Here I happen to look for PythonDebug setting from get_config(), but
the get_options() is there along with what I listed above.

Also did find it necessary to have "filename" and "uri", but this was
to support my configuration file search mechanism also illustrated
above. It needs to know the physical directory corresponding to the
URL so it can search back up the directory hierarchy looking for the
named config file. Search stops at the PythonHandler root directory
if no config file found. Hard to explain, but using "uri" and
"filename" in the context I do here would be fine because of the
link back to a physical file in the file system.

Now in terms of what I was talking previously about sub imports. The 
line
before the handler function is doing a module sub import. Ie., use the
vampire.importModule() method instead of "import". I could have supplied
the __info__ variable as additional third argument to the import 
function
and it would have passed access to the cut down req object to the sub
import as well.

I do have good reasons for all this weirdness, but take too long to
explain here. I need to write up some better documentation for Vampire
about all its tricky features. :-)

BTW, was probably going to be releasing a new version of Vampire this
weekend. This will now incorporate this. I just have to decide whether
"__info__" is an okay name, or whether another name is more appropriate.

Is this looking better? Probably just confusing you. :-)

Graham

From fumanchu at amor.org  Fri Jan 21 11:39:20 2005
From: fumanchu at amor.org (Robert Brewer)
Date: Fri Jan 21 11:42:24 2005
Subject: [mod_python] PythonOption access
Message-ID: <3A81C87DC164034AA4E2DDFE11D258E339823D@exchange.hqamor.amorhq.net>

Bo Lorentsen wrote:
> Robert Brewer wrote:
> >Not at all. Use the PythonImport directive to load a "global" module
> >when Apache starts, and have that module inspect and preserve
> >PythonOption values.
> >
> How would I inspect "PythonOption" values from a 
> PythonImport'ed module 
> ? I still have no access to the "req" object given to the 
> handlers, otr 
> even parts of it !

As Graham pointed out, by inspecting the result of apache.config_tree().
That will be a list of tuples, one for each top-level directive in your
httpd.conf (or any other .conf which you Include in httpd). Find the one
for the Directory/Files/Location section you're interested in. Following
that entry will be a list of directive-tuples within that section. Short
example:

[('PythonImport', 'junct.startapp REDROVER.HQAMOR.amorhq.net'),
 ('Alias', '/junct D:\\htdocs\\junct'),
 ('<Directory', 'D:\\htdocs\\junct>'),
     [('AddHandler', 'python-program .htm'),
      ('PythonHandler', 'cation.html.uiwsgi::mod_python_handler'),
      ('PythonOption', 'application junct.startapp::get_wsgi_app'),
      ('PythonDebug', 'On'),
      ('DirectoryIndex', 'topic.htm'),
     ]


Robert Brewer
MIS
Amor Ministries
fumanchu@amor.org

From snacktime at gmail.com  Sat Jan 22 15:03:07 2005
From: snacktime at gmail.com (snacktime)
Date: Sat Jan 22 15:03:10 2005
Subject: [mod_python] Quick question from mod_perl user
Message-ID: <1f060c4c05012212037d7684cf@mail.gmail.com>

I have an application that I need to write in mod_python, and I was
curious if global variables persist like they do in mod_perl, or is
that a non issue with mod_python?

Also, can I set the handler to use a .pyc file instead of the source
file (.py) ?  Such as:

AddHandler mod_python .pyc


Thanks,

Chris
From snacktime at gmail.com  Sat Jan 22 16:58:44 2005
From: snacktime at gmail.com (snacktime)
Date: Sat Jan 22 16:58:47 2005
Subject: [mod_python] Freebsd 5.3 - PyThreadState_Delete: tstate is still
	current
Message-ID: <1f060c4c050122135864eb9808@mail.gmail.com>

Freebsd 5.3-p2.  Python 2.4/mod_python 3.1.3 built from ports with
threading disabled (as per mod_python port requirement).


On some requests I get this error message:

Fatal Python error: PyThreadState_Delete: tstate is still current
[Sat Jan 22 21:47:12 2005] [notice] child pid 46205 exit signal Abort trap (6)


For example, with the following in httpd.conf:

<Directory /usr/local/www/data/python>
    SetHandler mod_python
  PythonHandler mod_python.publisher
  PythonDebug On
  </Directory>

The example index.py from the docs works when the url is
/python/index.  But I get the error with /python/index/hello, or
/python/index/anything_else.

The sample from section 3.3 of the docs does work.  When I tried using
a Location directive instead of Directory, I get the error.

Is something trying to use threads when it's not supposed to?  At
first I thought maybe I had built python with threads, but after
reinstalling python and mod_python without threads I still get the
same errors.

Any ideas?

Chris
From grahamd at dscpl.com.au  Sat Jan 22 21:35:32 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sat Jan 22 21:35:56 2005
Subject: [mod_python] Quick question from mod_perl user
In-Reply-To: <1f060c4c05012212037d7684cf@mail.gmail.com>
References: <1f060c4c05012212037d7684cf@mail.gmail.com>
Message-ID: <7461E8FD-6CE7-11D9-8E9B-000393DCF16E@dscpl.com.au>


On 23/01/2005, at 7:03 AM, snacktime wrote:

> I have an application that I need to write in mod_python, and I was
> curious if global variables persist like they do in mod_perl, or is
> that a non issue with mod_python?

I am not familiar with mod_perl, and thus not totally clear on what you
mean by "persist" in this particular case, but a global variable within
a module will in mod_python persist across distinct requests.

This global though is only accessible to that specific Python 
interpreter,
thus if using prefork mode of Apache, different processes obviously have
different versions of that global. If in one process, distinct 
interpreters
are created, again each interpreter, each has their own version of that
global.

Obviously, a global does not persist across restarts.

Note that if using a multithreaded MPM with Apache, the global will need
to be adequately threaded protected if access is more than read only.

There are also various issues that need to be dealt with if you enable
module reloading. This is because a global which is setup during module
import will be replaced when a module is reloaded unless you add extra
code to detect when a module reload is occurring and preserve the 
existing
copy of the global data, rather than replacing it.

I have rambled on about issues with globals, module reloading and 
threading
previous on the mailing list. One of these threads was:

   http://www.modpython.org/pipermail/mod_python/2004-October/016605.html

There were possibly other threads as well, so you should search the
mailing list archive on the mod_python web site.

> Also, can I set the handler to use a .pyc file instead of the source
> file (.py) ?  Such as:
>
> AddHandler mod_python .pyc

The extension for AddHandler isn't referring to the name of the Python 
code
file, but the extension which appears in the request URL. Thus, if you 
have:

   AddHandler mod_python .py
   PythonHandler mymodule

what it means is that if a request URL ends in ".py" extension, then 
your
Python module called "mymodule" will be used.

Because the basic import module mechanism used by mod_python is the 
same as
is used in normal Python imports, it will pick .py, .pyc or even .so 
variants
of modules. Thus, for a .py, if it has already been compiled into .pyc, 
it
will used the compiled module. If the user/group that Apache runs as is 
such
that it has permission to write a file into directory where .py exists, 
if
no .pyc file exists, it will write the compiled file automatically, and 
next
time the module is required, for example after a restart, the compiled 
module
will be used instead.

Graham

From snacktime at gmail.com  Sun Jan 23 00:08:38 2005
From: snacktime at gmail.com (snacktime)
Date: Sun Jan 23 00:08:40 2005
Subject: [mod_python] Quick question from mod_perl user
In-Reply-To: <7461E8FD-6CE7-11D9-8E9B-000393DCF16E@dscpl.com.au>
References: <1f060c4c05012212037d7684cf@mail.gmail.com>
	<7461E8FD-6CE7-11D9-8E9B-000393DCF16E@dscpl.com.au>
Message-ID: <1f060c4c05012221087afa6587@mail.gmail.com>

> I am not familiar with mod_perl, and thus not totally clear on what you
> mean by "persist" in this particular case, but a global variable within
> a module will in mod_python persist across distinct requests.
> 
> This global though is only accessible to that specific Python
> interpreter,
> thus if using prefork mode of Apache, different processes obviously have
> different versions of that global. If in one process, distinct
> interpreters
> are created, again each interpreter, each has their own version of that
> global.
> 
> Obviously, a global does not persist across restarts.
> 
Ok, so far this is the same as mod perl.

With mod perl I normally create my own request object, usually a
hash/dictionary to store all the values I need to be global.  At the
end of the request I just undefine the one request object instead of
having to remember all the different global variables.  Is this
approach good for mod python as well?

Thanks for the rest of the info, that helped..

Chris
From grahamd at dscpl.com.au  Sun Jan 23 00:20:11 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sun Jan 23 00:20:32 2005
Subject: [mod_python] Quick question from mod_perl user
In-Reply-To: <1f060c4c05012221087afa6587@mail.gmail.com>
References: <1f060c4c05012212037d7684cf@mail.gmail.com>
	<7461E8FD-6CE7-11D9-8E9B-000393DCF16E@dscpl.com.au>
	<1f060c4c05012221087afa6587@mail.gmail.com>
Message-ID: <74427419-6CFE-11D9-8E9B-000393DCF16E@dscpl.com.au>


On 23/01/2005, at 4:08 PM, snacktime wrote:

>> I am not familiar with mod_perl, and thus not totally clear on what  
>> you
>> mean by "persist" in this particular case, but a global variable  
>> within
>> a module will in mod_python persist across distinct requests.
>>
>> This global though is only accessible to that specific Python
>> interpreter,
>> thus if using prefork mode of Apache, different processes obviously  
>> have
>> different versions of that global. If in one process, distinct
>> interpreters
>> are created, again each interpreter, each has their own version of  
>> that
>> global.
>>
>> Obviously, a global does not persist across restarts.
>>
> Ok, so far this is the same as mod perl.
>
> With mod perl I normally create my own request object, usually a
> hash/dictionary to store all the values I need to be global.  At the
> end of the request I just undefine the one request object instead of
> having to remember all the different global variables.  Is this
> approach good for mod python as well?

In mod_python, to communicate between handlers or even methods  
fulfilling
a request, one can add bits into the existing request object. The  
documentation
even says:

   http://www.modpython.org/live/current/doc-html/pyapi-mprequest.html

   You can dynamically assign attributes to it as a way to communicate  
between handlers.

    
http://www.modpython.org/live/current/doc-html/pyapi-mprequest-mem.html

   notes
     A table object that could be used to store miscellaneous  general  
purpose
     info that lives for as long as the request lives. If  you need to  
pass data
     between handlers, it's better to simply add  members to the request  
object
     than to use notes.

Thus:

   def accesshandler(req):
     req.mystuff = { "a": 1 }
     ...
     return apache.OK

   def handler(req):
     if req.mystuff["a"] == ...:
       ...
     ...
     return apache.OK

You don't even have to undefine your stuff as the "req" object which  
holds it
will be destroyed at the end of the request anyway.

If you need to do more complicated stuff whereby you need to execute  
some
special code to cleanup at the end of a request, you can also look at  
cleanup
callbacks.

    
http://www.modpython.org/live/current/doc-html/pyapi-mprequest- 
meth.html

   register_cleanup(callable[, data])

     Registers a cleanup. Argument callable can be any callable  object,
     the optional argument data can be any object (default is None). At  
the very
     end of the request, just before the actual  request record is  
destroyed
     by Apache, callable will be called  with one argument, data.

     It is OK to pass the request object as data, but keep in mind that
     when the cleanup is executed, the request processing is already  
complete,
     so doing things like writing to the client is completely  pointless.

     If errors are encountered during cleanup processing, they should be
     in  error log, but otherwise will not affect request processing in  
any
     way, which makes cleanup bugs sometimes hard to spot.

     If the server is shut down before the cleanup had a chance to run,
     it's possible that it will not be executed.

Hope this helps.

Graham

From grahamd at dscpl.com.au  Sun Jan 23 00:40:10 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sun Jan 23 00:40:18 2005
Subject: [mod_python] ANN: Vampire 1.4 is now available.
Message-ID: <3EDAD73B-6D01-11D9-8E9B-000393DCF16E@dscpl.com.au>

Vampire 1.4 is now available.

   http://www.dscpl.com.au/projects/vampire

   http://www.dscpl.com.au/downloads/vampire-1.4-20050123.tar.gz

See the web site for information on what Vampire is all about.

For those who have been tracking Vampire already, the main new things of
interest in this release are:

   - Vampire can now be used to intercept handlers other than that for 
the
     PythonHandler directive and it will be directed to a specific module
     indicated within the handlers section of the Vampire config file. 
Thus,
     if in your ".htaccess" file you might have:

       PythonAccessHandler vampire

     In your ".vampire" config file you might then have:

       [Handlers]

       accesshandler = %(__config_root__)s/modules/access-handler.py

     The handler function in the specified file must be the default for 
the
     particular directive, it cannot be modified like it can using "::" 
in
     the ".htaccess" file.

   - Special conventions can now be used in form arguments to denote data
     which should be translated to dictionaries and list. Specifically:

       Keys (variable names) can have subkeys, with a ``.`` and can be
       numbered with ``-``, like ``a.b-3=something`` means that the value
       ``a`` is a dictionary with a key ``b``, and ``b`` is a list, the
       third(-ish) element with the value ``something``. Numbers are used
       to sort, missing numbers are ignored.

     The code to achieve this bit of magic courtesy of some code from the
     FormEncode/Validator package made available by Ian Bicking.

   - The XmlRpcHandler class has been discarded completely. Instead, a 
much
     more low level request handler is provided whose job is only to 
parse
     the inbound request and then format the response. The actual 
execution
     of the request is passed off to a supplied callback. This callback
     must work out how to then map the request to a specific method.

     This means that in the first instance the support for XML-RPC 
requests
     is not as useful and more work is required to use it, but it opens
     things up so that more powerful things can be done. For example, a
     means of optionally having the request object also passed through to
     methods could also be implemented. For example:

       import vampire
       import types

       config = vampire.loadConfig(__req__,".vampire")
       modules = config.get("Modules","common")
       module = vampire.importModule("python-utils",modules)

       def handler(req):

         def _callback(req,name,params):
           if name[0:1] != "_":
             if module.__dict__.has_key(name):
               method = module.__dict__[name]
               if type(method) == types.FunctionType:
                 if len(method.func_code.co_varnames) != 0:
                   if method.func_code.co_varnames[0] == "req":
                     params = list(params)
                     params.insert(0,req)
                 return method(*params)
           raise Exception("Method Unavailable")

         return vampire.serviceRequest(req,_callback)

   - A cut down "req" object is now available when the Python code file
     for a handler is being imported. This will be stored in the module 
as
     "__req__". Once importing of the module has been completed it will 
be
     deleted out of the module. The cut down "req" object allows access 
to
     PythonOption variables using get_options(), other mod_python 
settings
     using get_config(), as well as attributes such as "interpreter" etc.
     The "uri" and "filename" are also supplied such that the cut down 
"req"
     object can be used on configuration file lookup during module
     importing. This is shown in practice in XML-RPC example above.

Enjoy.


--
Graham Dumpleton (grahamd@dscpl.com.au)

From zwhite-mod_python at darkstar.frop.org  Sun Jan 23 01:02:05 2005
From: zwhite-mod_python at darkstar.frop.org (Zach White)
Date: Sun Jan 23 01:02:10 2005
Subject: [mod_python] psp_site example doesn't work
Message-ID: <20050123060205.GF1302@darkstar.frop.org>

Hi Everyone,

I'm trying to get mod_python going for a site I'm working on. However, I can't
seem to get the publisher handler to work. First, server/install details:

Server: Apache/1.3.29 (Unix) mod_python/2.7.10 Python/2.3.4 mod_ssl/2.8.16 OpenSSL/0.9.7c

Config:

<VirtualHost 65.74.140.23>
    ServerName beta.rvmotel.com
    DocumentRoot /var/www/rvmotel-beta
    ErrorLog logs/motel_beta_error_log
    CustomLog logs/motel_beta_access_log combined
</VirtualHost>
 
<Directory "/var/www/rvmotel-beta">
    Options None
    AllowOverride All
    Order allow,deny
    Allow from all
    SetHandler mod_python
    PythonHandler mod_python.publisher
    PythonDebug On
    #PythonAutoReload on                # Change to off when not developing
</Directory>

This is on an OpenBSD 3.6 machine, running their server in a non-chrooted
environment. Python was compiled myself, and installed in /var/www/python.
I've set the path in my apachectl script so that /var/www/python/bin is
first.

I can get mptest.py to work, but when I switch the config over to publisher,
instead of processing the page I get the source of the python script
instead.

Any ideas?

On an unrelated note, it'd be nice if the archives were searchable. It seems
that google doesn't index them.

-Zach
From grahamd at dscpl.com.au  Sun Jan 23 01:29:32 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sun Jan 23 01:29:52 2005
Subject: [mod_python] psp_site example doesn't work
In-Reply-To: <20050123060205.GF1302@darkstar.frop.org>
References: <20050123060205.GF1302@darkstar.frop.org>
Message-ID: <2449341A-6D08-11D9-8E9B-000393DCF16E@dscpl.com.au>


On 23/01/2005, at 5:02 PM, Zach White wrote:
>
> On an unrelated note, it'd be nice if the archives were searchable. It 
> seems
> that google doesn't index them.
>

Hmmm, I have had no problems with searching the mailing list archives 
using the
search box on the mod_python web site main page. You may not get the 
very latest stuff
as Google might not index it very often.

Typing "inurl:pipermail" in the search box on www.modpython.org and I 
get about 6100
matches for mailing list stuff.

Graham

From grahamd at dscpl.com.au  Sun Jan 23 01:47:41 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sun Jan 23 01:47:51 2005
Subject: [mod_python] psp_site example doesn't work
In-Reply-To: <20050123060205.GF1302@darkstar.frop.org>
References: <20050123060205.GF1302@darkstar.frop.org>
Message-ID: <ADB72CA8-6D0A-11D9-8E9B-000393DCF16E@dscpl.com.au>


On 23/01/2005, at 5:02 PM, Zach White wrote:

>
> I can get mptest.py to work, but when I switch the config over to 
> publisher,
> instead of processing the page I get the source of the python script
> instead.

Since configuration in httpd.conf file as opposed to .htaccess, I assume
that Apache was restarted?

After restarting Apache, when you try and access the file which you 
expect
to be managed by the mod_python.publisher handler, do you see a line 
appear
in the Apache error log file of the form?

   [Sun Jan 23 15:09:54 2005] [notice] mod_python: (Re)importing module 
'mod_python.publisher'

This would indicate that mod_python.publisher is indeed being loaded to
handle the request.

You should also see a subsequent line indicating that your particular 
handler
is being loaded. For example:

   [Sun Jan 23 17:44:25 2005] [notice] mod_python: (Re)importing module 
'index' with path set to '['/Users/grahamd/Sites/publisher']'

These will only come out though if PythonDebug is enabled, which you 
config
suggests it is.

If you don't see this would assume config problem or Apache not 
restarted.
Are there any other messages generated in error log file?

Graham

From zwhite-mod_python at darkstar.frop.org  Sun Jan 23 02:28:54 2005
From: zwhite-mod_python at darkstar.frop.org (Zach White)
Date: Sun Jan 23 02:28:56 2005
Subject: [mod_python] psp_site example doesn't work
In-Reply-To: <ADB72CA8-6D0A-11D9-8E9B-000393DCF16E@dscpl.com.au>
References: <20050123060205.GF1302@darkstar.frop.org>
	<ADB72CA8-6D0A-11D9-8E9B-000393DCF16E@dscpl.com.au>
Message-ID: <20050123072854.GG1302@darkstar.frop.org>

On Sun, Jan 23, 2005 at 05:47:41PM +1100, Graham Dumpleton wrote:
> Since configuration in httpd.conf file as opposed to .htaccess, I assume
> that Apache was restarted?

Yes, I've restarted apache many times, using 'apachectl stop && apachectl 
start'. I've also removed the .htaccess that comes with psp_site so that's 
not in the picture.

> After restarting Apache, when you try and access the file which you 
> expect
> to be managed by the mod_python.publisher handler, do you see a line 
> appear
> in the Apache error log file of the form?

(Read your post about the mailing list archives, and found that the problem
wasn't google not indexing it, but that I had searched for 'psp psp_site
publisher' which appearantly has no results. Mea culpa.)

I do not see that in the error log. In fact, I don't see anything in the 
error log, unless I try going to any of the following combinations:

http://beta.rvmotel.com/index
http://beta.rvmotel.com/index.py/index
http://beta.rvmotel.com/index.py/home

And then it's just a file not found error.

In reading through the archives on anything that seemed to relate to my
problem, I switched from SetHandler to:

    AddHandler python-program .py

And now mod_python seems to be parsing pages, but not really how I'd like.
If I goto index/index, I get a cannot import psp error, but at least
mod_python works now. So I throw up a hello.py:

def index():
        return 'Hello there!'

http://beta.rvmotel.com/hello.py
68.186.66.XXX - - [23/Jan/2005:07:15:47 +0000] "GET /hello.py HTTP/1.1" 404 334 "-" "Mozilla/5.0 (Macintosh; U; PPC Mac OS X; en-US) AppleWebKit/125.4 (KHTML, like Gecko, Safari) OmniWeb/v563.34"

Notice the 404 error, but nothing in error_log.

http://beta.rvmotel.com/hello.py/index
[Sun Jan 23 07:17:23 2005] [notice] mod_python: (Re)importing hello from ['/var/www/rvmotel-beta']

So, I have it most of the way there to being able to develop. But I can't
seem to get publisher to run the index() function like all the docs I've come
across say I can. I also can not get it to treat index.py as the directory
index. This means I need to use something like an index.html with a meta
refresh, which I'd like to avoid if at all possible.

So, some progress, but ever more questions. Why does AddHandler work, but
the SetHandler that the docs say to use doesn't? Why can't I get it to
process index.py or the index() function?

Thanks for your help.

-Zach
From grahamd at dscpl.com.au  Sun Jan 23 05:03:49 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sun Jan 23 05:04:32 2005
Subject: [mod_python] psp_site example doesn't work
In-Reply-To: <20050123072854.GG1302@darkstar.frop.org>
References: <20050123060205.GF1302@darkstar.frop.org>
	<ADB72CA8-6D0A-11D9-8E9B-000393DCF16E@dscpl.com.au>
	<20050123072854.GG1302@darkstar.frop.org>
Message-ID: <13C4B510-6D26-11D9-8E9B-000393DCF16E@dscpl.com.au>


On 23/01/2005, at 6:28 PM, Zach White wrote:

> I do not see that in the error log. In fact, I don't see anything in 
> the
> error log, unless I try going to any of the following combinations:
>
> http://beta.rvmotel.com/index
> http://beta.rvmotel.com/index.py/index
> http://beta.rvmotel.com/index.py/home
>
> And then it's just a file not found error.
>
> In reading through the archives on anything that seemed to relate to my
> problem, I switched from SetHandler to:
>
>     AddHandler python-program .py
>
> And now mod_python seems to be parsing pages, but not really how I'd 
> like.
> If I goto index/index, I get a cannot import psp error, but at least
> mod_python works now.

You are using mod_python 2.7.10. PSP is only in mod_python 3.X, thus why
you get a PSP import error. That you are using mod_python 2.7.10 also
explains why:

   SetHandler mod_python

wasn't working for you. Use:

   SetHandler python-program

and make sure you are reading the mod_python 2.7.10 documentation and 
not
the newer version.

When you go back to SetHandler, the index function mapping may then 
work.

Further, you are using Apache 1.3 and the way it processes requests 
against
directories and then maps that to an index file is different to Apache 
2.0.
This may or may not be an issue.

Graham

From zwhite-mod_python at darkstar.frop.org  Sun Jan 23 17:20:02 2005
From: zwhite-mod_python at darkstar.frop.org (Zach White)
Date: Sun Jan 23 17:20:08 2005
Subject: [mod_python] psp_site example doesn't work
In-Reply-To: <13C4B510-6D26-11D9-8E9B-000393DCF16E@dscpl.com.au>
References: <20050123060205.GF1302@darkstar.frop.org>
	<ADB72CA8-6D0A-11D9-8E9B-000393DCF16E@dscpl.com.au>
	<20050123072854.GG1302@darkstar.frop.org>
	<13C4B510-6D26-11D9-8E9B-000393DCF16E@dscpl.com.au>
Message-ID: <20050123222002.GH1302@darkstar.frop.org>

On Sun, Jan 23, 2005 at 09:03:49PM +1100, Graham Dumpleton wrote:
> You are using mod_python 2.7.10. PSP is only in mod_python 3.X, thus why
> you get a PSP import error. That you are using mod_python 2.7.10 also
> explains why:
> 
>   SetHandler mod_python
> 
> wasn't working for you. Use:
> 
>   SetHandler python-program

Ok, that would explain that. Kind of annoying that the change was made, 
although I do think that calling the handler mod_python makes more sense.

> and make sure you are reading the mod_python 2.7.10 documentation and 
> not
> the newer version.

I am, but at the time I was going on the documentation in the psp example.
Going back and looking at the examples page on the site, I see where it says
that it requires mod_python 3.x. Somehow I overlooked that. Maybe someone 
can add a note to the comments in index.py in psp_example saying it requires 
mod_python 3.x?

> Further, you are using Apache 1.3 and the way it processes requests 
> against
> directories and then maps that to an index file is different to Apache 
> 2.0.
> This may or may not be an issue.

Well, it is and it isn't an issue. Playing with it, it seems that the 
following URLs will not work:

http://beta.rvmotel.com/
http://beta.rvmotel.com/index
http://beta.rvmotel.com/index.py

But the following URLs do:

http://beta.rvmotel.com/index/index
http://beta.rvmotel.com/index.py/index

Not a big deal, but not really ideal, either. It means I'll have to use 
AddHandler and have an index.html or index.cgi that redirects the user to
the real index page. From my own developing standpoint, I'd rather not have
to do that. But from the standpoint of the people I'm doing this for, it
doesn't matter.

Thanks again for your help. 

-Zach
From grahamd at dscpl.com.au  Sun Jan 23 17:44:19 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sun Jan 23 17:44:25 2005
Subject: [mod_python] psp_site example doesn't work
Message-ID: <1106520259.27118@dscpl.user.openhosting.com>

Zach White wrote ..
> > Further, you are using Apache 1.3 and the way it processes requests 
> > against
> > directories and then maps that to an index file is different to Apache
> > 2.0.
> > This may or may not be an issue.
> 
> Well, it is and it isn't an issue. Playing with it, it seems that the 
> following URLs will not work:
> 
> http://beta.rvmotel.com/
> http://beta.rvmotel.com/index
> http://beta.rvmotel.com/index.py
> 
> But the following URLs do:
> 
> http://beta.rvmotel.com/index/index
> http://beta.rvmotel.com/index.py/index
> 
> Not a big deal, but not really ideal, either. It means I'll have to use
> AddHandler and have an index.html or index.cgi that redirects the user
> to
> the real index page. From my own developing standpoint, I'd rather not
> have
> to do that. But from the standpoint of the people I'm doing this for, it
> doesn't matter.

Had a bit of a play with mod_python.publisher and Apache 1.3 and I
couldn't work it out either. Must have been how it worked back then.

People probably get sick of me promoting my own stuff here, but you
might want to have a look at Vampire. I know that for it the directory
index type stuff works even on Apache 1.3 and mod_python 2.7.10.
It differs from mod_python.publisher in as much as you are defining a
basic content handler. That is, you can't just return a text string from
the method called and have it automatically turned into a complete
response. It does allow multiple content handlers in a directory though.
It also supports mod_python.publisher style form parsing. Ie., form
parameters can be passed as additional arguments to content handler.

Whether Vampire might be of interest will depend though on how much
time and effort you might already have invested in existing publisher
code. If you are starting from scratch anyway, might be interesting to
look at.

In case you missed the recent announcement about Vampire, it is at:

  http://www.dscpl.com.au/projects/vampire

Graham
From list at joreybump.com  Sun Jan 23 18:07:58 2005
From: list at joreybump.com (Jorey Bump)
Date: Sun Jan 23 18:08:03 2005
Subject: [mod_python] psp_site example doesn't work
In-Reply-To: <20050123222002.GH1302@darkstar.frop.org>
References: <20050123060205.GF1302@darkstar.frop.org>	<ADB72CA8-6D0A-11D9-8E9B-000393DCF16E@dscpl.com.au>	<20050123072854.GG1302@darkstar.frop.org>	<13C4B510-6D26-11D9-8E9B-000393DCF16E@dscpl.com.au>
	<20050123222002.GH1302@darkstar.frop.org>
Message-ID: <41F42E4E.1070902@joreybump.com>

Zach White wrote:

> http://beta.rvmotel.com/index/index
> http://beta.rvmotel.com/index.py/index
> 
> Not a big deal, but not really ideal, either. It means I'll have to use 
> AddHandler and have an index.html or index.cgi that redirects the user to
> the real index page. From my own developing standpoint, I'd rather not have
> to do that. But from the standpoint of the people I'm doing this for, it
> doesn't matter.

I use the Publisher handler exclusively, and do all of my development 
this way, with one exception: I avoid using the name "index" like the 
plague in module or function names! AddHandler lets you add index.html 
to the directory if you feel you must, but it doesn't even make sense to 
try to include index.py in the DirectoryIndex; it would be like trying 
to put 20 versions of example.exe in a Windows directory. Start off by 
giving all of your applications unique names and you'll avoid namespace 
pollution issues that trip up a lot of mod_python newbies.

To clarify, if you have a foo.py located *anywhere*, don't reuse the 
name in another module. Choose a sensible function to start with 
(remember, this is with Publisher in mind) and distribute the URL:

  http://host.dom/foo/login

I've had no issues with users misunderstanding such URLs and achieve a 
terrific hassle-free separation between applications this way. 
AddHandler lets me mix file types in a directory, and MultiViews lets me 
drop the .py extension in the URL.


From grahamd at dscpl.com.au  Sun Jan 23 18:38:43 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sun Jan 23 18:39:16 2005
Subject: [mod_python] psp_site example doesn't work
Message-ID: <1106523523.15703@dscpl.user.openhosting.com>

Jorey Bump wrote ..
> Zach White wrote:
> 
> > http://beta.rvmotel.com/index/index
> > http://beta.rvmotel.com/index.py/index
> > 
> > Not a big deal, but not really ideal, either. It means I'll have to use
> > AddHandler and have an index.html or index.cgi that redirects the user
> to
> > the real index page. From my own developing standpoint, I'd rather not
> have
> > to do that. But from the standpoint of the people I'm doing this for,
> it
> > doesn't matter.
> 
> I use the Publisher handler exclusively, and do all of my development 
> this way, with one exception: I avoid using the name "index" like the 
> plague in module or function names! AddHandler lets you add index.html
> to the directory if you feel you must, but it doesn't even make sense to
> try to include index.py in the DirectoryIndex; it would be like trying
> to put 20 versions of example.exe in a Windows directory. Start off by
> giving all of your applications unique names and you'll avoid namespace
> pollution issues that trip up a lot of mod_python newbies.
> 
> To clarify, if you have a foo.py located *anywhere*, don't reuse the 
> name in another module. Choose a sensible function to start with 
> (remember, this is with Publisher in mind) and distribute the URL:
> 
>   http://host.dom/foo/login
> 
> I've had no issues with users misunderstanding such URLs and achieve a
> terrific hassle-free separation between applications this way. 
> AddHandler lets me mix file types in a directory, and MultiViews lets me
> drop the .py extension in the URL.

Possibly worth emphasising in this is the use of a common name, used
across multiple directories, and not unique names may cause subtle
problems with module reloading. This is why one should avoid it.

The problem here is that the mod_python module importing mechanism
uses the "imp" module, which has the same affect as "import" statement.
Because module imports are added into "sys.modules", you have issues
when the same module name appears in two different directories. For
examples, if you have "subdir1/index.py" and "subdir2/index.py".

If no "index" module has been loaded and "subdir1/index.py" is accessed,
it will be loaded. If now "subdir2/index.py" is accessed, the mod_python
module importing mechanism will note that the "index" module is located
at a different path and thus will load the latter. In doing this however, it
will override the existing "index" module already in "sys.modules".

The consequences of this are that if requests cycle between the two
versions of "index.py", on every access there will be a module reload.
This will be inefficient at least, but worse problems could arise if the
two instances of the module use similar names for global variables.

Package such as mpservlets and Vampire implement their own module
importing mechanisms in order to avoid this problem. Ie., with those
packages it is safe to have Python code files which are named the same
appearing in different directories managed by mod_python running
under the same interpreter.

Graham
From nicolas.lehuen at gmail.com  Mon Jan 24 02:09:02 2005
From: nicolas.lehuen at gmail.com (Nicolas Lehuen)
Date: Mon Jan 24 02:09:04 2005
Subject: [mod_python] psp_site example doesn't work
In-Reply-To: <1106523523.15703@dscpl.user.openhosting.com>
References: <1106523523.15703@dscpl.user.openhosting.com>
Message-ID: <c298f2d7050123230939196a6@mail.gmail.com>

On Sun, 23 Jan 2005 18:38:43 -0500, Graham Dumpleton
<grahamd@dscpl.com.au> wrote:
> Jorey Bump wrote ..
> > Zach White wrote:
> >
> > > http://beta.rvmotel.com/index/index
> > > http://beta.rvmotel.com/index.py/index
> > >
> > > Not a big deal, but not really ideal, either. It means I'll have to use
> > > AddHandler and have an index.html or index.cgi that redirects the user
> > to
> > > the real index page. From my own developing standpoint, I'd rather not
> > have
> > > to do that. But from the standpoint of the people I'm doing this for,
> > it
> > > doesn't matter.
> >
> > I use the Publisher handler exclusively, and do all of my development
> > this way, with one exception: I avoid using the name "index" like the
> > plague in module or function names! AddHandler lets you add index.html
> > to the directory if you feel you must, but it doesn't even make sense to
> > try to include index.py in the DirectoryIndex; it would be like trying
> > to put 20 versions of example.exe in a Windows directory. Start off by
> > giving all of your applications unique names and you'll avoid namespace
> > pollution issues that trip up a lot of mod_python newbies.
> >
> > To clarify, if you have a foo.py located *anywhere*, don't reuse the
> > name in another module. Choose a sensible function to start with
> > (remember, this is with Publisher in mind) and distribute the URL:
> >
> >   http://host.dom/foo/login
> >
> > I've had no issues with users misunderstanding such URLs and achieve a
> > terrific hassle-free separation between applications this way.
> > AddHandler lets me mix file types in a directory, and MultiViews lets me
> > drop the .py extension in the URL.
> 
> Possibly worth emphasising in this is the use of a common name, used
> across multiple directories, and not unique names may cause subtle
> problems with module reloading. This is why one should avoid it.
> 
> The problem here is that the mod_python module importing mechanism
> uses the "imp" module, which has the same affect as "import" statement.
> Because module imports are added into "sys.modules", you have issues
> when the same module name appears in two different directories. For
> examples, if you have "subdir1/index.py" and "subdir2/index.py".
> 
> If no "index" module has been loaded and "subdir1/index.py" is accessed,
> it will be loaded. If now "subdir2/index.py" is accessed, the mod_python
> module importing mechanism will note that the "index" module is located
> at a different path and thus will load the latter. In doing this however, it
> will override the existing "index" module already in "sys.modules".
> 
> The consequences of this are that if requests cycle between the two
> versions of "index.py", on every access there will be a module reload.
> This will be inefficient at least, but worse problems could arise if the
> two instances of the module use similar names for global variables.
> 
> Package such as mpservlets and Vampire implement their own module
> importing mechanisms in order to avoid this problem. Ie., with those
> packages it is safe to have Python code files which are named the same
> appearing in different directories managed by mod_python running
> under the same interpreter.

We had a discussion a few months ago about this issue, and I still
think it's a bug. Like Daniel Popovitch with mpservlets and you with
Vampire, I had to implement my own import mechanism to work around the
bug. I think it's time to fix it... I'll add a bug report and see what
we can do about it.

Regards,
Nicolas
From grahamd at dscpl.com.au  Mon Jan 24 07:00:01 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon Jan 24 07:01:02 2005
Subject: [mod_python] psp_site example doesn't work
In-Reply-To: <c298f2d7050123230939196a6@mail.gmail.com>
References: <1106523523.15703@dscpl.user.openhosting.com>
	<c298f2d7050123230939196a6@mail.gmail.com>
Message-ID: <7A48F293-6DFF-11D9-9689-000393DCF16E@dscpl.com.au>


On 24/01/2005, at 6:09 PM, Nicolas Lehuen wrote:
>> The consequences of this are that if requests cycle between the two
>> versions of "index.py", on every access there will be a module reload.
>> This will be inefficient at least, but worse problems could arise if 
>> the
>> two instances of the module use similar names for global variables.
>>
>> Package such as mpservlets and Vampire implement their own module
>> importing mechanisms in order to avoid this problem. Ie., with those
>> packages it is safe to have Python code files which are named the same
>> appearing in different directories managed by mod_python running
>> under the same interpreter.
>
> We had a discussion a few months ago about this issue, and I still
> think it's a bug. Like Daniel Popovitch with mpservlets and you with
> Vampire, I had to implement my own import mechanism to work around the
> bug. I think it's time to fix it... I'll add a bug report and see what
> we can do about it.

Probably a good thing. All my implementations of my module import system
however have worked on specifying the exact directory that the module
was expected to reside in. Thus I wasn't having to deal with the 
problems
of using sys.path and the unpredictability of which module you will pick
up if there are commonly named ones. I will thus have to have a good 
think
about how the mod_python one can be fixed and retain the same interface.
I can see a partial solution in my head, but not yet a complete one. :-)

Do we need to document properly first the perceived problems and some
examples of errornous behaviour? This will help to ensure we fix
everything and provide a basis for some tests of any new implementation.
I know that such information can be noted against the bug tracker item,
but is it easier to thrash it out here first.

In the back of my head, am thinking that relying on a search through
sys.path is always going to be problematic. Do we want to also consider
any alternative interfaces styles to module importing and caching. 
Perhaps
provide a parallel implementation that requires the exact directory to
be specified and if this proves better, promote a migration to this
style of interface while keeping the old.

Graham

From list at joreybump.com  Mon Jan 24 09:12:24 2005
From: list at joreybump.com (Jorey Bump)
Date: Mon Jan 24 09:12:31 2005
Subject: [mod_python] psp_site example doesn't work
In-Reply-To: <c298f2d7050123230939196a6@mail.gmail.com>
References: <1106523523.15703@dscpl.user.openhosting.com>
	<c298f2d7050123230939196a6@mail.gmail.com>
Message-ID: <41F50248.1020703@joreybump.com>

Nicolas Lehuen wrote:
> On Sun, 23 Jan 2005 18:38:43 -0500, Graham Dumpleton
> <grahamd@dscpl.com.au> wrote:

>>Package such as mpservlets and Vampire implement their own module
>>importing mechanisms in order to avoid this problem. Ie., with those
>>packages it is safe to have Python code files which are named the same
>>appearing in different directories managed by mod_python running
>>under the same interpreter.
> 
> We had a discussion a few months ago about this issue, and I still
> think it's a bug. Like Daniel Popovitch with mpservlets and you with
> Vampire, I had to implement my own import mechanism to work around the
> bug. I think it's time to fix it... I'll add a bug report and see what
> we can do about it.

I guess I'm on record as considering this to be normal Python behaviour, 
and not a bug. Talk of modifying Publisher's current import mechanism 
threatens the significant investment I have in the applications I've 
already developed. I'd rather see Publisher left alone, as other 
frameworks are maturing that address this issue.

We should be clear about what we are talking about:

Issue:

An interpreter imports a module's name into the namespace independent of 
its location in the filesystem.

Pros:

- This is consistent with normal Python behaviour, where an interpreter 
loads modules from the current directory or PYTHONPATH. [1]

- There is no ambiguity about imports, and no need to rewrite code when 
moving the module to another location.

- The Python language documentation serves as a good resource, as native 
behaviours are not contradicted. [2]

- General purpose code needs *very* little modification to run under 
mod_python.publisher.

- The default Python behaviour of caching imported modules can be used 
to great leverage, and plays a significant role in the performance boost 
offered by mod_python. [3]

- With careful planning, per-interpreter package repositories can be 
created.

Cons:

- This consistently trips up newbies, who are expecting PHP-like 
behaviour from their web applications.

- Within an interpreter (a VirtualHost, for example), such care must be 
taken to create unique module names that porting an application or 
working in a team environment is significantly more fragile than in 
other web technologies, where it usually suffices to throw the code in 
its own directory.

- Although a lot of issues can be addressed in .htaccess files, so much 
configuration occurs at the apache level that it is difficult to use 
mod_python effectively without apache admin privileges. [4]

- The Multi-Processing Modules (MPMs) in apache 2 may have a unique 
effect on an application. After throwing in the different platforms, 
Python versions, and developer styles, it can be very hard to reach a 
consensus on whether an issue even exists.

Possible solution:

Automatically package module based on the file path.

Pros:

- Hopefully, this would provide better separation of modules in namespace.

Cons:

- Serious potential to break existing Publisher applications.

- The same module might be loaded into a separate namespace for 
different applications, eliminating the advantage of module caching. [5]

- This encourages the reuse of module names (such as index.py), which is 
considered a bad programming practice in Python. [1]

- If the code assumes and uses a package name based on its location, it 
will need to be rewritten if it is moved.

- The possibility that autopackaging will arbitrarily create a namespace 
clash with a standard module is unacceptably high, especially where 
third party packages are installed.

- It severely limits the ability to test portions of the code from the 
command line, because it adds an element of unpredictability to the 
module search path.

- Seasoned Python programmers might consider mod_python.publisher to be 
"broken" because it doesn't conform to Python standards. [6]


[1] For a clear description of Python's module search path, see: 
http://www.python.org/doc/current/tut/node8.html#SECTION008110000000000000000

[2] The documentation for mod_python is sparse because it simply embeds 
an interpreter in apache. See the Python documentation for programming 
issues: http://www.python.org/doc/current/index.html

[3] This seems to be the main complaint levied against mod_python, in 
one form or the other. I consider it one of it's greatest strengths. For 
example, it allows me to import database handling code from a module 
once for that interpreter, allowing multiple applications to share the 
connection -- a poor man's database pool, if you will.

[4] The same can be said about php.ini, but noone ever needs to restart 
apache to develop PHP applications.

[5] What is the solution to the problems caused by module caching? It 
doesn't make much sense to force mod_python to act like it's spawning a 
new interpreter for every request. Run the app as a CGI instead of using 
mod_python.

[6] The strength of Publisher is that it leverages the advantages of 
Python with very little overhead, simply adding a number of conveniences 
specific to web application development. mod_python.psp is a much better 
area to radically depart from this paradigm, as it is expected to 
provide PHP-like behaviour.


From nicolas.lehuen at gmail.com  Mon Jan 24 10:28:47 2005
From: nicolas.lehuen at gmail.com (Nicolas Lehuen)
Date: Mon Jan 24 10:28:50 2005
Subject: [mod_python] psp_site example doesn't work
In-Reply-To: <41F50248.1020703@joreybump.com>
References: <1106523523.15703@dscpl.user.openhosting.com>
	<c298f2d7050123230939196a6@mail.gmail.com>
	<41F50248.1020703@joreybump.com>
Message-ID: <c298f2d705012407284ef8ab40@mail.gmail.com>

On Mon, 24 Jan 2005 09:12:24 -0500, Jorey Bump <list@joreybump.com> wrote:
> Nicolas Lehuen wrote:
> > On Sun, 23 Jan 2005 18:38:43 -0500, Graham Dumpleton
> > <grahamd@dscpl.com.au> wrote:
> 
> >>Package such as mpservlets and Vampire implement their own module
> >>importing mechanisms in order to avoid this problem. Ie., with those
> >>packages it is safe to have Python code files which are named the same
> >>appearing in different directories managed by mod_python running
> >>under the same interpreter.
> >
> > We had a discussion a few months ago about this issue, and I still
> > think it's a bug. Like Daniel Popovitch with mpservlets and you with
> > Vampire, I had to implement my own import mechanism to work around the
> > bug. I think it's time to fix it... I'll add a bug report and see what
> > we can do about it.
> 
> I guess I'm on record as considering this to be normal Python behaviour,
> and not a bug. Talk of modifying Publisher's current import mechanism
> threatens the significant investment I have in the applications I've
> already developed. I'd rather see Publisher left alone, as other
> frameworks are maturing that address this issue.
> 
> We should be clear about what we are talking about:
> 
> Issue:
> 
> An interpreter imports a module's name into the namespace independent of
> its location in the filesystem.
> 
> Pros:
> 
> - This is consistent with normal Python behaviour, where an interpreter
> loads modules from the current directory or PYTHONPATH. [1]
> 
> - There is no ambiguity about imports, and no need to rewrite code when
> moving the module to another location.
> 
> - The Python language documentation serves as a good resource, as native
> behaviours are not contradicted. [2]
> 
> - General purpose code needs *very* little modification to run under
> mod_python.publisher.
> 
> - The default Python behaviour of caching imported modules can be used
> to great leverage, and plays a significant role in the performance boost
> offered by mod_python. [3]
> 
> - With careful planning, per-interpreter package repositories can be
> created.
> 
> Cons:
> 
> - This consistently trips up newbies, who are expecting PHP-like
> behaviour from their web applications.
> 
> - Within an interpreter (a VirtualHost, for example), such care must be
> taken to create unique module names that porting an application or
> working in a team environment is significantly more fragile than in
> other web technologies, where it usually suffices to throw the code in
> its own directory.
> 
> - Although a lot of issues can be addressed in .htaccess files, so much
> configuration occurs at the apache level that it is difficult to use
> mod_python effectively without apache admin privileges. [4]
> 
> - The Multi-Processing Modules (MPMs) in apache 2 may have a unique
> effect on an application. After throwing in the different platforms,
> Python versions, and developer styles, it can be very hard to reach a
> consensus on whether an issue even exists.
> 
> Possible solution:
> 
> Automatically package module based on the file path.
> 
> Pros:
> 
> - Hopefully, this would provide better separation of modules in namespace.
> 
> Cons:
> 
> - Serious potential to break existing Publisher applications.
> 
> - The same module might be loaded into a separate namespace for
> different applications, eliminating the advantage of module caching. [5]
> 
> - This encourages the reuse of module names (such as index.py), which is
> considered a bad programming practice in Python. [1]
> 
> - If the code assumes and uses a package name based on its location, it
> will need to be rewritten if it is moved.
> 
> - The possibility that autopackaging will arbitrarily create a namespace
> clash with a standard module is unacceptably high, especially where
> third party packages are installed.
> 
> - It severely limits the ability to test portions of the code from the
> command line, because it adds an element of unpredictability to the
> module search path.
> 
> - Seasoned Python programmers might consider mod_python.publisher to be
> "broken" because it doesn't conform to Python standards. [6]
> 
> [1] For a clear description of Python's module search path, see:
> http://www.python.org/doc/current/tut/node8.html#SECTION008110000000000000000
> 
> [2] The documentation for mod_python is sparse because it simply embeds
> an interpreter in apache. See the Python documentation for programming
> issues: http://www.python.org/doc/current/index.html
> 
> [3] This seems to be the main complaint levied against mod_python, in
> one form or the other. I consider it one of it's greatest strengths. For
> example, it allows me to import database handling code from a module
> once for that interpreter, allowing multiple applications to share the
> connection -- a poor man's database pool, if you will.
> 
> [4] The same can be said about php.ini, but noone ever needs to restart
> apache to develop PHP applications.
> 
> [5] What is the solution to the problems caused by module caching? It
> doesn't make much sense to force mod_python to act like it's spawning a
> new interpreter for every request. Run the app as a CGI instead of using
> mod_python.
> 
> [6] The strength of Publisher is that it leverages the advantages of
> Python with very little overhead, simply adding a number of conveniences
> specific to web application development. mod_python.psp is a much better
> area to radically depart from this paradigm, as it is expected to
> provide PHP-like behaviour.

Sorry, I don't have much time, so for now I'll give a short answer : I
agree that importing modules should be consistent between the standard
Python way (the import keyword) and the apache.import_module way.

The problem is that mod_python.publisher does not follow the standard
Python way in that it imports published modules as root-level modules.
It's as if mod_python.publisher changed sys.path for each and every
published module. This is not the standard Python way, and the source
for many errors.

Note that the current package system in Python is way, way smarter
than mod_python.publisher : in a package, you can import fellow
modules by giving their local names. It's not recommended by
pychecker, but it works. The smart part is that if I have this :

/
     package1.py
/subdir
     __init__.py
     package1.py
     package2.py

Then whatever I do, /subdir/package1.py is imported as subdir.package1
and does not collide with /package1.py. mod_python.publisher is not as
smart, this is very confusing and surprising, nearly everybody
complains about this and hence, I think this should be filed as a bug.

So maybe apache.import_module should not be modified (except for
performance, but that's another issue which is already in the bugs
database), but mod_python.publisher sure has to be changed.

As far as I'm concerned, this bug was sufficient to have me implement
a publisher which works the way I want ; Daniel Popovitch and Graham
Dumpleton did the same with different designs. If each and every
developer develops his own publisher, it may be time to think about
changing the built-in one.

Regards,
Nicolas
From nicolas.lehuen at gmail.com  Mon Jan 24 10:30:47 2005
From: nicolas.lehuen at gmail.com (Nicolas Lehuen)
Date: Mon Jan 24 10:30:50 2005
Subject: [mod_python] psp_site example doesn't work
In-Reply-To: <c298f2d705012407284ef8ab40@mail.gmail.com>
References: <1106523523.15703@dscpl.user.openhosting.com>
	<c298f2d7050123230939196a6@mail.gmail.com>
	<41F50248.1020703@joreybump.com>
	<c298f2d705012407284ef8ab40@mail.gmail.com>
Message-ID: <c298f2d705012407307d37cb3c@mail.gmail.com>

On Mon, 24 Jan 2005 16:28:47 +0100, Nicolas Lehuen
<nicolas.lehuen@gmail.com> wrote:
> On Mon, 24 Jan 2005 09:12:24 -0500, Jorey Bump <list@joreybump.com> wrote:
> > Nicolas Lehuen wrote:
> > > On Sun, 23 Jan 2005 18:38:43 -0500, Graham Dumpleton
> > > <grahamd@dscpl.com.au> wrote:
> >
> > >>Package such as mpservlets and Vampire implement their own module
> > >>importing mechanisms in order to avoid this problem. Ie., with those
> > >>packages it is safe to have Python code files which are named the same
> > >>appearing in different directories managed by mod_python running
> > >>under the same interpreter.
> > >
> > > We had a discussion a few months ago about this issue, and I still
> > > think it's a bug. Like Daniel Popovitch with mpservlets and you with
> > > Vampire, I had to implement my own import mechanism to work around the
> > > bug. I think it's time to fix it... I'll add a bug report and see what
> > > we can do about it.
> >
> > I guess I'm on record as considering this to be normal Python behaviour,
> > and not a bug. Talk of modifying Publisher's current import mechanism
> > threatens the significant investment I have in the applications I've
> > already developed. I'd rather see Publisher left alone, as other
> > frameworks are maturing that address this issue.
> >
> > We should be clear about what we are talking about:
> >
> > Issue:
> >
> > An interpreter imports a module's name into the namespace independent of
> > its location in the filesystem.
> >
> > Pros:
> >
> > - This is consistent with normal Python behaviour, where an interpreter
> > loads modules from the current directory or PYTHONPATH. [1]
> >
> > - There is no ambiguity about imports, and no need to rewrite code when
> > moving the module to another location.
> >
> > - The Python language documentation serves as a good resource, as native
> > behaviours are not contradicted. [2]
> >
> > - General purpose code needs *very* little modification to run under
> > mod_python.publisher.
> >
> > - The default Python behaviour of caching imported modules can be used
> > to great leverage, and plays a significant role in the performance boost
> > offered by mod_python. [3]
> >
> > - With careful planning, per-interpreter package repositories can be
> > created.
> >
> > Cons:
> >
> > - This consistently trips up newbies, who are expecting PHP-like
> > behaviour from their web applications.
> >
> > - Within an interpreter (a VirtualHost, for example), such care must be
> > taken to create unique module names that porting an application or
> > working in a team environment is significantly more fragile than in
> > other web technologies, where it usually suffices to throw the code in
> > its own directory.
> >
> > - Although a lot of issues can be addressed in .htaccess files, so much
> > configuration occurs at the apache level that it is difficult to use
> > mod_python effectively without apache admin privileges. [4]
> >
> > - The Multi-Processing Modules (MPMs) in apache 2 may have a unique
> > effect on an application. After throwing in the different platforms,
> > Python versions, and developer styles, it can be very hard to reach a
> > consensus on whether an issue even exists.
> >
> > Possible solution:
> >
> > Automatically package module based on the file path.
> >
> > Pros:
> >
> > - Hopefully, this would provide better separation of modules in namespace.
> >
> > Cons:
> >
> > - Serious potential to break existing Publisher applications.
> >
> > - The same module might be loaded into a separate namespace for
> > different applications, eliminating the advantage of module caching. [5]
> >
> > - This encourages the reuse of module names (such as index.py), which is
> > considered a bad programming practice in Python. [1]
> >
> > - If the code assumes and uses a package name based on its location, it
> > will need to be rewritten if it is moved.
> >
> > - The possibility that autopackaging will arbitrarily create a namespace
> > clash with a standard module is unacceptably high, especially where
> > third party packages are installed.
> >
> > - It severely limits the ability to test portions of the code from the
> > command line, because it adds an element of unpredictability to the
> > module search path.
> >
> > - Seasoned Python programmers might consider mod_python.publisher to be
> > "broken" because it doesn't conform to Python standards. [6]
> >
> > [1] For a clear description of Python's module search path, see:
> > http://www.python.org/doc/current/tut/node8.html#SECTION008110000000000000000
> >
> > [2] The documentation for mod_python is sparse because it simply embeds
> > an interpreter in apache. See the Python documentation for programming
> > issues: http://www.python.org/doc/current/index.html
> >
> > [3] This seems to be the main complaint levied against mod_python, in
> > one form or the other. I consider it one of it's greatest strengths. For
> > example, it allows me to import database handling code from a module
> > once for that interpreter, allowing multiple applications to share the
> > connection -- a poor man's database pool, if you will.
> >
> > [4] The same can be said about php.ini, but noone ever needs to restart
> > apache to develop PHP applications.
> >
> > [5] What is the solution to the problems caused by module caching? It
> > doesn't make much sense to force mod_python to act like it's spawning a
> > new interpreter for every request. Run the app as a CGI instead of using
> > mod_python.
> >
> > [6] The strength of Publisher is that it leverages the advantages of
> > Python with very little overhead, simply adding a number of conveniences
> > specific to web application development. mod_python.psp is a much better
> > area to radically depart from this paradigm, as it is expected to
> > provide PHP-like behaviour.
> 
> Sorry, I don't have much time, so for now I'll give a short answer : I
> agree that importing modules should be consistent between the standard
> Python way (the import keyword) and the apache.import_module way.
> 
> The problem is that mod_python.publisher does not follow the standard
> Python way in that it imports published modules as root-level modules.
> It's as if mod_python.publisher changed sys.path for each and every
> published module. This is not the standard Python way, and the source
> for many errors.
> 
> Note that the current package system in Python is way, way smarter
> than mod_python.publisher : in a package, you can import fellow
> modules by giving their local names. It's not recommended by
> pychecker, but it works. The smart part is that if I have this :
> 
> /
>      package1.py
> /subdir
>      __init__.py
>      package1.py
>      package2.py
> 
> Then whatever I do, /subdir/package1.py is imported as subdir.package1
> and does not collide with /package1.py. mod_python.publisher is not as
> smart, this is very confusing and surprising, nearly everybody
> complains about this and hence, I think this should be filed as a bug.
> 
> So maybe apache.import_module should not be modified (except for
> performance, but that's another issue which is already in the bugs
> database), but mod_python.publisher sure has to be changed.
> 
> As far as I'm concerned, this bug was sufficient to have me implement
> a publisher which works the way I want ; Daniel Popovitch and Graham
> Dumpleton did the same with different designs. If each and every
> developer develops his own publisher, it may be time to think about
> changing the built-in one.
> 
> Regards,
> Nicolas
> 

Or it could be the sign that mod_python.publisher should be completely
erased from the project, since it poses much more problems than it
solves. Maybe we should include both mpservlets and Vampire in
mod_python, and forget about the default publisher (except maybe for
compatibility issues).

Regards,
Nicolas
From JFeghhi at visa.com  Mon Jan 24 11:08:50 2005
From: JFeghhi at visa.com (Feghhi, Jalil)
Date: Mon Jan 24 11:09:23 2005
Subject: [mod_python] Integration Issue
Message-ID: <8C53AAFA2050EE40BDCDB9455DA7D63401A00F60@sw720ex020.visa.com>


I compiled and installed Python 2.4 under Redhat in /usr/local/bin and
/usr/local/lib (default locations). I then compiled mod_python using
Python 2.4 (I could see it picking up the right version when compiling).
However, when run under Apache, it seems it still picks up the older
version of Python libraries from /usr/lib. How can I make Apache (or
mod_python under Apache) use the new version?

Thanks,

-JF

From lroubeyrie at limair.asso.fr  Mon Jan 24 11:13:06 2005
From: lroubeyrie at limair.asso.fr (Lionel Roubeyrie)
Date: Mon Jan 24 11:14:12 2005
Subject: [mod_python] module import
Message-ID: <200501241713.06813.lroubeyrie@limair.asso.fr>

Hi all,
new in the mod_python's world, I'm starting with a little problem of import.
The index.py page must import a package in the subdirectory where index.py is, 
then I wrote:
import os, sys
current_path = os.getcwd()
top = os.path.join(current_path, '../')
if top not in sys.path : sys.path.append(top)
import my_mod

mod_python raise an error, but puting the lines in a python shell works!
Do I have to do anything else?

-- 
Lionel Roubeyrie - lroubeyrie@limair.asso.fr
LIMAIR
http://www.limair.asso.fr

From dpopowich at comcast.net  Mon Jan 24 12:19:46 2005
From: dpopowich at comcast.net (Daniel Popowich)
Date: Mon Jan 24 12:19:54 2005
Subject: [mod_python] psp_site example doesn't work
In-Reply-To: <c298f2d705012407307d37cb3c@mail.gmail.com>
References: <1106523523.15703@dscpl.user.openhosting.com>
	<c298f2d7050123230939196a6@mail.gmail.com>
	<41F50248.1020703@joreybump.com>
	<c298f2d705012407284ef8ab40@mail.gmail.com>
	<c298f2d705012407307d37cb3c@mail.gmail.com>
Message-ID: <16885.11826.768433.372438@greenmonster.local>


I agree with Nicolas that this is a "bug".  Perhaps not a bug in the
classic sense: something not working as advertised, but a design
issue so gnarly, that it smells like bug.

Thank you Jorey for your detailed email, but I have to disagree with
you when you wrote:

    This is consistent with normal Python behaviour, where an
    interpreter loads modules from the current directory or
    PYTHONPATH. [1]

I came to mod_python after *many* years of intensive python
programming and as a newbie to mod_python was caught by this issue for
days.  The way mod_python imports files all at the same root level is
very UN-pythonic.  After much hair-pulling I finally realized I needed
to roll my own for mpservlets.

I do think it's possible to patch publisher and keep it backwards
compatible.  In mpservlets, I do something like this:

    cache = {}
    ...
    fname = full path of source file to be loaded, say, req.filename
    ...
    # check cache
    code = cache.get(fname)
    if not code:
	code = {}
	execfile(fname, code)
	cache[fname] = code
    # search code dictionary for what I'm after, e.g.:
    handler = code.get('handler')
    if not handler:
       raise apache.SERVER_RETURN, apache.http_not_found
    handler(req)

You get the idea...

Since publisher should "own" the modules it will import (if well
designed, IMHO, the files exist for mod_python, not general use) and
knows exactly what it's looking for in the modules, I see no reason
why such a caching scheme can't work.

There is an issue of both the python module infrastructure and
mod_python having their own copies of the same module if your
publisher source file is imported by another module, e.g., index.py is
imported by foo.py.  With mpservlets I took the path of enforcing
servlets to be in a file that cannot be imported by other modules
(they have to be named .mps); this did two things: 1) prevents the
double caching problem and 2) promotes the separation of interface
code from business logic code.

I also agree with Nicolas that there seems to be a message being sent
when you consider mpservlets, Vampire, his own handler and PSP are all
doing their own importing mechanism.  Let's face it, importing in
vanilla python is not the most clear-cut source-inclusion scheme
around (this is the ONLY area where I think java got it right over
python); when you imbed it in a process like apache...ouch...

As for Nicholas' suggestion of removing publisher from the
project...that may be a bit drastic.  That being said, I've never
thought it an intuitive place to start for newbies.

But if mpservlets was adopted into the main-stream distro...!  :-)

Daniel Popowich
-----------------------------------------------
http://home.comcast.net/~d.popowich/mpservlets/




Nicolas Lehuen writes:
> On Mon, 24 Jan 2005 16:28:47 +0100, Nicolas Lehuen
> <nicolas.lehuen@gmail.com> wrote:
> > On Mon, 24 Jan 2005 09:12:24 -0500, Jorey Bump <list@joreybump.com> wrote:
> > > Nicolas Lehuen wrote:
> > > > On Sun, 23 Jan 2005 18:38:43 -0500, Graham Dumpleton
> > > > <grahamd@dscpl.com.au> wrote:
> > >
> > > >>Package such as mpservlets and Vampire implement their own module
> > > >>importing mechanisms in order to avoid this problem. Ie., with those
> > > >>packages it is safe to have Python code files which are named the same
> > > >>appearing in different directories managed by mod_python running
> > > >>under the same interpreter.
> > > >
> > > > We had a discussion a few months ago about this issue, and I still
> > > > think it's a bug. Like Daniel Popovitch with mpservlets and you with
> > > > Vampire, I had to implement my own import mechanism to work around the
> > > > bug. I think it's time to fix it... I'll add a bug report and see what
> > > > we can do about it.
> > >
> > > I guess I'm on record as considering this to be normal Python behaviour,
> > > and not a bug. Talk of modifying Publisher's current import mechanism
> > > threatens the significant investment I have in the applications I've
> > > already developed. I'd rather see Publisher left alone, as other
> > > frameworks are maturing that address this issue.
> > >
> > > We should be clear about what we are talking about:
> > >
> > > Issue:
> > >
> > > An interpreter imports a module's name into the namespace independent of
> > > its location in the filesystem.
> > >
> > > Pros:
> > >
> > > - This is consistent with normal Python behaviour, where an interpreter
> > > loads modules from the current directory or PYTHONPATH. [1]
> > >
> > > - There is no ambiguity about imports, and no need to rewrite code when
> > > moving the module to another location.
> > >
> > > - The Python language documentation serves as a good resource, as native
> > > behaviours are not contradicted. [2]
> > >
> > > - General purpose code needs *very* little modification to run under
> > > mod_python.publisher.
> > >
> > > - The default Python behaviour of caching imported modules can be used
> > > to great leverage, and plays a significant role in the performance boost
> > > offered by mod_python. [3]
> > >
> > > - With careful planning, per-interpreter package repositories can be
> > > created.
> > >
> > > Cons:
> > >
> > > - This consistently trips up newbies, who are expecting PHP-like
> > > behaviour from their web applications.
> > >
> > > - Within an interpreter (a VirtualHost, for example), such care must be
> > > taken to create unique module names that porting an application or
> > > working in a team environment is significantly more fragile than in
> > > other web technologies, where it usually suffices to throw the code in
> > > its own directory.
> > >
> > > - Although a lot of issues can be addressed in .htaccess files, so much
> > > configuration occurs at the apache level that it is difficult to use
> > > mod_python effectively without apache admin privileges. [4]
> > >
> > > - The Multi-Processing Modules (MPMs) in apache 2 may have a unique
> > > effect on an application. After throwing in the different platforms,
> > > Python versions, and developer styles, it can be very hard to reach a
> > > consensus on whether an issue even exists.
> > >
> > > Possible solution:
> > >
> > > Automatically package module based on the file path.
> > >
> > > Pros:
> > >
> > > - Hopefully, this would provide better separation of modules in namespace.
> > >
> > > Cons:
> > >
> > > - Serious potential to break existing Publisher applications.
> > >
> > > - The same module might be loaded into a separate namespace for
> > > different applications, eliminating the advantage of module caching. [5]
> > >
> > > - This encourages the reuse of module names (such as index.py), which is
> > > considered a bad programming practice in Python. [1]
> > >
> > > - If the code assumes and uses a package name based on its location, it
> > > will need to be rewritten if it is moved.
> > >
> > > - The possibility that autopackaging will arbitrarily create a namespace
> > > clash with a standard module is unacceptably high, especially where
> > > third party packages are installed.
> > >
> > > - It severely limits the ability to test portions of the code from the
> > > command line, because it adds an element of unpredictability to the
> > > module search path.
> > >
> > > - Seasoned Python programmers might consider mod_python.publisher to be
> > > "broken" because it doesn't conform to Python standards. [6]
> > >
> > > [1] For a clear description of Python's module search path, see:
> > > http://www.python.org/doc/current/tut/node8.html#SECTION008110000000000000000
> > >
> > > [2] The documentation for mod_python is sparse because it simply embeds
> > > an interpreter in apache. See the Python documentation for programming
> > > issues: http://www.python.org/doc/current/index.html
> > >
> > > [3] This seems to be the main complaint levied against mod_python, in
> > > one form or the other. I consider it one of it's greatest strengths. For
> > > example, it allows me to import database handling code from a module
> > > once for that interpreter, allowing multiple applications to share the
> > > connection -- a poor man's database pool, if you will.
> > >
> > > [4] The same can be said about php.ini, but noone ever needs to restart
> > > apache to develop PHP applications.
> > >
> > > [5] What is the solution to the problems caused by module caching? It
> > > doesn't make much sense to force mod_python to act like it's spawning a
> > > new interpreter for every request. Run the app as a CGI instead of using
> > > mod_python.
> > >
> > > [6] The strength of Publisher is that it leverages the advantages of
> > > Python with very little overhead, simply adding a number of conveniences
> > > specific to web application development. mod_python.psp is a much better
> > > area to radically depart from this paradigm, as it is expected to
> > > provide PHP-like behaviour.
> > 
> > Sorry, I don't have much time, so for now I'll give a short answer : I
> > agree that importing modules should be consistent between the standard
> > Python way (the import keyword) and the apache.import_module way.
> > 
> > The problem is that mod_python.publisher does not follow the standard
> > Python way in that it imports published modules as root-level modules.
> > It's as if mod_python.publisher changed sys.path for each and every
> > published module. This is not the standard Python way, and the source
> > for many errors.
> > 
> > Note that the current package system in Python is way, way smarter
> > than mod_python.publisher : in a package, you can import fellow
> > modules by giving their local names. It's not recommended by
> > pychecker, but it works. The smart part is that if I have this :
> > 
> > /
> >      package1.py
> > /subdir
> >      __init__.py
> >      package1.py
> >      package2.py
> > 
> > Then whatever I do, /subdir/package1.py is imported as subdir.package1
> > and does not collide with /package1.py. mod_python.publisher is not as
> > smart, this is very confusing and surprising, nearly everybody
> > complains about this and hence, I think this should be filed as a bug.
> > 
> > So maybe apache.import_module should not be modified (except for
> > performance, but that's another issue which is already in the bugs
> > database), but mod_python.publisher sure has to be changed.
> > 
> > As far as I'm concerned, this bug was sufficient to have me implement
> > a publisher which works the way I want ; Daniel Popovitch and Graham
> > Dumpleton did the same with different designs. If each and every
> > developer develops his own publisher, it may be time to think about
> > changing the built-in one.
> > 
> > Regards,
> > Nicolas
> > 
> 
> Or it could be the sign that mod_python.publisher should be completely
> erased from the project, since it poses much more problems than it
> solves. Maybe we should include both mpservlets and Vampire in
> mod_python, and forget about the default publisher (except maybe for
> compatibility issues).
> 
> Regards,
> Nicolas
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
From god at skri.org  Mon Jan 24 12:32:31 2005
From: god at skri.org (Simon Kesenci)
Date: Mon Jan 24 12:34:02 2005
Subject: [mod_python] Integration Issue
In-Reply-To: <8C53AAFA2050EE40BDCDB9455DA7D63401A00F60@sw720ex020.visa.com>
References: <8C53AAFA2050EE40BDCDB9455DA7D63401A00F60@sw720ex020.visa.com>
Message-ID: <ED232782-6E2D-11D9-8FAE-000393CA53DC@skri.org>

Did you move the new mod_python.so into the apache module directory?

--S.

On Jan 24, 2005, at 08:08, Feghhi, Jalil wrote:

>
> I compiled and installed Python 2.4 under Redhat in /usr/local/bin and
> /usr/local/lib (default locations). I then compiled mod_python using
> Python 2.4 (I could see it picking up the right version when 
> compiling).
> However, when run under Apache, it seems it still picks up the older
> version of Python libraries from /usr/lib. How can I make Apache (or
> mod_python under Apache) use the new version?
>
> Thanks,
>
> -JF
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>

From nick at dd.revealed.net  Mon Jan 24 12:45:34 2005
From: nick at dd.revealed.net (Nick)
Date: Mon Jan 24 12:45:47 2005
Subject: [mod_python] psp_site example doesn't work
In-Reply-To: <16885.11826.768433.372438@greenmonster.local>
References: <1106523523.15703@dscpl.user.openhosting.com>	<c298f2d7050123230939196a6@mail.gmail.com>	<41F50248.1020703@joreybump.com>	<c298f2d705012407284ef8ab40@mail.gmail.com>	<c298f2d705012407307d37cb3c@mail.gmail.com>
	<16885.11826.768433.372438@greenmonster.local>
Message-ID: <41F5343E.1080807@dd.revealed.net>

While I don't use the publisher handler anymore, I agree with these guys. 
It *is* essentially correct behavior for python, but it is also 
non-intuitive and a stumbling block for new users.

I don't believe getting rid of the publisher handler is a solution, because 
it's a good starting place, simple to understand, and particularly useful to 
some folks.  It's a good way to understand how mod_python works, in terms of 
an example of how to write handlers.

Maybe the solution is just to document the behavior and explain WHY that 
happens.  As a relatively experienced Python user before mod_python, it only 
took a short time to track this down and understand the problem, but it 
seems like a lot of users are new to both Python and mod_python. 
Secondarily, make an import function available separate from the Python 
import facilities that implements something like what is done in Vampire 
and/or mp_servlets, while leaving the default mechanism intact.

Nick

Daniel Popowich wrote:
> I agree with Nicolas that this is a "bug".  Perhaps not a bug in the
> classic sense: something not working as advertised, but a design
> issue so gnarly, that it smells like bug.
> 
> Thank you Jorey for your detailed email, but I have to disagree with
> you when you wrote:
> 
>     This is consistent with normal Python behaviour, where an
>     interpreter loads modules from the current directory or
>     PYTHONPATH. [1]
> 
> I came to mod_python after *many* years of intensive python
> programming and as a newbie to mod_python was caught by this issue for
> days.  The way mod_python imports files all at the same root level is
> very UN-pythonic.  After much hair-pulling I finally realized I needed
> to roll my own for mpservlets.
From list at joreybump.com  Mon Jan 24 14:32:05 2005
From: list at joreybump.com (Jorey Bump)
Date: Mon Jan 24 14:32:15 2005
Subject: [mod_python] psp_site example doesn't work
In-Reply-To: <c298f2d705012407307d37cb3c@mail.gmail.com>
References: <1106523523.15703@dscpl.user.openhosting.com>	
	<c298f2d7050123230939196a6@mail.gmail.com>	
	<41F50248.1020703@joreybump.com>	
	<c298f2d705012407284ef8ab40@mail.gmail.com>
	<c298f2d705012407307d37cb3c@mail.gmail.com>
Message-ID: <41F54D35.8020107@joreybump.com>

Nicolas Lehuen wrote:
> On Mon, 24 Jan 2005 16:28:47 +0100, Nicolas Lehuen
> <nicolas.lehuen@gmail.com> wrote:
> 
>>On Mon, 24 Jan 2005 09:12:24 -0500, Jorey Bump <list@joreybump.com> wrote:
>>
>>>Nicolas Lehuen wrote:

>>The problem is that mod_python.publisher does not follow the standard
>>Python way in that it imports published modules as root-level modules.

Yes, it's true that it strips away leading path information to put all 
modules on an even plane. I find this an easy adjustment to make. 
Imports done by published modules obey sys.path, so I don't see any 
problem.

>>It's as if mod_python.publisher changed sys.path for each and every
>>published module. This is not the standard Python way, and the source
>>for many errors.

The main effect is that the DocumentRoot might get prepended to sys.path 
instead of the directory containing the published module. But a single 
interpreter must have a single working directory, so I consider this an 
elegant solution.

If you modify the path with the PythonPath directive, this will no 
longer be the case. The DocumentRoot is not prepended to the path and 
you will be limited to the directories explicitly listed in PythonPath. 
This can lead to surprising behaviour if you created some modules and 
packages in the DocumentRoot, because they will no longer work properly.

To me, this seems very much like a feature, and not a bug, because it 
allows you to finetune your environment and offers some nice security 
capabilities. You are right that it's not expected, but it's not 
necessarily inconsistent, once you get used to it.

Fortunately, I tend to create packages that are available for my apps 
and put them in predictable locations in the module search path, so I'm 
not bit by this. You are right that this can be a serious problem for 
anyone expecting sys.path to be identical to python run from the command 
line, but it's really a mod_python configuration issue.

>>Note that the current package system in Python is way, way smarter
>>than mod_python.publisher : in a package, you can import fellow
>>modules by giving their local names. It's not recommended by
>>pychecker, but it works. The smart part is that if I have this :
>>
>>/
>>     package1.py
>>/subdir
>>     __init__.py
>>     package1.py
>>     package2.py
>>
>>Then whatever I do, /subdir/package1.py is imported as subdir.package1
>>and does not collide with /package1.py. mod_python.publisher is not as
>>smart, this is very confusing and surprising, nearly everybody
>>complains about this and hence, I think this should be filed as a bug.

To be accurate, Python does not import fellow modules or packages -- it 
prepends the directory containing the main module to sys.path and limits 
imports to sys.path. As seen above, mod_python also obeys sys.path, so 
be sure your imported modules/packages are there.

>>So maybe apache.import_module should not be modified (except for
>>performance, but that's another issue which is already in the bugs
>>database), but mod_python.publisher sure has to be changed.

Its behaviour is consistent, once you understand it, so I don't see a 
need for the change.

> Or it could be the sign that mod_python.publisher should be completely
> erased from the project, since it poses much more problems than it
> solves. Maybe we should include both mpservlets and Vampire in
> mod_python, and forget about the default publisher (except maybe for
> compatibility issues).

Yikes! Publisher is simply the best web application framework I have 
ever used. I've never felt a need to move beyond it, and I'm not menaced 
by the issues that seem to bother others. I'd rather see it more heavily 
promoted and the intricacies explained in some more detail. Once you 
comprehend a few simple rules, it's incredibly powerful and productive. 
   Grisha created a thing of beauty in Publisher, but its simplicity is 
lost on many people. To remove it would be madness...



From list at joreybump.com  Mon Jan 24 14:56:23 2005
From: list at joreybump.com (Jorey Bump)
Date: Mon Jan 24 14:56:30 2005
Subject: [mod_python] psp_site example doesn't work
In-Reply-To: <16885.11826.768433.372438@greenmonster.local>
References: <1106523523.15703@dscpl.user.openhosting.com>	<c298f2d7050123230939196a6@mail.gmail.com>	<41F50248.1020703@joreybump.com>	<c298f2d705012407284ef8ab40@mail.gmail.com>	<c298f2d705012407307d37cb3c@mail.gmail.com>
	<16885.11826.768433.372438@greenmonster.local>
Message-ID: <41F552E7.4000805@joreybump.com>

Daniel Popowich wrote:

> Thank you Jorey for your detailed email, but I have to disagree with
> you when you wrote:
> 
>     This is consistent with normal Python behaviour, where an
>     interpreter loads modules from the current directory or
>     PYTHONPATH. [1]
> 
> I came to mod_python after *many* years of intensive python
> programming and as a newbie to mod_python was caught by this issue for
> days.  The way mod_python imports files all at the same root level is
> very UN-pythonic.  

Yes, I'll concede that. But, mod_python.publisher must remove leading 
path information when the published modules are imported, otherwise 
Python wouldn't import them (unless they happen to be in sys.path). It's 
important to understand that the module in the URL is being imported by 
another module, not run directly by the interpreter, as when you type 
"python app.py" on the command line. It took a while for this to sink in 
completely, myself.

There is no mechanism in Python to import a module by file path, so it's 
consistent, but confusing. The alternative would have been to force a 
working directory onto the user, much like a cgi-bin, and prepend that 
to sys.path.

> I also agree with Nicolas that there seems to be a message being sent
> when you consider mpservlets, Vampire, his own handler and PSP are all
> doing their own importing mechanism.  Let's face it, importing in
> vanilla python is not the most clear-cut source-inclusion scheme
> around (this is the ONLY area where I think java got it right over
> python); when you imbed it in a process like apache...ouch...

Yes, this abstraction of the interpreter seems to be what causes the 
most confusion. I guess I would summarize it like this:

1. The modules in your URL are imported by Publisher at the root level.
2. The modules in your URL must obey sys.path in their own imports.

Add the sugar (like readily accessible form variables, the req object, 
etc.) and you have Publisher.




From nicolas.lehuen at gmail.com  Mon Jan 24 14:58:59 2005
From: nicolas.lehuen at gmail.com (Nicolas Lehuen)
Date: Mon Jan 24 14:59:04 2005
Subject: [mod_python] psp_site example doesn't work
In-Reply-To: <16885.11826.768433.372438@greenmonster.local>
References: <1106523523.15703@dscpl.user.openhosting.com>
	<c298f2d7050123230939196a6@mail.gmail.com>
	<41F50248.1020703@joreybump.com>
	<c298f2d705012407284ef8ab40@mail.gmail.com>
	<c298f2d705012407307d37cb3c@mail.gmail.com>
	<16885.11826.768433.372438@greenmonster.local>
Message-ID: <c298f2d705012411582debaa2a@mail.gmail.com>

On Mon, 24 Jan 2005 12:19:46 -0500, Daniel Popowich
<dpopowich@comcast.net> wrote:
> 
> I agree with Nicolas that this is a "bug".  Perhaps not a bug in the
> classic sense: something not working as advertised, but a design
> issue so gnarly, that it smells like bug.
> 
> Thank you Jorey for your detailed email, but I have to disagree with
> you when you wrote:
> 
>     This is consistent with normal Python behaviour, where an
>     interpreter loads modules from the current directory or
>     PYTHONPATH. [1]
> 
> I came to mod_python after *many* years of intensive python
> programming and as a newbie to mod_python was caught by this issue for
> days.  The way mod_python imports files all at the same root level is
> very UN-pythonic.  After much hair-pulling I finally realized I needed
> to roll my own for mpservlets.
> 
> I do think it's possible to patch publisher and keep it backwards
> compatible.  In mpservlets, I do something like this:
> 
>     cache = {}
>     ...
>     fname = full path of source file to be loaded, say, req.filename
>     ...
>     # check cache
>     code = cache.get(fname)
>     if not code:
>         code = {}
>         execfile(fname, code)
>         cache[fname] = code
>     # search code dictionary for what I'm after, e.g.:
>     handler = code.get('handler')
>     if not handler:
>        raise apache.SERVER_RETURN, apache.http_not_found
>     handler(req)
> 
> You get the idea...
>
> Since publisher should "own" the modules it will import (if well
> designed, IMHO, the files exist for mod_python, not general use) and
> knows exactly what it's looking for in the modules, I see no reason
> why such a caching scheme can't work.

That's what I also use, with locks to ensure thread safety, and it
works without a hitch on a production server. I do totally agree with
you when you write that published modules should not be mixed with
general purpose modules. Published modules and 'standard' modules do
not share the same semantics :

- published modules can be reloaded as soon as they are modified, or
loaded multiple times if you use the forked MPM ; the code it contains
must be aware of this fact, which is generally not true for standard
modules.
- some objects from the published modules are accessible through HTTP.
This means that those modules are potentially subject to security
problems. In mod_python.publisher, a non-callable object is simply
transformed into a string and returned to the HTTP client. It's not a
good idea, therefore, to have a variable named
MY_VERY_SECRET_PRIVATE_KEY in the module... It's not even a good idea
to import it ! Granted, some other publishers may secure what is
accessible through HTTP and what is not (mine does), but anyway, it's
a good idea to distinguish between published modules and the others.
- I personnaly think it's a good thing for published modules not to be
compiled into a .pyc or .pyo file. Like for the previous point, my
concern is about security : .pyc and .pyo file should not be
accessible through HTTP, lest you want your code be dissassembled and
your private key exposed. A simple .htaccess directive can solve this,
but what about the zillion people who will forget about it ?
 
> There is an issue of both the python module infrastructure and
> mod_python having their own copies of the same module if your
> publisher source file is imported by another module, e.g., index.py is
> imported by foo.py.  With mpservlets I took the path of enforcing
> servlets to be in a file that cannot be imported by other modules
> (they have to be named .mps); this did two things: 1) prevents the
> double caching problem and 2) promotes the separation of interface
> code from business logic code.

I totally agree with your design decision. My application are
separated between published modules which contain all the HTML and
interface logic, and standard, imported backend modules which contain
all the application logic. Much cleaner this way.

> I also agree with Nicolas that there seems to be a message being sent
> when you consider mpservlets, Vampire, his own handler and PSP are all
> doing their own importing mechanism.  Let's face it, importing in
> vanilla python is not the most clear-cut source-inclusion scheme
> around (this is the ONLY area where I think java got it right over
> python); when you imbed it in a process like apache...ouch...
> 
> As for Nicholas' suggestion of removing publisher from the
> project...that may be a bit drastic.  That being said, I've never
> thought it an intuitive place to start for newbies.

That was a bit provocative, I agree ;).

> But if mpservlets was adopted into the main-stream distro...!  :-)

I'd say, why not ? I think it's a good thing mod_python is designed
the way it is. mod_python.apache provides a very low-level interface
to the Apache mod API. We can then add higher level interfaces on top
: mod_python.publisher, mpservlets, Vampire... We could even package
in a WSGI implementation !

However, I think mod_python should provide a default high level
implementation, a little bit more convenient than
mod_python.publisher. For starters, I think, like Graham, that the
fact that the publisher want you to return document instead of writing
them to the request object is a bit surprising for the newbie, and
hampers the transition from handlers to published objects. Maybe by
working together on the python-dev list, we could design a new
publisher for mod_python ?

Regards,
Nicolas
From list at joreybump.com  Mon Jan 24 15:29:43 2005
From: list at joreybump.com (Jorey Bump)
Date: Mon Jan 24 15:29:51 2005
Subject: [mod_python] psp_site example doesn't work
In-Reply-To: <c298f2d705012411582debaa2a@mail.gmail.com>
References: <1106523523.15703@dscpl.user.openhosting.com>	<c298f2d7050123230939196a6@mail.gmail.com>	<41F50248.1020703@joreybump.com>	<c298f2d705012407284ef8ab40@mail.gmail.com>	<c298f2d705012407307d37cb3c@mail.gmail.com>	<16885.11826.768433.372438@greenmonster.local>
	<c298f2d705012411582debaa2a@mail.gmail.com>
Message-ID: <41F55AB7.5050906@joreybump.com>

Nicolas Lehuen wrote:

> - some objects from the published modules are accessible through HTTP.
> This means that those modules are potentially subject to security
> problems. In mod_python.publisher, a non-callable object is simply
> transformed into a string and returned to the HTTP client. It's not a
> good idea, therefore, to have a variable named
> MY_VERY_SECRET_PRIVATE_KEY in the module... It's not even a good idea
> to import it ! Granted, some other publishers may secure what is
> accessible through HTTP and what is not (mine does), but anyway, it's
> a good idea to distinguish between published modules and the others.

That's disconcerting. Can you provide a sample showing how such a 
variable would be exposed?

> - I personnaly think it's a good thing for published modules not to be
> compiled into a .pyc or .pyo file. Like for the previous point, my
> concern is about security : .pyc and .pyo file should not be
> accessible through HTTP, lest you want your code be dissassembled and
> your private key exposed. A simple .htaccess directive can solve this,
> but what about the zillion people who will forget about it ?

Ouch! I wasn't aware of this! Is this all that's necessary?

<FilesMatch "\.(pyc|pyo)$">
     Order allow,deny
     Deny from all
</FilesMatch>

Will that also cause the compiled versions not to be used by mod_python?


From JFeghhi at visa.com  Mon Jan 24 16:06:10 2005
From: JFeghhi at visa.com (Feghhi, Jalil)
Date: Mon Jan 24 16:06:46 2005
Subject: [mod_python] Integration Issue
Message-ID: <8C53AAFA2050EE40BDCDB9455DA7D63401A01068@sw720ex020.visa.com>


Yes. I checked and the mod_python.so file under /etc/httpd/modules had a
new timestamp. I am not at my RH box now but I will double check to make
sure. Anything else I need to do? Are there any env. vars used by
Apache? I couldn't find any.

Also, I noticed mod_python.so is picked up by Apache automatically and I
don't need to load it explicitly in httpd.conf. When I do it explicitly,
there is a warning that the module is already loaded and will be
skipped. I am not sure if this has anything to do with it though.

Thanks,

-Jalil

-----Original Message-----
From: Simon Kesenci [mailto:god@skri.org] 
Sent: Monday, January 24, 2005 9:33 AM
To: Feghhi, Jalil
Cc: mod_python@modpython.org
Subject: Re: [mod_python] Integration Issue

Did you move the new mod_python.so into the apache module directory?

--S.

On Jan 24, 2005, at 08:08, Feghhi, Jalil wrote:

>
> I compiled and installed Python 2.4 under Redhat in /usr/local/bin and

> /usr/local/lib (default locations). I then compiled mod_python using 
> Python 2.4 (I could see it picking up the right version when 
> compiling).
> However, when run under Apache, it seems it still picks up the older 
> version of Python libraries from /usr/lib. How can I make Apache (or 
> mod_python under Apache) use the new version?
>
> Thanks,
>
> -JF
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>


From list at joreybump.com  Mon Jan 24 16:12:39 2005
From: list at joreybump.com (Jorey Bump)
Date: Mon Jan 24 16:12:47 2005
Subject: [mod_python] psp_site example doesn't work
In-Reply-To: <41F55AB7.5050906@joreybump.com>
References: <1106523523.15703@dscpl.user.openhosting.com>	<c298f2d7050123230939196a6@mail.gmail.com>	<41F50248.1020703@joreybump.com>	<c298f2d705012407284ef8ab40@mail.gmail.com>	<c298f2d705012407307d37cb3c@mail.gmail.com>	<16885.11826.768433.372438@greenmonster.local>	<c298f2d705012411582debaa2a@mail.gmail.com>
	<41F55AB7.5050906@joreybump.com>
Message-ID: <41F564C7.6050209@joreybump.com>

Jorey Bump wrote:
> Nicolas Lehuen wrote:
> 
>> - some objects from the published modules are accessible through HTTP.
>> This means that those modules are potentially subject to security
>> problems. In mod_python.publisher, a non-callable object is simply
>> transformed into a string and returned to the HTTP client. It's not a
>> good idea, therefore, to have a variable named
>> MY_VERY_SECRET_PRIVATE_KEY in the module... It's not even a good idea
>> to import it ! Granted, some other publishers may secure what is
>> accessible through HTTP and what is not (mine does), but anyway, it's
>> a good idea to distinguish between published modules and the others.
> 
> 
> That's disconcerting. Can you provide a sample showing how such a 
> variable would be exposed?

Nevermind. I see that it's directly accessible via the URL:

  # foo.py
  secret = 'abc123'

accessible via:

  http://host/foo/secret

To fix:

  # foo.py
  _secret = 'abc123'

not accessible via:

  http://host/foo/_secret

Thank you for pointing this out, Nicolas. I have some editing to do...


From god at skri.org  Mon Jan 24 16:22:28 2005
From: god at skri.org (Simon Kesenci)
Date: Mon Jan 24 16:23:59 2005
Subject: [mod_python] Integration Issue
In-Reply-To: <8C53AAFA2050EE40BDCDB9455DA7D63401A01068@sw720ex020.visa.com>
References: <8C53AAFA2050EE40BDCDB9455DA7D63401A01068@sw720ex020.visa.com>
Message-ID: <0CDA626B-6E4E-11D9-8FAE-000393CA53DC@skri.org>

In my experience there needs to be an explicit call to load the module 
somewhere with reference to the location of the module file.  Check the 
files that are included by httpd.conf.  One of them might be loading 
the old module from somewhere else.

--S.

On Jan 24, 2005, at 13:06, Feghhi, Jalil wrote:

>
> Yes. I checked and the mod_python.so file under /etc/httpd/modules had 
> a
> new timestamp. I am not at my RH box now but I will double check to 
> make
> sure. Anything else I need to do? Are there any env. vars used by
> Apache? I couldn't find any.
>
> Also, I noticed mod_python.so is picked up by Apache automatically and 
> I
> don't need to load it explicitly in httpd.conf. When I do it 
> explicitly,
> there is a warning that the module is already loaded and will be
> skipped. I am not sure if this has anything to do with it though.
>
> Thanks,
>
> -Jalil
>
> -----Original Message-----
> From: Simon Kesenci [mailto:god@skri.org]
> Sent: Monday, January 24, 2005 9:33 AM
> To: Feghhi, Jalil
> Cc: mod_python@modpython.org
> Subject: Re: [mod_python] Integration Issue
>
> Did you move the new mod_python.so into the apache module directory?
>
> --S.
>
> On Jan 24, 2005, at 08:08, Feghhi, Jalil wrote:
>
>>
>> I compiled and installed Python 2.4 under Redhat in /usr/local/bin and
>
>> /usr/local/lib (default locations). I then compiled mod_python using
>> Python 2.4 (I could see it picking up the right version when
>> compiling).
>> However, when run under Apache, it seems it still picks up the older
>> version of Python libraries from /usr/lib. How can I make Apache (or
>> mod_python under Apache) use the new version?
>>
>> Thanks,
>>
>> -JF
>>
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>
>

From grahamd at dscpl.com.au  Mon Jan 24 16:45:38 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon Jan 24 16:46:10 2005
Subject: [mod_python] psp_site example doesn't work
Message-ID: <1106603138.16901@dscpl.user.openhosting.com>

Jorey Bump wrote ..
> There is no mechanism in Python to import a module by file path, so it's
> consistent, but confusing. The alternative would have been to force a 
> working directory onto the user, much like a cgi-bin, and prepend that
> to sys.path.

That "there is no mechanism in Python to import a module by file path"
isn't strictly true. There are actually a couple of ways of achieving it.

The import_module() method in order to work first has to find the actual
module. This is done using imp.find_module:

  f, p, d = imp.find_module(parts[i], path)

If path is None, the sys.path is searched for the module. If one sets path
explicitly, one can control exactly where a module is picked up.

This is in part how publisher works now, in that it passes a path argument
to the import_module() method to be the actual place where the module is
located so it only looks there.

The other way of loading a module from a specific path is using execfile()
to execute code in the context of a module created with imp.new_module().
This module will not though appear in sys.modules however, although not
sure why anyone might rely on this in the context of mod_python.

Now if you mean't specifically that one can't use the "import" statement to
import a module by path, then you are true.

Thus, import_module() already provides the means of picking a module
from the correct location, the problem is how it names modules and how
they get installed into sys.module and managed after that is the problem.

Graham

From list at joreybump.com  Mon Jan 24 16:53:56 2005
From: list at joreybump.com (Jorey Bump)
Date: Mon Jan 24 16:54:04 2005
Subject: [mod_python] psp_site example doesn't work
In-Reply-To: <1106603138.16901@dscpl.user.openhosting.com>
References: <1106603138.16901@dscpl.user.openhosting.com>
Message-ID: <41F56E74.8010306@joreybump.com>

Graham Dumpleton wrote:
> Jorey Bump wrote ..
> 
>>There is no mechanism in Python to import a module by file path, so it's
>>consistent, but confusing. The alternative would have been to force a 
>>working directory onto the user, much like a cgi-bin, and prepend that
>>to sys.path.
> 
> That "there is no mechanism in Python to import a module by file path"
> isn't strictly true. There are actually a couple of ways of achieving it.

I realized my poor choice of words as soon as I hit the send button. 
Obviously, it's possible, or you couldn't design your own import 
mechanism...

> Now if you mean't specifically that one can't use the "import" statement to
> import a module by path, then you are true.

That's what I meant. Mea culpa. :P

From grahamd at dscpl.com.au  Mon Jan 24 17:39:30 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon Jan 24 17:40:25 2005
Subject: [mod_python] Catalog of mod_python.publisher problems.
Message-ID: <1106606370.4554@dscpl.user.openhosting.com>

Graham Dumpleton wrote ..
> 
> Do we need to document properly first the perceived problems and some
> examples of errornous behaviour? This will help to ensure we fix
> everything and provide a basis for some tests of any new implementation.
> I know that such information can be noted against the bug tracker item,
> but is it easier to thrash it out here first.

FWIW, here is my personal list of problems in mod_python.publisher that
I know about. Note that I have ignored totally the basic issue that sys.path
makes which module you get unpredictable if import_module() is used
directly. This is just mod_python.publisher problems which should in
themselves be fixable whatever may eventually be done about the
import_module() method. Let me know if you want these put on bug
tracker as one item or three items.


Continual reloading of modules
------------------------------

Create a subdirectory called "publisher". In that directory create a
".htaccess" file containing:

  SetHandler python-program
  PythonHandler mod_python.publisher
  PythonDebug On

Now create two subdirectories "subdir-1" and "subdir-1". In both of these
subdirectories create an "index.py" file which contains:

  import os
  def index():
    return os.getpid(),__file__

Restart Apache to clear any cached modules and then cycle between the URLs
corresponding to the two subdirectories. In my case this is:

  /~grahamd/publisher/subdir-1
  /~grahamd/publisher/subdir-2
  /~grahamd/publisher/subdir-1
  /~grahamd/publisher/subdir-2
  ...

The output for each page was in turn:

  (462, '/Users/grahamd/Sites/publisher/subdir-1/index.py')
  (462, '/Users/grahamd/Sites/publisher/subdir-2/index.py')
  (462, '/Users/grahamd/Sites/publisher/subdir-1/index.pyc')
  (462, '/Users/grahamd/Sites/publisher/subdir-2/index.pyc')
  ...

If you look at the Apache error log file you will see something like:

  [Tue Jan 25 09:03:45 2005] [notice] mod_python: Creating 32 session mutexes
  based on 4 max processes and 25 max threads.
  [Tue Jan 25 09:03:45 2005] [notice] Apache/2.0.51 (Unix) mod_python/3.1.3
  Python/2.3 configured -- resuming normal operations

  [Tue Jan 25 09:04:02 2005] [notice] mod_python: (Re)importing module
  'mod_python.publisher'
  [Tue Jan 25 09:04:02 2005] [notice] mod_python: (Re)importing module 'index'
  with path set to '['/Users/grahamd/Sites/publisher/subdir-1']'
  [Tue Jan 25 09:04:16 2005] [notice] mod_python: (Re)importing module 'index'
  with path set to '['/Users/grahamd/Sites/publisher/subdir-2']'
  [Tue Jan 25 09:04:26 2005] [notice] mod_python: (Re)importing module 'index'
  with path set to '['/Users/grahamd/Sites/publisher/subdir-1']'
  [Tue Jan 25 09:04:40 2005] [notice] mod_python: (Re)importing module 'index'
  with path set to '['/Users/grahamd/Sites/publisher/subdir-2']'

You will see how as one cycles between the two URLs corresponding to the
modules, that the modules are reimported everytime.

Note that I ensured that only one Apache server process was initially
started so that all requests served by same process. One can also see this
is the response, which includes the process ID of the server process.

Overall what is returned is correct, but it isn't efficient because each
request is triggering a module import.

Cross contamination of modules
------------------------------

For the above case, change the code in "subdir-1/index.py" to:

  subdir1 = None
  def index():
    return "subdir-1",globals().keys()

and "subdir-2/index.py" to:

  subdir2 = None
  def index():
    return "subdir-2",globals().keys()

Accessing "subdir-1" the result is:

  ('subdir-1', ['index', '__mtime__', '__builtins__',
   '__file__', 'subdir1', '__name__', '__doc__'])

Now accessing "subdir-2" the result is:

  ('subdir-2', ['index', '__mtime__', '__builtins__',
   '__file__', 'subdir2', 'subdir1', '__name__', '__doc__'])

Back to "subdir-1" again:

  ('subdir-1', ['index', '__mtime__', '__builtins__',
   '__file__', 'subdir2', 'subdir1', '__name__', '__doc__'])

Because modules of the same name are reimported on top of the existing
module you can end up with cross contamination of modules in respect of
global variables, functions, class definitions, module imports etc.

The most obvious problem this causes with publisher, is that one can
suddenly have appear in a module a function from a different module. This
function then becomes accessible using an appropriate URL via the module
in which it doesn't belong.

Overall this is annoying and could be problematic for those unaware.

Sticky modules obscuring real module
------------------------------------

Create and "index.py", "subdir-1/index.py" and "subdir-2/index.py" all
containing:

  import os
  def index():
    return os.getpid(),__file__

Now cycle through accessing these in the order:

  index.py
  subdir-1/index.py
  index.py
  subdir-2/index.py
  index.py
  subdir-1/index.py
  index.py
  subdir-2/index.py
  ...

In my case this is:

  /~grahamd/publisher
  /~grahamd/publisher/subdir-1
  /~grahamd/publisher
  /~grahamd/publisher/subdir-2
  /~grahamd/publisher
  /~grahamd/publisher/subdir-1
  /~grahamd/publisher
  /~grahamd/publisher/subdir-2
  /~grahamd/publisher
  ...

The result for this is:

  (521, '/Users/grahamd/Sites/publisher/index.py')
  (521, '/Users/grahamd/Sites/publisher/subdir-1/index.py')
  (521, '/Users/grahamd/Sites/publisher/subdir-1/index.py')
  (521, '/Users/grahamd/Sites/publisher/subdir-2/index.py')
  (521, '/Users/grahamd/Sites/publisher/subdir-2/index.py')
  (521, '/Users/grahamd/Sites/publisher/subdir-1/index.pyc')
  (521, '/Users/grahamd/Sites/publisher/subdir-1/index.pyc')
  (521, '/Users/grahamd/Sites/publisher/subdir-2/index.pyc')
  (521, '/Users/grahamd/Sites/publisher/subdir-2/index.pyc')

One can see that once one of the "index.py" files in the subdirectories is
accessed, they become sticky and the latest one accessed from a subdirectory
is returned instead of the top level one when it is accessed.

This one has got to be a bug.

--
Graham Dumpleton (grahamd@dscpl.com.au)

From grahamd at dscpl.com.au  Mon Jan 24 18:06:11 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon Jan 24 18:06:16 2005
Subject: [mod_python] module import
Message-ID: <1106607971.14935@dscpl.user.openhosting.com>

Lionel Roubeyrie wrote ..
> Hi all,
> new in the mod_python's world, I'm starting with a little problem of import.
> The index.py page must import a package in the subdirectory where index.py
> is, 
> then I wrote:
> import os, sys
> current_path = os.getcwd()
> top = os.path.join(current_path, '../')
> if top not in sys.path : sys.path.append(top)
> import my_mod
> 
> mod_python raise an error, but puting the lines in a python shell works!
> Do I have to do anything else?

The value returned by os.getcwd() will be '/' and not the directory in which
the index.py resides. It is also not a good idea to be modifying sys.path
the way you are.

One option is to use the PythonPath directive to add additional directories
to search for Python modules and then just use "import" without any of
the other stuff.

You don't say whether you are using mod_python.publisher or whether
your index.py is listed as PythonHandler directly, which makes it a bit harder
to guess behaviour, but in various cases the directory in which the content
handler resides will be listed in sys.path anyway.

One final alternative to modifying PythonPath is to use:

  import os
  from mod_python import apache

  directory = os.path.dirname(__file__)
  my_mod = apache.import_module("my_mod",path=[directory])

At least I think that will work. :-)

Graham
From list at joreybump.com  Mon Jan 24 19:39:06 2005
From: list at joreybump.com (Jorey Bump)
Date: Mon Jan 24 19:39:16 2005
Subject: [mod_python] psp_site example doesn't work
In-Reply-To: <41F54D35.8020107@joreybump.com>
References: <1106523523.15703@dscpl.user.openhosting.com>		<c298f2d7050123230939196a6@mail.gmail.com>		<41F50248.1020703@joreybump.com>		<c298f2d705012407284ef8ab40@mail.gmail.com>	<c298f2d705012407307d37cb3c@mail.gmail.com>
	<41F54D35.8020107@joreybump.com>
Message-ID: <41F5952A.9070202@joreybump.com>

Jorey Bump wrote:

> The main effect is that the DocumentRoot might get prepended to sys.path 
> instead of the directory containing the published module. But a single 
> interpreter must have a single working directory, so I consider this an 
> elegant solution.
> 
> If you modify the path with the PythonPath directive, this will no 
> longer be the case. The DocumentRoot is not prepended to the path and 
> you will be limited to the directories explicitly listed in PythonPath. 
> This can lead to surprising behaviour if you created some modules and 
> packages in the DocumentRoot, because they will no longer work properly.

I should stress here that I used DocumentRoot as an example, and it is 
in no way the default path that gets prepended to sys.path. The 
Directory in which the interpreter is defined is the path that gets 
prepended to sys.path.

So, if your DocumentRoot is /var/www, it would get prepended to sys.path 
in the following configuration:

<Directory /var/www>
   AddHandler python-program .py
   PythonHandler mod_python.publisher
   PythonDebug On
</Directory>

But if you start the interpreter in a subdirectory, such as /var/www/py, 
it would be prepended to sys.path:

<Directory /var/www/py>
   AddHandler python-program .py
   PythonHandler mod_python.publisher
   PythonDebug On
</Directory>

Finally, remember that declaring a path explicitly with PythonPath 
overrides this behaviour.





From eddielee at tropicsoft.com  Mon Jan 24 20:02:27 2005
From: eddielee at tropicsoft.com (Eddie Diener)
Date: Mon Jan 24 20:03:32 2005
Subject: [mod_python] Installing mod_python for Python 2.4
Message-ID: <007801c50279$8a29a2d0$02fea8c0@eldiener>

I have Python 2.3 and Python 2.4 on my machine. If I install mod_python it always finds the 2.3 directory and attempts to install there, nor is there any way to change it. Is there any way to install mod_python so that it integrates with Python 2.4 ? If not are there any plans for a version of mod_python for Python 2.4 ?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050124/56601062/attachment.html
From grahamd at dscpl.com.au  Mon Jan 24 20:11:51 2005
From: grahamd at dscpl.com.au (grahamd@dscpl.com.au)
Date: Mon Jan 24 20:11:59 2005
Subject: [mod_python] psp_site example doesn't work
Message-ID: <1106615511.26901@dscpl.user.openhosting.com>

Jorey Bump wrote ..
> But if you start the interpreter in a subdirectory, such as /var/www/py,
> it would be prepended to sys.path:
> 
> <Directory /var/www/py>
>    AddHandler python-program .py
>    PythonHandler mod_python.publisher
>    PythonDebug On
> </Directory>
> 
> Finally, remember that declaring a path explicitly with PythonPath 
> overrides this behaviour.

FWIW, I recommend with Vampire that people set:

  PythonPath 'sys.path'

This has the effect of avoiding sys.path being extended with paths
in your document tree.

The idea then is one supplies an explicit directory to look in for
your application modules to an import function such as the
apache.import_module() function or that supplied with Vampire.
For standard Python modules installed with Python, one continues
to use the "import" statement.

This avoids all the sys.path unpredictability as it nevers gets
changed and is only consulted for standard Python modules.

Graham
From list at joreybump.com  Mon Jan 24 23:29:39 2005
From: list at joreybump.com (Jorey Bump)
Date: Mon Jan 24 23:29:48 2005
Subject: [mod_python] Catalog of mod_python.publisher problems.
In-Reply-To: <1106606370.4554@dscpl.user.openhosting.com>
References: <1106606370.4554@dscpl.user.openhosting.com>
Message-ID: <41F5CB33.8020100@joreybump.com>

Graham Dumpleton wrote:
> Graham Dumpleton wrote ..
> 
>>Do we need to document properly first the perceived problems and some
>>examples of errornous behaviour? This will help to ensure we fix
>>everything and provide a basis for some tests of any new implementation.

Good idea. A battery of tests helps to demonstrate what is really 
happening. Thanks for the examples.

> Continual reloading of modules
> ------------------------------
>   [Tue Jan 25 09:04:40 2005] [notice] mod_python: (Re)importing module 'index'
>   with path set to '['/Users/grahamd/Sites/publisher/subdir-2']'
> 
> You will see how as one cycles between the two URLs corresponding to the
> modules, that the modules are reimported everytime.
> 
> Overall what is returned is correct, but it isn't efficient because each
> request is triggering a module import.

Isn't this consistent with published modules requiring unique names? The 
important thing is that the os module is not being reimported. As you 
say, it's correct, and should be emphasized in the documentation, but 
not necessarily "fixed".

> Cross contamination of modules
> ------------------------------
> Because modules of the same name are reimported on top of the existing
> module you can end up with cross contamination of modules in respect of
> global variables, functions, class definitions, module imports etc.
> 
> The most obvious problem this causes with publisher, is that one can
> suddenly have appear in a module a function from a different module. This
> function then becomes accessible using an appropriate URL via the module
> in which it doesn't belong.
> 
> Overall this is annoying and could be problematic for those unaware.

Once again, stress this limitation in the docs: Don't reuse published 
module names.

> Sticky modules obscuring real module
> ------------------------------------
> 
> Create and "index.py", "subdir-1/index.py" and "subdir-2/index.py" all
> containing:
> 
>   import os
>   def index():
>     return os.getpid(),__file__
> 
> Now cycle through accessing these in the order:
> 
>   index.py
>   subdir-1/index.py
>   index.py
>   subdir-2/index.py
>   index.py
>   subdir-1/index.py
>   index.py
>   subdir-2/index.py
>   ...
> 
> In my case this is:
> 
>   /~grahamd/publisher
>   /~grahamd/publisher/subdir-1
>   /~grahamd/publisher
>   /~grahamd/publisher/subdir-2
>   /~grahamd/publisher
>   /~grahamd/publisher/subdir-1
>   /~grahamd/publisher
>   /~grahamd/publisher/subdir-2
>   /~grahamd/publisher
>   ...
> 
> The result for this is:
> 
>   (521, '/Users/grahamd/Sites/publisher/index.py')
>   (521, '/Users/grahamd/Sites/publisher/subdir-1/index.py')
>   (521, '/Users/grahamd/Sites/publisher/subdir-1/index.py')
>   (521, '/Users/grahamd/Sites/publisher/subdir-2/index.py')
>   (521, '/Users/grahamd/Sites/publisher/subdir-2/index.py')
>   (521, '/Users/grahamd/Sites/publisher/subdir-1/index.pyc')
>   (521, '/Users/grahamd/Sites/publisher/subdir-1/index.pyc')
>   (521, '/Users/grahamd/Sites/publisher/subdir-2/index.pyc')
>   (521, '/Users/grahamd/Sites/publisher/subdir-2/index.pyc')
> 
> One can see that once one of the "index.py" files in the subdirectories is
> accessed, they become sticky and the latest one accessed from a subdirectory
> is returned instead of the top level one when it is accessed.
> 
> This one has got to be a bug.

Hmmm, yet there is a pattern. I wonder if there is some method to this 
madness.

In any case, all of your examples reuse published module names, which 
shouldn't be done in Publisher. When you abandon that practice, what 
bugs are actually left?

Here's something that misled me a few months ago (with apologies to 
Nicolas):

Create 2 modules, in the same directory, named master.py and slave.py:

master.py:

  import slave

  def hello(req):
      return slave.hello

slave.py:

  hello = "Hello, world!"

Access http://host/master/hello and "Hello, world!" appears in the 
browser. Now move the files into a subdirectory and access 
http://host/subdir/master/hello. It throws up an error:

  ImportError: No module named slave

What happened? It originally appeared as though a module could import 
adjacent modules, but this failed in a subdirectory. The reason is that 
the original directory was where the interpreter was defined (with no 
PythonPath), and so was prepended to the module search path. It doesn't 
matter where master.py is (as long as it accessible by the defined 
interpreter), but slave.py  must be in sys.path if it is to be imported 
by a published module.

This falls under the "perceived problem" category, in that it's not a 
bug, but sure looks like one at first. My own practice for coping with 
this is to set a PythonPath directive, appending a directory outside the 
DocumentRoot from which I can reliably import modules and packages 
specific to that interpreter or VirtualHost.


From grahamd at dscpl.com.au  Tue Jan 25 00:14:42 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Jan 25 00:15:17 2005
Subject: [mod_python] Catalog of mod_python.publisher problems.
Message-ID: <1106630082.17602@dscpl.user.openhosting.com>

Jorey Bump wrote ..
> Create 2 modules, in the same directory, named master.py and slave.py:
> 
> master.py:
> 
>   import slave
> 
>   def hello(req):
>       return slave.hello
> 
> slave.py:
> 
>   hello = "Hello, world!"
> 
> Access http://host/master/hello and "Hello, world!" appears in the 
> browser. Now move the files into a subdirectory and access 
> http://host/subdir/master/hello. It throws up an error:
> 
>   ImportError: No module named slave
> 
> What happened? It originally appeared as though a module could import 
> adjacent modules, but this failed in a subdirectory. The reason is that
> the original directory was where the interpreter was defined (with no 
> PythonPath), and so was prepended to the module search path. It doesn't
> matter where master.py is (as long as it accessible by the defined 
> interpreter), but slave.py  must be in sys.path if it is to be imported
> by a published module.
> 
> This falls under the "perceived problem" category, in that it's not a 
> bug, but sure looks like one at first. My own practice for coping with
> this is to set a PythonPath directive, appending a directory outside the
> DocumentRoot from which I can reliably import modules and packages 
> specific to that interpreter or VirtualHost.

As I gave as response to a recent question, this is possibly better solved
by writing:

  import os
  from mod_python import apache
  directory = os.path.dirname(__file__)

  slave = apache.import_module("slave",[directory])
 
  def hello(req):
      return slave.hello

Everyone has their own personal opinions on how best to use mod_python.
As to my own two cents worth, although mod_python uses Python, the
environment which it is running under isn't like running Python from the
command line. One is using it in the context of a web server and what
people tend to expect in doing stuff with web servers is that they can use
the same resource name in different locations of the URL namespace.

Because people are using mod_python/Python specifically to build web
applications, I believe that this expectation about using the same
resource names in multiple places is an overriding factor and any design
should accomodate this practice.

Thus, I would suggest that best practice would be:

1. Only use the "import" statement to import modules which have been
provided with Python, are installed into the "site-packages" directory
or are clearly seperated out into a directory distinct from the document
hierarchy. In this later case PythonPath should be used to denote where
that directory is.

2. That sys.path should not ever include any directory which is a part of
the document hierarchy. Unfortunately the way handlers are setup this
is done by default. This can be avoided though by setting PythonPath
explicity at the same point PythonHandler is defined. If PythonPath isn't
being defined anyway to add in extra external directories containing
application specific modules, then PythonPath should be set to "sys.path"
to ensure the document directory isn't added.

3. Always use apache.import_module() to import relative code files which
are contained within the document hierarchy. Because of (2) above, one
wouldn't be able to rely on sys.path though, so one should calculate the
exact directory that a code files resides in. This can be done by using
__file__ as described above. The directory would then be supplied to the
import module method to ensure that only that directory is searched.

In other words, a clear distinction is drawn. If it is outside the document
hierarchy, then "import" must be used with sys.path defining the search
path. Because "import" is used, modules outside of document hierarchy
must be uniquely named.

Inside the document heirarchy always use import_module() and always
define the exact directory you want something loaded from. Within the
document hierarchy, rather than calling them modules, they should be
seen as code files and duplicates should be allowed in different
directories.

All that now would need to be done is to fix import_module() so that it
copes properly with loading from the document hierarchy code files
with the same name in different directories. This isn't actually that hard
to do, but at the moment we seemed to be bogged down in arguing
about whether it is right or not.

Graham
From grahamd at dscpl.com.au  Tue Jan 25 01:46:07 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Jan 25 01:46:08 2005
Subject: [mod_python] Catalog of mod_python.publisher problems.
Message-ID: <1106635567.19792@dscpl.user.openhosting.com>

Graham Dumpleton wrote ..
> Graham Dumpleton wrote ..
> > 
> > Do we need to document properly first the perceived problems and some
> > examples of errornous behaviour? This will help to ensure we fix
> > everything and provide a basis for some tests of any new implementation.
> > I know that such information can be noted against the bug tracker item,
> > but is it easier to thrash it out here first.
> 
> FWIW, here is my personal list of problems in mod_python.publisher that
> I know about. Note that I have ignored totally the basic issue that sys.path
> makes which module you get unpredictable if import_module() is used
> directly. This is just mod_python.publisher problems which should in
> themselves be fixable whatever may eventually be done about the
> import_module() method. Let me know if you want these put on bug
> tracker as one item or three items.

Here is a fourth problem I have remembered. Although am sure that some
will say that this is expected as well. ;-(

ImportError: cannot import name publisher
------------------------------------

In a directory publisher, setup for mod_python.publisher as described in
previous email, and with same index.py. Ie.,

  import os
  def index():
    return os.getpid(),__file__

Now create a parallel directory called "handler" and in its .htaccess file add:

  SetHandler python-program
  PythonHandler mptest
  PythonDebug On

The mptest.py file in that directory should read:

  from mod_python import apache
  import os

  from mod_python import publisher

  def handler(req):
    req.content_type = "text/plain"
    req.send_http_header()
    req.write(str((os.getpid(),__file__)))
    return apache.OK

Restart Apache to clear caches and access "handler" and "publisher"
directories in that order. One gets:

  (747, '/Users/grahamd/Sites/handler/mptest.py')
  (747, '/Users/grahamd/Sites/publisher/index.py')
  (747, '/Users/grahamd/Sites/handler/mptest.py')
  (747, '/Users/grahamd/Sites/publisher/index.py')
  
Okay, everything is fine.

Now restart Apache to clear caches and access "publisher" and then
"handler". Ie., in reverse order. One gets:

  (761, '/Users/grahamd/Sites/publisher/index.py')

  Mod_python error: "PythonHandler mptest"

  Traceback (most recent call last):

    File "/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site-packages/mod_python/apache.py", line 296, in HandlerDispatch
      log=debug)

    File "/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site-packages/mod_python/apache.py", line 421, in import_module
      autoreload=autoreload,log=log,path=path)

    File "/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site-packages/mod_python/apache.py", line 474, in _unsafe_import_module
      module = imp.load_module(mname, f, p, d)

    File "/Users/grahamd/Sites/handler/mptest.py", line 4, in ?
      from mod_python import publisher

  ImportError: cannot import name publisher

The way in which mod_python.publisher is loaded as PythonHandler,
if done before being imported explicitly using "import", screws up
that latter import.

I know some will scream that I am mixing "import" and "import_module()",
but since mod_python.publisher is installed into "site-packages", one
should expect it to work with "import". Whether it does is order dependent.

Because I use mod_python.publisher in Vampire for its user authentication
stuff, this problem means that if using Vampire and elsewhere also wanting
to use mod_python.publisher as PythonHandler, that the Vampire area
should be setup with its own PythonInterpreter instance.

Having now remembered this problem, as a workaround in Vampire I
should probably go and use:

  publisher = apache.import_module("mod_python.publisher")

instead. At least that way it will work all the time. :-)

I know my wanting to use internals of mod_python.publisher is the
exception, but these sort of strange things shouldn't by right happen.

Graham




From nicolas.lehuen at gmail.com  Tue Jan 25 02:10:24 2005
From: nicolas.lehuen at gmail.com (Nicolas Lehuen)
Date: Tue Jan 25 02:10:26 2005
Subject: [mod_python] psp_site example doesn't work
In-Reply-To: <41F55AB7.5050906@joreybump.com>
References: <1106523523.15703@dscpl.user.openhosting.com>
	<c298f2d7050123230939196a6@mail.gmail.com>
	<41F50248.1020703@joreybump.com>
	<c298f2d705012407284ef8ab40@mail.gmail.com>
	<c298f2d705012407307d37cb3c@mail.gmail.com>
	<16885.11826.768433.372438@greenmonster.local>
	<c298f2d705012411582debaa2a@mail.gmail.com>
	<41F55AB7.5050906@joreybump.com>
Message-ID: <c298f2d7050124231055df243d@mail.gmail.com>

On Mon, 24 Jan 2005 15:29:43 -0500, Jorey Bump <list@joreybump.com> wrote:
> Nicolas Lehuen wrote:
> 
> > - some objects from the published modules are accessible through HTTP.
> > This means that those modules are potentially subject to security
> > problems. In mod_python.publisher, a non-callable object is simply
> > transformed into a string and returned to the HTTP client. It's not a
> > good idea, therefore, to have a variable named
> > MY_VERY_SECRET_PRIVATE_KEY in the module... It's not even a good idea
> > to import it ! Granted, some other publishers may secure what is
> > accessible through HTTP and what is not (mine does), but anyway, it's
> > a good idea to distinguish between published modules and the others.
> 
> That's disconcerting. Can you provide a sample showing how such a
> variable would be exposed?

Here is the test I did yesterday to check my assertion :

## index.py
import mod_python, sys, time

SECRET = "Hello, world !"

def index(req):
    req.content_type='text/html'
    return """<html><head><title>mod_python.publisher info</title></head><body>
    <p>mod_python.publisher runs !</p>
    <p>Now: %s</p>
    <p>Python version : <code>%s</code></p>
    <p>Python path : <code>%s</code></p>
    <p><a href="pspinfo.psp">mode_python.psp info</a></p>
</body></html>""" % (time.ctime(),sys.version,sys.path)

If you call http://localhost/index.py , you get an information page.
If you call http://localhost/index.py/SECRET, then you get the
supposedly super secret variable, direclty displayed in your browser.

( BTW, I think we should provide a built-in test handler that would
reside in the PYTHONPATH like the mod_python.* modules. This way,
users would be able to test the basic mod_python installation without
having problems with the mptest.py business. )
 
> > - I personnaly think it's a good thing for published modules not to be
> > compiled into a .pyc or .pyo file. Like for the previous point, my
> > concern is about security : .pyc and .pyo file should not be
> > accessible through HTTP, lest you want your code be dissassembled and
> > your private key exposed. A simple .htaccess directive can solve this,
> > but what about the zillion people who will forget about it ?
> 
> Ouch! I wasn't aware of this! Is this all that's necessary?
> 
> <FilesMatch "\.(pyc|pyo)$">
>      Order allow,deny
>      Deny from all
> </FilesMatch>

Yes, though I'd rather write "\.py[co]$" (it should be slightly more
efficient, performance-wise).
 
> Will that also cause the compiled versions not to be used by mod_python?

No. The import mechanism of mod_python and the authorization mechanism
of Apache are totally orthogonal.
From nicolas.lehuen at gmail.com  Tue Jan 25 02:31:32 2005
From: nicolas.lehuen at gmail.com (Nicolas Lehuen)
Date: Tue Jan 25 02:31:33 2005
Subject: [mod_python] psp_site example doesn't work
In-Reply-To: <41F552E7.4000805@joreybump.com>
References: <1106523523.15703@dscpl.user.openhosting.com>
	<c298f2d7050123230939196a6@mail.gmail.com>
	<41F50248.1020703@joreybump.com>
	<c298f2d705012407284ef8ab40@mail.gmail.com>
	<c298f2d705012407307d37cb3c@mail.gmail.com>
	<16885.11826.768433.372438@greenmonster.local>
	<41F552E7.4000805@joreybump.com>
Message-ID: <c298f2d7050124233180554d0@mail.gmail.com>

On Mon, 24 Jan 2005 14:56:23 -0500, Jorey Bump <list@joreybump.com> wrote:
> Daniel Popowich wrote:
> 
> > Thank you Jorey for your detailed email, but I have to disagree with
> > you when you wrote:
> >
> >     This is consistent with normal Python behaviour, where an
> >     interpreter loads modules from the current directory or
> >     PYTHONPATH. [1]
> >
> > I came to mod_python after *many* years of intensive python
> > programming and as a newbie to mod_python was caught by this issue for
> > days.  The way mod_python imports files all at the same root level is
> > very UN-pythonic.
> 
> Yes, I'll concede that. But, mod_python.publisher must remove leading
> path information when the published modules are imported, otherwise
> Python wouldn't import them (unless they happen to be in sys.path). It's
> important to understand that the module in the URL is being imported by
> another module, not run directly by the interpreter, as when you type
> "python app.py" on the command line. It took a while for this to sink in
> completely, myself.
> 
> There is no mechanism in Python to import a module by file path, so it's
> consistent, but confusing. The alternative would have been to force a
> working directory onto the user, much like a cgi-bin, and prepend that
> to sys.path.

Jorey,

A lot of the problem caused by import_module() and the
mod_python.publisher come from two very simple mistakes :

1) it is not necessary IMHO to have published moduled imported in the
same namespace than other 'standard' modules.

2) Using the 'import' keyword or the 'imp' modules are not the only
ways to import modules. Like you wrote, import and imp use a dotted
naming scheme for the modules, and have a rather complicated search
path algorithm. This is NOT what should be used to import published
modules whose place in the filesystem follows a publication scheme
instead of a modularization scheme.

The daily message from a new puzzled user should remind us that
publishing a module is NOT the same thing as importing it in standard
Python parlance. mpservlets, Vampire and other publishers have shown
that it's quite easy to import modules without using import or imp.
Separating published modules from standard modules should be done
ASAP, and I think everybody will save mental health when it will be
done ;).

Another proof that mixing published and standard module is a bad
design choice is that you end up putting constraints (through the path
parameter in import_module) to make sure that only modules from the
published filesystem are published. This is inefficient at best. Have
a look at what CherryPy does, for example : function and object which
can be published are just marked as such. Anything else can't be
published. There's no need to worry about path restrictions and so on
and so forth.

I'm sorry to be a little harsh on the subject, but for now, I think
mod_python is far from being an user-friendly web development
environment. For power users who can wrap their head around the
various bugs^H^H^H^Hfeatures, it's perfect, but judging from the
volumes of "Can't make mptest.py to run" or "Can't import yada_yada
module from index.py" messages, there's still a lot of things to cope
with to get a bigger user base. I definitely think the import
mechanism and mod_python.publisher need urgent and radical
improvements.

Regards,
Nicolas
From isofroni at cc.uoi.gr  Tue Jan 25 04:22:10 2005
From: isofroni at cc.uoi.gr (John)
Date: Tue Jan 25 04:23:55 2005
Subject: [mod_python] mod_python in safe_mode
Message-ID: <005d01c502bf$5c741e10$747882c3@jonsof>

I want to enable my users executing their python scripts but i am wondering if this can be done
in safe_mode (like php)

Thanks in advance.

John
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050125/0c1e02c6/attachment.html
From lroubeyrie at limair.asso.fr  Tue Jan 25 04:48:42 2005
From: lroubeyrie at limair.asso.fr (Lionel Roubeyrie)
Date: Tue Jan 25 04:49:50 2005
Subject: [mod_python] is not a file?
Message-ID: <200501251048.42562.lroubeyrie@limair.asso.fr>

Hi all,
I don't understand why I have this error:
################################
Mod_python error: "PythonHandler mod_python.psp"
Traceback (most recent call last):
  File "/usr/lib/python2.3/site-packages/mod_python/apache.py", line 299, in 
HandlerDispatch
    result = object(req)
  File "/usr/lib/python2.3/site-packages/mod_python/psp.py", line 296, in 
handler
    p = PSP(req)
  File "/usr/lib/python2.3/site-packages/mod_python/psp.py", line 111, in 
__init__
    self.load_from_file()
  File "/usr/lib/python2.3/site-packages/mod_python/psp.py", line 162, in 
load_from_file
    raise ValueError, "%s is not a file" % filename
ValueError: /home/lionel/Developpement/PREVAIR_LIMAIR/CARTAIR/mod_web/maxh1h.psp 
is not a file
################################
The file is :
################################
<%
TITLE='CARTAIR'
if form.has_key('date_calcul'):
   tutu=form['date_calcul']
else:
   tutu=''
# end
%>
<html>
<head>
        <title> <%=TITLE%> </title>
        <link rel="STYLESHEET" type="text/css" href="static/miseenpage.css">
</head>
<body>
    <%=tutu%>
    <div align="center">
        <form action='maxh1h.psp' method='POST'>
            <table width=80%>
                <tr>
                    <td>Date de calcul:    <input type='text' 
name='date_calcul' value=%s><br></td>
                </tr>
                <tr>
                    <td>Date de Pr?vision:   <input type='text' 
name='date_prevu' value=%s><br></td>
                </tr>
                <tr>
                    <td><input type='submit' value="Afficher"></td>
                </tr>
            </table>
        </form>
    </div>
</body>
</html>
################################
If I call this page from another psp page, it's ok, but not if I press the 
submit button or if I call direectly the page from the browser.
In the Apache2 config:
################################
<Directory /home/lionel/Developpement/PREVAIR_LIMAIR/CARTAIR/mod_web>
        Order allow,deny
        Allow from all
        Options Indexes Includes FollowSymLinks MultiViews
        AddHandler mod_python .psp
        PythonHandler mod_python.psp
        PythonDebug On
</Directory>
################################

What's wrong?
-- 
Lionel Roubeyrie - lroubeyrie@limair.asso.fr
LIMAIR
http://www.limair.asso.fr


From jon.mercer at achean.com  Tue Jan 25 04:55:35 2005
From: jon.mercer at achean.com (Jon Mercer)
Date: Tue Jan 25 04:55:41 2005
Subject: [mod_python] is not a file?
In-Reply-To: <200501251048.42562.lroubeyrie@limair.asso.fr>
References: <200501251048.42562.lroubeyrie@limair.asso.fr>
Message-ID: <37923.217.33.199.34.1106646935.squirrel@217.33.199.34>

Hi all,

Not sure this is the formal fix to manage this, I'm a bit of a newbie
here, but having had the same problem I've found the solution was as below
in the Apache config section.

As a further question in this thread, what is the proper way/best practice
to be mixing directories with different methods of calling mod_python? Can
the same directory handle the publisher as well as psp and custom
mechanisms?

Jon

On Tue, January 25, 2005 9:48, Lionel Roubeyrie said:
> Hi all,
> I don't understand why I have this error:
> ################################
> Mod_python error: "PythonHandler mod_python.psp"
> Traceback (most recent call last):
>   File "/usr/lib/python2.3/site-packages/mod_python/apache.py", line 299,
> in
> HandlerDispatch
>     result = object(req)
>   File "/usr/lib/python2.3/site-packages/mod_python/psp.py", line 296, in
> handler
>     p = PSP(req)
>   File "/usr/lib/python2.3/site-packages/mod_python/psp.py", line 111, in
> __init__
>     self.load_from_file()
>   File "/usr/lib/python2.3/site-packages/mod_python/psp.py", line 162, in
> load_from_file
>     raise ValueError, "%s is not a file" % filename
> ValueError:
> /home/lionel/Developpement/PREVAIR_LIMAIR/CARTAIR/mod_web/maxh1h.psp
> is not a file
> ################################
> The file is :
> ################################
> <%
> TITLE='CARTAIR'
> if form.has_key('date_calcul'):
>    tutu=form['date_calcul']
> else:
>    tutu=''
> # end
> %>
> <html>
> <head>
>         <title> <%=TITLE%> </title>
>         <link rel="STYLESHEET" type="text/css"
> href="static/miseenpage.css">
> </head>
> <body>
>     <%=tutu%>
>     <div align="center">
>         <form action='maxh1h.psp' method='POST'>
>             <table width=80%>
>                 <tr>
>                     <td>Date de calcul:    <input type='text'
> name='date_calcul' value=%s><br></td>
>                 </tr>
>                 <tr>
>                     <td>Date de Pr?vision:   <input type='text'
> name='date_prevu' value=%s><br></td>
>                 </tr>
>                 <tr>
>                     <td><input type='submit' value="Afficher"></td>
>                 </tr>
>             </table>
>         </form>
>     </div>
> </body>
> </html>
> ################################
> If I call this page from another psp page, it's ok, but not if I press the
> submit button or if I call direectly the page from the browser.
> In the Apache2 config:
> ################################
> <Directory /home/lionel/Developpement/PREVAIR_LIMAIR/CARTAIR/mod_web>
>         Order allow,deny
>         Allow from all
>         Options Indexes Includes FollowSymLinks MultiViews

The following line should read:
          SetHandler mod_python


>         AddHandler mod_python .psp
>         PythonHandler mod_python.psp
>         PythonDebug On
> </Directory>
> ################################
>
> What's wrong?
> --
> Lionel Roubeyrie - lroubeyrie@limair.asso.fr
> LIMAIR
> http://www.limair.asso.fr
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>


-----------------------------------------------------------------------
Achean Ltd                                        http://www.achean.com
Jon Mercer              jon.mercer@achean.com                  Director
-----------------------------------------------------------------------
From grahamd at dscpl.com.au  Tue Jan 25 05:25:51 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Jan 25 05:27:07 2005
Subject: [mod_python] is not a file?
In-Reply-To: <37923.217.33.199.34.1106646935.squirrel@217.33.199.34>
References: <200501251048.42562.lroubeyrie@limair.asso.fr>
	<37923.217.33.199.34.1106646935.squirrel@217.33.199.34>
Message-ID: <7CCD39BE-6EBB-11D9-993F-000393DCF16E@dscpl.com.au>


On 25/01/2005, at 8:55 PM, Jon Mercer wrote:
>
> As a further question in this thread, what is the proper way/best 
> practice
> to be mixing directories with different methods of calling mod_python? 
> Can
> the same directory handle the publisher as well as psp and custom
> mechanisms?

Using just mod_python, one can only really achieve this mixing by 
assigning
different extension types in URLs to the different implementation 
mechanisms.

   AddHandler mod_python.psp .psp
   AddHandler mod_python.mpservlets .mps
   AddHandler mod_python.publisher .py
   AddHandler mycustommechanism .mypy

I personally don't like this approach as it exposes implementation 
details
and looks plain messy having all these different extensions.

As an alternative therefore, you might have a look at Vampire.

   http://www.dscpl.com.au/projects/vampire

Vampire takes the approach of exposing resources based on the type of 
content
being returned, rather than implementation mechanism. It allows one to 
use
a .html extension (for example), but where the implementation could be 
PSP,
mpservlets or a customer handler. The only thing it doesn't have is a 
way of
mixing with mod_python.publisher, but then the mechanism is has for 
custom
handlers is probably preferred over the magic of mod_python.publisher 
as it
is less problematic.

Anyway, if interested, check out the web site.

Graham

From lroubeyrie at limair.asso.fr  Tue Jan 25 08:13:49 2005
From: lroubeyrie at limair.asso.fr (Lionel Roubeyrie)
Date: Tue Jan 25 08:14:57 2005
Subject: [mod_python] publisher
Message-ID: <200501251413.49253.lroubeyrie@limair.asso.fr>

Hi again :-)
PSP is great but for my app publisher is better, then I put this in hhtp.conf:
####################################
<Directory /home/lionel/Developpement/PREVAIR_LIMAIR/CARTAIR/mod_web_publisher>
        Order allow,deny
        Allow from all
        Options Indexes Includes FollowSymLinks MultiViews
        SetHandler mod_python
        PythonHandler mod_python.publisher
        PythonDebug On
</Directory>
####################################
and in a file:
####################################
def index(req, date_calcul='0', date_prevu='0'):
    if date_calcul=='0': test=''
    else: test='ok'
    page= '''
        <html>
        <head>
                <link rel='STYLESHEET' type='text/css' 
href='static/miseenpage.css'>
        </head>
        <body>
            %s
            <div align='center'>
                <form action='max1h' method='POST'>
                    <table width='80%%'>
                        <tr>
                            <td>Date de calcul:    <input type='text' 
name='date_calcul' value='%s'><br></td>
                        </tr>
                        <tr>
                            <td>Date de Pr?vision:   <input type='text' 
name='date_prevu' value='%s'><br></td>
                        </tr>
                        <tr>
                            <td><input type='submit' value='Afficher'></td>
                        </tr>
                    </table>
                </form>
            </div>
        </body>
        </html>'''%(test, date_calcul,date_prevu)
    return page
####################################
Good, but I loss the stylesheet :-( Why?

-- 
Lionel Roubeyrie - lroubeyrie@limair.asso.fr
LIMAIR
http://www.limair.asso.fr


From bmasters at direcway.com  Tue Jan 25 10:52:42 2005
From: bmasters at direcway.com (Brandon Masterson)
Date: Tue Jan 25 10:53:45 2005
Subject: [mod_python] Apache1.3.33 + Python2.3.4 + mod_python - Can't get
 Python templates to work
Message-ID: <5.1.0.14.0.20050125071338.00bccda8@pop3.direcway.com>

An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050125/9a442f02/attachment.html
From nicolas.lehuen at gmail.com  Tue Jan 25 11:12:54 2005
From: nicolas.lehuen at gmail.com (Nicolas Lehuen)
Date: Tue Jan 25 11:12:56 2005
Subject: [mod_python] Apache1.3.33 + Python2.3.4 + mod_python - Can't get
	Python templates to work
In-Reply-To: <5.1.0.14.0.20050125071338.00bccda8@pop3.direcway.com>
References: <5.1.0.14.0.20050125071338.00bccda8@pop3.direcway.com>
Message-ID: <c298f2d7050125081212b556c2@mail.gmail.com>

I think the problem is the CWD, which is automatically set to / IIRC.
You have to give an absolute path to your template files. The best way
to do this is to use the __file__ variable, which gives you the
absolute path of the current .py file, and navigate from this file
using the os and os.path modules.

Regards,
Nicolas


On Tue, 25 Jan 2005 07:52:42 -0800, Brandon Masterson
<bmasters@direcway.com> wrote:
>  I'm a perl templates user trying to learn Python and templates but I've run
> into a brick wall with the inability to open any of the template files. 
> I've tried Cheetah, Simpletal, and htmltmpl all with the same basic problem
> so I suspect I've got something wrong with either my apache or mod_python
> setup.  The problem is, when I attempt to run the .py files thru the
> browser, the scripts get down to the open command and then can't find the
> template files.  I can run scripts that don't have template accesses just
> fine but attempts to open local directory files causes the errors below.
> Also when I run the scripts calling templates on the command line with the
> interpreter, they work fine.  One other thing I tried was to add the path to
> the template names in the open commands but this resulted in a slightly
> different error (see bottom of this email).
> 
>  For reference this is a Debian machine.  Here's the module versions
> installed:
>  root@Knoppix:/var/www/pythontest# apt-show-versions | sort | egrep
> "apache|python"
>  apache-common/testing uptodate 1.3.33-2
>  apache-utils/testing uptodate 1.3.33-2
>  apache/testing uptodate 1.3.33-2
>  apache2-common/testing uptodate 2.0.52-3
>  apache2-doc/testing uptodate 2.0.52-3
>  apache2-mpm-worker/testing uptodate 2.0.52-3
>  libapache-mod-python/testing uptodate 2:2.7.10-3
>  libapache-mod-python2.3/testing uptodate 2:2.7.10-3
>  libapache-mod-ssl/testing uptodate 2.8.22-1
>  libapache2-svn/testing uptodate 1.1.1-2
>  libboost-python1.31.0/testing uptodate 1.31.0-9
>  python-cheetah/testing uptodate 0.9.15-5
>  python-clearsilver/unstable upgradeable from 0.9.8-3 to 0.9.13-1
>  python-dev/testing uptodate 2.3.4-5
>  python-examples/testing uptodate 2.3.4-5
>  python-mysqldb/testing uptodate 1.1.6-1
>  python-sqlite/testing upgradeable from 1.0-2 to 1.0.1-1
>  python-tk/testing upgradeable from 2.3.4-4 to 2.3.4-5
>  python/testing upgradeable from 2.3.4-4 to 2.3.4-5
>  python2.2-xml/testing upgradeable from 0.8.3-5 to 0.8.4-1
>  python2.2-xmlbase/testing upgradeable from 2.2.3-11 to 2.2.3-12
>  python2.2/testing upgradeable from 2.2.3-11 to 2.2.3-12
>  python2.3-cheetah/testing uptodate 0.9.15-5
>  python2.3-clearsilver/unstable upgradeable from 0.9.8-3 to 0.9.13-1
>  python2.3-dev/testing uptodate 2.3.4-19
>  python2.3-examples/testing upgradeable from 2.3.4-18 to 2.3.4-19
>  python2.3-htmlgen/testing uptodate 2.2.2-10
>  python2.3-htmltmpl/testing uptodate 1.22-5
>  python2.3-mysqldb/testing uptodate 1.1.6-1
>  python2.3-sqlite/testing upgradeable from 1.0-2 to 1.0.1-1
>  python2.3-subversion/testing uptodate 1.1.1-2
>  python2.3-tk/testing uptodate 2.3.4-19
>  python2.3-zopeinterface/testing uptodate 3.0.0-2
>  python2.3/testing uptodate 2.3.4-19
> 
>  Any help would be appreciated.
> 
>  SIMPLETAL ATTEMPT:
>  from simpletal import simpleTAL, simpleTALES
>  import sys
>  import os
>  templateFile = open ("basic.html", 'r')
>  templateFile.close()
> 
>  ERROR:
>  Mod_python error: "PythonHandler mod_python.publisher"
> 
>  Traceback (most recent call last):
> 
>    File "/usr/lib/python2.3/site-packages/mod_python/apache.py", line 193,
> in Dispatch
>      result = object(req)
> 
>    File "/usr/lib/python2.3/site-packages/mod_python/publisher.py", line
> 132, in handler
>      module = apache.import_module(module_name, _req, [path])
> 
>    File "/usr/lib/python2.3/site-packages/mod_python/apache.py", line 335,
> in import_module
>      module = imp.load_module(mname, f, p, d)
> 
>    File "/var/www/pythontest/a.py", line 6, in ?
>      templateFile = open ("basic.html", 'r')
> 
>  IOError: [Errno 2] No such file or directory: 'basic.html'
> 
>  
>  CHEETAH ATTEMPT:
>  from Cheetah.Template import Template
>  templateFileName = 'cheetah.tmpl'
>  t = Template(file=templateFileName, searchList=[{'records':[]},])
> 
>  ERROR:
>  Mod_python error: "PythonHandler mod_python.publisher"
> 
>  Traceback (most recent call last):
> 
>    File "/usr/lib/python2.3/site-packages/mod_python/apache.py", line 193,
> in Dispatch
>      result = object(req)
> 
>    File "/usr/lib/python2.3/site-packages/mod_python/publisher.py", line
> 132, in handler
>      module = apache.import_module(module_name, _req, [path])
> 
>    File "/usr/lib/python2.3/site-packages/mod_python/apache.py", line 335,
> in import_module
>      module = imp.load_module(mname, f, p, d)
> 
>    File "/var/www/pythontest/b.py", line 6, in ?
>      t = Template(file=templateFileName, searchList=[{'records':[]},])
> 
>    File "/usr/lib/python2.3/site-packages/Cheetah/Template.py", line 156, in
> __init__
>      self.compile(source, file)
> 
>    File "/usr/lib/python2.3/site-packages/Cheetah/Template.py", line 235, in
> compile
>      self._fileMtime = os.path.getmtime(file)
> 
>    File "/usr/lib/python2.3/posixpath.py", line 146, in getmtime
>      return os.stat(filename).st_mtime
> 
>  OSError: [Errno 2] No such file or directory: '/cheetah.tmpl'
> 
>  
> 
>  HTMLTMPL ATTEMPT:
>  from htmltmpl import TemplateManager, TemplateProcessor
>  template = TemplateManager().prepare("template.tmpl")
> 
>  ERROR:
>  Mod_python error: "PythonHandler mod_python.publisher"
> 
>  Traceback (most recent call last):
> 
>    File "/usr/lib/python2.3/site-packages/mod_python/apache.py", line 193,
> in Dispatch
>      result = object(req)
> 
>    File "/usr/lib/python2.3/site-packages/mod_python/publisher.py", line
> 132, in handler
>      module = apache.import_module(module_name, _req, [path])
> 
>    File "/usr/lib/python2.3/site-packages/mod_python/apache.py", line 335,
> in import_module
>      module = imp.load_module(mname, f, p, d)
> 
>    File "/var/www/pythontest/c.py", line 2, in ?
>      template = TemplateManager().prepare("template.tmpl")
> 
>    File "/usr/lib/python2.3/site-packages/htmltmpl.py", line 222, in prepare
>      compiled = self.compile(file)
> 
>    File "/usr/lib/python2.3/site-packages/htmltmpl.py", line 296, in compile
>      self._debug).compile(file)
> 
>    File "/usr/lib/python2.3/site-packages/htmltmpl.py", line 988, in compile
>      tokens = self.parse(self.read(file))
> 
>    File "/usr/lib/python2.3/site-packages/htmltmpl.py", line 1038, in read
>      raise TemplateError, "IO error while reading template '%s': "\
> 
>  TemplateError: Htmltmpl error: IO error while reading template
> 'template.tmpl': (2) No such file or directory
> 
>  
>  FILES:
>  -rw-r--r--  1 www-data www-data  343 Jan 25 08:42 c.pyc
>  -rwxr-xr-x  1 root     root      111 Jan 25 08:42 c.py
>  -rw-r--r--  1 www-data www-data  332 Jan 25 08:36 b.pyc
>  -rw-r--r--  1 www-data www-data  387 Jan 25 08:34 a.pyc
>  -rw-r--r--  1 root     root      390 Jan 25 08:33 cheetah.tmpl
>  -rw-r--r--  1 root     root      203 Jan 25 08:31 b.py
>  -rwxr-xr-x  1 root     root      152 Jan 25 08:31 a.py
>  -rw-r--r--  1 www-data www-data  882 Jan 24 23:40 template.tmplc
>  -rw-r--r--  1 root     root      702 Jan 24 23:22 template.tmpl
>  -rw-r--r--  1 root     root      239 Jan 23 18:49 basic.html
> 
>  APACHE CONFIG (PYTHON SPECIFIC):
>  AddType text/plain .py
>  <Directory /var/www/pythontest>
>       Options -Indexes FollowSymLinks MultiViews
>       AllowOverride None
> 
>       AddHandler python-program .py
>       PythonHandler mod_python.publisher
>       PythonDebug On
> 
>  </Directory>
> 
>  
> 
>  ERROR MESSAGES WITH FULL PATH (/var/www/pythontest/c.py) SPECIFIED:
>  Not Found
>  The requested URL /pythontest/c.py was not found on this server.
>  Apache/1.3.33 Server at 192.168.0.12 Port 80
> 
>  
>  What am I missing?
> 
>  Thanks...
> 
>  Brandon
>  
>  
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 
> 
>
From list at joreybump.com  Tue Jan 25 12:19:16 2005
From: list at joreybump.com (Jorey Bump)
Date: Tue Jan 25 12:19:19 2005
Subject: [mod_python] psp_site example doesn't work
In-Reply-To: <c298f2d7050124233180554d0@mail.gmail.com>
References: <1106523523.15703@dscpl.user.openhosting.com>	
	<c298f2d7050123230939196a6@mail.gmail.com>	
	<41F50248.1020703@joreybump.com>	
	<c298f2d705012407284ef8ab40@mail.gmail.com>	
	<c298f2d705012407307d37cb3c@mail.gmail.com>	
	<16885.11826.768433.372438@greenmonster.local>	
	<41F552E7.4000805@joreybump.com>
	<c298f2d7050124233180554d0@mail.gmail.com>
Message-ID: <41F67F94.2000102@joreybump.com>

Nicolas Lehuen wrote:

> A lot of the problem caused by import_module() and the
> mod_python.publisher come from two very simple mistakes :
> 
> 1) it is not necessary IMHO to have published moduled imported in the
> same namespace than other 'standard' modules.
> 
> 2) Using the 'import' keyword or the 'imp' modules are not the only
> ways to import modules. Like you wrote, import and imp use a dotted
> naming scheme for the modules, and have a rather complicated search
> path algorithm. This is NOT what should be used to import published
> modules whose place in the filesystem follows a publication scheme
> instead of a modularization scheme.
> 
> The daily message from a new puzzled user should remind us that
> publishing a module is NOT the same thing as importing it in standard
> Python parlance. mpservlets, Vampire and other publishers have shown
> that it's quite easy to import modules without using import or imp.
> Separating published modules from standard modules should be done
> ASAP, and I think everybody will save mental health when it will be
> done ;).

Your argument holds a lot of water, and you've described the situation 
very well. But I feel that Publisher is very simple, and a decent manual 
  would only be a few pages long. After reading it, a user could sit 
down with "Learning Python" and immediately start writing a web 
application. Little tweaks that start giving Publisher its own syntax 
could also interfere with good mental health.

> Another proof that mixing published and standard module is a bad
> design choice is that you end up putting constraints (through the path
> parameter in import_module) to make sure that only modules from the
> published filesystem are published. This is inefficient at best. Have
> a look at what CherryPy does, for example : function and object which
> can be published are just marked as such. Anything else can't be
> published. There's no need to worry about path restrictions and so on
> and so forth.

Yes, but I think that Publisher is meant to be more of a transparent 
interface between apache and Python, with some useful conveniences 
thrown in for web development. I don't find myself thinking much about 
Publisher internals when I'm developing an application. CherryPy 
requirements are a lot more prominent in the code.

> I'm sorry to be a little harsh on the subject, but for now, I think
> mod_python is far from being an user-friendly web development
> environment. 

True, especially if you're expecting something with a builtin for every 
purpose. But I find it to be a transparent, programmer-friendly 
environment, because I just need to use ordinary Python commands and 
packages. I immediately develop reusable code, including code that isn't 
restricted to mod_python or web applications (parsing an Excel file, for 
example). I've even written modules that can run as a standalone web 
application, a command line application, or imported into another 
module, all in one file. I'd hate to see special syntax added to 
Publisher that makes this impossible. I *like* using ordinary import 
statements. :)

> For power users who can wrap their head around the
> various bugs^H^H^H^Hfeatures, it's perfect, but judging from the
> volumes of "Can't make mptest.py to run" or "Can't import yada_yada
> module from index.py" messages, there's still a lot of things to cope
> with to get a bigger user base. I definitely think the import
> mechanism and mod_python.publisher need urgent and radical
> improvements.

I rarely encounter software that works reliably and predictably well, 
and I include Publisher in that category. When something "just works" 
for me, talk of improving, fixing, or eliminating it makes me nervous. 
I'm not terribly motivated by joining a larger herd (I've gotten used to 
all of my favorite TV shows being cancelled). But there *are* choices, 
including Publisher, CherryPy, Vampire, mpservlets, etc. My concern is 
that Publisher will be turned into something more like the others, 
thereby eliminating my choice.

From list at joreybump.com  Tue Jan 25 12:44:36 2005
From: list at joreybump.com (Jorey Bump)
Date: Tue Jan 25 12:44:43 2005
Subject: [mod_python] publisher
In-Reply-To: <200501251413.49253.lroubeyrie@limair.asso.fr>
References: <200501251413.49253.lroubeyrie@limair.asso.fr>
Message-ID: <41F68584.8000208@joreybump.com>

Lionel Roubeyrie wrote:

> ####################################
> and in a file:
> ####################################
> def index(req, date_calcul='0', date_prevu='0'):
>     if date_calcul=='0': test=''
>     else: test='ok'
>     page= '''
>         <html>
>         <head>
>                 <link rel='STYLESHEET' type='text/css' 
> href='static/miseenpage.css'>
[snip]
> Good, but I loss the stylesheet :-( Why?

It needs to be relative to the function, not the file. You'll soon grow 
tired of rewriting the HTML and develop some reusable header code, so 
you might as well use an URL or site-relative link, instead:

  href='http://example.com/static/miseenpage.css'
  href='/static/miseenpage.css'

From grahamd at dscpl.com.au  Tue Jan 25 16:10:07 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Jan 25 16:10:48 2005
Subject: [mod_python] is not a file?
In-Reply-To: <7CCD39BE-6EBB-11D9-993F-000393DCF16E@dscpl.com.au>
References: <200501251048.42562.lroubeyrie@limair.asso.fr>
	<37923.217.33.199.34.1106646935.squirrel@217.33.199.34>
	<7CCD39BE-6EBB-11D9-993F-000393DCF16E@dscpl.com.au>
Message-ID: <7D7E695B-6F15-11D9-952F-000393DCF16E@dscpl.com.au>


On 25/01/2005, at 9:25 PM, Graham Dumpleton wrote:

>
> On 25/01/2005, at 8:55 PM, Jon Mercer wrote:
>>
>> As a further question in this thread, what is the proper way/best 
>> practice
>> to be mixing directories with different methods of calling 
>> mod_python? Can
>> the same directory handle the publisher as well as psp and custom
>> mechanisms?
>
> Using just mod_python, one can only really achieve this mixing by 
> assigning
> different extension types in URLs to the different implementation 
> mechanisms.
>
>   AddHandler mod_python.psp .psp
>   AddHandler mod_python.mpservlets .mps
>   AddHandler mod_python.publisher .py
>   AddHandler mycustommechanism .mypy
>
> I personally don't like this approach as it exposes implementation 
> details
> and looks plain messy having all these different extensions.

Hmmm, I shouldn't like that approach as it will not work how I wrote 
that. Wish
people would correct me when I go too quick and spout bullshit. Knew I 
should
have gone to sleep early.

Lets see if I can get it right this time.

   <Files *.psp>
   AddHandler mod_python .psp
   PythonHandler mod_python.psp
   </Files>
   <Files *.mps>
   AddHandler mod_python .mps
   PythonHandler mod_python.mpservlets
   </Files>
   <Files *.py>
   AddHandler mod_python .py
   PythonHandler mod_python.publisher
   </Files>

Or:

   SetHandler mod_python

   <Files *.psp>
   PythonHandler mod_python.psp
   </Files>
   <Files *.mps>
   PythonHandler mod_python.mpservlets
   </Files>
   <Files *.py>
   PythonHandler mod_python.publisher
   </Files>

Or:

   SetHandler mod_python

   PythonHandler mod_python.psp | .psp
   PythonHandler mod_python.mpservlets | .mps
   PythonHandler mod_python.publisher | .py

Is that better?

:-(

From nicolas.lehuen at gmail.com  Tue Jan 25 16:23:01 2005
From: nicolas.lehuen at gmail.com (Nicolas Lehuen)
Date: Tue Jan 25 16:23:04 2005
Subject: [mod_python] Catalog of mod_python.publisher problems.
In-Reply-To: <1106635567.19792@dscpl.user.openhosting.com>
References: <1106635567.19792@dscpl.user.openhosting.com>
Message-ID: <c298f2d7050125132330c07854@mail.gmail.com>

Graham,

Thanks for listing all those bugs. I'm a bit tired now to decide what
to do about this, but I think you did a great job in providing both a
bug description and a test case for each issue.

Maybe we could build a whole set of unit tests for
mod_python.publisher and put your test cases into it. Then we would
try to this those bugs until the test cases pass.

Regards,
Nicolas

On Tue, 25 Jan 2005 01:46:07 -0500, Graham Dumpleton
<grahamd@dscpl.com.au> wrote:
> Graham Dumpleton wrote ..
> > Graham Dumpleton wrote ..
> > >
> > > Do we need to document properly first the perceived problems and some
> > > examples of errornous behaviour? This will help to ensure we fix
> > > everything and provide a basis for some tests of any new implementation.
> > > I know that such information can be noted against the bug tracker item,
> > > but is it easier to thrash it out here first.
> >
> > FWIW, here is my personal list of problems in mod_python.publisher that
> > I know about. Note that I have ignored totally the basic issue that sys.path
> > makes which module you get unpredictable if import_module() is used
> > directly. This is just mod_python.publisher problems which should in
> > themselves be fixable whatever may eventually be done about the
> > import_module() method. Let me know if you want these put on bug
> > tracker as one item or three items.
> 
> Here is a fourth problem I have remembered. Although am sure that some
> will say that this is expected as well. ;-(
> 
> ImportError: cannot import name publisher
> ------------------------------------
> 
> In a directory publisher, setup for mod_python.publisher as described in
> previous email, and with same index.py. Ie.,
> 
>   import os
>   def index():
>     return os.getpid(),__file__
> 
> Now create a parallel directory called "handler" and in its .htaccess file add:
> 
>   SetHandler python-program
>   PythonHandler mptest
>   PythonDebug On
> 
> The mptest.py file in that directory should read:
> 
>   from mod_python import apache
>   import os
> 
>   from mod_python import publisher
> 
>   def handler(req):
>     req.content_type = "text/plain"
>     req.send_http_header()
>     req.write(str((os.getpid(),__file__)))
>     return apache.OK
> 
> Restart Apache to clear caches and access "handler" and "publisher"
> directories in that order. One gets:
> 
>   (747, '/Users/grahamd/Sites/handler/mptest.py')
>   (747, '/Users/grahamd/Sites/publisher/index.py')
>   (747, '/Users/grahamd/Sites/handler/mptest.py')
>   (747, '/Users/grahamd/Sites/publisher/index.py')
> 
> Okay, everything is fine.
> 
> Now restart Apache to clear caches and access "publisher" and then
> "handler". Ie., in reverse order. One gets:
> 
>   (761, '/Users/grahamd/Sites/publisher/index.py')
> 
>   Mod_python error: "PythonHandler mptest"
> 
>   Traceback (most recent call last):
> 
>     File "/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site-packages/mod_python/apache.py", line 296, in HandlerDispatch
>       log=debug)
> 
>     File "/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site-packages/mod_python/apache.py", line 421, in import_module
>       autoreload=autoreload,log=log,path=path)
> 
>     File "/System/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site-packages/mod_python/apache.py", line 474, in _unsafe_import_module
>       module = imp.load_module(mname, f, p, d)
> 
>     File "/Users/grahamd/Sites/handler/mptest.py", line 4, in ?
>       from mod_python import publisher
> 
>   ImportError: cannot import name publisher
> 
> The way in which mod_python.publisher is loaded as PythonHandler,
> if done before being imported explicitly using "import", screws up
> that latter import.
> 
> I know some will scream that I am mixing "import" and "import_module()",
> but since mod_python.publisher is installed into "site-packages", one
> should expect it to work with "import". Whether it does is order dependent.
> 
> Because I use mod_python.publisher in Vampire for its user authentication
> stuff, this problem means that if using Vampire and elsewhere also wanting
> to use mod_python.publisher as PythonHandler, that the Vampire area
> should be setup with its own PythonInterpreter instance.
> 
> Having now remembered this problem, as a workaround in Vampire I
> should probably go and use:
> 
>   publisher = apache.import_module("mod_python.publisher")
> 
> instead. At least that way it will work all the time. :-)
> 
> I know my wanting to use internals of mod_python.publisher is the
> exception, but these sort of strange things shouldn't by right happen.
> 
> Graham
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From bmasters at direcway.com  Wed Jan 26 03:09:16 2005
From: bmasters at direcway.com (Brandon Masterson)
Date: Wed Jan 26 03:10:01 2005
Subject: [mod_python] Apache1.3.33 + Python2.3.4 + mod_python - Can't get
	Python templates to work
In-Reply-To: <c298f2d7050125081212b556c2@mail.gmail.com>
References: <5.1.0.14.0.20050125071338.00bccda8@pop3.direcway.com>
	<5.1.0.14.0.20050125071338.00bccda8@pop3.direcway.com>
Message-ID: <5.1.0.14.0.20050125233759.00bb0610@pop3.direcway.com>

Gave it a try but had no luck.  Adding something like this:

filepath = "%s/basic.html" % os.path.dirname(__file__)
templateFile = open (filepath, 'r')

...generated the same error I get if I hard coded the entire absolute path 
in with the template name (e.g. /var/www/pythontest/basic.html).  When I 
make this change, I get the following:

ERROR MESSAGE:
404 Not Found
The requested URL /pythontest/c.py was not found on this server.


At 05:12 PM 1/25/2005 +0100, Nicolas Lehuen wrote:
>I think the problem is the CWD, which is automatically set to / IIRC.
>You have to give an absolute path to your template files. The best way
>to do this is to use the __file__ variable, which gives you the
>absolute path of the current .py file, and navigate from this file
>using the os and os.path modules.



From lroubeyrie at limair.asso.fr  Wed Jan 26 06:17:36 2005
From: lroubeyrie at limair.asso.fr (Lionel Roubeyrie)
Date: Wed Jan 26 06:18:48 2005
Subject: [mod_python] user privilege
Message-ID: <200501261217.36262.lroubeyrie@limair.asso.fr>

Hi all,
Is it possible to execute some mod_python codes by another user than the 
default apache user?
Thank's
-- 
Lionel Roubeyrie - lroubeyrie@limair.asso.fr
LIMAIR
http://www.limair.asso.fr

From grahamd at dscpl.com.au  Wed Jan 26 06:38:41 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Jan 26 06:40:06 2005
Subject: [mod_python] Apache1.3.33 + Python2.3.4 + mod_python - Can't get
	Python templates to work
In-Reply-To: <5.1.0.14.0.20050125233759.00bb0610@pop3.direcway.com>
References: <5.1.0.14.0.20050125071338.00bccda8@pop3.direcway.com>
	<5.1.0.14.0.20050125071338.00bccda8@pop3.direcway.com>
	<5.1.0.14.0.20050125233759.00bb0610@pop3.direcway.com>
Message-ID: <D3F85C7C-6F8E-11D9-952F-000393DCF16E@dscpl.com.au>


On 26/01/2005, at 7:09 PM, Brandon Masterson wrote:

> Gave it a try but had no luck.  Adding something like this:
>
> filepath = "%s/basic.html" % os.path.dirname(__file__)
> templateFile = open (filepath, 'r')
>
> ...generated the same error I get if I hard coded the entire absolute 
> path in with the template name (e.g. /var/www/pythontest/basic.html).  
> When I make this change, I get the following:
>
> ERROR MESSAGE:
> 404 Not Found
> The requested URL /pythontest/c.py was not found on this server.

Read the error message. It isn't even talking about not being able to
open "basic.html". It is saying that the URL you used didn't even
map to a valid resource.

Anyway, suggest you go back to square one and create a simple test
content handler which simply returns an explicit string. Get this
working again before you even attempt to do something that opens
a file. Ie., do one step at a time. At least then you can be exactly
sure at what point things fall apart.

Also, we might be able to assist more if you provide a full copy of
the contents of the Python code file you are using rather than the
snippets you have posted so far. Also repost the Apache configuration
you are using at the same time for that Python code file. It is hard
to gauge if your content handler is even setup correctly without
complete information.

Graham

From igor at rulim.de  Wed Jan 26 09:07:58 2005
From: igor at rulim.de (Igor Stroh)
Date: Wed Jan 26 09:08:06 2005
Subject: [mod_python] Strange request.parsed_uri
Message-ID: <41F7A43E.3040603@rulim.de>

Hi all,

under which circumstances are the first 6 tuple members
of request.parsed_uri None? The unparsed_uri member
returns only the path portion too (along with query stuff).
Funny enough, it already worked, i.e. I already have had
a setup where the parsed_uri tuple contained at least
7 members which where not None - scheme, hostname, username...

Any ideas?

Apache2 config:
===============================================================
<VirtualHost 1.2.3.4:80>
    ServerName    foo.bar.com
    ServerAdmin   john.dow@foo.bar.com
    ServerSignature Off

    LogLevel debug
    CustomLog     /var/log/apache2/foo.bar/access.log combined
    ErrorLog      /var/log/apache2/foo.bar/error.log
    TransferLog   /var/log/apache2/foo.bar/transfer.log

    SetHandler mod_python
    #PythonOption "ApplicationPath" "/"
    PythonPath "['/usr/share/myHandlerModule'] + sys.path"
    PythonHandler myHandler
    PythonDebug On
</VirtualHost>
===============================================================


myHandler.py:
===============================================================
from mod_python import apache
def handler(REQUEST):
    REQUEST.conditions = "text/plain"
    REQUEST.send_http_header()
    REQUEST.write("Parsed URI: %s\n" % str(REQUEST.parsed_uri))
    return apache.OK
===============================================================

Version info:
python 2.3.4-5
apache2 2.0.52-3 (mpm-prefork)
mod_python 3.1.3-2.2

TIA,
Igor
From grisha at modpython.org  Wed Jan 26 10:00:31 2005
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Wed Jan 26 10:00:39 2005
Subject: [mod_python] user privilege
In-Reply-To: <200501261217.36262.lroubeyrie@limair.asso.fr>
References: <200501261217.36262.lroubeyrie@limair.asso.fr>
Message-ID: <20050126095824.N19241@grisha.dyndns.org>


On Wed, 26 Jan 2005, Lionel Roubeyrie wrote:

> Hi all,
> Is it possible to execute some mod_python codes by another user than the
> default apache user?

You can write a suid wrapper which you'd call from mod_python. Or another 
way to do this is via the sudo command.

Grisha
From nick at dd.revealed.net  Wed Jan 26 10:14:57 2005
From: nick at dd.revealed.net (Nick)
Date: Wed Jan 26 10:15:14 2005
Subject: [mod_python] user privilege
In-Reply-To: <20050126095824.N19241@grisha.dyndns.org>
References: <200501261217.36262.lroubeyrie@limair.asso.fr>
	<20050126095824.N19241@grisha.dyndns.org>
Message-ID: <41F7B3F1.1090508@dd.revealed.net>

It's also possible in apache 1.3 (and experimentally in 2.0 using 
mpm_perchild) to have a different user and group per virtual server, which 
you may run on different ports and tie together with mod_rewrite or some 
such thing.

Nick

Gregory (Grisha) Trubetskoy wrote:
> 
> On Wed, 26 Jan 2005, Lionel Roubeyrie wrote:
> 
>> Hi all,
>> Is it possible to execute some mod_python codes by another user than the
>> default apache user?
> 
> 
> You can write a suid wrapper which you'd call from mod_python. Or 
> another way to do this is via the sudo command.
> 
> Grisha
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From lroubeyrie at limair.asso.fr  Wed Jan 26 10:31:02 2005
From: lroubeyrie at limair.asso.fr (Lionel Roubeyrie)
Date: Wed Jan 26 10:32:13 2005
Subject: [mod_python] Broken pipe
Message-ID: <200501261631.02455.lroubeyrie@limair.asso.fr>

Hi all,
I need to transform a .eps file into a .jpg or .png file. Using a simple 
script with the PIL works fine:
#################################
def convert(infile, outfile):
? ? import Image
? ? fp = Image.open(infile)
? ? fp.save(outfile)
? ? return outfile
#################################

then convert('tutu.eps', 'tutu.jpg') is ok, not if I call it in mod_python:
#################################
File "/home/lionel/cartair.py", line 502, in convert
? ? fp.save(outfile)
? File "/usr/lib/python2.3/site-packages/PIL/Image.py", line 1125, in save
? ? self.load()
? File "/usr/lib/python2.3/site-packages/PIL/EpsImagePlugin.py", line 282, in 
load
? ? self.im = Ghostscript(self.tile, self.size, self.fp)
? File "/usr/lib/python2.3/site-packages/PIL/EpsImagePlugin.py", line 73, in 
Ghostscript
? ? gs.write(s)
IOError: [Errno 32] Broken pipe
#################################
Do I have to change something?
Thanks

-- 
Lionel Roubeyrie - lroubeyrie@limair.asso.fr
LIMAIR
http://www.limair.asso.fr


From bmasters at direcway.com  Wed Jan 26 10:37:35 2005
From: bmasters at direcway.com (Brandon Masterson)
Date: Wed Jan 26 10:41:00 2005
Subject: [mod_python] Apache1.3.33 + Python2.3.4 + mod_python - Can't get
	Python templates to work
In-Reply-To: <D3F85C7C-6F8E-11D9-952F-000393DCF16E@dscpl.com.au>
References: <5.1.0.14.0.20050125233759.00bb0610@pop3.direcway.com>
	<5.1.0.14.0.20050125071338.00bccda8@pop3.direcway.com>
	<5.1.0.14.0.20050125071338.00bccda8@pop3.direcway.com>
	<5.1.0.14.0.20050125233759.00bb0610@pop3.direcway.com>
Message-ID: <5.1.0.14.0.20050126071004.00b37638@pop3.direcway.com>

Gents,

Appreciate the help for this python newbie.  I do recognize that the error 
message changed when the full path is provided (as I noted in the bottom of 
the first message) either when hard coded or using the __file__ to extract 
it.  Regarding the rest:
1) Code snippets - With the exception of the apache config excerpt the code 
posted was the entire file boiled down from examples I had found on various 
template sites.
2) Basics - Done that.  I have several working .py files in the 
/var/www/pythontest directory from simple "hello world" types up to a local 
mysql database access and dump, all via the browser so I know the files are 
accessible and work fine.  The problem was in going to the next step 
(referencing local files).
3) Index missing - Based on the posted comments I've wrapped the original 
template code in a def index the following
from simpletal import simpleTAL, simpleTALES
import sys
import os

def index(req):
    filepath = "%s/basic.html" % os.path.dirname(__file__)
    templateFile = open (filepath, 'r')
    templateFile.close()

This gets me this error when I used "http://192.168.0.12/pythontest/a.py" :
500 Internal Server Error
The server encountered an internal error or misconfiguration and was unable 
to complete your request.

Please contact the server administrator, webmaster@Knoppix and inform them 
of the time the error occurred, and anything you might have done that may 
have caused the error.

More information about this error may be available in the server error log.

4)  Full apache config below - Hope you see something:
##
## httpd.conf -- Apache HTTP server configuration file
##

#
# Based upon the NCSA server configuration files originally by Rob McCool.
#
# This is the main Apache server configuration file.  It contains the
# configuration directives that give the server its instructions.
# See <URL:http://www.apache.org/docs/> for detailed information about
# the directives.
#
# Do NOT simply read the instructions in here without understanding
# what they do.  They're here only as hints or reminders.  If you are unsure
# consult the online docs. You have been warned.
#
# After this file is processed, the server will look for and process
# /etc/apache/srm.conf and then /etc/apache/access.conf
# unless you have overridden these with ResourceConfig and/or
# AccessConfig directives here.
#
# The configuration directives are grouped into three basic sections:
#  1. Directives that control the operation of the Apache server process as a
#     whole (the 'global environment').
#  2. Directives that define the parameters of the 'main' or 'default' server,
#     which responds to requests that aren't handled by a virtual host.
#     These directives also provide default values for the settings
#     of all virtual hosts.
#  3. Settings for virtual hosts, which allow Web requests to be sent to
#     different IP addresses or hostnames and have them handled by the
#     same Apache server process.
#
# Configuration and logfile names: If the filenames you specify for many
# of the server's control files begin with "/" (or "drive:/" for Win32), the
# server will use that explicit path.  If the filenames do *not* begin
# with "/", the value of ServerRoot is prepended -- so "logs/foo.log"
# with ServerRoot set to "/usr/local/apache" will be interpreted by the
# server as "/usr/local/apache/logs/foo.log".
#

### Section 1: Global Environment
#
# The directives in this section affect the overall operation of Apache,
# such as the number of concurrent requests it can handle or where it
# can find its configuration files.
#

#
# ServerType is either inetd, or standalone.  Inetd mode is only supported on
# Unix platforms.
#
ServerType standalone

#
# ServerRoot: The top of the directory tree under which the server's
# configuration, error, and log files are kept.
#
# NOTE!  If you intend to place this on an NFS (or otherwise network)
# mounted filesystem then please read the LockFile documentation
# (available at <URL:http://www.apache.org/docs/mod/core.html#lockfile>);
# you will save yourself a lot of trouble.
#
# Do NOT add a slash at the end of the directory path.
#
ServerRoot /etc/apache

#
# The LockFile directive sets the path to the lockfile used when Apache
# is compiled with either USE_FCNTL_SERIALIZED_ACCEPT or
# USE_FLOCK_SERIALIZED_ACCEPT. This directive should normally be left at
# its default value. The main reason for changing it is if the logs
# directory is NFS mounted, since the lockfile MUST BE STORED ON A LOCAL
# DISK. The PID of the main server process is automatically appended to
# the filename.
#
LockFile /var/lock/apache.lock

#
# PidFile: The file in which the server should record its process
# identification number when it starts.
#
PidFile /var/run/apache.pid

#
# ScoreBoardFile: File used to store internal server process information.
# Not all architectures require this.  But if yours does (you'll know because
# this file will be  created when you run Apache) then you *must* ensure that
# no two invocations of Apache share the same scoreboard file.
#
ScoreBoardFile /var/run/apache.scoreboard

#
# In the standard configuration, the server will process this file,
# srm.conf, and access.conf in that order.  The latter two files are
# now distributed empty, as it is recommended that all directives
# be kept in a single file for simplicity.  The commented-out values
# below are the built-in defaults.  You can have the server ignore
# these files altogether by using "/dev/null" (for Unix) or
# "nul" (for Win32) for the arguments to the directives.
#
#ResourceConfig /etc/apache/srm.conf
#AccessConfig /etc/apache/access.conf

#
# Timeout: The number of seconds before receives and sends time out.
#
Timeout 300

#
# KeepAlive: Whether or not to allow persistent connections (more than
# one request per connection). Set to "Off" to deactivate.
#
KeepAlive On

#
# MaxKeepAliveRequests: The maximum number of requests to allow
# during a persistent connection. Set to 0 to allow an unlimited amount.
# We recommend you leave this number high, for maximum performance.
#
MaxKeepAliveRequests 100

#
# KeepAliveTimeout: Number of seconds to wait for the next request from the
# same client on the same connection.
#
KeepAliveTimeout 15

#
# Server-pool size regulation.  Rather than making you guess how many
# server processes you need, Apache dynamically adapts to the load it
# sees --- that is, it tries to maintain enough server processes to
# handle the current load, plus a few spare servers to handle transient
# load spikes (e.g., multiple simultaneous requests from a single
# Netscape browser).
#
# It does this by periodically checking how many servers are waiting
# for a request.  If there are fewer than MinSpareServers, it creates
# a new spare.  If there are more than MaxSpareServers, some of the
# spares die off.  The default values are probably OK for most sites.
#
MinSpareServers 5
MaxSpareServers 20

#
# Number of servers to start initially --- should be a reasonable ballpark
# figure.
#
StartServers 5

#
# Limit on total number of servers running, i.e., limit on the number
# of clients who can simultaneously connect --- if this limit is ever
# reached, clients will be LOCKED OUT, so it should NOT BE SET TOO LOW.
# It is intended mainly as a brake to keep a runaway server from taking
# the system with it as it spirals down...
#
MaxClients 150

#
# MaxRequestsPerChild: the number of requests each child process is
# allowed to process before the child dies.  The child will exit so
# as to avoid problems after prolonged use when Apache (and maybe the
# libraries it uses) leak memory or other resources.  On most systems, this
# isn't really needed, but a few (such as Solaris) do have notable leaks
# in the libraries. For these platforms, set to something like 10000
# or so; a setting of 0 means unlimited.
#
# NOTE: This value does not include keepalive requests after the initial
#       request per connection. For example, if a child process handles
#       an initial request and 10 subsequent "keptalive" requests, it
#       would only count as 1 request towards this limit.
#
MaxRequestsPerChild 100

#
# Listen: Allows you to bind Apache to specific IP addresses and/or
# ports, in addition to the default. See also the <VirtualHost>
# directive.
#
#Listen 3000
#Listen 12.34.56.78:80

#
# BindAddress: You can support virtual hosts with this option. This directive
# is used to tell the server which IP address to listen to. It can either
# contain "*", an IP address, or a fully qualified Internet domain name.
# See also the <VirtualHost> and Listen directives.
#
#BindAddress *

#
# Dynamic Shared Object (DSO) Support
#
# To be able to use the functionality of a module which was built as a DSO you
# have to place corresponding `LoadModule' lines at this location so the
# directives contained in it are actually available _before_ they are used.
# Please read the file README.DSO in the Apache 1.3 distribution for more
# details about the DSO mechanism and run `apache -l' for the list of already
# built-in (statically linked and thus always available) modules in your apache
# binary.
#
# Please keep this LoadModule: line here, it is needed for installation.
Include /etc/apache/modules.conf

#
# ExtendedStatus: controls whether Apache will generate "full" status
# information (ExtendedStatus On) or just basic information (ExtendedStatus
# Off) when the "server-status" handler is called. The default is Off.
#
ExtendedStatus On

### Section 2: 'Main' server configuration
#
# The directives in this section set up the values used by the 'main'
# server, which responds to any requests that aren't handled by a
# <VirtualHost> definition.  These values also provide defaults for
# any <VirtualHost> containers you may define later in the file.
#
# All of these directives may appear inside <VirtualHost> containers,
# in which case these default settings will be overridden for the
# virtual host being defined.
#

#
# If your ServerType directive (set earlier in the 'Global Environment'
# section) is set to "inetd", the next few directives don't have any
# effect since their settings are defined by the inetd configuration.
# Skip ahead to the ServerAdmin directive.
#

#
# Port: The port to which the standalone server listens. For
# ports < 1023, you will need apache to be run as root initially.
#
Port 80

#
# If you wish apache to run as a different user or group, you must run
# apacheas root initially and it will switch.
#
# User/Group: The name (or #number) of the user/group to run apache as.
#  . On SCO (ODT 3) use "User nouser" and "Group nogroup".
#  . On HPUX you may not be able to use shared memory as nobody, and the
#    suggested workaround is to create a user www and use that user.
#  NOTE that some kernels refuse to setgid(Group) or semctl(IPC_SET)
#  when the value of (unsigned)Group is above 60000;
#  don't use Group nobody on these systems!
#
User www-data
Group www-data

#
# ServerAdmin: Your address, where problems with the server should be
# e-mailed.  This address appears on some server-generated pages, such
# as error documents.
#
ServerAdmin webmaster@Knoppix

#
# ServerName: allows you to set a host name which is sent back to clients for
# your server if it's different than the one the program would get (i.e., use
# "www" instead of the host's real name).
#
# Note: You cannot just invent host names and hope they work. The name you
# define here must be a valid DNS name for your host. If you don't understand
# this, ask your network administrator.
# If your host doesn't have a registered DNS name, enter its IP address here.
# You will have to access it by its address (e.g., http://123.45.67.89/)
# anyway, and this will make redirections work in a sensible way.
ServerName 192.168.0.12
#
#ServerName new.host.name

#
# DocumentRoot: The directory out of which you will serve your
# documents. By default, all requests are taken from this directory, but
# symbolic links and aliases may be used to point to other locations.
#
DocumentRoot "/var/www"

#
# Each directory to which Apache has access, can be configured with respect
# to which services and features are allowed and/or disabled in that
# directory (and its subdirectories).
#
# First, we configure the "default" to be a very restrictive set of
# permissions.
#
<Directory />
     #Options SymLinksIfOwnerMatch
     Options FollowSymLinks
     AllowOverride None
</Directory>

#
# Note that from this point forward you must specifically allow
# particular features to be enabled - so if something's not working as
# you might expect, make sure that you have specifically enabled it
# below.
#

#
# This should be changed to whatever you set DocumentRoot to.
#
<Directory "/var/www/">

#
# This may also be "None", "All", or any combination of "Indexes",
# "Includes", "FollowSymLinks", "ExecCGI", or "MultiViews".
#
# Note that "MultiViews" must be named *explicitly* --- "Options All"
# doesn't give it to you.
#
     Options Indexes Includes FollowSymLinks MultiViews ExecCGI

#
# This controls which options the .htaccess files in directories can
# override. Can also be "All", or any combination of "Options", "FileInfo",
# "AuthConfig", and "Limit"
#
     AllowOverride None

#
# Controls who can get stuff from this server.
#
     Order allow,deny
     Allow from all
</Directory>

#
# UserDir: The name of the directory which is appended onto a user's home
# directory if a ~user request is received.
#
<IfModule mod_userdir.c>
     UserDir public_html
</IfModule>

#
# Control access to UserDir directories.  The following is an example
# for a site where these directories are restricted to read-only.
#
<Directory /home/*/public_html>
     AllowOverride FileInfo AuthConfig Limit
     Options MultiViews Indexes SymLinksIfOwnerMatch IncludesNoExec
     <Limit GET POST OPTIONS PROPFIND>
         Order allow,deny
         Allow from all
     </Limit>
     <Limit PUT DELETE PATCH PROPPATCH MKCOL COPY MOVE LOCK UNLOCK>
         Order deny,allow
         Deny from all
     </Limit>
</Directory>

#
# DirectoryIndex: Name of the file or files to use as a pre-written HTML
# directory index.  Separate multiple entries with spaces.
#
<IfModule mod_dir.c>
     DirectoryIndex index.html index.htm index.shtml index.cgi
</IfModule>

#
# AccessFileName: The name of the file to look for in each directory
# for access control information.
#
AccessFileName .htaccess

#
# The following lines prevent .htaccess files from being viewed by
# Web clients.  Since .htaccess files often contain authorization
# information, access is disallowed for security reasons.  Comment
# these lines out if you want Web visitors to see the contents of
# .htaccess files.  If you change the AccessFileName directive above,
# be sure to make the corresponding changes here.
#
# Also, folks tend to use names such as .htpasswd for password
# files, so this will protect those as well.
#
<Files ~ "^\.ht">
     Order allow,deny
     Deny from all
</Files>

#
# CacheNegotiatedDocs: By default, Apache sends "Pragma: no-cache" with each
# document that was negotiated on the basis of content. This asks proxy
# servers not to cache the document. Uncommenting the following line disables
# this behavior, and proxies will be allowed to cache the documents.
#
#CacheNegotiatedDocs

#
# UseCanonicalName:  (new for 1.3)  With this setting turned on, whenever
# Apache needs to construct a self-referencing URL (a URL that refers back
# to the server the response is coming from) it will use ServerName and
# Port to form a "canonical" name.  With this setting off, Apache will
# use the hostname:port that the client supplied, when possible.  This
# also affects SERVER_NAME and SERVER_PORT in CGI scripts.
#
UseCanonicalName On

#
# TypesConfig describes where the mime.types file (or equivalent) is
# to be found.
#
TypesConfig /etc/mime.types

#
# DefaultType is the default MIME type the server will use for a document
# if it cannot otherwise determine one, such as from filename extensions.
# If your server contains mostly text or HTML documents, "text/plain" is
# a good value.  If most of your content is binary, such as applications
# or images, you may want to use "application/octet-stream" instead to
# keep browsers from trying to display binary files as though they are
# text.
#
DefaultType text/plain

#
# The mod_mime_magic module allows the server to use various hints from the
# contents of the file itself to determine its type.  The MIMEMagicFile
# directive tells the module where the hint definitions are located.
# mod_mime_magic is not part of the default server (you have to add
# it yourself with a LoadModule [see the DSO paragraph in the 'Global
# Environment' section], or recompile the server and include mod_mime_magic
# as part of the configuration), so it's enclosed in an <IfModule> container.
# This means that the MIMEMagicFile directive will only be processed if the
# module is part of the server.
#
<IfModule mod_mime_magic.c>
     MIMEMagicFile share/magic
</IfModule>

#
# HostnameLookups: Log the names of clients or just their IP addresses
# e.g., www.apache.org (on) or 204.62.129.132 (off).
# The default is off because it'd be overall better for the net if people
# had to knowingly turn this feature on, since enabling it means that
# each client request will result in AT LEAST one lookup request to the
# nameserver.
#
HostnameLookups Off

#
# ErrorLog: The location of the error log file.
# If you do not specify an ErrorLog directive within a <VirtualHost>
# container, error messages relating to that virtual host will be
# logged here.  If you *do* define an error logfile for a <VirtualHost>
# container, that host's errors will be logged there and not here.
#
ErrorLog /var/log/apache/error.log

#
# LogLevel: Control the number of messages logged to the error_log.
# Possible values include: debug, info, notice, warn, error, crit,
# alert, emerg.
#
LogLevel warn

#
# The following directives define some format nicknames for use with
# a CustomLog directive (see below).
#
LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\" %T 
%v" full
LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\" %P 
%T" debug
LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" 
combined
LogFormat "%h %l %u %t \"%r\" %>s %b" common
LogFormat "%{Referer}i -> %U" referer
LogFormat "%{User-agent}i" agent

#
# The location and format of the access logfile (Common Logfile Format).
# If you do not define any access logfiles within a <VirtualHost>
# container, they will be logged here.  Contrariwise, if you *do*
# define per-<VirtualHost> access logfiles, transactions will be
# logged therein and *not* in this file.
#
#CustomLog /var/log/apache/access.log common

#
# If you would like to have agent and referer logfiles, uncomment the
# following directives.
#
#CustomLog /var/log/apache/referer.log referer
#CustomLog /var/log/apache/agent.log agent

#
# If you prefer a single logfile with access, agent, and referer information
# (Combined Logfile Format) you can use the following directive.
#
CustomLog /var/log/apache/access.log combined

#
# Optionally add a line containing the server version and virtual host
# name to server-generated pages (error documents, FTP directory listings,
# mod_status and mod_info output etc., but not CGI generated documents).
# Set to "EMail" to also include a mailto: link to the ServerAdmin.
# Set to one of:  On | Off | EMail
#
ServerSignature On

#
# Aliases: Add here as many aliases as you need (with no limit). The format is
# Alias fakename realname
#
# Note that if you include a trailing / on fakename then the server will
# require it to be present in the URL.  So "/icons" isn't aliased in this
# example, only "/icons/"..
#

Alias /icons/ /usr/share/apache/icons/

<Directory /usr/share/apache/icons>
     Options Indexes MultiViews
     AllowOverride None
     Order allow,deny
     Allow from all
</Directory>

#
# ScriptAlias: This controls which directories contain server scripts.
# ScriptAliases are essentially the same as Aliases, except that
# documents in the realname directory are treated as applications and
# run by the server when requested rather than as documents sent to the client.
# The same rules about trailing "/" apply to ScriptAlias directives as to
# Alias.
#
#ScriptAlias /cgi-bin/ /usr/lib/cgi-bin/
ScriptAlias /cgi-bin/ /var/www/bugz/
#ScriptAlias /cgi-bin/ /var/www/pythontest/

#
# "/usr/lib/cgi-bin" could be changed to whatever your ScriptAliased
# CGI directory exists, if you have that configured.
#
#<Directory /usr/lib/cgi-bin/>
<Directory /var/www/bugz/>
     AllowOverride None
     Options ExecCGI
     Order allow,deny
     Allow from all
</Directory>

# 1/17/05 BHM - Trying to add mod_python
AddType text/plain .py
<Directory /var/www/pythontest>
      #AllowOverride All
      Options -Indexes Includes FollowSymLinks MultiViews
      #ExecCGI
      AllowOverride None

      AddHandler python-program .py
      PythonHandler mod_python.publisher
      PythonDebug On

      #<Files *.py>
      #PythonPath "['/var/www/pythontest'] + sys.path"
      #</Files>

</Directory>

# Adding password protect on a directory
#     PythonHandler myscript
#     PythonAuthenHandler myscript
#     AuthType Basic
#     AuthName "Restricted Area"
#     require valid-user

#
# Redirect allows you to tell clients about documents which used to exist in
# your server's namespace, but do not anymore. This allows you to tell the
# clients where to look for the relocated document.
# Format: Redirect old-URI new-URL
#

#
# Directives controlling the display of server-generated directory listings.
#

<IfModule mod_autoindex.c>

     #
     # FancyIndexing: whether you want fancy directory indexing or standard
     #
     IndexOptions FancyIndexing NameWidth=*

     #
     # AddIcon* directives tell the server which icon to show for different
     # files or filename extensions.  These are only displayed for
     # FancyIndexed directories.
     #
     AddIconByEncoding (CMP,/icons/compressed.gif) x-compress x-gzip

     AddIconByType (TXT,/icons/text.gif) text/*
     AddIconByType (IMG,/icons/image2.gif) image/*
     AddIconByType (SND,/icons/sound2.gif) audio/*
     AddIconByType (VID,/icons/movie.gif) video/*

     AddIcon /icons/binary.gif .bin .exe
     AddIcon /icons/binhex.gif .hqx
     AddIcon /icons/tar.gif .tar
     AddIcon /icons/world2.gif .wrl .wrl.gz .vrml .vrm .iv
     AddIcon /icons/compressed.gif .Z .z .tgz .gz .zip
     AddIcon /icons/a.gif .ps .ai .eps
     AddIcon /icons/layout.gif .html .shtml .htm .pdf
     AddIcon /icons/text.gif .txt
     AddIcon /icons/c.gif .c
     AddIcon /icons/p.gif .pl .py
     AddIcon /icons/f.gif .for
     AddIcon /icons/dvi.gif .dvi
     AddIcon /icons/uuencoded.gif .uu
     AddIcon /icons/script.gif .conf .sh .shar .csh .ksh .tcl
     AddIcon /icons/tex.gif .tex
     AddIcon /icons/bomb.gif core

     AddIcon /icons/back.gif ..
     AddIcon /icons/hand.right.gif README
     AddIcon /icons/folder.gif ^^DIRECTORY^^
     AddIcon /icons/blank.gif ^^BLANKICON^^

     #
     # DefaultIcon: which icon to show for files which do not have an icon
     # explicitly set.
     #
     DefaultIcon /icons/unknown.gif

     #
     # AddDescription: allows you to place a short description after a file in
     # server-generated indexes.  These are only displayed for FancyIndexed
     # directories.
     # Format: AddDescription "description" filename
     #
     #AddDescription "GZIP compressed document" .gz
     #AddDescription "tar archive" .tar
     #AddDescription "GZIP compressed tar archive" .tgz

     #
     # ReadmeName: the name of the README file the server will look for by
     # default, and append to directory listings.
     #
     # HeaderName: the name of a file which should be prepended to
     # directory indexes.
     #
     # The server will first look for name.html and include it if found.
     # If name.html doesn't exist, the server will then look for name.txt
     # and include it as plaintext if found.
     #
     ReadmeName README
     HeaderName HEADER

     #
     # IndexIgnore: a set of filenames which directory indexing should ignore
     # and not include in the listing.  Shell-style wildcarding is permitted.
     #
     IndexIgnore .??* *~ *# HEADER* README* RCS CVS *,v *,t

</IfModule>

#
# Document types.
#
<IfModule mod_mime.c>

     # AddEncoding allows you to have certain browsers (Mosaic/X 2.1+)
     # uncompress information on the fly. Note: Not all browsers support
     # this.  Despite the name similarity, the following Add* directives
     # have nothing to do with the FancyIndexing customization
     # directives above.

     AddEncoding x-compress Z
     AddEncoding x-gzip gz tgz

     #
     # AddLanguage: allows you to specify the language of a document. You can
     # then use content negotiation to give a browser a file in a language
     # it can understand.
     #
     # Note 1: The suffix does not have to be the same as the language
     # keyword --- those with documents in Polish (whose net-standard
     # language code is pl) may wish to use "AddLanguage pl .po" to
     # avoid the ambiguity with the common suffix for perl scripts.
     #
     # Note 2: The example entries below illustrate that in quite
     # some cases the two character 'Language' abbriviation is not
     # identical to the two character 'Country' code for its country,
     # E.g. 'Danmark/dk' versus 'Danish/da'.
     #
     # Note 3: In the case of 'ltz' we violate the RFC by using a three char
     # specifier. But there is 'work in progress' to fix this and get
     # the reference data for rfc1766 cleaned up.
     #
     # Danish (da) - Dutch (nl) - English (en) - Estonian (ee)
     # French (fr) - German (de) - Greek-Modern (el)
     # Italian (it) - Portugese (pt) - Luxembourgeois* (ltz)
     # Spanish (es) - Swedish (sv) - Catalan (ca) - Czech(cz)
     # Polish (pl) - Brazilian Portuguese (pt-br) - Japanese (ja)
     #
     AddLanguage da .dk
     AddLanguage nl .nl
     AddLanguage en .en
     AddLanguage et .ee
     AddLanguage fr .fr
     AddLanguage de .de
     AddLanguage el .el
     AddLanguage it .it
     AddLanguage ja .ja
     AddCharset ISO-2022-JP .jis
     AddLanguage pl .po
     AddCharset ISO-8859-2 .iso-pl
     AddLanguage pt .pt
     AddLanguage pt-br .pt-br
     AddLanguage ltz .lu
     AddLanguage ca .ca
     AddLanguage es .es
     AddLanguage sv .se
     AddLanguage cz .cz

     # LanguagePriority: allows you to give precedence to some languages
     # in case of a tie during content negotiation.
     #
     # Just list the languages in decreasing order of preference. We have
     # more or less alphabetized them here. You probably want to change
     # this.
     #
     <IfModule mod_negotiation.c>
         LanguagePriority en da nl et fr de el it ja pl pt pt-br ltz ca es sv
     </IfModule>

     #
     # AddType allows you to tweak mime.types without actually editing
     # it, or to make certain files to be certain types.
     #
     # For example, the PHP 3.x module (not part of the Apache
     # distribution - see http://www.php.net) will typically use:
     #
     #AddType application/x-httpd-php3 .php3
     #AddType application/x-httpd-php3-source .phps
     #
     # And for PHP 4.x, use:
     #
     AddType application/x-httpd-php .php .php3 .php4
     AddType application/x-httpd-php-source .phps

     AddType application/x-tar .tgz
     AddType image/bmp .bmp

     # hdml
     AddType text/x-hdml .hdml

     #
     # AddHandler allows you to map certain file extensions to "handlers",
     # actions unrelated to filetype. These can be either built into
     # the server or added with the Action command (see below).
     #
     # If you want to use server side includes, or CGI outside
     # ScriptAliased directories, uncomment the following lines.
     #
     # To use CGI scripts:
     #
     AddHandler cgi-script .cgi .sh .pl

     #
     # To use server-parsed HTML files
     #
     #AddType text/html .shtml
     #AddHandler server-parsed .shtml

     #
     # Uncomment the following line to enable Apache's send-asis HTTP
     # file feature.
     #
     #AddHandler send-as-is asis

     #
     # If you wish to use server-parsed imagemap files, use
     #
     #AddHandler imap-file map

     #
     # To enable type maps, you might want to use
     #
     #AddHandler type-map var

</IfModule>
# End of document types.

# Default charset to iso-8859-1 (ttp://www.apache.org/info/css-security/).

AddDefaultCharset on

#
# Action: lets you define media types that will execute a script whenever
# a matching file is called. This eliminates the need for repeated URL
# pathnames for oft-used CGI file processors.
# Format: Action media/type /cgi-script/location
# Format: Action handler-name /cgi-script/location
#

#
# MetaDir: specifies the name of the directory in which Apache can find
# meta information files. These files contain additional HTTP headers
# to include when sending the document
#
#MetaDir .web

#
# MetaSuffix: specifies the file name suffix for the file containing the
# meta information.
#
#MetaSuffix .meta

#
# Customizable error response (Apache style)
#  these come in three flavors
#
#    1) plain text
#ErrorDocument 500 "The server made a boo boo.
#  n.b.  the (") marks it as text, it does not get output
#
#    2) local redirects
#ErrorDocument 404 /missing.html
#  to redirect to local URL /missing.html
#ErrorDocument 404 /cgi-bin/missing_handler.pl
#  N.B.: You can redirect to a script or a document using server-side-includes.
#
#    3) external redirects
#ErrorDocument 402 http://some.other_server.com/subscription_info.html
#  N.B.: Many of the environment variables associated with the original
#  request will *not* be available to such a script.

<IfModule mod_setenvif.c>
     #
     # The following directives modify normal HTTP response behavior.
     # The first directive disables keepalive for Netscape 2.x and browsers 
that
     # spoof it. There are known problems with these browser implementations.
     # The second directive is for Microsoft Internet Explorer 4.0b2
     # which has a broken HTTP/1.1 implementation and does not properly
     # support keepalive when it is used on 301 or 302 (redirect) responses.
     #
     BrowserMatch "Mozilla/2" nokeepalive
     BrowserMatch "MSIE 4\.0b2;" nokeepalive downgrade-1.0 force-response-1.0

     #
     # The following directive disables HTTP/1.1 responses to browsers which
     # are in violation of the HTTP/1.0 spec by not being able to grok a
     # basic 1.1 response.
     #
     BrowserMatch "RealPlayer 4\.0" force-response-1.0
     BrowserMatch "Java/1\.0" force-response-1.0
     BrowserMatch "JDK/1\.0" force-response-1.0
</IfModule>


# If the perl module is installed, this will be enabled.
<IfModule mod_perl.c>
   Alias /perl/ /var/www/perl/
   <Location /perl>
     SetHandler perl-script
     PerlHandler Apache::Registry
     Options +ExecCGI
   </Location>
</IfModule>

#
# Allow http put (such as Netscape Gold's publish feature)
# Use htpasswd to generate /etc/apache/passwd.
# You must unremark these two lines at the top of this file as well:
#LoadModule put_module		modules/mod_put.so
#
#Alias /upload /tmp
#<Location /upload>
#    EnablePut On
#    AuthType Basic
#    AuthName Temporary
#    AuthUserFile /etc/apache/passwd
#    EnableDelete Off
#    umask 007
#    <Limit PUT>
#	require valid-user
#    </Limit>
#</Location>

#
# Allow server status reports, with the URL of http://servername/server-status
# Change the ".your_domain.com" to match your domain to enable.
#
#<Location /server-status>
#    SetHandler server-status
#    Order deny,allow
#    Deny from all
#    Allow from .your_domain.com
#</Location>

#
# Allow remote server configuration reports, with the URL of
#  http://servername/server-info (requires that mod_info.c be loaded).
# Change the ".your_domain.com" to match your domain to enable.
#
#<Location /server-info>
#    SetHandler server-info
#    Order deny,allow
#    Deny from all
#    Allow from .your_domain.com
#</Location>

# Allow access to local system documentation from localhost.
# (Debian Policy assumes /usr/share/doc is "/doc/", at least from the 
localhost.)
Alias /doc/ /usr/share/doc/

<Location /doc>
   order deny,allow
   deny from all
   allow from 127.0.0.0/255.0.0.0
   Options Indexes FollowSymLinks
</Location>

#
# There have been reports of people trying to abuse an old bug from pre-1.1
# days.  This bug involved a CGI script distributed as a part of Apache.
# By uncommenting these lines you can redirect these attacks to a logging
# script on phf.apache.org.  Or, you can record them yourself, using the script
# support/phf_abuse_log.cgi.
#
#<Location /cgi-bin/phf*>
#    Deny from all
#    ErrorDocument 403 http://phf.apache.org/phf_abuse_log.cgi
#</Location>

<IfModule mod_proxy.c>
     #
     # Proxy Server directives. Uncomment the following lines to
     # enable the proxy server:
     #
     #<IfModule mod_proxy.c>
     #ProxyRequests On
     #
     #<Directory proxy:*>
     #    Order deny,allow
     #    Deny from all
     #    Allow from .your_domain.com
     #</Directory>
</IfModule>

#
# Enable/disable the handling of HTTP/1.1 "Via:" headers.
# ("Full" adds the server version; "Block" removes all outgoing Via: headers)
# Set to one of: Off | On | Full | Block
#
#ProxyVia On

#
# To enable the cache as well, edit and uncomment the following lines:
# (no cacheing without CacheRoot)
#
#CacheRoot "/var/cache/apache"
#CacheSize 5
#CacheGcInterval 4
#CacheMaxExpire 24
#CacheLastModifiedFactor 0.1
#CacheDefaultExpire 1
#NoCache a_domain.com another_domain.edu joes.garage_sale.com

#</IfModule>
# End of proxy directives.

### Section 3: Virtual Hosts
#
# VirtualHost: If you want to maintain multiple domains/hostnames on your
# machine you can setup VirtualHost containers for them.
# Please see the documentation at <URL:http://www.apache.org/docs/vhosts/>
# for further details before you try to setup virtual hosts.
# You may use the command line option '-S' to verify your virtual host
# configuration.

#
# If you want to use name-based virtual hosts you need to define at
# least one IP address (and port number) for them.
#
#NameVirtualHost 12.34.56.78:80
#NameVirtualHost 12.34.56.78

#
# VirtualHost example:
# Almost any Apache directive may go into a VirtualHost container.
#
#<VirtualHost ip.address.of.host.some_domain.com>
#    ServerAdmin webmaster@host.some_domain.com
#    DocumentRoot /www/docs/host.some_domain.com
#    ServerName host.some_domain.com
#    ErrorLog logs/host.some_domain.com-error.log
#    CustomLog logs/host.some_domain.com-access.log common
#</VirtualHost>

#<VirtualHost _default_:*>
#</VirtualHost>

# Automatically added by the post-installation script
# as part of the transition to a config directory layout
# similar to apache2, and that will help users to migrate
# from apache to apache2 or revert back easily
Include /etc/apache/conf.d



HERE'S THE MODULES.CONF:
# Autogenerated file - do not edit!
# This file is maintained by the apache package.
# To update it, run the command:
#    /usr/sbin/apache-modconf apache
ClearModuleList
AddModule mod_so.c
AddModule mod_macro.c
LoadModule config_log_module /usr/lib/apache/1.3/mod_log_config.so
LoadModule mime_module /usr/lib/apache/1.3/mod_mime.so
LoadModule negotiation_module /usr/lib/apache/1.3/mod_negotiation.so
LoadModule status_module /usr/lib/apache/1.3/mod_status.so
LoadModule autoindex_module /usr/lib/apache/1.3/mod_autoindex.so
LoadModule dir_module /usr/lib/apache/1.3/mod_dir.so
LoadModule cgi_module /usr/lib/apache/1.3/mod_cgi.so
LoadModule userdir_module /usr/lib/apache/1.3/mod_userdir.so
LoadModule alias_module /usr/lib/apache/1.3/mod_alias.so
LoadModule rewrite_module /usr/lib/apache/1.3/mod_rewrite.so
LoadModule access_module /usr/lib/apache/1.3/mod_access.so
LoadModule auth_module /usr/lib/apache/1.3/mod_auth.so
LoadModule expires_module /usr/lib/apache/1.3/mod_expires.so
LoadModule unique_id_module /usr/lib/apache/1.3/mod_unique_id.so
LoadModule setenvif_module /usr/lib/apache/1.3/mod_setenvif.so
LoadModule ssl_module /usr/lib/apache/1.3/mod_ssl.so
LoadModule php4_module /usr/lib/apache/1.3/libphp4.so
LoadModule python_module /usr/lib/apache/1.3/mod_python.so


Thanks for the help...

Brandon




From bmasters at direcway.com  Wed Jan 26 11:06:27 2005
From: bmasters at direcway.com (Brandon Masterson)
Date: Wed Jan 26 11:07:24 2005
Subject: [mod_python] Apache1.3.33 + Python2.3.4 + mod_python - Can't get
	Python templates to work
In-Reply-To: <5.1.0.14.0.20050126071004.00b37638@pop3.direcway.com>
References: <D3F85C7C-6F8E-11D9-952F-000393DCF16E@dscpl.com.au>
	<5.1.0.14.0.20050125233759.00bb0610@pop3.direcway.com>
	<5.1.0.14.0.20050125071338.00bccda8@pop3.direcway.com>
	<5.1.0.14.0.20050125071338.00bccda8@pop3.direcway.com>
	<5.1.0.14.0.20050125233759.00bb0610@pop3.direcway.com>
Message-ID: <5.1.0.14.0.20050126080520.033e6f08@pop3.direcway.com>

Oh and the error log:

[Wed Jan 26 09:12:30 2005] [notice] mod_python: (Re)importing 
mod_python.publisher from None
[Wed Jan 26 09:12:30 2005] [notice] mod_python: (Re)importing a from 
['/var/www/pythontest']


From nicolas.lehuen at gmail.com  Wed Jan 26 13:49:04 2005
From: nicolas.lehuen at gmail.com (Nicolas Lehuen)
Date: Wed Jan 26 13:49:06 2005
Subject: [mod_python] Broken pipe
In-Reply-To: <200501261631.02455.lroubeyrie@limair.asso.fr>
References: <200501261631.02455.lroubeyrie@limair.asso.fr>
Message-ID: <c298f2d7050126104930e5b8a4@mail.gmail.com>

The working directory of a published module is /, therefore your file
can't be found. Try putting an absolute path, then if it works, try
building the path based on the __file__ global variable :
os.path.dirname(__file__)+os.sep+'tutu.eps'

Regards,
Nicolas


On Wed, 26 Jan 2005 16:31:02 +0100, Lionel Roubeyrie
<lroubeyrie@limair.asso.fr> wrote:
> Hi all,
> I need to transform a .eps file into a .jpg or .png file. Using a simple
> script with the PIL works fine:
> #################################
> def convert(infile, outfile):
>     import Image
>     fp = Image.open(infile)
>     fp.save(outfile)
>     return outfile
> #################################
> 
> then convert('tutu.eps', 'tutu.jpg') is ok, not if I call it in mod_python:
> #################################
> File "/home/lionel/cartair.py", line 502, in convert
>     fp.save(outfile)
>   File "/usr/lib/python2.3/site-packages/PIL/Image.py", line 1125, in save
>     self.load()
>   File "/usr/lib/python2.3/site-packages/PIL/EpsImagePlugin.py", line 282, in
> load
>     self.im = Ghostscript(self.tile, self.size, self.fp)
>   File "/usr/lib/python2.3/site-packages/PIL/EpsImagePlugin.py", line 73, in
> Ghostscript
>     gs.write(s)
> IOError: [Errno 32] Broken pipe
> #################################
> Do I have to change something?
> Thanks
> 
> --
> Lionel Roubeyrie - lroubeyrie@limair.asso.fr
> LIMAIR
> http://www.limair.asso.fr
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From nicolas.lehuen at gmail.com  Wed Jan 26 13:51:50 2005
From: nicolas.lehuen at gmail.com (Nicolas Lehuen)
Date: Wed Jan 26 13:51:52 2005
Subject: [mod_python] Apache1.3.33 + Python2.3.4 + mod_python - Can't get
	Python templates to work
In-Reply-To: <5.1.0.14.0.20050126080520.033e6f08@pop3.direcway.com>
References: <D3F85C7C-6F8E-11D9-952F-000393DCF16E@dscpl.com.au>
	<5.1.0.14.0.20050125071338.00bccda8@pop3.direcway.com>
	<5.1.0.14.0.20050125233759.00bb0610@pop3.direcway.com>
	<5.1.0.14.0.20050126071004.00b37638@pop3.direcway.com>
	<5.1.0.14.0.20050126080520.033e6f08@pop3.direcway.com>
Message-ID: <c298f2d705012610519ab5f0f@mail.gmail.com>

Please remove the "from simpletal import simpleTAL, simpleTALES" from
your test file and check what it does. Also, you should have a stack
trace written to error.log. Are you sure there isn't one ?

Regards,
Nicolas


On Wed, 26 Jan 2005 08:06:27 -0800, Brandon Masterson
<bmasters@direcway.com> wrote:
> Oh and the error log:
> 
> [Wed Jan 26 09:12:30 2005] [notice] mod_python: (Re)importing
> mod_python.publisher from None
> [Wed Jan 26 09:12:30 2005] [notice] mod_python: (Re)importing a from
> ['/var/www/pythontest']
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From grahamd at dscpl.com.au  Wed Jan 26 15:55:34 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Jan 26 15:56:56 2005
Subject: [mod_python] Apache1.3.33 + Python2.3.4 + mod_python - Can't get
	Python templates to work
In-Reply-To: <5.1.0.14.0.20050126071004.00b37638@pop3.direcway.com>
References: <5.1.0.14.0.20050125233759.00bb0610@pop3.direcway.com>
	<5.1.0.14.0.20050125071338.00bccda8@pop3.direcway.com>
	<5.1.0.14.0.20050125071338.00bccda8@pop3.direcway.com>
	<5.1.0.14.0.20050125233759.00bb0610@pop3.direcway.com>
	<5.1.0.14.0.20050126071004.00b37638@pop3.direcway.com>
Message-ID: <9FCCFF24-6FDC-11D9-952F-000393DCF16E@dscpl.com.au>


On 27/01/2005, at 2:37 AM, Brandon Masterson wrote:

> from simpletal import simpleTAL, simpleTALES
> import sys
> import os
>
> def index(req):
>    filepath = "%s/basic.html" % os.path.dirname(__file__)
>    templateFile = open (filepath, 'r')
>    templateFile.close()
>
> This gets me this error when I used 
> "http://192.168.0.12/pythontest/a.py" :
> 500 Internal Server Error
> The server encountered an internal error or misconfiguration and was 
> unable to complete your request.

If there was a problem with the import of TAL stuff, with PythonDebug 
enabled,
one would normally get a traceback displayed in the browser.

In my experience, a 500 error of this form has usually meant an error 
in the
config files. If other requests in the same directory are still working 
then
it is perhaps something more sinister. If other requests in the same 
directory
aren't working either but normal requests in other directories are, then
possibly a config problem in the local .htaccess file. Ar you using a 
.htaccess
file at all?

You have posted the full httpd.conf file which can at least look at. 
Although
when I said about posting the config, I sort of mean't just the 
Directory
directive block relevant to that directory from httpd.conf, or whatever 
you
have in the local .htaccess file.

BTW, the more sinister sort of thing that can happen is something like 
shared
library version clashes between Python modules, Apache, PHP and Perl 
for stuff
like expat library. Comes up quite a bit.

As Nicolas said, remove the TAL stuff first at least as that will 
eliminate
the possibility of a shared library problem if it happens to require 
expat.

Graham

From grahamd at dscpl.com.au  Wed Jan 26 16:03:26 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Jan 26 16:03:33 2005
Subject: [mod_python] Strange request.parsed_uri
In-Reply-To: <41F7A43E.3040603@rulim.de>
References: <41F7A43E.3040603@rulim.de>
Message-ID: <B8FD1562-6FDD-11D9-952F-000393DCF16E@dscpl.com.au>


On 27/01/2005, at 1:07 AM, Igor Stroh wrote:

> myHandler.py:
> ===============================================================
> from mod_python import apache
> def handler(REQUEST):
>    REQUEST.conditions = "text/plain"
>    REQUEST.send_http_header()
>    REQUEST.write("Parsed URI: %s\n" % str(REQUEST.parsed_uri))
>    return apache.OK
> ===============================================================

Can't help you on the parsed_uri stuff right this minute, but just
a suggestion about the handler and what possibly can be seen as
"best practice".

Instead of using "REQUEST", always use "req".

The reason for this is that if you ever decided to switch your code
to using mod_python.publisher, the "req" name is a bit magic and
must always be used as the parameter name for the request object.

This is because in mod_python.publisher, any form parameters will
be matched against the method parameter names. In doing this, the
req object is still available to be passed in, but will be passed in
only through a parameter called "req".

Thus, maintaining this convention might save you some confusion
later.

This is mainly from memory, although I had a quick check at the
code as well. Someone please correct me if I am wrong, especially
after that last stuff up I made. :-)

Graham


From rosendo.martinez at valdisme.com  Wed Jan 26 18:05:26 2005
From: rosendo.martinez at valdisme.com (Rosendo Martinez)
Date: Wed Jan 26 18:04:21 2005
Subject: [mod_python] pool and mps
In-Reply-To: <200501261700.j0QH02xK003074@modpython.org>
References: <200501261700.j0QH02xK003074@modpython.org>
Message-ID: <41F82236.1080500@valdisme.com>

Hi all,
this is a mps(by Daniel Popowich) and/or mod_python question.
How can i configurate a pool of db connections o a pool of objects?

Thanks for your help.
Rosendo.

From catunda at pobox.com  Wed Jan 26 18:14:52 2005
From: catunda at pobox.com (Marco Catunda)
Date: Wed Jan 26 18:17:41 2005
Subject: [mod_python] mod_python with xmlrplib
Message-ID: <41F8246C.2060702@pobox.com>

I haven't been able to use xmlrpclib with mod_python.
When I import xmlrpclib the apache server crash (segmentation fault),
the following code will be show it.

=====================================
from mod_python import apache
import xmlrpclib

def handler( req ):
         req.write("Hello World!")
         return apache.OK
=====================================

My system:
   RedHat ES 3
   Apache 2.0.52
   Python 2.4

Is there a way to fix it?

Thanks
--
Marco Catunda


From grahamd at dscpl.com.au  Wed Jan 26 18:36:40 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Jan 26 18:36:44 2005
Subject: [mod_python] mod_python with xmlrplib
Message-ID: <1106782600.27654@dscpl.user.openhosting.com>

Marco Catunda wrote ..
> I haven't been able to use xmlrpclib with mod_python.
> When I import xmlrpclib the apache server crash (segmentation fault),
> the following code will be show it.
> 
> =====================================
> from mod_python import apache
> import xmlrpclib
> 
> def handler( req ):
>          req.write("Hello World!")
>          return apache.OK
> =====================================
> 
> My system:
>    RedHat ES 3
>    Apache 2.0.52
>    Python 2.4
> 
> Is there a way to fix it?

The xmlrpclib module uses a Python XML module which looks like it tries
to use expat.

>>> import xmlrpclib
>>> import sys
>>> sys.modules.keys()
['cStringIO', 'copy_reg', 'sre_compile', '_sre', 'site', '__builtin__', 'xml.parsers.expat', 'xml._xmlplus', 'xml.parsers', 'xml.sys', '__main__', 'operator', 'xml.parsers.pyexpat', 'xml', 'posixpath', 'base64', 'binascii', 'pyexpat.errors', 'sre_constants', 're', 'os.path', 'stat', 'zipimport', 'string', 'warnings', 'UserDict', '_xmlplus', 'sys', 'readline', 'types', 'strop', 'sre', 'signal', 'xmlrpclib', 'linecache', 'posix', 'pyexpat.model', 'time', 'exceptions', 'sre_parse', 'os']

It is a frequent problem that the version of the expat shared library which
is used by the Python modules differs to that which Apache or PHP may
already be using. This difference can result in a server crash.

You should thus try to determine if you have multiple versions of expat
present and whether these different packages are using different versions.

On Linux, you might be able to use "ldd" to work this out by running it
on the "httpd" binary, as well as the appropriate .so Python module.

  ldd /somepath-to-apache-bin-dir/httpd
  ldd /somepath-to-python-module-dir/lib-dynload/pyexpat.so
  ldd /somepath-to-apache-module-dir/*php*.so

The paths will need to be adjusted obviously.

Please post the results of ldd if you can as am curious to see if this
does help, I have never suggested trying it before.

Graham
From christopher.jackson at gmail.com  Wed Jan 26 18:55:35 2005
From: christopher.jackson at gmail.com (Chris Jackson)
Date: Wed Jan 26 18:55:38 2005
Subject: [mod_python] mod_python with xmlrplib
In-Reply-To: <1106782600.27654@dscpl.user.openhosting.com>
References: <1106782600.27654@dscpl.user.openhosting.com>
Message-ID: <4d11484d05012615554f89493e@mail.gmail.com>

On a simliar note, I was just about to post an XML problem I had using
regular Python XML (minidom).

<myconfig>
mod_python version = 3.1.3
Apache version = 2.0.52
python version = 2.4
</myconfig>

...
from xml.dom import minidom
xmldoc = minidom.parse(myFile.xml)
...

After analyzing the logs files, I find segmentation faults occurring causing
the page to hand and never get displayed. I have tested this on two
separate systems and the results are the same.  

I will try the methods described above and see what happens.

~= Chris =~



On Wed, 26 Jan 2005 18:36:40 -0500, Graham Dumpleton
<grahamd@dscpl.com.au> wrote:
> Marco Catunda wrote ..
> > I haven't been able to use xmlrpclib with mod_python.
> > When I import xmlrpclib the apache server crash (segmentation fault),
> > the following code will be show it.
> >
> > =====================================
> > from mod_python import apache
> > import xmlrpclib
> >
> > def handler( req ):
> >          req.write("Hello World!")
> >          return apache.OK
> > =====================================
> >
> > My system:
> >    RedHat ES 3
> >    Apache 2.0.52
> >    Python 2.4
> >
> > Is there a way to fix it?
> 
> The xmlrpclib module uses a Python XML module which looks like it tries
> to use expat.
> 
> >>> import xmlrpclib
> >>> import sys
> >>> sys.modules.keys()
> ['cStringIO', 'copy_reg', 'sre_compile', '_sre', 'site', '__builtin__', 'xml.parsers.expat', 'xml._xmlplus', 'xml.parsers', 'xml.sys', '__main__', 'operator', 'xml.parsers.pyexpat', 'xml', 'posixpath', 'base64', 'binascii', 'pyexpat.errors', 'sre_constants', 're', 'os.path', 'stat', 'zipimport', 'string', 'warnings', 'UserDict', '_xmlplus', 'sys', 'readline', 'types', 'strop', 'sre', 'signal', 'xmlrpclib', 'linecache', 'posix', 'pyexpat.model', 'time', 'exceptions', 'sre_parse', 'os']
> 
> It is a frequent problem that the version of the expat shared library which
> is used by the Python modules differs to that which Apache or PHP may
> already be using. This difference can result in a server crash.
> 
> You should thus try to determine if you have multiple versions of expat
> present and whether these different packages are using different versions.
> 
> On Linux, you might be able to use "ldd" to work this out by running it
> on the "httpd" binary, as well as the appropriate .so Python module.
> 
>   ldd /somepath-to-apache-bin-dir/httpd
>   ldd /somepath-to-python-module-dir/lib-dynload/pyexpat.so
>   ldd /somepath-to-apache-module-dir/*php*.so
> 
> The paths will need to be adjusted obviously.
> 
> Please post the results of ldd if you can as am curious to see if this
> does help, I have never suggested trying it before.
> 
> Graham
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From christopher.jackson at gmail.com  Wed Jan 26 18:56:41 2005
From: christopher.jackson at gmail.com (Chris Jackson)
Date: Wed Jan 26 18:57:32 2005
Subject: [mod_python] mod_python with xmlrplib
In-Reply-To: <4d11484d05012615554f89493e@mail.gmail.com>
References: <1106782600.27654@dscpl.user.openhosting.com>
	<4d11484d05012615554f89493e@mail.gmail.com>
Message-ID: <4d11484d05012615563383f6d5@mail.gmail.com>

It should also be noted that this works fine in the python
interpreter, but crashes only during runtime when running in the
context of mod_python.

~= Chris =~


On Wed, 26 Jan 2005 18:55:35 -0500, Chris Jackson
<christopher.jackson@gmail.com> wrote:
> On a simliar note, I was just about to post an XML problem I had using
> regular Python XML (minidom).
> 
> <myconfig>
> mod_python version = 3.1.3
> Apache version = 2.0.52
> python version = 2.4
> </myconfig>
> 
> ...
> from xml.dom import minidom
> xmldoc = minidom.parse(myFile.xml)
> ...
> 
> After analyzing the logs files, I find segmentation faults occurring causing
> the page to hand and never get displayed. I have tested this on two
> separate systems and the results are the same.
> 
> I will try the methods described above and see what happens.
> 
> ~= Chris =~
> 
> 
> On Wed, 26 Jan 2005 18:36:40 -0500, Graham Dumpleton
> <grahamd@dscpl.com.au> wrote:
> > Marco Catunda wrote ..
> > > I haven't been able to use xmlrpclib with mod_python.
> > > When I import xmlrpclib the apache server crash (segmentation fault),
> > > the following code will be show it.
> > >
> > > =====================================
> > > from mod_python import apache
> > > import xmlrpclib
> > >
> > > def handler( req ):
> > >          req.write("Hello World!")
> > >          return apache.OK
> > > =====================================
> > >
> > > My system:
> > >    RedHat ES 3
> > >    Apache 2.0.52
> > >    Python 2.4
> > >
> > > Is there a way to fix it?
> >
> > The xmlrpclib module uses a Python XML module which looks like it tries
> > to use expat.
> >
> > >>> import xmlrpclib
> > >>> import sys
> > >>> sys.modules.keys()
> > ['cStringIO', 'copy_reg', 'sre_compile', '_sre', 'site', '__builtin__', 'xml.parsers.expat', 'xml._xmlplus', 'xml.parsers', 'xml.sys', '__main__', 'operator', 'xml.parsers.pyexpat', 'xml', 'posixpath', 'base64', 'binascii', 'pyexpat.errors', 'sre_constants', 're', 'os.path', 'stat', 'zipimport', 'string', 'warnings', 'UserDict', '_xmlplus', 'sys', 'readline', 'types', 'strop', 'sre', 'signal', 'xmlrpclib', 'linecache', 'posix', 'pyexpat.model', 'time', 'exceptions', 'sre_parse', 'os']
> >
> > It is a frequent problem that the version of the expat shared library which
> > is used by the Python modules differs to that which Apache or PHP may
> > already be using. This difference can result in a server crash.
> >
> > You should thus try to determine if you have multiple versions of expat
> > present and whether these different packages are using different versions.
> >
> > On Linux, you might be able to use "ldd" to work this out by running it
> > on the "httpd" binary, as well as the appropriate .so Python module.
> >
> >   ldd /somepath-to-apache-bin-dir/httpd
> >   ldd /somepath-to-python-module-dir/lib-dynload/pyexpat.so
> >   ldd /somepath-to-apache-module-dir/*php*.so
> >
> > The paths will need to be adjusted obviously.
> >
> > Please post the results of ldd if you can as am curious to see if this
> > does help, I have never suggested trying it before.
> >
> > Graham
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
>
From grahamd at dscpl.com.au  Wed Jan 26 18:58:35 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Jan 26 18:58:39 2005
Subject: [mod_python] mod_python with xmlrplib
Message-ID: <1106783915.3723@dscpl.user.openhosting.com>

Graham Dumpleton wrote ..
> On Linux, you might be able to use "ldd" to work this out by running it
> on the "httpd" binary, as well as the appropriate .so Python module.
> 
>   ldd /somepath-to-apache-bin-dir/httpd
>   ldd /somepath-to-python-module-dir/lib-dynload/pyexpat.so
>   ldd /somepath-to-apache-module-dir/*php*.so
> 
> The paths will need to be adjusted obviously.
> 
> Please post the results of ldd if you can as am curious to see if this
> does help, I have never suggested trying it before.

FWIW, below is what I got on a Linux box I have access to. Unfortunately
it doesn't show a dependency of pyexpat.so onto libexpat.so, which is
what I would have expected. This doesn't mean that pyexpat.so doesn't
still require the library, just that the dependency may not have been
encoded into the .so and instead that the .so expects it to somehow
have already been linked into the application or loaded by another module.
I can't though find another module which loads it. I could just be wrong
in thinking that pyexpat.so is the one that would require libexpat.so, the
name certainly suggests it might though.

Either way, look for the presence of multiple libexpat.so versions in
the /usr/lib directory. If there are, it suggests the potential for this
particular problem I am talking about.

[grahamd@dscpl grahamd]$ ldd /usr/sbin/httpd
        ....... deleted
        libexpat.so.0 => /usr/lib/libexpat.so.0 (0xb7e8c000)
        ....... deleted
[grahamd@dscpl grahamd]$ ldd /usr/lib/python2.3/lib-dynload/pyexpat.so 
        linux-gate.so.1 =>  (0xffffe000)
        libpthread.so.0 => /lib/tls/libpthread.so.0 (0xb7fc0000)
        libc.so.6 => /lib/tls/libc.so.6 (0xb7ea5000)
        /lib/ld-linux.so.2 => /lib/ld-linux.so.2 (0x80000000)
[grahamd@dscpl grahamd]$ ldd /etc/httpd/modules/*php*
        ....... deleted
        libexpat.so.0 => /usr/lib/libexpat.so.0 (0xb7dca000)
        ....... deleted
[grahamd@dscpl grahamd]$ ls -las /usr/lib/libexpat.so 
0 lrwxrwxrwx  1 root root 17 Dec  7 00:14 /usr/lib/libexpat.so -> libexpat.so.0.5.0
[grahamd@dscpl grahamd]$ ls -las /usr/lib/libexpat.so*
  0 lrwxrwxrwx   1 root root     17 Dec  7 00:14 /usr/lib/libexpat.so -> libexpat.so.0.5.0
  0 lrwxrwxrwx   1 root root     17 Dec  7 00:14 /usr/lib/libexpat.so.0 -> libexpat.so.0.5.0
128 -rwxr-xr-x  20 root root 126144 Oct 22 20:52 /usr/lib/libexpat.so.0.5.0
[
From craig.warren at encorp.com  Wed Jan 26 19:00:11 2005
From: craig.warren at encorp.com (Craig Warren)
Date: Wed Jan 26 19:00:36 2005
Subject: [mod_python] mod_python with xmlrplib
In-Reply-To: <41F8246C.2060702@pobox.com>
References: <41F8246C.2060702@pobox.com>
Message-ID: <41F82F0B.7050400@encorp.com>


I have found that you need version 1.95.8 of expat.  I had the same 
problem and  was using version 1.95.7 before Fedora Core  2

[cwarren@lapbob clean]$ rpm -qi expat
Name        : expat                        Relocations: (not relocatable)
Version     : 1.95.8                            Vendor: (none)
Release     : 4                             Build Date: Tue 28 Dec 2004 
02:55:23 PM MST
Install Date: Tue 28 Dec 2004 02:55:53 PM MST      Build Host: lapbob
Group       : System Environment/Libraries   Source RPM: 
expat-1.95.8-4.src.rpm
Size        : 157806                           License: BSD
Signature   : (none)
URL         : http://www.libexpat.org/
Summary     : A library for parsing XML.



Marco Catunda wrote:

> I haven't been able to use xmlrpclib with mod_python.
> When I import xmlrpclib the apache server crash (segmentation fault),
> the following code will be show it.
>
> =====================================
> from mod_python import apache
> import xmlrpclib
>
> def handler( req ):
>         req.write("Hello World!")
>         return apache.OK
> =====================================
>
> My system:
>   RedHat ES 3
>   Apache 2.0.52
>   Python 2.4
>
> Is there a way to fix it?
>
> Thanks
> -- 
> Marco Catunda
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python


From christopher.jackson at gmail.com  Wed Jan 26 19:03:53 2005
From: christopher.jackson at gmail.com (Chris Jackson)
Date: Wed Jan 26 19:04:50 2005
Subject: [mod_python] mod_python with xmlrplib
In-Reply-To: <4d11484d05012615563383f6d5@mail.gmail.com>
References: <1106782600.27654@dscpl.user.openhosting.com>
	<4d11484d05012615554f89493e@mail.gmail.com>
	<4d11484d05012615563383f6d5@mail.gmail.com>
Message-ID: <4d11484d05012616032f67e841@mail.gmail.com>

My results:

ldd httpd
======
        linux-gate.so.1 =>  (0xffffe000)
        libaprutil-0.so.0 => /usr/local/apache/lib/libaprutil-0.so.0
(0x40018000)
        libexpat.so.0 => /usr/lib/libexpat.so.0 (0x40037000)
        libapr-0.so.0 => /usr/local/apache/lib/libapr-0.so.0 (0x40059000)
        librt.so.1 => /lib/tls/librt.so.1 (0x40079000)
        libm.so.6 => /lib/tls/libm.so.6 (0x4008d000)
        libcrypt.so.1 => /lib/libcrypt.so.1 (0x400b0000)
        libnsl.so.1 => /lib/libnsl.so.1 (0x400dd000)
        libpthread.so.0 => /lib/tls/libpthread.so.0 (0x400f0000)
        libdl.so.2 => /lib/libdl.so.2 (0x40101000)
        libc.so.6 => /lib/tls/libc.so.6 (0x40104000)
        /lib/ld-linux.so.2 => /lib/ld-linux.so.2 (0x40000000)

ldd lib-dynload/pyexpat.so
==================
        linux-gate.so.1 =>  (0xffffe000)
        libpthread.so.0 => /lib/tls/libpthread.so.0 (0x40040000)
        libc.so.6 => /lib/tls/libc.so.6 (0x40051000)
        /lib/ld-linux.so.2 => /lib/ld-linux.so.2 (0x80000000)

PHP is not installed.

~= Chris =~

On Wed, 26 Jan 2005 18:56:41 -0500, Chris Jackson
<christopher.jackson@gmail.com> wrote:
> It should also be noted that this works fine in the python
> interpreter, but crashes only during runtime when running in the
> context of mod_python.
> 
> ~= Chris =~
> 
> 
> On Wed, 26 Jan 2005 18:55:35 -0500, Chris Jackson
> <christopher.jackson@gmail.com> wrote:
> > On a simliar note, I was just about to post an XML problem I had using
> > regular Python XML (minidom).
> >
> > <myconfig>
> > mod_python version = 3.1.3
> > Apache version = 2.0.52
> > python version = 2.4
> > </myconfig>
> >
> > ...
> > from xml.dom import minidom
> > xmldoc = minidom.parse(myFile.xml)
> > ...
> >
> > After analyzing the logs files, I find segmentation faults occurring causing
> > the page to hand and never get displayed. I have tested this on two
> > separate systems and the results are the same.
> >
> > I will try the methods described above and see what happens.
> >
> > ~= Chris =~
> >
> >
> > On Wed, 26 Jan 2005 18:36:40 -0500, Graham Dumpleton
> > <grahamd@dscpl.com.au> wrote:
> > > Marco Catunda wrote ..
> > > > I haven't been able to use xmlrpclib with mod_python.
> > > > When I import xmlrpclib the apache server crash (segmentation fault),
> > > > the following code will be show it.
> > > >
> > > > =====================================
> > > > from mod_python import apache
> > > > import xmlrpclib
> > > >
> > > > def handler( req ):
> > > >          req.write("Hello World!")
> > > >          return apache.OK
> > > > =====================================
> > > >
> > > > My system:
> > > >    RedHat ES 3
> > > >    Apache 2.0.52
> > > >    Python 2.4
> > > >
> > > > Is there a way to fix it?
> > >
> > > The xmlrpclib module uses a Python XML module which looks like it tries
> > > to use expat.
> > >
> > > >>> import xmlrpclib
> > > >>> import sys
> > > >>> sys.modules.keys()
> > > ['cStringIO', 'copy_reg', 'sre_compile', '_sre', 'site', '__builtin__', 'xml.parsers.expat', 'xml._xmlplus', 'xml.parsers', 'xml.sys', '__main__', 'operator', 'xml.parsers.pyexpat', 'xml', 'posixpath', 'base64', 'binascii', 'pyexpat.errors', 'sre_constants', 're', 'os.path', 'stat', 'zipimport', 'string', 'warnings', 'UserDict', '_xmlplus', 'sys', 'readline', 'types', 'strop', 'sre', 'signal', 'xmlrpclib', 'linecache', 'posix', 'pyexpat.model', 'time', 'exceptions', 'sre_parse', 'os']
> > >
> > > It is a frequent problem that the version of the expat shared library which
> > > is used by the Python modules differs to that which Apache or PHP may
> > > already be using. This difference can result in a server crash.
> > >
> > > You should thus try to determine if you have multiple versions of expat
> > > present and whether these different packages are using different versions.
> > >
> > > On Linux, you might be able to use "ldd" to work this out by running it
> > > on the "httpd" binary, as well as the appropriate .so Python module.
> > >
> > >   ldd /somepath-to-apache-bin-dir/httpd
> > >   ldd /somepath-to-python-module-dir/lib-dynload/pyexpat.so
> > >   ldd /somepath-to-apache-module-dir/*php*.so
> > >
> > > The paths will need to be adjusted obviously.
> > >
> > > Please post the results of ldd if you can as am curious to see if this
> > > does help, I have never suggested trying it before.
> > >
> > > Graham
> > > _______________________________________________
> > > Mod_python mailing list
> > > Mod_python@modpython.org
> > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > >
> >
>
From grahamd at dscpl.com.au  Wed Jan 26 19:14:09 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Jan 26 19:14:12 2005
Subject: [mod_python] mod_python with xmlrplib
Message-ID: <1106784849.10313@dscpl.user.openhosting.com>

Craig Warren wrote ..
> 
> I have found that you need version 1.95.8 of expat.  I had the same 
> problem and  was using version 1.95.7 before Fedora Core  2
> 
> [cwarren@lapbob clean]$ rpm -qi expat
> Name        : expat                        Relocations: (not relocatable)
> Version     : 1.95.8                            Vendor: (none)

That sounds like a good theory to me. The particular Linux box I
have access to has:

Name        : expat                        Relocations: (not relocatable)
Version     : 1.95.7                            Vendor: Red Hat, Inc.
Release     : 1.1                           Build Date: Tue 02 Mar 2004 07:43:45

I justed test xmlrpclib under mod_python on it and it did indeed
crash Apache.

Good thing to know as I was just about to move my site to the box
and would have been using xmlrpclib in some stuff.

Thanks.

Graham
From davidf at sjsoft.com  Wed Jan 26 23:47:09 2005
From: davidf at sjsoft.com (David Fraser)
Date: Wed Jan 26 23:47:15 2005
Subject: [mod_python] mod_python with xmlrplib
In-Reply-To: <1106782600.27654@dscpl.user.openhosting.com>
References: <1106782600.27654@dscpl.user.openhosting.com>
Message-ID: <41F8724D.2080109@sjsoft.com>

Graham Dumpleton wrote:

>Marco Catunda wrote ..
>  
>
>>I haven't been able to use xmlrpclib with mod_python.
>>When I import xmlrpclib the apache server crash (segmentation fault),
>>the following code will be show it.
>>
>>=====================================
>>from mod_python import apache
>>import xmlrpclib
>>
>>def handler( req ):
>>         req.write("Hello World!")
>>         return apache.OK
>>=====================================
>>
>>My system:
>>   RedHat ES 3
>>   Apache 2.0.52
>>   Python 2.4
>>
>>Is there a way to fix it?
>>    
>>
>
>The xmlrpclib module uses a Python XML module which looks like it tries
>to use expat.
>
>  
>
>>>>import xmlrpclib
>>>>import sys
>>>>sys.modules.keys()
>>>>        
>>>>
>['cStringIO', 'copy_reg', 'sre_compile', '_sre', 'site', '__builtin__', 'xml.parsers.expat', 'xml._xmlplus', 'xml.parsers', 'xml.sys', '__main__', 'operator', 'xml.parsers.pyexpat', 'xml', 'posixpath', 'base64', 'binascii', 'pyexpat.errors', 'sre_constants', 're', 'os.path', 'stat', 'zipimport', 'string', 'warnings', 'UserDict', '_xmlplus', 'sys', 'readline', 'types', 'strop', 'sre', 'signal', 'xmlrpclib', 'linecache', 'posix', 'pyexpat.model', 'time', 'exceptions', 'sre_parse', 'os']
>
>It is a frequent problem that the version of the expat shared library which
>is used by the Python modules differs to that which Apache or PHP may
>already be using. This difference can result in a server crash.
>
>You should thus try to determine if you have multiple versions of expat
>present and whether these different packages are using different versions.
>
>On Linux, you might be able to use "ldd" to work this out by running it
>on the "httpd" binary, as well as the appropriate .so Python module.
>
>  ldd /somepath-to-apache-bin-dir/httpd
>  ldd /somepath-to-python-module-dir/lib-dynload/pyexpat.so
>  ldd /somepath-to-apache-module-dir/*php*.so
>
>The paths will need to be adjusted obviously.
>
>Please post the results of ldd if you can as am curious to see if this
>does help, I have never suggested trying it before.
>
>Graham
>
>  
>
Since this is a common problem, I wonder if there may be a way to put 
checks into the Python modules that use expat to prevent this happening?

David
From grahamd at dscpl.com.au  Thu Jan 27 00:37:51 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Jan 27 00:37:53 2005
Subject: [mod_python] mod_python with xmlrplib
Message-ID: <1106804271.3504@dscpl.user.openhosting.com>

David Fraser wrote ..
> >It is a frequent problem that the version of the expat shared library
> which
> >is used by the Python modules differs to that which Apache or PHP may
> >already be using. This difference can result in a server crash.
> >
> >You should thus try to determine if you have multiple versions of expat
> >present and whether these different packages are using different versions.
> >
> >On Linux, you might be able to use "ldd" to work this out by running it
> >on the "httpd" binary, as well as the appropriate .so Python module.
> >
> >  ldd /somepath-to-apache-bin-dir/httpd
> >  ldd /somepath-to-python-module-dir/lib-dynload/pyexpat.so
> >  ldd /somepath-to-apache-module-dir/*php*.so
> >
> >The paths will need to be adjusted obviously.
> >
> >Please post the results of ldd if you can as am curious to see if this
> >does help, I have never suggested trying it before.
> >
> Since this is a common problem, I wonder if there may be a way to put 
> checks into the Python modules that use expat to prevent this happening?

Probably not very easy to determine. Trying ldd was an attempt to understand
the problem better and see if that might help but in the end it didn't show
anything that would help.

In this case, it actually didn't turn out to be a problem with different
incompatible versions of libexpat.so, but a buggy one. Using next minor
point revision of library, without even recompiling looks like it may fix
it. I'll be able to confirm that on site I can access later.

When we have a clearer picture of the situation, should at least perhaps
be mentioned in the FAQ.

Graham
From snacktime at gmail.com  Thu Jan 27 01:42:14 2005
From: snacktime at gmail.com (snacktime)
Date: Thu Jan 27 01:42:18 2005
Subject: [mod_python] namespaces in publisher
Message-ID: <1f060c4c0501262242194ef343@mail.gmail.com>

Do variables defined in the main function called by publisher persist
after the request?

Also, how do you destroy an instance of a class?  Do you just assign
it a value of None?  And if you call a class from within a function,
when you leave the function the class instance is destroyed unless the
function returns the instance to the caller correct?

Chris
From bmasters at direcway.com  Thu Jan 27 01:42:40 2005
From: bmasters at direcway.com (Brandon Masterson)
Date: Thu Jan 27 01:54:36 2005
Subject: [mod_python] Apache1.3.33 + Python2.3.4 + mod_python - Can't get
	Python templates to work
In-Reply-To: <c298f2d705012610519ab5f0f@mail.gmail.com>
References: <5.1.0.14.0.20050126080520.033e6f08@pop3.direcway.com>
	<D3F85C7C-6F8E-11D9-952F-000393DCF16E@dscpl.com.au>
	<5.1.0.14.0.20050125071338.00bccda8@pop3.direcway.com>
	<5.1.0.14.0.20050125233759.00bb0610@pop3.direcway.com>
	<5.1.0.14.0.20050126071004.00b37638@pop3.direcway.com>
	<5.1.0.14.0.20050126080520.033e6f08@pop3.direcway.com>
Message-ID: <5.1.0.14.0.20050126201043.00bcfaa8@pop3.direcway.com>

Commented out as requested and got the same 500 error message below:

    500 Internal Server Error
    The server encountered an internal error or misconfiguration and was 
unable to complete your request.
    Please contact the server administrator, webmaster@Knoppix and inform 
them of the time the error occurred,
    and anything you might have done that may have caused the error.
    More information about this error may be available in the server error log.
    Apache/1.3.33 Server at 192.168.0.12 Port 80

How I called it: http://192.168.0.12/pythontest/a.py

Did it 3 times in a row and this is what the error log showed:

[Wed Jan 26 22:36:20 2005] [notice] mod_python: (Re)importing a from 
['/var/www/pythontest']
[Wed Jan 26 22:36:21 2005] [notice] mod_python: (Re)importing a from 
['/var/www/pythontest']
[Wed Jan 26 22:36:22 2005] [notice] mod_python: (Re)importing a from 
['/var/www/pythontest']

EXAMPLE 1
--------------------------------------------------------------------------------------------------------------------------------------------
Okay, so here's a simple script that I believe demos things are working:

from mod_python import util
from mod_python import apache
import os

def hello(name=None):
      if name:
          return 'Hello, %s!' % name.capitalize()
      else:
          return 'Hello there! %s ' % os.path.dirname(__file__)

PRODUCES ON THE BROWSER:
Hello there! /var/www/pythontest


EXAMPLE 2
--------------------------------------------------------------------------------------------------------------------------------------------
Okay, here's a simple script that I believe demos things are working:

from mod_python import util
from mod_python import apache
import os

def page(req):
      req.content_type = 'text/html'
      req.write('<html><head><title>Available Projects</title></head>')
      req.write('<body><h1>Available Projects</h1><ul>')
      req.write('Processing ')
      req.write('</ul></body><html>')

PRODUCES ON THE BROWSER:

Available Projects

       Processing

HTTP/1.1 500 Internal Server Error Date: Thu, 27 Jan 2005 04:37:26 GMT 
Server: Apache/1.3.33 (Debian GNU/Linux) mod_python/2.7.10 Python/2.3.4 
PHP/4.3.8-5 mod_ssl/2.8.22 OpenSSL/0.9.7d Connection: close 
Transfer-Encoding: chunked Content-Type: text/html; charset=iso-8859-1 252
Internal Server Error
The server encountered an internal error or misconfiguration and was unable 
to complete your request.

Please contact the server administrator, webmaster@Knoppix and inform them 
of the time the error occurred, and anything you might have done that may 
have caused the error.

More information about this error may be available in the server error log.

Apache/1.3.33 Server at 192.168.0.12 Port 80
0

ERROR LOG:
[Wed Jan 26 23:37:26 2005] [notice] mod_python: (Re)importing h from 
['/var/www/pythontest']


From nicolas.lehuen at gmail.com  Thu Jan 27 02:06:28 2005
From: nicolas.lehuen at gmail.com (Nicolas Lehuen)
Date: Thu Jan 27 02:06:31 2005
Subject: [mod_python] pool and mps
In-Reply-To: <41F82236.1080500@valdisme.com>
References: <200501261700.j0QH02xK003074@modpython.org>
	<41F82236.1080500@valdisme.com>
Message-ID: <c298f2d7050126230633ec6d3a@mail.gmail.com>

Hi,

There is no standard way to do it. First, if you are using the Apache
mpm_prefork (the forked MPM), the efficiency of pooling will be very
low, since your pool will be instantiated as many times as there are
Apache processes.

I'm using the threaded MPM, and I built my own DB connection pool. The
best place to instantiate the DB connection pool is in a module on the
PYTHONPATH, which will be imported from any published modules. This
way, you are guaranteed that the pool will be instantiated only once.

As for the pool code, I'll publish it eventually... It's not really
difficult to write one, but threading and locking issues can be a
little tricky to get right.

Regards,
Nicolas

On Thu, 27 Jan 2005 00:05:26 +0100, Rosendo Martinez
<rosendo.martinez@valdisme.com> wrote:
> Hi all,
> this is a mps(by Daniel Popowich) and/or mod_python question.
> How can i configurate a pool of db connections o a pool of objects?
> 
> Thanks for your help.
> Rosendo.
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From nicolas.lehuen at gmail.com  Thu Jan 27 02:09:02 2005
From: nicolas.lehuen at gmail.com (Nicolas Lehuen)
Date: Thu Jan 27 02:09:04 2005
Subject: [mod_python] mod_python with xmlrplib
In-Reply-To: <1106804271.3504@dscpl.user.openhosting.com>
References: <1106804271.3504@dscpl.user.openhosting.com>
Message-ID: <c298f2d7050126230928922a72@mail.gmail.com>

On Thu, 27 Jan 2005 00:37:51 -0500, Graham Dumpleton
<grahamd@dscpl.com.au> wrote:
> > Since this is a common problem, I wonder if there may be a way to put
> > checks into the Python modules that use expat to prevent this happening?
> 
> Probably not very easy to determine. Trying ldd was an attempt to understand
> the problem better and see if that might help but in the end it didn't show
> anything that would help.
> 
> In this case, it actually didn't turn out to be a problem with different
> incompatible versions of libexpat.so, but a buggy one. Using next minor
> point revision of library, without even recompiling looks like it may fix
> it. I'll be able to confirm that on site I can access later.
> 
> When we have a clearer picture of the situation, should at least perhaps
> be mentioned in the FAQ.
> 
> Graham

Am I dreaming, or is this an instance of DLL Hell under Linux ? ;)

Nicolas
From nicolas.lehuen at gmail.com  Thu Jan 27 02:30:51 2005
From: nicolas.lehuen at gmail.com (Nicolas Lehuen)
Date: Thu Jan 27 02:30:53 2005
Subject: [mod_python] namespaces in publisher
In-Reply-To: <1f060c4c0501262242194ef343@mail.gmail.com>
References: <1f060c4c0501262242194ef343@mail.gmail.com>
Message-ID: <c298f2d7050126233049486671@mail.gmail.com>

On Wed, 26 Jan 2005 22:42:14 -0800, snacktime <snacktime@gmail.com> wrote:
> Do variables defined in the main function called by publisher persist
> after the request?
> 
> Also, how do you destroy an instance of a class?  Do you just assign
> it a value of None?  And if you call a class from within a function,
> when you leave the function the class instance is destroyed unless the
> function returns the instance to the caller correct?
> 
> Chris
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 

Hi,

Those are Python-specific questions, not mod_python questions. You
have to learn the difference between global and local variables, or
more precisely how Python handle its namespaces. Do not hesitate to
read the Python Tutorial (or any other Python tutorial) :

http://docs.python.org/tut/tut.html

I'll try to answer your questions, though :

1) No, variables defined in functions are not persisted. Those
variables are only defined in a scope which is dynamically created
each time the function is called. When the function exits, the scope
is destroyed, so next time the function will be called, it will be in
a news scope, with new variables.

2) You can't explicitely destroy objects in Python. Python, like many
other languages now, handles memory automatically. Once an object is
not referenced anywhere in a program, it can be safely removed from
memory. All you can do in Python is to dereference an object with the
'del' keyword (have a look at the documentation), but generally you
don't have to worry about this.

3) Like I wrote in 1), any object which is created is initially
referenced in the local scope of the function. If you do not return
this object, it will be dereferenced at the end of the call since the
local scope will be destructed. If you return the object, when the
local scope is destructed, the object will not be destructed since it
will be referenced somewhere else (in the local scope of the calling
function).

What you must understand is that "it just works". You don't have to
worry about object allocation and destruction. Objects are
automatically destroyed when it is safe. The only thing you have to
understand is how scope are created and destroyed (which is a totally
different mechanism than object allocation/destruction) ; fortunately
it's nearly the same scoping rule as in other languages.

Regards,
Nicolas
From bmasters at direcway.com  Thu Jan 27 02:32:55 2005
From: bmasters at direcway.com (Brandon Masterson)
Date: Thu Jan 27 02:35:02 2005
Subject: [mod_python] Apache1.3.33 + Python2.3.4 + mod_python - Can't get
	Python templates to work
In-Reply-To: <9FCCFF24-6FDC-11D9-952F-000393DCF16E@dscpl.com.au>
References: <5.1.0.14.0.20050126071004.00b37638@pop3.direcway.com>
	<5.1.0.14.0.20050125233759.00bb0610@pop3.direcway.com>
	<5.1.0.14.0.20050125071338.00bccda8@pop3.direcway.com>
	<5.1.0.14.0.20050125071338.00bccda8@pop3.direcway.com>
	<5.1.0.14.0.20050125233759.00bb0610@pop3.direcway.com>
	<5.1.0.14.0.20050126071004.00b37638@pop3.direcway.com>
Message-ID: <5.1.0.14.0.20050126224321.03417738@pop3.direcway.com>


>
>If there was a problem with the import of TAL stuff, with PythonDebug enabled,
>one would normally get a traceback displayed in the browser.

Confirmed, I was not getting tracebacks with this last set of examples.  In 
the original posting I had several scripts with tracebacks.

>If other requests in the same directory are still working then
>it is perhaps something more sinister.

Yes other requests are working in the directory per my other email.

>Are you using a .htaccess
>file at all?

I don't believe so though the apache config file is not something I've 
researched much, modifying it very little to get the basic server up and 
running for my perl-based template system.

>...I sort of mean't just the Directory...

Sorry, didn't understand that, thus the full http config.

>BTW, the more sinister sort of thing that can happen is something like shared
>library version clashes between Python modules, Apache, PHP and Perl for stuff
>like expat library. Comes up quite a bit.

Tried commenting out the PHP apache module and restarted apache but that 
didn't change the result.

Can you point me to a simple, known-to-work script using templates that I 
could use to verify my configuration?  I've tried pasting in examples from 
many of the templating websites with no luck.

Your help is appreciated.

Brandon


From grahamd at dscpl.com.au  Thu Jan 27 04:29:56 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Jan 27 04:31:21 2005
Subject: [mod_python] Apache1.3.33 + Python2.3.4 + mod_python - Can't get
	Python templates to work
In-Reply-To: <5.1.0.14.0.20050126201043.00bcfaa8@pop3.direcway.com>
References: <5.1.0.14.0.20050126080520.033e6f08@pop3.direcway.com>
	<D3F85C7C-6F8E-11D9-952F-000393DCF16E@dscpl.com.au>
	<5.1.0.14.0.20050125071338.00bccda8@pop3.direcway.com>
	<5.1.0.14.0.20050125233759.00bb0610@pop3.direcway.com>
	<5.1.0.14.0.20050126071004.00b37638@pop3.direcway.com>
	<5.1.0.14.0.20050126080520.033e6f08@pop3.direcway.com>
	<5.1.0.14.0.20050126201043.00bcfaa8@pop3.direcway.com>
Message-ID: <01CE58F9-7046-11D9-A6B9-000393DCF16E@dscpl.com.au>


On 27/01/2005, at 5:42 PM, Brandon Masterson wrote:
> EXAMPLE 2
> ----------------------------------------------------------------------- 
> ---------------------------------------------------------------------
> Okay, here's a simple script that I believe demos things are working:
>
> from mod_python import util
> from mod_python import apache
> import os
>
> def page(req):
>      req.content_type = 'text/html'
>      req.write('<html><head><title>Available Projects</title></head>')
>      req.write('<body><h1>Available Projects</h1><ul>')
>      req.write('Processing ')
>      req.write('</ul></body><html>')
>
> PRODUCES ON THE BROWSER:
>
> Available Projects
>
>       Processing
>
> HTTP/1.1 500 Internal Server Error Date: Thu, 27 Jan 2005 04:37:26 GMT  
> Server: Apache/1.3.33 (Debian GNU/Linux) mod_python/2.7.10  
> Python/2.3.4 PHP/4.3.8-5 mod_ssl/2.8.22 OpenSSL/0.9.7d Connection:  
> close Transfer-Encoding: chunked Content-Type: text/html;  
> charset=iso-8859-1 252
> Internal Server Error
> The server encountered an internal error or misconfiguration and was  
> unable to complete your request.
>
> Please contact the server administrator, webmaster@Knoppix and inform  
> them of the time the error occurred, and anything you might have done  
> that may have caused the error.
>
> More information about this error may be available in the server error  
> log.
>
> Apache/1.3.33 Server at 192.168.0.12 Port 80
> 0
>
> ERROR LOG:
> [Wed Jan 26 23:37:26 2005] [notice] mod_python: (Re)importing h from  
> ['/var/www/pythontest']

Okay, understand now. I didn't notice that you were using mod_python  
2.7.10 before.

What you have found is a bug in 2.7.10. Namely, that you will get a 500  
server
error if you do not return anything, or return an empty string from the  
method.

Add:

   return " "

at the end of the method. Ie., string containing a single character and  
it looks
like it will work.

Weird. The code works fine on 3.X mod_python. Ie., handles no return  
value.

Graham

From grisha at modpython.org  Thu Jan 27 10:21:02 2005
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Thu Jan 27 10:21:12 2005
Subject: [mod_python] mod_python with xmlrplib
In-Reply-To: <4d11484d05012616032f67e841@mail.gmail.com>
References: <1106782600.27654@dscpl.user.openhosting.com>
	<4d11484d05012615554f89493e@mail.gmail.com>
	<4d11484d05012615563383f6d5@mail.gmail.com>
	<4d11484d05012616032f67e841@mail.gmail.com>
Message-ID: <20050127101849.P31392@grisha.dyndns.org>


On Wed, 26 Jan 2005, Chris Jackson wrote:

> My results:
>
> ldd httpd
> ======
>        linux-gate.so.1 =>  (0xffffe000)
>        libaprutil-0.so.0 => /usr/local/apache/lib/libaprutil-0.so.0
> (0x40018000)
>        libexpat.so.0 => /usr/lib/libexpat.so.0 (0x40037000)
>        libapr-0.so.0 => /usr/local/apache/lib/libapr-0.so.0 (0x40059000)
>        librt.so.1 => /lib/tls/librt.so.1 (0x40079000)
>        libm.so.6 => /lib/tls/libm.so.6 (0x4008d000)
>        libcrypt.so.1 => /lib/libcrypt.so.1 (0x400b0000)
>        libnsl.so.1 => /lib/libnsl.so.1 (0x400dd000)
>        libpthread.so.0 => /lib/tls/libpthread.so.0 (0x400f0000)
>        libdl.so.2 => /lib/libdl.so.2 (0x40101000)
>        libc.so.6 => /lib/tls/libc.so.6 (0x40104000)
>        /lib/ld-linux.so.2 => /lib/ld-linux.so.2 (0x40000000)
>
> ldd lib-dynload/pyexpat.so
> ==================
>        linux-gate.so.1 =>  (0xffffe000)
>        libpthread.so.0 => /lib/tls/libpthread.so.0 (0x40040000)
>        libc.so.6 => /lib/tls/libc.so.6 (0x40051000)
>        /lib/ld-linux.so.2 => /lib/ld-linux.so.2 (0x80000000)

So this looks like httpd is using a dynamic libexpat, while pyexpat.so 
doesn't which means it is probably statically linked?

Grisha
From mark at gsoa.net  Thu Jan 27 10:29:10 2005
From: mark at gsoa.net (Mark McClain)
Date: Thu Jan 27 10:29:19 2005
Subject: [mod_python] mod_python with xmlrplib
In-Reply-To: <41F8724D.2080109@sjsoft.com>
References: <1106782600.27654@dscpl.user.openhosting.com>
	<41F8724D.2080109@sjsoft.com>
Message-ID: <50b65a4daa1e903c2b48c74714dbedee@gsoa.net>

This is probably has something do to with the library conflicts.  Our 
production servers (mod_python 3.1.x, apache 2.0.x, python 2.3.x) has 
been using xmlrpclib for over a year without any crashes.

Have you compiled your own versions of apache,mod_python, and python?  
Or are you using the stock redhat versions?

Mark

On Jan 26, 2005, at 11:47 PM, David Fraser wrote:

> Graham Dumpleton wrote:
>
>> Marco Catunda wrote ..
>>
>>> I haven't been able to use xmlrpclib with mod_python.
>>> When I import xmlrpclib the apache server crash (segmentation fault),
>>> the following code will be show it.
>>>
>>> =====================================
>>> from mod_python import apache
>>> import xmlrpclib
>>>
>>> def handler( req ):
>>>         req.write("Hello World!")
>>>         return apache.OK
>>> =====================================
>>>
>>> My system:
>>>   RedHat ES 3
>>>   Apache 2.0.52
>>>   Python 2.4
>>>
>>> Is there a way to fix it?
>>>
>>
>> The xmlrpclib module uses a Python XML module which looks like it 
>> tries
>> to use expat.
>>
>>
>>>>> import xmlrpclib
>>>>> import sys
>>>>> sys.modules.keys()
>>>>>
>> ['cStringIO', 'copy_reg', 'sre_compile', '_sre', 'site', 
>> '__builtin__', 'xml.parsers.expat', 'xml._xmlplus', 'xml.parsers', 
>> 'xml.sys', '__main__', 'operator', 'xml.parsers.pyexpat', 'xml', 
>> 'posixpath', 'base64', 'binascii', 'pyexpat.errors', 'sre_constants', 
>> 're', 'os.path', 'stat', 'zipimport', 'string', 'warnings', 
>> 'UserDict', '_xmlplus', 'sys', 'readline', 'types', 'strop', 'sre', 
>> 'signal', 'xmlrpclib', 'linecache', 'posix', 'pyexpat.model', 'time', 
>> 'exceptions', 'sre_parse', 'os']
>>
>> It is a frequent problem that the version of the expat shared library 
>> which
>> is used by the Python modules differs to that which Apache or PHP may
>> already be using. This difference can result in a server crash.
>>
>> You should thus try to determine if you have multiple versions of 
>> expat
>> present and whether these different packages are using different 
>> versions.
>>
>> On Linux, you might be able to use "ldd" to work this out by running 
>> it
>> on the "httpd" binary, as well as the appropriate .so Python module.
>>
>>  ldd /somepath-to-apache-bin-dir/httpd
>>  ldd /somepath-to-python-module-dir/lib-dynload/pyexpat.so
>>  ldd /somepath-to-apache-module-dir/*php*.so
>>
>> The paths will need to be adjusted obviously.
>>
>> Please post the results of ldd if you can as am curious to see if this
>> does help, I have never suggested trying it before.
>>
>> Graham
>>
>>
> Since this is a common problem, I wonder if there may be a way to put 
> checks into the Python modules that use expat to prevent this 
> happening?
>
> David
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>

From indrek at inversion.ee  Thu Jan 27 10:47:41 2005
From: indrek at inversion.ee (=?ISO-8859-1?Q?Indrek_J=E4rve?=)
Date: Thu Jan 27 10:47:44 2005
Subject: [mod_python] mod_python with xmlrplib
In-Reply-To: <50b65a4daa1e903c2b48c74714dbedee@gsoa.net>
References: <1106782600.27654@dscpl.user.openhosting.com>	<41F8724D.2080109@sjsoft.com>
	<50b65a4daa1e903c2b48c74714dbedee@gsoa.net>
Message-ID: <41F90D1D.1000508@inversion.ee>

Didn't Python 2.4 include a newer version of the expat library?
*checks*
Indeed, the post is here: 
http://mail.python.org/pipermail/xml-sig/2004-August/010405.html
The library mismatch could be the problem, as described in the thread in 
the link:
http://mail.python.org/pipermail/python-list/2004-December/256676.html

Regards,
Indrek

Mark McClain wrote:

> This is probably has something do to with the library conflicts.  Our 
> production servers (mod_python 3.1.x, apache 2.0.x, python 2.3.x) has 
> been using xmlrpclib for over a year without any crashes.
>
> Have you compiled your own versions of apache,mod_python, and python?  
> Or are you using the stock redhat versions?
>
> Mark
>
> On Jan 26, 2005, at 11:47 PM, David Fraser wrote:
>
>> Graham Dumpleton wrote:
>>
>>> Marco Catunda wrote ..
>>>
>>>> I haven't been able to use xmlrpclib with mod_python.
>>>> When I import xmlrpclib the apache server crash (segmentation fault),
>>>> the following code will be show it.
>>>>
>>>> =====================================
>>>> from mod_python import apache
>>>> import xmlrpclib
>>>>
>>>> def handler( req ):
>>>>         req.write("Hello World!")
>>>>         return apache.OK
>>>> =====================================
>>>>
>>>> My system:
>>>>   RedHat ES 3
>>>>   Apache 2.0.52
>>>>   Python 2.4
>>>>
>>>> Is there a way to fix it?
>>>>
>>>
>>> The xmlrpclib module uses a Python XML module which looks like it tries
>>> to use expat.
>>>
>>>
>>>>>> import xmlrpclib
>>>>>> import sys
>>>>>> sys.modules.keys()
>>>>>>
>>> ['cStringIO', 'copy_reg', 'sre_compile', '_sre', 'site', 
>>> '__builtin__', 'xml.parsers.expat', 'xml._xmlplus', 'xml.parsers', 
>>> 'xml.sys', '__main__', 'operator', 'xml.parsers.pyexpat', 'xml', 
>>> 'posixpath', 'base64', 'binascii', 'pyexpat.errors', 
>>> 'sre_constants', 're', 'os.path', 'stat', 'zipimport', 'string', 
>>> 'warnings', 'UserDict', '_xmlplus', 'sys', 'readline', 'types', 
>>> 'strop', 'sre', 'signal', 'xmlrpclib', 'linecache', 'posix', 
>>> 'pyexpat.model', 'time', 'exceptions', 'sre_parse', 'os']
>>>
>>> It is a frequent problem that the version of the expat shared 
>>> library which
>>> is used by the Python modules differs to that which Apache or PHP may
>>> already be using. This difference can result in a server crash.
>>>
>>> You should thus try to determine if you have multiple versions of expat
>>> present and whether these different packages are using different 
>>> versions.
>>>
>>> On Linux, you might be able to use "ldd" to work this out by running it
>>> on the "httpd" binary, as well as the appropriate .so Python module.
>>>
>>>  ldd /somepath-to-apache-bin-dir/httpd
>>>  ldd /somepath-to-python-module-dir/lib-dynload/pyexpat.so
>>>  ldd /somepath-to-apache-module-dir/*php*.so
>>>
>>> The paths will need to be adjusted obviously.
>>>
>>> Please post the results of ldd if you can as am curious to see if this
>>> does help, I have never suggested trying it before.
>>>
>>> Graham
>>>
>>>
>> Since this is a common problem, I wonder if there may be a way to put 
>> checks into the Python modules that use expat to prevent this happening?
>>
>> David
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python


From list at joreybump.com  Thu Jan 27 11:23:24 2005
From: list at joreybump.com (Jorey Bump)
Date: Thu Jan 27 11:23:32 2005
Subject: [mod_python] pool and mps
In-Reply-To: <c298f2d7050126230633ec6d3a@mail.gmail.com>
References: <200501261700.j0QH02xK003074@modpython.org>	<41F82236.1080500@valdisme.com>
	<c298f2d7050126230633ec6d3a@mail.gmail.com>
Message-ID: <41F9157C.2000103@joreybump.com>

Nicolas Lehuen wrote:

> There is no standard way to do it. First, if you are using the Apache
> mpm_prefork (the forked MPM), the efficiency of pooling will be very
> low, since your pool will be instantiated as many times as there are
> Apache processes.

It's still worth doing, however, as you can determine by tailing the 
mysql log that connections are being reused more often.

> I'm using the threaded MPM, and I built my own DB connection pool. The
> best place to instantiate the DB connection pool is in a module on the
> PYTHONPATH, which will be imported from any published modules. This
> way, you are guaranteed that the pool will be instantiated only once.

Here's some code to play with, all using the Publisher module, prefork 
apache 1.3, mod_python 2.7:

1. Most inefficient approach:

#db1.py
import MySQLdb
# set up handle in a function
def getdbh():
     dbhost = "localhost"
     dbuser = "bob"
     dbpwd  = "secret"
     dbname = "foo"
     dbh = MySQLdb.connect(dbhost, dbuser, dbpwd, dbname)
     return dbh
# get handle from function
dbh = getdbh

This will create a new db handle with every connection:

  http://host/db1/dbh

2. Better:

#db2.py
import MySQLdb
# use underscore to prevent values from being exposed via HTTP
_dbhost = "localhost"
_dbuser = "bob"
_dbpwd  = "secret"
_dbname = "foo"
_dbh = MySQLdb.connect(_dbhost, _dbuser, _dbpwd, _dbname)
# db handle is available within functions
def dbh(req):
     return _dbh

This method seems to reuse handles more often:

  http://host/db2/dbh

3. Best, import handle from external module, preferably in path outside 
of DocumentRoot:

# connect.py
# put this module in a directory in PYTHONPATH
import MySQLdb
# Set up db connection and return handle.
_dbhost = "localhost"
_dbuser = "bob"
_dbpwd  = "secret"
_dbname = "foo"
dbh = MySQLdb.connect(_dbhost, _dbuser, _dbpwd, _dbname)

Now create a published module that imports the connection:

# db3.py
import MySQLdb
# import db handle from module in PYTHONPATH
from connect import dbh

While not truly persistent, this seems to provide the best connection reuse:

  http://host/db3/dbh

You need to tail your mysql log to get an idea of how well connections 
are being reused; you can't rely solely on the instance location 
returned by mod_python. Add some SELECT statements if you want to make 
it more interesting. Also, I have no idea how this will work on a 
anything other than a prefork apache.

I think the ideal technique would make the same connection available to 
multiple apache processes but limited to the appropriate interpreters, 
and spawn new connections as needed. I'm not sure how this would be 
done, or if anyone has published code that will do this for mod_python.
From conrad at hep.caltech.edu  Thu Jan 27 11:33:35 2005
From: conrad at hep.caltech.edu (Conrad Steenberg)
Date: Thu Jan 27 11:33:45 2005
Subject: [mod_python] mod_python with xmlrplib
In-Reply-To: <41F8246C.2060702@pobox.com>
References: <41F8246C.2060702@pobox.com>
Message-ID: <1106843615.32500.89.camel@heppc22.hep.caltech.edu>

Hi Marco

Btw, it is highly recommended that you also look at py-xmlrpc as well if
you have the ability to install your own modules on the server.

- It is very fast, using it's own C-based parsing engine.
- Corollary to the bove: it doesn't need expat. In fact it has no
external dependencies.
- It uses its own http library if you want to use it as a client

FWIW, I've been using py-xmlrpc with mod_python for about 3 years on a
number of production servers with no problems.

Cheers

Conrad

On Wed, 2005-01-26 at 21:14 -0200, Marco Catunda wrote:
> I haven't been able to use xmlrpclib with mod_python.
> When I import xmlrpclib the apache server crash (segmentation fault),
> the following code will be show it.
> 
> =====================================
> from mod_python import apache
> import xmlrpclib
> 
> def handler( req ):
>          req.write("Hello World!")
>          return apache.OK
> =====================================
> 
> My system:
>    RedHat ES 3
>    Apache 2.0.52
>    Python 2.4
> 
> Is there a way to fix it?
> 
> Thanks
> --
> Marco Catunda
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
-- 
Conrad Steenberg <conrad@hep.caltech.edu>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 2531 bytes
Desc: not available
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050127/7b7ca5c9/smime.bin
From craig.warren at encorp.com  Thu Jan 27 11:38:40 2005
From: craig.warren at encorp.com (Craig Warren)
Date: Thu Jan 27 11:39:16 2005
Subject: [mod_python] mod_python with xmlrplib
In-Reply-To: <41F90D1D.1000508@inversion.ee>
References: <1106782600.27654@dscpl.user.openhosting.com>	<41F8724D.2080109@sjsoft.com>	<50b65a4daa1e903c2b48c74714dbedee@gsoa.net>
	<41F90D1D.1000508@inversion.ee>
Message-ID: <41F91910.9080702@encorp.com>

Yeah ,I didn't see this problem till we moved to Python2.4. With 
Python2.3 the old expat libraries worked.

Craig


Indrek J?rve wrote:

> Didn't Python 2.4 include a newer version of the expat library?
> *checks*
> Indeed, the post is here: 
> http://mail.python.org/pipermail/xml-sig/2004-August/010405.html
> The library mismatch could be the problem, as described in the thread 
> in the link:
> http://mail.python.org/pipermail/python-list/2004-December/256676.html
>
> Regards,
> Indrek
>
> Mark McClain wrote:
>
>> This is probably has something do to with the library conflicts.  Our 
>> production servers (mod_python 3.1.x, apache 2.0.x, python 2.3.x) has 
>> been using xmlrpclib for over a year without any crashes.
>>
>> Have you compiled your own versions of apache,mod_python, and 
>> python?  Or are you using the stock redhat versions?
>>
>> Mark
>>
>> On Jan 26, 2005, at 11:47 PM, David Fraser wrote:
>>
>>> Graham Dumpleton wrote:
>>>
>>>> Marco Catunda wrote ..
>>>>
>>>>> I haven't been able to use xmlrpclib with mod_python.
>>>>> When I import xmlrpclib the apache server crash (segmentation fault),
>>>>> the following code will be show it.
>>>>>
>>>>> =====================================
>>>>> from mod_python import apache
>>>>> import xmlrpclib
>>>>>
>>>>> def handler( req ):
>>>>>         req.write("Hello World!")
>>>>>         return apache.OK
>>>>> =====================================
>>>>>
>>>>> My system:
>>>>>   RedHat ES 3
>>>>>   Apache 2.0.52
>>>>>   Python 2.4
>>>>>
>>>>> Is there a way to fix it?
>>>>>
>>>>
>>>> The xmlrpclib module uses a Python XML module which looks like it 
>>>> tries
>>>> to use expat.
>>>>
>>>>
>>>>>>> import xmlrpclib
>>>>>>> import sys
>>>>>>> sys.modules.keys()
>>>>>>>
>>>> ['cStringIO', 'copy_reg', 'sre_compile', '_sre', 'site', 
>>>> '__builtin__', 'xml.parsers.expat', 'xml._xmlplus', 'xml.parsers', 
>>>> 'xml.sys', '__main__', 'operator', 'xml.parsers.pyexpat', 'xml', 
>>>> 'posixpath', 'base64', 'binascii', 'pyexpat.errors', 
>>>> 'sre_constants', 're', 'os.path', 'stat', 'zipimport', 'string', 
>>>> 'warnings', 'UserDict', '_xmlplus', 'sys', 'readline', 'types', 
>>>> 'strop', 'sre', 'signal', 'xmlrpclib', 'linecache', 'posix', 
>>>> 'pyexpat.model', 'time', 'exceptions', 'sre_parse', 'os']
>>>>
>>>> It is a frequent problem that the version of the expat shared 
>>>> library which
>>>> is used by the Python modules differs to that which Apache or PHP may
>>>> already be using. This difference can result in a server crash.
>>>>
>>>> You should thus try to determine if you have multiple versions of 
>>>> expat
>>>> present and whether these different packages are using different 
>>>> versions.
>>>>
>>>> On Linux, you might be able to use "ldd" to work this out by 
>>>> running it
>>>> on the "httpd" binary, as well as the appropriate .so Python module.
>>>>
>>>>  ldd /somepath-to-apache-bin-dir/httpd
>>>>  ldd /somepath-to-python-module-dir/lib-dynload/pyexpat.so
>>>>  ldd /somepath-to-apache-module-dir/*php*.so
>>>>
>>>> The paths will need to be adjusted obviously.
>>>>
>>>> Please post the results of ldd if you can as am curious to see if this
>>>> does help, I have never suggested trying it before.
>>>>
>>>> Graham
>>>>
>>>>
>>> Since this is a common problem, I wonder if there may be a way to 
>>> put checks into the Python modules that use expat to prevent this 
>>> happening?
>>>
>>> David
>>> _______________________________________________
>>> Mod_python mailing list
>>> Mod_python@modpython.org
>>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>>
>>
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python


From christopher.jackson at gmail.com  Thu Jan 27 14:33:16 2005
From: christopher.jackson at gmail.com (Chris Jackson)
Date: Thu Jan 27 14:33:17 2005
Subject: [mod_python] mod_python with xmlrplib
In-Reply-To: <20050127101849.P31392@grisha.dyndns.org>
References: <1106782600.27654@dscpl.user.openhosting.com>
	<4d11484d05012615554f89493e@mail.gmail.com>
	<4d11484d05012615563383f6d5@mail.gmail.com>
	<4d11484d05012616032f67e841@mail.gmail.com>
	<20050127101849.P31392@grisha.dyndns.org>
Message-ID: <4d11484d05012711335bb0c756@mail.gmail.com>

Problem solved!

Yes, pyexpat is statically linked with the latest version of expat
since it's Python-2.4.
So I upgraded the dynamic libexpat used by apache removing old expat
libraries and compiling the new expat-1.95.8 library. Then I  copied
those files to the proper chrooted directory, and viola!

~= Chris =~

P.S. Thanks everyone for the info! 



On Thu, 27 Jan 2005 10:21:02 -0500 (EST), Gregory (Grisha) Trubetskoy
<grisha@modpython.org> wrote:
> 
> On Wed, 26 Jan 2005, Chris Jackson wrote:
> 
> > My results:
> >
> > ldd httpd
> > ======
> >        linux-gate.so.1 =>  (0xffffe000)
> >        libaprutil-0.so.0 => /usr/local/apache/lib/libaprutil-0.so.0
> > (0x40018000)
> >        libexpat.so.0 => /usr/lib/libexpat.so.0 (0x40037000)
> >        libapr-0.so.0 => /usr/local/apache/lib/libapr-0.so.0 (0x40059000)
> >        librt.so.1 => /lib/tls/librt.so.1 (0x40079000)
> >        libm.so.6 => /lib/tls/libm.so.6 (0x4008d000)
> >        libcrypt.so.1 => /lib/libcrypt.so.1 (0x400b0000)
> >        libnsl.so.1 => /lib/libnsl.so.1 (0x400dd000)
> >        libpthread.so.0 => /lib/tls/libpthread.so.0 (0x400f0000)
> >        libdl.so.2 => /lib/libdl.so.2 (0x40101000)
> >        libc.so.6 => /lib/tls/libc.so.6 (0x40104000)
> >        /lib/ld-linux.so.2 => /lib/ld-linux.so.2 (0x40000000)
> >
> > ldd lib-dynload/pyexpat.so
> > ==================
> >        linux-gate.so.1 =>  (0xffffe000)
> >        libpthread.so.0 => /lib/tls/libpthread.so.0 (0x40040000)
> >        libc.so.6 => /lib/tls/libc.so.6 (0x40051000)
> >        /lib/ld-linux.so.2 => /lib/ld-linux.so.2 (0x80000000)
> 
> So this looks like httpd is using a dynamic libexpat, while pyexpat.so
> doesn't which means it is probably statically linked?
> 
> Grisha
>
From catunda at pobox.com  Thu Jan 27 14:32:53 2005
From: catunda at pobox.com (Marco Catunda)
Date: Thu Jan 27 14:35:44 2005
Subject: [mod_python] mod_python with xmlrplib
In-Reply-To: <41F91910.9080702@encorp.com>
References: <1106782600.27654@dscpl.user.openhosting.com>	<41F8724D.2080109@sjsoft.com>	<50b65a4daa1e903c2b48c74714dbedee@gsoa.net>	<41F90D1D.1000508@inversion.ee>
	<41F91910.9080702@encorp.com>
Message-ID: <41F941E5.6010204@pobox.com>

Greats!!
Thanks everybody.
I resolved the problem in my system.

My config was:

/usr/local/desenv/python/Python-2.4# rpm -qa | grep expat
expat-1.95.5-6
expat-devel-1.95.5-6

/usr/local/desenv/python/Python-2.4# tail Modules/expat/expat.h
*/
#define XML_MAJOR_VERSION 1
#define XML_MINOR_VERSION 95
#define XML_MICRO_VERSION 8

The expat module used in apache was 1.95.5 version
and in python was 1.95.8. I recompiled apache with
expat 1.95.8 and everything worked fine.

--
Marco Catunda




Craig Warren wrote:
> Yeah ,I didn't see this problem till we moved to Python2.4. With 
> Python2.3 the old expat libraries worked.
> 
> Craig
> 
> 
> Indrek J?rve wrote:
> 
>> Didn't Python 2.4 include a newer version of the expat library?
>> *checks*
>> Indeed, the post is here: 
>> http://mail.python.org/pipermail/xml-sig/2004-August/010405.html
>> The library mismatch could be the problem, as described in the thread 
>> in the link:
>> http://mail.python.org/pipermail/python-list/2004-December/256676.html
>>
>> Regards,
>> Indrek
>>
>> Mark McClain wrote:
>>
>>> This is probably has something do to with the library conflicts.  Our 
>>> production servers (mod_python 3.1.x, apache 2.0.x, python 2.3.x) has 
>>> been using xmlrpclib for over a year without any crashes.
>>>
>>> Have you compiled your own versions of apache,mod_python, and 
>>> python?  Or are you using the stock redhat versions?
>>>
>>> Mark
>>>
>>> On Jan 26, 2005, at 11:47 PM, David Fraser wrote:
>>>
>>>> Graham Dumpleton wrote:
>>>>
>>>>> Marco Catunda wrote ..
>>>>>
>>>>>> I haven't been able to use xmlrpclib with mod_python.
>>>>>> When I import xmlrpclib the apache server crash (segmentation fault),
>>>>>> the following code will be show it.
>>>>>>
>>>>>> =====================================
>>>>>> from mod_python import apache
>>>>>> import xmlrpclib
>>>>>>
>>>>>> def handler( req ):
>>>>>>         req.write("Hello World!")
>>>>>>         return apache.OK
>>>>>> =====================================
>>>>>>
>>>>>> My system:
>>>>>>   RedHat ES 3
>>>>>>   Apache 2.0.52
>>>>>>   Python 2.4
>>>>>>
>>>>>> Is there a way to fix it?
>>>>>>
>>>>>
>>>>> The xmlrpclib module uses a Python XML module which looks like it 
>>>>> tries
>>>>> to use expat.
>>>>>
>>>>>
>>>>>>>> import xmlrpclib
>>>>>>>> import sys
>>>>>>>> sys.modules.keys()
>>>>>>>>
>>>>> ['cStringIO', 'copy_reg', 'sre_compile', '_sre', 'site', 
>>>>> '__builtin__', 'xml.parsers.expat', 'xml._xmlplus', 'xml.parsers', 
>>>>> 'xml.sys', '__main__', 'operator', 'xml.parsers.pyexpat', 'xml', 
>>>>> 'posixpath', 'base64', 'binascii', 'pyexpat.errors', 
>>>>> 'sre_constants', 're', 'os.path', 'stat', 'zipimport', 'string', 
>>>>> 'warnings', 'UserDict', '_xmlplus', 'sys', 'readline', 'types', 
>>>>> 'strop', 'sre', 'signal', 'xmlrpclib', 'linecache', 'posix', 
>>>>> 'pyexpat.model', 'time', 'exceptions', 'sre_parse', 'os']
>>>>>
>>>>> It is a frequent problem that the version of the expat shared 
>>>>> library which
>>>>> is used by the Python modules differs to that which Apache or PHP may
>>>>> already be using. This difference can result in a server crash.
>>>>>
>>>>> You should thus try to determine if you have multiple versions of 
>>>>> expat
>>>>> present and whether these different packages are using different 
>>>>> versions.
>>>>>
>>>>> On Linux, you might be able to use "ldd" to work this out by 
>>>>> running it
>>>>> on the "httpd" binary, as well as the appropriate .so Python module.
>>>>>
>>>>>  ldd /somepath-to-apache-bin-dir/httpd
>>>>>  ldd /somepath-to-python-module-dir/lib-dynload/pyexpat.so
>>>>>  ldd /somepath-to-apache-module-dir/*php*.so
>>>>>
>>>>> The paths will need to be adjusted obviously.
>>>>>
>>>>> Please post the results of ldd if you can as am curious to see if this
>>>>> does help, I have never suggested trying it before.
>>>>>
>>>>> Graham
>>>>>
>>>>>
>>>> Since this is a common problem, I wonder if there may be a way to 
>>>> put checks into the Python modules that use expat to prevent this 
>>>> happening?
>>>>
>>>> David
>>>> _______________________________________________
>>>> Mod_python mailing list
>>>> Mod_python@modpython.org
>>>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>>>
>>>
>>> _______________________________________________
>>> Mod_python mailing list
>>> Mod_python@modpython.org
>>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>
>>
>>
>>
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
> 
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 
> 
From christopher.jackson at gmail.com  Thu Jan 27 16:34:10 2005
From: christopher.jackson at gmail.com (Chris Jackson)
Date: Thu Jan 27 16:34:12 2005
Subject: [mod_python] psp_site example doesn't work
In-Reply-To: <20050123060205.GF1302@darkstar.frop.org>
References: <20050123060205.GF1302@darkstar.frop.org>
Message-ID: <4d11484d05012713341b539cf9@mail.gmail.com>

On Sun, 23 Jan 2005 06:02:05 +0000, Zach White
<zwhite-mod_python@darkstar.frop.org> wrote:

> 
> On an unrelated note, it'd be nice if the archives were searchable. It seems
> that google doesn't index them.
> 
> -Zach

Actually they do... I have you tried Google Suggest?

http://www.google.com/webhp?complete=1&hl=en

~= Chris =~
From grahamd at dscpl.com.au  Thu Jan 27 16:36:56 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Jan 27 16:37:18 2005
Subject: [mod_python] pool and mps
Message-ID: <1106861816.22108@dscpl.user.openhosting.com>

Jorey Bump wrote ..
> 3. Best, import handle from external module, preferably in path outside
> of DocumentRoot:
> 
> # connect.py
> # put this module in a directory in PYTHONPATH
> import MySQLdb
> # Set up db connection and return handle.
> _dbhost = "localhost"
> _dbuser = "bob"
> _dbpwd  = "secret"
> _dbname = "foo"
> dbh = MySQLdb.connect(_dbhost, _dbuser, _dbpwd, _dbname)

This approach of having it in a separate module (outside of your document
tree), is also preferred for other reasons as well.

Namely, it is never a good idea to have login names and passwords, or any
sensitive information for that matter within a Python code file which exists
within the document tree. All it takes is for a coding stuff up on your own
part, a misconfiguration of Apache or for some other problem to arise and
your Python code files could get exposed to the outside world, thus revealing
said logins, passwords or other sensitive information. That in publisher
globals not prefixed with an underscore are exposed, makes it even more
prone to these risks than other mechanisms.

Graham
From administrator at leebrown.org  Thu Jan 27 18:57:18 2005
From: administrator at leebrown.org (Lee Brown)
Date: Thu Jan 27 18:57:55 2005
Subject: [mod_python] namespaces in publisher
In-Reply-To: <1f060c4c0501262242194ef343@mail.gmail.com>
Message-ID: <14967C9A1B9D@underdog>

 

-----Original Message-----
From: mod_python-bounces@modpython.org
[mailto:mod_python-bounces@modpython.org] On Behalf Of snacktime
Sent: Thursday, January 27, 2005 1:42 AM
To: mod_python@modpython.org
Subject: [mod_python] namespaces in publisher

> ...
> Also, how do you destroy an instance of a class?
> ...

I usually destroy a class by not reading the documentation before I screw
around overloading its methods.  Sometimes I can destroy it just by
subclassing it.  Heck, some days I can destroy it just by looking in its
general direction. :-)

From SAiello at Jentoo.com  Fri Jan 28 12:15:10 2005
From: SAiello at Jentoo.com (SAiello@Jentoo.com)
Date: Fri Jan 28 12:07:41 2005
Subject: [mod_python] Can you run a process when a session expires
Message-ID: <200501281215.10118.SAiello@Jentoo.com>

Hello,

I was wondering if it is possible to run a process when a session timeout 
expires. I wouldn't believe there is, for there would need to be some process 
constantly monitoring all the processes for expiration, and immediately run 
the program. But I figured I would ask.

So to try to do this, I figured I would write another process that would 
monitor that session database. Basically, open and read the 
'/tmp/mp_session.dbm' run through all the sessions, and if expired run the 
program I would like to run. The default db for mp_sess.dbm is dbhash. I have 
never worked with dbhash before, I have worked with gdbm. I tried looking at 
what is contained within the dbhash file, and I wasn't too sure how to parse 
the information under the sid keys.

So I thought I would see how a mp_sess.dbm file would be created if I 
specified using gdbm, I used the following lines:
import gdbm
sess=Session.DbmSession(req, None, None, gdbm)

But I get the following error:
Mod_python error: "PythonHandler mod_python.publisher"

Traceback (most recent call last):

  File "/usr/lib/python2.3/site-packages/mod_python/apache.py", line 299, in 
HandlerDispatch
    result = object(req)

  File "/usr/lib/python2.3/site-packages/mod_python/publisher.py", line 136, 
in handler
    result = util.apply_fs_data(object, req.form, req=req)

  File "/usr/lib/python2.3/site-packages/mod_python/util.py", line 361, in 
apply_fs_data
    return object(**args)

  File "/var/www/localhost/htdocs/python/inet.py", line 11, in login
    webtools.login(req, Secret, args)

  File "/var/www/localhost/htdocs/python/webtools.py", line 23, in login
    sess=Session.DbmSession(req, None, Secret, gdbm)

  File "/usr/lib/python2.3/site-packages/mod_python/Session.py", line 294, in 
__init__
    timeout=timeout, lock=lock)

  File "/usr/lib/python2.3/site-packages/mod_python/Session.py", line 132, in 
__init__
    Cookie.add_cookie(self._req, self.make_cookie())

  File "/usr/lib/python2.3/site-packages/mod_python/Cookie.py", line 353, in 
add_cookie
    req.headers_out.add("Set-Cookie", str(cookie))

  File "/usr/lib/python2.3/site-packages/mod_python/Cookie.py", line 204, in 
__str__
    result = ["%s=%s%s" % (self.name, self.hexdigest(self.value),

  File "/usr/lib/python2.3/site-packages/mod_python/Cookie.py", line 198, in 
hexdigest
    _hmac = hmac.new(self.__data__["secret"], self.name)

  File "/usr/lib/python2.3/hmac.py", line 97, in new
    return HMAC(key, msg, digestmod)

  File "/usr/lib/python2.3/hmac.py", line 41, in __init__
    if len(key) > blocksize:

TypeError: len() of unsized object


Any ideas or suggestions ?
Thanks,
  Steven
From sp3ktr at gmail.com  Sat Jan 29 10:27:39 2005
From: sp3ktr at gmail.com (sp3ktr)
Date: Sat Jan 29 10:27:41 2005
Subject: [mod_python] Using SetHandler mod_python in the web root.
Message-ID: <d80541240501290727372c4b3@mail.gmail.com>

Hi all!

I'm relatively new to mod_python and am having trouble using
mod_python from the root of the web server.  My current apache2 config
is:

DocumentRoot /some/path
</Directory /some/path>
                SetHandler mod_python
                PythonHandler index
                PythonDebug On
</Directory>

the web server has this file structure:

/
/xsl
/xsl/default.xsl
/index.py

When i write out xml from index.py the link to /xsl/default.xsl
doesn't work because all requests go through index.py now.  I'm
wondering how to set up the handler in such a way that i can still
access the /xsl/* files?

The reason for this is that i would like all requests to go to
http://host/<request>  while retaining the /xsl as the main store of
xsl files.  And also to hide the .py extension in the url.

Any help would be greatly appreciated

-- 
adieu
sp3ktr
From nicolas.lehuen at gmail.com  Sat Jan 29 11:02:20 2005
From: nicolas.lehuen at gmail.com (Nicolas Lehuen)
Date: Sat Jan 29 11:02:22 2005
Subject: [mod_python] Using SetHandler mod_python in the web root.
In-Reply-To: <d80541240501290727372c4b3@mail.gmail.com>
References: <d80541240501290727372c4b3@mail.gmail.com>
Message-ID: <c298f2d70501290802337d74bf@mail.gmail.com>

Hi,

Your problem comes from the fact that you are using the SetHandler
directive. As soon as you use it, *all* requests are handled by
mod_python, not just the ones for .py files.

You have two options :

1) You can use the AddHandler directive :

DocumentRoot /some/path
</Directory /some/path>
               AddHandler mod_python .py
               PythonHandler index | .py
               PythonDebug On
</Directory>

This way *all* request for files ending with .py (for example, a
request for /index.py) will be handled by you index handler.

For more flexibility, you could have a look at the mod_python publisher.

2) Keep the SetHandler directive, so everything will go through
mod_python, but use the Vampire handler
(http://www.dscpl.com.au/projects/vampire/). You then have to
configure Vampire to correctly serve .xsl files.

Regards,
Nicolas

On Sat, 29 Jan 2005 23:27:39 +0800, sp3ktr <sp3ktr@gmail.com> wrote:
> Hi all!
> 
> I'm relatively new to mod_python and am having trouble using
> mod_python from the root of the web server.  My current apache2 config
> is:
> 
> DocumentRoot /some/path
> </Directory /some/path>
>                 SetHandler mod_python
>                 PythonHandler index
>                 PythonDebug On
> </Directory>
> 
> the web server has this file structure:
> 
> /
> /xsl
> /xsl/default.xsl
> /index.py
> 
> When i write out xml from index.py the link to /xsl/default.xsl
> doesn't work because all requests go through index.py now.  I'm
> wondering how to set up the handler in such a way that i can still
> access the /xsl/* files?
> 
> The reason for this is that i would like all requests to go to
> http://host/<request>  while retaining the /xsl as the main store of
> xsl files.  And also to hide the .py extension in the url.
> 
> Any help would be greatly appreciated
> 
> --
> adieu
> sp3ktr
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From grahamd at dscpl.com.au  Sat Jan 29 16:10:14 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sat Jan 29 16:12:35 2005
Subject: [mod_python] Using SetHandler mod_python in the web root.
In-Reply-To: <c298f2d70501290802337d74bf@mail.gmail.com>
References: <d80541240501290727372c4b3@mail.gmail.com>
	<c298f2d70501290802337d74bf@mail.gmail.com>
Message-ID: <2B14C364-723A-11D9-AAA5-000393DCF16E@dscpl.com.au>


On 30/01/2005, at 3:02 AM, Nicolas Lehuen wrote:
> 2) Keep the SetHandler directive, so everything will go through
> mod_python, but use the Vampire handler
> (http://www.dscpl.com.au/projects/vampire/). You then have to
> configure Vampire to correctly serve .xsl files.

Actually, you wouldn't have to do anything for the .xsl as far as 
configuration,
as Vampire would realise it didn't have to do anything special for it 
and
so decline to do so. Thus Apache would serve it up as normal. Thus just 
have
in configuration.

</Directory /some/path>
                 SetHandler vampire
                 PythonHandler index
                 PythonDebug On
</Directory>

The only difference then is you would access index page as:

   /index

and not:

   /index.py

If that page was serving up HTML, if you change the name of the handler 
from
"handler()" to "handler_html()", you could use:

   /index.html

Graham

From sp3ktr at gmail.com  Sat Jan 29 22:24:07 2005
From: sp3ktr at gmail.com (sp3ktr)
Date: Sat Jan 29 22:24:08 2005
Subject: [mod_python] Using SetHandler mod_python in the web root.
In-Reply-To: <2B14C364-723A-11D9-AAA5-000393DCF16E@dscpl.com.au>
References: <d80541240501290727372c4b3@mail.gmail.com>
	<c298f2d70501290802337d74bf@mail.gmail.com>
	<2B14C364-723A-11D9-AAA5-000393DCF16E@dscpl.com.au>
Message-ID: <d8054124050129192432cdf20b@mail.gmail.com>

On Sun, 30 Jan 2005 08:10:14 +1100, Graham Dumpleton
<grahamd@dscpl.com.au> wrote:
> 
> On 30/01/2005, at 3:02 AM, Nicolas Lehuen wrote:
> > 2) Keep the SetHandler directive, so everything will go through
> > mod_python, but use the Vampire handler
> > (http://www.dscpl.com.au/projects/vampire/). You then have to
> > configure Vampire to correctly serve .xsl files.
> 
> Actually, you wouldn't have to do anything for the .xsl as far as
> configuration,
> as Vampire would realise it didn't have to do anything special for it
> and
> so decline to do so. Thus Apache would serve it up as normal. Thus just
> have
> in configuration.
> 
> </Directory /some/path>
>                  SetHandler vampire
>                  PythonHandler index
>                  PythonDebug On
> </Directory>
> 
> The only difference then is you would access index page as:
> 
>    /index
> 
> and not:
> 
>    /index.py
> 
> If that page was serving up HTML, if you change the name of the handler
> from
> "handler()" to "handler_html()", you could use:
> 
>    /index.html
> 
> Graham
> 
> 

I think i'll try the vampire setup, thanks heaps for the quick replies! : )
-- 
adieu
sp3ktr
From JFeghhi at visa.com  Sun Jan 30 16:34:37 2005
From: JFeghhi at visa.com (Feghhi, Jalil)
Date: Sun Jan 30 16:35:36 2005
Subject: [mod_python] Exception loading a session
Message-ID: <8C53AAFA2050EE40BDCDB9455DA7D63401A01BD4@sw720ex020.visa.com>

I compiled and installed mod_python on RH Linux using Python 2.4 and
libdb 4.2 and now get the following error when running my application. I
did not have this issue with Python 2.3 and libdb 4.0. I also created
and ran a simple python program with the same function that throws
exception under mod_python and did not get any exception when ran it
under Python 2.4. But when I turned my program into psp, I got the exact
same exception as below. 

 Does anybody know how to debug this? 

-Jalil


Mod_python error: "PythonHandler mod_python.psp"

Traceback (most recent call last):

  File "/usr/local/lib/python2.4/site-packages/mod_python/apache.py",
line 299, in HandlerDispatch
    result = object(req)

  File "/usr/local/lib/python2.4/site-packages/mod_python/psp.py", line
297, in handler
    p.run()

  File "/usr/local/lib/python2.4/site-packages/mod_python/psp.py", line
191, in run
    session = Session.Session(req)

  File "/usr/local/lib/python2.4/site-packages/mod_python/Session.py",
line 389, in Session
    timeout=timeout, lock=lock)

  File "/usr/local/lib/python2.4/site-packages/mod_python/Session.py",
line 294, in __init__
    timeout=timeout, lock=lock)

  File "/usr/local/lib/python2.4/site-packages/mod_python/Session.py",
line 124, in __init__
    if self.load():

  File "/usr/local/lib/python2.4/site-packages/mod_python/Session.py",
line 185, in load
    dict = self.do_load()

  File "/usr/local/lib/python2.4/site-packages/mod_python/Session.py",
line 315, in do_load
    dbm = self._get_dbm()

  File "/usr/local/lib/python2.4/site-packages/mod_python/Session.py",
line 302, in _get_dbm
    result = self._dbmtype.open(self._dbmfile, 'c')

  File "/usr/local/lib/python2.4/anydbm.py", line 83, in open
    return mod.open(file, flag, mode)

  File "/usr/local/lib/python2.4/dbhash.py", line 16, in open
    return bsddb.hashopen(file, flag, mode)

  File "/usr/local/lib/python2.4/bsddb/__init__.py", line 285, in
hashopen
    e = _openDBEnv()

  File "/usr/local/lib/python2.4/bsddb/__init__.py", line 339, in
_openDBEnv
    e.open('.', db.DB_PRIVATE | db.DB_CREATE | db.DB_THREAD |
db.DB_INIT_LOCK | db.DB_INIT_MPOOL)

DBError: (154070928, 'Unknown error 154070928')	

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050130/ecb6b1d9/attachment.html
From andfarm at teknovis.com  Mon Jan 31 03:51:13 2005
From: andfarm at teknovis.com (Andrew Farmer)
Date: Mon Jan 31 03:51:18 2005
Subject: [mod_python] Weird ob_callback problems
Message-ID: <44a01877a65104f6b5451ea54d1a283c@teknovis.com>

Installing mod_python 2.7.10 on Mac OS X 10.3.7. I've upgraded Python 
to 2.4 myself (the machine came with 2.3) and installed it in 
/usr/local. I'm using the stock Apache 1.3.33.

mod_python installed without trouble -- I added -DEAPI to the CFLAGS to 
avoid the httpd warning -- but, upon trying to run any Python script, I 
get an error 500 in the browser. The error log shows the following:

> make_obcallback(): could not import mod_python.apache.
> make_obcallback(): could not call init.
> [Mon Jan 31 00:21:35 2005] [error] [client 127.0.0.1] python_handler: 
> make_obcallback returned no obCallBack!

I inserted a PyErr_Print() into make_obcallback at the critical point 
and got:

> Traceback (most recent call last):
>   File "/usr/local/lib/python2.4/site-packages/mod_python/apache.py", 
> line 49, in ?
>     import time
> ImportError: Failure linking new module: : dyld: /usr/sbin/httpd 
> Undefined symbols:
> /usr/local/lib/python2.4/lib-dynload/time.so undefined reference to 
> _PyArg_Parse expected to be defined in the executable
> /usr/local/lib/python2.4/lib-dynload/time.so undefined reference to 
> PyArg_ParseTuple expected to be defined in the executable
> /usr/local/lib/python2.4/lib-dynload/time.so undefined reference to 
> PyDict_GetItemString expected to be defined in the executable
> /usr/local/lib/python2.4/lib-dynload/time.so undefined refer...

which suggests some sort of Python version mismatch. However, 
mod_python.so *looks* like it was built against Python 2.4, and the 
compilation process suggests the same.

Anyone know what's going on -- and, more importantly, what to do about 
it?
-------------- next part --------------
A non-text attachment was scrubbed...
Name: PGP.sig
Type: application/pgp-signature
Size: 186 bytes
Desc: This is a digitally signed message part
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050131/3c559f90/PGP.bin
From lroubeyrie at limair.asso.fr  Mon Jan 31 08:18:18 2005
From: lroubeyrie at limair.asso.fr (Lionel Roubeyrie)
Date: Mon Jan 31 08:19:43 2005
Subject: [mod_python] pythonpath
Message-ID: <200501311418.18168.lroubeyrie@limair.asso.fr>

Hi all,
I have a problem with the PYTHONPATH. I have to import in the web pages a 
python module located in the topdirectory of where the web pages are stored.
For that I modify the PythonPath directive, but now Apache2 gives a "Not Page 
Found" error, and I have to demand three or four times the same url to 
finally have the web page. I also try without the PythonPath directive and 
set it in the /etc/profile or in the .bashrc of the Apache user, the same 
problem returns.
What can I do? 

-- 
Lionel Roubeyrie - lroubeyrie@limair.asso.fr
LIMAIR
http://www.limair.asso.fr

From list at joreybump.com  Mon Jan 31 09:12:36 2005
From: list at joreybump.com (Jorey Bump)
Date: Mon Jan 31 09:12:41 2005
Subject: [mod_python] pythonpath
In-Reply-To: <200501311418.18168.lroubeyrie@limair.asso.fr>
References: <200501311418.18168.lroubeyrie@limair.asso.fr>
Message-ID: <41FE3CD4.4010606@joreybump.com>

Lionel Roubeyrie wrote:
> Hi all,
> I have a problem with the PYTHONPATH. I have to import in the web pages a 
> python module located in the topdirectory of where the web pages are stored.
> For that I modify the PythonPath directive, but now Apache2 gives a "Not Page 
> Found" error, and I have to demand three or four times the same url to 
> finally have the web page. I also try without the PythonPath directive and 
> set it in the /etc/profile or in the .bashrc of the Apache user, the same 
> problem returns.
> What can I do? 

You didn't provide enough details. Show us:

1. How you've configured mod_python (in httpd.conf or .htaccess)
2. How and where you've set the PYTHONPATH
3. The relevant parts of your importing module
4. The URL you are using
5. The relevant error entries in apache's error log

Don't bother with /etc/profile or .bashrc. Also, include a function in 
your module to display the path, so you can confirm it's being set.
From lroubeyrie at limair.asso.fr  Mon Jan 31 09:57:40 2005
From: lroubeyrie at limair.asso.fr (Lionel Roubeyrie)
Date: Mon Jan 31 09:59:04 2005
Subject: [mod_python] pythonpath
In-Reply-To: <41FE3CD4.4010606@joreybump.com>
References: <200501311418.18168.lroubeyrie@limair.asso.fr>
	<41FE3CD4.4010606@joreybump.com>
Message-ID: <200501311557.40282.lroubeyrie@limair.asso.fr>

Hi,
Le Lundi 31 Janvier 2005 15:12, Jorey Bump a ?crit?:
> You didn't provide enough details. Show us:
>
> 1. How you've configured mod_python (in httpd.conf or .htaccess)
in httpd.conf of Apache2:
Alias /cartairweb /topdir/webdir
Directory /topdir/webdir>
        Order allow,deny
        Allow from all
        Options Indexes Includes FollowSymLinks MultiViews
        AddHandler mod_python .py
        PythonHandler mod_python.publisher
#       PythonPath "sys.path+['/topdir']"
        PythonDebug On
</Directory>
> 2. How and where you've set the PYTHONPATH
Like in the previous lines, or using a more Goliath' like method calling 
setEnviron() :
####################################
def getParentDir():
    currentfile = os.path.abspath(__file__)
    currentdir = os.path.split(currentfile)[0]
    parentdir = os.path.split(currentdir)[0]
    return parentdir
def setEnviron():
    parentdir = getParentDir()
    if parentdir not in sys.path : sys.path.append(parentdir)
    os.environ['PYTHONPATH']=parentdir
####################################
In all case, I have to change the current working directory to where the web 
pages are.
> 3. The relevant parts of your importing module
In fact, the error comes when I import the desired module (cartair) located in 
the topdirectory:
####################################
import os, utils
import cartair
utils.setCurrentWkDir()
utils.setEnviron()
    
def index(req, executer='0', section='PREVAIR', date_calcul='', date_prevu='', 
code_modele='', polluant='', niveau='', squelette=''):
    result = ''
    conf= cartair.CartairConf()
    date = cartair.Cdate()
    try:
        if (code_modele == '') or (code_modele == None): 
code_modele=conf.get(section, 'code_modele')
...
####################################
> 4. The URL you are using
http://localhost/cartairweb/
> 5. The relevant error entries in apache's error log
no real error
> Don't bother with /etc/profile or .bashrc. Also, include a function in
> your module to display the path, so you can confirm it's being set.
Sometimes yes, sometimes no ...
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

-- 
Lionel Roubeyrie - lroubeyrie@limair.asso.fr
LIMAIR
http://www.limair.asso.fr


From lroubeyrie at limair.asso.fr  Mon Jan 31 10:22:57 2005
From: lroubeyrie at limair.asso.fr (Lionel Roubeyrie)
Date: Mon Jan 31 10:24:21 2005
Subject: [mod_python] pythonpath
In-Reply-To: <41FE3CD4.4010606@joreybump.com>
References: <200501311418.18168.lroubeyrie@limair.asso.fr>
	<41FE3CD4.4010606@joreybump.com>
Message-ID: <200501311622.57974.lroubeyrie@limair.asso.fr>

Hi again,
I have done another test with the PythonPath directive, and the env variable 
is not set :
In index.py
#####################################
import os, sys
def index(req):
    path = os.environ['PATH']
    try:
        pythonpath = os.environ['PYTHONPATH']
    except:
        pythonpath = 'Not set'
    syspath =':'.join(sys.path)
  
    return('''<HTML><BODY>
            PATH = %s <BR>
            PYTHONPATH = %s <BR>
            SYSPATH = %s <BR></BODY></HTML>'''%(path, pythonpath, syspath))
#####################################
And the r?sult :
#####################################
PATH = /usr/local/bin:/usr/bin:/bin 
 PYTHONPATH = Not set 
 SYSPATH 
= /usr/lib/python23.zip:/usr/lib/python2.3:/usr/lib/python2.3/plat-linux2:/usr/lib/python2.3/lib-tk:
/usr/lib/python2.3/lib-dynload:/usr/local/lib/python2.3/site-packages:/usr/lib/python2.3/site-packages:
/usr/lib/python2.3/site-packages/Numeric:/usr/lib/python2.3/site-packages/PIL:
/topdir/webdir
#####################################


Le Lundi 31 Janvier 2005 15:12, Jorey Bump a ?crit?:
> Lionel Roubeyrie wrote:
> > Hi all,
> > I have a problem with the PYTHONPATH. I have to import in the web pages a
> > python module located in the topdirectory of where the web pages are
> > stored. For that I modify the PythonPath directive, but now Apache2 gives
> > a "Not Page Found" error, and I have to demand three or four times the
> > same url to finally have the web page. I also try without the PythonPath
> > directive and set it in the /etc/profile or in the .bashrc of the Apache
> > user, the same problem returns.
> > What can I do?
>
> You didn't provide enough details. Show us:
>
> 1. How you've configured mod_python (in httpd.conf or .htaccess)
> 2. How and where you've set the PYTHONPATH
> 3. The relevant parts of your importing module
> 4. The URL you are using
> 5. The relevant error entries in apache's error log
>
> Don't bother with /etc/profile or .bashrc. Also, include a function in
> your module to display the path, so you can confirm it's being set.
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

-- 
Lionel Roubeyrie - lroubeyrie@limair.asso.fr
LIMAIR
http://www.limair.asso.fr


From grisha at modpython.org  Mon Jan 31 10:28:17 2005
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Mon Jan 31 10:28:22 2005
Subject: [mod_python] Weird ob_callback problems
In-Reply-To: <44a01877a65104f6b5451ea54d1a283c@teknovis.com>
References: <44a01877a65104f6b5451ea54d1a283c@teknovis.com>
Message-ID: <20050131102730.W26813@grisha.dyndns.org>


Try defining DYLD_FORCE_FLAT_NAMESPACE=1 environment variable before 
launching httpd. Don't know if it will help, but it might.

Grisha

On Mon, 31 Jan 2005, Andrew Farmer wrote:

> Installing mod_python 2.7.10 on Mac OS X 10.3.7. I've upgraded Python to 2.4 
> myself (the machine came with 2.3) and installed it in /usr/local. I'm using 
> the stock Apache 1.3.33.
>
> mod_python installed without trouble -- I added -DEAPI to the CFLAGS to avoid 
> the httpd warning -- but, upon trying to run any Python script, I get an 
> error 500 in the browser. The error log shows the following:
>
>> make_obcallback(): could not import mod_python.apache.
>> make_obcallback(): could not call init.
>> [Mon Jan 31 00:21:35 2005] [error] [client 127.0.0.1] python_handler: 
>> make_obcallback returned no obCallBack!
>
> I inserted a PyErr_Print() into make_obcallback at the critical point and 
> got:
>
>> Traceback (most recent call last):
>>   File "/usr/local/lib/python2.4/site-packages/mod_python/apache.py", line 
>> 49, in ?
>>     import time
>> ImportError: Failure linking new module: : dyld: /usr/sbin/httpd Undefined 
>> symbols:
>> /usr/local/lib/python2.4/lib-dynload/time.so undefined reference to 
>> _PyArg_Parse expected to be defined in the executable
>> /usr/local/lib/python2.4/lib-dynload/time.so undefined reference to 
>> PyArg_ParseTuple expected to be defined in the executable
>> /usr/local/lib/python2.4/lib-dynload/time.so undefined reference to 
>> PyDict_GetItemString expected to be defined in the executable
>> /usr/local/lib/python2.4/lib-dynload/time.so undefined refer...
>
> which suggests some sort of Python version mismatch. However, mod_python.so 
> *looks* like it was built against Python 2.4, and the compilation process 
> suggests the same.
>
> Anyone know what's going on -- and, more importantly, what to do about it?
>
From list at joreybump.com  Mon Jan 31 10:42:21 2005
From: list at joreybump.com (Jorey Bump)
Date: Mon Jan 31 10:42:26 2005
Subject: [mod_python] pythonpath
In-Reply-To: <200501311557.40282.lroubeyrie@limair.asso.fr>
References: <200501311418.18168.lroubeyrie@limair.asso.fr>	<41FE3CD4.4010606@joreybump.com>
	<200501311557.40282.lroubeyrie@limair.asso.fr>
Message-ID: <41FE51DD.8070207@joreybump.com>

Lionel Roubeyrie wrote:
> Hi,
> Le Lundi 31 Janvier 2005 15:12, Jorey Bump a ?crit :
> 
>>You didn't provide enough details. Show us:
>>
>>1. How you've configured mod_python (in httpd.conf or .htaccess)
> 
> in httpd.conf of Apache2:
> Alias /cartairweb /topdir/webdir
> Directory /topdir/webdir>
>         Order allow,deny
>         Allow from all
>         Options Indexes Includes FollowSymLinks MultiViews
>         AddHandler mod_python .py
>         PythonHandler mod_python.publisher
> #       PythonPath "sys.path+['/topdir']"
>         PythonDebug On
> </Directory>
> 
>>2. How and where you've set the PYTHONPATH
> 
> Like in the previous lines, or using a more Goliath' like method calling 
> setEnviron() :
> ####################################
> def getParentDir():
>     currentfile = os.path.abspath(__file__)
>     currentdir = os.path.split(currentfile)[0]
>     parentdir = os.path.split(currentdir)[0]
>     return parentdir
> def setEnviron():
>     parentdir = getParentDir()
>     if parentdir not in sys.path : sys.path.append(parentdir)
>     os.environ['PYTHONPATH']=parentdir
> ####################################
> In all case, I have to change the current working directory to where the web 
> pages are.
> 
>>3. The relevant parts of your importing module
> 
> In fact, the error comes when I import the desired module (cartair) located in 
> the topdirectory:
> ####################################
> import os, utils
> import cartair
> utils.setCurrentWkDir()
> utils.setEnviron()
>     
> def index(req, executer='0', section='PREVAIR', date_calcul='', date_prevu='', 
> code_modele='', polluant='', niveau='', squelette=''):
>     result = ''
>     conf= cartair.CartairConf()
>     date = cartair.Cdate()
>     try:
>         if (code_modele == '') or (code_modele == None): 
> code_modele=conf.get(section, 'code_modele')
> ...
> ####################################
> 
>>4. The URL you are using
> 
> http://localhost/cartairweb/
> 
>>5. The relevant error entries in apache's error log
> 
> no real error
> 
>>Don't bother with /etc/profile or .bashrc. Also, include a function in
>>your module to display the path, so you can confirm it's being set.
> 
> Sometimes yes, sometimes no ...

Okay, in order to avoid some the quirks of Publisher, let's give the 
module a unique name, like foo.py. Rename the index function to 
something else (I'll use "start" as an example). Avoid using the Alias 
while you're troubleshooting, and don't set the PythonPath for now. This 
gives us an URL like this:

  http://localhost/topdir/webdir/foo/start

Assuming cartair.py is in /topdir/webdir, it should be imported 
properly, because the directory in which mod_python is defined is 
prepended to the path (unless PythonPath is set).

You didn't mention the name of your published module, but it looks like 
you're calling it index.py. That's a bad habit you should break. 
Although it's offered as a convenience, it creates problems because 
newbies treat it like index.html and don't understand that you can only 
have one index.py per interpreter, regardless of the location. Published 
modules are imported into the root namespace and will cause collisions 
if all published module names are not unique. This can cause the erratic 
behaviour you describe. Used properly, it can allow you to use a module 
as the root of your site, but it's really just smoke and mirrors. To put 
it in a somewhat gross oversimplification, Publisher allows you to have 
only one index.py in your site.



From list at joreybump.com  Mon Jan 31 10:46:07 2005
From: list at joreybump.com (Jorey Bump)
Date: Mon Jan 31 10:46:12 2005
Subject: [mod_python] pythonpath
In-Reply-To: <200501311622.57974.lroubeyrie@limair.asso.fr>
References: <200501311418.18168.lroubeyrie@limair.asso.fr>	<41FE3CD4.4010606@joreybump.com>
	<200501311622.57974.lroubeyrie@limair.asso.fr>
Message-ID: <41FE52BF.1040409@joreybump.com>

Lionel Roubeyrie wrote:
> Hi again,
> I have done another test with the PythonPath directive, and the env variable 
> is not set :

> PATH = /usr/local/bin:/usr/bin:/bin 
>  PYTHONPATH = Not set 
>  SYSPATH 
> = /usr/lib/python23.zip:/usr/lib/python2.3:/usr/lib/python2.3/plat-linux2:/usr/lib/python2.3/lib-tk:
> /usr/lib/python2.3/lib-dynload:/usr/local/lib/python2.3/site-packages:/usr/lib/python2.3/site-packages:
> /usr/lib/python2.3/site-packages/Numeric:/usr/lib/python2.3/site-packages/PIL:
> /topdir/webdir

Don't worry about it, you only care about sys.path.
From lroubeyrie at limair.asso.fr  Mon Jan 31 11:47:37 2005
From: lroubeyrie at limair.asso.fr (Lionel Roubeyrie)
Date: Mon Jan 31 11:49:03 2005
Subject: [mod_python] pythonpath
In-Reply-To: <41FE51DD.8070207@joreybump.com>
References: <200501311418.18168.lroubeyrie@limair.asso.fr>
	<200501311557.40282.lroubeyrie@limair.asso.fr>
	<41FE51DD.8070207@joreybump.com>
Message-ID: <200501311747.37931.lroubeyrie@limair.asso.fr>

Le Lundi 31 Janvier 2005 16:42, Jorey Bump a ?crit?:
>
> Okay, in order to avoid some the quirks of Publisher, let's give the
> module a unique name, like foo.py. Rename the index function to
> something else (I'll use "start" as an example). Avoid using the Alias
> while you're troubleshooting, and don't set the PythonPath for now. This
> gives us an URL like this:
>
>   http://localhost/topdir/webdir/foo/start
>
> Assuming cartair.py is in /topdir/webdir, it should be imported
> properly, because the directory in which mod_python is defined is
> prepended to the path (unless PythonPath is set).
I use index.py in /topdir/webdir (it's a framed page in which the others pages 
are also in /topdir/webdir. I can put out the .py because I don't really need 
it, but I don't find how to mix .html and .py files together (and I don't 
want to use PSP pages because I need to call others modules). The others .py 
pages use the publisher with a index(req) method, like menu.py which have to 
call cartair.py located in /topdir (and not /topdir/webdir!), and this is the 
problem. One time they can call cartair.py, another time not.

> You didn't mention the name of your published module, but it looks like
> you're calling it index.py. That's a bad habit you should break.
> Although it's offered as a convenience, it creates problems because
> newbies treat it like index.html and don't understand that you can only
> have one index.py per interpreter, regardless of the location. Published
> modules are imported into the root namespace and will cause collisions
> if all published module names are not unique. This can cause the erratic
> behaviour you describe. Used properly, it can allow you to use a module
> as the root of your site, but it's really just smoke and mirrors. To put
> it in a somewhat gross oversimplification, Publisher allows you to have
> only one index.py in your site.
>
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

-- 
Lionel Roubeyrie - lroubeyrie@limair.asso.fr
LIMAIR
http://www.limair.asso.fr


From andfarm at teknovis.com  Mon Jan 31 13:44:55 2005
From: andfarm at teknovis.com (Andrew Farmer)
Date: Mon Jan 31 13:45:00 2005
Subject: [mod_python] Weird ob_callback problems
In-Reply-To: <20050131102730.W26813@grisha.dyndns.org>
References: <44a01877a65104f6b5451ea54d1a283c@teknovis.com>
	<20050131102730.W26813@grisha.dyndns.org>
Message-ID: <80ac6de5669f8cee20205218fe068178@teknovis.com>

On 31 Jan 2005, at 07:28, Gregory (Grisha) Trubetskoy wrote:
> Try defining DYLD_FORCE_FLAT_NAMESPACE=1 environment variable before 
> launching httpd. Don't know if it will help, but it might.

That seems to do it. Thanks.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: PGP.sig
Type: application/pgp-signature
Size: 186 bytes
Desc: This is a digitally signed message part
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050131/f24382fe/PGP.bin
From list at joreybump.com  Mon Jan 31 13:53:37 2005
From: list at joreybump.com (Jorey Bump)
Date: Mon Jan 31 13:53:41 2005
Subject: [mod_python] pythonpath
In-Reply-To: <200501311747.37931.lroubeyrie@limair.asso.fr>
References: <200501311418.18168.lroubeyrie@limair.asso.fr>	<200501311557.40282.lroubeyrie@limair.asso.fr>	<41FE51DD.8070207@joreybump.com>
	<200501311747.37931.lroubeyrie@limair.asso.fr>
Message-ID: <41FE7EB1.2050104@joreybump.com>

Lionel Roubeyrie wrote:
> Le Lundi 31 Janvier 2005 16:42, Jorey Bump a ?crit :
>>Assuming cartair.py is in /topdir/webdir, it should be imported
>>properly, because the directory in which mod_python is defined is
>>prepended to the path (unless PythonPath is set).
> 
> I use index.py in /topdir/webdir (it's a framed page in which the others pages 
> are also in /topdir/webdir. I can put out the .py because I don't really need 
> it, but I don't find how to mix .html and .py files together (and I don't 
> want to use PSP pages because I need to call others modules). The others .py 
> pages use the publisher with a index(req) method, like menu.py 

Because you use AddHandler, you should be able to mix .html and .py 
files. But with Multiviews on, you must take pains to use unique names 
for your files (after removing the extension), or the results will be 
unpredictable (you can't have multiple files named index.html, index.py, 
index.py~, index.cgi, index.jpg, index.bak, etc.). Be sure to remove any 
extraneous backup files, which sometimes cause problems with MultiViews.

> which have to 
> call cartair.py located in /topdir (and not /topdir/webdir!), and this is the 
> problem. One time they can call cartair.py, another time not.

Sorry, I missed the location in your PythonPath directive. If I may ask, 
why must cartair.py be in /topdir? There are any number of reasons why 
this may be a bad idea, but I'm not familiar enough with your setup to 
comment on the restriction. In any case, it must be in your path,  so 
use the PythonPath directive. Keep in mind that this will remove 
/topdir/webdir from being automatically added to your path, so if you 
are importing modules from that directory, it will also need to be added 
to PythonPath.

From joele at qalabs.com  Mon Jan 31 19:33:31 2005
From: joele at qalabs.com (Joel Eusebio)
Date: Mon Jan 31 19:27:11 2005
Subject: [mod_python] Newbie Question
Message-ID: <200502010027.j110R9k4025626@modpython.org>

Hi Everybody,

 

I'm pretty new to Python and would like to ask a few questions. I have this
setup on a Fedora Core 3 box.

 

Python 2.3.4

wxPython-common-gtk-ansi-2.5.3.1-fc2_py2.3

mod_python-3.1.3-5

Apache/2.0.52

 

I have a test.py which looks like this:

 

from mod_python import apache

 

def handler(req):

        req.write("Hello World!")

        return apache.OK

 

Whenever I access test.py from my browser it says "The page cannot be found"
, I have the file on /var/www/html, what did I miss?

 

Thanks in advance,

 

Joel 

 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050131/006877d0/attachment.html
From jgentil at sebistar.net  Mon Jan 31 19:54:37 2005
From: jgentil at sebistar.net (Jon-Pierre Gentil)
Date: Mon Jan 31 19:54:49 2005
Subject: [mod_python] Newbie Question
In-Reply-To: <200502010027.j110R9k4025626@modpython.org>
References: <200502010027.j110R9k4025626@modpython.org>
Message-ID: <200501311854.42251.jgentil@sebistar.net>

On Monday 31 January 2005 06:33 pm, Joel Eusebio wrote:

> I'm pretty new to Python and would like to ask a few questions. I have
> this setup on a Fedora Core 3 box.
> Python 2.3.4
> wxPython-common-gtk-ansi-2.5.3.1-fc2_py2.3

Not sure what wxPython has to do with it...

> mod_python-3.1.3-5
> Apache/2.0.52

Can you show us your Apache config file snippet that defines your 
Directory config sections?



-- 
_________________________________________________________

  Jon-Pierre Gentil               PGP: 0xA21BC30E
  jabber: jgentil@sebistar.net    web: www.sebistar.net
  "If you think education is expensive, try ignorance."
_________________________________________________________ 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: not available
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050131/3e869b29/attachment.bin
