<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Segmentation fault when loading modules
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Segmentation%20fault%20when%20loading%20modules&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022126.html">
   <LINK REL="Next"  HREF="022129.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Segmentation fault when loading modules</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Siddhartha Azad</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Segmentation%20fault%20when%20loading%20modules&In-Reply-To="
       TITLE="[mod_python] Segmentation fault when loading modules">sid_docs at yahoo.com
       </A><BR>
    <I>Tue Sep 26 20:16:40 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="022126.html">[mod_python] Cookies &amp; mod_rewrite
</A></li>
        <LI>Next message: <A HREF="022129.html">[mod_python] Segmentation fault when loading modules
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22128">[ date ]</a>
              <a href="thread.html#22128">[ thread ]</a>
              <a href="subject.html#22128">[ subject ]</a>
              <a href="author.html#22128">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,
I have mod_python 3.2.10 built with apache 2.2.3 on RH
Linux. All was working fine for me until I changed my
directory structure (and hence the location of the
python modules). After doing so I apache started
seg-faulting. I  debugged with gdb -X and the
stacktrace points (as I suspected) to some
module-loading code that eventually crashes in some
pyexpat module due to a null string.

When I change my directory structure to what it was
before, everything works perfectly.

1. The directory structure that works:

   /dev/www/xyz.py
   /dev/www/modules/*.py

 When I invoke xyz.py from the browser (xyz.py imports
modules from &quot;modules.py&quot;) everything works fine (i.e.
when the modules sub-directory is under within the
same parent directory as xyz.py.


2. The directory structure that doesn't work:

  /dev/www/xyz.py
  /dev/modules/*.py


Notice that the modules are no longer under the &quot;www&quot;
directory. Also, this only happens when my PYTHONPATH
actually has the &quot;modules&quot; directory (otherwise of
course I get an error from xyz.py that the import of
the modules failed).
Please help, I have been trying to fix this for 2 days
now and cannot find any references anyplace else.
The output from the apache error log and some walkback
from &quot;gdb&quot; follow.
Thanks, Sid.

APACHE ERROR LOG
----------------

[Tue Sep 26 20:12:47 2006] [notice] mod_python:
(Re)importing module 'mod_python.publisher'
[Tue Sep 26 20:12:47 2006] [notice] [client 127.0.0.1]
Publisher loading page /home/sid/dev/www/xyz.py
[Tue Sep 26 20:12:48 2006] [notice] child pid 32091
exit signal Segmentation fault (11)


WALKBACK FROM DEBUGGER
----------------------


#0  0x40167892 in PyString_FromString (str=0x0) at
Objects/stringobject.c:106
#1  0x401b8373 in PyModule_AddStringConstant
(m=0x4081e0ec,
   name=0x4092f6ba &quot;XML_ERROR_UNBOUND_PREFIX&quot;,
value=0x0) at
Python/modsupport.c:531
#2  0x40913fa1 in initpyexpat () at
/usr/python-2.4.2/Python-2.4.2/Modules/pyexpat.c:1970
#3  0x401b2bad in _PyImport_LoadDynamicModule
(name=0xbfffadfc &quot;pyexpat&quot;,
   pathname=0xbfffa960
&quot;/usr/local/lib/python2.4/lib-dynload/pyexpat.so&quot;,
fp=0x8253090)
   at Python/importdl.c:53
#4  0x401af90d in load_module (name=0xbfffadfc
&quot;pyexpat&quot;, fp=0x8253090,
   buf=0xbfffa960
&quot;/usr/local/lib/python2.4/lib-dynload/pyexpat.so&quot;,
type=3, loader=0x1b)
   at Python/import.c:1677
#5  0x401b0615 in import_submodule (mod=0x40208de0,
subname=0xbfffadfc
&quot;pyexpat&quot;,
   fullname=0xbfffadfc &quot;pyexpat&quot;) at
Python/import.c:2262


</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022126.html">[mod_python] Cookies &amp; mod_rewrite
</A></li>
	<LI>Next message: <A HREF="022129.html">[mod_python] Segmentation fault when loading modules
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22128">[ date ]</a>
              <a href="thread.html#22128">[ thread ]</a>
              <a href="subject.html#22128">[ subject ]</a>
              <a href="author.html#22128">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
