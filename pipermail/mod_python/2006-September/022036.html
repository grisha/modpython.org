<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Mod-Python Help
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Mod-Python%20Help&In-Reply-To=1157589578.5516.14.camel%40anthracite.dev.neuraliq.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022035.html">
   <LINK REL="Next"  HREF="022037.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Mod-Python Help</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Mod-Python%20Help&In-Reply-To=1157589578.5516.14.camel%40anthracite.dev.neuraliq.com"
       TITLE="[mod_python] Mod-Python Help">grahamd at dscpl.com.au
       </A><BR>
    <I>Wed Sep  6 20:58:42 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="022035.html">[mod_python] Mod-Python Help
</A></li>
        <LI>Next message: <A HREF="022037.html">[mod_python] Mod-Python Help
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22036">[ date ]</a>
              <a href="thread.html#22036">[ thread ]</a>
              <a href="subject.html#22036">[ subject ]</a>
              <a href="author.html#22036">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On 07/09/2006, at 10:39 AM, David Beal wrote:

&gt;<i> Ethan,
</I>&gt;<i>
</I>&gt;&gt;<i> Thanks for your help.  It turns out the problem was the &quot;return
</I>&gt;&gt;<i> apache.OK&quot;.  I was getting that extra 0 at the end and could not
</I>&gt;&gt;<i> figure
</I>&gt;&gt;<i> out why.  Thanks for the prompt replies.  I appreciate all the help.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> The problem is probably not with return apache.OK, but maybe with the
</I>&gt;<i> client's XmlHttpRequest handler not understanding chunked encoding
</I>&gt;<i> markers.  The 0 is for HTTP chunked encoding.  Look for the header:
</I>&gt;<i>
</I>&gt;<i> Transfer-Encoding: chunked
</I>&gt;<i>
</I>&gt;<i> and the first line of the content will be a hexadecimal number of the
</I>&gt;<i> content-length for the first chunk.  Each subsequent chunk comes  
</I>&gt;<i> with a
</I>&gt;<i> chunk length marker.  The 0 at the end of the file indicates that  
</I>&gt;<i> there
</I>&gt;<i> are no more chunks.  Chunk length markers will also appear whenever an
</I>&gt;<i> output flush occurs.
</I>&gt;<i>
</I>&gt;<i> To disable chunked encoding, you should specify a content length:
</I>&gt;<i>
</I>&gt;<i> req.headers_out['Content-Length']=str(len(code))
</I>
I'd suggest it isn't anything to do with chunked encoding and the  
original
suggestion about apache.OK is going to be correct.

It is an occasional problem we have to correct whereby people who move
from a mod_python basic handler to mod_python.publisher keep returning
apache.OK as a status when they shouldn't with result of an extra '0'
appearing in response.

Ie., a mod_python basic handler of:

   def handler(req):
     req.content_type = 'text/plain'
     req.write(&quot;content&quot;)
     return apache.OK

can not simply be taken and then used as mod_python.publisher  
function as:

   def index(req):
     req.content_type = 'text/plain'
     req.write(&quot;content&quot;)
     return apache.OK

This is because mod_python.publisher will always take the result of  
the function
and convert it to a string and append it to the response, even if  
req.write() were
used. Thus, must be written as:

   def index(req):
     req.content_type = 'text/plain'
     req.write(&quot;content&quot;)

or for older versions of mod_python where returning None or an empty  
string is
a problem, written as:

   def index(req):
     req.content_type = 'text/plain'
     req.write(&quot;content&quot;)
     return ' '

Graham
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022035.html">[mod_python] Mod-Python Help
</A></li>
	<LI>Next message: <A HREF="022037.html">[mod_python] Mod-Python Help
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22036">[ date ]</a>
              <a href="thread.html#22036">[ thread ]</a>
              <a href="subject.html#22036">[ subject ]</a>
              <a href="author.html#22036">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
