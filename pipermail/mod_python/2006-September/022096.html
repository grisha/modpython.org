<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Cookies &amp; mod_rewrite
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Cookies%20%26%20mod_rewrite&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022099.html">
   <LINK REL="Next"  HREF="022097.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Cookies &amp; mod_rewrite</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Cookies%20%26%20mod_rewrite&In-Reply-To="
       TITLE="[mod_python] Cookies &amp; mod_rewrite">grahamd at dscpl.com.au
       </A><BR>
    <I>Mon Sep 18 18:13:14 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="022099.html">[mod_python] Lama, sorry: Windows, Apache 2.2.3, ModPy
</A></li>
        <LI>Next message: <A HREF="022097.html">[mod_python] Cookies &amp; mod_rewrite
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22096">[ date ]</a>
              <a href="thread.html#22096">[ thread ]</a>
              <a href="subject.html#22096">[ subject ]</a>
              <a href="author.html#22096">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>CARTWRIGHT, Guy, GBM wrote ..
&gt;<i> Hi
</I>&gt;<i> 
</I>&gt;<i> I'm using mod_python to perform NTLM authentication. In my handler script
</I>&gt;<i> &quot;ntlmhandler.py&quot; a cookie gets set using the following code:
</I>&gt;<i> 
</I>&gt;<i> cookie = Cookie.Cookie('username', user, path='/')
</I>&gt;<i> Cookie.add_cookie(req, cookie)   
</I>&gt;<i> 
</I>&gt;<i> With the following apache conf for some reason the cookie is not getting
</I>&gt;<i> passed in the request to the rewrite url. When requesting a page in the
</I>&gt;<i> /ntlm directory without the rewrite rule in place, the above cookie is
</I>&gt;<i> getting set fine. Does anybody have any ideas why this might be the case?
</I>&gt;<i> 
</I>&gt;<i> &lt;VirtualHost 192.168.100.100:80&gt;
</I>&gt;<i>     ServerName myserver.com
</I>&gt;<i>     KeepAlive On
</I>&gt;<i> 
</I>&gt;<i>     DocumentRoot /ntlm/
</I>&gt;<i> 
</I>&gt;<i>     &lt;Directory /ntlm&gt; 
</I>&gt;<i>         AddHandler mod_python .py
</I>
You don't need AddHandler if you aren't defining a response handler, ie. only
need that or SetHandler when using PythonHandler directive.

&gt;<i>         PythonAuthenHandler ntlmhandler
</I>
Have you added logging in your authenhandler and know for sure that it is being
called?

&gt;<i>         PythonDebug On
</I>&gt;<i>         AuthType NTLM
</I>&gt;<i>         require valid-user
</I>&gt;<i> 
</I>&gt;<i>         RewriteEngine On
</I>&gt;<i>         RewriteRule ^(.*)$
</I>&gt;<i> <A HREF="http://192.168.100.100:5090/VirtualHostBase/http/myserver.com:80/dev/content">http://192.168.100.100:5090/VirtualHostBase/http/myserver.com:80/dev/content</A>
</I>&gt;<i> _root/VirtualHostRoot/$1 [P,L]    
</I>&gt;<i> 
</I>&gt;<i>     &lt;/Directory&gt;    
</I>&gt;<i> 
</I>&gt;<i> &lt;/VirtualHost&gt;
</I>
I am not very good at mod_rewrite, but I read this as you using mod_rewrite to
proxy the request through to a backend server. If this is true and your
expectation is that the cookie will be passed through to the backend to be used
there somehow before perhaps also being sent back to the client, your
assumption would be wrong. This is because setting a cookie in the
authenhandler is going to be done in the headers_out where only headers_in
would be getting proxied through.

Is that what you were expecting?

Graham

</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022099.html">[mod_python] Lama, sorry: Windows, Apache 2.2.3, ModPy
</A></li>
	<LI>Next message: <A HREF="022097.html">[mod_python] Cookies &amp; mod_rewrite
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22096">[ date ]</a>
              <a href="thread.html#22096">[ thread ]</a>
              <a href="subject.html#22096">[ subject ]</a>
              <a href="author.html#22096">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
