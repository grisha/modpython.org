<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Raising Exceptions
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Raising%20Exceptions&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022158.html">
   <LINK REL="Next"  HREF="022167.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Raising Exceptions</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>John Keyes</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Raising%20Exceptions&In-Reply-To="
       TITLE="[mod_python] Raising Exceptions">john.keyes at secantus.com
       </A><BR>
    <I>Fri Sep 29 06:09:53 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="022158.html">[mod_python] fedora vs ubuntu
</A></li>
        <LI>Next message: <A HREF="022167.html">[mod_python] Raising Exceptions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22159">[ date ]</a>
              <a href="thread.html#22159">[ thread ]</a>
              <a href="subject.html#22159">[ subject ]</a>
              <a href="author.html#22159">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi guys,

I've included some test code (see below) for some weird
behaviour I've noticed.

I have dispatcher.py set up as a handler which dynamically
imports another handler (testhandler.py) and then calls
it's handler function.

The handler function in testhandler throws a user defined
exception (see __init__.py) which the dispatcher is
explicity set up to catch (see except MyError).

If I import testhandler using apache.import_module I
get the following output:

  test
  testhandler - b4 raise
  exception - MyError - jk

Yet if I use __import__ and getattr I get the following
output:

  test
  testhandler - b4 raise
  myerror

As you can see using import_module the incorrect except
block is executed, but the class name of the exception
is correct.

Can anyone explain to me why this is the case?

I've the code included inline but if you want to run the
code I've attached a zip file as well.

Apache     - 2.0.58
mod_python - 3.2.8
Python     - 2.4.3

Cheers,
-John K

== test.__init__.py ==
class MyError(Exception):
    def __init__(self, msg):
        self.msg = msg

    def __str__(self):
        return self.msg

== test.dispatcher.py ==
from mod_python import apache

from test import MyError

def handler(req):
    req.write(&quot;\ntest&quot;)

    try:
        #test_handler = apache.import_module('test.handlers.testhandler')
        test_handler = my_import('test.handlers.testhandler')
        val = test_handler.handler(req)
    except MyError, me:
        req.write(&quot;\nmyerror&quot;)
    except Exception, e:
        req.write(&quot;\nexception - %s - %s&quot; % (e.__class__.__name__, e))

    return apache.OK

def my_import(name):
    mod = __import__(name)
    components = name.split('.')
    for comp in components[1:]:
        mod = getattr(mod, comp)
    return mod

== test.handlers.testhandler.py ==
from mod_python import apache

from test import MyError

def handler(req):
    req.write(&quot;\ntesthandler - b4 raise&quot;)

    raise MyError('jk')

    req.write(&quot;\ntesthandler - af raise&quot;)
    return apache.OK
-------------- next part --------------
A non-text attachment was scrubbed...
Name: import_test.zip
Type: application/zip
Size: 1113 bytes
Desc: not available
Url : <A HREF="http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060929/3bba7e00/import_test.zip">http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060929/3bba7e00/import_test.zip</A>
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022158.html">[mod_python] fedora vs ubuntu
</A></li>
	<LI>Next message: <A HREF="022167.html">[mod_python] Raising Exceptions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22159">[ date ]</a>
              <a href="thread.html#22159">[ thread ]</a>
              <a href="subject.html#22159">[ subject ]</a>
              <a href="author.html#22159">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
