From aditya.vrr at gmail.com  Tue May  2 18:36:48 2006
From: aditya.vrr at gmail.com (gOLeM)
Date: Tue May  2 18:36:55 2006
Subject: [mod_python] Mod Python startup errors
Message-ID: <ec2d07cf0605021536k18dc8e0u2eb9ee9b4f9921b@mail.gmail.com>

one of my friends tried to install datetime module for python and he
moved some so files here and there. (He doesnt remember which ones :(
)

if there is anything you guys could help me on this without me having
to reinstall python/modpython, i would be very thankful :)

modpython version 3.2.8
python version 2.3.5

taken from /var/log/httpd/error_log

[Wed May 03 03:59:12 2006] [error] make_obcallback: could not import
mod_python.apache.

Could not find platform independent libraries <prefix>
Could not find platform dependent libraries <exec_prefix>
Consider setting $PYTHONHOME to <prefix>[:<exec_prefix>]
'import site' failed; use -v for traceback
/usr/lib/python2.2/os.py:282: Warning: 'yield' will become a reserved
keyword in the future
'import site' failed; use -v for traceback
ImportError: No module named mod_python.apache
[Wed May 03 03:59:12 2006] [error] python_handler: no interpreter
callback found.
[Wed May 03 03:59:12 2006] [error] make_obcallback: could not import
mod_python.apache.

Could not find platform independent libraries <prefix>
Could not find platform dependent libraries <exec_prefix>
Consider setting $PYTHONHOME to <prefix>[:<exec_prefix>]
'import site' failed; use -v for traceback
/usr/lib/python2.2/os.py:282: Warning: 'yield' will become a reserved
keyword in the future
'import site' failed; use -v for traceback
ImportError: No module named mod_python.apache
[Wed May 03 03:59:12 2006] [error] python_handler: no interpreter
callback found.
[Wed May 03 03:59:12 2006] [error] make_obcallback: could not import
mod_python.apache.

Could not find platform independent libraries <prefix>
Could not find platform dependent libraries <exec_prefix>
Consider setting $PYTHONHOME to <prefix>[:<exec_prefix>]
'import site' failed; use -v for traceback
/usr/lib/python2.2/os.py:282: Warning: 'yield' will become a reserved
keyword in the future
'import site' failed; use -v for traceback
ImportError: No module named mod_python.apache
[Wed May 03 03:59:12 2006] [error] python_handler: no interpreter
callback found.
[Wed May 03 03:59:12 2006] [error] make_obcallback: could not import
mod_python.apache.

Could not find platform independent libraries <prefix>
Could not find platform dependent libraries <exec_prefix>
Consider setting $PYTHONHOME to <prefix>[:<exec_prefix>]
'import site' failed; use -v for traceback
/usr/lib/python2.2/os.py:282: Warning: 'yield' will become a reserved
keyword in the future
'import site' failed; use -v for traceback
ImportError: No module named mod_python.apache
[Wed May 03 03:59:12 2006] [error] python_handler: no interpreter
callback found.
[Wed May 03 03:59:12 2006] [error] make_obcallback: could not import
mod_python.apache.

Could not find platform independent libraries <prefix>
Could not find platform dependent libraries <exec_prefix>
Consider setting $PYTHONHOME to <prefix>[:<exec_prefix>]
'import site' failed; use -v for traceback
/usr/lib/python2.2/os.py:282: Warning: 'yield' will become a reserved
keyword in the future
'import site' failed; use -v for traceback
ImportError: No module named mod_python.apache
[Wed May 03 03:59:12 2006] [error] python_handler: no interpreter
callback found.
[Wed May 03 03:59:12 2006] [error] make_obcallback: could not import
mod_python.apache.

Could not find platform independent libraries <prefix>
Could not find platform dependent libraries <exec_prefix>
Consider setting $PYTHONHOME to <prefix>[:<exec_prefix>]
'import site' failed; use -v for traceback
/usr/lib/python2.2/os.py:282: Warning: 'yield' will become a reserved
keyword in the future
'import site' failed; use -v for traceback
ImportError: No module named mod_python.apache
[Wed May 03 03:59:12 2006] [error] python_handler: no interpreter
callback found.
[Wed May 03 03:59:12 2006] [error] make_obcallback: could not import
mod_python.apache.

Could not find platform independent libraries <prefix>
Could not find platform dependent libraries <exec_prefix>
Consider setting $PYTHONHOME to <prefix>[:<exec_prefix>]
'import site' failed; use -v for traceback
/usr/lib/python2.2/os.py:282: Warning: 'yield' will become a reserved
keyword in the future
'import site' failed; use -v for traceback
ImportError: No module named mod_python.apache
[Wed May 03 03:59:12 2006] [error] python_handler: no interpreter
callback found.
[Wed May 03 03:59:12 2006] [error] make_obcallback: could not import
mod_python.apache.

Could not find platform independent libraries <prefix>
Could not find platform dependent libraries <exec_prefix>
Consider setting $PYTHONHOME to <prefix>[:<exec_prefix>]
'import site' failed; use -v for traceback
/usr/lib/python2.2/os.py:282: Warning: 'yield' will become a reserved
keyword in the future
'import site' failed; use -v for traceback
ImportError: No module named mod_python.apache
[Wed May 03 03:59:12 2006] [error] python_handler: no interpreter
callback found.
[Wed May 03 03:59:12 2006] [notice] caught SIGTERM, shutting down
Could not find platform independent libraries <prefix>
Could not find platform dependent libraries <exec_prefix>
Consider setting $PYTHONHOME to <prefix>[:<exec_prefix>]
'import site' failed; use -v for traceback
[Wed May 03 03:59:13 2006] [notice] Digest: generating secret for
digest authentication ...
[Wed May 03 03:59:13 2006] [notice] Digest: done
[Wed May 03 03:59:14 2006] [notice] mod_python: Creating 8 session
mutexes based on 150 max processes and 0 max threads.
[Wed May 03 03:59:14 2006] [notice] Apache/2.0.47 (Fedora) configured
-- resuming normal operations



--
The Purpose of Life is a life of purpose -- Leider, Richard
Quitters never win and Winners never quit   -- Napolean Hill

From grahamd at dscpl.com.au  Tue May  2 23:13:44 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue May  2 23:13:47 2006
Subject: [mod_python] Mod Python startup errors
Message-ID: <1146626024.32352@dscpl.user.openhosting.com>

gOLeM wrote ..
> one of my friends tried to install datetime module for python and he
> moved some so files here and there. (He doesnt remember which ones :(
> )
> 
> if there is anything you guys could help me on this without me having
> to reinstall python/modpython, i would be very thankful :)
> 
> modpython version 3.2.8
> python version 2.3.5

When you start apache manually, mod_python it will use whatever version
of Python it finds in the PATH. Base on the log messages below, although
you reckon you are using Python 2.3.5, mod_python is using Python 2.2.X.

You need to ensure that python binary for 2.3.5 is in your PATH before
that for Python 2.2.X.

Alternatively, you have so broken the Python 2.3.5 installation that it was
not able to use it and somehow found Python 2.2.X instead.

Graham

> taken from /var/log/httpd/error_log
> 
> [Wed May 03 03:59:12 2006] [error] make_obcallback: could not import
> mod_python.apache.
> 
> Could not find platform independent libraries <prefix>
> Could not find platform dependent libraries <exec_prefix>
> Consider setting $PYTHONHOME to <prefix>[:<exec_prefix>]
> 'import site' failed; use -v for traceback
> /usr/lib/python2.2/os.py:282: Warning: 'yield' will become a reserved
> keyword in the future
> 'import site' failed; use -v for traceback
> ImportError: No module named mod_python.apache
> [Wed May 03 03:59:12 2006] [error] python_handler: no interpreter
> callback found.
> [Wed May 03 03:59:12 2006] [error] make_obcallback: could not import
> mod_python.apache.
> 
> Could not find platform independent libraries <prefix>
> Could not find platform dependent libraries <exec_prefix>
> Consider setting $PYTHONHOME to <prefix>[:<exec_prefix>]
> 'import site' failed; use -v for traceback
> /usr/lib/python2.2/os.py:282: Warning: 'yield' will become a reserved
> keyword in the future
> 'import site' failed; use -v for traceback
> ImportError: No module named mod_python.apache
> [Wed May 03 03:59:12 2006] [error] python_handler: no interpreter
> callback found.
> [Wed May 03 03:59:12 2006] [error] make_obcallback: could not import
> mod_python.apache.
> 
> Could not find platform independent libraries <prefix>
> Could not find platform dependent libraries <exec_prefix>
> Consider setting $PYTHONHOME to <prefix>[:<exec_prefix>]
> 'import site' failed; use -v for traceback
> /usr/lib/python2.2/os.py:282: Warning: 'yield' will become a reserved
> keyword in the future
> 'import site' failed; use -v for traceback
> ImportError: No module named mod_python.apache
> [Wed May 03 03:59:12 2006] [error] python_handler: no interpreter
> callback found.
> [Wed May 03 03:59:12 2006] [error] make_obcallback: could not import
> mod_python.apache.
> 
> Could not find platform independent libraries <prefix>
> Could not find platform dependent libraries <exec_prefix>
> Consider setting $PYTHONHOME to <prefix>[:<exec_prefix>]
> 'import site' failed; use -v for traceback
> /usr/lib/python2.2/os.py:282: Warning: 'yield' will become a reserved
> keyword in the future
> 'import site' failed; use -v for traceback
> ImportError: No module named mod_python.apache
> [Wed May 03 03:59:12 2006] [error] python_handler: no interpreter
> callback found.
> [Wed May 03 03:59:12 2006] [error] make_obcallback: could not import
> mod_python.apache.
> 
> Could not find platform independent libraries <prefix>
> Could not find platform dependent libraries <exec_prefix>
> Consider setting $PYTHONHOME to <prefix>[:<exec_prefix>]
> 'import site' failed; use -v for traceback
> /usr/lib/python2.2/os.py:282: Warning: 'yield' will become a reserved
> keyword in the future
> 'import site' failed; use -v for traceback
> ImportError: No module named mod_python.apache
> [Wed May 03 03:59:12 2006] [error] python_handler: no interpreter
> callback found.
> [Wed May 03 03:59:12 2006] [error] make_obcallback: could not import
> mod_python.apache.
> 
> Could not find platform independent libraries <prefix>
> Could not find platform dependent libraries <exec_prefix>
> Consider setting $PYTHONHOME to <prefix>[:<exec_prefix>]
> 'import site' failed; use -v for traceback
> /usr/lib/python2.2/os.py:282: Warning: 'yield' will become a reserved
> keyword in the future
> 'import site' failed; use -v for traceback
> ImportError: No module named mod_python.apache
> [Wed May 03 03:59:12 2006] [error] python_handler: no interpreter
> callback found.
> [Wed May 03 03:59:12 2006] [error] make_obcallback: could not import
> mod_python.apache.
> 
> Could not find platform independent libraries <prefix>
> Could not find platform dependent libraries <exec_prefix>
> Consider setting $PYTHONHOME to <prefix>[:<exec_prefix>]
> 'import site' failed; use -v for traceback
> /usr/lib/python2.2/os.py:282: Warning: 'yield' will become a reserved
> keyword in the future
> 'import site' failed; use -v for traceback
> ImportError: No module named mod_python.apache
> [Wed May 03 03:59:12 2006] [error] python_handler: no interpreter
> callback found.
> [Wed May 03 03:59:12 2006] [error] make_obcallback: could not import
> mod_python.apache.
> 
> Could not find platform independent libraries <prefix>
> Could not find platform dependent libraries <exec_prefix>
> Consider setting $PYTHONHOME to <prefix>[:<exec_prefix>]
> 'import site' failed; use -v for traceback
> /usr/lib/python2.2/os.py:282: Warning: 'yield' will become a reserved
> keyword in the future
> 'import site' failed; use -v for traceback
> ImportError: No module named mod_python.apache
> [Wed May 03 03:59:12 2006] [error] python_handler: no interpreter
> callback found.
> [Wed May 03 03:59:12 2006] [notice] caught SIGTERM, shutting down
> Could not find platform independent libraries <prefix>
> Could not find platform dependent libraries <exec_prefix>
> Consider setting $PYTHONHOME to <prefix>[:<exec_prefix>]
> 'import site' failed; use -v for traceback
> [Wed May 03 03:59:13 2006] [notice] Digest: generating secret for
> digest authentication ...
> [Wed May 03 03:59:13 2006] [notice] Digest: done
> [Wed May 03 03:59:14 2006] [notice] mod_python: Creating 8 session
> mutexes based on 150 max processes and 0 max threads.
> [Wed May 03 03:59:14 2006] [notice] Apache/2.0.47 (Fedora) configured
> -- resuming normal operations
> 
> 
> 
> --
> The Purpose of Life is a life of purpose -- Leider, Richard
> Quitters never win and Winners never quit   -- Napolean Hill
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
From e.deventer at boer.nl  Wed May  3 04:52:39 2006
From: e.deventer at boer.nl (e.deventer@boer.nl)
Date: Wed May  3 04:52:50 2006
Subject: [mod_python] error: could not import mod_python.apache
In-Reply-To: <006001c6653e$eb9499c0$0301a8c0@uberbox>
Message-ID: <OF2F778165.86778206-ONC1257163.00244C9B-C1257163.0030C42E@boer.nl>

Sorry it took me so long to reply, there were a lot of other things going 
on.


"Lee Brown" <administrator@leebrown.org> wrote on 21-04-2006 14:27:13:

> The reason why I asked you to check the owner status is that the 
> owner of a file or application is always fully-privileged for that 
> file or application.  Ask your system administrator to log and in 
> and try running your tests again.  If it works when the 
> administrator is the current user and it doesn't work when you are 
> the current user, then somewhere in the apache/mod_python/python 
> process there is a file that cannot be accessed by an ordinary user.

Turns out I was wrong, they are not owned by the user Administrator but by 
the user group Administrators. And my user account is actually part of the 
Administrators group.

> If so, the quickest solution is for your administrator is to create 
> a new user group that has administrator-level privileges for all of 
> apache, mod_python, python, and the web document directories - all 
> the stuff you will be using.  He should then add your user to that 
group.

All these files are owned by the Administrator group.

Kind regards,
Edwin

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060503/334ecfdd/attachment.html
From geoff at teammsa.com  Wed May  3 23:59:39 2006
From: geoff at teammsa.com (Geoff Skerrett)
Date: Thu May  4 00:03:43 2006
Subject: [mod_python] Mod_python.publisher behavior - sending .py file to
 browser not processing it in pyton
Message-ID: <000401c66f2f$2ae7faf0$6804a8c0@MSASALESGES2>

Just getting started with modpython. And i am not sure if I understand the
documentation, specifically section 6.1.2 Publishing algorithm so I hope
someone can set me straight.
 
My setup is on a laptop
Apache/2.0.54 (Win32) mod_python/3.2.8 Python/2.4.1 Server 
 
 
Using mod_python.publisher with the following setup in my http.conf file;
<Directory "C:\Program Files\Apache Group\Apache2\htdocs\app/"> 
    SetHandler mod_python
    AddHandler mod_python .py
    AddHandler mod_python .pyw
    AddHandler mod_python .pyc
    PythonHandler mod_python.publisher
    PythonDebug On 
</Directory> 
 
As I interpret the documentation; entering the following URL
http://localhost/app/
 
the system should look for a file index.py 
and then within this a function def index()
and then it will be processed the results.
Unfortunate when I enter this, the file index.py is actually sent to the
browser as a text file an is not being processed by mod_python.
 
In the same index.py file, I have a function called "login()".  If I enter
the URL;
http://localhost/app/login
 
The function is proessed and results from login a transmitted to the browser
without a problem.
 
So my question is ...
 
What setting am I missing that the index/index isn't processed
and
How do I prevent my *.py files from being "served" to the browser.
 
Thanks for you patience.
 
-----------------------------
Geoff Skerrett
Murray, Skerrett & Associates, Jonas Business Software
Phn: 902-461-0079 ~ Fax:902-461-9559 ~ Mob: 516-220-9723
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060504/ece04a21/attachment.html
From grahamd at dscpl.com.au  Thu May  4 00:16:43 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu May  4 00:16:46 2006
Subject: [mod_python] Mod_python.publisher behavior - sending .py file
	tobrowser not processing it in pyton
Message-ID: <1146716203.13055@dscpl.user.openhosting.com>

Geoff Skerrett wrote ..
> Just getting started with modpython. And i am not sure if I understand
> the
> documentation, specifically section 6.1.2 Publishing algorithm so I hope
> someone can set me straight.
>  
> My setup is on a laptop
> Apache/2.0.54 (Win32) mod_python/3.2.8 Python/2.4.1 Server 
>  
>  
> Using mod_python.publisher with the following setup in my http.conf file;
> <Directory "C:\Program Files\Apache Group\Apache2\htdocs\app/"> 
>     SetHandler mod_python
>     AddHandler mod_python .py
>     AddHandler mod_python .pyw
>     AddHandler mod_python .pyc
>     PythonHandler mod_python.publisher
>     PythonDebug On 
> </Directory> 

Running out the door, so can't explain in detail. But you should not
be setting both SetHandler and AddHandler. Just use SetHandler and
see what happens.

Graham
From nogradi at gmail.com  Thu May  4 06:17:38 2006
From: nogradi at gmail.com (Daniel Nogradi)
Date: Thu May  4 06:17:44 2006
Subject: [mod_python] Re: Mod_python.publisher behavior - sending .py file
	tobrowser not processing it in pyton
In-Reply-To: <1146716203.13055@dscpl.user.openhosting.com>
References: <1146716203.13055@dscpl.user.openhosting.com>
Message-ID: <5f56302b0605040317o4f327f4fob58a1c824dbf3124@mail.gmail.com>

> > Just getting started with modpython. And i am not sure if I understand
> > the
> > documentation, specifically section 6.1.2 Publishing algorithm so I hope
> > someone can set me straight.
> >
> > My setup is on a laptop
> > Apache/2.0.54 (Win32) mod_python/3.2.8 Python/2.4.1 Server
> >
> >
> > Using mod_python.publisher with the following setup in my http.conf file;
> > <Directory "C:\Program Files\Apache Group\Apache2\htdocs\app/">
> >     SetHandler mod_python
> >     AddHandler mod_python .py
> >     AddHandler mod_python .pyw
> >     AddHandler mod_python .pyc
> >     PythonHandler mod_python.publisher
> >     PythonDebug On
> > </Directory>
>
> Running out the door, so can't explain in detail. But you should not
> be setting both SetHandler and AddHandler. Just use SetHandler and
> see what happens.
>

As Graham pointed out SetHandler and AddHandler should not be used at
the same time. "SetHandler mod_python" causes all files to be served
by mod_python and when you refer to them in your browser you don't
need to specify any extension such as .py and "AddHandler mod_python
.py" causes all files ending in .py to be served by mod_python but in
this case when referring to a file in your browser you should add the
.py extension. So if you have

<Directory '/your_document_root/whatever'>
    SetHandler mod_python
    PythonHandler mod_python.publisher
</Directory>

and you have a file /whatever/foo.py with a function bar( ) then in
your browser you would type http://yourserver/whatever/foo/bar,
whereas with

<Directory '/your_document_root/whatever'>
    AddHandler mod_python .py
    PythonHandler mod_python.publisher
</Directory>

you would need http://yourserver/whatever/foo.py/bar

So it's really up to you which behaviour you like, you want *all*
files to be served by mod_python or only those that have a specific
extension and then you set either AddHandler or SetHandler. But not
both :) And in any case, you certainly don't want your .pyc files to
be served at all, so you should probably remove "AddHandler mod_python
.pyc".

HTH :)

From grahamd at dscpl.com.au  Thu May  4 06:56:17 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu May  4 06:56:26 2006
Subject: [mod_python] Re: Mod_python.publisher behavior - sending .py file
	tobrowser not processing it in pyton
In-Reply-To: <5f56302b0605040317o4f327f4fob58a1c824dbf3124@mail.gmail.com>
References: <1146716203.13055@dscpl.user.openhosting.com>
	<5f56302b0605040317o4f327f4fob58a1c824dbf3124@mail.gmail.com>
Message-ID: <F8ED685B-2383-42E0-A661-4FDADB22E8F3@dscpl.com.au>


On 04/05/2006, at 8:17 PM, Daniel Nogradi wrote:

>> > Just getting started with modpython. And i am not sure if I  
>> understand
>> > the
>> > documentation, specifically section 6.1.2 Publishing algorithm  
>> so I hope
>> > someone can set me straight.
>> >
>> > My setup is on a laptop
>> > Apache/2.0.54 (Win32) mod_python/3.2.8 Python/2.4.1 Server
>> >
>> >
>> > Using mod_python.publisher with the following setup in my  
>> http.conf file;
>> > <Directory "C:\Program Files\Apache Group\Apache2\htdocs\app/">
>> >     SetHandler mod_python
>> >     AddHandler mod_python .py
>> >     AddHandler mod_python .pyw
>> >     AddHandler mod_python .pyc
>> >     PythonHandler mod_python.publisher
>> >     PythonDebug On
>> > </Directory>
>>
>> Running out the door, so can't explain in detail. But you should not
>> be setting both SetHandler and AddHandler. Just use SetHandler and
>> see what happens.
>>
>
> As Graham pointed out SetHandler and AddHandler should not be used at
> the same time. "SetHandler mod_python" causes all files to be served
> by mod_python and when you refer to them in your browser you don't
> need to specify any extension such as .py and "AddHandler mod_python
> .py" causes all files ending in .py to be served by mod_python but in
> this case when referring to a file in your browser you should add the
> .py extension. So if you have
>
> <Directory '/your_document_root/whatever'>
>    SetHandler mod_python
>    PythonHandler mod_python.publisher
> </Directory>
>
> and you have a file /whatever/foo.py with a function bar( ) then in
> your browser you would type http://yourserver/whatever/foo/bar,

When using SetHandler you should still be able to use:

   http://yourserver/whatever/foo.py/bar

Your mileage may vary though depending on how some of the
other bits of Apache configuration are set. See some of previous
rants for possibly useful about this.

   http://www.modpython.org/pipermail/mod_python/2005-August/018828.html
   http://www.modpython.org/pipermail/mod_python/2005-August/018829.html
   http://www.modpython.org/pipermail/mod_python/2006-March/020501.html

> whereas with
>
> <Directory '/your_document_root/whatever'>
>    AddHandler mod_python .py
>    PythonHandler mod_python.publisher
> </Directory>
>
> you would need http://yourserver/whatever/foo.py/bar

As long as you have content negotiation directives set correctly, you
don't have to use .py extension when AddHandler is used. See my linked
rants above for details.

> So it's really up to you which behaviour you like, you want *all*
> files to be served by mod_python or only those that have a specific
> extension and then you set either AddHandler or SetHandler. But not
> both :) And in any case, you certainly don't want your .pyc files to
> be served at all, so you should probably remove "AddHandler mod_python
> .pyc".

If using AddHandler and Apache has write permission to directory, it is
actually a good idea to have:

   <Files *.pyc>
   deny from all
   </Files>

This will prevent the pyc files being accessible.

Using AddHandler for pyc extension will probably actually cause it to
execute the file as publisher, just like if py extension was used.  
This is
because mod_python.publisher will quite happily drop the pyc extension
and use basename to match to .py file.

Besides the fact that AddHandler allows you to mix other file types in
the same directory, the main difference between SetHandler and  
AddHandler
as far as mod_python.publisher goes is that when SetHandler is used a
request against the directory is passed through direct to  
mod_python.publisher
and it resolves request to index.py.

When AddHandler is used, a request against the directory results in  
mod_dir
trying to match for a file listed in DirectoryIndex directive. In  
order for
mod_python.publisher to be triggered, you would need to list index.py
in the DirectoryIndex directive.

Other than that, with the correct Apache directives defined related  
to content
negotiation, both ways should allow for optional use of extension.

Graham

From nogradi at gmail.com  Thu May  4 08:05:58 2006
From: nogradi at gmail.com (Daniel Nogradi)
Date: Thu May  4 08:06:03 2006
Subject: [mod_python] Mod_python.publisher behavior - sending .py file
	tobrowser not processing it in pyton
In-Reply-To: <5f56302b0605040503u72fb7bb1j8bdd55dd129f2c1@mail.gmail.com>
References: <1146716203.13055@dscpl.user.openhosting.com>
	<5f56302b0605040317o4f327f4fob58a1c824dbf3124@mail.gmail.com>
	<F8ED685B-2383-42E0-A661-4FDADB22E8F3@dscpl.com.au>
	<5f56302b0605040503u72fb7bb1j8bdd55dd129f2c1@mail.gmail.com>
Message-ID: <5f56302b0605040505m2d19ec4fj74d7f0cd7979f953@mail.gmail.com>

> > As Graham pointed out SetHandler and AddHandler should not be used at
> > the same time. "SetHandler mod_python" causes all files to be served
> > by mod_python and when you refer to them in your browser you don't
> > need to specify any extension such as .py and "AddHandler mod_python
> > .py" causes all files ending in .py to be served by mod_python but in
> > this case when referring to a file in your browser you should add the
> > .py extension. So if you have
> >
> > <Directory '/your_document_root/whatever'>
> >    SetHandler mod_python
> >    PythonHandler mod_python.publisher
> > </Directory>
> >
> > and you have a file /whatever/foo.py with a function bar( ) then in
> > your browser you would type http://yourserver/whatever/foo/bar,
>
> When using SetHandler you should still be able to use:
>
>    http://yourserver/whatever/foo.py/bar
>
> Your mileage may vary though depending on how some of the
> other bits of Apache configuration are set. See some of previous
> rants for possibly useful about this.
>
>    http://www.modpython.org/pipermail/mod_python/2005-August/018828.html
>    http://www.modpython.org/pipermail/mod_python/2005-August/018829.html
>    http://www.modpython.org/pipermail/mod_python/2006-March/020501.html
>
> > whereas with
> >
> > <Directory '/your_document_root/whatever'>
> >    AddHandler mod_python .py
> >    PythonHandler mod_python.publisher
> > </Directory>
> >
> > you would need http://yourserver/whatever/foo.py/bar
>
> As long as you have content negotiation directives set correctly, you
> don't have to use .py extension when AddHandler is used. See my linked
> rants above for details.
>
> > So it's really up to you which behaviour you like, you want *all*
> > files to be served by mod_python or only those that have a specific
> > extension and then you set either AddHandler or SetHandler. But not
> > both :) And in any case, you certainly don't want your .pyc files to
> > be served at all, so you should probably remove "AddHandler mod_python
> > .pyc".
>
> If using AddHandler and Apache has write permission to directory, it is
> actually a good idea to have:
>
>    <Files *.pyc>
>    deny from all
>    </Files>
>
> This will prevent the pyc files being accessible.
>
> Using AddHandler for pyc extension will probably actually cause it to
> execute the file as publisher, just like if py extension was used.
> This is
> because mod_python.publisher will quite happily drop the pyc extension
> and use basename to match to .py file.
>
> Besides the fact that AddHandler allows you to mix other file types in
> the same directory, the main difference between SetHandler and
> AddHandler
> as far as mod_python.publisher goes is that when SetHandler is used a
> request against the directory is passed through direct to
> mod_python.publisher
> and it resolves request to index.py.
>
> When AddHandler is used, a request against the directory results in
> mod_dir
> trying to match for a file listed in DirectoryIndex directive. In
> order for
> mod_python.publisher to be triggered, you would need to list index.py
> in the DirectoryIndex directive.
>
> Other than that, with the correct Apache directives defined related
> to content
> negotiation, both ways should allow for optional use of extension.


Thanks for these clarifications, I indeed didn't realize that my rule
of thumb 'AddHandler: extension needed' vs. 'SetHandler: no extension'
is not quite true. Probably my particular configuration gave me the
feeling that it is always the case, but good to know that it isn't :)

From grahamd at dscpl.com.au  Fri May  5 06:48:32 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Fri May  5 06:49:04 2006
Subject: [mod_python] PythonAuthzHandler not working
In-Reply-To: <1145850628.26998@dscpl.user.openhosting.com>
References: <1145850628.26998@dscpl.user.openhosting.com>
Message-ID: <4AC63DFD-BB0C-45FA-9B5C-B4C3F4209038@dscpl.com.au>


On 24/04/2006, at 1:50 PM, Graham Dumpleton wrote:

> Jim Gallacher wrote ..
>> Ultimately however it seems to me there is a bug in mod_python.c  
>> related
>> to the whole AuthAthoritative business. Consider the following code
>> pulled from the python_handler function. (mod_python.c line 1412
>> revision 396250):
>>
>>     if (strcmp(phase, "PythonAuthenHandler") == 0) {
>>           ... snip ...
>>
>>           if (result == HTTP_UNAUTHORIZED)
>>           {
>>                if   (! conf->authoritative)
>>                      result = DECLINED;
>>
>>
>> conf->authoritative is initialized to 1, but we don't have an Apache
>> directive to set the value. I wonder if the assumption was that  
>> this was
>> set by AuthAuthoritative, or if it there was an oversight in not  
>> adding
>> a new directive? Either way it's a bug. Mod_python should not concern
>> itself with AuthAuthoritative, as that is for use by mod_auth, so we
>> really need our on directive.
>>
>> As confirmation I modified python_handler to log conf- 
>> >authoritative and
>> indeed it's value is unaffected by the AuthAthoritative setting.  
>> In it's
>> current state, PythonAuthenHander will *always* be authoritative.
>>
>> Other mod_auth_* modules define their own  authoritative  
>> directives, for
>> example: AuthDBMAuthoritative, AuthLDAPAuthoritative,
>> AuthMySQLAuthoritative and Anonymous_Authoritative. Following the  
>> most
>> common pattern I would suggest we add AuthPythonAuthoritative.
>>
>> This issue may also be important to
>> http://issues.apache.org/jira/browse/MODPYTHON-129
>
> I've noted the PythonAuthenHandler code in python_handler many  
> times and
> although I need to go back and look at it again I have been thinking
> that that section of code may possibly be partly bogus and  
> shouldn't be
> in there. The warning message about req.user not being set is possibly
> helpful, but why should mod_python be making a decision to change an
> unauthorized response back to a declined and why should it be  
> generating
> a WWW-Authenticate header with an assumption that Basic authorisation
> is being used when it may well not be. What is going to happen if I  
> write
> an authenhandler for Digest authentication and it returns  
> unauthorised,
> mod_python will obliterate any WWW-Authenticate header I may have
> placed there specific to Digest authentication.
>
> Thus I don't necessarily think it is a case of amending it some  
> way, it
> may be a case of obliterating it and make people do the correct thing
> in their handlers to begin with rather than providing a crutch to  
> fix their
> omissions. This may mean adding means of calling further auth related
> functions through the req object if there is something missing now,
> such as access to ap_note_basic_auth_failure().

FWIW, my concerns about something being a bit wrong with the code are a
baseless in as much as ap_note_basic_auth_failure() only adds the header
is AuthType is set to Basic. Thus it cant obliterate a Digest header.

Still think mod_python shouldn't be doing any of this stuff anyway,  
as the
handler should have been doing it in the first place.

Anyway, can remove this thread from my inbox now. :-)

Graham


From jpg at jgassociates.ca  Fri May  5 08:21:50 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Fri May  5 08:21:52 2006
Subject: [mod_python] PythonAuthzHandler not working
In-Reply-To: <4AC63DFD-BB0C-45FA-9B5C-B4C3F4209038@dscpl.com.au>
References: <1145850628.26998@dscpl.user.openhosting.com>
	<4AC63DFD-BB0C-45FA-9B5C-B4C3F4209038@dscpl.com.au>
Message-ID: <445B435E.7010903@jgassociates.ca>

Graham Dumpleton wrote:
> 
> On 24/04/2006, at 1:50 PM, Graham Dumpleton wrote:
> 
>> Jim Gallacher wrote ..
>>> Ultimately however it seems to me there is a bug in mod_python.c related
>>> to the whole AuthAthoritative business. Consider the following code
>>> pulled from the python_handler function. (mod_python.c line 1412
>>> revision 396250):
>>>
>>>     if (strcmp(phase, "PythonAuthenHandler") == 0) {
>>>           ... snip ...
>>>
>>>           if (result == HTTP_UNAUTHORIZED)
>>>           {
>>>                if   (! conf->authoritative)
>>>                      result = DECLINED;
>>>
>>>
>>> conf->authoritative is initialized to 1, but we don't have an Apache
>>> directive to set the value. I wonder if the assumption was that this was
>>> set by AuthAuthoritative, or if it there was an oversight in not adding
>>> a new directive? Either way it's a bug. Mod_python should not concern
>>> itself with AuthAuthoritative, as that is for use by mod_auth, so we
>>> really need our on directive.
>>>
>>> As confirmation I modified python_handler to log conf->authoritative and
>>> indeed it's value is unaffected by the AuthAthoritative setting. In it's
>>> current state, PythonAuthenHander will *always* be authoritative.
>>>
>>> Other mod_auth_* modules define their own  authoritative directives, for
>>> example: AuthDBMAuthoritative, AuthLDAPAuthoritative,
>>> AuthMySQLAuthoritative and Anonymous_Authoritative. Following the most
>>> common pattern I would suggest we add AuthPythonAuthoritative.
>>>
>>> This issue may also be important to
>>> http://issues.apache.org/jira/browse/MODPYTHON-129
>>
>> I've noted the PythonAuthenHandler code in python_handler many times and
>> although I need to go back and look at it again I have been thinking
>> that that section of code may possibly be partly bogus and shouldn't be
>> in there. The warning message about req.user not being set is possibly
>> helpful, but why should mod_python be making a decision to change an
>> unauthorized response back to a declined and why should it be generating
>> a WWW-Authenticate header with an assumption that Basic authorisation
>> is being used when it may well not be. What is going to happen if I write
>> an authenhandler for Digest authentication and it returns unauthorised,
>> mod_python will obliterate any WWW-Authenticate header I may have
>> placed there specific to Digest authentication.
>>
>> Thus I don't necessarily think it is a case of amending it some way, it
>> may be a case of obliterating it and make people do the correct thing
>> in their handlers to begin with rather than providing a crutch to fix 
>> their
>> omissions. This may mean adding means of calling further auth related
>> functions through the req object if there is something missing now,
>> such as access to ap_note_basic_auth_failure().
> 
> FWIW, my concerns about something being a bit wrong with the code are a
> baseless in as much as ap_note_basic_auth_failure() only adds the header
> is AuthType is set to Basic. Thus it cant obliterate a Digest header.

That is incorrect. ap_note_basic_auth_failure() checks if the auth type 
is "Basic". If so it sets the headers, otherwise it calls 
ap_note_auth_failure(). ap_note_auth_failure() also checks the auth type 
and will either call ap_note_basic_auth_failure if the type is "Basic", 
ap_note_digest_auth_failure() if the type is "Digest" or else just log 
an error.

ap_note_digest_auth_failure will sets the headers appropriately for 
digest authentication.

This doesn't mean we are correct in calling ap_note_basic_auth_failure, 
but doing so will not cause any problems as long as the AuthType is set 
properly.

Jim
From grahamd at dscpl.com.au  Fri May  5 08:32:42 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Fri May  5 08:33:13 2006
Subject: [mod_python] PythonAuthzHandler not working
In-Reply-To: <445B435E.7010903@jgassociates.ca>
References: <1145850628.26998@dscpl.user.openhosting.com>
	<4AC63DFD-BB0C-45FA-9B5C-B4C3F4209038@dscpl.com.au>
	<445B435E.7010903@jgassociates.ca>
Message-ID: <9E56DF79-2C7E-4FBE-B73B-2D858CACBE6C@dscpl.com.au>


On 05/05/2006, at 10:21 PM, Jim Gallacher wrote:

> Graham Dumpleton wrote:
>> On 24/04/2006, at 1:50 PM, Graham Dumpleton wrote:
>>> Jim Gallacher wrote ..
>>>> Ultimately however it seems to me there is a bug in mod_python.c  
>>>> related
>>>> to the whole AuthAthoritative business. Consider the following code
>>>> pulled from the python_handler function. (mod_python.c line 1412
>>>> revision 396250):
>>>>
>>>>     if (strcmp(phase, "PythonAuthenHandler") == 0) {
>>>>           ... snip ...
>>>>
>>>>           if (result == HTTP_UNAUTHORIZED)
>>>>           {
>>>>                if   (! conf->authoritative)
>>>>                      result = DECLINED;
>>>>
>>>>
>>>> conf->authoritative is initialized to 1, but we don't have an  
>>>> Apache
>>>> directive to set the value. I wonder if the assumption was that  
>>>> this was
>>>> set by AuthAuthoritative, or if it there was an oversight in not  
>>>> adding
>>>> a new directive? Either way it's a bug. Mod_python should not  
>>>> concern
>>>> itself with AuthAuthoritative, as that is for use by mod_auth,  
>>>> so we
>>>> really need our on directive.
>>>>
>>>> As confirmation I modified python_handler to log conf- 
>>>> >authoritative and
>>>> indeed it's value is unaffected by the AuthAthoritative setting.  
>>>> In it's
>>>> current state, PythonAuthenHander will *always* be authoritative.
>>>>
>>>> Other mod_auth_* modules define their own  authoritative  
>>>> directives, for
>>>> example: AuthDBMAuthoritative, AuthLDAPAuthoritative,
>>>> AuthMySQLAuthoritative and Anonymous_Authoritative. Following  
>>>> the most
>>>> common pattern I would suggest we add AuthPythonAuthoritative.
>>>>
>>>> This issue may also be important to
>>>> http://issues.apache.org/jira/browse/MODPYTHON-129
>>>
>>> I've noted the PythonAuthenHandler code in python_handler many  
>>> times and
>>> although I need to go back and look at it again I have been thinking
>>> that that section of code may possibly be partly bogus and  
>>> shouldn't be
>>> in there. The warning message about req.user not being set is  
>>> possibly
>>> helpful, but why should mod_python be making a decision to change an
>>> unauthorized response back to a declined and why should it be  
>>> generating
>>> a WWW-Authenticate header with an assumption that Basic  
>>> authorisation
>>> is being used when it may well not be. What is going to happen if  
>>> I write
>>> an authenhandler for Digest authentication and it returns  
>>> unauthorised,
>>> mod_python will obliterate any WWW-Authenticate header I may have
>>> placed there specific to Digest authentication.
>>>
>>> Thus I don't necessarily think it is a case of amending it some  
>>> way, it
>>> may be a case of obliterating it and make people do the correct  
>>> thing
>>> in their handlers to begin with rather than providing a crutch to  
>>> fix their
>>> omissions. This may mean adding means of calling further auth  
>>> related
>>> functions through the req object if there is something missing now,
>>> such as access to ap_note_basic_auth_failure().
>> FWIW, my concerns about something being a bit wrong with the code  
>> are a
>> baseless in as much as ap_note_basic_auth_failure() only adds the  
>> header
>> is AuthType is set to Basic. Thus it cant obliterate a Digest header.
>
> That is incorrect. ap_note_basic_auth_failure() checks if the auth  
> type is "Basic". If so it sets the headers, otherwise it calls  
> ap_note_auth_failure(). ap_note_auth_failure() also checks the auth  
> type and will either call ap_note_basic_auth_failure if the type is  
> "Basic", ap_note_digest_auth_failure() if the type is "Digest" or  
> else just log an error.
>
> ap_note_digest_auth_failure will sets the headers appropriately for  
> digest authentication.
>
> This doesn't mean we are correct in calling  
> ap_note_basic_auth_failure, but doing so will not cause any  
> problems as long as the AuthType is set properly.

Me wrong. If this call is going to be made then, it may as well call  
ap_note_auth_failure()
then instead of ap_note_basic_auth_failure(). At least then it is  
obvious.

Anyway, makes sense now as I was seeing warning in error log of:

   need AuthType to note auth failure

which is generated by ap_note_auth_failure() when AuthType not set. I  
think I
somehow convinced myself at one point that I didn't see it and it  
must have been
from something else I was doing.

Too tired. Which makes me think I better not commit this code I was  
about to commit
for something else. :-)

BTW, what do you think of:

   http://issues.apache.org/jira/browse/MODPYTHON-169

Time for sleep me thinks. I'll see what you say tomorrow.

Graham


From jpg at jgassociates.ca  Fri May  5 09:23:39 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Fri May  5 09:23:18 2006
Subject: [mod_python] PythonAuthzHandler not working
In-Reply-To: <9E56DF79-2C7E-4FBE-B73B-2D858CACBE6C@dscpl.com.au>
References: <1145850628.26998@dscpl.user.openhosting.com>	<4AC63DFD-BB0C-45FA-9B5C-B4C3F4209038@dscpl.com.au>	<445B435E.7010903@jgassociates.ca>
	<9E56DF79-2C7E-4FBE-B73B-2D858CACBE6C@dscpl.com.au>
Message-ID: <445B51DB.6080903@jgassociates.ca>

Graham Dumpleton wrote:
> 
> On 05/05/2006, at 10:21 PM, Jim Gallacher wrote:
> 
>> Graham Dumpleton wrote:
>>> On 24/04/2006, at 1:50 PM, Graham Dumpleton wrote:
>>>> Jim Gallacher wrote ..
>>>>> Ultimately however it seems to me there is a bug in mod_python.c 
>>>>> related
>>>>> to the whole AuthAthoritative business. Consider the following code
>>>>> pulled from the python_handler function. (mod_python.c line 1412
>>>>> revision 396250):
>>>>>
>>>>>     if (strcmp(phase, "PythonAuthenHandler") == 0) {
>>>>>           ... snip ...
>>>>>
>>>>>           if (result == HTTP_UNAUTHORIZED)
>>>>>           {
>>>>>                if   (! conf->authoritative)
>>>>>                      result = DECLINED;
>>>>>
>>>>>
>>>>> conf->authoritative is initialized to 1, but we don't have an Apache
>>>>> directive to set the value. I wonder if the assumption was that 
>>>>> this was
>>>>> set by AuthAuthoritative, or if it there was an oversight in not 
>>>>> adding
>>>>> a new directive? Either way it's a bug. Mod_python should not concern
>>>>> itself with AuthAuthoritative, as that is for use by mod_auth, so we
>>>>> really need our on directive.
>>>>>
>>>>> As confirmation I modified python_handler to log 
>>>>> conf->authoritative and
>>>>> indeed it's value is unaffected by the AuthAthoritative setting. In 
>>>>> it's
>>>>> current state, PythonAuthenHander will *always* be authoritative.
>>>>>
>>>>> Other mod_auth_* modules define their own  authoritative 
>>>>> directives, for
>>>>> example: AuthDBMAuthoritative, AuthLDAPAuthoritative,
>>>>> AuthMySQLAuthoritative and Anonymous_Authoritative. Following the most
>>>>> common pattern I would suggest we add AuthPythonAuthoritative.
>>>>>
>>>>> This issue may also be important to
>>>>> http://issues.apache.org/jira/browse/MODPYTHON-129
>>>>
>>>> I've noted the PythonAuthenHandler code in python_handler many times 
>>>> and
>>>> although I need to go back and look at it again I have been thinking
>>>> that that section of code may possibly be partly bogus and shouldn't be
>>>> in there. The warning message about req.user not being set is possibly
>>>> helpful, but why should mod_python be making a decision to change an
>>>> unauthorized response back to a declined and why should it be 
>>>> generating
>>>> a WWW-Authenticate header with an assumption that Basic authorisation
>>>> is being used when it may well not be. What is going to happen if I 
>>>> write
>>>> an authenhandler for Digest authentication and it returns unauthorised,
>>>> mod_python will obliterate any WWW-Authenticate header I may have
>>>> placed there specific to Digest authentication.
>>>>
>>>> Thus I don't necessarily think it is a case of amending it some way, it
>>>> may be a case of obliterating it and make people do the correct thing
>>>> in their handlers to begin with rather than providing a crutch to 
>>>> fix their
>>>> omissions. This may mean adding means of calling further auth related
>>>> functions through the req object if there is something missing now,
>>>> such as access to ap_note_basic_auth_failure().
>>> FWIW, my concerns about something being a bit wrong with the code are a
>>> baseless in as much as ap_note_basic_auth_failure() only adds the header
>>> is AuthType is set to Basic. Thus it cant obliterate a Digest header.
>>
>> That is incorrect. ap_note_basic_auth_failure() checks if the auth 
>> type is "Basic". If so it sets the headers, otherwise it calls 
>> ap_note_auth_failure(). ap_note_auth_failure() also checks the auth 
>> type and will either call ap_note_basic_auth_failure if the type is 
>> "Basic", ap_note_digest_auth_failure() if the type is "Digest" or else 
>> just log an error.
>>
>> ap_note_digest_auth_failure will sets the headers appropriately for 
>> digest authentication.
>>
>> This doesn't mean we are correct in calling 
>> ap_note_basic_auth_failure, but doing so will not cause any problems 
>> as long as the AuthType is set properly.
> 
> Me wrong. If this call is going to be made then, it may as well call 
> ap_note_auth_failure()
> then instead of ap_note_basic_auth_failure(). At least then it is obvious.
> 
> Anyway, makes sense now as I was seeing warning in error log of:
> 
>   need AuthType to note auth failure
> 
> which is generated by ap_note_auth_failure() when AuthType not set. I 
> think I
> somehow convinced myself at one point that I didn't see it and it must 
> have been
> from something else I was doing.
> 
> Too tired. Which makes me think I better not commit this code I was 
> about to commit
> for something else. :-)

That is always prudent. There is nothing quite like committing some code 
late a night and realizing you may have done something that would break 
the build. The question then becomes fix or sleep...

> BTW, what do you think of:
> 
>   http://issues.apache.org/jira/browse/MODPYTHON-169

The short answer is I like it. I've been reading the Apache2.2 
auth/authz stuff in modules/aaa with my morning coffee. :) I certainly 
think we need a general review how we handle this stuff so that 
mod_python can play nice with Apache 2.2.

Jim

From mcassiano at manord.com  Fri May  5 11:29:37 2006
From: mcassiano at manord.com (Cassiano, Marco)
Date: Fri May  5 11:29:48 2006
Subject: [mod_python] mod_python.servlet: DBNoMemoryError
Message-ID: <BC53C974C3B9E542BC0A9BD4C5B1168A01308AFF@NEWMAIL.manord.com>

Hi All,
 
I've just uninstalled the Redhat 3 httpd RPM and compiled httpd (2.0.55) from source because I needed the updated APXS.
 
Now I sometimes get this error in functions that worked ok before :
 
 
 mod_python.servlet: DBNoMemoryError: (12, 'Cannot allocate memory -- malloc: Cannot allocate memory: 16384')
 
 
anyone could give me on advice on it ?
Thanks in advance
 
 
 
 

Marco Cassiano 
  
Manifatture del Nord srl unipersonale
Gruppo MaxMara 

viale Regina Elena 13-15 
42100 Reggio Emilia RE 
ITALY 

Sede operativa:
via Mazzacurati 6
42100 Reggio Emilia RE
ITALY 

Tel. +39 0522 358215 
Fax +39 0522 268715 
email : mcassiano@manord.com 
www.pennyblack.com <file:///C:/Documents%20and%20Settings/mcassiano/Dati%20applicazioni/Microsoft/Firme%20elettroniche/www.pennyblack.com>  

 

The contents of the present communication is strictly confidential and reserved solely to the referred addressees. In the event was received by person different from the addressee, it is forbidden the diffusion, distribution and copy. In the event you have received it mistakenly we ask you to inform us and to destroy and/or to delete it by your computer, without using the data herein contained.

 

The present message (eventual annexes inclusive) shall not be considered any contractual proposal and/or acceptance of offer coming from the addressee, nor waiver neither recognizance of rights, debts and/or credits, and it shall not be binding, when it is not executed a subsequent agreement by person who could lawfully represent us. No pre-contractual liability shall derive to us, when the present communication is not followed by any binding agreement between the parties.

---------------------------------------------------------------------------------------------

 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060505/f8518cbf/attachment-0001.html
From amarrero at mitre.org  Fri May  5 19:32:51 2006
From: amarrero at mitre.org (Alexis Marrero)
Date: Fri May  5 19:36:25 2006
Subject: [mod_python] MemorySession and httpd processes
Message-ID: <4F65C701-8825-445F-9867-91B176B820D7@mitre.org>

Is there anyway that I can use mod_python.Session.MemorySession  
through the different httpd processes? I guess that the answer is no,  
but I wanted to check.

I have a process that post data multiple times, one session.

The problems that I'm having is that httpd instantiate multiple  
servers by the ServerLimit in hte worker.c module.  Every time apache  
switches process for handling one of the requests for the requests  
mod_python believe that the session is not longer valid and creates a  
new one.

I had to change my httpd.conf to look like this:

###### httpd conf

# worker MPM
# StartServers: initial number of server processes to start
# MaxClients: maximum number of simultaneous client connections
# MinSpareThreads: minimum number of worker threads which are kept spare
# MaxSpareThreads: maximum number of worker threads which are kept spare
# ThreadsPerChild: constant number of worker threads in each server  
process
# MaxRequestsPerChild: maximum number of requests a server process  
serves
<IfModule worker.c>
ServerLimit          1
StartServers         1
MaxClients          25
MinSpareThreads     25
MaxSpareThreads     75
ThreadsPerChild     25
MaxRequestsPerChild  0
</IfModule>

#######

In order to force apache to use the same process so the session can  
be share my multiple threads under the same process.

But as you can see this limits my number of Process to 1!

Is there any other more efficient way.

Note that the one of the objects that I need to save in the session  
CANNOT be pickled.

Thanks for any pointers,
/amn
From jpg at jgassociates.ca  Fri May  5 20:41:51 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Fri May  5 20:38:33 2006
Subject: [mod_python] MemorySession and httpd processes
In-Reply-To: <4F65C701-8825-445F-9867-91B176B820D7@mitre.org>
References: <4F65C701-8825-445F-9867-91B176B820D7@mitre.org>
Message-ID: <445BF0CF.6020108@jgassociates.ca>

Alexis Marrero wrote:
> Is there anyway that I can use mod_python.Session.MemorySession through 
> the different httpd processes? I guess that the answer is no, but I 
> wanted to check.

You are correct. The answer for anything put mpm-threaded is no.

> I have a process that post data multiple times, one session.
> 
> The problems that I'm having is that httpd instantiate multiple servers 
> by the ServerLimit in hte worker.c module.  Every time apache switches 
> process for handling one of the requests for the requests mod_python 
> believe that the session is not longer valid and creates a new one.
> 
> I had to change my httpd.conf to look like this:
> 
> ###### httpd conf
> 
> # worker MPM
> # StartServers: initial number of server processes to start
> # MaxClients: maximum number of simultaneous client connections
> # MinSpareThreads: minimum number of worker threads which are kept spare
> # MaxSpareThreads: maximum number of worker threads which are kept spare
> # ThreadsPerChild: constant number of worker threads in each server process
> # MaxRequestsPerChild: maximum number of requests a server process serves
> <IfModule worker.c>
> ServerLimit          1
> StartServers         1
> MaxClients          25
> MinSpareThreads     25
> MaxSpareThreads     75
> ThreadsPerChild     25
> MaxRequestsPerChild  0
> </IfModule>
> 
> #######
> 
> In order to force apache to use the same process so the session can be 
> share my multiple threads under the same process.
> 
> But as you can see this limits my number of Process to 1!
 >
> Is there any other more efficient way.
>
> Note that the one of the objects that I need to save in the session 
> CANNOT be pickled.

I think you may be stuck. The only thing I can suggest is to refactor 
your code such that you are able to pickle your data. I realize this is 
not particularly satisfactory.

Jim
From yjfuk at 126.com  Sat May  6 12:35:04 2006
From: yjfuk at 126.com (yjfuk)
Date: Sat May  6 12:35:34 2006
Subject: [mod_python] MySQLdb problem
Message-ID: <445CD038.00012E.31097@m69.126.com>

I am use mod_python3.2.8,MySQL-python-1.2.1_p2,mysql5.0.20,centOS
when I run the script below(I save this script also in utf-8):
#coding: utf-8
from MySQLdb import connect
connection=connect(user='root',passwd='',host='localhost',db='test')
cursor = connection.cursor()
cursor.execute("INSERT INTO `fee` ( `affair` ) VALUES ('')")
#'' is a chinese word means test
 
it raise error:
Traceback (most recent call last):
  File "test.py", line 8, in ?
    cursor.execute("INSERT INTO `fee` ( `affair` ) VALUES ('')")
  File "/opt/python/lib/python2.4/site-packages/MySQLdb/cursors.py", line 146, in execute
    query = query.encode(charset)
UnicodeDecodeError: 'ascii' codec can't decode byte 0xe6 in position 40: ordinal not in range(128)
 
 
 
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060507/fffa1bf4/attachment.html
From listspam at flowtheory.net  Sat May  6 16:17:27 2006
From: listspam at flowtheory.net (Joshua Ginsberg)
Date: Sat May  6 16:18:17 2006
Subject: [mod_python] MySQLdb problem
In-Reply-To: <445CD038.00012E.31097@m69.126.com>
References: <445CD038.00012E.31097@m69.126.com>
Message-ID: <f6316a9ebc5ce5f3be16670c1eb325e3@flowtheory.net>

This is an issue related to MySQLdb, not mod_python.

-jag

On May 6, 2006, at 12:35 PM, yjfuk wrote:

> I am use mod_python3.2.8,MySQL-python-1.2.1_p2,mysql5.0.20,centOS
> when I run the script below(I save this script also in utf-8):
> #coding: utf-8
> from MySQLdb import connect
> connection=connect(user='root',passwd='',host='localhost',db='test')
> cursor = connection.cursor()
> cursor.execute("INSERT INTO `fee` ( `affair` ) VALUES ('~{2bJT~}')")
> #'~{2bJT~}' is a chinese word means test
>  
> it raise error:
> Traceback (most recent call last):
>   File "test.py", line 8, in ?
>     cursor.execute("INSERT INTO `fee` ( `affair` ) VALUES ('~{2bJT~}')")
>   File "/opt/python/lib/python2.4/site-packages/MySQLdb/cursors.py", 
> line 146, in execute
>     query = query.encode(charset)
> UnicodeDecodeError: 'ascii' codec can't decode byte 0xe6 in position 
> 40: ordinal not in range(128)
>  
>  
>  
>  
>
>
>
>
>
>
>
> ~{Dc~} ~{2;~} ~{Ok~} ~{JT~} ~{JT~} ~{=q~} ~{OD~} ~{Wn~} ~{!0?a!1~} ~{5D~} ~{SJ~} ~{Od~} ~{Bp~} ~{#?~}
> ~{TL~} ~{:-~} ~{VP~} ~{;*~} ~{4+~} ~{M3~} ~{ND~} ~{;/~} ~{SZ~} ~{J@~} ~{=g~} ~{R;~} ~{Aw~} ~{?F~} ~{<<~} ~{V.~} ~{VP#,44~} ~{PB~} Ajax ~{<<~} ~{Ju#,~}126 ~{!0~}D ~{<F~} ~{;.!1;p~} ~{HH~} ~{Le~} ~{Qi~} ~{VP~} ~{#!~} 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: text/enriched
Size: 6098 bytes
Desc: not available
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060506/b4360bae/attachment.bin
From grahamd at dscpl.com.au  Sat May  6 20:02:07 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sat May  6 20:03:12 2006
Subject: [mod_python] mod_python.servlet: DBNoMemoryError
In-Reply-To: <BC53C974C3B9E542BC0A9BD4C5B1168A01308AFF@NEWMAIL.manord.com>
References: <BC53C974C3B9E542BC0A9BD4C5B1168A01308AFF@NEWMAIL.manord.com>
Message-ID: <3E519C36-D90B-4A12-944A-783BF9CDB623@dscpl.com.au>


On 06/05/2006, at 1:29 AM, Cassiano, Marco wrote:

> Hi All,
>
> I've just uninstalled the Redhat 3 httpd RPM and compiled httpd  
> (2.0.55) from source because I needed the updated APXS.
>
> Now I sometimes get this error in functions that worked ok before :
>
>
>  mod_python.servlet: DBNoMemoryError: (12, 'Cannot allocate memory  
> -- malloc: Cannot allocate memory: 16384')
>
>
> anyone could give me on advice on it ?

If mod_python.servlet is mpservlets, I don't recollect it having any  
sort of database
component, so thus suspect that you must be using MySQLdb or some other
database module. If this is the case, you may have a mismatch between  
what
MySQL shared libraries are being found and what the Apache/Python  
modules
needing them were compiled against. Such mismatches are known to cause
strange behaviour. See:

   http://www.modpython.org/FAQ/faqw.py?req=show&file=faq02.013.htp

for some related information about what problems can occur.

Graham
From grahamd at dscpl.com.au  Sat May  6 20:04:24 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sat May  6 20:04:51 2006
Subject: [mod_python] MemorySession and httpd processes
In-Reply-To: <4F65C701-8825-445F-9867-91B176B820D7@mitre.org>
References: <4F65C701-8825-445F-9867-91B176B820D7@mitre.org>
Message-ID: <E04EA5D8-C7E7-4A44-91BC-929E487135C0@dscpl.com.au>


On 06/05/2006, at 9:32 AM, Alexis Marrero wrote:

> Is there anyway that I can use mod_python.Session.MemorySession  
> through the different httpd processes? I guess that the answer is  
> no, but I wanted to check.
>
> I have a process that post data multiple times, one session.
>
> The problems that I'm having is that httpd instantiate multiple  
> servers by the ServerLimit in hte worker.c module.  Every time  
> apache switches process for handling one of the requests for the  
> requests mod_python believe that the session is not longer valid  
> and creates a new one.
>
> I had to change my httpd.conf to look like this:
>
> ###### httpd conf
>
> # worker MPM
> # StartServers: initial number of server processes to start
> # MaxClients: maximum number of simultaneous client connections
> # MinSpareThreads: minimum number of worker threads which are kept  
> spare
> # MaxSpareThreads: maximum number of worker threads which are kept  
> spare
> # ThreadsPerChild: constant number of worker threads in each server  
> process
> # MaxRequestsPerChild: maximum number of requests a server process  
> serves
> <IfModule worker.c>
> ServerLimit          1
> StartServers         1
> MaxClients          25
> MinSpareThreads     25
> MaxSpareThreads     75
> ThreadsPerChild     25
> MaxRequestsPerChild  0
> </IfModule>
>
> #######
>
> In order to force apache to use the same process so the session can  
> be share my multiple threads under the same process.
>
> But as you can see this limits my number of Process to 1!
>
> Is there any other more efficient way.
>
> Note that the one of the objects that I need to save in the session  
> CANNOT be pickled.

What is the object you are trying to pickle and what error is it  
giving back indicating
that it can't be pickled? We may be able to suggest a better way of  
managing you
data to avoid the restriction.

FWIW, you might also ensure you read:

   http://www.dscpl.com.au/articles/modpython-005.html

This talks about some of the pickling issues with session objects.

Graham
From geoff at teammsa.com  Sun May  7 03:24:51 2006
From: geoff at teammsa.com (Geoff Skerrett)
Date: Sun May  7 03:28:37 2006
Subject: [mod_python] Try # 2: Mod_python.publisher behavior - sending .py
 file to browser - Still !
In-Reply-To: <200605041600.k44G0BSQ007014@modpython.org>
Message-ID: <000601c671a7$5486df00$6804a8c0@MSASALESGES2>


Gentlemen thanks for you help, and I hope you will be patient with me.  I
have solved the problem and while I know why it works, I am not sure why my
solution was required as the documentation and your responses don't seem to
suggest it as being needed.

Explaination:
I modified the settings in my http.conf file for the directory as suggested
and of course restarted the server.  For this directory the setting are now
as follows;

<Directory "C:\Program Files\Apache Group\Apache2\htdocs\app/"> 
    SetHandler mod_python
    PythonHandler mod_python.publisher
    PythonDebug On 
</Directory> 

I created a very simple program index.py program to help me understand the
behavior.  
It is as follows;

### Begin index.py

def index(req):
	req.write("I am in index()")
	
def bar(req):
	req.write("I am in bar()")

### End index.py

In the browser if I type the following Http://localhost/app/index
The browser displays: "I am in index()"

In the browser if I type the following Http://localhost/app/index/bar
The browser displays: "I am in bar()"

In the browser if I type the following Http://localhost/app/bar
The browser displays: "I am in bar()"

However ...
In the browser if I type the following Http://localhost/app/
The brower displays the file download page and says it is trying to open a
"httpd/unix-directory" file.  If I save this file and view it, the contents
are:
"I am in index()"

So ... mod_python.publisher appears to be working correctly for all cases,
except in the case where I think that it should automatically default to
finding function "index()" within the module "index.py".  

If I modify my example program as follows;

### Begin index.py

def index(req):
	req.content_type = "text/plain"
	req.write("I am in index()")
	
def bar(req):
	req.write("I am in bar()")

### End index.py

Then the URI Http://localhost/app/ work file and displays "I am in index()
in the browser.

So after that long winded explanation ... Is there an addition/extra setting
in the http.conf file that I should be making to make the URI resolution
work properly without having to set the content_type ?  As I mentioned at
the top, the docs don't seem to suggest the *content_type* setting as being
a requirement.

Glad I got I working though ... Now off to some more serious development
issues !

Geoff.

From grahamd at dscpl.com.au  Sun May  7 04:09:43 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sun May  7 04:11:11 2006
Subject: [mod_python] Try # 2: Mod_python.publisher behavior - sending .py
	file to browser - Still !
In-Reply-To: <000601c671a7$5486df00$6804a8c0@MSASALESGES2>
References: <000601c671a7$5486df00$6804a8c0@MSASALESGES2>
Message-ID: <C34E23FF-261D-4730-B1F6-FE6B88BC454C@dscpl.com.au>

As a workaround for now, use the following for .htaccess file:

   SetHandler mod_python
   PythonHeaderParserHandler index::_fixup_directory
   PythonHandler mod_python.publisher
   PythonDebug On

and in index.py file put:

   from mod_python import apache
   import os, posixpath

   def _fixup_directory(req):
       if os.path.isdir(req.filename):
           if req.filename[-1] == '/':
               path = posixpath.join(req.uri, 'index.py')
               req.internal_redirect(path)
               return apache.DONE
       return apache.OK

   def index(req):
           req.write("I am in index()")

   def bar(req):
           req.write("I am in bar()")

Right now I'm not quite sure why it is mucking up but I'll look into it
further.

Graham

On 07/05/2006, at 5:24 PM, Geoff Skerrett wrote:

>
> Gentlemen thanks for you help, and I hope you will be patient with  
> me.  I
> have solved the problem and while I know why it works, I am not  
> sure why my
> solution was required as the documentation and your responses don't  
> seem to
> suggest it as being needed.
>
> Explaination:
> I modified the settings in my http.conf file for the directory as  
> suggested
> and of course restarted the server.  For this directory the setting  
> are now
> as follows;
>
> <Directory "C:\Program Files\Apache Group\Apache2\htdocs\app/">
>     SetHandler mod_python
>     PythonHandler mod_python.publisher
>     PythonDebug On
> </Directory>
>
> I created a very simple program index.py program to help me  
> understand the
> behavior.
> It is as follows;
>
> ### Begin index.py
>
> def index(req):
> 	req.write("I am in index()")
> 	
> def bar(req):
> 	req.write("I am in bar()")
>
> ### End index.py
>
> In the browser if I type the following Http://localhost/app/index
> The browser displays: "I am in index()"
>
> In the browser if I type the following Http://localhost/app/index/bar
> The browser displays: "I am in bar()"
>
> In the browser if I type the following Http://localhost/app/bar
> The browser displays: "I am in bar()"
>
> However ...
> In the browser if I type the following Http://localhost/app/
> The brower displays the file download page and says it is trying to  
> open a
> "httpd/unix-directory" file.  If I save this file and view it, the  
> contents
> are:
> "I am in index()"
>
> So ... mod_python.publisher appears to be working correctly for all  
> cases,
> except in the case where I think that it should automatically  
> default to
> finding function "index()" within the module "index.py".
>
> If I modify my example program as follows;
>
> ### Begin index.py
>
> def index(req):
> 	req.content_type = "text/plain"
> 	req.write("I am in index()")
> 	
> def bar(req):
> 	req.write("I am in bar()")
>
> ### End index.py
>
> Then the URI Http://localhost/app/ work file and displays "I am in  
> index()
> in the browser.
>
> So after that long winded explanation ... Is there an addition/ 
> extra setting
> in the http.conf file that I should be making to make the URI  
> resolution
> work properly without having to set the content_type ?  As I  
> mentioned at
> the top, the docs don't seem to suggest the *content_type* setting  
> as being
> a requirement.
>
> Glad I got I working though ... Now off to some more serious  
> development
> issues !
>
> Geoff.
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From grahamd at dscpl.com.au  Sun May  7 04:16:52 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sun May  7 04:17:28 2006
Subject: [mod_python] Try # 2: Mod_python.publisher behavior - sending .py
	file to browser - Still !
In-Reply-To: <000601c671a7$5486df00$6804a8c0@MSASALESGES2>
References: <000601c671a7$5486df00$6804a8c0@MSASALESGES2>
Message-ID: <089F92AB-C021-439B-BFCF-F9201FF7FF29@dscpl.com.au>


On 07/05/2006, at 5:24 PM, Geoff Skerrett wrote:

> I created a very simple program index.py program to help me  
> understand the
> behavior.
> It is as follows;
>
> ### Begin index.py
>
> def index(req):
> 	req.write("I am in index()")
> 	
> def bar(req):
> 	req.write("I am in bar()")

Whoops. Quite obvious really. You must use:

   def index(req):
	return "I am in index()"
	
   def bar(req):
	return "I am in bar()"

When you you use req.write(), the headers are automatically flushed,  
so the
setting of req.content_type by mod_publisher after the published  
function
returns has no affect.

In other words, if you are going to use req.write(), you must set  
req.content_type
yourself.

Graham

From jpg at jgassociates.ca  Sun May  7 10:39:25 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Sun May  7 10:39:28 2006
Subject: [mod_python] Try # 2: Mod_python.publisher behavior - sending
	.py	file to browser - Still !
In-Reply-To: <089F92AB-C021-439B-BFCF-F9201FF7FF29@dscpl.com.au>
References: <000601c671a7$5486df00$6804a8c0@MSASALESGES2>
	<089F92AB-C021-439B-BFCF-F9201FF7FF29@dscpl.com.au>
Message-ID: <445E069D.8050103@jgassociates.ca>

Graham Dumpleton wrote:
> 
> On 07/05/2006, at 5:24 PM, Geoff Skerrett wrote:
> 
>> I created a very simple program index.py program to help me understand 
>> the
>> behavior.
>> It is as follows;
>>
>> ### Begin index.py
>>
>> def index(req):
>>     req.write("I am in index()")
>>     
>> def bar(req):
>>     req.write("I am in bar()")
> 
> Whoops. Quite obvious really. You must use:
> 
>   def index(req):
>     return "I am in index()"
>     
>   def bar(req):
>     return "I am in bar()"
> 
> When you you use req.write(), the headers are automatically flushed, so the
> setting of req.content_type by mod_publisher after the published function
> returns has no affect.
> 
> In other words, if you are going to use req.write(), you must set 
> req.content_type
> yourself.

Geoff,

Also, when you are using req.write() directly and not setting the
content_type, you are depending on the browser making a best guess. You
were getting different results because your browser was not consistent
its guess. The behaviour will differ on various browsers.

Jim
From nogradi at gmail.com  Sun May  7 11:33:22 2006
From: nogradi at gmail.com (Daniel Nogradi)
Date: Sun May  7 11:33:25 2006
Subject: [mod_python] apache pysqlite segfault
Message-ID: <5f56302b0605070833w6724a60dm2d2e7c752b224fb3@mail.gmail.com>

(crossposted to pysqlite and mod_python)

Some time ago I had problems with running pysqlite from mod_python and
every version of pysqlite beyond 2.0.6 was causing apache to segfault. Now I
upgraded several parts of my system including pysqlite but had no luck,
the following combination

sqlite 3.3.5    (compiled with threadsafe enabled)
pysqlite 2.2.2
apache 2.0.53
mod_python 3.2.8
python 2.4

still makes apache segfault. The last couple of lines from running gdb
on the core file is:

Loaded symbols for /usr/lib/python2.4/lib-dynload/_weakref.so
Reading symbols from
/usr/lib/python2.4/site-packages/pysqlite2/_sqlite.so...done.
Loaded symbols for /usr/lib/python2.4/site-packages/pysqlite2/_sqlite.so
Reading symbols from /usr/lib/libsqlite3.so.0...done.
Loaded symbols for /usr/lib/libsqlite3.so.0
#0  flush_statement_cache (self=0xb7dde200) at src/connection.c:156
156         self->statement_cache->decref_factory = 0;

and then a backtrace gives

(gdb) bt
#0  flush_statement_cache (self=0xb7dde200) at src/connection.c:156
#1  0x009daa39 in connection_close (self=0xb7dde200, args=0x0) at
src/connection.c:237
#2  0x05ba3dce in PyEval_EvalFrame () from /etc/httpd/modules/mod_python.so
#3  0x05ba44d6 in PyEval_EvalCodeEx () from /etc/httpd/modules/mod_python.so
#4  0x05bf07a2 in function_call () from /etc/httpd/modules/mod_python.so
#5  0x05b500c8 in PyObject_Call () from /etc/httpd/modules/mod_python.so
#6  0x05b9ed79 in PyEval_EvalFrame () from /etc/httpd/modules/mod_python.so
#7  0x05ba44d6 in PyEval_EvalCodeEx () from /etc/httpd/modules/mod_python.so
#8  0x05ba229f in PyEval_EvalFrame () from /etc/httpd/modules/mod_python.so
#9  0x05ba3d50 in PyEval_EvalFrame () from /etc/httpd/modules/mod_python.so
#10 0x05ba3d50 in PyEval_EvalFrame () from /etc/httpd/modules/mod_python.so
#11 0x05ba44d6 in PyEval_EvalCodeEx () from /etc/httpd/modules/mod_python.so
#12 0x05bf07a2 in function_call () from /etc/httpd/modules/mod_python.so
#13 0x05b500c8 in PyObject_Call () from /etc/httpd/modules/mod_python.so
#14 0x05b586c5 in instancemethod_call () from /etc/httpd/modules/mod_python.so
#15 0x05b50308 in PyObject_CallMethod () from /etc/httpd/modules/mod_python.so
#16 0x05b4adb5 in python_handler (req=0x8925510, phase=0x5bf95f3
"PythonHandler") at mod_python.c:1114
#17 0x00509a27 in ap_run_handler () from /usr/sbin/httpd
#18 0x08715890 in ?? ()
#19 0x005099fe in ap_run_handler () from /usr/sbin/httpd
#20 0x08925510 in ?? ()
#21 0x08925510 in ?? ()
#22 0xbf926ff8 in ?? ()
#23 0x00509e93 in ap_invoke_handler () from /usr/sbin/httpd
Previous frame inner to this frame (corrupt stack?)
(gdb)

So pysqlite version 2.0.5 is fine, but no version beyond that. While
searching for a solution I came across many times the suggestion (also
raised by Jim as far as I remember) that different apache modules
using different versions of the same library might cause this
behaviour but I don't have php-sqlite or anything else resembling (to
me at least :)) such a situation. Which modules would be suspicious?

What else could I check or what details should I send that would be
useful to debug this?

From geoff at teammsa.com  Sun May  7 13:51:45 2006
From: geoff at teammsa.com (Geoff Skerrett)
Date: Sun May  7 13:55:28 2006
Subject: [mod_python] Try # 2: Mod_python.publisher behavior - sending .py
	file to browser - Still !
In-Reply-To: <445E069D.8050103@jgassociates.ca>
Message-ID: <001301c671fe$e84e1120$6804a8c0@MSASALESGES2>

Graham Dumpleton wrote:
> 
> On 07/05/2006, at 5:24 PM, Geoff Skerrett wrote:
> 
>> I created a very simple program index.py program to help me 
>> understand the behavior.
>> It is as follows;
>>
>> ### Begin index.py
>>
>> def index(req):
>>     req.write("I am in index()")
>>     
>> def bar(req):
>>     req.write("I am in bar()")
> 
> Whoops. Quite obvious really. You must use:
> 
>   def index(req):
>     return "I am in index()"
>     
>   def bar(req):
>     return "I am in bar()"
> 
> When you you use req.write(), the headers are automatically flushed, 
> so the setting of req.content_type by mod_publisher after the 
> published function returns has no affect.
> 
> In other words, if you are going to use req.write(), you must set 
> req.content_type yourself.

Geoff,

Also, when you are using req.write() directly and not setting the
content_type, you are depending on the browser making a best guess. You were
getting different results because your browser was not consistent its guess.
The behaviour will differ on various browsers.

Jim

>From Geoff Skerrett;
Thank you Jim and Graham for you help on this.  It was of course the
solution and I am now in the right track.

Geoff.



From grahamd at dscpl.com.au  Sun May  7 16:38:09 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sun May  7 16:38:24 2006
Subject: [mod_python] Try # 2: Mod_python.publisher behavior - sending
	.py	file to browser - Still !
In-Reply-To: <445E069D.8050103@jgassociates.ca>
References: <000601c671a7$5486df00$6804a8c0@MSASALESGES2>
	<089F92AB-C021-439B-BFCF-F9201FF7FF29@dscpl.com.au>
	<445E069D.8050103@jgassociates.ca>
Message-ID: <F1418961-01A9-46D5-BA60-5683163AA880@dscpl.com.au>


On 08/05/2006, at 12:39 AM, Jim Gallacher wrote:

> Graham Dumpleton wrote:
>> On 07/05/2006, at 5:24 PM, Geoff Skerrett wrote:
>>> I created a very simple program index.py program to help me  
>>> understand the
>>> behavior.
>>> It is as follows;
>>>
>>> ### Begin index.py
>>>
>>> def index(req):
>>>     req.write("I am in index()")
>>>     def bar(req):
>>>     req.write("I am in bar()")
>> Whoops. Quite obvious really. You must use:
>>   def index(req):
>>     return "I am in index()"
>>       def bar(req):
>>     return "I am in bar()"
>> When you you use req.write(), the headers are automatically  
>> flushed, so the
>> setting of req.content_type by mod_publisher after the published  
>> function
>> returns has no affect.
>> In other words, if you are going to use req.write(), you must set  
>> req.content_type
>> yourself.
>
> Geoff,
>
> Also, when you are using req.write() directly and not setting the
> content_type, you are depending on the browser making a best guess.  
> You
> were getting different results because your browser was not consistent
> its guess. The behaviour will differ on various browsers.

FWIW.

In the case of the directory access, the browser could possibly not have
got an opportunity to make a guess, as Apache would have sent back a
content type of 'httpd/unix-directory'.

If a default content type had been set in Apache configuration, eg,  
'text/plain',
the other accesses would have returned that automatically.

Graham
From aditya.vrr at gmail.com  Mon May  8 01:42:19 2006
From: aditya.vrr at gmail.com (gOLeM)
Date: Mon May  8 01:42:26 2006
Subject: [mod_python] python handler
Message-ID: <ec2d07cf0605072242s3335a5dve25897449a687ddc@mail.gmail.com>

from mod_python import apache

def handler(req, arg = "1"):
    req.content_type = 'text/html'
    myfile = open("/var/www/html/ajax/index.html", "r");
    for line in myfile.readlines() :
        req.write(line)
    return apache.OK

this is myhandler.py


<Directory "/var/www/html/xxxxxxxxx">
        AddHandler mod_python .py
        PythonHandler myhandler
        PythonDebug On
</Directory>

when i try http://localhost/myhandler.py?arg=2
it is not taking the value of arg as 2. Is it the expected behaviour
or am i doing something wrong?

--
The Purpose of Life is a life of purpose -- Leider, Richard
Quitters never win and Winners never quit   -- Napolean Hill

From grahamd at dscpl.com.au  Mon May  8 02:01:39 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon May  8 02:01:42 2006
Subject: [mod_python] python handler
Message-ID: <1147068099.30856@dscpl.user.openhosting.com>

gOLeM wrote ..
> from mod_python import apache
> 
> def handler(req, arg = "1"):
>     req.content_type = 'text/html'
>     myfile = open("/var/www/html/ajax/index.html", "r");
>     for line in myfile.readlines() :
>         req.write(line)
>     return apache.OK
> 
> this is myhandler.py
> 
> 
> <Directory "/var/www/html/xxxxxxxxx">
>         AddHandler mod_python .py
>         PythonHandler myhandler
>         PythonDebug On
> </Directory>
> 
> when i try http://localhost/myhandler.py?arg=2
> it is not taking the value of arg as 2. Is it the expected behaviour
> or am i doing something wrong?

You are mixing mod_python.publisher concepts with basic mod_python
handler concepts. If using a basic mod_python handler you will need
to use util.FieldStorage explicitly to decode form parameters.

Thus something (untested and I haven't used it directly for a while) like:

  from mod_python import util

  def handler(req):
      form = util.FieldStorage(req)
      arg = form.getfirst("arg", "1")
      req.content_type = 'text/html'
      myfile = open("/var/www/html/ajax/index.html", "r");
      for line in myfile.readlines() :
          req.write(line)
      return apache.OK

See util.FieldStorage documentation.

  http://www.modpython.org/live/current/doc-html/pyapi-util-fstor.html
  http://www.modpython.org/live/current/doc-html/pyapi-util-fstor-fld.html

Anyway, even if wrong, should point you in right direction. :-)

Graham
From dpopowich at comcast.net  Mon May  8 07:32:47 2006
From: dpopowich at comcast.net (Daniel J. Popowich)
Date: Mon May  8 07:32:25 2006
Subject: [mod_python] mod_python.servlet: DBNoMemoryError
In-Reply-To: <3E519C36-D90B-4A12-944A-783BF9CDB623@dscpl.com.au>
References: <BC53C974C3B9E542BC0A9BD4C5B1168A01308AFF@NEWMAIL.manord.com>
	<3E519C36-D90B-4A12-944A-783BF9CDB623@dscpl.com.au>
Message-ID: <17503.11359.61053.484435@io.astro.umass.edu>


Graham Dumpleton writes:
> 
> On 06/05/2006, at 1:29 AM, Cassiano, Marco wrote:
> 
> > Hi All,
> >
> > I've just uninstalled the Redhat 3 httpd RPM and compiled httpd  
> > (2.0.55) from source because I needed the updated APXS.
> >
> > Now I sometimes get this error in functions that worked ok before :
> >
> >
> >  mod_python.servlet: DBNoMemoryError: (12, 'Cannot allocate memory  
> > -- malloc: Cannot allocate memory: 16384')
> >
> >
> > anyone could give me on advice on it ?
> 
> If mod_python.servlet is mpservlets, I don't recollect it having any
> sort of database component...

It doesn't.  This error comes from bsddb.  I have definitely come
across library mismatch trouble between python's and apache's bsddb.
You have to make sure you build apache against the same bsddb library
that your python was built against.  You can use the ldd command to
see which libraries your binaries are linked against...

  ldd /usr/bin/python
  ldd /usr/sbin/httpd

...substituting the appropriate paths on your system, of course.

Cheers,

Daniel Popowich
---------------
http://home.comcast.net/~d.popowich/mpservlets/
From stefano.cirilli1 at virgilio.it  Mon May  8 08:12:33 2006
From: stefano.cirilli1 at virgilio.it (stefano cirilli)
Date: Mon May  8 08:13:26 2006
Subject: [mod_python] Publisher Handler(my own http404)
Message-ID: <000001c67298$e3bdcca0$63000a57@stefano>

Hi all,
i'm trying to get my own http404 page, my configuration, in apache conf file(Apache 2.0.55, mod_python 3.2.8), looks like this:
<Directory htdocs/users/http404>
SetHandler mod_python
PythonHandler mod_python.publisher
</Directory>
My Python(2.4.3) code, in a module named "pagenotf.py":

from mod_python import apache
def index(req):
	if req.filename[-17:] == 'apache-error.html':
		return(apache.HTTP_NOT_FOUND)
	if req.filename[-18:] == 'handler-error.html':
		req.status = apache.HTTP_NOT_FOUND
		pagebuffer = 'Page not here. Page left, not know where gone.'
	else:
		pagebuffer = open(req.filename, 'r').read()
	req.content_type = "text/plain"	
	req.write(pagebuffer)
	return(apache.OK)

if i send, to my browser, this URL:
http://127.0.0.1/users/http404
i receive an Http 404 response, "Page not found",
if i send
http://127.0.0.1/users/http404/pagenotf

then i get a page with the python code. Is the same, if i try

http://127.0.0.1/users/http404/pagenotf/index

How can i get(what's the URL), to display in my page, the content of the variable pagebuffer?

req.write(pagebuffer) 

sets to "Page not here. Page left, not know where gone.".
Sincerely yours,
Stefano Cirilli
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060508/35d66db0/attachment.html
From luismg at gmx.net  Mon May  8 09:51:55 2006
From: luismg at gmx.net (Luis M. Gonzalez)
Date: Mon May  8 09:51:50 2006
Subject: [mod_python] publisher + cheetah 
Message-ID: <007301c672a6$93d168b0$c51ce818@luis>

Hi,

I've been trying (unsuccesfuly) to use Cheetah templates with mod_python publisher.
As far as I could see in previous posts and other sources, Graham's handler is the ultimate way of making it work,
But I'm still having trouble: http://www.modpython.org/pipermail/mod_python/2005-March/017639.html

I wonder what would be the httpd.conf configuration?
Is there any other detail I should be aware of?

Any hint would be highly appreciated...
LUIS
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060508/25f46fe9/attachment.html
From deron.meranda at gmail.com  Mon May  8 10:19:23 2006
From: deron.meranda at gmail.com (Deron Meranda)
Date: Mon May  8 10:19:26 2006
Subject: [mod_python] Publisher Handler(my own http404)
In-Reply-To: <000001c67298$e3bdcca0$63000a57@stefano>
References: <000001c67298$e3bdcca0$63000a57@stefano>
Message-ID: <5c06fa770605080719q4a686394pe82231e8259f5cf2@mail.gmail.com>

On 5/8/06, stefano cirilli <stefano.cirilli1@virgilio.it> wrote:
> i'm trying to get my own http404 page, my configuration, in apache conf
> file(Apache 2.0.55, mod_python 3.2.8), looks like this:
> <Directory htdocs/users/http404>
> SetHandler mod_python
> PythonHandler mod_python.publisher
> </Directory>

I'm not exactly sure what you're trying to do, but it looks like you're
writing your own static file handler.  In which case I think it will be
best just to let Apache serve up your files rather than using mod_python.
(Not to mention the security flaws in your sample code).

Anyway if what you really meant to do was to create a custom 404
error page, you should look at the Apache ErrorDocument directive:
  http://httpd.apache.org/docs/2.2/mod/core.html#errordocument

--
Deron Meranda

From jpg at jgassociates.ca  Mon May  8 12:01:36 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Mon May  8 12:00:36 2006
Subject: [mod_python] Publisher Handler(my own http404)
In-Reply-To: <5c06fa770605080719q4a686394pe82231e8259f5cf2@mail.gmail.com>
References: <000001c67298$e3bdcca0$63000a57@stefano>
	<5c06fa770605080719q4a686394pe82231e8259f5cf2@mail.gmail.com>
Message-ID: <445F6B60.9030203@jgassociates.ca>

Deron Meranda wrote:
> On 5/8/06, stefano cirilli <stefano.cirilli1@virgilio.it> wrote:
>> i'm trying to get my own http404 page, my configuration, in apache conf
>> file(Apache 2.0.55, mod_python 3.2.8), looks like this:
>> <Directory htdocs/users/http404>
>> SetHandler mod_python
>> PythonHandler mod_python.publisher
>> </Directory>
> 
> I'm not exactly sure what you're trying to do, but it looks like you're
> writing your own static file handler.  In which case I think it will be
> best just to let Apache serve up your files rather than using mod_python.
> (Not to mention the security flaws in your sample code).

In addition to the security flaw I would not use
pagebuffer = open(req.filename, 'r').read()
in production for anything other than a small file, as the whole file 
will be read into memory. Much better to have Apache serve up the file 
as Deron suggests, or at least use req.sendfile().

Also, I'd suggest getting publisher working before attempting the other 
things you are trying. Getting the python code when you access pagenotf 
suggests something is amiss with your configuration. I often find when I 
get the python code in the response that the culprit is a typo in the 
Directory path.

Jim

From neomoha at gmail.com  Mon May  8 15:43:43 2006
From: neomoha at gmail.com (Mohamed Sordo)
Date: Mon May  8 15:43:47 2006
Subject: [mod_python] Import Local Name Error, need help!
Message-ID: <77f541e40605081243l7898b357nb784639ac85cc3ec@mail.gmail.com>

Hi everybody,
I've some problems with my mod_python.
I'm trying to execute server_side.py via mod_python.
I have a mod_python_my_files.conf in /etc/apache2/conf.d/

It seems like that:

<IfModule mod_alias.c>
    Alias /my_server /home/neomoha/PFC/src/server_side.py
</IfModule>
<DirectoryMatch /home/neomoha/PFC/src/ >

# mod_python 3.X
    AddHandler mod_python .py
    PythonHandler mod_python.publisher
    PythonDebug On

    Options +FollowSymLinks

    Order allow,deny
    Allow from all
</DirectoryMatch>

NOTE: server-side.py is rwx for everybody

When a execute a python script that uses my localhost connection with
mod_python , I have this output:

Traceback (most recent call last):

  File "/usr/lib/python2.3/site-packages/mod_python/apache.py", line 299, in
HandlerDispatch
    result = object(req)

  File "/usr/lib/python2.3/site-packages/mod_python/publisher.py", line 98,
in handler
    path=[path])

  File "/usr/lib/python2.3/site-packages/mod_python/apache.py", line 457, in
import_module
    module = imp.load_module(mname, f, p, d)

  File "/home/neomoha/PFC/src/server_side.py", line 22, in ?
    from myfile import MyFile

ImportError: cannot import name MyFile

NOTE: myfile.py is in /home/neomoha/PFC/src/ directory.
And I'm using Apache/2.0.55 (Debian) mod_python/3.1.3 Python/2.3.5 Server at
localhost Port 80

Thanks for any answer,
Mohamed.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060508/41d4f17f/attachment.html
From jpg at jgassociates.ca  Mon May  8 16:01:54 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Mon May  8 15:59:47 2006
Subject: [mod_python] Import Local Name Error, need help!
In-Reply-To: <77f541e40605081243l7898b357nb784639ac85cc3ec@mail.gmail.com>
References: <77f541e40605081243l7898b357nb784639ac85cc3ec@mail.gmail.com>
Message-ID: <445FA3B2.7000600@jgassociates.ca>

Mohamed Sordo wrote:
> Hi everybody,
> I've some problems with my mod_python.
> I'm trying to execute server_side.py via mod_python.
> I have a mod_python_my_files.conf in /etc/apache2/conf.d/
> 
> It seems like that:
> 
> <IfModule mod_alias.c>
>    Alias /my_server /home/neomoha/PFC/src/server_side.py
> </IfModule>
> <DirectoryMatch /home/neomoha/PFC/src/ >
> 
> # mod_python 3.X
>    AddHandler mod_python .py
>    PythonHandler mod_python.publisher
>    PythonDebug On
> 
>    Options +FollowSymLinks
> 
>    Order allow,deny
>    Allow from all
> </DirectoryMatch>
> 
> NOTE: server-side.py is rwx for everybody
> 
> When a execute a python script that uses my localhost connection with
> mod_python , I have this output:
> 
> Traceback (most recent call last):
> 
>  File "/usr/lib/python2.3/site-packages/mod_python/apache.py", line 299, in
> HandlerDispatch
>    result = object(req)
> 
>  File "/usr/lib/python2.3/site-packages/mod_python/publisher.py", line 98,
> in handler
>    path=[path])
> 
>  File "/usr/lib/python2.3/site-packages/mod_python/apache.py", line 457, in
> import_module
>    module = imp.load_module(mname, f, p, d)
> 
>  File "/home/neomoha/PFC/src/server_side.py", line 22, in ?
>    from myfile import MyFile
> 
> ImportError: cannot import name MyFile
> 
> NOTE: myfile.py is in /home/neomoha/PFC/src/ directory.
> And I'm using Apache/2.0.55 (Debian) mod_python/3.1.3 Python/2.3.5 
> Server at
> localhost Port 80

Either put myfile.py somewhere in your python path (eg. 
/usr/local/python2.3/site-packages/myfile.py) or add the path using 
PythonPath "['/path/to/myfile.py',] + sys.path" in your apache 
mod_python_my_files.conf file.

Note that it is considered to be bad practice to add any directories 
under your document root using PythonPath. You are likely to observe 
strange import behaviour.

Jim
From grahamd at dscpl.com.au  Mon May  8 19:19:20 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon May  8 19:19:25 2006
Subject: [mod_python] publisher + cheetah 
Message-ID: <1147130360.19158@dscpl.user.openhosting.com>

Luis M. Gonzalez wrote ..
> Hi,
> 
> I've been trying (unsuccesfuly) to use Cheetah templates with mod_python
> publisher.
> As far as I could see in previous posts and other sources, Graham's handler
> is the ultimate way of making it work,
> But I'm still having trouble: http://www.modpython.org/pipermail/mod_python/2005-March/017639.html
> 
> I wonder what would be the httpd.conf configuration?
> Is there any other detail I should be aware of?
> 
> Any hint would be highly appreciated...

There was a mistake in the apache.import_module() call, see:

  http://wiki.cheetahtemplate.org/cheetah-recipes.html?

for further commentary on this code.

If after working through stuff in that file you still have issues, you'll need
to provide further information about what Apache configuration you are
using and what errors you are actually getting in the Apache error log.

Graham
From luismg at gmx.net  Mon May  8 21:17:38 2006
From: luismg at gmx.net (Luis M. Gonzalez)
Date: Mon May  8 21:17:46 2006
Subject: [mod_python] publisher + cheetah 
References: <1147130360.19158@dscpl.user.openhosting.com>
Message-ID: <001101c67306$5ea4e260$c51ce818@luis>

Thanks for your reply Graham!

Well, this is my Apache configuraton:

  <Directory "C:/Archivos de programa/xampp/htdocs">
  AddHandler python-program .py .psp
  PythonHandler mod_python.publisher | .py
  PythonHandler mod_python.psp | .psp
  </Directory>

I actually managed to use Cheetah templates with publisher, without any special handler at all.
All I had to do is compile the template into a .py module first (cheetah compile mytemplate.tmpl ---> mytemplate.py).

Then I would simply use it as follows:

  from mytemplate import mytemplate
  import MySQLdb

  def index(req):
      con = MySQLdb.connect('localhost','root','','vic')
      cur = con.cursor()
      cur.execute('select * from clientes')
      res = cur.fetchall()
      con.close()

      req.content_type='text/html'
      templ = mytemplate(searchList=[{'res':res}])
      return templ

However, I'd like to use templates without having to compile them first.

My questions are:

1) How should I configure Apache?
2) What's the best handler to use Cheetah + publisher?

LUIS









----- Original Message ----- 
From: "Graham Dumpleton" <grahamd@dscpl.com.au>
To: "Luis M. Gonzalez" <luismg@gmx.net>
Cc: <mod_python@modpython.org>
Sent: Monday, May 08, 2006 8:19 PM
Subject: Re: [mod_python] publisher + cheetah 


> Luis M. Gonzalez wrote ..
>> Hi,
>> 
>> I've been trying (unsuccesfuly) to use Cheetah templates with mod_python
>> publisher.
>> As far as I could see in previous posts and other sources, Graham's handler
>> is the ultimate way of making it work,
>> But I'm still having trouble: http://www.modpython.org/pipermail/mod_python/2005-March/017639.html
>> 
>> I wonder what would be the httpd.conf configuration?
>> Is there any other detail I should be aware of?
>> 
>> Any hint would be highly appreciated...
> 
> There was a mistake in the apache.import_module() call, see:
> 
>  http://wiki.cheetahtemplate.org/cheetah-recipes.html?
> 
> for further commentary on this code.
> 
> If after working through stuff in that file you still have issues, you'll need
> to provide further information about what Apache configuration you are
> using and what errors you are actually getting in the Apache error log.
> 
> Graham
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060508/67d1a308/attachment.html
From grahamd at dscpl.com.au  Mon May  8 21:31:15 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon May  8 21:31:19 2006
Subject: [mod_python] publisher + cheetah 
Message-ID: <1147138275.28584@dscpl.user.openhosting.com>

Luis M. Gonzalez wrote ..
> However, I'd like to use templates without having to compile them first.

Is there a reason you don't want to have to compile them first?
There is a performance hit by not doing so.

Anyway, just want to make sure I understand you reasons before
I suggest a solution.

Graham
From luismg at gmx.net  Mon May  8 22:40:37 2006
From: luismg at gmx.net (Luis M. Gonzalez)
Date: Mon May  8 22:40:45 2006
Subject: [mod_python] publisher + cheetah 
References: <1147138275.28584@dscpl.user.openhosting.com>
Message-ID: <000e01c67311$f658c990$c51ce818@luis>

> Is there a reason you don't want to have to compile them first?

  Not really. I just thought I was doing something wrong, because I read many posts about "cheetah handlers" and I couldn't believe the way I was using cheetah was the correct one (or the most recommended).
  The only benefit I can think of, is that I would avoid the extra step of compiling when testing code...

> There is a performance hit by not doing so.

  That's good to know. So, why the heck do people write cheetah handlers ?
 
> Anyway, just want to make sure I understand you reasons before
> I suggest a solution.

  Well, I still wonder why people write cheetah handlers... :-)

Thanks!
LUIS
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060508/f348d8d3/attachment-0001.html
From grahamd at dscpl.com.au  Tue May  9 00:16:51 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue May  9 00:16:54 2006
Subject: [mod_python] Import Local Name Error, need help!
Message-ID: <1147148211.22612@dscpl.user.openhosting.com>

Mohamed Sordo wrote ..
> Hi everybody,
> I've some problems with my mod_python.
> I'm trying to execute server_side.py via mod_python.
> I have a mod_python_my_files.conf in /etc/apache2/conf.d/
> 
> It seems like that:
> 
> <IfModule mod_alias.c>
>     Alias /my_server /home/neomoha/PFC/src/server_side.py
> </IfModule>
> <DirectoryMatch /home/neomoha/PFC/src/ >

I would recommend not using DirectoryMatch as mod_python can't
handle a regular expression or globex style path using this
directive or the Directory directive. Such support may make it into
mod_python 3.3. Use a straight path instead for now:

  <Directory /home/neomoha/PFC/src/>

Overall, unless you have a PythonPath set at global scope which is
causing directory associated with directive to not be added to sys.path
automatically, not sure why it wouldn't find it. Other possibility is
how you are using Alias is screwing things up.

Can you add to the start of your module:

  from mod_python import apache
  import sys
  apache.log_error('__file__=%s' % __file__)
  apache.log_error('path=%s' % sys.path)

to see what sys.path is set to when import is occurring and post the
result here if you haven't yet worked it out. The messages will be logged
in the Apache error log file.

> # mod_python 3.X
>     AddHandler mod_python .py
>     PythonHandler mod_python.publisher
>     PythonDebug On
> 
>     Options +FollowSymLinks
> 
>     Order allow,deny
>     Allow from all
> </DirectoryMatch>
> 
> NOTE: server-side.py is rwx for everybody
> 
> When a execute a python script that uses my localhost connection with
> mod_python , I have this output:
> 
> Traceback (most recent call last):
> 
>   File "/usr/lib/python2.3/site-packages/mod_python/apache.py", line 299,
> in
> HandlerDispatch
>     result = object(req)
> 
>   File "/usr/lib/python2.3/site-packages/mod_python/publisher.py", line
> 98,
> in handler
>     path=[path])
> 
>   File "/usr/lib/python2.3/site-packages/mod_python/apache.py", line 457,
> in
> import_module
>     module = imp.load_module(mname, f, p, d)
> 
>   File "/home/neomoha/PFC/src/server_side.py", line 22, in ?
>     from myfile import MyFile
> 
> ImportError: cannot import name MyFile
> 
> NOTE: myfile.py is in /home/neomoha/PFC/src/ directory.
> And I'm using Apache/2.0.55 (Debian) mod_python/3.1.3 Python/2.3.5 Server
> at
> localhost Port 80
> 
> Thanks for any answer,
> Mohamed.
From dan.eloff at gmail.com  Tue May  9 00:58:17 2006
From: dan.eloff at gmail.com (Dan Eloff)
Date: Tue May  9 00:58:22 2006
Subject: [mod_python] Graham's New Importer
Message-ID: <4817b6fc0605082158u73a856dfg184a010b38f96303@mail.gmail.com>

Hey Graham, I've been using your new module importer and it works like
a charm. I haven't had a single problem with it. Thanks!

I would like to discuss having a general search path, and being able
to add directories to it. While I understand the reasons you have (and
they are valid, good reasons) for not wanting to do this, there are
also good reasons to have the ability. Right now, so I don't have to
stick the absolute path to pyserver components in every file, I've
moved pyserver to site-packages, giving up the reload ability. It also
prevents me from using the debugger without restarting the server. I
also find that I have some common includes off sys.path and I've sunk
to placing the absolute path in an extraneous module and importing
that whenever I need to import these common files so as to avoid
sticking the path everywhere. It's less than ideal. I think it would
really be a nice touch to be able to choose which behaviour you want.
Just add a PythonOption called search_path or import_path or
something, and if given the directories listed get added to the search
path for all importing needs.

If you're not interested I'll add this, but I would want your
permission first before I go messing with your code.

That aside, don't let my suggestion for improvement detract in any way
from your importer, it's really a great piece of work.
-Dan

From grahamd at dscpl.com.au  Tue May  9 01:22:34 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue May  9 01:22:37 2006
Subject: [mod_python] Graham's New Importer
Message-ID: <1147152154.26950@dscpl.user.openhosting.com>

Dan Eloff wrote ..
> Hey Graham, I've been using your new module importer and it works like
> a charm. I haven't had a single problem with it. Thanks!
> 
> I would like to discuss having a general search path, and being able
> to add directories to it. While I understand the reasons you have (and
> they are valid, good reasons) for not wanting to do this, there are
> also good reasons to have the ability. Right now, so I don't have to
> stick the absolute path to pyserver components in every file, I've
> moved pyserver to site-packages, giving up the reload ability. It also
> prevents me from using the debugger without restarting the server. I
> also find that I have some common includes off sys.path and I've sunk
> to placing the absolute path in an extraneous module and importing
> that whenever I need to import these common files so as to avoid
> sticking the path everywhere. It's less than ideal. I think it would
> really be a nice touch to be able to choose which behaviour you want.
> Just add a PythonOption called search_path or import_path or
> something, and if given the directories listed get added to the search
> path for all importing needs.
> 
> If you're not interested I'll add this, but I would want your
> permission first before I go messing with your code.
> 
> That aside, don't let my suggestion for improvement detract in any way
> from your importer, it's really a great piece of work.

This discussion should perhaps be on the developers mailing list, here
will do for the moment though.

Now, before you contemplate making any code changes, just outline at a
high level what options/directives you have in mind should be added and
what defining them should cause to happen.

In the mean time, I'll have to go back and read what I rambled on about
last time as I forget. I don't think though that I revealed everything you
could do and although some of the stuff I didn't mention may not be
directly useful, it may well form basis of implementing such stuff.

Will be interested to here how you think such global search paths should
work. After all, you are probably the first to try and seriously use the
new importer in the new ways that it can be used.

Anyway, will see what you have to say and make comments if appropriate.
 
Graham
From grahamd at dscpl.com.au  Tue May  9 01:38:49 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue May  9 01:38:53 2006
Subject: [mod_python] publisher + cheetah 
Message-ID: <1147153129.3547@dscpl.user.openhosting.com>

Luis M. Gonzalez wrote ..
> > Is there a reason you don't want to have to compile them first?
> 
>   Not really. I just thought I was doing something wrong, because I read
> many posts about "cheetah handlers" and I couldn't believe the way I was
> using cheetah was the correct one (or the most recommended).
>   The only benefit I can think of, is that I would avoid the extra step
> of compiling when testing code...
> 
> > There is a performance hit by not doing so.
> 
>   That's good to know. So, why the heck do people write cheetah handlers
> ?
>  
> > Anyway, just want to make sure I understand you reasons before
> > I suggest a solution.
> 
>   Well, I still wonder why people write cheetah handlers... :-)

Note that I am not an expert on Cheetah and it has been a while since I
have looked at it, so don't take the follow as gospel.

There are different ways in which Cheetah can be used, thus the way you
use it will to a degree dictate what you need to do to integrate it with
mod_python.

First off, you can store templates as text and not precompile them to
Python source code, or you can precompile them.

In the first case you need to instantiate a Cheetah Template class
instance on each access to the page unless you implement yourself some
caching mechanism which uses last loaded page and only recreates it when
it is detected that file on disk has changed. If the template has to be
recreated every time, performance will be affected.

In the case of precompiled templates where Python code resides on
disk, the actual code file is loaded as a Python module. In this case,
sys.modules is acting like a cache for you and performance will be
faster than having to create Template instance on every access. Dealing
with changes to template/code on disk is problematic with precompiled
templates stored on disk, but I'll get to that later (maybe not this email).

That is one choice that exists and I my partial understanding is that
by not using precompiled templates, you do loose some features,
or maybe how you have to do it is different. Specifically, when using
precompiled templates you have the ability to derive a template from
another template. Thus, you can have a base template which defines
a skeleton for a site layout. Individual pages can then extend this base
template and override just the body or other bits as necessary.

The next choice one has that one can make is how you put together
all the data which may be required to fill out a page when it is being
rendered. Here you can either construct a big dictionary containing
all the data precalculated before you even try to render the page, or,
you can initiate the rendering of the page and have it internally
collect the data.

In simple terms, you are either providing the data to the template, or
the template can make callouts to get the data.

Which want you want to work here can affect how you use mod_python
handlers to integrate things together. If you are going to precalculate
all the data, then it effectively means you are going to have a customised
handler or publisher function corresponding to each resource where
such data needs to be calculated. If instead the template is going to
call out to get the data, you can possibly get away with a generic
handler which passes in just the request object and the template does
any necessary imports of other modules to get access to data.

Anyway, my head isn't thinking straight right now so I am going to
leave it at that for now, leaving issues of module importing and reloading
when using precompiled templates another time. I hope from the above
you might see that depending on how you want to do things, a custom
handler may well work, but if perhaps you want to deal with page
caching issues and/or templates calling out to get data as opposed to
passing it in, a generic handler may work better as it hides the details
away and you don't have to duplicate them in each custom handler.

Sorry, brain is giving up. Time for me to go home and sleep I think. :-)

Graham
From lucian at unixro.net  Tue May  9 09:27:42 2006
From: lucian at unixro.net (Lucian)
Date: Tue May  9 09:27:46 2006
Subject: [mod_python] ./configure fails on freebsd 6.0
Message-ID: <446098CE.7070205@unixro.net>

Hi there. I'm trying to compile mod_python on a freebsd 6.0 box, but 
configure fails. It seems to be a shell script problem.

./configure --with-apxs=/usr/local/apache2/bin/apxs
... ... ...
checking linker flags used to link Python...
checking where Python include files are... -I/usr/local/include/python2.4
./configure: line 3427: syntax error near unexpected token `('
./configure: line 3427: `  as_lineno_3=`(expr $as_lineno_1 + 1) 
2>/dev/null`'

Any suggestions? Thanks.
From dan.eloff at gmail.com  Tue May  9 11:40:50 2006
From: dan.eloff at gmail.com (Dan Eloff)
Date: Tue May  9 11:41:39 2006
Subject: [mod_python] Graham's New Importer
In-Reply-To: <1147152154.26950@dscpl.user.openhosting.com>
References: <1147152154.26950@dscpl.user.openhosting.com>
Message-ID: <4817b6fc0605090840h5891981di714b46c465e51091@mail.gmail.com>

I think probably just:

PythonOption importer.path "C:\Documents And Settings\..." "another path"

I'm not sure the syntax allows for that, but something along those
lines is the idea. None of those paths should be on sys.path.

You shouldn't be able to specify this more than once for each python
interpreter. I don't know how to enforce that, but it would prevent
any wierdness with the same module being imported under different
circumstances in the same interpreter.

The paths should be used for all importing done by that interpreter,
and should be added to sys.path temporarily if you fallback to
python's import so that those modules can still be found.

There's probably some problems with all this, but I don't think
anything insurmountable, and you're no doubt familiar enough with the
system to spot the trouble before we start.

-Dan



On 5/8/06, Graham Dumpleton <grahamd@dscpl.com.au> wrote:
> Dan Eloff wrote ..
> > Hey Graham, I've been using your new module importer and it works like
> > a charm. I haven't had a single problem with it. Thanks!
> >
> > I would like to discuss having a general search path, and being able
> > to add directories to it. While I understand the reasons you have (and
> > they are valid, good reasons) for not wanting to do this, there are
> > also good reasons to have the ability. Right now, so I don't have to
> > stick the absolute path to pyserver components in every file, I've
> > moved pyserver to site-packages, giving up the reload ability. It also
> > prevents me from using the debugger without restarting the server. I
> > also find that I have some common includes off sys.path and I've sunk
> > to placing the absolute path in an extraneous module and importing
> > that whenever I need to import these common files so as to avoid
> > sticking the path everywhere. It's less than ideal. I think it would
> > really be a nice touch to be able to choose which behaviour you want.
> > Just add a PythonOption called search_path or import_path or
> > something, and if given the directories listed get added to the search
> > path for all importing needs.
> >
> > If you're not interested I'll add this, but I would want your
> > permission first before I go messing with your code.
> >
> > That aside, don't let my suggestion for improvement detract in any way
> > from your importer, it's really a great piece of work.
>
> This discussion should perhaps be on the developers mailing list, here
> will do for the moment though.
>
> Now, before you contemplate making any code changes, just outline at a
> high level what options/directives you have in mind should be added and
> what defining them should cause to happen.
>
> In the mean time, I'll have to go back and read what I rambled on about
> last time as I forget. I don't think though that I revealed everything you
> could do and although some of the stuff I didn't mention may not be
> directly useful, it may well form basis of implementing such stuff.
>
> Will be interested to here how you think such global search paths should
> work. After all, you are probably the first to try and seriously use the
> new importer in the new ways that it can be used.
>
> Anyway, will see what you have to say and make comments if appropriate.
>
> Graham
>

From jpg at jgassociates.ca  Tue May  9 12:17:47 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Tue May  9 12:17:23 2006
Subject: [mod_python] ./configure fails on freebsd 6.0
In-Reply-To: <446098CE.7070205@unixro.net>
References: <446098CE.7070205@unixro.net>
Message-ID: <4460C0AB.3030309@jgassociates.ca>

Lucian wrote:
> Hi there. I'm trying to compile mod_python on a freebsd 6.0 box, but 
> configure fails. It seems to be a shell script problem.
> 
> ./configure --with-apxs=/usr/local/apache2/bin/apxs
> ... ... ...
> checking linker flags used to link Python...
> checking where Python include files are... -I/usr/local/include/python2.4
> ./configure: line 3427: syntax error near unexpected token `('
> ./configure: line 3427: `  as_lineno_3=`(expr $as_lineno_1 + 1) 
> 2>/dev/null`'

Looks like the bash 3.1 bug. It's been fixed in for the next release. 
See http://issues.apache.org/jira/browse/MODPYTHON-122

Jim
From petersanchez at gmail.com  Tue May  9 14:52:37 2006
From: petersanchez at gmail.com (Peter Sanchez)
Date: Tue May  9 14:52:41 2006
Subject: [mod_python] PSP Error & apache.import_module() questions
Message-ID: <20060509185237.GI11383@g35-140.icann.org>

Hey all...                                                                                                     
                                                                                                               
I have been getting these errors more and more. I am sure they are                                             
related to my template files, but not sure what the error really means.                                        
Here it is (trimmed):                                                                                          
                                                                                                               
<snip to the meat>                                                                                             
                                                                                                               
PythonHandler mod_python.publisher:   File                                                                     
"/usr/local/lib/python2.4/site-packages/mod_python/psp.py", line 213, in                                       
run\n    exec code in global_scope                                                                             
PythonHandler mod_python.publisher:   File                                                                     
"/home/ahcabron/data/templates/view_img.tmpl", line 160, in ?\n    %>                                          
                                                                                                               
</snip>                                                                                                        
                                                                                                               
Now, line 160 in view_img.tmpl is literally "%>\n" and that's it.                                              
                                                                                                               
I am using mod_python.publisher, and mod_python.psp as my template                                             
engine. Can anyone help me out with this error msg and what it means?                                          
The next line in the traceback can be from any one of my templates, at                                         
various other line numbers. It isn't just in view_img.tmpl, it can be in                                       
any of my templates and always at a line where "%>\n" is all there is.                                         
                                                                                                               
Here is my environment info:                                                                                   
                                                                                                               
Apache/2.0.54 (FreeBSD) PHP/4.4.0 mod_python/3.2.7 Python/2.4.1                                                
                                                                                                               
                                                                                                               
Also, I have a question on the apache.import_module() function. Should                                         
this be done in *all* modules that are subsequently imported. IE                                               
                                                                                                               
index.py imports myconfig.py                                                                                   
myconfig.py in turn imports sys, os and re                                                                     
                                                                                                               
Should myconfig.py be using apache.import_module() as well?                                                    
                                                                                                               
Is there an option to do the equivilent of 'from module import *', etc?                                        
                                                                                                               
Thanks for any help!                                                                                           
                                                                                                               
Peter
From jpg at jgassociates.ca  Tue May  9 16:57:04 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Tue May  9 16:55:30 2006
Subject: [mod_python] PSP Error & apache.import_module() questions
In-Reply-To: <20060509185237.GI11383@g35-140.icann.org>
References: <20060509185237.GI11383@g35-140.icann.org>
Message-ID: <44610220.6020503@jgassociates.ca>

Peter Sanchez wrote:
> Hey all...                                                                                                     
>                                                                                                                
> I have been getting these errors more and more. I am sure they are                                             
> related to my template files, but not sure what the error really means.                                        
> Here it is (trimmed):                                                                                          
>                                                                                                                
> <snip to the meat>                                                                                             
>                                                                                                                
> PythonHandler mod_python.publisher:   File                                                                     
> "/usr/local/lib/python2.4/site-packages/mod_python/psp.py", line 213, in                                       
> run\n    exec code in global_scope                                                                             
> PythonHandler mod_python.publisher:   File                                                                     
> "/home/ahcabron/data/templates/view_img.tmpl", line 160, in ?\n    %>                                          
>                                                                                                                
> </snip>                                                                                                        
>                                                                                                                
> Now, line 160 in view_img.tmpl is literally "%>\n" and that's it.                                              
>                                                                                                                
> I am using mod_python.publisher, and mod_python.psp as my template                                             
> engine. Can anyone help me out with this error msg and what it means?                                          
> The next line in the traceback can be from any one of my templates, at                                         
> various other line numbers. It isn't just in view_img.tmpl, it can be in                                       
> any of my templates and always at a line where "%>\n" is all there is.                                         
>                                                                                                                
> Here is my environment info:                                                                                   
>                                                                                                                
> Apache/2.0.54 (FreeBSD) PHP/4.4.0 mod_python/3.2.7 Python/2.4.1                                                

Uhm, I think maybe you cut into the bone when trimming. You know, the 
bit that says:

InquisitionError: warning, wasn't expecting the Spanish Inquisition

Or whatever. Otherwise we'd just be guessing. At this point all I can 
say is that there is problem somewhere before line 160 in your template. :)

Jim


 
 
 

From petersanchez at gmail.com  Tue May  9 17:17:43 2006
From: petersanchez at gmail.com (Peter Sanchez)
Date: Tue May  9 17:17:46 2006
Subject: [mod_python] PSP Error & apache.import_module() questions
In-Reply-To: <44610220.6020503@jgassociates.ca>
References: <20060509185237.GI11383@g35-140.icann.org>
	<44610220.6020503@jgassociates.ca>
Message-ID: <20060509211742.GL11383@g35-140.icann.org>


On Tue, May 09, 2006 at 04:57:04PM -0400, Jim Gallacher wrote:
> Peter Sanchez wrote:
> >Hey all...                                                                 
> >                                                                                                               
> >I have been getting these errors more and more. I am sure they are         
> >related to my template files, but not sure what the error really means.    
> >Here it is (trimmed):                                                      
> >                                                                                                               
> ><snip to the meat>                                                         
> >                                                                                                               
> >PythonHandler mod_python.publisher:   File                                 
> >"/usr/local/lib/python2.4/site-packages/mod_python/psp.py", line 213, in   
> >run\n    exec code in global_scope                                         
> >PythonHandler mod_python.publisher:   File                                 
> >"/home/ahcabron/data/templates/view_img.tmpl", line 160, in ?\n    %>      
> >                                                                                                               
> ></snip>                                                                    
> >                                                                                                               
> >Now, line 160 in view_img.tmpl is literally "%>\n" and that's it.          
> >                                                                                                               
> >I am using mod_python.publisher, and mod_python.psp as my template         
> >engine. Can anyone help me out with this error msg and what it means?      
> >The next line in the traceback can be from any one of my templates, at     
> >various other line numbers. It isn't just in view_img.tmpl, it can be in   
> >any of my templates and always at a line where "%>\n" is all there is.     
> >                                                                                                               
> >Here is my environment info:                                               
> >                                                                                                               
> >Apache/2.0.54 (FreeBSD) PHP/4.4.0 mod_python/3.2.7 Python/2.4.1            
> 
> Uhm, I think maybe you cut into the bone when trimming. You know, the 
> bit that says:
> 
> InquisitionError: warning, wasn't expecting the Spanish Inquisition
> 
> Or whatever. Otherwise we'd just be guessing. At this point all I can 
> say is that there is problem somewhere before line 160 in your template. :)

Heh, sorry. Here is the entire error. It didn't seem like the other
lines from the traceback were very useful. Here you go :)

Tue May 09 14:06:08 2006] [error] [client 144.13.215.1004] PythonHandler
mod_python.publisher: Traceback (most recent call last):
http://www.ahcabron.com/view_cat?c=15&p=3

[Tue May 09 14:06:08 2006] [error] [client 144.13.215.104] PythonHandler
mod_python.publisher:   File
"/usr/local/lib/python2.4/site-packages/mod_python/apache.py", line 299,
in HandlerDispatch\n    res
ult = object(req), referer: http://www.ahcabron.com/view_cat?c=15&p=3

[Tue May 09 14:06:08 2006] [error] [client 144.13.215.104] PythonHandler
mod_python.publisher:   File
"/usr/local/lib/python2.4/site-packages/mod_python/publisher.py", line
213, in handler\n    publishe
d = publish_object(req, object), referer:
http://www.ahcabron.com/view_cat?c=15&p=3

[Tue May 09 14:06:08 2006] [error] [client 144.13.215.104] PythonHandler
mod_python.publisher:   File
"/usr/local/lib/python2.4/site-packages/mod_python/publisher.py", line
412, in publish_object\n    r
eturn publish_object(req,util.apply_fs_data(object, req.form, req=req)),
referer: http://www.ahcabron.com/view_cat?c=15&p=3

[Tue May 09 14:06:08 2006] [error] [client 144.13.215.104] PythonHandler
mod_python.publisher:   File
"/usr/local/lib/python2.4/site-packages/mod_python/publisher.py", line
453, in publish_object\n    r
esult = str(object), referer: http://www.ahcabron.com/view_cat?c=15&p=3

[Tue May 09 14:06:08 2006] [error] [client 144.13.215.104] PythonHandler
mod_python.publisher:   File
"/usr/local/lib/python2.4/site-packages/mod_python/psp.py", line 233, in
__str__\n    self.run(), re
ferer: http://www.ahcabron.com/view_cat?c=15&p=3

[Tue May 09 14:06:08 2006] [error] [client 144.13.215.104] PythonHandler
mod_python.publisher:   File
"/usr/local/lib/python2.4/site-packages/mod_python/psp.py", line 213, in
run\n    exec code in globa
l_scope, referer: http://www.ahcabron.com/view_cat?c=15&p=3

[Tue May 09 14:06:08 2006] [error] [client 144.13.215.104] PythonHandler
mod_python.publisher:   File
"/home/ahcabron/data/templates/view_img.tmpl", line 160, in ?\n    %>,
referer: http://www.ahcabron.
com/view_cat?c=15&p=3

[Tue May 09 14:06:08 2006] [error] [client 144.13.215.104] PythonHandler
mod_python.publisher: IOError: Write failed, client closed connection.,
referer: http://www.ahcabron.com/view_cat?c=15&p=3


Hope this helps :)

Thanks again!

Peter

> 
> Jim
> 
> 
> 
> 
> 
From David.Bear at asu.edu  Tue May  9 22:18:24 2006
From: David.Bear at asu.edu (David Bear)
Date: Tue May  9 22:18:34 2006
Subject: [mod_python] syntax errors
Message-ID: <20060510021824.GJ18174@asu.edu>

I'm using psp handler like this:

<Directory "/www/htdocs/psp">
 AddHandler mod_python .psp
 PythonHandler mod_python.psp
 PythonDebug On
</Directory>

my html.psp file contains a simple exercise from onlamp demonstrating
psp and looks like this:


<html>
 <head>
   <title>A psp test </title>
 </head>
 <body>
<% 
if form.has_key('name'):
   greet = 'Hellow %s ' % form.['name'].capitalize()
else: 
   greet = 'hellow nobody '
%>
   <h1>A greeting test </h1>
   <%= greet %>
 </body>
<html>

I am getting a syntax error. My reading of the onlamp article
indicated that indentation shouldn't be a problem -- and indentation
is consistent. I'm just not seeing the error.

There must be something really simple that I'm missing. Any
suggestions?
-- 
David Bear
phone: 	480-965-8257
fax: 	480-965-9189
College of Public Programs/ASU
Wilson Hall 232
Tempe, AZ 85287-0803
 "Beware the IP portfolio, everyone will be suspect of trespassing"
From grahamd at dscpl.com.au  Tue May  9 22:32:59 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue May  9 22:33:55 2006
Subject: [mod_python] syntax errors
Message-ID: <1147228379.15059@dscpl.user.openhosting.com>

David Bear wrote ..
> I'm using psp handler like this:
> 
> <Directory "/www/htdocs/psp">
>  AddHandler mod_python .psp
>  PythonHandler mod_python.psp
>  PythonDebug On
> </Directory>
> 
> my html.psp file contains a simple exercise from onlamp demonstrating
> psp and looks like this:
> 
> 
> <html>
>  <head>
>    <title>A psp test </title>
>  </head>
>  <body>
> <% 
> if form.has_key('name'):
>    greet = 'Hellow %s ' % form.['name'].capitalize()
> else: 
>    greet = 'hellow nobody '
> %>
>    <h1>A greeting test </h1>
>    <%= greet %>
>  </body>
> <html>
> 
> I am getting a syntax error. My reading of the onlamp article
> indicated that indentation shouldn't be a problem -- and indentation
> is consistent. I'm just not seeing the error.
> 
> There must be something really simple that I'm missing. Any
> suggestions?

Replace your four space indent with tabs. PSP is fussy.

Alternatively, read the following:

 http://www.modpython.org/pipermail/mod_python/2005-May/018102.html

as to how to include indent hints so you can use four spaces instead.

Graham
From grahamd at dscpl.com.au  Tue May  9 22:46:58 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue May  9 22:47:01 2006
Subject: [mod_python] PSP Error & apache.import_module() questions
Message-ID: <1147229218.22779@dscpl.user.openhosting.com>

Peter Sanchez wrote ..
> Also, I have a question on the apache.import_module() function. Should
> this be done in *all* modules that are subsequently imported. IE      
>                                                                                                                
> index.py imports myconfig.py                                          
> myconfig.py in turn imports sys, os and re                            
>                                                                                                                
> Should myconfig.py be using apache.import_module() as well?           
>                                                                                                                
> Is there an option to do the equivilent of 'from module import *', etc?

Standard Python modules should always be included with "import" and NOT
with "apache.import_module()".

Also, a general rule is that you should not import the same module using
both "import" and "apache.import_module()" from different places. If you
break this rule, you can end up with modules being wrongly reloaded
which can cause problems. See:

  http://www.dscpl.com.au/articles/modpython-003.html#redundant-module-loading

You may want to read that whole article, as it describes various other
module importing issues when using mod_python.

Graham
From grahamd at dscpl.com.au  Tue May  9 22:57:03 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue May  9 22:57:07 2006
Subject: [mod_python] Graham's New Importer
Message-ID: <1147229823.28296@dscpl.user.openhosting.com>

Dan Eloff wrote ..
> I think probably just:
> 
> PythonOption importer.path "C:\Documents And Settings\..." "another path"
> 
> I'm not sure the syntax allows for that, but something along those
> lines is the idea. None of those paths should be on sys.path.
> 
> You shouldn't be able to specify this more than once for each python
> interpreter. I don't know how to enforce that, but it would prevent
> any wierdness with the same module being imported under different
> circumstances in the same interpreter.

The only way you could enforce that it only be set once is to have it
take two arguments, one being the interpreter name and the other the
path, and only honour the option when it is set in the global Apache
configuration. That is, read from:

  apache.main_server.get_options()

This is restrictive though, as makes it impossible to set it in a local
.htaccess file.

> The paths should be used for all importing done by that interpreter,
> and should be added to sys.path temporarily if you fallback to
> python's import so that those modules can still be found.

I don't follow the adding it temporarily to 'sys.path' bit. Conceptually
"import" can be overridden so that it checks the additional locations
before it falls back to having builtin __import__ look for it in
'sys.path', but this would only work for file modules and not packages.
In this case it would actually use the mod_python importer to load the
file base module. Actually adding stuff to 'sys.path' even for a moment
will not working in a multithreaded system.

Perhaps you can explain the sys.path bit in some more detail.

I haven't had a chance to go back and read what I said last time yet,
after I have I'll probably comment further.

Graham

> There's probably some problems with all this, but I don't think
> anything insurmountable, and you're no doubt familiar enough with the
> system to spot the trouble before we start.
> 
> -Dan
> 
> 
> 
> On 5/8/06, Graham Dumpleton <grahamd@dscpl.com.au> wrote:
> > Dan Eloff wrote ..
> > > Hey Graham, I've been using your new module importer and it works like
> > > a charm. I haven't had a single problem with it. Thanks!
> > >
> > > I would like to discuss having a general search path, and being able
> > > to add directories to it. While I understand the reasons you have (and
> > > they are valid, good reasons) for not wanting to do this, there are
> > > also good reasons to have the ability. Right now, so I don't have to
> > > stick the absolute path to pyserver components in every file, I've
> > > moved pyserver to site-packages, giving up the reload ability. It also
> > > prevents me from using the debugger without restarting the server.
> I
> > > also find that I have some common includes off sys.path and I've sunk
> > > to placing the absolute path in an extraneous module and importing
> > > that whenever I need to import these common files so as to avoid
> > > sticking the path everywhere. It's less than ideal. I think it would
> > > really be a nice touch to be able to choose which behaviour you want.
> > > Just add a PythonOption called search_path or import_path or
> > > something, and if given the directories listed get added to the search
> > > path for all importing needs.
> > >
> > > If you're not interested I'll add this, but I would want your
> > > permission first before I go messing with your code.
> > >
> > > That aside, don't let my suggestion for improvement detract in any
> way
> > > from your importer, it's really a great piece of work.
> >
> > This discussion should perhaps be on the developers mailing list, here
> > will do for the moment though.
> >
> > Now, before you contemplate making any code changes, just outline at
> a
> > high level what options/directives you have in mind should be added and
> > what defining them should cause to happen.
> >
> > In the mean time, I'll have to go back and read what I rambled on about
> > last time as I forget. I don't think though that I revealed everything
> you
> > could do and although some of the stuff I didn't mention may not be
> > directly useful, it may well form basis of implementing such stuff.
> >
> > Will be interested to here how you think such global search paths should
> > work. After all, you are probably the first to try and seriously use
> the
> > new importer in the new ways that it can be used.
> >
> > Anyway, will see what you have to say and make comments if appropriate.
> >
> > Graham
> >
From grahamd at dscpl.com.au  Tue May  9 22:59:38 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue May  9 23:00:22 2006
Subject: [mod_python] syntax errors
Message-ID: <1147229978.29590@dscpl.user.openhosting.com>

Your response returned back to mailing list with additional comment.
Please keep further followups on the mailing list.

David Bear wrote ..
> On Tue, May 09, 2006 at 10:32:59PM -0400, Graham Dumpleton wrote:
> > David Bear wrote ..
> > > indicated that indentation shouldn't be a problem -- and indentation
> > > is consistent. I'm just not seeing the error.
> > > 
> > > There must be something really simple that I'm missing. Any
> > > suggestions?
> > 
> > Replace your four space indent with tabs. PSP is fussy.
> > 
> 
> that wasn't part of the onlamp article;0) Thank you for a quick
> response... now I just need to get emacs to insert tabs when editing
> psp files and stay with spaces on py files;-)

Sorry, it doesn't literally need to be a TAB, it can be 8 spaces as well.

> > Alternatively, read the following:
> > 
> >  http://www.modpython.org/pipermail/mod_python/2005-May/018102.html
> 
> Thanks for the tip.
> 
> > 
> > as to how to include indent hints so you can use four spaces instead.
> > 
> > Graham
> 
> -- 
> David Bear
> phone: 	480-965-8257
> fax: 	480-965-9189
> College of Public Programs/ASU
> Wilson Hall 232
> Tempe, AZ 85287-0803
>  "Beware the IP portfolio, everyone will be suspect of trespassing"
From jpg at jgassociates.ca  Wed May 10 00:02:34 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Tue May  9 23:59:06 2006
Subject: [mod_python] syntax errors
In-Reply-To: <20060510021824.GJ18174@asu.edu>
References: <20060510021824.GJ18174@asu.edu>
Message-ID: <446165DA.3020803@jgassociates.ca>

David Bear wrote:
> I'm using psp handler like this:
> 
> <Directory "/www/htdocs/psp">
>  AddHandler mod_python .psp
>  PythonHandler mod_python.psp
>  PythonDebug On
> </Directory>
> 
> my html.psp file contains a simple exercise from onlamp demonstrating
> psp and looks like this:
> 
> 
> <html>
>  <head>
>    <title>A psp test </title>
>  </head>
>  <body>
> <% 
> if form.has_key('name'):
>    greet = 'Hellow %s ' % form.['name'].capitalize()

     greet = 'Hellow %s ' % form.['name'].capitalize()

                                 ^

SyntaxError: invalid syntax


Pretty much what the traceback tells ya. Try this:

    greet = 'Hellow %s ' % form['name'].capitalize()

Jim


From jpg at jgassociates.ca  Wed May 10 00:30:08 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Wed May 10 00:26:32 2006
Subject: [mod_python] PSP Error & apache.import_module() questions
In-Reply-To: <20060509211742.GL11383@g35-140.icann.org>
References: <20060509185237.GI11383@g35-140.icann.org>	<44610220.6020503@jgassociates.ca>
	<20060509211742.GL11383@g35-140.icann.org>
Message-ID: <44616C50.8090702@jgassociates.ca>

Peter Sanchez wrote:
> On Tue, May 09, 2006 at 04:57:04PM -0400, Jim Gallacher wrote:
>> Peter Sanchez wrote:
>>> Hey all...                                                                 
>>>                                                                                                               
>>> I have been getting these errors more and more. I am sure they are         
>>> related to my template files, but not sure what the error really means.    
>>> Here it is (trimmed):                                                      
>>>                                                                                                               
>>> <snip to the meat>                                                         
>>>                                                                                                               
>>> PythonHandler mod_python.publisher:   File                                 
>>> "/usr/local/lib/python2.4/site-packages/mod_python/psp.py", line 213, in   
>>> run\n    exec code in global_scope                                         
>>> PythonHandler mod_python.publisher:   File                                 
>>> "/home/ahcabron/data/templates/view_img.tmpl", line 160, in ?\n    %>      
>>>                                                                                                               
>>> </snip>                                                                    
>>>                                                                                                               
>>> Now, line 160 in view_img.tmpl is literally "%>\n" and that's it.          
>>>                                                                                                               
>>> I am using mod_python.publisher, and mod_python.psp as my template         
>>> engine. Can anyone help me out with this error msg and what it means?      
>>> The next line in the traceback can be from any one of my templates, at     
>>> various other line numbers. It isn't just in view_img.tmpl, it can be in   
>>> any of my templates and always at a line where "%>\n" is all there is.     
>>>                                                                                                               
>>> Here is my environment info:                                               
>>>                                                                                                               
>>> Apache/2.0.54 (FreeBSD) PHP/4.4.0 mod_python/3.2.7 Python/2.4.1            
>> Uhm, I think maybe you cut into the bone when trimming. You know, the 
>> bit that says:
>>
>> InquisitionError: warning, wasn't expecting the Spanish Inquisition
>>
>> Or whatever. Otherwise we'd just be guessing. At this point all I can 
>> say is that there is problem somewhere before line 160 in your template. :)
> 
> Heh, sorry. Here is the entire error. It didn't seem like the other
> lines from the traceback were very useful. Here you go :)
> 

> 
> [Tue May 09 14:06:08 2006] [error] [client 144.13.215.104] PythonHandler
> mod_python.publisher: IOError: Write failed, client closed connection.,

The IOError is telling you that the client has closed the connection 
before mod_python can finish writing. In other words, the browser has 
timed out or the user has hit stop button. That would seem consistent 
with the fact that it is happening in different templates.

Jim


From petersanchez at gmail.com  Wed May 10 00:56:22 2006
From: petersanchez at gmail.com (Peter Sanchez)
Date: Wed May 10 00:56:29 2006
Subject: [mod_python] PSP Error & apache.import_module() questions
In-Reply-To: <44616C50.8090702@jgassociates.ca>
References: <20060509185237.GI11383@g35-140.icann.org>	<44610220.6020503@jgassociates.ca>
	<20060509211742.GL11383@g35-140.icann.org>
	<44616C50.8090702@jgassociates.ca>
Message-ID: <DBAA21B5-A94C-4D21-9427-E778DECF20B0@gmail.com>


On May 9, 2006, at 9:30 PM, Jim Gallacher wrote:

> Peter Sanchez wrote:
>> On Tue, May 09, 2006 at 04:57:04PM -0400, Jim Gallacher wrote:
>>> Peter Sanchez wrote:
>>>> Hey  
>>>> all...                                                              
>>>>                                                                     
>>>>                                                I have been  
>>>> getting these errors more and more. I am sure they are          
>>>> related to my template files, but not sure what the error really  
>>>> means.    Here it is  
>>>> (trimmed):                                                          
>>>>                                                                     
>>>>                                         <snip to the  
>>>> meat>                                                               
>>>>                                                                     
>>>>                                       PythonHandler  
>>>> mod_python.publisher:   File                                 "/ 
>>>> usr/local/lib/python2.4/site-packages/mod_python/psp.py", line  
>>>> 213, in   run\n    exec code in  
>>>> global_scope                                          
>>>> PythonHandler mod_python.publisher:    
>>>> File                                 "/home/ahcabron/data/ 
>>>> templates/view_img.tmpl", line 160, in ?\n    % 
>>>> >                                                                   
>>>>                                                   </ 
>>>> snip>                                                               
>>>>                                                                     
>>>>                                                  Now, line 160  
>>>> in view_img.tmpl is literally "%>\n" and that's  
>>>> it.                                                                 
>>>>                                                         I am  
>>>> using mod_python.publisher, and mod_python.psp as my  
>>>> template         engine. Can anyone help me out with this error  
>>>> msg and what it means?      The next line in the traceback can  
>>>> be from any one of my templates, at     various other line  
>>>> numbers. It isn't just in view_img.tmpl, it can be in   any of  
>>>> my templates and always at a line where "%>\n" is all there  
>>>> is.                                                                 
>>>>                                                    Here is my  
>>>> environment  
>>>> info:                                                               
>>>>                                                                     
>>>>                             Apache/2.0.54 (FreeBSD) PHP/4.4.0  
>>>> mod_python/3.2.7 Python/2.4.1
>>> Uhm, I think maybe you cut into the bone when trimming. You know,  
>>> the bit that says:
>>>
>>> InquisitionError: warning, wasn't expecting the Spanish Inquisition
>>>
>>> Or whatever. Otherwise we'd just be guessing. At this point all I  
>>> can say is that there is problem somewhere before line 160 in  
>>> your template. :)
>> Heh, sorry. Here is the entire error. It didn't seem like the other
>> lines from the traceback were very useful. Here you go :)
>
>> [Tue May 09 14:06:08 2006] [error] [client 144.13.215.104]  
>> PythonHandler
>> mod_python.publisher: IOError: Write failed, client closed  
>> connection.,
>
> The IOError is telling you that the client has closed the  
> connection before mod_python can finish writing. In other words,  
> the browser has timed out or the user has hit stop button. That  
> would seem consistent with the fact that it is happening in  
> different templates.

I actually figured that was the error, but it seems to be happening  
more and more, so I was thinking it may be caused by something else.  
The server has been under a load lately and is in desperate need of  
an upgrade, which is supposed to happen this weekend. I will see if  
that has any benefit.

Thanks!

Peter

>
> Jim
>
>

From petersanchez at gmail.com  Wed May 10 00:59:09 2006
From: petersanchez at gmail.com (Peter Sanchez)
Date: Wed May 10 00:59:17 2006
Subject: [mod_python] PSP Error & apache.import_module() questions
In-Reply-To: <1147229218.22779@dscpl.user.openhosting.com>
References: <1147229218.22779@dscpl.user.openhosting.com>
Message-ID: <0D14E797-5BA5-4A5B-95E5-AB78A5B839A4@gmail.com>


On May 9, 2006, at 7:46 PM, Graham Dumpleton wrote:

> Peter Sanchez wrote ..
>> Also, I have a question on the apache.import_module() function.  
>> Should
>> this be done in *all* modules that are subsequently imported. IE
>>
>> index.py imports myconfig.py
>> myconfig.py in turn imports sys, os and re
>>
>> Should myconfig.py be using apache.import_module() as well?
>>
>> Is there an option to do the equivilent of 'from module import *',  
>> etc?
>
> Standard Python modules should always be included with "import" and  
> NOT
> with "apache.import_module()".

When should apache.import_module() be used? I am using "import" for  
mod_python, standard python and custom modules.

>
> Also, a general rule is that you should not import the same module  
> using
> both "import" and "apache.import_module()" from different places.  
> If you
> break this rule, you can end up with modules being wrongly reloaded
> which can cause problems. See:
>
>   http://www.dscpl.com.au/articles/modpython-003.html#redundant- 
> module-loading
>
> You may want to read that whole article, as it describes various other
> module importing issues when using mod_python.

Thanks, I will read the entire article.

Peter

>
> Graham

From smilelover at centrum.cz  Wed May 10 05:04:15 2006
From: smilelover at centrum.cz (.: smilelover :.)
Date: Wed May 10 05:05:24 2006
Subject: [mod_python] mod_python and module importing
Message-ID: <200605101104.31125@centrum.cz>

Hi guys,
I have a simple python web running on mod_python, but I have serious troubles with importing my own modules located in the project directory.

I have index.py and a directory called "lib", which contains a file called MyWebTools.py.
I have added the path to sys.path via:

PythonPath "sys.path+[os.getcwd()+'/lib']"

in .htaccess.

But when I use "import MyWebTools", I get an error message saying no such module exists a and it is the same when I place MyWebTools.py directly into the project dir.

The most weird I experienced is, that sometimes it works, somwtimes not. And sometimes it works partialy - the module is imported, but Python says that instances of a class contained in MyWebTools do not have certain attributes (even though they DO have them and when I declare the class in index.py, everything works fine).
But most of the time it says the module is not there.

So how can I safely import a module?

From grahamd at dscpl.com.au  Wed May 10 07:02:43 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed May 10 07:03:15 2006
Subject: [mod_python] mod_python and module importing
In-Reply-To: <200605101104.31125@centrum.cz>
References: <200605101104.31125@centrum.cz>
Message-ID: <961ADE65-7D57-477B-88C8-AAA07946E0D9@dscpl.com.au>


On 10/05/2006, at 7:04 PM, .: smilelover :. wrote:

> Hi guys,
> I have a simple python web running on mod_python, but I have  
> serious troubles with importing my own modules located in the  
> project directory.
>
> I have index.py and a directory called "lib", which contains a file  
> called MyWebTools.py.
> I have added the path to sys.path via:
>
> PythonPath "sys.path+[os.getcwd()+'/lib']"
>
> in .htaccess.
>
> But when I use "import MyWebTools", I get an error message saying  
> no such module exists a and it is the same when I place  
> MyWebTools.py directly into the project dir.
>
> The most weird I experienced is, that sometimes it works, somwtimes  
> not. And sometimes it works partialy - the module is imported, but  
> Python says that instances of a class contained in MyWebTools do  
> not have certain attributes (even though they DO have them and when  
> I declare the class in index.py, everything works fine).
> But most of the time it says the module is not there.
>
> So how can I safely import a module?

You can't say 'os.getcwd()' as there is no guarantees about what the
current working directory will be. Most Apache installations it will
actually return '/'.

Thus, you need to explicitly specify the full pathname to the directory
where MyWebTools resides.

Also note that MyWebTools must be a unique module name. If some
other web application on the server virtual host has a similar module,
you might pick that up by mistake. This may account for why you are
finding a version but not what you expected.

Graham
From grahamd at dscpl.com.au  Wed May 10 07:07:21 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed May 10 07:08:28 2006
Subject: [mod_python] PSP Error & apache.import_module() questions
In-Reply-To: <0D14E797-5BA5-4A5B-95E5-AB78A5B839A4@gmail.com>
References: <1147229218.22779@dscpl.user.openhosting.com>
	<0D14E797-5BA5-4A5B-95E5-AB78A5B839A4@gmail.com>
Message-ID: <645EE738-34E4-41E2-B0CF-3D7D7E4948BF@dscpl.com.au>


On 10/05/2006, at 2:59 PM, Peter Sanchez wrote:

>
> On May 9, 2006, at 7:46 PM, Graham Dumpleton wrote:
>
>> Peter Sanchez wrote ..
>>> Also, I have a question on the apache.import_module() function.  
>>> Should
>>> this be done in *all* modules that are subsequently imported. IE
>>>
>>> index.py imports myconfig.py
>>> myconfig.py in turn imports sys, os and re
>>>
>>> Should myconfig.py be using apache.import_module() as well?
>>>
>>> Is there an option to do the equivilent of 'from module import  
>>> *', etc?
>>
>> Standard Python modules should always be included with "import"  
>> and NOT
>> with "apache.import_module()".
>
> When should apache.import_module() be used? I am using "import" for  
> mod_python, standard python and custom modules.

Unfortunately that doesn't have a simple answer right now because of the
various issues with the module importer.

Generally, it would be used to import other modules in your document  
tree,
or modules in some separate directory which is not listed in sys.path.

In respect of importing modules from the document tree, there are issues
though if that other module is directly imported by mod_python.publisher
and you are using mod_python 3.2.X. There are comments in that article
about this issue.

Graham
From grahamd at dscpl.com.au  Wed May 10 07:39:04 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed May 10 07:39:34 2006
Subject: [mod_python] Graham's New Importer
In-Reply-To: <1147229823.28296@dscpl.user.openhosting.com>
References: <1147229823.28296@dscpl.user.openhosting.com>
Message-ID: <41362E48-242C-4B01-86BD-245699781BDB@dscpl.com.au>


On 10/05/2006, at 12:57 PM, Graham Dumpleton wrote:

> Dan Eloff wrote ..
>> I think probably just:
>>
>> PythonOption importer.path "C:\Documents And Settings\..."  
>> "another path"
>>
>> I'm not sure the syntax allows for that, but something along those
>> lines is the idea. None of those paths should be on sys.path.
>>
>> You shouldn't be able to specify this more than once for each python
>> interpreter. I don't know how to enforce that, but it would prevent
>> any wierdness with the same module being imported under different
>> circumstances in the same interpreter.
>
> The only way you could enforce that it only be set once is to have it
> take two arguments, one being the interpreter name and the other the
> path, and only honour the option when it is set in the global Apache
> configuration. That is, read from:
>
>   apache.main_server.get_options()
>
> This is restrictive though, as makes it impossible to set it in a  
> local
> .htaccess file.

Now, FWIW, you can actually do sort of what you want now. It uses an  
aspect of
the module importer though for which how the interfaces will  
eventually be made
publically usable isn't finalised. That said, what you should be able  
to do is
put the following at the start of a module.

   from mod_python import apache
   __info__.path.extend(eval(apache.main_server.get_options().get 
('my_import_path','[]')))

The path you want to search has to be in global part of Apache  
configuration.
Its form should be like PythonPath, ie., Python list, but shouldn't  
reference
sys.path. Thus, just a list of directories.

   PythonOption my_import_path "['C:/Documents And Settings/...','C:/ 
Some/Other/Path']"

The '__info__.path' is a special attribute of data kept in module by  
the importer
and acts as an embedded search path for modules. Once you have set that
from code above run at global scope within module, it is possible to  
use "import"
or "apache.import_module()" after that point and the directories you  
added will
be searched for the module you want.

Now although it is the intention that this hook for a search path be  
able to be
used, a final name and means of accessing it haven't been worked out.
It would have been nice to be able to use "__path__" instead of  
"__info__.path",
but "__path__" is special to Python and stuffs up normal imports if  
specified in
non package contexts.

Overall, I have been thinking whether the following naming changes  
should be
made:

   __info__ --> __mp__

   __clone__ --> __mp_clone__
   __purge__ --> __mp_purge__

Ie., use "mp" designator to make it clear that this is mod_python stuff.

At the same time, could add:

   __mp_path__ == __mp__.path

Ie., "__mp_path__" would be an alias for "__mp__.path". You would  
need to
make sure though that you always appended, inserted or extended the path
through the alias as assignment would break the association and import
code would only look at "__mp__.path".

By a module explicitly adding items to the embedded search path, it  
would be
more predictable perhaps than blindly always using what the option  
may be set
to, as by adding the code in you are making a conscious decision that  
you want
it to work that way. You need not even use an option to obtain what  
the path
should be set to, you could also use hard coded paths, or a path  
determined by
taking a relative path and adding it to the dirname of the __file__  
attribute of the
module.

If you understand the feature above I am describing, will be  
interested in your
comments as to usability and also as to what naming conventions  
should be
used. It is because I hadn't worked out naming that I hadn't  
mentioned this
feature before.

Graham

From dan.eloff at gmail.com  Wed May 10 12:18:09 2006
From: dan.eloff at gmail.com (Dan Eloff)
Date: Wed May 10 12:18:35 2006
Subject: [mod_python] Graham's New Importer
In-Reply-To: <41362E48-242C-4B01-86BD-245699781BDB@dscpl.com.au>
References: <1147229823.28296@dscpl.user.openhosting.com>
	<41362E48-242C-4B01-86BD-245699781BDB@dscpl.com.au>
Message-ID: <4817b6fc0605100918t22337169x3f00fe4fcbdcb725@mail.gmail.com>

>Perhaps you can explain the sys.path bit in some more detail.

Modifying sys.path is not a good idea, but what I wanted to accomplish
is to make sure that when your module importer falls back to python's
import, the modules are not suddenly unable to be found. It is
possible that that is completely unnecessary, I don't know under what
circumstances you fall back to python's import. As long as it stays
consistent regardless of PythonAutoReload or PythonDebug or
PythonOptimize for a given module then it works perfectly.

>    from mod_python import apache
>    __info__.path.extend(eval(apache.main_server.get_options().get
> ('my_import_path','[]')))
>

I like that, but I agree __info__.path is not ideal.

> Overall, I have been thinking whether the following naming changes
> should be
> made:
>
>    __info__ --> __mp__
>
>    __clone__ --> __mp_clone__
>    __purge__ --> __mp_purge__
>
> Ie., use "mp" designator to make it clear that this is mod_python stuff.

Yes, perfect, do that.

> At the same time, could add:
>
>    __mp_path__ == __mp__.path

I don't really see __mp_path__ and an improvement over __mp__.path,
and if you go with the latter you don't have to fiddle with alias or
worry about assignment. I'll leave the call to you though, I'm sure
whatever you decide will be fine.

> By a module explicitly adding items to the embedded search path, it
> would be
> more predictable perhaps than blindly always using what the option
> may be set
> to, as by adding the code in you are making a conscious decision that
> you want
> it to work that way. You need not even use an option to obtain what
> the path
> should be set to, you could also use hard coded paths, or a path
> determined by
> taking a relative path and adding it to the dirname of the __file__
> attribute of the
> module.

Not ideal for me, since I would simply add this to the top of every
single python file. But I can live with that because it does solve all
the issues related to a global setting. All in all a pretty good
solution.

> If you understand the feature above I am describing, will be
> interested in your
> comments as to usability and also as to what naming conventions
> should be
> used. It is because I hadn't worked out naming that I hadn't
> mentioned this
> feature before.

When you make the changes let me know and I'll update from the cvs and
give it a try. I suspect it is a good balance between power and
flexibility.

-Dan

From grahamd at dscpl.com.au  Wed May 10 19:31:00 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed May 10 19:31:06 2006
Subject: [mod_python] Graham's New Importer
Message-ID: <1147303860.25016@dscpl.user.openhosting.com>

Dan Eloff wrote ..
> >    from mod_python import apache
> >    __info__.path.extend(eval(apache.main_server.get_options().get
> > ('my_import_path','[]')))
> >
> 
> I like that, but I agree __info__.path is not ideal.
>
> ...
> 
> > By a module explicitly adding items to the embedded search path, it
> > would be
> > more predictable perhaps than blindly always using what the option
> > may be set
> > to, as by adding the code in you are making a conscious decision that
> > you want
> > it to work that way. You need not even use an option to obtain what
> > the path
> > should be set to, you could also use hard coded paths, or a path
> > determined by
> > taking a relative path and adding it to the dirname of the __file__
> > attribute of the
> > module.
> 
> Not ideal for me, since I would simply add this to the top of every
> single python file. But I can live with that because it does solve all
> the issues related to a global setting. All in all a pretty good
> solution.

Depending on how your modules are structured, it may not be quite
as bad as having to add it to every file. At least not the look up of
what path to use.

This is because what you may be able to do is use the fact that if
you supply an absolute or relative path to apache.import_module(),
that the "path" argument, rather than being a search path, becomes
the path which is encoded into the module as '__info__.path'.

Thus, if a top level entry point module were used, much like a
package root, and although there were various sub modules that
any methods were exposed through the top level module, you
could do something like:

    # toplevel.py

    from mod_python import apache
    __info__.path.extend(eval(apache.main_server.get_options().get('my_import_path','[]')))

    submodule_1 = apache.import_module('./submodule_1.py', path=__info__.path)
    submodule_2 = apache.import_module('./subdir_2/toplevel.py', path=__info__.path)

Thus, those submodules now don't need to set '__info__.path', as they
will inherit that from the top level module.

This may turn out to be messy or not useful as is as well. Overall, I
guess what we need to come up with is some example use cases where
search paths are required and perhaps work from that as to what is
a good interface for supporting it. At the moment, my impression is
that the common use case is in order to access some configuration
module in a central location. Can you describe again your use case?

One other issue that may come into play in this is that besides being
able to access 'apache.main_server.get_options()', that is, the main
server options, there is no way at global scope within a module to
access the options related to the request, or virtual host that the
module is being imported into.

There was a similar issue in respect of the mod_python config settings
for PythonDebug and PythonAutoReload when it came to the importer
itself. To get around this the importer uses new top level dispatch
functions to cache the appropriate configuration available so it is
available no matter where apache.import_module() is used. At the
moment this cached config isn't accessible through the 'apache' module
but is available as 'mod_python.importer.get_config()'.

If a module import is occurring do to PythonImport and you call that
function, you will get the 'apache.main_server.get_config()' object. If
the module import is occurring within the context of a request, the
function will return 'req.get_config()'. Thus the 'apache.import_module()'
function uses this to get the PythonDebug and PythonAutoReload
settings so that they don't have to be explicitly passed to the function
itself, thus avoiding some of the problems described in my issues list.

I guess the question in respect of user options, is whether there should
be some means getting the appropriate options object from global
scope in a module. Thus, something like:

    from mod_python import apache
    __info__.path.extend(eval(apache.get_options().get('my_import_path','[]')))

Where like with the config, if it is PythonImport, it returns the main
server options and if in context of a request, the request options.

The only problem with this is that you get back to unpredictable
behaviour if a module might be imported from different places where
the option set is different. That option set which is used first takes
precedence.

The issue is whether we want to protect people from doing stupid
things by not allowing it, or give them a loaded gun and let them
kill themselves if they want to. :-)

Note, in Vampire, it actually for the time that a module is being
imported exposes a variable '__req__' as global data within the module
so that either the config, options or anything else for that matter about
the request can be accessed. When I modified the Vampire importer for
use in mod_python though, I didn't carry across that feature as was
unsure about how wise it was providing it.

Sorry, I know this should be on the developer list. Maybe we should
look at bumping it over there. Dan are you on the developer list?

Graham

From smilelover at centrum.cz  Thu May 11 04:15:59 2006
From: smilelover at centrum.cz (.: smilelover :.)
Date: Thu May 11 04:16:20 2006
Subject: [mod_python] Re: mod_python and module importing
In-Reply-To: <200605101104.31125@centrum.cz>
References: <200605101104.31125@centrum.cz>
Message-ID: <200605111015.17288@centrum.cz>

______________________________________________________________
> Od: smilelover@centrum.cz
> Komu:  <mod_python@modpython.org>
> CC:  
> Datum: 10.05.2006 11:04
> P?edm?t: mod_python and module importing
>
>  Hi guys,
> I have a simple python web running on mod_python, but I have serious
> troubles with importing my own modules located in the project directory.
> 
> I have index.py and a directory called "lib", which contains a file called
> MyWebTools.py.
> I have added the path to sys.path via:
> 
> PythonPath "sys.path+[os.getcwd()+'/lib']"
> 
> in .htaccess.
> 
> But when I use "import MyWebTools", I get an error message saying no such
> module exists a and it is the same when I place MyWebTools.py directly
> into the project dir.
> 
> The most weird I experienced is, that sometimes it works, somwtimes not.
> And sometimes it works partialy - the module is imported, but Python says
> that instances of a class contained in MyWebTools do not have certain
> attributes (even though they DO have them and when I declare the class in
> index.py, everything works fine).
> But most of the time it says the module is not there.
> 
> So how can I safely import a module?
> 
> 

OK, one of the problems was using os.getcwd() in PythonPath directive. It returns / and it returns / even if called directly in the script (index.py). It is not necessary to use it at all (mod_python adds the base script dir in PythonPath when index.py is called, doesn't it?).
When I added __init__.py with appropriate content to the lib dir, it worked.

Thanx for your advices, guys.
Dan

From grahamd at dscpl.com.au  Thu May 11 06:17:18 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu May 11 06:17:27 2006
Subject: [mod_python] Re: mod_python and module importing
In-Reply-To: <200605111015.17288@centrum.cz>
References: <200605101104.31125@centrum.cz> <200605111015.17288@centrum.cz>
Message-ID: <B9EA4A34-5977-4FBC-9B6C-F42970937F51@dscpl.com.au>


On 11/05/2006, at 6:15 PM, .: smilelover :. wrote:

> ______________________________________________________________
>> Od: smilelover@centrum.cz
>> Komu:  <mod_python@modpython.org>
>> CC:
>> Datum: 10.05.2006 11:04
>> P?edm?t: mod_python and module importing
>>
>>  Hi guys,
>> I have a simple python web running on mod_python, but I have serious
>> troubles with importing my own modules located in the project  
>> directory.
>>
>> I have index.py and a directory called "lib", which contains a  
>> file called
>> MyWebTools.py.
>> I have added the path to sys.path via:
>>
>> PythonPath "sys.path+[os.getcwd()+'/lib']"
>>
>> in .htaccess.
>>
>> But when I use "import MyWebTools", I get an error message saying  
>> no such
>> module exists a and it is the same when I place MyWebTools.py  
>> directly
>> into the project dir.
>>
>> The most weird I experienced is, that sometimes it works,  
>> somwtimes not.
>> And sometimes it works partialy - the module is imported, but  
>> Python says
>> that instances of a class contained in MyWebTools do not have certain
>> attributes (even though they DO have them and when I declare the  
>> class in
>> index.py, everything works fine).
>> But most of the time it says the module is not there.
>>
>> So how can I safely import a module?
>>
>>
>
> OK, one of the problems was using os.getcwd() in PythonPath  
> directive. It returns / and it returns / even if called directly in  
> the script (index.py). It is not necessary to use it at all  
> (mod_python adds the base script dir in PythonPath when index.py is  
> called, doesn't it?).
> When I added __init__.py with appropriate content to the lib dir,  
> it worked.

Add an __init__.py file into the "lib" directory doesn't make a great  
deal of sense
unless what you were actually doing was:

   from lib import MyWebTools

That is, "lib" was really acting like a package. If not, I don't see  
how it would make
any difference.

Graham
From smilelover at centrum.cz  Thu May 11 06:57:00 2006
From: smilelover at centrum.cz (.: smilelover :.)
Date: Thu May 11 06:56:25 2006
Subject: [mod_python] Re: mod_python and module importing
In-Reply-To: <B9EA4A34-5977-4FBC-9B6C-F42970937F51@dscpl.com.au>
References: 200605101104.31125@centrum.cz> <200605111015.17288@centrum.cz>
	<B9EA4A34-5977-4FBC-9B6C-F42970937F51@dscpl.com.au>
Message-ID: <200605111257.27843@centrum.cz>


______________________________________________________________
> Od: grahamd@dscpl.com.au
> Komu:  ".: smilelover :." <smilelover@centrum.cz>
> CC:  <mod_python@modpython.org>
> Datum: 11.05.2006 12:17
> P?edm?t: Re: [mod_python] Re: mod_python and module importing
>
>  
> On 11/05/2006, at 6:15 PM, .: smilelover :. wrote:
> 
> > ______________________________________________________________
> >> Od: smilelover@centrum.cz
> >> Komu:  <mod_python@modpython.org>
> >> CC:
> >> Datum: 10.05.2006 11:04
> >> P?edm?t: mod_python and module importing
> >>
> >>  Hi guys,
> >> I have a simple python web running on mod_python, but I have serious
> >> troubles with importing my own modules located in the project  >>
> directory.
> >>
> >> I have index.py and a directory called "lib", which contains a  >> file
> called
> >> MyWebTools.py.
> >> I have added the path to sys.path via:
> >>
> >> PythonPath "sys.path+[os.getcwd()+'/lib']"
> >>
> >> in .htaccess.
> >>
> >> But when I use "import MyWebTools", I get an error message saying  >>
> no such
> >> module exists a and it is the same when I place MyWebTools.py  >>
> directly
> >> into the project dir.
> >>
> >> The most weird I experienced is, that sometimes it works,  >> somwtimes
> not.
> >> And sometimes it works partialy - the module is imported, but  >>
> Python says
> >> that instances of a class contained in MyWebTools do not have certain
> >> attributes (even though they DO have them and when I declare the  >>
> class in
> >> index.py, everything works fine).
> >> But most of the time it says the module is not there.
> >>
> >> So how can I safely import a module?
> >>
> >>
> >
> > OK, one of the problems was using os.getcwd() in PythonPath  >
> directive. It returns / and it returns / even if called directly in  > the
> script (index.py). It is not necessary to use it at all  > (mod_python adds
> the base script dir in PythonPath when index.py is  > called, doesn't it?).
> > When I added __init__.py with appropriate content to the lib dir,  > it
> worked.
> 
> Add an __init__.py file into the "lib" directory doesn't make a great 
> deal of sense
> unless what you were actually doing was:
> 
>    from lib import MyWebTools
> 
> That is, "lib" was really acting like a package. If not, I don't see  how
> it would make
> any difference.
> 
> Graham</mod_python@modpython.org>

Yes, I want it to be a package and that's why I added __init__.py and use the "from ..." stuff. When I change the import command to

    import MyWebTools

it works only sometimes (when reloading the page for several times), it's strange.
I think it shouldn't work at all, because there is no standalone module called MyWebTools in the base directory and no package called MyWebTools (just the lib pack).

Dan

From calderano at sgaspa.it  Thu May 11 11:36:42 2006
From: calderano at sgaspa.it (Luca Calderano)
Date: Thu May 11 11:37:58 2006
Subject: [mod_python] mod_python.publisher and framesets
Message-ID: <009101c67510$b6457690$410100a4@sga.dom>

Can someone show me hot to use the mod_python.publisher to handle framesets ??

Thanks 
Luca

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060511/93a2547c/attachment.html
From mmokrejs at ribosome.natur.cuni.cz  Fri May 12 15:06:21 2006
From: mmokrejs at ribosome.natur.cuni.cz (=?ISO-8859-2?Q?Martin_MOKREJ=A9?=)
Date: Fri May 12 15:06:36 2006
Subject: [mod_python] How to change charset on the Content-Type line throu
	mod_python.publisher
Message-ID: <4464DCAD.90806@ribosome.natur.cuni.cz>

Hi,
  I am trying to figure out how to affect my charset other than use
AddCharset Apache directive, which works over file extensions.
I don't think it makes sense to assign say 'utf8' to .html file extension.
When the HTML code is generated through mod_python.publisher, I should
be able to do it.
  The only examples how to alter Content-Type: is to use your own
handler. No, I don't need it, thanks. I'd immediately fall into the trap
with need to use 'req.write', 'return apache.OK', etc. somewhere in my
code.


http://www.modpython.org/live/current/doc-html/pyapi-mprequest-mem.html

<QUOTE>
content_languages
    Tuple. List of strings representing the content languages. 

handler
    The name of the handler currently being processed. This is the handler
    set by mod_mime, not the mod_python handler. In most cases it will be
    ""mod_python". (Read-Only) 

content_encoding
    String. Content encoding. (Read-Only) 
</QUOTE>


  I awfully lack examples in the documentation. So, how can I make publisher
change my charset away from the site-wide defined value? Please update the
docs. I very much appreciate the effort Graham and Nicolas does to support
this email list but save yourself some time and fix the docs for yourself! ;)
Martin
From David.Bear at asu.edu  Fri May 12 17:00:41 2006
From: David.Bear at asu.edu (David Bear)
Date: Fri May 12 17:00:46 2006
Subject: [mod_python] error with test template system
Message-ID: <20060512210041.GB18097@asu.edu>

I downloaded the sample template system from
http://www.modpython.org/examples/

and placed it in a directory where publisher was set to be the .py
handler.

However, when I open the sample index.py file, modpython returns an
error that there is no module named index. I am using modpython 3.1.3
(rpm packaged by suse) and apache 2.0.53.

I know modpython is handling the request since I get a regular python
traceback when viewing the page through my web browser.

Is there something simple that I have missed?

-- 
David Bear
phone: 	480-965-8257
fax: 	480-965-9189
College of Public Programs/ASU
Wilson Hall 232
Tempe, AZ 85287-0803
 "Beware the IP portfolio, everyone will be suspect of trespassing"
From grahamd at dscpl.com.au  Fri May 12 18:19:21 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Fri May 12 18:19:34 2006
Subject: [mod_python] How to change charset on the Content-Type line throu
	mod_python.publisher
In-Reply-To: <4464DCAD.90806@ribosome.natur.cuni.cz>
References: <4464DCAD.90806@ribosome.natur.cuni.cz>
Message-ID: <8040DD07-2E4D-4F55-8B45-DDD8568B665F@dscpl.com.au>

On 13/05/2006, at 5:06 AM, Martin MOKREJ? wrote:

> Hi,
>   I am trying to figure out how to affect my charset other than use
> AddCharset Apache directive, which works over file extensions.
> I don't think it makes sense to assign say 'utf8' to .html file  
> extension.
> When the HTML code is generated through mod_python.publisher, I should
> be able to do it.
>   The only examples how to alter Content-Type: is to use your own
> handler. No, I don't need it, thanks. I'd immediately fall into the  
> trap
> with need to use 'req.write', 'return apache.OK', etc. somewhere in my
> code.
>
>
> http://www.modpython.org/live/current/doc-html/pyapi-mprequest- 
> mem.html
>
> <QUOTE>
> content_languages
>     Tuple. List of strings representing the content languages.
>
> handler
>     The name of the handler currently being processed. This is the  
> handler
>     set by mod_mime, not the mod_python handler. In most cases it  
> will be
>     ""mod_python". (Read-Only)
>
> content_encoding
>     String. Content encoding. (Read-Only)
> </QUOTE>

I believe that content_encoding is only relevant to the received  
request.
Even if settable, nothing consults it in respect of updating anything  
in a
response.

>
>   I awfully lack examples in the documentation. So, how can I make  
> publisher
> change my charset away from the site-wide defined value?

If using mod_python.publisher and returning your page content as the
return value, add "req" as one of the function input parameters and do:

   def index(req):
     req.content_type = 'text/html; charset=UTF8'
     return "<html>....</html>"

Provided you are using mod_python 3.2.8, if the publisher function  
returns
a Unicode string, then mod_python.publisher will automatically attempt
to fill out the charset in the content type header for you.

> Please update the
> docs. I very much appreciate the effort Graham and Nicolas does to  
> support
> this email list but save yourself some time and fix the docs for  
> yourself! ;)

Some updates are made, but because they in source code repository copy
of documentation, you will not see them until next major release of  
mod_python.

Also, Nicolas, Jim and I all have limited time. Our job would be made  
easier
though if users of mod_python would like to offer up the examples and  
show
where to put them in the documentation. Remember, our focus is not  
likely
to be where your focus lies and so we wouldn't even think to update a  
certain
bit of documentation unless it is pointed out to us specifically with  
examples
of what to put in it to make it better.

Any documentation changes/enhancements can be logged at:

   http://issues.apache.org/jira/browse/MODPYTHON

There is no point posting them just to the mailing list as they  
inevitably get lost.
If on JIRA, they have to be dealt with eventually.

Graham
From grahamd at dscpl.com.au  Fri May 12 19:08:05 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Fri May 12 19:08:23 2006
Subject: [mod_python] error with test template system
In-Reply-To: <20060512210041.GB18097@asu.edu>
References: <20060512210041.GB18097@asu.edu>
Message-ID: <8A68D8DA-8E75-4BA6-AF91-A05332F19066@dscpl.com.au>


On 13/05/2006, at 7:00 AM, David Bear wrote:

> I downloaded the sample template system from
> http://www.modpython.org/examples/
>
> and placed it in a directory where publisher was set to be the .py
> handler.
>
> However, when I open the sample index.py file, modpython returns an
> error that there is no module named index. I am using modpython 3.1.3
> (rpm packaged by suse) and apache 2.0.53.
>
> I know modpython is handling the request since I get a regular python
> traceback when viewing the page through my web browser.
>
> Is there something simple that I have missed?

It will help if you send the exact text of the error with at least  
the few most
inner frames in the traceback. Also send the Apache configuration  
snippet
(not whole configuration) that you have used to enable mod_python for
the example. Also indicate whether mod_python is used by anyone else
of the server and whether the PythonPath directive has been set anywhere
at all in the Apache configuration. Finally, before you tried this  
example,
did you try your own hello world example first.

I may not be around to answer this question in the short term as  
going away
for a little trip, but with this information someone else may be able  
to help.

Graham
From David.Bear at asu.edu  Fri May 12 19:44:12 2006
From: David.Bear at asu.edu (David Bear)
Date: Fri May 12 19:44:21 2006
Subject: [mod_python] error with test template system
In-Reply-To: <8A68D8DA-8E75-4BA6-AF91-A05332F19066@dscpl.com.au>
References: <20060512210041.GB18097@asu.edu>
	<8A68D8DA-8E75-4BA6-AF91-A05332F19066@dscpl.com.au>
Message-ID: <20060512234412.GA8279@asu.edu>

On Sat, May 13, 2006 at 09:08:05AM +1000, Graham Dumpleton wrote:
> 
> On 13/05/2006, at 7:00 AM, David Bear wrote:
> 
> >I downloaded the sample template system from
> >http://www.modpython.org/examples/
> >
> >and placed it in a directory where publisher was set to be the .py
> >handler.
> >
> >However, when I open the sample index.py file, modpython returns an
> >error that there is no module named index. I am using modpython 3.1.3
> >(rpm packaged by suse) and apache 2.0.53.
> >
> >I know modpython is handling the request since I get a regular python
> >traceback when viewing the page through my web browser.
> >
> >Is there something simple that I have missed?
> 
> It will help if you send the exact text of the error with at least  
> the few most
> inner frames in the traceback. Also send the Apache configuration  
> snippet
> (not whole configuration) that you have used to enable mod_python for
> the example. Also indicate whether mod_python is used by anyone else
> of the server and whether the PythonPath directive has been set anywhere
> at all in the Apache configuration. Finally, before you tried this  
> example,
> did you try your own hello world example first.

yes. I did the hello world example. It works.

here's the traceback:
=================================
Mod_python error: "PythonHandler mod_python.publisher"

Traceback (most recent call last):

  File "/usr/lib64/python2.4/site-packages/mod_python/apache.py", line
299, in HandlerDispatch
    result = object(req)

  File "/usr/lib64/python2.4/site-packages/mod_python/publisher.py",
line 98, in handler
    path=[path])

  File "/usr/lib64/python2.4/site-packages/mod_python/apache.py", line
454, in import_module
    f, p, d = imp.find_module(parts[i], path)

ImportError: No module named index
==================================

Here's the configuration directive:

<Directory "/work/servers/www/htdocs/mp">
 AddHandler python-program .py
 PythonHandler mod_python.publisher
 PythonDebug On
</Directory>






> 
> I may not be around to answer this question in the short term as  
> going away
> for a little trip, but with this information someone else may be able  
> to help.
> 
> Graham

-- 
David Bear
phone: 	480-965-8257
fax: 	480-965-9189
College of Public Programs/ASU
Wilson Hall 232
Tempe, AZ 85287-0803
 "Beware the IP portfolio, everyone will be suspect of trespassing"
From list at joreybump.com  Fri May 12 21:48:03 2006
From: list at joreybump.com (Jorey Bump)
Date: Fri May 12 21:48:09 2006
Subject: [mod_python] mod_python.publisher and framesets
In-Reply-To: <009101c67510$b6457690$410100a4@sga.dom>
References: <009101c67510$b6457690$410100a4@sga.dom>
Message-ID: <44653AD3.4000807@joreybump.com>

Luca Calderano wrote:
> Can someone show me hot to use the mod_python.publisher to handle 
> framesets ??

Contents of frames.py (using invalid HTML for simplicity):

def index():
     return """<html>
<frameset cols="25%,75%">
   <frame src="spam">
   <frame src="eggs">
</frameset>
</html>
"""

def spam():
     return """<html>
<body>
<h3>Spam</h3>
</body>
</html>
"""

def eggs():
     return """<html>
<body>
<h3>Eggs</h3>
</body>
</html>
"""

Point your browser to http://host/frames.py/ and you will see a frameset 
and its contents generated from functions in the same published module.

From mail at stefanwehr.de  Sat May 13 11:16:33 2006
From: mail at stefanwehr.de (Stefan Wehr)
Date: Sat May 13 11:25:15 2006
Subject: [mod_python] sending headers directly to the client
Message-ID: <slrne6bu2g.l0q.mail@waawaa.informatik.uni-freiburg.de>

Hi all,

I need to send headers directly to the client; that is, before
mod_python sends its headers (I know that I have to handle the status
line specially).

Background: I need to detect when the user hits the 'Cancel' button of
the browser. The only reliable way to do this seems to send something
periodically to the client. My idea is now to send dummy headers to
the client until the possibly long running HTML code generating
function is finished. Then I stop sending dummy headers and send the
HTML code to the client. If the client hits 'Cancel' while the
HTML code generating function is running, I'm able to detect this
because I get some kind of error when sending a dummy header.

The problem is now: how can I send the dummy headers?

I cannot use 'req.write' because this flushes all headers (note that
some headers can be set only *after* HTML has been generated).  My
idea was then to use 'req.connection.write'. The problem with this
approach is that this function does *not* trigger an error if the
connection is closed. I also fiddled around with the
'req.connection.aborted' field without success.

Any help would be greatly appreciated.

Cheers, Stefan

From grahamd at dscpl.com.au  Sun May 14 16:33:46 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sun May 14 16:34:18 2006
Subject: [mod_python] error with test template system
In-Reply-To: <20060512234412.GA8279@asu.edu>
References: <20060512210041.GB18097@asu.edu>
	<8A68D8DA-8E75-4BA6-AF91-A05332F19066@dscpl.com.au>
	<20060512234412.GA8279@asu.edu>
Message-ID: <7DE1AAC0-5F06-44FE-9515-269C8A3F61FF@dscpl.com.au>


On 13/05/2006, at 9:44 AM, David Bear wrote:

> On Sat, May 13, 2006 at 09:08:05AM +1000, Graham Dumpleton wrote:
>>
>> On 13/05/2006, at 7:00 AM, David Bear wrote:
>>
>>> I downloaded the sample template system from
>>> http://www.modpython.org/examples/
>>>
>>> and placed it in a directory where publisher was set to be the .py
>>> handler.
>>>
>>> However, when I open the sample index.py file, modpython returns an
>>> error that there is no module named index. I am using modpython  
>>> 3.1.3
>>> (rpm packaged by suse) and apache 2.0.53.
>>>
>>> I know modpython is handling the request since I get a regular  
>>> python
>>> traceback when viewing the page through my web browser.
>>>
>>> Is there something simple that I have missed?
>>
>> It will help if you send the exact text of the error with at least
>> the few most
>> inner frames in the traceback. Also send the Apache configuration
>> snippet
>> (not whole configuration) that you have used to enable mod_python for
>> the example. Also indicate whether mod_python is used by anyone else
>> of the server and whether the PythonPath directive has been set  
>> anywhere
>> at all in the Apache configuration. Finally, before you tried this
>> example,
>> did you try your own hello world example first.
>
> yes. I did the hello world example. It works.
>
> here's the traceback:
> =================================
> Mod_python error: "PythonHandler mod_python.publisher"
>
> Traceback (most recent call last):
>
>   File "/usr/lib64/python2.4/site-packages/mod_python/apache.py", line
> 299, in HandlerDispatch
>     result = object(req)
>
>   File "/usr/lib64/python2.4/site-packages/mod_python/publisher.py",
> line 98, in handler
>     path=[path])
>
>   File "/usr/lib64/python2.4/site-packages/mod_python/apache.py", line
> 454, in import_module
>     f, p, d = imp.find_module(parts[i], path)
>
> ImportError: No module named index
> ==================================
>
> Here's the configuration directive:
>
> <Directory "/work/servers/www/htdocs/mp">
>  AddHandler python-program .py
>  PythonHandler mod_python.publisher
>  PythonDebug On
> </Directory>

Are the files in the directory readable by others? The Apache server  
generally
runs as a special user, if that user doesn't have read access to the  
directories
and files, it will not be able to find the files.

Also, do you have an appropriate Alias directive to map URL namespace to
that actual directory, or does that directory lie under the document  
root?
What is the actual URL you are using?

Graham
From grahamd at dscpl.com.au  Sun May 14 21:56:03 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sun May 14 21:56:07 2006
Subject: [mod_python] sending headers directly to the client
Message-ID: <1147658163.16335@dscpl.user.openhosting.com>

What you are wanting to do, detect client connection being closed
and aborting content generation, is generally seen as being bad
practice. Even if there were some way of doing it in the way you
are contemplating, you could run into problems with intermediate
proxies or firewalls stopping your scheme working because of
header buffering or other issues. You could also run into problems
with too much headers causing a client or intermediary to exceed
some size limit and simply aborting the whole request.

Why do you think what you want to do is a good idea? What
problem do you think you are trying to solve?

Graham

Stefan Wehr wrote ..
> Hi all,
> 
> I need to send headers directly to the client; that is, before
> mod_python sends its headers (I know that I have to handle the status
> line specially).
> 
> Background: I need to detect when the user hits the 'Cancel' button of
> the browser. The only reliable way to do this seems to send something
> periodically to the client. My idea is now to send dummy headers to
> the client until the possibly long running HTML code generating
> function is finished. Then I stop sending dummy headers and send the
> HTML code to the client. If the client hits 'Cancel' while the
> HTML code generating function is running, I'm able to detect this
> because I get some kind of error when sending a dummy header.
> 
> The problem is now: how can I send the dummy headers?
> 
> I cannot use 'req.write' because this flushes all headers (note that
> some headers can be set only *after* HTML has been generated).  My
> idea was then to use 'req.connection.write'. The problem with this
> approach is that this function does *not* trigger an error if the
> connection is closed. I also fiddled around with the
> 'req.connection.aborted' field without success.
> 
> Any help would be greatly appreciated.
> 
> Cheers, Stefan
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
From nlv11281 at natlab.research.philips.com  Mon May 15 02:00:41 2006
From: nlv11281 at natlab.research.philips.com (Mike Looijmans)
Date: Mon May 15 02:01:13 2006
Subject: [mod_python] sending headers directly to the client
In-Reply-To: <slrne6bu2g.l0q.mail@waawaa.informatik.uni-freiburg.de>
References: <slrne6bu2g.l0q.mail@waawaa.informatik.uni-freiburg.de>
Message-ID: <44681909.9010706@natlab.research.philips.com>

First explain what is so special about your request that you cannot just 
send out regular data and have to delay sending the response headers?

Awaiting your reply - could a simple (periodic) redirect solve your problem?


Mike Looijmans
Philips Natlab / Topic Automation


Stefan Wehr wrote:
> Hi all,
> 
> I need to send headers directly to the client; that is, before
> mod_python sends its headers (I know that I have to handle the status
> line specially).
> 
> Background: I need to detect when the user hits the 'Cancel' button of
> the browser. The only reliable way to do this seems to send something
> periodically to the client. My idea is now to send dummy headers to
> the client until the possibly long running HTML code generating
> function is finished. Then I stop sending dummy headers and send the
> HTML code to the client. If the client hits 'Cancel' while the
> HTML code generating function is running, I'm able to detect this
> because I get some kind of error when sending a dummy header.
> 
> The problem is now: how can I send the dummy headers?
> 
> I cannot use 'req.write' because this flushes all headers (note that
> some headers can be set only *after* HTML has been generated).  My
> idea was then to use 'req.connection.write'. The problem with this
> approach is that this function does *not* trigger an error if the
> connection is closed. I also fiddled around with the
> 'req.connection.aborted' field without success.
> 
> Any help would be greatly appreciated.
> 
> Cheers, Stefan
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 

From mail at stefanwehr.de  Mon May 15 02:27:13 2006
From: mail at stefanwehr.de (Stefan Wehr)
Date: Mon May 15 02:27:39 2006
Subject: [mod_python] Re: sending headers directly to the client
References: <slrne6bu2g.l0q.mail@waawaa.informatik.uni-freiburg.de>
	<44681909.9010706@natlab.research.philips.com>
Message-ID: <slrne6g7q0.rb1.mail@waawaa.informatik.uni-freiburg.de>

Hi!

Mike Looijmans <nlv11281@natlab.research.philips.com> wrote::

> First explain what is so special about your request that you cannot just 
> send out regular data and have to delay sending the response headers?

Answering some of our requests can take up to 30 seconds. We often
have the problem that users are getting nervous, hit the 'Cancel'
button of their browser, and reload the page. Now our system tries to
answer two requests, which can lead to strange results: The database
transaction started by the first request wins over the database
transaction started by the second request, although the user
explicitly stopped the first request.

> Awaiting your reply - could a simple (periodic) redirect solve your problem?

How what such a redirect work?

Stefan

From nlv11281 at natlab.research.philips.com  Mon May 15 02:46:50 2006
From: nlv11281 at natlab.research.philips.com (Mike Looijmans)
Date: Mon May 15 02:46:54 2006
Subject: [mod_python] Re: sending headers directly to the client
In-Reply-To: <slrne6g7q0.rb1.mail@waawaa.informatik.uni-freiburg.de>
References: <slrne6bu2g.l0q.mail@waawaa.informatik.uni-freiburg.de>	<44681909.9010706@natlab.research.philips.com>
	<slrne6g7q0.rb1.mail@waawaa.informatik.uni-freiburg.de>
Message-ID: <446823DA.7040109@natlab.research.philips.com>

When the user submits the request, immediately return a page that says 
something like "processing your request, please wait...".

The simplest thing to do is to just output that on the result page, and 
flush() the request output. Then do as you normally do.

The "please wait" could be removed with javascript or so.

Another option is to first return a "please wait" HTML page. This page 
has a redirect header, that loads the actual result page. The user gets 
to see the redirecting page until the result page is done.



Mike Looijmans
Philips Natlab / Topic Automation


Stefan Wehr wrote:
> Hi!
> 
> Mike Looijmans <nlv11281@natlab.research.philips.com> wrote::
> 
> 
>>First explain what is so special about your request that you cannot just 
>>send out regular data and have to delay sending the response headers?
> 
> 
> Answering some of our requests can take up to 30 seconds. We often
> have the problem that users are getting nervous, hit the 'Cancel'
> button of their browser, and reload the page. Now our system tries to
> answer two requests, which can lead to strange results: The database
> transaction started by the first request wins over the database
> transaction started by the second request, although the user
> explicitly stopped the first request.
> 
> 
>>Awaiting your reply - could a simple (periodic) redirect solve your problem?
> 
> 
> How what such a redirect work?
> 
> Stefan
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 

From grahamd at dscpl.com.au  Mon May 15 05:31:22 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon May 15 05:31:32 2006
Subject: [mod_python] Re: sending headers directly to the client
In-Reply-To: <446823DA.7040109@natlab.research.philips.com>
References: <slrne6bu2g.l0q.mail@waawaa.informatik.uni-freiburg.de>	<44681909.9010706@natlab.research.philips.com>
	<slrne6g7q0.rb1.mail@waawaa.informatik.uni-freiburg.de>
	<446823DA.7040109@natlab.research.philips.com>
Message-ID: <53B1D390-686E-4216-BA64-4AFAAD6C3A7D@dscpl.com.au>


On 15/05/2006, at 4:46 PM, Mike Looijmans wrote:

> When the user submits the request, immediately return a page that  
> says something like "processing your request, please wait...".
>
> The simplest thing to do is to just output that on the result page,  
> and flush() the request output. Then do as you normally do.
>
> The "please wait" could be removed with javascript or so.
>
> Another option is to first return a "please wait" HTML page. This  
> page has a redirect header, that loads the actual result page. The  
> user gets to see the redirecting page until the result page is done.

Noting though that you may need a caching system for the result of  
database
query which is accessible from multiple processes. This is because if  
Apache
prefork MPM being used, or even worker with multiple processes, the
subsequent request to get the results of the query will not  
necessarily end
up at the same Apache child process. Thus, you can't rely on caching  
within
an Apache child process.

Graham

>
> Mike Looijmans
> Philips Natlab / Topic Automation
>
>
> Stefan Wehr wrote:
>> Hi!
>> Mike Looijmans <nlv11281@natlab.research.philips.com> wrote::
>>> First explain what is so special about your request that you  
>>> cannot just send out regular data and have to delay sending the  
>>> response headers?
>> Answering some of our requests can take up to 30 seconds. We often
>> have the problem that users are getting nervous, hit the 'Cancel'
>> button of their browser, and reload the page. Now our system tries to
>> answer two requests, which can lead to strange results: The database
>> transaction started by the first request wins over the database
>> transaction started by the second request, although the user
>> explicitly stopped the first request.
>>> Awaiting your reply - could a simple (periodic) redirect solve  
>>> your problem?
>> How what such a redirect work?
>> Stefan
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From nlv11281 at natlab.research.philips.com  Mon May 15 07:50:23 2006
From: nlv11281 at natlab.research.philips.com (Mike Looijmans)
Date: Mon May 15 07:52:50 2006
Subject: [mod_python] Re: sending headers directly to the client
In-Reply-To: <53B1D390-686E-4216-BA64-4AFAAD6C3A7D@dscpl.com.au>
References: <slrne6bu2g.l0q.mail@waawaa.informatik.uni-freiburg.de>	<44681909.9010706@natlab.research.philips.com>
	<slrne6g7q0.rb1.mail@waawaa.informatik.uni-freiburg.de>
	<446823DA.7040109@natlab.research.philips.com>
	<53B1D390-686E-4216-BA64-4AFAAD6C3A7D@dscpl.com.au>
Message-ID: <44686AFF.2010206@natlab.research.philips.com>

>> When the user submits the request, immediately return a page that  
>> says something like "processing your request, please wait...".
>>
>> The simplest thing to do is to just output that on the result page,  
>> and flush() the request output. Then do as you normally do.
>>
>> The "please wait" could be removed with javascript or so.
>>
>> Another option is to first return a "please wait" HTML page. This  
>> page has a redirect header, that loads the actual result page. The  
>> user gets to see the redirecting page until the result page is done.
> 
> 
> Noting though that you may need a caching system for the result of  
> database
> query which is accessible from multiple processes. This is because if  
> Apache
> prefork MPM being used, or even worker with multiple processes, the
> subsequent request to get the results of the query will not  necessarily 
> end
> up at the same Apache child process. Thus, you can't rely on caching  
> within
> an Apache child process.

One way to avoid that issue is by making sure the intermediate page does 
not do anything useful. Simple example (untested code, probably loaded 
with bugs but it might illustrate what i mean):

<form action=search.psp>
   Search: <input name=s type=text>
   <input type=submit value="Go">
</form>


in search.psp:


<%
req.headers_out.put('refresh', '1;url=dosearch.psp?s=%s' % 
urlencode(form['s']))
%>
<H1>Please wait</H1>
...


in dosearch.psp:


<H1>Result</H1>
<%=VeryBigImpressivelySlowQueryResult%>


From David.Bear at asu.edu  Mon May 15 12:08:50 2006
From: David.Bear at asu.edu (David Bear)
Date: Mon May 15 12:09:06 2006
Subject: [mod_python] error with test template system
In-Reply-To: <7DE1AAC0-5F06-44FE-9515-269C8A3F61FF@dscpl.com.au>
References: <20060512210041.GB18097@asu.edu>
	<8A68D8DA-8E75-4BA6-AF91-A05332F19066@dscpl.com.au>
	<20060512234412.GA8279@asu.edu>
	<7DE1AAC0-5F06-44FE-9515-269C8A3F61FF@dscpl.com.au>
Message-ID: <20060515160850.GA9264@asu.edu>

On Mon, May 15, 2006 at 06:33:46AM +1000, Graham Dumpleton wrote:
> 
> On 13/05/2006, at 9:44 AM, David Bear wrote:
> 
> >On Sat, May 13, 2006 at 09:08:05AM +1000, Graham Dumpleton wrote:
> >>
> >>On 13/05/2006, at 7:00 AM, David Bear wrote:
> >>
> >>>I downloaded the sample template system from
> >>>http://www.modpython.org/examples/
> >>>
> >>>python
> >>>traceback when viewing the page through my web browser.
> >>>
> >>>Is there something simple that I have missed?
> >
> >here's the traceback:
> >=================================
> >Mod_python error: "PythonHandler mod_python.publisher"
> >
> >Traceback (most recent call last):
> >
> >  File "/usr/lib64/python2.4/site-packages/mod_python/apache.py", line
> >299, in HandlerDispatch
> >    result = object(req)
> >
> >  File "/usr/lib64/python2.4/site-packages/mod_python/publisher.py",
> >line 98, in handler
> >    path=[path])
> >
> >  File "/usr/lib64/python2.4/site-packages/mod_python/apache.py", line
> >454, in import_module
> >    f, p, d = imp.find_module(parts[i], path)
> >
> >ImportError: No module named index
> >==================================
> >
> >Here's the configuration directive:
> >
> ><Directory "/work/servers/www/htdocs/mp">
> > AddHandler python-program .py
> > PythonHandler mod_python.publisher
> > PythonDebug On
> ></Directory>
> 
> Are the files in the directory readable by others? The Apache server  
> generally
> runs as a special user, if that user doesn't have read access to the  
> directories
> and files, it will not be able to find the files.

boy do I feel stupid. That was it.

I change file perms to go+rx and now all works.



> 
> Also, do you have an appropriate Alias directive to map URL namespace to
> that actual directory, or does that directory lie under the document  
> root?
> What is the actual URL you are using?
> 
> Graham

-- 
David Bear
phone: 	480-965-8257
fax: 	480-965-9189
College of Public Programs/ASU
Wilson Hall 232
Tempe, AZ 85287-0803
 "Beware the IP portfolio, everyone will be suspect of trespassing"
From max_lynch at sbcglobal.net  Tue May 16 00:06:05 2006
From: max_lynch at sbcglobal.net (Max Lynch)
Date: Tue May 16 00:06:23 2006
Subject: [mod_python] Session Management, Straight Answer?
Message-ID: <20060516040605.94759.qmail@web82005.mail.mud.yahoo.com>

I have looked at many of the session management posts on the list, but I am looking for a straightforward answer on how to make session data persist through different pages.  I have seen examples on using cookies/etc., but I would like a formal answer as it seems many people are also stuck on this (I might post my experiences with mod_python on a site as first-hand documentation, so that could help).  Also, I am using psp, not the publisher stuff.  Love mod_python so far though, just a little stuck!

Thanks,
Max Lynch
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060515/aaccaac5/attachment.html
From grahamd at dscpl.com.au  Tue May 16 00:23:13 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue May 16 00:23:15 2006
Subject: [mod_python] Session Management, Straight Answer?
Message-ID: <1147753393.22491@dscpl.user.openhosting.com>

Max Lynch wrote ..
> I have looked at many of the session management posts on the list, but
> I am looking for a straightforward answer on how to make session data persist
> through different pages.  I have seen examples on using cookies/etc., but
> I would like a formal answer as it seems many people are also stuck on
> this (I might post my experiences with mod_python on a site as first-hand
> documentation, so that could help).  Also, I am using psp, not the publisher
> stuff.  Love mod_python so far though, just a little stuck!

If you are using psp only (not combined with publisher), then all you
need to do is access "session" attribute from a page and the session
object will be automatically created for you. The session object will
also be automatically saved for you after page has rendered.

This is mentioned in the documentation:

  http://www.modpython.org/live/current/doc-html/pyapi-psp.html

  Additionally, the PSP code will be given global variables req, psp,
  session and form. A session will be created and assigned to session
  variable only if session is referenced in the code (the PSP handler
  examines co_names of the code object to make that determination).
  Remember that a mere mention of session will generate cookies and turn
  on session locking, which may or may not be what you want. Similarly, a
  mod_python FieldStorage object will be instantiated if form is
  referenced in the code.

If you were aware of this, what is the actual problem you are having?

Graham
From jim at qlf.com  Tue May 16 09:50:18 2006
From: jim at qlf.com (Jim Steil)
Date: Tue May 16 09:50:42 2006
Subject: [mod_python] Session Management, Straight Answer?
In-Reply-To: <20060516040605.94759.qmail@web82005.mail.mud.yahoo.com>
Message-ID: <000601c678ef$ab1477c0$800101df@qlf.local>

If you look back at the posts for January and search on my name as the
author (Jim Steil) you will see what it took for the Jim Gallacher to set me
straight on how to handle the session stuff.  I'm happy to help out as I
can, but I do not have a deep knowledge of how all this works.

 

            -Jim

 

  _____  

From: mod_python-bounces@modpython.org
[mailto:mod_python-bounces@modpython.org] On Behalf Of Max Lynch
Sent: Monday, May 15, 2006 11:06 PM
To: mod_python@modpython.org
Subject: [mod_python] Session Management, Straight Answer?

 

I have looked at many of the session management posts on the list, but I am
looking for a straightforward answer on how to make session data persist
through different pages.  I have seen examples on using cookies/etc., but I
would like a formal answer as it seems many people are also stuck on this (I
might post my experiences with mod_python on a site as first-hand
documentation, so that could help).  Also, I am using psp, not the publisher
stuff.  Love mod_python so far though, just a little stuck!

Thanks,
Max Lynch

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060516/8a575a1b/attachment.html
From prashantchari at students.iiit.net  Tue May 16 13:44:33 2006
From: prashantchari at students.iiit.net (Prashant Chari)
Date: Tue May 16 13:44:52 2006
Subject: [mod_python] Simple Problem in  using mod_python
Message-ID: <Pine.LNX.4.61.0605162305470.17887@students.iiit.net>

Hi,

 	I've just installed mod_python successfully, and seem to be having 
some problems in getting it to work . I've followed the instructions on 
the site but the code given in the 'Tutorial' section in the site does not 
seem to do what it is suppossed to .Attached is the mpinfo file. I am 
using the program 'mptest.py' given in 2.4 on the  site. The output when
i run a normal '.py' program in the browser is

Mod_python error: "PythonHandler mptest.py"

Traceback (most recent call last):

   File "/usr/local/lib/python2.4/site-packages/mod_python/apache.py", line 
287, in HandlerDispatch
     log=debug)

   File "/usr/local/lib/python2.4/site-packages/mod_python/apache.py", line 
461, in import_module
     f, p, d = imp.find_module(parts[i], path)

ImportError: No module named py



-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060516/eb6cce06/mpinfo.html
From yess at hell.org.pl  Tue May 16 13:54:14 2006
From: yess at hell.org.pl (Tadeusz Andrzej =?iso-8859-2?Q?Kad=B3ubowski?=)
Date: Tue May 16 13:54:21 2006
Subject: [mod_python] Simple Problem in  using mod_python
In-Reply-To: <Pine.LNX.4.61.0605162305470.17887@students.iiit.net>
References: <Pine.LNX.4.61.0605162305470.17887@students.iiit.net>
Message-ID: <20060516175414.GA5968@hell.org.pl>

Thus wrote Prashant Chari:
> Hi,
> 
> 	I've just installed mod_python successfully, and seem to be having 
> some problems in getting it to work . I've followed the instructions on 
> the site but the code given in the 'Tutorial' section in the site does not 
> seem to do what it is suppossed to .Attached is the mpinfo file. I am 
> using the program 'mptest.py' given in 2.4 on the  site. The output when
> i run a normal '.py' program in the browser is
> 
> Mod_python error: "PythonHandler mptest.py"

Maybe:

	PythonHandler mptest
	
in your configuration will work better?

The mod_python looks for a submodule named py in a module named mptest.

Good luck,

-- 
tadeusz andrzej kad?ubowski
From prashantchari at students.iiit.net  Tue May 16 14:03:09 2006
From: prashantchari at students.iiit.net (Prashant Chari)
Date: Tue May 16 14:03:27 2006
Subject: [mod_python] Simple Problem in  using mod_python
In-Reply-To: <20060516175414.GA5968@hell.org.pl>
References: <Pine.LNX.4.61.0605162305470.17887@students.iiit.net>
	<20060516175414.GA5968@hell.org.pl>
Message-ID: <Pine.LNX.4.61.0605162332590.29450@students.iiit.net>

thnx, it worked.

On Tue, 16 May 2006, Tadeusz Andrzej [iso-8859-2] KadBubowski wrote:

> Thus wrote Prashant Chari:
>> Hi,
>>
>> 	I've just installed mod_python successfully, and seem to be having
>> some problems in getting it to work . I've followed the instructions on
>> the site but the code given in the 'Tutorial' section in the site does not
>> seem to do what it is suppossed to .Attached is the mpinfo file. I am
>> using the program 'mptest.py' given in 2.4 on the  site. The output when
>> i run a normal '.py' program in the browser is
>>
>> Mod_python error: "PythonHandler mptest.py"
>
> Maybe:
>
> 	PythonHandler mptest
>
> in your configuration will work better?
>
> The mod_python looks for a submodule named py in a module named mptest.
>
> Good luck,
>
>

-- 
T.Prashant
Web-site(local): http://students.iiit.ac.in/~prashantchari
From David.Bear at asu.edu  Tue May 16 21:12:38 2006
From: David.Bear at asu.edu (David Bear)
Date: Tue May 16 21:12:46 2006
Subject: [mod_python] addhandler or sethandler
Message-ID: <20060517011238.GF28842@asu.edu>

I'm trying to better understand the directive semantics. So, I created
2 .htaccess files.

the mpt.py file is the same. However I get different results between
each .htaccess file.

.htaccess
SetHandler mod_python
PythonHandler mod_python.publisher
PythonDebug On

---
The above file produces an error when viewing mpt.py:

Mod_python error: "PythonHandler mod_python.publisher"

Traceback (most recent call last):

  File "/usr/lib64/python2.4/site-packages/mod_python/apache.py", line
299, in HandlerDispatch
    result = object(req)

  File "/usr/lib64/python2.4/site-packages/mod_python/publisher.py",
line 98, in handler
    path=[path])

  File "/usr/lib64/python2.4/site-packages/mod_python/apache.py", line
457, in import_module
    module = imp.load_module(mname, f, p, d)

  File "/work/servers/www/htdocs/apep/index.py", line 22

    return "Falling through to main "

SyntaxError: 'return' outside function

However, the below htaccess file produces the expected result, it
executes the python function, which is:

from mod_python import apache

def handler ( req ):
  req.content_type = "text/plain"
  req.send_http_header()
  req.write( "mod python test \n hello world" )
  return apache.OK


.htaccess
 AddHandler python-program .py
 PythonHandler mpt
 PythonDebug On


I hate to bug this group but can someone explain the difference?

-- 
David Bear
phone: 	480-965-8257
fax: 	480-965-9189
College of Public Programs/ASU
Wilson Hall 232
Tempe, AZ 85287-0803
 "Beware the IP portfolio, everyone will be suspect of trespassing"
From grahamd at dscpl.com.au  Tue May 16 22:10:31 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue May 16 22:10:39 2006
Subject: [mod_python] addhandler or sethandler
Message-ID: <1147831831.25050@dscpl.user.openhosting.com>

David Bear wrote ..
> I'm trying to better understand the directive semantics. So, I created
> 2 .htaccess files.
> 
> the mpt.py file is the same. However I get different results between
> each .htaccess file.
> 
> .htaccess
> SetHandler mod_python
> PythonHandler mod_python.publisher
> PythonDebug On

For SetHandler, any request against the directory will be processed
by mod_python which in turn will bump request through to mod_python.publisher.

> ---
> The above file produces an error when viewing mpt.py:
> 
> Mod_python error: "PythonHandler mod_python.publisher"
> 
> Traceback (most recent call last):
> 
>   File "/usr/lib64/python2.4/site-packages/mod_python/apache.py", line
> 299, in HandlerDispatch
>     result = object(req)
> 
>   File "/usr/lib64/python2.4/site-packages/mod_python/publisher.py",
> line 98, in handler
>     path=[path])
> 
>   File "/usr/lib64/python2.4/site-packages/mod_python/apache.py", line
> 457, in import_module
>     module = imp.load_module(mname, f, p, d)
> 
>   File "/work/servers/www/htdocs/apep/index.py", line 22
> 
>     return "Falling through to main "
> 
> SyntaxError: 'return' outside function

This looks like an indentation problem in your code file.

> However, the below htaccess file produces the expected result, it
> executes the python function, which is:
> 
> from mod_python import apache
> 
> def handler ( req ):
>   req.content_type = "text/plain"
>   req.send_http_header()
>   req.write( "mod python test \n hello world" )
>   return apache.OK
> 
> 
> .htaccess
>  AddHandler python-program .py
>  PythonHandler mpt
>  PythonDebug On

Only requests for which URL resolves to physical file with a .py extension
which be processed by mod_python which will in turn bump request
through to "mpt" handler.

Note that I intentionally say extension of physical file URL mapped to
as multiview matching rules can come into play. See link down further.

Note that "python-program" is same as saying "mod_python" in
mod_python 3.X. Only "python-program" was accepted in mod_python 2.X.

> I hate to bug this group but can someone explain the difference?

For some information, see discussion around:

  http://www.modpython.org/pipermail/mod_python/2006-May/021040.html

Graham
From jpg at jgassociates.ca  Tue May 16 22:36:39 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Tue May 16 22:32:29 2006
Subject: [mod_python] addhandler or sethandler
In-Reply-To: <1147831831.25050@dscpl.user.openhosting.com>
References: <1147831831.25050@dscpl.user.openhosting.com>
Message-ID: <446A8C37.2050908@jgassociates.ca>

Graham Dumpleton wrote:
> David Bear wrote ..
>> I'm trying to better understand the directive semantics. So, I created
>> 2 .htaccess files.
>>
>> the mpt.py file is the same. However I get different results between
>> each .htaccess file.
>>
>> .htaccess
>> SetHandler mod_python
>> PythonHandler mod_python.publisher
>> PythonDebug On
> 
> For SetHandler, any request against the directory will be processed
> by mod_python which in turn will bump request through to mod_python.publisher.
> 
>> ---
>> The above file produces an error when viewing mpt.py:
>>
>> Mod_python error: "PythonHandler mod_python.publisher"
>>
>> Traceback (most recent call last):
>>
>>   File "/usr/lib64/python2.4/site-packages/mod_python/apache.py", line
>> 299, in HandlerDispatch
>>     result = object(req)
>>
>>   File "/usr/lib64/python2.4/site-packages/mod_python/publisher.py",
>> line 98, in handler
>>     path=[path])
>>
>>   File "/usr/lib64/python2.4/site-packages/mod_python/apache.py", line
>> 457, in import_module
>>     module = imp.load_module(mname, f, p, d)
>>
>>   File "/work/servers/www/htdocs/apep/index.py", line 22
>>
>>     return "Falling through to main "
>>
>> SyntaxError: 'return' outside function
> 
> This looks like an indentation problem in your code file.
> 
>> However, the below htaccess file produces the expected result, it
>> executes the python function, which is:
>>
>> from mod_python import apache
>>
>> def handler ( req ):
>>   req.content_type = "text/plain"
>>   req.send_http_header()
>>   req.write( "mod python test \n hello world" )
>>   return apache.OK
>>
>>
>> .htaccess
>>  AddHandler python-program .py
>>  PythonHandler mpt
>>  PythonDebug On
> 
> Only requests for which URL resolves to physical file with a .py extension
> which be processed by mod_python which will in turn bump request
> through to "mpt" handler.
> 
> Note that I intentionally say extension of physical file URL mapped to
> as multiview matching rules can come into play. See link down further.
> 
> Note that "python-program" is same as saying "mod_python" in
> mod_python 3.X. Only "python-program" was accepted in mod_python 2.X.

Also note that in mod_python 3.x "req.send_http_header()" is not 
required, and is in fact a noop.

To get a better feeling for the difference between SetHandler and 
AddHandler I'd suggest using the same handler in each of your .htaccess 
files. Try accessing a couple of different files (.py, .txt, .html) 
using both setups and you'll get a pretty good idea of the difference 
between the 2 directives.

Jim
From wouter at squirrel-systems.com  Tue May 16 23:38:18 2006
From: wouter at squirrel-systems.com (Wouter van Marle)
Date: Tue May 16 23:38:25 2006
Subject: [mod_python] Problem with html quoted/unquoted
Message-ID: <1147837098.17770.175.camel@pistachio.squirrel>

Hi all,

I have a problem with POST requests - loosely related to mod_python but
I don't know a better place to ask.

I have a website run by python/mod_python/apache2, using a MySQL
database (accessed through MySQLdb).

For html compatibility reasons, I store all the search data in the MySQL
database in html-quoted format. The term in question that I ran into is:
"Jubil?umsmodell", stored in the database as "Jubil&auml;umsmodell".

The select in the html source, as presented to the browser, is fine (the
html line is abbreviated for here; it contains many more options):
<select name=model>
	<option value="Jubil&auml;umsmodell 40 Jahre">Jubil&auml;umsmodell 40
Jahre</option>
</select>

It is rendered correctly of course by the browser.
Now when the user clicks go, and the POST is generated, the character is
sent back in what I guess is UTF-8 encoding (I assume it's that, as
that's my default encoding) (again only a snippet):
&model=Jubil%C3%A4umsmodell+40+Jahre

And as you can imagine this messes up the search in the MySQL database,
where I can find the term only if it's html quoted again.

So the end of the whole story, the actual question is now: how do I get
from this utf-8 encoding back to html quoted encoding, for searching in
the database? And no, I'm not going to put the info in the database in
utf-8, that must remain html quoted for many other locations where it
goes wrong otherwise.

Wouter.

From David.Bear at asu.edu  Tue May 16 23:49:35 2006
From: David.Bear at asu.edu (David Bear)
Date: Tue May 16 23:49:41 2006
Subject: [mod_python] publisher on psp
Message-ID: <20060517034935.GG28842@asu.edu>

I'm using the psp template formulation from the modpython web site.

I do not have any psp code in the template yet. The dispatcher code
seems to be working. I have an html only file. I have an index.py
file. In index.py I have a function called begin. The html template
(which right now is only html) lives in documentroot/template. there
is a graphic src image tag in that template that points to
documentroot/images/my.jpg.  documentroot here means the directroy
where index.py lives.

the problem is the image is never sent to the browser. I know it must
be related to what document root is, and I assume the answer is found
in some psp global variable...so, how do I construct my <img src="..">
tag to properly find the jpg?

-- 
David Bear
phone: 	480-965-8257
fax: 	480-965-9189
College of Public Programs/ASU
Wilson Hall 232
Tempe, AZ 85287-0803
 "Beware the IP portfolio, everyone will be suspect of trespassing"
From grahamd at dscpl.com.au  Wed May 17 00:09:36 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed May 17 00:09:44 2006
Subject: [mod_python] addhandler or sethandler
Message-ID: <1147838976.30378@dscpl.user.openhosting.com>


> Graham Dumpleton wrote:
> > David Bear wrote ..
> >> However, the below htaccess file produces the expected result, it
> >> executes the python function, which is:
> >>
> >> from mod_python import apache
> >>
> >> def handler ( req ):
> >>   req.content_type = "text/plain"
> >>   req.send_http_header()
> >>   req.write( "mod python test \n hello world" )
> >>   return apache.OK
> >>
> >>
> >> .htaccess
> >>  AddHandler python-program .py
> >>  PythonHandler mpt
> >>  PythonDebug On
> > 
> > Only requests for which URL resolves to physical file with a .py extension
> > which be processed by mod_python which will in turn bump request
> > through to "mpt" handler.
> > 
> > Note that I intentionally say extension of physical file URL mapped to
> > as multiview matching rules can come into play. See link down further.

Whoops, need to correct a slight in accuracy in what I originally said.

That is, if the URL has a .py extension in first component of path,
a physical file doesn't have to exist.

The need for a physical file with .py extension only comes into play
when multiviews matching is attempted.

Also, if "MultiviewsMatch Handlers" is defined, you don't even need
a physical .py file for multiviews to work, as it will match purely based
on fact that .py is defined as the handler extension.

It's all a muddle, and one of these days I should write a proper mini
article on it all to clearly explain it, with examples. :-(

Graham
From grahamd at dscpl.com.au  Wed May 17 00:19:51 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed May 17 00:19:58 2006
Subject: [mod_python] publisher on psp
Message-ID: <1147839591.7065@dscpl.user.openhosting.com>

David Bear wrote ..
> I'm using the psp template formulation from the modpython web site.
> 
> I do not have any psp code in the template yet. The dispatcher code
> seems to be working. I have an html only file. I have an index.py
> file. In index.py I have a function called begin. The html template
> (which right now is only html) lives in documentroot/template. there
> is a graphic src image tag in that template that points to
> documentroot/images/my.jpg.  documentroot here means the directroy
> where index.py lives.
> 
> the problem is the image is never sent to the browser. I know it must
> be related to what document root is, and I assume the answer is found
> in some psp global variable...so, how do I construct my <img src="..">
> tag to properly find the jpg?

Calculating correct relative to URLs when using publisher is a PITA
because multiple URLs can refer to the same resource. See prior
commentary on this:

  http://www.modpython.org/pipermail/mod_python/2006-March/020501.html

The link includes code which may be of some use in at least
reliably calculating a relative URL to the directory the PythonHandler
directives was defined for. Knowing that, you can then extend
it to parent or sibling directories as appropriate using posixpath.join().

Graham
From smilelover at centrum.cz  Wed May 17 04:14:00 2006
From: smilelover at centrum.cz (.: smilelover :.)
Date: Wed May 17 04:14:46 2006
Subject: [mod_python] Session Management, Straight Answer?
In-Reply-To: <20060516040605.94759.qmail@web82005.mail.mud.yahoo.com>
References: <20060516040605.94759.qmail@web82005.mail.mud.yahoo.com>
Message-ID: <200605171014.3919@centrum.cz>

I also struggled a lot to understand the sessions stuff and now I use sessions this way:

in index I enter login and pass in a form and send it to check_login, which checks the login data and if correct, creates a session object, fills it with the data I need it to bear, sets timeout and saves it. On the check_login page there is a link that points to  "section" (some imaginary section, as if in some admin pass-protected area). In the section, I create another session object, but the first thing I do with it is sess.load(), which loads the data of the previously saved session. And thats it.

I attached the code and templates (I use publisher) + .htaccess file. It should work for you.
With regular PSP it's probably different, as Graham wrote.

This is the way I use it and it is quite possible it is some deprecated way. I don't know :) If anyone of you knows there are some serious mistakes in the way I use sessions, don't hesitate and post it here.
Thx.

Dan
______________________________________________________________
> Od: max_lynch@sbcglobal.net
> Komu:  mod_python@modpython.org
> CC:  
> Datum: 16.05.2006 06:08
> P?edm?t: [mod_python] Session Management, Straight Answer?
>
>  I have looked at many of the session management posts on the list, but I
> am looking for a straightforward answer on how to make session data
> persist through different pages.  I have seen examples on using
> cookies/etc., but I would like a formal answer as it seems many people are
> also stuck on this (I might post my experiences with mod_python on a site
> as first-hand documentation, so that could help).  Also, I am using psp,
> not the publisher stuff.  Love mod_python so far though, just a little
> stuck!
> 
> Thanks,
> Max Lynch
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 
> 

-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/zip
Size: 1425 bytes
Desc: not available
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060517/3ab63d6d/attachment.zip
From grahamd at dscpl.com.au  Wed May 17 06:37:38 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed May 17 06:38:21 2006
Subject: [mod_python] Session Management, Straight Answer?
In-Reply-To: <200605171014.3919@centrum.cz>
References: <20060516040605.94759.qmail@web82005.mail.mud.yahoo.com>
	<200605171014.3919@centrum.cz>
Message-ID: <118F66E8-0489-4502-991D-F9678792486A@dscpl.com.au>

I'm not sure you actually need the load() and delete() calls. The load 
() is
called from the constructor and the delete() from invalidate().

The session timeout is specified as seconds. Do you really mean to  
have it
be 30 seconds? The default timeout is 30 minutes.

If you are using mod_python 3.2.7 or later and are using PSP in  
conjunction
with publisher, set req.session to your session object and PSP will  
automatically
use it rather than create its own when "session" attribute is  
accessed in a page.
That way you can still access it from the PSP page.

At a quick glance, am bit concerned about whether it is is robust as  
a whole,
but don't have access to my own code at present and don't have time to
play with your code.

FWIW, I don't do my session creation management from the content handler
but in an earlier phase with the session object being left in  
req.session. This
way the session management will work no matter whether you are using PSP
pages, publisher, a mix of these or even custom handlers. Thus the  
session
management becomes a reusable unit in itself. Can't remember though  
whether
I was dependent on features specifically in mod_python 3.3 though.

Graham


On 17/05/2006, at 6:14 PM, .: smilelover :. wrote:

> I also struggled a lot to understand the sessions stuff and now I  
> use sessions this way:
>
> in index I enter login and pass in a form and send it to  
> check_login, which checks the login data and if correct, creates a  
> session object, fills it with the data I need it to bear, sets  
> timeout and saves it. On the check_login page there is a link that  
> points to  "section" (some imaginary section, as if in some admin  
> pass-protected area). In the section, I create another session  
> object, but the first thing I do with it is sess.load(), which  
> loads the data of the previously saved session. And thats it.
>
> I attached the code and templates (I use publisher) + .htaccess  
> file. It should work for you.
> With regular PSP it's probably different, as Graham wrote.
>
> This is the way I use it and it is quite possible it is some  
> deprecated way. I don't know :) If anyone of you knows there are  
> some serious mistakes in the way I use sessions, don't hesitate and  
> post it here.
> Thx.
>
> Dan
> ______________________________________________________________
>> Od: max_lynch@sbcglobal.net
>> Komu:  mod_python@modpython.org
>> CC:
>> Datum: 16.05.2006 06:08
>> P?edm?t: [mod_python] Session Management, Straight Answer?
>>
>>  I have looked at many of the session management posts on the  
>> list, but I
>> am looking for a straightforward answer on how to make session data
>> persist through different pages.  I have seen examples on using
>> cookies/etc., but I would like a formal answer as it seems many  
>> people are
>> also stuck on this (I might post my experiences with mod_python on  
>> a site
>> as first-hand documentation, so that could help).  Also, I am  
>> using psp,
>> not the publisher stuff.  Love mod_python so far though, just a  
>> little
>> stuck!
>>
>> Thanks,
>> Max Lynch
>>
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>
>>
>
> <session.zip>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python


From hrz at geodata.soton.ac.uk  Wed May 17 08:06:34 2006
From: hrz at geodata.soton.ac.uk (hrz@geodata.soton.ac.uk)
Date: Wed May 17 08:06:44 2006
Subject: [mod_python] undefined symbol: apr_table_compress ??
Message-ID: <20060517120634.GC11850@geodata.soton.ac.uk>

I've just come across the problem defined below using mod_python
3.2.8. After some hunting around, it transpires that the problem is
that the installed APR has been stripped (we're using Red Hat) as
described very nicely at:

http://search.cpan.org/dist/mod_perl/docs/user/troubleshooting/troubleshooting.pod#undefined_symbol%3A_apr_table_compress

The attached patch to the 3.2.8 configure.in file seemed to catch the
error (autoconf needs to be run after applying this). After looking at

http://www.modpython.org/pipermail/mod_python/2006-February/020286.html

some better solution using apr-config might be better to ensure that
APR is as required.

Kind regards,

Homme.


> > I've downloaded mod_python 3.2.5b (Beta) and compiled it using
> >
> > ./configure --with-apxs=/usr/sbin/apxs --with-python=/usr/local/bin/ 
> > python2.3
> > make
> > make install
> >
> > just as the documentation says. But when I add LoadModule... to my
> > httpd.conf and restart Apache 2.0.46 I get the error message
> >
> > Cannot load /etc/httpd/modules/mod_python.so into server:
> > /etc/httpd/modules/mod_python.so: undefined symbol: apr_table_compress
> >
> > any ideas on how to fix this??
> >
> > Regards
> > Martin
> 
> Martin, did you ever sort this out? I appreciate no help was  
> forthcoming on
> the list. It doesn't seem to be anything we have specifically seen.  
> Thus, bar
> suggesting a rebuild of Apache and mod_python from scratch, probably
> nothing else anyone could think of to suggest.
> 
> Graham


-------------- next part --------------
--- configure.in
+++ configure.in
@@ -117,6 +117,15 @@
     AC_MSG_ERROR([This version of mod_python only works with Apache 2. The one you have seems to be $ver.])
   fi
 
+  # ensure the apr_* symbols can be read
+  AC_CHECK_LIB(apr-0, apr_table_compress, [], 
+  [
+    AC_MSG_ERROR([Apache Portable Runtime (apr) library not found. This may be due to one of:
+    - APR not being installed on the system
+    - The shared object (libapr-0) being stripped
+    - An installed APR that does not support the apr_table_compress() function])
+  ])
+  
   # determine LIBEXEC
   AC_MSG_CHECKING(for Apache libexec directory)
   LIBEXECDIR=`${APXS} -q LIBEXECDIR`
From jpg at jgassociates.ca  Wed May 17 08:35:34 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Wed May 17 08:35:54 2006
Subject: [mod_python] undefined symbol: apr_table_compress ??
In-Reply-To: <20060517120634.GC11850@geodata.soton.ac.uk>
References: <20060517120634.GC11850@geodata.soton.ac.uk>
Message-ID: <446B1896.8040208@jgassociates.ca>

hrz@geodata.soton.ac.uk wrote:
> I've just come across the problem defined below using mod_python
> 3.2.8. After some hunting around, it transpires that the problem is
> that the installed APR has been stripped (we're using Red Hat) as
> described very nicely at:
> 
> http://search.cpan.org/dist/mod_perl/docs/user/troubleshooting/troubleshooting.pod#undefined_symbol%3A_apr_table_compress
> 
> The attached patch to the 3.2.8 configure.in file seemed to catch the
> error (autoconf needs to be run after applying this). After looking at
> 
> http://www.modpython.org/pipermail/mod_python/2006-February/020286.html
> 
> some better solution using apr-config might be better to ensure that
> APR is as required.
> 

The fact that the library is stripped is not relevant to your problem. 
All the libs on Debian are stripped and everything works fine for me. 
Stripping just removes debugging symbols, making the lib smaller on disk 
and in memory.

I took a quick glance at the debian src for apache 2.0.55, and it looks 
like apr_table_compress was added in apr 0.9.4, so you might want to 
check your apr version with

$ apr-config --version

I'm not sure when we started to use apr_table_compress, but I have a 
feeling this may have been done in 3.2.x to fix a bug. I don't have time 
to investigate right now, but I will check the svn logs tonight.

Jim

> Kind regards,
> 
> Homme.
> 
> 
>>> I've downloaded mod_python 3.2.5b (Beta) and compiled it using
>>>
>>> ./configure --with-apxs=/usr/sbin/apxs --with-python=/usr/local/bin/ 
>>> python2.3
>>> make
>>> make install
>>>
>>> just as the documentation says. But when I add LoadModule... to my
>>> httpd.conf and restart Apache 2.0.46 I get the error message
>>>
>>> Cannot load /etc/httpd/modules/mod_python.so into server:
>>> /etc/httpd/modules/mod_python.so: undefined symbol: apr_table_compress
>>>
>>> any ideas on how to fix this??
>>>
>>> Regards
>>> Martin
>> Martin, did you ever sort this out? I appreciate no help was  
>> forthcoming on
>> the list. It doesn't seem to be anything we have specifically seen.  
>> Thus, bar
>> suggesting a rebuild of Apache and mod_python from scratch, probably
>> nothing else anyone could think of to suggest.
>>
>> Graham
> 
> 
> 
> ------------------------------------------------------------------------
> 
> --- configure.in
> +++ configure.in
> @@ -117,6 +117,15 @@
>      AC_MSG_ERROR([This version of mod_python only works with Apache 2. The one you have seems to be $ver.])
>    fi
>  
> +  # ensure the apr_* symbols can be read
> +  AC_CHECK_LIB(apr-0, apr_table_compress, [], 
> +  [
> +    AC_MSG_ERROR([Apache Portable Runtime (apr) library not found. This may be due to one of:
> +    - APR not being installed on the system
> +    - The shared object (libapr-0) being stripped
> +    - An installed APR that does not support the apr_table_compress() function])
> +  ])
> +  
>    # determine LIBEXEC
>    AC_MSG_CHECKING(for Apache libexec directory)
>    LIBEXECDIR=`${APXS} -q LIBEXECDIR`
> 
> 
> ------------------------------------------------------------------------
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From grahamd at dscpl.com.au  Wed May 17 08:43:58 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed May 17 08:45:25 2006
Subject: [mod_python] undefined symbol: apr_table_compress ??
In-Reply-To: <20060517120634.GC11850@geodata.soton.ac.uk>
References: <20060517120634.GC11850@geodata.soton.ac.uk>
Message-ID: <CBC33DB3-6B75-47D6-97EA-B763E13F6DA4@dscpl.com.au>

That the APR library has been stripped is not the problem in itself
as the symbol should still be in there, you just may not be able to see
it on some platforms when using nm. The real problem is probably
that the wrong APR library version has been used and the symbol
was not in the library, stripped or not stripped. Thus the real essence
of what the web page you refer to is telling you is to ensure the  
correct
APR library version is used when mod_perl (mod_python in our
case) is being built. In practice this should not be an issue if the  
correct
version of apxs is found when configuring mod_python source code.
If not finding the correct version, the --with-apxs option can be used
to configure. But then, if your runtime library search path causes
Apache to still pick up the wrong version when run, you'll still have
problems.

Thus, also determine if LD_LIBRARY_PATH is set in environment which
Apache runs under. With that same value of LD_LIBRARY_PATH
set and exported, run "ldd" on "httpd" binary to see what APR library
is being found. Work out what version that library may be. Work out
if this is the version that it should be using based on what Apache was
built against. If they are different, that will be the more probable  
cause.

Graham

On 17/05/2006, at 10:06 PM, hrz@geodata.soton.ac.uk wrote:

> I've just come across the problem defined below using mod_python
> 3.2.8. After some hunting around, it transpires that the problem is
> that the installed APR has been stripped (we're using Red Hat) as
> described very nicely at:
>
> http://search.cpan.org/dist/mod_perl/docs/user/troubleshooting/ 
> troubleshooting.pod#undefined_symbol%3A_apr_table_compress
>
> The attached patch to the 3.2.8 configure.in file seemed to catch the
> error (autoconf needs to be run after applying this). After looking at
>
> http://www.modpython.org/pipermail/mod_python/2006-February/ 
> 020286.html
>
> some better solution using apr-config might be better to ensure that
> APR is as required.
>
> Kind regards,
>
> Homme.
>
>
>>> I've downloaded mod_python 3.2.5b (Beta) and compiled it using
>>>
>>> ./configure --with-apxs=/usr/sbin/apxs --with-python=/usr/local/bin/
>>> python2.3
>>> make
>>> make install
>>>
>>> just as the documentation says. But when I add LoadModule... to my
>>> httpd.conf and restart Apache 2.0.46 I get the error message
>>>
>>> Cannot load /etc/httpd/modules/mod_python.so into server:
>>> /etc/httpd/modules/mod_python.so: undefined symbol:  
>>> apr_table_compress
>>>
>>> any ideas on how to fix this??
>>>
>>> Regards
>>> Martin
>>
>> Martin, did you ever sort this out? I appreciate no help was
>> forthcoming on
>> the list. It doesn't seem to be anything we have specifically seen.
>> Thus, bar
>> suggesting a rebuild of Apache and mod_python from scratch, probably
>> nothing else anyone could think of to suggest.
>>
>> Graham
>
>
> <configure.in.patch>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From hrz at geodata.soton.ac.uk  Wed May 17 08:59:25 2006
From: hrz at geodata.soton.ac.uk (hrz@geodata.soton.ac.uk)
Date: Wed May 17 08:59:44 2006
Subject: [mod_python] undefined symbol: apr_table_compress ??
In-Reply-To: <446B1896.8040208@jgassociates.ca>
References: <20060517120634.GC11850@geodata.soton.ac.uk>
	<446B1896.8040208@jgassociates.ca>
Message-ID: <20060517125925.GD11850@geodata.soton.ac.uk>

On Wed, May 17, 2006 at 08:35:34AM -0400, Jim Gallacher wrote:
> hrz@geodata.soton.ac.uk wrote:
> >I've just come across the problem defined below using mod_python
> >3.2.8. After some hunting around, it transpires that the problem is
> >that the installed APR has been stripped (we're using Red Hat) as
> >described very nicely at:
> >
> >http://search.cpan.org/dist/mod_perl/docs/user/troubleshooting/troubleshooting.pod#undefined_symbol%3A_apr_table_compress
> >
> >The attached patch to the 3.2.8 configure.in file seemed to catch the
> >error (autoconf needs to be run after applying this). After looking at
> >
> >http://www.modpython.org/pipermail/mod_python/2006-February/020286.html
> >
> >some better solution using apr-config might be better to ensure that
> >APR is as required.
> >
> 
> The fact that the library is stripped is not relevant to your problem. 
> All the libs on Debian are stripped and everything works fine for me. 
> Stripping just removes debugging symbols, making the lib smaller on disk 
> and in memory.
> 
> I took a quick glance at the debian src for apache 2.0.55, and it looks 
> like apr_table_compress was added in apr 0.9.4, so you might want to 
> check your apr version with
> 
> $ apr-config --version
> 
> I'm not sure when we started to use apr_table_compress, but I have a 
> feeling this may have been done in 3.2.x to fix a bug. I don't have time 
> to investigate right now, but I will check the svn logs tonight.

Thanks - reading the replie from Graham and yourself and looking at

http://www.modpython.org/pipermail/mod_python/2006-February/020280.html

brings me to the same conclusion as the Nicolas; we should add some
warning that mod_python >=3.2.7 only supports Apache 2.0.47 and later
versions.

I've run all the relevant ldd checks etc. and am using apr-0.9.4 but
with Apache/2.0.46 - so upgrading apache to 2.0.47 would apparently
solve the problem.

Kind regards,

Homme.


From deron.meranda at gmail.com  Wed May 17 11:02:03 2006
From: deron.meranda at gmail.com (Deron Meranda)
Date: Wed May 17 11:02:32 2006
Subject: [mod_python] Problem with html quoted/unquoted
In-Reply-To: <1147837098.17770.175.camel@pistachio.squirrel>
References: <1147837098.17770.175.camel@pistachio.squirrel>
Message-ID: <5c06fa770605170802j4cf0cfffg4bccb38c1bdb9cba@mail.gmail.com>

On 5/16/06, Wouter van Marle <wouter@squirrel-systems.com> wrote:
> For html compatibility reasons, I store all the search data in the MySQL
> database in html-quoted format. The term in question that I ran into is:
> "Jubil?umsmodell", stored in the database as "Jubil&auml;umsmodell".
>
> The select in the html source, as presented to the browser, is fine (the
> html line is abbreviated for here; it contains many more options):
> <select name=model>
>         <option value="Jubil&auml;umsmodell 40 Jahre">Jubil&auml;umsmodell 40
> Jahre</option>
> </select>
>
> It is rendered correctly of course by the browser.
> Now when the user clicks go, and the POST is generated, the character is
> sent back in what I guess is UTF-8 encoding

>From my experience, browsers will POST in the same character set/
encoding as whatever the HTML page containing the <form> was
encoded in.  So if you output your HTML page in utf-8, then the POST
will also be UTF-8.

You can of course affect that somewhat if you explicitly output the
Accept-Encoding HTTP header, or the optional accept-charset
attribute of the <form> element.

Regardless though, you should use one of the above methods
rather than leaving it up to the browser.  My personal opinion
is to always use UTF-8 when communicating with browsers.
It is the best supported across all browsers, and will cause you
the least grief.

> (I assume it's that, as that's my default encoding) (again only a snippet):
> &model=Jubil%C3%A4umsmodell+40+Jahre

Yes, [0xc3, 0xa4] is in fact the two-byte UTF-8 encoding of the
unicode character U+00E4 (the a-diaeresis).

> So the end of the whole story, the actual question is now: how do I get
> from this utf-8 encoding back to html quoted encoding, for searching in
> the database?

What makes this more difficult is that you are using entity names rather
than character references.  For example, in HTML, all of these
"escape" strings can be used to reference the same character:

   &auml;
   &#228;
  &#xe8;

The second decimal-numeric character reference is the most universal.
In fact it is what you must use if you ever want to use some other
XML-based languages rather than HTML.

Anyway, the first thing to do is to get the UTF-8 encoded string
turned back into a Python unicode string, such as

   s = s.decode('utf8')

Now that two-byte sequence has turned into a single unicode
character, \u00e8 (displayed as \xe8 when you print it).

Then you probably want to define a function which HTM-encodes
a Unicode string, turning all non-ASCII characters into references,
perhaps something like

def encodechar( c ):
    codepoint = ord(c)
    if codepoint >= 128 or codepoint < 32:
        return '&#%d;' % codepoint
    else:
        return c

And HTML-encode your string like:

   encoded_s = ''.join( [encodechar(c) for c in s] )

If you are really tied to using entities rather than character references,
you may be able to do something like this instead:

import htmlentitydefs

def encodechar( c ):
    codepoint = ord(c)
    entityname = htmlentitydefs.codepoint2name.get( codepoint, None )
    if entityname:
        return '&%s;' % entityname
    elif codepoint >= 128 or codepoint < 32:
        return '&#%d;' % codepoint
    else:
        return c

Keep in mind though that not all browser versions understand
the complete list of HTML entity names.  That's why I would
strongly recommend against using entity names.

Also note that if you need apostrophes escaped too, you'll need to
put in another special case for that as the htmlentitydefs does
not have an entry for "apos" for some reason.

> And no, I'm not going to put the info in the database in
> utf-8, that must remain html quoted for many other locations where it
> goes wrong otherwise.

Your choice.  Actually though, MySQL handles Unicode brilliantly,
and if you could ever convert to that you'll make things a lot
easier on yourself in the future.
-- 
Deron Meranda

From deron.meranda at gmail.com  Wed May 17 11:06:47 2006
From: deron.meranda at gmail.com (Deron Meranda)
Date: Wed May 17 11:10:13 2006
Subject: [mod_python] Problem with html quoted/unquoted
In-Reply-To: <5c06fa770605170802j4cf0cfffg4bccb38c1bdb9cba@mail.gmail.com>
References: <1147837098.17770.175.camel@pistachio.squirrel>
	<5c06fa770605170802j4cf0cfffg4bccb38c1bdb9cba@mail.gmail.com>
Message-ID: <5c06fa770605170806i71a2d8d0k943631fc8259ca50@mail.gmail.com>

On 5/17/06, Deron Meranda <deron.meranda@gmail.com> wrote:
> def encodechar( c ):
>     codepoint = ord(c)
>     if codepoint >= 128 or codepoint < 32:
>         return '&#%d;' % codepoint
>     else:
>         return c

Oops, in my first encodechar() function, the else clause should read:

   else:
      import cgi
      return cgi.escape( c, True )

Or some equivalent, in order to insure that &, <, and > get encoded.

My second example which uses htmlentitdefs doesn't need that
since those characters are already in the htmlentitydefs.
-- 
Deron Meranda

From deron.meranda at gmail.com  Wed May 17 11:06:47 2006
From: deron.meranda at gmail.com (Deron Meranda)
Date: Wed May 17 11:17:50 2006
Subject: [mod_python] Problem with html quoted/unquoted
In-Reply-To: <5c06fa770605170802j4cf0cfffg4bccb38c1bdb9cba@mail.gmail.com>
References: <1147837098.17770.175.camel@pistachio.squirrel>
	<5c06fa770605170802j4cf0cfffg4bccb38c1bdb9cba@mail.gmail.com>
Message-ID: <5c06fa770605170806i71a2d8d0k943631fc8259ca50@mail.gmail.com>

On 5/17/06, Deron Meranda <deron.meranda@gmail.com> wrote:
> def encodechar( c ):
>     codepoint = ord(c)
>     if codepoint >= 128 or codepoint < 32:
>         return '&#%d;' % codepoint
>     else:
>         return c

Oops, in my first encodechar() function, the else clause should read:

   else:
      import cgi
      return cgi.escape( c, True )

Or some equivalent, in order to insure that &, <, and > get encoded.

My second example which uses htmlentitdefs doesn't need that
since those characters are already in the htmlentitydefs.
-- 
Deron Meranda

From wouter at squirrel-systems.com  Wed May 17 11:17:29 2006
From: wouter at squirrel-systems.com (Wouter van Marle)
Date: Wed May 17 11:18:02 2006
Subject: [mod_python] Problem with html quoted/unquoted
In-Reply-To: <5c06fa770605170802j4cf0cfffg4bccb38c1bdb9cba@mail.gmail.com>
References: <1147837098.17770.175.camel@pistachio.squirrel>
	<5c06fa770605170802j4cf0cfffg4bccb38c1bdb9cba@mail.gmail.com>
Message-ID: <1147879049.8449.135.camel@cm222-167-159-88.hkcable.com.hk>

Dear Deron,

Thank you for the comments. I understand your ideas; unfortunately it
does not solve my problem.

The info I get from another website, this origin gives me the info in
the ampersand form (that third party site is a Netscape server by the
way! Didn't know they are still in use, very remarkable). And I like
that.
The main reason to continue using that format is the " (double-quotes)
and ' (single quotes). These characters are used in the data that I try
to store in the mysql base, and that fantastically messes up with the
queries....
imagine: s = "this is 'a' string"
then say query = """ SELECT * FROM base WHERE field = "%s";"""% s

But what about when s can be 'this is "a" string'
or s = """this is a 5", 'b' sized thing""".

Now if I keep those " and ' characters in ampersand quoted form, no
problem. And as a result I (have to - conversion issue; urllib.unquote()
is not selective) keep the rest of the strange characters (usually
umlauts and so) also in that form.

If there is no easier solution I'll have to just use urllib.unquote()
and code into utf-8 for storing, and then replace the " characters again
with the quoted form. May be the best solution.

Wouter.


On Wed, 2006-05-17 at 11:02 -0400, Deron Meranda wrote:
> On 5/16/06, Wouter van Marle <wouter@squirrel-systems.com> wrote:
> > For html compatibility reasons, I store all the search data in the MySQL
> > database in html-quoted format. The term in question that I ran into is:
> > "Jubil?umsmodell", stored in the database as "Jubil&auml;umsmodell".
> >
> > The select in the html source, as presented to the browser, is fine (the
> > html line is abbreviated for here; it contains many more options):
> > <select name=model>
> >         <option value="Jubil&auml;umsmodell 40 Jahre">Jubil&auml;umsmodell 40
> > Jahre</option>
> > </select>
> >
> > It is rendered correctly of course by the browser.
> > Now when the user clicks go, and the POST is generated, the character is
> > sent back in what I guess is UTF-8 encoding
> 
> From my experience, browsers will POST in the same character set/
> encoding as whatever the HTML page containing the <form> was
> encoded in.  So if you output your HTML page in utf-8, then the POST
> will also be UTF-8.
> 
> You can of course affect that somewhat if you explicitly output the
> Accept-Encoding HTTP header, or the optional accept-charset
> attribute of the <form> element.
> 
> Regardless though, you should use one of the above methods
> rather than leaving it up to the browser.  My personal opinion
> is to always use UTF-8 when communicating with browsers.
> It is the best supported across all browsers, and will cause you
> the least grief.
> 
> > (I assume it's that, as that's my default encoding) (again only a snippet):
> > &model=Jubil%C3%A4umsmodell+40+Jahre
> 
> Yes, [0xc3, 0xa4] is in fact the two-byte UTF-8 encoding of the
> unicode character U+00E4 (the a-diaeresis).
> 
> > So the end of the whole story, the actual question is now: how do I get
> > from this utf-8 encoding back to html quoted encoding, for searching in
> > the database?
> 
> What makes this more difficult is that you are using entity names rather
> than character references.  For example, in HTML, all of these
> "escape" strings can be used to reference the same character:
> 
>    &auml;
>    &#228;
>   &#xe8;
> 
> The second decimal-numeric character reference is the most universal.
> In fact it is what you must use if you ever want to use some other
> XML-based languages rather than HTML.
> 
> Anyway, the first thing to do is to get the UTF-8 encoded string
> turned back into a Python unicode string, such as
> 
>    s = s.decode('utf8')
> 
> Now that two-byte sequence has turned into a single unicode
> character, \u00e8 (displayed as \xe8 when you print it).
> 
> Then you probably want to define a function which HTM-encodes
> a Unicode string, turning all non-ASCII characters into references,
> perhaps something like
> 
> def encodechar( c ):
>     codepoint = ord(c)
>     if codepoint >= 128 or codepoint < 32:
>         return '&#%d;' % codepoint
>     else:
>         return c
> 
> And HTML-encode your string like:
> 
>    encoded_s = ''.join( [encodechar(c) for c in s] )
> 
> If you are really tied to using entities rather than character references,
> you may be able to do something like this instead:
> 
> import htmlentitydefs
> 
> def encodechar( c ):
>     codepoint = ord(c)
>     entityname = htmlentitydefs.codepoint2name.get( codepoint, None )
>     if entityname:
>         return '&%s;' % entityname
>     elif codepoint >= 128 or codepoint < 32:
>         return '&#%d;' % codepoint
>     else:
>         return c
> 
> Keep in mind though that not all browser versions understand
> the complete list of HTML entity names.  That's why I would
> strongly recommend against using entity names.
> 
> Also note that if you need apostrophes escaped too, you'll need to
> put in another special case for that as the htmlentitydefs does
> not have an entry for "apos" for some reason.
> 
> > And no, I'm not going to put the info in the database in
> > utf-8, that must remain html quoted for many other locations where it
> > goes wrong otherwise.
> 
> Your choice.  Actually though, MySQL handles Unicode brilliantly,
> and if you could ever convert to that you'll make things a lot
> easier on yourself in the future.

From jpg at jgassociates.ca  Wed May 17 11:46:29 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Wed May 17 11:45:32 2006
Subject: [mod_python] Problem with html quoted/unquoted
In-Reply-To: <1147879049.8449.135.camel@cm222-167-159-88.hkcable.com.hk>
References: <1147837098.17770.175.camel@pistachio.squirrel>	<5c06fa770605170802j4cf0cfffg4bccb38c1bdb9cba@mail.gmail.com>
	<1147879049.8449.135.camel@cm222-167-159-88.hkcable.com.hk>
Message-ID: <446B4555.9040308@jgassociates.ca>

Wouter van Marle wrote:
> Dear Deron,
> 
> Thank you for the comments. I understand your ideas; unfortunately it
> does not solve my problem.
> 
> The info I get from another website, this origin gives me the info in
> the ampersand form (that third party site is a Netscape server by the
> way! Didn't know they are still in use, very remarkable). And I like
> that.
> The main reason to continue using that format is the " (double-quotes)
> and ' (single quotes). These characters are used in the data that I try
> to store in the mysql base, and that fantastically messes up with the
> queries....
> imagine: s = "this is 'a' string"
> then say query = """ SELECT * FROM base WHERE field = "%s";"""% s
> 
> But what about when s can be 'this is "a" string'
> or s = """this is a 5", 'b' sized thing""".


Don't build your query string that way, *especially* if you are getting 
data from an untrusted source. You are laying yourself open to a SQL 
injection attack. You want to use parameter passing. (for MySQLdb)

cur.execute("SELECT * FROM base WHERE field = %s", s)

The DBI will escape the quote characters for you (as well as the ';' 
character), and stick quotes around the %s in the query string if required.

Jim
From wouter at squirrel-systems.com  Wed May 17 11:53:23 2006
From: wouter at squirrel-systems.com (Wouter van Marle)
Date: Wed May 17 11:53:30 2006
Subject: [mod_python] Problem with html quoted/unquoted
In-Reply-To: <446B4555.9040308@jgassociates.ca>
References: <1147837098.17770.175.camel@pistachio.squirrel>
	<5c06fa770605170802j4cf0cfffg4bccb38c1bdb9cba@mail.gmail.com>
	<1147879049.8449.135.camel@cm222-167-159-88.hkcable.com.hk>
	<446B4555.9040308@jgassociates.ca>
Message-ID: <1147881203.8449.140.camel@cm222-167-159-88.hkcable.com.hk>

On Wed, 2006-05-17 at 11:46 -0400, Jim Gallacher wrote:
> Wouter van Marle wrote:
> > Dear Deron,
> > 
> > Thank you for the comments. I understand your ideas; unfortunately it
> > does not solve my problem.
> > 
> > The info I get from another website, this origin gives me the info in
> > the ampersand form (that third party site is a Netscape server by the
> > way! Didn't know they are still in use, very remarkable). And I like
> > that.
> > The main reason to continue using that format is the " (double-quotes)
> > and ' (single quotes). These characters are used in the data that I try
> > to store in the mysql base, and that fantastically messes up with the
> > queries....
> > imagine: s = "this is 'a' string"
> > then say query = """ SELECT * FROM base WHERE field = "%s";"""% s
> > 
> > But what about when s can be 'this is "a" string'
> > or s = """this is a 5", 'b' sized thing""".
> 
> 
> Don't build your query string that way, *especially* if you are getting 
> data from an untrusted source. You are laying yourself open to a SQL 
> injection attack. You want to use parameter passing. (for MySQLdb)
> 
> cur.execute("SELECT * FROM base WHERE field = %s", s)

I have tried this (once) with MySQLdb, and it doesn't seem to work like
that. (v1.2.1g2) Didn't pursue the issue further.

I am aware of the issues of SQL injection. For that reason I've given
the web script a special user with only very limited capabilities, to at
least make it a little harder for attackers.

Wouter.

> 
> The DBI will escape the quote characters for you (as well as the ';' 
> character), and stick quotes around the %s in the query string if required.
> 
> Jim
> 
> 

From jarrod at vertigrated.com  Wed May 17 17:30:12 2006
From: jarrod at vertigrated.com (jarrod roberson)
Date: Wed May 17 17:30:20 2006
Subject: [mod_python] Strange Issue with modules "disappearing" while server
	is running.
Message-ID: <2389d4730605171430i18387d12x58edbb6039222e89@mail.gmail.com>

we are having issues where we get WARNING "The xmllib module is obsolete.
Use xml.sax instead." while the server is running.
it doesn't happen at start up, only sporatically. as it works find for a
while, then throws this warning, sometimes like crazy then works find for a
while again.
we are using the xmlrpclib to make calls to an external service.
we can't figure out why mod_python is not caching this module, or the
pyexpat module that it can't find.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060517/cd414022/attachment.html
From deron.meranda at gmail.com  Wed May 17 17:44:46 2006
From: deron.meranda at gmail.com (Deron Meranda)
Date: Wed May 17 17:44:52 2006
Subject: [mod_python] Strange Issue with modules "disappearing" while
	server is running.
In-Reply-To: <2389d4730605171430i18387d12x58edbb6039222e89@mail.gmail.com>
References: <2389d4730605171430i18387d12x58edbb6039222e89@mail.gmail.com>
Message-ID: <5c06fa770605171444j69eb9b92v1ac8030951404d41@mail.gmail.com>

On 5/17/06, jarrod roberson <jarrod@vertigrated.com> wrote:
> we are having issues where we get WARNING "The xmllib module is obsolete.
> Use xml.sax instead." while the server is running.
> it doesn't happen at start up, only sporatically. as it works find for a
> while, then throws this warning, sometimes like crazy then works find for a
> while again.
> we are using the xmlrpclib to make calls to an external service.
> we can't figure out why mod_python is not caching this module, or the
> pyexpat module that it can't find.

Sporadic issues like this are often caused by using a forking-style
Apache MPM.  Each Apache process (and thus mod_python
environment) is separate.  A module imported into one process is
not automatically imported into the other ones.

So it could be that the appropriate module has already been imported
into one of the processes (perhaps by the sequence through which
you click through your pages), but not in others.

Also you may have other mod_python based applications running
which are importing conflicting modules, etc.  You can always try
to use the PythonInterpreter option to isolate your own modules
if you think that is an issue.
-- 
Deron Meranda

From mmokrejs at ribosome.natur.cuni.cz  Wed May 17 17:46:53 2006
From: mmokrejs at ribosome.natur.cuni.cz (=?UTF-8?B?TWFydGluIE1PS1JFSsWg?=)
Date: Wed May 17 17:47:06 2006
Subject: [mod_python] Problem with html quoted/unquoted
In-Reply-To: <1147837098.17770.175.camel@pistachio.squirrel>
References: <1147837098.17770.175.camel@pistachio.squirrel>
Message-ID: <446B99CD.2020702@ribosome.natur.cuni.cz>

Hi,
  I have just spent about 4 days implementing utf8 support in my webapp using
mod_python, mysql-python-1.2.1, ElementTree and mysql-5.0. It turned out after
adding:

<HEAD>
  <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">
</HEAD>

and setting

req.content_type = "text/html; charset=UTF-8"

in the top-level index() function when using mod_python.publisher.

I always get UTF8 data back from the user becasue of teh above then.
Thus, there was no need to convert the data from POSTed HTML forms to unicode
and to push the data in unicode using
   connect(..., use_unicode=True, charset='utf8')
That didn't work unless I updated to mysql-python-1.2.1 anyway. Still, I felt
I can live with strings in utf-8 encoding and forget about conversion to unicode.
But, using use unicode=False has shown a bug in mysql-python-1.2.1, so I filed
a bug report on that and had to patch two lines. Next two days I spent figuring
out why the data in exported XML files are screwed up. Yes, I do have to pass
unicode objects to ElementTree.
Tables in mysql I have charset set to utf8 charset, connection charset is utf8,
Check also output from 'show full columns from $tablename'. Why don't you want
to store utf8 data in mysql tables? It is supported, you can search on them,
you can "ignore" the accented chars on searches if you wish ...

In summary, except debugging print calls which use 'ascii' encoding to
convert whatever object to string, I get always nice UTF-8 data back to the
browser and browser always post in that encoding. Internally, I do not have to
convert to unicode at all except the ElementTree problem.
In case of those print calls used for debugging or when exceptions are raised,
I get the \xc2, etc. In all other cases, I have strings, sometimes use
isinstance(_var, basestring) checks and only once use unicode() call,
actually _str.decode('utf8), when feeding data in (c)ElementTree.

Regarding the entity problem, I had the same problem when I fed utf8 strings
into ElementTree, I got out '&#174', etc. That got fixed after feeding in unicode
objects directly. I thought about htmltidy, actually tidy which I think
has some pythonic interface, but probably as you said urllib has similar
functionality.

Hope this helps
Martin

Wouter van Marle wrote:
> Hi all,
> 
> I have a problem with POST requests - loosely related to mod_python but
> I don't know a better place to ask.
> 
> I have a website run by python/mod_python/apache2, using a MySQL
> database (accessed through MySQLdb).
> 
> For html compatibility reasons, I store all the search data in the MySQL
> database in html-quoted format. The term in question that I ran into is:
> "Jubil?umsmodell", stored in the database as "Jubil&auml;umsmodell".
> 
> The select in the html source, as presented to the browser, is fine (the
> html line is abbreviated for here; it contains many more options):
> <select name=model>
> 	<option value="Jubil&auml;umsmodell 40 Jahre">Jubil&auml;umsmodell 40
> Jahre</option>
> </select>
> 
> It is rendered correctly of course by the browser.
> Now when the user clicks go, and the POST is generated, the character is
> sent back in what I guess is UTF-8 encoding (I assume it's that, as
> that's my default encoding) (again only a snippet):
> &model=Jubil%C3%A4umsmodell+40+Jahre
> 
> And as you can imagine this messes up the search in the MySQL database,
> where I can find the term only if it's html quoted again.
> 
> So the end of the whole story, the actual question is now: how do I get
> from this utf-8 encoding back to html quoted encoding, for searching in
> the database? And no, I'm not going to put the info in the database in
> utf-8, that must remain html quoted for many other locations where it
> goes wrong otherwise.
> 
> Wouter.
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 
> 

-- 
Dr. Martin Mokrejs
Faculty of Science, Charles University
Vinicna 5, 128 43 Prague, Czech Republic
http://www.iresite.org
http://www.iresite.org/~mmokrejs
From gdamjan at mail.net.mk  Wed May 17 17:57:48 2006
From: gdamjan at mail.net.mk (Damjan)
Date: Wed May 17 17:57:53 2006
Subject: [mod_python] Can mod_python control other Apache mdoules and Apache
	configuration
Message-ID: <20060517215748.GB7096@legolas.on.net.mk>

Generaly my question is if it's possible to use a mod_python script to
define massive virtual hosts, each with it's own specific configuration.

For example, a handler that would catch the request early
(PythonPostReadRequestHandler??) and then setup the DocumentRoot,
php_admin_value, ErrorLog, CustomLog or SCGIMount Apache directives.

Is this possible ?



-- 
damjan | ??????
This is my jabber ID -->         damjan@bagra.net.mk 
 -- not my mail address, it's a Jabber ID --^ :)
From jpg at jgassociates.ca  Wed May 17 18:09:07 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Wed May 17 18:06:24 2006
Subject: [mod_python] Problem with html quoted/unquoted
In-Reply-To: <1147881203.8449.140.camel@cm222-167-159-88.hkcable.com.hk>
References: <1147837098.17770.175.camel@pistachio.squirrel>	<5c06fa770605170802j4cf0cfffg4bccb38c1bdb9cba@mail.gmail.com>	<1147879049.8449.135.camel@cm222-167-159-88.hkcable.com.hk>	<446B4555.9040308@jgassociates.ca>
	<1147881203.8449.140.camel@cm222-167-159-88.hkcable.com.hk>
Message-ID: <446B9F03.20704@jgassociates.ca>

Wouter van Marle wrote:
> On Wed, 2006-05-17 at 11:46 -0400, Jim Gallacher wrote:
>> Wouter van Marle wrote:
>>> Dear Deron,
>>>
>>> Thank you for the comments. I understand your ideas; unfortunately it
>>> does not solve my problem.
>>>
>>> The info I get from another website, this origin gives me the info in
>>> the ampersand form (that third party site is a Netscape server by the
>>> way! Didn't know they are still in use, very remarkable). And I like
>>> that.
>>> The main reason to continue using that format is the " (double-quotes)
>>> and ' (single quotes). These characters are used in the data that I try
>>> to store in the mysql base, and that fantastically messes up with the
>>> queries....
>>> imagine: s = "this is 'a' string"
>>> then say query = """ SELECT * FROM base WHERE field = "%s";"""% s
>>>
>>> But what about when s can be 'this is "a" string'
>>> or s = """this is a 5", 'b' sized thing""".
>>
>> Don't build your query string that way, *especially* if you are getting 
>> data from an untrusted source. You are laying yourself open to a SQL 
>> injection attack. You want to use parameter passing. (for MySQLdb)
>>
>> cur.execute("SELECT * FROM base WHERE field = %s", s)
> 
> I have tried this (once) with MySQLdb, and it doesn't seem to work like
> that. (v1.2.1g2) Didn't pursue the issue further.

You must be doing something wrong. A quick test on my system:

 >>> s = """This is 'some' stuff with "quotes" and stuff"""
 >>> cursor.execute('insert into testtable (data) values (%s)', s)
1L

mysql.log output
----------------

060517 17:27:39	     75 Query       insert into testtable (data) values 
('This is \'some\' stuff with \"quotes\" and stuff')

This really is the correct way to pass parameters to your query.

> I am aware of the issues of SQL injection. For that reason I've given
> the web script a special user with only very limited capabilities, to at
> least make it a little harder for attackers.

Don't make it hard, make it impossible. Bugtraq has reports of SQL 
injection attacks in PHP applications almost every day. This sort of 
problem can be avoided in python by using the appropriate mechanism for 
executing SQL queries, so do yourself a favour and get in the habit of 
doing it the right way. DB access should be restricted to the bare 
minimum required for your app to work anyway, but should not be a 
substitute for writing a secure application in the first place. Your 
requirements may change in the future which necessitate relaxing the db 
restrictions, and then you are faced with auditing your code to correct 
the deficiencies, or even worse you'll have completely forgotten about 
the security issue.

I hope I'm not sounding too harsh here Wouter, as that is not my 
intention. I'm just trying to help.

Jim
From grahamd at dscpl.com.au  Wed May 17 18:28:59 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed May 17 18:29:11 2006
Subject: [mod_python] Can mod_python control other Apache mdoules and
	Apacheconfiguration
Message-ID: <1147904939.17054@dscpl.user.openhosting.com>

Damjan wrote ..
> Generaly my question is if it's possible to use a mod_python script to
> define massive virtual hosts, each with it's own specific configuration.
> 
> For example, a handler that would catch the request early
> (PythonPostReadRequestHandler??) and then setup the DocumentRoot,
> php_admin_value, ErrorLog, CustomLog or SCGIMount Apache directives.
> 
> Is this possible ?

Short answer is no.

You might be better off using mod_perl for this purpose as it has a means
of constructing Apache configuration programmatically at Apache startup.
For a prior reference to this, see:

  http://www.modpython.org/pipermail/mod_python/2003-March/013485.html

Graham
From smilelover at centrum.cz  Thu May 18 05:17:18 2006
From: smilelover at centrum.cz (.: smilelover :.)
Date: Thu May 18 05:17:32 2006
Subject: [mod_python] Session Management, Straight Answer?
In-Reply-To: <118F66E8-0489-4502-991D-F9678792486A@dscpl.com.au>
References: 20060516040605.94759.qmail@web82005.mail.mud.yahoo.com>
	<200605171014.3919@centrum.cz>
	<118F66E8-0489-4502-991D-F9678792486A@dscpl.com.au>
Message-ID: <200605181117.14606@centrum.cz>

Thanks for comments!
Yes, yes, the timeout is OK. The thing I sent was purely experimental, just to learn sessions and to check out how timeout works.

Thanks also for info about PSP.

Robust :) ...yes, it might not be. just experimenting so far..

So where exactly do you create sessions? Do you have any special handler set in htaccess for that and point to it when needed?

Dan
______________________________________________________________
> Od: grahamd@dscpl.com.au
> Komu:  ".: smilelover :." <smilelover@centrum.cz>
> CC:  <mod_python@modpython.org>
> Datum: 17.05.2006 12:38
> P?edm?t: Re: [mod_python] Session Management, Straight Answer?
>
>  I'm not sure you actually need the load() and delete() calls. The load ()
> is
> called from the constructor and the delete() from invalidate().
> 
> The session timeout is specified as seconds. Do you really mean to  have
> it
> be 30 seconds? The default timeout is 30 minutes.
> 
> If you are using mod_python 3.2.7 or later and are using PSP in 
> conjunction
> with publisher, set req.session to your session object and PSP will 
> automatically
> use it rather than create its own when "session" attribute is  accessed in
> a page.
> That way you can still access it from the PSP page.
> 
> At a quick glance, am bit concerned about whether it is is robust as  a
> whole,
> but don't have access to my own code at present and don't have time to
> play with your code.
> 
> FWIW, I don't do my session creation management from the content handler
> but in an earlier phase with the session object being left in 
> req.session. This
> way the session management will work no matter whether you are using PSP
> pages, publisher, a mix of these or even custom handlers. Thus the 
> session
> management becomes a reusable unit in itself. Can't remember though 
> whether
> I was dependent on features specifically in mod_python 3.3 though.
> 
> Graham
> 
> 
> On 17/05/2006, at 6:14 PM, .: smilelover :. wrote:
> 
> > I also struggled a lot to understand the sessions stuff and now I  > use
> sessions this way:
> >
> > in index I enter login and pass in a form and send it to  > check_login,
> which checks the login data and if correct, creates a  > session object,
> fills it with the data I need it to bear, sets  > timeout and saves it. On
> the check_login page there is a link that  > points to  "section" (some
> imaginary section, as if in some admin  > pass-protected area). In the
> section, I create another session  > object, but the first thing I do with
> it is sess.load(), which  > loads the data of the previously saved session.
> And thats it.
> >
> > I attached the code and templates (I use publisher) + .htaccess  > file.
> It should work for you.
> > With regular PSP it's probably different, as Graham wrote.
> >
> > This is the way I use it and it is quite possible it is some  >
> deprecated way. I don't know :) If anyone of you knows there are  > some
> serious mistakes in the way I use sessions, don't hesitate and  > post it
> here.
> > Thx.
> >
> > Dan
> > ______________________________________________________________
> >> Od: max_lynch@sbcglobal.net
> >> Komu:  mod_python@modpython.org
> >> CC:
> >> Datum: 16.05.2006 06:08
> >> P?edm?t: [mod_python] Session Management, Straight Answer?
> >>
> >>  I have looked at many of the session management posts on the  >> list,
> but I
> >> am looking for a straightforward answer on how to make session data
> >> persist through different pages.  I have seen examples on using
> >> cookies/etc., but I would like a formal answer as it seems many  >>
> people are
> >> also stuck on this (I might post my experiences with mod_python on  >>
> a site
> >> as first-hand documentation, so that could help).  Also, I am  >> using
> psp,
> >> not the publisher stuff.  Love mod_python so far though, just a  >>
> little
> >> stuck!
> >>
> >> Thanks,
> >> Max Lynch
> >>
> >> _______________________________________________
> >> Mod_python mailing list
> >> Mod_python@modpython.org
> >> http://mailman.modpython.org/mailman/listinfo/mod_python
> >>
> >>
> >
> > <session.zip>
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> 
> </session.zip>

From David.Bear at asu.edu  Thu May 18 12:08:22 2006
From: David.Bear at asu.edu (David Bear)
Date: Thu May 18 12:08:31 2006
Subject: [mod_python] namespace available to psp
Message-ID: <20060518160822.GO28842@asu.edu>

When using psp called from publisher, what is the namespace shared
between the instance of publisher and the called psp?

I modelled a test of the templating example from modpython.org. 

I have a function call _any_page that is called to setup any/all
objects passed to a psp page.

in that function I have 

vars = {"mytest": "this is  atest"}

then, in my psp page I have

<%= mytest %>

When run, ie. when called from the publisher script I get a Namerror
exception -- that mytest is not defined.

so then I tried

<%= locals() %> in the psp page and looked at the namespace. I didn't
see any of the vars defined in the publisher script.



-- 
David Bear
phone: 	480-965-8257
fax: 	480-965-9189
College of Public Programs/ASU
Wilson Hall 232
Tempe, AZ 85287-0803
 "Beware the IP portfolio, everyone will be suspect of trespassing"
From jpg at jgassociates.ca  Thu May 18 12:19:24 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Thu May 18 12:19:04 2006
Subject: [mod_python] namespace available to psp
In-Reply-To: <20060518160822.GO28842@asu.edu>
References: <20060518160822.GO28842@asu.edu>
Message-ID: <446C9E8C.6000605@jgassociates.ca>

David Bear wrote:
> When using psp called from publisher, what is the namespace shared
> between the instance of publisher and the called psp?
> 
> I modelled a test of the templating example from modpython.org. 
> 
> I have a function call _any_page that is called to setup any/all
> objects passed to a psp page.
> 
> in that function I have 
> 
> vars = {"mytest": "this is  atest"}
> 
> then, in my psp page I have
> 
> <%= mytest %>
> 
> When run, ie. when called from the publisher script I get a Namerror
> exception -- that mytest is not defined.
> 
> so then I tried
> 
> <%= locals() %> in the psp page and looked at the namespace. I didn't
> see any of the vars defined in the publisher script.
> 

You are passing in vars in the PSP() constructor or in the run() method, 
right?

tmpl = psp.PSP(req, filename=filename, vars=vars)
or
tmpl.run(vars)

Jim


From amarrero at mitre.org  Thu May 18 14:40:56 2006
From: amarrero at mitre.org (Alexis Marrero)
Date: Thu May 18 14:44:35 2006
Subject: [mod_python] Problems with mp_request.read(length)
Message-ID: <4FAFD871-8E90-4E9B-B756-BAE4983661A3@mitre.org>

All,

I have been experimenting with mod_python.util.FieldStorage() and  
changing it so it will recognize and use Content-Length for a  
particular field.

I noticed that if I make a call to req.read(length) where length is  
greater than 65646 the data is corrupted.  You can try different  
numbers and find what the boundary exactly is for your system.  It is  
a very weird error. Using req.readline(length) would behave perfectly  
(assuming there are no new lines in the data).

Does anyone has an idea why this could happen?


/amn
From grahamd at dscpl.com.au  Thu May 18 16:37:53 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu May 18 16:38:15 2006
Subject: [mod_python] Problems with mp_request.read(length)
In-Reply-To: <4FAFD871-8E90-4E9B-B756-BAE4983661A3@mitre.org>
References: <4FAFD871-8E90-4E9B-B756-BAE4983661A3@mitre.org>
Message-ID: <EFD2AA63-DC60-4123-94FA-BA73C854E791@dscpl.com.au>


On 19/05/2006, at 4:40 AM, Alexis Marrero wrote:

> All,
>
> I have been experimenting with mod_python.util.FieldStorage() and  
> changing it so it will recognize and use Content-Length for a  
> particular field.
>
> I noticed that if I make a call to req.read(length) where length is  
> greater than 65646 the data is corrupted.  You can try different  
> numbers and find what the boundary exactly is for your system.  It  
> is a very weird error. Using req.readline(length) would behave  
> perfectly (assuming there are no new lines in the data).
>
> Does anyone has an idea why this could happen?

Can you state which version of mod_python and Apache you are using.

Graham
From grahamd at dscpl.com.au  Thu May 18 17:07:10 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu May 18 17:07:18 2006
Subject: [mod_python] Problems with mp_request.read(length)
In-Reply-To: <1E026DDC-6119-4EC8-BCB5-F9B99E1891B0@mitre.org>
References: <4FAFD871-8E90-4E9B-B756-BAE4983661A3@mitre.org>
	<EFD2AA63-DC60-4123-94FA-BA73C854E791@dscpl.com.au>
	<1E026DDC-6119-4EC8-BCB5-F9B99E1891B0@mitre.org>
Message-ID: <0B439E9F-5451-4B10-B6CB-8E0DEC48B0C3@dscpl.com.au>

I'd suggest you upgrade to 3.2.8 before going any further. There was
various fixes done to FieldStatorage related to large files in it.

On 19/05/2006, at 6:38 AM, Alexis Marrero wrote:

> Apache 2.0.54
> mod_python 3.1.4
>
> I would suggest that you try to read a  field for which you know  
> its content length put it in a file and md5 the original data and  
> the one you get by the read().
>
> /amn
> On May 18, 2006, at 4:37 PM, Graham Dumpleton wrote:
>
>>
>> On 19/05/2006, at 4:40 AM, Alexis Marrero wrote:
>>
>>> All,
>>>
>>> I have been experimenting with mod_python.util.FieldStorage() and  
>>> changing it so it will recognize and use Content-Length for a  
>>> particular field.
>>>
>>> I noticed that if I make a call to req.read(length) where length  
>>> is greater than 65646 the data is corrupted.  You can try  
>>> different numbers and find what the boundary exactly is for your  
>>> system.  It is a very weird error. Using req.readline(length)  
>>> would behave perfectly (assuming there are no new lines in the  
>>> data).
>>>
>>> Does anyone has an idea why this could happen?
>>
>> Can you state which version of mod_python and Apache you are using.
>>
>> Graham

From David.Bear at asu.edu  Thu May 18 17:31:32 2006
From: David.Bear at asu.edu (David Bear)
Date: Thu May 18 17:31:39 2006
Subject: [mod_python] namespace available to psp
In-Reply-To: <446C9E8C.6000605@jgassociates.ca>
References: <20060518160822.GO28842@asu.edu> <446C9E8C.6000605@jgassociates.ca>
Message-ID: <20060518213132.GP28842@asu.edu>

this is it. yes. I was not passing vars when I called the psp.

On Thu, May 18, 2006 at 12:19:24PM -0400, Jim Gallacher wrote:
> David Bear wrote:
> >When using psp called from publisher, what is the namespace shared
> >between the instance of publisher and the called psp?
> >
> >I modelled a test of the templating example from modpython.org. 
> >
> >I have a function call _any_page that is called to setup any/all
> >objects passed to a psp page.
> >
> >in that function I have 
> >
> >vars = {"mytest": "this is  atest"}
> >
> >then, in my psp page I have
> >
> ><%= mytest %>
> >
> >When run, ie. when called from the publisher script I get a Namerror
> >exception -- that mytest is not defined.
> >
> >so then I tried
> >
> ><%= locals() %> in the psp page and looked at the namespace. I didn't
> >see any of the vars defined in the publisher script.
> >
> 
> You are passing in vars in the PSP() constructor or in the run() method, 
> right?
> 
> tmpl = psp.PSP(req, filename=filename, vars=vars)
> or
> tmpl.run(vars)
> 
> Jim
> 

-- 
David Bear
phone: 	480-965-8257
fax: 	480-965-9189
College of Public Programs/ASU
Wilson Hall 232
Tempe, AZ 85287-0803
 "Beware the IP portfolio, everyone will be suspect of trespassing"
From jaba at findyourcore.com  Thu May 18 18:25:23 2006
From: jaba at findyourcore.com (jaba@findyourcore.com)
Date: Thu May 18 18:25:27 2006
Subject: [mod_python] Form upload
Message-ID: <50450.68.239.2.246.1147991123.squirrel@findyourcore.com>

heres my code:

#########upload.py#########

from mod_python import util
import sys
def handler(req):
    sys.stdout=sys.stderr=req
    form=util.FieldStorage(req)
    if form.has_key("file"):print form.list[0].file.getvalue()
    print "<form method=post><input type=file name=file></form>"

###########################

the problem is, it only returns the filename, not the file contents.
Whats wrong?
From grahamd at dscpl.com.au  Thu May 18 18:53:42 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu May 18 18:53:47 2006
Subject: [mod_python] Form upload
Message-ID: <1147992822.25499@dscpl.user.openhosting.com>

jaba@findyourcore.com wrote ..
> heres my code:
> 
> #########upload.py#########
> 
> from mod_python import util
> import sys
> def handler(req):
>     sys.stdout=sys.stderr=req
>     form=util.FieldStorage(req)
>     if form.has_key("file"):print form.list[0].file.getvalue()
>     print "<form method=post><input type=file name=file></form>"
> 
> ###########################
> 
> the problem is, it only returns the filename, not the file contents.
> Whats wrong?

Am sure someone else will answer your real question, I can't remember
off the top of my head how to handle files as not something I do.
Anyway, would like to point out some other things you are doing wrong.

The main issue is that you MUST not set sys.stdout/sys.stderr to the
req object and then use "print". This will blow up in bad ways if you
are using a multithreaded MPM such as used on Win32 or "worker"
on UNIX. If you really want to use "print", leave sys.std??? alone and
use:

  if form.has_key("file"):
    print >> req, form.list[0].file.getvalue()
  print >> req, "<form method=post><input type=file name=file></form>"

Ie., use ">>" redirection to make it print to the req object.

Since you are returning HTML, also make sure you set content type.

  req.content_type = 'text/html'

before first content written. Don't assume browsers will always guess
correctly.

Also, I assume that not returning apache.OK is purely because you
didn't need it necessary to supply all the code????

Graham
  
From grahamd at dscpl.com.au  Thu May 18 19:14:42 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu May 18 19:14:50 2006
Subject: [mod_python] Form upload
Message-ID: <1147994080.4855@dscpl.user.openhosting.com>

Please keep followups on the mailing list. Response at end of message.

jaba@findyourcore.com wrote ..
> > jaba@findyourcore.com wrote ..
> >> heres my code:
> >>
> >> #########upload.py#########
> >>
> >> from mod_python import util
> >> import sys
> >> def handler(req):
> >>     sys.stdout=sys.stderr=req
> >>     form=util.FieldStorage(req)
> >>     if form.has_key("file"):print form.list[0].file.getvalue()
> >>     print "<form method=post><input type=file name=file></form>"
> >>
> >> ###########################
> >>
> >> the problem is, it only returns the filename, not the file contents.
> >> Whats wrong?
> >
> > Am sure someone else will answer your real question, I can't remember
> > off the top of my head how to handle files as not something I do.
> > Anyway, would like to point out some other things you are doing wrong.
> >
> > The main issue is that you MUST not set sys.stdout/sys.stderr to the
> > req object and then use "print". This will blow up in bad ways if you
> > are using a multithreaded MPM such as used on Win32 or "worker"
> > on UNIX. If you really want to use "print", leave sys.std??? alone and
> > use:
> >
> >   if form.has_key("file"):
> >     print >> req, form.list[0].file.getvalue()
> >   print >> req, "<form method=post><input type=file name=file></form>"
> >
> > Ie., use ">>" redirection to make it print to the req object.
> >
> > Since you are returning HTML, also make sure you set content type.
> >
> >   req.content_type = 'text/html'
> >
> > before first content written. Don't assume browsers will always guess
> > correctly.
> >
> > Also, I assume that not returning apache.OK is purely because you
> > didn't need it necessary to supply all the code????
> >
> > Graham
> 
> How would it blow up? (its a little annoying doing the "print >> req,"
> all
> the time.
> And yes, your assumption is correct.

In a multithreaded MPM, multiple requests can be executing in the same
Apache child process at the same time. Further, they could be executing
in the same handler at the same time. If a handler modifies sys.std???
and sets it to the req object for a particular request, it may get replaced
by that for a different request before it even got to use it. Thus you will
get responses going back to the wrong clients. Further, after a handler
returns, the req object internals have been deleted, although the Python
wrapper will not. Any write to the req object at that point will cause
Apache to crash usually.

Graham
From David.Bear at asu.edu  Thu May 18 21:19:43 2006
From: David.Bear at asu.edu (David Bear)
Date: Thu May 18 21:19:47 2006
Subject: [mod_python] more psp and publisher questions
Message-ID: <20060519011943.GU28842@asu.edu>

I'm using the publisher handler and psp example framework. I would
much rather have something like tal in zope -- but psp will work for
now.

The general model is to have a dispatcher script call psp pages. As I
was deconstructing an existing html form I realized that I would like
to create multipe psp files -- and then include them in other psp
files.

For example, I create a form that only has form html in it, and form
fields are populated by psp statements.

Then I have a main page that wants to include the form psp file.

How does the form psp file access the same name space as the main psp
file?

for example, in main I instantiate some 'global variables'


<% myform = "<form>bla blah bal </form>"
   myftemplate = "formtemplate.psp"
   formsubmit = "http://myserver/modpython.py/submit" %>
<html>
more blah...
  <%= myform %>
  <%= myftemplate %>
</html>

then formtemplate.psp has
<form name="test" method="post" action="<%= formsubmit %>">
blahh..


How would the formtemplate.psp file 'know' about the name 'formsubmit'
declared in the first template?

and as I write this, I'm not sure I even understand how one psp file
would call another...

I need some more examples on using psp's and calling them from
publisher scripts -- and from each other.  I been going through the
modpython.org docs and its not enough for to understand this yet.

-- 
David Bear
phone: 	480-965-8257
fax: 	480-965-9189
College of Public Programs/ASU
Wilson Hall 232
Tempe, AZ 85287-0803
 "Beware the IP portfolio, everyone will be suspect of trespassing"
From grahamd at dscpl.com.au  Thu May 18 21:47:35 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu May 18 21:47:42 2006
Subject: [mod_python] more psp and publisher questions
Message-ID: <1148003255.10566@dscpl.user.openhosting.com>

David Bear wrote ..
> and as I write this, I'm not sure I even understand how one psp file
> would call another...

Try:

  <%@ include file="/file/to/include"%>

>From memory, you don't have to have an absolute path, you can use relative
path with directory corresponding to req.filename name being your starting
point. I could be wrong about that though.

Graham
From terry.macdonald at dsl.pipex.com  Fri May 19 06:13:31 2006
From: terry.macdonald at dsl.pipex.com (Terry Macdonald)
Date: Fri May 19 06:15:15 2006
Subject: [mod_python] Form upload
In-Reply-To: <1147994080.4855@dscpl.user.openhosting.com>
References: <1147994080.4855@dscpl.user.openhosting.com>
Message-ID: <446D9A4B.8040909@dsl.pipex.com>


"sys.stdout=sys.stderr=req"

This may be a dumb question but I'm not getting it...
What does the above line do?
Why does one want to set standard error and standard out to the request 
object?
What does printing to the request object do?
...and how does it work?

I'm missing something fundamentally object oriented here, aren't I?

I just see objects that are used to print stuff and then a request 
object which contains request information. I'm not getting the link.


Cheers
From grahamd at dscpl.com.au  Fri May 19 06:58:58 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Fri May 19 06:59:06 2006
Subject: [mod_python] Form upload
In-Reply-To: <446D9A4B.8040909@dsl.pipex.com>
References: <1147994080.4855@dscpl.user.openhosting.com>
	<446D9A4B.8040909@dsl.pipex.com>
Message-ID: <55FB5E45-2FF3-47D8-954C-A3F96B006B06@dscpl.com.au>


On 19/05/2006, at 8:13 PM, Terry Macdonald wrote:

>
> "sys.stdout=sys.stderr=req"
>
> This may be a dumb question but I'm not getting it...
> What does the above line do?
> Why does one want to set standard error and standard out to the  
> request object?
> What does printing to the request object do?
> ...and how does it work?
>
> I'm missing something fundamentally object oriented here, aren't I?
>
> I just see objects that are used to print stuff and then a request  
> object which contains request information. I'm not getting the link.

Both sys.stderr and sys.stdout are file objects. The primary method  
for writing
data is the "write()" member function. It is the "write()" member  
function that "print"
calls on the sys.stdout file object.

Outside of mod_python, you could replace sys.stdout with some other  
file object,
for example an open log file, and every use of "print" in the program  
would see that
output go to the log file instead.

In practice, sys.stdout doesn't actually have to be a file object,  
just a file like
object which provides a "write()" method. As a "req" object provides  
a "write()"
function, it could technically thus be used as a substitute for  
sys.stdout. As I
pointed out in prior email though, this would actually be a dangerous  
thing
to do in mod_python where a multithreaded MPM is being used.

Hope this makes sense.

Graham
From terry.macdonald at dsl.pipex.com  Fri May 19 07:38:45 2006
From: terry.macdonald at dsl.pipex.com (Terry Macdonald)
Date: Fri May 19 07:40:32 2006
Subject: [mod_python] Form upload
In-Reply-To: <55FB5E45-2FF3-47D8-954C-A3F96B006B06@dscpl.com.au>
References: <1147994080.4855@dscpl.user.openhosting.com>
	<446D9A4B.8040909@dsl.pipex.com>
	<55FB5E45-2FF3-47D8-954C-A3F96B006B06@dscpl.com.au>
Message-ID: <446DAE45.7060501@dsl.pipex.com>

Graham Dumpleton wrote:
>
> On 19/05/2006, at 8:13 PM, Terry Macdonald wrote:
>
>>
>> "sys.stdout=sys.stderr=req"
>>
>> This may be a dumb question but I'm not getting it...
>> What does the above line do?
>> Why does one want to set standard error and standard out to the 
>> request object?
>> What does printing to the request object do?
>> ...and how does it work?
>>
>> I'm missing something fundamentally object oriented here, aren't I?
>>
>> I just see objects that are used to print stuff and then a request 
>> object which contains request information. I'm not getting the link.
>
> Both sys.stderr and sys.stdout are file objects. The primary method 
> for writing
> data is the "write()" member function. It is the "write()" member 
> function that "print"
> calls on the sys.stdout file object.
>
> Outside of mod_python, you could replace sys.stdout with some other 
> file object,
> for example an open log file, and every use of "print" in the program 
> would see that
> output go to the log file instead.
>
> In practice, sys.stdout doesn't actually have to be a file object, 
> just a file like
> object which provides a "write()" method. As a "req" object provides a 
> "write()"
> function, it could technically thus be used as a substitute for 
> sys.stdout. As I
> pointed out in prior email though, this would actually be a dangerous 
> thing
> to do in mod_python where a multithreaded MPM is being used.
>
> Hope this makes sense.
>
> Graham
Thanks for the help/reply Graham

So effectively if you print something to the req object it morphs into a 
response back to the client browser?


From jpg at jgassociates.ca  Fri May 19 08:25:23 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Fri May 19 08:25:28 2006
Subject: [mod_python] Form upload
In-Reply-To: <446DAE45.7060501@dsl.pipex.com>
References: <1147994080.4855@dscpl.user.openhosting.com>	<446D9A4B.8040909@dsl.pipex.com>	<55FB5E45-2FF3-47D8-954C-A3F96B006B06@dscpl.com.au>
	<446DAE45.7060501@dsl.pipex.com>
Message-ID: <446DB933.5090109@jgassociates.ca>

Terry Macdonald wrote:
> Graham Dumpleton wrote:
>>
>> On 19/05/2006, at 8:13 PM, Terry Macdonald wrote:
>>
>>>
>>> "sys.stdout=sys.stderr=req"
>>>
>>> This may be a dumb question but I'm not getting it...
>>> What does the above line do?
>>> Why does one want to set standard error and standard out to the 
>>> request object?
>>> What does printing to the request object do?
>>> ...and how does it work?
>>>
>>> I'm missing something fundamentally object oriented here, aren't I?
>>>
>>> I just see objects that are used to print stuff and then a request 
>>> object which contains request information. I'm not getting the link.
>>
>> Both sys.stderr and sys.stdout are file objects. The primary method 
>> for writing
>> data is the "write()" member function. It is the "write()" member 
>> function that "print"
>> calls on the sys.stdout file object.
>>
>> Outside of mod_python, you could replace sys.stdout with some other 
>> file object,
>> for example an open log file, and every use of "print" in the program 
>> would see that
>> output go to the log file instead.
>>
>> In practice, sys.stdout doesn't actually have to be a file object, 
>> just a file like
>> object which provides a "write()" method. As a "req" object provides a 
>> "write()"
>> function, it could technically thus be used as a substitute for 
>> sys.stdout. As I
>> pointed out in prior email though, this would actually be a dangerous 
>> thing
>> to do in mod_python where a multithreaded MPM is being used.
>>
>> Hope this makes sense.
>>
>> Graham
> Thanks for the help/reply Graham
> 
> So effectively if you print something to the req object it morphs into a 
> response back to the client browser?

Yes, but as Graham says, the safe way to do that in mod_python is:

print >> req, "Stuff"

which is the same as:

req.write("Stuff\n")

Jim
From geoff at teammsa.com  Fri May 19 14:57:37 2006
From: geoff at teammsa.com (Geoff Skerrett)
Date: Fri May 19 15:02:40 2006
Subject: [mod_python] Custom Login with redirection back to referer
Message-ID: <000e01c67b76$18c419a0$6900a8c0@MSASALESGES2>

I am hoping someone can get me back on track and point me in thr right
direction.
 
I want to create a process where if the user requests a page they are not
authorized for then;
1) a custom logon form is displayed
2) the users submits and it is processed verifying against a database if the
user is valid
3) as part of the processing a session is created 
4) the session stores the some data  (userid, name, lastip, etc)
5) when complete the system redirects the user to the original page (ie the
referrer for the login)
 
I have a test case working and using the util.redirect function.  Everything
works fine, but the referred page is processed, it gets a new session so the
variables I have stored during the login page process aren't available to
the refered page.
 
What am I missing? What is the best strategy for storing the session
variables and dealing with this type of process ?
 
I am using the mp.publisher Apache/2.0.54 (Win32) mod_python/3.2.8
Python/2.4.1 Server
Geoff.
 


From deron.meranda at gmail.com  Fri May 19 15:49:10 2006
From: deron.meranda at gmail.com (Deron Meranda)
Date: Fri May 19 15:49:14 2006
Subject: [mod_python] Custom Login with redirection back to referer
In-Reply-To: <000e01c67b76$18c419a0$6900a8c0@MSASALESGES2>
References: <000e01c67b76$18c419a0$6900a8c0@MSASALESGES2>
Message-ID: <5c06fa770605191249h4f496066v77f85114d3602dd4@mail.gmail.com>

On 5/19/06, Geoff Skerrett <geoff@teammsa.com> wrote:
> I am hoping someone can get me back on track and point me in thr right
> direction.
>
> I want to create a process where if the user requests a page they are not
> authorized for then;
> 1) a custom logon form is displayed
> 2) the users submits and it is processed verifying against a database if the
> user is valid
> 3) as part of the processing a session is created
> 4) the session stores the some data  (userid, name, lastip, etc)
> 5) when complete the system redirects the user to the original page (ie the
> referrer for the login)
>
> I have a test case working and using the util.redirect function.  Everything
> works fine, but the referred page is processed, it gets a new session so the
> variables I have stored during the login page process aren't available to
> the refered page.
>
> What am I missing? What is the best strategy for storing the session
> variables and dealing with this type of process ?

First of all, be cautious using redirection for that purpose.  Proxy
servers, caching, and the like may decide to just cache the
redirects too.  And then you'd have cross-user contamination.

A better approach that more closely follows the HTTP standard
semantics is to have your authentication handler cause an
HTTP 403 error when the user doesn't have permissions.
      m.abort(403)

Then Apache will display the standard 403 error handler page.
You should replace/modify that page to contain some text
that provides a link to the login page
     <a href="/login">Please login to view this page</a>

Then your login page handler should capture the value of
the HTTP_REFERER (if any) and save it.  The referer in
this case will be the original URL which failed your access
control checks (not the 403 error page).  If you're putting
up an HTML login form, then stick the value of the
referer into a hidden <input> element, so you can preserve
it.  Note that you should handle the case where there is
no referer too.

After the user types in their login credentials and you
successfully process the login form and authenticate the user,
you can retrieve the value of the referer from the input field.
And if it exists do your redirect back to the original page.
Or you could display a "welcome" greeting page first, which
then contained a link to "go back" to the page you originally
tried to view.
-- 
Deron Meranda

From deron.meranda at gmail.com  Fri May 19 15:51:38 2006
From: deron.meranda at gmail.com (Deron Meranda)
Date: Fri May 19 15:51:42 2006
Subject: [mod_python] Custom Login with redirection back to referer
In-Reply-To: <5c06fa770605191249h4f496066v77f85114d3602dd4@mail.gmail.com>
References: <000e01c67b76$18c419a0$6900a8c0@MSASALESGES2>
	<5c06fa770605191249h4f496066v77f85114d3602dd4@mail.gmail.com>
Message-ID: <5c06fa770605191251v61cee597vd62813e573dbb813@mail.gmail.com>

> A better approach that more closely follows the HTTP standard
> semantics is to have your authentication handler cause an
> HTTP 403 error when the user doesn't have permissions.
>       m.abort(403)

Oops, should be

    raise apache.SERVER_RETURN, apache.HTTP_FORBIDDEN
-- 
Deron Meranda

From jaba at findyourcore.com  Fri May 19 22:52:29 2006
From: jaba at findyourcore.com (jaba@findyourcore.com)
Date: Fri May 19 22:52:33 2006
Subject: [mod_python] Form upload
In-Reply-To: <446D5B0E.4060709@natlab.research.philips.com>
References: <50450.68.239.2.246.1147991123.squirrel@findyourcore.com>
	<446D5B0E.4060709@natlab.research.philips.com>
Message-ID: <50359.70.19.178.52.1148093549.squirrel@findyourcore.com>

Thank you so much. You have saved me loads of time.

> You probably forgot to set the encoding type of the form:
>
> <form enctype="multipart/form-data" method="POST"
> action="upload.psp?doit=yes">
>
> Without the enctype="multipart/form-data" part, the browser will only send
> the filename and not the
> contents.
>
> --
> Mike Looijmans
> Philips Natlab / Topic Automation
>
>
> jaba@findyourcore.com wrote:
>> heres my code:
>>
>> #########upload.py#########
>>
>> from mod_python import util
>> import sys
>> def handler(req):
>>     sys.stdout=sys.stderr=req
>>     form=util.FieldStorage(req)
>>     if form.has_key("file"):print form.list[0].file.getvalue()
>>     print "<form method=post><input type=file name=file></form>"
>>
>> ###########################
>>
>> the problem is, it only returns the filename, not the file contents.
>> Whats wrong?
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>
>
>

From jeffh at dundeemt.com  Sat May 20 00:50:06 2006
From: jeffh at dundeemt.com (Jeff Hinrichs - DM&T)
Date: Sat May 20 00:50:10 2006
Subject: [mod_python] Need help testing mod_python?
Message-ID: <5aaed53f0605192150j382fcf82qb4c4a12f194d231c@mail.gmail.com>

I can help test mod_python if needed.  I run on FreeBSD 6 with Python 2.4.3
I've got the trunk checked out and built and can submit "make check"
results when appropriate/helpful.



-- 
Jeff Hinrichs
Dundee Media & Technology, Inc
jeffh@dundeemt.com

From grahamd at dscpl.com.au  Sat May 20 01:40:01 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sat May 20 01:40:35 2006
Subject: [mod_python] Custom Login with redirection back to referer
In-Reply-To: <5c06fa770605191249h4f496066v77f85114d3602dd4@mail.gmail.com>
References: <000e01c67b76$18c419a0$6900a8c0@MSASALESGES2>
	<5c06fa770605191249h4f496066v77f85114d3602dd4@mail.gmail.com>
Message-ID: <F31F70F0-9C12-472B-A420-4FE70023CEB7@dscpl.com.au>


On 20/05/2006, at 5:49 AM, Deron Meranda wrote:

> On 5/19/06, Geoff Skerrett <geoff@teammsa.com> wrote:
>> I am hoping someone can get me back on track and point me in thr  
>> right
>> direction.
>>
>> I want to create a process where if the user requests a page they  
>> are not
>> authorized for then;
>> 1) a custom logon form is displayed
>> 2) the users submits and it is processed verifying against a  
>> database if the
>> user is valid
>> 3) as part of the processing a session is created
>> 4) the session stores the some data  (userid, name, lastip, etc)
>> 5) when complete the system redirects the user to the original  
>> page (ie the
>> referrer for the login)
>>
>> I have a test case working and using the util.redirect function.   
>> Everything
>> works fine, but the referred page is processed, it gets a new  
>> session so the
>> variables I have stored during the login page process aren't  
>> available to
>> the refered page.
>>
>> What am I missing? What is the best strategy for storing the session
>> variables and dealing with this type of process ?
>
> First of all, be cautious using redirection for that purpose.  Proxy
> servers, caching, and the like may decide to just cache the
> redirects too.  And then you'd have cross-user contamination.

The HTTP specification actually says for 307 (Temporary Redirection),  
which
is what one would want to use:

   The requested resource resides temporarily under a different URI.  
Since the
   redirection MAY be altered on occasion, the client SHOULD continue  
to use
   the Request-URI for future requests. This response is only  
cacheable if
   indicated by a Cache-Control or Expires header field.

In other words, any cache should by default not cache such a  
response. In
order for it to be cached, it would require the handler to have  
explicitly set
appropriate Cache-Control and/or Expires headers to tell it to cache it.

So, as far as the response redirecting a request to a login page is  
concerned,
that shouldn't be a problem in respect of any caching mechanism.

Where caching is more of an issue is where the login page presents  
the form
and does a request against some other URL to perform the  
authentication. If
this is a POST, then it should be okay as a cache shouldn't remember  
POST
requests. If someone wanted to mimic the POST and used a GET,  
supplying the
form parameters in the URL as part of the query string, then a cache may
remember the result of the authentication request if the handler for  
it didn't
explicitly prohibit caching. Thus, always a good idea for the handler  
in this
case to explicitly prohibit caching of the response.

But then, the handler doing the authentication should be returning  
yet another
redirect under normal circumstances to get back to the original page,  
thus
shouldn't be cached after all as per specification for 307 responses.  
Still good
idea to explicitly deny caching, and may be even better for the login  
handler to
only work with POST requests and disallow GET requests. Same for any  
logout
handler.

All in all, it can be a bit tricky. Since there has been a couple of  
queries about
session based form login lately, I'll try and post some code of my  
own that I
was playing with. The code though only works with mod_python 3.3  
development
version, but still may be good for a laugh, ... I mean, may be useful  
for ideas. The
code may well be adapted back to mod_python 3.2.8, but don't have  
time right
now to do that.

PS. This is my understanding of things. I could also be wrong. ;-)

Graham


From deron.meranda at gmail.com  Sat May 20 02:38:10 2006
From: deron.meranda at gmail.com (Deron Meranda)
Date: Sat May 20 02:38:17 2006
Subject: [mod_python] Custom Login with redirection back to referer
In-Reply-To: <F31F70F0-9C12-472B-A420-4FE70023CEB7@dscpl.com.au>
References: <000e01c67b76$18c419a0$6900a8c0@MSASALESGES2>
	<5c06fa770605191249h4f496066v77f85114d3602dd4@mail.gmail.com>
	<F31F70F0-9C12-472B-A420-4FE70023CEB7@dscpl.com.au>
Message-ID: <5c06fa770605192338v20c640e6r81f8830cb1539ffa@mail.gmail.com>

On 5/20/06, Graham Dumpleton <grahamd@dscpl.com.au> wrote:
> The HTTP specification actually says for 307 (Temporary Redirection),
> which is what one would want to use:

Yes, that works too and is quite common, although be aware that
most older browsers don't understand a 307.  So put a link
on the redirecting HTML page as well.  I'd stay away from a
302 though because it's semantics are more ambiguous.

I still prefer to send back a 401 or 403 as the semantics are
much more explicit as to what is happening (the user
doesn't have permissions to view the page).  This may be
important if you want to adhere to a REST design.  Also,
unlike redirects of various flavors, a 40x won't confuse any
spiders crawling your site (whether a public search engine,
or your own indexer, or perhaps even a site mirror-er).
Other rare edge cases could also occur with redirects, such
as a user doing a "save target as" where the link is to a URL
requiring login first.  Rather than seeing an error message, the
user may later find that the file they saved was actually the
HTML source to your login page.

This is mostly academic of course, but the intended purpose of
a 30x redirect is to say that the resource (or equivalent) which was
supposed to be at URL A can instead be found at URL B.  But in
this scenario that's not what you're doing.  URL A is simply not
accessible because of permissions, and URL B is a completely
different resource---the login page.

But do what you want.  Many/most sites use 30x.  The main
disadvantages of the 40x codes is that there is no auto
reloading; and that can often be more important than having
the precisely correct semantics.  With a 40x, the user will have
to click on a link on the error page to get to the login page.
But then again, depending on your usability philosophy, that
may be more desirable.  Seeing an error page saying you
need to login before your can view the page may be less of
a surprise then just seeing a login form when you expected
something else, with no explanation why.


> ... and may be even better for the login handler to
> only work with POST requests and disallow GET requests.

Restricting the method to POST on a login is also good for security.
-- 
Deron Meranda

From grahamd at dscpl.com.au  Sat May 20 03:40:30 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sat May 20 03:41:02 2006
Subject: [mod_python] Custom Login with redirection back to referer
In-Reply-To: <5c06fa770605192338v20c640e6r81f8830cb1539ffa@mail.gmail.com>
References: <000e01c67b76$18c419a0$6900a8c0@MSASALESGES2>
	<5c06fa770605191249h4f496066v77f85114d3602dd4@mail.gmail.com>
	<F31F70F0-9C12-472B-A420-4FE70023CEB7@dscpl.com.au>
	<5c06fa770605192338v20c640e6r81f8830cb1539ffa@mail.gmail.com>
Message-ID: <BEECFD3D-33D3-4E12-B5AE-67239367300C@dscpl.com.au>


On 20/05/2006, at 4:38 PM, Deron Meranda wrote:

> On 5/20/06, Graham Dumpleton <grahamd@dscpl.com.au> wrote:
>> The HTTP specification actually says for 307 (Temporary Redirection),
>> which is what one would want to use:
>
> Yes, that works too and is quite common, although be aware that
> most older browsers don't understand a 307.  So put a link
> on the redirecting HTML page as well.  I'd stay away from a
> 302 though because it's semantics are more ambiguous.

Arrggh, I actually meant to say 302 and not 307, as util.redirect()
uses a 302. The specification still says much the same thing.

   The requested resource resides temporarily under a different URI.  
Since
   the redirection might be altered on occasion, the client SHOULD  
continue
   to use the Request-URI for future requests. This response is only  
cacheable
   if indicated by a Cache-Control or Expires header field.

Thus same argument should apply unless browser/cache is truly old.

> I still prefer to send back a 401 or 403 as the semantics are
> much more explicit as to what is happening (the user
> doesn't have permissions to view the page).  This may be
> important if you want to adhere to a REST design.  Also,
> unlike redirects of various flavors, a 40x won't confuse any
> spiders crawling your site (whether a public search engine,
> or your own indexer, or perhaps even a site mirror-er).
> Other rare edge cases could also occur with redirects, such
> as a user doing a "save target as" where the link is to a URL
> requiring login first.  Rather than seeing an error message, the
> user may later find that the file they saved was actually the
> HTML source to your login page.
>
> This is mostly academic of course, but the intended purpose of
> a 30x redirect is to say that the resource (or equivalent) which was
> supposed to be at URL A can instead be found at URL B.  But in
> this scenario that's not what you're doing.  URL A is simply not
> accessible because of permissions, and URL B is a completely
> different resource---the login page.
>
> But do what you want.  Many/most sites use 30x.  The main
> disadvantages of the 40x codes is that there is no auto
> reloading; and that can often be more important than having
> the precisely correct semantics.  With a 40x, the user will have
> to click on a link on the error page to get to the login page.

Can't one use JavaScript or HTTP-EQUIV header in 40x error response
to get browser to redirect automatically?

> But then again, depending on your usability philosophy, that
> may be more desirable.  Seeing an error page saying you
> need to login before your can view the page may be less of
> a surprise then just seeing a login form when you expected
> something else, with no explanation why.

What is you attitude on having the login form in the 40x error page  
itself?

Anyway, see where you are going now. What I'll do is post up my session
login stuff using 302 redirects, and then if I have time, will try  
and modify
it to use ideas you are talking about and see if we can't come up  
with code
for each which people can compare. Someone will just have to convert
my code to work with mod_python 3.2.8. :-)

Graham


From grahamd at dscpl.com.au  Sat May 20 06:33:03 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sat May 20 06:33:30 2006
Subject: [mod_python] Example of session management using redirects.
Message-ID: <F0BE512D-2EEF-4CDB-83D7-D2BAE3A8A23C@dscpl.com.au>

As I said I might, am posting here (as attachment) some code of my own
which does session management with form based login. In this case, it
is using a multitude of redirects to do part of what it needs to do.

This code is probably going to be a bit different to what you have  
probably
seen before. This is because it will only work with mod_python 3.3 from
trunk of source code repository. This is the case as it is using  
specific
features of this new version of mod_python to allow it to be implemented
as an authenhandler.

Note that this code is very much an experiment in progress to allow me
to try out ideas and workarounds for some mod_python problems. I
don't guarantee that it will always work especially as I hadn't touched
it for a while and had to quickly fix a few things. Someone may find  
it of
interest though.

Anyway, by virtue of it being implemented as an authenhandler, the  
code can
technically perform authentication for files being served up as  
static files or
by mod_python, or even other Apache modules such as PHP or mod_perl.
Thus, it is a general purpose session based login mechanism.

As far as the login page goes, it can be implemented as static HTML, as
a PSP page, using mod_python.publisher, or again using some other
system such as PHP or mod_perl.

To specify whether files are public or private, you do stuff like the  
following
in your Apache configuration file:

   # Enable our session manager as primary means of
   # performing authentication. Specify that all files in
   # the directory are 'Private' by default and therefore
   # require user to have successfully logged in.

   AuthType Session
   AuthName Private

   # Ensure that the login page is publically accessible.
   # This must be done else they will not get opportunity
   # to login in the first place.

   <Files login.html>
   AuthName Public
   </Files>

   # Now specify other files which don't actually require
   # the user to have logged in. This might for example be
   # the main index page. The empty case is intentional as
   # that ensures that access to the directory itself will
   # work, with the request actually being redirected
   # internally to the publically accessible index file.

   <Files ~ '^(|index.html)$'>
   AuthName Public
   </Files>

Wish you all fun trying to understand it. :-)

If you do have questions, you better be quick, as am about to go on  
holidays.

Graham

-------------- next part --------------
A non-text attachment was scrubbed...
Name: sessionmanager.tar.gz
Type: application/x-gzip
Size: 6380 bytes
Desc: not available
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060520/813620d0/sessionmanager.tar.gz
From jpg at jgassociates.ca  Sat May 20 07:27:22 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Sat May 20 07:27:27 2006
Subject: [mod_python] Need help testing mod_python?
In-Reply-To: <5aaed53f0605192150j382fcf82qb4c4a12f194d231c@mail.gmail.com>
References: <5aaed53f0605192150j382fcf82qb4c4a12f194d231c@mail.gmail.com>
Message-ID: <446EFD1A.8040504@jgassociates.ca>

Jeff Hinrichs - DM&T wrote:
> I can help test mod_python if needed.  I run on FreeBSD 6 with Python 2.4.3
> I've got the trunk checked out and built and can submit "make check"
> results when appropriate/helpful.

Yes, that would be very helpful. Our main FreeBSD guy is is going to be 
very busy for the next several months so it would be nice to know we are 
still covered on that platform. You should probably subscribe to the 
developers list to keep abreast of changes, although it's pretty quiet 
over there right - it seems everyone is busy working on their own stuff 
right now. Subscription info is here:

http://people.apache.org/~jgallacher/mod_python/website-test/lists.html#mp-dev

Jim
From jpg at jgassociates.ca  Sat May 20 08:10:18 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Sat May 20 08:10:10 2006
Subject: [mod_python] Custom Login with redirection back to referer
In-Reply-To: <BEECFD3D-33D3-4E12-B5AE-67239367300C@dscpl.com.au>
References: <000e01c67b76$18c419a0$6900a8c0@MSASALESGES2>	<5c06fa770605191249h4f496066v77f85114d3602dd4@mail.gmail.com>	<F31F70F0-9C12-472B-A420-4FE70023CEB7@dscpl.com.au>	<5c06fa770605192338v20c640e6r81f8830cb1539ffa@mail.gmail.com>
	<BEECFD3D-33D3-4E12-B5AE-67239367300C@dscpl.com.au>
Message-ID: <446F072A.3020808@jgassociates.ca>

Graham Dumpleton wrote:
> 
> On 20/05/2006, at 4:38 PM, Deron Meranda wrote:
> 
>> On 5/20/06, Graham Dumpleton <grahamd@dscpl.com.au> wrote:
>>> The HTTP specification actually says for 307 (Temporary Redirection),
>>> which is what one would want to use:
>>
>> Yes, that works too and is quite common, although be aware that
>> most older browsers don't understand a 307.

But I suspect if browser is too old to understand a 307 redirect, most 
web pages that user visits are almost completely unreadable anyway. :) 
It's up to the designer to decide if supporting stone-age browsers is 
worth the effort.

>  So put a link
>> on the redirecting HTML page as well.  I'd stay away from a
>> 302 though because it's semantics are more ambiguous.
>
> Arrggh, I actually meant to say 302 and not 307, as util.redirect()
> uses a 302. The specification still says much the same thing.
> 
>   The requested resource resides temporarily under a different URI. Since
>   the redirection might be altered on occasion, the client SHOULD continue
>   to use the Request-URI for future requests. This response is only 
> cacheable
>   if indicated by a Cache-Control or Expires header field.
> 
> Thus same argument should apply unless browser/cache is truly old.
> 
>> I still prefer to send back a 401 or 403 as the semantics are
>> much more explicit as to what is happening (the user
>> doesn't have permissions to view the page).  This may be
>> important if you want to adhere to a REST design.  Also,
>> unlike redirects of various flavors, a 40x won't confuse any
>> spiders crawling your site (whether a public search engine,
>> or your own indexer, or perhaps even a site mirror-er).
>> Other rare edge cases could also occur with redirects, such
>> as a user doing a "save target as" where the link is to a URL
>> requiring login first.  Rather than seeing an error message, the
>> user may later find that the file they saved was actually the
>> HTML source to your login page.
>>
>> This is mostly academic of course, but the intended purpose of
>> a 30x redirect is to say that the resource (or equivalent) which was
>> supposed to be at URL A can instead be found at URL B.  But in
>> this scenario that's not what you're doing.  URL A is simply not
>> accessible because of permissions, and URL B is a completely
>> different resource---the login page.
>>
>> But do what you want.  Many/most sites use 30x.  The main
>> disadvantages of the 40x codes is that there is no auto
>> reloading; and that can often be more important than having
>> the precisely correct semantics.  With a 40x, the user will have
>> to click on a link on the error page to get to the login page.
> 
> Can't one use JavaScript or HTTP-EQUIV header in 40x error response
> to get browser to redirect automatically?
> 
>> But then again, depending on your usability philosophy, that
>> may be more desirable.  Seeing an error page saying you
>> need to login before your can view the page may be less of
>> a surprise then just seeing a login form when you expected
>> something else, with no explanation why.
> 
> What is you attitude on having the login form in the 40x error page itself?
> 
> Anyway, see where you are going now. What I'll do is post up my session
> login stuff using 302 redirects, and then if I have time, will try and 
> modify
> it to use ideas you are talking about and see if we can't come up with code
> for each which people can compare. Someone will just have to convert
> my code to work with mod_python 3.2.8. :-)

Not completely on topic, but since we are talking about 30x redirects, I 
thought I'd mention that I've modified util.redirect to support any of 
the 30x codes. It's a pretty simple change, where util.redirect becomes

def redirect(req, location, permanent=0, status=None, text=None)

If status is not None it overrides the permanent parameter. I want this 
so I use util.redirect with a 303 HTTP_SEE_OTHER response after creating 
a resource with a POST. (for the POST-REDIRECT-GET pattern used in 
RESTful applications).

I haven't created a JIRA issue or checked in the code just yet. I figure 
if I'm are going to change redirect I may as well do it right and make 
sure we comply with RFC-2616, which may be a bit more work.

The 304 HTTP_NOT_MODIFIED redirect looks interesting in particular, but 
has some specific requirements for a couple of headers. I'm not sure if 
we should be doing any error checking in the util.redirect(), or just 
assume that if the user wants do this they know what they doing and have 
set the response headers accordingly.

If anyone has a couple of spare minutes perhaps they could peruse 
http://rfc.net/rfc2616.html#s10.3 and let me know what they think.

Jim


From terry.macdonald at dsl.pipex.com  Sat May 20 13:36:50 2006
From: terry.macdonald at dsl.pipex.com (Terry Macdonald)
Date: Sat May 20 13:38:47 2006
Subject: [mod_python] Form upload
In-Reply-To: <446DB933.5090109@jgassociates.ca>
References: <1147994080.4855@dscpl.user.openhosting.com>	<446D9A4B.8040909@dsl.pipex.com>	<55FB5E45-2FF3-47D8-954C-A3F96B006B06@dscpl.com.au>
	<446DAE45.7060501@dsl.pipex.com> <446DB933.5090109@jgassociates.ca>
Message-ID: <446F53B2.20402@dsl.pipex.com>

Jim Gallacher wrote:
> Terry Macdonald wrote:
>> Graham Dumpleton wrote:
>>>
>>> On 19/05/2006, at 8:13 PM, Terry Macdonald wrote:
>>>
>>>>
>>>> "sys.stdout=sys.stderr=req"
>>>>
>>>> This may be a dumb question but I'm not getting it...
>>>> What does the above line do?
>>>> Why does one want to set standard error and standard out to the 
>>>> request object?
>>>> What does printing to the request object do?
>>>> ...and how does it work?
>>>>
>>>> I'm missing something fundamentally object oriented here, aren't I?
>>>>
>>>> I just see objects that are used to print stuff and then a request 
>>>> object which contains request information. I'm not getting the link.
>>>
>>> Both sys.stderr and sys.stdout are file objects. The primary method 
>>> for writing
>>> data is the "write()" member function. It is the "write()" member 
>>> function that "print"
>>> calls on the sys.stdout file object.
>>>
>>> Outside of mod_python, you could replace sys.stdout with some other 
>>> file object,
>>> for example an open log file, and every use of "print" in the 
>>> program would see that
>>> output go to the log file instead.
>>>
>>> In practice, sys.stdout doesn't actually have to be a file object, 
>>> just a file like
>>> object which provides a "write()" method. As a "req" object provides 
>>> a "write()"
>>> function, it could technically thus be used as a substitute for 
>>> sys.stdout. As I
>>> pointed out in prior email though, this would actually be a 
>>> dangerous thing
>>> to do in mod_python where a multithreaded MPM is being used.
>>>
>>> Hope this makes sense.
>>>
>>> Graham
>> Thanks for the help/reply Graham
>>
>> So effectively if you print something to the req object it morphs 
>> into a response back to the client browser?
>
> Yes, but as Graham says, the safe way to do that in mod_python is:
>
> print >> req, "Stuff"
>
> which is the same as:
>
> req.write("Stuff\n")
>
> Jim

Thanks again, I get it now ( and I feel a little stoopid :3) )

However, for what its worth I do think it semantically awkward (and 
confusing to newcomers) to think of the request as the response - 
req.write() should send a request in a normal universe but it sends a 
response (yuck):  am I right in thinking that is an Apache way of 
looking at things?

Cheers
From jpg at jgassociates.ca  Sat May 20 13:43:19 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Sat May 20 13:41:45 2006
Subject: [mod_python] Form upload
In-Reply-To: <446F53B2.20402@dsl.pipex.com>
References: <1147994080.4855@dscpl.user.openhosting.com>	<446D9A4B.8040909@dsl.pipex.com>	<55FB5E45-2FF3-47D8-954C-A3F96B006B06@dscpl.com.au>	<446DAE45.7060501@dsl.pipex.com>
	<446DB933.5090109@jgassociates.ca> <446F53B2.20402@dsl.pipex.com>
Message-ID: <446F5537.8020407@jgassociates.ca>

Terry Macdonald wrote:
> Jim Gallacher wrote:
>> Terry Macdonald wrote:
>>> Graham Dumpleton wrote:
>>>>
>>>> On 19/05/2006, at 8:13 PM, Terry Macdonald wrote:
>>>>
>>>>>
>>>>> "sys.stdout=sys.stderr=req"
>>>>>
>>>>> This may be a dumb question but I'm not getting it...
>>>>> What does the above line do?
>>>>> Why does one want to set standard error and standard out to the 
>>>>> request object?
>>>>> What does printing to the request object do?
>>>>> ...and how does it work?
>>>>>
>>>>> I'm missing something fundamentally object oriented here, aren't I?
>>>>>
>>>>> I just see objects that are used to print stuff and then a request 
>>>>> object which contains request information. I'm not getting the link.
>>>>
>>>> Both sys.stderr and sys.stdout are file objects. The primary method 
>>>> for writing
>>>> data is the "write()" member function. It is the "write()" member 
>>>> function that "print"
>>>> calls on the sys.stdout file object.
>>>>
>>>> Outside of mod_python, you could replace sys.stdout with some other 
>>>> file object,
>>>> for example an open log file, and every use of "print" in the 
>>>> program would see that
>>>> output go to the log file instead.
>>>>
>>>> In practice, sys.stdout doesn't actually have to be a file object, 
>>>> just a file like
>>>> object which provides a "write()" method. As a "req" object provides 
>>>> a "write()"
>>>> function, it could technically thus be used as a substitute for 
>>>> sys.stdout. As I
>>>> pointed out in prior email though, this would actually be a 
>>>> dangerous thing
>>>> to do in mod_python where a multithreaded MPM is being used.
>>>>
>>>> Hope this makes sense.
>>>>
>>>> Graham
>>> Thanks for the help/reply Graham
>>>
>>> So effectively if you print something to the req object it morphs 
>>> into a response back to the client browser?
>>
>> Yes, but as Graham says, the safe way to do that in mod_python is:
>>
>> print >> req, "Stuff"
>>
>> which is the same as:
>>
>> req.write("Stuff\n")
>>
>> Jim
> 
> Thanks again, I get it now ( and I feel a little stoopid :3) )
> 
> However, for what its worth I do think it semantically awkward (and 
> confusing to newcomers) to think of the request as the response - 
> req.write() should send a request in a normal universe but it sends a 
> response (yuck):  am I right in thinking that is an Apache way of 
> looking at things?

Yep.

Jim

From terry.macdonald at dsl.pipex.com  Sat May 20 16:15:08 2006
From: terry.macdonald at dsl.pipex.com (Terry Macdonald)
Date: Sat May 20 16:17:04 2006
Subject: [mod_python] Example of session management using redirects.
In-Reply-To: <F0BE512D-2EEF-4CDB-83D7-D2BAE3A8A23C@dscpl.com.au>
References: <F0BE512D-2EEF-4CDB-83D7-D2BAE3A8A23C@dscpl.com.au>
Message-ID: <446F78CC.1010006@dsl.pipex.com>

What are 'built-in operations' that you refer to?
From terry.macdonald at dsl.pipex.com  Sat May 20 16:29:26 2006
From: terry.macdonald at dsl.pipex.com (Terry Macdonald)
Date: Sat May 20 16:31:21 2006
Subject: [mod_python] Example of session management using redirects.
In-Reply-To: <446F78CC.1010006@dsl.pipex.com>
References: <F0BE512D-2EEF-4CDB-83D7-D2BAE3A8A23C@dscpl.com.au>
	<446F78CC.1010006@dsl.pipex.com>
Message-ID: <446F7C26.4090606@dsl.pipex.com>

Terry Macdonald wrote:
> What are 'built-in operations' that you refer to?
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
Apologies, I now see what they are.
From grahamd at dscpl.com.au  Sat May 20 17:40:19 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sat May 20 17:40:36 2006
Subject: [mod_python] Example of session management using redirects.
In-Reply-To: <446F7C26.4090606@dsl.pipex.com>
References: <F0BE512D-2EEF-4CDB-83D7-D2BAE3A8A23C@dscpl.com.au>
	<446F78CC.1010006@dsl.pipex.com> <446F7C26.4090606@dsl.pipex.com>
Message-ID: <0CF63674-E4D0-41EF-B3DF-6F81C6C6201B@dscpl.com.au>


On 21/05/2006, at 6:29 AM, Terry Macdonald wrote:

> Terry Macdonald wrote:
>> What are 'built-in operations' that you refer to?
> Apologies, I now see what they are.

Be careful of those as they were one of my experiments. Specifically, I
wanted to see if I could have actions against the directory itself  
for the
validate/invalidate operation, rather than create separate fake URLs  
which
might overlap with some name for a file that someone else decided to  
use.
It actually turned out to make other parts related to the workaround for
DirectoryIndex problems more complicated, so questionable as to whether
it was a good idea or not.

Anyone else got any other suggestions besides having separate fake URLs
for:

   /validate
   /invalidate

I was for the record using:

   /?validate
   /?invalidate

to avoid naming collisions.

Graham
From deron.meranda at gmail.com  Sun May 21 00:47:57 2006
From: deron.meranda at gmail.com (Deron Meranda)
Date: Sun May 21 00:48:00 2006
Subject: [mod_python] Custom Login with redirection back to referer
In-Reply-To: <BEECFD3D-33D3-4E12-B5AE-67239367300C@dscpl.com.au>
References: <000e01c67b76$18c419a0$6900a8c0@MSASALESGES2>
	<5c06fa770605191249h4f496066v77f85114d3602dd4@mail.gmail.com>
	<F31F70F0-9C12-472B-A420-4FE70023CEB7@dscpl.com.au>
	<5c06fa770605192338v20c640e6r81f8830cb1539ffa@mail.gmail.com>
	<BEECFD3D-33D3-4E12-B5AE-67239367300C@dscpl.com.au>
Message-ID: <5c06fa770605202147i567d0bd3u9d159e7237269811@mail.gmail.com>

On 5/20/06, Graham Dumpleton <grahamd@dscpl.com.au> wrote:
> Can't one use JavaScript or HTTP-EQUIV header in 40x error response
> to get browser to redirect automatically?

If your response is HTML (as is typically the case), yes you can
do that.  But again, being somewhat of a "purist" I wouldn't. The
http-equiv is really there to "store" any important HTTP headers
which affect how the page may be interpreted, such as content-type
or charset, so the page can be properly rendered statically while
offline (i.e., not over HTTP).  Any http-equiv meta elements in your
document should correspond exactly to the same HTTP headers
you serve up with that document.  In fact, I've gone so far as to
enforce this in the mini-frameworks I build on top of mod_python,
so I never have an http-equiv which doesn't match exactly a real
HTTP header.

If you really want an automatic redirect, you probably should just
go ahead and use one of the 30x responses...or use some
javascript to reload the error page to the login page after a
suitable delay.

> What is you attitude on having the login form in the 40x error page
> itself?

I guess that is a possibility.  It really depends on your needs
and the complexity of your login form processing---using
captchas or SecureID, etc, may be challenging to do from
within an error response page.  But, I've never tried that.
I do know that Apache tends makes it hard to do anything
sophisticated on an error response page.  I'm also not sure
if there might be some strange interactions with some browser
form-remembering features.  It would be interesting to try.

An important point though is that I use 403's in many different
"permission denied" cases, some of which are because the user
isn't logged in, and others when logging in won't make any
difference (a simple example is "directly listing is prohibited").  So
you still want your 403 error page to look like an error page,
notifying the user that there could be any number of reasons
why they may not have permissions to retrieve the resource; and
then suggesting that they may try logging in (but with no promises).

Technically, a 401 would be more appropriate than a 403 for
this very reason; but then you are restricted to using a standard
authentication mechanism, or one that the browsers understand
(not a form-based login).


One thing that would be nice to be able to do is to pass
information to the Apache error page, so it can be more
specific in the human-readable part of the reponse. Perhaps
the new SSI hooks you added might make that possible ??

Looking forward to seeing your code.  I'm excited about many of
the auth* integration features you added, but haven't had time to
play with them in the trunk yet.
-- 
Deron Meranda

From deron.meranda at gmail.com  Sun May 21 01:23:40 2006
From: deron.meranda at gmail.com (Deron Meranda)
Date: Sun May 21 01:23:43 2006
Subject: [mod_python] Custom Login with redirection back to referer
In-Reply-To: <446F072A.3020808@jgassociates.ca>
References: <000e01c67b76$18c419a0$6900a8c0@MSASALESGES2>
	<5c06fa770605191249h4f496066v77f85114d3602dd4@mail.gmail.com>
	<F31F70F0-9C12-472B-A420-4FE70023CEB7@dscpl.com.au>
	<5c06fa770605192338v20c640e6r81f8830cb1539ffa@mail.gmail.com>
	<BEECFD3D-33D3-4E12-B5AE-67239367300C@dscpl.com.au>
	<446F072A.3020808@jgassociates.ca>
Message-ID: <5c06fa770605202223h5a42ce72ica21c36246542d9e@mail.gmail.com>

On 5/20/06, Jim Gallacher <jpg@jgassociates.ca> wrote:
> But I suspect if browser is too old to understand a 307 redirect, most
> web pages that user visits are almost completely unreadable anyway. :)

I still remember coding up web pages for the old Mosaic
browser, so by this point what's old, new, or stone-age
is pretty much a blur ;)

> Not completely on topic, but since we are talking about 30x redirects, I
> thought I'd mention that I've modified util.redirect to support any of
> the 30x codes. It's a pretty simple change, where util.redirect becomes
>
> def redirect(req, location, permanent=0, status=None, text=None)
>
> If status is not None it overrides the permanent parameter. I want this
> so I use util.redirect with a 303 HTTP_SEE_OTHER response after creating
> a resource with a POST. (for the POST-REDIRECT-GET pattern used in
> RESTful applications).

It's nice to get support for more the the response codes.  I think
it's interesting to see how designing RESTful makes one think
a lot more about the why and not just how of the HTTP protocol
details.

As far as the redirect() function.  The only thing that bothers
me a bit is having two mutually-exclusive parameters.  But I'm
not sure how you'd fix that will maintaining backwards compatibility.

But I have to admit I often do things the "hard way" out of
habit back from the days when I coded "nph-" style CGI scripts.
I tend not to use the redirect() helper function, and instead
do everyting at a lower level.  Some day I'll convert.

> The 304 HTTP_NOT_MODIFIED redirect looks interesting in particular,

Yes, it is.  It is one of those uncommon ones that I use a bit.  Other
ones I find myself using occasionally are:
  201 Created
  202 Accepted
  400 Bad request
  403 Forbidden
  405 Method not allowed
  503 Service unavailable

You might want to think about 413 (request entity too large) as
possibly something that really belongs in the inner workings
of mod_python's FieldStorage stuff.

-- 
Deron Meranda

From grahamd at dscpl.com.au  Sun May 21 02:01:22 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sun May 21 02:01:59 2006
Subject: [mod_python] Custom Login with redirection back to referer
In-Reply-To: <5c06fa770605202223h5a42ce72ica21c36246542d9e@mail.gmail.com>
References: <000e01c67b76$18c419a0$6900a8c0@MSASALESGES2>
	<5c06fa770605191249h4f496066v77f85114d3602dd4@mail.gmail.com>
	<F31F70F0-9C12-472B-A420-4FE70023CEB7@dscpl.com.au>
	<5c06fa770605192338v20c640e6r81f8830cb1539ffa@mail.gmail.com>
	<BEECFD3D-33D3-4E12-B5AE-67239367300C@dscpl.com.au>
	<446F072A.3020808@jgassociates.ca>
	<5c06fa770605202223h5a42ce72ica21c36246542d9e@mail.gmail.com>
Message-ID: <4F30B721-9CBB-49E2-A536-11F591AA560D@dscpl.com.au>


On 21/05/2006, at 3:23 PM, Deron Meranda wrote:

> On 5/20/06, Jim Gallacher <jpg@jgassociates.ca> wrote:
>> But I suspect if browser is too old to understand a 307 redirect,  
>> most
>> web pages that user visits are almost completely unreadable  
>> anyway. :)
>
> I still remember coding up web pages for the old Mosaic
> browser, so by this point what's old, new, or stone-age
> is pretty much a blur ;)
>
>> Not completely on topic, but since we are talking about 30x  
>> redirects, I
>> thought I'd mention that I've modified util.redirect to support  
>> any of
>> the 30x codes. It's a pretty simple change, where util.redirect  
>> becomes
>>
>> def redirect(req, location, permanent=0, status=None, text=None)
>>
>> If status is not None it overrides the permanent parameter. I want  
>> this
>> so I use util.redirect with a 303 HTTP_SEE_OTHER response after  
>> creating
>> a resource with a POST. (for the POST-REDIRECT-GET pattern used in
>> RESTful applications).
>
> It's nice to get support for more the the response codes.  I think
> it's interesting to see how designing RESTful makes one think
> a lot more about the why and not just how of the HTTP protocol
> details.
>
> As far as the redirect() function.  The only thing that bothers
> me a bit is having two mutually-exclusive parameters.  But I'm
> not sure how you'd fix that will maintaining backwards compatibility.
>
> But I have to admit I often do things the "hard way" out of
> habit back from the days when I coded "nph-" style CGI scripts.
> I tend not to use the redirect() helper function, and instead
> do everyting at a lower level.  Some day I'll convert.

Personally I am probably -1 on overloading util.redirect() to do  
this. That function
isn't too complicated, but probably should be kept just for the  
simple cases. If
someone knows enough to use other cases, they are probably knowledgeable
enough to know how to do it properly themselves at the lower level.

Graham
From jpg at jgassociates.ca  Sun May 21 10:17:52 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Sun May 21 10:19:36 2006
Subject: [mod_python] Custom Login with redirection back to referer
In-Reply-To: <4F30B721-9CBB-49E2-A536-11F591AA560D@dscpl.com.au>
References: <000e01c67b76$18c419a0$6900a8c0@MSASALESGES2>	<5c06fa770605191249h4f496066v77f85114d3602dd4@mail.gmail.com>	<F31F70F0-9C12-472B-A420-4FE70023CEB7@dscpl.com.au>	<5c06fa770605192338v20c640e6r81f8830cb1539ffa@mail.gmail.com>	<BEECFD3D-33D3-4E12-B5AE-67239367300C@dscpl.com.au>	<446F072A.3020808@jgassociates.ca>	<5c06fa770605202223h5a42ce72ica21c36246542d9e@mail.gmail.com>
	<4F30B721-9CBB-49E2-A536-11F591AA560D@dscpl.com.au>
Message-ID: <44707690.5020008@jgassociates.ca>

Graham Dumpleton wrote:
> 
> On 21/05/2006, at 3:23 PM, Deron Meranda wrote:
> 
>> On 5/20/06, Jim Gallacher <jpg@jgassociates.ca> wrote:
>>> But I suspect if browser is too old to understand a 307 redirect, most
>>> web pages that user visits are almost completely unreadable anyway. :)
>>
>> I still remember coding up web pages for the old Mosaic
>> browser, so by this point what's old, new, or stone-age
>> is pretty much a blur ;)
>>
>>> Not completely on topic, but since we are talking about 30x redirects, I
>>> thought I'd mention that I've modified util.redirect to support any of
>>> the 30x codes. It's a pretty simple change, where util.redirect becomes
>>>
>>> def redirect(req, location, permanent=0, status=None, text=None)
>>>
>>> If status is not None it overrides the permanent parameter. I want this
>>> so I use util.redirect with a 303 HTTP_SEE_OTHER response after creating
>>> a resource with a POST. (for the POST-REDIRECT-GET pattern used in
>>> RESTful applications).
>>
>> It's nice to get support for more the the response codes.  I think
>> it's interesting to see how designing RESTful makes one think
>> a lot more about the why and not just how of the HTTP protocol
>> details.
>>
>> As far as the redirect() function.  The only thing that bothers
>> me a bit is having two mutually-exclusive parameters.  But I'm
>> not sure how you'd fix that will maintaining backwards compatibility.
>>
>> But I have to admit I often do things the "hard way" out of
>> habit back from the days when I coded "nph-" style CGI scripts.
>> I tend not to use the redirect() helper function, and instead
>> do everyting at a lower level.  Some day I'll convert.
> 
> Personally I am probably -1 on overloading util.redirect() to do this. 
> That function
> isn't too complicated, but probably should be kept just for the simple 
> cases. If
> someone knows enough to use other cases, they are probably knowledgeable
> enough to know how to do it properly themselves at the lower level.

One could argue, (and one will argue, since one wants to use other 30x 
codes but not maintain a separate function in one's own code ;) ), that 
util.redirect is actually broken as it only supports a subset of 30x 
responses. Perhaps it should have been call util.moved() or something.

I don't see adding a parameter to redirect() to support the other 30x 
codes as overloading. The intent of redirect has not changed, and we 
could check that the status is in valid range to enforce this. I do 
however acknowledge the concern about passing 2 mutually exclusive 
parameters but I don't see any other way to munge the code.

Here's what my new version looks like. Note that most of the changes 
consistent of head scratching comments. Actual code changes are only a 
couple of lines.

def redirect(req, location, permanent=0, status=None, text=None):
     """
     A convenience function to provide redirection
     """

     if req.sent_bodyct:
         raise IOError, "Cannot redirect after headers have already been 
sent."

     req.err_headers_out["Location"] = location

     if not status:
         if permanent:
             req.status = apache.HTTP_MOVED_PERMANENTLY
         else:
             req.status = apache.HTTP_MOVED_TEMPORARILY
     else:
         # TODO? should we verify that status is in 30x range?
         # TODO? RFC2616 has some special header requirements
         # for HTTP_NOT_MODIFIED 304 response. Should we raise an error
         # if these conditions are not met, or just assume the
         # caller knows what they are doing and have set the headers?
         # ie. Date, Etag, etc.
         # see http://rfc.net/rfc2616.html#s10.3.5
         req.status = status

     if req.status is not apache.HTTP_NOT_MODIFIED:
         # RFC-2161 says HTTP_NOT_MODIFIED (304)
         # response MUST NOT contain a message-body
         # Any others are ok
         # TODO according to RFC-2616 the reponse should not contain
         # a message body for HEAD method. Should we test here or just
         # depend on apache to truncate the body?
         # TODO we shouldn't write anything if the request is a
         # HEAD method. I believe apache will take care of this in
         # a later phase, so we won't worry about it here.

         if text is None:
             req.write('<p>The document has moved'
                      ' <a href="%s">here</a></p>\n'
                      % location)
         else:
             req.write(text)

     raise apache.SERVER_RETURN, apache.DONE


Jim
From jaba at findyourcore.com  Sun May 21 16:52:10 2006
From: jaba at findyourcore.com (jaba@findyourcore.com)
Date: Sun May 21 16:52:15 2006
Subject: [mod_python] apache.OK and Cookies
Message-ID: <50765.70.19.178.52.1148244730.squirrel@findyourcore.com>

I have two questions:
1. is 'return apache.OK' really needed? ive gone without it many times,
and nothing goes wrong.

2. How do you handle cookies (get,set,etc.)?

Thanks in advance.
From listspam at flowtheory.net  Sun May 21 17:00:12 2006
From: listspam at flowtheory.net (Joshua Ginsberg)
Date: Sun May 21 17:00:56 2006
Subject: [SPAM] Re: [mod_python] apache.OK and Cookies
In-Reply-To: <50765.70.19.178.52.1148244730.squirrel@findyourcore.com>
References: <50765.70.19.178.52.1148244730.squirrel@findyourcore.com>
Message-ID: <61f5b172ff6dc2644dd387564f83277d@flowtheory.net>

On May 21, 2006, at 4:52 PM, jaba@findyourcore.com wrote:

> I have two questions:
> 1. is 'return apache.OK' really needed? ive gone without it many times,
> and nothing goes wrong.

Is it so hard to include it?

> 2. How do you handle cookies (get,set,etc.)?

RTFM: http://modpython.org/live/current/doc-html/pyapi-cookie.html

-jag

From grahamd at dscpl.com.au  Sun May 21 18:40:38 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sun May 21 18:40:41 2006
Subject: [mod_python] apache.OK and Cookies
Message-ID: <1148251237.14268@dscpl.user.openhosting.com>

jaba@findyourcore.com wrote ..
> I have two questions:
> 1. is 'return apache.OK' really needed? ive gone without it many times,
> and nothing goes wrong.

What version of mod_python are you using?

Can you clarify whether you are using your own handler, where it would
should be used, or whether you are using mod_python.publisher where it
would not, but if it was may simply result in a extraneous "0" at end of
output that may get overlooked.

In summary, if using your own handler, you should always return it. If
you don't, you should at least see a warning message in the Apache log
files and the results may be unpredictable as to how Apache treats the
result.

Graham
From grahamd at dscpl.com.au  Sun May 21 18:49:30 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sun May 21 18:49:34 2006
Subject: [mod_python] apache.OK and Cookies
Message-ID: <1148251770.19073@dscpl.user.openhosting.com>

Graham Dumpleton wrote ..
> jaba@findyourcore.com wrote ..
> > I have two questions:
> > 1. is 'return apache.OK' really needed? ive gone without it many times,
> > and nothing goes wrong.
> 
> What version of mod_python are you using?
> 
> Can you clarify whether you are using your own handler, where it would
> should be used, or whether you are using mod_python.publisher where it
> would not, but if it was may simply result in a extraneous "0" at end of
> output that may get overlooked.
> 
> In summary, if using your own handler, you should always return it. If
> you don't, you should at least see a warning message in the Apache log
> files and the results may be unpredictable as to how Apache treats the
> result.

Actually, as well as the error in the log file, mod_python should end up
sending an internal server error (500) response back to Apache. If you
aren't seeing this, then I would suspect you aren't writing your own
handler and are using some layer on top where the result may not even be
a status code, or where status codes are treated differently. For
example, in mod_python.publisher, the result is converted to a string
and append to the content. In Vampire, if nothing is returning it is
equivalent to having returned apache.OK.

Thus, thus make sure you indicate what handler you are using as well as
the version of mod_python.

Graham
From vmanera at manord.com  Mon May 22 06:38:42 2006
From: vmanera at manord.com (Manera, Villiam)
Date: Mon May 22 06:38:49 2006
Subject: [mod_python] Servlet Loading problem 1 year later
Message-ID: <BC53C974C3B9E542BC0A9BD4C5B1168AE1C94F@NEWMAIL.manord.com>

This problem happened rarely, but now it raises many times a day.
I modified the servlet.py in order to do some debugging and it seems
that  the statement:
if not issubclass(klass, Servlet): sometimes works and sometimes not.

So this is the code that I modified:

            try:
                if not issubclass(klass, Servlet):
                    raise ValueError
            except:
                from mdnlib import path_logs
                def iteraPadri(f,classe):
                   global isServletDescendant
                   isServletDescendant=False
                   f.write('\n')
                   if classe.__bases__ : 
                      f.write(classe.__name__+' deriva da:
'+classe.__bases__[0].__name__)
                      iteraPadri(f,classe.__bases__[0])
                   else:
                      f.write(classe.__name__)
                      if classe.__name__ == 'Servlet':
isServletDescendant = True
                nome = os.path.join(path_logs,'apache','servlet.txt')
                f = file(nome,'a')
                f.write('\n')
                f.write(time.strftime ('%d/%m/%Y
%H:%M:%S',time.localtime(time.time())))
                if klass: iteraPadri(f,klass)
                if isServletDescendant:
                  f.write(' Non faccio Abortire \n')
                else:
                  f.write('\n')
                  f.write('%s is not a subclass of Servlet (in %s) code:
%s'  
                      % (basename, fname, str(code)) )
                  f.write('\n')
 
f.write('---------------------------------------------')
                  f.write('\n')
                  f.close()
                  raise ValueError, ('%s is not a subclass of Servlet
(in %s) code: %s'
                                   % (basename, fname, str(code)))


So, in except I lookup from the ancestor and if I found Servlet
don't'raise exception.

Below some rows of the log:

19/05/2006 11:20:52
scarica_viti deriva da: docBase_mps_form
docBase_mps_form deriva da: docBase_mps
docBase_mps deriva da: HTMLPage
HTMLPage deriva da: Servlet
Servlet Non faccio Abortire 

19/05/2006 11:21:07
Stat_utente deriva da: docBase_mps_form
docBase_mps_form deriva da: docBase_mps
docBase_mps deriva da: HTMLPage
HTMLPage deriva da: Servlet
Servlet Non faccio Abortire 

19/05/2006 11:23:36
operazioni deriva da: docBase_mps_form_matrici_automatico
docBase_mps_form_matrici_automatico deriva da: docBase_mps_form_matrici
docBase_mps_form_matrici deriva da: docBase_mps_form
docBase_mps_form deriva da: docBase_mps
docBase_mps deriva da: HTMLPage
HTMLPage deriva da: Servlet
Servlet Non faccio Abortire



For example on Friday from 8 am to 11 am all work fine after 11 am the
log became populating...
But every time I found the Servlet as ancestor.

So why issubclass(klass, Servlet) don't return True?

Villiam


From grahamd at dscpl.com.au  Mon May 22 06:55:08 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon May 22 06:55:46 2006
Subject: [mod_python] Servlet Loading problem 1 year later
In-Reply-To: <BC53C974C3B9E542BC0A9BD4C5B1168AE1C94F@NEWMAIL.manord.com>
References: <BC53C974C3B9E542BC0A9BD4C5B1168AE1C94F@NEWMAIL.manord.com>
Message-ID: <A55E6B15-EC41-49CF-BF4F-4638020B7A92@dscpl.com.au>

Possibly a similar problem to:

   http://www.modpython.org/pipermail/mod_python/2004-October/ 
016596.html

Graham	

On 22/05/2006, at 8:38 PM, Manera, Villiam wrote:

> This problem happened rarely, but now it raises many times a day.
> I modified the servlet.py in order to do some debugging and it seems
> that  the statement:
> if not issubclass(klass, Servlet): sometimes works and sometimes not.
>
> So this is the code that I modified:
>
>             try:
>                 if not issubclass(klass, Servlet):
>                     raise ValueError
>             except:
>                 from mdnlib import path_logs
>                 def iteraPadri(f,classe):
>                    global isServletDescendant
>                    isServletDescendant=False
>                    f.write('\n')
>                    if classe.__bases__ :
>                       f.write(classe.__name__+' deriva da:
> '+classe.__bases__[0].__name__)
>                       iteraPadri(f,classe.__bases__[0])
>                    else:
>                       f.write(classe.__name__)
>                       if classe.__name__ == 'Servlet':
> isServletDescendant = True
>                 nome = os.path.join(path_logs,'apache','servlet.txt')
>                 f = file(nome,'a')
>                 f.write('\n')
>                 f.write(time.strftime ('%d/%m/%Y
> %H:%M:%S',time.localtime(time.time())))
>                 if klass: iteraPadri(f,klass)
>                 if isServletDescendant:
>                   f.write(' Non faccio Abortire \n')
>                 else:
>                   f.write('\n')
>                   f.write('%s is not a subclass of Servlet (in %s)  
> code:
> %s'
>                       % (basename, fname, str(code)) )
>                   f.write('\n')
>
> f.write('---------------------------------------------')
>                   f.write('\n')
>                   f.close()
>                   raise ValueError, ('%s is not a subclass of Servlet
> (in %s) code: %s'
>                                    % (basename, fname, str(code)))
>
>
> So, in except I lookup from the ancestor and if I found Servlet
> don't'raise exception.
>
> Below some rows of the log:
>
> 19/05/2006 11:20:52
> scarica_viti deriva da: docBase_mps_form
> docBase_mps_form deriva da: docBase_mps
> docBase_mps deriva da: HTMLPage
> HTMLPage deriva da: Servlet
> Servlet Non faccio Abortire
>
> 19/05/2006 11:21:07
> Stat_utente deriva da: docBase_mps_form
> docBase_mps_form deriva da: docBase_mps
> docBase_mps deriva da: HTMLPage
> HTMLPage deriva da: Servlet
> Servlet Non faccio Abortire
>
> 19/05/2006 11:23:36
> operazioni deriva da: docBase_mps_form_matrici_automatico
> docBase_mps_form_matrici_automatico deriva da:  
> docBase_mps_form_matrici
> docBase_mps_form_matrici deriva da: docBase_mps_form
> docBase_mps_form deriva da: docBase_mps
> docBase_mps deriva da: HTMLPage
> HTMLPage deriva da: Servlet
> Servlet Non faccio Abortire
>
>
>
> For example on Friday from 8 am to 11 am all work fine after 11 am the
> log became populating...
> But every time I found the Servlet as ancestor.
>
> So why issubclass(klass, Servlet) don't return True?
>
> Villiam
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From dpopowich at comcast.net  Mon May 22 08:30:04 2006
From: dpopowich at comcast.net (Daniel J. Popowich)
Date: Mon May 22 08:29:25 2006
Subject: [mod_python] Servlet Loading problem 1 year later
In-Reply-To: <BC53C974C3B9E542BC0A9BD4C5B1168AE1C94F@NEWMAIL.manord.com>
References: <BC53C974C3B9E542BC0A9BD4C5B1168AE1C94F@NEWMAIL.manord.com>
Message-ID: <17521.44748.928546.713447@io.astro.umass.edu>



Manera, Villiam writes:
> This problem happened rarely, but now it raises many times a day.
> I modified the servlet.py in order to do some debugging and it seems
> that  the statement:
> if not issubclass(klass, Servlet): sometimes works and sometimes not.
> 

Here's a modification of an explanation I gave someone else last June
(http://www.modpython.org/pipermail/mod_python/2005-June/018463.html):

If modifying servlet.py and PythonAutoReload is "on" then servlet.py
is being reloaded by mod_python which will create a new Servlet class
in the python interpreter.  Servlets instantiated *after* the change
will not have a problem, but cached instances created *before* the
modifications to servlet.py will be referencing the wrong class (the
reloaded Servlet is not the same class as the one when the cached
objects were instantiated).  This can create quite unpredictable
results when using the prefork MPM because different processes may or
may not have had a cached instance, so sometimes it works and
sometimes it doesn't depending on which process handles your request.
Restarting apache fixes your problem: you get fresh copies of
everything in new python interpreters.

To avoid this:

  1. You really shouldn't change servlet.py.  Put
     modifications/extensions in subclasses...the power of OO and
     all...

  2. In development mode, I configure my prefork apache with:

        MaxRequestsPerChild  1

     Sure, it's a performance hit, but you NEVER have to deal with
     stale python module importing issues and you don't have to
     litter your code with special-case importing code, etc.

Cheers,

Daniel Popowich
---------------
http://home.comcast.net/~d.popowich/mpservlets/
From wouter at squirrel-systems.com  Mon May 22 09:07:34 2006
From: wouter at squirrel-systems.com (Wouter van Marle)
Date: Mon May 22 09:36:26 2006
Subject: [mod_python] Language selection
Message-ID: <1148303255.26486.6.camel@cm222-167-159-88.hkcable.com.hk>

Hi all,

I know it's possible through the http request for browsers to indicate
preference for a language.
Can anyone explain how that works? Or are there code snippets available
for mod_python?

My website now supports four languages (English, Dutch, Chinese
Simplified, Chinese Traditional), defaulting to English. If the user
wants another language, they have to select it manually. It'd be nice if
I can detect there preference and default to that.

Wouter.

From jpg at jgassociates.ca  Mon May 22 09:53:55 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Mon May 22 09:53:56 2006
Subject: [mod_python] Language selection
In-Reply-To: <1148303255.26486.6.camel@cm222-167-159-88.hkcable.com.hk>
References: <1148303255.26486.6.camel@cm222-167-159-88.hkcable.com.hk>
Message-ID: <4471C273.30003@jgassociates.ca>

Wouter van Marle wrote:
> Hi all,
> 
> I know it's possible through the http request for browsers to indicate
> preference for a language.
> Can anyone explain how that works? Or are there code snippets available
> for mod_python?
> 
> My website now supports four languages (English, Dutch, Chinese
> Simplified, Chinese Traditional), defaulting to English. If the user
> wants another language, they have to select it manually. It'd be nice if
> I can detect there preference and default to that.

You want to examine the Accept-Language header, which will likely be set 
by the browser. See RFC-2616 at http://rfc.net/rfc2616.html#s14.4

Note the important caveat in the RFC:

    As intelligibility is highly dependent on the individual user, it is
    recommended that client applications make the choice of linguistic
    preference available to the user. If the choice is not made
    available, then the Accept-Language header field MUST NOT be given in
    the request.

Sorry, I don't have any code snippets.
Jim

From wouter at squirrel-systems.com  Mon May 22 10:35:51 2006
From: wouter at squirrel-systems.com (Wouter van Marle)
Date: Mon May 22 10:35:59 2006
Subject: [mod_python] Language selection
In-Reply-To: <4471C273.30003@jgassociates.ca>
References: <1148303255.26486.6.camel@cm222-167-159-88.hkcable.com.hk>
	<4471C273.30003@jgassociates.ca>
Message-ID: <1148308551.26486.14.camel@cm222-167-159-88.hkcable.com.hk>

On Mon, 2006-05-22 at 09:53 -0400, Jim Gallacher wrote:
> Wouter van Marle wrote:
> > Hi all,
> > 
> > I know it's possible through the http request for browsers to indicate
> > preference for a language.
> > Can anyone explain how that works? Or are there code snippets available
> > for mod_python?
> > 
> > My website now supports four languages (English, Dutch, Chinese
> > Simplified, Chinese Traditional), defaulting to English. If the user
> > wants another language, they have to select it manually. It'd be nice if
> > I can detect there preference and default to that.
> 
> You want to examine the Accept-Language header, which will likely be set 
> by the browser. See RFC-2616 at http://rfc.net/rfc2616.html#s14.4

I found that one in the meantime as well.
Not easy - searching for "language" on google gives heaps of references
to PROGRAMMING languages... 

> Note the important caveat in the RFC:
> 
>     As intelligibility is highly dependent on the individual user, it is
>     recommended that client applications make the choice of linguistic
>     preference available to the user. If the choice is not made
>     available, then the Accept-Language header field MUST NOT be given in
>     the request.

Of course I check for the existence, if not fall back to a default. And
include a separate language selector (had that already).

After I found out the workings of this header the implementation was
easy.

Wouter.

> 
> Sorry, I don't have any code snippets.
> Jim
> 
> 

From jpg at jgassociates.ca  Mon May 22 10:53:37 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Mon May 22 10:53:31 2006
Subject: [mod_python] Language selection
In-Reply-To: <1148308551.26486.14.camel@cm222-167-159-88.hkcable.com.hk>
References: <1148303255.26486.6.camel@cm222-167-159-88.hkcable.com.hk>	<4471C273.30003@jgassociates.ca>
	<1148308551.26486.14.camel@cm222-167-159-88.hkcable.com.hk>
Message-ID: <4471D071.3060601@jgassociates.ca>

Wouter van Marle wrote:
> On Mon, 2006-05-22 at 09:53 -0400, Jim Gallacher wrote:
>> Wouter van Marle wrote:
>>> Hi all,
>>>
>>> I know it's possible through the http request for browsers to indicate
>>> preference for a language.
>>> Can anyone explain how that works? Or are there code snippets available
>>> for mod_python?
>>>
>>> My website now supports four languages (English, Dutch, Chinese
>>> Simplified, Chinese Traditional), defaulting to English. If the user
>>> wants another language, they have to select it manually. It'd be nice if
>>> I can detect there preference and default to that.
>> You want to examine the Accept-Language header, which will likely be set 
>> by the browser. See RFC-2616 at http://rfc.net/rfc2616.html#s14.4
> 
> I found that one in the meantime as well.
> Not easy - searching for "language" on google gives heaps of references
> to PROGRAMMING languages... 

Including "rfc" in your search terms will help when you are looking for 
information on internet protocols. My reaction when I first started 
reading the RFCs was, "Oh, so that's how the internet works". And of 
course your education is not complete until you've read and thoroughly 
understood RFC-1149. Implementation is left to you as an exercise. ;)

Jim
From David.Bear at asu.edu  Mon May 22 16:10:43 2006
From: David.Bear at asu.edu (David Bear)
Date: Mon May 22 16:10:55 2006
Subject: [mod_python] apache.OK and Cookies
In-Reply-To: <1148251770.19073@dscpl.user.openhosting.com>
References: <1148251770.19073@dscpl.user.openhosting.com>
Message-ID: <20060522201043.GH14800@asu.edu>

On Sun, May 21, 2006 at 06:49:30PM -0400, Graham Dumpleton wrote:
> Graham Dumpleton wrote ..
> > jaba@findyourcore.com wrote ..
> > > I have two questions:
> > > 1. is 'return apache.OK' really needed? ive gone without it many times,
> > > and nothing goes wrong.
> > 
> > What version of mod_python are you using?
> > 
> > Can you clarify whether you are using your own handler, where it would
> > should be used, or whether you are using mod_python.publisher where it
> > would not, but if it was may simply result in a extraneous "0" at end of
> > output that may get overlooked.
> > 
> > In summary, if using your own handler, you should always return it. If
> > you don't, you should at least see a warning message in the Apache log
> > files and the results may be unpredictable as to how Apache treats the
> > result.
> 
> Actually, as well as the error in the log file, mod_python should end up
> sending an internal server error (500) response back to Apache. If you
> aren't seeing this, then I would suspect you aren't writing your own
> handler and are using some layer on top where the result may not even be
> a status code, or where status codes are treated differently. For
> example, in mod_python.publisher, the result is converted to a string
> and append to the content. In Vampire, if nothing is returning it is
> equivalent to having returned apache.OK.
> 
> Thus, thus make sure you indicate what handler you are using as well as
> the version of mod_python.

this caused me to think, what happens when a publisher script returns
a psp file? using the example from the mod_python.org web site, all
the functions that are used to 'dispatch' different pages return the
psp file. Does that implicitly then return apache.OK to apache? or is
there something else that need to be done to keep apache happy?

> 
> Graham
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

-- 
David Bear
phone: 	480-965-8257
fax: 	480-965-9189
College of Public Programs/ASU
Wilson Hall 232
Tempe, AZ 85287-0803
 "Beware the IP portfolio, everyone will be suspect of trespassing"
From grahamd at dscpl.com.au  Mon May 22 16:28:58 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon May 22 16:29:19 2006
Subject: [mod_python] Language selection
In-Reply-To: <4471D071.3060601@jgassociates.ca>
References: <1148303255.26486.6.camel@cm222-167-159-88.hkcable.com.hk>	<4471C273.30003@jgassociates.ca>
	<1148308551.26486.14.camel@cm222-167-159-88.hkcable.com.hk>
	<4471D071.3060601@jgassociates.ca>
Message-ID: <69D82CB5-FBA8-48EF-99E5-CDD4D7549829@dscpl.com.au>


On 23/05/2006, at 12:53 AM, Jim Gallacher wrote:

> Wouter van Marle wrote:
>> On Mon, 2006-05-22 at 09:53 -0400, Jim Gallacher wrote:
>>> Wouter van Marle wrote:
>>>> Hi all,
>>>>
>>>> I know it's possible through the http request for browsers to  
>>>> indicate
>>>> preference for a language.
>>>> Can anyone explain how that works? Or are there code snippets  
>>>> available
>>>> for mod_python?
>>>>
>>>> My website now supports four languages (English, Dutch, Chinese
>>>> Simplified, Chinese Traditional), defaulting to English. If the  
>>>> user
>>>> wants another language, they have to select it manually. It'd be  
>>>> nice if
>>>> I can detect there preference and default to that.
>>> You want to examine the Accept-Language header, which will likely  
>>> be set by the browser. See RFC-2616 at http://rfc.net/ 
>>> rfc2616.html#s14.4
>> I found that one in the meantime as well.
>> Not easy - searching for "language" on google gives heaps of  
>> references
>> to PROGRAMMING languages...
>
> Including "rfc" in your search terms will help when you are looking  
> for information on internet protocols. My reaction when I first  
> started reading the RFCs was, "Oh, so that's how the internet  
> works". And of course your education is not complete until you've  
> read and thoroughly understood RFC-1149. Implementation is left to  
> you as an exercise. ;)

FWIW, req.content_languages isn't writable.

I noted that this wasn't writable in some arbitrary JIRA issue  
sometime ago, but
didn't actually create a proper issue for it, since I don't use  
languages and thus
wasn't sure I understood the issues and how this attribute came into  
play.

Graham
From grahamd at dscpl.com.au  Mon May 22 16:30:42 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon May 22 16:31:39 2006
Subject: [mod_python] apache.OK and Cookies
In-Reply-To: <20060522201043.GH14800@asu.edu>
References: <1148251770.19073@dscpl.user.openhosting.com>
	<20060522201043.GH14800@asu.edu>
Message-ID: <0FAA1615-9C08-4C46-83A4-788C63E475B7@dscpl.com.au>


On 23/05/2006, at 6:10 AM, David Bear wrote:

> On Sun, May 21, 2006 at 06:49:30PM -0400, Graham Dumpleton wrote:
>> Graham Dumpleton wrote ..
>>> jaba@findyourcore.com wrote ..
>>>> I have two questions:
>>>> 1. is 'return apache.OK' really needed? ive gone without it many  
>>>> times,
>>>> and nothing goes wrong.
>>>
>>> What version of mod_python are you using?
>>>
>>> Can you clarify whether you are using your own handler, where it  
>>> would
>>> should be used, or whether you are using mod_python.publisher  
>>> where it
>>> would not, but if it was may simply result in a extraneous "0" at  
>>> end of
>>> output that may get overlooked.
>>>
>>> In summary, if using your own handler, you should always return  
>>> it. If
>>> you don't, you should at least see a warning message in the  
>>> Apache log
>>> files and the results may be unpredictable as to how Apache  
>>> treats the
>>> result.
>>
>> Actually, as well as the error in the log file, mod_python should  
>> end up
>> sending an internal server error (500) response back to Apache. If  
>> you
>> aren't seeing this, then I would suspect you aren't writing your own
>> handler and are using some layer on top where the result may not  
>> even be
>> a status code, or where status codes are treated differently. For
>> example, in mod_python.publisher, the result is converted to a string
>> and append to the content. In Vampire, if nothing is returning it is
>> equivalent to having returned apache.OK.
>>
>> Thus, thus make sure you indicate what handler you are using as  
>> well as
>> the version of mod_python.
>
> this caused me to think, what happens when a publisher script returns
> a psp file? using the example from the mod_python.org web site, all
> the functions that are used to 'dispatch' different pages return the
> psp file. Does that implicitly then return apache.OK to apache? or is
> there something else that need to be done to keep apache happy?

The returned PSP object has a __str__() method so the PSP page gets
executed and string result sent in response.

Graham
From grahamd at dscpl.com.au  Mon May 22 16:56:10 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon May 22 16:56:23 2006
Subject: R: [mod_python] Servlet Loading problem 1 year later
In-Reply-To: <BC53C974C3B9E542BC0A9BD4C5B1168AE1C950@NEWMAIL.manord.com>
References: <BC53C974C3B9E542BC0A9BD4C5B1168AE1C950@NEWMAIL.manord.com>
Message-ID: <9ED4629E-0A83-4167-A2EC-53AA20E1F7DF@dscpl.com.au>

Please keep followups on list.

You don't need to actually touch servlet.py to get problems if you
happen to be using "import" and "apache.import_module()" on the
same module at different times. This is because of an issue in
the mod_python importer. See:

   http://www.dscpl.com.au/articles/modpython-003.html#redundant- 
module-loading

Sorry for quick reply, in a rush. I'll try and comment later on the
whole issue of checking subclass types and caching.

Graham

On 22/05/2006, at 11:06 PM, Manera, Villiam wrote:

> Yes, i knows that it could be happened if I touch servlet.py becouse
> Daniel Popowiwich told me 1 year ago.
>
> Now I have changed servlet.py only for the debug pourpose, after  
> that I
> have stopped apache and then restart.
> Every nigth Apache is restart, so when the problem had occurred apache
> was restarted and Servelt.py not modified.
>
> In the log:
> 19/05/2006 11:21:07
> Stat_utente deriva da: docBase_mps_form
> docBase_mps_form deriva da: docBase_mps
> docBase_mps deriva da: HTMLPage
> HTMLPage deriva da: Servlet
> Servlet Non faccio Abortire
>
> Stat_utente is the .mps that programmes may modify without restart
> apache, not
> docBase_mps_form
> docBase_mps
> HTMLPage
> Or Servlet
>
>
>
> On 22/05/2006, at 12:55 Graham Dumpleton wrote:
>
>> Possibly a similar problem to:
>
>>
> http://www.modpython.org/pipermail/mod_python/2004-October/016596.html
>
> Graham	
>
> On 22/05/2006, at 8:38 PM, Manera, Villiam wrote:
>
>> This problem happened rarely, but now it raises many times a day. I
> .....

From grahamd at dscpl.com.au  Mon May 22 18:48:38 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon May 22 18:49:18 2006
Subject: [mod_python] apache.OK and Cookies
Message-ID: <1148338118.31013@dscpl.user.openhosting.com>

David Bear wrote ..
> On Tue, May 23, 2006 at 06:30:42AM +1000, Graham Dumpleton wrote:
> > 
> > On 23/05/2006, at 6:10 AM, David Bear wrote:
> > 
> > >On Sun, May 21, 2006 at 06:49:30PM -0400, Graham Dumpleton wrote:
> > >>Graham Dumpleton wrote ..
> > >>Thus, thus make sure you indicate what handler you are using as  
> > >>well as
> > >>the version of mod_python.
> > >
> > >this caused me to think, what happens when a publisher script returns
> > >a psp file? using the example from the mod_python.org web site, all
> > >the functions that are used to 'dispatch' different pages return the
> > >psp file. Does that implicitly then return apache.OK to apache? or is
> > >there something else that need to be done to keep apache happy?
> > 
> > The returned PSP object has a __str__() method so the PSP page gets
> > executed and string result sent in response.
> 
> so, the fact that at string  is being returned implies an apache.OK

Please try and keep followups on mailing list.

Anything returned using "return" from a publisher, or even implicit
return of "None", implies apache.OK. If you want to return some other
status you have to do one of either two things.

1. Raise an apache.SERVER_RETURN exception with status as argument.

  raise apache.SERVER_RETURN, apache.HTTP_FORBIDDEN

OR 2. Set status in req object explicitly.

  req.status = apache.HTTP_FORBIDDEN
  return "... page content ..."

When the result returned isn't a string or Unicode, publisher will apply str()
to it to convert it to a string representation. In the case of Unicode it will
convert it to a string based on calculated encoding type.

Graham
From wouter at squirrel-systems.com  Mon May 22 23:18:12 2006
From: wouter at squirrel-systems.com (Wouter van Marle)
Date: Mon May 22 23:18:32 2006
Subject: [mod_python] Problem with html quoted/unquoted
In-Reply-To: <446B9F03.20704@jgassociates.ca>
References: <1147837098.17770.175.camel@pistachio.squirrel>
	<5c06fa770605170802j4cf0cfffg4bccb38c1bdb9cba@mail.gmail.com>
	<1147879049.8449.135.camel@cm222-167-159-88.hkcable.com.hk>
	<446B4555.9040308@jgassociates.ca>
	<1147881203.8449.140.camel@cm222-167-159-88.hkcable.com.hk>
	<446B9F03.20704@jgassociates.ca>
Message-ID: <1148354292.18791.47.camel@pistachio.squirrel>

On Wed, 2006-05-17 at 18:09 -0400, Jim Gallacher wrote:
> >> cur.execute("SELECT * FROM base WHERE field = %s", s)
> > 
> > I have tried this (once) with MySQLdb, and it doesn't seem to work
> like
> > that. (v1.2.1g2) Didn't pursue the issue further.
> 
> You must be doing something wrong. A quick test on my system:
> 
>  >>> s = """This is 'some' stuff with "quotes" and stuff"""
>  >>> cursor.execute('insert into testtable (data) values (%s)', s)
> 1L

Just tried it for myself - it works now.
Maybe I had an older version of MySQLdb when testing? I don't know
anymore. I'll follow your advice and fix my code!

And after that the info in the databases... that's going to be a harder
job.

Wouter.


From wouter at squirrel-systems.com  Mon May 22 23:50:16 2006
From: wouter at squirrel-systems.com (Wouter van Marle)
Date: Mon May 22 23:50:21 2006
Subject: [mod_python] Problem with html quoted/unquoted
In-Reply-To: <1148354292.18791.47.camel@pistachio.squirrel>
References: <1147837098.17770.175.camel@pistachio.squirrel>
	<5c06fa770605170802j4cf0cfffg4bccb38c1bdb9cba@mail.gmail.com>
	<1147879049.8449.135.camel@cm222-167-159-88.hkcable.com.hk>
	<446B4555.9040308@jgassociates.ca>
	<1147881203.8449.140.camel@cm222-167-159-88.hkcable.com.hk>
	<446B9F03.20704@jgassociates.ca>
	<1148354292.18791.47.camel@pistachio.squirrel>
Message-ID: <1148356216.18791.55.camel@pistachio.squirrel>

On Tue, 2006-05-23 at 11:18 +0800, Wouter van Marle wrote:
> On Wed, 2006-05-17 at 18:09 -0400, Jim Gallacher wrote:
> > >> cur.execute("SELECT * FROM base WHERE field = %s", s)
> > > 
> > > I have tried this (once) with MySQLdb, and it doesn't seem to work
> > like
> > > that. (v1.2.1g2) Didn't pursue the issue further.
> > 
> > You must be doing something wrong. A quick test on my system:
> > 
> >  >>> s = """This is 'some' stuff with "quotes" and stuff"""
> >  >>> cursor.execute('insert into testtable (data) values (%s)', s)
> > 1L
> 
> Just tried it for myself - it works now.

RRrrrriiiiigggghhhttt.... that said.... I just tried again... and now
have a fail. Now I also remember why I didn't use that method yet :)

- Debian Sarge, MySQLdb 1.2.1g2: works fine.
- Mandriva Linux LE2005 (v10.2), MySQLdb 1.2.1g3: gives SQL error on
this one.

>>> cursor.execute("INSERT INTO testtable (field1) VALUES ('This is a
string!');")
1L
>>> cursor.execute("INSERT INTO testtable (field1) VALUES (%s);"% s)

Traceback (most recent call last):
  File "<pyshell#15>", line 1, in -toplevel-
    cursor.execute("INSERT INTO testtable (field1) VALUES (%s);"% s)
  File "/usr/lib/python2.4/site-packages/MySQLdb/cursors.py", line 137,
in execute
    self.errorhandler(self, exc, value)
  File "/usr/lib/python2.4/site-packages/MySQLdb/connections.py", line
33, in defaulterrorhandler
    raise errorclass, errorvalue
ProgrammingError: (1064, 'You have an error in your SQL syntax; check
the manual that corresponds to your MySQL server version for the right
syntax to use near \'\'some\' stuff with "quotes" and stuff)\' at line
1')

- Mandriva Linux 2006.0, MySQLdb 1.2.0final: works fine.

So there is a serious bug in MySQLdb as well; seems to be the 1.2.1g3
version.

Wouter.

> Maybe I had an older version of MySQLdb when testing? I don't know
> anymore. I'll follow your advice and fix my code!
> 
> And after that the info in the databases... that's going to be a harder
> job.
> 
> Wouter.
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 
> 

From wouter at squirrel-systems.com  Tue May 23 00:27:48 2006
From: wouter at squirrel-systems.com (Wouter van Marle)
Date: Tue May 23 00:27:53 2006
Subject: [mod_python] Language selection
In-Reply-To: <4471D071.3060601@jgassociates.ca>
References: <1148303255.26486.6.camel@cm222-167-159-88.hkcable.com.hk>
	<4471C273.30003@jgassociates.ca>
	<1148308551.26486.14.camel@cm222-167-159-88.hkcable.com.hk>
	<4471D071.3060601@jgassociates.ca>
Message-ID: <1148358468.18791.59.camel@pistachio.squirrel>

On Mon, 2006-05-22 at 10:53 -0400, Jim Gallacher wrote:
> Including "rfc" in your search terms will help when you are looking
> for 
> information on internet protocols. 

Good advice... will try to remember that.

> My reaction when I first started 
> reading the RFCs was, "Oh, so that's how the internet works". And of 
> course your education is not complete until you've read and
> thoroughly 
> understood RFC-1149. Implementation is left to you as an exercise. ;)

Oh I don't have the ambition to go that deep down :) That's just too
much for me. I'm happy to be able to hack a site together, I've put a
translation database behind it translating everything automatically and
on-the-fly, makes me a bit proud. And now when sending out links to
people using another language, they will automatically see the site in
their preferred language! Which is great I think.

Wouter.

From listspam at flowtheory.net  Tue May 23 01:49:00 2006
From: listspam at flowtheory.net (Joshua Ginsberg)
Date: Tue May 23 01:49:45 2006
Subject: [SPAM] Re: [mod_python] Problem with html quoted/unquoted
In-Reply-To: <1148356216.18791.55.camel@pistachio.squirrel>
References: <1147837098.17770.175.camel@pistachio.squirrel>
	<5c06fa770605170802j4cf0cfffg4bccb38c1bdb9cba@mail.gmail.com>
	<1147879049.8449.135.camel@cm222-167-159-88.hkcable.com.hk>
	<446B4555.9040308@jgassociates.ca>
	<1147881203.8449.140.camel@cm222-167-159-88.hkcable.com.hk>
	<446B9F03.20704@jgassociates.ca>
	<1148354292.18791.47.camel@pistachio.squirrel>
	<1148356216.18791.55.camel@pistachio.squirrel>
Message-ID: <af55c2e46fd3785a8b67656248728815@flowtheory.net>

Wouter --

You used % to do string substitution on the first argument to execute() 
as opposed to passing a tuple as a second argument to execute().

-jag

On May 22, 2006, at 11:50 PM, Wouter van Marle wrote:

> On Tue, 2006-05-23 at 11:18 +0800, Wouter van Marle wrote:
>> On Wed, 2006-05-17 at 18:09 -0400, Jim Gallacher wrote:
>>>>> cur.execute("SELECT * FROM base WHERE field = %s", s)
>>>>
>>>> I have tried this (once) with MySQLdb, and it doesn't seem to work
>>> like
>>>> that. (v1.2.1g2) Didn't pursue the issue further.
>>>
>>> You must be doing something wrong. A quick test on my system:
>>>
>>>>>> s = """This is 'some' stuff with "quotes" and stuff"""
>>>>>> cursor.execute('insert into testtable (data) values (%s)', s)
>>> 1L
>>
>> Just tried it for myself - it works now.
>
> RRrrrriiiiigggghhhttt.... that said.... I just tried again... and now
> have a fail. Now I also remember why I didn't use that method yet :)
>
> - Debian Sarge, MySQLdb 1.2.1g2: works fine.
> - Mandriva Linux LE2005 (v10.2), MySQLdb 1.2.1g3: gives SQL error on
> this one.
>
>>>> cursor.execute("INSERT INTO testtable (field1) VALUES ('This is a
> string!');")
> 1L
>>>> cursor.execute("INSERT INTO testtable (field1) VALUES (%s);"% s)
>
> Traceback (most recent call last):
>   File "<pyshell#15>", line 1, in -toplevel-
>     cursor.execute("INSERT INTO testtable (field1) VALUES (%s);"% s)
>   File "/usr/lib/python2.4/site-packages/MySQLdb/cursors.py", line 137,
> in execute
>     self.errorhandler(self, exc, value)
>   File "/usr/lib/python2.4/site-packages/MySQLdb/connections.py", line
> 33, in defaulterrorhandler
>     raise errorclass, errorvalue
> ProgrammingError: (1064, 'You have an error in your SQL syntax; check
> the manual that corresponds to your MySQL server version for the right
> syntax to use near \'\'some\' stuff with "quotes" and stuff)\' at line
> 1')
>
> - Mandriva Linux 2006.0, MySQLdb 1.2.0final: works fine.
>
> So there is a serious bug in MySQLdb as well; seems to be the 1.2.1g3
> version.
>
> Wouter.
>
>> Maybe I had an older version of MySQLdb when testing? I don't know
>> anymore. I'll follow your advice and fix my code!
>>
>> And after that the info in the databases... that's going to be a 
>> harder
>> job.
>>
>> Wouter.
>>
>>
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>
>>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From wouter at squirrel-systems.com  Tue May 23 02:22:58 2006
From: wouter at squirrel-systems.com (Wouter van Marle)
Date: Tue May 23 02:23:05 2006
Subject: [mod_python] Problem with html quoted/unquoted
In-Reply-To: <af55c2e46fd3785a8b67656248728815@flowtheory.net>
References: <1147837098.17770.175.camel@pistachio.squirrel>
	<5c06fa770605170802j4cf0cfffg4bccb38c1bdb9cba@mail.gmail.com>
	<1147879049.8449.135.camel@cm222-167-159-88.hkcable.com.hk>
	<446B4555.9040308@jgassociates.ca>
	<1147881203.8449.140.camel@cm222-167-159-88.hkcable.com.hk>
	<446B9F03.20704@jgassociates.ca>
	<1148354292.18791.47.camel@pistachio.squirrel>
	<1148356216.18791.55.camel@pistachio.squirrel>
	<af55c2e46fd3785a8b67656248728815@flowtheory.net>
Message-ID: <1148365378.18791.67.camel@pistachio.squirrel>

On Tue, 2006-05-23 at 01:49 -0400, Joshua Ginsberg wrote:
> Wouter --
> 
> You used % to do string substitution on the first argument to execute() 
> as opposed to passing a tuple as a second argument to execute().

I don't get your meaning.
Can you please give me the lines of code as example? Thanks!

Wouter.

> 
> -jag
> 
> On May 22, 2006, at 11:50 PM, Wouter van Marle wrote:
> 
> > On Tue, 2006-05-23 at 11:18 +0800, Wouter van Marle wrote:
> >> On Wed, 2006-05-17 at 18:09 -0400, Jim Gallacher wrote:
> >>>>> cur.execute("SELECT * FROM base WHERE field = %s", s)
> >>>>
> >>>> I have tried this (once) with MySQLdb, and it doesn't seem to work
> >>> like
> >>>> that. (v1.2.1g2) Didn't pursue the issue further.
> >>>
> >>> You must be doing something wrong. A quick test on my system:
> >>>
> >>>>>> s = """This is 'some' stuff with "quotes" and stuff"""
> >>>>>> cursor.execute('insert into testtable (data) values (%s)', s)
> >>> 1L
> >>
> >> Just tried it for myself - it works now.
> >
> > RRrrrriiiiigggghhhttt.... that said.... I just tried again... and now
> > have a fail. Now I also remember why I didn't use that method yet :)
> >
> > - Debian Sarge, MySQLdb 1.2.1g2: works fine.
> > - Mandriva Linux LE2005 (v10.2), MySQLdb 1.2.1g3: gives SQL error on
> > this one.
> >
> >>>> cursor.execute("INSERT INTO testtable (field1) VALUES ('This is a
> > string!');")
> > 1L
> >>>> cursor.execute("INSERT INTO testtable (field1) VALUES (%s);"% s)
> >
> > Traceback (most recent call last):
> >   File "<pyshell#15>", line 1, in -toplevel-
> >     cursor.execute("INSERT INTO testtable (field1) VALUES (%s);"% s)
> >   File "/usr/lib/python2.4/site-packages/MySQLdb/cursors.py", line 137,
> > in execute
> >     self.errorhandler(self, exc, value)
> >   File "/usr/lib/python2.4/site-packages/MySQLdb/connections.py", line
> > 33, in defaulterrorhandler
> >     raise errorclass, errorvalue
> > ProgrammingError: (1064, 'You have an error in your SQL syntax; check
> > the manual that corresponds to your MySQL server version for the right
> > syntax to use near \'\'some\' stuff with "quotes" and stuff)\' at line
> > 1')
> >
> > - Mandriva Linux 2006.0, MySQLdb 1.2.0final: works fine.
> >
> > So there is a serious bug in MySQLdb as well; seems to be the 1.2.1g3
> > version.
> >
> > Wouter.
> >
> >> Maybe I had an older version of MySQLdb when testing? I don't know
> >> anymore. I'll follow your advice and fix my code!
> >>
> >> And after that the info in the databases... that's going to be a 
> >> harder
> >> job.
> >>
> >> Wouter.
> >>
> >>
> >> _______________________________________________
> >> Mod_python mailing list
> >> Mod_python@modpython.org
> >> http://mailman.modpython.org/mailman/listinfo/mod_python
> >>
> >>
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> 
> 

From trevor at thennion.demon.co.uk  Tue May 23 03:58:25 2006
From: trevor at thennion.demon.co.uk (Trevor Hennion)
Date: Tue May 23 03:58:36 2006
Subject: [mod_python] Problem with html quoted/unquoted
In-Reply-To: <1148365378.18791.67.camel@pistachio.squirrel>
References: <1147837098.17770.175.camel@pistachio.squirrel>	<5c06fa770605170802j4cf0cfffg4bccb38c1bdb9cba@mail.gmail.com>	<1147879049.8449.135.camel@cm222-167-159-88.hkcable.com.hk>	<446B4555.9040308@jgassociates.ca>	<1147881203.8449.140.camel@cm222-167-159-88.hkcable.com.hk>	<446B9F03.20704@jgassociates.ca>	<1148354292.18791.47.camel@pistachio.squirrel>	<1148356216.18791.55.camel@pistachio.squirrel>	<af55c2e46fd3785a8b67656248728815@flowtheory.net>
	<1148365378.18791.67.camel@pistachio.squirrel>
Message-ID: <4472C0A1.7010409@thennion.demon.co.uk>

Wouter van Marle wrote:
> On Tue, 2006-05-23 at 01:49 -0400, Joshua Ginsberg wrote:
>> Wouter --
>>
>> You used % to do string substitution on the first argument to execute() 
>> as opposed to passing a tuple as a second argument to execute().
> 
> I don't get your meaning.
> Can you please give me the lines of code as example? Thanks!
> 
> Wouter.
> 

Wouter,

I have been stuggling to understand this as well

I believe that it should look like this:

s = """This is 'some' stuff with "quotes" and stuff"""
cursor.execute('INSERT INTO testtable (field1) VALUES (%s)', (s,))

If this is incorrect please somebody put me right!

Regards

Trevor Hennion
http://www.infocentrality.co.uk
From vmanera at manord.com  Tue May 23 06:15:45 2006
From: vmanera at manord.com (Manera, Villiam)
Date: Tue May 23 06:15:57 2006
Subject: R: R: [mod_python] Servlet Loading problem 1 year later
Message-ID: <BC53C974C3B9E542BC0A9BD4C5B1168AE1C957@NEWMAIL.manord.com>

I don't use apache.import_module() in any of my own modules.
The problem arise in developer (linux:RH3 EL mod_python 3.2.8)
And in the production          (linux:RH3 EL mod_python 3.1.5)

If I right understand the article only in mod_python 3.2.8 the new
module loding is in place.

Villiam


On 22/05/2006 at 22:56 Graham Dumpleton wrote:

>Please keep followups on list.

>You don't need to actually touch servlet.py to get problems if you
happen to be using "import" and "apache.import_module ()" on the same
module at different times. This is because of an issue in the mod_python
importer. See:

>
http://www.dscpl.com.au/articles/modpython-003.html#redundant-module-loa
ding

>Sorry for quick reply, in a rush. I'll try and comment later on the
whole issue of checking subclass types and caching.

>Graham

On 22/05/2006, at 11:06 PM, Manera, Villiam wrote:

> Yes, i knows that it could be happened if I touch servlet.py becouse 
> Daniel Popowiwich told me 1 year ago.
>
>....

From grahamd at dscpl.com.au  Tue May 23 07:09:13 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue May 23 07:09:51 2006
Subject: R: R: [mod_python] Servlet Loading problem 1 year later
In-Reply-To: <BC53C974C3B9E542BC0A9BD4C5B1168AE1C957@NEWMAIL.manord.com>
References: <BC53C974C3B9E542BC0A9BD4C5B1168AE1C957@NEWMAIL.manord.com>
Message-ID: <5A06EDAB-E5A6-42B9-8DD0-0305391E46D4@dscpl.com.au>

On 23/05/2006, at 8:15 PM, Manera, Villiam wrote:

> I don't use apache.import_module() in any of my own modules.
> The problem arise in developer (linux:RH3 EL mod_python 3.2.8)
> And in the production          (linux:RH3 EL mod_python 3.1.5)
>
> If I right understand the article only in mod_python 3.2.8 the new
> module loding is in place.
>
> Villiam

If you are specifying:

   PythonHandler mod_python.servlet

or:

   PythonHandler servlet

if you put the mpservlets code in your handler directory, then you are.

This is because the PythonHandler directive uses "apache.import_module 
()".

All it then takes to cause problems is for you to use:

   import mod_python.servlet
   from mod_python import servlet

or:

   import servlet

depending on whether mpservlets installed centrally or in handler  
directory.

If this is the case, you might solve the problem by using  
"apache.import_module()"
to import "mod_python.servlet" etc.

Graham

> On 22/05/2006 at 22:56 Graham Dumpleton wrote:
>
>> Please keep followups on list.
>
>> You don't need to actually touch servlet.py to get problems if you
> happen to be using "import" and "apache.import_module ()" on the same
> module at different times. This is because of an issue in the  
> mod_python
> importer. See:
>
>>
> http://www.dscpl.com.au/articles/modpython-003.html#redundant- 
> module-loa
> ding
>
>> Sorry for quick reply, in a rush. I'll try and comment later on the
> whole issue of checking subclass types and caching.
>
>> Graham
>
> On 22/05/2006, at 11:06 PM, Manera, Villiam wrote:
>
>> Yes, i knows that it could be happened if I touch servlet.py becouse
>> Daniel Popowiwich told me 1 year ago.
>>
>> ....

From jpg at jgassociates.ca  Tue May 23 07:50:18 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Tue May 23 07:50:19 2006
Subject: [mod_python] Problem with html quoted/unquoted
In-Reply-To: <4472C0A1.7010409@thennion.demon.co.uk>
References: <1147837098.17770.175.camel@pistachio.squirrel>	<5c06fa770605170802j4cf0cfffg4bccb38c1bdb9cba@mail.gmail.com>	<1147879049.8449.135.camel@cm222-167-159-88.hkcable.com.hk>	<446B4555.9040308@jgassociates.ca>	<1147881203.8449.140.camel@cm222-167-159-88.hkcable.com.hk>	<446B9F03.20704@jgassociates.ca>	<1148354292.18791.47.camel@pistachio.squirrel>	<1148356216.18791.55.camel@pistachio.squirrel>	<af55c2e46fd3785a8b67656248728815@flowtheory.net>	<1148365378.18791.67.camel@pistachio.squirrel>
	<4472C0A1.7010409@thennion.demon.co.uk>
Message-ID: <4472F6FA.6080608@jgassociates.ca>

Trevor Hennion wrote:
> Wouter van Marle wrote:
>> On Tue, 2006-05-23 at 01:49 -0400, Joshua Ginsberg wrote:
>>> Wouter --
>>>
>>> You used % to do string substitution on the first argument to 
>>> execute() as opposed to passing a tuple as a second argument to 
>>> execute().
>>
>> I don't get your meaning.
>> Can you please give me the lines of code as example? Thanks!
>>
>> Wouter.
>>
> 
> Wouter,
> 
> I have been stuggling to understand this as well
> 
> I believe that it should look like this:
> 
> s = """This is 'some' stuff with "quotes" and stuff"""
> cursor.execute('INSERT INTO testtable (field1) VALUES (%s)', (s,))
> 
> If this is incorrect please somebody put me right!

Your code snippet is correct. If you only have one parameter you don't 
need to wrap it in a tuple although that may be dependent on the DBI 
implementation. I usually wrap it anyway as you have done just to keep 
my code consistent.

Jim
From listspam at flowtheory.net  Tue May 23 08:27:52 2006
From: listspam at flowtheory.net (Joshua Ginsberg)
Date: Tue May 23 08:28:36 2006
Subject: [SPAM] Re: [mod_python] Problem with html quoted/unquoted
In-Reply-To: <1148365378.18791.67.camel@pistachio.squirrel>
References: <1147837098.17770.175.camel@pistachio.squirrel>
	<5c06fa770605170802j4cf0cfffg4bccb38c1bdb9cba@mail.gmail.com>
	<1147879049.8449.135.camel@cm222-167-159-88.hkcable.com.hk>
	<446B4555.9040308@jgassociates.ca>
	<1147881203.8449.140.camel@cm222-167-159-88.hkcable.com.hk>
	<446B9F03.20704@jgassociates.ca>
	<1148354292.18791.47.camel@pistachio.squirrel>
	<1148356216.18791.55.camel@pistachio.squirrel>
	<af55c2e46fd3785a8b67656248728815@flowtheory.net>
	<1148365378.18791.67.camel@pistachio.squirrel>
Message-ID: <f5b1fb416df312b3488460fc06d1cb64@flowtheory.net>

This will work:

c.execute('select foo from bar where baz = %s', (s,))

You are passing two arguments to execute() -- the first being a string 
representing SQL and the second being a tuple of values to be 
substituted in. The execute() method is smart enough to quote where 
necessary.

This will not work:

c.execute('select foo from bar where baz = %s' % (s,))

You are passing a single argument to execute() -- a string that does 
Python string formatting. The execute() method does not have a chance 
to be smart enough to quote where necessary.

In your "quick test on your system" you refer to below, you use the 
first method. In your "I just tried again" you use the second method, 
which is why it fails.

-jag

On May 23, 2006, at 2:22 AM, Wouter van Marle wrote:

> On Tue, 2006-05-23 at 01:49 -0400, Joshua Ginsberg wrote:
>> Wouter --
>>
>> You used % to do string substitution on the first argument to 
>> execute()
>> as opposed to passing a tuple as a second argument to execute().
>
> I don't get your meaning.
> Can you please give me the lines of code as example? Thanks!
>
> Wouter.
>
>>
>> -jag
>>
>> On May 22, 2006, at 11:50 PM, Wouter van Marle wrote:
>>
>>> On Tue, 2006-05-23 at 11:18 +0800, Wouter van Marle wrote:
>>>> On Wed, 2006-05-17 at 18:09 -0400, Jim Gallacher wrote:
>>>>>>> cur.execute("SELECT * FROM base WHERE field = %s", s)
>>>>>>
>>>>>> I have tried this (once) with MySQLdb, and it doesn't seem to work
>>>>> like
>>>>>> that. (v1.2.1g2) Didn't pursue the issue further.
>>>>>
>>>>> You must be doing something wrong. A quick test on my system:
>>>>>
>>>>>>>> s = """This is 'some' stuff with "quotes" and stuff"""
>>>>>>>> cursor.execute('insert into testtable (data) values (%s)', s)
>>>>> 1L
>>>>
>>>> Just tried it for myself - it works now.
>>>
>>> RRrrrriiiiigggghhhttt.... that said.... I just tried again... and now
>>> have a fail. Now I also remember why I didn't use that method yet :)
>>>
>>> - Debian Sarge, MySQLdb 1.2.1g2: works fine.
>>> - Mandriva Linux LE2005 (v10.2), MySQLdb 1.2.1g3: gives SQL error on
>>> this one.
>>>
>>>>>> cursor.execute("INSERT INTO testtable (field1) VALUES ('This is a
>>> string!');")
>>> 1L
>>>>>> cursor.execute("INSERT INTO testtable (field1) VALUES (%s);"% s)
>>>
>>> Traceback (most recent call last):
>>>   File "<pyshell#15>", line 1, in -toplevel-
>>>     cursor.execute("INSERT INTO testtable (field1) VALUES (%s);"% s)
>>>   File "/usr/lib/python2.4/site-packages/MySQLdb/cursors.py", line 
>>> 137,
>>> in execute
>>>     self.errorhandler(self, exc, value)
>>>   File "/usr/lib/python2.4/site-packages/MySQLdb/connections.py", 
>>> line
>>> 33, in defaulterrorhandler
>>>     raise errorclass, errorvalue
>>> ProgrammingError: (1064, 'You have an error in your SQL syntax; check
>>> the manual that corresponds to your MySQL server version for the 
>>> right
>>> syntax to use near \'\'some\' stuff with "quotes" and stuff)\' at 
>>> line
>>> 1')
>>>
>>> - Mandriva Linux 2006.0, MySQLdb 1.2.0final: works fine.
>>>
>>> So there is a serious bug in MySQLdb as well; seems to be the 1.2.1g3
>>> version.
>>>
>>> Wouter.
>>>
>>>> Maybe I had an older version of MySQLdb when testing? I don't know
>>>> anymore. I'll follow your advice and fix my code!
>>>>
>>>> And after that the info in the databases... that's going to be a
>>>> harder
>>>> job.
>>>>
>>>> Wouter.
>>>>
>>>>
>>>> _______________________________________________
>>>> Mod_python mailing list
>>>> Mod_python@modpython.org
>>>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>>>
>>>>
>>>
>>> _______________________________________________
>>> Mod_python mailing list
>>> Mod_python@modpython.org
>>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>
>>
>

From vmanera at manord.com  Tue May 23 09:30:54 2006
From: vmanera at manord.com (Manera, Villiam)
Date: Tue May 23 09:31:06 2006
Subject: R: R: R: [mod_python] Servlet Loading problem 1 year later
Message-ID: <BC53C974C3B9E542BC0A9BD4C5B1168AE1C959@NEWMAIL.manord.com>

Ok! I have PythonHandler mod_python.servlet, and only 5 modules with:
>From mod_python.servlet import * so no hard work for fix.

Instead a lot with:
from mod_python.servlet import HTMLPage (HTMLPage inherit from Servlet)

Sorry for my ignorance, but I have to fix with apache.import_module() also those that import HTMPLPage?

Villiam

-----Messaggio originale-----
Da: Graham Dumpleton [mailto:grahamd@dscpl.com.au] 
Inviato: marted? 23 maggio 2006 13.09
A: Manera, Villiam
Cc: mod_python@modpython... list
Oggetto: Re: R: R: [mod_python] Servlet Loading problem 1 year later


On 23/05/2006, at 8:15 PM, Manera, Villiam wrote:

> I don't use apache.import_module() in any of my own modules. The 
> problem arise in developer (linux:RH3 EL mod_python 3.2.8)
> And in the production          (linux:RH3 EL mod_python 3.1.5)
>
> If I right understand the article only in mod_python 3.2.8 the new 
> module loding is in place.
>
> Villiam

If you are specifying:

   PythonHandler mod_python.servlet

or:

   PythonHandler servlet

if you put the mpservlets code in your handler directory, then you are.

This is because the PythonHandler directive uses "apache.import_module 
()".

All it then takes to cause problems is for you to use:

   import mod_python.servlet
   from mod_python import servlet

or:

   import servlet

depending on whether mpservlets installed centrally or in handler  
directory.

If this is the case, you might solve the problem by using  
"apache.import_module()"
to import "mod_python.servlet" etc.

Graham

> On 22/05/2006 at 22:56 Graham Dumpleton wrote:
>
>> Please keep followups on list.
>
>> You don't need to actually touch servlet.py to get problems if you
> happen to be using "import" and "apache.import_module ()" on the same 
> module at different times. This is because of an issue in the
> mod_python
> importer. See:
>
>>
> http://www.dscpl.com.au/articles/modpython-003.html#redundant-
> module-loa
> ding
>
>> Sorry for quick reply, in a rush. I'll try and comment later on the
> whole issue of checking subclass types and caching.
>
>> Graham
>
> On 22/05/2006, at 11:06 PM, Manera, Villiam wrote:
>
>> Yes, i knows that it could be happened if I touch servlet.py becouse 
>> Daniel Popowiwich told me 1 year ago.
>>
>> ....


From wouter at squirrel-systems.com  Tue May 23 10:50:48 2006
From: wouter at squirrel-systems.com (Wouter van Marle)
Date: Tue May 23 10:52:11 2006
Subject: [mod_python] Problem with html quoted/unquoted
In-Reply-To: <f5b1fb416df312b3488460fc06d1cb64@flowtheory.net>
References: <1147837098.17770.175.camel@pistachio.squirrel>
	<5c06fa770605170802j4cf0cfffg4bccb38c1bdb9cba@mail.gmail.com>
	<1147879049.8449.135.camel@cm222-167-159-88.hkcable.com.hk>
	<446B4555.9040308@jgassociates.ca>
	<1147881203.8449.140.camel@cm222-167-159-88.hkcable.com.hk>
	<446B9F03.20704@jgassociates.ca>
	<1148354292.18791.47.camel@pistachio.squirrel>
	<1148356216.18791.55.camel@pistachio.squirrel>
	<af55c2e46fd3785a8b67656248728815@flowtheory.net>
	<1148365378.18791.67.camel@pistachio.squirrel>
	<f5b1fb416df312b3488460fc06d1cb64@flowtheory.net>
Message-ID: <1148395849.5731.4.camel@cm222-167-159-88.hkcable.com.hk>

Joshua, Jim,

Thanks for the replies - I think I understand it now. I completely
overlooked the , vs % in the string replacement! When testing it on my
debian box I copy-pasted the example in, while later I typed it in by
hand. And then used the % which I didn't notice was "replaced" by a
comma...
That'll make a big difference.

Wouter.


On Tue, 2006-05-23 at 08:27 -0400, Joshua Ginsberg wrote:
> This will work:
> 
> c.execute('select foo from bar where baz = %s', (s,))
> 
> You are passing two arguments to execute() -- the first being a string 
> representing SQL and the second being a tuple of values to be 
> substituted in. The execute() method is smart enough to quote where 
> necessary.
> 
> This will not work:
> 
> c.execute('select foo from bar where baz = %s' % (s,))
> 
> You are passing a single argument to execute() -- a string that does 
> Python string formatting. The execute() method does not have a chance 
> to be smart enough to quote where necessary.
> 
> In your "quick test on your system" you refer to below, you use the 
> first method. In your "I just tried again" you use the second method, 
> which is why it fails.
> 
> -jag
> 
> On May 23, 2006, at 2:22 AM, Wouter van Marle wrote:
> 
> > On Tue, 2006-05-23 at 01:49 -0400, Joshua Ginsberg wrote:
> >> Wouter --
> >>
> >> You used % to do string substitution on the first argument to 
> >> execute()
> >> as opposed to passing a tuple as a second argument to execute().
> >
> > I don't get your meaning.
> > Can you please give me the lines of code as example? Thanks!
> >
> > Wouter.
> >
> >>
> >> -jag
> >>
> >> On May 22, 2006, at 11:50 PM, Wouter van Marle wrote:
> >>
> >>> On Tue, 2006-05-23 at 11:18 +0800, Wouter van Marle wrote:
> >>>> On Wed, 2006-05-17 at 18:09 -0400, Jim Gallacher wrote:
> >>>>>>> cur.execute("SELECT * FROM base WHERE field = %s", s)
> >>>>>>
> >>>>>> I have tried this (once) with MySQLdb, and it doesn't seem to work
> >>>>> like
> >>>>>> that. (v1.2.1g2) Didn't pursue the issue further.
> >>>>>
> >>>>> You must be doing something wrong. A quick test on my system:
> >>>>>
> >>>>>>>> s = """This is 'some' stuff with "quotes" and stuff"""
> >>>>>>>> cursor.execute('insert into testtable (data) values (%s)', s)
> >>>>> 1L
> >>>>
> >>>> Just tried it for myself - it works now.
> >>>
> >>> RRrrrriiiiigggghhhttt.... that said.... I just tried again... and now
> >>> have a fail. Now I also remember why I didn't use that method yet :)
> >>>
> >>> - Debian Sarge, MySQLdb 1.2.1g2: works fine.
> >>> - Mandriva Linux LE2005 (v10.2), MySQLdb 1.2.1g3: gives SQL error on
> >>> this one.
> >>>
> >>>>>> cursor.execute("INSERT INTO testtable (field1) VALUES ('This is a
> >>> string!');")
> >>> 1L
> >>>>>> cursor.execute("INSERT INTO testtable (field1) VALUES (%s);"% s)
> >>>
> >>> Traceback (most recent call last):
> >>>   File "<pyshell#15>", line 1, in -toplevel-
> >>>     cursor.execute("INSERT INTO testtable (field1) VALUES (%s);"% s)
> >>>   File "/usr/lib/python2.4/site-packages/MySQLdb/cursors.py", line 
> >>> 137,
> >>> in execute
> >>>     self.errorhandler(self, exc, value)
> >>>   File "/usr/lib/python2.4/site-packages/MySQLdb/connections.py", 
> >>> line
> >>> 33, in defaulterrorhandler
> >>>     raise errorclass, errorvalue
> >>> ProgrammingError: (1064, 'You have an error in your SQL syntax; check
> >>> the manual that corresponds to your MySQL server version for the 
> >>> right
> >>> syntax to use near \'\'some\' stuff with "quotes" and stuff)\' at 
> >>> line
> >>> 1')
> >>>
> >>> - Mandriva Linux 2006.0, MySQLdb 1.2.0final: works fine.
> >>>
> >>> So there is a serious bug in MySQLdb as well; seems to be the 1.2.1g3
> >>> version.
> >>>
> >>> Wouter.
> >>>
> >>>> Maybe I had an older version of MySQLdb when testing? I don't know
> >>>> anymore. I'll follow your advice and fix my code!
> >>>>
> >>>> And after that the info in the databases... that's going to be a
> >>>> harder
> >>>> job.
> >>>>
> >>>> Wouter.
> >>>>
> >>>>
> >>>> _______________________________________________
> >>>> Mod_python mailing list
> >>>> Mod_python@modpython.org
> >>>> http://mailman.modpython.org/mailman/listinfo/mod_python
> >>>>
> >>>>
> >>>
> >>> _______________________________________________
> >>> Mod_python mailing list
> >>> Mod_python@modpython.org
> >>> http://mailman.modpython.org/mailman/listinfo/mod_python
> >>
> >>
> >
> 
> 

From deron.meranda at gmail.com  Tue May 23 12:05:32 2006
From: deron.meranda at gmail.com (Deron Meranda)
Date: Tue May 23 12:05:36 2006
Subject: [mod_python] Problem with html quoted/unquoted
In-Reply-To: <1148395849.5731.4.camel@cm222-167-159-88.hkcable.com.hk>
References: <1147837098.17770.175.camel@pistachio.squirrel>
	<446B4555.9040308@jgassociates.ca>
	<1147881203.8449.140.camel@cm222-167-159-88.hkcable.com.hk>
	<446B9F03.20704@jgassociates.ca>
	<1148354292.18791.47.camel@pistachio.squirrel>
	<1148356216.18791.55.camel@pistachio.squirrel>
	<af55c2e46fd3785a8b67656248728815@flowtheory.net>
	<1148365378.18791.67.camel@pistachio.squirrel>
	<f5b1fb416df312b3488460fc06d1cb64@flowtheory.net>
	<1148395849.5731.4.camel@cm222-167-159-88.hkcable.com.hk>
Message-ID: <5c06fa770605230905m494488f2u772bb258c0443e2c@mail.gmail.com>

Also, a MySQLdb specific alternative:

  c.execute('select foo from bar where baz = %s' % db.escape(s))

The escape() method of the connection object will do the proper
quote-escaping, so you can use the %-style subtitution instead
of tuple-arguments.

But that is a MySQLdb feature, and not standard DBI.
-- 
Deron Meranda

From jaba at findyourcore.com  Tue May 23 12:21:34 2006
From: jaba at findyourcore.com (jaba@findyourcore.com)
Date: Tue May 23 12:21:42 2006
Subject: [mod_python] apache.OK and Cookies
In-Reply-To: <61f5b172ff6dc2644dd387564f83277d@flowtheory.net>
References: <50765.70.19.178.52.1148244730.squirrel@findyourcore.com>
	<61f5b172ff6dc2644dd387564f83277d@flowtheory.net>
Message-ID: <50582.70.19.133.56.1148401294.squirrel@findyourcore.com>

>
> On May 21, 2006, at 4:52 PM, jaba@findyourcore.com wrote:
>
>> I have two questions:
>> 1. is 'return apache.OK' really needed? ive gone without it many times,
>> and nothing goes wrong.
>
> Is it so hard to include it?
>
>> 2. How do you handle cookies (get,set,etc.)?
>
> RTFM: http://modpython.org/live/current/doc-html/pyapi-cookie.html
>
> -jag
>
>
yes, i saw that before, but i cant find were the heck it is!
(mod_python needs a new manual)
its not in mod_python(from mod_pythno import Cookie)
or in util,or in apache.
Where is it!?!?!
From jaba at findyourcore.com  Tue May 23 12:27:43 2006
From: jaba at findyourcore.com (jaba@findyourcore.com)
Date: Tue May 23 12:27:50 2006
Subject: [mod_python] apache.OK and Cookies
In-Reply-To: <1148251770.19073@dscpl.user.openhosting.com>
References: <1148251770.19073@dscpl.user.openhosting.com>
Message-ID: <50743.70.19.133.56.1148401663.squirrel@findyourcore.com>

> Graham Dumpleton wrote ..
>> jaba@findyourcore.com wrote ..
>> > I have two questions:
>> > 1. is 'return apache.OK' really needed? ive gone without it many
>> times,
>> > and nothing goes wrong.
>>
>> What version of mod_python are you using?
>>
>> Can you clarify whether you are using your own handler, where it would
>> should be used, or whether you are using mod_python.publisher where it
>> would not, but if it was may simply result in a extraneous "0" at end of
>> output that may get overlooked.
>>
>> In summary, if using your own handler, you should always return it. If
>> you don't, you should at least see a warning message in the Apache log
>> files and the results may be unpredictable as to how Apache treats the
>> result.
>
> Actually, as well as the error in the log file, mod_python should end up
> sending an internal server error (500) response back to Apache. If you
> aren't seeing this, then I would suspect you aren't writing your own
> handler and are using some layer on top where the result may not even be
> a status code, or where status codes are treated differently. For
> example, in mod_python.publisher, the result is converted to a string
> and append to the content. In Vampire, if nothing is returning it is
> equivalent to having returned apache.OK.
>
> Thus, thus make sure you indicate what handler you are using as well as
> the version of mod_python.
>
> Graham
>

i am using ny own handler, so i guess i'll just put apache.OK at the end,
anyway.
From jarrod at vertigrated.com  Tue May 23 13:31:38 2006
From: jarrod at vertigrated.com (jarrod roberson)
Date: Tue May 23 13:31:42 2006
Subject: [mod_python] Handing Expect: 100-continue from inside mod_python
Message-ID: <2389d4730605231031h486ea63fv20fbdd633dd075ca@mail.gmail.com>

I have been googling and have not been able to find any information about
how to have my mod_python handler respond with a 100 Continue or 417
Expectation Failed. We are checking quota on PUT's and want to be able to
support Expect: 100-continue for PUTs so the client ( which we are in charge
of and Content-Lenght is required by the server ). Right now we just drop
the connection if the the PUT will fail, it would be much nicer to respond
in a more friendly manner.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060523/4d868b64/attachment.html
From listspam at flowtheory.net  Tue May 23 13:53:55 2006
From: listspam at flowtheory.net (Joshua Ginsberg)
Date: Tue May 23 13:54:09 2006
Subject: [SPAM] Re: [mod_python] apache.OK and Cookies
In-Reply-To: <50582.70.19.133.56.1148401294.squirrel@findyourcore.com>
References: <50765.70.19.178.52.1148244730.squirrel@findyourcore.com>
	<61f5b172ff6dc2644dd387564f83277d@flowtheory.net>
	<50582.70.19.133.56.1148401294.squirrel@findyourcore.com>
Message-ID: <1148406835.6045.14.camel@localhost.localdomain>

The answer to this is probably strongly dependent upon your answer to
Graham's question about mod_python version. The Cookie library was
implemented in mod_python 3 -- versions before that did not have it.

-jag

On Tue, 2006-05-23 at 12:21 -0400, jaba@findyourcore.com wrote:
> >
> > On May 21, 2006, at 4:52 PM, jaba@findyourcore.com wrote:
> >
> >> I have two questions:
> >> 1. is 'return apache.OK' really needed? ive gone without it many times,
> >> and nothing goes wrong.
> >
> > Is it so hard to include it?
> >
> >> 2. How do you handle cookies (get,set,etc.)?
> >
> > RTFM: http://modpython.org/live/current/doc-html/pyapi-cookie.html
> >
> > -jag
> >
> >
> yes, i saw that before, but i cant find were the heck it is!
> (mod_python needs a new manual)
> its not in mod_python(from mod_pythno import Cookie)
> or in util,or in apache.
> Where is it!?!?!

From listspam at flowtheory.net  Tue May 23 13:55:35 2006
From: listspam at flowtheory.net (Joshua Ginsberg)
Date: Tue May 23 13:55:46 2006
Subject: [SPAM] Re: [mod_python] Handing Expect: 100-continue from inside
	mod_python
In-Reply-To: <2389d4730605231031h486ea63fv20fbdd633dd075ca@mail.gmail.com>
References: <2389d4730605231031h486ea63fv20fbdd633dd075ca@mail.gmail.com>
Message-ID: <1148406935.6045.16.camel@localhost.localdomain>

>From the mod_python manual:

http://modpython.org/live/current/doc-html/pyapi-handler.html

-jag

On Tue, 2006-05-23 at 13:31 -0400, jarrod roberson wrote:
> I have been googling and have not been able to find any information
> about how to have my mod_python handler respond with a 100 Continue or
> 417 Expectation Failed. We are checking quota on PUT's and want to be
> able to support Expect: 100-continue for PUTs so the client ( which we
> are in charge of and Content-Lenght is required by the server ). Right
> now we just drop the connection if the the PUT will fail, it would be
> much nicer to respond in a more friendly manner. 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From David.Bear at asu.edu  Tue May 23 15:15:35 2006
From: David.Bear at asu.edu (David Bear)
Date: Tue May 23 15:15:43 2006
Subject: [mod_python] psp include directive
Message-ID: <20060523191535.GC24281@asu.edu>

I am using publisher to dispatch different psp pages.

When I use the include directive in the psp page I get an quoting
error -- 

here is a snippet of the psp code that throws the error:
=============
        <td width="30%">
    <div id="contactBlock"><%@ include file='contact_body.html' > </div>
    <div id="useabilityNotes"><%@ include file='useabilityNotes.html' > </div>
        </td>
===================

the error traceback is 
===================
Mod_python error: "PythonHandler mod_python.publisher"

Traceback (most recent call last):

  File "/usr/lib64/python2.4/site-packages/mod_python/apache.py", line
299, in HandlerDispatch
    result = object(req)

  File "/usr/lib64/python2.4/site-packages/mod_python/publisher.py",
line 136, in handler
    result = util.apply_fs_data(object, req.form, req=req)

  File "/usr/lib64/python2.4/site-packages/mod_python/util.py", line
361, in apply_fs_data
    return object(**args)

  File "/work/servers/www/htdocs/apep/index.py", line 80, in index
    return _any_page(req, MAINTEMPLATE )

  File "/work/servers/www/htdocs/apep/index.py", line 107, in
_any_page
    return psp.PSP(req, main_template, vars=vars)

  File "/usr/lib64/python2.4/site-packages/mod_python/psp.py", line
111, in __init__
    self.load_from_file()

  File "/usr/lib64/python2.4/site-packages/mod_python/psp.py", line
177, in load_from_file
    code = compile(source, filename, "exec")

  File "/work/servers/www/htdocs/apep/templates/main_template.html",
line 27

    req.write("""
   
   ^ SyntaxError: EOF while scanning triple-quoted string 

=======================
I'm about to kill this --- are single quotes in directives not
allowed?




-- 
David Bear
phone: 	480-965-8257
fax: 	480-965-9189
College of Public Programs/ASU
Wilson Hall 232
Tempe, AZ 85287-0803
 "Beware the IP portfolio, everyone will be suspect of trespassing"
From jpg at jgassociates.ca  Tue May 23 16:00:41 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Tue May 23 15:59:54 2006
Subject: [mod_python] psp include directive
In-Reply-To: <20060523191535.GC24281@asu.edu>
References: <20060523191535.GC24281@asu.edu>
Message-ID: <447369E9.1040403@jgassociates.ca>

David Bear wrote:
> I am using publisher to dispatch different psp pages.
> 
> When I use the include directive in the psp page I get an quoting
> error -- 
> 
> here is a snippet of the psp code that throws the error:
> =============
>         <td width="30%">
>     <div id="contactBlock"><%@ include file='contact_body.html' > </div>
>     <div id="useabilityNotes"><%@ include file='useabilityNotes.html' > </div>
>         </td>
> ===================
> 
> the error traceback is 
> ===================
> Mod_python error: "PythonHandler mod_python.publisher"
> 
> Traceback (most recent call last):
> 
>   File "/usr/lib64/python2.4/site-packages/mod_python/apache.py", line
> 299, in HandlerDispatch
>     result = object(req)
> 
>   File "/usr/lib64/python2.4/site-packages/mod_python/publisher.py",
> line 136, in handler
>     result = util.apply_fs_data(object, req.form, req=req)
> 
>   File "/usr/lib64/python2.4/site-packages/mod_python/util.py", line
> 361, in apply_fs_data
>     return object(**args)
> 
>   File "/work/servers/www/htdocs/apep/index.py", line 80, in index
>     return _any_page(req, MAINTEMPLATE )
> 
>   File "/work/servers/www/htdocs/apep/index.py", line 107, in
> _any_page
>     return psp.PSP(req, main_template, vars=vars)
> 
>   File "/usr/lib64/python2.4/site-packages/mod_python/psp.py", line
> 111, in __init__
>     self.load_from_file()
> 
>   File "/usr/lib64/python2.4/site-packages/mod_python/psp.py", line
> 177, in load_from_file
>     code = compile(source, filename, "exec")
> 
>   File "/work/servers/www/htdocs/apep/templates/main_template.html",
> line 27
> 
>     req.write("""
>    
>    ^ SyntaxError: EOF while scanning triple-quoted string 
> 
> =======================
> I'm about to kill this --- are single quotes in directives not
> allowed?

It would appear not, according to a quick test I just ran on my system - 
but it didn't throw an exception either. Double quotes would seem to be 
the order of the day. Sorry, no time to dig into the psp parser code 
right now.

Jim

From jaba at findyourcore.com  Tue May 23 16:39:05 2006
From: jaba at findyourcore.com (jaba@findyourcore.com)
Date: Tue May 23 16:39:13 2006
Subject: [mod_python] apache.OK and Cookies
In-Reply-To: <1148406835.6045.14.camel@localhost.localdomain>
References: <50765.70.19.178.52.1148244730.squirrel@findyourcore.com> 
	<61f5b172ff6dc2644dd387564f83277d@flowtheory.net> 
	<50582.70.19.133.56.1148401294.squirrel@findyourcore.com>
	<1148406835.6045.14.camel@localhost.localdomain>
Message-ID: <50664.70.19.133.56.1148416745.squirrel@findyourcore.com>

how do i tell what mod_python version im using?
-jared


> The answer to this is probably strongly dependent upon your answer to
> Graham's question about mod_python version. The Cookie library was
> implemented in mod_python 3 -- versions before that did not have it.
>
> -jag
>
> On Tue, 2006-05-23 at 12:21 -0400, jaba@findyourcore.com wrote:
>> >
>> > On May 21, 2006, at 4:52 PM, jaba@findyourcore.com wrote:
>> >
>> >> I have two questions:
>> >> 1. is 'return apache.OK' really needed? ive gone without it many
>> times,
>> >> and nothing goes wrong.
>> >
>> > Is it so hard to include it?
>> >
>> >> 2. How do you handle cookies (get,set,etc.)?
>> >
>> > RTFM: http://modpython.org/live/current/doc-html/pyapi-cookie.html
>> >
>> > -jag
>> >
>> >
>> yes, i saw that before, but i cant find were the heck it is!
>> (mod_python needs a new manual)
>> its not in mod_python(from mod_pythno import Cookie)
>> or in util,or in apache.
>> Where is it!?!?!
>
>

From grahamd at dscpl.com.au  Tue May 23 16:58:41 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue May 23 16:59:14 2006
Subject: [mod_python] apache.OK and Cookies
In-Reply-To: <50664.70.19.133.56.1148416745.squirrel@findyourcore.com>
References: <50765.70.19.178.52.1148244730.squirrel@findyourcore.com>
	<61f5b172ff6dc2644dd387564f83277d@flowtheory.net>
	<50582.70.19.133.56.1148401294.squirrel@findyourcore.com>
	<1148406835.6045.14.camel@localhost.localdomain>
	<50664.70.19.133.56.1148416745.squirrel@findyourcore.com>
Message-ID: <CE18FFE7-9B60-4E38-B38D-C2AAA996C30A@dscpl.com.au>

The mod_python startup message in the Apache error log will tell you:

   [Tue Feb 01 16:08:21 2005] [notice] Apache/2.0.51 (Unix)
   mod_python/3.1.3 Python/2.3 configured -- resuming normal operations

For a crude method, from a command line python run:

   ~ [510]$ python
   Python 2.3 (#1, Sep 13 2003, 00:49:11)
   [GCC 3.3 20030304 (Apple Computer, Inc. build 1495)] on darwin
   Type "help", "copyright", "credits" or "license" for more  
information.
   >>> import mod_python.Cookie

If you see:

   ImportError: No module named Cookie

Then you are using an old version of mod_python which doesn't have
cookie support.

Graham


On 24/05/2006, at 6:39 AM, jaba@findyourcore.com wrote:

> how do i tell what mod_python version im using?
> -jared
>
>
>> The answer to this is probably strongly dependent upon your answer to
>> Graham's question about mod_python version. The Cookie library was
>> implemented in mod_python 3 -- versions before that did not have it.
>>
>> -jag
>>
>> On Tue, 2006-05-23 at 12:21 -0400, jaba@findyourcore.com wrote:
>>>>
>>>> On May 21, 2006, at 4:52 PM, jaba@findyourcore.com wrote:
>>>>
>>>>> I have two questions:
>>>>> 1. is 'return apache.OK' really needed? ive gone without it many
>>> times,
>>>>> and nothing goes wrong.
>>>>
>>>> Is it so hard to include it?
>>>>
>>>>> 2. How do you handle cookies (get,set,etc.)?
>>>>
>>>> RTFM: http://modpython.org/live/current/doc-html/pyapi-cookie.html
>>>>
>>>> -jag
>>>>
>>>>
>>> yes, i saw that before, but i cant find were the heck it is!
>>> (mod_python needs a new manual)
>>> its not in mod_python(from mod_pythno import Cookie)
>>> or in util,or in apache.
>>> Where is it!?!?!
>>
>>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From jaba at findyourcore.com  Tue May 23 17:47:36 2006
From: jaba at findyourcore.com (jaba@findyourcore.com)
Date: Tue May 23 17:47:44 2006
Subject: [mod_python] apache.OK and Cookies
In-Reply-To: <CE18FFE7-9B60-4E38-B38D-C2AAA996C30A@dscpl.com.au>
References: <50765.70.19.178.52.1148244730.squirrel@findyourcore.com> 
	<61f5b172ff6dc2644dd387564f83277d@flowtheory.net> 
	<50582.70.19.133.56.1148401294.squirrel@findyourcore.com>
	<1148406835.6045.14.camel@localhost.localdomain>
	<50664.70.19.133.56.1148416745.squirrel@findyourcore.com>
	<CE18FFE7-9B60-4E38-B38D-C2AAA996C30A@dscpl.com.au>
Message-ID: <50446.70.19.133.56.1148420856.squirrel@findyourcore.com>

Crap.
ok, Thanks for all the help.

Ill try to get my server admin to upgrade mod_python.

-jared

> The mod_python startup message in the Apache error log will tell you:
>
>    [Tue Feb 01 16:08:21 2005] [notice] Apache/2.0.51 (Unix)
>    mod_python/3.1.3 Python/2.3 configured -- resuming normal operations
>
> For a crude method, from a command line python run:
>
>    ~ [510]$ python
>    Python 2.3 (#1, Sep 13 2003, 00:49:11)
>    [GCC 3.3 20030304 (Apple Computer, Inc. build 1495)] on darwin
>    Type "help", "copyright", "credits" or "license" for more
> information.
>    >>> import mod_python.Cookie
>
> If you see:
>
>    ImportError: No module named Cookie
>
> Then you are using an old version of mod_python which doesn't have
> cookie support.
>
> Graham
>
>
> On 24/05/2006, at 6:39 AM, jaba@findyourcore.com wrote:
>
>> how do i tell what mod_python version im using?
>> -jared
>>
>>
>>> The answer to this is probably strongly dependent upon your answer to
>>> Graham's question about mod_python version. The Cookie library was
>>> implemented in mod_python 3 -- versions before that did not have it.
>>>
>>> -jag
>>>
>>> On Tue, 2006-05-23 at 12:21 -0400, jaba@findyourcore.com wrote:
>>>>>
>>>>> On May 21, 2006, at 4:52 PM, jaba@findyourcore.com wrote:
>>>>>
>>>>>> I have two questions:
>>>>>> 1. is 'return apache.OK' really needed? ive gone without it many
>>>> times,
>>>>>> and nothing goes wrong.
>>>>>
>>>>> Is it so hard to include it?
>>>>>
>>>>>> 2. How do you handle cookies (get,set,etc.)?
>>>>>
>>>>> RTFM: http://modpython.org/live/current/doc-html/pyapi-cookie.html
>>>>>
>>>>> -jag
>>>>>
>>>>>
>>>> yes, i saw that before, but i cant find were the heck it is!
>>>> (mod_python needs a new manual)
>>>> its not in mod_python(from mod_pythno import Cookie)
>>>> or in util,or in apache.
>>>> Where is it!?!?!
>>>
>>>
>>
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>

From grahamd at dscpl.com.au  Tue May 23 18:35:50 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue May 23 18:35:55 2006
Subject: [mod_python] apache.OK and Cookies
Message-ID: <1148423750.6055@dscpl.user.openhosting.com>

jaba@findyourcore.com wrote ..
> Crap.
> ok, Thanks for all the help.
> 
> Ill try to get my server admin to upgrade mod_python.


Realise though that if they are still using Apache 1.3 they will not be
able to upgrade mod_python as later version required Apache 2.0.
You can't even use Apache 2.2 at this point with last official release
of mod_python.

Graham


> -jared
> 
> > The mod_python startup message in the Apache error log will tell you:
> >
> >    [Tue Feb 01 16:08:21 2005] [notice] Apache/2.0.51 (Unix)
> >    mod_python/3.1.3 Python/2.3 configured -- resuming normal operations
> >
> > For a crude method, from a command line python run:
> >
> >    ~ [510]$ python
> >    Python 2.3 (#1, Sep 13 2003, 00:49:11)
> >    [GCC 3.3 20030304 (Apple Computer, Inc. build 1495)] on darwin
> >    Type "help", "copyright", "credits" or "license" for more
> > information.
> >    >>> import mod_python.Cookie
> >
> > If you see:
> >
> >    ImportError: No module named Cookie
> >
> > Then you are using an old version of mod_python which doesn't have
> > cookie support.
> >
> > Graham
> >
> >
> > On 24/05/2006, at 6:39 AM, jaba@findyourcore.com wrote:
> >
> >> how do i tell what mod_python version im using?
> >> -jared
> >>
> >>
> >>> The answer to this is probably strongly dependent upon your answer
> to
> >>> Graham's question about mod_python version. The Cookie library was
> >>> implemented in mod_python 3 -- versions before that did not have it.
> >>>
> >>> -jag
> >>>
> >>> On Tue, 2006-05-23 at 12:21 -0400, jaba@findyourcore.com wrote:
> >>>>>
> >>>>> On May 21, 2006, at 4:52 PM, jaba@findyourcore.com wrote:
> >>>>>
> >>>>>> I have two questions:
> >>>>>> 1. is 'return apache.OK' really needed? ive gone without it many
> >>>> times,
> >>>>>> and nothing goes wrong.
> >>>>>
> >>>>> Is it so hard to include it?
> >>>>>
> >>>>>> 2. How do you handle cookies (get,set,etc.)?
> >>>>>
> >>>>> RTFM: http://modpython.org/live/current/doc-html/pyapi-cookie.html
> >>>>>
> >>>>> -jag
> >>>>>
> >>>>>
> >>>> yes, i saw that before, but i cant find were the heck it is!
> >>>> (mod_python needs a new manual)
> >>>> its not in mod_python(from mod_pythno import Cookie)
> >>>> or in util,or in apache.
> >>>> Where is it!?!?!
> >>>
> >>>
> >>
> >> _______________________________________________
> >> Mod_python mailing list
> >> Mod_python@modpython.org
> >> http://mailman.modpython.org/mailman/listinfo/mod_python
> >
> >
From David.Bear at asu.edu  Tue May 23 21:42:16 2006
From: David.Bear at asu.edu (David Bear)
Date: Tue May 23 21:42:26 2006
Subject: [mod_python] evaluation psp for inclusion in psp
Message-ID: <20060524014216.GK24281@asu.edu>

I am using publisher.

I have one psp template that I would like to evaluate for inclusion
into another psp template.

I thought I could do something like this:

==================================
def _get_psp(req, name="blank.ptml", vars={}, docroot=THISROOT, template=TEMPLATES):
    '''
    expects a docroot, template path and name of footer,
    returns a string containing the contents of the file named
    name'''
    fn = os.path.join(docroot, template, name)
    try:
        os.path.exists(fn)
    except IOError:
        inc = "File %s NOT Found" % fn
    ipsp = psp.PSP(req, filename=fn)
    ipsp.run(vars)
    return ipsp
==================================

then use it like this:

==================================
def index(req):
    '''
    default page
    '''
    fd = {}
    pspinclude = _get_psp(req, "registrationForm.ptml", {"submit":
"http:"})
    fd["formname"]="regform1"
    fd["form"]=pspinclude
    return _any_page(req, fd, MAINTEMPLATE )
==================================

But the psp.run method writes directly to the req object and the prior
to anything being returned from _any_page(). I want a psp method that
returns a string of html (base on a psp template). Is there a psp
method that does that?

btw, perhaps my thinking is skewed on using psp. I'm trying structure
things similar to the way zope page templates TAL and METAL work...
but that may be too much of a stretch for psp and publisher.

-- 
David Bear
phone: 	480-965-8257
fax: 	480-965-9189
College of Public Programs/ASU
Wilson Hall 232
Tempe, AZ 85287-0803
 "Beware the IP portfolio, everyone will be suspect of trespassing"
From David.Bear at asu.edu  Tue May 23 23:02:20 2006
From: David.Bear at asu.edu (David Bear)
Date: Tue May 23 23:02:31 2006
Subject: [mod_python] clarity on request.form 
Message-ID: <20060524030220.GM24281@asu.edu>

>From the manual, I don't understand the following statement:
'''
Since a FieldStorage can only be instantiated once per request, one
must not attempt to instantiate FieldStorage when using the Publisher
handler and should use Request.form instead.
'''

I've been using publisher as a dispatcher to select the next psp to
serve. Does the above statement imply that I cannot do this?  Where is
Request.form define? is Request not the same as req?


-- 
David Bear
phone: 	480-965-8257
fax: 	480-965-9189
College of Public Programs/ASU
Wilson Hall 232
Tempe, AZ 85287-0803
 "Beware the IP portfolio, everyone will be suspect of trespassing"
From grahamd at dscpl.com.au  Tue May 23 23:17:45 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue May 23 23:17:49 2006
Subject: [mod_python] clarity on request.form 
Message-ID: <1148440664.30006@dscpl.user.openhosting.com>

David Bear wrote ..
> >From the manual, I don't understand the following statement:
> '''
> Since a FieldStorage can only be instantiated once per request, one
> must not attempt to instantiate FieldStorage when using the Publisher
> handler and should use Request.form instead.
> '''
> 
> I've been using publisher as a dispatcher to select the next psp to
> serve. Does the above statement imply that I cannot do this?  Where is
> Request.form define? is Request not the same as req?

Add a argument called "req" to your published function and then
access "req.form".

  def index(req):
    form = req.form

Unfortunately PSP doesn't play too nice with publisher as far as
form creation and will create its own if you access "form" from
inside PSP page. If request is a GET request, although redundantly
created, the form will still work. If a POST request though, there
will be no fields as publisher already consumed it.

The work around for this is to use something like:

    page = psp.PSP(.....)
    page.run({"form": form})
    ...

There was discussion about having PSP understand convention of req.form
being populated by publisher and use it if it exists, but no consensus
was reached on whether it was a good idea or not.

Graham
From grahamd at dscpl.com.au  Tue May 23 23:18:45 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue May 23 23:18:53 2006
Subject: [mod_python] evaluation psp for inclusion in psp
Message-ID: <1148440725.30638@dscpl.user.openhosting.com>

See the complete thread of which this link is a part:

  http://www.modpython.org/pipermail/mod_python/2005-June/018232.html

Graham

David Bear wrote ..
> I am using publisher.
> 
> I have one psp template that I would like to evaluate for inclusion
> into another psp template.
> 
> I thought I could do something like this:
> 
> ==================================
> def _get_psp(req, name="blank.ptml", vars={}, docroot=THISROOT, template=TEMPLATES):
>     '''
>     expects a docroot, template path and name of footer,
>     returns a string containing the contents of the file named
>     name'''
>     fn = os.path.join(docroot, template, name)
>     try:
>         os.path.exists(fn)
>     except IOError:
>         inc = "File %s NOT Found" % fn
>     ipsp = psp.PSP(req, filename=fn)
>     ipsp.run(vars)
>     return ipsp
> ==================================
> 
> then use it like this:
> 
> ==================================
> def index(req):
>     '''
>     default page
>     '''
>     fd = {}
>     pspinclude = _get_psp(req, "registrationForm.ptml", {"submit":
> "http:"})
>     fd["formname"]="regform1"
>     fd["form"]=pspinclude
>     return _any_page(req, fd, MAINTEMPLATE )
> ==================================
> 
> But the psp.run method writes directly to the req object and the prior
> to anything being returned from _any_page(). I want a psp method that
> returns a string of html (base on a psp template). Is there a psp
> method that does that?
> 
> btw, perhaps my thinking is skewed on using psp. I'm trying structure
> things similar to the way zope page templates TAL and METAL work...
> but that may be too much of a stretch for psp and publisher.
> 
> -- 
> David Bear
> phone: 	480-965-8257
> fax: 	480-965-9189
> College of Public Programs/ASU
> Wilson Hall 232
> Tempe, AZ 85287-0803
>  "Beware the IP portfolio, everyone will be suspect of trespassing"
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
From grahamd at dscpl.com.au  Tue May 23 23:24:20 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue May 23 23:24:46 2006
Subject: [mod_python] Off on holidays.
Message-ID: <1148441060.1181@dscpl.user.openhosting.com>

Sorry everyone, I'm off on holidays for a few weeks and will have very
little if any Internet access. Thus I will not be jumping in and
answering questions on the mod_python lists. But then, since I am sure
that the only reason I'm the one posting so much is that I simply get in
before anyone else does with an answer, there should be lots of you out
there who will now get a chance to help out and answer peoples
questions. :-)

Have fun while I am away and don't find too many bugs ....

Graham
From David.Bear at asu.edu  Tue May 23 23:31:04 2006
From: David.Bear at asu.edu (David Bear)
Date: Tue May 23 23:31:27 2006
Subject: [mod_python] clarity on request.form
In-Reply-To: <1148440664.30006@dscpl.user.openhosting.com>
References: <1148440664.30006@dscpl.user.openhosting.com>
Message-ID: <20060524033104.GN24281@asu.edu>

On Tue, May 23, 2006 at 11:17:45PM -0400, Graham Dumpleton wrote:
> David Bear wrote ..
> > >From the manual, I don't understand the following statement:
> > '''
> > Since a FieldStorage can only be instantiated once per request, one
> > must not attempt to instantiate FieldStorage when using the Publisher
> > handler and should use Request.form instead.
> > '''
> > 
> > I've been using publisher as a dispatcher to select the next psp to
> > serve. Does the above statement imply that I cannot do this?  Where is
> > Request.form define? is Request not the same as req?
> 
> Add a argument called "req" to your published function and then
> access "req.form".
> 
>   def index(req):
>     form = req.form
> 

okay. thats what I thought I could do. however, the paragraph from the
manual tripped me up.

> Unfortunately PSP doesn't play too nice with publisher as far as
> form creation and will create its own if you access "form" from
> inside PSP page. If request is a GET request, although redundantly
> created, the form will still work. If a POST request though, there
> will be no fields as publisher already consumed it.

So, in order to pass req.form to a psp, I would need to copy it to
some object? simple

   thisform = req.form
   vars = thisform
   return psp.PSP('somepsp.html', vars)

won't work? or will the assignment make a copy?

> 
> The work around for this is to use something like:
> 
>     page = psp.PSP(.....)
>     page.run({"form": form})
>     ...
> 
> There was discussion about having PSP understand convention of req.form
> being populated by publisher and use it if it exists, but no consensus
> was reached on whether it was a good idea or not.
> 
> Graham

-- 
David Bear
phone: 	480-965-8257
fax: 	480-965-9189
College of Public Programs/ASU
Wilson Hall 232
Tempe, AZ 85287-0803
 "Beware the IP portfolio, everyone will be suspect of trespassing"
From David.Bear at asu.edu  Tue May 23 23:55:32 2006
From: David.Bear at asu.edu (David Bear)
Date: Tue May 23 23:55:39 2006
Subject: [mod_python] clarity on request.form
In-Reply-To: <20060524033104.GN24281@asu.edu>
References: <1148440664.30006@dscpl.user.openhosting.com>
	<20060524033104.GN24281@asu.edu>
Message-ID: <20060524035532.GO24281@asu.edu>

On Tue, May 23, 2006 at 08:31:04PM -0700, David Bear wrote:
> On Tue, May 23, 2006 at 11:17:45PM -0400, Graham Dumpleton wrote:
> > David Bear wrote ..
> > > >From the manual, I don't understand the following statement:
> > > '''
> > > Since a FieldStorage can only be instantiated once per request, one
> > > must not attempt to instantiate FieldStorage when using the Publisher
> > > handler and should use Request.form instead.
> > > '''
> > > 
> > > I've been using publisher as a dispatcher to select the next psp to
> > > serve. Does the above statement imply that I cannot do this?  Where is
> > > Request.form define? is Request not the same as req?
> > 
> > Add a argument called "req" to your published function and then
> > access "req.form".
> > 
> >   def index(req):
> >     form = req.form
> > 
> 
> okay. thats what I thought I could do. however, the paragraph from the
> manual tripped me up.
> 
> > Unfortunately PSP doesn't play too nice with publisher as far as
> > form creation and will create its own if you access "form" from
> > inside PSP page. If request is a GET request, although redundantly
> > created, the form will still work. If a POST request though, there
> > will be no fields as publisher already consumed it.
> 
> So, in order to pass req.form to a psp, I would need to copy it to
> some object? simple
> 
>    thisform = req.form
>    vars = thisform
>    return psp.PSP('somepsp.html', vars)
> 
> won't work? or will the assignment make a copy?
> 

I just tried 

    myform = copy.deepcopy(req.form)

and it failed.. 

where is req.form documented? I'm looking for its methods.

> > 
> > The work around for this is to use something like:
> > 
> >     page = psp.PSP(.....)
> >     page.run({"form": form})
> >     ...
> > 
> > There was discussion about having PSP understand convention of req.form
> > being populated by publisher and use it if it exists, but no consensus
> > was reached on whether it was a good idea or not.
> > 
> > Graham
> 
> -- 
> David Bear
> phone: 	480-965-8257
> fax: 	480-965-9189
> College of Public Programs/ASU
> Wilson Hall 232
> Tempe, AZ 85287-0803
>  "Beware the IP portfolio, everyone will be suspect of trespassing"

-- 
David Bear
phone: 	480-965-8257
fax: 	480-965-9189
College of Public Programs/ASU
Wilson Hall 232
Tempe, AZ 85287-0803
 "Beware the IP portfolio, everyone will be suspect of trespassing"
From jeffh at dundeemt.com  Wed May 24 00:14:35 2006
From: jeffh at dundeemt.com (Jeff Hinrichs - DM&T)
Date: Wed May 24 00:14:39 2006
Subject: [mod_python] clarity on request.form
In-Reply-To: <20060524035532.GO24281@asu.edu>
References: <1148440664.30006@dscpl.user.openhosting.com>
	<20060524033104.GN24281@asu.edu> <20060524035532.GO24281@asu.edu>
Message-ID: <5aaed53f0605232114i6a390a0al2adec191ccad74cb@mail.gmail.com>

David,

I couldn't find a good answer via Google, so I took a peek at
publish.py and found that:
  req.form = util.FieldStorage(req, keep_blank_values=1)

Checking out the details of FieldStorage in util.py should give you
the info you need.  It's pure python so fairly straight forward.

Both are found in you site-packages/mod_python/ directory if
mod_python installed with default options, I believe.

-Jeff

On 5/23/06, David Bear <David.Bear@asu.edu> wrote:
> On Tue, May 23, 2006 at 08:31:04PM -0700, David Bear wrote:
> > On Tue, May 23, 2006 at 11:17:45PM -0400, Graham Dumpleton wrote:
> > > David Bear wrote ..
> > > > >From the manual, I don't understand the following statement:
> > > > '''
> > > > Since a FieldStorage can only be instantiated once per request, one
> > > > must not attempt to instantiate FieldStorage when using the Publisher
> > > > handler and should use Request.form instead.
> > > > '''
> > > >
> > > > I've been using publisher as a dispatcher to select the next psp to
> > > > serve. Does the above statement imply that I cannot do this?  Where is
> > > > Request.form define? is Request not the same as req?
> > >
> > > Add a argument called "req" to your published function and then
> > > access "req.form".
> > >
> > >   def index(req):
> > >     form = req.form
> > >
> >
> > okay. thats what I thought I could do. however, the paragraph from the
> > manual tripped me up.
> >
> > > Unfortunately PSP doesn't play too nice with publisher as far as
> > > form creation and will create its own if you access "form" from
> > > inside PSP page. If request is a GET request, although redundantly
> > > created, the form will still work. If a POST request though, there
> > > will be no fields as publisher already consumed it.
> >
> > So, in order to pass req.form to a psp, I would need to copy it to
> > some object? simple
> >
> >    thisform = req.form
> >    vars = thisform
> >    return psp.PSP('somepsp.html', vars)
> >
> > won't work? or will the assignment make a copy?
> >
>
> I just tried
>
>     myform = copy.deepcopy(req.form)
>
> and it failed..
>
> where is req.form documented? I'm looking for its methods.
>
> > >
> > > The work around for this is to use something like:
> > >
> > >     page = psp.PSP(.....)
> > >     page.run({"form": form})
> > >     ...
> > >
> > > There was discussion about having PSP understand convention of req.form
> > > being populated by publisher and use it if it exists, but no consensus
> > > was reached on whether it was a good idea or not.
> > >
> > > Graham
> >
> > --
> > David Bear
> > phone:        480-965-8257
> > fax:  480-965-9189
> > College of Public Programs/ASU
> > Wilson Hall 232
> > Tempe, AZ 85287-0803
> >  "Beware the IP portfolio, everyone will be suspect of trespassing"
>
> --
> David Bear
> phone:  480-965-8257
> fax:    480-965-9189
> College of Public Programs/ASU
> Wilson Hall 232
> Tempe, AZ 85287-0803
>  "Beware the IP portfolio, everyone will be suspect of trespassing"
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>


-- 
Jeff Hinrichs
Dundee Media & Technology, Inc
jeffh@dundeemt.com
402.320.0821

From grahamd at dscpl.com.au  Wed May 24 01:03:51 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed May 24 01:04:39 2006
Subject: [mod_python] clarity on request.form
In-Reply-To: <20060524035532.GO24281@asu.edu>
References: <1148440664.30006@dscpl.user.openhosting.com>
	<20060524033104.GN24281@asu.edu> <20060524035532.GO24281@asu.edu>
Message-ID: <658B20A1-FC48-445C-97DC-9A6652FA68FA@dscpl.com.au>

Time for a couple more questions. :-)

On 24/05/2006, at 1:55 PM, David Bear wrote:

>>> Unfortunately PSP doesn't play too nice with publisher as far as
>>> form creation and will create its own if you access "form" from
>>> inside PSP page. If request is a GET request, although redundantly
>>> created, the form will still work. If a POST request though, there
>>> will be no fields as publisher already consumed it.
>>
>> So, in order to pass req.form to a psp, I would need to copy it to
>> some object? simple
>>
>>    thisform = req.form
>>    vars = thisform
>>    return psp.PSP('somepsp.html', vars)
>>
>> won't work? or will the assignment make a copy?
>>
>
> I just tried
>
>     myform = copy.deepcopy(req.form)
>
> and it failed..
>
> where is req.form documented? I'm looking for its methods.
>
>>>
>>> The work around for this is to use something like:
>>>
>>>     page = psp.PSP(.....)
>>>     page.run({"form": form})
>>>     ...
>>>
>>> There was discussion about having PSP understand convention of  
>>> req.form
>>> being populated by publisher and use it if it exists, but no  
>>> consensus
>>> was reached on whether it was a good idea or not.

You don't need to make a deep copy. The only thing wrong with what  
you had is
that vars has to be a dictionary.

    thisform = req.form
    vars = { "form": thisform }
    return psp.PSP('somepsp.html', vars=vars)

Then just access methods of form object (ie., FieldStorage) through  
"form" in PSP
just like you would normally if using FieldStorage object. Eg.

   form.get("field")

etc.

Graham

From grahamd at dscpl.com.au  Wed May 24 01:08:12 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed May 24 01:08:39 2006
Subject: [mod_python] clarity on request.form
In-Reply-To: <658B20A1-FC48-445C-97DC-9A6652FA68FA@dscpl.com.au>
References: <1148440664.30006@dscpl.user.openhosting.com>
	<20060524033104.GN24281@asu.edu> <20060524035532.GO24281@asu.edu>
	<658B20A1-FC48-445C-97DC-9A6652FA68FA@dscpl.com.au>
Message-ID: <7379C1FC-2F7C-4168-9B3E-A85425DC627E@dscpl.com.au>


On 24/05/2006, at 3:03 PM, Graham Dumpleton wrote:

> Time for a couple more questions. :-)
>
> On 24/05/2006, at 1:55 PM, David Bear wrote:
>
>>>> Unfortunately PSP doesn't play too nice with publisher as far as
>>>> form creation and will create its own if you access "form" from
>>>> inside PSP page. If request is a GET request, although redundantly
>>>> created, the form will still work. If a POST request though, there
>>>> will be no fields as publisher already consumed it.
>>>
>>> So, in order to pass req.form to a psp, I would need to copy it to
>>> some object? simple
>>>
>>>    thisform = req.form
>>>    vars = thisform
>>>    return psp.PSP('somepsp.html', vars)
>>>
>>> won't work? or will the assignment make a copy?
>>>
>>
>> I just tried
>>
>>     myform = copy.deepcopy(req.form)
>>
>> and it failed..
>>
>> where is req.form documented? I'm looking for its methods.
>>
>>>>
>>>> The work around for this is to use something like:
>>>>
>>>>     page = psp.PSP(.....)
>>>>     page.run({"form": form})
>>>>     ...
>>>>
>>>> There was discussion about having PSP understand convention of  
>>>> req.form
>>>> being populated by publisher and use it if it exists, but no  
>>>> consensus
>>>> was reached on whether it was a good idea or not.
>
> You don't need to make a deep copy. The only thing wrong with what  
> you had is
> that vars has to be a dictionary.
>
>    thisform = req.form
>    vars = { "form": thisform }
>    return psp.PSP('somepsp.html', vars=vars)
>
> Then just access methods of form object (ie., FieldStorage) through  
> "form" in PSP
> just like you would normally if using FieldStorage object. Eg.
>
>   form.get("field")
>
> etc.

Here is an example which I think will work. This will iterate over  
all fields and show
you what they are.

<html>

<head>
<title>Form Values</title>
</head>

<body>

<h1>Form Values</h1>

<p>
<table>

<thead>
<tr>
<th>Name</th>
<th>Value</th>
</tr>
</thead>

<tbody>
<%
keys = form.keys()
keys.sort()
for key in keys:
     # indent
%>
     <tr>
     <td><%=key%></td>
     <td><%=form[key]%></td>
     </tr>
</tbody>
<%
# end for
%>

</table>
</p>

</body>
</html>

From grahamd at dscpl.com.au  Wed May 24 01:17:31 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed May 24 01:18:03 2006
Subject: R: R: R: [mod_python] Servlet Loading problem 1 year later
In-Reply-To: <BC53C974C3B9E542BC0A9BD4C5B1168AE1C959@NEWMAIL.manord.com>
References: <BC53C974C3B9E542BC0A9BD4C5B1168AE1C959@NEWMAIL.manord.com>
Message-ID: <FB2444CC-2C74-4BB2-BD14-F5A292544495@dscpl.com.au>


On 23/05/2006, at 11:30 PM, Manera, Villiam wrote:

> Ok! I have PythonHandler mod_python.servlet, and only 5 modules with:
>> From mod_python.servlet import * so no hard work for fix.
>
> Instead a lot with:
> from mod_python.servlet import HTMLPage (HTMLPage inherit from  
> Servlet)
>
> Sorry for my ignorance, but I have to fix with apache.import_module 
> () also those that import HTMPLPage?

Yes. The original link I pointed you at showed exactly that as an  
example.

   http://www.modpython.org/pipermail/mod_python/2004-October/ 
016596.html

   # from servlet import HTMLPage

   from mod_python import apache
   servlet = apache.import_module("servlet")
   HTMLPage = servlet.HTMLPage

Graham

> -----Messaggio originale-----
> Da: Graham Dumpleton [mailto:grahamd@dscpl.com.au]
> Inviato: marted? 23 maggio 2006 13.09
> A: Manera, Villiam
> Cc: mod_python@modpython... list
> Oggetto: Re: R: R: [mod_python] Servlet Loading problem 1 year later
>
>
> On 23/05/2006, at 8:15 PM, Manera, Villiam wrote:
>
>> I don't use apache.import_module() in any of my own modules. The
>> problem arise in developer (linux:RH3 EL mod_python 3.2.8)
>> And in the production          (linux:RH3 EL mod_python 3.1.5)
>>
>> If I right understand the article only in mod_python 3.2.8 the new
>> module loding is in place.
>>
>> Villiam
>
> If you are specifying:
>
>    PythonHandler mod_python.servlet
>
> or:
>
>    PythonHandler servlet
>
> if you put the mpservlets code in your handler directory, then you  
> are.
>
> This is because the PythonHandler directive uses "apache.import_module
> ()".
>
> All it then takes to cause problems is for you to use:
>
>    import mod_python.servlet
>    from mod_python import servlet
>
> or:
>
>    import servlet
>
> depending on whether mpservlets installed centrally or in handler
> directory.
>
> If this is the case, you might solve the problem by using
> "apache.import_module()"
> to import "mod_python.servlet" etc.
>
> Graham
>
>> On 22/05/2006 at 22:56 Graham Dumpleton wrote:
>>
>>> Please keep followups on list.
>>
>>> You don't need to actually touch servlet.py to get problems if you
>> happen to be using "import" and "apache.import_module ()" on the same
>> module at different times. This is because of an issue in the
>> mod_python
>> importer. See:
>>
>>>
>> http://www.dscpl.com.au/articles/modpython-003.html#redundant-
>> module-loa
>> ding
>>
>>> Sorry for quick reply, in a rush. I'll try and comment later on the
>> whole issue of checking subclass types and caching.
>>
>>> Graham
>>
>> On 22/05/2006, at 11:06 PM, Manera, Villiam wrote:
>>
>>> Yes, i knows that it could be happened if I touch servlet.py becouse
>>> Daniel Popowiwich told me 1 year ago.
>>>
>>> ....
>


From yjfuk at 126.com  Wed May 24 03:17:49 2006
From: yjfuk at 126.com (yjfuk)
Date: Wed May 24 03:12:39 2006
Subject: [mod_python] psp problem
In-Reply-To: <A651CD18-12D0-4F09-B744-04599D8B3A7A@dscpl.com.au>
References: <4452E132.00007B.00573@m65.126.com>
	<A651CD18-12D0-4F09-B744-04599D8B3A7A@dscpl.com.au>
Message-ID: <4474089D.3010703@126.com>


I use mod_python publish as handler,psp as template and MySQLdb to  
connect  the mysql .apache is 2.0.58 use perfork MPM

codes below:

from MySQLdb import connect
from mod_python import psp

def index (req):
    
conn=connect(**{'host':'localhost','user':'root','passwd':'','db':'test'})
    req.content_type = "text/html; charset=utf-8"
    psp.PSP(req,'templates/test.html').run({'name':'jack'})
    conn.close()

when I flush the exlpore, I see the 'show processlist' in the mysql 
shell is ceaselessly increasing ,why?


From niclas.hughes at securetrading.com  Wed May 24 06:43:20 2006
From: niclas.hughes at securetrading.com (Niclas Hughes)
Date: Wed May 24 06:43:25 2006
Subject: [mod_python] undefined symbol APR_STATUS_IS_SUCCESS version 3.2.8
Message-ID: <200605241043.k4OAhNFd020174@modpython.org>

After upgrading apache to 2.0.58 and found about about the memory problems
with mod_python 3.1.4 we have looked into upgrading mod_python to version
3.2.8 but are getting an error when trying to start apache: undefined symbol
APR_STATUS_IS_SUCCESS

 

Does anyone know why this error is happening with apache 2.0.58 and
mod_python 3.2.8.

 

Thanks

Nick

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060524/ef9af1c6/attachment.html
From jpg at jgassociates.ca  Wed May 24 07:46:11 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Wed May 24 07:46:11 2006
Subject: [mod_python] undefined symbol APR_STATUS_IS_SUCCESS version 3.2.8
In-Reply-To: <200605241043.k4OAhNFd020174@modpython.org>
References: <200605241043.k4OAhNFd020174@modpython.org>
Message-ID: <44744783.1040006@jgassociates.ca>

Niclas Hughes wrote:
> After upgrading apache to 2.0.58 and found about about the memory problems
> with mod_python 3.1.4 we have looked into upgrading mod_python to version
> 3.2.8 but are getting an error when trying to start apache: undefined symbol
> APR_STATUS_IS_SUCCESS
> 
> Does anyone know why this error is happening with apache 2.0.58 and
> mod_python 3.2.8.

Thats strange. What's your apr version? (apxs --version)

APR_STATUS_IS_SUCCESS is deprecated in apr 0.9.x, and removed in 1.x 
(which is used in Apache 2.2), but the version shipped with apache 
2.0.55 is still 0.9.7. I find it hard to believe 2.0.58 would use apr 
1.0, but I suppose it's possible.

This is one of the things that we changed to support Apache 2.2.

Sorry for the vagueness on the version numbers, but I'm in a rush to get 
out the door.

Jim

From jpg at jgassociates.ca  Wed May 24 08:03:23 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Wed May 24 08:03:19 2006
Subject: [mod_python] psp problem
In-Reply-To: <4474089D.3010703@126.com>
References: <4452E132.00007B.00573@m65.126.com>	<A651CD18-12D0-4F09-B744-04599D8B3A7A@dscpl.com.au>
	<4474089D.3010703@126.com>
Message-ID: <44744B8B.4080601@jgassociates.ca>

yjfuk wrote:
> 
> I use mod_python publish as handler,psp as template and MySQLdb to  
> connect  the mysql .apache is 2.0.58 use perfork MPM
> 
> codes below:
> 
> from MySQLdb import connect
> from mod_python import psp
> 
> def index (req):
>    
> conn=connect(**{'host':'localhost','user':'root','passwd':'','db':'test'})
>    req.content_type = "text/html; charset=utf-8"
>    psp.PSP(req,'templates/test.html').run({'name':'jack'})
>    conn.close()
> 
> when I flush the exlpore, I see the 'show processlist' in the mysql 
> shell is ceaselessly increasing ,why?

Are you raising an exception such that conn.close() does not get a 
chance to run? If so, you could either wrap your code in a try/finally 
clause (closing the connection within finally), or better yet, register 
a cleanup that will always run when apache finishes processing the request.

def index(req):
    conn=connect(**{'host':'localhost','user':'root',
                   'passwd':'','db':'test'})
    req.register_cleanup(close_db_connection, conn)
    req.content_type = "text/html; charset=utf-8"
    psp.PSP(req,'templates/test.html').run({'name':'jack'})

def close_db_connection(db_con):
    db_con.close()

Jim
From jpg at jgassociates.ca  Wed May 24 08:09:04 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Wed May 24 08:08:58 2006
Subject: [mod_python] undefined symbol APR_STATUS_IS_SUCCESS version 3.2.8
In-Reply-To: <44744783.1040006@jgassociates.ca>
References: <200605241043.k4OAhNFd020174@modpython.org>
	<44744783.1040006@jgassociates.ca>
Message-ID: <44744CE0.3070300@jgassociates.ca>

Jim Gallacher wrote:
> Niclas Hughes wrote:
>> After upgrading apache to 2.0.58 and found about about the memory 
>> problems
>> with mod_python 3.1.4 we have looked into upgrading mod_python to version
>> 3.2.8 but are getting an error when trying to start apache: undefined 
>> symbol
>> APR_STATUS_IS_SUCCESS
>>
>> Does anyone know why this error is happening with apache 2.0.58 and
>> mod_python 3.2.8.
> 
> Thats strange. What's your apr version? (apxs --version)

And by apxs --version I *really* meant

apr-config --version

Jim
From yjfuk at 126.com  Wed May 24 10:35:13 2006
From: yjfuk at 126.com (yjfuk)
Date: Wed May 24 10:35:41 2006
Subject: [mod_python] psp problem
In-Reply-To: <44744B8B.4080601@jgassociates.ca>
References: <4452E132.00007B.00573@m65.126.com>	<A651CD18-12D0-4F09-B744-04599D8B3A7A@dscpl.com.au>
	<4474089D.3010703@126.com> <44744B8B.4080601@jgassociates.ca>
Message-ID: <44746F21.9000006@126.com>


I tested it when I run psp with no vars,it does not increase.
how psp do with the vars?

Jim Gallacher ??:
>
> yjfuk wrote:
>>
>> I use mod_python publish as handler,psp as template and MySQLdb to 
>> connect the mysql .apache is 2.0.58 use perfork MPM
>>
>> codes below:
>>
>> from MySQLdb import connect
>> from mod_python import psp
>>
>> def index (req):
>> conn=connect(**{'host':'localhost','user':'root','passwd':'','db':'test'}) 
>>
>> req.content_type = "text/html; charset=utf-8"
>> psp.PSP(req,'templates/test.html').run({'name':'jack'})
>> conn.close()
>>
>> when I flush the exlpore, I see the 'show processlist' in the mysql 
>> shell is ceaselessly increasing ,why?
>
> Are you raising an exception such that conn.close() does not get a 
> chance to run? If so, you could either wrap your code in a try/finally 
> clause (closing the connection within finally), or better yet, 
> register a cleanup that will always run when apache finishes 
> processing the request.
>
> def index(req):
> conn=connect(**{'host':'localhost','user':'root',
> 'passwd':'','db':'test'})
> req.register_cleanup(close_db_connection, conn)
> req.content_type = "text/html; charset=utf-8"
> psp.PSP(req,'templates/test.html').run({'name':'jack'})
>
> def close_db_connection(db_con):
> db_con.close()
>
> Jim
>
>


From David.Bear at asu.edu  Wed May 24 16:16:45 2006
From: David.Bear at asu.edu (David Bear)
Date: Wed May 24 16:16:56 2006
Subject: [mod_python] force a reload?
Message-ID: <20060524201645.GF1300@asu.edu>

As I make changes to my publisher script, I think I'm running into
instances where when I run a test, the 'old' version of the script is
still be run by apache. Two cases of come up so far.

1) I modify code in a psp template to form a new img src path. Some
times it works -- sometimes not. (when viewing the html source sent to
the browser its clear the the modified verions of my function is not
being executed) (note that the code lives in a psp served by a
publisher script)

2) Second instance is where I've modified a function in a publisher
script that doesn't seem to be executed when apache serves it.

I assumed I hitting the situation where I've hit an apache thread that
had an 'older' running interpreter?

I'm using apache 2.0.53 prefork and modpython 3.1.3. (on a suse 9.3
linux system)(installed by rpm not source)

-- 
David Bear
phone: 	480-965-8257
fax: 	480-965-9189
College of Public Programs/ASU
Wilson Hall 232
Tempe, AZ 85287-0803
 "Beware the IP portfolio, everyone will be suspect of trespassing"
From David.Bear at asu.edu  Wed May 24 16:26:47 2006
From: David.Bear at asu.edu (David Bear)
Date: Wed May 24 16:28:17 2006
Subject: [mod_python] session redux
Message-ID: <20060524202647.GG1300@asu.edu>

I'm trying to understand sessioning better. Here is a scenario:

I have a publisher script called py.py. publisher is set as the
handler for directory.

Using py.py as a dispatcher for url named modules we have

functions in py.py 		psp pages served by function
index 				main.psp
register 			register.psp
regpage2 			regp2.psp
final				final.psp

A session object is instantiated in py.py. I assume I can pass the
session object via the vars name to the psp template correct?

using http://myserver/py.py the index function serves main.psp.

using http://myserver/py.py/register the register.psp code is
'rendered'/'evaluated' and sent to the client.

Now, the question: As the user proceeds from main.psp to register.psp
to regp2.psp and so on, how to modpython know not to create a new
session object for each visit? Put another way, how would the
regp2.psp page 'know' of the session object created when the user
first visited the main.psp page?

-- 
David Bear
phone: 	480-965-8257
fax: 	480-965-9189
College of Public Programs/ASU
Wilson Hall 232
Tempe, AZ 85287-0803
 "Beware the IP portfolio, everyone will be suspect of trespassing"
From james at theblogstudio.com  Wed May 24 16:39:34 2006
From: james at theblogstudio.com (James King)
Date: Wed May 24 16:39:39 2006
Subject: [mod_python] mod_python on apache 1.3.36
Message-ID: <D591BBFA-F398-4189-A89A-281449DD523A@theblogstudio.com>

Hi there!

Any help is appreciated..

Having an issue verifying that my install of mod_python is  
functioning. I need to get it to work to get trac running. :)

ran ./configure --with-apxs=/usr/local/apache/bin/apxs --with-max- 
locks=32; make & make install

Then added the LoadModule / AddModule lines to my main httpd.conf file

Now within a VirtualHost section I have:

ServerAlias foo.com
...
<Location /mptest>
   SetHandler mod_python
   PythonHandler modpython.testhandler
</Location>
...

And when I go to http://foo.com/mptest I simply get a 404. No errors  
and nothing in the log.

Thanks in advance for your help!

Cheers,

James
From jpg at jgassociates.ca  Wed May 24 22:10:00 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Wed May 24 22:07:30 2006
Subject: [mod_python] force a reload?
In-Reply-To: <20060524201645.GF1300@asu.edu>
References: <20060524201645.GF1300@asu.edu>
Message-ID: <447511F8.9050401@jgassociates.ca>

David Bear wrote:
> As I make changes to my publisher script, I think I'm running into
> instances where when I run a test, the 'old' version of the script is
> still be run by apache. Two cases of come up so far.
> 
> 1) I modify code in a psp template to form a new img src path. Some
> times it works -- sometimes not. (when viewing the html source sent to
> the browser its clear the the modified verions of my function is not
> being executed) (note that the code lives in a psp served by a
> publisher script)
> 
> 2) Second instance is where I've modified a function in a publisher
> script that doesn't seem to be executed when apache serves it.
> 
> I assumed I hitting the situation where I've hit an apache thread that
> had an 'older' running interpreter?
> 
> I'm using apache 2.0.53 prefork and modpython 3.1.3. (on a suse 9.3
> linux system)(installed by rpm not source)

Your assessment may be correct but there is a further issue in 3.1.3, 
where you can have 2 files with the same name (index.py) in different 
directories. The file that will by subsequent requests in a given 
process will depend on which on one got loaded first. As a result you 
can flip between 2 different outputs. Version 3.2.8 is an improvement 
and you are much less likely to see this sort of problem for simple 
cases. Graham is working on a new importer for 3.3 which will hopefully 
be a more complete solution. Upgrade to 3.2.8 if you can, or restart 
apache when you make changes in your code and avoid duplicate file 
names. Using 3.1.x really can be a PIA.

Jim


From jpg at jgassociates.ca  Wed May 24 22:22:32 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Wed May 24 22:19:55 2006
Subject: [mod_python] mod_python on apache 1.3.36
In-Reply-To: <D591BBFA-F398-4189-A89A-281449DD523A@theblogstudio.com>
References: <D591BBFA-F398-4189-A89A-281449DD523A@theblogstudio.com>
Message-ID: <447514E8.6090603@jgassociates.ca>

You can't use mod_python 3.x on apache 1.3 because of threading issues. 
Either downgrade to mod_python 2.7.x or upgrade apache to 2.0.x.

(I'm assuming you're trying to install mod_python 3.2.8, as 
--with-max=locks is a new in 3.2)

Jim

James King wrote:
> Hi there!
> 
> Any help is appreciated..
> 
> Having an issue verifying that my install of mod_python is functioning. 
> I need to get it to work to get trac running. :)
> 
> ran ./configure --with-apxs=/usr/local/apache/bin/apxs 
> --with-max-locks=32; make & make install
> 
> Then added the LoadModule / AddModule lines to my main httpd.conf file
> 
> Now within a VirtualHost section I have:
> 
> ServerAlias foo.com
> ...
> <Location /mptest>
>   SetHandler mod_python
>   PythonHandler modpython.testhandler
> </Location>
> ...
> 
> And when I go to http://foo.com/mptest I simply get a 404. No errors and 
> nothing in the log.
> 
> Thanks in advance for your help!
> 
> Cheers,
> 
> James
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 

From jpg at jgassociates.ca  Wed May 24 22:39:15 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Wed May 24 22:36:33 2006
Subject: [mod_python] session redux
In-Reply-To: <20060524202647.GG1300@asu.edu>
References: <20060524202647.GG1300@asu.edu>
Message-ID: <447518D3.2090905@jgassociates.ca>

David Bear wrote:
> I'm trying to understand sessioning better. Here is a scenario:
> 
> I have a publisher script called py.py. publisher is set as the
> handler for directory.
> 
> Using py.py as a dispatcher for url named modules we have
> 
> functions in py.py 		psp pages served by function
> index 				main.psp
> register 			register.psp
> regpage2 			regp2.psp
> final				final.psp
> 
> A session object is instantiated in py.py. I assume I can pass the
> session object via the vars name to the psp template correct?
> 
> using http://myserver/py.py the index function serves main.psp.
> 
> using http://myserver/py.py/register the register.psp code is
> 'rendered'/'evaluated' and sent to the client.
> 
> Now, the question: As the user proceeds from main.psp to register.psp
> to regp2.psp and so on, how to modpython know not to create a new
> session object for each visit? Put another way, how would the
> regp2.psp page 'know' of the session object created when the user
> first visited the main.psp page?

It's magic and it all happens when you create a session instance. When 
the instance is created it checks for the existence of a cookie named 
pysid. If it finds it, it will check the persistent store (depending on 
what session class you are using) for the corresponding data and load it 
if it exists. Otherwise it will generate a new session id. Finally, the 
pysid cookie (either the existing on or the new one) will be set in the 
response headers.

The only trick is to make sure you save your session data. Otherwise 
every request will create a new session.

The only *other* trick is to make sure you only create one session 
instance per request, otherwise you'll get a deadlock. Session locking 
happens automatically and protects the integrity of your session, but 
deadlocks are a bad thing, and should be avoided. ;)

The "standard" way to pass the session instance around is as a request 
attribute. There is some further magic in psp where it looks for any 
variables named "session". If found it will use req.session if it 
exists, or create a new session using Session.Session().

Typical usage
-------------

def index(req):
    req.session = Session.Session(req)
    if req.session.is_new():
        req.session['count'] = 0
    else:
        req.session['count'] = req.session['count'] + 1

    tmpl = psp.PSP(req, filename='whatever.tmpl')
    tmpl.run()
    # Make sure you save your session!
    req.session.save()


def register(req):
    req.session = Session.Session(req)
    if req.session.is_new():
        req.session['count'] = 0
    else:
        req.session['count'] = req.session['count'] + 1
    helper_function(req)
    tmpl = psp.PSP(req, filename='whatever.tmpl')
    tmpl.run()
    # Make sure you save your session!
    req.session.save()

def helper_function(req):
    # Don't create a session instance here, use the one created in
    # in the register function.
    req.session['message'] = "You have been helped"

As you suggest you could pass the session instance to the psp template 
using vars, but if you do make sure you *do not* use "session" as a 
variable name in the template. Otherwise the magic in psp will turn out 
to be all bad and you'll deadlock.

Jim

From jpg at jgassociates.ca  Wed May 24 22:42:14 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Wed May 24 22:39:31 2006
Subject: [mod_python] psp problem
In-Reply-To: <44746F21.9000006@126.com>
References: <4452E132.00007B.00573@m65.126.com>	<A651CD18-12D0-4F09-B744-04599D8B3A7A@dscpl.com.au>
	<4474089D.3010703@126.com> <44744B8B.4080601@jgassociates.ca>
	<44746F21.9000006@126.com>
Message-ID: <44751986.8070008@jgassociates.ca>

yjfuk wrote:
> 
> I tested it when I run psp with no vars,it does not increase.
> how psp do with the vars?

There must be more going on in your code than you have indicated. The 
use of psp should not have any impact on the mysql connection.

Jim

> Jim Gallacher :
>>
>> yjfuk wrote:
>>>
>>> I use mod_python publish as handler,psp as template and MySQLdb to 
>>> connect the mysql .apache is 2.0.58 use perfork MPM
>>>
>>> codes below:
>>>
>>> from MySQLdb import connect
>>> from mod_python import psp
>>>
>>> def index (req):
>>> conn=connect(**{'host':'localhost','user':'root','passwd':'','db':'test'}) 
>>>
>>> req.content_type = "text/html; charset=utf-8"
>>> psp.PSP(req,'templates/test.html').run({'name':'jack'})
>>> conn.close()
>>>
>>> when I flush the exlpore, I see the 'show processlist' in the mysql 
>>> shell is ceaselessly increasing ,why?
>>
>> Are you raising an exception such that conn.close() does not get a 
>> chance to run? If so, you could either wrap your code in a try/finally 
>> clause (closing the connection within finally), or better yet, 
>> register a cleanup that will always run when apache finishes 
>> processing the request.
>>
>> def index(req):
>> conn=connect(**{'host':'localhost','user':'root',
>> 'passwd':'','db':'test'})
>> req.register_cleanup(close_db_connection, conn)
>> req.content_type = "text/html; charset=utf-8"
>> psp.PSP(req,'templates/test.html').run({'name':'jack'})
>>
>> def close_db_connection(db_con):
>> db_con.close()
>>
>> Jim
>>
>>
> 
> 
> 

From gary at plasmaperfect.net  Thu May 25 06:20:45 2006
From: gary at plasmaperfect.net (Gary Broadbent)
Date: Thu May 25 06:21:12 2006
Subject: [mod_python] FieldStorage and POST data
Message-ID: <200605251120.45970.gary@plasmaperfect.net>

Sorry if this is a silly question, but:

I am having some issues trying to retrieve POST data from a form.

If I set the form method to GET, FieldStorage gets populated, but as soon as I 
set the method to POST, I dont retrieve and data.

Please refer to the following output:

***** GET method used **********
FieldStorage  	
= [Field('num', '0'),
 Field('search', 'sear'),
 Field('company', 'comp'),
 Field('location', 'loca')]

the_request 
= 'GET /sipnificant/results?num=0&search=sear&company=comp&location=loca 
HTTP/1.1'

subprocess_env  	
= {'DOCUMENT_ROOT': '/home/***/html',
 'GATEWAY_INTERFACE': 'CGI/1.1',
 'HTTP_ACCEPT': 'text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5',
 'HTTP_ACCEPT_CHARSET': 'ISO-8859-1,utf-8;q=0.7,*;q=0.7',
 'HTTP_ACCEPT_ENCODING': 'gzip,deflate',
 'HTTP_ACCEPT_LANGUAGE': 'en-us,en;q=0.5',
 'HTTP_CONNECTION': 'keep-alive',
 'HTTP_COOKIE': 'taskware_lang=en; style=A; 
AWSUSER_ID=awsuser_id1143973127792r5484; colour=white',
 'HTTP_HOST': 'plasmaperfect.net',
 'HTTP_KEEP_ALIVE': '300',
 'HTTP_REFERER': 'http://plasmaperfect.net/****/',
 'HTTP_USER_AGENT': 'Mozilla/5.0 (X11; U; Linux x86_64; en-US; rv:1.8.0.1) 
Gecko/20060222 Firefox/1.5.0.1',
 'PATH': '/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/sbin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/opt/bin:/usr/x86_64-pc-linux-gnu/gcc-bin/3.4.5',
 'QUERY_STRING': 'num=0&search=sear&company=comp&location=loca',
 'REMOTE_ADDR': '192.168.0.4',
 'REMOTE_PORT': '53695',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/****/results?num=0&search=sear&company=comp&location=loca',
 'SCRIPT_FILENAME': '/home/***/sipnificant/results',
 'SCRIPT_NAME': '/sipnificant/results',
 'SERVER_ADDR': '192.168.0.2',
 'SERVER_ADMIN': 'hostmaster@plasmaperfect.net',
 'SERVER_NAME': 'plasmaperfect.net',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'SERVER_SIGNATURE': '',

unparsed_uri  	
= '/sipnificant/results?num=0&search=sear&company=comp&location=loca'

uri 	
= '/sipnificant/results'

filename 	
= '/home/***/sipnificant/results'

canonical_filename 	
= '/home/***/sipnificant/results'

path_info 	
= ''
args 	
= 'num=0&search=sear&company=comp&location=loca'

finfo 	
= None

parsed_uri 	
= (None,
 None,
 None,
 None,
 None,
 None,
 '/sipnificant/results',
 'num=0&search=sear&company=comp&location=loca',
 None)

parsed_uri 	
= (None,
 None,
 None,
 None,
 None,
 None,
 '/sipnificant/results',
 'num=0&search=sear&company=comp&location=loca',
 None)

***** POST method used **********
FieldStorage  	
= []

the_request  	
= 'POST /sipnificant/results HTTP/1.1'

subprocess_env  	
= {'CONTENT_LENGTH': '44',
 'CONTENT_TYPE': 'application/x-www-form-urlencoded',
 'DOCUMENT_ROOT': '/home/***/html',
 'GATEWAY_INTERFACE': 'CGI/1.1',
 'HTTP_ACCEPT': 'text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5',
 'HTTP_ACCEPT_CHARSET': 'ISO-8859-1,utf-8;q=0.7,*;q=0.7',
 'HTTP_ACCEPT_ENCODING': 'gzip,deflate',
 'HTTP_ACCEPT_LANGUAGE': 'en-us,en;q=0.5',
 'HTTP_CONNECTION': 'keep-alive',
 'HTTP_COOKIE': 'taskware_lang=en; style=A; 
AWSUSER_ID=awsuser_id1143973127792r5484; colour=white',
 'HTTP_HOST': 'plasmaperfect.net',
 'HTTP_KEEP_ALIVE': '300',
 'HTTP_REFERER': 'http://plasmaperfect.net/sipnificant/',
 'HTTP_USER_AGENT': 'Mozilla/5.0 (X11; U; Linux x86_64; en-US; rv:1.8.0.1) 
Gecko/20060222 Firefox/1.5.0.1',
 'PATH': '/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/sbin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/opt/bin:/usr/x86_64-pc-linux-gnu/gcc-bin/3.4.5',
 'QUERY_STRING': '',
 'REMOTE_ADDR': '192.168.0.4',
 'REMOTE_PORT': '37766',
 'REQUEST_METHOD': 'POST',
 'REQUEST_URI': '/sipnificant/results',
 'SCRIPT_FILENAME': '/home/****/sipnificant/results',
 'SCRIPT_NAME': '/sipnificant/results',
 'SERVER_ADDR': '192.168.0.2',
 'SERVER_ADMIN': 'hostmaster@plasmaperfect.net',
 'SERVER_NAME': 'plasmaperfect.net',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'SERVER_SIGNATURE': '',
 'SERVER_SOFTWARE': 'Apache'}

unparsed_uri  	
= '/sipnificant/results'

uri 	
= '/sipnificant/results'

args  	
= None

finfo 	
= None

parsed_uri 	
= (None, None, None, None, None, None, '/sipnificant/results', None, None)

parsed_uri 	
= (None, None, None, None, None, None, '/sipnificant/results', None, None)


Thank you in advance,

Gary Stidston-Broadbent
From jpg at jgassociates.ca  Thu May 25 07:48:48 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Thu May 25 07:49:20 2006
Subject: [mod_python] FieldStorage and POST data
In-Reply-To: <200605251120.45970.gary@plasmaperfect.net>
References: <200605251120.45970.gary@plasmaperfect.net>
Message-ID: <447599A0.4000804@jgassociates.ca>

Not enough information here to say for sure, but be aware that you can 
only create one instance of FieldStorage per request, as the body of the 
request gets "consumed". So if you do something like:

form1 = FieldStorage(req)
form2 = FieldStorage(req)

form1 will be populated with the contents of the POST but form2 will not.

When the FieldStorage instance is being created it will always parse the 
query string so you will always get those fields for a GET. For POST, 
the form data is encoded in the body of the request which FieldStorage 
treats as a file stream and creating form1 reads to the end of the 
stream. When you create form2, you are already at the end of the stream, 
so there is nothing to process.

Note that publisher automatically creates a FieldStorage instance as 
req.form. If you are using publisher, don't create your own instance. 
Use the one stuffed into req.form.

Jim

Gary Broadbent wrote:
> Sorry if this is a silly question, but:
> 
> I am having some issues trying to retrieve POST data from a form.
> 
> If I set the form method to GET, FieldStorage gets populated, but as soon as I 
> set the method to POST, I dont retrieve and data.
> 
> Please refer to the following output:
> 
> ***** GET method used **********
> FieldStorage  	
> = [Field('num', '0'),
>  Field('search', 'sear'),
>  Field('company', 'comp'),
>  Field('location', 'loca')]
> 
> the_request 
> = 'GET /sipnificant/results?num=0&search=sear&company=comp&location=loca 
> HTTP/1.1'
> 
> subprocess_env  	
> = {'DOCUMENT_ROOT': '/home/***/html',
>  'GATEWAY_INTERFACE': 'CGI/1.1',
>  'HTTP_ACCEPT': 'text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5',
>  'HTTP_ACCEPT_CHARSET': 'ISO-8859-1,utf-8;q=0.7,*;q=0.7',
>  'HTTP_ACCEPT_ENCODING': 'gzip,deflate',
>  'HTTP_ACCEPT_LANGUAGE': 'en-us,en;q=0.5',
>  'HTTP_CONNECTION': 'keep-alive',
>  'HTTP_COOKIE': 'taskware_lang=en; style=A; 
> AWSUSER_ID=awsuser_id1143973127792r5484; colour=white',
>  'HTTP_HOST': 'plasmaperfect.net',
>  'HTTP_KEEP_ALIVE': '300',
>  'HTTP_REFERER': 'http://plasmaperfect.net/****/',
>  'HTTP_USER_AGENT': 'Mozilla/5.0 (X11; U; Linux x86_64; en-US; rv:1.8.0.1) 
> Gecko/20060222 Firefox/1.5.0.1',
>  'PATH': '/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/sbin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/opt/bin:/usr/x86_64-pc-linux-gnu/gcc-bin/3.4.5',
>  'QUERY_STRING': 'num=0&search=sear&company=comp&location=loca',
>  'REMOTE_ADDR': '192.168.0.4',
>  'REMOTE_PORT': '53695',
>  'REQUEST_METHOD': 'GET',
>  'REQUEST_URI': '/****/results?num=0&search=sear&company=comp&location=loca',
>  'SCRIPT_FILENAME': '/home/***/sipnificant/results',
>  'SCRIPT_NAME': '/sipnificant/results',
>  'SERVER_ADDR': '192.168.0.2',
>  'SERVER_ADMIN': 'hostmaster@plasmaperfect.net',
>  'SERVER_NAME': 'plasmaperfect.net',
>  'SERVER_PORT': '80',
>  'SERVER_PROTOCOL': 'HTTP/1.1',
>  'SERVER_SIGNATURE': '',
> 
> unparsed_uri  	
> = '/sipnificant/results?num=0&search=sear&company=comp&location=loca'
> 
> uri 	
> = '/sipnificant/results'
> 
> filename 	
> = '/home/***/sipnificant/results'
> 
> canonical_filename 	
> = '/home/***/sipnificant/results'
> 
> path_info 	
> = ''
> args 	
> = 'num=0&search=sear&company=comp&location=loca'
> 
> finfo 	
> = None
> 
> parsed_uri 	
> = (None,
>  None,
>  None,
>  None,
>  None,
>  None,
>  '/sipnificant/results',
>  'num=0&search=sear&company=comp&location=loca',
>  None)
> 
> parsed_uri 	
> = (None,
>  None,
>  None,
>  None,
>  None,
>  None,
>  '/sipnificant/results',
>  'num=0&search=sear&company=comp&location=loca',
>  None)
> 
> ***** POST method used **********
> FieldStorage  	
> = []
> 
> the_request  	
> = 'POST /sipnificant/results HTTP/1.1'
> 
> subprocess_env  	
> = {'CONTENT_LENGTH': '44',
>  'CONTENT_TYPE': 'application/x-www-form-urlencoded',
>  'DOCUMENT_ROOT': '/home/***/html',
>  'GATEWAY_INTERFACE': 'CGI/1.1',
>  'HTTP_ACCEPT': 'text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5',
>  'HTTP_ACCEPT_CHARSET': 'ISO-8859-1,utf-8;q=0.7,*;q=0.7',
>  'HTTP_ACCEPT_ENCODING': 'gzip,deflate',
>  'HTTP_ACCEPT_LANGUAGE': 'en-us,en;q=0.5',
>  'HTTP_CONNECTION': 'keep-alive',
>  'HTTP_COOKIE': 'taskware_lang=en; style=A; 
> AWSUSER_ID=awsuser_id1143973127792r5484; colour=white',
>  'HTTP_HOST': 'plasmaperfect.net',
>  'HTTP_KEEP_ALIVE': '300',
>  'HTTP_REFERER': 'http://plasmaperfect.net/sipnificant/',
>  'HTTP_USER_AGENT': 'Mozilla/5.0 (X11; U; Linux x86_64; en-US; rv:1.8.0.1) 
> Gecko/20060222 Firefox/1.5.0.1',
>  'PATH': '/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/sbin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/opt/bin:/usr/x86_64-pc-linux-gnu/gcc-bin/3.4.5',
>  'QUERY_STRING': '',
>  'REMOTE_ADDR': '192.168.0.4',
>  'REMOTE_PORT': '37766',
>  'REQUEST_METHOD': 'POST',
>  'REQUEST_URI': '/sipnificant/results',
>  'SCRIPT_FILENAME': '/home/****/sipnificant/results',
>  'SCRIPT_NAME': '/sipnificant/results',
>  'SERVER_ADDR': '192.168.0.2',
>  'SERVER_ADMIN': 'hostmaster@plasmaperfect.net',
>  'SERVER_NAME': 'plasmaperfect.net',
>  'SERVER_PORT': '80',
>  'SERVER_PROTOCOL': 'HTTP/1.1',
>  'SERVER_SIGNATURE': '',
>  'SERVER_SOFTWARE': 'Apache'}
> 
> unparsed_uri  	
> = '/sipnificant/results'
> 
> uri 	
> = '/sipnificant/results'
> 
> args  	
> = None
> 
> finfo 	
> = None
> 
> parsed_uri 	
> = (None, None, None, None, None, None, '/sipnificant/results', None, None)
> 
> parsed_uri 	
> = (None, None, None, None, None, None, '/sipnificant/results', None, None)
> 
> 
> Thank you in advance,
> 
> Gary Stidston-Broadbent
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 

From David.Bear at asu.edu  Thu May 25 13:41:55 2006
From: David.Bear at asu.edu (David Bear)
Date: Thu May 25 13:42:00 2006
Subject: [mod_python] conditions for a 404
Message-ID: <20060525174155.GB9617@asu.edu>

I have a file called tddb.py which contains

"""
from mod_python import session

def index(req):
  req.content_type = "text/plain"
  req.send_http_header()
  req.write("hello world")
  keys = req.keys()
  for k in keys:
    req.write("object name is %s " % k)
  req.write("done")
  return apache.OK

It lives in a directory where publisher is set as the handler for all
.py files.

When I run this via url http://myserver/tddb.py apache returns a 404
error.

I've checked that the file perms on 755 and group own by the webserver
group.

I'm getting lost here. the more I use modpython the less I understand
it. What could be wrong?

-- 
David Bear
phone: 	480-965-8257
fax: 	480-965-9189
College of Public Programs/ASU
Wilson Hall 232
Tempe, AZ 85287-0803
 "Beware the IP portfolio, everyone will be suspect of trespassing"
From nicolas at lehuen.com  Thu May 25 14:03:46 2006
From: nicolas at lehuen.com (Nicolas Lehuen)
Date: Thu May 25 14:03:50 2006
Subject: [mod_python] conditions for a 404
In-Reply-To: <20060525174155.GB9617@asu.edu>
References: <20060525174155.GB9617@asu.edu>
Message-ID: <c298f2d70605251103j6f64a81csb4ccaac2c9143f4a@mail.gmail.com>

Hi David,

First of all, you may want to read your Apache error log to get more
information. In some cases, for security reasons, the user gets a
simple 404 error whereas there is a more precise error message in the
log.

If you cannot read the error log, you can try switching on the
PythonDebug configuration directive to get more detailled error
messages on the client side. Don't forget to remove it when launching
your site on a production server, though, because those error messages
usually contain stack trace, which gives a little bit more data to a
would-be hacker than you would like.

BTW, even if this should not lead to the problem you observe, you are
using the handler's style of coding instead of the publisher style.
Published functions or methods do not return apache.OK, they simply
return a string that needs to be returned to the client, or None if
req.write() is used to send content to the client. Also, you do not
need to use req.send_http_headers().

All this is assuming that you are using the latest mod_python release,
namely the 3.2.8 one. If you don't then I strongly suggest you
upgrade, because you've missed more than one year of bugfixes.

Tell us what is your precise configuration and what you can find in
your error log if you need more help.

Regards,
Nicolas

2006/5/25, David Bear <David.Bear@asu.edu>:
> I have a file called tddb.py which contains
>
> """
> from mod_python import session
>
> def index(req):
>   req.content_type = "text/plain"
>   req.send_http_header()
>   req.write("hello world")
>   keys = req.keys()
>   for k in keys:
>     req.write("object name is %s " % k)
>   req.write("done")
>   return apache.OK
>
> It lives in a directory where publisher is set as the handler for all
> .py files.
>
> When I run this via url http://myserver/tddb.py apache returns a 404
> error.
>
> I've checked that the file perms on 755 and group own by the webserver
> group.
>
> I'm getting lost here. the more I use modpython the less I understand
> it. What could be wrong?
>
> --
> David Bear
> phone:  480-965-8257
> fax:    480-965-9189
> College of Public Programs/ASU
> Wilson Hall 232
> Tempe, AZ 85287-0803
>  "Beware the IP portfolio, everyone will be suspect of trespassing"
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>

From list at joreybump.com  Thu May 25 14:55:25 2006
From: list at joreybump.com (Jorey Bump)
Date: Thu May 25 14:55:33 2006
Subject: [mod_python] conditions for a 404
In-Reply-To: <20060525174155.GB9617@asu.edu>
References: <20060525174155.GB9617@asu.edu>
Message-ID: <4475FD9D.6000607@joreybump.com>

David Bear wrote:
> I have a file called tddb.py which contains
> 
> """
> from mod_python import session
> 
> def index(req):
>   req.content_type = "text/plain"
>   req.send_http_header()
>   req.write("hello world")

These statements are unnecessary when using Publisher.

>   keys = req.keys()

req has no keys method.

>   for k in keys:
>     req.write("object name is %s " % k)
>   req.write("done")

req.write is unnecessary with Publisher, although it may be useful in 
some cases.

>   return apache.OK

This is also unnecessary. It's usually best to return a string from your 
functions when using Publisher. In most cases, this will be a complete 
HTML page, but could also be plain text. In either case, Publisher will 
write the correct headers.

Here is a simplified version of your module:

def index(req):
     return "\n".join(["object name is %s " % (i,) for i in dir(req)])

> It lives in a directory where publisher is set as the handler for all
> .py files.
> 
> When I run this via url http://myserver/tddb.py apache returns a 404
> error.

With Publisher, you must call a function within the module. These are 
equivalent:

http://host/tddb.py/index
http://host/tddb/index

And, because of the special way Publisher handles index():

http://host/tddb.py/
http://host/tddb/

Your URL should also have worked, but it is bad form and maybe you are 
not using a recent version of mod_python. That would be a mistake. You 
should upgrade.

> I've checked that the file perms on 755 and group own by the webserver
> group.
> 
> I'm getting lost here. the more I use modpython the less I understand
> it. What could be wrong?

It is very different from other web application languages, so forget 
everything you know about PHP or CGI for now, as they will only create 
false expectations. Pretend that you are learning web programming from 
scratch, and you may eventually find that it makes a lot of sense. There 
are caveats, however, and mod_python itself is a bit of a moving target 
while it is evolving. Be sure to read the documentation aimed at your 
specific version, and always report your apache/mod_python versions when 
asking for help.

I recommend that beginners master Publisher and ignore PSP for the 
timebeing. That will help you get in the right frame of mind, and 
Publisher is simple (yet powerful) enough to study when/if you decide to 
write your own handler.


From David.Bear at asu.edu  Thu May 25 17:28:40 2006
From: David.Bear at asu.edu (David Bear)
Date: Thu May 25 17:32:05 2006
Subject: [mod_python] conditions for a 404
In-Reply-To: <4475FD9D.6000607@joreybump.com>
References: <20060525174155.GB9617@asu.edu> <4475FD9D.6000607@joreybump.com>
Message-ID: <20060525212840.GE9617@asu.edu>

Thanks for the extensive comments and instructions. Further comments
below..

On Thu, May 25, 2006 at 02:55:25PM -0400, Jorey Bump wrote:
> David Bear wrote:
> >I have a file called tddb.py which contains
> >
> >"""
> >from mod_python import session
> >
> >def index(req):
> >  req.content_type = "text/plain"
> >  req.send_http_header()
> >  req.write("hello world")
> 
> These statements are unnecessary when using Publisher.
> 

okay. I was getting mixed up trying to read too much of the
documentation.

Here's an idea. I was looking for a way to use python to 'publish'
information through apache. I wasn't looking for a way to change
apache.

It seems modpython is more suited to changing apache that just
'pubilshing'. In order to understand how to use modpython to 'publish'
you really need to understand a LOT about the way apache 'publishes'
information. I looked at the publisher handler as a shortcut to
'publishing' the results of python functions, ie a way to make a
python namespace accessible via urls. (coming from doing zope this was
an easy paradigm to work from)

> >  keys = req.keys()
> 
> req has no keys method.
> 
> >  for k in keys:
> >    req.write("object name is %s " % k)
> >  req.write("done")
>

yes. I was poking around trying to see what methods were available on
the request object. I didn't see this documented in the web site..
(but then, I'm still trying to understand the meaning of a lot at
modpython.org)

> 
> def index(req):
>     return "\n".join(["object name is %s " % (i,) for i in dir(req)])
> 
> It is very different from other web application languages, so forget 
> everything you know about PHP or CGI for now, as they will only create 
> false expectations. Pretend that you are learning web programming from 
> scratch, and you may eventually find that it makes a lot of sense. There 
> are caveats, however, and mod_python itself is a bit of a moving target 
> while it is evolving. Be sure to read the documentation aimed at your 
> specific version, and always report your apache/mod_python versions when 
> asking for help.

yes -- this is becoming more true for me. I attempted a reformulation
of my original script. It still generates the 404 error.
==================================
from mod_python import session

page1 = '''
<html>
 <head>
  <title>page 1 </title>
 </head>
 <body>
  this is page 1 boo
 </body>
</html> 
'''

def index(req):
  return page1

def info(req):
  res = []
  thereq = dir(req)
  for i in thereq:
    res.append(i)
  return("%s " % res)
===============================

> 
> I recommend that beginners master Publisher and ignore PSP for the 
> timebeing. That will help you get in the right frame of mind, and 
> Publisher is simple (yet powerful) enough to study when/if you decide to 
> write your own handler.

this is good advice. However, the best example code available at
modpython.org is at  http://modpython.org/examples/ using publisher
and psp.  I would love more example code to learn from. But it seem
rather scarce. There are no books at amazon about modpython. googling
for it almost always yields pages that use addons like vampire,
django, or other templating systems.

Any good sources for information on publisher?

-- 
David Bear
phone: 	480-965-8257
fax: 	480-965-9189
College of Public Programs/ASU
Wilson Hall 232
Tempe, AZ 85287-0803
 "Beware the IP portfolio, everyone will be suspect of trespassing"
From David.Bear at asu.edu  Thu May 25 17:49:09 2006
From: David.Bear at asu.edu (David Bear)
Date: Thu May 25 17:49:19 2006
Subject: [mod_python] conditions for a 404
In-Reply-To: <c298f2d70605251103j6f64a81csb4ccaac2c9143f4a@mail.gmail.com>
References: <20060525174155.GB9617@asu.edu>
	<c298f2d70605251103j6f64a81csb4ccaac2c9143f4a@mail.gmail.com>
Message-ID: <20060525214909.GF9617@asu.edu>

On Thu, May 25, 2006 at 08:03:46PM +0200, Nicolas Lehuen wrote:
> Hi David,
> 
> First of all, you may want to read your Apache error log to get more
> information. In some cases, for security reasons, the user gets a
> simple 404 error whereas there is a more precise error message in the
> log.

This was the first place I looked. The only message in the error_log
is:

[Thu May 25 12:34:09 2006] [notice] mod_python: (Re)importing module
'tddb' with path set to '['/work/servers/www/htdocs/test']'
[Thu May 25 12:34:10 2006] [notice] mod_python: (Re)importing module
'tddb' with path set to '['/work/servers/www/htdocs/test']'
[Thu May 25 12:34:10 2006] [notice] mod_python: (Re)importing module
'tddb' with path set to '['/work/servers/www/htdocs/test']'
[Thu May 25 14:09:49 2006] [notice] mod_python: (Re)importing module
'mod_python.publisher'
[Thu May 25 14:09:49 2006] [notice] mod_python: (Re)importing module
'tddb' with path set to '['/work/servers/www/htdocs/test']'
[Thu May 25 14:09:49 2006] [notice] mod_python: (Re)importing module
'index' with path set to '['/work/servers/www/htdocs/test']'


> If you cannot read the error log, you can try switching on the
> PythonDebug configuration directive to get more detailled error
> messages on the client side. Don't forget to remove it when launching

I have debug on in the directive file:

---------
cat .htaccess
 AddHandler python-program .py
 PythonHandler mod_python.publisher
 PythonDebug On
------------



> your site on a production server, though, because those error messages
> usually contain stack trace, which gives a little bit more data to a
> would-be hacker than you would like.

thanks. good advice. this would be a good think to document in a
modpython best practices.

> 
> BTW, even if this should not lead to the problem you observe, you are
> using the handler's style of coding instead of the publisher style.
> Published functions or methods do not return apache.OK, they simply
> return a string that needs to be returned to the client, or None if
> req.write() is used to send content to the client. Also, you do not
> need to use req.send_http_headers().

ok. this wasn't clear. I've updated the code to be

=====================================
from mod_python import session

page1 = '''
<html>
 <head>
  <title>page 1 </title>
 </head>
 <body>
  this is page 1 boo
 </body>
</html> 
'''

def index(req):
  return page1

def info(req):
  res = []
  thereq = dir(req)
  for i in thereq:
    res.append(i)
  return("%s " % res)
  
==================================

and I still get a 404 error. It would be nice if there were a way to
start a python interpreter, and import the module just to see if there
were some other reason for the error -- syntax, indentation...
  

> 
> All this is assuming that you are using the latest mod_python release,
> namely the 3.2.8 one. If you don't then I strongly suggest you
> upgrade, because you've missed more than one year of bugfixes.
>

sorry, I should have included that. I'm using modpython 3.1.x and
apache 2.0.53 all packaged by suse. Since this is suse 9.3 I'm a
little hesitant to upgrade the modpython for fear of breaking
something else suse might have as a dependancy.

-- 
David Bear
phone: 	480-965-8257
fax: 	480-965-9189
College of Public Programs/ASU
Wilson Hall 232
Tempe, AZ 85287-0803
 "Beware the IP portfolio, everyone will be suspect of trespassing"
From list at joreybump.com  Thu May 25 20:54:17 2006
From: list at joreybump.com (Jorey Bump)
Date: Thu May 25 20:54:22 2006
Subject: [mod_python] conditions for a 404
In-Reply-To: <20060525212840.GE9617@asu.edu>
References: <20060525174155.GB9617@asu.edu> <4475FD9D.6000607@joreybump.com>
	<20060525212840.GE9617@asu.edu>
Message-ID: <447651B9.8090300@joreybump.com>

David Bear wrote:

>> def index(req):
>>     return "\n".join(["object name is %s " % (i,) for i in dir(req)])

Did you try this? It's very simple and should work.

> I attempted a reformulation
> of my original script. It still generates the 404 error.

How did you access it? Show the URL you used. If you are using 
AddHandler, try:

  http://host/directory/tddb.py/index

Remember to include the directory. Your original post did not, and your 
other message indicated that you have the module in a directory called 
test. This would rightly return a 404 error.

> from mod_python import session
> 
> page1 = '''
> <html>
>  <head>
>   <title>page 1 </title>
>  </head>
>  <body>
>   this is page 1 boo
>  </body>
> </html> 
> '''
> 
> def index(req):
>   return page1
> 
> def info(req):
>   res = []
>   thereq = dir(req)
>   for i in thereq:
>     res.append(i)
>   return("%s " % res)

If your module needs reworking, you'll know it from the debug output. 
But you're not there yet, and I fear you're troubleshooting in the wrong 
place. A 404 error is a simple thing to correct, although Publisher can 
introduce quirks that may have us chasing a red herring. You need to get 
output from your published module, so create one that is really simple 
and get it to work:

def eggs():
     return "eggs"

Create this as spam.py in the directory you have mod_python.publisher 
configured as the handler (we'll assume it's called test) and access 
like this:

  http://host/test/spam.py/eggs

Get that to work, and the rest will come easily.

> this is good advice. However, the best example code available at
> modpython.org is at  http://modpython.org/examples/ using publisher
> and psp.  I would love more example code to learn from. But it seem
> rather scarce. There are no books at amazon about modpython. googling
> for it almost always yields pages that use addons like vampire,
> django, or other templating systems.
> 
> Any good sources for information on publisher?

A good book on Publisher would be only a few pages long. Examples are 
scarce because mod_python is extremely flexible, allowing programmers to 
write code according to their own style. I write Python apps in an 
almost purely functional style, for example, and that wouldn't appeal to 
someone who prefers an object oriented approach. I've also created my 
own templating and utility libraries, so my code wouldn't make much 
sense without access to those. But that's just a testament to how 
productive you can be, as soon as you understand mod_python enough to 
leverage the power of Python, which is it's primary focus. Take it 
slowly, read the short manual a few times, and keep a good Python 
reference at hand.


From sanja at bougakov.com  Sun May 28 08:57:42 2006
From: sanja at bougakov.com (Sanja Bougakov)
Date: Sun May 28 08:57:54 2006
Subject: [mod_python] [SPAM] Problem installing on Apache 1.3.34/Win32 -
	"make_obcallback returned no obCallBack!"
Message-ID: <000b01c68256$50475bd0$0301a8c0@lg>

Hello,

I've attempted to install mod_python on Apache 1.3.34 running on Windows XP 
Home.

I've downloaded and installed python-2.4.3.msi (with all default settings), 
extracted mod_python.dll from python2.2-apache1.3.22.zip to python's 
installation directory.

I've added the following to my httpd.conf:

  LoadModule   python_module "c:/python24/mod_python.dll"
  AddHandler python-program .py
  PythonHandler mptest
  PythonDebug on
  AddType text/html .py

Then I've copied python24.dll to python22.dll (leaping ahead: I've also 
tried installing Python-2.2.3.exe to get 'genuine' 2.2 DLL, but it didn't 
change anything). Apache starts OK telling:

  Apache/1.3.34 (Win32) mod_python/2.7.6 Python/2.2.3 PHP/4.4.2 running...

But when I try opening "Hello World" test file from my browser, I get Error 
500 and the following line in VirtualHost's error.log:

  [Sun May 28 16:17:39 2006] [error] [client 127.0.0.1] python_handler: 
make_obcallback returned no obCallBack!

Main error.log contains:

  'import site' failed; use -v for traceback
  make_obcallback(): could not import mod_python.apache.
  make_obcallback(): could not call init.

How can I fix it and make it work?

Thanks in advance,
Sanja

P.S. Please do not advise to upgrade to Apache 2 - it is not an option for 
me. 

From ah at hatzis.de  Mon May 29 13:02:11 2006
From: ah at hatzis.de (Anastasios Hatzis (Hatzis Edelstahlbearbeitung))
Date: Mon May 29 13:02:16 2006
Subject: [mod_python] Problem with clueless Internet Explorer
Message-ID: <447B2913.70204@hatzis.de>

Dear list members!

Currently I'm testing PSP pages. If requesting with Firefox a psp page 
everything
works fine. If requesting with MSIE, I'm prompted with a security hint
to choose wether I want to download or open the file, - huh?

example url:
http://localhost/MyWebapp/MyPage_view.psp?eid=2
or
http://192.168.11.11/MyWebapp/MyPage_view.psp?eid=2

Both doesn't work with MSIE.

Well, I'm sure that I have misconfigured something, thus MSIE is getting
confused of the content type, but I'm not sure, where to start. Apache
config, htaccess, Python script or HTML... I wonder that Firefox has no
problems with that. Of course I can provide more information if needed.

Many thanks.

My test environment consists of:
modpython 3.2.8
Windows XP Professional Version 2002 SP2
Python 2.4.2, standard distribution windows with installer
Apache 2.5.55-win32-x86

Anastasios

From pavel at madman2k.net  Mon May 29 16:51:50 2006
From: pavel at madman2k.net (Pavel Roitberg)
Date: Mon May 29 16:51:53 2006
Subject: [mod_python] Troubles with including local modules
Message-ID: <447B5EE6.1030500@madman2k.net>

Hi,

I'm trying to dig into python using mod_python, but I already fail with
this easy thing.
I can include modules located in /usr/lib without problems, but when I
try to include a local module I'm getting the following error:

"""
Mod_python error: "PythonHandler index"

Traceback (most recent call last):

   File "/usr/lib/python2.4/site-packages/mod_python/apache.py", line
287, in HandlerDispatch
     log=debug)

   File "/usr/lib/python2.4/site-packages/mod_python/apache.py", line
457, in import_module
     module = imp.load_module(mname, f, p, d)

   File "/home/pavel/data/webwork/python/index.py", line 3, in ?
     from module import article

ImportError: cannot import name article
"""

It only works after python generates the according pyc files. (when I
import them manually using the interpreter)

Apache.import_module() does not work at all; neither error, nor module
in local namespace.

The environment is:
mod_python 3.1.4
apache 2.0.55-4ubuntu2
python 2.4.2-0ubuntu3
Ubuntu 6.06

Pavel
From gdamjan at mail.net.mk  Mon May 29 19:31:08 2006
From: gdamjan at mail.net.mk (Damjan)
Date: Mon May 29 19:35:05 2006
Subject: [mod_python] Problem with clueless Internet Explorer
In-Reply-To: <447B2913.70204@hatzis.de>
References: <447B2913.70204@hatzis.de>
Message-ID: <20060529233108.GB16890@legolas.on.net.mk>

> 
> Currently I'm testing PSP pages. If requesting with Firefox a psp page 
> everything
> works fine. If requesting with MSIE, I'm prompted with a security hint
> to choose wether I want to download or open the file, - huh?
> 
> example url:
> http://localhost/MyWebapp/MyPage_view.psp?eid=2
> or
> http://192.168.11.11/MyWebapp/MyPage_view.psp?eid=2
> 
> Both doesn't work with MSIE.
> 
> Well, I'm sure that I have misconfigured something, thus MSIE is getting
> confused of the content type, but I'm not sure, where to start. Apache
> config, htaccess, Python script or HTML... I wonder that Firefox has no
> problems with that. Of course I can provide more information if needed.

Check with the LiveHttp headers Firefox extension if your pages a
returning the correct header "Content-Type: text/html"?

Or, you can also check like this:
  telnet localhost 80
  GET /MyWebapp/MyPage_view.psp?eid=2 HTTP/1.0
  Host: localhost

  <empty line here ... just press ENTER>
  <... you'll receive something like ...>
  HTTP/1.1 200 OK
  Date: Mon, 29 May 2006 23:27:57 GMT
  Server: Apache/2.0.54 (Unix) DAV/2 PHP/5.0.4 mod_python/3.1.4
  Python/2.4.2 mod_scgi/1.7
  Accept-Ranges: bytes
  Connection: close
  Content-Type: text/html


-- 
damjan | ??????
This is my jabber ID -->         damjan@bagra.net.mk 
 -- not my mail address, it's a Jabber ID --^ :)
From mvanaswegen at gmail.com  Tue May 30 03:08:07 2006
From: mvanaswegen at gmail.com (marinus van aswegen)
Date: Tue May 30 03:08:11 2006
Subject: [mod_python] Secure Sessions
Message-ID: <ffa39deb0605300008v36bd900ag42f3422e0e36ffd9@mail.gmail.com>

Hi All

I've noticed that I can tell cookies to only be sent to secured sites
(ala https), however I didn't see the same option for the session
class. Am I missing something here? It's a good practise when using
https to have your sessionid cookie only sent to the secure site
(should also be in the faq).

Marinus
From ah at hatzis.de  Tue May 30 03:59:29 2006
From: ah at hatzis.de (Anastasios Hatzis (Hatzis Edelstahlbearbeitung))
Date: Tue May 30 03:59:33 2006
Subject: [mod_python] Problem with clueless Internet Explorer
In-Reply-To: <20060529233108.GB16890@legolas.on.net.mk>
References: <447B2913.70204@hatzis.de>
	<20060529233108.GB16890@legolas.on.net.mk>
Message-ID: <447BFB61.8050400@hatzis.de>

Damjan wrote:
> Check with the LiveHttp headers Firefox extension if your pages a
> returning the correct header "Content-Type: text/html"?
>   
I used the LiveHttp headers FF extension. Useful goodie. This was the 
header:

*****
http://localhost/MyApp/InetAddress_view.psp?eid=2

[snip]

HTTP/1.x 200 OK
Date: Tue, 30 May 2006 06:49:39 GMT
Server: Apache/2.0.55 (Win32) mod_python/3.2.8 Python/2.4.2
Keep-Alive: timeout=15, max=100
Connection: Keep-Alive
Transfer-Encoding: chunked
Content-Type: text/html, charset=UTF-8
*****

Please notice in Content-Type that I used a  "," - which caused a 
problem for MSIE while Firefox was more tolerant. I replaced it by ";"

req.content_type = 'text/html; charset=UTF-8'
works fine now also on MSIE and encoding in browsers is also correct.

Thanks again!
Anastasios
From stefano.cirilli1 at virgilio.it  Tue May 30 07:47:15 2006
From: stefano.cirilli1 at virgilio.it (stefano cirilli)
Date: Tue May 30 07:47:18 2006
Subject: [mod_python] Problem with clueless Internet Explorer
References: <447B2913.70204@hatzis.de>
Message-ID: <001101c683de$e58f7400$ad963352@stefano>

I think, you are getting this error, the failed import of a local module,
because it isn't in your PythonPath Directory.
In the IDLE try
>import sys
>sys.path (or sys.modules)
with the first, you'll see the list of the added paths, with the second
you'll see, the complete list of all loaded modules.
Stefano Cirilli
----- Original Message ----- 
From: "Anastasios Hatzis (Hatzis Edelstahlbearbeitung)" <ah@hatzis.de>
To: <mod_python@modpython.org>
Sent: Monday, May 29, 2006 7:02 PM
Subject: [mod_python] Problem with clueless Internet Explorer


> Dear list members!
>
> Currently I'm testing PSP pages. If requesting with Firefox a psp page
> everything
> works fine. If requesting with MSIE, I'm prompted with a security hint
> to choose wether I want to download or open the file, - huh?
>
> example url:
> http://localhost/MyWebapp/MyPage_view.psp?eid=2
> or
> http://192.168.11.11/MyWebapp/MyPage_view.psp?eid=2
>
> Both doesn't work with MSIE.
>
> Well, I'm sure that I have misconfigured something, thus MSIE is getting
> confused of the content type, but I'm not sure, where to start. Apache
> config, htaccess, Python script or HTML... I wonder that Firefox has no
> problems with that. Of course I can provide more information if needed.
>
> Many thanks.
>
> My test environment consists of:
> modpython 3.2.8
> Windows XP Professional Version 2002 SP2
> Python 2.4.2, standard distribution windows with installer
> Apache 2.5.55-win32-x86
>
> Anastasios
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From jpg at jgassociates.ca  Tue May 30 08:38:17 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Tue May 30 08:38:21 2006
Subject: [mod_python] Secure Sessions
In-Reply-To: <ffa39deb0605300008v36bd900ag42f3422e0e36ffd9@mail.gmail.com>
References: <ffa39deb0605300008v36bd900ag42f3422e0e36ffd9@mail.gmail.com>
Message-ID: <447C3CB9.2040906@jgassociates.ca>

marinus van aswegen wrote:
> Hi All
> 
> I've noticed that I can tell cookies to only be sent to secured sites
> (ala https),

Are you referring to mod_python or something else? Perhaps you are 
misunderstanding the nature of the SignedCookie class. Quoting from the 
docs:

"This class creates cookies whose name and value are automatically 
signed using HMAC (md5) with a provided secret 'secret', which must be a 
non-empty string."

http://www.modpython.org/live/current/doc-html/pyapi-cookie-classes.html#l2h-202

> however I didn't see the same option for the session
> class. Am I missing something here? 

Yes, if you *are* referring to signed cookies. Just pass the secret to 
the session constructor, same as if you were creating a SignedCookie.

session = Session.Session(req, secret="some secret")

Quoting from the docs for BaseSession:

"When a secret is provided, BaseSession will use SignedCookie when 
generating cookies thereby making the session id almost impossible to 
fake. The default is to use plain Cookie (though even if not signed, the 
session id is generated to be very difficult to guess)."

http://www.modpython.org/live/current/doc-html/pyapi-sess-classes.html#l2h-209

> It's a good practise when using
> https to have your sessionid cookie only sent to the secure site

As far as I know this is not a mod_python capability out of the box. 
You'll need to test if it is an https request in your code and act 
accordingly.

> (should also be in the faq).

Well, maybe but I think this is the first time anyone has asked this 
question, so it doesn't really qualify as frequently asked. ;)

Jim

From nlv11281 at natlab.research.philips.com  Tue May 30 08:51:40 2006
From: nlv11281 at natlab.research.philips.com (Mike Looijmans)
Date: Tue May 30 08:53:34 2006
Subject: [mod_python] Handing Expect: 100-continue from inside mod_python]
Message-ID: <447C3FDC.4080705@natlab.research.philips.com>

I think you'll have to write the 100 response header(s) and status line 
to the underlying connection object. Otherwise, apache will think that 
the request is finished, and weird things will happen.


Simply closing the connection is not so bad - the server is free to do
that anyway. Outputting a "Connection: Close" header along with your
error mesage is good practice. That's what I use since 100-continues are
a pain in the neck to get right on the client side (Python's httplib
cannot handle them).


Mike Looijmans
Philips Natlab / Topic Automation


Joshua Ginsberg wrote:
>>From the mod_python manual:
> 
> http://modpython.org/live/current/doc-html/pyapi-handler.html
> 
> -jag
> 
> On Tue, 2006-05-23 at 13:31 -0400, jarrod roberson wrote:
> 
>>I have been googling and have not been able to find any information
>>about how to have my mod_python handler respond with a 100 Continue or
>>417 Expectation Failed. We are checking quota on PUT's and want to be
>>able to support Expect: 100-continue for PUTs so the client ( which we
>>are in charge of and Content-Lenght is required by the server ). Right
>>now we just drop the connection if the the PUT will fail, it would be
>>much nicer to respond in a more friendly manner. 
>>_______________________________________________
>>Mod_python mailing list
>>Mod_python@modpython.org
>>http://mailman.modpython.org/mailman/listinfo/mod_python
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 


-- 
Mike Looijmans
Philips Natlab / Topic Automation

From jpg at jgassociates.ca  Tue May 30 09:02:53 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Tue May 30 09:02:50 2006
Subject: [mod_python] Troubles with including local modules
In-Reply-To: <447B5EE6.1030500@madman2k.net>
References: <447B5EE6.1030500@madman2k.net>
Message-ID: <447C427D.8050909@jgassociates.ca>

Pavel Roitberg wrote:
> Hi,
> 
> I'm trying to dig into python using mod_python, but I already fail with
> this easy thing.
> I can include modules located in /usr/lib without problems, but when I
> try to include a local module I'm getting the following error:
> 
> """
> Mod_python error: "PythonHandler index"
> 
> Traceback (most recent call last):
> 
>   File "/usr/lib/python2.4/site-packages/mod_python/apache.py", line
> 287, in HandlerDispatch
>     log=debug)
> 
>   File "/usr/lib/python2.4/site-packages/mod_python/apache.py", line
> 457, in import_module
>     module = imp.load_module(mname, f, p, d)
> 
>   File "/home/pavel/data/webwork/python/index.py", line 3, in ?
>     from module import article
> 
> ImportError: cannot import name article
> """
> 
> It only works after python generates the according pyc files. (when I
> import them manually using the interpreter)
> 
> Apache.import_module() does not work at all; neither error, nor module
> in local namespace.
> 
> The environment is:
> mod_python 3.1.4
> apache 2.0.55-4ubuntu2
> python 2.4.2-0ubuntu3
> Ubuntu 6.06
> 

It's not clear to my why it works for pyc files, but not py files. 
Perhaps you could include your mod_python apache configuration 
(AddHandler, etc), and a code snippet.

Jim


From mvanaswegen at gmail.com  Tue May 30 09:19:09 2006
From: mvanaswegen at gmail.com (marinus van aswegen)
Date: Tue May 30 09:19:21 2006
Subject: [mod_python] Secure Sessions
In-Reply-To: <447C3CB9.2040906@jgassociates.ca>
References: <ffa39deb0605300008v36bd900ag42f3422e0e36ffd9@mail.gmail.com>
	<447C3CB9.2040906@jgassociates.ca>
Message-ID: <ffa39deb0605300619h6985c149v8c6b559dc58ec7b5@mail.gmail.com>

Hi Jim

It's a good security practise not to permit the client to send a
sessionid to a non secured (non https) sites, even if it's encrypted.
I just wanted to do this with mod_python.

I found the following via Google.
http://issues.apache.org/jira/browse/MODPYTHON-108

Marinus

On 5/30/06, Jim Gallacher <jpg@jgassociates.ca> wrote:
> marinus van aswegen wrote:
> > Hi All
> >
> > I've noticed that I can tell cookies to only be sent to secured sites
> > (ala https),
>
> Are you referring to mod_python or something else? Perhaps you are
> misunderstanding the nature of the SignedCookie class. Quoting from the
> docs:
>
> "This class creates cookies whose name and value are automatically
> signed using HMAC (md5) with a provided secret 'secret', which must be a
> non-empty string."
>
> http://www.modpython.org/live/current/doc-html/pyapi-cookie-classes.html#l2h-202
>
> > however I didn't see the same option for the session
> > class. Am I missing something here?
>
> Yes, if you *are* referring to signed cookies. Just pass the secret to
> the session constructor, same as if you were creating a SignedCookie.
>
> session = Session.Session(req, secret="some secret")
>
> Quoting from the docs for BaseSession:
>
> "When a secret is provided, BaseSession will use SignedCookie when
> generating cookies thereby making the session id almost impossible to
> fake. The default is to use plain Cookie (though even if not signed, the
> session id is generated to be very difficult to guess)."
>
> http://www.modpython.org/live/current/doc-html/pyapi-sess-classes.html#l2h-209
>
> > It's a good practise when using
> > https to have your sessionid cookie only sent to the secure site
>
> As far as I know this is not a mod_python capability out of the box.
> You'll need to test if it is an https request in your code and act
> accordingly.
>
> > (should also be in the faq).
>
> Well, maybe but I think this is the first time anyone has asked this
> question, so it doesn't really qualify as frequently asked. ;)
>
> Jim
>
>
From jpg at jgassociates.ca  Tue May 30 09:34:07 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Tue May 30 09:34:00 2006
Subject: [SPAM] [mod_python] [SPAM] Problem installing on Apache
	1.3.34/Win32 - "make_obcallback returned no obCallBack!"
In-Reply-To: <000b01c68256$50475bd0$0301a8c0@lg>
References: <000b01c68256$50475bd0$0301a8c0@lg>
Message-ID: <447C49CF.1040903@jgassociates.ca>

Sanja Bougakov wrote:
> Hello,
> 
> I've attempted to install mod_python on Apache 1.3.34 running on Windows 
> XP Home.
> 
> I've downloaded and installed python-2.4.3.msi (with all default 
> settings), extracted mod_python.dll from python2.2-apache1.3.22.zip to 
> python's installation directory.
> 
> I've added the following to my httpd.conf:
> 
>  LoadModule   python_module "c:/python24/mod_python.dll"
>  AddHandler python-program .py
>  PythonHandler mptest
>  PythonDebug on
>  AddType text/html .py
> 
> Then I've copied python24.dll to python22.dll (leaping ahead: I've also 
> tried installing Python-2.2.3.exe to get 'genuine' 2.2 DLL, but it 
> didn't change anything). Apache starts OK telling:
> 
>  Apache/1.3.34 (Win32) mod_python/2.7.6 Python/2.2.3 PHP/4.4.2 running...
> 
> But when I try opening "Hello World" test file from my browser, I get 
> Error 500 and the following line in VirtualHost's error.log:
> 
>  [Sun May 28 16:17:39 2006] [error] [client 127.0.0.1] python_handler: 
> make_obcallback returned no obCallBack!
> 
> Main error.log contains:
> 
>  'import site' failed; use -v for traceback
>  make_obcallback(): could not import mod_python.apache.
>  make_obcallback(): could not call init.
> 
> How can I fix it and make it work?
> 
> Thanks in advance,
> Sanja

Generally the make_obcallback results when the apache module is not able 
to find the mod_python python modules. Things can get muddled when you 
have several python versions on your system.

Setting the PYTHONHOME environment variable to the correct python may 
help. Make sure the user running apache has the correct permissions to 
access the python modules.

That being said, I really don't think it's a good idea to be copying the 
dlls for different versions around. It may work, but I would not be 
surprised if you ran into problems later.

Jim



From pavel at madman2k.net  Tue May 30 09:48:45 2006
From: pavel at madman2k.net (Pavel Roitberg)
Date: Tue May 30 09:48:48 2006
Subject: [mod_python] Troubles with including local modules
In-Reply-To: <447C427D.8050909@jgassociates.ca>
References: <447B5EE6.1030500@madman2k.net> <447C427D.8050909@jgassociates.ca>
Message-ID: <447C4D3D.6060403@madman2k.net>

Jim Gallacher wrote:
> Pavel Roitberg wrote:
>> Hi,
>>
>> I'm trying to dig into python using mod_python, but I already fail with
>> this easy thing.
>> I can include modules located in /usr/lib without problems, but when I
>> try to include a local module I'm getting the following error:
>>
>> """
>> Mod_python error: "PythonHandler index"
>>
>> Traceback (most recent call last):
>>
>>   File "/usr/lib/python2.4/site-packages/mod_python/apache.py", line
>> 287, in HandlerDispatch
>>     log=debug)
>>
>>   File "/usr/lib/python2.4/site-packages/mod_python/apache.py", line
>> 457, in import_module
>>     module = imp.load_module(mname, f, p, d)
>>
>>   File "/home/pavel/data/webwork/python/index.py", line 3, in ?
>>     from module import article
>>
>> ImportError: cannot import name article
>> """
>>
>> It only works after python generates the according pyc files. (when I
>> import them manually using the interpreter)
>>
>> Apache.import_module() does not work at all; neither error, nor module
>> in local namespace.
>>
>> The environment is:
>> mod_python 3.1.4
>> apache 2.0.55-4ubuntu2
>> python 2.4.2-0ubuntu3
>> Ubuntu 6.06
>>
> 
> It's not clear to my why it works for pyc files, but not py files. 
> Perhaps you could include your mod_python apache configuration 
> (AddHandler, etc), and a code snippet.
> 
> Jim
sure

Apache Config:
<Directory /home/pavel/data/webwork/python>
	Options Indexes FollowSymLinks
	AllowOverride FileInfo
	SetHandler mod_python
	PythonHandler index
	PythonDebug On
	Order allow,deny
	allow from all
</Directory>

index.py:
from mod_python import apache, psp, Cookie
import time, sys
from module import article

bla = dir()

def handler(req):	
	content = req.uri[1:].split("/")+bla
		
	req.content_type = "application/xhtml+xml"
	
	template = psp.PSP(req, 'template/main.xhtml')
	template.run({"title":"News", "user":"Pavel", "content":content, 
"pages":3, "active":1})

	return apache.OK

From jpg at jgassociates.ca  Tue May 30 09:49:19 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Tue May 30 09:49:00 2006
Subject: [mod_python] Secure Sessions
In-Reply-To: <ffa39deb0605300619h6985c149v8c6b559dc58ec7b5@mail.gmail.com>
References: <ffa39deb0605300008v36bd900ag42f3422e0e36ffd9@mail.gmail.com>	<447C3CB9.2040906@jgassociates.ca>
	<ffa39deb0605300619h6985c149v8c6b559dc58ec7b5@mail.gmail.com>
Message-ID: <447C4D5F.3040905@jgassociates.ca>

marinus van aswegen wrote:
> Hi Jim
> 
> It's a good security practise not to permit the client to send a
> sessionid to a non secured (non https) sites, even if it's encrypted.
> I just wanted to do this with mod_python.

I understand the logic of it, but I got the impression that you may have 
thought this was already supported in the Cookie class, which it is not.

We've added a new req.is_https() method in the development branch and 
backported to the 3.2.x branch. This will be included in the 3.2.9 
release which we are hoping to get out in the next couple of weeks.

Jim
From list at joreybump.com  Tue May 30 10:29:32 2006
From: list at joreybump.com (Jorey Bump)
Date: Tue May 30 10:29:44 2006
Subject: [mod_python] Troubles with including local modules
In-Reply-To: <447C4D3D.6060403@madman2k.net>
References: <447B5EE6.1030500@madman2k.net> <447C427D.8050909@jgassociates.ca>
	<447C4D3D.6060403@madman2k.net>
Message-ID: <447C56CC.8020308@joreybump.com>

Pavel Roitberg wrote:
> Jim Gallacher wrote:
>> Pavel Roitberg wrote:
>>>
>>>   File "/home/pavel/data/webwork/python/index.py", line 3, in ?
>>>     from module import article
>>>
>>> ImportError: cannot import name article
>>> """
>>>
>>> It only works after python generates the according pyc files. (when I
>>> import them manually using the interpreter)
>>
>> It's not clear to my why it works for pyc files, but not py files. 
>> Perhaps you could include your mod_python apache configuration 
>> (AddHandler, etc), and a code snippet.
>>
> sure
> 
> Apache Config:
> <Directory /home/pavel/data/webwork/python>
>     Options Indexes FollowSymLinks
>     AllowOverride FileInfo
>     SetHandler mod_python
>     PythonHandler index
>     PythonDebug On
>     Order allow,deny
>     allow from all
> </Directory>

Is it possible that your .py module is readable only by you, but when 
you import it manually it creates a .pyc file that is also readable by 
the web server? What are the permissions on your .py file?


From pavel at madman2k.net  Tue May 30 12:21:28 2006
From: pavel at madman2k.net (Pavel Roitberg)
Date: Tue May 30 12:21:27 2006
Subject: [mod_python] gettext and psp?
Message-ID: <447C7108.3010305@madman2k.net>

is there an easy way to get gettext with psp running?
I am using psp as a template engine with gettext included as 
<%=_("translate me")%> at the according places.
Obviously pygettext is not able to parse the html templates.
Would it work if I manually write the *.po files or is thera an easier way?

Pavel
From ah at hatzis.de  Tue May 30 12:42:13 2006
From: ah at hatzis.de (Anastasios Hatzis (Hatzis Edelstahlbearbeitung))
Date: Tue May 30 12:42:22 2006
Subject: [mod_python] Redirect and/or output regeneration with PSP files
Message-ID: <447C75E5.2060508@hatzis.de>

Dear list members,

I'm still struggling with my PSP files. I like the embedding feature 
very much, but there is one issue I don't know how to solve and couldn't 
find a hint in the manual or web. It's about redirecting and/or 
re-generation of the HTML output depending on object states. I 
recognized that PSP obviously by default sends header/output directly to 
the client.

My first approach: I built a web-layer consisting of PSP-files only. 
They were called from a browser and each of them imported and accessed 
appropriate Python modules of my back-end application. These PSP files 
also included some other PSP files containing HTML snipplets. Structure 
was simplified like this

examplePage.psp:
a) include head.psp
b) do something with the back-end (imported Python modules with 
database-access) and build body
c) include foot.psp

head.psp and foot.psp also contained some condition-dependent output.

When specified conditions are met during processing of the request, it 
is necessary to either redirect to another URL - typical example would 
be a redirect to a sign-on form - or to re-generate partially or totally 
the HTML output. Unfortunatelly this can occur anywhere in a), b) or c), 
where PSP already have been included. I learned that I neither can clear 
and re-generate the already generated HTML output, nor use a 
util.redirect to another (PSP) file. Latter leads to the following error 
message:

IOError: Cannot redirect after headers have already been sent.


My second approach was to use mod_python.publisher instead of psp, where 
methods in py files are called, e.g.
http://www.modpython.org/examplePage.py/view?objectID=5
calling in examplePage.py the method view(req, objectID) which should 
then call an appropriate py-file which is responsible for importing the 
back-end modules and including PSP-files. For latter I used the template 
suggestion as made in the modpython manual:

        template = psp.PSP(self.oReq(), filename='../src/psp/head.psp')

        template.run({'txtPageTitle':'hello world'})


Unfortunatelly this doesn't help since PSP.run() is also directly 
sending header to the browser.

So, I'm ending with the question if there are options or how-tos in 
order to
a) prevent PSP files from sending headers to the browser, so I can later 
in the process do a full re-direct, like util.redirect, if necessary
b) collecting PSP file outputs in objects and deciding myself which to 
send and which not to send, something like:

template = psp.PSP(self.oReq(), filename='../src/psp/head.psp')

htmlHead = template.run({'txtPageTitle':'hello world'})

template = psp.PSP(self.oReq(), filename='../src/psp/ExampleBody.psp')

htmlBody = template.run({'txtPageTitle':'hello world'})

template = psp.PSP(self.oReq(), filename='../src/psp/foot.psp')

htmlFoot = template.run({'txtPageTitle':'hello world'})

if simpleHead:

    htmlHead = '<html><body>'

return htmlHead + htmlBody + htmlFoot


A link to documentation or how-to would be great or any good idea is 
appreciated.

Many thanks again and greetings from southern Germany (snowing here, hurrrr)
Anastasios
From pavel at madman2k.net  Tue May 30 13:41:04 2006
From: pavel at madman2k.net (Pavel Roitberg)
Date: Tue May 30 13:41:03 2006
Subject: [mod_python] Redirect and/or output regeneration with PSP files
In-Reply-To: <447C75E5.2060508@hatzis.de>
References: <447C75E5.2060508@hatzis.de>
Message-ID: <447C83B0.1040702@madman2k.net>

Anastasios Hatzis (Hatzis Edelstahlbearbeitung) wrote:
> Dear list members,
> 
> I'm still struggling with my PSP files. I like the embedding feature 
> very much, but there is one issue I don't know how to solve and couldn't 
> find a hint in the manual or web. It's about redirecting and/or 
> re-generation of the HTML output depending on object states. I 
> recognized that PSP obviously by default sends header/output directly to 
> the client.
> 
> My first approach: I built a web-layer consisting of PSP-files only. 
> They were called from a browser and each of them imported and accessed 
> appropriate Python modules of my back-end application. These PSP files 
> also included some other PSP files containing HTML snipplets. Structure 
> was simplified like this
> 
> examplePage.psp:
> a) include head.psp
> b) do something with the back-end (imported Python modules with 
> database-access) and build body
> c) include foot.psp
you cant do it that way.
headers must be sent before any other output i.e. before you include 
head.psp.
if you want to redirect using psp look at this example:
<%

# note that the '<' above is the first byte of the page!
psp.redirect('http://www.modpython.org')
%>

http://www.modpython.org/live/current/doc-html/pyapi-psp.html

Pavel
From jpg at jgassociates.ca  Tue May 30 14:31:10 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Tue May 30 14:29:37 2006
Subject: [mod_python] Redirect and/or output regeneration with PSP files
In-Reply-To: <447C75E5.2060508@hatzis.de>
References: <447C75E5.2060508@hatzis.de>
Message-ID: <447C8F6E.8010605@jgassociates.ca>

Anastasios Hatzis (Hatzis Edelstahlbearbeitung) wrote:
> Dear list members,
> 
> I'm still struggling with my PSP files. I like the embedding feature 
> very much, but there is one issue I don't know how to solve and couldn't 
> find a hint in the manual or web. It's about redirecting and/or 
> re-generation of the HTML output depending on object states. I 
> recognized that PSP obviously by default sends header/output directly to 
> the client.
> 
> My first approach: I built a web-layer consisting of PSP-files only. 
> They were called from a browser and each of them imported and accessed 
> appropriate Python modules of my back-end application. These PSP files 
> also included some other PSP files containing HTML snipplets. Structure 
> was simplified like this
> 
> examplePage.psp:
> a) include head.psp
> b) do something with the back-end (imported Python modules with 
> database-access) and build body
> c) include foot.psp
> 
> head.psp and foot.psp also contained some condition-dependent output.
> 
> When specified conditions are met during processing of the request, it 
> is necessary to either redirect to another URL - typical example would 
> be a redirect to a sign-on form - or to re-generate partially or totally 
> the HTML output. Unfortunatelly this can occur anywhere in a), b) or c), 
> where PSP already have been included. I learned that I neither can clear 
> and re-generate the already generated HTML output, nor use a 
> util.redirect to another (PSP) file. Latter leads to the following error 
> message:
> 
> IOError: Cannot redirect after headers have already been sent.
> 
> 
> My second approach was to use mod_python.publisher instead of psp, where 
> methods in py files are called, e.g.
> http://www.modpython.org/examplePage.py/view?objectID=5
> calling in examplePage.py the method view(req, objectID) which should 
> then call an appropriate py-file which is responsible for importing the 
> back-end modules and including PSP-files. For latter I used the template 
> suggestion as made in the modpython manual:
> 
>        template = psp.PSP(self.oReq(), filename='../src/psp/head.psp')
> 
>        template.run({'txtPageTitle':'hello world'})
> 
> 
> Unfortunatelly this doesn't help since PSP.run() is also directly 
> sending header to the browser.
> 
> So, I'm ending with the question if there are options or how-tos in 
> order to
> a) prevent PSP files from sending headers to the browser, so I can later 
> in the process do a full re-direct, like util.redirect, if necessary
> b) collecting PSP file outputs in objects and deciding myself which to 
> send and which not to send, something like:
> 
> template = psp.PSP(self.oReq(), filename='../src/psp/head.psp')
> 
> htmlHead = template.run({'txtPageTitle':'hello world'})
> 
> template = psp.PSP(self.oReq(), filename='../src/psp/ExampleBody.psp')
> 
> htmlBody = template.run({'txtPageTitle':'hello world'})
> 
> template = psp.PSP(self.oReq(), filename='../src/psp/foot.psp')
> 
> htmlFoot = template.run({'txtPageTitle':'hello world'})
> 
> if simpleHead:
> 
>    htmlHead = '<html><body>'
> 
> return htmlHead + htmlBody + htmlFoot
> 
> 
> A link to documentation or how-to would be great or any good idea is 
> appreciated.

No link, but perhaps a clarification. It's not really template.run() 
that is sending the headers.

Generating output with psp is a 2 step process.

1. Parse the psp template and generate python code. Any text outside the 
"<% %>" tag is wrapped in a req.write() call. Anything inside the tag is 
  treated as python code. Stuff inside "<%= %>" is treated as a python 
statement and wrapped by a req.write() call. All this happens in the 
psp.PSP() constructor.

2. Execute the code generated in step 1, with the vars copied into the 
global scope. This happens when run() is called. PSP does not concern 
itself with the response headers.

Ultimately it is the first call to req.write() that causes the headers 
to be flushed. You could still do a redirect in a psp template, but you 
need to make sure this happens *before* any output such as straight html 
or python code. This will not be a very robust solution however, since a 
single unwanted space or other character at the beginning of the 
template file will trigger a req.write() call.

You may find the following pattern more useful. Use publisher or some 
other handler to organize your back-end and page logic. Use a master 
template and pass sub-templates to the master in vars.

mptest.py
---------
def index(req):
     vars = {}
     if some_condition:
         vars['body'] = psp.PSP(req, filename='hi.tmpl')
     else:
         vars['body'] = psp.PSP(req, filename='bye.tmpl')

     master_tmpl = psp.PSP(req, filename='master.tmpl', vars=vars)
     return master_tmpl


master.tmpl
-----------
<html>
<body>
<%= body %>
</body>
</html>

hi.tmpl
---------
<p>Hello world</p>

bye.tmpl
--------
<p>Goodbye world</p>


When <%= body %> is encountered it's __str__ method is called. For a PSP 
instance this causes body.run() to be called. If you need access to vars 
in the sub-templates you'll need to pass vars to each in their constructors.

> Many thanks again and greetings from southern Germany (snowing here, 
> hurrrr)

Now *that* is just crazy. (The snow part, not the fact that you are from 
Southern Germany. ;) )

Jim
From ah at hatzis.de  Tue May 30 16:40:17 2006
From: ah at hatzis.de (Anastasios Hatzis (Hatzis Edelstahlbearbeitung))
Date: Tue May 30 16:40:25 2006
Subject: [mod_python] Redirect and/or output regeneration with PSP files
In-Reply-To: <447C8F6E.8010605@jgassociates.ca>
References: <447C75E5.2060508@hatzis.de> <447C8F6E.8010605@jgassociates.ca>
Message-ID: <447CADB1.70104@hatzis.de>

Jim Gallacher wrote:
> mptest.py
> ---------
> def index(req):
>     vars = {}
>     if some_condition:
>         vars['body'] = psp.PSP(req, filename='hi.tmpl')
>     else:
>         vars['body'] = psp.PSP(req, filename='bye.tmpl')
>
>     master_tmpl = psp.PSP(req, filename='master.tmpl', vars=vars)
>     return master_tmpl
>
>
> master.tmpl
> -----------
> <html>
> <body>
> <%= body %>
> </body>
> </html>
>
> hi.tmpl
> ---------
> <p>Hello world</p>
>
> bye.tmpl
> --------
> <p>Goodbye world</p>
>
>
> When <%= body %> is encountered it's __str__ method is called. For a 
> PSP instance this causes body.run() to be called. If you need access 
> to vars in the sub-templates you'll need to pass vars to each in their 
> constructors.
>
Yes, this pattern seems to work fine for me. I adopted it for my 
environment and it's wonderful. Meets both requirements and I still take 
benefit from the PSP-features. Thank you also for clarifying the PSP 
behaviour.

>> Many thanks again and greetings from southern Germany (snowing here, 
>> hurrrr)
> Now *that* is just crazy. (The snow part, not the fact that you are 
> from Southern Germany. ;) )
It's a nightmare! Over last night all of my mom's flowers have been 
assassinated perfidously. My old tomcat Herr Hugo impends to change back 
again to winter pelt. I want it to stop. I already shot dozens of 
lovely-boring winter landscape photos since I moved into this region. 
It's enough. Whoever guilty: Give us back the spring!

Anastasios
...waiting for the real summer.
From sergey at optimaltec.com  Tue May 30 22:33:35 2006
From: sergey at optimaltec.com (Sergey A. Lipnevich)
Date: Tue May 30 22:33:57 2006
Subject: [mod_python] Tiny patch for better apr_stat usage in sendfile
Message-ID: <e5iv9v$4rg$1@sea.gmane.org>

Hi All,

I'd like to offer the following patch for 3.2.8's sendfile function that
asks APR to provide less information about a file (which is beneficial
on Windows as APR doesn't have to construct POSIX protection flags),
because the only field in use becomes file size. Incidentally, it also
allows mod_python (plus Apache 2.2 patch) to work with the following
tweak for APR 1.2.7 (required for Subversion), under Windows and Apache
2.2.2: http://article.gmane.org/gmane.comp.apache.apr.devel/9389/.

I didn't test the patch on anything but Windows XP. The error I was
getting with the setup above was "Could not stat file for reading."
I also have to mention that the whole thing was compiled with VS 2005
compiler to support Python 2.4, although I think it's not relevant for
the patch attached.

I hope all this patch citing is not too confusing :-).
Thank you!

Sergey.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: apr_stat.diff
Type: text/x-patch
Size: 805 bytes
Desc: not available
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060530/ce60b216/apr_stat.bin
From slinger at cs.uu.nl  Wed May 31 03:06:52 2006
From: slinger at cs.uu.nl (drs. Slinger Jansen)
Date: Wed May 31 03:06:55 2006
Subject: [mod_python] Must restart apache for recompile?
Message-ID: <447D408C.20701@cs.uu.nl>

*newbie* Hi there,

I have recently installed mod_python and I'm trying to fight through the 
steep learning curve of SOAP interfaces.

Got my first sample program running now, but I need to restart Apache 
each time I wish to recompile my apps. I cannot believe that that's the 
way to go. Currently I have three .py files, a "MyHandler.py", a 
"client.py" and a "server.py". client.py calls the server, which imports 
myhandler. MyHandler and server are never recompiled when accessed from 
client.py. Client.py of course is recompiled each time I run it (using 
python client.py).

I'm confused, shouldn't server.py (and in turn MyHandler.py) be 
recompiled each time I access them from client.py? I need this for 
development.

Slinger Jansen



-- 
Slinger Remy Lokien Jansen

*email :* slinger@cs.uu.nl <mailto:slinger@cs.uu.nl>
*office :* CGN-B228
*telephone :* +31 (30) 253 6652
*faxnumber :* +31 (30) 251 3791

*Universiteit Utrecht*
Institute of Information and Computing Sciences
Centrumgebouw Noord, office B228
Padualaan 14, De Uithof
3584CH Utrecht

*scientific website : *http://www.cs.uu.nl/people/slinger/ 
<http://www.cs.uu.nl/people/slinger>
*personal website : *www.slingerjansen.nl <http://www.slingerjansen.nl>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060531/df2e8fa5/attachment.html
From nlv11281 at natlab.research.philips.com  Wed May 31 03:32:48 2006
From: nlv11281 at natlab.research.philips.com (Mike Looijmans)
Date: Wed May 31 03:33:13 2006
Subject: [mod_python] Must restart apache for recompile?
In-Reply-To: <447D408C.20701@cs.uu.nl>
References: <447D408C.20701@cs.uu.nl>
Message-ID: <447D46A0.4070600@natlab.research.philips.com>

It may not be the prettiest, but a restart is surely the most stable way to do this. It's only a 
sighup on most systems anyway.

In a previous project, I had a "secret" reload page, that tried to flush out all my modules from the 
sys.modules list, by calling reload() for each one, something like:

for modul in sys.modules:
   if "/myapp/" in modul.__file__:
     reload(modul)

I don't recall the exact semantics (the code above probably won't really work).

As an alternative, grab the latest mod_python and give Graham's new module loader a workout. That 
ought to fix it properly.

Mike Looijmans
Philips Natlab / Topic Automation


drs. Slinger Jansen wrote:
> *newbie* Hi there,
> 
> I have recently installed mod_python and I'm trying to fight through the 
> steep learning curve of SOAP interfaces.
> 
> Got my first sample program running now, but I need to restart Apache 
> each time I wish to recompile my apps. I cannot believe that that's the 
> way to go. Currently I have three .py files, a "MyHandler.py", a 
> "client.py" and a "server.py". client.py calls the server, which imports 
> myhandler. MyHandler and server are never recompiled when accessed from 
> client.py. Client.py of course is recompiled each time I run it (using 
> python client.py).
> 
> I'm confused, shouldn't server.py (and in turn MyHandler.py) be 
> recompiled each time I access them from client.py? I need this for 
> development.
> 
> Slinger Jansen
> 
> 
> 
> -- 
> Slinger Remy Lokien Jansen
> 
> *email :* slinger@cs.uu.nl <mailto:slinger@cs.uu.nl>
> *office :* CGN-B228
> *telephone :* +31 (30) 253 6652
> *faxnumber :* +31 (30) 251 3791
> 
> *Universiteit Utrecht*
> Institute of Information and Computing Sciences
> Centrumgebouw Noord, office B228
> Padualaan 14, De Uithof
> 3584CH Utrecht
> 
> *scientific website : *http://www.cs.uu.nl/people/slinger/ 
> <http://www.cs.uu.nl/people/slinger>
> *personal website : *www.slingerjansen.nl <http://www.slingerjansen.nl>
> 
> 
> ------------------------------------------------------------------------
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From jpg at jgassociates.ca  Wed May 31 07:29:28 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Wed May 31 07:29:45 2006
Subject: [mod_python] Must restart apache for recompile?
In-Reply-To: <447D46A0.4070600@natlab.research.philips.com>
References: <447D408C.20701@cs.uu.nl>
	<447D46A0.4070600@natlab.research.philips.com>
Message-ID: <447D7E18.2060905@jgassociates.ca>

Mike Looijmans wrote:
> It may not be the prettiest, but a restart is surely the most stable way 
> to do this. It's only a sighup on most systems anyway.
> 
> In a previous project, I had a "secret" reload page, that tried to flush 
> out all my modules from the sys.modules list, by calling reload() for 
> each one, something like:
> 
> for modul in sys.modules:
>   if "/myapp/" in modul.__file__:
>     reload(modul)
> 
> I don't recall the exact semantics (the code above probably won't really 
> work).
> 
> As an alternative, grab the latest mod_python and give Graham's new 
> module loader a workout. That ought to fix it properly.

Just a small clarification. The new importer is in the subversion trunk 
repository, but not in the released 3.2.x stable branch.

Jim
From deron.meranda at gmail.com  Wed May 31 11:28:31 2006
From: deron.meranda at gmail.com (Deron Meranda)
Date: Wed May 31 11:28:38 2006
Subject: [mod_python] Sending back headers with 4xx responses
Message-ID: <5c06fa770605310828h2bcbc00btd8e3425187acdef5@mail.gmail.com>

I don't know if this is mod_python or perhaps just an Apache
limitation, but is it possible to send back specific HTTP
headers for any 4xx response codes?

In particular, I'm trying to send a 416 "Requested Range Not
Satisfiable", as well as a Content-Ranges header, but the
header is never sent back to the user agent.  As per the
RFC 2616 spec section 14.16:

   "A server sending a response with status code 416
    (Requested range not satisfiable) SHOULD include a
    Content-Range field with a byte-range-resp-spec of "*".
    The instance-length specifies the current length of the
    selected resource."

Granted, it's a SHOULD rather than a MUST, but is it
even possible with Apache/mod_python?  BTW, sending
headers works fine for any 2xx or 3xx reponses.

Here's a minimal handler which demonstrates this.

from mod_python import apache
def handler(req):
    req.headers_out['Content-Range'] = "*/10000"
    return apache.HTTP_RANGE_NOT_SATISFIABLE

Any ideas?
-- 
Deron Meranda
From nferrier at tapsellferrier.co.uk  Wed May 31 11:41:32 2006
From: nferrier at tapsellferrier.co.uk (Nic James Ferrier)
Date: Wed May 31 11:47:50 2006
Subject: [mod_python] Sending back headers with 4xx responses
In-Reply-To: <5c06fa770605310828h2bcbc00btd8e3425187acdef5@mail.gmail.com>
	(Deron Meranda's message of "Wed, 31 May 2006 11:28:31 -0400")
References: <5c06fa770605310828h2bcbc00btd8e3425187acdef5@mail.gmail.com>
Message-ID: <87wtc2urpv.fsf@nicferrier.tapsellferrier.co.uk>

"Deron Meranda" <deron.meranda@gmail.com> writes:

> I don't know if this is mod_python or perhaps just an Apache
> limitation, but is it possible to send back specific HTTP
> headers for any 4xx response codes?
>
> In particular, I'm trying to send a 416 "Requested Range Not
> Satisfiable", as well as a Content-Ranges header, but the
> header is never sent back to the user agent.  As per the
> RFC 2616 spec section 14.16:
>
>    "A server sending a response with status code 416
>     (Requested range not satisfiable) SHOULD include a
>     Content-Range field with a byte-range-resp-spec of "*".
>     The instance-length specifies the current length of the
>     selected resource."
>
> Granted, it's a SHOULD rather than a MUST, but is it
> even possible with Apache/mod_python?  BTW, sending
> headers works fine for any 2xx or 3xx reponses.
>
> Here's a minimal handler which demonstrates this.
>
> from mod_python import apache
> def handler(req):
>     req.headers_out['Content-Range'] = "*/10000"
>     return apache.HTTP_RANGE_NOT_SATISFIABLE

You have to raise these.

For example:

    if status >= 200 and status < 300:
        return apache.OK
    else:
        raise apache.SERVER_RETURN, status


-- 
Nic Ferrier
http://www.tapsellferrier.co.uk   for all your tapsell ferrier needs
From list at joreybump.com  Wed May 31 12:16:13 2006
From: list at joreybump.com (Jorey Bump)
Date: Wed May 31 12:16:24 2006
Subject: [mod_python] Sending back headers with 4xx responses
In-Reply-To: <5c06fa770605310828h2bcbc00btd8e3425187acdef5@mail.gmail.com>
References: <5c06fa770605310828h2bcbc00btd8e3425187acdef5@mail.gmail.com>
Message-ID: <447DC14D.3080702@joreybump.com>

Deron Meranda wrote:
> I don't know if this is mod_python or perhaps just an Apache
> limitation, but is it possible to send back specific HTTP
> headers for any 4xx response codes?
> 
> In particular, I'm trying to send a 416 "Requested Range Not
> Satisfiable", as well as a Content-Ranges header, but the
> header is never sent back to the user agent.  As per the
> RFC 2616 spec section 14.16:
> 
>   "A server sending a response with status code 416
>    (Requested range not satisfiable) SHOULD include a
>    Content-Range field with a byte-range-resp-spec of "*".
>    The instance-length specifies the current length of the
>    selected resource."
> 
> Granted, it's a SHOULD rather than a MUST, but is it
> even possible with Apache/mod_python?  BTW, sending
> headers works fine for any 2xx or 3xx reponses.
> 
> Here's a minimal handler which demonstrates this.
> 
> from mod_python import apache
> def handler(req):
>    req.headers_out['Content-Range'] = "*/10000"
>    return apache.HTTP_RANGE_NOT_SATISFIABLE
> 
> Any ideas?

Here is what I do for HTTP_SEE_OTHER (303) redirects, which appears 
similar to what you are trying to do (except I'm using Publisher):

def redirect(req, auth_url):
     """
     Redirect to the authentication page. Use HTTP_SEE_OTHER to coax
     the browser into discarding any form data and requesting the
     page with a GET.

     Arguments:

     req: mod_python apache request object
     auth_url: redirection url

     """
     status = apache.HTTP_SEE_OTHER
     req.headers_out['Location'] = auth_url
     req.status = status
     raise apache.SERVER_RETURN, status

There's a little redundancy to support future modifications I haven't 
implemented yet. Ignore this. It works, and should provide a suitable 
basis. I haven't tested it with 4xx errors, though.

From deron.meranda at gmail.com  Wed May 31 12:45:45 2006
From: deron.meranda at gmail.com (Deron Meranda)
Date: Wed May 31 12:45:49 2006
Subject: [mod_python] Sending back headers with 4xx responses
In-Reply-To: <87wtc2urpv.fsf@nicferrier.tapsellferrier.co.uk>
References: <5c06fa770605310828h2bcbc00btd8e3425187acdef5@mail.gmail.com>
	<87wtc2urpv.fsf@nicferrier.tapsellferrier.co.uk>
Message-ID: <5c06fa770605310945v2a47eb3ds8a8d2feae0828072@mail.gmail.com>

> You have to raise these.
>
> For example:
>
>     if status >= 200 and status < 300:
>         return apache.OK
>     else:
>         raise apache.SERVER_RETURN, status

No, that's not it.  Either way the response code is sent back,
but not the headers.  It definitely appears to be a problem only
for 1xx, 4xx and 5xx codes.  For any 2xx or 3xx codes,
headers go through as expected.

At least for the 4/5xx codes, perhaps the problem is the way
Apache really does an internal redirect to the appropriate
error page?  Is there any way to pass information or headers
on to those?

Whatever the reason, I seem unable to send back a Content-Range
header for a 416 as recommended by the RFC.
-- 
Deron Meranda
From deron.meranda at gmail.com  Wed May 31 13:05:03 2006
From: deron.meranda at gmail.com (Deron Meranda)
Date: Wed May 31 13:05:07 2006
Subject: [mod_python] Sending back headers with 4xx responses
In-Reply-To: <5c06fa770605310945v2a47eb3ds8a8d2feae0828072@mail.gmail.com>
References: <5c06fa770605310828h2bcbc00btd8e3425187acdef5@mail.gmail.com>
	<87wtc2urpv.fsf@nicferrier.tapsellferrier.co.uk>
	<5c06fa770605310945v2a47eb3ds8a8d2feae0828072@mail.gmail.com>
Message-ID: <5c06fa770605311005r7b6deb7bx17f8940293114f03@mail.gmail.com>

On 5/31/06, Deron Meranda <deron.meranda@gmail.com> wrote:
> At least for the 4/5xx codes, perhaps the problem is the way
> Apache really does an internal redirect to the appropriate
> error page?  Is there any way to pass information or headers
> on to those?

As an experiment, I have noticed that I can write an nph-* CGI
script (non-parsed headers) that can output any headers I want
with any response code I want.  But this is not possible with a
normal (non-nph) CGI.

So, is there a way in mod_python to do something similar to an
NPH CGI?  (To keep Apache from post-processing the response).
-- 
Deron Meranda
From nferrier at tapsellferrier.co.uk  Wed May 31 13:59:06 2006
From: nferrier at tapsellferrier.co.uk (Nic James Ferrier)
Date: Wed May 31 14:07:50 2006
Subject: [mod_python] Sending back headers with 4xx responses
In-Reply-To: <5c06fa770605310945v2a47eb3ds8a8d2feae0828072@mail.gmail.com>
	(Deron Meranda's message of "Wed, 31 May 2006 12:45:45 -0400")
References: <5c06fa770605310828h2bcbc00btd8e3425187acdef5@mail.gmail.com>
	<87wtc2urpv.fsf@nicferrier.tapsellferrier.co.uk>
	<5c06fa770605310945v2a47eb3ds8a8d2feae0828072@mail.gmail.com>
Message-ID: <87odxeulcl.fsf@nicferrier.tapsellferrier.co.uk>

"Deron Meranda" <deron.meranda@gmail.com> writes:

>> You have to raise these.
>>
>> For example:
>>
>>     if status >= 200 and status < 300:
>>         return apache.OK
>>     else:
>>         raise apache.SERVER_RETURN, status
>
> No, that's not it.  Either way the response code is sent back,
> but not the headers.  It definitely appears to be a problem only
> for 1xx, 4xx and 5xx codes.  For any 2xx or 3xx codes,
> headers go through as expected.
>
> At least for the 4/5xx codes, perhaps the problem is the way
> Apache really does an internal redirect to the appropriate
> error page?  Is there any way to pass information or headers
> on to those?
>
> Whatever the reason, I seem unable to send back a Content-Range
> header for a 416 as recommended by the RFC.

Sorry - I ommitted to mention that the headers have to go into:

   http_request_object.err_headers_out

So, something like:

  http_request_object.err_headers_out["Content-Range"] = 10
  raise apache.SERVER_RETURN, 416

should work.

-- 
Nic Ferrier
http://www.tapsellferrier.co.uk   for all your tapsell ferrier needs
From deron.meranda at gmail.com  Wed May 31 14:13:22 2006
From: deron.meranda at gmail.com (Deron Meranda)
Date: Wed May 31 14:13:26 2006
Subject: [mod_python] Sending back headers with 4xx responses
In-Reply-To: <87odxeulcl.fsf@nicferrier.tapsellferrier.co.uk>
References: <5c06fa770605310828h2bcbc00btd8e3425187acdef5@mail.gmail.com>
	<87wtc2urpv.fsf@nicferrier.tapsellferrier.co.uk>
	<5c06fa770605310945v2a47eb3ds8a8d2feae0828072@mail.gmail.com>
	<87odxeulcl.fsf@nicferrier.tapsellferrier.co.uk>
Message-ID: <5c06fa770605311113n6a63b950qcc56d58f02fbeb00@mail.gmail.com>

On 5/31/06, Nic James Ferrier <nferrier@tapsellferrier.co.uk> wrote:
> Sorry - I ommitted to mention that the headers have to go into:
>
>    http_request_object.err_headers_out
>
> So, something like:
>
>   http_request_object.err_headers_out["Content-Range"] = 10
>   raise apache.SERVER_RETURN, 416
>
> should work.


Yes!  That works.  Somehow I just missed the err_headers_out
member completely.

Thanks Nic
-- 
Deron Meranda
