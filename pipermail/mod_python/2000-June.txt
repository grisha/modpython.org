From a.d.stribblehill at durham.ac.uk  Thu Jun  1 11:59:27 2000
From: a.d.stribblehill at durham.ac.uk (Andrew Stribblehill)
Date: Fri Jan  9 21:45:54 2004
Subject: [mod_python] Apache segfaults on startup
Message-ID: <20000601115927.B24781@womble.dur.ac.uk>

I compiled mod_python as a DSO. It compiled OK, and so I installed
it into libexec and put the appropriate magic into httpd.conf.
Subsequently, running apache causes it to seg. I noticed the FAQ
answer so I put made sure the module was loaded first, but it
still segs. How can I track down this problem?

OS: Solaris 8
Compiler: GCC 2.8.1
Python : 1.5.2
Apache: 1.3.9

Thanks,

Andrew Stribblehill
Systems Programmer, IT Service, University of Durham, England

From hildmann at prz.tu-berlin.de  Thu Jun  1 19:21:07 2000
From: hildmann at prz.tu-berlin.de (Thomas Hildmann)
Date: Fri Jan  9 21:45:54 2004
Subject: [mod_python] How to run each .py instead of showing it
Message-ID: <39369B83.5259DA64@prz.tu-berlin.de>

Hello!

This is more an apache configuration question than a mod_python one. 

Is it possible to configure the apache this way that every .py file is
interpreted to be processed by the mod_python?


Greetings....

hildi

From Mads at Kiilerich.com  Fri Jun  2 04:01:14 2000
From: Mads at Kiilerich.com (Mads Kiilerich)
Date: Fri Jan  9 21:45:54 2004
Subject: [mod_python] AttributeError: handler
Message-ID: <Pine.LNX.4.21.0006020345280.18671-200000@localhost>

Hello,

I'm testing mod_python on a almost vanilla Red Hat 6.2 with the
relevant stuff coming directly from the RPM packages:

[mk@otto mk]$ rpm -q apache python
apache-1.3.12-2
python-1.5.2-13
[mk@otto mk]$ 

mod_python have been installed as DSO according to the
instructions (IMHO, but MyMMV). When apache starts I get

[Fri Jun  2 03:47:15 2000] [notice] Apache/1.3.12 (Unix)  (Red Hat/Linux) PHP/3.0.15 mod_python/2.1 Python/1.5.2 configured -- resuming normal operations

But accessing the test.py page I get the attached error-message.

Any hints to how to solve that problem?

TIA,

-- 
Mads Kiilerich          Sys.Adm. Cand.Polyt
Mads@Kiilerich.com      Tel. +45 38 16 26 00  Mob. +45 26 20 07 73
M?ntmestervej 12B 1th,  DK-2400 NV,  Denmark

"Learned about WAP. It sucks. The more I play with WML the more sure 
I am that WAP will die out rapidly once phones doing HTML exist."
							Alan Cox
-------------- next part --------------

ERROR mod_python: "PythonHandler test"

Traceback (innermost last):

  File "/usr/lib/python1.5/site-packages/mod_python/apache.py", line 87, in Dispatch
    object = self.resolve_object(module, object_str)

  File "/usr/lib/python1.5/site-packages/mod_python/apache.py", line 42, in resolve_object
    obj = getattr(obj, obj_str)

AttributeError: handler

From grisha at ispol.com  Fri Jun  2 07:29:22 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:54 2004
Subject: [mod_python] AttributeError: handler
In-Reply-To: <Pine.LNX.4.21.0006020345280.18671-200000@localhost>
Message-ID: <Pine.LNX.4.21.0006020728250.7977-100000@saturn.ispol.com>

The message means that module test did not have a function called
"handler".

Grisha

On Fri, 2 Jun 2000, Mads Kiilerich wrote:

> Hello,
> 
> I'm testing mod_python on a almost vanilla Red Hat 6.2 with the
> relevant stuff coming directly from the RPM packages:
> 
> [mk@otto mk]$ rpm -q apache python
> apache-1.3.12-2
> python-1.5.2-13
> [mk@otto mk]$ 
> 
> mod_python have been installed as DSO according to the
> instructions (IMHO, but MyMMV). When apache starts I get
> 
> [Fri Jun  2 03:47:15 2000] [notice] Apache/1.3.12 (Unix)  (Red Hat/Linux) PHP/3.0.15 mod_python/2.1 Python/1.5.2 configured -- resuming normal operations
> 
> But accessing the test.py page I get the attached error-message.
> 
> Any hints to how to solve that problem?
> 
> TIA,
> 
> -- 
> Mads Kiilerich          Sys.Adm. Cand.Polyt
> Mads@Kiilerich.com      Tel. +45 38 16 26 00  Mob. +45 26 20 07 73
> M?ntmestervej 12B 1th,  DK-2400 NV,  Denmark
> 
> "Learned about WAP. It sucks. The more I play with WML the more sure 
> I am that WAP will die out rapidly once phones doing HTML exist."
> 							Alan Cox
> 


From grisha at ispol.com  Fri Jun  2 12:25:35 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:54 2004
Subject: [mod_python] test
Message-ID: <Pine.LNX.4.21.0006021225150.8928-100000@saturn.ispol.com>

please ignore


From haering at informatik.tu-muenchen.de  Sun Jun  4 04:34:32 2000
From: haering at informatik.tu-muenchen.de (Gerhard Haering)
Date: Fri Jan  9 21:45:54 2004
Subject: [mod_python] ANNOUNCE: mod_python 2.1 RPMs for SuSE 6.4
Message-ID: <20000604043417.A14514@in.tum.de>

this and the files at: http://jarre.pair.com/insadmin/gerhard/

----------------------------
mod_python RPMs for SuSE 6.4
----------------------------


What is it?

Source and binary packages of mod_python 2.1 and a mod_python-ready Apache
in RPM format. All for SuSE Linux version 6.4.


The history of it

I am by no means a mod_python expert. In fact I have not even programmed
anything with it until now. I am, however, very interested in mod_python
because I use Python for CGI-scripting exclusively. When I recently heard
of mod_python, I tried to make it run on my Apache server, but it was not
especially easy to get it going. Finally I succeeded but it was a product
of trial and error. A few days later I didn't want to do any 'real'
programming, so I thought it would be nice to finally learn how to build
RPMs and why not package mod_python ...


What's in for you

If you have a SuSE 6.4 system and want to try out mod_python without
messing around too much recompiling Apache or Apache modules, these RPMs
might be for you. To be honest, I don't know how well they will work, at
least they work for me, that is: after installing the RPMs
http://localhost/test/test.py displays "Hello from mod_python." on my
machine. Most probably, the RPMs will need some tweaking and be rebuilt
for older SuSE versions. They will definitely not work for any other
distributions, but the SPEC file and my patches for the Apache startup
script, httpd/httpd.conf, the Makefile for mod_python, etc. might give you
a start if you want to build packages for your favorite distribution.


Quickstart

On a SuSE 6.4 system, remove the old Apache RPM and install my modified
Apache 1.3.12 RPM. Then install the mod_python RPM. Then restart Apache
and point your browser to http://localhost/test/test.py. The text "Hello
from mod_python." should be displayed. If you want to know what's going on
behind the scenes:

     - patched the SuSE startup script /sbin/init.d/apache to work with and 
       without mod_python
     - patched /etc/httpd/httpd.conf to use a mod_python 
       handler at /usr/local/httpd/htdocs/test/test.py
     - install mod_python documentation at /usr/doc/packages/mod_python

Have a lot of fun!


Feedback

I cannot promise to remove any bugs in the RPMs, but if any feedback is
coming, I will try. If I have some time to waste, I will try to improve
the RPMs and make some for SuSE 6.3. Please contact me at haering@in.tum.de.

From richard at whitequeen.com  Sat Jun  3 20:43:13 2000
From: richard at whitequeen.com (richard offer)
Date: Fri Jan  9 21:45:54 2004
Subject: [mod_python] Returning multiple content types ?
Message-ID: <200006040343.e543hD329628@erij.whitequeen.com>

Hi,


<Newbie>

How do I write a handler that can return multitple pieces of content ? 


I've got a handler that can read an image out of the photgraphic database
I'm working on, but I need to be able to generate the rest of the page
around the image ?


Should I be using the cgihandler ? This is virgin code so I'm, not
porting an exising implementation, so it seemed to me that I would be
better off using the basic handler, is this true ?


Is there an easy way to parse the QUERY_STRING into a dict ?


Should I be using a different architecture ? I was working on having
everything in one handler, does this make sence?

</Newbie>


thanks, this is so cool :-)


richard.


-----------------------------------------------------------------------
richard offer @ home 
_______________________________http://www.whitequeen.com/users/richard/


From grisha at ispol.com  Sun Jun  4 15:00:44 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:54 2004
Subject: [mod_python] 2.2 is out
Message-ID: <Pine.LNX.4.21.0006041452530.28185-100000@saturn.ispol.com>

Mod_python 2.2 is out. This one fixes the occasional trashing of
content-type that some people have reported. This bug manifested itself
more for people who use Python 1.6. Thanks to Dave Wallace for pointing it
out.

There is also a Win32 DLL of 2.1 available for download, and 2.2 hopefully
as soon as Stephane Bidoul gets around to compiling it. 

Also thanks to Gerhard Haering for the Suse RPM's. It'd be nice if someone
came up and agreed to maintain with RedHat RPM, Debian package, a FreeBSD
port and a Solaris package...

Have a good day,

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com






From grisha at ispol.com  Sun Jun  4 15:08:38 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:54 2004
Subject: [mod_python] Returning multiple content types ?
In-Reply-To: <200006040343.e543hD329628@erij.whitequeen.com>
Message-ID: <Pine.LNX.4.21.0006041503350.28185-100000@saturn.ispol.com>

On Sat, 3 Jun 2000, richard offer wrote:

> How do I write a handler that can return multitple pieces of content ? 

For as long as you have a way to tell the handler which content to return
(typically done via URL) and the handler has the logic to understand it,
this shouldn't be too hard. All of the handlers included with mod_python
return multiple pieces of content.

> Should I be using the cgihandler ? This is virgin code so I'm, not
> porting an exising implementation, so it seemed to me that I would be
> better off using the basic handler, is this true ?

If it's virgin code and you have no intentions of using CGI in the future
there is no reason for you to mess with the cgihandler, you're right.

> Is there an easy way to parse the QUERY_STRING into a dict ?

Look at the standard Python library module cgi.py.

> Should I be using a different architecture ? I was working on having
> everything in one handler, does this make sence?

This is something only you, as developer,  can determine.

Grisha


From SBID at BXS.BE  Mon Jun  5 12:01:12 2000
From: SBID at BXS.BE (=?iso-8859-1?Q?St=E9phane_BIDOUL?=)
Date: Fri Jan  9 21:45:54 2004
Subject: [mod_python] Problems under windows
Message-ID: <C16998C688CDD31196D90008C7E690CB17233F@EVRSRV04>

Hi,

mod_python seems to crash sometimes under
windows (Windows 2000, Python 1.5.2, Apache 1.3.11, mod_python 2.2).

I can trigger the problem by keeping the "refresh" key pressed in the
browser. I use the most trivial test script:

	print "content-type: text/plain"
	print
	print "Hello from mod_python"

and the following httpd.conf

	LoadModule python_module modules/mod_python.dll
	AddHandler python-program .py
	PythonHandler mod_python.cgihandler
	PythonDebug

The problem seems to be thread-related because I sometimes
get the following message:

	Fatal Python error: ceval: orphan tstate

Sometimes it's simply an access violation.

It seems to occur somewhere inside the PyObject_CallMethod call 
in python_handler().

I'm not intimate with python or apache threading, so maybe someone 
can examine the problem further... Or maybe it's simply my windows build of 
mod_python which is wrong somehow...

Any idea?

-Stephane
sbi@acse.be

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20000605/07b9a484/attachment.htm
From seant at alum.mit.edu  Mon Jun  5 07:21:48 2000
From: seant at alum.mit.edu (Sean True)
Date: Fri Jan  9 21:45:54 2004
Subject: [mod_python] Leaking and cgi-handler
In-Reply-To: <C16998C688CDD31196D90008C7E690CB17233F@EVRSRV04>
Message-ID: <4.3.2.20000605071041.00b91280@pop.ne.mediaone.net>

Like too many people, I'm working on a version of python server pages -- 
.phtml pages which contain
mixed python and HTML code, allowing on the fly construction of pages from 
files which can mostly be
edited with a WYSIWYG HTML editor. I have a phtml.py program which is 
invoked as a cgi script, and more
recently under cgi-handler.

The documentation for cgi-handler notes that it may be subject to a memory 
leak related to os.environ().

On a Linux Redhat 6.1 system with Apache and statically linked mod_python, 
I'm seeing memory usage growing
by about 10K or so per page served (measured by watching the system monitor 
reports grow). Performance also
drops -- from about 15 pages served per second to less than 8 pages per second.

All of this makes me think that some data structure in the interpreter or 
mod_python is growing without bound,
in combination with a linear search from the front of the list.

The same code runs under pyapache with a very modest memory leak (also 
documented for pyapache) of about 1K
per page served.

I was a little unwilling to try switching to a more direct method of 
content handling under mod_python (creating
a request handler for .phtml page) until the whole system was a little more 
stable. I'm in production under pyapache
now, and I hate forking the code base.

Comments? Suggestions?

Does anyone have a skeleton content handler they would be willing to share, 
along with a corresponding .conf
entry?

-- Sean

==========
Sean True
seant@alum.mit.edu


From grisha at ispol.com  Mon Jun  5 08:05:32 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:54 2004
Subject: [mod_python] Leaking and cgi-handler
In-Reply-To: <4.3.2.20000605071041.00b91280@pop.ne.mediaone.net>
Message-ID: <Pine.LNX.4.21.0006050746190.31412-100000@saturn.ispol.com>

Sean - 

If you can find the source of the memory leak, please let me know what it
is, because I couldn't... :-(

The cgihandler when used with scripts not using cgi.py does not leak a
byte of memory. Unfortunately 98% of Python scripts out there start with
"import cgi".

A common misconception about Python and memory leaks is that it is
impossible to leak memory in Python. Python, just like any other language
allows you to allocate limitless memory, and in a persistent daemon-type
environment like Apache it shows.

Most likely the reason PyApache does not leak memory as bad is it resets
the interpeter between hits. This comes at a significant performance hit
since all the modules have to imported again, to the point where PyApache
isn't all that much faster than plain CGI.

My recomendation would to rewrite everything using "native" mod_python
handlers. They are simple (much simpler than CGI), fast and they do not
leak memory. You fears about them being unstable are unfounded, I think.

P.S. A skeleton content handler is described in the documentation.

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Mon, 5 Jun 2000, Sean True wrote:

> The same code runs under pyapache with a very modest memory leak (also
> documented for pyapache) of about 1K per page served.
> 
> I was a little unwilling to try switching to a more direct method of
> content handling under mod_python (creating a request handler for
> .phtml page) until the whole system was a little more stable. I'm in
> production under pyapache now, and I hate forking the code base.
> 
> Comments? Suggestions?
> 
> Does anyone have a skeleton content handler they would be willing to
> share, along with a corresponding .conf entry?
> 
> -- Sean


From Mads at Kiilerich.com  Mon Jun  5 15:13:40 2000
From: Mads at Kiilerich.com (Mads Kiilerich)
Date: Fri Jan  9 21:45:54 2004
Subject: [mod_python] AttributeError: handler
In-Reply-To: <Pine.LNX.4.21.0006020728250.7977-100000@saturn.ispol.com>
Message-ID: <Pine.LNX.4.21.0006051504240.864-100000@localhost>

Friday I got mail from Gregory Trubetskoy:

> The message means that module test did not have a function called
> "handler".
> 
> Grisha

Thanks for the fast response.

But test.py contains the following, according to the example in
the documentation:


from mod_python import apache

def handler(req):
	req.send_http_header()
	req.write("Hello World!")
	return apache.OK 


As far as I can see there _is_ a function called "handler"!?

Can you confirm that the example from the documentation works
"out of the box"?

Also: Should the .py be compiled to .pyc?

TIA,
-- 
Mads Kiilerich          Sys.Adm. Cand.Polyt
Mads@Kiilerich.com      Tel. +45 38 16 26 00  Mob. +45 26 20 07 73
M?ntmestervej 12B 1th,  DK-2400 NV,  Denmark

"Learned about WAP. It sucks. The more I play with WML the more sure 
I am that WAP will die out rapidly once phones doing HTML exist."
							Alan Cox


From grisha at ispol.com  Mon Jun  5 09:40:52 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:54 2004
Subject: [mod_python] AttributeError: handler
In-Reply-To: <Pine.LNX.4.21.0006051504240.864-100000@localhost>
Message-ID: <Pine.LNX.4.21.0006050938520.31412-100000@saturn.ispol.com>

Mads - 

Everyone who reported this problem so far found later on that they had
extra blanks in their test.py because they cut and pasted from the web
page.

No, you don't need to compile your py into a pyc - Python will do that for
you.

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Mon, 5 Jun 2000, Mads Kiilerich wrote:

> Friday I got mail from Gregory Trubetskoy:
> 
> But test.py contains the following, according to the example in
> the documentation:
> 
> 
> from mod_python import apache
> 
> def handler(req):
> 	req.send_http_header()
> 	req.write("Hello World!")
> 	return apache.OK 
> 


From aiglauer at yahoo.com  Mon Jun  5 07:08:41 2000
From: aiglauer at yahoo.com (Alexis Iglauer)
Date: Fri Jan  9 21:45:54 2004
Subject: [mod_python] AttributeError: handler
Message-ID: <20000605140841.29193.qmail@web2205.mail.yahoo.com>

Always a good idea to just run python over your script
before trying to run it on the webserver - this will
pick up any inconsistent dedents or other little
syntax nasties.

If you are in unix, edit the file in vi and type in
':set list' - you can then see which of your nice
spaces are actually sneaky tabs :)

Regards
aei


--- Gregory Trubetskoy <grisha@ispol.com> wrote:
> 
> Mads - 
> 
> Everyone who reported this problem so far found
> later on that they had
> extra blanks in their test.py because they cut and
> pasted from the web
> page.
> 
> No, you don't need to compile your py into a pyc -
> Python will do that for
> you.
> 
> --
>   Gregory (Grisha) Trubetskoy
>        grisha@ispol.com
> 
> On Mon, 5 Jun 2000, Mads Kiilerich wrote:
> 
> > Friday I got mail from Gregory Trubetskoy:
> > 
> > But test.py contains the following, according to
> the example in
> > the documentation:
> > 
> > 
> > from mod_python import apache
> > 
> > def handler(req):
> > 	req.send_http_header()
> > 	req.write("Hello World!")
> > 	return apache.OK 
> > 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 
> 
> 


__________________________________________________
Do You Yahoo!?
Yahoo! Photos -- now, 100 FREE prints!
http://photos.yahoo.com

From sbi at acse.be  Mon Jun  5 20:56:13 2000
From: sbi at acse.be (=?iso-8859-1?Q?St=E9phane_Bidoul?=)
Date: Fri Jan  9 21:45:54 2004
Subject: [mod_python] Problems under windows: a first diagnostic
Message-ID: <010101bfcf1f$b9407bd0$885bfea9@spirou>

Hi again,

I think I've got an explanation for the crashes under windows.

Disclaimer: I'm no apache expert, nor am I intimate with python threading,
so bear with me if the following is completely off-track.

In the python doc, I've found the following:

<PythonDocExcerpt>

[...] when threads are created from C, they don't have the global interpreter lock, nor is there a thread state data structure for them. Such threads must bootstrap themselves into existence, by first creating a thread state data structure [PyThreadState_New()?], then acquiring the lock, and finally storing their thread state pointer, before they can start using the Python/C API. When they are done, they should reset the thread state pointer, release the lock, and finally free their thread state data structure.

</PythonDocExcerpt>

Now, in mod_python, threads are created by Apache, so they should
somehow be bootstrapped for python. 

In my understanding, mod_python only initializes one thread per
interpreter: the Apache thread that is happening to create the interpreter
 (using Py_NewInterpreter(), which in turns calls PyThreadState_New()
for the interpreter's "main" thread).
All other apache threads using that same interpreter will not call
PyThreadState_New()... hence the potential conflict.

To summarize, my understanding of the python doc is that there should
be one PyThreadState_New() for each (apache thread, python interpreter) couple.

AFAIK, threads are used only in the Windows version of Apache, 
so the problem should not occur on unix  (athough that will change with Apache 2). 
Also, if ThreadsPerChild is set to 1, the problem disappears,
which seems to confirm my diagnostic.

Again, bear with me if this is totally wrong...
If this is correct, however, I've no idea (yet) on how to fix it...

What do you think? 
Can a python threading expert confirm or infirm this diagnostic?

-Stephane
sbi@acse.be




From gstein at lyra.org  Mon Jun  5 17:16:39 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:45:54 2004
Subject: [mod_python] Problems under windows: a first diagnostic
In-Reply-To: <010101bfcf1f$b9407bd0$885bfea9@spirou>
Message-ID: <Pine.LNX.4.10.10006051658410.14292-100000@nebula.lyra.org>

On Mon, 5 Jun 2000, [iso-8859-1] Stéphane Bidoul wrote:
>...
> Now, in mod_python, threads are created by Apache, so they should
> somehow be bootstrapped for python. 

Correct.

> In my understanding, mod_python only initializes one thread per
> interpreter: the Apache thread that is happening to create the interpreter
>  (using Py_NewInterpreter(), which in turns calls PyThreadState_New()
> for the interpreter's "main" thread).
> All other apache threads using that same interpreter will not call
> PyThreadState_New()... hence the potential conflict.

ThreadState structures are not specific to a particular (OS) thread. You
can actually use them (not at the same time!) across different threads.
Given the protection of the global lock, it might be okay to even attempt
to use them at the same time.
[ haven't thought through this particular scenario fully yet ]

> To summarize, my understanding of the python doc is that there should
> be one PyThreadState_New() for each (apache thread, python
> interpreter) couple.

Theoretically: yes.

Python's central lock "should" arbitrate the use of the per-interpreter
thread state so that it can be used by multiple Apache threads. Probably
isn't the best idea, though.

Eek. Definitely wrong for the Apache scenario.

The scoop: if python_handler() calls into Python, then returns, then
tstate->frame should be NULL. In this scenario, you could do the
share-tstate thing.

However: somewhere down inside of python_handler's call into Python, it is
quite possible for Python to use Py_BEGIN_ALLOW_THREADS (unlock the global
lock). This will allow another python_handler to grab the tstate and
attempt execution. Let's say the thread execution then flips back to
normal: the original thread's tstate->frame is now *totally* wrong.

[ tstate->frame has a direct correspondence to the C stack; these must
  stay in sync or Bad Things happen ]

> AFAIK, threads are used only in the Windows version of Apache, 
> so the problem should not occur on unix  (athough that will change with Apache 2). 
> Also, if ThreadsPerChild is set to 1, the problem disappears,
> which seems to confirm my diagnostic.
> 
> Again, bear with me if this is totally wrong...
> If this is correct, however, I've no idea (yet) on how to fix it...

Your underlying hypothesis is quite correct. Above is a more detailed
breakdown of "why".

> What do you think? 
> Can a python threading expert confirm or infirm this diagnostic?

That would be me :-)

One other thing: if Apache is going to run threads, then Python *MUST* be
compiled with thread support. Otherwise, things will die very rapidly.
Presuming that you are using the standard Windows distribution, then the
thread support is automatically enabled. I would recommend that mod_python
barf with #error if it detects Apache/Win32 and WITH_THREAD is not
enabled.

Heh. All of this just supports my belief in "free threading" Python even
more... :-)

What is the solution? Each entry to python-handler should construct a
tstate on the fly, call into Python, then destroy the tstate. I used this
design for the Python/COM support in the Win32 distribution. That had to
deal with reentrancy issues, but (luckily) that isn't a problem here.

Presumably, you could also cache/pool tstates and yank them from your
pool on entry to python-handler, returning them on exit. If two threads
came into python-handler (against the same interp!), then additional
tstates would be constructed.

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/


From seant at alum.mit.edu  Mon Jun  5 23:11:07 2000
From: seant at alum.mit.edu (Sean True)
Date: Fri Jan  9 21:45:54 2004
Subject: [mod_python] A cheap handler for exploring Apache req contents
Message-ID: <4.3.2.20000605230004.00b94c20@pop.ne.mediaone.net>

The following code is so inelegant, I'm a little embarrassed to share it, 
but it's a handy handler for starting
to poke around inside the Apache req structure, and so informative that I 
thought I'd share.

Grisha might want to comment as to why some of the attributes of the req 
don't dump the way I tried to dump them. Could just be the late night 
stupids on my part.

-- Sean

=================
from mod_python import apache

def dumpdict(req,title, d):
     req.write("*"+title + "\n")
     for key in d.keys():
         req.write(str(key) + ": " + str(d[key]) + "\n")
def dump(req,title,s):
     req.write(title+": "+s+"\n")
def handler(req):
     req.send_http_header()
     dump(req,"Request", req.the_request)
     dump(req,"Protocol", req.protocol)
     dump(req,"Hostname", req.hostname)
     dump(req,"Status line", req.status_line)
     dump(req, "Method", req.method)
     dump(req,"Content handler", req.handler)
     dump(req, "Unparsed uri", req.unparsed_uri)
     dump(req, "Uri", req.uri)
     dump(req, "Filename", req.filename)
     dump(req, "Path info", req.path_info)
     dump(req, "Args", req.args)
     dump(req, "Mtime", str(req.mtime))
     dump(req, "Remaining", str(req.remaining))
     # The following don't work.
     #dump(req, "Content type", req.content_type)
     #dump(req, "Content encoding", req.content_encoding)
     #dump(req, "Parsed uri", str(req.parsed_uri))
     #dump(req, "finfo", str(req.finfo))
     dumpdict(req, "headers_in",req.headers_in)
     dumpdict(req, "headers_out", req.headers_out)
     dumpdict(req, "err_headers_out", req.err_headers_out)
     dumpdict(req, "subprocess_env", req.subprocess_env)
     dumpdict(req, "notes", req.notes)
     return apache.OK
================
Output on my system: (with domain deleted for privacy)
================
Request: GET /foo.xhtml?fu=bar HTTP/1.0
Protocol: HTTP/1.0
Hostname: www.[..].com
Status line: 200 OK Method: GET
Content handler: python-program
Unparsed uri: /foo.xhtml?fu=bar
Uri: /foo.xhtml
Filename: /usr/local/apache/htdocs/foo.xhtml
Path info:
Args: fu=bar
Mtime: 0
Remaining: 0
*headers_in
Accept: */*
Accept-Language: en-us
Connection: Keep-Alive
Host: www.[..].com
User-Agent: Mozilla/4.0 (compatible; MSIE 5.01; Windows 98)
*headers_out
Connection: close
Content-Type: text/plain
*err_headers_out
*subprocess_env
SCRIPT_URL: /foo.xhtml
SCRIPT_URI: http://www.[..]/foo.xhtml
GATEWAY_INTERFACE: CGI/1.1
SERVER_PROTOCOL: HTTP/1.0
REQUEST_METHOD: GET
QUERY_STRING: fu=bar
REQUEST_URI: /foo.xhtml?fu=bar
SCRIPT_NAME: /foo.xhtml
*notes
python_request_ptr: 135846824

==========
Sean True
seant@alum.mit.edu


From sbi at acse.be  Tue Jun  6 09:35:03 2000
From: sbi at acse.be (=?iso-8859-1?Q?St=E9phane_Bidoul?=)
Date: Fri Jan  9 21:45:54 2004
Subject: [mod_python] Problems under windows: a first diagnostic
References: <Pine.LNX.4.10.10006051658410.14292-100000@nebula.lyra.org>
Message-ID: <006201bfcf89$ba39c2c0$885bfea9@spirou>

>...
>The scoop: if python_handler() calls into Python, then returns, then
>tstate->frame should be NULL. In this scenario, you could do the
>share-tstate thing.
>
>However: somewhere down inside of python_handler's call into Python, it is
>quite possible for Python to use Py_BEGIN_ALLOW_THREADS (unlock the global
>lock). This will allow another python_handler to grab the tstate and
>attempt execution. Let's say the thread execution then flips back to
>normal: the original thread's tstate->frame is now *totally* wrong.

Wow! This looks even more complex than I thought...

>What is the solution? Each entry to python-handler should construct a
>tstate on the fly, call into Python, then destroy the tstate. I used this
>design for the Python/COM support in the Win32 distribution. That had to
>deal with reentrancy issues, but (luckily) that isn't a problem here.
>
>Presumably, you could also cache/pool tstates and yank them from your
>pool on entry to python-handler, returning them on exit. If two threads
>came into python-handler (against the same interp!), then additional
>tstates would be constructed.

I was contemplating the use of thread-local storage to maintain
the list of interpreters for which a tstate is initialized for each
Apache thread, but it's probably overkill...

Ideally, Apache should provide access to some "per-thread data area" for this,
but it does not, right?

Anyway, unless Gregory tells me otherwise, I will experiment with 
Greg's first solution and see how it works...

-Stephane



From gstein at lyra.org  Tue Jun  6 02:50:52 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:45:54 2004
Subject: [mod_python] Problems under windows: a first diagnostic
In-Reply-To: <006201bfcf89$ba39c2c0$885bfea9@spirou>
Message-ID: <Pine.LNX.4.10.10006060245500.14292-100000@nebula.lyra.org>

On Tue, 6 Jun 2000, [iso-8859-1] Stéphane Bidoul wrote:
>...
> >What is the solution? Each entry to python-handler should construct a
> >tstate on the fly, call into Python, then destroy the tstate. I used this
> >design for the Python/COM support in the Win32 distribution. That had to
> >deal with reentrancy issues, but (luckily) that isn't a problem here.
> >
> >Presumably, you could also cache/pool tstates and yank them from your
> >pool on entry to python-handler, returning them on exit. If two threads
> >came into python-handler (against the same interp!), then additional
> >tstates would be constructed.
> 
> I was contemplating the use of thread-local storage to maintain
> the list of interpreters for which a tstate is initialized for each
> Apache thread, but it's probably overkill...

The cost of creating a tstate isn't all that high, in the scheme of
things. What is going to get a bit difficult is the change necessary in
get_obcallback(). It uses Py_NewInterpreter to create an interp/tstate
pair. You'll have to unwrap that into creating *just* an interpreter, thus
allowing you to create/destroy tstates at will.

> Ideally, Apache should provide access to some "per-thread data area" for this,
> but it does not, right?

For Apache 1.3, the only threaded platform is Windows, where TLS is going
to work out fine for you.

Apache 2.0 is a whole different story, and doesn't apply to mod_python.

> Anyway, unless Gregory tells me otherwise, I will experiment with 
> Greg's first solution and see how it works...

It is a good bundle of work, but it should work quite fine. Like I said, I
used a similar pattern for embedding the Python interpreter behind the
(multi-threaded) COM interfaces.

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/


From grisha at ispol.com  Tue Jun  6 07:38:29 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:54 2004
Subject: [mod_python] Problems under windows: a first diagnostic
In-Reply-To: <Pine.LNX.4.10.10006060245500.14292-100000@nebula.lyra.org>
Message-ID: <Pine.LNX.4.21.0006060734030.4432-100000@saturn.ispol.com>

I haven't had any caffeine yet so I don't think I can comment. The Python
relationship between ThreadStates and Interpreters took me a while to
understand last time I studied it and it's one of those things that I can
only grasp for a few days until I don't need it - then, next time, I have
figure it out again.

I'll think about this some more in the coming days....

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Tue, 6 Jun 2000, Greg Stein wrote:

> On Tue, 6 Jun 2000, [iso-8859-1] St?phane Bidoul wrote:
> >...
> > >What is the solution? Each entry to python-handler should construct a
> > >tstate on the fly, call into Python, then destroy the tstate. I used this
> > >design for the Python/COM support in the Win32 distribution. That had to
> > >deal with reentrancy issues, but (luckily) that isn't a problem here.
> > >
> > >Presumably, you could also cache/pool tstates and yank them from your
> > >pool on entry to python-handler, returning them on exit. If two threads
> > >came into python-handler (against the same interp!), then additional
> > >tstates would be constructed.
> > 
> > I was contemplating the use of thread-local storage to maintain
> > the list of interpreters for which a tstate is initialized for each
> > Apache thread, but it's probably overkill...
> 
> The cost of creating a tstate isn't all that high, in the scheme of
> things. What is going to get a bit difficult is the change necessary in
> get_obcallback(). It uses Py_NewInterpreter to create an interp/tstate
> pair. You'll have to unwrap that into creating *just* an interpreter, thus
> allowing you to create/destroy tstates at will.
> 
> > Ideally, Apache should provide access to some "per-thread data area" for this,
> > but it does not, right?
> 
> For Apache 1.3, the only threaded platform is Windows, where TLS is going
> to work out fine for you.
> 
> Apache 2.0 is a whole different story, and doesn't apply to mod_python.
> 
> > Anyway, unless Gregory tells me otherwise, I will experiment with 
> > Greg's first solution and see how it works...
> 
> It is a good bundle of work, but it should work quite fine. Like I said, I
> used a similar pattern for embedding the Python interpreter behind the
> (multi-threaded) COM interfaces.
> 
> Cheers,
> -g
> 
> -- 
> Greg Stein, http://www.lyra.org/
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From danilo at telusplanet.net  Wed Jun  7 14:51:44 2000
From: danilo at telusplanet.net (Danilo Fiorenzano)
Date: Fri Jan  9 21:45:54 2004
Subject: [mod_python] Leaking and cgi-handler
In-Reply-To: Gregory Trubetskoy's message of "Mon, 5 Jun 2000 08:05:32 -0400 (EDT)"
References: <Pine.LNX.4.21.0006050746190.31412-100000@saturn.ispol.com>
Message-ID: <m3puptnrj3.fsf@spike.interalta.com>

Gregory Trubetskoy <grisha@ispol.com> writes:

 
> The cgihandler when used with scripts not using cgi.py does not leak a
> byte of memory. Unfortunately 98% of Python scripts out there start with
> "import cgi".

..
 
> My recomendation would to rewrite everything using "native" mod_python
> handlers. They are simple (much simpler than CGI), fast and they do not
> leak memory. You fears about them being unstable are unfounded, I think.

On this theme: from the heights of my blissful ignorance (started
learning python and its library 2 weeks ago or so), I apparently
devised a way to use the facilities of the cgi module with mod_python
_without_ using the cgihandler.  I do something like this:

import cgi
from mod_python import apache

def handler(req):
    req.content_type = "text/html"
    req.send_http_header()

    env, si, so = apache.setup_cgi(req)
    formData = cgi.FieldStorage()
    for key in formData.keys():
        req.write( str(key) + " : " + str(data[key].value) + "<br>" )


This works without the need to specify cgihandler in the apache
config.  Not sure whether it's the Right way to handle things, or if
it avoids the leaking, but I thought it was worth sharing.. YMMV.

 regards

-- Danilo

From roybryant at SEVENtwentyfour.com  Wed Jun  7 20:46:43 2000
From: roybryant at SEVENtwentyfour.com (Roy Bryant)
Date: Fri Jan  9 21:45:54 2004
Subject: [mod_python] Broken link in www.modpython.org
Message-ID: <307EC3F394ACD311B959006008A30AD6BCDD9B@MAIL724>

There appears to be a problem on this page of your site.

    On your page
http://www.modpython.org/pipermail/mod_python/2000-June/000067.html
    when you click on your link to http://localhost/test/test.py.
    you get the error: Domain name lookup failed (may be a transient error)

As recommended by the Robot Guidelines, this email is to explain our robot's
activities and to let you know about one of the broken links we encountered.
LinkWalker does not store or publish the content of your pages, but rather
uses the link information to update our map of the World Wide Web.

Are these reports helpful? I'd love some feedback. If you prefer not to
receive these occasional error notices please let me know.

Roy Bryant

 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 Roy Bryant, roybryant@seventwentyfour.com
 President
 SEVENtwentyfour Inc. ("Always watching the Web")
 http://www.seventwentyfour.com
 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ 

From grisha at ispol.com  Thu Jun  8 09:53:32 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:54 2004
Subject: [mod_python] mod_python 2.3
Message-ID: <Pine.LNX.4.21.0006080946010.15265-100000@saturn.ispol.com>

Mod_python 2.3 is out.

There are two major changes in this one:

1. The PythonDebug, PythonInterpPerDirectory and PythonNoReload now
require an argument of On or Off. NOTE - THIS WILL REQUIRE YOU TO CHANGE
YOUR CONFIGS IF YOU'RE USING ANY OF THESE DIRECTIVES!!!

2. A new directive, PythonImport allows you to import modules at child
process initialization time. This is good for initializing database
connections, etc. Read the documentation for details.

For the future relelases, on my list are (in no particular order):

1. Ironing out the thread related issues so that mod_python works on
win32. 

2. ChildInit, ChildExit and Cleanup handlers.

3. Dynamic handler registration.

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com


From grisha at ispol.com  Thu Jun  8 09:57:48 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:55 2004
Subject: [mod_python] suggestions
Message-ID: <Pine.LNX.4.21.0006080953350.15265-100000@saturn.ispol.com>

If all goes well, I will be presenting about mod_python at the upcoming
Apachecon in London in October.

I'm looking for sugestions on topics that you think would be interesting
to cover. Imagine you were planning on attending the conference - what
would YOU like to know about mod_python?

Thanks,

Grisha



From sbi at acse.be  Thu Jun  8 17:28:31 2000
From: sbi at acse.be (=?Windows-1252?Q?St=E9phane_Bidoul?=)
Date: Fri Jan  9 21:45:55 2004
Subject: [mod_python] Another threading issue: chdir
Message-ID: <003b01bfd15e$33cb0f60$66a679c1@spirou>

Hi again,

Obviously, chdir is not thread-safe
(I discovered the problem by running different 
handlers in different directories)

It's ok with the one performed in cgihandler,
since cgi must run single-threaded anyway.

I wonder if the one in mod_python.c is really necessary?
Maybe apache.import_module() could add the directory to
pythonpath before doing the import instead of adding '.'.
Oh, and now that I write it, changing python path is 
not thread-safe either: can we do the import without
changing pythonpath at all? If not, another lock 
will be required to protect that...

There is also a chdir in the httpdapi handler
but I've no idea about that one.

Well, I hope the end of the threading tunnel is in sight...

-sbi
-------------- next part --------------
A non-text attachment was scrubbed...
Name: =?Windows-1252?Q?St=E9phane_Bidoul.vcf?=
Type: text/x-vcard
Size: 361 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20000608/ea5f5f9f/Windows-1252QStE9phane_Bidoul.vcf
From grisha at ispol.com  Thu Jun  8 18:14:05 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:55 2004
Subject: [mod_python] Another threading issue: chdir (fwd)
Message-ID: <Pine.LNX.4.21.0006081813330.17090-100000@saturn.ispol.com>

Having the url directory as your current directory is just an intuitive
thing and makes it easier for the developer.... E.g. if you're trying to
open files, etc.

One thing that we could do is restore the original directory and make sure
that the lock is aqcuired before first chdir() and after the last chdir()?

Or chdir could be made optional via a directive of some sort.... I need to
think about this too...

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Thu, 8 Jun 2000, [Windows-1252] St?phane Bidoul wrote:

> Hi again,
> 
> Obviously, chdir is not thread-safe
> (I discovered the problem by running different 
> handlers in different directories)
> 
> It's ok with the one performed in cgihandler,
> since cgi must run single-threaded anyway.
> 
> I wonder if the one in mod_python.c is really necessary?
> Maybe apache.import_module() could add the directory to
> pythonpath before doing the import instead of adding '.'.
> Oh, and now that I write it, changing python path is 
> not thread-safe either: can we do the import without
> changing pythonpath at all? If not, another lock 
> will be required to protect that...
> 
> There is also a chdir in the httpdapi handler
> but I've no idea about that one.
> 
> Well, I hope the end of the threading tunnel is in sight...
> 
> -sbi
> 



From SBID at BXS.BE  Fri Jun  9 09:23:29 2000
From: SBID at BXS.BE (=?iso-8859-1?Q?St=E9phane_BIDOUL?=)
Date: Fri Jan  9 21:45:55 2004
Subject: [mod_python] Re: Another threading issue: chdir (fwd)
Message-ID: <C16998C688CDD31196D90008C7E690CB172343@EVRSRV04>

> Having the url directory as your current directory is just an intuitive
> thing and makes it easier for the developer.... E.g. if you're trying to
> open files, etc.

Agreed. OTOH, it is quite easy to obtain the module directory
with something like os.path.dirname(__file__).

> One thing that we could do is restore the original directory and make sure
> that the lock is aqcuired before first chdir() and after the last chdir()?

It would require another lock than the global interpreter lock because
that one can be released during execution. If another thread steps
in a that moment, the current directory could change in the middle of
a script...

But then it would degrade even native handlers to single-threading.

> Or chdir could be made optional via a directive of some sort.... I need to
> think about this too...

This option looks reasonable to me; 
the associated threading caveats could be documented easily.

Cheers

-sbi
sbi@acse.be
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20000609/a0168ad8/attachment.htm
From grisha at ispol.com  Fri Jun  9 17:12:16 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:55 2004
Subject: [mod_python] Re: Another threading issue: chdir (fwd)
In-Reply-To: <C16998C688CDD31196D90008C7E690CB172342@EVRSRV04>
Message-ID: <Pine.LNX.4.21.0006091703340.21671-100000@saturn.ispol.com>

On Fri, 9 Jun 2000, St?phane BIDOUL wrote:

> > Or chdir could be made optional via a directive of some sort.... I need to
> > think about this too...
> 
> This option looks reasonable to me; 
> the associated threading caveats could be documented easily.

The more I think about this, the more it seems to me that doing away with
the chdir and prepending the path rather than the '.' is the way to go.

This will break old code that relied on the chdir being there, but what
can you do...

All the other solutions will make threaded mod_python incompatible with
nonthreaded be it extra directives or different code that you need....

Grisha



From daniel at copyleft.no  Sun Jun 11 14:44:00 2000
From: daniel at copyleft.no (Hr. Daniel Mikkelsen)
Date: Fri Jan  9 21:45:55 2004
Subject: [mod_python] make_obcallback(): could not import mod_python.apache.
Message-ID: <Pine.LNX.4.10.10006111434560.14419-100000@unity.copyleft.no>

Hi. 

I'm getting this error in my mail apache error_log when I try to start
httpd after having added mod_python 2.3 as a DSO:

make_obcallback(): could not import mod_python.apache.
make_obcallback(): could not call init.
[Sun Jun 11 14:33:49 2000] [error] python_init: get_obcallback returned no
  obCallBack. Possibly no more memory.

In version 2.2, I had the same problem (I switched to 2.3 while trying to
figure it out), with two exceptions. The last line in the error message
wasn't there, and apache didn't fail in starting (only in running .py test
files). 

Now, when I ran httpdapy, earlier, I had a very similar problem with
tracebacks about how it couldn't load certain python modules (apache.py
for instance), and apache failed to load in the same way. I solved the
problem by setting the PYTHONPATH correctly.

Changing PYTHONPATH doesn't seem to work now, however. I have the .py
files wich came with mod_python 2.3 in my
/usr/local/lib/python1.5/site-packages directory. I have compiled a
threadless python that expects (I assume, having given no --prefix=...
statement to its ./configure) to find scripts there. I've linked my
mod_python DSO with this verison of python. 

My setup is an OpenBSD 2.6 (using the apache that comes bundled), Python
1.5, enough memory (128Mb of which 81 are reported "free" byt top).

I'm trying to load the test.py given in the installation docs, and the
zhello.py given in the zhandler docs. 

Any ideas?

-- Daniel Mikkelsen, Copyleft Software


From grisha at ispol.com  Sun Jun 11 09:52:19 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:55 2004
Subject: [mod_python] make_obcallback(): could not import mod_python.apache.
In-Reply-To: <Pine.LNX.4.10.10006111434560.14419-100000@unity.copyleft.no>
Message-ID: <Pine.LNX.4.21.0006110951330.6729-100000@saturn.ispol.com>

If your Apache runs as nobody and the python library is not world
readable, you will get this error too.

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Sun, 11 Jun 2000, Hr. Daniel Mikkelsen wrote:

> Hi. 
> 
> I'm getting this error in my mail apache error_log when I try to start
> httpd after having added mod_python 2.3 as a DSO:
> 
> make_obcallback(): could not import mod_python.apache.
> make_obcallback(): could not call init.
> [Sun Jun 11 14:33:49 2000] [error] python_init: get_obcallback returned no
>   obCallBack. Possibly no more memory.
> 
> In version 2.2, I had the same problem (I switched to 2.3 while trying to
> figure it out), with two exceptions. The last line in the error message
> wasn't there, and apache didn't fail in starting (only in running .py test
> files). 
> 
> Now, when I ran httpdapy, earlier, I had a very similar problem with
> tracebacks about how it couldn't load certain python modules (apache.py
> for instance), and apache failed to load in the same way. I solved the
> problem by setting the PYTHONPATH correctly.
> 
> Changing PYTHONPATH doesn't seem to work now, however. I have the .py
> files wich came with mod_python 2.3 in my
> /usr/local/lib/python1.5/site-packages directory. I have compiled a
> threadless python that expects (I assume, having given no --prefix=...
> statement to its ./configure) to find scripts there. I've linked my
> mod_python DSO with this verison of python. 
> 
> My setup is an OpenBSD 2.6 (using the apache that comes bundled), Python
> 1.5, enough memory (128Mb of which 81 are reported "free" byt top).
> 
> I'm trying to load the test.py given in the installation docs, and the
> zhello.py given in the zhandler docs. 
> 
> Any ideas?
> 
> -- Daniel Mikkelsen, Copyleft Software
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From richard at whitequeen.com  Sun Jun 11 12:34:14 2000
From: richard at whitequeen.com (richard offer)
Date: Fri Jan  9 21:45:55 2004
Subject: [mod_python] problems with 2.0 -> 2.3 upgrade
Message-ID: <200006111934.e5BJYEB07387@erij.whitequeen.com>

Hi,

I upgraded from 2.0 to 2.3 this morning and am now seeing the following
error message in the webservers log file

[Sun Jun 11 12:23:33 2000] [notice] child pid 7340 exit signal Segmentation fault (11)
[Sun Jun 11 12:23:33 2000] [notice] child pid 7339 exit signal Segmentation fault (11)
[Sun Jun 11 12:23:35 2000] [notice] child pid 7343 exit signal Segmentation fault (11)
[Sun Jun 11 12:23:36 2000] [notice] child pid 7345 exit signal Segmentation fault (11)
[Sun Jun 11 12:23:36 2000] [notice] child pid 7344 exit signal Segmentation faul


It seems like all child webservers are dying, but the master is running
in a continous loop trying to spawn the children.


Moving the old (2.0) DSO and python code back into place fixed it.

[ Running Apache 1.3.12 on Redhat 6.1/2.2.16 ]


Any hints ?

richard.

-- 
richard offer @ home 
          84 FE 48 E4 74 D0 26 D4  31 8E B6 86 98 74 E2 7C  8A FB BF A3
___________________________________http://216.185.15.144/users/richard/

From grisha at ispol.com  Sun Jun 11 16:03:47 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:55 2004
Subject: [mod_python] problems with 2.0 -> 2.3 upgrade
In-Reply-To: <200006111934.e5BJYEB07387@erij.whitequeen.com>
Message-ID: <Pine.LNX.4.21.0006111558070.7904-100000@saturn.ispol.com>

Someone else reported this and I know what the problem is.

There are two things you can do:

1. downgrade to 2.2 and wait until 2.4
2. add a dummy PythonImport statement in the httpd.conf file between some
<Directory> tags, e.g.

PythonImport string

This is because I added the new PythonImport derective and did all the
testing and it worked fine, except when the directive is NOT specified and
thus the variable that holds the info is undefined.... Sorry, I'll be more
thorough next time!

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Sun, 11 Jun 2000, richard offer wrote:

> 
> Hi,
> 
> I upgraded from 2.0 to 2.3 this morning and am now seeing the following
> error message in the webservers log file
> 
> [Sun Jun 11 12:23:33 2000] [notice] child pid 7340 exit signal Segmentation fault (11)
> [Sun Jun 11 12:23:33 2000] [notice] child pid 7339 exit signal Segmentation fault (11)
> [Sun Jun 11 12:23:35 2000] [notice] child pid 7343 exit signal Segmentation fault (11)
> [Sun Jun 11 12:23:36 2000] [notice] child pid 7345 exit signal Segmentation fault (11)
> [Sun Jun 11 12:23:36 2000] [notice] child pid 7344 exit signal Segmentation faul
> 
> 
> It seems like all child webservers are dying, but the master is running
> in a continous loop trying to spawn the children.
> 
> 
> Moving the old (2.0) DSO and python code back into place fixed it.
> 
> [ Running Apache 1.3.12 on Redhat 6.1/2.2.16 ]
> 
> 
> Any hints ?
> 
> richard.
> 
> -- 
> richard offer @ home 
>           84 FE 48 E4 74 D0 26 D4  31 8E B6 86 98 74 E2 7C  8A FB BF A3
> ___________________________________http://216.185.15.144/users/richard/
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From wayne.izatt at myself.com  Sun Jun 11 13:46:08 2000
From: wayne.izatt at myself.com (Wayne Izatt)
Date: Fri Jan  9 21:45:55 2004
Subject: [mod_python] problems with 2.0 -> 2.3 upgrade
References: <200006111934.e5BJYEB07387@erij.whitequeen.com>
Message-ID: <3943FA8F.B7743662@myself.com>

richard offer wrote:

> Hi,
>
> I upgraded from 2.0 to 2.3 this morning and am now seeing the following
> error message in the webservers log file
>
> [Sun Jun 11 12:23:33 2000] [notice] child pid 7340 exit signal Segmentation fault (11)

<snip>

I get the same problem - same apache, same redhat.

<rant>

I'm getting sick and tired of these sorts of issues with redhat. I have apache problems
using PHP 4.0 with redhat, and mod_perl doesn't always work as expected on redhat.

</rant>


>
> It seems like all child webservers are dying, but the master is running
> in a continous loop trying to spawn the children.
>
> Moving the old (2.0) DSO and python code back into place fixed it.
>
> [ Running Apache 1.3.12 on Redhat 6.1/2.2.16 ]
>
> Any hints ?
>
> richard.
>
> --
> richard offer @ home
>           84 FE 48 E4 74 D0 26 D4  31 8E B6 86 98 74 E2 7C  8A FB BF A3
> ___________________________________http://216.185.15.144/users/richard/
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python


From sbi at acse.be  Mon Jun 12 23:06:03 2000
From: sbi at acse.be (=?iso-8859-1?Q?St=E9phane_Bidoul?=)
Date: Fri Jan  9 21:45:55 2004
Subject: [mod_python] Re: Another threading issue: chdir (fwd)
References: <Pine.LNX.4.21.0006091703340.21671-100000@saturn.ispol.com>
Message-ID: <00b401bfd4b2$0aed8a30$faa679c1@spirou>

>The more I think about this, the more it seems to me that doing away with
>the chdir and prepending the path rather than the '.' is the way to go.

Agreed, but I wonder how much the manipulation of sys.path to do the imports
can cause threading issues... Is it possible to avoid it?

>This will break old code that relied on the chdir being there, but what
>can you do...
>All the other solutions will make threaded mod_python incompatible with
>nonthreaded be it extra directives or different code that you need....

Cross platform compatibility is indeed important. To achive it people
should be told to assume multi-threaded operation: to be portable
to windows, and also to be Apache2-proof [since I understand that
it will use threads on Unix also; but it may not be a target for mod_python,
I don't know how different the API is].

-sbi




From gstein at lyra.org  Mon Jun 12 14:18:20 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:45:55 2004
Subject: [mod_python] Re: Another threading issue: chdir (fwd)
In-Reply-To: <00b401bfd4b2$0aed8a30$faa679c1@spirou>; from sbi@acse.be on Mon, Jun 12, 2000 at 11:06:03PM +0200
References: <Pine.LNX.4.21.0006091703340.21671-100000@saturn.ispol.com> <00b401bfd4b2$0aed8a30$faa679c1@spirou>
Message-ID: <20000612141820.R19484@lyra.org>

On Mon, Jun 12, 2000 at 11:06:03PM +0200, St?phane Bidoul wrote:
> >The more I think about this, the more it seems to me that doing away with
> >the chdir and prepending the path rather than the '.' is the way to go.
> 
> Agreed, but I wonder how much the manipulation of sys.path to do the imports
> can cause threading issues... Is it possible to avoid it?

sys.path is specific to an interpreter, rather than to a thread. Therefore,
threads should not be changing it.

> >This will break old code that relied on the chdir being there, but what
> >can you do...
> >All the other solutions will make threaded mod_python incompatible with
> >nonthreaded be it extra directives or different code that you need....
> 
> Cross platform compatibility is indeed important. To achive it people
> should be told to assume multi-threaded operation: to be portable
> to windows, and also to be Apache2-proof [since I understand that
> it will use threads on Unix also;

Correct. Apache 2.0 is threaded whenever threads are available (basically
everywhere nowadays). You can still run Apache 2.0 in its current mode, but
the default is threaded.

> but it may not be a target for mod_python,
> I don't know how different the API is].

The API is different enough; a 1.3 module can be ported, but it would be
reasonably difficult to have a module be compileable for both.

There are a number of other things that can be taken advantage of in the
Apache 2.0 API to improve/tighten the Apache/Python binding. I've been
planning to implement an Apache 2.0 specific "mod_py2" this summer to take
advantage of the 2.0 benefits. (as an Apache author, I can also make changes
to Apache to enhance this even further :-) In conjunction with that work,
I'm going to redo my "free threading patches" for 1.6 so that Python can
operate completely threaded within Apache 2.0 (e.g. the central lock
disappears entirely).

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/

From grisha at ispol.com  Mon Jun 12 17:30:14 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:55 2004
Subject: [mod_python] Re: Another threading issue: chdir (fwd)
In-Reply-To: <00b401bfd4b2$0aed8a30$faa679c1@spirou>
Message-ID: <Pine.LNX.4.21.0006121714500.12547-100000@saturn.ispol.com>

On Mon, 12 Jun 2000, St?phane Bidoul wrote:

> >The more I think about this, the more it seems to me that doing away with
> >the chdir and prepending the path rather than the '.' is the way to go.
> 
> Agreed, but I wonder how much the manipulation of sys.path to do the imports
> can cause threading issues... Is it possible to avoid it?

You could avoid it by making sure that the Pythonpath includes the
directory where your handlers are from the start, for example by setting
PYTHONPATH in the Apache startup script. But if we're going this route, we
might as well abandon the multiple interpreters.

Another problem with this is that typically you'll have to be root on the
system to restart Apache, and in many cases users are not.

On the upside, sys.path shouldn't get manipulated more than once. An
interpreter will get created and the sys.path changed upon the first hit,
after that it won't change. The sys.path manipualtion should be surrounded
by Python locks.

I have another idea - unless I'm missing something obvious, the way to
deal with this would be to add the directory to the path at interpreter
creation time in mod_python.c.

Grisha



From grisha at ispol.com  Mon Jun 12 17:48:08 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:55 2004
Subject: [mod_python] Re: Another threading issue: chdir (fwd)
In-Reply-To: <20000612141820.R19484@lyra.org>
Message-ID: <Pine.LNX.4.21.0006121740030.12547-100000@saturn.ispol.com>

On Mon, 12 Jun 2000, Greg Stein wrote:

> On Mon, Jun 12, 2000 at 11:06:03PM +0200, St?phane Bidoul wrote:
> > >The more I think about this, the more it seems to me that doing away with
> > >the chdir and prepending the path rather than the '.' is the way to go.
> > 
> > Agreed, but I wonder how much the manipulation of sys.path to do the imports
> > can cause threading issues... Is it possible to avoid it?
> 
> sys.path is specific to an interpreter, rather than to a thread. Therefore,
> threads should not be changing it.

On a related note though - is ap_table_set() thread-safe? I'm thinking of
all the Python* directives in .htaccess.

> as an Apache author, I can also make changes to Apache to enhance
> this even further :-)

Now that's luxury!

Grisha


From gstein at lyra.org  Mon Jun 12 14:57:19 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:45:55 2004
Subject: [mod_python] Re: Another threading issue: chdir (fwd)
In-Reply-To: <Pine.LNX.4.21.0006121740030.12547-100000@saturn.ispol.com>; from grisha@ispol.com on Mon, Jun 12, 2000 at 05:48:08PM -0400
References: <20000612141820.R19484@lyra.org> <Pine.LNX.4.21.0006121740030.12547-100000@saturn.ispol.com>
Message-ID: <20000612145719.U19484@lyra.org>

On Mon, Jun 12, 2000 at 05:48:08PM -0400, Gregory Trubetskoy wrote:
> On Mon, 12 Jun 2000, Greg Stein wrote:
>...
> > sys.path is specific to an interpreter, rather than to a thread. Therefore,
> > threads should not be changing it.
> 
> On a related note though - is ap_table_set() thread-safe? I'm thinking of
> all the Python* directives in .htaccess.

They are not thread-safe, but the only tables that would be changed are in
the request_rec and possibly the conn_rec. In other words: private to the
thread.

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/

From grisha at ispol.com  Mon Jun 12 18:23:28 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:55 2004
Subject: [mod_python] Re: Another threading issue: chdir (fwd)
In-Reply-To: <20000612145719.U19484@lyra.org>
Message-ID: <Pine.LNX.4.21.0006121818230.12547-100000@saturn.ispol.com>

On Mon, 12 Jun 2000, Greg Stein wrote:

> On Mon, Jun 12, 2000 at 05:48:08PM -0400, Gregory Trubetskoy wrote:
> > 
> > On a related note though - is ap_table_set() thread-safe? I'm thinking of
> > all the Python* directives in .htaccess.
> 
> They are not thread-safe, but the only tables that would be changed are in
> the request_rec and possibly the conn_rec. In other words: private to the
> thread.

Hmm.... But it might be a problem for PythonImport. PythonImport builds a
table a pointer to which is a global variable python_import. Then,
ChildInitHandler goes through that table and imports all the modules.

The reason PythonImport doesn't use the standard config stuff is that
ap_get_module_config() returns NULL inside a child init handler.

Am I taking the wrong apporach on this?

Grisha


From Mads at Kiilerich.com  Tue Jun 13 10:06:12 2000
From: Mads at Kiilerich.com (Mads Kiilerich)
Date: Fri Jan  9 21:45:55 2004
Subject: [mod_python] AttributeError: handler
In-Reply-To: <Pine.LNX.4.21.0006050938520.31412-100000@saturn.ispol.com>
Message-ID: <Pine.LNX.4.21.0006122243040.1325-100000@localhost>

Jun 5 I got mail from Gregory Trubetskoy:

> Everyone who reported this problem so far found later on that they had
> extra blanks in their test.py because they cut and pasted from the web
> page.

That makes me a speciel case. I found the solution to my problem
- and the problem wasn't spaces. 

The problem was that the PythonHandler I had specified wasn't in
the same directory as the directive was given in - thus the
handler couldn't be found.  I found this behaviour very
confusing - but now when I know it it starts to make sense! ;)

Correcting the path solved the problem. Another solution was to
add the PythonInterpPerDirectory directive.

Cheers,

-- 
Mads Kiilerich          Sys.Adm. Cand.Polyt
Mads@Kiilerich.com      Tel. +45 38 16 26 00  Mob. +45 26 20 07 73
M?ntmestervej 12B 1th,  DK-2400 NV,  Denmark

"Learned about WAP. It sucks. The more I play with WML the more sure I 
am that WAP will die out rapidly once phones doing HTML exist."    Cox




From Mads at Kiilerich.com  Tue Jun 13 10:07:07 2000
From: Mads at Kiilerich.com (Mads Kiilerich)
Date: Fri Jan  9 21:45:55 2004
Subject: [mod_python] AttributeError: handler
In-Reply-To: <20000605140841.29193.qmail@web2205.mail.yahoo.com>
Message-ID: <Pine.LNX.4.21.0006122249210.1325-100000@localhost>

Jun 5 I got mail from Alexis Iglauer:

> Always a good idea to just run python over your script
> before trying to run it on the webserver - this will
> pick up any inconsistent dedents or other little
> syntax nasties.

"Run python over".  How do I do that? With a compileall? (I
guess not, as performing a compileall gives a "Listing test.py
...\nCan't list test.py".)

TIA,
-- 
Mads Kiilerich          Sys.Adm. Cand.Polyt
Mads@Kiilerich.com      Tel. +45 38 16 26 00  Mob. +45 26 20 07 73
M?ntmestervej 12B 1th,  DK-2400 NV,  Denmark

"Learned about WAP. It sucks. The more I play with WML the more sure I 
am that WAP will die out rapidly once phones doing HTML exist."    Cox




From Mads at Kiilerich.com  Tue Jun 13 10:10:20 2000
From: Mads at Kiilerich.com (Mads Kiilerich)
Date: Fri Jan  9 21:45:55 2004
Subject: [mod_python] 2.2 is out
In-Reply-To: <Pine.LNX.4.21.0006041452530.28185-100000@saturn.ispol.com>
Message-ID: <Pine.LNX.4.21.0006131007280.904-200000@localhost>

Jun 4 I got mail from Gregory Trubetskoy:

> Also thanks to Gerhard Haering for the Suse RPM's. It'd be nice if someone
> came up and agreed to maintain with RedHat RPM, Debian package, a FreeBSD
> port and a Solaris package...

I've made a spec for RedHat, you'll find it attached. IMHO, if
you make a rpm and install it on a plain 6.2 system you'll get
something that works and can be used as a base for further
experiments.

Feedback is welcome!

Regards,

-- 
Mads Kiilerich          Sys.Adm. Cand.Polyt
Mads@Kiilerich.com      Tel. +45 38 16 26 00  Mob. +45 26 20 07 73
M?ntmestervej 12B 1th,  DK-2400 NV,  Denmark

"Learned about WAP. It sucks. The more I play with WML the more sure I 
am that WAP will die out rapidly once phones doing HTML exist."    Cox

-------------- next part --------------
Summary: The Python language for use with Apache.
Name: mod_python
Version: 2.2
Release: 0
Group: System Environment/Daemons
Source0: %{name}-%{version}.tgz
Copyright: BSD-ish???
BuildRoot: %{_tmppath}/%{name}-root
Requires: apache >= 1.3 , python >= 1.5.2
BuildPrereq: apache-devel 
Packager: Mads Kiilerich <mads@kiilerich.com>

%description
Mod_python allows embedding Python within the Apache http server for a
considerable boost in performance and added flexibility in designing web based
applications. 

The RPM installs a small example in /home/httpd/mod_python which can be
accessed as http://localhost/mod_python/some/path/which/doesn/t/matter

%prep
%setup -q -n mod_python-%{version}

%build
# 1. Installing Python Libraries
/usr/bin/python /usr/lib/python1.5/compileall.py lib/python/mod_python

# 2. Compiling -- Compiling mod_python as a DSO
apxs -I /usr/include/python1.5 -c src/mod_python.c \
	/usr/lib/python1.5/config/libpython1.5.a -lpthread

%install
rm -rf $RPM_BUILD_ROOT
install -D -s src/mod_python.so $RPM_BUILD_ROOT/usr/lib/apache/mod_python.so
mkdir -p $RPM_BUILD_ROOT/usr/lib/python1.5/site-packages/mod_python
install lib/python/mod_python/* \
	$RPM_BUILD_ROOT/usr/lib/python1.5/site-packages/mod_python
mkdir -p $RPM_BUILD_ROOT/home/httpd/mod_python
cat <<CAT>$RPM_BUILD_ROOT/home/httpd/mod_python/.htaccess
SetHandler python-program
PythonHandler pythonhandler
CAT
cat <<CAT>$RPM_BUILD_ROOT/home/httpd/mod_python/pythonhandler.py 
from mod_python import apache

def handler(req):
    req.send_http_header()
    req.write("Hello to the World from "+req.uri+"!")
    return apache.OK 
CAT

%clean
rm -rf $RPM_BUILD_ROOT

%post
grep -q 'LoadModule python_module' /etc/httpd/conf/httpd.conf || \
patch /etc/httpd/conf/httpd.conf <<CAT
*** httpd.conf.org      
--- httpd.conf  
***************
*** 206,207 ****
--- 206,208 ----
  # LoadModule foo_module modules/mod_foo.so
+ LoadModule python_module      modules/mod_python.so
  #LoadModule mmap_static_module modules/mod_mmap_static.so
***************
*** 253,254 ****
--- 254,256 ----
  ClearModuleList
+ AddModule mod_python.c
  #AddModule mod_mmap_static.c
***************
*** 965,966 ****
--- 967,974 ----
  
+ <IfModule mod_python.c>
+   Alias /mod_python/ /home/httpd/mod_python/
+   <Directory /home/httpd/mod_python>
+     AllowOverride FileInfo
+   </Directory>
+ </IfModule>
  ### Section 3: Virtual Hosts
CAT

%postun
perl -pi -e 's|^LoadModule python_module|#LoadModule python_module|g' \
 	/etc/httpd/conf/httpd.conf
perl -pi -e 's|^AddModule mod_python.c|#AddModule mod_python.c|g' \
	/etc/httpd/conf/httpd.conf

%files
%defattr(-,root,root)
%attr(0755,root,root) /usr/lib/apache/mod_python.so
/usr/lib/python1.5/site-packages/mod_python
/home/httpd/mod_python
%doc COPYRIGHT doc/*.html

%changelog
* Mon Jun 13 2000 Mads Kiilerich <mads@kiilerich.com>
- Made initial version of mod_python rpm
From sbi at acse.be  Tue Jun 13 19:08:18 2000
From: sbi at acse.be (=?iso-8859-1?Q?St=E9phane_Bidoul?=)
Date: Fri Jan  9 21:45:55 2004
Subject: [mod_python] Slashes...
Message-ID: <021c01bfd559$fdc62490$66a679c1@spirou>

A potential problem with slashes:
Windows NT accepts / or \, while Windows 9x accepts only \.

It means that with this directive:

<Directory "c:/soft/apache/htdocs/test2/">
  PythonHandler test2
</Directory>

mod_python ends up importing c:/soft/apache/htdocs/test2/\test2.py.

It works fine so it should not be an issue. 

Could it be an issue in get_request_object where the trailing
slash is first removed then added again? 
[I'm not sure to understand that area so I can't tell myself]

Maybe the functions from os.path should be used to be safe?

Also, I've found this in the apache doc:

<ApacheDocExcerpt>
The directives that accept filenames as arguments now must use Windows filenames instead of Unix ones. However, because Apache uses Unix-style names internally, you must use forward slashes, not backslashes. Drive letters can be used; if omitted, the drive with the Apache executable will be assumed.
</ApacheDocExcerpt>

So I'm not sure what is the right approach...

Regards.

-sbi



From sbi at acse.be  Tue Jun 13 19:07:53 2000
From: sbi at acse.be (=?iso-8859-1?Q?St=E9phane_Bidoul?=)
Date: Fri Jan  9 21:45:55 2004
Subject: [mod_python] Re: Another threading issue: chdir (fwd)
References: <Pine.LNX.4.21.0006121714500.12547-100000@saturn.ispol.com>
Message-ID: <020a01bfd559$eef3e470$66a679c1@spirou>

>I have another idea - unless I'm missing something obvious, the way to
>deal with this would be to add the directory to the path at interpreter
>creation time in mod_python.c.

I see nothing wrong with that either. 
I think is done already in ChildInitHandler when 
PythonImport is specified, so why not do it systematically.

-sbi





From gstein at lyra.org  Wed Jun 14 00:04:13 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:45:55 2004
Subject: [mod_python] mod_snake
Message-ID: <20000614000413.G27338@lyra.org>

fyi...

http://modsnake.sourceforge.net/

-- 
Greg Stein, http://www.lyra.org/

From richard at whitequeen.com  Tue Jun 13 05:35:59 2000
From: richard at whitequeen.com (richard offer)
Date: Fri Jan  9 21:45:55 2004
Subject: [mod_python] mod_snake
In-Reply-To: Greg Stein <gstein@lyra.org>
       "[mod_python] mod_snake" (Jun 14, 12:04am)
Message-ID: <200006131235.e5DCZxu10283@erij.whitequeen.com>

* $ from gstein@lyra.org at "14-Jun:12:04am" | sed "1,$s/^/* /" 
*
*
* fyi...
* 
* http://modsnake.sourceforge.net/

Has anyone played with it yet, pros ? cons ? I like the idea of moving
to Apache 2.0, and it seems to have reasonable documentation (probably
my biggest gripe about mod_python is the sparse docs).

On the other hand I'm close to getting something to show...

* Greg Stein, http://www.lyra.org/

richard.


-- 
richard offer @ home 
          84 FE 48 E4 74 D0 26 D4  31 8E B6 86 98 74 E2 7C  8A FB BF A3
___________________________________http://216.185.15.144/users/richard/

From grisha at ispol.com  Wed Jun 14 12:34:46 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:55 2004
Subject: [mod_python] mod_snake
In-Reply-To: <200006131235.e5DCZxu10283@erij.whitequeen.com>
Message-ID: <Pine.LNX.4.21.0006141233360.22477-100000@saturn.ispol.com>

On Tue, 13 Jun 2000, richard offer wrote:

> to Apache 2.0, and it seems to have reasonable documentation (probably
> my biggest gripe about mod_python is the sparse docs).

Hmmm... Everyone else said the documentation was very thorough. What do
think is missing?

Grisha


From sjbotha at email.com  Wed Jun 14 19:08:40 2000
From: sjbotha at email.com (Sarel J. Botha)
Date: Fri Jan  9 21:45:55 2004
Subject: [mod_python] Just displays
Message-ID: <20000614190839.A30053@home>

I'm having a bit of a problem with mod_python. The module gets loaded (I
can see in the logs), but when I access a .py file it just prints the
source.

I've got this in srm.conf:
AddHandler python-program .py

As far as I can tell, that's all that's needed, right?

Thanks
-- 
------------------
Sarel Botha
sjbotha@email.com
------------------

99 little bugs in the code, 99 bugs in the code,
          fix one bug, compile it again...
          101 little bugs in the code....


From richard at whitequeen.com  Tue Jun 13 07:35:21 2000
From: richard at whitequeen.com (richard offer)
Date: Fri Jan  9 21:45:55 2004
Subject: [mod_python] mod_snake
In-Reply-To: Gregory Trubetskoy <grisha@ispol.com>
       "Re: [mod_python] mod_snake" (Jun 14, 12:34pm)
Message-ID: <200006131435.e5DEZLM10444@erij.whitequeen.com>

* $ from grisha@ispol.com at "14-Jun:12:34pm" | sed "1,$s/^/* /" 
*
*
* 
* On Tue, 13 Jun 2000, richard offer wrote:
* 
* > to Apache 2.0, and it seems to have reasonable documentation (probably
* > my biggest gripe about mod_python is the sparse docs).
* 
* Hmmm... Everyone else said the documentation was very thorough. What do
* think is missing?

It took me a while to work out the relationship between the PythonHandler 
<entry> and the location of the file.py I wanted to run. I figured it out
eventually, but these are the sorts of questions that need to be obvious,
sicne they are only met by first time users (when I was a system manager, 
if it took me any longer than an 1/2 day to get a piece of software working,
it went to the the bottome the queue---under those rules I'd be using 
php now).

There are no function prototypes in the docs, it took me a while to
figure out that req.read() needed a length argument.

I have to refer to the Apache C docs to work out what members I can use
in the request structure.

The examples are too short, something demonstrating the handling of url
args would have saved me a day, needing to test for req.method as well
as req.args is more hassle. 

I hope to publish my code in the next few weeks (interface to a MySQL 
image database with search etc), maybe just a few contributed demos
would help. I'd like to see some drop in contributed modules like
php/mod_perl has.


Now I admit that I'm new to this (web programming) but I'm a self taught C
OS programmer, so if I can waste days in figuring it out, this isn't CP4E.

Please don't take the above as anything but constructive critism, I like
mod_python, it got me off my ass and working on the web site which I'd
been postponing for months, and for that I'm grateful.

* 
* Grisha
* 

richard.


-- 
richard offer @ home 
          84 FE 48 E4 74 D0 26 D4  31 8E B6 86 98 74 E2 7C  8A FB BF A3
___________________________________http://216.185.15.144/users/richard/

From martin at src.no  Thu Jun 15 10:48:12 2000
From: martin at src.no (Martin Jenssen)
Date: Fri Jan  9 21:45:55 2004
Subject: [mod_python] Difficulties with Windows NT/Apache/mod_python
Message-ID: <Pine.LNX.4.21.0006151030550.23457-100000@lade.src.no>

Hello,

I am getting some strange messages when trying to setup Apache with
mod_python on Windows NT.  I used the precompiled binary of mod_python 2.2
as found on http://www.modpython.org/, the precompiled binary of Apache
1.3.12 as found on http://www.apache.org/ and Windows NT 4.0 Server.

When I try to start Apache with mod_python configured as specified in the
documentation, I get these messages:

"""
make_obcallback(): could not import mod_python.apache.
make_obcallback(): could not call init.
Apache/1.3.12 (Win32) mod_python/2.2 Python/1.5.2 running...
"""

Strangely, it doesn't quit, but continues to try to serve web pages.  For
each .py file I try to reach via the web browser, I get these messages
thrown into the error.log file:

"""
[Thu Jun 15 10:37:45 2000] [error] [client 193.71.134.144] \
	python_handler: get_obcallback returned no obCallBack!
"""


Martin Jenssen


From daniel at copyleft.no  Thu Jun 15 11:03:42 2000
From: daniel at copyleft.no (Hr. Daniel Mikkelsen)
Date: Fri Jan  9 21:45:55 2004
Subject: [mod_python] Difficulties with Windows NT/Apache/mod_python
In-Reply-To: <Pine.LNX.4.21.0006151030550.23457-100000@lade.src.no>
Message-ID: <Pine.LNX.4.10.10006151100460.6024-100000@unity.copyleft.no>

> make_obcallback(): could not import mod_python.apache.
> make_obcallback(): could not call init.
> Apache/1.3.12 (Win32) mod_python/2.2 Python/1.5.2 running...

I got these messages when I copied the _files_ in the
lib/python/mod_python dir into site-packages, instead 
of copying the entire _directory_, by mistake. 

Anyway, it's a problem of your python interpreter not 
finding the mod_python modules. Use PYTHONPATH in the 
environment or PythonPath in the apache.conf. 

-- Daniel Mikkelsen, Copyleft Software



From grisha at ispol.com  Thu Jun 15 07:44:04 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:55 2004
Subject: [mod_python] Difficulties with Windows NT/Apache/mod_python
In-Reply-To: <Pine.LNX.4.21.0006151030550.23457-100000@lade.src.no>
Message-ID: <Pine.LNX.4.21.0006150742280.28199-100000@saturn.ispol.com>

Sounds to me like the mod_python package is not in your pythonpath.

BTW, the win32 binary is unstable because of some thread problems. 2.4
should be considerably more stable and will come out in a couple of days.

Grisha

On Thu, 15 Jun 2000, Martin Jenssen wrote:

> Hello,
> 
> I am getting some strange messages when trying to setup Apache with
> mod_python on Windows NT.  I used the precompiled binary of mod_python 2.2
> as found on http://www.modpython.org/, the precompiled binary of Apache
> 1.3.12 as found on http://www.apache.org/ and Windows NT 4.0 Server.
> 
> When I try to start Apache with mod_python configured as specified in the
> documentation, I get these messages:
> 
> """
> make_obcallback(): could not import mod_python.apache.
> make_obcallback(): could not call init.
> Apache/1.3.12 (Win32) mod_python/2.2 Python/1.5.2 running...
> """
> 
> Strangely, it doesn't quit, but continues to try to serve web pages.  For
> each .py file I try to reach via the web browser, I get these messages
> thrown into the error.log file:
> 
> """
> [Thu Jun 15 10:37:45 2000] [error] [client 193.71.134.144] \
> 	python_handler: get_obcallback returned no obCallBack!
> """
> 
> 
> Martin Jenssen
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From sjbotha at email.com  Thu Jun 15 21:54:59 2000
From: sjbotha at email.com (Sarel J. Botha)
Date: Fri Jan  9 21:45:55 2004
Subject: [mod_python] Re: Just displays
In-Reply-To: <20000614190839.A30053@home>; from  on Wed, Jun 14, 2000 at 07:08:40PM +0200
References: <20000614190839.A30053@home>
Message-ID: <20000615215457.A9676@home>

On Wed, Jun 14, 2000 at 07:08:40PM +0200, I wrote:
> I'm having a bit of a problem with mod_python. The module gets loaded (I
> can see in the logs), but when I access a .py file it just prints the
> source.

I still can't get it working.

I've got LoadModule python_module /usr/local/lib/apache/1.3/mod_python.so
in httpd.conf and the module loads, as I can see it in the logs:
[Thu Jun 15 21:40:52 2000] [notice] Apache/1.3.12 (Unix) Debian/GNU PHP/4.0RC1 mod_python/2.2 Python/1.5.2 configured -- resuming normal operations

I've got this in srm.conf:
  AddHandler python-program .py

It just prints the file, as if the AddHandler directive weren't there.

Thanks
-- 
------------------
Sarel Botha
sjbotha@email.com
------------------

99 little bugs in the code, 99 bugs in the code,
          fix one bug, compile it again...
          101 little bugs in the code....


From grisha at ispol.com  Thu Jun 15 18:00:31 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:55 2004
Subject: [mod_python] Re: Just displays
In-Reply-To: <20000615215457.A9676@home>
Message-ID: <Pine.LNX.4.21.0006151759230.28199-100000@saturn.ispol.com>

On Thu, 15 Jun 2000, Sarel J. Botha wrote:

> On Wed, Jun 14, 2000 at 07:08:40PM +0200, I wrote:
> 
> I've got this in srm.conf:
>   AddHandler python-program .py
> 
> It just prints the file, as if the AddHandler directive weren't there.

Are you sure your srm.conf file is being read at all? Move the directive
into httpd.conf. srm.conf is obsolete and shouldn't be used anyway.

Grisha


From sjbotha at email.com  Fri Jun 16 02:29:10 2000
From: sjbotha at email.com (Sarel J. Botha)
Date: Fri Jan  9 21:45:55 2004
Subject: [mod_python] Re: Just displays
In-Reply-To: <Pine.LNX.4.21.0006151759230.28199-100000@saturn.ispol.com>; from grisha@ispol.com on Thu, Jun 15, 2000 at 06:00:31PM -0400
References: <20000615215457.A9676@home> <Pine.LNX.4.21.0006151759230.28199-100000@saturn.ispol.com>
Message-ID: <20000616022908.A11353@home>

On Thu, Jun 15, 2000 at 06:00:31PM -0400, Gregory Trubetskoy wrote:
> Are you sure your srm.conf file is being read at all? Move the directive
> into httpd.conf. srm.conf is obsolete and shouldn't be used anyway.

That's great to hear. I've always thought it was a bit silly to have so
many different config files.

It is reading srm.conf, I just added a .cgi Handler and it works. Without
it, it doesn't.

Thanks
-- 
------------------
Sarel Botha
sjbotha@email.com
------------------

99 little bugs in the code, 99 bugs in the code,
          fix one bug, compile it again...
          101 little bugs in the code....


From geoff at ijane.com  Fri Jun 16 10:54:15 2000
From: geoff at ijane.com (geoff@ijane.com)
Date: Fri Jan  9 21:45:55 2004
Subject: [mod_python] python rewrite of mod_usertrack
Message-ID: <20000616155414.IQGO860.mta1biz.bizmailsrvcs.net@web1biz.bizmailsrvcs.net>

Here is a first pass at a session tracking module using mod_python.
It is basically a mod_usertrack rip-off.
Let me know what you think.
-geoff greenberg

From geoff at ijane.com  Fri Jun 16 11:19:33 2000
From: geoff at ijane.com (geoff@ijane.com)
Date: Fri Jan  9 21:45:56 2004
Subject: [mod_python] python rewrite of mod_usertrack (actual module this time)
Message-ID: <20000616161933.ANH135729.mta1biz.bizmailsrvcs.net@web1biz.bizmailsrvcs.net>

Sorry.
I didn't realize that attachment didn't work.
Here is the module (usertrack.py):

"""This module is a shameless rewrite of mod_usertrack in python.  It should
operate in most respects like mod_usertrack.  The exception would be that it
always sets a 4 digit year for an expire date.

Logging
This will be handled by mod_log_config, the custom log module.  The cookie
will be available by using the token, "%{session_cookie}n".
For example:

LogFormat "%t \"%r\" %>s \"%{session_cookie}n\"" session
CustomLog /usr/local/apache/logs/session_log session

PythonOptions
There are three options that can be configured: CookieExpires, CookieName
and CookieTracking.   These basically work the same as mod_usertrack's
directives of the same name.

CookieExpires
This option sets an expiration time for the cookie generated by this module.
This time can be either a number of seconds or a string describing the
amount of time.  If this option does not exist the cookie will expire when
the browser's session does.  The time string must be quoted and is in the
format of a space separeated list of "number label" pairs.  Valid labels
are: years, months, weeks, days, hours, minutes, seconds.

CookieName
If this option exists the default name of the cookie will be whatever the
label specifies.

CookieTracking
This option is required if you will to use this module.  It's value must be
"on" for this module to operate.


httpd.conf example:

<Directory />
    PythonPath "['/usr/lib/python1.5', '/usr/lib/python1.5/site-packages']"

    PythonDebug
    PythonOption CookieName k3WL_c00KI3_nAM3
    PythonOption CookieTracking on
    PythonOption CookieExpires "10 years 4 months 2 weeks 3 days 2 hours 36
seconds"
    PythonFixupHandler usertrack
</Directory>

"""
__version__ = "$Id: usertrack.py,v 1.1 2000/06/02 09:00:31 geoff Exp $"
from mod_python import apache
import re, string, time, os

isDigit = re.compile("^\d+$")
isSpace = re.compile("\s+")

FACTOR = {
    'years': 60 * 60 * 24 * 365,
    'months': 60 * 60 * 24 * 30,
    'weeks': 60 * 60 * 24 * 7,
    'days': 60 * 60 * 24,
    'hours': 60 * 60,
    'minutes': 60,
    'seconds': 1,
    }            

COOKIE_NAME = "Apache_Python"

def fixuphandler(r):
    global COOKIE_NAME
    opt = r.get_options()
    if opt['CookieTracking'] != 'on':
        return apache.DECLINED
    else:
        if opt.has_key('CookieName'): COOKIE_NAME = opt['CookieName']
        try:
            m = re.search("(?:^|\s+)%s=(?P<cookieValue>[^;]+)" %
COOKIE_NAME, \
                          r.headers_in['Cookie'])
            r.notes['session_cookie'] = m.group('cookieValue')
            return apache.DECLINED
        except:
            expires = 0
            if opt.has_key('CookieExpires'):
                expires = r.request_time + \
                                 parseExpire(opt['CookieExpires'])
            make_cookie(r, COOKIE_NAME, expires)
    return apache.OK
        
def make_cookie(r, name, expires):
    """Set a unique cookie for user tracking."""
    cookieValue = "%s.%d%ld%ld" % (r.hostname, os.getpid(), r.request_time,
\
                                   time.clock())
    if expires == 0:
        r.headers_out['Set-Cookie'] = "%s=%s; path=/" % (name, \
                                                         cookieValue)
    else:
        r.headers_out['Set-Cookie'] = "%s=%s; path=/; expires=%s GMT" % \
            (name, cookieValue, time.strftime("%A, %d-%b-%Y %H:%M:%S", \
            time.gmtime(expires)))  
    r.notes['session_cookie'] = cookieValue
    return

def parseExpire(expire):
    """Return number of seconds from a formated string."""
    if isDigit.search(expire): return expire
    seconds = 0
    t = isSpace.split(expire)
    tLen = len(t)
    i = 0
    while i < tLen:
        if isDigit.search(t[i]):
            seconds = seconds + (FACTOR.get(string.lower(t[i + 1]), 0) * \
                                 string.atoi(t[i]))
        i = i + 2
    return seconds

From grisha at ispol.com  Fri Jun 16 12:43:43 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:56 2004
Subject: [mod_python] python rewrite of mod_usertrack (actual module this
 time)
In-Reply-To: <20000616161933.ANH135729.mta1biz.bizmailsrvcs.net@web1biz.bizmailsrvcs.net>
Message-ID: <Pine.LNX.4.21.0006161243020.1238-100000@saturn.ispol.com>

Nice work!

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Fri, 16 Jun 2000 geoff@ijane.com wrote:

> Sorry.
> I didn't realize that attachment didn't work.
> Here is the module (usertrack.py):
> 
> """This module is a shameless rewrite of mod_usertrack in python.  It should
> operate in most respects like mod_usertrack.  The exception would be that it


From jam at quark.emich.edu  Sat Jun 17 10:33:54 2000
From: jam at quark.emich.edu (Jeff)
Date: Fri Jan  9 21:45:56 2004
Subject: [mod_python] release of 2.4 or CVS access
Message-ID: <20000617103354.A3690@quark.emich.edu>

Greetings,

I'd like to do some work with mod_python.. I noticed on the website that 2.3
has a bug that will be fixed in 2.4. 

when and where can I find 2.4? is there a CVS repository I can check out the
code from? what's the bug in 2.3 that's so nasty?

regards,
J
-- 
|| visit gfd <http://quark.emich.edu/>
|| psa member -- <http://www.python.org/psa/> 

From grisha at ispol.com  Sat Jun 17 11:15:51 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:56 2004
Subject: [mod_python] release of 2.4 or CVS access
In-Reply-To: <20000617103354.A3690@quark.emich.edu>
Message-ID: <Pine.LNX.4.21.0006171111280.5577-100000@saturn.ispol.com>

On Sat, 17 Jun 2000, Jeff wrote:

> when and where can I find 2.4? 

when - whenever it is done. Some time next week.

where - same place as 2.2 :-)

> is there a CVS repository I can check out the code from? 

there is a CVS repository, but only I have access to it.... I'm
considering putting it out on sourceforge.

> what's the bug in 2.3 that's so nasty?

It basically won't run. You can still download it from the same place as
2.2 - just substitute 2.2 for 2.3. 

Regards - 

Grisha


From jam at quark.emich.edu  Sat Jun 17 11:26:00 2000
From: jam at quark.emich.edu (Jeff)
Date: Fri Jan  9 21:45:56 2004
Subject: [mod_python] access to ap_send_fd from python
Message-ID: <20000617112600.D5135@quark.emich.edu>

Greetings,

I was looking through the API documentation and found the ap_send_fd
function (http://dev.apache.org/apidoc/apidoc_ap_send_fd.html). It's purpose
is to send the contents of a FILE* to the client. 

This seems appropriate when static files need to be served-- decode the URL
the client is asking for, open the file, set the appropriate headers
(content-type in particular), call this function, then close the file. This
moves the 'work' of sending the file into the C code, instead of using
Python, which would seem to be quite a bit faster.

Could this be considered for a future releases of mod_python? 

Are there any issues I should be aware of before trying to get it to work?

Regards,
J
-- 
|| visit gfd <http://quark.emich.edu/>
|| psa member -- <http://www.python.org/psa/> 

From jam at quark.emich.edu  Sat Jun 17 11:30:55 2000
From: jam at quark.emich.edu (Jeff)
Date: Fri Jan  9 21:45:56 2004
Subject: [mod_python] release of 2.4 or CVS access
In-Reply-To: <Pine.LNX.4.21.0006171111280.5577-100000@saturn.ispol.com>; from grisha@ispol.com on Sat, Jun 17, 2000 at 11:15:51AM -0400
References: <20000617103354.A3690@quark.emich.edu> <Pine.LNX.4.21.0006171111280.5577-100000@saturn.ispol.com>
Message-ID: <20000617113055.E5135@quark.emich.edu>

On Sat, Jun 17, 2000 at 11:15:51AM -0400, Gregory Trubetskoy wrote:
> 
> On Sat, 17 Jun 2000, Jeff wrote:
> 
> > when and where can I find 2.4? 
> 
> when - whenever it is done. Some time next week.
> 

clearly ;) I got the impression that it was a simple problem of a NULL
pointer and so should be fairly easy to fix. I assume this means there will
be more than just this change in 2.4? what's on the list?

Regards,
J
-- 
|| visit gfd <http://quark.emich.edu/>
|| psa member -- <http://www.python.org/psa/> 

From grisha at ispol.com  Sat Jun 17 16:04:00 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:56 2004
Subject: [mod_python] release of 2.4 or CVS access
In-Reply-To: <20000617113055.E5135@quark.emich.edu>
Message-ID: <Pine.LNX.4.21.0006171602350.6292-100000@saturn.ispol.com>

On Sat, 17 Jun 2000, Jeff wrote:

> clearly ;) I got the impression that it was a simple problem of a NULL
> pointer and so should be fairly easy to fix. I assume this means there will
> be more than just this change in 2.4? what's on the list?

Not much really.

It should work cleanly on Win32 (multithreaded) and then I'm trying add a
tutorial to the documentation.

Grisha


From seant at alum.mit.edu  Sun Jun 18 15:08:15 2000
From: seant at alum.mit.edu (Sean True)
Date: Fri Jan  9 21:45:56 2004
Subject: [mod_python] mod_python style redirection.
Message-ID: <4.3.2.7.2.20000618150623.00bb75f0@pop.ne.mediaone.net>

Any one care to suggest a mod_python appropriate way to redirect a request 
to another page? The ap_internal_redirect() function looks
appropriate but does not seem to be wrapped.

TIA.

-- Sean

==========
Sean True
seant@alum.mit.edu


From grisha at ispol.com  Sun Jun 18 16:11:31 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:56 2004
Subject: [mod_python] mod_python style redirection.
In-Reply-To: <4.3.2.7.2.20000618150623.00bb75f0@pop.ne.mediaone.net>
Message-ID: <Pine.LNX.4.21.0006181608100.19774-100000@saturn.ispol.com>

Something like this should work:

	req.headers_out["Location"] = "http://www.redirectto.com/"
	return apache.HTTP_MOVED_TEMPORARILY

Grisha

On Sun, 18 Jun 2000, Sean True wrote:

> Any one care to suggest a mod_python appropriate way to redirect a request 
> to another page? The ap_internal_redirect() function looks
> appropriate but does not seem to be wrapped.
> 
> TIA.
> 
> -- Sean
> 
> ==========
> Sean True
> seant@alum.mit.edu
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From grisha at ispol.com  Tue Jun 20 11:23:41 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:56 2004
Subject: [mod_python] mod_python 2.4
Message-ID: <Pine.LNX.4.21.0006201117090.27023-100000@saturn.ispol.com>

Mod_python 2.4 is out. Unlike 2.3, this one should work ;-).

There are some major changes since 2.2:

1. The PythonDebug, PythonInterpPerDirectory and PythonNoReload now
require an argument of On or Off. NOTE - THIS WILL REQUIRE YOU TO CHANGE
YOUR CONFIGS IF YOU'RE USING ANY OF THESE DIRECTIVES!!!

2. A new directive, PythonImport allows you to import modules at child
process initialization time. This is good for initializing database
connections, etc, though this approach has some serious limitations. Read
the documentation for details.

3. We think that most thread-related issues have been resolved and that
mod_python is capable of running stably on Win32. There is a Win32
(i3866) DLL binary available for download. A lot of very valuable input
and work on this was done by St?phane Bidoul and Greg Stein.

4. I tried to improve the docuemntation. All mod_python objects are now
documented down to every single attribute, and there is a small tutorial
started. The tutorial will need some improvements - e.g. examples of
how to deal with forms or cookies.

Regards -

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com



From jam at quark.emich.edu  Tue Jun 20 11:25:48 2000
From: jam at quark.emich.edu (Jeff)
Date: Fri Jan  9 21:45:56 2004
Subject: [mod_python] attempting to download 2.4 -- permission denied.
Message-ID: <20000620112548.A15890@quark.emich.edu>

Greetings,

I tried to download v2.4 just now, and I get a 'permission denied' error.
Could you have a look into this issue?

Thanks!

Regards,
J
-- 
|| visit gfd <http://quark.emich.edu/>
|| psa member -- <http://www.python.org/psa/> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 232 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20000620/a1382baa/attachment.bin
From jam at quark.emich.edu  Tue Jun 20 11:36:39 2000
From: jam at quark.emich.edu (Jeff)
Date: Fri Jan  9 21:45:56 2004
Subject: [mod_python] attempting to download 2.4 -- permission denied.
In-Reply-To: <20000620112548.A15890@quark.emich.edu>; from jam@quark.emich.edu on Tue, Jun 20, 2000 at 11:25:48AM -0400
References: <20000620112548.A15890@quark.emich.edu>
Message-ID: <20000620113639.B15890@quark.emich.edu>

On Tue, Jun 20, 2000 at 11:25:48AM -0400, Jeff wrote:
> Greetings,
> 
> I tried to download v2.4 just now, and I get a 'permission denied' error.
> Could you have a look into this issue?
> 
> Thanks!
> 


it's fixed now, carry on ;)

-- 
|| visit gfd <http://quark.emich.edu/>
|| psa member -- <http://www.python.org/psa/> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 232 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20000620/e0661a03/attachment.bin
From xbouska at infima.cz  Tue Jun 20 18:23:24 2000
From: xbouska at infima.cz (Richard Bouska)
Date: Fri Jan  9 21:45:56 2004
Subject: [mod_python] mod_python does not interoperate with CORBA (omniORB)
Message-ID: <20000620182324.E26145@intranet>

Hello

I am trying to convert one of my project from single threaded corba
server (ILU from PARC XEROX) to multithreaded (omniORB 3.0 FROM at&t). 
But I am unable to use the mod_python due some problems with threads.

The script runs fine as a CGI but when I try use mod_python it stucks in 

corba_init call. It freeses before it transfers any byte through the 
iiop protocol.

When I let the apache live in only one thread - apache -X then 
everything 
workes well.

Has anoybody some idea what I shell try?

configuration:

Linux 2.2.12 - debian potato 
mod_python 2.2 (2.4) - I try both - dynamicaly linked  
omniORB 3.0 - beta from CVS
apache 1.3.12


PS: I was using the PyApache and leave it because I thaught that the 
problem 
with omniORB is caused by  some problem in it - but now I dot know 
because both
mod_python and PyApache have the same problem.

Thank You in advance

Richard Bouska
Richard@Bouska.cz


From Howard.Williams at marchFIRST.com  Tue Jun 20 15:46:53 2000
From: Howard.Williams at marchFIRST.com (Howard Williams)
Date: Fri Jan  9 21:45:56 2004
Subject: [mod_python] (no subject)
Message-ID: <002701bfdb09$6e69cf80$1d0eaad1@edalearning.com>

Hi

I've just installed the mod_python using all the latest source code for
apache, python, and from the modpython.org site.

I can't seem to run the tester:

My directories are laid out as follows:

/usr/local/lib/python1.5/site-packages/mod_python/apache.py
/usr/local/lib/python1.5/site-packages/mod_python/
/usr/local/lib/python1.5/site-packages/mod_python/
/usr/local/lib/python1.5/site-packages/mod_python/
/usr/local/lib/python1.5/site-packages/mod_python/


ERROR mod_python: "PythonHandler test"

Traceback (innermost last):

  File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line
96, in Dispatch
    object = self.resolve_object(module, object_str)

  File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line
42, in resolve_object
    obj = getattr(obj, obj_str)

AttributeError: handler


HOWARD WILLIAMS
marchFIRST
23422 Mill Creek Drive., Suite 100
Laguna Hills, CA 92653
ph: (949) 461-5480
fax: (949) 461-5669
howard.williams@marchFIRST.com
www.marchFIRST.com


-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20000620/a50b964a/attachment.htm
From Howard.Williams at marchFIRST.com  Tue Jun 20 16:00:26 2000
From: Howard.Williams at marchFIRST.com (Howard Williams)
Date: Fri Jan  9 21:45:56 2004
Subject: [mod_python] test doesn't work
Message-ID: <003d01bfdb0b$52f1e150$1d0eaad1@edalearning.com>

Hi

I've just installed the mod_python using all the latest source code for
apache, python, and from the modpython.org site.

I can't seem to run the tester:  So I've seen some postings from last month
about this with a similar "AttributeError: handler" title, but they didn't
seem to apply.

When I run "python test.py" (which I'm not convinced is supposed to be
possible) from a command line, I get the following output to stderr:
***********************************************************
Traceback (innermost last):
  File "test.py", line 1, in ?
    from mod_python import apache
  File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line
18, in ?
    import _apache
ImportError: No module named _apache

***********************************************************


My directories are laid out as follows:

/usr/local/lib/python1.5/site-packages/mod_python/apache.py
/usr/local/lib/python1.5/site-packages/mod_python/apache.pyc
/usr/local/lib/python1.5/site-packages/mod_python/cgihandler.py
/usr/local/lib/python1.5/site-packages/mod_python/cgihandler.pyc
/usr/local/lib/python1.5/site-packages/mod_python/httpdapi.py
/usr/local/lib/python1.5/site-packages/mod_python/httpdapi.pyc
/usr/local/lib/python1.5/site-packages/mod_python/zhandler.py
/usr/local/lib/python1.5/site-packages/mod_python/zhandler.pyc


I get this error:
*********************************
ERROR mod_python: "PythonHandler test"

Traceback (innermost last):

  File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line
96, in Dispatch
    object = self.resolve_object(module, object_str)

  File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line
42, in resolve_object
    obj = getattr(obj, obj_str)

AttributeError: handler
************************************************


Here's the apache error_log:
************************************************
[Tue Jun 20 15:47:37 2000] [notice] Apache/1.3.12 (Unix) configured --
resuming normal operations
[Tue Jun 20 15:47:46 2000] [error] PythonHandler test: Traceback (innermost
last):
[Tue Jun 20 15:47:46 2000] [error] PythonHandler test:   File
"/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 96, in
Dispatch
    object = self.resolve_object(module, object_str)
[Tue Jun 20 15:47:46 2000] [error] PythonHandler test:   File
"/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 42, in
resolve_object
    obj = getattr(obj, obj_str)
[Tue Jun 20 15:47:46 2000] [error] PythonHandler test: AttributeError:
handler
************************************************



 Thanks for any help you can provide !!!!   :)


HOWARD WILLIAMS
marchFIRST
23422 Mill Creek Drive., Suite 100
Laguna Hills, CA 92653
ph: (949) 461-5480
fax: (949) 461-5669
howard.williams@marchFIRST.com
www.marchFIRST.com

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20000620/0305da7e/attachment.htm
From grisha at ispol.com  Tue Jun 20 21:41:20 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:56 2004
Subject: [mod_python] test doesn't work
In-Reply-To: <003d01bfdb0b$52f1e150$1d0eaad1@edalearning.com>
Message-ID: <Pine.LNX.4.21.0006202138080.28773-100000@saturn.ispol.com>

There is a module _apache which is only available from within
mod_python. However, if you comment out the 

from mod_python import apache

line, you should be able to import it from the command line.

I'm a little puzzled by this error, since everyone who has experienced it
never gave any logical reason as to what they did to fix this. It seems to
go away magically after they mes around for a while.

I am almost certain that this is caused by

1. a syntax error in test.py
2. a permissions problem

Grisha

On Tue, 20 Jun 2000, Howard Williams wrote:

> Hi
> 
> I've just installed the mod_python using all the latest source code for
> apache, python, and from the modpython.org site.
> 
> I can't seem to run the tester:  So I've seen some postings from last month
> about this with a similar "AttributeError: handler" title, but they didn't
> seem to apply.
> 
> When I run "python test.py" (which I'm not convinced is supposed to be
> possible) from a command line, I get the following output to stderr:
> ***********************************************************
> Traceback (innermost last):
>   File "test.py", line 1, in ?
>     from mod_python import apache
>   File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line
> 18, in ?
>     import _apache
> ImportError: No module named _apache
> 
> ***********************************************************
> 
> 
> My directories are laid out as follows:
> 
> /usr/local/lib/python1.5/site-packages/mod_python/apache.py
> /usr/local/lib/python1.5/site-packages/mod_python/apache.pyc
> /usr/local/lib/python1.5/site-packages/mod_python/cgihandler.py
> /usr/local/lib/python1.5/site-packages/mod_python/cgihandler.pyc
> /usr/local/lib/python1.5/site-packages/mod_python/httpdapi.py
> /usr/local/lib/python1.5/site-packages/mod_python/httpdapi.pyc
> /usr/local/lib/python1.5/site-packages/mod_python/zhandler.py
> /usr/local/lib/python1.5/site-packages/mod_python/zhandler.pyc
> 
> 
> I get this error:
> *********************************
> ERROR mod_python: "PythonHandler test"
> 
> Traceback (innermost last):
> 
>   File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line
> 96, in Dispatch
>     object = self.resolve_object(module, object_str)
> 
>   File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line
> 42, in resolve_object
>     obj = getattr(obj, obj_str)
> 
> AttributeError: handler
> ************************************************
> 
> 
> Here's the apache error_log:
> ************************************************
> [Tue Jun 20 15:47:37 2000] [notice] Apache/1.3.12 (Unix) configured --
> resuming normal operations
> [Tue Jun 20 15:47:46 2000] [error] PythonHandler test: Traceback (innermost
> last):
> [Tue Jun 20 15:47:46 2000] [error] PythonHandler test:   File
> "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 96, in
> Dispatch
>     object = self.resolve_object(module, object_str)
> [Tue Jun 20 15:47:46 2000] [error] PythonHandler test:   File
> "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 42, in
> resolve_object
>     obj = getattr(obj, obj_str)
> [Tue Jun 20 15:47:46 2000] [error] PythonHandler test: AttributeError:
> handler
> ************************************************
> 
> 
> 
>  Thanks for any help you can provide !!!!   :)
> 
> 
> HOWARD WILLIAMS
> marchFIRST
> 23422 Mill Creek Drive., Suite 100
> Laguna Hills, CA 92653
> ph: (949) 461-5480
> fax: (949) 461-5669
> howard.williams@marchFIRST.com
> www.marchFIRST.com
> 
> 


From grisha at ispol.com  Tue Jun 20 22:00:16 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:56 2004
Subject: [mod_python] test doesn't work
In-Reply-To: <Pine.LNX.4.21.0006202138080.28773-100000@saturn.ispol.com>
Message-ID: <Pine.LNX.4.21.0006202157290.28833-100000@saturn.ispol.com>

On Tue, 20 Jun 2000, Gregory Trubetskoy wrote:

> I am almost certain that this is caused by
> 
> 1. a syntax error in test.py
> 2. a permissions problem

OR

3. If the PythonHandler directive is in httpd.conf outside any <Directory>
tags, or if PythonHandler is inside a <Directory> different from that in
which test.py is, then /usr/local/lib/python1.5/test/ gets imported
instead, which, of course, doesn't have a function called "handler".

HTH

Grisha


From miguel at yorku.ca  Wed Jun 21 12:10:31 2000
From: miguel at yorku.ca (Miguel Marques)
Date: Fri Jan  9 21:45:56 2004
Subject: [mod_python] test doesn't work
In-Reply-To: <Pine.LNX.4.21.0006202157290.28833-100000@saturn.ispol.com>
References: <Pine.LNX.4.21.0006202138080.28773-100000@saturn.ispol.com>
	<Pine.LNX.4.21.0006202157290.28833-100000@saturn.ispol.com>
Message-ID: <20000621121031L.miguel@yorku.ca>

On Tue, 20 Jun 2000 22:00:16 -0400 (EDT), Gregory Trubetskoy <grisha@ispol.com> wrote:
> 
> On Tue, 20 Jun 2000, Gregory Trubetskoy wrote:
> 
> > I am almost certain that this is caused by
> > 
> > 1. a syntax error in test.py
> > 2. a permissions problem
> 
> OR
> 
> 3. If the PythonHandler directive is in httpd.conf outside any <Directory>
> tags, or if PythonHandler is inside a <Directory> different from that in
> which test.py is, then /usr/local/lib/python1.5/test/ gets imported
> instead, which, of course, doesn't have a function called "handler".
> 
> HTH
> 
> Grisha
> 
Well, I have the same problem.  I've tried everything I can think of.
This also happened with mod_python/2.2.
My setup is 
SunOS 5.7 Apache/1.3.12 (Unix) ApacheJServ/1.1 mod_perl/1.24 mod_python/2.4 Python/1.5.2

1. I can run test.py with python as apache (my server run under username apache)
2. I think 1. rules it out and I've checked the permissions of the all
   the python files.
3. my directive is 

<Directory "/usr/local/apache/htdocs/test">
    AddHandler python-program .py
    PythonHandler test
    PythonDebug on
</Directory>
and test.py is in /usr/local/apache/htdocs/test

I always get:

ERROR mod_python: "PythonHandler test"

Traceback (innermost last):

  File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 96, in Dispatch
    object = self.resolve_object(module, object_str)

  File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 42, in resolve_object
    obj = getattr(obj, obj_str)

AttributeError: handler

being somewhat new to python I'm unsure on how to proceed to figure
this out.
Any suggestions?
TIA...

							Miguel

C. Miguel Marques, York University, Computing & Communications Services
e-mail: miguel@yorku.ca, voice: (416)736-2100x22684, fax: (416)736-5830

From miguel at yorku.ca  Wed Jun 21 12:27:47 2000
From: miguel at yorku.ca (Miguel Marques)
Date: Fri Jan  9 21:45:56 2004
Subject: [mod_python] test doesn't work (solved?)
In-Reply-To: <20000621121031L.miguel@yorku.ca>
References: <Pine.LNX.4.21.0006202138080.28773-100000@saturn.ispol.com>
	<Pine.LNX.4.21.0006202157290.28833-100000@saturn.ispol.com>
	<20000621121031L.miguel@yorku.ca>
Message-ID: <20000621122747A.miguel@yorku.ca>

On Wed, 21 Jun 2000 12:10:31 -0400, Miguel Marques <miguel@yorku.ca> wrote:
> On Tue, 20 Jun 2000 22:00:16 -0400 (EDT), Gregory Trubetskoy <grisha@ispol.com> wrote:
> > 
> > On Tue, 20 Jun 2000, Gregory Trubetskoy wrote:
> > 
> > > I am almost certain that this is caused by
> > > 
> > > 1. a syntax error in test.py
> > > 2. a permissions problem
> > 
> > OR
> > 
> > 3. If the PythonHandler directive is in httpd.conf outside any <Directory>
> > tags, or if PythonHandler is inside a <Directory> different from that in
> > which test.py is, then /usr/local/lib/python1.5/test/ gets imported
> > instead, which, of course, doesn't have a function called "handler".
> > 
> > HTH
> > 
> > Grisha
> > 
> Well, I have the same problem.  I've tried everything I can think of.
> This also happened with mod_python/2.2.
> My setup is 
> SunOS 5.7 Apache/1.3.12 (Unix) ApacheJServ/1.1 mod_perl/1.24 mod_python/2.4 Python/1.5.2
> 
> 1. I can run test.py with python as apache (my server run under username apache)
> 2. I think 1. rules it out and I've checked the permissions of the all
>    the python files.
> 3. my directive is 
> 
> <Directory "/usr/local/apache/htdocs/test">
>     AddHandler python-program .py
>     PythonHandler test
>     PythonDebug on
> </Directory>

If I add a slash to the end of the directory in the Directory directive it works.
<Directory "/usr/local/apache/htdocs/test/">
    AddHandler python-program .py
    PythonHandler test
    PythonDebug on
</Directory>

I couldn't get a Location directive to work either way, though.
Is there a reason for this which I don't understand?
Thanks.

						  Miguel

C. Miguel Marques, York University, Computing & Communications Services
e-mail: miguel@yorku.ca, voice: (416)736-2100x22684, fax: (416)736-5830





From Howard.Williams at marchFIRST.com  Wed Jun 21 12:24:20 2000
From: Howard.Williams at marchFIRST.com (Howard Williams)
Date: Fri Jan  9 21:45:56 2004
Subject: [mod_python] test doesn't work (solved?)
In-Reply-To: <20000621122747A.miguel@yorku.ca>
Message-ID: <000001bfdbb6$4d3764f0$1d0eaad1@edalearning.com>

Yup !!!!  Adding the / at the end of the <Directory ...> statement did the
trick in httpd.conf

Thanks a bunch

HOWARD WILLIAMS
marchFIRST
23422 Mill Creek Drive., Suite 100
Laguna Hills, CA 92653
ph: (949) 461-5480
fax: (949) 461-5669
howard.williams@marchFIRST.com <mailto:howard.williams@marchFIRST.com>
www.marchFIRST.com



-----Original Message-----
From: Miguel Marques [mailto:miguel@yorku.ca]
Sent: Wednesday, June 21, 2000 9:28 AM
To: mod_python@modpython.org
Subject: Re: [mod_python] test doesn't work (solved?)


On Wed, 21 Jun 2000 12:10:31 -0400, Miguel Marques <miguel@yorku.ca> wrote:
> On Tue, 20 Jun 2000 22:00:16 -0400 (EDT), Gregory Trubetskoy
<grisha@ispol.com> wrote:
> >
> > On Tue, 20 Jun 2000, Gregory Trubetskoy wrote:
> >
> > > I am almost certain that this is caused by
> > >
> > > 1. a syntax error in test.py
> > > 2. a permissions problem
> >
> > OR
> >
> > 3. If the PythonHandler directive is in httpd.conf outside any
<Directory>
> > tags, or if PythonHandler is inside a <Directory> different from that in
> > which test.py is, then /usr/local/lib/python1.5/test/ gets imported
> > instead, which, of course, doesn't have a function called "handler".
> >
> > HTH
> >
> > Grisha
> >
> Well, I have the same problem.  I've tried everything I can think of.
> This also happened with mod_python/2.2.
> My setup is
> SunOS 5.7 Apache/1.3.12 (Unix) ApacheJServ/1.1 mod_perl/1.24
mod_python/2.4 Python/1.5.2
>
> 1. I can run test.py with python as apache (my server run under username
apache)
> 2. I think 1. rules it out and I've checked the permissions of the all
>    the python files.
> 3. my directive is
>
> <Directory "/usr/local/apache/htdocs/test">
>     AddHandler python-program .py
>     PythonHandler test
>     PythonDebug on
> </Directory>

If I add a slash to the end of the directory in the Directory directive it
works.
<Directory "/usr/local/apache/htdocs/test/">
    AddHandler python-program .py
    PythonHandler test
    PythonDebug on
</Directory>

I couldn't get a Location directive to work either way, though.
Is there a reason for this which I don't understand?
Thanks.

						  Miguel

C. Miguel Marques, York University, Computing & Communications Services
e-mail: miguel@yorku.ca, voice: (416)736-2100x22684, fax: (416)736-5830




_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python


From grisha at ispol.com  Wed Jun 21 18:00:25 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:56 2004
Subject: [mod_python] test doesn't work
In-Reply-To: <20000621121031L.miguel@yorku.ca>
Message-ID: <Pine.LNX.4.21.0006211759290.32339-100000@saturn.ispol.com>

How about when you rename test.py to mptest.py and change the
PythonHandler directive accordingly?

Grisha

On Wed, 21 Jun 2000, Miguel Marques wrote:

> On Tue, 20 Jun 2000 22:00:16 -0400 (EDT), Gregory Trubetskoy <grisha@ispol.com> wrote:
> > 
> > On Tue, 20 Jun 2000, Gregory Trubetskoy wrote:
> > 
> > > I am almost certain that this is caused by
> > > 
> > > 1. a syntax error in test.py
> > > 2. a permissions problem
> > 
> > OR
> > 
> > 3. If the PythonHandler directive is in httpd.conf outside any <Directory>
> > tags, or if PythonHandler is inside a <Directory> different from that in
> > which test.py is, then /usr/local/lib/python1.5/test/ gets imported
> > instead, which, of course, doesn't have a function called "handler".
> > 
> > HTH
> > 
> > Grisha
> > 
> Well, I have the same problem.  I've tried everything I can think of.
> This also happened with mod_python/2.2.
> My setup is 
> SunOS 5.7 Apache/1.3.12 (Unix) ApacheJServ/1.1 mod_perl/1.24 mod_python/2.4 Python/1.5.2
> 
> 1. I can run test.py with python as apache (my server run under username apache)
> 2. I think 1. rules it out and I've checked the permissions of the all
>    the python files.
> 3. my directive is 
> 
> <Directory "/usr/local/apache/htdocs/test">
>     AddHandler python-program .py
>     PythonHandler test
>     PythonDebug on
> </Directory>
> and test.py is in /usr/local/apache/htdocs/test
> 
> I always get:
> 
> ERROR mod_python: "PythonHandler test"
> 
> Traceback (innermost last):
> 
>   File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 96, in Dispatch
>     object = self.resolve_object(module, object_str)
> 
>   File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 42, in resolve_object
>     obj = getattr(obj, obj_str)
> 
> AttributeError: handler
> 
> being somewhat new to python I'm unsure on how to proceed to figure
> this out.
> Any suggestions?
> TIA...
> 
> 							Miguel
> 
> C. Miguel Marques, York University, Computing & Communications Services
> e-mail: miguel@yorku.ca, voice: (416)736-2100x22684, fax: (416)736-5830
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From grisha at ispol.com  Wed Jun 21 18:03:00 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:56 2004
Subject: [mod_python] test doesn't work (solved?)
In-Reply-To: <000001bfdbb6$4d3764f0$1d0eaad1@edalearning.com>
Message-ID: <Pine.LNX.4.21.0006211802230.32339-100000@saturn.ispol.com>

This may actually be a bug after all....

Grisha

On Wed, 21 Jun 2000, Howard Williams wrote:

> Yup !!!!  Adding the / at the end of the <Directory ...> statement did the
> trick in httpd.conf
> 
> Thanks a bunch
> 
> HOWARD WILLIAMS
> marchFIRST
> 23422 Mill Creek Drive., Suite 100
> Laguna Hills, CA 92653
> ph: (949) 461-5480
> fax: (949) 461-5669
> howard.williams@marchFIRST.com <mailto:howard.williams@marchFIRST.com>
> www.marchFIRST.com
> 
> 
> 
> -----Original Message-----
> From: Miguel Marques [mailto:miguel@yorku.ca]
> Sent: Wednesday, June 21, 2000 9:28 AM
> To: mod_python@modpython.org
> Subject: Re: [mod_python] test doesn't work (solved?)
> 
> 
> On Wed, 21 Jun 2000 12:10:31 -0400, Miguel Marques <miguel@yorku.ca> wrote:
> > On Tue, 20 Jun 2000 22:00:16 -0400 (EDT), Gregory Trubetskoy
> <grisha@ispol.com> wrote:
> > >
> > > On Tue, 20 Jun 2000, Gregory Trubetskoy wrote:
> > >
> > > > I am almost certain that this is caused by
> > > >
> > > > 1. a syntax error in test.py
> > > > 2. a permissions problem
> > >
> > > OR
> > >
> > > 3. If the PythonHandler directive is in httpd.conf outside any
> <Directory>
> > > tags, or if PythonHandler is inside a <Directory> different from that in
> > > which test.py is, then /usr/local/lib/python1.5/test/ gets imported
> > > instead, which, of course, doesn't have a function called "handler".
> > >
> > > HTH
> > >
> > > Grisha
> > >
> > Well, I have the same problem.  I've tried everything I can think of.
> > This also happened with mod_python/2.2.
> > My setup is
> > SunOS 5.7 Apache/1.3.12 (Unix) ApacheJServ/1.1 mod_perl/1.24
> mod_python/2.4 Python/1.5.2
> >
> > 1. I can run test.py with python as apache (my server run under username
> apache)
> > 2. I think 1. rules it out and I've checked the permissions of the all
> >    the python files.
> > 3. my directive is
> >
> > <Directory "/usr/local/apache/htdocs/test">
> >     AddHandler python-program .py
> >     PythonHandler test
> >     PythonDebug on
> > </Directory>
> 
> If I add a slash to the end of the directory in the Directory directive it
> works.
> <Directory "/usr/local/apache/htdocs/test/">
>     AddHandler python-program .py
>     PythonHandler test
>     PythonDebug on
> </Directory>
> 
> I couldn't get a Location directive to work either way, though.
> Is there a reason for this which I don't understand?
> Thanks.
> 
> 						  Miguel
> 
> C. Miguel Marques, York University, Computing & Communications Services
> e-mail: miguel@yorku.ca, voice: (416)736-2100x22684, fax: (416)736-5830
> 
> 
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From Howard.Williams at marchFIRST.com  Wed Jun 21 15:23:23 2000
From: Howard.Williams at marchFIRST.com (Howard Williams)
Date: Fri Jan  9 21:45:56 2004
Subject: [mod_python] test doesn't work
In-Reply-To: <Pine.LNX.4.21.0006211759290.32339-100000@saturn.ispol.com>
Message-ID: <001001bfdbcf$507b6300$1d0eaad1@edalearning.com>

no problem there

HOWARD WILLIAMS
marchFIRST
23422 Mill Creek Drive., Suite 100
Laguna Hills, CA 92653
ph: (949) 461-5480
fax: (949) 461-5669
howard.williams@marchFIRST.com <mailto:howard.williams@marchFIRST.com>
www.marchFIRST.com



-----Original Message-----
From: Gregory Trubetskoy [mailto:grisha@ispol.com]
Sent: Wednesday, June 21, 2000 3:00 PM
To: Miguel Marques
Cc: mod_python@modpython.org
Subject: Re: [mod_python] test doesn't work



How about when you rename test.py to mptest.py and change the
PythonHandler directive accordingly?

Grisha

On Wed, 21 Jun 2000, Miguel Marques wrote:

> On Tue, 20 Jun 2000 22:00:16 -0400 (EDT), Gregory Trubetskoy
<grisha@ispol.com> wrote:
> >
> > On Tue, 20 Jun 2000, Gregory Trubetskoy wrote:
> >
> > > I am almost certain that this is caused by
> > >
> > > 1. a syntax error in test.py
> > > 2. a permissions problem
> >
> > OR
> >
> > 3. If the PythonHandler directive is in httpd.conf outside any
<Directory>
> > tags, or if PythonHandler is inside a <Directory> different from that in
> > which test.py is, then /usr/local/lib/python1.5/test/ gets imported
> > instead, which, of course, doesn't have a function called "handler".
> >
> > HTH
> >
> > Grisha
> >
> Well, I have the same problem.  I've tried everything I can think of.
> This also happened with mod_python/2.2.
> My setup is
> SunOS 5.7 Apache/1.3.12 (Unix) ApacheJServ/1.1 mod_perl/1.24
mod_python/2.4 Python/1.5.2
>
> 1. I can run test.py with python as apache (my server run under username
apache)
> 2. I think 1. rules it out and I've checked the permissions of the all
>    the python files.
> 3. my directive is
>
> <Directory "/usr/local/apache/htdocs/test">
>     AddHandler python-program .py
>     PythonHandler test
>     PythonDebug on
> </Directory>
> and test.py is in /usr/local/apache/htdocs/test
>
> I always get:
>
> ERROR mod_python: "PythonHandler test"
>
> Traceback (innermost last):
>
>   File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line
96, in Dispatch
>     object = self.resolve_object(module, object_str)
>
>   File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line
42, in resolve_object
>     obj = getattr(obj, obj_str)
>
> AttributeError: handler
>
> being somewhat new to python I'm unsure on how to proceed to figure
> this out.
> Any suggestions?
> TIA...
>
> 							Miguel
>
> C. Miguel Marques, York University, Computing & Communications Services
> e-mail: miguel@yorku.ca, voice: (416)736-2100x22684, fax: (416)736-5830
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python


From grisha at ispol.com  Wed Jun 21 21:33:41 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:56 2004
Subject: [mod_python] test doesn't work (solved?)
In-Reply-To: <20000621122747A.miguel@yorku.ca>
Message-ID: <Pine.LNX.4.21.0006212131300.498-100000@saturn.ispol.com>

On Wed, 21 Jun 2000, Miguel Marques wrote:

> If I add a slash to the end of the directory in the Directory directive it works.
> <Directory "/usr/local/apache/htdocs/test/">

OK, it is actually a bug.

line 108 of mod_python.c, which reads

#define SLASH_S "\\"

should read

#define SLASH_S "/"

If you edit this and recompile, the problem will go away.

Grisha


From miguel at yorku.ca  Thu Jun 22 11:23:01 2000
From: miguel at yorku.ca (Miguel Marques)
Date: Fri Jan  9 21:45:56 2004
Subject: [mod_python] test doesn't work (solved?)
In-Reply-To: <Pine.LNX.4.21.0006212131300.498-100000@saturn.ispol.com>
References: <20000621122747A.miguel@yorku.ca>
	<Pine.LNX.4.21.0006212131300.498-100000@saturn.ispol.com>
Message-ID: <20000622112301P.miguel@yorku.ca>

On Wed, 21 Jun 2000 21:33:41 -0400 (EDT), Gregory Trubetskoy <grisha@ispol.com> wrote:
> 
> On Wed, 21 Jun 2000, Miguel Marques wrote:
> 
> > If I add a slash to the end of the directory in the Directory directive it works.
> > <Directory "/usr/local/apache/htdocs/test/">
> 
> OK, it is actually a bug.
> 
> line 108 of mod_python.c, which reads
> 
> #define SLASH_S "\\"
> 
> should read
> 
> #define SLASH_S "/"
> 
> If you edit this and recompile, the problem will go away.
> 
It does indeed go away. 
Thanks!!!
But note that when using a Location directive it still does not work.
e.g.
<Location "/test">
    AddHandler python-program .py
    PythonHandler test
    PythonDebug on
</Location>

Is this intentional?

							Miguel

C. Miguel Marques, York University, Computing & Communications Services
e-mail: miguel@yorku.ca, voice: (416)736-2100x22684, fax: (416)736-5830

From daniel at copyleft.no  Thu Jun 22 17:36:34 2000
From: daniel at copyleft.no (Hr. Daniel Mikkelsen)
Date: Fri Jan  9 21:45:56 2004
Subject: [mod_python] req.connection.user
Message-ID: <Pine.LNX.4.10.10006221730110.15525-100000@unity.copyleft.no>

Hi.

I'm trying to set up authentication based on the example given in the
tutorial. Everything seems to work, except that i get Null instead of
the username for req.connection.user.

So that if I just test for password with req.get_basic_auth_pw() and not
for user, I get "through" the basic authentication.

The source I'm using is taken straight from the tutorial. 

Any ideas? I'm using the preinstalled apache 1.3.9 on OpenBSD 2.6, with
mod_python as a DSO. I've tried both versions 2.2 and 2.4. 

-- Daniel Mikkelsen, Copyleft Software


From grisha at ispol.com  Fri Jun 23 18:31:54 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:56 2004
Subject: [mod_python] test doesn't work (solved?)
In-Reply-To: <20000622112301P.miguel@yorku.ca>
Message-ID: <Pine.LNX.4.21.0006231821170.7430-100000@saturn.ispol.com>

On Thu, 22 Jun 2000, Miguel Marques wrote:

> But note that when using a Location directive it still does not work.
> e.g.
> <Location "/test">
>     AddHandler python-program .py
>     PythonHandler test
>     PythonDebug on
> </Location>
> 
> Is this intentional?

I don't know if "intentional" is the right word, but it _is_ expected
behaviour.

mod_python prepends the directory to pythonpath, as outlined here:
http://www.modpython.org/live/mod_python-2.4/doc/pythonapi.html#handler

The <Location> directive puts whatever is specified as the argument to it
as the "directory", and mod_python ends up prependind it. But since
"/test" is not a real directory, it doesn't do you any good. I don't think
there is a simple way to find out what the real directory is from
<Location>. If you read the Apache documentation for it, it puts the
emphasis on the fact that <Location> is not in any way linked to the
filesystem.

Grisha


From hunter at userfriendly.net  Fri Jun 23 22:40:41 2000
From: hunter at userfriendly.net (hUnTeR)
Date: Fri Jan  9 21:45:57 2004
Subject: [mod_python] DSO compile
Message-ID: <39541FA9.D23BAB1A@userfriendly.net>

Dear list readers - 

I am currently trying to build the mod_python as a DSO for
apache-1.3.12. I have already compiled as DSO mod_perl, mod_ssl, etc but
i desparately need this module. I would even settle for a static compile
to get this to work (trying to replace our company's current method of
Netscape Enterprise Server with python). I get the following error when
trying to make:

===> src/modules/extra
gcc -c -I/usr/include/python1.5 -I../../os/unix -I../../include  
-DLINUX=2 -DUo
In file included from mod_python.c:89:
/usr/include/python1.5/Python.h:39: config.h: No such file or directory
In file included from /usr/include/python1.5/modsupport.h:52,
                 from /usr/include/python1.5/Python.h:101,
                 from mod_python.c:89:
/usr/lib/gcc-lib/i386-redhat-linux/egcs-2.91.66/include/varargs.h:106:
warning:d
/usr/lib/gcc-lib/i386-redhat-linux/egcs-2.91.66/include/stdarg.h:90:
warning: tn
make[4]: *** [mod_python.so] Error 1
make[3]: *** [all] Error 1
make[2]: *** [subdirs] Error 1
make[2]: Leaving directory `/root/temp/apache_1.3.12/src'
make[1]: *** [build-std] Error 2
make[1]: Leaving directory `/root/temp/apache_1.3.12'
make: *** [build] Error 2

Any ideas? I have even recently rebuilt python to include the ctsybase
and thread modules, but this one is giving me a headache.

Any help would be appreciated.

Regards
-- 
Michael B. Weiner
Systems Administrator/Partner
The UserFriendly Network (UFN)
--

             / /  (_)__  __ ____  __
            / /__/ / _ \/ // /\ \/ /  
           /____/_/_//_/\_,_/ /_/\_\ 

     * * * CHOICE OF A GNU GENERATION * * *

From grisha at ispol.com  Sat Jun 24 10:00:09 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:57 2004
Subject: [mod_python] DSO compile
In-Reply-To: <39541FA9.D23BAB1A@userfriendly.net>
Message-ID: <Pine.LNX.4.21.0006240958150.10701-100000@saturn.ispol.com>

it's saying it's missing config.h.

did you run "make install" after compiling Python?

Grisha

On Fri, 23 Jun 2000, hUnTeR wrote:

> Dear list readers - 
> 
> I am currently trying to build the mod_python as a DSO for
> apache-1.3.12. I have already compiled as DSO mod_perl, mod_ssl, etc but
> i desparately need this module. I would even settle for a static compile
> to get this to work (trying to replace our company's current method of
> Netscape Enterprise Server with python). I get the following error when
> trying to make:
> 
> ===> src/modules/extra
> gcc -c -I/usr/include/python1.5 -I../../os/unix -I../../include  
> -DLINUX=2 -DUo
> In file included from mod_python.c:89:
> /usr/include/python1.5/Python.h:39: config.h: No such file or directory
> In file included from /usr/include/python1.5/modsupport.h:52,
>                  from /usr/include/python1.5/Python.h:101,
>                  from mod_python.c:89:
> /usr/lib/gcc-lib/i386-redhat-linux/egcs-2.91.66/include/varargs.h:106:
> warning:d
> /usr/lib/gcc-lib/i386-redhat-linux/egcs-2.91.66/include/stdarg.h:90:
> warning: tn
> make[4]: *** [mod_python.so] Error 1
> make[3]: *** [all] Error 1
> make[2]: *** [subdirs] Error 1
> make[2]: Leaving directory `/root/temp/apache_1.3.12/src'
> make[1]: *** [build-std] Error 2
> make[1]: Leaving directory `/root/temp/apache_1.3.12'
> make: *** [build] Error 2
> 
> Any ideas? I have even recently rebuilt python to include the ctsybase
> and thread modules, but this one is giving me a headache.
> 
> Any help would be appreciated.
> 
> Regards
> -- 
> Michael B. Weiner
> Systems Administrator/Partner
> The UserFriendly Network (UFN)
> --
> 
>              / /  (_)__  __ ____  __
>             / /__/ / _ \/ // /\ \/ /  
>            /____/_/_//_/\_,_/ /_/\_\ 
> 
>      * * * CHOICE OF A GNU GENERATION * * *
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From hunter at userfriendly.net  Sat Jun 24 11:32:47 2000
From: hunter at userfriendly.net (hUnTeR)
Date: Fri Jan  9 21:45:57 2004
Subject: [mod_python] DSO compile
Message-ID: <3954D49F.199ECBCC@userfriendly.net>

Dear list readers - 

OK, i got around the previously emailed problem and was able to
successfully build a DSO mod_python module. However, when i go to
restart apache, i now receive the following error:

Starting httpd: Syntax error on line 250 of /etc/httpd/conf/httpd.conf:
Cannot load /etc/httpd/modules/mod_python.so into server:
/etc/httpd/modules/mod_python.so: undefined symbol: ct_con_props


Any ideas? Any help would be appreciated.

Regards
-- 
Michael B. Weiner
Systems Administrator/Partner
The UserFriendly Network (UFN)
--

             / /  (_)__  __ ____  __
            / /__/ / _ \/ // /\ \/ /  
           /____/_/_//_/\_,_/ /_/\_\ 

     * * * CHOICE OF A GNU GENERATION * * *
_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python

From hunter at userfriendly.net  Sat Jun 24 12:22:18 2000
From: hunter at userfriendly.net (hUnTeR)
Date: Fri Jan  9 21:45:57 2004
Subject: [mod_python] DSO compile
Message-ID: <3954E03A.E2987217@userfriendly.net>

Dear list readers - 

OK, i got around the previously emailed problem - the ctsybase module
was giving me the errors on start up. So i had to rebuild python from
scratch again without the ctsybase module support. However now when i
rebuild mod_python and go to restart apache it doesnt startup and gives
me "httpd dead but subsys locked"


Any ideas? Any help would be appreciated.

Regards
-- 
Michael B. Weiner
Systems Administrator/Partner
The UserFriendly Network (UFN)
--

             / /  (_)__  __ ____  __
            / /__/ / _ \/ // /\ \/ /  
           /____/_/_//_/\_,_/ /_/\_\ 

     * * * CHOICE OF A GNU GENERATION * * *
_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python
_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python

From jam at quark.emich.edu  Sat Jun 24 13:01:18 2000
From: jam at quark.emich.edu (Jeff)
Date: Fri Jan  9 21:45:57 2004
Subject: [mod_python] DSO compile
In-Reply-To: <3954E03A.E2987217@userfriendly.net>; from hunter@userfriendly.net on Sat, Jun 24, 2000 at 12:22:18PM -0400
References: <3954E03A.E2987217@userfriendly.net>
Message-ID: <20000624130118.E30377@quark.emich.edu>

On Sat, Jun 24, 2000 at 12:22:18PM -0400, hUnTeR wrote:
> Dear list readers - 
> 
> OK, i got around the previously emailed problem - the ctsybase module
> was giving me the errors on start up. So i had to rebuild python from
> scratch again without the ctsybase module support. However now when i
> rebuild mod_python and go to restart apache it doesnt startup and gives
> me "httpd dead but subsys locked"
> 
> 
> Any ideas? Any help would be appreciated.

apache is core dumping. 

I had this problem with an older version of mod_python, and solved it by
putting the "AddModule" and "LoadModule" directives in specific locations in
the httpd.conf file.

I noticed, though, that the 2.4 version *does not* work with this solution.

as a start to the troubleshooting, could you post the specific parameters to
apxs that you used? it would also be useful to know the exact apache
configuration you have for comparison.

regards,
J
-- 
|| visit gfd <http://quark.emich.edu/>
|| psa member -- <http://www.python.org/psa/> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 232 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20000624/d5940662/attachment.bin
From richard at whitequeen.com  Fri Jun 23 19:11:10 2000
From: richard at whitequeen.com (richard offer)
Date: Fri Jan  9 21:45:57 2004
Subject: [mod_python] RFE: expose File descriptor in API
Message-ID: <200006240211.e5O2BAm23684@erij.whitequeen.com>

Hi,

Is is possible to expose the FD that req.write() is using to the API
? Is this worth it ?

I'm in the process of switching from HTMLgen to HyperText as my text
generator and that has a writeto() method that takes a FD as an argument.

Wont this allow for progressive loading ?

Just a thought.

richard.

-- 
richard offer @ home 
          84 FE 48 E4 74 D0 26 D4  31 8E B6 86 98 74 E2 7C  8A FB BF A3
___________________________________http://216.185.15.144/users/richard/

From grisha at ispol.com  Sat Jun 24 14:43:03 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:57 2004
Subject: [mod_python] RFE: expose File descriptor in API
In-Reply-To: <200006240211.e5O2BAm23684@erij.whitequeen.com>
Message-ID: <Pine.LNX.4.21.0006241438330.11343-100000@saturn.ispol.com>


On Fri, 23 Jun 2000, richard offer wrote:

> I'm in the process of switching from HTMLgen to HyperText as my text
> generator and that has a writeto() method that takes a FD as an argument.

I don't think there is such a thing as a file descriptor that one can
write to within apache. Also, writeto() would need to know how to handle
HTTP errors.

> Wont this allow for progressive loading ?

What's "progressive loading"?

Grisha


From dwallace at delanet.com  Sun Jun 25 08:41:23 2000
From: dwallace at delanet.com (Dave)
Date: Fri Jan  9 21:45:57 2004
Subject: [mod_python] test doesn't work (solved?)
Message-ID: <3955FDF3.DC59F96B@delanet.com>

I've been using the Location directive for a bit now, here is how it
looks for me:

<Location /wpy >
  SetHandler python-program
  PythonDebug On
  PythonPath "sys.path+['/devel/WEB/Webware/WebKit']"
  PythonHandler webkit_handler
</Location>

The key here is the undocumented feature of PythonPath that it
apparently evals its argument. I've been meaning to ask about this since
at some point this could get broken in development and I'd be up a
creek. This is certainly handy but what isn't nice is that I suppose
/something/wpy is also being appended to the PYTHONPATH wether I want or
not.  Maybe a directive to append paths to the default PYTHONPATH would
be in order?

BTW, the nice thing about using Location is the fact that for the
particular application I'm using there is only a single handler and all
content is delivered through that handler by the application. Having to
specify a Directory just doesn't seem quite right.

Dave.

On Fri, 23 Jun 2000, Gregory Trubetskoy wrote:

>On Thu, 22 Jun 2000, Miguel Marques wrote:

>> But note that when using a Location directive it still does not work.

>> e.g.
>> <Location "/test">
>>     AddHandler python-program .py
>>     PythonHandler test
>>     PythonDebug on
>> </Location>
>>
>> Is this intentional?

>I don't know if "intentional" is the right word, but it _is_ expected
>behaviour.

>mod_python prepends the directory to pythonpath, as outlined here:
>http://www.modpython.org/live/mod_python-2.4/doc/pythonapi.html#handler

>The <Location> directive puts whatever is specified as the argument to
it
>as the "directory", and mod_python ends up prependind it. But since
>"/test" is not a real directory, it doesn't do you any good. I don't
think
>there is a simple way to find out what the real directory is from
><Location>. If you read the Apache documentation for it, it puts the
>emphasis on the fact that <Location> is not in any way linked to the
>filesystem.



From grisha at ispol.com  Sun Jun 25 15:55:04 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:57 2004
Subject: [mod_python] test doesn't work (solved?)
In-Reply-To: <3955FDF3.DC59F96B@delanet.com>
Message-ID: <Pine.LNX.4.21.0006251540480.24945-100000@saturn.ispol.com>

On Sun, 25 Jun 2000, Dave wrote:

> I've been using the Location directive for a bit now, here is how it
> looks for me:
> 
> <Location /wpy >
>   SetHandler python-program
>   PythonDebug On
>   PythonPath "sys.path+['/devel/WEB/Webware/WebKit']"
>   PythonHandler webkit_handler
> </Location>
> 
> The key here is the undocumented feature of PythonPath that it
> apparently evals its argument. I've been meaning to ask about this since
> at some point this could get broken in development and I'd be up a
> creek. 

I don't think this is going away - there is no simpler way to specify the
pythonpath than in python syntax which implies evaling.

> This is certainly handy but what isn't nice is that I suppose
> /something/wpy is also being appended to the PYTHONPATH wether I want or
> not.  

Yes, it's "/wpy", actually. Unfortunately, there is no way to tell at the
time the directives are being processed whether it's <Location> or
<Directive>. One option may be not to intriduce another directive,
something like PythonDoNotModifyPath or something. 

> Maybe a directive to append paths to the default PYTHONPATH would
> be in order?

Originally, I considered something like using "+['/some/path']" to mean
append or "['/some/path']+" to prepend. There turned out to be some not so
obvious issues, such as the fact that with .htaccess, the directive gets
processed with every hit, so you would have to make sure to act on it only
once, the first time.

It _could_ be done, but it went against my principle to keep it simple, so
I decided to save for it later since I had more important features to
roll out.

> BTW, the nice thing about using Location is the fact that for the
> particular application I'm using there is only a single handler and all
> content is delivered through that handler by the application. Having to
> specify a Directory just doesn't seem quite right.

Not sure I understand this completely - could you elaborate a bit?

Grisha


From grisha at ispol.com  Sun Jun 25 16:51:58 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:57 2004
Subject: [mod_python] CVS
Message-ID: <Pine.LNX.4.21.0006251650370.25128-100000@saturn.ispol.com>

Someone was asking about CVS - 

You should be able to get CVS access from sourceforge. Go to 
http://sourceforge.net/projects/modpython for details.

Grisha



From gstein at lyra.org  Sun Jun 25 13:56:31 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:45:57 2004
Subject: [mod_python] test doesn't work (solved?)
In-Reply-To: <Pine.LNX.4.21.0006251540480.24945-100000@saturn.ispol.com>; from grisha@ispol.com on Sun, Jun 25, 2000 at 03:55:04PM -0400
References: <3955FDF3.DC59F96B@delanet.com> <Pine.LNX.4.21.0006251540480.24945-100000@saturn.ispol.com>
Message-ID: <20000625135631.F29590@lyra.org>

On Sun, Jun 25, 2000 at 03:55:04PM -0400, Gregory Trubetskoy wrote:
> On Sun, 25 Jun 2000, Dave wrote:
> > I've been using the Location directive for a bit now, here is how it
> > looks for me:
> > 
> > <Location /wpy >
> >   SetHandler python-program
> >   PythonDebug On
> >   PythonPath "sys.path+['/devel/WEB/Webware/WebKit']"
> >   PythonHandler webkit_handler
> > </Location>
> > 
> > The key here is the undocumented feature of PythonPath that it
> > apparently evals its argument. I've been meaning to ask about this since
> > at some point this could get broken in development and I'd be up a
> > creek. 
> 
> I don't think this is going away - there is no simpler way to specify the
> pythonpath than in python syntax which implies evaling.

Huh? How about specifying the path in standard DIR:DIR:DIR notation, and
using:

    sys.path = sys.path + string.split(directive_arg, ':')

No need to eval at all.

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/

From gstein at lyra.org  Sun Jun 25 15:57:55 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:45:57 2004
Subject: [mod_python] test doesn't work (solved?)
In-Reply-To: <4.3.2.7.2.20000625174031.00bd3540@pop.ne.mediaone.net>; from seant@alum.mit.edu on Sun, Jun 25, 2000 at 05:41:24PM -0400
References: <Pine.LNX.4.21.0006251540480.24945-100000@saturn.ispol.com> <3955FDF3.DC59F96B@delanet.com> <Pine.LNX.4.21.0006251540480.24945-100000@saturn.ispol.com> <20000625135631.F29590@lyra.org> <4.3.2.7.2.20000625174031.00bd3540@pop.ne.mediaone.net>
Message-ID: <20000625155755.H29590@lyra.org>

On Sun, Jun 25, 2000 at 05:41:24PM -0400, Sean True wrote:
> At 01:56 PM 6/25/00 -0700, you wrote:
> >Huh? How about specifying the path in standard DIR:DIR:DIR notation, and
> >using:
> >
> >     sys.path = sys.path + string.split(directive_arg, ':')
> >
> >No need to eval at all.
> Not as tasteful on Wintel platforms, though.

Fine. Then use os.pathsep rather than ':'

The *point* is valid -- there is no need for an eval in there, no need for a
Python expression, and every possibility of using "standard" path notations.

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/

From dwallace at delanet.com  Sun Jun 25 19:34:45 2000
From: dwallace at delanet.com (Dave)
Date: Fri Jan  9 21:45:57 2004
Subject: [mod_python] test doesn't work (solved?)
References: <Pine.LNX.4.21.0006251540480.24945-100000@saturn.ispol.com>
Message-ID: <39569715.BA322B4C@delanet.com>

Gregory Trubetskoy wrote:

> > Maybe a directive to append paths to the default PYTHONPATH would
> > be in order?
> It _could_ be done, but it went against my principle to keep it simple, so
> I decided to save for it later since I had more important features to
> roll out.

Right-on, works for me!

> > BTW, the nice thing about using Location is the fact that for the
> > particular application I'm using there is only a single handler and all
> > content is delivered through that handler by the application. Having to
> > specify a Directory just doesn't seem quite right.
>
> Not sure I understand this completely - could you elaborate a bit?

Webware is a application server (in development) that does Servlets and
Server Pages in Python so what it really wants is a path into its servlet
directory so it can find the source, generate the content and send it back
through the handler. For now the mod_python handler is just a proxy that
marshals some data from the request,sends it to the application server via a
socket, and relays the response back to Apache. If I were using Directory I'd
have to make a physical directory somwhere just to contain the handler and
nothing else or I suppose I could put the handler in my servlet directory but
it just doesn''t seem to belong there. Using Location I can place the handler
with the other application server source files. That just seems cleaner for
now.
Of course, this is all making me think of what will happen when I want to put
server pages alongside static html and have the right thing happen when .html
or .psp (server pages) are called for, but I suppose there is some way to
coerce Apache into doing that.

Dave.




From rsalz at caveosystems.com  Sun Jun 25 21:54:40 2000
From: rsalz at caveosystems.com (Rich Salz)
Date: Fri Jan  9 21:45:57 2004
Subject: [mod_python] test doesn't work (solved?)
References: <Pine.LNX.4.21.0006251540480.24945-100000@saturn.ispol.com> <3955FDF3.DC59F96B@delanet.com> <Pine.LNX.4.21.0006251540480.24945-100000@saturn.ispol.com> <20000625135631.F29590@lyra.org> <4.3.2.7.2.20000625174031.00bd3540@pop.ne.mediaone.net> <20000625155755.H29590@lyra.org>
Message-ID: <3956B7E0.718FB3B9@caveosystems.com>

> > >     sys.path = sys.path + string.split(directive_arg, ':')

Gee, I dunno. I kinda like the idea that the config file can completely
set the path.  It seems cleaner that way, just as scripts often do
	PATH=/bin:/usr/bin ; export PATH
rather than
	PATH=$PATH:/bin:/usr/bin ; export PATH

I vote to keep the current semantics.

From a.d.stribblehill at durham.ac.uk  Thu Jun  1 11:59:27 2000
From: a.d.stribblehill at durham.ac.uk (Andrew Stribblehill)
Date: Fri Jan  9 21:51:58 2004
Subject: [mod_python] Apache segfaults on startup
Message-ID: <20000601115927.B24781@womble.dur.ac.uk>

I compiled mod_python as a DSO. It compiled OK, and so I installed
it into libexec and put the appropriate magic into httpd.conf.
Subsequently, running apache causes it to seg. I noticed the FAQ
answer so I put made sure the module was loaded first, but it
still segs. How can I track down this problem?

OS: Solaris 8
Compiler: GCC 2.8.1
Python : 1.5.2
Apache: 1.3.9

Thanks,

Andrew Stribblehill
Systems Programmer, IT Service, University of Durham, England

From hildmann at prz.tu-berlin.de  Thu Jun  1 19:21:07 2000
From: hildmann at prz.tu-berlin.de (Thomas Hildmann)
Date: Fri Jan  9 21:51:58 2004
Subject: [mod_python] How to run each .py instead of showing it
Message-ID: <39369B83.5259DA64@prz.tu-berlin.de>

Hello!

This is more an apache configuration question than a mod_python one. 

Is it possible to configure the apache this way that every .py file is
interpreted to be processed by the mod_python?


Greetings....

hildi

From Mads at Kiilerich.com  Fri Jun  2 04:01:14 2000
From: Mads at Kiilerich.com (Mads Kiilerich)
Date: Fri Jan  9 21:51:58 2004
Subject: [mod_python] AttributeError: handler
Message-ID: <Pine.LNX.4.21.0006020345280.18671-200000@localhost>

Hello,

I'm testing mod_python on a almost vanilla Red Hat 6.2 with the
relevant stuff coming directly from the RPM packages:

[mk@otto mk]$ rpm -q apache python
apache-1.3.12-2
python-1.5.2-13
[mk@otto mk]$ 

mod_python have been installed as DSO according to the
instructions (IMHO, but MyMMV). When apache starts I get

[Fri Jun  2 03:47:15 2000] [notice] Apache/1.3.12 (Unix)  (Red Hat/Linux) PHP/3.0.15 mod_python/2.1 Python/1.5.2 configured -- resuming normal operations

But accessing the test.py page I get the attached error-message.

Any hints to how to solve that problem?

TIA,

-- 
Mads Kiilerich          Sys.Adm. Cand.Polyt
Mads@Kiilerich.com      Tel. +45 38 16 26 00  Mob. +45 26 20 07 73
M?ntmestervej 12B 1th,  DK-2400 NV,  Denmark

"Learned about WAP. It sucks. The more I play with WML the more sure 
I am that WAP will die out rapidly once phones doing HTML exist."
							Alan Cox
-------------- next part --------------

ERROR mod_python: "PythonHandler test"

Traceback (innermost last):

  File "/usr/lib/python1.5/site-packages/mod_python/apache.py", line 87, in Dispatch
    object = self.resolve_object(module, object_str)

  File "/usr/lib/python1.5/site-packages/mod_python/apache.py", line 42, in resolve_object
    obj = getattr(obj, obj_str)

AttributeError: handler

From grisha at ispol.com  Fri Jun  2 07:29:22 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:51:58 2004
Subject: [mod_python] AttributeError: handler
In-Reply-To: <Pine.LNX.4.21.0006020345280.18671-200000@localhost>
Message-ID: <Pine.LNX.4.21.0006020728250.7977-100000@saturn.ispol.com>

The message means that module test did not have a function called
"handler".

Grisha

On Fri, 2 Jun 2000, Mads Kiilerich wrote:

> Hello,
> 
> I'm testing mod_python on a almost vanilla Red Hat 6.2 with the
> relevant stuff coming directly from the RPM packages:
> 
> [mk@otto mk]$ rpm -q apache python
> apache-1.3.12-2
> python-1.5.2-13
> [mk@otto mk]$ 
> 
> mod_python have been installed as DSO according to the
> instructions (IMHO, but MyMMV). When apache starts I get
> 
> [Fri Jun  2 03:47:15 2000] [notice] Apache/1.3.12 (Unix)  (Red Hat/Linux) PHP/3.0.15 mod_python/2.1 Python/1.5.2 configured -- resuming normal operations
> 
> But accessing the test.py page I get the attached error-message.
> 
> Any hints to how to solve that problem?
> 
> TIA,
> 
> -- 
> Mads Kiilerich          Sys.Adm. Cand.Polyt
> Mads@Kiilerich.com      Tel. +45 38 16 26 00  Mob. +45 26 20 07 73
> M?ntmestervej 12B 1th,  DK-2400 NV,  Denmark
> 
> "Learned about WAP. It sucks. The more I play with WML the more sure 
> I am that WAP will die out rapidly once phones doing HTML exist."
> 							Alan Cox
> 


From grisha at ispol.com  Fri Jun  2 12:25:35 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:51:58 2004
Subject: [mod_python] test
Message-ID: <Pine.LNX.4.21.0006021225150.8928-100000@saturn.ispol.com>

please ignore


From haering at informatik.tu-muenchen.de  Sun Jun  4 04:34:32 2000
From: haering at informatik.tu-muenchen.de (Gerhard Haering)
Date: Fri Jan  9 21:51:58 2004
Subject: [mod_python] ANNOUNCE: mod_python 2.1 RPMs for SuSE 6.4
Message-ID: <20000604043417.A14514@in.tum.de>

this and the files at: http://jarre.pair.com/insadmin/gerhard/

----------------------------
mod_python RPMs for SuSE 6.4
----------------------------


What is it?

Source and binary packages of mod_python 2.1 and a mod_python-ready Apache
in RPM format. All for SuSE Linux version 6.4.


The history of it

I am by no means a mod_python expert. In fact I have not even programmed
anything with it until now. I am, however, very interested in mod_python
because I use Python for CGI-scripting exclusively. When I recently heard
of mod_python, I tried to make it run on my Apache server, but it was not
especially easy to get it going. Finally I succeeded but it was a product
of trial and error. A few days later I didn't want to do any 'real'
programming, so I thought it would be nice to finally learn how to build
RPMs and why not package mod_python ...


What's in for you

If you have a SuSE 6.4 system and want to try out mod_python without
messing around too much recompiling Apache or Apache modules, these RPMs
might be for you. To be honest, I don't know how well they will work, at
least they work for me, that is: after installing the RPMs
http://localhost/test/test.py displays "Hello from mod_python." on my
machine. Most probably, the RPMs will need some tweaking and be rebuilt
for older SuSE versions. They will definitely not work for any other
distributions, but the SPEC file and my patches for the Apache startup
script, httpd/httpd.conf, the Makefile for mod_python, etc. might give you
a start if you want to build packages for your favorite distribution.


Quickstart

On a SuSE 6.4 system, remove the old Apache RPM and install my modified
Apache 1.3.12 RPM. Then install the mod_python RPM. Then restart Apache
and point your browser to http://localhost/test/test.py. The text "Hello
from mod_python." should be displayed. If you want to know what's going on
behind the scenes:

     - patched the SuSE startup script /sbin/init.d/apache to work with and 
       without mod_python
     - patched /etc/httpd/httpd.conf to use a mod_python 
       handler at /usr/local/httpd/htdocs/test/test.py
     - install mod_python documentation at /usr/doc/packages/mod_python

Have a lot of fun!


Feedback

I cannot promise to remove any bugs in the RPMs, but if any feedback is
coming, I will try. If I have some time to waste, I will try to improve
the RPMs and make some for SuSE 6.3. Please contact me at haering@in.tum.de.

From richard at whitequeen.com  Sat Jun  3 20:43:13 2000
From: richard at whitequeen.com (richard offer)
Date: Fri Jan  9 21:51:58 2004
Subject: [mod_python] Returning multiple content types ?
Message-ID: <200006040343.e543hD329628@erij.whitequeen.com>

Hi,


<Newbie>

How do I write a handler that can return multitple pieces of content ? 


I've got a handler that can read an image out of the photgraphic database
I'm working on, but I need to be able to generate the rest of the page
around the image ?


Should I be using the cgihandler ? This is virgin code so I'm, not
porting an exising implementation, so it seemed to me that I would be
better off using the basic handler, is this true ?


Is there an easy way to parse the QUERY_STRING into a dict ?


Should I be using a different architecture ? I was working on having
everything in one handler, does this make sence?

</Newbie>


thanks, this is so cool :-)


richard.


-----------------------------------------------------------------------
richard offer @ home 
_______________________________http://www.whitequeen.com/users/richard/


From grisha at ispol.com  Sun Jun  4 15:00:44 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:51:58 2004
Subject: [mod_python] 2.2 is out
Message-ID: <Pine.LNX.4.21.0006041452530.28185-100000@saturn.ispol.com>

Mod_python 2.2 is out. This one fixes the occasional trashing of
content-type that some people have reported. This bug manifested itself
more for people who use Python 1.6. Thanks to Dave Wallace for pointing it
out.

There is also a Win32 DLL of 2.1 available for download, and 2.2 hopefully
as soon as Stephane Bidoul gets around to compiling it. 

Also thanks to Gerhard Haering for the Suse RPM's. It'd be nice if someone
came up and agreed to maintain with RedHat RPM, Debian package, a FreeBSD
port and a Solaris package...

Have a good day,

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com






From grisha at ispol.com  Sun Jun  4 15:08:38 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:51:58 2004
Subject: [mod_python] Returning multiple content types ?
In-Reply-To: <200006040343.e543hD329628@erij.whitequeen.com>
Message-ID: <Pine.LNX.4.21.0006041503350.28185-100000@saturn.ispol.com>

On Sat, 3 Jun 2000, richard offer wrote:

> How do I write a handler that can return multitple pieces of content ? 

For as long as you have a way to tell the handler which content to return
(typically done via URL) and the handler has the logic to understand it,
this shouldn't be too hard. All of the handlers included with mod_python
return multiple pieces of content.

> Should I be using the cgihandler ? This is virgin code so I'm, not
> porting an exising implementation, so it seemed to me that I would be
> better off using the basic handler, is this true ?

If it's virgin code and you have no intentions of using CGI in the future
there is no reason for you to mess with the cgihandler, you're right.

> Is there an easy way to parse the QUERY_STRING into a dict ?

Look at the standard Python library module cgi.py.

> Should I be using a different architecture ? I was working on having
> everything in one handler, does this make sence?

This is something only you, as developer,  can determine.

Grisha


From SBID at BXS.BE  Mon Jun  5 12:01:12 2000
From: SBID at BXS.BE (=?iso-8859-1?Q?St=E9phane_BIDOUL?=)
Date: Fri Jan  9 21:51:58 2004
Subject: [mod_python] Problems under windows
Message-ID: <C16998C688CDD31196D90008C7E690CB17233F@EVRSRV04>

Hi,

mod_python seems to crash sometimes under
windows (Windows 2000, Python 1.5.2, Apache 1.3.11, mod_python 2.2).

I can trigger the problem by keeping the "refresh" key pressed in the
browser. I use the most trivial test script:

	print "content-type: text/plain"
	print
	print "Hello from mod_python"

and the following httpd.conf

	LoadModule python_module modules/mod_python.dll
	AddHandler python-program .py
	PythonHandler mod_python.cgihandler
	PythonDebug

The problem seems to be thread-related because I sometimes
get the following message:

	Fatal Python error: ceval: orphan tstate

Sometimes it's simply an access violation.

It seems to occur somewhere inside the PyObject_CallMethod call 
in python_handler().

I'm not intimate with python or apache threading, so maybe someone 
can examine the problem further... Or maybe it's simply my windows build of 
mod_python which is wrong somehow...

Any idea?

-Stephane
sbi@acse.be

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20000605/07b9a484/attachment-0001.htm
From seant at alum.mit.edu  Mon Jun  5 07:21:48 2000
From: seant at alum.mit.edu (Sean True)
Date: Fri Jan  9 21:51:58 2004
Subject: [mod_python] Leaking and cgi-handler
In-Reply-To: <C16998C688CDD31196D90008C7E690CB17233F@EVRSRV04>
Message-ID: <4.3.2.20000605071041.00b91280@pop.ne.mediaone.net>

Like too many people, I'm working on a version of python server pages -- 
.phtml pages which contain
mixed python and HTML code, allowing on the fly construction of pages from 
files which can mostly be
edited with a WYSIWYG HTML editor. I have a phtml.py program which is 
invoked as a cgi script, and more
recently under cgi-handler.

The documentation for cgi-handler notes that it may be subject to a memory 
leak related to os.environ().

On a Linux Redhat 6.1 system with Apache and statically linked mod_python, 
I'm seeing memory usage growing
by about 10K or so per page served (measured by watching the system monitor 
reports grow). Performance also
drops -- from about 15 pages served per second to less than 8 pages per second.

All of this makes me think that some data structure in the interpreter or 
mod_python is growing without bound,
in combination with a linear search from the front of the list.

The same code runs under pyapache with a very modest memory leak (also 
documented for pyapache) of about 1K
per page served.

I was a little unwilling to try switching to a more direct method of 
content handling under mod_python (creating
a request handler for .phtml page) until the whole system was a little more 
stable. I'm in production under pyapache
now, and I hate forking the code base.

Comments? Suggestions?

Does anyone have a skeleton content handler they would be willing to share, 
along with a corresponding .conf
entry?

-- Sean

==========
Sean True
seant@alum.mit.edu


From grisha at ispol.com  Mon Jun  5 08:05:32 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:51:58 2004
Subject: [mod_python] Leaking and cgi-handler
In-Reply-To: <4.3.2.20000605071041.00b91280@pop.ne.mediaone.net>
Message-ID: <Pine.LNX.4.21.0006050746190.31412-100000@saturn.ispol.com>

Sean - 

If you can find the source of the memory leak, please let me know what it
is, because I couldn't... :-(

The cgihandler when used with scripts not using cgi.py does not leak a
byte of memory. Unfortunately 98% of Python scripts out there start with
"import cgi".

A common misconception about Python and memory leaks is that it is
impossible to leak memory in Python. Python, just like any other language
allows you to allocate limitless memory, and in a persistent daemon-type
environment like Apache it shows.

Most likely the reason PyApache does not leak memory as bad is it resets
the interpeter between hits. This comes at a significant performance hit
since all the modules have to imported again, to the point where PyApache
isn't all that much faster than plain CGI.

My recomendation would to rewrite everything using "native" mod_python
handlers. They are simple (much simpler than CGI), fast and they do not
leak memory. You fears about them being unstable are unfounded, I think.

P.S. A skeleton content handler is described in the documentation.

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Mon, 5 Jun 2000, Sean True wrote:

> The same code runs under pyapache with a very modest memory leak (also
> documented for pyapache) of about 1K per page served.
> 
> I was a little unwilling to try switching to a more direct method of
> content handling under mod_python (creating a request handler for
> .phtml page) until the whole system was a little more stable. I'm in
> production under pyapache now, and I hate forking the code base.
> 
> Comments? Suggestions?
> 
> Does anyone have a skeleton content handler they would be willing to
> share, along with a corresponding .conf entry?
> 
> -- Sean


From Mads at Kiilerich.com  Mon Jun  5 15:13:40 2000
From: Mads at Kiilerich.com (Mads Kiilerich)
Date: Fri Jan  9 21:51:58 2004
Subject: [mod_python] AttributeError: handler
In-Reply-To: <Pine.LNX.4.21.0006020728250.7977-100000@saturn.ispol.com>
Message-ID: <Pine.LNX.4.21.0006051504240.864-100000@localhost>

Friday I got mail from Gregory Trubetskoy:

> The message means that module test did not have a function called
> "handler".
> 
> Grisha

Thanks for the fast response.

But test.py contains the following, according to the example in
the documentation:


from mod_python import apache

def handler(req):
	req.send_http_header()
	req.write("Hello World!")
	return apache.OK 


As far as I can see there _is_ a function called "handler"!?

Can you confirm that the example from the documentation works
"out of the box"?

Also: Should the .py be compiled to .pyc?

TIA,
-- 
Mads Kiilerich          Sys.Adm. Cand.Polyt
Mads@Kiilerich.com      Tel. +45 38 16 26 00  Mob. +45 26 20 07 73
M?ntmestervej 12B 1th,  DK-2400 NV,  Denmark

"Learned about WAP. It sucks. The more I play with WML the more sure 
I am that WAP will die out rapidly once phones doing HTML exist."
							Alan Cox


From grisha at ispol.com  Mon Jun  5 09:40:52 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:51:58 2004
Subject: [mod_python] AttributeError: handler
In-Reply-To: <Pine.LNX.4.21.0006051504240.864-100000@localhost>
Message-ID: <Pine.LNX.4.21.0006050938520.31412-100000@saturn.ispol.com>

Mads - 

Everyone who reported this problem so far found later on that they had
extra blanks in their test.py because they cut and pasted from the web
page.

No, you don't need to compile your py into a pyc - Python will do that for
you.

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Mon, 5 Jun 2000, Mads Kiilerich wrote:

> Friday I got mail from Gregory Trubetskoy:
> 
> But test.py contains the following, according to the example in
> the documentation:
> 
> 
> from mod_python import apache
> 
> def handler(req):
> 	req.send_http_header()
> 	req.write("Hello World!")
> 	return apache.OK 
> 


From aiglauer at yahoo.com  Mon Jun  5 07:08:41 2000
From: aiglauer at yahoo.com (Alexis Iglauer)
Date: Fri Jan  9 21:51:58 2004
Subject: [mod_python] AttributeError: handler
Message-ID: <20000605140841.29193.qmail@web2205.mail.yahoo.com>

Always a good idea to just run python over your script
before trying to run it on the webserver - this will
pick up any inconsistent dedents or other little
syntax nasties.

If you are in unix, edit the file in vi and type in
':set list' - you can then see which of your nice
spaces are actually sneaky tabs :)

Regards
aei


--- Gregory Trubetskoy <grisha@ispol.com> wrote:
> 
> Mads - 
> 
> Everyone who reported this problem so far found
> later on that they had
> extra blanks in their test.py because they cut and
> pasted from the web
> page.
> 
> No, you don't need to compile your py into a pyc -
> Python will do that for
> you.
> 
> --
>   Gregory (Grisha) Trubetskoy
>        grisha@ispol.com
> 
> On Mon, 5 Jun 2000, Mads Kiilerich wrote:
> 
> > Friday I got mail from Gregory Trubetskoy:
> > 
> > But test.py contains the following, according to
> the example in
> > the documentation:
> > 
> > 
> > from mod_python import apache
> > 
> > def handler(req):
> > 	req.send_http_header()
> > 	req.write("Hello World!")
> > 	return apache.OK 
> > 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 
> 
> 


__________________________________________________
Do You Yahoo!?
Yahoo! Photos -- now, 100 FREE prints!
http://photos.yahoo.com

From sbi at acse.be  Mon Jun  5 20:56:13 2000
From: sbi at acse.be (=?iso-8859-1?Q?St=E9phane_Bidoul?=)
Date: Fri Jan  9 21:51:58 2004
Subject: [mod_python] Problems under windows: a first diagnostic
Message-ID: <010101bfcf1f$b9407bd0$885bfea9@spirou>

Hi again,

I think I've got an explanation for the crashes under windows.

Disclaimer: I'm no apache expert, nor am I intimate with python threading,
so bear with me if the following is completely off-track.

In the python doc, I've found the following:

<PythonDocExcerpt>

[...] when threads are created from C, they don't have the global interpreter lock, nor is there a thread state data structure for them. Such threads must bootstrap themselves into existence, by first creating a thread state data structure [PyThreadState_New()?], then acquiring the lock, and finally storing their thread state pointer, before they can start using the Python/C API. When they are done, they should reset the thread state pointer, release the lock, and finally free their thread state data structure.

</PythonDocExcerpt>

Now, in mod_python, threads are created by Apache, so they should
somehow be bootstrapped for python. 

In my understanding, mod_python only initializes one thread per
interpreter: the Apache thread that is happening to create the interpreter
 (using Py_NewInterpreter(), which in turns calls PyThreadState_New()
for the interpreter's "main" thread).
All other apache threads using that same interpreter will not call
PyThreadState_New()... hence the potential conflict.

To summarize, my understanding of the python doc is that there should
be one PyThreadState_New() for each (apache thread, python interpreter) couple.

AFAIK, threads are used only in the Windows version of Apache, 
so the problem should not occur on unix  (athough that will change with Apache 2). 
Also, if ThreadsPerChild is set to 1, the problem disappears,
which seems to confirm my diagnostic.

Again, bear with me if this is totally wrong...
If this is correct, however, I've no idea (yet) on how to fix it...

What do you think? 
Can a python threading expert confirm or infirm this diagnostic?

-Stephane
sbi@acse.be




From gstein at lyra.org  Mon Jun  5 17:16:39 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:51:59 2004
Subject: [mod_python] Problems under windows: a first diagnostic
In-Reply-To: <010101bfcf1f$b9407bd0$885bfea9@spirou>
Message-ID: <Pine.LNX.4.10.10006051658410.14292-100000@nebula.lyra.org>

On Mon, 5 Jun 2000, [iso-8859-1] Stéphane Bidoul wrote:
>...
> Now, in mod_python, threads are created by Apache, so they should
> somehow be bootstrapped for python. 

Correct.

> In my understanding, mod_python only initializes one thread per
> interpreter: the Apache thread that is happening to create the interpreter
>  (using Py_NewInterpreter(), which in turns calls PyThreadState_New()
> for the interpreter's "main" thread).
> All other apache threads using that same interpreter will not call
> PyThreadState_New()... hence the potential conflict.

ThreadState structures are not specific to a particular (OS) thread. You
can actually use them (not at the same time!) across different threads.
Given the protection of the global lock, it might be okay to even attempt
to use them at the same time.
[ haven't thought through this particular scenario fully yet ]

> To summarize, my understanding of the python doc is that there should
> be one PyThreadState_New() for each (apache thread, python
> interpreter) couple.

Theoretically: yes.

Python's central lock "should" arbitrate the use of the per-interpreter
thread state so that it can be used by multiple Apache threads. Probably
isn't the best idea, though.

Eek. Definitely wrong for the Apache scenario.

The scoop: if python_handler() calls into Python, then returns, then
tstate->frame should be NULL. In this scenario, you could do the
share-tstate thing.

However: somewhere down inside of python_handler's call into Python, it is
quite possible for Python to use Py_BEGIN_ALLOW_THREADS (unlock the global
lock). This will allow another python_handler to grab the tstate and
attempt execution. Let's say the thread execution then flips back to
normal: the original thread's tstate->frame is now *totally* wrong.

[ tstate->frame has a direct correspondence to the C stack; these must
  stay in sync or Bad Things happen ]

> AFAIK, threads are used only in the Windows version of Apache, 
> so the problem should not occur on unix  (athough that will change with Apache 2). 
> Also, if ThreadsPerChild is set to 1, the problem disappears,
> which seems to confirm my diagnostic.
> 
> Again, bear with me if this is totally wrong...
> If this is correct, however, I've no idea (yet) on how to fix it...

Your underlying hypothesis is quite correct. Above is a more detailed
breakdown of "why".

> What do you think? 
> Can a python threading expert confirm or infirm this diagnostic?

That would be me :-)

One other thing: if Apache is going to run threads, then Python *MUST* be
compiled with thread support. Otherwise, things will die very rapidly.
Presuming that you are using the standard Windows distribution, then the
thread support is automatically enabled. I would recommend that mod_python
barf with #error if it detects Apache/Win32 and WITH_THREAD is not
enabled.

Heh. All of this just supports my belief in "free threading" Python even
more... :-)

What is the solution? Each entry to python-handler should construct a
tstate on the fly, call into Python, then destroy the tstate. I used this
design for the Python/COM support in the Win32 distribution. That had to
deal with reentrancy issues, but (luckily) that isn't a problem here.

Presumably, you could also cache/pool tstates and yank them from your
pool on entry to python-handler, returning them on exit. If two threads
came into python-handler (against the same interp!), then additional
tstates would be constructed.

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/


From seant at alum.mit.edu  Mon Jun  5 23:11:07 2000
From: seant at alum.mit.edu (Sean True)
Date: Fri Jan  9 21:51:59 2004
Subject: [mod_python] A cheap handler for exploring Apache req contents
Message-ID: <4.3.2.20000605230004.00b94c20@pop.ne.mediaone.net>

The following code is so inelegant, I'm a little embarrassed to share it, 
but it's a handy handler for starting
to poke around inside the Apache req structure, and so informative that I 
thought I'd share.

Grisha might want to comment as to why some of the attributes of the req 
don't dump the way I tried to dump them. Could just be the late night 
stupids on my part.

-- Sean

=================
from mod_python import apache

def dumpdict(req,title, d):
     req.write("*"+title + "\n")
     for key in d.keys():
         req.write(str(key) + ": " + str(d[key]) + "\n")
def dump(req,title,s):
     req.write(title+": "+s+"\n")
def handler(req):
     req.send_http_header()
     dump(req,"Request", req.the_request)
     dump(req,"Protocol", req.protocol)
     dump(req,"Hostname", req.hostname)
     dump(req,"Status line", req.status_line)
     dump(req, "Method", req.method)
     dump(req,"Content handler", req.handler)
     dump(req, "Unparsed uri", req.unparsed_uri)
     dump(req, "Uri", req.uri)
     dump(req, "Filename", req.filename)
     dump(req, "Path info", req.path_info)
     dump(req, "Args", req.args)
     dump(req, "Mtime", str(req.mtime))
     dump(req, "Remaining", str(req.remaining))
     # The following don't work.
     #dump(req, "Content type", req.content_type)
     #dump(req, "Content encoding", req.content_encoding)
     #dump(req, "Parsed uri", str(req.parsed_uri))
     #dump(req, "finfo", str(req.finfo))
     dumpdict(req, "headers_in",req.headers_in)
     dumpdict(req, "headers_out", req.headers_out)
     dumpdict(req, "err_headers_out", req.err_headers_out)
     dumpdict(req, "subprocess_env", req.subprocess_env)
     dumpdict(req, "notes", req.notes)
     return apache.OK
================
Output on my system: (with domain deleted for privacy)
================
Request: GET /foo.xhtml?fu=bar HTTP/1.0
Protocol: HTTP/1.0
Hostname: www.[..].com
Status line: 200 OK Method: GET
Content handler: python-program
Unparsed uri: /foo.xhtml?fu=bar
Uri: /foo.xhtml
Filename: /usr/local/apache/htdocs/foo.xhtml
Path info:
Args: fu=bar
Mtime: 0
Remaining: 0
*headers_in
Accept: */*
Accept-Language: en-us
Connection: Keep-Alive
Host: www.[..].com
User-Agent: Mozilla/4.0 (compatible; MSIE 5.01; Windows 98)
*headers_out
Connection: close
Content-Type: text/plain
*err_headers_out
*subprocess_env
SCRIPT_URL: /foo.xhtml
SCRIPT_URI: http://www.[..]/foo.xhtml
GATEWAY_INTERFACE: CGI/1.1
SERVER_PROTOCOL: HTTP/1.0
REQUEST_METHOD: GET
QUERY_STRING: fu=bar
REQUEST_URI: /foo.xhtml?fu=bar
SCRIPT_NAME: /foo.xhtml
*notes
python_request_ptr: 135846824

==========
Sean True
seant@alum.mit.edu


From sbi at acse.be  Tue Jun  6 09:35:03 2000
From: sbi at acse.be (=?iso-8859-1?Q?St=E9phane_Bidoul?=)
Date: Fri Jan  9 21:51:59 2004
Subject: [mod_python] Problems under windows: a first diagnostic
References: <Pine.LNX.4.10.10006051658410.14292-100000@nebula.lyra.org>
Message-ID: <006201bfcf89$ba39c2c0$885bfea9@spirou>

>...
>The scoop: if python_handler() calls into Python, then returns, then
>tstate->frame should be NULL. In this scenario, you could do the
>share-tstate thing.
>
>However: somewhere down inside of python_handler's call into Python, it is
>quite possible for Python to use Py_BEGIN_ALLOW_THREADS (unlock the global
>lock). This will allow another python_handler to grab the tstate and
>attempt execution. Let's say the thread execution then flips back to
>normal: the original thread's tstate->frame is now *totally* wrong.

Wow! This looks even more complex than I thought...

>What is the solution? Each entry to python-handler should construct a
>tstate on the fly, call into Python, then destroy the tstate. I used this
>design for the Python/COM support in the Win32 distribution. That had to
>deal with reentrancy issues, but (luckily) that isn't a problem here.
>
>Presumably, you could also cache/pool tstates and yank them from your
>pool on entry to python-handler, returning them on exit. If two threads
>came into python-handler (against the same interp!), then additional
>tstates would be constructed.

I was contemplating the use of thread-local storage to maintain
the list of interpreters for which a tstate is initialized for each
Apache thread, but it's probably overkill...

Ideally, Apache should provide access to some "per-thread data area" for this,
but it does not, right?

Anyway, unless Gregory tells me otherwise, I will experiment with 
Greg's first solution and see how it works...

-Stephane



From gstein at lyra.org  Tue Jun  6 02:50:52 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:51:59 2004
Subject: [mod_python] Problems under windows: a first diagnostic
In-Reply-To: <006201bfcf89$ba39c2c0$885bfea9@spirou>
Message-ID: <Pine.LNX.4.10.10006060245500.14292-100000@nebula.lyra.org>

On Tue, 6 Jun 2000, [iso-8859-1] Stéphane Bidoul wrote:
>...
> >What is the solution? Each entry to python-handler should construct a
> >tstate on the fly, call into Python, then destroy the tstate. I used this
> >design for the Python/COM support in the Win32 distribution. That had to
> >deal with reentrancy issues, but (luckily) that isn't a problem here.
> >
> >Presumably, you could also cache/pool tstates and yank them from your
> >pool on entry to python-handler, returning them on exit. If two threads
> >came into python-handler (against the same interp!), then additional
> >tstates would be constructed.
> 
> I was contemplating the use of thread-local storage to maintain
> the list of interpreters for which a tstate is initialized for each
> Apache thread, but it's probably overkill...

The cost of creating a tstate isn't all that high, in the scheme of
things. What is going to get a bit difficult is the change necessary in
get_obcallback(). It uses Py_NewInterpreter to create an interp/tstate
pair. You'll have to unwrap that into creating *just* an interpreter, thus
allowing you to create/destroy tstates at will.

> Ideally, Apache should provide access to some "per-thread data area" for this,
> but it does not, right?

For Apache 1.3, the only threaded platform is Windows, where TLS is going
to work out fine for you.

Apache 2.0 is a whole different story, and doesn't apply to mod_python.

> Anyway, unless Gregory tells me otherwise, I will experiment with 
> Greg's first solution and see how it works...

It is a good bundle of work, but it should work quite fine. Like I said, I
used a similar pattern for embedding the Python interpreter behind the
(multi-threaded) COM interfaces.

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/


From grisha at ispol.com  Tue Jun  6 07:38:29 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:51:59 2004
Subject: [mod_python] Problems under windows: a first diagnostic
In-Reply-To: <Pine.LNX.4.10.10006060245500.14292-100000@nebula.lyra.org>
Message-ID: <Pine.LNX.4.21.0006060734030.4432-100000@saturn.ispol.com>

I haven't had any caffeine yet so I don't think I can comment. The Python
relationship between ThreadStates and Interpreters took me a while to
understand last time I studied it and it's one of those things that I can
only grasp for a few days until I don't need it - then, next time, I have
figure it out again.

I'll think about this some more in the coming days....

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Tue, 6 Jun 2000, Greg Stein wrote:

> On Tue, 6 Jun 2000, [iso-8859-1] St?phane Bidoul wrote:
> >...
> > >What is the solution? Each entry to python-handler should construct a
> > >tstate on the fly, call into Python, then destroy the tstate. I used this
> > >design for the Python/COM support in the Win32 distribution. That had to
> > >deal with reentrancy issues, but (luckily) that isn't a problem here.
> > >
> > >Presumably, you could also cache/pool tstates and yank them from your
> > >pool on entry to python-handler, returning them on exit. If two threads
> > >came into python-handler (against the same interp!), then additional
> > >tstates would be constructed.
> > 
> > I was contemplating the use of thread-local storage to maintain
> > the list of interpreters for which a tstate is initialized for each
> > Apache thread, but it's probably overkill...
> 
> The cost of creating a tstate isn't all that high, in the scheme of
> things. What is going to get a bit difficult is the change necessary in
> get_obcallback(). It uses Py_NewInterpreter to create an interp/tstate
> pair. You'll have to unwrap that into creating *just* an interpreter, thus
> allowing you to create/destroy tstates at will.
> 
> > Ideally, Apache should provide access to some "per-thread data area" for this,
> > but it does not, right?
> 
> For Apache 1.3, the only threaded platform is Windows, where TLS is going
> to work out fine for you.
> 
> Apache 2.0 is a whole different story, and doesn't apply to mod_python.
> 
> > Anyway, unless Gregory tells me otherwise, I will experiment with 
> > Greg's first solution and see how it works...
> 
> It is a good bundle of work, but it should work quite fine. Like I said, I
> used a similar pattern for embedding the Python interpreter behind the
> (multi-threaded) COM interfaces.
> 
> Cheers,
> -g
> 
> -- 
> Greg Stein, http://www.lyra.org/
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From danilo at telusplanet.net  Wed Jun  7 14:51:44 2000
From: danilo at telusplanet.net (Danilo Fiorenzano)
Date: Fri Jan  9 21:51:59 2004
Subject: [mod_python] Leaking and cgi-handler
In-Reply-To: Gregory Trubetskoy's message of "Mon, 5 Jun 2000 08:05:32 -0400 (EDT)"
References: <Pine.LNX.4.21.0006050746190.31412-100000@saturn.ispol.com>
Message-ID: <m3puptnrj3.fsf@spike.interalta.com>

Gregory Trubetskoy <grisha@ispol.com> writes:

 
> The cgihandler when used with scripts not using cgi.py does not leak a
> byte of memory. Unfortunately 98% of Python scripts out there start with
> "import cgi".

..
 
> My recomendation would to rewrite everything using "native" mod_python
> handlers. They are simple (much simpler than CGI), fast and they do not
> leak memory. You fears about them being unstable are unfounded, I think.

On this theme: from the heights of my blissful ignorance (started
learning python and its library 2 weeks ago or so), I apparently
devised a way to use the facilities of the cgi module with mod_python
_without_ using the cgihandler.  I do something like this:

import cgi
from mod_python import apache

def handler(req):
    req.content_type = "text/html"
    req.send_http_header()

    env, si, so = apache.setup_cgi(req)
    formData = cgi.FieldStorage()
    for key in formData.keys():
        req.write( str(key) + " : " + str(data[key].value) + "<br>" )


This works without the need to specify cgihandler in the apache
config.  Not sure whether it's the Right way to handle things, or if
it avoids the leaking, but I thought it was worth sharing.. YMMV.

 regards

-- Danilo

From roybryant at SEVENtwentyfour.com  Wed Jun  7 20:46:43 2000
From: roybryant at SEVENtwentyfour.com (Roy Bryant)
Date: Fri Jan  9 21:51:59 2004
Subject: [mod_python] Broken link in www.modpython.org
Message-ID: <307EC3F394ACD311B959006008A30AD6BCDD9B@MAIL724>

There appears to be a problem on this page of your site.

    On your page
http://www.modpython.org/pipermail/mod_python/2000-June/000067.html
    when you click on your link to http://localhost/test/test.py.
    you get the error: Domain name lookup failed (may be a transient error)

As recommended by the Robot Guidelines, this email is to explain our robot's
activities and to let you know about one of the broken links we encountered.
LinkWalker does not store or publish the content of your pages, but rather
uses the link information to update our map of the World Wide Web.

Are these reports helpful? I'd love some feedback. If you prefer not to
receive these occasional error notices please let me know.

Roy Bryant

 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 Roy Bryant, roybryant@seventwentyfour.com
 President
 SEVENtwentyfour Inc. ("Always watching the Web")
 http://www.seventwentyfour.com
 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ 

From grisha at ispol.com  Thu Jun  8 09:53:32 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:51:59 2004
Subject: [mod_python] mod_python 2.3
Message-ID: <Pine.LNX.4.21.0006080946010.15265-100000@saturn.ispol.com>

Mod_python 2.3 is out.

There are two major changes in this one:

1. The PythonDebug, PythonInterpPerDirectory and PythonNoReload now
require an argument of On or Off. NOTE - THIS WILL REQUIRE YOU TO CHANGE
YOUR CONFIGS IF YOU'RE USING ANY OF THESE DIRECTIVES!!!

2. A new directive, PythonImport allows you to import modules at child
process initialization time. This is good for initializing database
connections, etc. Read the documentation for details.

For the future relelases, on my list are (in no particular order):

1. Ironing out the thread related issues so that mod_python works on
win32. 

2. ChildInit, ChildExit and Cleanup handlers.

3. Dynamic handler registration.

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com


From grisha at ispol.com  Thu Jun  8 09:57:48 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:51:59 2004
Subject: [mod_python] suggestions
Message-ID: <Pine.LNX.4.21.0006080953350.15265-100000@saturn.ispol.com>

If all goes well, I will be presenting about mod_python at the upcoming
Apachecon in London in October.

I'm looking for sugestions on topics that you think would be interesting
to cover. Imagine you were planning on attending the conference - what
would YOU like to know about mod_python?

Thanks,

Grisha



From sbi at acse.be  Thu Jun  8 17:28:31 2000
From: sbi at acse.be (=?Windows-1252?Q?St=E9phane_Bidoul?=)
Date: Fri Jan  9 21:51:59 2004
Subject: [mod_python] Another threading issue: chdir
Message-ID: <003b01bfd15e$33cb0f60$66a679c1@spirou>

Hi again,

Obviously, chdir is not thread-safe
(I discovered the problem by running different 
handlers in different directories)

It's ok with the one performed in cgihandler,
since cgi must run single-threaded anyway.

I wonder if the one in mod_python.c is really necessary?
Maybe apache.import_module() could add the directory to
pythonpath before doing the import instead of adding '.'.
Oh, and now that I write it, changing python path is 
not thread-safe either: can we do the import without
changing pythonpath at all? If not, another lock 
will be required to protect that...

There is also a chdir in the httpdapi handler
but I've no idea about that one.

Well, I hope the end of the threading tunnel is in sight...

-sbi
-------------- next part --------------
A non-text attachment was scrubbed...
Name: =?Windows-1252?Q?St=E9phane_Bidoul.vcf?=
Type: text/x-vcard
Size: 361 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20000608/ea5f5f9f/Windows-1252QStE9phane_Bidoul-0001.vcf
From grisha at ispol.com  Thu Jun  8 18:14:05 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:51:59 2004
Subject: [mod_python] Another threading issue: chdir (fwd)
Message-ID: <Pine.LNX.4.21.0006081813330.17090-100000@saturn.ispol.com>

Having the url directory as your current directory is just an intuitive
thing and makes it easier for the developer.... E.g. if you're trying to
open files, etc.

One thing that we could do is restore the original directory and make sure
that the lock is aqcuired before first chdir() and after the last chdir()?

Or chdir could be made optional via a directive of some sort.... I need to
think about this too...

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Thu, 8 Jun 2000, [Windows-1252] St?phane Bidoul wrote:

> Hi again,
> 
> Obviously, chdir is not thread-safe
> (I discovered the problem by running different 
> handlers in different directories)
> 
> It's ok with the one performed in cgihandler,
> since cgi must run single-threaded anyway.
> 
> I wonder if the one in mod_python.c is really necessary?
> Maybe apache.import_module() could add the directory to
> pythonpath before doing the import instead of adding '.'.
> Oh, and now that I write it, changing python path is 
> not thread-safe either: can we do the import without
> changing pythonpath at all? If not, another lock 
> will be required to protect that...
> 
> There is also a chdir in the httpdapi handler
> but I've no idea about that one.
> 
> Well, I hope the end of the threading tunnel is in sight...
> 
> -sbi
> 



From SBID at BXS.BE  Fri Jun  9 09:23:29 2000
From: SBID at BXS.BE (=?iso-8859-1?Q?St=E9phane_BIDOUL?=)
Date: Fri Jan  9 21:51:59 2004
Subject: [mod_python] Re: Another threading issue: chdir (fwd)
Message-ID: <C16998C688CDD31196D90008C7E690CB172343@EVRSRV04>

> Having the url directory as your current directory is just an intuitive
> thing and makes it easier for the developer.... E.g. if you're trying to
> open files, etc.

Agreed. OTOH, it is quite easy to obtain the module directory
with something like os.path.dirname(__file__).

> One thing that we could do is restore the original directory and make sure
> that the lock is aqcuired before first chdir() and after the last chdir()?

It would require another lock than the global interpreter lock because
that one can be released during execution. If another thread steps
in a that moment, the current directory could change in the middle of
a script...

But then it would degrade even native handlers to single-threading.

> Or chdir could be made optional via a directive of some sort.... I need to
> think about this too...

This option looks reasonable to me; 
the associated threading caveats could be documented easily.

Cheers

-sbi
sbi@acse.be
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20000609/a0168ad8/attachment-0001.htm
From grisha at ispol.com  Fri Jun  9 17:12:16 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:51:59 2004
Subject: [mod_python] Re: Another threading issue: chdir (fwd)
In-Reply-To: <C16998C688CDD31196D90008C7E690CB172342@EVRSRV04>
Message-ID: <Pine.LNX.4.21.0006091703340.21671-100000@saturn.ispol.com>

On Fri, 9 Jun 2000, St?phane BIDOUL wrote:

> > Or chdir could be made optional via a directive of some sort.... I need to
> > think about this too...
> 
> This option looks reasonable to me; 
> the associated threading caveats could be documented easily.

The more I think about this, the more it seems to me that doing away with
the chdir and prepending the path rather than the '.' is the way to go.

This will break old code that relied on the chdir being there, but what
can you do...

All the other solutions will make threaded mod_python incompatible with
nonthreaded be it extra directives or different code that you need....

Grisha



From daniel at copyleft.no  Sun Jun 11 14:44:00 2000
From: daniel at copyleft.no (Hr. Daniel Mikkelsen)
Date: Fri Jan  9 21:51:59 2004
Subject: [mod_python] make_obcallback(): could not import mod_python.apache.
Message-ID: <Pine.LNX.4.10.10006111434560.14419-100000@unity.copyleft.no>

Hi. 

I'm getting this error in my mail apache error_log when I try to start
httpd after having added mod_python 2.3 as a DSO:

make_obcallback(): could not import mod_python.apache.
make_obcallback(): could not call init.
[Sun Jun 11 14:33:49 2000] [error] python_init: get_obcallback returned no
  obCallBack. Possibly no more memory.

In version 2.2, I had the same problem (I switched to 2.3 while trying to
figure it out), with two exceptions. The last line in the error message
wasn't there, and apache didn't fail in starting (only in running .py test
files). 

Now, when I ran httpdapy, earlier, I had a very similar problem with
tracebacks about how it couldn't load certain python modules (apache.py
for instance), and apache failed to load in the same way. I solved the
problem by setting the PYTHONPATH correctly.

Changing PYTHONPATH doesn't seem to work now, however. I have the .py
files wich came with mod_python 2.3 in my
/usr/local/lib/python1.5/site-packages directory. I have compiled a
threadless python that expects (I assume, having given no --prefix=...
statement to its ./configure) to find scripts there. I've linked my
mod_python DSO with this verison of python. 

My setup is an OpenBSD 2.6 (using the apache that comes bundled), Python
1.5, enough memory (128Mb of which 81 are reported "free" byt top).

I'm trying to load the test.py given in the installation docs, and the
zhello.py given in the zhandler docs. 

Any ideas?

-- Daniel Mikkelsen, Copyleft Software


From grisha at ispol.com  Sun Jun 11 09:52:19 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:51:59 2004
Subject: [mod_python] make_obcallback(): could not import mod_python.apache.
In-Reply-To: <Pine.LNX.4.10.10006111434560.14419-100000@unity.copyleft.no>
Message-ID: <Pine.LNX.4.21.0006110951330.6729-100000@saturn.ispol.com>

If your Apache runs as nobody and the python library is not world
readable, you will get this error too.

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Sun, 11 Jun 2000, Hr. Daniel Mikkelsen wrote:

> Hi. 
> 
> I'm getting this error in my mail apache error_log when I try to start
> httpd after having added mod_python 2.3 as a DSO:
> 
> make_obcallback(): could not import mod_python.apache.
> make_obcallback(): could not call init.
> [Sun Jun 11 14:33:49 2000] [error] python_init: get_obcallback returned no
>   obCallBack. Possibly no more memory.
> 
> In version 2.2, I had the same problem (I switched to 2.3 while trying to
> figure it out), with two exceptions. The last line in the error message
> wasn't there, and apache didn't fail in starting (only in running .py test
> files). 
> 
> Now, when I ran httpdapy, earlier, I had a very similar problem with
> tracebacks about how it couldn't load certain python modules (apache.py
> for instance), and apache failed to load in the same way. I solved the
> problem by setting the PYTHONPATH correctly.
> 
> Changing PYTHONPATH doesn't seem to work now, however. I have the .py
> files wich came with mod_python 2.3 in my
> /usr/local/lib/python1.5/site-packages directory. I have compiled a
> threadless python that expects (I assume, having given no --prefix=...
> statement to its ./configure) to find scripts there. I've linked my
> mod_python DSO with this verison of python. 
> 
> My setup is an OpenBSD 2.6 (using the apache that comes bundled), Python
> 1.5, enough memory (128Mb of which 81 are reported "free" byt top).
> 
> I'm trying to load the test.py given in the installation docs, and the
> zhello.py given in the zhandler docs. 
> 
> Any ideas?
> 
> -- Daniel Mikkelsen, Copyleft Software
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From richard at whitequeen.com  Sun Jun 11 12:34:14 2000
From: richard at whitequeen.com (richard offer)
Date: Fri Jan  9 21:51:59 2004
Subject: [mod_python] problems with 2.0 -> 2.3 upgrade
Message-ID: <200006111934.e5BJYEB07387@erij.whitequeen.com>

Hi,

I upgraded from 2.0 to 2.3 this morning and am now seeing the following
error message in the webservers log file

[Sun Jun 11 12:23:33 2000] [notice] child pid 7340 exit signal Segmentation fault (11)
[Sun Jun 11 12:23:33 2000] [notice] child pid 7339 exit signal Segmentation fault (11)
[Sun Jun 11 12:23:35 2000] [notice] child pid 7343 exit signal Segmentation fault (11)
[Sun Jun 11 12:23:36 2000] [notice] child pid 7345 exit signal Segmentation fault (11)
[Sun Jun 11 12:23:36 2000] [notice] child pid 7344 exit signal Segmentation faul


It seems like all child webservers are dying, but the master is running
in a continous loop trying to spawn the children.


Moving the old (2.0) DSO and python code back into place fixed it.

[ Running Apache 1.3.12 on Redhat 6.1/2.2.16 ]


Any hints ?

richard.

-- 
richard offer @ home 
          84 FE 48 E4 74 D0 26 D4  31 8E B6 86 98 74 E2 7C  8A FB BF A3
___________________________________http://216.185.15.144/users/richard/

From grisha at ispol.com  Sun Jun 11 16:03:47 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:51:59 2004
Subject: [mod_python] problems with 2.0 -> 2.3 upgrade
In-Reply-To: <200006111934.e5BJYEB07387@erij.whitequeen.com>
Message-ID: <Pine.LNX.4.21.0006111558070.7904-100000@saturn.ispol.com>

Someone else reported this and I know what the problem is.

There are two things you can do:

1. downgrade to 2.2 and wait until 2.4
2. add a dummy PythonImport statement in the httpd.conf file between some
<Directory> tags, e.g.

PythonImport string

This is because I added the new PythonImport derective and did all the
testing and it worked fine, except when the directive is NOT specified and
thus the variable that holds the info is undefined.... Sorry, I'll be more
thorough next time!

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Sun, 11 Jun 2000, richard offer wrote:

> 
> Hi,
> 
> I upgraded from 2.0 to 2.3 this morning and am now seeing the following
> error message in the webservers log file
> 
> [Sun Jun 11 12:23:33 2000] [notice] child pid 7340 exit signal Segmentation fault (11)
> [Sun Jun 11 12:23:33 2000] [notice] child pid 7339 exit signal Segmentation fault (11)
> [Sun Jun 11 12:23:35 2000] [notice] child pid 7343 exit signal Segmentation fault (11)
> [Sun Jun 11 12:23:36 2000] [notice] child pid 7345 exit signal Segmentation fault (11)
> [Sun Jun 11 12:23:36 2000] [notice] child pid 7344 exit signal Segmentation faul
> 
> 
> It seems like all child webservers are dying, but the master is running
> in a continous loop trying to spawn the children.
> 
> 
> Moving the old (2.0) DSO and python code back into place fixed it.
> 
> [ Running Apache 1.3.12 on Redhat 6.1/2.2.16 ]
> 
> 
> Any hints ?
> 
> richard.
> 
> -- 
> richard offer @ home 
>           84 FE 48 E4 74 D0 26 D4  31 8E B6 86 98 74 E2 7C  8A FB BF A3
> ___________________________________http://216.185.15.144/users/richard/
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From wayne.izatt at myself.com  Sun Jun 11 13:46:08 2000
From: wayne.izatt at myself.com (Wayne Izatt)
Date: Fri Jan  9 21:51:59 2004
Subject: [mod_python] problems with 2.0 -> 2.3 upgrade
References: <200006111934.e5BJYEB07387@erij.whitequeen.com>
Message-ID: <3943FA8F.B7743662@myself.com>

richard offer wrote:

> Hi,
>
> I upgraded from 2.0 to 2.3 this morning and am now seeing the following
> error message in the webservers log file
>
> [Sun Jun 11 12:23:33 2000] [notice] child pid 7340 exit signal Segmentation fault (11)

<snip>

I get the same problem - same apache, same redhat.

<rant>

I'm getting sick and tired of these sorts of issues with redhat. I have apache problems
using PHP 4.0 with redhat, and mod_perl doesn't always work as expected on redhat.

</rant>


>
> It seems like all child webservers are dying, but the master is running
> in a continous loop trying to spawn the children.
>
> Moving the old (2.0) DSO and python code back into place fixed it.
>
> [ Running Apache 1.3.12 on Redhat 6.1/2.2.16 ]
>
> Any hints ?
>
> richard.
>
> --
> richard offer @ home
>           84 FE 48 E4 74 D0 26 D4  31 8E B6 86 98 74 E2 7C  8A FB BF A3
> ___________________________________http://216.185.15.144/users/richard/
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python


From sbi at acse.be  Mon Jun 12 23:06:03 2000
From: sbi at acse.be (=?iso-8859-1?Q?St=E9phane_Bidoul?=)
Date: Fri Jan  9 21:51:59 2004
Subject: [mod_python] Re: Another threading issue: chdir (fwd)
References: <Pine.LNX.4.21.0006091703340.21671-100000@saturn.ispol.com>
Message-ID: <00b401bfd4b2$0aed8a30$faa679c1@spirou>

>The more I think about this, the more it seems to me that doing away with
>the chdir and prepending the path rather than the '.' is the way to go.

Agreed, but I wonder how much the manipulation of sys.path to do the imports
can cause threading issues... Is it possible to avoid it?

>This will break old code that relied on the chdir being there, but what
>can you do...
>All the other solutions will make threaded mod_python incompatible with
>nonthreaded be it extra directives or different code that you need....

Cross platform compatibility is indeed important. To achive it people
should be told to assume multi-threaded operation: to be portable
to windows, and also to be Apache2-proof [since I understand that
it will use threads on Unix also; but it may not be a target for mod_python,
I don't know how different the API is].

-sbi




From gstein at lyra.org  Mon Jun 12 14:18:20 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:51:59 2004
Subject: [mod_python] Re: Another threading issue: chdir (fwd)
In-Reply-To: <00b401bfd4b2$0aed8a30$faa679c1@spirou>; from sbi@acse.be on Mon, Jun 12, 2000 at 11:06:03PM +0200
References: <Pine.LNX.4.21.0006091703340.21671-100000@saturn.ispol.com> <00b401bfd4b2$0aed8a30$faa679c1@spirou>
Message-ID: <20000612141820.R19484@lyra.org>

On Mon, Jun 12, 2000 at 11:06:03PM +0200, St?phane Bidoul wrote:
> >The more I think about this, the more it seems to me that doing away with
> >the chdir and prepending the path rather than the '.' is the way to go.
> 
> Agreed, but I wonder how much the manipulation of sys.path to do the imports
> can cause threading issues... Is it possible to avoid it?

sys.path is specific to an interpreter, rather than to a thread. Therefore,
threads should not be changing it.

> >This will break old code that relied on the chdir being there, but what
> >can you do...
> >All the other solutions will make threaded mod_python incompatible with
> >nonthreaded be it extra directives or different code that you need....
> 
> Cross platform compatibility is indeed important. To achive it people
> should be told to assume multi-threaded operation: to be portable
> to windows, and also to be Apache2-proof [since I understand that
> it will use threads on Unix also;

Correct. Apache 2.0 is threaded whenever threads are available (basically
everywhere nowadays). You can still run Apache 2.0 in its current mode, but
the default is threaded.

> but it may not be a target for mod_python,
> I don't know how different the API is].

The API is different enough; a 1.3 module can be ported, but it would be
reasonably difficult to have a module be compileable for both.

There are a number of other things that can be taken advantage of in the
Apache 2.0 API to improve/tighten the Apache/Python binding. I've been
planning to implement an Apache 2.0 specific "mod_py2" this summer to take
advantage of the 2.0 benefits. (as an Apache author, I can also make changes
to Apache to enhance this even further :-) In conjunction with that work,
I'm going to redo my "free threading patches" for 1.6 so that Python can
operate completely threaded within Apache 2.0 (e.g. the central lock
disappears entirely).

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/

From grisha at ispol.com  Mon Jun 12 17:30:14 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:51:59 2004
Subject: [mod_python] Re: Another threading issue: chdir (fwd)
In-Reply-To: <00b401bfd4b2$0aed8a30$faa679c1@spirou>
Message-ID: <Pine.LNX.4.21.0006121714500.12547-100000@saturn.ispol.com>

On Mon, 12 Jun 2000, St?phane Bidoul wrote:

> >The more I think about this, the more it seems to me that doing away with
> >the chdir and prepending the path rather than the '.' is the way to go.
> 
> Agreed, but I wonder how much the manipulation of sys.path to do the imports
> can cause threading issues... Is it possible to avoid it?

You could avoid it by making sure that the Pythonpath includes the
directory where your handlers are from the start, for example by setting
PYTHONPATH in the Apache startup script. But if we're going this route, we
might as well abandon the multiple interpreters.

Another problem with this is that typically you'll have to be root on the
system to restart Apache, and in many cases users are not.

On the upside, sys.path shouldn't get manipulated more than once. An
interpreter will get created and the sys.path changed upon the first hit,
after that it won't change. The sys.path manipualtion should be surrounded
by Python locks.

I have another idea - unless I'm missing something obvious, the way to
deal with this would be to add the directory to the path at interpreter
creation time in mod_python.c.

Grisha



From grisha at ispol.com  Mon Jun 12 17:48:08 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:51:59 2004
Subject: [mod_python] Re: Another threading issue: chdir (fwd)
In-Reply-To: <20000612141820.R19484@lyra.org>
Message-ID: <Pine.LNX.4.21.0006121740030.12547-100000@saturn.ispol.com>

On Mon, 12 Jun 2000, Greg Stein wrote:

> On Mon, Jun 12, 2000 at 11:06:03PM +0200, St?phane Bidoul wrote:
> > >The more I think about this, the more it seems to me that doing away with
> > >the chdir and prepending the path rather than the '.' is the way to go.
> > 
> > Agreed, but I wonder how much the manipulation of sys.path to do the imports
> > can cause threading issues... Is it possible to avoid it?
> 
> sys.path is specific to an interpreter, rather than to a thread. Therefore,
> threads should not be changing it.

On a related note though - is ap_table_set() thread-safe? I'm thinking of
all the Python* directives in .htaccess.

> as an Apache author, I can also make changes to Apache to enhance
> this even further :-)

Now that's luxury!

Grisha


From gstein at lyra.org  Mon Jun 12 14:57:19 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:51:59 2004
Subject: [mod_python] Re: Another threading issue: chdir (fwd)
In-Reply-To: <Pine.LNX.4.21.0006121740030.12547-100000@saturn.ispol.com>; from grisha@ispol.com on Mon, Jun 12, 2000 at 05:48:08PM -0400
References: <20000612141820.R19484@lyra.org> <Pine.LNX.4.21.0006121740030.12547-100000@saturn.ispol.com>
Message-ID: <20000612145719.U19484@lyra.org>

On Mon, Jun 12, 2000 at 05:48:08PM -0400, Gregory Trubetskoy wrote:
> On Mon, 12 Jun 2000, Greg Stein wrote:
>...
> > sys.path is specific to an interpreter, rather than to a thread. Therefore,
> > threads should not be changing it.
> 
> On a related note though - is ap_table_set() thread-safe? I'm thinking of
> all the Python* directives in .htaccess.

They are not thread-safe, but the only tables that would be changed are in
the request_rec and possibly the conn_rec. In other words: private to the
thread.

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/

From grisha at ispol.com  Mon Jun 12 18:23:28 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:51:59 2004
Subject: [mod_python] Re: Another threading issue: chdir (fwd)
In-Reply-To: <20000612145719.U19484@lyra.org>
Message-ID: <Pine.LNX.4.21.0006121818230.12547-100000@saturn.ispol.com>

On Mon, 12 Jun 2000, Greg Stein wrote:

> On Mon, Jun 12, 2000 at 05:48:08PM -0400, Gregory Trubetskoy wrote:
> > 
> > On a related note though - is ap_table_set() thread-safe? I'm thinking of
> > all the Python* directives in .htaccess.
> 
> They are not thread-safe, but the only tables that would be changed are in
> the request_rec and possibly the conn_rec. In other words: private to the
> thread.

Hmm.... But it might be a problem for PythonImport. PythonImport builds a
table a pointer to which is a global variable python_import. Then,
ChildInitHandler goes through that table and imports all the modules.

The reason PythonImport doesn't use the standard config stuff is that
ap_get_module_config() returns NULL inside a child init handler.

Am I taking the wrong apporach on this?

Grisha


From Mads at Kiilerich.com  Tue Jun 13 10:06:12 2000
From: Mads at Kiilerich.com (Mads Kiilerich)
Date: Fri Jan  9 21:51:59 2004
Subject: [mod_python] AttributeError: handler
In-Reply-To: <Pine.LNX.4.21.0006050938520.31412-100000@saturn.ispol.com>
Message-ID: <Pine.LNX.4.21.0006122243040.1325-100000@localhost>

Jun 5 I got mail from Gregory Trubetskoy:

> Everyone who reported this problem so far found later on that they had
> extra blanks in their test.py because they cut and pasted from the web
> page.

That makes me a speciel case. I found the solution to my problem
- and the problem wasn't spaces. 

The problem was that the PythonHandler I had specified wasn't in
the same directory as the directive was given in - thus the
handler couldn't be found.  I found this behaviour very
confusing - but now when I know it it starts to make sense! ;)

Correcting the path solved the problem. Another solution was to
add the PythonInterpPerDirectory directive.

Cheers,

-- 
Mads Kiilerich          Sys.Adm. Cand.Polyt
Mads@Kiilerich.com      Tel. +45 38 16 26 00  Mob. +45 26 20 07 73
M?ntmestervej 12B 1th,  DK-2400 NV,  Denmark

"Learned about WAP. It sucks. The more I play with WML the more sure I 
am that WAP will die out rapidly once phones doing HTML exist."    Cox




From Mads at Kiilerich.com  Tue Jun 13 10:07:07 2000
From: Mads at Kiilerich.com (Mads Kiilerich)
Date: Fri Jan  9 21:51:59 2004
Subject: [mod_python] AttributeError: handler
In-Reply-To: <20000605140841.29193.qmail@web2205.mail.yahoo.com>
Message-ID: <Pine.LNX.4.21.0006122249210.1325-100000@localhost>

Jun 5 I got mail from Alexis Iglauer:

> Always a good idea to just run python over your script
> before trying to run it on the webserver - this will
> pick up any inconsistent dedents or other little
> syntax nasties.

"Run python over".  How do I do that? With a compileall? (I
guess not, as performing a compileall gives a "Listing test.py
...\nCan't list test.py".)

TIA,
-- 
Mads Kiilerich          Sys.Adm. Cand.Polyt
Mads@Kiilerich.com      Tel. +45 38 16 26 00  Mob. +45 26 20 07 73
M?ntmestervej 12B 1th,  DK-2400 NV,  Denmark

"Learned about WAP. It sucks. The more I play with WML the more sure I 
am that WAP will die out rapidly once phones doing HTML exist."    Cox




From Mads at Kiilerich.com  Tue Jun 13 10:10:20 2000
From: Mads at Kiilerich.com (Mads Kiilerich)
Date: Fri Jan  9 21:51:59 2004
Subject: [mod_python] 2.2 is out
In-Reply-To: <Pine.LNX.4.21.0006041452530.28185-100000@saturn.ispol.com>
Message-ID: <Pine.LNX.4.21.0006131007280.904-200000@localhost>

Jun 4 I got mail from Gregory Trubetskoy:

> Also thanks to Gerhard Haering for the Suse RPM's. It'd be nice if someone
> came up and agreed to maintain with RedHat RPM, Debian package, a FreeBSD
> port and a Solaris package...

I've made a spec for RedHat, you'll find it attached. IMHO, if
you make a rpm and install it on a plain 6.2 system you'll get
something that works and can be used as a base for further
experiments.

Feedback is welcome!

Regards,

-- 
Mads Kiilerich          Sys.Adm. Cand.Polyt
Mads@Kiilerich.com      Tel. +45 38 16 26 00  Mob. +45 26 20 07 73
M?ntmestervej 12B 1th,  DK-2400 NV,  Denmark

"Learned about WAP. It sucks. The more I play with WML the more sure I 
am that WAP will die out rapidly once phones doing HTML exist."    Cox

-------------- next part --------------
Summary: The Python language for use with Apache.
Name: mod_python
Version: 2.2
Release: 0
Group: System Environment/Daemons
Source0: %{name}-%{version}.tgz
Copyright: BSD-ish???
BuildRoot: %{_tmppath}/%{name}-root
Requires: apache >= 1.3 , python >= 1.5.2
BuildPrereq: apache-devel 
Packager: Mads Kiilerich <mads@kiilerich.com>

%description
Mod_python allows embedding Python within the Apache http server for a
considerable boost in performance and added flexibility in designing web based
applications. 

The RPM installs a small example in /home/httpd/mod_python which can be
accessed as http://localhost/mod_python/some/path/which/doesn/t/matter

%prep
%setup -q -n mod_python-%{version}

%build
# 1. Installing Python Libraries
/usr/bin/python /usr/lib/python1.5/compileall.py lib/python/mod_python

# 2. Compiling -- Compiling mod_python as a DSO
apxs -I /usr/include/python1.5 -c src/mod_python.c \
	/usr/lib/python1.5/config/libpython1.5.a -lpthread

%install
rm -rf $RPM_BUILD_ROOT
install -D -s src/mod_python.so $RPM_BUILD_ROOT/usr/lib/apache/mod_python.so
mkdir -p $RPM_BUILD_ROOT/usr/lib/python1.5/site-packages/mod_python
install lib/python/mod_python/* \
	$RPM_BUILD_ROOT/usr/lib/python1.5/site-packages/mod_python
mkdir -p $RPM_BUILD_ROOT/home/httpd/mod_python
cat <<CAT>$RPM_BUILD_ROOT/home/httpd/mod_python/.htaccess
SetHandler python-program
PythonHandler pythonhandler
CAT
cat <<CAT>$RPM_BUILD_ROOT/home/httpd/mod_python/pythonhandler.py 
from mod_python import apache

def handler(req):
    req.send_http_header()
    req.write("Hello to the World from "+req.uri+"!")
    return apache.OK 
CAT

%clean
rm -rf $RPM_BUILD_ROOT

%post
grep -q 'LoadModule python_module' /etc/httpd/conf/httpd.conf || \
patch /etc/httpd/conf/httpd.conf <<CAT
*** httpd.conf.org      
--- httpd.conf  
***************
*** 206,207 ****
--- 206,208 ----
  # LoadModule foo_module modules/mod_foo.so
+ LoadModule python_module      modules/mod_python.so
  #LoadModule mmap_static_module modules/mod_mmap_static.so
***************
*** 253,254 ****
--- 254,256 ----
  ClearModuleList
+ AddModule mod_python.c
  #AddModule mod_mmap_static.c
***************
*** 965,966 ****
--- 967,974 ----
  
+ <IfModule mod_python.c>
+   Alias /mod_python/ /home/httpd/mod_python/
+   <Directory /home/httpd/mod_python>
+     AllowOverride FileInfo
+   </Directory>
+ </IfModule>
  ### Section 3: Virtual Hosts
CAT

%postun
perl -pi -e 's|^LoadModule python_module|#LoadModule python_module|g' \
 	/etc/httpd/conf/httpd.conf
perl -pi -e 's|^AddModule mod_python.c|#AddModule mod_python.c|g' \
	/etc/httpd/conf/httpd.conf

%files
%defattr(-,root,root)
%attr(0755,root,root) /usr/lib/apache/mod_python.so
/usr/lib/python1.5/site-packages/mod_python
/home/httpd/mod_python
%doc COPYRIGHT doc/*.html

%changelog
* Mon Jun 13 2000 Mads Kiilerich <mads@kiilerich.com>
- Made initial version of mod_python rpm
From sbi at acse.be  Tue Jun 13 19:08:18 2000
From: sbi at acse.be (=?iso-8859-1?Q?St=E9phane_Bidoul?=)
Date: Fri Jan  9 21:51:59 2004
Subject: [mod_python] Slashes...
Message-ID: <021c01bfd559$fdc62490$66a679c1@spirou>

A potential problem with slashes:
Windows NT accepts / or \, while Windows 9x accepts only \.

It means that with this directive:

<Directory "c:/soft/apache/htdocs/test2/">
  PythonHandler test2
</Directory>

mod_python ends up importing c:/soft/apache/htdocs/test2/\test2.py.

It works fine so it should not be an issue. 

Could it be an issue in get_request_object where the trailing
slash is first removed then added again? 
[I'm not sure to understand that area so I can't tell myself]

Maybe the functions from os.path should be used to be safe?

Also, I've found this in the apache doc:

<ApacheDocExcerpt>
The directives that accept filenames as arguments now must use Windows filenames instead of Unix ones. However, because Apache uses Unix-style names internally, you must use forward slashes, not backslashes. Drive letters can be used; if omitted, the drive with the Apache executable will be assumed.
</ApacheDocExcerpt>

So I'm not sure what is the right approach...

Regards.

-sbi



From sbi at acse.be  Tue Jun 13 19:07:53 2000
From: sbi at acse.be (=?iso-8859-1?Q?St=E9phane_Bidoul?=)
Date: Fri Jan  9 21:51:59 2004
Subject: [mod_python] Re: Another threading issue: chdir (fwd)
References: <Pine.LNX.4.21.0006121714500.12547-100000@saturn.ispol.com>
Message-ID: <020a01bfd559$eef3e470$66a679c1@spirou>

>I have another idea - unless I'm missing something obvious, the way to
>deal with this would be to add the directory to the path at interpreter
>creation time in mod_python.c.

I see nothing wrong with that either. 
I think is done already in ChildInitHandler when 
PythonImport is specified, so why not do it systematically.

-sbi





From gstein at lyra.org  Wed Jun 14 00:04:13 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:52:00 2004
Subject: [mod_python] mod_snake
Message-ID: <20000614000413.G27338@lyra.org>

fyi...

http://modsnake.sourceforge.net/

-- 
Greg Stein, http://www.lyra.org/

From richard at whitequeen.com  Tue Jun 13 05:35:59 2000
From: richard at whitequeen.com (richard offer)
Date: Fri Jan  9 21:52:00 2004
Subject: [mod_python] mod_snake
In-Reply-To: Greg Stein <gstein@lyra.org>
       "[mod_python] mod_snake" (Jun 14, 12:04am)
Message-ID: <200006131235.e5DCZxu10283@erij.whitequeen.com>

* $ from gstein@lyra.org at "14-Jun:12:04am" | sed "1,$s/^/* /" 
*
*
* fyi...
* 
* http://modsnake.sourceforge.net/

Has anyone played with it yet, pros ? cons ? I like the idea of moving
to Apache 2.0, and it seems to have reasonable documentation (probably
my biggest gripe about mod_python is the sparse docs).

On the other hand I'm close to getting something to show...

* Greg Stein, http://www.lyra.org/

richard.


-- 
richard offer @ home 
          84 FE 48 E4 74 D0 26 D4  31 8E B6 86 98 74 E2 7C  8A FB BF A3
___________________________________http://216.185.15.144/users/richard/

From grisha at ispol.com  Wed Jun 14 12:34:46 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:52:00 2004
Subject: [mod_python] mod_snake
In-Reply-To: <200006131235.e5DCZxu10283@erij.whitequeen.com>
Message-ID: <Pine.LNX.4.21.0006141233360.22477-100000@saturn.ispol.com>

On Tue, 13 Jun 2000, richard offer wrote:

> to Apache 2.0, and it seems to have reasonable documentation (probably
> my biggest gripe about mod_python is the sparse docs).

Hmmm... Everyone else said the documentation was very thorough. What do
think is missing?

Grisha


From sjbotha at email.com  Wed Jun 14 19:08:40 2000
From: sjbotha at email.com (Sarel J. Botha)
Date: Fri Jan  9 21:52:00 2004
Subject: [mod_python] Just displays
Message-ID: <20000614190839.A30053@home>

I'm having a bit of a problem with mod_python. The module gets loaded (I
can see in the logs), but when I access a .py file it just prints the
source.

I've got this in srm.conf:
AddHandler python-program .py

As far as I can tell, that's all that's needed, right?

Thanks
-- 
------------------
Sarel Botha
sjbotha@email.com
------------------

99 little bugs in the code, 99 bugs in the code,
          fix one bug, compile it again...
          101 little bugs in the code....


From richard at whitequeen.com  Tue Jun 13 07:35:21 2000
From: richard at whitequeen.com (richard offer)
Date: Fri Jan  9 21:52:00 2004
Subject: [mod_python] mod_snake
In-Reply-To: Gregory Trubetskoy <grisha@ispol.com>
       "Re: [mod_python] mod_snake" (Jun 14, 12:34pm)
Message-ID: <200006131435.e5DEZLM10444@erij.whitequeen.com>

* $ from grisha@ispol.com at "14-Jun:12:34pm" | sed "1,$s/^/* /" 
*
*
* 
* On Tue, 13 Jun 2000, richard offer wrote:
* 
* > to Apache 2.0, and it seems to have reasonable documentation (probably
* > my biggest gripe about mod_python is the sparse docs).
* 
* Hmmm... Everyone else said the documentation was very thorough. What do
* think is missing?

It took me a while to work out the relationship between the PythonHandler 
<entry> and the location of the file.py I wanted to run. I figured it out
eventually, but these are the sorts of questions that need to be obvious,
sicne they are only met by first time users (when I was a system manager, 
if it took me any longer than an 1/2 day to get a piece of software working,
it went to the the bottome the queue---under those rules I'd be using 
php now).

There are no function prototypes in the docs, it took me a while to
figure out that req.read() needed a length argument.

I have to refer to the Apache C docs to work out what members I can use
in the request structure.

The examples are too short, something demonstrating the handling of url
args would have saved me a day, needing to test for req.method as well
as req.args is more hassle. 

I hope to publish my code in the next few weeks (interface to a MySQL 
image database with search etc), maybe just a few contributed demos
would help. I'd like to see some drop in contributed modules like
php/mod_perl has.


Now I admit that I'm new to this (web programming) but I'm a self taught C
OS programmer, so if I can waste days in figuring it out, this isn't CP4E.

Please don't take the above as anything but constructive critism, I like
mod_python, it got me off my ass and working on the web site which I'd
been postponing for months, and for that I'm grateful.

* 
* Grisha
* 

richard.


-- 
richard offer @ home 
          84 FE 48 E4 74 D0 26 D4  31 8E B6 86 98 74 E2 7C  8A FB BF A3
___________________________________http://216.185.15.144/users/richard/

From martin at src.no  Thu Jun 15 10:48:12 2000
From: martin at src.no (Martin Jenssen)
Date: Fri Jan  9 21:52:00 2004
Subject: [mod_python] Difficulties with Windows NT/Apache/mod_python
Message-ID: <Pine.LNX.4.21.0006151030550.23457-100000@lade.src.no>

Hello,

I am getting some strange messages when trying to setup Apache with
mod_python on Windows NT.  I used the precompiled binary of mod_python 2.2
as found on http://www.modpython.org/, the precompiled binary of Apache
1.3.12 as found on http://www.apache.org/ and Windows NT 4.0 Server.

When I try to start Apache with mod_python configured as specified in the
documentation, I get these messages:

"""
make_obcallback(): could not import mod_python.apache.
make_obcallback(): could not call init.
Apache/1.3.12 (Win32) mod_python/2.2 Python/1.5.2 running...
"""

Strangely, it doesn't quit, but continues to try to serve web pages.  For
each .py file I try to reach via the web browser, I get these messages
thrown into the error.log file:

"""
[Thu Jun 15 10:37:45 2000] [error] [client 193.71.134.144] \
	python_handler: get_obcallback returned no obCallBack!
"""


Martin Jenssen


From daniel at copyleft.no  Thu Jun 15 11:03:42 2000
From: daniel at copyleft.no (Hr. Daniel Mikkelsen)
Date: Fri Jan  9 21:52:00 2004
Subject: [mod_python] Difficulties with Windows NT/Apache/mod_python
In-Reply-To: <Pine.LNX.4.21.0006151030550.23457-100000@lade.src.no>
Message-ID: <Pine.LNX.4.10.10006151100460.6024-100000@unity.copyleft.no>

> make_obcallback(): could not import mod_python.apache.
> make_obcallback(): could not call init.
> Apache/1.3.12 (Win32) mod_python/2.2 Python/1.5.2 running...

I got these messages when I copied the _files_ in the
lib/python/mod_python dir into site-packages, instead 
of copying the entire _directory_, by mistake. 

Anyway, it's a problem of your python interpreter not 
finding the mod_python modules. Use PYTHONPATH in the 
environment or PythonPath in the apache.conf. 

-- Daniel Mikkelsen, Copyleft Software



From grisha at ispol.com  Thu Jun 15 07:44:04 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:52:00 2004
Subject: [mod_python] Difficulties with Windows NT/Apache/mod_python
In-Reply-To: <Pine.LNX.4.21.0006151030550.23457-100000@lade.src.no>
Message-ID: <Pine.LNX.4.21.0006150742280.28199-100000@saturn.ispol.com>

Sounds to me like the mod_python package is not in your pythonpath.

BTW, the win32 binary is unstable because of some thread problems. 2.4
should be considerably more stable and will come out in a couple of days.

Grisha

On Thu, 15 Jun 2000, Martin Jenssen wrote:

> Hello,
> 
> I am getting some strange messages when trying to setup Apache with
> mod_python on Windows NT.  I used the precompiled binary of mod_python 2.2
> as found on http://www.modpython.org/, the precompiled binary of Apache
> 1.3.12 as found on http://www.apache.org/ and Windows NT 4.0 Server.
> 
> When I try to start Apache with mod_python configured as specified in the
> documentation, I get these messages:
> 
> """
> make_obcallback(): could not import mod_python.apache.
> make_obcallback(): could not call init.
> Apache/1.3.12 (Win32) mod_python/2.2 Python/1.5.2 running...
> """
> 
> Strangely, it doesn't quit, but continues to try to serve web pages.  For
> each .py file I try to reach via the web browser, I get these messages
> thrown into the error.log file:
> 
> """
> [Thu Jun 15 10:37:45 2000] [error] [client 193.71.134.144] \
> 	python_handler: get_obcallback returned no obCallBack!
> """
> 
> 
> Martin Jenssen
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From sjbotha at email.com  Thu Jun 15 21:54:59 2000
From: sjbotha at email.com (Sarel J. Botha)
Date: Fri Jan  9 21:52:00 2004
Subject: [mod_python] Re: Just displays
In-Reply-To: <20000614190839.A30053@home>; from  on Wed, Jun 14, 2000 at 07:08:40PM +0200
References: <20000614190839.A30053@home>
Message-ID: <20000615215457.A9676@home>

On Wed, Jun 14, 2000 at 07:08:40PM +0200, I wrote:
> I'm having a bit of a problem with mod_python. The module gets loaded (I
> can see in the logs), but when I access a .py file it just prints the
> source.

I still can't get it working.

I've got LoadModule python_module /usr/local/lib/apache/1.3/mod_python.so
in httpd.conf and the module loads, as I can see it in the logs:
[Thu Jun 15 21:40:52 2000] [notice] Apache/1.3.12 (Unix) Debian/GNU PHP/4.0RC1 mod_python/2.2 Python/1.5.2 configured -- resuming normal operations

I've got this in srm.conf:
  AddHandler python-program .py

It just prints the file, as if the AddHandler directive weren't there.

Thanks
-- 
------------------
Sarel Botha
sjbotha@email.com
------------------

99 little bugs in the code, 99 bugs in the code,
          fix one bug, compile it again...
          101 little bugs in the code....


From grisha at ispol.com  Thu Jun 15 18:00:31 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:52:00 2004
Subject: [mod_python] Re: Just displays
In-Reply-To: <20000615215457.A9676@home>
Message-ID: <Pine.LNX.4.21.0006151759230.28199-100000@saturn.ispol.com>

On Thu, 15 Jun 2000, Sarel J. Botha wrote:

> On Wed, Jun 14, 2000 at 07:08:40PM +0200, I wrote:
> 
> I've got this in srm.conf:
>   AddHandler python-program .py
> 
> It just prints the file, as if the AddHandler directive weren't there.

Are you sure your srm.conf file is being read at all? Move the directive
into httpd.conf. srm.conf is obsolete and shouldn't be used anyway.

Grisha


From sjbotha at email.com  Fri Jun 16 02:29:10 2000
From: sjbotha at email.com (Sarel J. Botha)
Date: Fri Jan  9 21:52:00 2004
Subject: [mod_python] Re: Just displays
In-Reply-To: <Pine.LNX.4.21.0006151759230.28199-100000@saturn.ispol.com>; from grisha@ispol.com on Thu, Jun 15, 2000 at 06:00:31PM -0400
References: <20000615215457.A9676@home> <Pine.LNX.4.21.0006151759230.28199-100000@saturn.ispol.com>
Message-ID: <20000616022908.A11353@home>

On Thu, Jun 15, 2000 at 06:00:31PM -0400, Gregory Trubetskoy wrote:
> Are you sure your srm.conf file is being read at all? Move the directive
> into httpd.conf. srm.conf is obsolete and shouldn't be used anyway.

That's great to hear. I've always thought it was a bit silly to have so
many different config files.

It is reading srm.conf, I just added a .cgi Handler and it works. Without
it, it doesn't.

Thanks
-- 
------------------
Sarel Botha
sjbotha@email.com
------------------

99 little bugs in the code, 99 bugs in the code,
          fix one bug, compile it again...
          101 little bugs in the code....


From geoff at ijane.com  Fri Jun 16 10:54:15 2000
From: geoff at ijane.com (geoff@ijane.com)
Date: Fri Jan  9 21:52:00 2004
Subject: [mod_python] python rewrite of mod_usertrack
Message-ID: <20000616155414.IQGO860.mta1biz.bizmailsrvcs.net@web1biz.bizmailsrvcs.net>

Here is a first pass at a session tracking module using mod_python.
It is basically a mod_usertrack rip-off.
Let me know what you think.
-geoff greenberg

From geoff at ijane.com  Fri Jun 16 11:19:33 2000
From: geoff at ijane.com (geoff@ijane.com)
Date: Fri Jan  9 21:52:00 2004
Subject: [mod_python] python rewrite of mod_usertrack (actual module this time)
Message-ID: <20000616161933.ANH135729.mta1biz.bizmailsrvcs.net@web1biz.bizmailsrvcs.net>

Sorry.
I didn't realize that attachment didn't work.
Here is the module (usertrack.py):

"""This module is a shameless rewrite of mod_usertrack in python.  It should
operate in most respects like mod_usertrack.  The exception would be that it
always sets a 4 digit year for an expire date.

Logging
This will be handled by mod_log_config, the custom log module.  The cookie
will be available by using the token, "%{session_cookie}n".
For example:

LogFormat "%t \"%r\" %>s \"%{session_cookie}n\"" session
CustomLog /usr/local/apache/logs/session_log session

PythonOptions
There are three options that can be configured: CookieExpires, CookieName
and CookieTracking.   These basically work the same as mod_usertrack's
directives of the same name.

CookieExpires
This option sets an expiration time for the cookie generated by this module.
This time can be either a number of seconds or a string describing the
amount of time.  If this option does not exist the cookie will expire when
the browser's session does.  The time string must be quoted and is in the
format of a space separeated list of "number label" pairs.  Valid labels
are: years, months, weeks, days, hours, minutes, seconds.

CookieName
If this option exists the default name of the cookie will be whatever the
label specifies.

CookieTracking
This option is required if you will to use this module.  It's value must be
"on" for this module to operate.


httpd.conf example:

<Directory />
    PythonPath "['/usr/lib/python1.5', '/usr/lib/python1.5/site-packages']"

    PythonDebug
    PythonOption CookieName k3WL_c00KI3_nAM3
    PythonOption CookieTracking on
    PythonOption CookieExpires "10 years 4 months 2 weeks 3 days 2 hours 36
seconds"
    PythonFixupHandler usertrack
</Directory>

"""
__version__ = "$Id: usertrack.py,v 1.1 2000/06/02 09:00:31 geoff Exp $"
from mod_python import apache
import re, string, time, os

isDigit = re.compile("^\d+$")
isSpace = re.compile("\s+")

FACTOR = {
    'years': 60 * 60 * 24 * 365,
    'months': 60 * 60 * 24 * 30,
    'weeks': 60 * 60 * 24 * 7,
    'days': 60 * 60 * 24,
    'hours': 60 * 60,
    'minutes': 60,
    'seconds': 1,
    }            

COOKIE_NAME = "Apache_Python"

def fixuphandler(r):
    global COOKIE_NAME
    opt = r.get_options()
    if opt['CookieTracking'] != 'on':
        return apache.DECLINED
    else:
        if opt.has_key('CookieName'): COOKIE_NAME = opt['CookieName']
        try:
            m = re.search("(?:^|\s+)%s=(?P<cookieValue>[^;]+)" %
COOKIE_NAME, \
                          r.headers_in['Cookie'])
            r.notes['session_cookie'] = m.group('cookieValue')
            return apache.DECLINED
        except:
            expires = 0
            if opt.has_key('CookieExpires'):
                expires = r.request_time + \
                                 parseExpire(opt['CookieExpires'])
            make_cookie(r, COOKIE_NAME, expires)
    return apache.OK
        
def make_cookie(r, name, expires):
    """Set a unique cookie for user tracking."""
    cookieValue = "%s.%d%ld%ld" % (r.hostname, os.getpid(), r.request_time,
\
                                   time.clock())
    if expires == 0:
        r.headers_out['Set-Cookie'] = "%s=%s; path=/" % (name, \
                                                         cookieValue)
    else:
        r.headers_out['Set-Cookie'] = "%s=%s; path=/; expires=%s GMT" % \
            (name, cookieValue, time.strftime("%A, %d-%b-%Y %H:%M:%S", \
            time.gmtime(expires)))  
    r.notes['session_cookie'] = cookieValue
    return

def parseExpire(expire):
    """Return number of seconds from a formated string."""
    if isDigit.search(expire): return expire
    seconds = 0
    t = isSpace.split(expire)
    tLen = len(t)
    i = 0
    while i < tLen:
        if isDigit.search(t[i]):
            seconds = seconds + (FACTOR.get(string.lower(t[i + 1]), 0) * \
                                 string.atoi(t[i]))
        i = i + 2
    return seconds

From grisha at ispol.com  Fri Jun 16 12:43:43 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:52:00 2004
Subject: [mod_python] python rewrite of mod_usertrack (actual module this
 time)
In-Reply-To: <20000616161933.ANH135729.mta1biz.bizmailsrvcs.net@web1biz.bizmailsrvcs.net>
Message-ID: <Pine.LNX.4.21.0006161243020.1238-100000@saturn.ispol.com>

Nice work!

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Fri, 16 Jun 2000 geoff@ijane.com wrote:

> Sorry.
> I didn't realize that attachment didn't work.
> Here is the module (usertrack.py):
> 
> """This module is a shameless rewrite of mod_usertrack in python.  It should
> operate in most respects like mod_usertrack.  The exception would be that it


From jam at quark.emich.edu  Sat Jun 17 10:33:54 2000
From: jam at quark.emich.edu (Jeff)
Date: Fri Jan  9 21:52:00 2004
Subject: [mod_python] release of 2.4 or CVS access
Message-ID: <20000617103354.A3690@quark.emich.edu>

Greetings,

I'd like to do some work with mod_python.. I noticed on the website that 2.3
has a bug that will be fixed in 2.4. 

when and where can I find 2.4? is there a CVS repository I can check out the
code from? what's the bug in 2.3 that's so nasty?

regards,
J
-- 
|| visit gfd <http://quark.emich.edu/>
|| psa member -- <http://www.python.org/psa/> 

From grisha at ispol.com  Sat Jun 17 11:15:51 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:52:00 2004
Subject: [mod_python] release of 2.4 or CVS access
In-Reply-To: <20000617103354.A3690@quark.emich.edu>
Message-ID: <Pine.LNX.4.21.0006171111280.5577-100000@saturn.ispol.com>

On Sat, 17 Jun 2000, Jeff wrote:

> when and where can I find 2.4? 

when - whenever it is done. Some time next week.

where - same place as 2.2 :-)

> is there a CVS repository I can check out the code from? 

there is a CVS repository, but only I have access to it.... I'm
considering putting it out on sourceforge.

> what's the bug in 2.3 that's so nasty?

It basically won't run. You can still download it from the same place as
2.2 - just substitute 2.2 for 2.3. 

Regards - 

Grisha


From jam at quark.emich.edu  Sat Jun 17 11:26:00 2000
From: jam at quark.emich.edu (Jeff)
Date: Fri Jan  9 21:52:00 2004
Subject: [mod_python] access to ap_send_fd from python
Message-ID: <20000617112600.D5135@quark.emich.edu>

Greetings,

I was looking through the API documentation and found the ap_send_fd
function (http://dev.apache.org/apidoc/apidoc_ap_send_fd.html). It's purpose
is to send the contents of a FILE* to the client. 

This seems appropriate when static files need to be served-- decode the URL
the client is asking for, open the file, set the appropriate headers
(content-type in particular), call this function, then close the file. This
moves the 'work' of sending the file into the C code, instead of using
Python, which would seem to be quite a bit faster.

Could this be considered for a future releases of mod_python? 

Are there any issues I should be aware of before trying to get it to work?

Regards,
J
-- 
|| visit gfd <http://quark.emich.edu/>
|| psa member -- <http://www.python.org/psa/> 

From jam at quark.emich.edu  Sat Jun 17 11:30:55 2000
From: jam at quark.emich.edu (Jeff)
Date: Fri Jan  9 21:52:00 2004
Subject: [mod_python] release of 2.4 or CVS access
In-Reply-To: <Pine.LNX.4.21.0006171111280.5577-100000@saturn.ispol.com>; from grisha@ispol.com on Sat, Jun 17, 2000 at 11:15:51AM -0400
References: <20000617103354.A3690@quark.emich.edu> <Pine.LNX.4.21.0006171111280.5577-100000@saturn.ispol.com>
Message-ID: <20000617113055.E5135@quark.emich.edu>

On Sat, Jun 17, 2000 at 11:15:51AM -0400, Gregory Trubetskoy wrote:
> 
> On Sat, 17 Jun 2000, Jeff wrote:
> 
> > when and where can I find 2.4? 
> 
> when - whenever it is done. Some time next week.
> 

clearly ;) I got the impression that it was a simple problem of a NULL
pointer and so should be fairly easy to fix. I assume this means there will
be more than just this change in 2.4? what's on the list?

Regards,
J
-- 
|| visit gfd <http://quark.emich.edu/>
|| psa member -- <http://www.python.org/psa/> 

From grisha at ispol.com  Sat Jun 17 16:04:00 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:52:00 2004
Subject: [mod_python] release of 2.4 or CVS access
In-Reply-To: <20000617113055.E5135@quark.emich.edu>
Message-ID: <Pine.LNX.4.21.0006171602350.6292-100000@saturn.ispol.com>

On Sat, 17 Jun 2000, Jeff wrote:

> clearly ;) I got the impression that it was a simple problem of a NULL
> pointer and so should be fairly easy to fix. I assume this means there will
> be more than just this change in 2.4? what's on the list?

Not much really.

It should work cleanly on Win32 (multithreaded) and then I'm trying add a
tutorial to the documentation.

Grisha


From seant at alum.mit.edu  Sun Jun 18 15:08:15 2000
From: seant at alum.mit.edu (Sean True)
Date: Fri Jan  9 21:52:00 2004
Subject: [mod_python] mod_python style redirection.
Message-ID: <4.3.2.7.2.20000618150623.00bb75f0@pop.ne.mediaone.net>

Any one care to suggest a mod_python appropriate way to redirect a request 
to another page? The ap_internal_redirect() function looks
appropriate but does not seem to be wrapped.

TIA.

-- Sean

==========
Sean True
seant@alum.mit.edu


From grisha at ispol.com  Sun Jun 18 16:11:31 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:52:00 2004
Subject: [mod_python] mod_python style redirection.
In-Reply-To: <4.3.2.7.2.20000618150623.00bb75f0@pop.ne.mediaone.net>
Message-ID: <Pine.LNX.4.21.0006181608100.19774-100000@saturn.ispol.com>

Something like this should work:

	req.headers_out["Location"] = "http://www.redirectto.com/"
	return apache.HTTP_MOVED_TEMPORARILY

Grisha

On Sun, 18 Jun 2000, Sean True wrote:

> Any one care to suggest a mod_python appropriate way to redirect a request 
> to another page? The ap_internal_redirect() function looks
> appropriate but does not seem to be wrapped.
> 
> TIA.
> 
> -- Sean
> 
> ==========
> Sean True
> seant@alum.mit.edu
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From grisha at ispol.com  Tue Jun 20 11:23:41 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:52:00 2004
Subject: [mod_python] mod_python 2.4
Message-ID: <Pine.LNX.4.21.0006201117090.27023-100000@saturn.ispol.com>

Mod_python 2.4 is out. Unlike 2.3, this one should work ;-).

There are some major changes since 2.2:

1. The PythonDebug, PythonInterpPerDirectory and PythonNoReload now
require an argument of On or Off. NOTE - THIS WILL REQUIRE YOU TO CHANGE
YOUR CONFIGS IF YOU'RE USING ANY OF THESE DIRECTIVES!!!

2. A new directive, PythonImport allows you to import modules at child
process initialization time. This is good for initializing database
connections, etc, though this approach has some serious limitations. Read
the documentation for details.

3. We think that most thread-related issues have been resolved and that
mod_python is capable of running stably on Win32. There is a Win32
(i3866) DLL binary available for download. A lot of very valuable input
and work on this was done by St?phane Bidoul and Greg Stein.

4. I tried to improve the docuemntation. All mod_python objects are now
documented down to every single attribute, and there is a small tutorial
started. The tutorial will need some improvements - e.g. examples of
how to deal with forms or cookies.

Regards -

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com



From jam at quark.emich.edu  Tue Jun 20 11:25:48 2000
From: jam at quark.emich.edu (Jeff)
Date: Fri Jan  9 21:52:00 2004
Subject: [mod_python] attempting to download 2.4 -- permission denied.
Message-ID: <20000620112548.A15890@quark.emich.edu>

Greetings,

I tried to download v2.4 just now, and I get a 'permission denied' error.
Could you have a look into this issue?

Thanks!

Regards,
J
-- 
|| visit gfd <http://quark.emich.edu/>
|| psa member -- <http://www.python.org/psa/> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 232 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20000620/a1382baa/attachment-0001.bin
From jam at quark.emich.edu  Tue Jun 20 11:36:39 2000
From: jam at quark.emich.edu (Jeff)
Date: Fri Jan  9 21:52:00 2004
Subject: [mod_python] attempting to download 2.4 -- permission denied.
In-Reply-To: <20000620112548.A15890@quark.emich.edu>; from jam@quark.emich.edu on Tue, Jun 20, 2000 at 11:25:48AM -0400
References: <20000620112548.A15890@quark.emich.edu>
Message-ID: <20000620113639.B15890@quark.emich.edu>

On Tue, Jun 20, 2000 at 11:25:48AM -0400, Jeff wrote:
> Greetings,
> 
> I tried to download v2.4 just now, and I get a 'permission denied' error.
> Could you have a look into this issue?
> 
> Thanks!
> 


it's fixed now, carry on ;)

-- 
|| visit gfd <http://quark.emich.edu/>
|| psa member -- <http://www.python.org/psa/> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 232 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20000620/e0661a03/attachment-0001.bin
From xbouska at infima.cz  Tue Jun 20 18:23:24 2000
From: xbouska at infima.cz (Richard Bouska)
Date: Fri Jan  9 21:52:00 2004
Subject: [mod_python] mod_python does not interoperate with CORBA (omniORB)
Message-ID: <20000620182324.E26145@intranet>

Hello

I am trying to convert one of my project from single threaded corba
server (ILU from PARC XEROX) to multithreaded (omniORB 3.0 FROM at&t). 
But I am unable to use the mod_python due some problems with threads.

The script runs fine as a CGI but when I try use mod_python it stucks in 

corba_init call. It freeses before it transfers any byte through the 
iiop protocol.

When I let the apache live in only one thread - apache -X then 
everything 
workes well.

Has anoybody some idea what I shell try?

configuration:

Linux 2.2.12 - debian potato 
mod_python 2.2 (2.4) - I try both - dynamicaly linked  
omniORB 3.0 - beta from CVS
apache 1.3.12


PS: I was using the PyApache and leave it because I thaught that the 
problem 
with omniORB is caused by  some problem in it - but now I dot know 
because both
mod_python and PyApache have the same problem.

Thank You in advance

Richard Bouska
Richard@Bouska.cz


From Howard.Williams at marchFIRST.com  Tue Jun 20 15:46:53 2000
From: Howard.Williams at marchFIRST.com (Howard Williams)
Date: Fri Jan  9 21:52:00 2004
Subject: [mod_python] (no subject)
Message-ID: <002701bfdb09$6e69cf80$1d0eaad1@edalearning.com>

Hi

I've just installed the mod_python using all the latest source code for
apache, python, and from the modpython.org site.

I can't seem to run the tester:

My directories are laid out as follows:

/usr/local/lib/python1.5/site-packages/mod_python/apache.py
/usr/local/lib/python1.5/site-packages/mod_python/
/usr/local/lib/python1.5/site-packages/mod_python/
/usr/local/lib/python1.5/site-packages/mod_python/
/usr/local/lib/python1.5/site-packages/mod_python/


ERROR mod_python: "PythonHandler test"

Traceback (innermost last):

  File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line
96, in Dispatch
    object = self.resolve_object(module, object_str)

  File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line
42, in resolve_object
    obj = getattr(obj, obj_str)

AttributeError: handler


HOWARD WILLIAMS
marchFIRST
23422 Mill Creek Drive., Suite 100
Laguna Hills, CA 92653
ph: (949) 461-5480
fax: (949) 461-5669
howard.williams@marchFIRST.com
www.marchFIRST.com


-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20000620/a50b964a/attachment-0001.htm
From Howard.Williams at marchFIRST.com  Tue Jun 20 16:00:26 2000
From: Howard.Williams at marchFIRST.com (Howard Williams)
Date: Fri Jan  9 21:52:00 2004
Subject: [mod_python] test doesn't work
Message-ID: <003d01bfdb0b$52f1e150$1d0eaad1@edalearning.com>

Hi

I've just installed the mod_python using all the latest source code for
apache, python, and from the modpython.org site.

I can't seem to run the tester:  So I've seen some postings from last month
about this with a similar "AttributeError: handler" title, but they didn't
seem to apply.

When I run "python test.py" (which I'm not convinced is supposed to be
possible) from a command line, I get the following output to stderr:
***********************************************************
Traceback (innermost last):
  File "test.py", line 1, in ?
    from mod_python import apache
  File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line
18, in ?
    import _apache
ImportError: No module named _apache

***********************************************************


My directories are laid out as follows:

/usr/local/lib/python1.5/site-packages/mod_python/apache.py
/usr/local/lib/python1.5/site-packages/mod_python/apache.pyc
/usr/local/lib/python1.5/site-packages/mod_python/cgihandler.py
/usr/local/lib/python1.5/site-packages/mod_python/cgihandler.pyc
/usr/local/lib/python1.5/site-packages/mod_python/httpdapi.py
/usr/local/lib/python1.5/site-packages/mod_python/httpdapi.pyc
/usr/local/lib/python1.5/site-packages/mod_python/zhandler.py
/usr/local/lib/python1.5/site-packages/mod_python/zhandler.pyc


I get this error:
*********************************
ERROR mod_python: "PythonHandler test"

Traceback (innermost last):

  File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line
96, in Dispatch
    object = self.resolve_object(module, object_str)

  File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line
42, in resolve_object
    obj = getattr(obj, obj_str)

AttributeError: handler
************************************************


Here's the apache error_log:
************************************************
[Tue Jun 20 15:47:37 2000] [notice] Apache/1.3.12 (Unix) configured --
resuming normal operations
[Tue Jun 20 15:47:46 2000] [error] PythonHandler test: Traceback (innermost
last):
[Tue Jun 20 15:47:46 2000] [error] PythonHandler test:   File
"/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 96, in
Dispatch
    object = self.resolve_object(module, object_str)
[Tue Jun 20 15:47:46 2000] [error] PythonHandler test:   File
"/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 42, in
resolve_object
    obj = getattr(obj, obj_str)
[Tue Jun 20 15:47:46 2000] [error] PythonHandler test: AttributeError:
handler
************************************************



 Thanks for any help you can provide !!!!   :)


HOWARD WILLIAMS
marchFIRST
23422 Mill Creek Drive., Suite 100
Laguna Hills, CA 92653
ph: (949) 461-5480
fax: (949) 461-5669
howard.williams@marchFIRST.com
www.marchFIRST.com

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20000620/0305da7e/attachment-0001.htm
From grisha at ispol.com  Tue Jun 20 21:41:20 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:52:00 2004
Subject: [mod_python] test doesn't work
In-Reply-To: <003d01bfdb0b$52f1e150$1d0eaad1@edalearning.com>
Message-ID: <Pine.LNX.4.21.0006202138080.28773-100000@saturn.ispol.com>

There is a module _apache which is only available from within
mod_python. However, if you comment out the 

from mod_python import apache

line, you should be able to import it from the command line.

I'm a little puzzled by this error, since everyone who has experienced it
never gave any logical reason as to what they did to fix this. It seems to
go away magically after they mes around for a while.

I am almost certain that this is caused by

1. a syntax error in test.py
2. a permissions problem

Grisha

On Tue, 20 Jun 2000, Howard Williams wrote:

> Hi
> 
> I've just installed the mod_python using all the latest source code for
> apache, python, and from the modpython.org site.
> 
> I can't seem to run the tester:  So I've seen some postings from last month
> about this with a similar "AttributeError: handler" title, but they didn't
> seem to apply.
> 
> When I run "python test.py" (which I'm not convinced is supposed to be
> possible) from a command line, I get the following output to stderr:
> ***********************************************************
> Traceback (innermost last):
>   File "test.py", line 1, in ?
>     from mod_python import apache
>   File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line
> 18, in ?
>     import _apache
> ImportError: No module named _apache
> 
> ***********************************************************
> 
> 
> My directories are laid out as follows:
> 
> /usr/local/lib/python1.5/site-packages/mod_python/apache.py
> /usr/local/lib/python1.5/site-packages/mod_python/apache.pyc
> /usr/local/lib/python1.5/site-packages/mod_python/cgihandler.py
> /usr/local/lib/python1.5/site-packages/mod_python/cgihandler.pyc
> /usr/local/lib/python1.5/site-packages/mod_python/httpdapi.py
> /usr/local/lib/python1.5/site-packages/mod_python/httpdapi.pyc
> /usr/local/lib/python1.5/site-packages/mod_python/zhandler.py
> /usr/local/lib/python1.5/site-packages/mod_python/zhandler.pyc
> 
> 
> I get this error:
> *********************************
> ERROR mod_python: "PythonHandler test"
> 
> Traceback (innermost last):
> 
>   File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line
> 96, in Dispatch
>     object = self.resolve_object(module, object_str)
> 
>   File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line
> 42, in resolve_object
>     obj = getattr(obj, obj_str)
> 
> AttributeError: handler
> ************************************************
> 
> 
> Here's the apache error_log:
> ************************************************
> [Tue Jun 20 15:47:37 2000] [notice] Apache/1.3.12 (Unix) configured --
> resuming normal operations
> [Tue Jun 20 15:47:46 2000] [error] PythonHandler test: Traceback (innermost
> last):
> [Tue Jun 20 15:47:46 2000] [error] PythonHandler test:   File
> "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 96, in
> Dispatch
>     object = self.resolve_object(module, object_str)
> [Tue Jun 20 15:47:46 2000] [error] PythonHandler test:   File
> "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 42, in
> resolve_object
>     obj = getattr(obj, obj_str)
> [Tue Jun 20 15:47:46 2000] [error] PythonHandler test: AttributeError:
> handler
> ************************************************
> 
> 
> 
>  Thanks for any help you can provide !!!!   :)
> 
> 
> HOWARD WILLIAMS
> marchFIRST
> 23422 Mill Creek Drive., Suite 100
> Laguna Hills, CA 92653
> ph: (949) 461-5480
> fax: (949) 461-5669
> howard.williams@marchFIRST.com
> www.marchFIRST.com
> 
> 


From grisha at ispol.com  Tue Jun 20 22:00:16 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:52:00 2004
Subject: [mod_python] test doesn't work
In-Reply-To: <Pine.LNX.4.21.0006202138080.28773-100000@saturn.ispol.com>
Message-ID: <Pine.LNX.4.21.0006202157290.28833-100000@saturn.ispol.com>

On Tue, 20 Jun 2000, Gregory Trubetskoy wrote:

> I am almost certain that this is caused by
> 
> 1. a syntax error in test.py
> 2. a permissions problem

OR

3. If the PythonHandler directive is in httpd.conf outside any <Directory>
tags, or if PythonHandler is inside a <Directory> different from that in
which test.py is, then /usr/local/lib/python1.5/test/ gets imported
instead, which, of course, doesn't have a function called "handler".

HTH

Grisha


From miguel at yorku.ca  Wed Jun 21 12:10:31 2000
From: miguel at yorku.ca (Miguel Marques)
Date: Fri Jan  9 21:52:00 2004
Subject: [mod_python] test doesn't work
In-Reply-To: <Pine.LNX.4.21.0006202157290.28833-100000@saturn.ispol.com>
References: <Pine.LNX.4.21.0006202138080.28773-100000@saturn.ispol.com>
	<Pine.LNX.4.21.0006202157290.28833-100000@saturn.ispol.com>
Message-ID: <20000621121031L.miguel@yorku.ca>

On Tue, 20 Jun 2000 22:00:16 -0400 (EDT), Gregory Trubetskoy <grisha@ispol.com> wrote:
> 
> On Tue, 20 Jun 2000, Gregory Trubetskoy wrote:
> 
> > I am almost certain that this is caused by
> > 
> > 1. a syntax error in test.py
> > 2. a permissions problem
> 
> OR
> 
> 3. If the PythonHandler directive is in httpd.conf outside any <Directory>
> tags, or if PythonHandler is inside a <Directory> different from that in
> which test.py is, then /usr/local/lib/python1.5/test/ gets imported
> instead, which, of course, doesn't have a function called "handler".
> 
> HTH
> 
> Grisha
> 
Well, I have the same problem.  I've tried everything I can think of.
This also happened with mod_python/2.2.
My setup is 
SunOS 5.7 Apache/1.3.12 (Unix) ApacheJServ/1.1 mod_perl/1.24 mod_python/2.4 Python/1.5.2

1. I can run test.py with python as apache (my server run under username apache)
2. I think 1. rules it out and I've checked the permissions of the all
   the python files.
3. my directive is 

<Directory "/usr/local/apache/htdocs/test">
    AddHandler python-program .py
    PythonHandler test
    PythonDebug on
</Directory>
and test.py is in /usr/local/apache/htdocs/test

I always get:

ERROR mod_python: "PythonHandler test"

Traceback (innermost last):

  File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 96, in Dispatch
    object = self.resolve_object(module, object_str)

  File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 42, in resolve_object
    obj = getattr(obj, obj_str)

AttributeError: handler

being somewhat new to python I'm unsure on how to proceed to figure
this out.
Any suggestions?
TIA...

							Miguel

C. Miguel Marques, York University, Computing & Communications Services
e-mail: miguel@yorku.ca, voice: (416)736-2100x22684, fax: (416)736-5830

From miguel at yorku.ca  Wed Jun 21 12:27:47 2000
From: miguel at yorku.ca (Miguel Marques)
Date: Fri Jan  9 21:52:00 2004
Subject: [mod_python] test doesn't work (solved?)
In-Reply-To: <20000621121031L.miguel@yorku.ca>
References: <Pine.LNX.4.21.0006202138080.28773-100000@saturn.ispol.com>
	<Pine.LNX.4.21.0006202157290.28833-100000@saturn.ispol.com>
	<20000621121031L.miguel@yorku.ca>
Message-ID: <20000621122747A.miguel@yorku.ca>

On Wed, 21 Jun 2000 12:10:31 -0400, Miguel Marques <miguel@yorku.ca> wrote:
> On Tue, 20 Jun 2000 22:00:16 -0400 (EDT), Gregory Trubetskoy <grisha@ispol.com> wrote:
> > 
> > On Tue, 20 Jun 2000, Gregory Trubetskoy wrote:
> > 
> > > I am almost certain that this is caused by
> > > 
> > > 1. a syntax error in test.py
> > > 2. a permissions problem
> > 
> > OR
> > 
> > 3. If the PythonHandler directive is in httpd.conf outside any <Directory>
> > tags, or if PythonHandler is inside a <Directory> different from that in
> > which test.py is, then /usr/local/lib/python1.5/test/ gets imported
> > instead, which, of course, doesn't have a function called "handler".
> > 
> > HTH
> > 
> > Grisha
> > 
> Well, I have the same problem.  I've tried everything I can think of.
> This also happened with mod_python/2.2.
> My setup is 
> SunOS 5.7 Apache/1.3.12 (Unix) ApacheJServ/1.1 mod_perl/1.24 mod_python/2.4 Python/1.5.2
> 
> 1. I can run test.py with python as apache (my server run under username apache)
> 2. I think 1. rules it out and I've checked the permissions of the all
>    the python files.
> 3. my directive is 
> 
> <Directory "/usr/local/apache/htdocs/test">
>     AddHandler python-program .py
>     PythonHandler test
>     PythonDebug on
> </Directory>

If I add a slash to the end of the directory in the Directory directive it works.
<Directory "/usr/local/apache/htdocs/test/">
    AddHandler python-program .py
    PythonHandler test
    PythonDebug on
</Directory>

I couldn't get a Location directive to work either way, though.
Is there a reason for this which I don't understand?
Thanks.

						  Miguel

C. Miguel Marques, York University, Computing & Communications Services
e-mail: miguel@yorku.ca, voice: (416)736-2100x22684, fax: (416)736-5830





From Howard.Williams at marchFIRST.com  Wed Jun 21 12:24:20 2000
From: Howard.Williams at marchFIRST.com (Howard Williams)
Date: Fri Jan  9 21:52:01 2004
Subject: [mod_python] test doesn't work (solved?)
In-Reply-To: <20000621122747A.miguel@yorku.ca>
Message-ID: <000001bfdbb6$4d3764f0$1d0eaad1@edalearning.com>

Yup !!!!  Adding the / at the end of the <Directory ...> statement did the
trick in httpd.conf

Thanks a bunch

HOWARD WILLIAMS
marchFIRST
23422 Mill Creek Drive., Suite 100
Laguna Hills, CA 92653
ph: (949) 461-5480
fax: (949) 461-5669
howard.williams@marchFIRST.com <mailto:howard.williams@marchFIRST.com>
www.marchFIRST.com



-----Original Message-----
From: Miguel Marques [mailto:miguel@yorku.ca]
Sent: Wednesday, June 21, 2000 9:28 AM
To: mod_python@modpython.org
Subject: Re: [mod_python] test doesn't work (solved?)


On Wed, 21 Jun 2000 12:10:31 -0400, Miguel Marques <miguel@yorku.ca> wrote:
> On Tue, 20 Jun 2000 22:00:16 -0400 (EDT), Gregory Trubetskoy
<grisha@ispol.com> wrote:
> >
> > On Tue, 20 Jun 2000, Gregory Trubetskoy wrote:
> >
> > > I am almost certain that this is caused by
> > >
> > > 1. a syntax error in test.py
> > > 2. a permissions problem
> >
> > OR
> >
> > 3. If the PythonHandler directive is in httpd.conf outside any
<Directory>
> > tags, or if PythonHandler is inside a <Directory> different from that in
> > which test.py is, then /usr/local/lib/python1.5/test/ gets imported
> > instead, which, of course, doesn't have a function called "handler".
> >
> > HTH
> >
> > Grisha
> >
> Well, I have the same problem.  I've tried everything I can think of.
> This also happened with mod_python/2.2.
> My setup is
> SunOS 5.7 Apache/1.3.12 (Unix) ApacheJServ/1.1 mod_perl/1.24
mod_python/2.4 Python/1.5.2
>
> 1. I can run test.py with python as apache (my server run under username
apache)
> 2. I think 1. rules it out and I've checked the permissions of the all
>    the python files.
> 3. my directive is
>
> <Directory "/usr/local/apache/htdocs/test">
>     AddHandler python-program .py
>     PythonHandler test
>     PythonDebug on
> </Directory>

If I add a slash to the end of the directory in the Directory directive it
works.
<Directory "/usr/local/apache/htdocs/test/">
    AddHandler python-program .py
    PythonHandler test
    PythonDebug on
</Directory>

I couldn't get a Location directive to work either way, though.
Is there a reason for this which I don't understand?
Thanks.

						  Miguel

C. Miguel Marques, York University, Computing & Communications Services
e-mail: miguel@yorku.ca, voice: (416)736-2100x22684, fax: (416)736-5830




_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python


From grisha at ispol.com  Wed Jun 21 18:00:25 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:52:01 2004
Subject: [mod_python] test doesn't work
In-Reply-To: <20000621121031L.miguel@yorku.ca>
Message-ID: <Pine.LNX.4.21.0006211759290.32339-100000@saturn.ispol.com>

How about when you rename test.py to mptest.py and change the
PythonHandler directive accordingly?

Grisha

On Wed, 21 Jun 2000, Miguel Marques wrote:

> On Tue, 20 Jun 2000 22:00:16 -0400 (EDT), Gregory Trubetskoy <grisha@ispol.com> wrote:
> > 
> > On Tue, 20 Jun 2000, Gregory Trubetskoy wrote:
> > 
> > > I am almost certain that this is caused by
> > > 
> > > 1. a syntax error in test.py
> > > 2. a permissions problem
> > 
> > OR
> > 
> > 3. If the PythonHandler directive is in httpd.conf outside any <Directory>
> > tags, or if PythonHandler is inside a <Directory> different from that in
> > which test.py is, then /usr/local/lib/python1.5/test/ gets imported
> > instead, which, of course, doesn't have a function called "handler".
> > 
> > HTH
> > 
> > Grisha
> > 
> Well, I have the same problem.  I've tried everything I can think of.
> This also happened with mod_python/2.2.
> My setup is 
> SunOS 5.7 Apache/1.3.12 (Unix) ApacheJServ/1.1 mod_perl/1.24 mod_python/2.4 Python/1.5.2
> 
> 1. I can run test.py with python as apache (my server run under username apache)
> 2. I think 1. rules it out and I've checked the permissions of the all
>    the python files.
> 3. my directive is 
> 
> <Directory "/usr/local/apache/htdocs/test">
>     AddHandler python-program .py
>     PythonHandler test
>     PythonDebug on
> </Directory>
> and test.py is in /usr/local/apache/htdocs/test
> 
> I always get:
> 
> ERROR mod_python: "PythonHandler test"
> 
> Traceback (innermost last):
> 
>   File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 96, in Dispatch
>     object = self.resolve_object(module, object_str)
> 
>   File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 42, in resolve_object
>     obj = getattr(obj, obj_str)
> 
> AttributeError: handler
> 
> being somewhat new to python I'm unsure on how to proceed to figure
> this out.
> Any suggestions?
> TIA...
> 
> 							Miguel
> 
> C. Miguel Marques, York University, Computing & Communications Services
> e-mail: miguel@yorku.ca, voice: (416)736-2100x22684, fax: (416)736-5830
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From grisha at ispol.com  Wed Jun 21 18:03:00 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:52:01 2004
Subject: [mod_python] test doesn't work (solved?)
In-Reply-To: <000001bfdbb6$4d3764f0$1d0eaad1@edalearning.com>
Message-ID: <Pine.LNX.4.21.0006211802230.32339-100000@saturn.ispol.com>

This may actually be a bug after all....

Grisha

On Wed, 21 Jun 2000, Howard Williams wrote:

> Yup !!!!  Adding the / at the end of the <Directory ...> statement did the
> trick in httpd.conf
> 
> Thanks a bunch
> 
> HOWARD WILLIAMS
> marchFIRST
> 23422 Mill Creek Drive., Suite 100
> Laguna Hills, CA 92653
> ph: (949) 461-5480
> fax: (949) 461-5669
> howard.williams@marchFIRST.com <mailto:howard.williams@marchFIRST.com>
> www.marchFIRST.com
> 
> 
> 
> -----Original Message-----
> From: Miguel Marques [mailto:miguel@yorku.ca]
> Sent: Wednesday, June 21, 2000 9:28 AM
> To: mod_python@modpython.org
> Subject: Re: [mod_python] test doesn't work (solved?)
> 
> 
> On Wed, 21 Jun 2000 12:10:31 -0400, Miguel Marques <miguel@yorku.ca> wrote:
> > On Tue, 20 Jun 2000 22:00:16 -0400 (EDT), Gregory Trubetskoy
> <grisha@ispol.com> wrote:
> > >
> > > On Tue, 20 Jun 2000, Gregory Trubetskoy wrote:
> > >
> > > > I am almost certain that this is caused by
> > > >
> > > > 1. a syntax error in test.py
> > > > 2. a permissions problem
> > >
> > > OR
> > >
> > > 3. If the PythonHandler directive is in httpd.conf outside any
> <Directory>
> > > tags, or if PythonHandler is inside a <Directory> different from that in
> > > which test.py is, then /usr/local/lib/python1.5/test/ gets imported
> > > instead, which, of course, doesn't have a function called "handler".
> > >
> > > HTH
> > >
> > > Grisha
> > >
> > Well, I have the same problem.  I've tried everything I can think of.
> > This also happened with mod_python/2.2.
> > My setup is
> > SunOS 5.7 Apache/1.3.12 (Unix) ApacheJServ/1.1 mod_perl/1.24
> mod_python/2.4 Python/1.5.2
> >
> > 1. I can run test.py with python as apache (my server run under username
> apache)
> > 2. I think 1. rules it out and I've checked the permissions of the all
> >    the python files.
> > 3. my directive is
> >
> > <Directory "/usr/local/apache/htdocs/test">
> >     AddHandler python-program .py
> >     PythonHandler test
> >     PythonDebug on
> > </Directory>
> 
> If I add a slash to the end of the directory in the Directory directive it
> works.
> <Directory "/usr/local/apache/htdocs/test/">
>     AddHandler python-program .py
>     PythonHandler test
>     PythonDebug on
> </Directory>
> 
> I couldn't get a Location directive to work either way, though.
> Is there a reason for this which I don't understand?
> Thanks.
> 
> 						  Miguel
> 
> C. Miguel Marques, York University, Computing & Communications Services
> e-mail: miguel@yorku.ca, voice: (416)736-2100x22684, fax: (416)736-5830
> 
> 
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From Howard.Williams at marchFIRST.com  Wed Jun 21 15:23:23 2000
From: Howard.Williams at marchFIRST.com (Howard Williams)
Date: Fri Jan  9 21:52:01 2004
Subject: [mod_python] test doesn't work
In-Reply-To: <Pine.LNX.4.21.0006211759290.32339-100000@saturn.ispol.com>
Message-ID: <001001bfdbcf$507b6300$1d0eaad1@edalearning.com>

no problem there

HOWARD WILLIAMS
marchFIRST
23422 Mill Creek Drive., Suite 100
Laguna Hills, CA 92653
ph: (949) 461-5480
fax: (949) 461-5669
howard.williams@marchFIRST.com <mailto:howard.williams@marchFIRST.com>
www.marchFIRST.com



-----Original Message-----
From: Gregory Trubetskoy [mailto:grisha@ispol.com]
Sent: Wednesday, June 21, 2000 3:00 PM
To: Miguel Marques
Cc: mod_python@modpython.org
Subject: Re: [mod_python] test doesn't work



How about when you rename test.py to mptest.py and change the
PythonHandler directive accordingly?

Grisha

On Wed, 21 Jun 2000, Miguel Marques wrote:

> On Tue, 20 Jun 2000 22:00:16 -0400 (EDT), Gregory Trubetskoy
<grisha@ispol.com> wrote:
> >
> > On Tue, 20 Jun 2000, Gregory Trubetskoy wrote:
> >
> > > I am almost certain that this is caused by
> > >
> > > 1. a syntax error in test.py
> > > 2. a permissions problem
> >
> > OR
> >
> > 3. If the PythonHandler directive is in httpd.conf outside any
<Directory>
> > tags, or if PythonHandler is inside a <Directory> different from that in
> > which test.py is, then /usr/local/lib/python1.5/test/ gets imported
> > instead, which, of course, doesn't have a function called "handler".
> >
> > HTH
> >
> > Grisha
> >
> Well, I have the same problem.  I've tried everything I can think of.
> This also happened with mod_python/2.2.
> My setup is
> SunOS 5.7 Apache/1.3.12 (Unix) ApacheJServ/1.1 mod_perl/1.24
mod_python/2.4 Python/1.5.2
>
> 1. I can run test.py with python as apache (my server run under username
apache)
> 2. I think 1. rules it out and I've checked the permissions of the all
>    the python files.
> 3. my directive is
>
> <Directory "/usr/local/apache/htdocs/test">
>     AddHandler python-program .py
>     PythonHandler test
>     PythonDebug on
> </Directory>
> and test.py is in /usr/local/apache/htdocs/test
>
> I always get:
>
> ERROR mod_python: "PythonHandler test"
>
> Traceback (innermost last):
>
>   File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line
96, in Dispatch
>     object = self.resolve_object(module, object_str)
>
>   File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line
42, in resolve_object
>     obj = getattr(obj, obj_str)
>
> AttributeError: handler
>
> being somewhat new to python I'm unsure on how to proceed to figure
> this out.
> Any suggestions?
> TIA...
>
> 							Miguel
>
> C. Miguel Marques, York University, Computing & Communications Services
> e-mail: miguel@yorku.ca, voice: (416)736-2100x22684, fax: (416)736-5830
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python


From grisha at ispol.com  Wed Jun 21 21:33:41 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:52:01 2004
Subject: [mod_python] test doesn't work (solved?)
In-Reply-To: <20000621122747A.miguel@yorku.ca>
Message-ID: <Pine.LNX.4.21.0006212131300.498-100000@saturn.ispol.com>

On Wed, 21 Jun 2000, Miguel Marques wrote:

> If I add a slash to the end of the directory in the Directory directive it works.
> <Directory "/usr/local/apache/htdocs/test/">

OK, it is actually a bug.

line 108 of mod_python.c, which reads

#define SLASH_S "\\"

should read

#define SLASH_S "/"

If you edit this and recompile, the problem will go away.

Grisha


From miguel at yorku.ca  Thu Jun 22 11:23:01 2000
From: miguel at yorku.ca (Miguel Marques)
Date: Fri Jan  9 21:52:01 2004
Subject: [mod_python] test doesn't work (solved?)
In-Reply-To: <Pine.LNX.4.21.0006212131300.498-100000@saturn.ispol.com>
References: <20000621122747A.miguel@yorku.ca>
	<Pine.LNX.4.21.0006212131300.498-100000@saturn.ispol.com>
Message-ID: <20000622112301P.miguel@yorku.ca>

On Wed, 21 Jun 2000 21:33:41 -0400 (EDT), Gregory Trubetskoy <grisha@ispol.com> wrote:
> 
> On Wed, 21 Jun 2000, Miguel Marques wrote:
> 
> > If I add a slash to the end of the directory in the Directory directive it works.
> > <Directory "/usr/local/apache/htdocs/test/">
> 
> OK, it is actually a bug.
> 
> line 108 of mod_python.c, which reads
> 
> #define SLASH_S "\\"
> 
> should read
> 
> #define SLASH_S "/"
> 
> If you edit this and recompile, the problem will go away.
> 
It does indeed go away. 
Thanks!!!
But note that when using a Location directive it still does not work.
e.g.
<Location "/test">
    AddHandler python-program .py
    PythonHandler test
    PythonDebug on
</Location>

Is this intentional?

							Miguel

C. Miguel Marques, York University, Computing & Communications Services
e-mail: miguel@yorku.ca, voice: (416)736-2100x22684, fax: (416)736-5830

From daniel at copyleft.no  Thu Jun 22 17:36:34 2000
From: daniel at copyleft.no (Hr. Daniel Mikkelsen)
Date: Fri Jan  9 21:52:01 2004
Subject: [mod_python] req.connection.user
Message-ID: <Pine.LNX.4.10.10006221730110.15525-100000@unity.copyleft.no>

Hi.

I'm trying to set up authentication based on the example given in the
tutorial. Everything seems to work, except that i get Null instead of
the username for req.connection.user.

So that if I just test for password with req.get_basic_auth_pw() and not
for user, I get "through" the basic authentication.

The source I'm using is taken straight from the tutorial. 

Any ideas? I'm using the preinstalled apache 1.3.9 on OpenBSD 2.6, with
mod_python as a DSO. I've tried both versions 2.2 and 2.4. 

-- Daniel Mikkelsen, Copyleft Software


From grisha at ispol.com  Fri Jun 23 18:31:54 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:52:01 2004
Subject: [mod_python] test doesn't work (solved?)
In-Reply-To: <20000622112301P.miguel@yorku.ca>
Message-ID: <Pine.LNX.4.21.0006231821170.7430-100000@saturn.ispol.com>

On Thu, 22 Jun 2000, Miguel Marques wrote:

> But note that when using a Location directive it still does not work.
> e.g.
> <Location "/test">
>     AddHandler python-program .py
>     PythonHandler test
>     PythonDebug on
> </Location>
> 
> Is this intentional?

I don't know if "intentional" is the right word, but it _is_ expected
behaviour.

mod_python prepends the directory to pythonpath, as outlined here:
http://www.modpython.org/live/mod_python-2.4/doc/pythonapi.html#handler

The <Location> directive puts whatever is specified as the argument to it
as the "directory", and mod_python ends up prependind it. But since
"/test" is not a real directory, it doesn't do you any good. I don't think
there is a simple way to find out what the real directory is from
<Location>. If you read the Apache documentation for it, it puts the
emphasis on the fact that <Location> is not in any way linked to the
filesystem.

Grisha


From hunter at userfriendly.net  Fri Jun 23 22:40:41 2000
From: hunter at userfriendly.net (hUnTeR)
Date: Fri Jan  9 21:52:01 2004
Subject: [mod_python] DSO compile
Message-ID: <39541FA9.D23BAB1A@userfriendly.net>

Dear list readers - 

I am currently trying to build the mod_python as a DSO for
apache-1.3.12. I have already compiled as DSO mod_perl, mod_ssl, etc but
i desparately need this module. I would even settle for a static compile
to get this to work (trying to replace our company's current method of
Netscape Enterprise Server with python). I get the following error when
trying to make:

===> src/modules/extra
gcc -c -I/usr/include/python1.5 -I../../os/unix -I../../include  
-DLINUX=2 -DUo
In file included from mod_python.c:89:
/usr/include/python1.5/Python.h:39: config.h: No such file or directory
In file included from /usr/include/python1.5/modsupport.h:52,
                 from /usr/include/python1.5/Python.h:101,
                 from mod_python.c:89:
/usr/lib/gcc-lib/i386-redhat-linux/egcs-2.91.66/include/varargs.h:106:
warning:d
/usr/lib/gcc-lib/i386-redhat-linux/egcs-2.91.66/include/stdarg.h:90:
warning: tn
make[4]: *** [mod_python.so] Error 1
make[3]: *** [all] Error 1
make[2]: *** [subdirs] Error 1
make[2]: Leaving directory `/root/temp/apache_1.3.12/src'
make[1]: *** [build-std] Error 2
make[1]: Leaving directory `/root/temp/apache_1.3.12'
make: *** [build] Error 2

Any ideas? I have even recently rebuilt python to include the ctsybase
and thread modules, but this one is giving me a headache.

Any help would be appreciated.

Regards
-- 
Michael B. Weiner
Systems Administrator/Partner
The UserFriendly Network (UFN)
--

             / /  (_)__  __ ____  __
            / /__/ / _ \/ // /\ \/ /  
           /____/_/_//_/\_,_/ /_/\_\ 

     * * * CHOICE OF A GNU GENERATION * * *

From grisha at ispol.com  Sat Jun 24 10:00:09 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:52:01 2004
Subject: [mod_python] DSO compile
In-Reply-To: <39541FA9.D23BAB1A@userfriendly.net>
Message-ID: <Pine.LNX.4.21.0006240958150.10701-100000@saturn.ispol.com>

it's saying it's missing config.h.

did you run "make install" after compiling Python?

Grisha

On Fri, 23 Jun 2000, hUnTeR wrote:

> Dear list readers - 
> 
> I am currently trying to build the mod_python as a DSO for
> apache-1.3.12. I have already compiled as DSO mod_perl, mod_ssl, etc but
> i desparately need this module. I would even settle for a static compile
> to get this to work (trying to replace our company's current method of
> Netscape Enterprise Server with python). I get the following error when
> trying to make:
> 
> ===> src/modules/extra
> gcc -c -I/usr/include/python1.5 -I../../os/unix -I../../include  
> -DLINUX=2 -DUo
> In file included from mod_python.c:89:
> /usr/include/python1.5/Python.h:39: config.h: No such file or directory
> In file included from /usr/include/python1.5/modsupport.h:52,
>                  from /usr/include/python1.5/Python.h:101,
>                  from mod_python.c:89:
> /usr/lib/gcc-lib/i386-redhat-linux/egcs-2.91.66/include/varargs.h:106:
> warning:d
> /usr/lib/gcc-lib/i386-redhat-linux/egcs-2.91.66/include/stdarg.h:90:
> warning: tn
> make[4]: *** [mod_python.so] Error 1
> make[3]: *** [all] Error 1
> make[2]: *** [subdirs] Error 1
> make[2]: Leaving directory `/root/temp/apache_1.3.12/src'
> make[1]: *** [build-std] Error 2
> make[1]: Leaving directory `/root/temp/apache_1.3.12'
> make: *** [build] Error 2
> 
> Any ideas? I have even recently rebuilt python to include the ctsybase
> and thread modules, but this one is giving me a headache.
> 
> Any help would be appreciated.
> 
> Regards
> -- 
> Michael B. Weiner
> Systems Administrator/Partner
> The UserFriendly Network (UFN)
> --
> 
>              / /  (_)__  __ ____  __
>             / /__/ / _ \/ // /\ \/ /  
>            /____/_/_//_/\_,_/ /_/\_\ 
> 
>      * * * CHOICE OF A GNU GENERATION * * *
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From hunter at userfriendly.net  Sat Jun 24 11:32:47 2000
From: hunter at userfriendly.net (hUnTeR)
Date: Fri Jan  9 21:52:01 2004
Subject: [mod_python] DSO compile
Message-ID: <3954D49F.199ECBCC@userfriendly.net>

Dear list readers - 

OK, i got around the previously emailed problem and was able to
successfully build a DSO mod_python module. However, when i go to
restart apache, i now receive the following error:

Starting httpd: Syntax error on line 250 of /etc/httpd/conf/httpd.conf:
Cannot load /etc/httpd/modules/mod_python.so into server:
/etc/httpd/modules/mod_python.so: undefined symbol: ct_con_props


Any ideas? Any help would be appreciated.

Regards
-- 
Michael B. Weiner
Systems Administrator/Partner
The UserFriendly Network (UFN)
--

             / /  (_)__  __ ____  __
            / /__/ / _ \/ // /\ \/ /  
           /____/_/_//_/\_,_/ /_/\_\ 

     * * * CHOICE OF A GNU GENERATION * * *
_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python

From hunter at userfriendly.net  Sat Jun 24 12:22:18 2000
From: hunter at userfriendly.net (hUnTeR)
Date: Fri Jan  9 21:52:01 2004
Subject: [mod_python] DSO compile
Message-ID: <3954E03A.E2987217@userfriendly.net>

Dear list readers - 

OK, i got around the previously emailed problem - the ctsybase module
was giving me the errors on start up. So i had to rebuild python from
scratch again without the ctsybase module support. However now when i
rebuild mod_python and go to restart apache it doesnt startup and gives
me "httpd dead but subsys locked"


Any ideas? Any help would be appreciated.

Regards
-- 
Michael B. Weiner
Systems Administrator/Partner
The UserFriendly Network (UFN)
--

             / /  (_)__  __ ____  __
            / /__/ / _ \/ // /\ \/ /  
           /____/_/_//_/\_,_/ /_/\_\ 

     * * * CHOICE OF A GNU GENERATION * * *
_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python
_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python

From jam at quark.emich.edu  Sat Jun 24 13:01:18 2000
From: jam at quark.emich.edu (Jeff)
Date: Fri Jan  9 21:52:01 2004
Subject: [mod_python] DSO compile
In-Reply-To: <3954E03A.E2987217@userfriendly.net>; from hunter@userfriendly.net on Sat, Jun 24, 2000 at 12:22:18PM -0400
References: <3954E03A.E2987217@userfriendly.net>
Message-ID: <20000624130118.E30377@quark.emich.edu>

On Sat, Jun 24, 2000 at 12:22:18PM -0400, hUnTeR wrote:
> Dear list readers - 
> 
> OK, i got around the previously emailed problem - the ctsybase module
> was giving me the errors on start up. So i had to rebuild python from
> scratch again without the ctsybase module support. However now when i
> rebuild mod_python and go to restart apache it doesnt startup and gives
> me "httpd dead but subsys locked"
> 
> 
> Any ideas? Any help would be appreciated.

apache is core dumping. 

I had this problem with an older version of mod_python, and solved it by
putting the "AddModule" and "LoadModule" directives in specific locations in
the httpd.conf file.

I noticed, though, that the 2.4 version *does not* work with this solution.

as a start to the troubleshooting, could you post the specific parameters to
apxs that you used? it would also be useful to know the exact apache
configuration you have for comparison.

regards,
J
-- 
|| visit gfd <http://quark.emich.edu/>
|| psa member -- <http://www.python.org/psa/> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 232 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20000624/d5940662/attachment-0001.bin
From richard at whitequeen.com  Fri Jun 23 19:11:10 2000
From: richard at whitequeen.com (richard offer)
Date: Fri Jan  9 21:52:01 2004
Subject: [mod_python] RFE: expose File descriptor in API
Message-ID: <200006240211.e5O2BAm23684@erij.whitequeen.com>

Hi,

Is is possible to expose the FD that req.write() is using to the API
? Is this worth it ?

I'm in the process of switching from HTMLgen to HyperText as my text
generator and that has a writeto() method that takes a FD as an argument.

Wont this allow for progressive loading ?

Just a thought.

richard.

-- 
richard offer @ home 
          84 FE 48 E4 74 D0 26 D4  31 8E B6 86 98 74 E2 7C  8A FB BF A3
___________________________________http://216.185.15.144/users/richard/

From grisha at ispol.com  Sat Jun 24 14:43:03 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:52:01 2004
Subject: [mod_python] RFE: expose File descriptor in API
In-Reply-To: <200006240211.e5O2BAm23684@erij.whitequeen.com>
Message-ID: <Pine.LNX.4.21.0006241438330.11343-100000@saturn.ispol.com>


On Fri, 23 Jun 2000, richard offer wrote:

> I'm in the process of switching from HTMLgen to HyperText as my text
> generator and that has a writeto() method that takes a FD as an argument.

I don't think there is such a thing as a file descriptor that one can
write to within apache. Also, writeto() would need to know how to handle
HTTP errors.

> Wont this allow for progressive loading ?

What's "progressive loading"?

Grisha


From dwallace at delanet.com  Sun Jun 25 08:41:23 2000
From: dwallace at delanet.com (Dave)
Date: Fri Jan  9 21:52:01 2004
Subject: [mod_python] test doesn't work (solved?)
Message-ID: <3955FDF3.DC59F96B@delanet.com>

I've been using the Location directive for a bit now, here is how it
looks for me:

<Location /wpy >
  SetHandler python-program
  PythonDebug On
  PythonPath "sys.path+['/devel/WEB/Webware/WebKit']"
  PythonHandler webkit_handler
</Location>

The key here is the undocumented feature of PythonPath that it
apparently evals its argument. I've been meaning to ask about this since
at some point this could get broken in development and I'd be up a
creek. This is certainly handy but what isn't nice is that I suppose
/something/wpy is also being appended to the PYTHONPATH wether I want or
not.  Maybe a directive to append paths to the default PYTHONPATH would
be in order?

BTW, the nice thing about using Location is the fact that for the
particular application I'm using there is only a single handler and all
content is delivered through that handler by the application. Having to
specify a Directory just doesn't seem quite right.

Dave.

On Fri, 23 Jun 2000, Gregory Trubetskoy wrote:

>On Thu, 22 Jun 2000, Miguel Marques wrote:

>> But note that when using a Location directive it still does not work.

>> e.g.
>> <Location "/test">
>>     AddHandler python-program .py
>>     PythonHandler test
>>     PythonDebug on
>> </Location>
>>
>> Is this intentional?

>I don't know if "intentional" is the right word, but it _is_ expected
>behaviour.

>mod_python prepends the directory to pythonpath, as outlined here:
>http://www.modpython.org/live/mod_python-2.4/doc/pythonapi.html#handler

>The <Location> directive puts whatever is specified as the argument to
it
>as the "directory", and mod_python ends up prependind it. But since
>"/test" is not a real directory, it doesn't do you any good. I don't
think
>there is a simple way to find out what the real directory is from
><Location>. If you read the Apache documentation for it, it puts the
>emphasis on the fact that <Location> is not in any way linked to the
>filesystem.



From grisha at ispol.com  Sun Jun 25 15:55:04 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:52:01 2004
Subject: [mod_python] test doesn't work (solved?)
In-Reply-To: <3955FDF3.DC59F96B@delanet.com>
Message-ID: <Pine.LNX.4.21.0006251540480.24945-100000@saturn.ispol.com>

On Sun, 25 Jun 2000, Dave wrote:

> I've been using the Location directive for a bit now, here is how it
> looks for me:
> 
> <Location /wpy >
>   SetHandler python-program
>   PythonDebug On
>   PythonPath "sys.path+['/devel/WEB/Webware/WebKit']"
>   PythonHandler webkit_handler
> </Location>
> 
> The key here is the undocumented feature of PythonPath that it
> apparently evals its argument. I've been meaning to ask about this since
> at some point this could get broken in development and I'd be up a
> creek. 

I don't think this is going away - there is no simpler way to specify the
pythonpath than in python syntax which implies evaling.

> This is certainly handy but what isn't nice is that I suppose
> /something/wpy is also being appended to the PYTHONPATH wether I want or
> not.  

Yes, it's "/wpy", actually. Unfortunately, there is no way to tell at the
time the directives are being processed whether it's <Location> or
<Directive>. One option may be not to intriduce another directive,
something like PythonDoNotModifyPath or something. 

> Maybe a directive to append paths to the default PYTHONPATH would
> be in order?

Originally, I considered something like using "+['/some/path']" to mean
append or "['/some/path']+" to prepend. There turned out to be some not so
obvious issues, such as the fact that with .htaccess, the directive gets
processed with every hit, so you would have to make sure to act on it only
once, the first time.

It _could_ be done, but it went against my principle to keep it simple, so
I decided to save for it later since I had more important features to
roll out.

> BTW, the nice thing about using Location is the fact that for the
> particular application I'm using there is only a single handler and all
> content is delivered through that handler by the application. Having to
> specify a Directory just doesn't seem quite right.

Not sure I understand this completely - could you elaborate a bit?

Grisha


From grisha at ispol.com  Sun Jun 25 16:51:58 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:52:01 2004
Subject: [mod_python] CVS
Message-ID: <Pine.LNX.4.21.0006251650370.25128-100000@saturn.ispol.com>

Someone was asking about CVS - 

You should be able to get CVS access from sourceforge. Go to 
http://sourceforge.net/projects/modpython for details.

Grisha



From gstein at lyra.org  Sun Jun 25 13:56:31 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:52:01 2004
Subject: [mod_python] test doesn't work (solved?)
In-Reply-To: <Pine.LNX.4.21.0006251540480.24945-100000@saturn.ispol.com>; from grisha@ispol.com on Sun, Jun 25, 2000 at 03:55:04PM -0400
References: <3955FDF3.DC59F96B@delanet.com> <Pine.LNX.4.21.0006251540480.24945-100000@saturn.ispol.com>
Message-ID: <20000625135631.F29590@lyra.org>

On Sun, Jun 25, 2000 at 03:55:04PM -0400, Gregory Trubetskoy wrote:
> On Sun, 25 Jun 2000, Dave wrote:
> > I've been using the Location directive for a bit now, here is how it
> > looks for me:
> > 
> > <Location /wpy >
> >   SetHandler python-program
> >   PythonDebug On
> >   PythonPath "sys.path+['/devel/WEB/Webware/WebKit']"
> >   PythonHandler webkit_handler
> > </Location>
> > 
> > The key here is the undocumented feature of PythonPath that it
> > apparently evals its argument. I've been meaning to ask about this since
> > at some point this could get broken in development and I'd be up a
> > creek. 
> 
> I don't think this is going away - there is no simpler way to specify the
> pythonpath than in python syntax which implies evaling.

Huh? How about specifying the path in standard DIR:DIR:DIR notation, and
using:

    sys.path = sys.path + string.split(directive_arg, ':')

No need to eval at all.

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/

From gstein at lyra.org  Sun Jun 25 15:57:55 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:52:01 2004
Subject: [mod_python] test doesn't work (solved?)
In-Reply-To: <4.3.2.7.2.20000625174031.00bd3540@pop.ne.mediaone.net>; from seant@alum.mit.edu on Sun, Jun 25, 2000 at 05:41:24PM -0400
References: <Pine.LNX.4.21.0006251540480.24945-100000@saturn.ispol.com> <3955FDF3.DC59F96B@delanet.com> <Pine.LNX.4.21.0006251540480.24945-100000@saturn.ispol.com> <20000625135631.F29590@lyra.org> <4.3.2.7.2.20000625174031.00bd3540@pop.ne.mediaone.net>
Message-ID: <20000625155755.H29590@lyra.org>

On Sun, Jun 25, 2000 at 05:41:24PM -0400, Sean True wrote:
> At 01:56 PM 6/25/00 -0700, you wrote:
> >Huh? How about specifying the path in standard DIR:DIR:DIR notation, and
> >using:
> >
> >     sys.path = sys.path + string.split(directive_arg, ':')
> >
> >No need to eval at all.
> Not as tasteful on Wintel platforms, though.

Fine. Then use os.pathsep rather than ':'

The *point* is valid -- there is no need for an eval in there, no need for a
Python expression, and every possibility of using "standard" path notations.

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/

From dwallace at delanet.com  Sun Jun 25 19:34:45 2000
From: dwallace at delanet.com (Dave)
Date: Fri Jan  9 21:52:01 2004
Subject: [mod_python] test doesn't work (solved?)
References: <Pine.LNX.4.21.0006251540480.24945-100000@saturn.ispol.com>
Message-ID: <39569715.BA322B4C@delanet.com>

Gregory Trubetskoy wrote:

> > Maybe a directive to append paths to the default PYTHONPATH would
> > be in order?
> It _could_ be done, but it went against my principle to keep it simple, so
> I decided to save for it later since I had more important features to
> roll out.

Right-on, works for me!

> > BTW, the nice thing about using Location is the fact that for the
> > particular application I'm using there is only a single handler and all
> > content is delivered through that handler by the application. Having to
> > specify a Directory just doesn't seem quite right.
>
> Not sure I understand this completely - could you elaborate a bit?

Webware is a application server (in development) that does Servlets and
Server Pages in Python so what it really wants is a path into its servlet
directory so it can find the source, generate the content and send it back
through the handler. For now the mod_python handler is just a proxy that
marshals some data from the request,sends it to the application server via a
socket, and relays the response back to Apache. If I were using Directory I'd
have to make a physical directory somwhere just to contain the handler and
nothing else or I suppose I could put the handler in my servlet directory but
it just doesn''t seem to belong there. Using Location I can place the handler
with the other application server source files. That just seems cleaner for
now.
Of course, this is all making me think of what will happen when I want to put
server pages alongside static html and have the right thing happen when .html
or .psp (server pages) are called for, but I suppose there is some way to
coerce Apache into doing that.

Dave.




From rsalz at caveosystems.com  Sun Jun 25 21:54:40 2000
From: rsalz at caveosystems.com (Rich Salz)
Date: Fri Jan  9 21:52:01 2004
Subject: [mod_python] test doesn't work (solved?)
References: <Pine.LNX.4.21.0006251540480.24945-100000@saturn.ispol.com> <3955FDF3.DC59F96B@delanet.com> <Pine.LNX.4.21.0006251540480.24945-100000@saturn.ispol.com> <20000625135631.F29590@lyra.org> <4.3.2.7.2.20000625174031.00bd3540@pop.ne.mediaone.net> <20000625155755.H29590@lyra.org>
Message-ID: <3956B7E0.718FB3B9@caveosystems.com>

> > >     sys.path = sys.path + string.split(directive_arg, ':')

Gee, I dunno. I kinda like the idea that the config file can completely
set the path.  It seems cleaner that way, just as scripts often do
	PATH=/bin:/usr/bin ; export PATH
rather than
	PATH=$PATH:/bin:/usr/bin ; export PATH

I vote to keep the current semantics.

From a.d.stribblehill at durham.ac.uk  Thu Jun  1 11:59:27 2000
From: a.d.stribblehill at durham.ac.uk (Andrew Stribblehill)
Date: Fri Jan  9 21:58:30 2004
Subject: [mod_python] Apache segfaults on startup
Message-ID: <20000601115927.B24781@womble.dur.ac.uk>

I compiled mod_python as a DSO. It compiled OK, and so I installed
it into libexec and put the appropriate magic into httpd.conf.
Subsequently, running apache causes it to seg. I noticed the FAQ
answer so I put made sure the module was loaded first, but it
still segs. How can I track down this problem?

OS: Solaris 8
Compiler: GCC 2.8.1
Python : 1.5.2
Apache: 1.3.9

Thanks,

Andrew Stribblehill
Systems Programmer, IT Service, University of Durham, England

From hildmann at prz.tu-berlin.de  Thu Jun  1 19:21:07 2000
From: hildmann at prz.tu-berlin.de (Thomas Hildmann)
Date: Fri Jan  9 21:58:30 2004
Subject: [mod_python] How to run each .py instead of showing it
Message-ID: <39369B83.5259DA64@prz.tu-berlin.de>

Hello!

This is more an apache configuration question than a mod_python one. 

Is it possible to configure the apache this way that every .py file is
interpreted to be processed by the mod_python?


Greetings....

hildi

From Mads at Kiilerich.com  Fri Jun  2 04:01:14 2000
From: Mads at Kiilerich.com (Mads Kiilerich)
Date: Fri Jan  9 21:58:30 2004
Subject: [mod_python] AttributeError: handler
Message-ID: <Pine.LNX.4.21.0006020345280.18671-200000@localhost>

Hello,

I'm testing mod_python on a almost vanilla Red Hat 6.2 with the
relevant stuff coming directly from the RPM packages:

[mk@otto mk]$ rpm -q apache python
apache-1.3.12-2
python-1.5.2-13
[mk@otto mk]$ 

mod_python have been installed as DSO according to the
instructions (IMHO, but MyMMV). When apache starts I get

[Fri Jun  2 03:47:15 2000] [notice] Apache/1.3.12 (Unix)  (Red Hat/Linux) PHP/3.0.15 mod_python/2.1 Python/1.5.2 configured -- resuming normal operations

But accessing the test.py page I get the attached error-message.

Any hints to how to solve that problem?

TIA,

-- 
Mads Kiilerich          Sys.Adm. Cand.Polyt
Mads@Kiilerich.com      Tel. +45 38 16 26 00  Mob. +45 26 20 07 73
M?ntmestervej 12B 1th,  DK-2400 NV,  Denmark

"Learned about WAP. It sucks. The more I play with WML the more sure 
I am that WAP will die out rapidly once phones doing HTML exist."
							Alan Cox
-------------- next part --------------

ERROR mod_python: "PythonHandler test"

Traceback (innermost last):

  File "/usr/lib/python1.5/site-packages/mod_python/apache.py", line 87, in Dispatch
    object = self.resolve_object(module, object_str)

  File "/usr/lib/python1.5/site-packages/mod_python/apache.py", line 42, in resolve_object
    obj = getattr(obj, obj_str)

AttributeError: handler

From grisha at ispol.com  Fri Jun  2 07:29:22 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:30 2004
Subject: [mod_python] AttributeError: handler
In-Reply-To: <Pine.LNX.4.21.0006020345280.18671-200000@localhost>
Message-ID: <Pine.LNX.4.21.0006020728250.7977-100000@saturn.ispol.com>

The message means that module test did not have a function called
"handler".

Grisha

On Fri, 2 Jun 2000, Mads Kiilerich wrote:

> Hello,
> 
> I'm testing mod_python on a almost vanilla Red Hat 6.2 with the
> relevant stuff coming directly from the RPM packages:
> 
> [mk@otto mk]$ rpm -q apache python
> apache-1.3.12-2
> python-1.5.2-13
> [mk@otto mk]$ 
> 
> mod_python have been installed as DSO according to the
> instructions (IMHO, but MyMMV). When apache starts I get
> 
> [Fri Jun  2 03:47:15 2000] [notice] Apache/1.3.12 (Unix)  (Red Hat/Linux) PHP/3.0.15 mod_python/2.1 Python/1.5.2 configured -- resuming normal operations
> 
> But accessing the test.py page I get the attached error-message.
> 
> Any hints to how to solve that problem?
> 
> TIA,
> 
> -- 
> Mads Kiilerich          Sys.Adm. Cand.Polyt
> Mads@Kiilerich.com      Tel. +45 38 16 26 00  Mob. +45 26 20 07 73
> M?ntmestervej 12B 1th,  DK-2400 NV,  Denmark
> 
> "Learned about WAP. It sucks. The more I play with WML the more sure 
> I am that WAP will die out rapidly once phones doing HTML exist."
> 							Alan Cox
> 


From grisha at ispol.com  Fri Jun  2 12:25:35 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:30 2004
Subject: [mod_python] test
Message-ID: <Pine.LNX.4.21.0006021225150.8928-100000@saturn.ispol.com>

please ignore


From haering at informatik.tu-muenchen.de  Sun Jun  4 04:34:32 2000
From: haering at informatik.tu-muenchen.de (Gerhard Haering)
Date: Fri Jan  9 21:58:30 2004
Subject: [mod_python] ANNOUNCE: mod_python 2.1 RPMs for SuSE 6.4
Message-ID: <20000604043417.A14514@in.tum.de>

this and the files at: http://jarre.pair.com/insadmin/gerhard/

----------------------------
mod_python RPMs for SuSE 6.4
----------------------------


What is it?

Source and binary packages of mod_python 2.1 and a mod_python-ready Apache
in RPM format. All for SuSE Linux version 6.4.


The history of it

I am by no means a mod_python expert. In fact I have not even programmed
anything with it until now. I am, however, very interested in mod_python
because I use Python for CGI-scripting exclusively. When I recently heard
of mod_python, I tried to make it run on my Apache server, but it was not
especially easy to get it going. Finally I succeeded but it was a product
of trial and error. A few days later I didn't want to do any 'real'
programming, so I thought it would be nice to finally learn how to build
RPMs and why not package mod_python ...


What's in for you

If you have a SuSE 6.4 system and want to try out mod_python without
messing around too much recompiling Apache or Apache modules, these RPMs
might be for you. To be honest, I don't know how well they will work, at
least they work for me, that is: after installing the RPMs
http://localhost/test/test.py displays "Hello from mod_python." on my
machine. Most probably, the RPMs will need some tweaking and be rebuilt
for older SuSE versions. They will definitely not work for any other
distributions, but the SPEC file and my patches for the Apache startup
script, httpd/httpd.conf, the Makefile for mod_python, etc. might give you
a start if you want to build packages for your favorite distribution.


Quickstart

On a SuSE 6.4 system, remove the old Apache RPM and install my modified
Apache 1.3.12 RPM. Then install the mod_python RPM. Then restart Apache
and point your browser to http://localhost/test/test.py. The text "Hello
from mod_python." should be displayed. If you want to know what's going on
behind the scenes:

     - patched the SuSE startup script /sbin/init.d/apache to work with and 
       without mod_python
     - patched /etc/httpd/httpd.conf to use a mod_python 
       handler at /usr/local/httpd/htdocs/test/test.py
     - install mod_python documentation at /usr/doc/packages/mod_python

Have a lot of fun!


Feedback

I cannot promise to remove any bugs in the RPMs, but if any feedback is
coming, I will try. If I have some time to waste, I will try to improve
the RPMs and make some for SuSE 6.3. Please contact me at haering@in.tum.de.

From richard at whitequeen.com  Sat Jun  3 20:43:13 2000
From: richard at whitequeen.com (richard offer)
Date: Fri Jan  9 21:58:30 2004
Subject: [mod_python] Returning multiple content types ?
Message-ID: <200006040343.e543hD329628@erij.whitequeen.com>

Hi,


<Newbie>

How do I write a handler that can return multitple pieces of content ? 


I've got a handler that can read an image out of the photgraphic database
I'm working on, but I need to be able to generate the rest of the page
around the image ?


Should I be using the cgihandler ? This is virgin code so I'm, not
porting an exising implementation, so it seemed to me that I would be
better off using the basic handler, is this true ?


Is there an easy way to parse the QUERY_STRING into a dict ?


Should I be using a different architecture ? I was working on having
everything in one handler, does this make sence?

</Newbie>


thanks, this is so cool :-)


richard.


-----------------------------------------------------------------------
richard offer @ home 
_______________________________http://www.whitequeen.com/users/richard/


From grisha at ispol.com  Sun Jun  4 15:00:44 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:30 2004
Subject: [mod_python] 2.2 is out
Message-ID: <Pine.LNX.4.21.0006041452530.28185-100000@saturn.ispol.com>

Mod_python 2.2 is out. This one fixes the occasional trashing of
content-type that some people have reported. This bug manifested itself
more for people who use Python 1.6. Thanks to Dave Wallace for pointing it
out.

There is also a Win32 DLL of 2.1 available for download, and 2.2 hopefully
as soon as Stephane Bidoul gets around to compiling it. 

Also thanks to Gerhard Haering for the Suse RPM's. It'd be nice if someone
came up and agreed to maintain with RedHat RPM, Debian package, a FreeBSD
port and a Solaris package...

Have a good day,

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com






From grisha at ispol.com  Sun Jun  4 15:08:38 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:30 2004
Subject: [mod_python] Returning multiple content types ?
In-Reply-To: <200006040343.e543hD329628@erij.whitequeen.com>
Message-ID: <Pine.LNX.4.21.0006041503350.28185-100000@saturn.ispol.com>

On Sat, 3 Jun 2000, richard offer wrote:

> How do I write a handler that can return multitple pieces of content ? 

For as long as you have a way to tell the handler which content to return
(typically done via URL) and the handler has the logic to understand it,
this shouldn't be too hard. All of the handlers included with mod_python
return multiple pieces of content.

> Should I be using the cgihandler ? This is virgin code so I'm, not
> porting an exising implementation, so it seemed to me that I would be
> better off using the basic handler, is this true ?

If it's virgin code and you have no intentions of using CGI in the future
there is no reason for you to mess with the cgihandler, you're right.

> Is there an easy way to parse the QUERY_STRING into a dict ?

Look at the standard Python library module cgi.py.

> Should I be using a different architecture ? I was working on having
> everything in one handler, does this make sence?

This is something only you, as developer,  can determine.

Grisha


From SBID at BXS.BE  Mon Jun  5 12:01:12 2000
From: SBID at BXS.BE (=?iso-8859-1?Q?St=E9phane_BIDOUL?=)
Date: Fri Jan  9 21:58:30 2004
Subject: [mod_python] Problems under windows
Message-ID: <C16998C688CDD31196D90008C7E690CB17233F@EVRSRV04>

Hi,

mod_python seems to crash sometimes under
windows (Windows 2000, Python 1.5.2, Apache 1.3.11, mod_python 2.2).

I can trigger the problem by keeping the "refresh" key pressed in the
browser. I use the most trivial test script:

	print "content-type: text/plain"
	print
	print "Hello from mod_python"

and the following httpd.conf

	LoadModule python_module modules/mod_python.dll
	AddHandler python-program .py
	PythonHandler mod_python.cgihandler
	PythonDebug

The problem seems to be thread-related because I sometimes
get the following message:

	Fatal Python error: ceval: orphan tstate

Sometimes it's simply an access violation.

It seems to occur somewhere inside the PyObject_CallMethod call 
in python_handler().

I'm not intimate with python or apache threading, so maybe someone 
can examine the problem further... Or maybe it's simply my windows build of 
mod_python which is wrong somehow...

Any idea?

-Stephane
sbi@acse.be

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20000605/07b9a484/attachment-0002.htm
From seant at alum.mit.edu  Mon Jun  5 07:21:48 2000
From: seant at alum.mit.edu (Sean True)
Date: Fri Jan  9 21:58:30 2004
Subject: [mod_python] Leaking and cgi-handler
In-Reply-To: <C16998C688CDD31196D90008C7E690CB17233F@EVRSRV04>
Message-ID: <4.3.2.20000605071041.00b91280@pop.ne.mediaone.net>

Like too many people, I'm working on a version of python server pages -- 
.phtml pages which contain
mixed python and HTML code, allowing on the fly construction of pages from 
files which can mostly be
edited with a WYSIWYG HTML editor. I have a phtml.py program which is 
invoked as a cgi script, and more
recently under cgi-handler.

The documentation for cgi-handler notes that it may be subject to a memory 
leak related to os.environ().

On a Linux Redhat 6.1 system with Apache and statically linked mod_python, 
I'm seeing memory usage growing
by about 10K or so per page served (measured by watching the system monitor 
reports grow). Performance also
drops -- from about 15 pages served per second to less than 8 pages per second.

All of this makes me think that some data structure in the interpreter or 
mod_python is growing without bound,
in combination with a linear search from the front of the list.

The same code runs under pyapache with a very modest memory leak (also 
documented for pyapache) of about 1K
per page served.

I was a little unwilling to try switching to a more direct method of 
content handling under mod_python (creating
a request handler for .phtml page) until the whole system was a little more 
stable. I'm in production under pyapache
now, and I hate forking the code base.

Comments? Suggestions?

Does anyone have a skeleton content handler they would be willing to share, 
along with a corresponding .conf
entry?

-- Sean

==========
Sean True
seant@alum.mit.edu


From grisha at ispol.com  Mon Jun  5 08:05:32 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:30 2004
Subject: [mod_python] Leaking and cgi-handler
In-Reply-To: <4.3.2.20000605071041.00b91280@pop.ne.mediaone.net>
Message-ID: <Pine.LNX.4.21.0006050746190.31412-100000@saturn.ispol.com>

Sean - 

If you can find the source of the memory leak, please let me know what it
is, because I couldn't... :-(

The cgihandler when used with scripts not using cgi.py does not leak a
byte of memory. Unfortunately 98% of Python scripts out there start with
"import cgi".

A common misconception about Python and memory leaks is that it is
impossible to leak memory in Python. Python, just like any other language
allows you to allocate limitless memory, and in a persistent daemon-type
environment like Apache it shows.

Most likely the reason PyApache does not leak memory as bad is it resets
the interpeter between hits. This comes at a significant performance hit
since all the modules have to imported again, to the point where PyApache
isn't all that much faster than plain CGI.

My recomendation would to rewrite everything using "native" mod_python
handlers. They are simple (much simpler than CGI), fast and they do not
leak memory. You fears about them being unstable are unfounded, I think.

P.S. A skeleton content handler is described in the documentation.

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Mon, 5 Jun 2000, Sean True wrote:

> The same code runs under pyapache with a very modest memory leak (also
> documented for pyapache) of about 1K per page served.
> 
> I was a little unwilling to try switching to a more direct method of
> content handling under mod_python (creating a request handler for
> .phtml page) until the whole system was a little more stable. I'm in
> production under pyapache now, and I hate forking the code base.
> 
> Comments? Suggestions?
> 
> Does anyone have a skeleton content handler they would be willing to
> share, along with a corresponding .conf entry?
> 
> -- Sean


From Mads at Kiilerich.com  Mon Jun  5 15:13:40 2000
From: Mads at Kiilerich.com (Mads Kiilerich)
Date: Fri Jan  9 21:58:30 2004
Subject: [mod_python] AttributeError: handler
In-Reply-To: <Pine.LNX.4.21.0006020728250.7977-100000@saturn.ispol.com>
Message-ID: <Pine.LNX.4.21.0006051504240.864-100000@localhost>

Friday I got mail from Gregory Trubetskoy:

> The message means that module test did not have a function called
> "handler".
> 
> Grisha

Thanks for the fast response.

But test.py contains the following, according to the example in
the documentation:


from mod_python import apache

def handler(req):
	req.send_http_header()
	req.write("Hello World!")
	return apache.OK 


As far as I can see there _is_ a function called "handler"!?

Can you confirm that the example from the documentation works
"out of the box"?

Also: Should the .py be compiled to .pyc?

TIA,
-- 
Mads Kiilerich          Sys.Adm. Cand.Polyt
Mads@Kiilerich.com      Tel. +45 38 16 26 00  Mob. +45 26 20 07 73
M?ntmestervej 12B 1th,  DK-2400 NV,  Denmark

"Learned about WAP. It sucks. The more I play with WML the more sure 
I am that WAP will die out rapidly once phones doing HTML exist."
							Alan Cox


From grisha at ispol.com  Mon Jun  5 09:40:52 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:30 2004
Subject: [mod_python] AttributeError: handler
In-Reply-To: <Pine.LNX.4.21.0006051504240.864-100000@localhost>
Message-ID: <Pine.LNX.4.21.0006050938520.31412-100000@saturn.ispol.com>

Mads - 

Everyone who reported this problem so far found later on that they had
extra blanks in their test.py because they cut and pasted from the web
page.

No, you don't need to compile your py into a pyc - Python will do that for
you.

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Mon, 5 Jun 2000, Mads Kiilerich wrote:

> Friday I got mail from Gregory Trubetskoy:
> 
> But test.py contains the following, according to the example in
> the documentation:
> 
> 
> from mod_python import apache
> 
> def handler(req):
> 	req.send_http_header()
> 	req.write("Hello World!")
> 	return apache.OK 
> 


From aiglauer at yahoo.com  Mon Jun  5 07:08:41 2000
From: aiglauer at yahoo.com (Alexis Iglauer)
Date: Fri Jan  9 21:58:30 2004
Subject: [mod_python] AttributeError: handler
Message-ID: <20000605140841.29193.qmail@web2205.mail.yahoo.com>

Always a good idea to just run python over your script
before trying to run it on the webserver - this will
pick up any inconsistent dedents or other little
syntax nasties.

If you are in unix, edit the file in vi and type in
':set list' - you can then see which of your nice
spaces are actually sneaky tabs :)

Regards
aei


--- Gregory Trubetskoy <grisha@ispol.com> wrote:
> 
> Mads - 
> 
> Everyone who reported this problem so far found
> later on that they had
> extra blanks in their test.py because they cut and
> pasted from the web
> page.
> 
> No, you don't need to compile your py into a pyc -
> Python will do that for
> you.
> 
> --
>   Gregory (Grisha) Trubetskoy
>        grisha@ispol.com
> 
> On Mon, 5 Jun 2000, Mads Kiilerich wrote:
> 
> > Friday I got mail from Gregory Trubetskoy:
> > 
> > But test.py contains the following, according to
> the example in
> > the documentation:
> > 
> > 
> > from mod_python import apache
> > 
> > def handler(req):
> > 	req.send_http_header()
> > 	req.write("Hello World!")
> > 	return apache.OK 
> > 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 
> 
> 


__________________________________________________
Do You Yahoo!?
Yahoo! Photos -- now, 100 FREE prints!
http://photos.yahoo.com

From sbi at acse.be  Mon Jun  5 20:56:13 2000
From: sbi at acse.be (=?iso-8859-1?Q?St=E9phane_Bidoul?=)
Date: Fri Jan  9 21:58:30 2004
Subject: [mod_python] Problems under windows: a first diagnostic
Message-ID: <010101bfcf1f$b9407bd0$885bfea9@spirou>

Hi again,

I think I've got an explanation for the crashes under windows.

Disclaimer: I'm no apache expert, nor am I intimate with python threading,
so bear with me if the following is completely off-track.

In the python doc, I've found the following:

<PythonDocExcerpt>

[...] when threads are created from C, they don't have the global interpreter lock, nor is there a thread state data structure for them. Such threads must bootstrap themselves into existence, by first creating a thread state data structure [PyThreadState_New()?], then acquiring the lock, and finally storing their thread state pointer, before they can start using the Python/C API. When they are done, they should reset the thread state pointer, release the lock, and finally free their thread state data structure.

</PythonDocExcerpt>

Now, in mod_python, threads are created by Apache, so they should
somehow be bootstrapped for python. 

In my understanding, mod_python only initializes one thread per
interpreter: the Apache thread that is happening to create the interpreter
 (using Py_NewInterpreter(), which in turns calls PyThreadState_New()
for the interpreter's "main" thread).
All other apache threads using that same interpreter will not call
PyThreadState_New()... hence the potential conflict.

To summarize, my understanding of the python doc is that there should
be one PyThreadState_New() for each (apache thread, python interpreter) couple.

AFAIK, threads are used only in the Windows version of Apache, 
so the problem should not occur on unix  (athough that will change with Apache 2). 
Also, if ThreadsPerChild is set to 1, the problem disappears,
which seems to confirm my diagnostic.

Again, bear with me if this is totally wrong...
If this is correct, however, I've no idea (yet) on how to fix it...

What do you think? 
Can a python threading expert confirm or infirm this diagnostic?

-Stephane
sbi@acse.be




From gstein at lyra.org  Mon Jun  5 17:16:39 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:58:30 2004
Subject: [mod_python] Problems under windows: a first diagnostic
In-Reply-To: <010101bfcf1f$b9407bd0$885bfea9@spirou>
Message-ID: <Pine.LNX.4.10.10006051658410.14292-100000@nebula.lyra.org>

On Mon, 5 Jun 2000, [iso-8859-1] Stéphane Bidoul wrote:
>...
> Now, in mod_python, threads are created by Apache, so they should
> somehow be bootstrapped for python. 

Correct.

> In my understanding, mod_python only initializes one thread per
> interpreter: the Apache thread that is happening to create the interpreter
>  (using Py_NewInterpreter(), which in turns calls PyThreadState_New()
> for the interpreter's "main" thread).
> All other apache threads using that same interpreter will not call
> PyThreadState_New()... hence the potential conflict.

ThreadState structures are not specific to a particular (OS) thread. You
can actually use them (not at the same time!) across different threads.
Given the protection of the global lock, it might be okay to even attempt
to use them at the same time.
[ haven't thought through this particular scenario fully yet ]

> To summarize, my understanding of the python doc is that there should
> be one PyThreadState_New() for each (apache thread, python
> interpreter) couple.

Theoretically: yes.

Python's central lock "should" arbitrate the use of the per-interpreter
thread state so that it can be used by multiple Apache threads. Probably
isn't the best idea, though.

Eek. Definitely wrong for the Apache scenario.

The scoop: if python_handler() calls into Python, then returns, then
tstate->frame should be NULL. In this scenario, you could do the
share-tstate thing.

However: somewhere down inside of python_handler's call into Python, it is
quite possible for Python to use Py_BEGIN_ALLOW_THREADS (unlock the global
lock). This will allow another python_handler to grab the tstate and
attempt execution. Let's say the thread execution then flips back to
normal: the original thread's tstate->frame is now *totally* wrong.

[ tstate->frame has a direct correspondence to the C stack; these must
  stay in sync or Bad Things happen ]

> AFAIK, threads are used only in the Windows version of Apache, 
> so the problem should not occur on unix  (athough that will change with Apache 2). 
> Also, if ThreadsPerChild is set to 1, the problem disappears,
> which seems to confirm my diagnostic.
> 
> Again, bear with me if this is totally wrong...
> If this is correct, however, I've no idea (yet) on how to fix it...

Your underlying hypothesis is quite correct. Above is a more detailed
breakdown of "why".

> What do you think? 
> Can a python threading expert confirm or infirm this diagnostic?

That would be me :-)

One other thing: if Apache is going to run threads, then Python *MUST* be
compiled with thread support. Otherwise, things will die very rapidly.
Presuming that you are using the standard Windows distribution, then the
thread support is automatically enabled. I would recommend that mod_python
barf with #error if it detects Apache/Win32 and WITH_THREAD is not
enabled.

Heh. All of this just supports my belief in "free threading" Python even
more... :-)

What is the solution? Each entry to python-handler should construct a
tstate on the fly, call into Python, then destroy the tstate. I used this
design for the Python/COM support in the Win32 distribution. That had to
deal with reentrancy issues, but (luckily) that isn't a problem here.

Presumably, you could also cache/pool tstates and yank them from your
pool on entry to python-handler, returning them on exit. If two threads
came into python-handler (against the same interp!), then additional
tstates would be constructed.

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/


From seant at alum.mit.edu  Mon Jun  5 23:11:07 2000
From: seant at alum.mit.edu (Sean True)
Date: Fri Jan  9 21:58:31 2004
Subject: [mod_python] A cheap handler for exploring Apache req contents
Message-ID: <4.3.2.20000605230004.00b94c20@pop.ne.mediaone.net>

The following code is so inelegant, I'm a little embarrassed to share it, 
but it's a handy handler for starting
to poke around inside the Apache req structure, and so informative that I 
thought I'd share.

Grisha might want to comment as to why some of the attributes of the req 
don't dump the way I tried to dump them. Could just be the late night 
stupids on my part.

-- Sean

=================
from mod_python import apache

def dumpdict(req,title, d):
     req.write("*"+title + "\n")
     for key in d.keys():
         req.write(str(key) + ": " + str(d[key]) + "\n")
def dump(req,title,s):
     req.write(title+": "+s+"\n")
def handler(req):
     req.send_http_header()
     dump(req,"Request", req.the_request)
     dump(req,"Protocol", req.protocol)
     dump(req,"Hostname", req.hostname)
     dump(req,"Status line", req.status_line)
     dump(req, "Method", req.method)
     dump(req,"Content handler", req.handler)
     dump(req, "Unparsed uri", req.unparsed_uri)
     dump(req, "Uri", req.uri)
     dump(req, "Filename", req.filename)
     dump(req, "Path info", req.path_info)
     dump(req, "Args", req.args)
     dump(req, "Mtime", str(req.mtime))
     dump(req, "Remaining", str(req.remaining))
     # The following don't work.
     #dump(req, "Content type", req.content_type)
     #dump(req, "Content encoding", req.content_encoding)
     #dump(req, "Parsed uri", str(req.parsed_uri))
     #dump(req, "finfo", str(req.finfo))
     dumpdict(req, "headers_in",req.headers_in)
     dumpdict(req, "headers_out", req.headers_out)
     dumpdict(req, "err_headers_out", req.err_headers_out)
     dumpdict(req, "subprocess_env", req.subprocess_env)
     dumpdict(req, "notes", req.notes)
     return apache.OK
================
Output on my system: (with domain deleted for privacy)
================
Request: GET /foo.xhtml?fu=bar HTTP/1.0
Protocol: HTTP/1.0
Hostname: www.[..].com
Status line: 200 OK Method: GET
Content handler: python-program
Unparsed uri: /foo.xhtml?fu=bar
Uri: /foo.xhtml
Filename: /usr/local/apache/htdocs/foo.xhtml
Path info:
Args: fu=bar
Mtime: 0
Remaining: 0
*headers_in
Accept: */*
Accept-Language: en-us
Connection: Keep-Alive
Host: www.[..].com
User-Agent: Mozilla/4.0 (compatible; MSIE 5.01; Windows 98)
*headers_out
Connection: close
Content-Type: text/plain
*err_headers_out
*subprocess_env
SCRIPT_URL: /foo.xhtml
SCRIPT_URI: http://www.[..]/foo.xhtml
GATEWAY_INTERFACE: CGI/1.1
SERVER_PROTOCOL: HTTP/1.0
REQUEST_METHOD: GET
QUERY_STRING: fu=bar
REQUEST_URI: /foo.xhtml?fu=bar
SCRIPT_NAME: /foo.xhtml
*notes
python_request_ptr: 135846824

==========
Sean True
seant@alum.mit.edu


From sbi at acse.be  Tue Jun  6 09:35:03 2000
From: sbi at acse.be (=?iso-8859-1?Q?St=E9phane_Bidoul?=)
Date: Fri Jan  9 21:58:31 2004
Subject: [mod_python] Problems under windows: a first diagnostic
References: <Pine.LNX.4.10.10006051658410.14292-100000@nebula.lyra.org>
Message-ID: <006201bfcf89$ba39c2c0$885bfea9@spirou>

>...
>The scoop: if python_handler() calls into Python, then returns, then
>tstate->frame should be NULL. In this scenario, you could do the
>share-tstate thing.
>
>However: somewhere down inside of python_handler's call into Python, it is
>quite possible for Python to use Py_BEGIN_ALLOW_THREADS (unlock the global
>lock). This will allow another python_handler to grab the tstate and
>attempt execution. Let's say the thread execution then flips back to
>normal: the original thread's tstate->frame is now *totally* wrong.

Wow! This looks even more complex than I thought...

>What is the solution? Each entry to python-handler should construct a
>tstate on the fly, call into Python, then destroy the tstate. I used this
>design for the Python/COM support in the Win32 distribution. That had to
>deal with reentrancy issues, but (luckily) that isn't a problem here.
>
>Presumably, you could also cache/pool tstates and yank them from your
>pool on entry to python-handler, returning them on exit. If two threads
>came into python-handler (against the same interp!), then additional
>tstates would be constructed.

I was contemplating the use of thread-local storage to maintain
the list of interpreters for which a tstate is initialized for each
Apache thread, but it's probably overkill...

Ideally, Apache should provide access to some "per-thread data area" for this,
but it does not, right?

Anyway, unless Gregory tells me otherwise, I will experiment with 
Greg's first solution and see how it works...

-Stephane



From gstein at lyra.org  Tue Jun  6 02:50:52 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:58:31 2004
Subject: [mod_python] Problems under windows: a first diagnostic
In-Reply-To: <006201bfcf89$ba39c2c0$885bfea9@spirou>
Message-ID: <Pine.LNX.4.10.10006060245500.14292-100000@nebula.lyra.org>

On Tue, 6 Jun 2000, [iso-8859-1] Stéphane Bidoul wrote:
>...
> >What is the solution? Each entry to python-handler should construct a
> >tstate on the fly, call into Python, then destroy the tstate. I used this
> >design for the Python/COM support in the Win32 distribution. That had to
> >deal with reentrancy issues, but (luckily) that isn't a problem here.
> >
> >Presumably, you could also cache/pool tstates and yank them from your
> >pool on entry to python-handler, returning them on exit. If two threads
> >came into python-handler (against the same interp!), then additional
> >tstates would be constructed.
> 
> I was contemplating the use of thread-local storage to maintain
> the list of interpreters for which a tstate is initialized for each
> Apache thread, but it's probably overkill...

The cost of creating a tstate isn't all that high, in the scheme of
things. What is going to get a bit difficult is the change necessary in
get_obcallback(). It uses Py_NewInterpreter to create an interp/tstate
pair. You'll have to unwrap that into creating *just* an interpreter, thus
allowing you to create/destroy tstates at will.

> Ideally, Apache should provide access to some "per-thread data area" for this,
> but it does not, right?

For Apache 1.3, the only threaded platform is Windows, where TLS is going
to work out fine for you.

Apache 2.0 is a whole different story, and doesn't apply to mod_python.

> Anyway, unless Gregory tells me otherwise, I will experiment with 
> Greg's first solution and see how it works...

It is a good bundle of work, but it should work quite fine. Like I said, I
used a similar pattern for embedding the Python interpreter behind the
(multi-threaded) COM interfaces.

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/


From grisha at ispol.com  Tue Jun  6 07:38:29 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:31 2004
Subject: [mod_python] Problems under windows: a first diagnostic
In-Reply-To: <Pine.LNX.4.10.10006060245500.14292-100000@nebula.lyra.org>
Message-ID: <Pine.LNX.4.21.0006060734030.4432-100000@saturn.ispol.com>

I haven't had any caffeine yet so I don't think I can comment. The Python
relationship between ThreadStates and Interpreters took me a while to
understand last time I studied it and it's one of those things that I can
only grasp for a few days until I don't need it - then, next time, I have
figure it out again.

I'll think about this some more in the coming days....

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Tue, 6 Jun 2000, Greg Stein wrote:

> On Tue, 6 Jun 2000, [iso-8859-1] St?phane Bidoul wrote:
> >...
> > >What is the solution? Each entry to python-handler should construct a
> > >tstate on the fly, call into Python, then destroy the tstate. I used this
> > >design for the Python/COM support in the Win32 distribution. That had to
> > >deal with reentrancy issues, but (luckily) that isn't a problem here.
> > >
> > >Presumably, you could also cache/pool tstates and yank them from your
> > >pool on entry to python-handler, returning them on exit. If two threads
> > >came into python-handler (against the same interp!), then additional
> > >tstates would be constructed.
> > 
> > I was contemplating the use of thread-local storage to maintain
> > the list of interpreters for which a tstate is initialized for each
> > Apache thread, but it's probably overkill...
> 
> The cost of creating a tstate isn't all that high, in the scheme of
> things. What is going to get a bit difficult is the change necessary in
> get_obcallback(). It uses Py_NewInterpreter to create an interp/tstate
> pair. You'll have to unwrap that into creating *just* an interpreter, thus
> allowing you to create/destroy tstates at will.
> 
> > Ideally, Apache should provide access to some "per-thread data area" for this,
> > but it does not, right?
> 
> For Apache 1.3, the only threaded platform is Windows, where TLS is going
> to work out fine for you.
> 
> Apache 2.0 is a whole different story, and doesn't apply to mod_python.
> 
> > Anyway, unless Gregory tells me otherwise, I will experiment with 
> > Greg's first solution and see how it works...
> 
> It is a good bundle of work, but it should work quite fine. Like I said, I
> used a similar pattern for embedding the Python interpreter behind the
> (multi-threaded) COM interfaces.
> 
> Cheers,
> -g
> 
> -- 
> Greg Stein, http://www.lyra.org/
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From danilo at telusplanet.net  Wed Jun  7 14:51:44 2000
From: danilo at telusplanet.net (Danilo Fiorenzano)
Date: Fri Jan  9 21:58:31 2004
Subject: [mod_python] Leaking and cgi-handler
In-Reply-To: Gregory Trubetskoy's message of "Mon, 5 Jun 2000 08:05:32 -0400 (EDT)"
References: <Pine.LNX.4.21.0006050746190.31412-100000@saturn.ispol.com>
Message-ID: <m3puptnrj3.fsf@spike.interalta.com>

Gregory Trubetskoy <grisha@ispol.com> writes:

 
> The cgihandler when used with scripts not using cgi.py does not leak a
> byte of memory. Unfortunately 98% of Python scripts out there start with
> "import cgi".

..
 
> My recomendation would to rewrite everything using "native" mod_python
> handlers. They are simple (much simpler than CGI), fast and they do not
> leak memory. You fears about them being unstable are unfounded, I think.

On this theme: from the heights of my blissful ignorance (started
learning python and its library 2 weeks ago or so), I apparently
devised a way to use the facilities of the cgi module with mod_python
_without_ using the cgihandler.  I do something like this:

import cgi
from mod_python import apache

def handler(req):
    req.content_type = "text/html"
    req.send_http_header()

    env, si, so = apache.setup_cgi(req)
    formData = cgi.FieldStorage()
    for key in formData.keys():
        req.write( str(key) + " : " + str(data[key].value) + "<br>" )


This works without the need to specify cgihandler in the apache
config.  Not sure whether it's the Right way to handle things, or if
it avoids the leaking, but I thought it was worth sharing.. YMMV.

 regards

-- Danilo

From roybryant at SEVENtwentyfour.com  Wed Jun  7 20:46:43 2000
From: roybryant at SEVENtwentyfour.com (Roy Bryant)
Date: Fri Jan  9 21:58:31 2004
Subject: [mod_python] Broken link in www.modpython.org
Message-ID: <307EC3F394ACD311B959006008A30AD6BCDD9B@MAIL724>

There appears to be a problem on this page of your site.

    On your page
http://www.modpython.org/pipermail/mod_python/2000-June/000067.html
    when you click on your link to http://localhost/test/test.py.
    you get the error: Domain name lookup failed (may be a transient error)

As recommended by the Robot Guidelines, this email is to explain our robot's
activities and to let you know about one of the broken links we encountered.
LinkWalker does not store or publish the content of your pages, but rather
uses the link information to update our map of the World Wide Web.

Are these reports helpful? I'd love some feedback. If you prefer not to
receive these occasional error notices please let me know.

Roy Bryant

 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 Roy Bryant, roybryant@seventwentyfour.com
 President
 SEVENtwentyfour Inc. ("Always watching the Web")
 http://www.seventwentyfour.com
 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ 

From grisha at ispol.com  Thu Jun  8 09:53:32 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:31 2004
Subject: [mod_python] mod_python 2.3
Message-ID: <Pine.LNX.4.21.0006080946010.15265-100000@saturn.ispol.com>

Mod_python 2.3 is out.

There are two major changes in this one:

1. The PythonDebug, PythonInterpPerDirectory and PythonNoReload now
require an argument of On or Off. NOTE - THIS WILL REQUIRE YOU TO CHANGE
YOUR CONFIGS IF YOU'RE USING ANY OF THESE DIRECTIVES!!!

2. A new directive, PythonImport allows you to import modules at child
process initialization time. This is good for initializing database
connections, etc. Read the documentation for details.

For the future relelases, on my list are (in no particular order):

1. Ironing out the thread related issues so that mod_python works on
win32. 

2. ChildInit, ChildExit and Cleanup handlers.

3. Dynamic handler registration.

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com


From grisha at ispol.com  Thu Jun  8 09:57:48 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:31 2004
Subject: [mod_python] suggestions
Message-ID: <Pine.LNX.4.21.0006080953350.15265-100000@saturn.ispol.com>

If all goes well, I will be presenting about mod_python at the upcoming
Apachecon in London in October.

I'm looking for sugestions on topics that you think would be interesting
to cover. Imagine you were planning on attending the conference - what
would YOU like to know about mod_python?

Thanks,

Grisha



From sbi at acse.be  Thu Jun  8 17:28:31 2000
From: sbi at acse.be (=?Windows-1252?Q?St=E9phane_Bidoul?=)
Date: Fri Jan  9 21:58:31 2004
Subject: [mod_python] Another threading issue: chdir
Message-ID: <003b01bfd15e$33cb0f60$66a679c1@spirou>

Hi again,

Obviously, chdir is not thread-safe
(I discovered the problem by running different 
handlers in different directories)

It's ok with the one performed in cgihandler,
since cgi must run single-threaded anyway.

I wonder if the one in mod_python.c is really necessary?
Maybe apache.import_module() could add the directory to
pythonpath before doing the import instead of adding '.'.
Oh, and now that I write it, changing python path is 
not thread-safe either: can we do the import without
changing pythonpath at all? If not, another lock 
will be required to protect that...

There is also a chdir in the httpdapi handler
but I've no idea about that one.

Well, I hope the end of the threading tunnel is in sight...

-sbi
-------------- next part --------------
A non-text attachment was scrubbed...
Name: =?Windows-1252?Q?St=E9phane_Bidoul.vcf?=
Type: text/x-vcard
Size: 361 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20000608/ea5f5f9f/Windows-1252QStE9phane_Bidoul-0002.vcf
From grisha at ispol.com  Thu Jun  8 18:14:05 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:31 2004
Subject: [mod_python] Another threading issue: chdir (fwd)
Message-ID: <Pine.LNX.4.21.0006081813330.17090-100000@saturn.ispol.com>

Having the url directory as your current directory is just an intuitive
thing and makes it easier for the developer.... E.g. if you're trying to
open files, etc.

One thing that we could do is restore the original directory and make sure
that the lock is aqcuired before first chdir() and after the last chdir()?

Or chdir could be made optional via a directive of some sort.... I need to
think about this too...

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Thu, 8 Jun 2000, [Windows-1252] St?phane Bidoul wrote:

> Hi again,
> 
> Obviously, chdir is not thread-safe
> (I discovered the problem by running different 
> handlers in different directories)
> 
> It's ok with the one performed in cgihandler,
> since cgi must run single-threaded anyway.
> 
> I wonder if the one in mod_python.c is really necessary?
> Maybe apache.import_module() could add the directory to
> pythonpath before doing the import instead of adding '.'.
> Oh, and now that I write it, changing python path is 
> not thread-safe either: can we do the import without
> changing pythonpath at all? If not, another lock 
> will be required to protect that...
> 
> There is also a chdir in the httpdapi handler
> but I've no idea about that one.
> 
> Well, I hope the end of the threading tunnel is in sight...
> 
> -sbi
> 



From SBID at BXS.BE  Fri Jun  9 09:23:29 2000
From: SBID at BXS.BE (=?iso-8859-1?Q?St=E9phane_BIDOUL?=)
Date: Fri Jan  9 21:58:31 2004
Subject: [mod_python] Re: Another threading issue: chdir (fwd)
Message-ID: <C16998C688CDD31196D90008C7E690CB172343@EVRSRV04>

> Having the url directory as your current directory is just an intuitive
> thing and makes it easier for the developer.... E.g. if you're trying to
> open files, etc.

Agreed. OTOH, it is quite easy to obtain the module directory
with something like os.path.dirname(__file__).

> One thing that we could do is restore the original directory and make sure
> that the lock is aqcuired before first chdir() and after the last chdir()?

It would require another lock than the global interpreter lock because
that one can be released during execution. If another thread steps
in a that moment, the current directory could change in the middle of
a script...

But then it would degrade even native handlers to single-threading.

> Or chdir could be made optional via a directive of some sort.... I need to
> think about this too...

This option looks reasonable to me; 
the associated threading caveats could be documented easily.

Cheers

-sbi
sbi@acse.be
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20000609/a0168ad8/attachment-0002.htm
From grisha at ispol.com  Fri Jun  9 17:12:16 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:31 2004
Subject: [mod_python] Re: Another threading issue: chdir (fwd)
In-Reply-To: <C16998C688CDD31196D90008C7E690CB172342@EVRSRV04>
Message-ID: <Pine.LNX.4.21.0006091703340.21671-100000@saturn.ispol.com>

On Fri, 9 Jun 2000, St?phane BIDOUL wrote:

> > Or chdir could be made optional via a directive of some sort.... I need to
> > think about this too...
> 
> This option looks reasonable to me; 
> the associated threading caveats could be documented easily.

The more I think about this, the more it seems to me that doing away with
the chdir and prepending the path rather than the '.' is the way to go.

This will break old code that relied on the chdir being there, but what
can you do...

All the other solutions will make threaded mod_python incompatible with
nonthreaded be it extra directives or different code that you need....

Grisha



From daniel at copyleft.no  Sun Jun 11 14:44:00 2000
From: daniel at copyleft.no (Hr. Daniel Mikkelsen)
Date: Fri Jan  9 21:58:31 2004
Subject: [mod_python] make_obcallback(): could not import mod_python.apache.
Message-ID: <Pine.LNX.4.10.10006111434560.14419-100000@unity.copyleft.no>

Hi. 

I'm getting this error in my mail apache error_log when I try to start
httpd after having added mod_python 2.3 as a DSO:

make_obcallback(): could not import mod_python.apache.
make_obcallback(): could not call init.
[Sun Jun 11 14:33:49 2000] [error] python_init: get_obcallback returned no
  obCallBack. Possibly no more memory.

In version 2.2, I had the same problem (I switched to 2.3 while trying to
figure it out), with two exceptions. The last line in the error message
wasn't there, and apache didn't fail in starting (only in running .py test
files). 

Now, when I ran httpdapy, earlier, I had a very similar problem with
tracebacks about how it couldn't load certain python modules (apache.py
for instance), and apache failed to load in the same way. I solved the
problem by setting the PYTHONPATH correctly.

Changing PYTHONPATH doesn't seem to work now, however. I have the .py
files wich came with mod_python 2.3 in my
/usr/local/lib/python1.5/site-packages directory. I have compiled a
threadless python that expects (I assume, having given no --prefix=...
statement to its ./configure) to find scripts there. I've linked my
mod_python DSO with this verison of python. 

My setup is an OpenBSD 2.6 (using the apache that comes bundled), Python
1.5, enough memory (128Mb of which 81 are reported "free" byt top).

I'm trying to load the test.py given in the installation docs, and the
zhello.py given in the zhandler docs. 

Any ideas?

-- Daniel Mikkelsen, Copyleft Software


From grisha at ispol.com  Sun Jun 11 09:52:19 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:31 2004
Subject: [mod_python] make_obcallback(): could not import mod_python.apache.
In-Reply-To: <Pine.LNX.4.10.10006111434560.14419-100000@unity.copyleft.no>
Message-ID: <Pine.LNX.4.21.0006110951330.6729-100000@saturn.ispol.com>

If your Apache runs as nobody and the python library is not world
readable, you will get this error too.

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Sun, 11 Jun 2000, Hr. Daniel Mikkelsen wrote:

> Hi. 
> 
> I'm getting this error in my mail apache error_log when I try to start
> httpd after having added mod_python 2.3 as a DSO:
> 
> make_obcallback(): could not import mod_python.apache.
> make_obcallback(): could not call init.
> [Sun Jun 11 14:33:49 2000] [error] python_init: get_obcallback returned no
>   obCallBack. Possibly no more memory.
> 
> In version 2.2, I had the same problem (I switched to 2.3 while trying to
> figure it out), with two exceptions. The last line in the error message
> wasn't there, and apache didn't fail in starting (only in running .py test
> files). 
> 
> Now, when I ran httpdapy, earlier, I had a very similar problem with
> tracebacks about how it couldn't load certain python modules (apache.py
> for instance), and apache failed to load in the same way. I solved the
> problem by setting the PYTHONPATH correctly.
> 
> Changing PYTHONPATH doesn't seem to work now, however. I have the .py
> files wich came with mod_python 2.3 in my
> /usr/local/lib/python1.5/site-packages directory. I have compiled a
> threadless python that expects (I assume, having given no --prefix=...
> statement to its ./configure) to find scripts there. I've linked my
> mod_python DSO with this verison of python. 
> 
> My setup is an OpenBSD 2.6 (using the apache that comes bundled), Python
> 1.5, enough memory (128Mb of which 81 are reported "free" byt top).
> 
> I'm trying to load the test.py given in the installation docs, and the
> zhello.py given in the zhandler docs. 
> 
> Any ideas?
> 
> -- Daniel Mikkelsen, Copyleft Software
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From richard at whitequeen.com  Sun Jun 11 12:34:14 2000
From: richard at whitequeen.com (richard offer)
Date: Fri Jan  9 21:58:31 2004
Subject: [mod_python] problems with 2.0 -> 2.3 upgrade
Message-ID: <200006111934.e5BJYEB07387@erij.whitequeen.com>

Hi,

I upgraded from 2.0 to 2.3 this morning and am now seeing the following
error message in the webservers log file

[Sun Jun 11 12:23:33 2000] [notice] child pid 7340 exit signal Segmentation fault (11)
[Sun Jun 11 12:23:33 2000] [notice] child pid 7339 exit signal Segmentation fault (11)
[Sun Jun 11 12:23:35 2000] [notice] child pid 7343 exit signal Segmentation fault (11)
[Sun Jun 11 12:23:36 2000] [notice] child pid 7345 exit signal Segmentation fault (11)
[Sun Jun 11 12:23:36 2000] [notice] child pid 7344 exit signal Segmentation faul


It seems like all child webservers are dying, but the master is running
in a continous loop trying to spawn the children.


Moving the old (2.0) DSO and python code back into place fixed it.

[ Running Apache 1.3.12 on Redhat 6.1/2.2.16 ]


Any hints ?

richard.

-- 
richard offer @ home 
          84 FE 48 E4 74 D0 26 D4  31 8E B6 86 98 74 E2 7C  8A FB BF A3
___________________________________http://216.185.15.144/users/richard/

From grisha at ispol.com  Sun Jun 11 16:03:47 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:31 2004
Subject: [mod_python] problems with 2.0 -> 2.3 upgrade
In-Reply-To: <200006111934.e5BJYEB07387@erij.whitequeen.com>
Message-ID: <Pine.LNX.4.21.0006111558070.7904-100000@saturn.ispol.com>

Someone else reported this and I know what the problem is.

There are two things you can do:

1. downgrade to 2.2 and wait until 2.4
2. add a dummy PythonImport statement in the httpd.conf file between some
<Directory> tags, e.g.

PythonImport string

This is because I added the new PythonImport derective and did all the
testing and it worked fine, except when the directive is NOT specified and
thus the variable that holds the info is undefined.... Sorry, I'll be more
thorough next time!

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Sun, 11 Jun 2000, richard offer wrote:

> 
> Hi,
> 
> I upgraded from 2.0 to 2.3 this morning and am now seeing the following
> error message in the webservers log file
> 
> [Sun Jun 11 12:23:33 2000] [notice] child pid 7340 exit signal Segmentation fault (11)
> [Sun Jun 11 12:23:33 2000] [notice] child pid 7339 exit signal Segmentation fault (11)
> [Sun Jun 11 12:23:35 2000] [notice] child pid 7343 exit signal Segmentation fault (11)
> [Sun Jun 11 12:23:36 2000] [notice] child pid 7345 exit signal Segmentation fault (11)
> [Sun Jun 11 12:23:36 2000] [notice] child pid 7344 exit signal Segmentation faul
> 
> 
> It seems like all child webservers are dying, but the master is running
> in a continous loop trying to spawn the children.
> 
> 
> Moving the old (2.0) DSO and python code back into place fixed it.
> 
> [ Running Apache 1.3.12 on Redhat 6.1/2.2.16 ]
> 
> 
> Any hints ?
> 
> richard.
> 
> -- 
> richard offer @ home 
>           84 FE 48 E4 74 D0 26 D4  31 8E B6 86 98 74 E2 7C  8A FB BF A3
> ___________________________________http://216.185.15.144/users/richard/
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From wayne.izatt at myself.com  Sun Jun 11 13:46:08 2000
From: wayne.izatt at myself.com (Wayne Izatt)
Date: Fri Jan  9 21:58:31 2004
Subject: [mod_python] problems with 2.0 -> 2.3 upgrade
References: <200006111934.e5BJYEB07387@erij.whitequeen.com>
Message-ID: <3943FA8F.B7743662@myself.com>

richard offer wrote:

> Hi,
>
> I upgraded from 2.0 to 2.3 this morning and am now seeing the following
> error message in the webservers log file
>
> [Sun Jun 11 12:23:33 2000] [notice] child pid 7340 exit signal Segmentation fault (11)

<snip>

I get the same problem - same apache, same redhat.

<rant>

I'm getting sick and tired of these sorts of issues with redhat. I have apache problems
using PHP 4.0 with redhat, and mod_perl doesn't always work as expected on redhat.

</rant>


>
> It seems like all child webservers are dying, but the master is running
> in a continous loop trying to spawn the children.
>
> Moving the old (2.0) DSO and python code back into place fixed it.
>
> [ Running Apache 1.3.12 on Redhat 6.1/2.2.16 ]
>
> Any hints ?
>
> richard.
>
> --
> richard offer @ home
>           84 FE 48 E4 74 D0 26 D4  31 8E B6 86 98 74 E2 7C  8A FB BF A3
> ___________________________________http://216.185.15.144/users/richard/
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python


From sbi at acse.be  Mon Jun 12 23:06:03 2000
From: sbi at acse.be (=?iso-8859-1?Q?St=E9phane_Bidoul?=)
Date: Fri Jan  9 21:58:31 2004
Subject: [mod_python] Re: Another threading issue: chdir (fwd)
References: <Pine.LNX.4.21.0006091703340.21671-100000@saturn.ispol.com>
Message-ID: <00b401bfd4b2$0aed8a30$faa679c1@spirou>

>The more I think about this, the more it seems to me that doing away with
>the chdir and prepending the path rather than the '.' is the way to go.

Agreed, but I wonder how much the manipulation of sys.path to do the imports
can cause threading issues... Is it possible to avoid it?

>This will break old code that relied on the chdir being there, but what
>can you do...
>All the other solutions will make threaded mod_python incompatible with
>nonthreaded be it extra directives or different code that you need....

Cross platform compatibility is indeed important. To achive it people
should be told to assume multi-threaded operation: to be portable
to windows, and also to be Apache2-proof [since I understand that
it will use threads on Unix also; but it may not be a target for mod_python,
I don't know how different the API is].

-sbi




From gstein at lyra.org  Mon Jun 12 14:18:20 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:58:31 2004
Subject: [mod_python] Re: Another threading issue: chdir (fwd)
In-Reply-To: <00b401bfd4b2$0aed8a30$faa679c1@spirou>; from sbi@acse.be on Mon, Jun 12, 2000 at 11:06:03PM +0200
References: <Pine.LNX.4.21.0006091703340.21671-100000@saturn.ispol.com> <00b401bfd4b2$0aed8a30$faa679c1@spirou>
Message-ID: <20000612141820.R19484@lyra.org>

On Mon, Jun 12, 2000 at 11:06:03PM +0200, St?phane Bidoul wrote:
> >The more I think about this, the more it seems to me that doing away with
> >the chdir and prepending the path rather than the '.' is the way to go.
> 
> Agreed, but I wonder how much the manipulation of sys.path to do the imports
> can cause threading issues... Is it possible to avoid it?

sys.path is specific to an interpreter, rather than to a thread. Therefore,
threads should not be changing it.

> >This will break old code that relied on the chdir being there, but what
> >can you do...
> >All the other solutions will make threaded mod_python incompatible with
> >nonthreaded be it extra directives or different code that you need....
> 
> Cross platform compatibility is indeed important. To achive it people
> should be told to assume multi-threaded operation: to be portable
> to windows, and also to be Apache2-proof [since I understand that
> it will use threads on Unix also;

Correct. Apache 2.0 is threaded whenever threads are available (basically
everywhere nowadays). You can still run Apache 2.0 in its current mode, but
the default is threaded.

> but it may not be a target for mod_python,
> I don't know how different the API is].

The API is different enough; a 1.3 module can be ported, but it would be
reasonably difficult to have a module be compileable for both.

There are a number of other things that can be taken advantage of in the
Apache 2.0 API to improve/tighten the Apache/Python binding. I've been
planning to implement an Apache 2.0 specific "mod_py2" this summer to take
advantage of the 2.0 benefits. (as an Apache author, I can also make changes
to Apache to enhance this even further :-) In conjunction with that work,
I'm going to redo my "free threading patches" for 1.6 so that Python can
operate completely threaded within Apache 2.0 (e.g. the central lock
disappears entirely).

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/

From grisha at ispol.com  Mon Jun 12 17:30:14 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:31 2004
Subject: [mod_python] Re: Another threading issue: chdir (fwd)
In-Reply-To: <00b401bfd4b2$0aed8a30$faa679c1@spirou>
Message-ID: <Pine.LNX.4.21.0006121714500.12547-100000@saturn.ispol.com>

On Mon, 12 Jun 2000, St?phane Bidoul wrote:

> >The more I think about this, the more it seems to me that doing away with
> >the chdir and prepending the path rather than the '.' is the way to go.
> 
> Agreed, but I wonder how much the manipulation of sys.path to do the imports
> can cause threading issues... Is it possible to avoid it?

You could avoid it by making sure that the Pythonpath includes the
directory where your handlers are from the start, for example by setting
PYTHONPATH in the Apache startup script. But if we're going this route, we
might as well abandon the multiple interpreters.

Another problem with this is that typically you'll have to be root on the
system to restart Apache, and in many cases users are not.

On the upside, sys.path shouldn't get manipulated more than once. An
interpreter will get created and the sys.path changed upon the first hit,
after that it won't change. The sys.path manipualtion should be surrounded
by Python locks.

I have another idea - unless I'm missing something obvious, the way to
deal with this would be to add the directory to the path at interpreter
creation time in mod_python.c.

Grisha



From grisha at ispol.com  Mon Jun 12 17:48:08 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:31 2004
Subject: [mod_python] Re: Another threading issue: chdir (fwd)
In-Reply-To: <20000612141820.R19484@lyra.org>
Message-ID: <Pine.LNX.4.21.0006121740030.12547-100000@saturn.ispol.com>

On Mon, 12 Jun 2000, Greg Stein wrote:

> On Mon, Jun 12, 2000 at 11:06:03PM +0200, St?phane Bidoul wrote:
> > >The more I think about this, the more it seems to me that doing away with
> > >the chdir and prepending the path rather than the '.' is the way to go.
> > 
> > Agreed, but I wonder how much the manipulation of sys.path to do the imports
> > can cause threading issues... Is it possible to avoid it?
> 
> sys.path is specific to an interpreter, rather than to a thread. Therefore,
> threads should not be changing it.

On a related note though - is ap_table_set() thread-safe? I'm thinking of
all the Python* directives in .htaccess.

> as an Apache author, I can also make changes to Apache to enhance
> this even further :-)

Now that's luxury!

Grisha


From gstein at lyra.org  Mon Jun 12 14:57:19 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:58:31 2004
Subject: [mod_python] Re: Another threading issue: chdir (fwd)
In-Reply-To: <Pine.LNX.4.21.0006121740030.12547-100000@saturn.ispol.com>; from grisha@ispol.com on Mon, Jun 12, 2000 at 05:48:08PM -0400
References: <20000612141820.R19484@lyra.org> <Pine.LNX.4.21.0006121740030.12547-100000@saturn.ispol.com>
Message-ID: <20000612145719.U19484@lyra.org>

On Mon, Jun 12, 2000 at 05:48:08PM -0400, Gregory Trubetskoy wrote:
> On Mon, 12 Jun 2000, Greg Stein wrote:
>...
> > sys.path is specific to an interpreter, rather than to a thread. Therefore,
> > threads should not be changing it.
> 
> On a related note though - is ap_table_set() thread-safe? I'm thinking of
> all the Python* directives in .htaccess.

They are not thread-safe, but the only tables that would be changed are in
the request_rec and possibly the conn_rec. In other words: private to the
thread.

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/

From grisha at ispol.com  Mon Jun 12 18:23:28 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:31 2004
Subject: [mod_python] Re: Another threading issue: chdir (fwd)
In-Reply-To: <20000612145719.U19484@lyra.org>
Message-ID: <Pine.LNX.4.21.0006121818230.12547-100000@saturn.ispol.com>

On Mon, 12 Jun 2000, Greg Stein wrote:

> On Mon, Jun 12, 2000 at 05:48:08PM -0400, Gregory Trubetskoy wrote:
> > 
> > On a related note though - is ap_table_set() thread-safe? I'm thinking of
> > all the Python* directives in .htaccess.
> 
> They are not thread-safe, but the only tables that would be changed are in
> the request_rec and possibly the conn_rec. In other words: private to the
> thread.

Hmm.... But it might be a problem for PythonImport. PythonImport builds a
table a pointer to which is a global variable python_import. Then,
ChildInitHandler goes through that table and imports all the modules.

The reason PythonImport doesn't use the standard config stuff is that
ap_get_module_config() returns NULL inside a child init handler.

Am I taking the wrong apporach on this?

Grisha


From Mads at Kiilerich.com  Tue Jun 13 10:06:12 2000
From: Mads at Kiilerich.com (Mads Kiilerich)
Date: Fri Jan  9 21:58:31 2004
Subject: [mod_python] AttributeError: handler
In-Reply-To: <Pine.LNX.4.21.0006050938520.31412-100000@saturn.ispol.com>
Message-ID: <Pine.LNX.4.21.0006122243040.1325-100000@localhost>

Jun 5 I got mail from Gregory Trubetskoy:

> Everyone who reported this problem so far found later on that they had
> extra blanks in their test.py because they cut and pasted from the web
> page.

That makes me a speciel case. I found the solution to my problem
- and the problem wasn't spaces. 

The problem was that the PythonHandler I had specified wasn't in
the same directory as the directive was given in - thus the
handler couldn't be found.  I found this behaviour very
confusing - but now when I know it it starts to make sense! ;)

Correcting the path solved the problem. Another solution was to
add the PythonInterpPerDirectory directive.

Cheers,

-- 
Mads Kiilerich          Sys.Adm. Cand.Polyt
Mads@Kiilerich.com      Tel. +45 38 16 26 00  Mob. +45 26 20 07 73
M?ntmestervej 12B 1th,  DK-2400 NV,  Denmark

"Learned about WAP. It sucks. The more I play with WML the more sure I 
am that WAP will die out rapidly once phones doing HTML exist."    Cox




From Mads at Kiilerich.com  Tue Jun 13 10:07:07 2000
From: Mads at Kiilerich.com (Mads Kiilerich)
Date: Fri Jan  9 21:58:31 2004
Subject: [mod_python] AttributeError: handler
In-Reply-To: <20000605140841.29193.qmail@web2205.mail.yahoo.com>
Message-ID: <Pine.LNX.4.21.0006122249210.1325-100000@localhost>

Jun 5 I got mail from Alexis Iglauer:

> Always a good idea to just run python over your script
> before trying to run it on the webserver - this will
> pick up any inconsistent dedents or other little
> syntax nasties.

"Run python over".  How do I do that? With a compileall? (I
guess not, as performing a compileall gives a "Listing test.py
...\nCan't list test.py".)

TIA,
-- 
Mads Kiilerich          Sys.Adm. Cand.Polyt
Mads@Kiilerich.com      Tel. +45 38 16 26 00  Mob. +45 26 20 07 73
M?ntmestervej 12B 1th,  DK-2400 NV,  Denmark

"Learned about WAP. It sucks. The more I play with WML the more sure I 
am that WAP will die out rapidly once phones doing HTML exist."    Cox




From Mads at Kiilerich.com  Tue Jun 13 10:10:20 2000
From: Mads at Kiilerich.com (Mads Kiilerich)
Date: Fri Jan  9 21:58:31 2004
Subject: [mod_python] 2.2 is out
In-Reply-To: <Pine.LNX.4.21.0006041452530.28185-100000@saturn.ispol.com>
Message-ID: <Pine.LNX.4.21.0006131007280.904-200000@localhost>

Jun 4 I got mail from Gregory Trubetskoy:

> Also thanks to Gerhard Haering for the Suse RPM's. It'd be nice if someone
> came up and agreed to maintain with RedHat RPM, Debian package, a FreeBSD
> port and a Solaris package...

I've made a spec for RedHat, you'll find it attached. IMHO, if
you make a rpm and install it on a plain 6.2 system you'll get
something that works and can be used as a base for further
experiments.

Feedback is welcome!

Regards,

-- 
Mads Kiilerich          Sys.Adm. Cand.Polyt
Mads@Kiilerich.com      Tel. +45 38 16 26 00  Mob. +45 26 20 07 73
M?ntmestervej 12B 1th,  DK-2400 NV,  Denmark

"Learned about WAP. It sucks. The more I play with WML the more sure I 
am that WAP will die out rapidly once phones doing HTML exist."    Cox

-------------- next part --------------
Summary: The Python language for use with Apache.
Name: mod_python
Version: 2.2
Release: 0
Group: System Environment/Daemons
Source0: %{name}-%{version}.tgz
Copyright: BSD-ish???
BuildRoot: %{_tmppath}/%{name}-root
Requires: apache >= 1.3 , python >= 1.5.2
BuildPrereq: apache-devel 
Packager: Mads Kiilerich <mads@kiilerich.com>

%description
Mod_python allows embedding Python within the Apache http server for a
considerable boost in performance and added flexibility in designing web based
applications. 

The RPM installs a small example in /home/httpd/mod_python which can be
accessed as http://localhost/mod_python/some/path/which/doesn/t/matter

%prep
%setup -q -n mod_python-%{version}

%build
# 1. Installing Python Libraries
/usr/bin/python /usr/lib/python1.5/compileall.py lib/python/mod_python

# 2. Compiling -- Compiling mod_python as a DSO
apxs -I /usr/include/python1.5 -c src/mod_python.c \
	/usr/lib/python1.5/config/libpython1.5.a -lpthread

%install
rm -rf $RPM_BUILD_ROOT
install -D -s src/mod_python.so $RPM_BUILD_ROOT/usr/lib/apache/mod_python.so
mkdir -p $RPM_BUILD_ROOT/usr/lib/python1.5/site-packages/mod_python
install lib/python/mod_python/* \
	$RPM_BUILD_ROOT/usr/lib/python1.5/site-packages/mod_python
mkdir -p $RPM_BUILD_ROOT/home/httpd/mod_python
cat <<CAT>$RPM_BUILD_ROOT/home/httpd/mod_python/.htaccess
SetHandler python-program
PythonHandler pythonhandler
CAT
cat <<CAT>$RPM_BUILD_ROOT/home/httpd/mod_python/pythonhandler.py 
from mod_python import apache

def handler(req):
    req.send_http_header()
    req.write("Hello to the World from "+req.uri+"!")
    return apache.OK 
CAT

%clean
rm -rf $RPM_BUILD_ROOT

%post
grep -q 'LoadModule python_module' /etc/httpd/conf/httpd.conf || \
patch /etc/httpd/conf/httpd.conf <<CAT
*** httpd.conf.org      
--- httpd.conf  
***************
*** 206,207 ****
--- 206,208 ----
  # LoadModule foo_module modules/mod_foo.so
+ LoadModule python_module      modules/mod_python.so
  #LoadModule mmap_static_module modules/mod_mmap_static.so
***************
*** 253,254 ****
--- 254,256 ----
  ClearModuleList
+ AddModule mod_python.c
  #AddModule mod_mmap_static.c
***************
*** 965,966 ****
--- 967,974 ----
  
+ <IfModule mod_python.c>
+   Alias /mod_python/ /home/httpd/mod_python/
+   <Directory /home/httpd/mod_python>
+     AllowOverride FileInfo
+   </Directory>
+ </IfModule>
  ### Section 3: Virtual Hosts
CAT

%postun
perl -pi -e 's|^LoadModule python_module|#LoadModule python_module|g' \
 	/etc/httpd/conf/httpd.conf
perl -pi -e 's|^AddModule mod_python.c|#AddModule mod_python.c|g' \
	/etc/httpd/conf/httpd.conf

%files
%defattr(-,root,root)
%attr(0755,root,root) /usr/lib/apache/mod_python.so
/usr/lib/python1.5/site-packages/mod_python
/home/httpd/mod_python
%doc COPYRIGHT doc/*.html

%changelog
* Mon Jun 13 2000 Mads Kiilerich <mads@kiilerich.com>
- Made initial version of mod_python rpm
From sbi at acse.be  Tue Jun 13 19:08:18 2000
From: sbi at acse.be (=?iso-8859-1?Q?St=E9phane_Bidoul?=)
Date: Fri Jan  9 21:58:31 2004
Subject: [mod_python] Slashes...
Message-ID: <021c01bfd559$fdc62490$66a679c1@spirou>

A potential problem with slashes:
Windows NT accepts / or \, while Windows 9x accepts only \.

It means that with this directive:

<Directory "c:/soft/apache/htdocs/test2/">
  PythonHandler test2
</Directory>

mod_python ends up importing c:/soft/apache/htdocs/test2/\test2.py.

It works fine so it should not be an issue. 

Could it be an issue in get_request_object where the trailing
slash is first removed then added again? 
[I'm not sure to understand that area so I can't tell myself]

Maybe the functions from os.path should be used to be safe?

Also, I've found this in the apache doc:

<ApacheDocExcerpt>
The directives that accept filenames as arguments now must use Windows filenames instead of Unix ones. However, because Apache uses Unix-style names internally, you must use forward slashes, not backslashes. Drive letters can be used; if omitted, the drive with the Apache executable will be assumed.
</ApacheDocExcerpt>

So I'm not sure what is the right approach...

Regards.

-sbi



From sbi at acse.be  Tue Jun 13 19:07:53 2000
From: sbi at acse.be (=?iso-8859-1?Q?St=E9phane_Bidoul?=)
Date: Fri Jan  9 21:58:31 2004
Subject: [mod_python] Re: Another threading issue: chdir (fwd)
References: <Pine.LNX.4.21.0006121714500.12547-100000@saturn.ispol.com>
Message-ID: <020a01bfd559$eef3e470$66a679c1@spirou>

>I have another idea - unless I'm missing something obvious, the way to
>deal with this would be to add the directory to the path at interpreter
>creation time in mod_python.c.

I see nothing wrong with that either. 
I think is done already in ChildInitHandler when 
PythonImport is specified, so why not do it systematically.

-sbi





From gstein at lyra.org  Wed Jun 14 00:04:13 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:58:31 2004
Subject: [mod_python] mod_snake
Message-ID: <20000614000413.G27338@lyra.org>

fyi...

http://modsnake.sourceforge.net/

-- 
Greg Stein, http://www.lyra.org/

From richard at whitequeen.com  Tue Jun 13 05:35:59 2000
From: richard at whitequeen.com (richard offer)
Date: Fri Jan  9 21:58:31 2004
Subject: [mod_python] mod_snake
In-Reply-To: Greg Stein <gstein@lyra.org>
       "[mod_python] mod_snake" (Jun 14, 12:04am)
Message-ID: <200006131235.e5DCZxu10283@erij.whitequeen.com>

* $ from gstein@lyra.org at "14-Jun:12:04am" | sed "1,$s/^/* /" 
*
*
* fyi...
* 
* http://modsnake.sourceforge.net/

Has anyone played with it yet, pros ? cons ? I like the idea of moving
to Apache 2.0, and it seems to have reasonable documentation (probably
my biggest gripe about mod_python is the sparse docs).

On the other hand I'm close to getting something to show...

* Greg Stein, http://www.lyra.org/

richard.


-- 
richard offer @ home 
          84 FE 48 E4 74 D0 26 D4  31 8E B6 86 98 74 E2 7C  8A FB BF A3
___________________________________http://216.185.15.144/users/richard/

From grisha at ispol.com  Wed Jun 14 12:34:46 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:31 2004
Subject: [mod_python] mod_snake
In-Reply-To: <200006131235.e5DCZxu10283@erij.whitequeen.com>
Message-ID: <Pine.LNX.4.21.0006141233360.22477-100000@saturn.ispol.com>

On Tue, 13 Jun 2000, richard offer wrote:

> to Apache 2.0, and it seems to have reasonable documentation (probably
> my biggest gripe about mod_python is the sparse docs).

Hmmm... Everyone else said the documentation was very thorough. What do
think is missing?

Grisha


From sjbotha at email.com  Wed Jun 14 19:08:40 2000
From: sjbotha at email.com (Sarel J. Botha)
Date: Fri Jan  9 21:58:31 2004
Subject: [mod_python] Just displays
Message-ID: <20000614190839.A30053@home>

I'm having a bit of a problem with mod_python. The module gets loaded (I
can see in the logs), but when I access a .py file it just prints the
source.

I've got this in srm.conf:
AddHandler python-program .py

As far as I can tell, that's all that's needed, right?

Thanks
-- 
------------------
Sarel Botha
sjbotha@email.com
------------------

99 little bugs in the code, 99 bugs in the code,
          fix one bug, compile it again...
          101 little bugs in the code....


From richard at whitequeen.com  Tue Jun 13 07:35:21 2000
From: richard at whitequeen.com (richard offer)
Date: Fri Jan  9 21:58:32 2004
Subject: [mod_python] mod_snake
In-Reply-To: Gregory Trubetskoy <grisha@ispol.com>
       "Re: [mod_python] mod_snake" (Jun 14, 12:34pm)
Message-ID: <200006131435.e5DEZLM10444@erij.whitequeen.com>

* $ from grisha@ispol.com at "14-Jun:12:34pm" | sed "1,$s/^/* /" 
*
*
* 
* On Tue, 13 Jun 2000, richard offer wrote:
* 
* > to Apache 2.0, and it seems to have reasonable documentation (probably
* > my biggest gripe about mod_python is the sparse docs).
* 
* Hmmm... Everyone else said the documentation was very thorough. What do
* think is missing?

It took me a while to work out the relationship between the PythonHandler 
<entry> and the location of the file.py I wanted to run. I figured it out
eventually, but these are the sorts of questions that need to be obvious,
sicne they are only met by first time users (when I was a system manager, 
if it took me any longer than an 1/2 day to get a piece of software working,
it went to the the bottome the queue---under those rules I'd be using 
php now).

There are no function prototypes in the docs, it took me a while to
figure out that req.read() needed a length argument.

I have to refer to the Apache C docs to work out what members I can use
in the request structure.

The examples are too short, something demonstrating the handling of url
args would have saved me a day, needing to test for req.method as well
as req.args is more hassle. 

I hope to publish my code in the next few weeks (interface to a MySQL 
image database with search etc), maybe just a few contributed demos
would help. I'd like to see some drop in contributed modules like
php/mod_perl has.


Now I admit that I'm new to this (web programming) but I'm a self taught C
OS programmer, so if I can waste days in figuring it out, this isn't CP4E.

Please don't take the above as anything but constructive critism, I like
mod_python, it got me off my ass and working on the web site which I'd
been postponing for months, and for that I'm grateful.

* 
* Grisha
* 

richard.


-- 
richard offer @ home 
          84 FE 48 E4 74 D0 26 D4  31 8E B6 86 98 74 E2 7C  8A FB BF A3
___________________________________http://216.185.15.144/users/richard/

From martin at src.no  Thu Jun 15 10:48:12 2000
From: martin at src.no (Martin Jenssen)
Date: Fri Jan  9 21:58:32 2004
Subject: [mod_python] Difficulties with Windows NT/Apache/mod_python
Message-ID: <Pine.LNX.4.21.0006151030550.23457-100000@lade.src.no>

Hello,

I am getting some strange messages when trying to setup Apache with
mod_python on Windows NT.  I used the precompiled binary of mod_python 2.2
as found on http://www.modpython.org/, the precompiled binary of Apache
1.3.12 as found on http://www.apache.org/ and Windows NT 4.0 Server.

When I try to start Apache with mod_python configured as specified in the
documentation, I get these messages:

"""
make_obcallback(): could not import mod_python.apache.
make_obcallback(): could not call init.
Apache/1.3.12 (Win32) mod_python/2.2 Python/1.5.2 running...
"""

Strangely, it doesn't quit, but continues to try to serve web pages.  For
each .py file I try to reach via the web browser, I get these messages
thrown into the error.log file:

"""
[Thu Jun 15 10:37:45 2000] [error] [client 193.71.134.144] \
	python_handler: get_obcallback returned no obCallBack!
"""


Martin Jenssen


From daniel at copyleft.no  Thu Jun 15 11:03:42 2000
From: daniel at copyleft.no (Hr. Daniel Mikkelsen)
Date: Fri Jan  9 21:58:32 2004
Subject: [mod_python] Difficulties with Windows NT/Apache/mod_python
In-Reply-To: <Pine.LNX.4.21.0006151030550.23457-100000@lade.src.no>
Message-ID: <Pine.LNX.4.10.10006151100460.6024-100000@unity.copyleft.no>

> make_obcallback(): could not import mod_python.apache.
> make_obcallback(): could not call init.
> Apache/1.3.12 (Win32) mod_python/2.2 Python/1.5.2 running...

I got these messages when I copied the _files_ in the
lib/python/mod_python dir into site-packages, instead 
of copying the entire _directory_, by mistake. 

Anyway, it's a problem of your python interpreter not 
finding the mod_python modules. Use PYTHONPATH in the 
environment or PythonPath in the apache.conf. 

-- Daniel Mikkelsen, Copyleft Software



From grisha at ispol.com  Thu Jun 15 07:44:04 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:32 2004
Subject: [mod_python] Difficulties with Windows NT/Apache/mod_python
In-Reply-To: <Pine.LNX.4.21.0006151030550.23457-100000@lade.src.no>
Message-ID: <Pine.LNX.4.21.0006150742280.28199-100000@saturn.ispol.com>

Sounds to me like the mod_python package is not in your pythonpath.

BTW, the win32 binary is unstable because of some thread problems. 2.4
should be considerably more stable and will come out in a couple of days.

Grisha

On Thu, 15 Jun 2000, Martin Jenssen wrote:

> Hello,
> 
> I am getting some strange messages when trying to setup Apache with
> mod_python on Windows NT.  I used the precompiled binary of mod_python 2.2
> as found on http://www.modpython.org/, the precompiled binary of Apache
> 1.3.12 as found on http://www.apache.org/ and Windows NT 4.0 Server.
> 
> When I try to start Apache with mod_python configured as specified in the
> documentation, I get these messages:
> 
> """
> make_obcallback(): could not import mod_python.apache.
> make_obcallback(): could not call init.
> Apache/1.3.12 (Win32) mod_python/2.2 Python/1.5.2 running...
> """
> 
> Strangely, it doesn't quit, but continues to try to serve web pages.  For
> each .py file I try to reach via the web browser, I get these messages
> thrown into the error.log file:
> 
> """
> [Thu Jun 15 10:37:45 2000] [error] [client 193.71.134.144] \
> 	python_handler: get_obcallback returned no obCallBack!
> """
> 
> 
> Martin Jenssen
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From sjbotha at email.com  Thu Jun 15 21:54:59 2000
From: sjbotha at email.com (Sarel J. Botha)
Date: Fri Jan  9 21:58:32 2004
Subject: [mod_python] Re: Just displays
In-Reply-To: <20000614190839.A30053@home>; from  on Wed, Jun 14, 2000 at 07:08:40PM +0200
References: <20000614190839.A30053@home>
Message-ID: <20000615215457.A9676@home>

On Wed, Jun 14, 2000 at 07:08:40PM +0200, I wrote:
> I'm having a bit of a problem with mod_python. The module gets loaded (I
> can see in the logs), but when I access a .py file it just prints the
> source.

I still can't get it working.

I've got LoadModule python_module /usr/local/lib/apache/1.3/mod_python.so
in httpd.conf and the module loads, as I can see it in the logs:
[Thu Jun 15 21:40:52 2000] [notice] Apache/1.3.12 (Unix) Debian/GNU PHP/4.0RC1 mod_python/2.2 Python/1.5.2 configured -- resuming normal operations

I've got this in srm.conf:
  AddHandler python-program .py

It just prints the file, as if the AddHandler directive weren't there.

Thanks
-- 
------------------
Sarel Botha
sjbotha@email.com
------------------

99 little bugs in the code, 99 bugs in the code,
          fix one bug, compile it again...
          101 little bugs in the code....


From grisha at ispol.com  Thu Jun 15 18:00:31 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:32 2004
Subject: [mod_python] Re: Just displays
In-Reply-To: <20000615215457.A9676@home>
Message-ID: <Pine.LNX.4.21.0006151759230.28199-100000@saturn.ispol.com>

On Thu, 15 Jun 2000, Sarel J. Botha wrote:

> On Wed, Jun 14, 2000 at 07:08:40PM +0200, I wrote:
> 
> I've got this in srm.conf:
>   AddHandler python-program .py
> 
> It just prints the file, as if the AddHandler directive weren't there.

Are you sure your srm.conf file is being read at all? Move the directive
into httpd.conf. srm.conf is obsolete and shouldn't be used anyway.

Grisha


From sjbotha at email.com  Fri Jun 16 02:29:10 2000
From: sjbotha at email.com (Sarel J. Botha)
Date: Fri Jan  9 21:58:32 2004
Subject: [mod_python] Re: Just displays
In-Reply-To: <Pine.LNX.4.21.0006151759230.28199-100000@saturn.ispol.com>; from grisha@ispol.com on Thu, Jun 15, 2000 at 06:00:31PM -0400
References: <20000615215457.A9676@home> <Pine.LNX.4.21.0006151759230.28199-100000@saturn.ispol.com>
Message-ID: <20000616022908.A11353@home>

On Thu, Jun 15, 2000 at 06:00:31PM -0400, Gregory Trubetskoy wrote:
> Are you sure your srm.conf file is being read at all? Move the directive
> into httpd.conf. srm.conf is obsolete and shouldn't be used anyway.

That's great to hear. I've always thought it was a bit silly to have so
many different config files.

It is reading srm.conf, I just added a .cgi Handler and it works. Without
it, it doesn't.

Thanks
-- 
------------------
Sarel Botha
sjbotha@email.com
------------------

99 little bugs in the code, 99 bugs in the code,
          fix one bug, compile it again...
          101 little bugs in the code....


From geoff at ijane.com  Fri Jun 16 10:54:15 2000
From: geoff at ijane.com (geoff@ijane.com)
Date: Fri Jan  9 21:58:32 2004
Subject: [mod_python] python rewrite of mod_usertrack
Message-ID: <20000616155414.IQGO860.mta1biz.bizmailsrvcs.net@web1biz.bizmailsrvcs.net>

Here is a first pass at a session tracking module using mod_python.
It is basically a mod_usertrack rip-off.
Let me know what you think.
-geoff greenberg

From geoff at ijane.com  Fri Jun 16 11:19:33 2000
From: geoff at ijane.com (geoff@ijane.com)
Date: Fri Jan  9 21:58:32 2004
Subject: [mod_python] python rewrite of mod_usertrack (actual module this time)
Message-ID: <20000616161933.ANH135729.mta1biz.bizmailsrvcs.net@web1biz.bizmailsrvcs.net>

Sorry.
I didn't realize that attachment didn't work.
Here is the module (usertrack.py):

"""This module is a shameless rewrite of mod_usertrack in python.  It should
operate in most respects like mod_usertrack.  The exception would be that it
always sets a 4 digit year for an expire date.

Logging
This will be handled by mod_log_config, the custom log module.  The cookie
will be available by using the token, "%{session_cookie}n".
For example:

LogFormat "%t \"%r\" %>s \"%{session_cookie}n\"" session
CustomLog /usr/local/apache/logs/session_log session

PythonOptions
There are three options that can be configured: CookieExpires, CookieName
and CookieTracking.   These basically work the same as mod_usertrack's
directives of the same name.

CookieExpires
This option sets an expiration time for the cookie generated by this module.
This time can be either a number of seconds or a string describing the
amount of time.  If this option does not exist the cookie will expire when
the browser's session does.  The time string must be quoted and is in the
format of a space separeated list of "number label" pairs.  Valid labels
are: years, months, weeks, days, hours, minutes, seconds.

CookieName
If this option exists the default name of the cookie will be whatever the
label specifies.

CookieTracking
This option is required if you will to use this module.  It's value must be
"on" for this module to operate.


httpd.conf example:

<Directory />
    PythonPath "['/usr/lib/python1.5', '/usr/lib/python1.5/site-packages']"

    PythonDebug
    PythonOption CookieName k3WL_c00KI3_nAM3
    PythonOption CookieTracking on
    PythonOption CookieExpires "10 years 4 months 2 weeks 3 days 2 hours 36
seconds"
    PythonFixupHandler usertrack
</Directory>

"""
__version__ = "$Id: usertrack.py,v 1.1 2000/06/02 09:00:31 geoff Exp $"
from mod_python import apache
import re, string, time, os

isDigit = re.compile("^\d+$")
isSpace = re.compile("\s+")

FACTOR = {
    'years': 60 * 60 * 24 * 365,
    'months': 60 * 60 * 24 * 30,
    'weeks': 60 * 60 * 24 * 7,
    'days': 60 * 60 * 24,
    'hours': 60 * 60,
    'minutes': 60,
    'seconds': 1,
    }            

COOKIE_NAME = "Apache_Python"

def fixuphandler(r):
    global COOKIE_NAME
    opt = r.get_options()
    if opt['CookieTracking'] != 'on':
        return apache.DECLINED
    else:
        if opt.has_key('CookieName'): COOKIE_NAME = opt['CookieName']
        try:
            m = re.search("(?:^|\s+)%s=(?P<cookieValue>[^;]+)" %
COOKIE_NAME, \
                          r.headers_in['Cookie'])
            r.notes['session_cookie'] = m.group('cookieValue')
            return apache.DECLINED
        except:
            expires = 0
            if opt.has_key('CookieExpires'):
                expires = r.request_time + \
                                 parseExpire(opt['CookieExpires'])
            make_cookie(r, COOKIE_NAME, expires)
    return apache.OK
        
def make_cookie(r, name, expires):
    """Set a unique cookie for user tracking."""
    cookieValue = "%s.%d%ld%ld" % (r.hostname, os.getpid(), r.request_time,
\
                                   time.clock())
    if expires == 0:
        r.headers_out['Set-Cookie'] = "%s=%s; path=/" % (name, \
                                                         cookieValue)
    else:
        r.headers_out['Set-Cookie'] = "%s=%s; path=/; expires=%s GMT" % \
            (name, cookieValue, time.strftime("%A, %d-%b-%Y %H:%M:%S", \
            time.gmtime(expires)))  
    r.notes['session_cookie'] = cookieValue
    return

def parseExpire(expire):
    """Return number of seconds from a formated string."""
    if isDigit.search(expire): return expire
    seconds = 0
    t = isSpace.split(expire)
    tLen = len(t)
    i = 0
    while i < tLen:
        if isDigit.search(t[i]):
            seconds = seconds + (FACTOR.get(string.lower(t[i + 1]), 0) * \
                                 string.atoi(t[i]))
        i = i + 2
    return seconds

From grisha at ispol.com  Fri Jun 16 12:43:43 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:32 2004
Subject: [mod_python] python rewrite of mod_usertrack (actual module this
 time)
In-Reply-To: <20000616161933.ANH135729.mta1biz.bizmailsrvcs.net@web1biz.bizmailsrvcs.net>
Message-ID: <Pine.LNX.4.21.0006161243020.1238-100000@saturn.ispol.com>

Nice work!

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Fri, 16 Jun 2000 geoff@ijane.com wrote:

> Sorry.
> I didn't realize that attachment didn't work.
> Here is the module (usertrack.py):
> 
> """This module is a shameless rewrite of mod_usertrack in python.  It should
> operate in most respects like mod_usertrack.  The exception would be that it


From jam at quark.emich.edu  Sat Jun 17 10:33:54 2000
From: jam at quark.emich.edu (Jeff)
Date: Fri Jan  9 21:58:32 2004
Subject: [mod_python] release of 2.4 or CVS access
Message-ID: <20000617103354.A3690@quark.emich.edu>

Greetings,

I'd like to do some work with mod_python.. I noticed on the website that 2.3
has a bug that will be fixed in 2.4. 

when and where can I find 2.4? is there a CVS repository I can check out the
code from? what's the bug in 2.3 that's so nasty?

regards,
J
-- 
|| visit gfd <http://quark.emich.edu/>
|| psa member -- <http://www.python.org/psa/> 

From grisha at ispol.com  Sat Jun 17 11:15:51 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:32 2004
Subject: [mod_python] release of 2.4 or CVS access
In-Reply-To: <20000617103354.A3690@quark.emich.edu>
Message-ID: <Pine.LNX.4.21.0006171111280.5577-100000@saturn.ispol.com>

On Sat, 17 Jun 2000, Jeff wrote:

> when and where can I find 2.4? 

when - whenever it is done. Some time next week.

where - same place as 2.2 :-)

> is there a CVS repository I can check out the code from? 

there is a CVS repository, but only I have access to it.... I'm
considering putting it out on sourceforge.

> what's the bug in 2.3 that's so nasty?

It basically won't run. You can still download it from the same place as
2.2 - just substitute 2.2 for 2.3. 

Regards - 

Grisha


From jam at quark.emich.edu  Sat Jun 17 11:26:00 2000
From: jam at quark.emich.edu (Jeff)
Date: Fri Jan  9 21:58:32 2004
Subject: [mod_python] access to ap_send_fd from python
Message-ID: <20000617112600.D5135@quark.emich.edu>

Greetings,

I was looking through the API documentation and found the ap_send_fd
function (http://dev.apache.org/apidoc/apidoc_ap_send_fd.html). It's purpose
is to send the contents of a FILE* to the client. 

This seems appropriate when static files need to be served-- decode the URL
the client is asking for, open the file, set the appropriate headers
(content-type in particular), call this function, then close the file. This
moves the 'work' of sending the file into the C code, instead of using
Python, which would seem to be quite a bit faster.

Could this be considered for a future releases of mod_python? 

Are there any issues I should be aware of before trying to get it to work?

Regards,
J
-- 
|| visit gfd <http://quark.emich.edu/>
|| psa member -- <http://www.python.org/psa/> 

From jam at quark.emich.edu  Sat Jun 17 11:30:55 2000
From: jam at quark.emich.edu (Jeff)
Date: Fri Jan  9 21:58:32 2004
Subject: [mod_python] release of 2.4 or CVS access
In-Reply-To: <Pine.LNX.4.21.0006171111280.5577-100000@saturn.ispol.com>; from grisha@ispol.com on Sat, Jun 17, 2000 at 11:15:51AM -0400
References: <20000617103354.A3690@quark.emich.edu> <Pine.LNX.4.21.0006171111280.5577-100000@saturn.ispol.com>
Message-ID: <20000617113055.E5135@quark.emich.edu>

On Sat, Jun 17, 2000 at 11:15:51AM -0400, Gregory Trubetskoy wrote:
> 
> On Sat, 17 Jun 2000, Jeff wrote:
> 
> > when and where can I find 2.4? 
> 
> when - whenever it is done. Some time next week.
> 

clearly ;) I got the impression that it was a simple problem of a NULL
pointer and so should be fairly easy to fix. I assume this means there will
be more than just this change in 2.4? what's on the list?

Regards,
J
-- 
|| visit gfd <http://quark.emich.edu/>
|| psa member -- <http://www.python.org/psa/> 

From grisha at ispol.com  Sat Jun 17 16:04:00 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:32 2004
Subject: [mod_python] release of 2.4 or CVS access
In-Reply-To: <20000617113055.E5135@quark.emich.edu>
Message-ID: <Pine.LNX.4.21.0006171602350.6292-100000@saturn.ispol.com>

On Sat, 17 Jun 2000, Jeff wrote:

> clearly ;) I got the impression that it was a simple problem of a NULL
> pointer and so should be fairly easy to fix. I assume this means there will
> be more than just this change in 2.4? what's on the list?

Not much really.

It should work cleanly on Win32 (multithreaded) and then I'm trying add a
tutorial to the documentation.

Grisha


From seant at alum.mit.edu  Sun Jun 18 15:08:15 2000
From: seant at alum.mit.edu (Sean True)
Date: Fri Jan  9 21:58:32 2004
Subject: [mod_python] mod_python style redirection.
Message-ID: <4.3.2.7.2.20000618150623.00bb75f0@pop.ne.mediaone.net>

Any one care to suggest a mod_python appropriate way to redirect a request 
to another page? The ap_internal_redirect() function looks
appropriate but does not seem to be wrapped.

TIA.

-- Sean

==========
Sean True
seant@alum.mit.edu


From grisha at ispol.com  Sun Jun 18 16:11:31 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:32 2004
Subject: [mod_python] mod_python style redirection.
In-Reply-To: <4.3.2.7.2.20000618150623.00bb75f0@pop.ne.mediaone.net>
Message-ID: <Pine.LNX.4.21.0006181608100.19774-100000@saturn.ispol.com>

Something like this should work:

	req.headers_out["Location"] = "http://www.redirectto.com/"
	return apache.HTTP_MOVED_TEMPORARILY

Grisha

On Sun, 18 Jun 2000, Sean True wrote:

> Any one care to suggest a mod_python appropriate way to redirect a request 
> to another page? The ap_internal_redirect() function looks
> appropriate but does not seem to be wrapped.
> 
> TIA.
> 
> -- Sean
> 
> ==========
> Sean True
> seant@alum.mit.edu
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From grisha at ispol.com  Tue Jun 20 11:23:41 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:32 2004
Subject: [mod_python] mod_python 2.4
Message-ID: <Pine.LNX.4.21.0006201117090.27023-100000@saturn.ispol.com>

Mod_python 2.4 is out. Unlike 2.3, this one should work ;-).

There are some major changes since 2.2:

1. The PythonDebug, PythonInterpPerDirectory and PythonNoReload now
require an argument of On or Off. NOTE - THIS WILL REQUIRE YOU TO CHANGE
YOUR CONFIGS IF YOU'RE USING ANY OF THESE DIRECTIVES!!!

2. A new directive, PythonImport allows you to import modules at child
process initialization time. This is good for initializing database
connections, etc, though this approach has some serious limitations. Read
the documentation for details.

3. We think that most thread-related issues have been resolved and that
mod_python is capable of running stably on Win32. There is a Win32
(i3866) DLL binary available for download. A lot of very valuable input
and work on this was done by St?phane Bidoul and Greg Stein.

4. I tried to improve the docuemntation. All mod_python objects are now
documented down to every single attribute, and there is a small tutorial
started. The tutorial will need some improvements - e.g. examples of
how to deal with forms or cookies.

Regards -

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com



From jam at quark.emich.edu  Tue Jun 20 11:25:48 2000
From: jam at quark.emich.edu (Jeff)
Date: Fri Jan  9 21:58:32 2004
Subject: [mod_python] attempting to download 2.4 -- permission denied.
Message-ID: <20000620112548.A15890@quark.emich.edu>

Greetings,

I tried to download v2.4 just now, and I get a 'permission denied' error.
Could you have a look into this issue?

Thanks!

Regards,
J
-- 
|| visit gfd <http://quark.emich.edu/>
|| psa member -- <http://www.python.org/psa/> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 232 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20000620/a1382baa/attachment-0002.bin
From jam at quark.emich.edu  Tue Jun 20 11:36:39 2000
From: jam at quark.emich.edu (Jeff)
Date: Fri Jan  9 21:58:32 2004
Subject: [mod_python] attempting to download 2.4 -- permission denied.
In-Reply-To: <20000620112548.A15890@quark.emich.edu>; from jam@quark.emich.edu on Tue, Jun 20, 2000 at 11:25:48AM -0400
References: <20000620112548.A15890@quark.emich.edu>
Message-ID: <20000620113639.B15890@quark.emich.edu>

On Tue, Jun 20, 2000 at 11:25:48AM -0400, Jeff wrote:
> Greetings,
> 
> I tried to download v2.4 just now, and I get a 'permission denied' error.
> Could you have a look into this issue?
> 
> Thanks!
> 


it's fixed now, carry on ;)

-- 
|| visit gfd <http://quark.emich.edu/>
|| psa member -- <http://www.python.org/psa/> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 232 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20000620/e0661a03/attachment-0002.bin
From xbouska at infima.cz  Tue Jun 20 18:23:24 2000
From: xbouska at infima.cz (Richard Bouska)
Date: Fri Jan  9 21:58:32 2004
Subject: [mod_python] mod_python does not interoperate with CORBA (omniORB)
Message-ID: <20000620182324.E26145@intranet>

Hello

I am trying to convert one of my project from single threaded corba
server (ILU from PARC XEROX) to multithreaded (omniORB 3.0 FROM at&t). 
But I am unable to use the mod_python due some problems with threads.

The script runs fine as a CGI but when I try use mod_python it stucks in 

corba_init call. It freeses before it transfers any byte through the 
iiop protocol.

When I let the apache live in only one thread - apache -X then 
everything 
workes well.

Has anoybody some idea what I shell try?

configuration:

Linux 2.2.12 - debian potato 
mod_python 2.2 (2.4) - I try both - dynamicaly linked  
omniORB 3.0 - beta from CVS
apache 1.3.12


PS: I was using the PyApache and leave it because I thaught that the 
problem 
with omniORB is caused by  some problem in it - but now I dot know 
because both
mod_python and PyApache have the same problem.

Thank You in advance

Richard Bouska
Richard@Bouska.cz


From Howard.Williams at marchFIRST.com  Tue Jun 20 15:46:53 2000
From: Howard.Williams at marchFIRST.com (Howard Williams)
Date: Fri Jan  9 21:58:32 2004
Subject: [mod_python] (no subject)
Message-ID: <002701bfdb09$6e69cf80$1d0eaad1@edalearning.com>

Hi

I've just installed the mod_python using all the latest source code for
apache, python, and from the modpython.org site.

I can't seem to run the tester:

My directories are laid out as follows:

/usr/local/lib/python1.5/site-packages/mod_python/apache.py
/usr/local/lib/python1.5/site-packages/mod_python/
/usr/local/lib/python1.5/site-packages/mod_python/
/usr/local/lib/python1.5/site-packages/mod_python/
/usr/local/lib/python1.5/site-packages/mod_python/


ERROR mod_python: "PythonHandler test"

Traceback (innermost last):

  File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line
96, in Dispatch
    object = self.resolve_object(module, object_str)

  File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line
42, in resolve_object
    obj = getattr(obj, obj_str)

AttributeError: handler


HOWARD WILLIAMS
marchFIRST
23422 Mill Creek Drive., Suite 100
Laguna Hills, CA 92653
ph: (949) 461-5480
fax: (949) 461-5669
howard.williams@marchFIRST.com
www.marchFIRST.com


-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20000620/a50b964a/attachment-0002.htm
From Howard.Williams at marchFIRST.com  Tue Jun 20 16:00:26 2000
From: Howard.Williams at marchFIRST.com (Howard Williams)
Date: Fri Jan  9 21:58:32 2004
Subject: [mod_python] test doesn't work
Message-ID: <003d01bfdb0b$52f1e150$1d0eaad1@edalearning.com>

Hi

I've just installed the mod_python using all the latest source code for
apache, python, and from the modpython.org site.

I can't seem to run the tester:  So I've seen some postings from last month
about this with a similar "AttributeError: handler" title, but they didn't
seem to apply.

When I run "python test.py" (which I'm not convinced is supposed to be
possible) from a command line, I get the following output to stderr:
***********************************************************
Traceback (innermost last):
  File "test.py", line 1, in ?
    from mod_python import apache
  File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line
18, in ?
    import _apache
ImportError: No module named _apache

***********************************************************


My directories are laid out as follows:

/usr/local/lib/python1.5/site-packages/mod_python/apache.py
/usr/local/lib/python1.5/site-packages/mod_python/apache.pyc
/usr/local/lib/python1.5/site-packages/mod_python/cgihandler.py
/usr/local/lib/python1.5/site-packages/mod_python/cgihandler.pyc
/usr/local/lib/python1.5/site-packages/mod_python/httpdapi.py
/usr/local/lib/python1.5/site-packages/mod_python/httpdapi.pyc
/usr/local/lib/python1.5/site-packages/mod_python/zhandler.py
/usr/local/lib/python1.5/site-packages/mod_python/zhandler.pyc


I get this error:
*********************************
ERROR mod_python: "PythonHandler test"

Traceback (innermost last):

  File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line
96, in Dispatch
    object = self.resolve_object(module, object_str)

  File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line
42, in resolve_object
    obj = getattr(obj, obj_str)

AttributeError: handler
************************************************


Here's the apache error_log:
************************************************
[Tue Jun 20 15:47:37 2000] [notice] Apache/1.3.12 (Unix) configured --
resuming normal operations
[Tue Jun 20 15:47:46 2000] [error] PythonHandler test: Traceback (innermost
last):
[Tue Jun 20 15:47:46 2000] [error] PythonHandler test:   File
"/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 96, in
Dispatch
    object = self.resolve_object(module, object_str)
[Tue Jun 20 15:47:46 2000] [error] PythonHandler test:   File
"/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 42, in
resolve_object
    obj = getattr(obj, obj_str)
[Tue Jun 20 15:47:46 2000] [error] PythonHandler test: AttributeError:
handler
************************************************



 Thanks for any help you can provide !!!!   :)


HOWARD WILLIAMS
marchFIRST
23422 Mill Creek Drive., Suite 100
Laguna Hills, CA 92653
ph: (949) 461-5480
fax: (949) 461-5669
howard.williams@marchFIRST.com
www.marchFIRST.com

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20000620/0305da7e/attachment-0002.htm
From grisha at ispol.com  Tue Jun 20 21:41:20 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:32 2004
Subject: [mod_python] test doesn't work
In-Reply-To: <003d01bfdb0b$52f1e150$1d0eaad1@edalearning.com>
Message-ID: <Pine.LNX.4.21.0006202138080.28773-100000@saturn.ispol.com>

There is a module _apache which is only available from within
mod_python. However, if you comment out the 

from mod_python import apache

line, you should be able to import it from the command line.

I'm a little puzzled by this error, since everyone who has experienced it
never gave any logical reason as to what they did to fix this. It seems to
go away magically after they mes around for a while.

I am almost certain that this is caused by

1. a syntax error in test.py
2. a permissions problem

Grisha

On Tue, 20 Jun 2000, Howard Williams wrote:

> Hi
> 
> I've just installed the mod_python using all the latest source code for
> apache, python, and from the modpython.org site.
> 
> I can't seem to run the tester:  So I've seen some postings from last month
> about this with a similar "AttributeError: handler" title, but they didn't
> seem to apply.
> 
> When I run "python test.py" (which I'm not convinced is supposed to be
> possible) from a command line, I get the following output to stderr:
> ***********************************************************
> Traceback (innermost last):
>   File "test.py", line 1, in ?
>     from mod_python import apache
>   File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line
> 18, in ?
>     import _apache
> ImportError: No module named _apache
> 
> ***********************************************************
> 
> 
> My directories are laid out as follows:
> 
> /usr/local/lib/python1.5/site-packages/mod_python/apache.py
> /usr/local/lib/python1.5/site-packages/mod_python/apache.pyc
> /usr/local/lib/python1.5/site-packages/mod_python/cgihandler.py
> /usr/local/lib/python1.5/site-packages/mod_python/cgihandler.pyc
> /usr/local/lib/python1.5/site-packages/mod_python/httpdapi.py
> /usr/local/lib/python1.5/site-packages/mod_python/httpdapi.pyc
> /usr/local/lib/python1.5/site-packages/mod_python/zhandler.py
> /usr/local/lib/python1.5/site-packages/mod_python/zhandler.pyc
> 
> 
> I get this error:
> *********************************
> ERROR mod_python: "PythonHandler test"
> 
> Traceback (innermost last):
> 
>   File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line
> 96, in Dispatch
>     object = self.resolve_object(module, object_str)
> 
>   File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line
> 42, in resolve_object
>     obj = getattr(obj, obj_str)
> 
> AttributeError: handler
> ************************************************
> 
> 
> Here's the apache error_log:
> ************************************************
> [Tue Jun 20 15:47:37 2000] [notice] Apache/1.3.12 (Unix) configured --
> resuming normal operations
> [Tue Jun 20 15:47:46 2000] [error] PythonHandler test: Traceback (innermost
> last):
> [Tue Jun 20 15:47:46 2000] [error] PythonHandler test:   File
> "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 96, in
> Dispatch
>     object = self.resolve_object(module, object_str)
> [Tue Jun 20 15:47:46 2000] [error] PythonHandler test:   File
> "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 42, in
> resolve_object
>     obj = getattr(obj, obj_str)
> [Tue Jun 20 15:47:46 2000] [error] PythonHandler test: AttributeError:
> handler
> ************************************************
> 
> 
> 
>  Thanks for any help you can provide !!!!   :)
> 
> 
> HOWARD WILLIAMS
> marchFIRST
> 23422 Mill Creek Drive., Suite 100
> Laguna Hills, CA 92653
> ph: (949) 461-5480
> fax: (949) 461-5669
> howard.williams@marchFIRST.com
> www.marchFIRST.com
> 
> 


From grisha at ispol.com  Tue Jun 20 22:00:16 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:32 2004
Subject: [mod_python] test doesn't work
In-Reply-To: <Pine.LNX.4.21.0006202138080.28773-100000@saturn.ispol.com>
Message-ID: <Pine.LNX.4.21.0006202157290.28833-100000@saturn.ispol.com>

On Tue, 20 Jun 2000, Gregory Trubetskoy wrote:

> I am almost certain that this is caused by
> 
> 1. a syntax error in test.py
> 2. a permissions problem

OR

3. If the PythonHandler directive is in httpd.conf outside any <Directory>
tags, or if PythonHandler is inside a <Directory> different from that in
which test.py is, then /usr/local/lib/python1.5/test/ gets imported
instead, which, of course, doesn't have a function called "handler".

HTH

Grisha


From miguel at yorku.ca  Wed Jun 21 12:10:31 2000
From: miguel at yorku.ca (Miguel Marques)
Date: Fri Jan  9 21:58:32 2004
Subject: [mod_python] test doesn't work
In-Reply-To: <Pine.LNX.4.21.0006202157290.28833-100000@saturn.ispol.com>
References: <Pine.LNX.4.21.0006202138080.28773-100000@saturn.ispol.com>
	<Pine.LNX.4.21.0006202157290.28833-100000@saturn.ispol.com>
Message-ID: <20000621121031L.miguel@yorku.ca>

On Tue, 20 Jun 2000 22:00:16 -0400 (EDT), Gregory Trubetskoy <grisha@ispol.com> wrote:
> 
> On Tue, 20 Jun 2000, Gregory Trubetskoy wrote:
> 
> > I am almost certain that this is caused by
> > 
> > 1. a syntax error in test.py
> > 2. a permissions problem
> 
> OR
> 
> 3. If the PythonHandler directive is in httpd.conf outside any <Directory>
> tags, or if PythonHandler is inside a <Directory> different from that in
> which test.py is, then /usr/local/lib/python1.5/test/ gets imported
> instead, which, of course, doesn't have a function called "handler".
> 
> HTH
> 
> Grisha
> 
Well, I have the same problem.  I've tried everything I can think of.
This also happened with mod_python/2.2.
My setup is 
SunOS 5.7 Apache/1.3.12 (Unix) ApacheJServ/1.1 mod_perl/1.24 mod_python/2.4 Python/1.5.2

1. I can run test.py with python as apache (my server run under username apache)
2. I think 1. rules it out and I've checked the permissions of the all
   the python files.
3. my directive is 

<Directory "/usr/local/apache/htdocs/test">
    AddHandler python-program .py
    PythonHandler test
    PythonDebug on
</Directory>
and test.py is in /usr/local/apache/htdocs/test

I always get:

ERROR mod_python: "PythonHandler test"

Traceback (innermost last):

  File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 96, in Dispatch
    object = self.resolve_object(module, object_str)

  File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 42, in resolve_object
    obj = getattr(obj, obj_str)

AttributeError: handler

being somewhat new to python I'm unsure on how to proceed to figure
this out.
Any suggestions?
TIA...

							Miguel

C. Miguel Marques, York University, Computing & Communications Services
e-mail: miguel@yorku.ca, voice: (416)736-2100x22684, fax: (416)736-5830

From miguel at yorku.ca  Wed Jun 21 12:27:47 2000
From: miguel at yorku.ca (Miguel Marques)
Date: Fri Jan  9 21:58:32 2004
Subject: [mod_python] test doesn't work (solved?)
In-Reply-To: <20000621121031L.miguel@yorku.ca>
References: <Pine.LNX.4.21.0006202138080.28773-100000@saturn.ispol.com>
	<Pine.LNX.4.21.0006202157290.28833-100000@saturn.ispol.com>
	<20000621121031L.miguel@yorku.ca>
Message-ID: <20000621122747A.miguel@yorku.ca>

On Wed, 21 Jun 2000 12:10:31 -0400, Miguel Marques <miguel@yorku.ca> wrote:
> On Tue, 20 Jun 2000 22:00:16 -0400 (EDT), Gregory Trubetskoy <grisha@ispol.com> wrote:
> > 
> > On Tue, 20 Jun 2000, Gregory Trubetskoy wrote:
> > 
> > > I am almost certain that this is caused by
> > > 
> > > 1. a syntax error in test.py
> > > 2. a permissions problem
> > 
> > OR
> > 
> > 3. If the PythonHandler directive is in httpd.conf outside any <Directory>
> > tags, or if PythonHandler is inside a <Directory> different from that in
> > which test.py is, then /usr/local/lib/python1.5/test/ gets imported
> > instead, which, of course, doesn't have a function called "handler".
> > 
> > HTH
> > 
> > Grisha
> > 
> Well, I have the same problem.  I've tried everything I can think of.
> This also happened with mod_python/2.2.
> My setup is 
> SunOS 5.7 Apache/1.3.12 (Unix) ApacheJServ/1.1 mod_perl/1.24 mod_python/2.4 Python/1.5.2
> 
> 1. I can run test.py with python as apache (my server run under username apache)
> 2. I think 1. rules it out and I've checked the permissions of the all
>    the python files.
> 3. my directive is 
> 
> <Directory "/usr/local/apache/htdocs/test">
>     AddHandler python-program .py
>     PythonHandler test
>     PythonDebug on
> </Directory>

If I add a slash to the end of the directory in the Directory directive it works.
<Directory "/usr/local/apache/htdocs/test/">
    AddHandler python-program .py
    PythonHandler test
    PythonDebug on
</Directory>

I couldn't get a Location directive to work either way, though.
Is there a reason for this which I don't understand?
Thanks.

						  Miguel

C. Miguel Marques, York University, Computing & Communications Services
e-mail: miguel@yorku.ca, voice: (416)736-2100x22684, fax: (416)736-5830





From Howard.Williams at marchFIRST.com  Wed Jun 21 12:24:20 2000
From: Howard.Williams at marchFIRST.com (Howard Williams)
Date: Fri Jan  9 21:58:32 2004
Subject: [mod_python] test doesn't work (solved?)
In-Reply-To: <20000621122747A.miguel@yorku.ca>
Message-ID: <000001bfdbb6$4d3764f0$1d0eaad1@edalearning.com>

Yup !!!!  Adding the / at the end of the <Directory ...> statement did the
trick in httpd.conf

Thanks a bunch

HOWARD WILLIAMS
marchFIRST
23422 Mill Creek Drive., Suite 100
Laguna Hills, CA 92653
ph: (949) 461-5480
fax: (949) 461-5669
howard.williams@marchFIRST.com <mailto:howard.williams@marchFIRST.com>
www.marchFIRST.com



-----Original Message-----
From: Miguel Marques [mailto:miguel@yorku.ca]
Sent: Wednesday, June 21, 2000 9:28 AM
To: mod_python@modpython.org
Subject: Re: [mod_python] test doesn't work (solved?)


On Wed, 21 Jun 2000 12:10:31 -0400, Miguel Marques <miguel@yorku.ca> wrote:
> On Tue, 20 Jun 2000 22:00:16 -0400 (EDT), Gregory Trubetskoy
<grisha@ispol.com> wrote:
> >
> > On Tue, 20 Jun 2000, Gregory Trubetskoy wrote:
> >
> > > I am almost certain that this is caused by
> > >
> > > 1. a syntax error in test.py
> > > 2. a permissions problem
> >
> > OR
> >
> > 3. If the PythonHandler directive is in httpd.conf outside any
<Directory>
> > tags, or if PythonHandler is inside a <Directory> different from that in
> > which test.py is, then /usr/local/lib/python1.5/test/ gets imported
> > instead, which, of course, doesn't have a function called "handler".
> >
> > HTH
> >
> > Grisha
> >
> Well, I have the same problem.  I've tried everything I can think of.
> This also happened with mod_python/2.2.
> My setup is
> SunOS 5.7 Apache/1.3.12 (Unix) ApacheJServ/1.1 mod_perl/1.24
mod_python/2.4 Python/1.5.2
>
> 1. I can run test.py with python as apache (my server run under username
apache)
> 2. I think 1. rules it out and I've checked the permissions of the all
>    the python files.
> 3. my directive is
>
> <Directory "/usr/local/apache/htdocs/test">
>     AddHandler python-program .py
>     PythonHandler test
>     PythonDebug on
> </Directory>

If I add a slash to the end of the directory in the Directory directive it
works.
<Directory "/usr/local/apache/htdocs/test/">
    AddHandler python-program .py
    PythonHandler test
    PythonDebug on
</Directory>

I couldn't get a Location directive to work either way, though.
Is there a reason for this which I don't understand?
Thanks.

						  Miguel

C. Miguel Marques, York University, Computing & Communications Services
e-mail: miguel@yorku.ca, voice: (416)736-2100x22684, fax: (416)736-5830




_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python


From grisha at ispol.com  Wed Jun 21 18:00:25 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:32 2004
Subject: [mod_python] test doesn't work
In-Reply-To: <20000621121031L.miguel@yorku.ca>
Message-ID: <Pine.LNX.4.21.0006211759290.32339-100000@saturn.ispol.com>

How about when you rename test.py to mptest.py and change the
PythonHandler directive accordingly?

Grisha

On Wed, 21 Jun 2000, Miguel Marques wrote:

> On Tue, 20 Jun 2000 22:00:16 -0400 (EDT), Gregory Trubetskoy <grisha@ispol.com> wrote:
> > 
> > On Tue, 20 Jun 2000, Gregory Trubetskoy wrote:
> > 
> > > I am almost certain that this is caused by
> > > 
> > > 1. a syntax error in test.py
> > > 2. a permissions problem
> > 
> > OR
> > 
> > 3. If the PythonHandler directive is in httpd.conf outside any <Directory>
> > tags, or if PythonHandler is inside a <Directory> different from that in
> > which test.py is, then /usr/local/lib/python1.5/test/ gets imported
> > instead, which, of course, doesn't have a function called "handler".
> > 
> > HTH
> > 
> > Grisha
> > 
> Well, I have the same problem.  I've tried everything I can think of.
> This also happened with mod_python/2.2.
> My setup is 
> SunOS 5.7 Apache/1.3.12 (Unix) ApacheJServ/1.1 mod_perl/1.24 mod_python/2.4 Python/1.5.2
> 
> 1. I can run test.py with python as apache (my server run under username apache)
> 2. I think 1. rules it out and I've checked the permissions of the all
>    the python files.
> 3. my directive is 
> 
> <Directory "/usr/local/apache/htdocs/test">
>     AddHandler python-program .py
>     PythonHandler test
>     PythonDebug on
> </Directory>
> and test.py is in /usr/local/apache/htdocs/test
> 
> I always get:
> 
> ERROR mod_python: "PythonHandler test"
> 
> Traceback (innermost last):
> 
>   File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 96, in Dispatch
>     object = self.resolve_object(module, object_str)
> 
>   File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 42, in resolve_object
>     obj = getattr(obj, obj_str)
> 
> AttributeError: handler
> 
> being somewhat new to python I'm unsure on how to proceed to figure
> this out.
> Any suggestions?
> TIA...
> 
> 							Miguel
> 
> C. Miguel Marques, York University, Computing & Communications Services
> e-mail: miguel@yorku.ca, voice: (416)736-2100x22684, fax: (416)736-5830
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From grisha at ispol.com  Wed Jun 21 18:03:00 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:33 2004
Subject: [mod_python] test doesn't work (solved?)
In-Reply-To: <000001bfdbb6$4d3764f0$1d0eaad1@edalearning.com>
Message-ID: <Pine.LNX.4.21.0006211802230.32339-100000@saturn.ispol.com>

This may actually be a bug after all....

Grisha

On Wed, 21 Jun 2000, Howard Williams wrote:

> Yup !!!!  Adding the / at the end of the <Directory ...> statement did the
> trick in httpd.conf
> 
> Thanks a bunch
> 
> HOWARD WILLIAMS
> marchFIRST
> 23422 Mill Creek Drive., Suite 100
> Laguna Hills, CA 92653
> ph: (949) 461-5480
> fax: (949) 461-5669
> howard.williams@marchFIRST.com <mailto:howard.williams@marchFIRST.com>
> www.marchFIRST.com
> 
> 
> 
> -----Original Message-----
> From: Miguel Marques [mailto:miguel@yorku.ca]
> Sent: Wednesday, June 21, 2000 9:28 AM
> To: mod_python@modpython.org
> Subject: Re: [mod_python] test doesn't work (solved?)
> 
> 
> On Wed, 21 Jun 2000 12:10:31 -0400, Miguel Marques <miguel@yorku.ca> wrote:
> > On Tue, 20 Jun 2000 22:00:16 -0400 (EDT), Gregory Trubetskoy
> <grisha@ispol.com> wrote:
> > >
> > > On Tue, 20 Jun 2000, Gregory Trubetskoy wrote:
> > >
> > > > I am almost certain that this is caused by
> > > >
> > > > 1. a syntax error in test.py
> > > > 2. a permissions problem
> > >
> > > OR
> > >
> > > 3. If the PythonHandler directive is in httpd.conf outside any
> <Directory>
> > > tags, or if PythonHandler is inside a <Directory> different from that in
> > > which test.py is, then /usr/local/lib/python1.5/test/ gets imported
> > > instead, which, of course, doesn't have a function called "handler".
> > >
> > > HTH
> > >
> > > Grisha
> > >
> > Well, I have the same problem.  I've tried everything I can think of.
> > This also happened with mod_python/2.2.
> > My setup is
> > SunOS 5.7 Apache/1.3.12 (Unix) ApacheJServ/1.1 mod_perl/1.24
> mod_python/2.4 Python/1.5.2
> >
> > 1. I can run test.py with python as apache (my server run under username
> apache)
> > 2. I think 1. rules it out and I've checked the permissions of the all
> >    the python files.
> > 3. my directive is
> >
> > <Directory "/usr/local/apache/htdocs/test">
> >     AddHandler python-program .py
> >     PythonHandler test
> >     PythonDebug on
> > </Directory>
> 
> If I add a slash to the end of the directory in the Directory directive it
> works.
> <Directory "/usr/local/apache/htdocs/test/">
>     AddHandler python-program .py
>     PythonHandler test
>     PythonDebug on
> </Directory>
> 
> I couldn't get a Location directive to work either way, though.
> Is there a reason for this which I don't understand?
> Thanks.
> 
> 						  Miguel
> 
> C. Miguel Marques, York University, Computing & Communications Services
> e-mail: miguel@yorku.ca, voice: (416)736-2100x22684, fax: (416)736-5830
> 
> 
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From Howard.Williams at marchFIRST.com  Wed Jun 21 15:23:23 2000
From: Howard.Williams at marchFIRST.com (Howard Williams)
Date: Fri Jan  9 21:58:33 2004
Subject: [mod_python] test doesn't work
In-Reply-To: <Pine.LNX.4.21.0006211759290.32339-100000@saturn.ispol.com>
Message-ID: <001001bfdbcf$507b6300$1d0eaad1@edalearning.com>

no problem there

HOWARD WILLIAMS
marchFIRST
23422 Mill Creek Drive., Suite 100
Laguna Hills, CA 92653
ph: (949) 461-5480
fax: (949) 461-5669
howard.williams@marchFIRST.com <mailto:howard.williams@marchFIRST.com>
www.marchFIRST.com



-----Original Message-----
From: Gregory Trubetskoy [mailto:grisha@ispol.com]
Sent: Wednesday, June 21, 2000 3:00 PM
To: Miguel Marques
Cc: mod_python@modpython.org
Subject: Re: [mod_python] test doesn't work



How about when you rename test.py to mptest.py and change the
PythonHandler directive accordingly?

Grisha

On Wed, 21 Jun 2000, Miguel Marques wrote:

> On Tue, 20 Jun 2000 22:00:16 -0400 (EDT), Gregory Trubetskoy
<grisha@ispol.com> wrote:
> >
> > On Tue, 20 Jun 2000, Gregory Trubetskoy wrote:
> >
> > > I am almost certain that this is caused by
> > >
> > > 1. a syntax error in test.py
> > > 2. a permissions problem
> >
> > OR
> >
> > 3. If the PythonHandler directive is in httpd.conf outside any
<Directory>
> > tags, or if PythonHandler is inside a <Directory> different from that in
> > which test.py is, then /usr/local/lib/python1.5/test/ gets imported
> > instead, which, of course, doesn't have a function called "handler".
> >
> > HTH
> >
> > Grisha
> >
> Well, I have the same problem.  I've tried everything I can think of.
> This also happened with mod_python/2.2.
> My setup is
> SunOS 5.7 Apache/1.3.12 (Unix) ApacheJServ/1.1 mod_perl/1.24
mod_python/2.4 Python/1.5.2
>
> 1. I can run test.py with python as apache (my server run under username
apache)
> 2. I think 1. rules it out and I've checked the permissions of the all
>    the python files.
> 3. my directive is
>
> <Directory "/usr/local/apache/htdocs/test">
>     AddHandler python-program .py
>     PythonHandler test
>     PythonDebug on
> </Directory>
> and test.py is in /usr/local/apache/htdocs/test
>
> I always get:
>
> ERROR mod_python: "PythonHandler test"
>
> Traceback (innermost last):
>
>   File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line
96, in Dispatch
>     object = self.resolve_object(module, object_str)
>
>   File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line
42, in resolve_object
>     obj = getattr(obj, obj_str)
>
> AttributeError: handler
>
> being somewhat new to python I'm unsure on how to proceed to figure
> this out.
> Any suggestions?
> TIA...
>
> 							Miguel
>
> C. Miguel Marques, York University, Computing & Communications Services
> e-mail: miguel@yorku.ca, voice: (416)736-2100x22684, fax: (416)736-5830
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python


From grisha at ispol.com  Wed Jun 21 21:33:41 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:33 2004
Subject: [mod_python] test doesn't work (solved?)
In-Reply-To: <20000621122747A.miguel@yorku.ca>
Message-ID: <Pine.LNX.4.21.0006212131300.498-100000@saturn.ispol.com>

On Wed, 21 Jun 2000, Miguel Marques wrote:

> If I add a slash to the end of the directory in the Directory directive it works.
> <Directory "/usr/local/apache/htdocs/test/">

OK, it is actually a bug.

line 108 of mod_python.c, which reads

#define SLASH_S "\\"

should read

#define SLASH_S "/"

If you edit this and recompile, the problem will go away.

Grisha


From miguel at yorku.ca  Thu Jun 22 11:23:01 2000
From: miguel at yorku.ca (Miguel Marques)
Date: Fri Jan  9 21:58:33 2004
Subject: [mod_python] test doesn't work (solved?)
In-Reply-To: <Pine.LNX.4.21.0006212131300.498-100000@saturn.ispol.com>
References: <20000621122747A.miguel@yorku.ca>
	<Pine.LNX.4.21.0006212131300.498-100000@saturn.ispol.com>
Message-ID: <20000622112301P.miguel@yorku.ca>

On Wed, 21 Jun 2000 21:33:41 -0400 (EDT), Gregory Trubetskoy <grisha@ispol.com> wrote:
> 
> On Wed, 21 Jun 2000, Miguel Marques wrote:
> 
> > If I add a slash to the end of the directory in the Directory directive it works.
> > <Directory "/usr/local/apache/htdocs/test/">
> 
> OK, it is actually a bug.
> 
> line 108 of mod_python.c, which reads
> 
> #define SLASH_S "\\"
> 
> should read
> 
> #define SLASH_S "/"
> 
> If you edit this and recompile, the problem will go away.
> 
It does indeed go away. 
Thanks!!!
But note that when using a Location directive it still does not work.
e.g.
<Location "/test">
    AddHandler python-program .py
    PythonHandler test
    PythonDebug on
</Location>

Is this intentional?

							Miguel

C. Miguel Marques, York University, Computing & Communications Services
e-mail: miguel@yorku.ca, voice: (416)736-2100x22684, fax: (416)736-5830

From daniel at copyleft.no  Thu Jun 22 17:36:34 2000
From: daniel at copyleft.no (Hr. Daniel Mikkelsen)
Date: Fri Jan  9 21:58:33 2004
Subject: [mod_python] req.connection.user
Message-ID: <Pine.LNX.4.10.10006221730110.15525-100000@unity.copyleft.no>

Hi.

I'm trying to set up authentication based on the example given in the
tutorial. Everything seems to work, except that i get Null instead of
the username for req.connection.user.

So that if I just test for password with req.get_basic_auth_pw() and not
for user, I get "through" the basic authentication.

The source I'm using is taken straight from the tutorial. 

Any ideas? I'm using the preinstalled apache 1.3.9 on OpenBSD 2.6, with
mod_python as a DSO. I've tried both versions 2.2 and 2.4. 

-- Daniel Mikkelsen, Copyleft Software


From grisha at ispol.com  Fri Jun 23 18:31:54 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:33 2004
Subject: [mod_python] test doesn't work (solved?)
In-Reply-To: <20000622112301P.miguel@yorku.ca>
Message-ID: <Pine.LNX.4.21.0006231821170.7430-100000@saturn.ispol.com>

On Thu, 22 Jun 2000, Miguel Marques wrote:

> But note that when using a Location directive it still does not work.
> e.g.
> <Location "/test">
>     AddHandler python-program .py
>     PythonHandler test
>     PythonDebug on
> </Location>
> 
> Is this intentional?

I don't know if "intentional" is the right word, but it _is_ expected
behaviour.

mod_python prepends the directory to pythonpath, as outlined here:
http://www.modpython.org/live/mod_python-2.4/doc/pythonapi.html#handler

The <Location> directive puts whatever is specified as the argument to it
as the "directory", and mod_python ends up prependind it. But since
"/test" is not a real directory, it doesn't do you any good. I don't think
there is a simple way to find out what the real directory is from
<Location>. If you read the Apache documentation for it, it puts the
emphasis on the fact that <Location> is not in any way linked to the
filesystem.

Grisha


From hunter at userfriendly.net  Fri Jun 23 22:40:41 2000
From: hunter at userfriendly.net (hUnTeR)
Date: Fri Jan  9 21:58:33 2004
Subject: [mod_python] DSO compile
Message-ID: <39541FA9.D23BAB1A@userfriendly.net>

Dear list readers - 

I am currently trying to build the mod_python as a DSO for
apache-1.3.12. I have already compiled as DSO mod_perl, mod_ssl, etc but
i desparately need this module. I would even settle for a static compile
to get this to work (trying to replace our company's current method of
Netscape Enterprise Server with python). I get the following error when
trying to make:

===> src/modules/extra
gcc -c -I/usr/include/python1.5 -I../../os/unix -I../../include  
-DLINUX=2 -DUo
In file included from mod_python.c:89:
/usr/include/python1.5/Python.h:39: config.h: No such file or directory
In file included from /usr/include/python1.5/modsupport.h:52,
                 from /usr/include/python1.5/Python.h:101,
                 from mod_python.c:89:
/usr/lib/gcc-lib/i386-redhat-linux/egcs-2.91.66/include/varargs.h:106:
warning:d
/usr/lib/gcc-lib/i386-redhat-linux/egcs-2.91.66/include/stdarg.h:90:
warning: tn
make[4]: *** [mod_python.so] Error 1
make[3]: *** [all] Error 1
make[2]: *** [subdirs] Error 1
make[2]: Leaving directory `/root/temp/apache_1.3.12/src'
make[1]: *** [build-std] Error 2
make[1]: Leaving directory `/root/temp/apache_1.3.12'
make: *** [build] Error 2

Any ideas? I have even recently rebuilt python to include the ctsybase
and thread modules, but this one is giving me a headache.

Any help would be appreciated.

Regards
-- 
Michael B. Weiner
Systems Administrator/Partner
The UserFriendly Network (UFN)
--

             / /  (_)__  __ ____  __
            / /__/ / _ \/ // /\ \/ /  
           /____/_/_//_/\_,_/ /_/\_\ 

     * * * CHOICE OF A GNU GENERATION * * *

From grisha at ispol.com  Sat Jun 24 10:00:09 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:33 2004
Subject: [mod_python] DSO compile
In-Reply-To: <39541FA9.D23BAB1A@userfriendly.net>
Message-ID: <Pine.LNX.4.21.0006240958150.10701-100000@saturn.ispol.com>

it's saying it's missing config.h.

did you run "make install" after compiling Python?

Grisha

On Fri, 23 Jun 2000, hUnTeR wrote:

> Dear list readers - 
> 
> I am currently trying to build the mod_python as a DSO for
> apache-1.3.12. I have already compiled as DSO mod_perl, mod_ssl, etc but
> i desparately need this module. I would even settle for a static compile
> to get this to work (trying to replace our company's current method of
> Netscape Enterprise Server with python). I get the following error when
> trying to make:
> 
> ===> src/modules/extra
> gcc -c -I/usr/include/python1.5 -I../../os/unix -I../../include  
> -DLINUX=2 -DUo
> In file included from mod_python.c:89:
> /usr/include/python1.5/Python.h:39: config.h: No such file or directory
> In file included from /usr/include/python1.5/modsupport.h:52,
>                  from /usr/include/python1.5/Python.h:101,
>                  from mod_python.c:89:
> /usr/lib/gcc-lib/i386-redhat-linux/egcs-2.91.66/include/varargs.h:106:
> warning:d
> /usr/lib/gcc-lib/i386-redhat-linux/egcs-2.91.66/include/stdarg.h:90:
> warning: tn
> make[4]: *** [mod_python.so] Error 1
> make[3]: *** [all] Error 1
> make[2]: *** [subdirs] Error 1
> make[2]: Leaving directory `/root/temp/apache_1.3.12/src'
> make[1]: *** [build-std] Error 2
> make[1]: Leaving directory `/root/temp/apache_1.3.12'
> make: *** [build] Error 2
> 
> Any ideas? I have even recently rebuilt python to include the ctsybase
> and thread modules, but this one is giving me a headache.
> 
> Any help would be appreciated.
> 
> Regards
> -- 
> Michael B. Weiner
> Systems Administrator/Partner
> The UserFriendly Network (UFN)
> --
> 
>              / /  (_)__  __ ____  __
>             / /__/ / _ \/ // /\ \/ /  
>            /____/_/_//_/\_,_/ /_/\_\ 
> 
>      * * * CHOICE OF A GNU GENERATION * * *
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From hunter at userfriendly.net  Sat Jun 24 11:32:47 2000
From: hunter at userfriendly.net (hUnTeR)
Date: Fri Jan  9 21:58:33 2004
Subject: [mod_python] DSO compile
Message-ID: <3954D49F.199ECBCC@userfriendly.net>

Dear list readers - 

OK, i got around the previously emailed problem and was able to
successfully build a DSO mod_python module. However, when i go to
restart apache, i now receive the following error:

Starting httpd: Syntax error on line 250 of /etc/httpd/conf/httpd.conf:
Cannot load /etc/httpd/modules/mod_python.so into server:
/etc/httpd/modules/mod_python.so: undefined symbol: ct_con_props


Any ideas? Any help would be appreciated.

Regards
-- 
Michael B. Weiner
Systems Administrator/Partner
The UserFriendly Network (UFN)
--

             / /  (_)__  __ ____  __
            / /__/ / _ \/ // /\ \/ /  
           /____/_/_//_/\_,_/ /_/\_\ 

     * * * CHOICE OF A GNU GENERATION * * *
_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python

From hunter at userfriendly.net  Sat Jun 24 12:22:18 2000
From: hunter at userfriendly.net (hUnTeR)
Date: Fri Jan  9 21:58:33 2004
Subject: [mod_python] DSO compile
Message-ID: <3954E03A.E2987217@userfriendly.net>

Dear list readers - 

OK, i got around the previously emailed problem - the ctsybase module
was giving me the errors on start up. So i had to rebuild python from
scratch again without the ctsybase module support. However now when i
rebuild mod_python and go to restart apache it doesnt startup and gives
me "httpd dead but subsys locked"


Any ideas? Any help would be appreciated.

Regards
-- 
Michael B. Weiner
Systems Administrator/Partner
The UserFriendly Network (UFN)
--

             / /  (_)__  __ ____  __
            / /__/ / _ \/ // /\ \/ /  
           /____/_/_//_/\_,_/ /_/\_\ 

     * * * CHOICE OF A GNU GENERATION * * *
_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python
_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python

From jam at quark.emich.edu  Sat Jun 24 13:01:18 2000
From: jam at quark.emich.edu (Jeff)
Date: Fri Jan  9 21:58:33 2004
Subject: [mod_python] DSO compile
In-Reply-To: <3954E03A.E2987217@userfriendly.net>; from hunter@userfriendly.net on Sat, Jun 24, 2000 at 12:22:18PM -0400
References: <3954E03A.E2987217@userfriendly.net>
Message-ID: <20000624130118.E30377@quark.emich.edu>

On Sat, Jun 24, 2000 at 12:22:18PM -0400, hUnTeR wrote:
> Dear list readers - 
> 
> OK, i got around the previously emailed problem - the ctsybase module
> was giving me the errors on start up. So i had to rebuild python from
> scratch again without the ctsybase module support. However now when i
> rebuild mod_python and go to restart apache it doesnt startup and gives
> me "httpd dead but subsys locked"
> 
> 
> Any ideas? Any help would be appreciated.

apache is core dumping. 

I had this problem with an older version of mod_python, and solved it by
putting the "AddModule" and "LoadModule" directives in specific locations in
the httpd.conf file.

I noticed, though, that the 2.4 version *does not* work with this solution.

as a start to the troubleshooting, could you post the specific parameters to
apxs that you used? it would also be useful to know the exact apache
configuration you have for comparison.

regards,
J
-- 
|| visit gfd <http://quark.emich.edu/>
|| psa member -- <http://www.python.org/psa/> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 232 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20000624/d5940662/attachment-0002.bin
From richard at whitequeen.com  Fri Jun 23 19:11:10 2000
From: richard at whitequeen.com (richard offer)
Date: Fri Jan  9 21:58:33 2004
Subject: [mod_python] RFE: expose File descriptor in API
Message-ID: <200006240211.e5O2BAm23684@erij.whitequeen.com>

Hi,

Is is possible to expose the FD that req.write() is using to the API
? Is this worth it ?

I'm in the process of switching from HTMLgen to HyperText as my text
generator and that has a writeto() method that takes a FD as an argument.

Wont this allow for progressive loading ?

Just a thought.

richard.

-- 
richard offer @ home 
          84 FE 48 E4 74 D0 26 D4  31 8E B6 86 98 74 E2 7C  8A FB BF A3
___________________________________http://216.185.15.144/users/richard/

From grisha at ispol.com  Sat Jun 24 14:43:03 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:33 2004
Subject: [mod_python] RFE: expose File descriptor in API
In-Reply-To: <200006240211.e5O2BAm23684@erij.whitequeen.com>
Message-ID: <Pine.LNX.4.21.0006241438330.11343-100000@saturn.ispol.com>


On Fri, 23 Jun 2000, richard offer wrote:

> I'm in the process of switching from HTMLgen to HyperText as my text
> generator and that has a writeto() method that takes a FD as an argument.

I don't think there is such a thing as a file descriptor that one can
write to within apache. Also, writeto() would need to know how to handle
HTTP errors.

> Wont this allow for progressive loading ?

What's "progressive loading"?

Grisha


From dwallace at delanet.com  Sun Jun 25 08:41:23 2000
From: dwallace at delanet.com (Dave)
Date: Fri Jan  9 21:58:33 2004
Subject: [mod_python] test doesn't work (solved?)
Message-ID: <3955FDF3.DC59F96B@delanet.com>

I've been using the Location directive for a bit now, here is how it
looks for me:

<Location /wpy >
  SetHandler python-program
  PythonDebug On
  PythonPath "sys.path+['/devel/WEB/Webware/WebKit']"
  PythonHandler webkit_handler
</Location>

The key here is the undocumented feature of PythonPath that it
apparently evals its argument. I've been meaning to ask about this since
at some point this could get broken in development and I'd be up a
creek. This is certainly handy but what isn't nice is that I suppose
/something/wpy is also being appended to the PYTHONPATH wether I want or
not.  Maybe a directive to append paths to the default PYTHONPATH would
be in order?

BTW, the nice thing about using Location is the fact that for the
particular application I'm using there is only a single handler and all
content is delivered through that handler by the application. Having to
specify a Directory just doesn't seem quite right.

Dave.

On Fri, 23 Jun 2000, Gregory Trubetskoy wrote:

>On Thu, 22 Jun 2000, Miguel Marques wrote:

>> But note that when using a Location directive it still does not work.

>> e.g.
>> <Location "/test">
>>     AddHandler python-program .py
>>     PythonHandler test
>>     PythonDebug on
>> </Location>
>>
>> Is this intentional?

>I don't know if "intentional" is the right word, but it _is_ expected
>behaviour.

>mod_python prepends the directory to pythonpath, as outlined here:
>http://www.modpython.org/live/mod_python-2.4/doc/pythonapi.html#handler

>The <Location> directive puts whatever is specified as the argument to
it
>as the "directory", and mod_python ends up prependind it. But since
>"/test" is not a real directory, it doesn't do you any good. I don't
think
>there is a simple way to find out what the real directory is from
><Location>. If you read the Apache documentation for it, it puts the
>emphasis on the fact that <Location> is not in any way linked to the
>filesystem.



From grisha at ispol.com  Sun Jun 25 15:55:04 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:33 2004
Subject: [mod_python] test doesn't work (solved?)
In-Reply-To: <3955FDF3.DC59F96B@delanet.com>
Message-ID: <Pine.LNX.4.21.0006251540480.24945-100000@saturn.ispol.com>

On Sun, 25 Jun 2000, Dave wrote:

> I've been using the Location directive for a bit now, here is how it
> looks for me:
> 
> <Location /wpy >
>   SetHandler python-program
>   PythonDebug On
>   PythonPath "sys.path+['/devel/WEB/Webware/WebKit']"
>   PythonHandler webkit_handler
> </Location>
> 
> The key here is the undocumented feature of PythonPath that it
> apparently evals its argument. I've been meaning to ask about this since
> at some point this could get broken in development and I'd be up a
> creek. 

I don't think this is going away - there is no simpler way to specify the
pythonpath than in python syntax which implies evaling.

> This is certainly handy but what isn't nice is that I suppose
> /something/wpy is also being appended to the PYTHONPATH wether I want or
> not.  

Yes, it's "/wpy", actually. Unfortunately, there is no way to tell at the
time the directives are being processed whether it's <Location> or
<Directive>. One option may be not to intriduce another directive,
something like PythonDoNotModifyPath or something. 

> Maybe a directive to append paths to the default PYTHONPATH would
> be in order?

Originally, I considered something like using "+['/some/path']" to mean
append or "['/some/path']+" to prepend. There turned out to be some not so
obvious issues, such as the fact that with .htaccess, the directive gets
processed with every hit, so you would have to make sure to act on it only
once, the first time.

It _could_ be done, but it went against my principle to keep it simple, so
I decided to save for it later since I had more important features to
roll out.

> BTW, the nice thing about using Location is the fact that for the
> particular application I'm using there is only a single handler and all
> content is delivered through that handler by the application. Having to
> specify a Directory just doesn't seem quite right.

Not sure I understand this completely - could you elaborate a bit?

Grisha


From grisha at ispol.com  Sun Jun 25 16:51:58 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:33 2004
Subject: [mod_python] CVS
Message-ID: <Pine.LNX.4.21.0006251650370.25128-100000@saturn.ispol.com>

Someone was asking about CVS - 

You should be able to get CVS access from sourceforge. Go to 
http://sourceforge.net/projects/modpython for details.

Grisha



From gstein at lyra.org  Sun Jun 25 13:56:31 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:58:33 2004
Subject: [mod_python] test doesn't work (solved?)
In-Reply-To: <Pine.LNX.4.21.0006251540480.24945-100000@saturn.ispol.com>; from grisha@ispol.com on Sun, Jun 25, 2000 at 03:55:04PM -0400
References: <3955FDF3.DC59F96B@delanet.com> <Pine.LNX.4.21.0006251540480.24945-100000@saturn.ispol.com>
Message-ID: <20000625135631.F29590@lyra.org>

On Sun, Jun 25, 2000 at 03:55:04PM -0400, Gregory Trubetskoy wrote:
> On Sun, 25 Jun 2000, Dave wrote:
> > I've been using the Location directive for a bit now, here is how it
> > looks for me:
> > 
> > <Location /wpy >
> >   SetHandler python-program
> >   PythonDebug On
> >   PythonPath "sys.path+['/devel/WEB/Webware/WebKit']"
> >   PythonHandler webkit_handler
> > </Location>
> > 
> > The key here is the undocumented feature of PythonPath that it
> > apparently evals its argument. I've been meaning to ask about this since
> > at some point this could get broken in development and I'd be up a
> > creek. 
> 
> I don't think this is going away - there is no simpler way to specify the
> pythonpath than in python syntax which implies evaling.

Huh? How about specifying the path in standard DIR:DIR:DIR notation, and
using:

    sys.path = sys.path + string.split(directive_arg, ':')

No need to eval at all.

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/

From gstein at lyra.org  Sun Jun 25 15:57:55 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:58:33 2004
Subject: [mod_python] test doesn't work (solved?)
In-Reply-To: <4.3.2.7.2.20000625174031.00bd3540@pop.ne.mediaone.net>; from seant@alum.mit.edu on Sun, Jun 25, 2000 at 05:41:24PM -0400
References: <Pine.LNX.4.21.0006251540480.24945-100000@saturn.ispol.com> <3955FDF3.DC59F96B@delanet.com> <Pine.LNX.4.21.0006251540480.24945-100000@saturn.ispol.com> <20000625135631.F29590@lyra.org> <4.3.2.7.2.20000625174031.00bd3540@pop.ne.mediaone.net>
Message-ID: <20000625155755.H29590@lyra.org>

On Sun, Jun 25, 2000 at 05:41:24PM -0400, Sean True wrote:
> At 01:56 PM 6/25/00 -0700, you wrote:
> >Huh? How about specifying the path in standard DIR:DIR:DIR notation, and
> >using:
> >
> >     sys.path = sys.path + string.split(directive_arg, ':')
> >
> >No need to eval at all.
> Not as tasteful on Wintel platforms, though.

Fine. Then use os.pathsep rather than ':'

The *point* is valid -- there is no need for an eval in there, no need for a
Python expression, and every possibility of using "standard" path notations.

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/

From dwallace at delanet.com  Sun Jun 25 19:34:45 2000
From: dwallace at delanet.com (Dave)
Date: Fri Jan  9 21:58:33 2004
Subject: [mod_python] test doesn't work (solved?)
References: <Pine.LNX.4.21.0006251540480.24945-100000@saturn.ispol.com>
Message-ID: <39569715.BA322B4C@delanet.com>

Gregory Trubetskoy wrote:

> > Maybe a directive to append paths to the default PYTHONPATH would
> > be in order?
> It _could_ be done, but it went against my principle to keep it simple, so
> I decided to save for it later since I had more important features to
> roll out.

Right-on, works for me!

> > BTW, the nice thing about using Location is the fact that for the
> > particular application I'm using there is only a single handler and all
> > content is delivered through that handler by the application. Having to
> > specify a Directory just doesn't seem quite right.
>
> Not sure I understand this completely - could you elaborate a bit?

Webware is a application server (in development) that does Servlets and
Server Pages in Python so what it really wants is a path into its servlet
directory so it can find the source, generate the content and send it back
through the handler. For now the mod_python handler is just a proxy that
marshals some data from the request,sends it to the application server via a
socket, and relays the response back to Apache. If I were using Directory I'd
have to make a physical directory somwhere just to contain the handler and
nothing else or I suppose I could put the handler in my servlet directory but
it just doesn''t seem to belong there. Using Location I can place the handler
with the other application server source files. That just seems cleaner for
now.
Of course, this is all making me think of what will happen when I want to put
server pages alongside static html and have the right thing happen when .html
or .psp (server pages) are called for, but I suppose there is some way to
coerce Apache into doing that.

Dave.




From rsalz at caveosystems.com  Sun Jun 25 21:54:40 2000
From: rsalz at caveosystems.com (Rich Salz)
Date: Fri Jan  9 21:58:33 2004
Subject: [mod_python] test doesn't work (solved?)
References: <Pine.LNX.4.21.0006251540480.24945-100000@saturn.ispol.com> <3955FDF3.DC59F96B@delanet.com> <Pine.LNX.4.21.0006251540480.24945-100000@saturn.ispol.com> <20000625135631.F29590@lyra.org> <4.3.2.7.2.20000625174031.00bd3540@pop.ne.mediaone.net> <20000625155755.H29590@lyra.org>
Message-ID: <3956B7E0.718FB3B9@caveosystems.com>

> > >     sys.path = sys.path + string.split(directive_arg, ':')

Gee, I dunno. I kinda like the idea that the config file can completely
set the path.  It seems cleaner that way, just as scripts often do
	PATH=/bin:/usr/bin ; export PATH
rather than
	PATH=$PATH:/bin:/usr/bin ; export PATH

I vote to keep the current semantics.

From a.d.stribblehill at durham.ac.uk  Thu Jun  1 11:59:27 2000
From: a.d.stribblehill at durham.ac.uk (Andrew Stribblehill)
Date: Fri Jan  9 22:02:19 2004
Subject: [mod_python] Apache segfaults on startup
Message-ID: <20000601115927.B24781@womble.dur.ac.uk>

I compiled mod_python as a DSO. It compiled OK, and so I installed
it into libexec and put the appropriate magic into httpd.conf.
Subsequently, running apache causes it to seg. I noticed the FAQ
answer so I put made sure the module was loaded first, but it
still segs. How can I track down this problem?

OS: Solaris 8
Compiler: GCC 2.8.1
Python : 1.5.2
Apache: 1.3.9

Thanks,

Andrew Stribblehill
Systems Programmer, IT Service, University of Durham, England

From hildmann at prz.tu-berlin.de  Thu Jun  1 19:21:07 2000
From: hildmann at prz.tu-berlin.de (Thomas Hildmann)
Date: Fri Jan  9 22:02:19 2004
Subject: [mod_python] How to run each .py instead of showing it
Message-ID: <39369B83.5259DA64@prz.tu-berlin.de>

Hello!

This is more an apache configuration question than a mod_python one. 

Is it possible to configure the apache this way that every .py file is
interpreted to be processed by the mod_python?


Greetings....

hildi

From Mads at Kiilerich.com  Fri Jun  2 04:01:14 2000
From: Mads at Kiilerich.com (Mads Kiilerich)
Date: Fri Jan  9 22:02:19 2004
Subject: [mod_python] AttributeError: handler
Message-ID: <Pine.LNX.4.21.0006020345280.18671-200000@localhost>

Hello,

I'm testing mod_python on a almost vanilla Red Hat 6.2 with the
relevant stuff coming directly from the RPM packages:

[mk@otto mk]$ rpm -q apache python
apache-1.3.12-2
python-1.5.2-13
[mk@otto mk]$ 

mod_python have been installed as DSO according to the
instructions (IMHO, but MyMMV). When apache starts I get

[Fri Jun  2 03:47:15 2000] [notice] Apache/1.3.12 (Unix)  (Red Hat/Linux) PHP/3.0.15 mod_python/2.1 Python/1.5.2 configured -- resuming normal operations

But accessing the test.py page I get the attached error-message.

Any hints to how to solve that problem?

TIA,

-- 
Mads Kiilerich          Sys.Adm. Cand.Polyt
Mads@Kiilerich.com      Tel. +45 38 16 26 00  Mob. +45 26 20 07 73
M?ntmestervej 12B 1th,  DK-2400 NV,  Denmark

"Learned about WAP. It sucks. The more I play with WML the more sure 
I am that WAP will die out rapidly once phones doing HTML exist."
							Alan Cox
-------------- next part --------------

ERROR mod_python: "PythonHandler test"

Traceback (innermost last):

  File "/usr/lib/python1.5/site-packages/mod_python/apache.py", line 87, in Dispatch
    object = self.resolve_object(module, object_str)

  File "/usr/lib/python1.5/site-packages/mod_python/apache.py", line 42, in resolve_object
    obj = getattr(obj, obj_str)

AttributeError: handler

From grisha at ispol.com  Fri Jun  2 07:29:22 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:19 2004
Subject: [mod_python] AttributeError: handler
In-Reply-To: <Pine.LNX.4.21.0006020345280.18671-200000@localhost>
Message-ID: <Pine.LNX.4.21.0006020728250.7977-100000@saturn.ispol.com>

The message means that module test did not have a function called
"handler".

Grisha

On Fri, 2 Jun 2000, Mads Kiilerich wrote:

> Hello,
> 
> I'm testing mod_python on a almost vanilla Red Hat 6.2 with the
> relevant stuff coming directly from the RPM packages:
> 
> [mk@otto mk]$ rpm -q apache python
> apache-1.3.12-2
> python-1.5.2-13
> [mk@otto mk]$ 
> 
> mod_python have been installed as DSO according to the
> instructions (IMHO, but MyMMV). When apache starts I get
> 
> [Fri Jun  2 03:47:15 2000] [notice] Apache/1.3.12 (Unix)  (Red Hat/Linux) PHP/3.0.15 mod_python/2.1 Python/1.5.2 configured -- resuming normal operations
> 
> But accessing the test.py page I get the attached error-message.
> 
> Any hints to how to solve that problem?
> 
> TIA,
> 
> -- 
> Mads Kiilerich          Sys.Adm. Cand.Polyt
> Mads@Kiilerich.com      Tel. +45 38 16 26 00  Mob. +45 26 20 07 73
> M?ntmestervej 12B 1th,  DK-2400 NV,  Denmark
> 
> "Learned about WAP. It sucks. The more I play with WML the more sure 
> I am that WAP will die out rapidly once phones doing HTML exist."
> 							Alan Cox
> 


From grisha at ispol.com  Fri Jun  2 12:25:35 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:19 2004
Subject: [mod_python] test
Message-ID: <Pine.LNX.4.21.0006021225150.8928-100000@saturn.ispol.com>

please ignore


From haering at informatik.tu-muenchen.de  Sun Jun  4 04:34:32 2000
From: haering at informatik.tu-muenchen.de (Gerhard Haering)
Date: Fri Jan  9 22:02:19 2004
Subject: [mod_python] ANNOUNCE: mod_python 2.1 RPMs for SuSE 6.4
Message-ID: <20000604043417.A14514@in.tum.de>

this and the files at: http://jarre.pair.com/insadmin/gerhard/

----------------------------
mod_python RPMs for SuSE 6.4
----------------------------


What is it?

Source and binary packages of mod_python 2.1 and a mod_python-ready Apache
in RPM format. All for SuSE Linux version 6.4.


The history of it

I am by no means a mod_python expert. In fact I have not even programmed
anything with it until now. I am, however, very interested in mod_python
because I use Python for CGI-scripting exclusively. When I recently heard
of mod_python, I tried to make it run on my Apache server, but it was not
especially easy to get it going. Finally I succeeded but it was a product
of trial and error. A few days later I didn't want to do any 'real'
programming, so I thought it would be nice to finally learn how to build
RPMs and why not package mod_python ...


What's in for you

If you have a SuSE 6.4 system and want to try out mod_python without
messing around too much recompiling Apache or Apache modules, these RPMs
might be for you. To be honest, I don't know how well they will work, at
least they work for me, that is: after installing the RPMs
http://localhost/test/test.py displays "Hello from mod_python." on my
machine. Most probably, the RPMs will need some tweaking and be rebuilt
for older SuSE versions. They will definitely not work for any other
distributions, but the SPEC file and my patches for the Apache startup
script, httpd/httpd.conf, the Makefile for mod_python, etc. might give you
a start if you want to build packages for your favorite distribution.


Quickstart

On a SuSE 6.4 system, remove the old Apache RPM and install my modified
Apache 1.3.12 RPM. Then install the mod_python RPM. Then restart Apache
and point your browser to http://localhost/test/test.py. The text "Hello
from mod_python." should be displayed. If you want to know what's going on
behind the scenes:

     - patched the SuSE startup script /sbin/init.d/apache to work with and 
       without mod_python
     - patched /etc/httpd/httpd.conf to use a mod_python 
       handler at /usr/local/httpd/htdocs/test/test.py
     - install mod_python documentation at /usr/doc/packages/mod_python

Have a lot of fun!


Feedback

I cannot promise to remove any bugs in the RPMs, but if any feedback is
coming, I will try. If I have some time to waste, I will try to improve
the RPMs and make some for SuSE 6.3. Please contact me at haering@in.tum.de.

From richard at whitequeen.com  Sat Jun  3 20:43:13 2000
From: richard at whitequeen.com (richard offer)
Date: Fri Jan  9 22:02:19 2004
Subject: [mod_python] Returning multiple content types ?
Message-ID: <200006040343.e543hD329628@erij.whitequeen.com>

Hi,


<Newbie>

How do I write a handler that can return multitple pieces of content ? 


I've got a handler that can read an image out of the photgraphic database
I'm working on, but I need to be able to generate the rest of the page
around the image ?


Should I be using the cgihandler ? This is virgin code so I'm, not
porting an exising implementation, so it seemed to me that I would be
better off using the basic handler, is this true ?


Is there an easy way to parse the QUERY_STRING into a dict ?


Should I be using a different architecture ? I was working on having
everything in one handler, does this make sence?

</Newbie>


thanks, this is so cool :-)


richard.


-----------------------------------------------------------------------
richard offer @ home 
_______________________________http://www.whitequeen.com/users/richard/


From grisha at ispol.com  Sun Jun  4 15:00:44 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:19 2004
Subject: [mod_python] 2.2 is out
Message-ID: <Pine.LNX.4.21.0006041452530.28185-100000@saturn.ispol.com>

Mod_python 2.2 is out. This one fixes the occasional trashing of
content-type that some people have reported. This bug manifested itself
more for people who use Python 1.6. Thanks to Dave Wallace for pointing it
out.

There is also a Win32 DLL of 2.1 available for download, and 2.2 hopefully
as soon as Stephane Bidoul gets around to compiling it. 

Also thanks to Gerhard Haering for the Suse RPM's. It'd be nice if someone
came up and agreed to maintain with RedHat RPM, Debian package, a FreeBSD
port and a Solaris package...

Have a good day,

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com






From grisha at ispol.com  Sun Jun  4 15:08:38 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:19 2004
Subject: [mod_python] Returning multiple content types ?
In-Reply-To: <200006040343.e543hD329628@erij.whitequeen.com>
Message-ID: <Pine.LNX.4.21.0006041503350.28185-100000@saturn.ispol.com>

On Sat, 3 Jun 2000, richard offer wrote:

> How do I write a handler that can return multitple pieces of content ? 

For as long as you have a way to tell the handler which content to return
(typically done via URL) and the handler has the logic to understand it,
this shouldn't be too hard. All of the handlers included with mod_python
return multiple pieces of content.

> Should I be using the cgihandler ? This is virgin code so I'm, not
> porting an exising implementation, so it seemed to me that I would be
> better off using the basic handler, is this true ?

If it's virgin code and you have no intentions of using CGI in the future
there is no reason for you to mess with the cgihandler, you're right.

> Is there an easy way to parse the QUERY_STRING into a dict ?

Look at the standard Python library module cgi.py.

> Should I be using a different architecture ? I was working on having
> everything in one handler, does this make sence?

This is something only you, as developer,  can determine.

Grisha


From SBID at BXS.BE  Mon Jun  5 12:01:12 2000
From: SBID at BXS.BE (=?iso-8859-1?Q?St=E9phane_BIDOUL?=)
Date: Fri Jan  9 22:02:19 2004
Subject: [mod_python] Problems under windows
Message-ID: <C16998C688CDD31196D90008C7E690CB17233F@EVRSRV04>

Hi,

mod_python seems to crash sometimes under
windows (Windows 2000, Python 1.5.2, Apache 1.3.11, mod_python 2.2).

I can trigger the problem by keeping the "refresh" key pressed in the
browser. I use the most trivial test script:

	print "content-type: text/plain"
	print
	print "Hello from mod_python"

and the following httpd.conf

	LoadModule python_module modules/mod_python.dll
	AddHandler python-program .py
	PythonHandler mod_python.cgihandler
	PythonDebug

The problem seems to be thread-related because I sometimes
get the following message:

	Fatal Python error: ceval: orphan tstate

Sometimes it's simply an access violation.

It seems to occur somewhere inside the PyObject_CallMethod call 
in python_handler().

I'm not intimate with python or apache threading, so maybe someone 
can examine the problem further... Or maybe it's simply my windows build of 
mod_python which is wrong somehow...

Any idea?

-Stephane
sbi@acse.be

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20000605/07b9a484/attachment-0003.htm
From seant at alum.mit.edu  Mon Jun  5 07:21:48 2000
From: seant at alum.mit.edu (Sean True)
Date: Fri Jan  9 22:02:19 2004
Subject: [mod_python] Leaking and cgi-handler
In-Reply-To: <C16998C688CDD31196D90008C7E690CB17233F@EVRSRV04>
Message-ID: <4.3.2.20000605071041.00b91280@pop.ne.mediaone.net>

Like too many people, I'm working on a version of python server pages -- 
.phtml pages which contain
mixed python and HTML code, allowing on the fly construction of pages from 
files which can mostly be
edited with a WYSIWYG HTML editor. I have a phtml.py program which is 
invoked as a cgi script, and more
recently under cgi-handler.

The documentation for cgi-handler notes that it may be subject to a memory 
leak related to os.environ().

On a Linux Redhat 6.1 system with Apache and statically linked mod_python, 
I'm seeing memory usage growing
by about 10K or so per page served (measured by watching the system monitor 
reports grow). Performance also
drops -- from about 15 pages served per second to less than 8 pages per second.

All of this makes me think that some data structure in the interpreter or 
mod_python is growing without bound,
in combination with a linear search from the front of the list.

The same code runs under pyapache with a very modest memory leak (also 
documented for pyapache) of about 1K
per page served.

I was a little unwilling to try switching to a more direct method of 
content handling under mod_python (creating
a request handler for .phtml page) until the whole system was a little more 
stable. I'm in production under pyapache
now, and I hate forking the code base.

Comments? Suggestions?

Does anyone have a skeleton content handler they would be willing to share, 
along with a corresponding .conf
entry?

-- Sean

==========
Sean True
seant@alum.mit.edu


From grisha at ispol.com  Mon Jun  5 08:05:32 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:19 2004
Subject: [mod_python] Leaking and cgi-handler
In-Reply-To: <4.3.2.20000605071041.00b91280@pop.ne.mediaone.net>
Message-ID: <Pine.LNX.4.21.0006050746190.31412-100000@saturn.ispol.com>

Sean - 

If you can find the source of the memory leak, please let me know what it
is, because I couldn't... :-(

The cgihandler when used with scripts not using cgi.py does not leak a
byte of memory. Unfortunately 98% of Python scripts out there start with
"import cgi".

A common misconception about Python and memory leaks is that it is
impossible to leak memory in Python. Python, just like any other language
allows you to allocate limitless memory, and in a persistent daemon-type
environment like Apache it shows.

Most likely the reason PyApache does not leak memory as bad is it resets
the interpeter between hits. This comes at a significant performance hit
since all the modules have to imported again, to the point where PyApache
isn't all that much faster than plain CGI.

My recomendation would to rewrite everything using "native" mod_python
handlers. They are simple (much simpler than CGI), fast and they do not
leak memory. You fears about them being unstable are unfounded, I think.

P.S. A skeleton content handler is described in the documentation.

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Mon, 5 Jun 2000, Sean True wrote:

> The same code runs under pyapache with a very modest memory leak (also
> documented for pyapache) of about 1K per page served.
> 
> I was a little unwilling to try switching to a more direct method of
> content handling under mod_python (creating a request handler for
> .phtml page) until the whole system was a little more stable. I'm in
> production under pyapache now, and I hate forking the code base.
> 
> Comments? Suggestions?
> 
> Does anyone have a skeleton content handler they would be willing to
> share, along with a corresponding .conf entry?
> 
> -- Sean


From Mads at Kiilerich.com  Mon Jun  5 15:13:40 2000
From: Mads at Kiilerich.com (Mads Kiilerich)
Date: Fri Jan  9 22:02:19 2004
Subject: [mod_python] AttributeError: handler
In-Reply-To: <Pine.LNX.4.21.0006020728250.7977-100000@saturn.ispol.com>
Message-ID: <Pine.LNX.4.21.0006051504240.864-100000@localhost>

Friday I got mail from Gregory Trubetskoy:

> The message means that module test did not have a function called
> "handler".
> 
> Grisha

Thanks for the fast response.

But test.py contains the following, according to the example in
the documentation:


from mod_python import apache

def handler(req):
	req.send_http_header()
	req.write("Hello World!")
	return apache.OK 


As far as I can see there _is_ a function called "handler"!?

Can you confirm that the example from the documentation works
"out of the box"?

Also: Should the .py be compiled to .pyc?

TIA,
-- 
Mads Kiilerich          Sys.Adm. Cand.Polyt
Mads@Kiilerich.com      Tel. +45 38 16 26 00  Mob. +45 26 20 07 73
M?ntmestervej 12B 1th,  DK-2400 NV,  Denmark

"Learned about WAP. It sucks. The more I play with WML the more sure 
I am that WAP will die out rapidly once phones doing HTML exist."
							Alan Cox


From grisha at ispol.com  Mon Jun  5 09:40:52 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:19 2004
Subject: [mod_python] AttributeError: handler
In-Reply-To: <Pine.LNX.4.21.0006051504240.864-100000@localhost>
Message-ID: <Pine.LNX.4.21.0006050938520.31412-100000@saturn.ispol.com>

Mads - 

Everyone who reported this problem so far found later on that they had
extra blanks in their test.py because they cut and pasted from the web
page.

No, you don't need to compile your py into a pyc - Python will do that for
you.

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Mon, 5 Jun 2000, Mads Kiilerich wrote:

> Friday I got mail from Gregory Trubetskoy:
> 
> But test.py contains the following, according to the example in
> the documentation:
> 
> 
> from mod_python import apache
> 
> def handler(req):
> 	req.send_http_header()
> 	req.write("Hello World!")
> 	return apache.OK 
> 


From aiglauer at yahoo.com  Mon Jun  5 07:08:41 2000
From: aiglauer at yahoo.com (Alexis Iglauer)
Date: Fri Jan  9 22:02:20 2004
Subject: [mod_python] AttributeError: handler
Message-ID: <20000605140841.29193.qmail@web2205.mail.yahoo.com>

Always a good idea to just run python over your script
before trying to run it on the webserver - this will
pick up any inconsistent dedents or other little
syntax nasties.

If you are in unix, edit the file in vi and type in
':set list' - you can then see which of your nice
spaces are actually sneaky tabs :)

Regards
aei


--- Gregory Trubetskoy <grisha@ispol.com> wrote:
> 
> Mads - 
> 
> Everyone who reported this problem so far found
> later on that they had
> extra blanks in their test.py because they cut and
> pasted from the web
> page.
> 
> No, you don't need to compile your py into a pyc -
> Python will do that for
> you.
> 
> --
>   Gregory (Grisha) Trubetskoy
>        grisha@ispol.com
> 
> On Mon, 5 Jun 2000, Mads Kiilerich wrote:
> 
> > Friday I got mail from Gregory Trubetskoy:
> > 
> > But test.py contains the following, according to
> the example in
> > the documentation:
> > 
> > 
> > from mod_python import apache
> > 
> > def handler(req):
> > 	req.send_http_header()
> > 	req.write("Hello World!")
> > 	return apache.OK 
> > 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 
> 
> 


__________________________________________________
Do You Yahoo!?
Yahoo! Photos -- now, 100 FREE prints!
http://photos.yahoo.com

From sbi at acse.be  Mon Jun  5 20:56:13 2000
From: sbi at acse.be (=?iso-8859-1?Q?St=E9phane_Bidoul?=)
Date: Fri Jan  9 22:02:20 2004
Subject: [mod_python] Problems under windows: a first diagnostic
Message-ID: <010101bfcf1f$b9407bd0$885bfea9@spirou>

Hi again,

I think I've got an explanation for the crashes under windows.

Disclaimer: I'm no apache expert, nor am I intimate with python threading,
so bear with me if the following is completely off-track.

In the python doc, I've found the following:

<PythonDocExcerpt>

[...] when threads are created from C, they don't have the global interpreter lock, nor is there a thread state data structure for them. Such threads must bootstrap themselves into existence, by first creating a thread state data structure [PyThreadState_New()?], then acquiring the lock, and finally storing their thread state pointer, before they can start using the Python/C API. When they are done, they should reset the thread state pointer, release the lock, and finally free their thread state data structure.

</PythonDocExcerpt>

Now, in mod_python, threads are created by Apache, so they should
somehow be bootstrapped for python. 

In my understanding, mod_python only initializes one thread per
interpreter: the Apache thread that is happening to create the interpreter
 (using Py_NewInterpreter(), which in turns calls PyThreadState_New()
for the interpreter's "main" thread).
All other apache threads using that same interpreter will not call
PyThreadState_New()... hence the potential conflict.

To summarize, my understanding of the python doc is that there should
be one PyThreadState_New() for each (apache thread, python interpreter) couple.

AFAIK, threads are used only in the Windows version of Apache, 
so the problem should not occur on unix  (athough that will change with Apache 2). 
Also, if ThreadsPerChild is set to 1, the problem disappears,
which seems to confirm my diagnostic.

Again, bear with me if this is totally wrong...
If this is correct, however, I've no idea (yet) on how to fix it...

What do you think? 
Can a python threading expert confirm or infirm this diagnostic?

-Stephane
sbi@acse.be




From gstein at lyra.org  Mon Jun  5 17:16:39 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 22:02:20 2004
Subject: [mod_python] Problems under windows: a first diagnostic
In-Reply-To: <010101bfcf1f$b9407bd0$885bfea9@spirou>
Message-ID: <Pine.LNX.4.10.10006051658410.14292-100000@nebula.lyra.org>

On Mon, 5 Jun 2000, [iso-8859-1] Stéphane Bidoul wrote:
>...
> Now, in mod_python, threads are created by Apache, so they should
> somehow be bootstrapped for python. 

Correct.

> In my understanding, mod_python only initializes one thread per
> interpreter: the Apache thread that is happening to create the interpreter
>  (using Py_NewInterpreter(), which in turns calls PyThreadState_New()
> for the interpreter's "main" thread).
> All other apache threads using that same interpreter will not call
> PyThreadState_New()... hence the potential conflict.

ThreadState structures are not specific to a particular (OS) thread. You
can actually use them (not at the same time!) across different threads.
Given the protection of the global lock, it might be okay to even attempt
to use them at the same time.
[ haven't thought through this particular scenario fully yet ]

> To summarize, my understanding of the python doc is that there should
> be one PyThreadState_New() for each (apache thread, python
> interpreter) couple.

Theoretically: yes.

Python's central lock "should" arbitrate the use of the per-interpreter
thread state so that it can be used by multiple Apache threads. Probably
isn't the best idea, though.

Eek. Definitely wrong for the Apache scenario.

The scoop: if python_handler() calls into Python, then returns, then
tstate->frame should be NULL. In this scenario, you could do the
share-tstate thing.

However: somewhere down inside of python_handler's call into Python, it is
quite possible for Python to use Py_BEGIN_ALLOW_THREADS (unlock the global
lock). This will allow another python_handler to grab the tstate and
attempt execution. Let's say the thread execution then flips back to
normal: the original thread's tstate->frame is now *totally* wrong.

[ tstate->frame has a direct correspondence to the C stack; these must
  stay in sync or Bad Things happen ]

> AFAIK, threads are used only in the Windows version of Apache, 
> so the problem should not occur on unix  (athough that will change with Apache 2). 
> Also, if ThreadsPerChild is set to 1, the problem disappears,
> which seems to confirm my diagnostic.
> 
> Again, bear with me if this is totally wrong...
> If this is correct, however, I've no idea (yet) on how to fix it...

Your underlying hypothesis is quite correct. Above is a more detailed
breakdown of "why".

> What do you think? 
> Can a python threading expert confirm or infirm this diagnostic?

That would be me :-)

One other thing: if Apache is going to run threads, then Python *MUST* be
compiled with thread support. Otherwise, things will die very rapidly.
Presuming that you are using the standard Windows distribution, then the
thread support is automatically enabled. I would recommend that mod_python
barf with #error if it detects Apache/Win32 and WITH_THREAD is not
enabled.

Heh. All of this just supports my belief in "free threading" Python even
more... :-)

What is the solution? Each entry to python-handler should construct a
tstate on the fly, call into Python, then destroy the tstate. I used this
design for the Python/COM support in the Win32 distribution. That had to
deal with reentrancy issues, but (luckily) that isn't a problem here.

Presumably, you could also cache/pool tstates and yank them from your
pool on entry to python-handler, returning them on exit. If two threads
came into python-handler (against the same interp!), then additional
tstates would be constructed.

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/


From seant at alum.mit.edu  Mon Jun  5 23:11:07 2000
From: seant at alum.mit.edu (Sean True)
Date: Fri Jan  9 22:02:20 2004
Subject: [mod_python] A cheap handler for exploring Apache req contents
Message-ID: <4.3.2.20000605230004.00b94c20@pop.ne.mediaone.net>

The following code is so inelegant, I'm a little embarrassed to share it, 
but it's a handy handler for starting
to poke around inside the Apache req structure, and so informative that I 
thought I'd share.

Grisha might want to comment as to why some of the attributes of the req 
don't dump the way I tried to dump them. Could just be the late night 
stupids on my part.

-- Sean

=================
from mod_python import apache

def dumpdict(req,title, d):
     req.write("*"+title + "\n")
     for key in d.keys():
         req.write(str(key) + ": " + str(d[key]) + "\n")
def dump(req,title,s):
     req.write(title+": "+s+"\n")
def handler(req):
     req.send_http_header()
     dump(req,"Request", req.the_request)
     dump(req,"Protocol", req.protocol)
     dump(req,"Hostname", req.hostname)
     dump(req,"Status line", req.status_line)
     dump(req, "Method", req.method)
     dump(req,"Content handler", req.handler)
     dump(req, "Unparsed uri", req.unparsed_uri)
     dump(req, "Uri", req.uri)
     dump(req, "Filename", req.filename)
     dump(req, "Path info", req.path_info)
     dump(req, "Args", req.args)
     dump(req, "Mtime", str(req.mtime))
     dump(req, "Remaining", str(req.remaining))
     # The following don't work.
     #dump(req, "Content type", req.content_type)
     #dump(req, "Content encoding", req.content_encoding)
     #dump(req, "Parsed uri", str(req.parsed_uri))
     #dump(req, "finfo", str(req.finfo))
     dumpdict(req, "headers_in",req.headers_in)
     dumpdict(req, "headers_out", req.headers_out)
     dumpdict(req, "err_headers_out", req.err_headers_out)
     dumpdict(req, "subprocess_env", req.subprocess_env)
     dumpdict(req, "notes", req.notes)
     return apache.OK
================
Output on my system: (with domain deleted for privacy)
================
Request: GET /foo.xhtml?fu=bar HTTP/1.0
Protocol: HTTP/1.0
Hostname: www.[..].com
Status line: 200 OK Method: GET
Content handler: python-program
Unparsed uri: /foo.xhtml?fu=bar
Uri: /foo.xhtml
Filename: /usr/local/apache/htdocs/foo.xhtml
Path info:
Args: fu=bar
Mtime: 0
Remaining: 0
*headers_in
Accept: */*
Accept-Language: en-us
Connection: Keep-Alive
Host: www.[..].com
User-Agent: Mozilla/4.0 (compatible; MSIE 5.01; Windows 98)
*headers_out
Connection: close
Content-Type: text/plain
*err_headers_out
*subprocess_env
SCRIPT_URL: /foo.xhtml
SCRIPT_URI: http://www.[..]/foo.xhtml
GATEWAY_INTERFACE: CGI/1.1
SERVER_PROTOCOL: HTTP/1.0
REQUEST_METHOD: GET
QUERY_STRING: fu=bar
REQUEST_URI: /foo.xhtml?fu=bar
SCRIPT_NAME: /foo.xhtml
*notes
python_request_ptr: 135846824

==========
Sean True
seant@alum.mit.edu


From sbi at acse.be  Tue Jun  6 09:35:03 2000
From: sbi at acse.be (=?iso-8859-1?Q?St=E9phane_Bidoul?=)
Date: Fri Jan  9 22:02:20 2004
Subject: [mod_python] Problems under windows: a first diagnostic
References: <Pine.LNX.4.10.10006051658410.14292-100000@nebula.lyra.org>
Message-ID: <006201bfcf89$ba39c2c0$885bfea9@spirou>

>...
>The scoop: if python_handler() calls into Python, then returns, then
>tstate->frame should be NULL. In this scenario, you could do the
>share-tstate thing.
>
>However: somewhere down inside of python_handler's call into Python, it is
>quite possible for Python to use Py_BEGIN_ALLOW_THREADS (unlock the global
>lock). This will allow another python_handler to grab the tstate and
>attempt execution. Let's say the thread execution then flips back to
>normal: the original thread's tstate->frame is now *totally* wrong.

Wow! This looks even more complex than I thought...

>What is the solution? Each entry to python-handler should construct a
>tstate on the fly, call into Python, then destroy the tstate. I used this
>design for the Python/COM support in the Win32 distribution. That had to
>deal with reentrancy issues, but (luckily) that isn't a problem here.
>
>Presumably, you could also cache/pool tstates and yank them from your
>pool on entry to python-handler, returning them on exit. If two threads
>came into python-handler (against the same interp!), then additional
>tstates would be constructed.

I was contemplating the use of thread-local storage to maintain
the list of interpreters for which a tstate is initialized for each
Apache thread, but it's probably overkill...

Ideally, Apache should provide access to some "per-thread data area" for this,
but it does not, right?

Anyway, unless Gregory tells me otherwise, I will experiment with 
Greg's first solution and see how it works...

-Stephane



From gstein at lyra.org  Tue Jun  6 02:50:52 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 22:02:20 2004
Subject: [mod_python] Problems under windows: a first diagnostic
In-Reply-To: <006201bfcf89$ba39c2c0$885bfea9@spirou>
Message-ID: <Pine.LNX.4.10.10006060245500.14292-100000@nebula.lyra.org>

On Tue, 6 Jun 2000, [iso-8859-1] Stéphane Bidoul wrote:
>...
> >What is the solution? Each entry to python-handler should construct a
> >tstate on the fly, call into Python, then destroy the tstate. I used this
> >design for the Python/COM support in the Win32 distribution. That had to
> >deal with reentrancy issues, but (luckily) that isn't a problem here.
> >
> >Presumably, you could also cache/pool tstates and yank them from your
> >pool on entry to python-handler, returning them on exit. If two threads
> >came into python-handler (against the same interp!), then additional
> >tstates would be constructed.
> 
> I was contemplating the use of thread-local storage to maintain
> the list of interpreters for which a tstate is initialized for each
> Apache thread, but it's probably overkill...

The cost of creating a tstate isn't all that high, in the scheme of
things. What is going to get a bit difficult is the change necessary in
get_obcallback(). It uses Py_NewInterpreter to create an interp/tstate
pair. You'll have to unwrap that into creating *just* an interpreter, thus
allowing you to create/destroy tstates at will.

> Ideally, Apache should provide access to some "per-thread data area" for this,
> but it does not, right?

For Apache 1.3, the only threaded platform is Windows, where TLS is going
to work out fine for you.

Apache 2.0 is a whole different story, and doesn't apply to mod_python.

> Anyway, unless Gregory tells me otherwise, I will experiment with 
> Greg's first solution and see how it works...

It is a good bundle of work, but it should work quite fine. Like I said, I
used a similar pattern for embedding the Python interpreter behind the
(multi-threaded) COM interfaces.

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/


From grisha at ispol.com  Tue Jun  6 07:38:29 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:20 2004
Subject: [mod_python] Problems under windows: a first diagnostic
In-Reply-To: <Pine.LNX.4.10.10006060245500.14292-100000@nebula.lyra.org>
Message-ID: <Pine.LNX.4.21.0006060734030.4432-100000@saturn.ispol.com>

I haven't had any caffeine yet so I don't think I can comment. The Python
relationship between ThreadStates and Interpreters took me a while to
understand last time I studied it and it's one of those things that I can
only grasp for a few days until I don't need it - then, next time, I have
figure it out again.

I'll think about this some more in the coming days....

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Tue, 6 Jun 2000, Greg Stein wrote:

> On Tue, 6 Jun 2000, [iso-8859-1] St?phane Bidoul wrote:
> >...
> > >What is the solution? Each entry to python-handler should construct a
> > >tstate on the fly, call into Python, then destroy the tstate. I used this
> > >design for the Python/COM support in the Win32 distribution. That had to
> > >deal with reentrancy issues, but (luckily) that isn't a problem here.
> > >
> > >Presumably, you could also cache/pool tstates and yank them from your
> > >pool on entry to python-handler, returning them on exit. If two threads
> > >came into python-handler (against the same interp!), then additional
> > >tstates would be constructed.
> > 
> > I was contemplating the use of thread-local storage to maintain
> > the list of interpreters for which a tstate is initialized for each
> > Apache thread, but it's probably overkill...
> 
> The cost of creating a tstate isn't all that high, in the scheme of
> things. What is going to get a bit difficult is the change necessary in
> get_obcallback(). It uses Py_NewInterpreter to create an interp/tstate
> pair. You'll have to unwrap that into creating *just* an interpreter, thus
> allowing you to create/destroy tstates at will.
> 
> > Ideally, Apache should provide access to some "per-thread data area" for this,
> > but it does not, right?
> 
> For Apache 1.3, the only threaded platform is Windows, where TLS is going
> to work out fine for you.
> 
> Apache 2.0 is a whole different story, and doesn't apply to mod_python.
> 
> > Anyway, unless Gregory tells me otherwise, I will experiment with 
> > Greg's first solution and see how it works...
> 
> It is a good bundle of work, but it should work quite fine. Like I said, I
> used a similar pattern for embedding the Python interpreter behind the
> (multi-threaded) COM interfaces.
> 
> Cheers,
> -g
> 
> -- 
> Greg Stein, http://www.lyra.org/
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From danilo at telusplanet.net  Wed Jun  7 14:51:44 2000
From: danilo at telusplanet.net (Danilo Fiorenzano)
Date: Fri Jan  9 22:02:20 2004
Subject: [mod_python] Leaking and cgi-handler
In-Reply-To: Gregory Trubetskoy's message of "Mon, 5 Jun 2000 08:05:32 -0400 (EDT)"
References: <Pine.LNX.4.21.0006050746190.31412-100000@saturn.ispol.com>
Message-ID: <m3puptnrj3.fsf@spike.interalta.com>

Gregory Trubetskoy <grisha@ispol.com> writes:

 
> The cgihandler when used with scripts not using cgi.py does not leak a
> byte of memory. Unfortunately 98% of Python scripts out there start with
> "import cgi".

..
 
> My recomendation would to rewrite everything using "native" mod_python
> handlers. They are simple (much simpler than CGI), fast and they do not
> leak memory. You fears about them being unstable are unfounded, I think.

On this theme: from the heights of my blissful ignorance (started
learning python and its library 2 weeks ago or so), I apparently
devised a way to use the facilities of the cgi module with mod_python
_without_ using the cgihandler.  I do something like this:

import cgi
from mod_python import apache

def handler(req):
    req.content_type = "text/html"
    req.send_http_header()

    env, si, so = apache.setup_cgi(req)
    formData = cgi.FieldStorage()
    for key in formData.keys():
        req.write( str(key) + " : " + str(data[key].value) + "<br>" )


This works without the need to specify cgihandler in the apache
config.  Not sure whether it's the Right way to handle things, or if
it avoids the leaking, but I thought it was worth sharing.. YMMV.

 regards

-- Danilo

From roybryant at SEVENtwentyfour.com  Wed Jun  7 20:46:43 2000
From: roybryant at SEVENtwentyfour.com (Roy Bryant)
Date: Fri Jan  9 22:02:20 2004
Subject: [mod_python] Broken link in www.modpython.org
Message-ID: <307EC3F394ACD311B959006008A30AD6BCDD9B@MAIL724>

There appears to be a problem on this page of your site.

    On your page
http://www.modpython.org/pipermail/mod_python/2000-June/000067.html
    when you click on your link to http://localhost/test/test.py.
    you get the error: Domain name lookup failed (may be a transient error)

As recommended by the Robot Guidelines, this email is to explain our robot's
activities and to let you know about one of the broken links we encountered.
LinkWalker does not store or publish the content of your pages, but rather
uses the link information to update our map of the World Wide Web.

Are these reports helpful? I'd love some feedback. If you prefer not to
receive these occasional error notices please let me know.

Roy Bryant

 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 Roy Bryant, roybryant@seventwentyfour.com
 President
 SEVENtwentyfour Inc. ("Always watching the Web")
 http://www.seventwentyfour.com
 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ 

From grisha at ispol.com  Thu Jun  8 09:53:32 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:20 2004
Subject: [mod_python] mod_python 2.3
Message-ID: <Pine.LNX.4.21.0006080946010.15265-100000@saturn.ispol.com>

Mod_python 2.3 is out.

There are two major changes in this one:

1. The PythonDebug, PythonInterpPerDirectory and PythonNoReload now
require an argument of On or Off. NOTE - THIS WILL REQUIRE YOU TO CHANGE
YOUR CONFIGS IF YOU'RE USING ANY OF THESE DIRECTIVES!!!

2. A new directive, PythonImport allows you to import modules at child
process initialization time. This is good for initializing database
connections, etc. Read the documentation for details.

For the future relelases, on my list are (in no particular order):

1. Ironing out the thread related issues so that mod_python works on
win32. 

2. ChildInit, ChildExit and Cleanup handlers.

3. Dynamic handler registration.

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com


From grisha at ispol.com  Thu Jun  8 09:57:48 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:20 2004
Subject: [mod_python] suggestions
Message-ID: <Pine.LNX.4.21.0006080953350.15265-100000@saturn.ispol.com>

If all goes well, I will be presenting about mod_python at the upcoming
Apachecon in London in October.

I'm looking for sugestions on topics that you think would be interesting
to cover. Imagine you were planning on attending the conference - what
would YOU like to know about mod_python?

Thanks,

Grisha



From sbi at acse.be  Thu Jun  8 17:28:31 2000
From: sbi at acse.be (=?Windows-1252?Q?St=E9phane_Bidoul?=)
Date: Fri Jan  9 22:02:20 2004
Subject: [mod_python] Another threading issue: chdir
Message-ID: <003b01bfd15e$33cb0f60$66a679c1@spirou>

Hi again,

Obviously, chdir is not thread-safe
(I discovered the problem by running different 
handlers in different directories)

It's ok with the one performed in cgihandler,
since cgi must run single-threaded anyway.

I wonder if the one in mod_python.c is really necessary?
Maybe apache.import_module() could add the directory to
pythonpath before doing the import instead of adding '.'.
Oh, and now that I write it, changing python path is 
not thread-safe either: can we do the import without
changing pythonpath at all? If not, another lock 
will be required to protect that...

There is also a chdir in the httpdapi handler
but I've no idea about that one.

Well, I hope the end of the threading tunnel is in sight...

-sbi
-------------- next part --------------
A non-text attachment was scrubbed...
Name: =?Windows-1252?Q?St=E9phane_Bidoul.vcf?=
Type: text/x-vcard
Size: 361 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20000608/ea5f5f9f/Windows-1252QStE9phane_Bidoul-0003.vcf
From grisha at ispol.com  Thu Jun  8 18:14:05 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:20 2004
Subject: [mod_python] Another threading issue: chdir (fwd)
Message-ID: <Pine.LNX.4.21.0006081813330.17090-100000@saturn.ispol.com>

Having the url directory as your current directory is just an intuitive
thing and makes it easier for the developer.... E.g. if you're trying to
open files, etc.

One thing that we could do is restore the original directory and make sure
that the lock is aqcuired before first chdir() and after the last chdir()?

Or chdir could be made optional via a directive of some sort.... I need to
think about this too...

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Thu, 8 Jun 2000, [Windows-1252] St?phane Bidoul wrote:

> Hi again,
> 
> Obviously, chdir is not thread-safe
> (I discovered the problem by running different 
> handlers in different directories)
> 
> It's ok with the one performed in cgihandler,
> since cgi must run single-threaded anyway.
> 
> I wonder if the one in mod_python.c is really necessary?
> Maybe apache.import_module() could add the directory to
> pythonpath before doing the import instead of adding '.'.
> Oh, and now that I write it, changing python path is 
> not thread-safe either: can we do the import without
> changing pythonpath at all? If not, another lock 
> will be required to protect that...
> 
> There is also a chdir in the httpdapi handler
> but I've no idea about that one.
> 
> Well, I hope the end of the threading tunnel is in sight...
> 
> -sbi
> 



From SBID at BXS.BE  Fri Jun  9 09:23:29 2000
From: SBID at BXS.BE (=?iso-8859-1?Q?St=E9phane_BIDOUL?=)
Date: Fri Jan  9 22:02:20 2004
Subject: [mod_python] Re: Another threading issue: chdir (fwd)
Message-ID: <C16998C688CDD31196D90008C7E690CB172343@EVRSRV04>

> Having the url directory as your current directory is just an intuitive
> thing and makes it easier for the developer.... E.g. if you're trying to
> open files, etc.

Agreed. OTOH, it is quite easy to obtain the module directory
with something like os.path.dirname(__file__).

> One thing that we could do is restore the original directory and make sure
> that the lock is aqcuired before first chdir() and after the last chdir()?

It would require another lock than the global interpreter lock because
that one can be released during execution. If another thread steps
in a that moment, the current directory could change in the middle of
a script...

But then it would degrade even native handlers to single-threading.

> Or chdir could be made optional via a directive of some sort.... I need to
> think about this too...

This option looks reasonable to me; 
the associated threading caveats could be documented easily.

Cheers

-sbi
sbi@acse.be
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20000609/a0168ad8/attachment-0003.htm
From grisha at ispol.com  Fri Jun  9 17:12:16 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:20 2004
Subject: [mod_python] Re: Another threading issue: chdir (fwd)
In-Reply-To: <C16998C688CDD31196D90008C7E690CB172342@EVRSRV04>
Message-ID: <Pine.LNX.4.21.0006091703340.21671-100000@saturn.ispol.com>

On Fri, 9 Jun 2000, St?phane BIDOUL wrote:

> > Or chdir could be made optional via a directive of some sort.... I need to
> > think about this too...
> 
> This option looks reasonable to me; 
> the associated threading caveats could be documented easily.

The more I think about this, the more it seems to me that doing away with
the chdir and prepending the path rather than the '.' is the way to go.

This will break old code that relied on the chdir being there, but what
can you do...

All the other solutions will make threaded mod_python incompatible with
nonthreaded be it extra directives or different code that you need....

Grisha



From daniel at copyleft.no  Sun Jun 11 14:44:00 2000
From: daniel at copyleft.no (Hr. Daniel Mikkelsen)
Date: Fri Jan  9 22:02:20 2004
Subject: [mod_python] make_obcallback(): could not import mod_python.apache.
Message-ID: <Pine.LNX.4.10.10006111434560.14419-100000@unity.copyleft.no>

Hi. 

I'm getting this error in my mail apache error_log when I try to start
httpd after having added mod_python 2.3 as a DSO:

make_obcallback(): could not import mod_python.apache.
make_obcallback(): could not call init.
[Sun Jun 11 14:33:49 2000] [error] python_init: get_obcallback returned no
  obCallBack. Possibly no more memory.

In version 2.2, I had the same problem (I switched to 2.3 while trying to
figure it out), with two exceptions. The last line in the error message
wasn't there, and apache didn't fail in starting (only in running .py test
files). 

Now, when I ran httpdapy, earlier, I had a very similar problem with
tracebacks about how it couldn't load certain python modules (apache.py
for instance), and apache failed to load in the same way. I solved the
problem by setting the PYTHONPATH correctly.

Changing PYTHONPATH doesn't seem to work now, however. I have the .py
files wich came with mod_python 2.3 in my
/usr/local/lib/python1.5/site-packages directory. I have compiled a
threadless python that expects (I assume, having given no --prefix=...
statement to its ./configure) to find scripts there. I've linked my
mod_python DSO with this verison of python. 

My setup is an OpenBSD 2.6 (using the apache that comes bundled), Python
1.5, enough memory (128Mb of which 81 are reported "free" byt top).

I'm trying to load the test.py given in the installation docs, and the
zhello.py given in the zhandler docs. 

Any ideas?

-- Daniel Mikkelsen, Copyleft Software


From grisha at ispol.com  Sun Jun 11 09:52:19 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:20 2004
Subject: [mod_python] make_obcallback(): could not import mod_python.apache.
In-Reply-To: <Pine.LNX.4.10.10006111434560.14419-100000@unity.copyleft.no>
Message-ID: <Pine.LNX.4.21.0006110951330.6729-100000@saturn.ispol.com>

If your Apache runs as nobody and the python library is not world
readable, you will get this error too.

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Sun, 11 Jun 2000, Hr. Daniel Mikkelsen wrote:

> Hi. 
> 
> I'm getting this error in my mail apache error_log when I try to start
> httpd after having added mod_python 2.3 as a DSO:
> 
> make_obcallback(): could not import mod_python.apache.
> make_obcallback(): could not call init.
> [Sun Jun 11 14:33:49 2000] [error] python_init: get_obcallback returned no
>   obCallBack. Possibly no more memory.
> 
> In version 2.2, I had the same problem (I switched to 2.3 while trying to
> figure it out), with two exceptions. The last line in the error message
> wasn't there, and apache didn't fail in starting (only in running .py test
> files). 
> 
> Now, when I ran httpdapy, earlier, I had a very similar problem with
> tracebacks about how it couldn't load certain python modules (apache.py
> for instance), and apache failed to load in the same way. I solved the
> problem by setting the PYTHONPATH correctly.
> 
> Changing PYTHONPATH doesn't seem to work now, however. I have the .py
> files wich came with mod_python 2.3 in my
> /usr/local/lib/python1.5/site-packages directory. I have compiled a
> threadless python that expects (I assume, having given no --prefix=...
> statement to its ./configure) to find scripts there. I've linked my
> mod_python DSO with this verison of python. 
> 
> My setup is an OpenBSD 2.6 (using the apache that comes bundled), Python
> 1.5, enough memory (128Mb of which 81 are reported "free" byt top).
> 
> I'm trying to load the test.py given in the installation docs, and the
> zhello.py given in the zhandler docs. 
> 
> Any ideas?
> 
> -- Daniel Mikkelsen, Copyleft Software
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From richard at whitequeen.com  Sun Jun 11 12:34:14 2000
From: richard at whitequeen.com (richard offer)
Date: Fri Jan  9 22:02:20 2004
Subject: [mod_python] problems with 2.0 -> 2.3 upgrade
Message-ID: <200006111934.e5BJYEB07387@erij.whitequeen.com>

Hi,

I upgraded from 2.0 to 2.3 this morning and am now seeing the following
error message in the webservers log file

[Sun Jun 11 12:23:33 2000] [notice] child pid 7340 exit signal Segmentation fault (11)
[Sun Jun 11 12:23:33 2000] [notice] child pid 7339 exit signal Segmentation fault (11)
[Sun Jun 11 12:23:35 2000] [notice] child pid 7343 exit signal Segmentation fault (11)
[Sun Jun 11 12:23:36 2000] [notice] child pid 7345 exit signal Segmentation fault (11)
[Sun Jun 11 12:23:36 2000] [notice] child pid 7344 exit signal Segmentation faul


It seems like all child webservers are dying, but the master is running
in a continous loop trying to spawn the children.


Moving the old (2.0) DSO and python code back into place fixed it.

[ Running Apache 1.3.12 on Redhat 6.1/2.2.16 ]


Any hints ?

richard.

-- 
richard offer @ home 
          84 FE 48 E4 74 D0 26 D4  31 8E B6 86 98 74 E2 7C  8A FB BF A3
___________________________________http://216.185.15.144/users/richard/

From grisha at ispol.com  Sun Jun 11 16:03:47 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:20 2004
Subject: [mod_python] problems with 2.0 -> 2.3 upgrade
In-Reply-To: <200006111934.e5BJYEB07387@erij.whitequeen.com>
Message-ID: <Pine.LNX.4.21.0006111558070.7904-100000@saturn.ispol.com>

Someone else reported this and I know what the problem is.

There are two things you can do:

1. downgrade to 2.2 and wait until 2.4
2. add a dummy PythonImport statement in the httpd.conf file between some
<Directory> tags, e.g.

PythonImport string

This is because I added the new PythonImport derective and did all the
testing and it worked fine, except when the directive is NOT specified and
thus the variable that holds the info is undefined.... Sorry, I'll be more
thorough next time!

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Sun, 11 Jun 2000, richard offer wrote:

> 
> Hi,
> 
> I upgraded from 2.0 to 2.3 this morning and am now seeing the following
> error message in the webservers log file
> 
> [Sun Jun 11 12:23:33 2000] [notice] child pid 7340 exit signal Segmentation fault (11)
> [Sun Jun 11 12:23:33 2000] [notice] child pid 7339 exit signal Segmentation fault (11)
> [Sun Jun 11 12:23:35 2000] [notice] child pid 7343 exit signal Segmentation fault (11)
> [Sun Jun 11 12:23:36 2000] [notice] child pid 7345 exit signal Segmentation fault (11)
> [Sun Jun 11 12:23:36 2000] [notice] child pid 7344 exit signal Segmentation faul
> 
> 
> It seems like all child webservers are dying, but the master is running
> in a continous loop trying to spawn the children.
> 
> 
> Moving the old (2.0) DSO and python code back into place fixed it.
> 
> [ Running Apache 1.3.12 on Redhat 6.1/2.2.16 ]
> 
> 
> Any hints ?
> 
> richard.
> 
> -- 
> richard offer @ home 
>           84 FE 48 E4 74 D0 26 D4  31 8E B6 86 98 74 E2 7C  8A FB BF A3
> ___________________________________http://216.185.15.144/users/richard/
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From wayne.izatt at myself.com  Sun Jun 11 13:46:08 2000
From: wayne.izatt at myself.com (Wayne Izatt)
Date: Fri Jan  9 22:02:20 2004
Subject: [mod_python] problems with 2.0 -> 2.3 upgrade
References: <200006111934.e5BJYEB07387@erij.whitequeen.com>
Message-ID: <3943FA8F.B7743662@myself.com>

richard offer wrote:

> Hi,
>
> I upgraded from 2.0 to 2.3 this morning and am now seeing the following
> error message in the webservers log file
>
> [Sun Jun 11 12:23:33 2000] [notice] child pid 7340 exit signal Segmentation fault (11)

<snip>

I get the same problem - same apache, same redhat.

<rant>

I'm getting sick and tired of these sorts of issues with redhat. I have apache problems
using PHP 4.0 with redhat, and mod_perl doesn't always work as expected on redhat.

</rant>


>
> It seems like all child webservers are dying, but the master is running
> in a continous loop trying to spawn the children.
>
> Moving the old (2.0) DSO and python code back into place fixed it.
>
> [ Running Apache 1.3.12 on Redhat 6.1/2.2.16 ]
>
> Any hints ?
>
> richard.
>
> --
> richard offer @ home
>           84 FE 48 E4 74 D0 26 D4  31 8E B6 86 98 74 E2 7C  8A FB BF A3
> ___________________________________http://216.185.15.144/users/richard/
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python


From sbi at acse.be  Mon Jun 12 23:06:03 2000
From: sbi at acse.be (=?iso-8859-1?Q?St=E9phane_Bidoul?=)
Date: Fri Jan  9 22:02:20 2004
Subject: [mod_python] Re: Another threading issue: chdir (fwd)
References: <Pine.LNX.4.21.0006091703340.21671-100000@saturn.ispol.com>
Message-ID: <00b401bfd4b2$0aed8a30$faa679c1@spirou>

>The more I think about this, the more it seems to me that doing away with
>the chdir and prepending the path rather than the '.' is the way to go.

Agreed, but I wonder how much the manipulation of sys.path to do the imports
can cause threading issues... Is it possible to avoid it?

>This will break old code that relied on the chdir being there, but what
>can you do...
>All the other solutions will make threaded mod_python incompatible with
>nonthreaded be it extra directives or different code that you need....

Cross platform compatibility is indeed important. To achive it people
should be told to assume multi-threaded operation: to be portable
to windows, and also to be Apache2-proof [since I understand that
it will use threads on Unix also; but it may not be a target for mod_python,
I don't know how different the API is].

-sbi




From gstein at lyra.org  Mon Jun 12 14:18:20 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 22:02:20 2004
Subject: [mod_python] Re: Another threading issue: chdir (fwd)
In-Reply-To: <00b401bfd4b2$0aed8a30$faa679c1@spirou>; from sbi@acse.be on Mon, Jun 12, 2000 at 11:06:03PM +0200
References: <Pine.LNX.4.21.0006091703340.21671-100000@saturn.ispol.com> <00b401bfd4b2$0aed8a30$faa679c1@spirou>
Message-ID: <20000612141820.R19484@lyra.org>

On Mon, Jun 12, 2000 at 11:06:03PM +0200, St?phane Bidoul wrote:
> >The more I think about this, the more it seems to me that doing away with
> >the chdir and prepending the path rather than the '.' is the way to go.
> 
> Agreed, but I wonder how much the manipulation of sys.path to do the imports
> can cause threading issues... Is it possible to avoid it?

sys.path is specific to an interpreter, rather than to a thread. Therefore,
threads should not be changing it.

> >This will break old code that relied on the chdir being there, but what
> >can you do...
> >All the other solutions will make threaded mod_python incompatible with
> >nonthreaded be it extra directives or different code that you need....
> 
> Cross platform compatibility is indeed important. To achive it people
> should be told to assume multi-threaded operation: to be portable
> to windows, and also to be Apache2-proof [since I understand that
> it will use threads on Unix also;

Correct. Apache 2.0 is threaded whenever threads are available (basically
everywhere nowadays). You can still run Apache 2.0 in its current mode, but
the default is threaded.

> but it may not be a target for mod_python,
> I don't know how different the API is].

The API is different enough; a 1.3 module can be ported, but it would be
reasonably difficult to have a module be compileable for both.

There are a number of other things that can be taken advantage of in the
Apache 2.0 API to improve/tighten the Apache/Python binding. I've been
planning to implement an Apache 2.0 specific "mod_py2" this summer to take
advantage of the 2.0 benefits. (as an Apache author, I can also make changes
to Apache to enhance this even further :-) In conjunction with that work,
I'm going to redo my "free threading patches" for 1.6 so that Python can
operate completely threaded within Apache 2.0 (e.g. the central lock
disappears entirely).

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/

From grisha at ispol.com  Mon Jun 12 17:30:14 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:20 2004
Subject: [mod_python] Re: Another threading issue: chdir (fwd)
In-Reply-To: <00b401bfd4b2$0aed8a30$faa679c1@spirou>
Message-ID: <Pine.LNX.4.21.0006121714500.12547-100000@saturn.ispol.com>

On Mon, 12 Jun 2000, St?phane Bidoul wrote:

> >The more I think about this, the more it seems to me that doing away with
> >the chdir and prepending the path rather than the '.' is the way to go.
> 
> Agreed, but I wonder how much the manipulation of sys.path to do the imports
> can cause threading issues... Is it possible to avoid it?

You could avoid it by making sure that the Pythonpath includes the
directory where your handlers are from the start, for example by setting
PYTHONPATH in the Apache startup script. But if we're going this route, we
might as well abandon the multiple interpreters.

Another problem with this is that typically you'll have to be root on the
system to restart Apache, and in many cases users are not.

On the upside, sys.path shouldn't get manipulated more than once. An
interpreter will get created and the sys.path changed upon the first hit,
after that it won't change. The sys.path manipualtion should be surrounded
by Python locks.

I have another idea - unless I'm missing something obvious, the way to
deal with this would be to add the directory to the path at interpreter
creation time in mod_python.c.

Grisha



From grisha at ispol.com  Mon Jun 12 17:48:08 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:20 2004
Subject: [mod_python] Re: Another threading issue: chdir (fwd)
In-Reply-To: <20000612141820.R19484@lyra.org>
Message-ID: <Pine.LNX.4.21.0006121740030.12547-100000@saturn.ispol.com>

On Mon, 12 Jun 2000, Greg Stein wrote:

> On Mon, Jun 12, 2000 at 11:06:03PM +0200, St?phane Bidoul wrote:
> > >The more I think about this, the more it seems to me that doing away with
> > >the chdir and prepending the path rather than the '.' is the way to go.
> > 
> > Agreed, but I wonder how much the manipulation of sys.path to do the imports
> > can cause threading issues... Is it possible to avoid it?
> 
> sys.path is specific to an interpreter, rather than to a thread. Therefore,
> threads should not be changing it.

On a related note though - is ap_table_set() thread-safe? I'm thinking of
all the Python* directives in .htaccess.

> as an Apache author, I can also make changes to Apache to enhance
> this even further :-)

Now that's luxury!

Grisha


From gstein at lyra.org  Mon Jun 12 14:57:19 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 22:02:20 2004
Subject: [mod_python] Re: Another threading issue: chdir (fwd)
In-Reply-To: <Pine.LNX.4.21.0006121740030.12547-100000@saturn.ispol.com>; from grisha@ispol.com on Mon, Jun 12, 2000 at 05:48:08PM -0400
References: <20000612141820.R19484@lyra.org> <Pine.LNX.4.21.0006121740030.12547-100000@saturn.ispol.com>
Message-ID: <20000612145719.U19484@lyra.org>

On Mon, Jun 12, 2000 at 05:48:08PM -0400, Gregory Trubetskoy wrote:
> On Mon, 12 Jun 2000, Greg Stein wrote:
>...
> > sys.path is specific to an interpreter, rather than to a thread. Therefore,
> > threads should not be changing it.
> 
> On a related note though - is ap_table_set() thread-safe? I'm thinking of
> all the Python* directives in .htaccess.

They are not thread-safe, but the only tables that would be changed are in
the request_rec and possibly the conn_rec. In other words: private to the
thread.

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/

From grisha at ispol.com  Mon Jun 12 18:23:28 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:20 2004
Subject: [mod_python] Re: Another threading issue: chdir (fwd)
In-Reply-To: <20000612145719.U19484@lyra.org>
Message-ID: <Pine.LNX.4.21.0006121818230.12547-100000@saturn.ispol.com>

On Mon, 12 Jun 2000, Greg Stein wrote:

> On Mon, Jun 12, 2000 at 05:48:08PM -0400, Gregory Trubetskoy wrote:
> > 
> > On a related note though - is ap_table_set() thread-safe? I'm thinking of
> > all the Python* directives in .htaccess.
> 
> They are not thread-safe, but the only tables that would be changed are in
> the request_rec and possibly the conn_rec. In other words: private to the
> thread.

Hmm.... But it might be a problem for PythonImport. PythonImport builds a
table a pointer to which is a global variable python_import. Then,
ChildInitHandler goes through that table and imports all the modules.

The reason PythonImport doesn't use the standard config stuff is that
ap_get_module_config() returns NULL inside a child init handler.

Am I taking the wrong apporach on this?

Grisha


From Mads at Kiilerich.com  Tue Jun 13 10:06:12 2000
From: Mads at Kiilerich.com (Mads Kiilerich)
Date: Fri Jan  9 22:02:20 2004
Subject: [mod_python] AttributeError: handler
In-Reply-To: <Pine.LNX.4.21.0006050938520.31412-100000@saturn.ispol.com>
Message-ID: <Pine.LNX.4.21.0006122243040.1325-100000@localhost>

Jun 5 I got mail from Gregory Trubetskoy:

> Everyone who reported this problem so far found later on that they had
> extra blanks in their test.py because they cut and pasted from the web
> page.

That makes me a speciel case. I found the solution to my problem
- and the problem wasn't spaces. 

The problem was that the PythonHandler I had specified wasn't in
the same directory as the directive was given in - thus the
handler couldn't be found.  I found this behaviour very
confusing - but now when I know it it starts to make sense! ;)

Correcting the path solved the problem. Another solution was to
add the PythonInterpPerDirectory directive.

Cheers,

-- 
Mads Kiilerich          Sys.Adm. Cand.Polyt
Mads@Kiilerich.com      Tel. +45 38 16 26 00  Mob. +45 26 20 07 73
M?ntmestervej 12B 1th,  DK-2400 NV,  Denmark

"Learned about WAP. It sucks. The more I play with WML the more sure I 
am that WAP will die out rapidly once phones doing HTML exist."    Cox




From Mads at Kiilerich.com  Tue Jun 13 10:07:07 2000
From: Mads at Kiilerich.com (Mads Kiilerich)
Date: Fri Jan  9 22:02:20 2004
Subject: [mod_python] AttributeError: handler
In-Reply-To: <20000605140841.29193.qmail@web2205.mail.yahoo.com>
Message-ID: <Pine.LNX.4.21.0006122249210.1325-100000@localhost>

Jun 5 I got mail from Alexis Iglauer:

> Always a good idea to just run python over your script
> before trying to run it on the webserver - this will
> pick up any inconsistent dedents or other little
> syntax nasties.

"Run python over".  How do I do that? With a compileall? (I
guess not, as performing a compileall gives a "Listing test.py
...\nCan't list test.py".)

TIA,
-- 
Mads Kiilerich          Sys.Adm. Cand.Polyt
Mads@Kiilerich.com      Tel. +45 38 16 26 00  Mob. +45 26 20 07 73
M?ntmestervej 12B 1th,  DK-2400 NV,  Denmark

"Learned about WAP. It sucks. The more I play with WML the more sure I 
am that WAP will die out rapidly once phones doing HTML exist."    Cox




From Mads at Kiilerich.com  Tue Jun 13 10:10:20 2000
From: Mads at Kiilerich.com (Mads Kiilerich)
Date: Fri Jan  9 22:02:20 2004
Subject: [mod_python] 2.2 is out
In-Reply-To: <Pine.LNX.4.21.0006041452530.28185-100000@saturn.ispol.com>
Message-ID: <Pine.LNX.4.21.0006131007280.904-200000@localhost>

Jun 4 I got mail from Gregory Trubetskoy:

> Also thanks to Gerhard Haering for the Suse RPM's. It'd be nice if someone
> came up and agreed to maintain with RedHat RPM, Debian package, a FreeBSD
> port and a Solaris package...

I've made a spec for RedHat, you'll find it attached. IMHO, if
you make a rpm and install it on a plain 6.2 system you'll get
something that works and can be used as a base for further
experiments.

Feedback is welcome!

Regards,

-- 
Mads Kiilerich          Sys.Adm. Cand.Polyt
Mads@Kiilerich.com      Tel. +45 38 16 26 00  Mob. +45 26 20 07 73
M?ntmestervej 12B 1th,  DK-2400 NV,  Denmark

"Learned about WAP. It sucks. The more I play with WML the more sure I 
am that WAP will die out rapidly once phones doing HTML exist."    Cox

-------------- next part --------------
Summary: The Python language for use with Apache.
Name: mod_python
Version: 2.2
Release: 0
Group: System Environment/Daemons
Source0: %{name}-%{version}.tgz
Copyright: BSD-ish???
BuildRoot: %{_tmppath}/%{name}-root
Requires: apache >= 1.3 , python >= 1.5.2
BuildPrereq: apache-devel 
Packager: Mads Kiilerich <mads@kiilerich.com>

%description
Mod_python allows embedding Python within the Apache http server for a
considerable boost in performance and added flexibility in designing web based
applications. 

The RPM installs a small example in /home/httpd/mod_python which can be
accessed as http://localhost/mod_python/some/path/which/doesn/t/matter

%prep
%setup -q -n mod_python-%{version}

%build
# 1. Installing Python Libraries
/usr/bin/python /usr/lib/python1.5/compileall.py lib/python/mod_python

# 2. Compiling -- Compiling mod_python as a DSO
apxs -I /usr/include/python1.5 -c src/mod_python.c \
	/usr/lib/python1.5/config/libpython1.5.a -lpthread

%install
rm -rf $RPM_BUILD_ROOT
install -D -s src/mod_python.so $RPM_BUILD_ROOT/usr/lib/apache/mod_python.so
mkdir -p $RPM_BUILD_ROOT/usr/lib/python1.5/site-packages/mod_python
install lib/python/mod_python/* \
	$RPM_BUILD_ROOT/usr/lib/python1.5/site-packages/mod_python
mkdir -p $RPM_BUILD_ROOT/home/httpd/mod_python
cat <<CAT>$RPM_BUILD_ROOT/home/httpd/mod_python/.htaccess
SetHandler python-program
PythonHandler pythonhandler
CAT
cat <<CAT>$RPM_BUILD_ROOT/home/httpd/mod_python/pythonhandler.py 
from mod_python import apache

def handler(req):
    req.send_http_header()
    req.write("Hello to the World from "+req.uri+"!")
    return apache.OK 
CAT

%clean
rm -rf $RPM_BUILD_ROOT

%post
grep -q 'LoadModule python_module' /etc/httpd/conf/httpd.conf || \
patch /etc/httpd/conf/httpd.conf <<CAT
*** httpd.conf.org      
--- httpd.conf  
***************
*** 206,207 ****
--- 206,208 ----
  # LoadModule foo_module modules/mod_foo.so
+ LoadModule python_module      modules/mod_python.so
  #LoadModule mmap_static_module modules/mod_mmap_static.so
***************
*** 253,254 ****
--- 254,256 ----
  ClearModuleList
+ AddModule mod_python.c
  #AddModule mod_mmap_static.c
***************
*** 965,966 ****
--- 967,974 ----
  
+ <IfModule mod_python.c>
+   Alias /mod_python/ /home/httpd/mod_python/
+   <Directory /home/httpd/mod_python>
+     AllowOverride FileInfo
+   </Directory>
+ </IfModule>
  ### Section 3: Virtual Hosts
CAT

%postun
perl -pi -e 's|^LoadModule python_module|#LoadModule python_module|g' \
 	/etc/httpd/conf/httpd.conf
perl -pi -e 's|^AddModule mod_python.c|#AddModule mod_python.c|g' \
	/etc/httpd/conf/httpd.conf

%files
%defattr(-,root,root)
%attr(0755,root,root) /usr/lib/apache/mod_python.so
/usr/lib/python1.5/site-packages/mod_python
/home/httpd/mod_python
%doc COPYRIGHT doc/*.html

%changelog
* Mon Jun 13 2000 Mads Kiilerich <mads@kiilerich.com>
- Made initial version of mod_python rpm
From sbi at acse.be  Tue Jun 13 19:08:18 2000
From: sbi at acse.be (=?iso-8859-1?Q?St=E9phane_Bidoul?=)
Date: Fri Jan  9 22:02:20 2004
Subject: [mod_python] Slashes...
Message-ID: <021c01bfd559$fdc62490$66a679c1@spirou>

A potential problem with slashes:
Windows NT accepts / or \, while Windows 9x accepts only \.

It means that with this directive:

<Directory "c:/soft/apache/htdocs/test2/">
  PythonHandler test2
</Directory>

mod_python ends up importing c:/soft/apache/htdocs/test2/\test2.py.

It works fine so it should not be an issue. 

Could it be an issue in get_request_object where the trailing
slash is first removed then added again? 
[I'm not sure to understand that area so I can't tell myself]

Maybe the functions from os.path should be used to be safe?

Also, I've found this in the apache doc:

<ApacheDocExcerpt>
The directives that accept filenames as arguments now must use Windows filenames instead of Unix ones. However, because Apache uses Unix-style names internally, you must use forward slashes, not backslashes. Drive letters can be used; if omitted, the drive with the Apache executable will be assumed.
</ApacheDocExcerpt>

So I'm not sure what is the right approach...

Regards.

-sbi



From sbi at acse.be  Tue Jun 13 19:07:53 2000
From: sbi at acse.be (=?iso-8859-1?Q?St=E9phane_Bidoul?=)
Date: Fri Jan  9 22:02:21 2004
Subject: [mod_python] Re: Another threading issue: chdir (fwd)
References: <Pine.LNX.4.21.0006121714500.12547-100000@saturn.ispol.com>
Message-ID: <020a01bfd559$eef3e470$66a679c1@spirou>

>I have another idea - unless I'm missing something obvious, the way to
>deal with this would be to add the directory to the path at interpreter
>creation time in mod_python.c.

I see nothing wrong with that either. 
I think is done already in ChildInitHandler when 
PythonImport is specified, so why not do it systematically.

-sbi





From gstein at lyra.org  Wed Jun 14 00:04:13 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 22:02:21 2004
Subject: [mod_python] mod_snake
Message-ID: <20000614000413.G27338@lyra.org>

fyi...

http://modsnake.sourceforge.net/

-- 
Greg Stein, http://www.lyra.org/

From richard at whitequeen.com  Tue Jun 13 05:35:59 2000
From: richard at whitequeen.com (richard offer)
Date: Fri Jan  9 22:02:21 2004
Subject: [mod_python] mod_snake
In-Reply-To: Greg Stein <gstein@lyra.org>
       "[mod_python] mod_snake" (Jun 14, 12:04am)
Message-ID: <200006131235.e5DCZxu10283@erij.whitequeen.com>

* $ from gstein@lyra.org at "14-Jun:12:04am" | sed "1,$s/^/* /" 
*
*
* fyi...
* 
* http://modsnake.sourceforge.net/

Has anyone played with it yet, pros ? cons ? I like the idea of moving
to Apache 2.0, and it seems to have reasonable documentation (probably
my biggest gripe about mod_python is the sparse docs).

On the other hand I'm close to getting something to show...

* Greg Stein, http://www.lyra.org/

richard.


-- 
richard offer @ home 
          84 FE 48 E4 74 D0 26 D4  31 8E B6 86 98 74 E2 7C  8A FB BF A3
___________________________________http://216.185.15.144/users/richard/

From grisha at ispol.com  Wed Jun 14 12:34:46 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:21 2004
Subject: [mod_python] mod_snake
In-Reply-To: <200006131235.e5DCZxu10283@erij.whitequeen.com>
Message-ID: <Pine.LNX.4.21.0006141233360.22477-100000@saturn.ispol.com>

On Tue, 13 Jun 2000, richard offer wrote:

> to Apache 2.0, and it seems to have reasonable documentation (probably
> my biggest gripe about mod_python is the sparse docs).

Hmmm... Everyone else said the documentation was very thorough. What do
think is missing?

Grisha


From sjbotha at email.com  Wed Jun 14 19:08:40 2000
From: sjbotha at email.com (Sarel J. Botha)
Date: Fri Jan  9 22:02:21 2004
Subject: [mod_python] Just displays
Message-ID: <20000614190839.A30053@home>

I'm having a bit of a problem with mod_python. The module gets loaded (I
can see in the logs), but when I access a .py file it just prints the
source.

I've got this in srm.conf:
AddHandler python-program .py

As far as I can tell, that's all that's needed, right?

Thanks
-- 
------------------
Sarel Botha
sjbotha@email.com
------------------

99 little bugs in the code, 99 bugs in the code,
          fix one bug, compile it again...
          101 little bugs in the code....


From richard at whitequeen.com  Tue Jun 13 07:35:21 2000
From: richard at whitequeen.com (richard offer)
Date: Fri Jan  9 22:02:21 2004
Subject: [mod_python] mod_snake
In-Reply-To: Gregory Trubetskoy <grisha@ispol.com>
       "Re: [mod_python] mod_snake" (Jun 14, 12:34pm)
Message-ID: <200006131435.e5DEZLM10444@erij.whitequeen.com>

* $ from grisha@ispol.com at "14-Jun:12:34pm" | sed "1,$s/^/* /" 
*
*
* 
* On Tue, 13 Jun 2000, richard offer wrote:
* 
* > to Apache 2.0, and it seems to have reasonable documentation (probably
* > my biggest gripe about mod_python is the sparse docs).
* 
* Hmmm... Everyone else said the documentation was very thorough. What do
* think is missing?

It took me a while to work out the relationship between the PythonHandler 
<entry> and the location of the file.py I wanted to run. I figured it out
eventually, but these are the sorts of questions that need to be obvious,
sicne they are only met by first time users (when I was a system manager, 
if it took me any longer than an 1/2 day to get a piece of software working,
it went to the the bottome the queue---under those rules I'd be using 
php now).

There are no function prototypes in the docs, it took me a while to
figure out that req.read() needed a length argument.

I have to refer to the Apache C docs to work out what members I can use
in the request structure.

The examples are too short, something demonstrating the handling of url
args would have saved me a day, needing to test for req.method as well
as req.args is more hassle. 

I hope to publish my code in the next few weeks (interface to a MySQL 
image database with search etc), maybe just a few contributed demos
would help. I'd like to see some drop in contributed modules like
php/mod_perl has.


Now I admit that I'm new to this (web programming) but I'm a self taught C
OS programmer, so if I can waste days in figuring it out, this isn't CP4E.

Please don't take the above as anything but constructive critism, I like
mod_python, it got me off my ass and working on the web site which I'd
been postponing for months, and for that I'm grateful.

* 
* Grisha
* 

richard.


-- 
richard offer @ home 
          84 FE 48 E4 74 D0 26 D4  31 8E B6 86 98 74 E2 7C  8A FB BF A3
___________________________________http://216.185.15.144/users/richard/

From martin at src.no  Thu Jun 15 10:48:12 2000
From: martin at src.no (Martin Jenssen)
Date: Fri Jan  9 22:02:21 2004
Subject: [mod_python] Difficulties with Windows NT/Apache/mod_python
Message-ID: <Pine.LNX.4.21.0006151030550.23457-100000@lade.src.no>

Hello,

I am getting some strange messages when trying to setup Apache with
mod_python on Windows NT.  I used the precompiled binary of mod_python 2.2
as found on http://www.modpython.org/, the precompiled binary of Apache
1.3.12 as found on http://www.apache.org/ and Windows NT 4.0 Server.

When I try to start Apache with mod_python configured as specified in the
documentation, I get these messages:

"""
make_obcallback(): could not import mod_python.apache.
make_obcallback(): could not call init.
Apache/1.3.12 (Win32) mod_python/2.2 Python/1.5.2 running...
"""

Strangely, it doesn't quit, but continues to try to serve web pages.  For
each .py file I try to reach via the web browser, I get these messages
thrown into the error.log file:

"""
[Thu Jun 15 10:37:45 2000] [error] [client 193.71.134.144] \
	python_handler: get_obcallback returned no obCallBack!
"""


Martin Jenssen


From daniel at copyleft.no  Thu Jun 15 11:03:42 2000
From: daniel at copyleft.no (Hr. Daniel Mikkelsen)
Date: Fri Jan  9 22:02:21 2004
Subject: [mod_python] Difficulties with Windows NT/Apache/mod_python
In-Reply-To: <Pine.LNX.4.21.0006151030550.23457-100000@lade.src.no>
Message-ID: <Pine.LNX.4.10.10006151100460.6024-100000@unity.copyleft.no>

> make_obcallback(): could not import mod_python.apache.
> make_obcallback(): could not call init.
> Apache/1.3.12 (Win32) mod_python/2.2 Python/1.5.2 running...

I got these messages when I copied the _files_ in the
lib/python/mod_python dir into site-packages, instead 
of copying the entire _directory_, by mistake. 

Anyway, it's a problem of your python interpreter not 
finding the mod_python modules. Use PYTHONPATH in the 
environment or PythonPath in the apache.conf. 

-- Daniel Mikkelsen, Copyleft Software



From grisha at ispol.com  Thu Jun 15 07:44:04 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:21 2004
Subject: [mod_python] Difficulties with Windows NT/Apache/mod_python
In-Reply-To: <Pine.LNX.4.21.0006151030550.23457-100000@lade.src.no>
Message-ID: <Pine.LNX.4.21.0006150742280.28199-100000@saturn.ispol.com>

Sounds to me like the mod_python package is not in your pythonpath.

BTW, the win32 binary is unstable because of some thread problems. 2.4
should be considerably more stable and will come out in a couple of days.

Grisha

On Thu, 15 Jun 2000, Martin Jenssen wrote:

> Hello,
> 
> I am getting some strange messages when trying to setup Apache with
> mod_python on Windows NT.  I used the precompiled binary of mod_python 2.2
> as found on http://www.modpython.org/, the precompiled binary of Apache
> 1.3.12 as found on http://www.apache.org/ and Windows NT 4.0 Server.
> 
> When I try to start Apache with mod_python configured as specified in the
> documentation, I get these messages:
> 
> """
> make_obcallback(): could not import mod_python.apache.
> make_obcallback(): could not call init.
> Apache/1.3.12 (Win32) mod_python/2.2 Python/1.5.2 running...
> """
> 
> Strangely, it doesn't quit, but continues to try to serve web pages.  For
> each .py file I try to reach via the web browser, I get these messages
> thrown into the error.log file:
> 
> """
> [Thu Jun 15 10:37:45 2000] [error] [client 193.71.134.144] \
> 	python_handler: get_obcallback returned no obCallBack!
> """
> 
> 
> Martin Jenssen
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From sjbotha at email.com  Thu Jun 15 21:54:59 2000
From: sjbotha at email.com (Sarel J. Botha)
Date: Fri Jan  9 22:02:21 2004
Subject: [mod_python] Re: Just displays
In-Reply-To: <20000614190839.A30053@home>; from  on Wed, Jun 14, 2000 at 07:08:40PM +0200
References: <20000614190839.A30053@home>
Message-ID: <20000615215457.A9676@home>

On Wed, Jun 14, 2000 at 07:08:40PM +0200, I wrote:
> I'm having a bit of a problem with mod_python. The module gets loaded (I
> can see in the logs), but when I access a .py file it just prints the
> source.

I still can't get it working.

I've got LoadModule python_module /usr/local/lib/apache/1.3/mod_python.so
in httpd.conf and the module loads, as I can see it in the logs:
[Thu Jun 15 21:40:52 2000] [notice] Apache/1.3.12 (Unix) Debian/GNU PHP/4.0RC1 mod_python/2.2 Python/1.5.2 configured -- resuming normal operations

I've got this in srm.conf:
  AddHandler python-program .py

It just prints the file, as if the AddHandler directive weren't there.

Thanks
-- 
------------------
Sarel Botha
sjbotha@email.com
------------------

99 little bugs in the code, 99 bugs in the code,
          fix one bug, compile it again...
          101 little bugs in the code....


From grisha at ispol.com  Thu Jun 15 18:00:31 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:21 2004
Subject: [mod_python] Re: Just displays
In-Reply-To: <20000615215457.A9676@home>
Message-ID: <Pine.LNX.4.21.0006151759230.28199-100000@saturn.ispol.com>

On Thu, 15 Jun 2000, Sarel J. Botha wrote:

> On Wed, Jun 14, 2000 at 07:08:40PM +0200, I wrote:
> 
> I've got this in srm.conf:
>   AddHandler python-program .py
> 
> It just prints the file, as if the AddHandler directive weren't there.

Are you sure your srm.conf file is being read at all? Move the directive
into httpd.conf. srm.conf is obsolete and shouldn't be used anyway.

Grisha


From sjbotha at email.com  Fri Jun 16 02:29:10 2000
From: sjbotha at email.com (Sarel J. Botha)
Date: Fri Jan  9 22:02:21 2004
Subject: [mod_python] Re: Just displays
In-Reply-To: <Pine.LNX.4.21.0006151759230.28199-100000@saturn.ispol.com>; from grisha@ispol.com on Thu, Jun 15, 2000 at 06:00:31PM -0400
References: <20000615215457.A9676@home> <Pine.LNX.4.21.0006151759230.28199-100000@saturn.ispol.com>
Message-ID: <20000616022908.A11353@home>

On Thu, Jun 15, 2000 at 06:00:31PM -0400, Gregory Trubetskoy wrote:
> Are you sure your srm.conf file is being read at all? Move the directive
> into httpd.conf. srm.conf is obsolete and shouldn't be used anyway.

That's great to hear. I've always thought it was a bit silly to have so
many different config files.

It is reading srm.conf, I just added a .cgi Handler and it works. Without
it, it doesn't.

Thanks
-- 
------------------
Sarel Botha
sjbotha@email.com
------------------

99 little bugs in the code, 99 bugs in the code,
          fix one bug, compile it again...
          101 little bugs in the code....


From geoff at ijane.com  Fri Jun 16 10:54:15 2000
From: geoff at ijane.com (geoff@ijane.com)
Date: Fri Jan  9 22:02:21 2004
Subject: [mod_python] python rewrite of mod_usertrack
Message-ID: <20000616155414.IQGO860.mta1biz.bizmailsrvcs.net@web1biz.bizmailsrvcs.net>

Here is a first pass at a session tracking module using mod_python.
It is basically a mod_usertrack rip-off.
Let me know what you think.
-geoff greenberg

From geoff at ijane.com  Fri Jun 16 11:19:33 2000
From: geoff at ijane.com (geoff@ijane.com)
Date: Fri Jan  9 22:02:21 2004
Subject: [mod_python] python rewrite of mod_usertrack (actual module this time)
Message-ID: <20000616161933.ANH135729.mta1biz.bizmailsrvcs.net@web1biz.bizmailsrvcs.net>

Sorry.
I didn't realize that attachment didn't work.
Here is the module (usertrack.py):

"""This module is a shameless rewrite of mod_usertrack in python.  It should
operate in most respects like mod_usertrack.  The exception would be that it
always sets a 4 digit year for an expire date.

Logging
This will be handled by mod_log_config, the custom log module.  The cookie
will be available by using the token, "%{session_cookie}n".
For example:

LogFormat "%t \"%r\" %>s \"%{session_cookie}n\"" session
CustomLog /usr/local/apache/logs/session_log session

PythonOptions
There are three options that can be configured: CookieExpires, CookieName
and CookieTracking.   These basically work the same as mod_usertrack's
directives of the same name.

CookieExpires
This option sets an expiration time for the cookie generated by this module.
This time can be either a number of seconds or a string describing the
amount of time.  If this option does not exist the cookie will expire when
the browser's session does.  The time string must be quoted and is in the
format of a space separeated list of "number label" pairs.  Valid labels
are: years, months, weeks, days, hours, minutes, seconds.

CookieName
If this option exists the default name of the cookie will be whatever the
label specifies.

CookieTracking
This option is required if you will to use this module.  It's value must be
"on" for this module to operate.


httpd.conf example:

<Directory />
    PythonPath "['/usr/lib/python1.5', '/usr/lib/python1.5/site-packages']"

    PythonDebug
    PythonOption CookieName k3WL_c00KI3_nAM3
    PythonOption CookieTracking on
    PythonOption CookieExpires "10 years 4 months 2 weeks 3 days 2 hours 36
seconds"
    PythonFixupHandler usertrack
</Directory>

"""
__version__ = "$Id: usertrack.py,v 1.1 2000/06/02 09:00:31 geoff Exp $"
from mod_python import apache
import re, string, time, os

isDigit = re.compile("^\d+$")
isSpace = re.compile("\s+")

FACTOR = {
    'years': 60 * 60 * 24 * 365,
    'months': 60 * 60 * 24 * 30,
    'weeks': 60 * 60 * 24 * 7,
    'days': 60 * 60 * 24,
    'hours': 60 * 60,
    'minutes': 60,
    'seconds': 1,
    }            

COOKIE_NAME = "Apache_Python"

def fixuphandler(r):
    global COOKIE_NAME
    opt = r.get_options()
    if opt['CookieTracking'] != 'on':
        return apache.DECLINED
    else:
        if opt.has_key('CookieName'): COOKIE_NAME = opt['CookieName']
        try:
            m = re.search("(?:^|\s+)%s=(?P<cookieValue>[^;]+)" %
COOKIE_NAME, \
                          r.headers_in['Cookie'])
            r.notes['session_cookie'] = m.group('cookieValue')
            return apache.DECLINED
        except:
            expires = 0
            if opt.has_key('CookieExpires'):
                expires = r.request_time + \
                                 parseExpire(opt['CookieExpires'])
            make_cookie(r, COOKIE_NAME, expires)
    return apache.OK
        
def make_cookie(r, name, expires):
    """Set a unique cookie for user tracking."""
    cookieValue = "%s.%d%ld%ld" % (r.hostname, os.getpid(), r.request_time,
\
                                   time.clock())
    if expires == 0:
        r.headers_out['Set-Cookie'] = "%s=%s; path=/" % (name, \
                                                         cookieValue)
    else:
        r.headers_out['Set-Cookie'] = "%s=%s; path=/; expires=%s GMT" % \
            (name, cookieValue, time.strftime("%A, %d-%b-%Y %H:%M:%S", \
            time.gmtime(expires)))  
    r.notes['session_cookie'] = cookieValue
    return

def parseExpire(expire):
    """Return number of seconds from a formated string."""
    if isDigit.search(expire): return expire
    seconds = 0
    t = isSpace.split(expire)
    tLen = len(t)
    i = 0
    while i < tLen:
        if isDigit.search(t[i]):
            seconds = seconds + (FACTOR.get(string.lower(t[i + 1]), 0) * \
                                 string.atoi(t[i]))
        i = i + 2
    return seconds

From grisha at ispol.com  Fri Jun 16 12:43:43 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:21 2004
Subject: [mod_python] python rewrite of mod_usertrack (actual module this
 time)
In-Reply-To: <20000616161933.ANH135729.mta1biz.bizmailsrvcs.net@web1biz.bizmailsrvcs.net>
Message-ID: <Pine.LNX.4.21.0006161243020.1238-100000@saturn.ispol.com>

Nice work!

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Fri, 16 Jun 2000 geoff@ijane.com wrote:

> Sorry.
> I didn't realize that attachment didn't work.
> Here is the module (usertrack.py):
> 
> """This module is a shameless rewrite of mod_usertrack in python.  It should
> operate in most respects like mod_usertrack.  The exception would be that it


From jam at quark.emich.edu  Sat Jun 17 10:33:54 2000
From: jam at quark.emich.edu (Jeff)
Date: Fri Jan  9 22:02:21 2004
Subject: [mod_python] release of 2.4 or CVS access
Message-ID: <20000617103354.A3690@quark.emich.edu>

Greetings,

I'd like to do some work with mod_python.. I noticed on the website that 2.3
has a bug that will be fixed in 2.4. 

when and where can I find 2.4? is there a CVS repository I can check out the
code from? what's the bug in 2.3 that's so nasty?

regards,
J
-- 
|| visit gfd <http://quark.emich.edu/>
|| psa member -- <http://www.python.org/psa/> 

From grisha at ispol.com  Sat Jun 17 11:15:51 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:21 2004
Subject: [mod_python] release of 2.4 or CVS access
In-Reply-To: <20000617103354.A3690@quark.emich.edu>
Message-ID: <Pine.LNX.4.21.0006171111280.5577-100000@saturn.ispol.com>

On Sat, 17 Jun 2000, Jeff wrote:

> when and where can I find 2.4? 

when - whenever it is done. Some time next week.

where - same place as 2.2 :-)

> is there a CVS repository I can check out the code from? 

there is a CVS repository, but only I have access to it.... I'm
considering putting it out on sourceforge.

> what's the bug in 2.3 that's so nasty?

It basically won't run. You can still download it from the same place as
2.2 - just substitute 2.2 for 2.3. 

Regards - 

Grisha


From jam at quark.emich.edu  Sat Jun 17 11:26:00 2000
From: jam at quark.emich.edu (Jeff)
Date: Fri Jan  9 22:02:21 2004
Subject: [mod_python] access to ap_send_fd from python
Message-ID: <20000617112600.D5135@quark.emich.edu>

Greetings,

I was looking through the API documentation and found the ap_send_fd
function (http://dev.apache.org/apidoc/apidoc_ap_send_fd.html). It's purpose
is to send the contents of a FILE* to the client. 

This seems appropriate when static files need to be served-- decode the URL
the client is asking for, open the file, set the appropriate headers
(content-type in particular), call this function, then close the file. This
moves the 'work' of sending the file into the C code, instead of using
Python, which would seem to be quite a bit faster.

Could this be considered for a future releases of mod_python? 

Are there any issues I should be aware of before trying to get it to work?

Regards,
J
-- 
|| visit gfd <http://quark.emich.edu/>
|| psa member -- <http://www.python.org/psa/> 

From jam at quark.emich.edu  Sat Jun 17 11:30:55 2000
From: jam at quark.emich.edu (Jeff)
Date: Fri Jan  9 22:02:21 2004
Subject: [mod_python] release of 2.4 or CVS access
In-Reply-To: <Pine.LNX.4.21.0006171111280.5577-100000@saturn.ispol.com>; from grisha@ispol.com on Sat, Jun 17, 2000 at 11:15:51AM -0400
References: <20000617103354.A3690@quark.emich.edu> <Pine.LNX.4.21.0006171111280.5577-100000@saturn.ispol.com>
Message-ID: <20000617113055.E5135@quark.emich.edu>

On Sat, Jun 17, 2000 at 11:15:51AM -0400, Gregory Trubetskoy wrote:
> 
> On Sat, 17 Jun 2000, Jeff wrote:
> 
> > when and where can I find 2.4? 
> 
> when - whenever it is done. Some time next week.
> 

clearly ;) I got the impression that it was a simple problem of a NULL
pointer and so should be fairly easy to fix. I assume this means there will
be more than just this change in 2.4? what's on the list?

Regards,
J
-- 
|| visit gfd <http://quark.emich.edu/>
|| psa member -- <http://www.python.org/psa/> 

From grisha at ispol.com  Sat Jun 17 16:04:00 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:21 2004
Subject: [mod_python] release of 2.4 or CVS access
In-Reply-To: <20000617113055.E5135@quark.emich.edu>
Message-ID: <Pine.LNX.4.21.0006171602350.6292-100000@saturn.ispol.com>

On Sat, 17 Jun 2000, Jeff wrote:

> clearly ;) I got the impression that it was a simple problem of a NULL
> pointer and so should be fairly easy to fix. I assume this means there will
> be more than just this change in 2.4? what's on the list?

Not much really.

It should work cleanly on Win32 (multithreaded) and then I'm trying add a
tutorial to the documentation.

Grisha


From seant at alum.mit.edu  Sun Jun 18 15:08:15 2000
From: seant at alum.mit.edu (Sean True)
Date: Fri Jan  9 22:02:21 2004
Subject: [mod_python] mod_python style redirection.
Message-ID: <4.3.2.7.2.20000618150623.00bb75f0@pop.ne.mediaone.net>

Any one care to suggest a mod_python appropriate way to redirect a request 
to another page? The ap_internal_redirect() function looks
appropriate but does not seem to be wrapped.

TIA.

-- Sean

==========
Sean True
seant@alum.mit.edu


From grisha at ispol.com  Sun Jun 18 16:11:31 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:21 2004
Subject: [mod_python] mod_python style redirection.
In-Reply-To: <4.3.2.7.2.20000618150623.00bb75f0@pop.ne.mediaone.net>
Message-ID: <Pine.LNX.4.21.0006181608100.19774-100000@saturn.ispol.com>

Something like this should work:

	req.headers_out["Location"] = "http://www.redirectto.com/"
	return apache.HTTP_MOVED_TEMPORARILY

Grisha

On Sun, 18 Jun 2000, Sean True wrote:

> Any one care to suggest a mod_python appropriate way to redirect a request 
> to another page? The ap_internal_redirect() function looks
> appropriate but does not seem to be wrapped.
> 
> TIA.
> 
> -- Sean
> 
> ==========
> Sean True
> seant@alum.mit.edu
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From grisha at ispol.com  Tue Jun 20 11:23:41 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:21 2004
Subject: [mod_python] mod_python 2.4
Message-ID: <Pine.LNX.4.21.0006201117090.27023-100000@saturn.ispol.com>

Mod_python 2.4 is out. Unlike 2.3, this one should work ;-).

There are some major changes since 2.2:

1. The PythonDebug, PythonInterpPerDirectory and PythonNoReload now
require an argument of On or Off. NOTE - THIS WILL REQUIRE YOU TO CHANGE
YOUR CONFIGS IF YOU'RE USING ANY OF THESE DIRECTIVES!!!

2. A new directive, PythonImport allows you to import modules at child
process initialization time. This is good for initializing database
connections, etc, though this approach has some serious limitations. Read
the documentation for details.

3. We think that most thread-related issues have been resolved and that
mod_python is capable of running stably on Win32. There is a Win32
(i3866) DLL binary available for download. A lot of very valuable input
and work on this was done by St?phane Bidoul and Greg Stein.

4. I tried to improve the docuemntation. All mod_python objects are now
documented down to every single attribute, and there is a small tutorial
started. The tutorial will need some improvements - e.g. examples of
how to deal with forms or cookies.

Regards -

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com



From jam at quark.emich.edu  Tue Jun 20 11:25:48 2000
From: jam at quark.emich.edu (Jeff)
Date: Fri Jan  9 22:02:21 2004
Subject: [mod_python] attempting to download 2.4 -- permission denied.
Message-ID: <20000620112548.A15890@quark.emich.edu>

Greetings,

I tried to download v2.4 just now, and I get a 'permission denied' error.
Could you have a look into this issue?

Thanks!

Regards,
J
-- 
|| visit gfd <http://quark.emich.edu/>
|| psa member -- <http://www.python.org/psa/> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 232 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20000620/a1382baa/attachment-0003.bin
From jam at quark.emich.edu  Tue Jun 20 11:36:39 2000
From: jam at quark.emich.edu (Jeff)
Date: Fri Jan  9 22:02:21 2004
Subject: [mod_python] attempting to download 2.4 -- permission denied.
In-Reply-To: <20000620112548.A15890@quark.emich.edu>; from jam@quark.emich.edu on Tue, Jun 20, 2000 at 11:25:48AM -0400
References: <20000620112548.A15890@quark.emich.edu>
Message-ID: <20000620113639.B15890@quark.emich.edu>

On Tue, Jun 20, 2000 at 11:25:48AM -0400, Jeff wrote:
> Greetings,
> 
> I tried to download v2.4 just now, and I get a 'permission denied' error.
> Could you have a look into this issue?
> 
> Thanks!
> 


it's fixed now, carry on ;)

-- 
|| visit gfd <http://quark.emich.edu/>
|| psa member -- <http://www.python.org/psa/> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 232 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20000620/e0661a03/attachment-0003.bin
From xbouska at infima.cz  Tue Jun 20 18:23:24 2000
From: xbouska at infima.cz (Richard Bouska)
Date: Fri Jan  9 22:02:21 2004
Subject: [mod_python] mod_python does not interoperate with CORBA (omniORB)
Message-ID: <20000620182324.E26145@intranet>

Hello

I am trying to convert one of my project from single threaded corba
server (ILU from PARC XEROX) to multithreaded (omniORB 3.0 FROM at&t). 
But I am unable to use the mod_python due some problems with threads.

The script runs fine as a CGI but when I try use mod_python it stucks in 

corba_init call. It freeses before it transfers any byte through the 
iiop protocol.

When I let the apache live in only one thread - apache -X then 
everything 
workes well.

Has anoybody some idea what I shell try?

configuration:

Linux 2.2.12 - debian potato 
mod_python 2.2 (2.4) - I try both - dynamicaly linked  
omniORB 3.0 - beta from CVS
apache 1.3.12


PS: I was using the PyApache and leave it because I thaught that the 
problem 
with omniORB is caused by  some problem in it - but now I dot know 
because both
mod_python and PyApache have the same problem.

Thank You in advance

Richard Bouska
Richard@Bouska.cz


From Howard.Williams at marchFIRST.com  Tue Jun 20 15:46:53 2000
From: Howard.Williams at marchFIRST.com (Howard Williams)
Date: Fri Jan  9 22:02:21 2004
Subject: [mod_python] (no subject)
Message-ID: <002701bfdb09$6e69cf80$1d0eaad1@edalearning.com>

Hi

I've just installed the mod_python using all the latest source code for
apache, python, and from the modpython.org site.

I can't seem to run the tester:

My directories are laid out as follows:

/usr/local/lib/python1.5/site-packages/mod_python/apache.py
/usr/local/lib/python1.5/site-packages/mod_python/
/usr/local/lib/python1.5/site-packages/mod_python/
/usr/local/lib/python1.5/site-packages/mod_python/
/usr/local/lib/python1.5/site-packages/mod_python/


ERROR mod_python: "PythonHandler test"

Traceback (innermost last):

  File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line
96, in Dispatch
    object = self.resolve_object(module, object_str)

  File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line
42, in resolve_object
    obj = getattr(obj, obj_str)

AttributeError: handler


HOWARD WILLIAMS
marchFIRST
23422 Mill Creek Drive., Suite 100
Laguna Hills, CA 92653
ph: (949) 461-5480
fax: (949) 461-5669
howard.williams@marchFIRST.com
www.marchFIRST.com


-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20000620/a50b964a/attachment-0003.htm
From Howard.Williams at marchFIRST.com  Tue Jun 20 16:00:26 2000
From: Howard.Williams at marchFIRST.com (Howard Williams)
Date: Fri Jan  9 22:02:21 2004
Subject: [mod_python] test doesn't work
Message-ID: <003d01bfdb0b$52f1e150$1d0eaad1@edalearning.com>

Hi

I've just installed the mod_python using all the latest source code for
apache, python, and from the modpython.org site.

I can't seem to run the tester:  So I've seen some postings from last month
about this with a similar "AttributeError: handler" title, but they didn't
seem to apply.

When I run "python test.py" (which I'm not convinced is supposed to be
possible) from a command line, I get the following output to stderr:
***********************************************************
Traceback (innermost last):
  File "test.py", line 1, in ?
    from mod_python import apache
  File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line
18, in ?
    import _apache
ImportError: No module named _apache

***********************************************************


My directories are laid out as follows:

/usr/local/lib/python1.5/site-packages/mod_python/apache.py
/usr/local/lib/python1.5/site-packages/mod_python/apache.pyc
/usr/local/lib/python1.5/site-packages/mod_python/cgihandler.py
/usr/local/lib/python1.5/site-packages/mod_python/cgihandler.pyc
/usr/local/lib/python1.5/site-packages/mod_python/httpdapi.py
/usr/local/lib/python1.5/site-packages/mod_python/httpdapi.pyc
/usr/local/lib/python1.5/site-packages/mod_python/zhandler.py
/usr/local/lib/python1.5/site-packages/mod_python/zhandler.pyc


I get this error:
*********************************
ERROR mod_python: "PythonHandler test"

Traceback (innermost last):

  File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line
96, in Dispatch
    object = self.resolve_object(module, object_str)

  File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line
42, in resolve_object
    obj = getattr(obj, obj_str)

AttributeError: handler
************************************************


Here's the apache error_log:
************************************************
[Tue Jun 20 15:47:37 2000] [notice] Apache/1.3.12 (Unix) configured --
resuming normal operations
[Tue Jun 20 15:47:46 2000] [error] PythonHandler test: Traceback (innermost
last):
[Tue Jun 20 15:47:46 2000] [error] PythonHandler test:   File
"/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 96, in
Dispatch
    object = self.resolve_object(module, object_str)
[Tue Jun 20 15:47:46 2000] [error] PythonHandler test:   File
"/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 42, in
resolve_object
    obj = getattr(obj, obj_str)
[Tue Jun 20 15:47:46 2000] [error] PythonHandler test: AttributeError:
handler
************************************************



 Thanks for any help you can provide !!!!   :)


HOWARD WILLIAMS
marchFIRST
23422 Mill Creek Drive., Suite 100
Laguna Hills, CA 92653
ph: (949) 461-5480
fax: (949) 461-5669
howard.williams@marchFIRST.com
www.marchFIRST.com

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20000620/0305da7e/attachment-0003.htm
From grisha at ispol.com  Tue Jun 20 21:41:20 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:21 2004
Subject: [mod_python] test doesn't work
In-Reply-To: <003d01bfdb0b$52f1e150$1d0eaad1@edalearning.com>
Message-ID: <Pine.LNX.4.21.0006202138080.28773-100000@saturn.ispol.com>

There is a module _apache which is only available from within
mod_python. However, if you comment out the 

from mod_python import apache

line, you should be able to import it from the command line.

I'm a little puzzled by this error, since everyone who has experienced it
never gave any logical reason as to what they did to fix this. It seems to
go away magically after they mes around for a while.

I am almost certain that this is caused by

1. a syntax error in test.py
2. a permissions problem

Grisha

On Tue, 20 Jun 2000, Howard Williams wrote:

> Hi
> 
> I've just installed the mod_python using all the latest source code for
> apache, python, and from the modpython.org site.
> 
> I can't seem to run the tester:  So I've seen some postings from last month
> about this with a similar "AttributeError: handler" title, but they didn't
> seem to apply.
> 
> When I run "python test.py" (which I'm not convinced is supposed to be
> possible) from a command line, I get the following output to stderr:
> ***********************************************************
> Traceback (innermost last):
>   File "test.py", line 1, in ?
>     from mod_python import apache
>   File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line
> 18, in ?
>     import _apache
> ImportError: No module named _apache
> 
> ***********************************************************
> 
> 
> My directories are laid out as follows:
> 
> /usr/local/lib/python1.5/site-packages/mod_python/apache.py
> /usr/local/lib/python1.5/site-packages/mod_python/apache.pyc
> /usr/local/lib/python1.5/site-packages/mod_python/cgihandler.py
> /usr/local/lib/python1.5/site-packages/mod_python/cgihandler.pyc
> /usr/local/lib/python1.5/site-packages/mod_python/httpdapi.py
> /usr/local/lib/python1.5/site-packages/mod_python/httpdapi.pyc
> /usr/local/lib/python1.5/site-packages/mod_python/zhandler.py
> /usr/local/lib/python1.5/site-packages/mod_python/zhandler.pyc
> 
> 
> I get this error:
> *********************************
> ERROR mod_python: "PythonHandler test"
> 
> Traceback (innermost last):
> 
>   File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line
> 96, in Dispatch
>     object = self.resolve_object(module, object_str)
> 
>   File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line
> 42, in resolve_object
>     obj = getattr(obj, obj_str)
> 
> AttributeError: handler
> ************************************************
> 
> 
> Here's the apache error_log:
> ************************************************
> [Tue Jun 20 15:47:37 2000] [notice] Apache/1.3.12 (Unix) configured --
> resuming normal operations
> [Tue Jun 20 15:47:46 2000] [error] PythonHandler test: Traceback (innermost
> last):
> [Tue Jun 20 15:47:46 2000] [error] PythonHandler test:   File
> "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 96, in
> Dispatch
>     object = self.resolve_object(module, object_str)
> [Tue Jun 20 15:47:46 2000] [error] PythonHandler test:   File
> "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 42, in
> resolve_object
>     obj = getattr(obj, obj_str)
> [Tue Jun 20 15:47:46 2000] [error] PythonHandler test: AttributeError:
> handler
> ************************************************
> 
> 
> 
>  Thanks for any help you can provide !!!!   :)
> 
> 
> HOWARD WILLIAMS
> marchFIRST
> 23422 Mill Creek Drive., Suite 100
> Laguna Hills, CA 92653
> ph: (949) 461-5480
> fax: (949) 461-5669
> howard.williams@marchFIRST.com
> www.marchFIRST.com
> 
> 


From grisha at ispol.com  Tue Jun 20 22:00:16 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:21 2004
Subject: [mod_python] test doesn't work
In-Reply-To: <Pine.LNX.4.21.0006202138080.28773-100000@saturn.ispol.com>
Message-ID: <Pine.LNX.4.21.0006202157290.28833-100000@saturn.ispol.com>

On Tue, 20 Jun 2000, Gregory Trubetskoy wrote:

> I am almost certain that this is caused by
> 
> 1. a syntax error in test.py
> 2. a permissions problem

OR

3. If the PythonHandler directive is in httpd.conf outside any <Directory>
tags, or if PythonHandler is inside a <Directory> different from that in
which test.py is, then /usr/local/lib/python1.5/test/ gets imported
instead, which, of course, doesn't have a function called "handler".

HTH

Grisha


From miguel at yorku.ca  Wed Jun 21 12:10:31 2000
From: miguel at yorku.ca (Miguel Marques)
Date: Fri Jan  9 22:02:21 2004
Subject: [mod_python] test doesn't work
In-Reply-To: <Pine.LNX.4.21.0006202157290.28833-100000@saturn.ispol.com>
References: <Pine.LNX.4.21.0006202138080.28773-100000@saturn.ispol.com>
	<Pine.LNX.4.21.0006202157290.28833-100000@saturn.ispol.com>
Message-ID: <20000621121031L.miguel@yorku.ca>

On Tue, 20 Jun 2000 22:00:16 -0400 (EDT), Gregory Trubetskoy <grisha@ispol.com> wrote:
> 
> On Tue, 20 Jun 2000, Gregory Trubetskoy wrote:
> 
> > I am almost certain that this is caused by
> > 
> > 1. a syntax error in test.py
> > 2. a permissions problem
> 
> OR
> 
> 3. If the PythonHandler directive is in httpd.conf outside any <Directory>
> tags, or if PythonHandler is inside a <Directory> different from that in
> which test.py is, then /usr/local/lib/python1.5/test/ gets imported
> instead, which, of course, doesn't have a function called "handler".
> 
> HTH
> 
> Grisha
> 
Well, I have the same problem.  I've tried everything I can think of.
This also happened with mod_python/2.2.
My setup is 
SunOS 5.7 Apache/1.3.12 (Unix) ApacheJServ/1.1 mod_perl/1.24 mod_python/2.4 Python/1.5.2

1. I can run test.py with python as apache (my server run under username apache)
2. I think 1. rules it out and I've checked the permissions of the all
   the python files.
3. my directive is 

<Directory "/usr/local/apache/htdocs/test">
    AddHandler python-program .py
    PythonHandler test
    PythonDebug on
</Directory>
and test.py is in /usr/local/apache/htdocs/test

I always get:

ERROR mod_python: "PythonHandler test"

Traceback (innermost last):

  File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 96, in Dispatch
    object = self.resolve_object(module, object_str)

  File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 42, in resolve_object
    obj = getattr(obj, obj_str)

AttributeError: handler

being somewhat new to python I'm unsure on how to proceed to figure
this out.
Any suggestions?
TIA...

							Miguel

C. Miguel Marques, York University, Computing & Communications Services
e-mail: miguel@yorku.ca, voice: (416)736-2100x22684, fax: (416)736-5830

From miguel at yorku.ca  Wed Jun 21 12:27:47 2000
From: miguel at yorku.ca (Miguel Marques)
Date: Fri Jan  9 22:02:21 2004
Subject: [mod_python] test doesn't work (solved?)
In-Reply-To: <20000621121031L.miguel@yorku.ca>
References: <Pine.LNX.4.21.0006202138080.28773-100000@saturn.ispol.com>
	<Pine.LNX.4.21.0006202157290.28833-100000@saturn.ispol.com>
	<20000621121031L.miguel@yorku.ca>
Message-ID: <20000621122747A.miguel@yorku.ca>

On Wed, 21 Jun 2000 12:10:31 -0400, Miguel Marques <miguel@yorku.ca> wrote:
> On Tue, 20 Jun 2000 22:00:16 -0400 (EDT), Gregory Trubetskoy <grisha@ispol.com> wrote:
> > 
> > On Tue, 20 Jun 2000, Gregory Trubetskoy wrote:
> > 
> > > I am almost certain that this is caused by
> > > 
> > > 1. a syntax error in test.py
> > > 2. a permissions problem
> > 
> > OR
> > 
> > 3. If the PythonHandler directive is in httpd.conf outside any <Directory>
> > tags, or if PythonHandler is inside a <Directory> different from that in
> > which test.py is, then /usr/local/lib/python1.5/test/ gets imported
> > instead, which, of course, doesn't have a function called "handler".
> > 
> > HTH
> > 
> > Grisha
> > 
> Well, I have the same problem.  I've tried everything I can think of.
> This also happened with mod_python/2.2.
> My setup is 
> SunOS 5.7 Apache/1.3.12 (Unix) ApacheJServ/1.1 mod_perl/1.24 mod_python/2.4 Python/1.5.2
> 
> 1. I can run test.py with python as apache (my server run under username apache)
> 2. I think 1. rules it out and I've checked the permissions of the all
>    the python files.
> 3. my directive is 
> 
> <Directory "/usr/local/apache/htdocs/test">
>     AddHandler python-program .py
>     PythonHandler test
>     PythonDebug on
> </Directory>

If I add a slash to the end of the directory in the Directory directive it works.
<Directory "/usr/local/apache/htdocs/test/">
    AddHandler python-program .py
    PythonHandler test
    PythonDebug on
</Directory>

I couldn't get a Location directive to work either way, though.
Is there a reason for this which I don't understand?
Thanks.

						  Miguel

C. Miguel Marques, York University, Computing & Communications Services
e-mail: miguel@yorku.ca, voice: (416)736-2100x22684, fax: (416)736-5830





From Howard.Williams at marchFIRST.com  Wed Jun 21 12:24:20 2000
From: Howard.Williams at marchFIRST.com (Howard Williams)
Date: Fri Jan  9 22:02:22 2004
Subject: [mod_python] test doesn't work (solved?)
In-Reply-To: <20000621122747A.miguel@yorku.ca>
Message-ID: <000001bfdbb6$4d3764f0$1d0eaad1@edalearning.com>

Yup !!!!  Adding the / at the end of the <Directory ...> statement did the
trick in httpd.conf

Thanks a bunch

HOWARD WILLIAMS
marchFIRST
23422 Mill Creek Drive., Suite 100
Laguna Hills, CA 92653
ph: (949) 461-5480
fax: (949) 461-5669
howard.williams@marchFIRST.com <mailto:howard.williams@marchFIRST.com>
www.marchFIRST.com



-----Original Message-----
From: Miguel Marques [mailto:miguel@yorku.ca]
Sent: Wednesday, June 21, 2000 9:28 AM
To: mod_python@modpython.org
Subject: Re: [mod_python] test doesn't work (solved?)


On Wed, 21 Jun 2000 12:10:31 -0400, Miguel Marques <miguel@yorku.ca> wrote:
> On Tue, 20 Jun 2000 22:00:16 -0400 (EDT), Gregory Trubetskoy
<grisha@ispol.com> wrote:
> >
> > On Tue, 20 Jun 2000, Gregory Trubetskoy wrote:
> >
> > > I am almost certain that this is caused by
> > >
> > > 1. a syntax error in test.py
> > > 2. a permissions problem
> >
> > OR
> >
> > 3. If the PythonHandler directive is in httpd.conf outside any
<Directory>
> > tags, or if PythonHandler is inside a <Directory> different from that in
> > which test.py is, then /usr/local/lib/python1.5/test/ gets imported
> > instead, which, of course, doesn't have a function called "handler".
> >
> > HTH
> >
> > Grisha
> >
> Well, I have the same problem.  I've tried everything I can think of.
> This also happened with mod_python/2.2.
> My setup is
> SunOS 5.7 Apache/1.3.12 (Unix) ApacheJServ/1.1 mod_perl/1.24
mod_python/2.4 Python/1.5.2
>
> 1. I can run test.py with python as apache (my server run under username
apache)
> 2. I think 1. rules it out and I've checked the permissions of the all
>    the python files.
> 3. my directive is
>
> <Directory "/usr/local/apache/htdocs/test">
>     AddHandler python-program .py
>     PythonHandler test
>     PythonDebug on
> </Directory>

If I add a slash to the end of the directory in the Directory directive it
works.
<Directory "/usr/local/apache/htdocs/test/">
    AddHandler python-program .py
    PythonHandler test
    PythonDebug on
</Directory>

I couldn't get a Location directive to work either way, though.
Is there a reason for this which I don't understand?
Thanks.

						  Miguel

C. Miguel Marques, York University, Computing & Communications Services
e-mail: miguel@yorku.ca, voice: (416)736-2100x22684, fax: (416)736-5830




_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python


From grisha at ispol.com  Wed Jun 21 18:00:25 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:22 2004
Subject: [mod_python] test doesn't work
In-Reply-To: <20000621121031L.miguel@yorku.ca>
Message-ID: <Pine.LNX.4.21.0006211759290.32339-100000@saturn.ispol.com>

How about when you rename test.py to mptest.py and change the
PythonHandler directive accordingly?

Grisha

On Wed, 21 Jun 2000, Miguel Marques wrote:

> On Tue, 20 Jun 2000 22:00:16 -0400 (EDT), Gregory Trubetskoy <grisha@ispol.com> wrote:
> > 
> > On Tue, 20 Jun 2000, Gregory Trubetskoy wrote:
> > 
> > > I am almost certain that this is caused by
> > > 
> > > 1. a syntax error in test.py
> > > 2. a permissions problem
> > 
> > OR
> > 
> > 3. If the PythonHandler directive is in httpd.conf outside any <Directory>
> > tags, or if PythonHandler is inside a <Directory> different from that in
> > which test.py is, then /usr/local/lib/python1.5/test/ gets imported
> > instead, which, of course, doesn't have a function called "handler".
> > 
> > HTH
> > 
> > Grisha
> > 
> Well, I have the same problem.  I've tried everything I can think of.
> This also happened with mod_python/2.2.
> My setup is 
> SunOS 5.7 Apache/1.3.12 (Unix) ApacheJServ/1.1 mod_perl/1.24 mod_python/2.4 Python/1.5.2
> 
> 1. I can run test.py with python as apache (my server run under username apache)
> 2. I think 1. rules it out and I've checked the permissions of the all
>    the python files.
> 3. my directive is 
> 
> <Directory "/usr/local/apache/htdocs/test">
>     AddHandler python-program .py
>     PythonHandler test
>     PythonDebug on
> </Directory>
> and test.py is in /usr/local/apache/htdocs/test
> 
> I always get:
> 
> ERROR mod_python: "PythonHandler test"
> 
> Traceback (innermost last):
> 
>   File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 96, in Dispatch
>     object = self.resolve_object(module, object_str)
> 
>   File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 42, in resolve_object
>     obj = getattr(obj, obj_str)
> 
> AttributeError: handler
> 
> being somewhat new to python I'm unsure on how to proceed to figure
> this out.
> Any suggestions?
> TIA...
> 
> 							Miguel
> 
> C. Miguel Marques, York University, Computing & Communications Services
> e-mail: miguel@yorku.ca, voice: (416)736-2100x22684, fax: (416)736-5830
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From grisha at ispol.com  Wed Jun 21 18:03:00 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:22 2004
Subject: [mod_python] test doesn't work (solved?)
In-Reply-To: <000001bfdbb6$4d3764f0$1d0eaad1@edalearning.com>
Message-ID: <Pine.LNX.4.21.0006211802230.32339-100000@saturn.ispol.com>

This may actually be a bug after all....

Grisha

On Wed, 21 Jun 2000, Howard Williams wrote:

> Yup !!!!  Adding the / at the end of the <Directory ...> statement did the
> trick in httpd.conf
> 
> Thanks a bunch
> 
> HOWARD WILLIAMS
> marchFIRST
> 23422 Mill Creek Drive., Suite 100
> Laguna Hills, CA 92653
> ph: (949) 461-5480
> fax: (949) 461-5669
> howard.williams@marchFIRST.com <mailto:howard.williams@marchFIRST.com>
> www.marchFIRST.com
> 
> 
> 
> -----Original Message-----
> From: Miguel Marques [mailto:miguel@yorku.ca]
> Sent: Wednesday, June 21, 2000 9:28 AM
> To: mod_python@modpython.org
> Subject: Re: [mod_python] test doesn't work (solved?)
> 
> 
> On Wed, 21 Jun 2000 12:10:31 -0400, Miguel Marques <miguel@yorku.ca> wrote:
> > On Tue, 20 Jun 2000 22:00:16 -0400 (EDT), Gregory Trubetskoy
> <grisha@ispol.com> wrote:
> > >
> > > On Tue, 20 Jun 2000, Gregory Trubetskoy wrote:
> > >
> > > > I am almost certain that this is caused by
> > > >
> > > > 1. a syntax error in test.py
> > > > 2. a permissions problem
> > >
> > > OR
> > >
> > > 3. If the PythonHandler directive is in httpd.conf outside any
> <Directory>
> > > tags, or if PythonHandler is inside a <Directory> different from that in
> > > which test.py is, then /usr/local/lib/python1.5/test/ gets imported
> > > instead, which, of course, doesn't have a function called "handler".
> > >
> > > HTH
> > >
> > > Grisha
> > >
> > Well, I have the same problem.  I've tried everything I can think of.
> > This also happened with mod_python/2.2.
> > My setup is
> > SunOS 5.7 Apache/1.3.12 (Unix) ApacheJServ/1.1 mod_perl/1.24
> mod_python/2.4 Python/1.5.2
> >
> > 1. I can run test.py with python as apache (my server run under username
> apache)
> > 2. I think 1. rules it out and I've checked the permissions of the all
> >    the python files.
> > 3. my directive is
> >
> > <Directory "/usr/local/apache/htdocs/test">
> >     AddHandler python-program .py
> >     PythonHandler test
> >     PythonDebug on
> > </Directory>
> 
> If I add a slash to the end of the directory in the Directory directive it
> works.
> <Directory "/usr/local/apache/htdocs/test/">
>     AddHandler python-program .py
>     PythonHandler test
>     PythonDebug on
> </Directory>
> 
> I couldn't get a Location directive to work either way, though.
> Is there a reason for this which I don't understand?
> Thanks.
> 
> 						  Miguel
> 
> C. Miguel Marques, York University, Computing & Communications Services
> e-mail: miguel@yorku.ca, voice: (416)736-2100x22684, fax: (416)736-5830
> 
> 
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From Howard.Williams at marchFIRST.com  Wed Jun 21 15:23:23 2000
From: Howard.Williams at marchFIRST.com (Howard Williams)
Date: Fri Jan  9 22:02:22 2004
Subject: [mod_python] test doesn't work
In-Reply-To: <Pine.LNX.4.21.0006211759290.32339-100000@saturn.ispol.com>
Message-ID: <001001bfdbcf$507b6300$1d0eaad1@edalearning.com>

no problem there

HOWARD WILLIAMS
marchFIRST
23422 Mill Creek Drive., Suite 100
Laguna Hills, CA 92653
ph: (949) 461-5480
fax: (949) 461-5669
howard.williams@marchFIRST.com <mailto:howard.williams@marchFIRST.com>
www.marchFIRST.com



-----Original Message-----
From: Gregory Trubetskoy [mailto:grisha@ispol.com]
Sent: Wednesday, June 21, 2000 3:00 PM
To: Miguel Marques
Cc: mod_python@modpython.org
Subject: Re: [mod_python] test doesn't work



How about when you rename test.py to mptest.py and change the
PythonHandler directive accordingly?

Grisha

On Wed, 21 Jun 2000, Miguel Marques wrote:

> On Tue, 20 Jun 2000 22:00:16 -0400 (EDT), Gregory Trubetskoy
<grisha@ispol.com> wrote:
> >
> > On Tue, 20 Jun 2000, Gregory Trubetskoy wrote:
> >
> > > I am almost certain that this is caused by
> > >
> > > 1. a syntax error in test.py
> > > 2. a permissions problem
> >
> > OR
> >
> > 3. If the PythonHandler directive is in httpd.conf outside any
<Directory>
> > tags, or if PythonHandler is inside a <Directory> different from that in
> > which test.py is, then /usr/local/lib/python1.5/test/ gets imported
> > instead, which, of course, doesn't have a function called "handler".
> >
> > HTH
> >
> > Grisha
> >
> Well, I have the same problem.  I've tried everything I can think of.
> This also happened with mod_python/2.2.
> My setup is
> SunOS 5.7 Apache/1.3.12 (Unix) ApacheJServ/1.1 mod_perl/1.24
mod_python/2.4 Python/1.5.2
>
> 1. I can run test.py with python as apache (my server run under username
apache)
> 2. I think 1. rules it out and I've checked the permissions of the all
>    the python files.
> 3. my directive is
>
> <Directory "/usr/local/apache/htdocs/test">
>     AddHandler python-program .py
>     PythonHandler test
>     PythonDebug on
> </Directory>
> and test.py is in /usr/local/apache/htdocs/test
>
> I always get:
>
> ERROR mod_python: "PythonHandler test"
>
> Traceback (innermost last):
>
>   File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line
96, in Dispatch
>     object = self.resolve_object(module, object_str)
>
>   File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line
42, in resolve_object
>     obj = getattr(obj, obj_str)
>
> AttributeError: handler
>
> being somewhat new to python I'm unsure on how to proceed to figure
> this out.
> Any suggestions?
> TIA...
>
> 							Miguel
>
> C. Miguel Marques, York University, Computing & Communications Services
> e-mail: miguel@yorku.ca, voice: (416)736-2100x22684, fax: (416)736-5830
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python


From grisha at ispol.com  Wed Jun 21 21:33:41 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:22 2004
Subject: [mod_python] test doesn't work (solved?)
In-Reply-To: <20000621122747A.miguel@yorku.ca>
Message-ID: <Pine.LNX.4.21.0006212131300.498-100000@saturn.ispol.com>

On Wed, 21 Jun 2000, Miguel Marques wrote:

> If I add a slash to the end of the directory in the Directory directive it works.
> <Directory "/usr/local/apache/htdocs/test/">

OK, it is actually a bug.

line 108 of mod_python.c, which reads

#define SLASH_S "\\"

should read

#define SLASH_S "/"

If you edit this and recompile, the problem will go away.

Grisha


From miguel at yorku.ca  Thu Jun 22 11:23:01 2000
From: miguel at yorku.ca (Miguel Marques)
Date: Fri Jan  9 22:02:22 2004
Subject: [mod_python] test doesn't work (solved?)
In-Reply-To: <Pine.LNX.4.21.0006212131300.498-100000@saturn.ispol.com>
References: <20000621122747A.miguel@yorku.ca>
	<Pine.LNX.4.21.0006212131300.498-100000@saturn.ispol.com>
Message-ID: <20000622112301P.miguel@yorku.ca>

On Wed, 21 Jun 2000 21:33:41 -0400 (EDT), Gregory Trubetskoy <grisha@ispol.com> wrote:
> 
> On Wed, 21 Jun 2000, Miguel Marques wrote:
> 
> > If I add a slash to the end of the directory in the Directory directive it works.
> > <Directory "/usr/local/apache/htdocs/test/">
> 
> OK, it is actually a bug.
> 
> line 108 of mod_python.c, which reads
> 
> #define SLASH_S "\\"
> 
> should read
> 
> #define SLASH_S "/"
> 
> If you edit this and recompile, the problem will go away.
> 
It does indeed go away. 
Thanks!!!
But note that when using a Location directive it still does not work.
e.g.
<Location "/test">
    AddHandler python-program .py
    PythonHandler test
    PythonDebug on
</Location>

Is this intentional?

							Miguel

C. Miguel Marques, York University, Computing & Communications Services
e-mail: miguel@yorku.ca, voice: (416)736-2100x22684, fax: (416)736-5830

From daniel at copyleft.no  Thu Jun 22 17:36:34 2000
From: daniel at copyleft.no (Hr. Daniel Mikkelsen)
Date: Fri Jan  9 22:02:22 2004
Subject: [mod_python] req.connection.user
Message-ID: <Pine.LNX.4.10.10006221730110.15525-100000@unity.copyleft.no>

Hi.

I'm trying to set up authentication based on the example given in the
tutorial. Everything seems to work, except that i get Null instead of
the username for req.connection.user.

So that if I just test for password with req.get_basic_auth_pw() and not
for user, I get "through" the basic authentication.

The source I'm using is taken straight from the tutorial. 

Any ideas? I'm using the preinstalled apache 1.3.9 on OpenBSD 2.6, with
mod_python as a DSO. I've tried both versions 2.2 and 2.4. 

-- Daniel Mikkelsen, Copyleft Software


From grisha at ispol.com  Fri Jun 23 18:31:54 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:22 2004
Subject: [mod_python] test doesn't work (solved?)
In-Reply-To: <20000622112301P.miguel@yorku.ca>
Message-ID: <Pine.LNX.4.21.0006231821170.7430-100000@saturn.ispol.com>

On Thu, 22 Jun 2000, Miguel Marques wrote:

> But note that when using a Location directive it still does not work.
> e.g.
> <Location "/test">
>     AddHandler python-program .py
>     PythonHandler test
>     PythonDebug on
> </Location>
> 
> Is this intentional?

I don't know if "intentional" is the right word, but it _is_ expected
behaviour.

mod_python prepends the directory to pythonpath, as outlined here:
http://www.modpython.org/live/mod_python-2.4/doc/pythonapi.html#handler

The <Location> directive puts whatever is specified as the argument to it
as the "directory", and mod_python ends up prependind it. But since
"/test" is not a real directory, it doesn't do you any good. I don't think
there is a simple way to find out what the real directory is from
<Location>. If you read the Apache documentation for it, it puts the
emphasis on the fact that <Location> is not in any way linked to the
filesystem.

Grisha


From hunter at userfriendly.net  Fri Jun 23 22:40:41 2000
From: hunter at userfriendly.net (hUnTeR)
Date: Fri Jan  9 22:02:22 2004
Subject: [mod_python] DSO compile
Message-ID: <39541FA9.D23BAB1A@userfriendly.net>

Dear list readers - 

I am currently trying to build the mod_python as a DSO for
apache-1.3.12. I have already compiled as DSO mod_perl, mod_ssl, etc but
i desparately need this module. I would even settle for a static compile
to get this to work (trying to replace our company's current method of
Netscape Enterprise Server with python). I get the following error when
trying to make:

===> src/modules/extra
gcc -c -I/usr/include/python1.5 -I../../os/unix -I../../include  
-DLINUX=2 -DUo
In file included from mod_python.c:89:
/usr/include/python1.5/Python.h:39: config.h: No such file or directory
In file included from /usr/include/python1.5/modsupport.h:52,
                 from /usr/include/python1.5/Python.h:101,
                 from mod_python.c:89:
/usr/lib/gcc-lib/i386-redhat-linux/egcs-2.91.66/include/varargs.h:106:
warning:d
/usr/lib/gcc-lib/i386-redhat-linux/egcs-2.91.66/include/stdarg.h:90:
warning: tn
make[4]: *** [mod_python.so] Error 1
make[3]: *** [all] Error 1
make[2]: *** [subdirs] Error 1
make[2]: Leaving directory `/root/temp/apache_1.3.12/src'
make[1]: *** [build-std] Error 2
make[1]: Leaving directory `/root/temp/apache_1.3.12'
make: *** [build] Error 2

Any ideas? I have even recently rebuilt python to include the ctsybase
and thread modules, but this one is giving me a headache.

Any help would be appreciated.

Regards
-- 
Michael B. Weiner
Systems Administrator/Partner
The UserFriendly Network (UFN)
--

             / /  (_)__  __ ____  __
            / /__/ / _ \/ // /\ \/ /  
           /____/_/_//_/\_,_/ /_/\_\ 

     * * * CHOICE OF A GNU GENERATION * * *

From grisha at ispol.com  Sat Jun 24 10:00:09 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:22 2004
Subject: [mod_python] DSO compile
In-Reply-To: <39541FA9.D23BAB1A@userfriendly.net>
Message-ID: <Pine.LNX.4.21.0006240958150.10701-100000@saturn.ispol.com>

it's saying it's missing config.h.

did you run "make install" after compiling Python?

Grisha

On Fri, 23 Jun 2000, hUnTeR wrote:

> Dear list readers - 
> 
> I am currently trying to build the mod_python as a DSO for
> apache-1.3.12. I have already compiled as DSO mod_perl, mod_ssl, etc but
> i desparately need this module. I would even settle for a static compile
> to get this to work (trying to replace our company's current method of
> Netscape Enterprise Server with python). I get the following error when
> trying to make:
> 
> ===> src/modules/extra
> gcc -c -I/usr/include/python1.5 -I../../os/unix -I../../include  
> -DLINUX=2 -DUo
> In file included from mod_python.c:89:
> /usr/include/python1.5/Python.h:39: config.h: No such file or directory
> In file included from /usr/include/python1.5/modsupport.h:52,
>                  from /usr/include/python1.5/Python.h:101,
>                  from mod_python.c:89:
> /usr/lib/gcc-lib/i386-redhat-linux/egcs-2.91.66/include/varargs.h:106:
> warning:d
> /usr/lib/gcc-lib/i386-redhat-linux/egcs-2.91.66/include/stdarg.h:90:
> warning: tn
> make[4]: *** [mod_python.so] Error 1
> make[3]: *** [all] Error 1
> make[2]: *** [subdirs] Error 1
> make[2]: Leaving directory `/root/temp/apache_1.3.12/src'
> make[1]: *** [build-std] Error 2
> make[1]: Leaving directory `/root/temp/apache_1.3.12'
> make: *** [build] Error 2
> 
> Any ideas? I have even recently rebuilt python to include the ctsybase
> and thread modules, but this one is giving me a headache.
> 
> Any help would be appreciated.
> 
> Regards
> -- 
> Michael B. Weiner
> Systems Administrator/Partner
> The UserFriendly Network (UFN)
> --
> 
>              / /  (_)__  __ ____  __
>             / /__/ / _ \/ // /\ \/ /  
>            /____/_/_//_/\_,_/ /_/\_\ 
> 
>      * * * CHOICE OF A GNU GENERATION * * *
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From hunter at userfriendly.net  Sat Jun 24 11:32:47 2000
From: hunter at userfriendly.net (hUnTeR)
Date: Fri Jan  9 22:02:22 2004
Subject: [mod_python] DSO compile
Message-ID: <3954D49F.199ECBCC@userfriendly.net>

Dear list readers - 

OK, i got around the previously emailed problem and was able to
successfully build a DSO mod_python module. However, when i go to
restart apache, i now receive the following error:

Starting httpd: Syntax error on line 250 of /etc/httpd/conf/httpd.conf:
Cannot load /etc/httpd/modules/mod_python.so into server:
/etc/httpd/modules/mod_python.so: undefined symbol: ct_con_props


Any ideas? Any help would be appreciated.

Regards
-- 
Michael B. Weiner
Systems Administrator/Partner
The UserFriendly Network (UFN)
--

             / /  (_)__  __ ____  __
            / /__/ / _ \/ // /\ \/ /  
           /____/_/_//_/\_,_/ /_/\_\ 

     * * * CHOICE OF A GNU GENERATION * * *
_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python

From hunter at userfriendly.net  Sat Jun 24 12:22:18 2000
From: hunter at userfriendly.net (hUnTeR)
Date: Fri Jan  9 22:02:22 2004
Subject: [mod_python] DSO compile
Message-ID: <3954E03A.E2987217@userfriendly.net>

Dear list readers - 

OK, i got around the previously emailed problem - the ctsybase module
was giving me the errors on start up. So i had to rebuild python from
scratch again without the ctsybase module support. However now when i
rebuild mod_python and go to restart apache it doesnt startup and gives
me "httpd dead but subsys locked"


Any ideas? Any help would be appreciated.

Regards
-- 
Michael B. Weiner
Systems Administrator/Partner
The UserFriendly Network (UFN)
--

             / /  (_)__  __ ____  __
            / /__/ / _ \/ // /\ \/ /  
           /____/_/_//_/\_,_/ /_/\_\ 

     * * * CHOICE OF A GNU GENERATION * * *
_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python
_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python

From jam at quark.emich.edu  Sat Jun 24 13:01:18 2000
From: jam at quark.emich.edu (Jeff)
Date: Fri Jan  9 22:02:22 2004
Subject: [mod_python] DSO compile
In-Reply-To: <3954E03A.E2987217@userfriendly.net>; from hunter@userfriendly.net on Sat, Jun 24, 2000 at 12:22:18PM -0400
References: <3954E03A.E2987217@userfriendly.net>
Message-ID: <20000624130118.E30377@quark.emich.edu>

On Sat, Jun 24, 2000 at 12:22:18PM -0400, hUnTeR wrote:
> Dear list readers - 
> 
> OK, i got around the previously emailed problem - the ctsybase module
> was giving me the errors on start up. So i had to rebuild python from
> scratch again without the ctsybase module support. However now when i
> rebuild mod_python and go to restart apache it doesnt startup and gives
> me "httpd dead but subsys locked"
> 
> 
> Any ideas? Any help would be appreciated.

apache is core dumping. 

I had this problem with an older version of mod_python, and solved it by
putting the "AddModule" and "LoadModule" directives in specific locations in
the httpd.conf file.

I noticed, though, that the 2.4 version *does not* work with this solution.

as a start to the troubleshooting, could you post the specific parameters to
apxs that you used? it would also be useful to know the exact apache
configuration you have for comparison.

regards,
J
-- 
|| visit gfd <http://quark.emich.edu/>
|| psa member -- <http://www.python.org/psa/> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 232 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20000624/d5940662/attachment-0003.bin
From richard at whitequeen.com  Fri Jun 23 19:11:10 2000
From: richard at whitequeen.com (richard offer)
Date: Fri Jan  9 22:02:22 2004
Subject: [mod_python] RFE: expose File descriptor in API
Message-ID: <200006240211.e5O2BAm23684@erij.whitequeen.com>

Hi,

Is is possible to expose the FD that req.write() is using to the API
? Is this worth it ?

I'm in the process of switching from HTMLgen to HyperText as my text
generator and that has a writeto() method that takes a FD as an argument.

Wont this allow for progressive loading ?

Just a thought.

richard.

-- 
richard offer @ home 
          84 FE 48 E4 74 D0 26 D4  31 8E B6 86 98 74 E2 7C  8A FB BF A3
___________________________________http://216.185.15.144/users/richard/

From grisha at ispol.com  Sat Jun 24 14:43:03 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:22 2004
Subject: [mod_python] RFE: expose File descriptor in API
In-Reply-To: <200006240211.e5O2BAm23684@erij.whitequeen.com>
Message-ID: <Pine.LNX.4.21.0006241438330.11343-100000@saturn.ispol.com>


On Fri, 23 Jun 2000, richard offer wrote:

> I'm in the process of switching from HTMLgen to HyperText as my text
> generator and that has a writeto() method that takes a FD as an argument.

I don't think there is such a thing as a file descriptor that one can
write to within apache. Also, writeto() would need to know how to handle
HTTP errors.

> Wont this allow for progressive loading ?

What's "progressive loading"?

Grisha


From dwallace at delanet.com  Sun Jun 25 08:41:23 2000
From: dwallace at delanet.com (Dave)
Date: Fri Jan  9 22:02:22 2004
Subject: [mod_python] test doesn't work (solved?)
Message-ID: <3955FDF3.DC59F96B@delanet.com>

I've been using the Location directive for a bit now, here is how it
looks for me:

<Location /wpy >
  SetHandler python-program
  PythonDebug On
  PythonPath "sys.path+['/devel/WEB/Webware/WebKit']"
  PythonHandler webkit_handler
</Location>

The key here is the undocumented feature of PythonPath that it
apparently evals its argument. I've been meaning to ask about this since
at some point this could get broken in development and I'd be up a
creek. This is certainly handy but what isn't nice is that I suppose
/something/wpy is also being appended to the PYTHONPATH wether I want or
not.  Maybe a directive to append paths to the default PYTHONPATH would
be in order?

BTW, the nice thing about using Location is the fact that for the
particular application I'm using there is only a single handler and all
content is delivered through that handler by the application. Having to
specify a Directory just doesn't seem quite right.

Dave.

On Fri, 23 Jun 2000, Gregory Trubetskoy wrote:

>On Thu, 22 Jun 2000, Miguel Marques wrote:

>> But note that when using a Location directive it still does not work.

>> e.g.
>> <Location "/test">
>>     AddHandler python-program .py
>>     PythonHandler test
>>     PythonDebug on
>> </Location>
>>
>> Is this intentional?

>I don't know if "intentional" is the right word, but it _is_ expected
>behaviour.

>mod_python prepends the directory to pythonpath, as outlined here:
>http://www.modpython.org/live/mod_python-2.4/doc/pythonapi.html#handler

>The <Location> directive puts whatever is specified as the argument to
it
>as the "directory", and mod_python ends up prependind it. But since
>"/test" is not a real directory, it doesn't do you any good. I don't
think
>there is a simple way to find out what the real directory is from
><Location>. If you read the Apache documentation for it, it puts the
>emphasis on the fact that <Location> is not in any way linked to the
>filesystem.



From grisha at ispol.com  Sun Jun 25 15:55:04 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:22 2004
Subject: [mod_python] test doesn't work (solved?)
In-Reply-To: <3955FDF3.DC59F96B@delanet.com>
Message-ID: <Pine.LNX.4.21.0006251540480.24945-100000@saturn.ispol.com>

On Sun, 25 Jun 2000, Dave wrote:

> I've been using the Location directive for a bit now, here is how it
> looks for me:
> 
> <Location /wpy >
>   SetHandler python-program
>   PythonDebug On
>   PythonPath "sys.path+['/devel/WEB/Webware/WebKit']"
>   PythonHandler webkit_handler
> </Location>
> 
> The key here is the undocumented feature of PythonPath that it
> apparently evals its argument. I've been meaning to ask about this since
> at some point this could get broken in development and I'd be up a
> creek. 

I don't think this is going away - there is no simpler way to specify the
pythonpath than in python syntax which implies evaling.

> This is certainly handy but what isn't nice is that I suppose
> /something/wpy is also being appended to the PYTHONPATH wether I want or
> not.  

Yes, it's "/wpy", actually. Unfortunately, there is no way to tell at the
time the directives are being processed whether it's <Location> or
<Directive>. One option may be not to intriduce another directive,
something like PythonDoNotModifyPath or something. 

> Maybe a directive to append paths to the default PYTHONPATH would
> be in order?

Originally, I considered something like using "+['/some/path']" to mean
append or "['/some/path']+" to prepend. There turned out to be some not so
obvious issues, such as the fact that with .htaccess, the directive gets
processed with every hit, so you would have to make sure to act on it only
once, the first time.

It _could_ be done, but it went against my principle to keep it simple, so
I decided to save for it later since I had more important features to
roll out.

> BTW, the nice thing about using Location is the fact that for the
> particular application I'm using there is only a single handler and all
> content is delivered through that handler by the application. Having to
> specify a Directory just doesn't seem quite right.

Not sure I understand this completely - could you elaborate a bit?

Grisha


From grisha at ispol.com  Sun Jun 25 16:51:58 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:22 2004
Subject: [mod_python] CVS
Message-ID: <Pine.LNX.4.21.0006251650370.25128-100000@saturn.ispol.com>

Someone was asking about CVS - 

You should be able to get CVS access from sourceforge. Go to 
http://sourceforge.net/projects/modpython for details.

Grisha



From gstein at lyra.org  Sun Jun 25 13:56:31 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 22:02:22 2004
Subject: [mod_python] test doesn't work (solved?)
In-Reply-To: <Pine.LNX.4.21.0006251540480.24945-100000@saturn.ispol.com>; from grisha@ispol.com on Sun, Jun 25, 2000 at 03:55:04PM -0400
References: <3955FDF3.DC59F96B@delanet.com> <Pine.LNX.4.21.0006251540480.24945-100000@saturn.ispol.com>
Message-ID: <20000625135631.F29590@lyra.org>

On Sun, Jun 25, 2000 at 03:55:04PM -0400, Gregory Trubetskoy wrote:
> On Sun, 25 Jun 2000, Dave wrote:
> > I've been using the Location directive for a bit now, here is how it
> > looks for me:
> > 
> > <Location /wpy >
> >   SetHandler python-program
> >   PythonDebug On
> >   PythonPath "sys.path+['/devel/WEB/Webware/WebKit']"
> >   PythonHandler webkit_handler
> > </Location>
> > 
> > The key here is the undocumented feature of PythonPath that it
> > apparently evals its argument. I've been meaning to ask about this since
> > at some point this could get broken in development and I'd be up a
> > creek. 
> 
> I don't think this is going away - there is no simpler way to specify the
> pythonpath than in python syntax which implies evaling.

Huh? How about specifying the path in standard DIR:DIR:DIR notation, and
using:

    sys.path = sys.path + string.split(directive_arg, ':')

No need to eval at all.

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/

From gstein at lyra.org  Sun Jun 25 15:57:55 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 22:02:22 2004
Subject: [mod_python] test doesn't work (solved?)
In-Reply-To: <4.3.2.7.2.20000625174031.00bd3540@pop.ne.mediaone.net>; from seant@alum.mit.edu on Sun, Jun 25, 2000 at 05:41:24PM -0400
References: <Pine.LNX.4.21.0006251540480.24945-100000@saturn.ispol.com> <3955FDF3.DC59F96B@delanet.com> <Pine.LNX.4.21.0006251540480.24945-100000@saturn.ispol.com> <20000625135631.F29590@lyra.org> <4.3.2.7.2.20000625174031.00bd3540@pop.ne.mediaone.net>
Message-ID: <20000625155755.H29590@lyra.org>

On Sun, Jun 25, 2000 at 05:41:24PM -0400, Sean True wrote:
> At 01:56 PM 6/25/00 -0700, you wrote:
> >Huh? How about specifying the path in standard DIR:DIR:DIR notation, and
> >using:
> >
> >     sys.path = sys.path + string.split(directive_arg, ':')
> >
> >No need to eval at all.
> Not as tasteful on Wintel platforms, though.

Fine. Then use os.pathsep rather than ':'

The *point* is valid -- there is no need for an eval in there, no need for a
Python expression, and every possibility of using "standard" path notations.

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/

From dwallace at delanet.com  Sun Jun 25 19:34:45 2000
From: dwallace at delanet.com (Dave)
Date: Fri Jan  9 22:02:22 2004
Subject: [mod_python] test doesn't work (solved?)
References: <Pine.LNX.4.21.0006251540480.24945-100000@saturn.ispol.com>
Message-ID: <39569715.BA322B4C@delanet.com>

Gregory Trubetskoy wrote:

> > Maybe a directive to append paths to the default PYTHONPATH would
> > be in order?
> It _could_ be done, but it went against my principle to keep it simple, so
> I decided to save for it later since I had more important features to
> roll out.

Right-on, works for me!

> > BTW, the nice thing about using Location is the fact that for the
> > particular application I'm using there is only a single handler and all
> > content is delivered through that handler by the application. Having to
> > specify a Directory just doesn't seem quite right.
>
> Not sure I understand this completely - could you elaborate a bit?

Webware is a application server (in development) that does Servlets and
Server Pages in Python so what it really wants is a path into its servlet
directory so it can find the source, generate the content and send it back
through the handler. For now the mod_python handler is just a proxy that
marshals some data from the request,sends it to the application server via a
socket, and relays the response back to Apache. If I were using Directory I'd
have to make a physical directory somwhere just to contain the handler and
nothing else or I suppose I could put the handler in my servlet directory but
it just doesn''t seem to belong there. Using Location I can place the handler
with the other application server source files. That just seems cleaner for
now.
Of course, this is all making me think of what will happen when I want to put
server pages alongside static html and have the right thing happen when .html
or .psp (server pages) are called for, but I suppose there is some way to
coerce Apache into doing that.

Dave.




From rsalz at caveosystems.com  Sun Jun 25 21:54:40 2000
From: rsalz at caveosystems.com (Rich Salz)
Date: Fri Jan  9 22:02:22 2004
Subject: [mod_python] test doesn't work (solved?)
References: <Pine.LNX.4.21.0006251540480.24945-100000@saturn.ispol.com> <3955FDF3.DC59F96B@delanet.com> <Pine.LNX.4.21.0006251540480.24945-100000@saturn.ispol.com> <20000625135631.F29590@lyra.org> <4.3.2.7.2.20000625174031.00bd3540@pop.ne.mediaone.net> <20000625155755.H29590@lyra.org>
Message-ID: <3956B7E0.718FB3B9@caveosystems.com>

> > >     sys.path = sys.path + string.split(directive_arg, ':')

Gee, I dunno. I kinda like the idea that the config file can completely
set the path.  It seems cleaner that way, just as scripts often do
	PATH=/bin:/usr/bin ; export PATH
rather than
	PATH=$PATH:/bin:/usr/bin ; export PATH

I vote to keep the current semantics.

