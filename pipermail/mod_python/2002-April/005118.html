<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] publisher security concerns
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20publisher%20security%20concerns&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005117.html">
   <LINK REL="Next"  HREF="005121.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] publisher security concerns</H1>
    <B>Allan Saddi</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20publisher%20security%20concerns&In-Reply-To="
       TITLE="[mod_python] publisher security concerns">asaddi at philosophysw.com
       </A><BR>
    <I>Fri Apr  5 18:43:55 EST 2002</I>
    <P><UL>
        <LI>Previous message: <A HREF="005117.html">[mod_python] mptest.py text does not interpret
</A></li>
        <LI>Next message: <A HREF="005121.html">[mod_python] publisher security concerns
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5118">[ date ]</a>
              <a href="thread.html#5118">[ thread ]</a>
              <a href="subject.html#5118">[ subject ]</a>
              <a href="author.html#5118">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<table border=0 width="100%"><tr><td>
<!--beginarticle-->
<PRE>Hi there,

I'm using mod_python 2.7.6 on FreeBSD. I was playing around with
the publisher handler today when I noticed something of concern.
I scoured the mailing list archives to see if it was mentioned
before, but I found no mention of it. (If it was discussed
before, please point me to the approximate date of the thread.)

Basically, if a module is loaded indirectly (via an import from
within another module), an outside user will be able to call
functions within that module afterward.

So, for example, if I have a script foo.py that imports pgdb
(PyGreSQL), and foo.py is later &quot;published&quot; by publisher,
afterward, I will be able to call functions within pgdb through
publisher. Note though that if a particular Apache child
interpreter instance has never loaded foo.py, it will
(rightfully) reject requests to pgdb.

The problem seems to lie in mod_python.apache.import_module(),
specifically this section of code:

        # keep track of file modification time and
        # try to reload it if it is newer
        if sys.modules.has_key(module_name):

            # the we won't even bother importing
            module = sys.modules[module_name]

            ...

When path is specified and not None (as it normally is when
import_module() is called from publisher), it is ignored if the
module already exists in the global modules list (sys.modules).

I'm a new mod_python user, so I'm not sure if this is a bug or
an intended feature. The impact of this behavior seems to be
limited to pure python modules, so thankfully, modules like os
cannot be exploited this way.  Essentially though, publisher is
exposing interfaces that the programmer may not know are
exposed. And that could be bad...

(Using my pgdb example, I was able to connect to my database
using the right URL... I wasn't able to do much else beyond
that, but that alone seemed scary enough.)

- Allan Saddi
  <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">asaddi at philosophysw.com</A>


</PRE>
<!--endarticle-->
</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005117.html">[mod_python] mptest.py text does not interpret
</A></li>
	<LI>Next message: <A HREF="005121.html">[mod_python] publisher security concerns
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5118">[ date ]</a>
              <a href="thread.html#5118">[ thread ]</a>
              <a href="subject.html#5118">[ subject ]</a>
              <a href="author.html#5118">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
