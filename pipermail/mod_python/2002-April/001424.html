<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] publisher security concerns
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20publisher%20security%20concerns&In-Reply-To=20020405184014.S25745-100000%40kalahari.flup.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001421.html">
   <LINK REL="Next"  HREF="001425.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] publisher security concerns</H1>
    <B>Javier Quinteros</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20publisher%20security%20concerns&In-Reply-To=20020405184014.S25745-100000%40kalahari.flup.org"
       TITLE="[mod_python] publisher security concerns">jquinte at fadu.uba.ar
       </A><BR>
    <I>Mon Apr  8 16:19:18 EST 2002</I>
    <P><UL>
        <LI>Previous message: <A HREF="001421.html">[mod_python] publisher security concerns
</A></li>
        <LI>Next message: <A HREF="001425.html">[mod_python] publisher security concerns
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1424">[ date ]</a>
              <a href="thread.html#1424">[ thread ]</a>
              <a href="subject.html#1424">[ subject ]</a>
              <a href="author.html#1424">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hi !!!
If you are worried about exposing some scripts that should &quot;only&quot; be used 
from other modules importing them, there's an easy solution (and I think it's 
the right one)... ;-)

Suppose you've got a script called interfacedb.py in your directory and it's 
full of functions that access your DB without checking anything, because you 
supose that it was imported from the modules that effectively do the 
checkings. The solution is to put this statement at the beggining of the 
script:

__auth__ = {}

This way, you're telling apache that no one is authorize to access (execute) 
this script. You can only call the functions inside the script if you import 
it from other module. This way you should add this statement to every script 
you don't want to be execute directly, no matter what URL you ask your 
browser.

Sorry if I misunderstood your question....

Hope this help...

On Friday 05 April 2002 23:43, Allan Saddi wrote:
&gt;<i> Hi there,
</I>&gt;<i>
</I>&gt;<i> I'm using mod_python 2.7.6 on FreeBSD. I was playing around with
</I>&gt;<i> the publisher handler today when I noticed something of concern.
</I>&gt;<i> I scoured the mailing list archives to see if it was mentioned
</I>&gt;<i> before, but I found no mention of it. (If it was discussed
</I>&gt;<i> before, please point me to the approximate date of the thread.)
</I>&gt;<i>
</I>&gt;<i> Basically, if a module is loaded indirectly (via an import from
</I>&gt;<i> within another module), an outside user will be able to call
</I>&gt;<i> functions within that module afterward.
</I>&gt;<i>
</I>&gt;<i> So, for example, if I have a script foo.py that imports pgdb
</I>&gt;<i> (PyGreSQL), and foo.py is later &quot;published&quot; by publisher,
</I>&gt;<i> afterward, I will be able to call functions within pgdb through
</I>&gt;<i> publisher. Note though that if a particular Apache child
</I>&gt;<i> interpreter instance has never loaded foo.py, it will
</I>&gt;<i> (rightfully) reject requests to pgdb.
</I>&gt;<i>
</I>&gt;<i> The problem seems to lie in mod_python.apache.import_module(),
</I>&gt;<i> specifically this section of code:
</I>&gt;<i>
</I>&gt;<i>         # keep track of file modification time and
</I>&gt;<i>         # try to reload it if it is newer
</I>&gt;<i>         if sys.modules.has_key(module_name):
</I>&gt;<i>
</I>&gt;<i>             # the we won't even bother importing
</I>&gt;<i>             module = sys.modules[module_name]
</I>&gt;<i>
</I>&gt;<i>             ...
</I>&gt;<i>
</I>&gt;<i> When path is specified and not None (as it normally is when
</I>&gt;<i> import_module() is called from publisher), it is ignored if the
</I>&gt;<i> module already exists in the global modules list (sys.modules).
</I>&gt;<i>
</I>&gt;<i> I'm a new mod_python user, so I'm not sure if this is a bug or
</I>&gt;<i> an intended feature. The impact of this behavior seems to be
</I>&gt;<i> limited to pure python modules, so thankfully, modules like os
</I>&gt;<i> cannot be exploited this way.  Essentially though, publisher is
</I>&gt;<i> exposing interfaces that the programmer may not know are
</I>&gt;<i> exposed. And that could be bad...
</I>&gt;<i>
</I>&gt;<i> (Using my pgdb example, I was able to connect to my database
</I>&gt;<i> using the right URL... I wasn't able to do much else beyond
</I>&gt;<i> that, but that alone seemed scary enough.)
</I>&gt;<i>
</I>&gt;<i> - Allan Saddi
</I>&gt;<i>   <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">asaddi at philosophysw.com</A>
</I>&gt;<i>
</I>
- -- 
- ---------------------------------
Javier Quinteros
<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">jquinte at fadu.uba.ar</A>
Secretar&#237;a de Planificaci&#243;n
Universidad de Buenos Aires
- ---------------------------------
Existe un solo lugar donde el Norte y el Sur del mundo se enfrentan en
igualdad de condiciones: es una cancha de f&#250;tbol de Brasil, en la 
desembocadura
del r&#237;o Amazonas. La l&#237;nea del ecuador corta por la mitad el estadio Zerao, en
Amap&#225;, de modo que cada equipo juega un tiempo en el sur y otro tiempo en el
norte.
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.0.6 (GNU/Linux)
Comment: For info see <A HREF="http://www.gnupg.org">http://www.gnupg.org</A>

iD8DBQE8se02dBzRnlFl4cgRAilyAJ9HCNjVlEHoG/zbv/A1XSx3P98RkwCg5ATw
D4QDlDayZurKXPr+QjhRX9E=
=Ji5h
-----END PGP SIGNATURE-----

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001421.html">[mod_python] publisher security concerns
</A></li>
	<LI>Next message: <A HREF="001425.html">[mod_python] publisher security concerns
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1424">[ date ]</a>
              <a href="thread.html#1424">[ thread ]</a>
              <a href="subject.html#1424">[ subject ]</a>
              <a href="author.html#1424">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
