<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] python path and 3.3
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20python%20path%20and%203.3&In-Reply-To=a595de7a0612020146j11ef3518m779760ffd289e6b1%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022741.html">
   <LINK REL="Next"  HREF="022740.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] python path and 3.3</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20python%20path%20and%203.3&In-Reply-To=a595de7a0612020146j11ef3518m779760ffd289e6b1%40mail.gmail.com"
       TITLE="[mod_python] python path and 3.3">grahamd at dscpl.com.au
       </A><BR>
    <I>Sat Dec  2 18:16:38 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="022741.html">[mod_python] python path and 3.3
</A></li>
        <LI>Next message: <A HREF="022740.html">[mod_python] python path and 3.3
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22750">[ date ]</a>
              <a href="thread.html#22750">[ thread ]</a>
              <a href="subject.html#22750">[ subject ]</a>
              <a href="author.html#22750">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On 02/12/2006, at 8:46 PM, Clodoaldo wrote:

&gt;<i> 2006/12/2, Graham Dumpleton &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">grahamd at dscpl.com.au</A>&gt;:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On 02/12/2006, at 10:57 AM, Clodoaldo wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &gt;&gt; Ok, I did it and now this works:
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; import constants as C
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; But this does not work:
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; from mod_python import apache
</I>&gt;&gt;<i> &gt;&gt; C = apache.import_module('constants.py')
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; Changed it to:
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; from mod_python import apache
</I>&gt;&gt;<i> &gt; C = apache.import_module('~/mod/constants.py')
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; And it works.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The apache.import_module() function is doing double duty in allowing
</I>&gt;&gt;<i> either a module name or a path for a file (including extension).  
</I>&gt;&gt;<i> For a
</I>&gt;&gt;<i> path it has to be able to be distinguishable from a module or module
</I>&gt;&gt;<i> within
</I>&gt;<i>
</I>&gt;<i> I should have tried it. This works:
</I>&gt;<i>
</I>&gt;<i> from mod_python import apache
</I>&gt;<i> C = apache.import_module('constants')
</I>
Yes, but if you want to be able to also run your code outside of  
Apache in
a test harness or something, using normal Python 'import' construct  
it still
possibly better. In the context of mod_python, provided the parent was
imported using the mod_python module importer and not handed off to
the standard Python importer, and the child is on the mod_python module
search path and not in sys.path, auto reloading still works okay.  
Thus, if
you change 'constants', the parent and the child will be automatically
reloaded next time the parent is required, even though the parent hadn't
been changed. That is, in the new module importer detects changes to
children and reloads the parent automatically as well. This didn't  
happen
in the old importer.

&gt;&gt;<i> package name. Thus, for a path, can only use:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    /some/path/module.py
</I>&gt;&gt;<i>    ~/some/path/module.py
</I>&gt;&gt;<i>    ./some/path/module.py
</I>&gt;&gt;<i>    ../some/path/module.py
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> For anything else it assumes it is a normal module import. For
</I>&gt;&gt;<i> 'constants.py'
</I>&gt;&gt;<i> that thus means it thinks you are wanting to import a submodule
</I>&gt;&gt;<i> called 'py'
</I>&gt;&gt;<i> from a package called 'constants'.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> There are a few other quirks with the new importer. The first is that
</I>&gt;&gt;<i> when a
</I>&gt;&gt;<i> path is specified, you don't actually need to use a .py extension.
</I>&gt;&gt;<i> This means
</I>&gt;&gt;<i> for example that the mpservlets package which uses a .mps extension
</I>&gt;&gt;<i> could
</I>&gt;&gt;<i> quite easily be rewritten to use the new module importer rather than
</I>&gt;&gt;<i> its own
</I>&gt;&gt;<i> and get all the benefit of the full depth checks on module reloading.
</I>&gt;&gt;<i> In other
</I>&gt;&gt;<i> words:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    module = apache.import_module(&quot;/some/path/servlet.mps&quot;)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> will work.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This may be useful if you don't want to use a .py extension and want
</I>&gt;&gt;<i> to use
</I>&gt;&gt;<i> something else to hide the fact that Python is being used.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Another strange characteristic of the new module importer,  
</I>&gt;&gt;<i> although this
</I>&gt;&gt;<i> also actually works in more recent Python versions if using  
</I>&gt;&gt;<i> __import__
</I>&gt;&gt;<i> (),
</I>&gt;&gt;<i> although not perhaps on all platforms, is that one can use a '/' to
</I>&gt;&gt;<i> refer to a
</I>&gt;&gt;<i> module name in a subdirectory somewhere on the module search path.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> What this means is that if you had used:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    PythonOption mod_python.importer.path &quot;['~/']&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> rather than:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    PythonOption mod_python.importer.path &quot;['~/mod']&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> you could then have said:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    apache.import_module('mod/constants')
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Note that I haven't used a '.py' extension. In some way this is like
</I>&gt;&gt;<i> having a
</I>&gt;&gt;<i> package, but the big difference is that the 'mod' directory doesn't
</I>&gt;&gt;<i> have to be
</I>&gt;&gt;<i> an actual package, ie., no __init__.py file is required.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This method can thus be used to create a namespace for modules still,
</I>&gt;&gt;<i> ie.,
</I>&gt;&gt;<i> by using a subdirectory, but since a package isn't being used,  
</I>&gt;&gt;<i> automatic
</I>&gt;&gt;<i> module reloading still works.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Since the same works with __import__() for some versions of Python,
</I>&gt;&gt;<i> falling back to using __import__() may be useful if you are trying  
</I>&gt;&gt;<i> to do
</I>&gt;&gt;<i> testing outside of mod_python.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Graham
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> This topic is now a very complete tutorial on the new 3.3 importer. It
</I>&gt;<i> can make a valuable article in the wiki, if properly cleaned.
</I>
Far from complete unfortunately. There is a lot of other stuff one  
needs to
know about the module importer as far as how reloading of modules  
occurs.
Unlike the old importer, the new importer doesn't just load modules  
on top
of the old ones. Thus, if you need to preserve some state or cache  
information
across reloads, for example a database connection pool, you need to
provide some hook functions to allow it.

Anyway, will describe that when someone comes across the need unless
I can get some separate documentation completed about it first.

Graham
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022741.html">[mod_python] python path and 3.3
</A></li>
	<LI>Next message: <A HREF="022740.html">[mod_python] python path and 3.3
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22750">[ date ]</a>
              <a href="thread.html#22750">[ thread ]</a>
              <a href="subject.html#22750">[ subject ]</a>
              <a href="author.html#22750">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
