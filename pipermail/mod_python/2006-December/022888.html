<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] example of the PythonImport directive
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20example%20of%20the%20PythonImport%20directive&In-Reply-To=9DDE0F31-1E6B-4BD3-AF62-B1367A1C024C%40dscpl.com.au">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022887.html">
   <LINK REL="Next"  HREF="022889.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] example of the PythonImport directive</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>m.banaouas</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20example%20of%20the%20PythonImport%20directive&In-Reply-To=9DDE0F31-1E6B-4BD3-AF62-B1367A1C024C%40dscpl.com.au"
       TITLE="[mod_python] example of the PythonImport directive">banaouas.medialog at wanadoo.fr
       </A><BR>
    <I>Wed Dec 27 06:01:58 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="022887.html">[mod_python] example of the PythonImport directive
</A></li>
        <LI>Next message: <A HREF="022889.html">[mod_python] example of the PythonImport directive
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22888">[ date ]</a>
              <a href="thread.html#22888">[ thread ]</a>
              <a href="subject.html#22888">[ subject ]</a>
              <a href="author.html#22888">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I looked at
<A HREF="http://www.dscpl.com.au/wiki/ModPython/Articles/TheProcessInterpreterModel">http://www.dscpl.com.au/wiki/ModPython/Articles/TheProcessInterpreterModel</A>
and of course found it very interesting, expecially for interpretter and 
process.
I must precise that my curent devloppement is under XP. So I'm concerned 
with winnt mode.
In any mode, we must do special stuff to make database connexion 
variable survive between requests.
If we avoid global variable as suggested by the article, shared memory 
seems to be the best solution, because database storage for database 
connexion variable makes no sense ...
Must I make moore interest about &quot;shared memory&quot; solutions like POSH 
(Python Object Sharing) or is there common module in python ?

Graham Dumpleton a &#233;crit :
 &gt;
 &gt; On 27/12/2006, at 8:20 PM, m.banaouas wrote:
 &gt;
 &gt;&gt; The fixup handler is probably the more elegant way to handle database
 &gt;&gt; connexion
 &gt;&gt; I suppose that this connexion (or pool of such objects) will &quot;survive&quot;
 &gt;&gt; (kept alive) between successive requests?
 &gt;
 &gt; Provided it is stored in a global module variable somewhere and suitable
 &gt; protection is implemented so as deal with module reloading if 
appropriate.
 &gt;
 &gt;&gt; you suggest to cache them in the request object: do you mean like its
 &gt;&gt; usually done with session id, added to all successif url or in hidden
 &gt;&gt; field? or should I add their reference  in the request object during
 &gt;&gt; fixup handler execution time?
 &gt;
 &gt; The reference is added to the request object merely as a convenience so
 &gt; the actual response handler doesn't itself have to go work out where to
 &gt; get the database connection handle from. Thus:
 &gt;
 &gt;   def fixuphandler(req):
 &gt;     # check if database connection initialised and if not initialise it
 &gt;
 &gt;     # cache a handle to database connection object in request object
 &gt;     # so response handler can use it
 &gt;     req.database = ...
 &gt;
 &gt;     return apache.OK
 &gt;
 &gt; Then later:
 &gt;
 &gt;   def handler(req):
 &gt;     database = req.database
 &gt;
 &gt;     # do stuff with database
 &gt;
 &gt;     return apache.OK
 &gt;
 &gt; In other words, it localises a lot of the database imports potentially
 &gt; to one place and you don't end up having it spread through all your
 &gt; handlers as well.
 &gt;
 &gt;&gt; from PythonHandler family, PythonInitHandler seems to be an other 
one appropriate for this job, is it ?
 &gt;
 &gt; PythonInitHandler is broken and doesn't work as advertised. See:
 &gt;
 &gt;   <A HREF="http://issues.apache.org/jira/browse/MODPYTHON-209">http://issues.apache.org/jira/browse/MODPYTHON-209</A>
 &gt;
 &gt;&gt; To avoid to me any mis-understanding, the long-live connexion object 
will reside as a global module variable ? may be that why &quot;interpretter&quot; 
is usually montionned in PythonImport&quot; threads: the globals will survive 
because the python process is the same one and is never stoped by apache?
 &gt;
 &gt; Interpreter name has to be specified with PythonImport as at point that
 &gt; that directive is processed is outside of any request so not possible to
 &gt; automatically determine what interpreter instance to perform the import
 &gt; for. Obviously you have to ensure it is the same as what any request
 &gt; handlers use. By default it would need to be virtual host name, but 
could be
 &gt; something else if using PythonInterpreter directive.
 &gt;
 &gt; I might suggest though that you read:
 &gt;
 &gt;   
<A HREF="http://www.dscpl.com.au/wiki/ModPython/Articles/TheProcessInterpreterModel">http://www.dscpl.com.au/wiki/ModPython/Articles/TheProcessInterpreterModel</A>
 &gt;
 &gt; as your terminology suggest you might not quite understand the
 &gt; relationship between process and interpreter instances.
 &gt;
 &gt; Graham
 &gt;
 &gt;&gt; Graham Dumpleton a &#233;crit :
 &gt;&gt;&gt; To avoid having to do it in lots of different places, for example 
if using
 &gt;&gt;&gt; mod_python.publisher, you can define a fixup handler which does it
 &gt;&gt;&gt; for you. The one fixup handler will be invoked for every request in 
that
 &gt;&gt;&gt; context. You could even cache a reference to the database connection
 &gt;&gt;&gt; handle in the request object ready for the subsequent response handler
 &gt;&gt;&gt; to use it.
 &gt;&gt;&gt;
 &gt;&gt;&gt; Graham


</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022887.html">[mod_python] example of the PythonImport directive
</A></li>
	<LI>Next message: <A HREF="022889.html">[mod_python] example of the PythonImport directive
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22888">[ date ]</a>
              <a href="thread.html#22888">[ thread ]</a>
              <a href="subject.html#22888">[ subject ]</a>
              <a href="author.html#22888">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
