<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] example of the PythonImport directive
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20example%20of%20the%20PythonImport%20directive&In-Reply-To=45923AF0.6060901%40wanadoo.fr">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022886.html">
   <LINK REL="Next"  HREF="022888.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] example of the PythonImport directive</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20example%20of%20the%20PythonImport%20directive&In-Reply-To=45923AF0.6060901%40wanadoo.fr"
       TITLE="[mod_python] example of the PythonImport directive">grahamd at dscpl.com.au
       </A><BR>
    <I>Wed Dec 27 04:30:34 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="022886.html">[mod_python] example of the PythonImport directive
</A></li>
        <LI>Next message: <A HREF="022888.html">[mod_python] example of the PythonImport directive
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22887">[ date ]</a>
              <a href="thread.html#22887">[ thread ]</a>
              <a href="subject.html#22887">[ subject ]</a>
              <a href="author.html#22887">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On 27/12/2006, at 8:20 PM, m.banaouas wrote:

&gt;<i> The fixup handler is probably the more elegant way to handle database
</I>&gt;<i> connexion
</I>&gt;<i> I suppose that this connexion (or pool of such objects) will &quot;survive&quot;
</I>&gt;<i> (kept alive) between successive requests?
</I>
Provided it is stored in a global module variable somewhere and suitable
protection is implemented so as deal with module reloading if  
appropriate.

&gt;<i> you suggest to cache them in the request object: do you mean like its
</I>&gt;<i> usually done with session id, added to all successif url or in hidden
</I>&gt;<i> field? or should I add their reference  in the request object during
</I>&gt;<i> fixup handler execution time?
</I>
The reference is added to the request object merely as a convenience so
the actual response handler doesn't itself have to go work out where to
get the database connection handle from. Thus:

   def fixuphandler(req):
     # check if database connection initialised and if not initialise it

     # cache a handle to database connection object in request object
     # so response handler can use it
     req.database = ...

     return apache.OK

Then later:

   def handler(req):
     database = req.database

     # do stuff with database

     return apache.OK

In other words, it localises a lot of the database imports potentially
to one place and you don't end up having it spread through all your
handlers as well.

&gt;<i> from PythonHandler family, PythonInitHandler seems to be an other  
</I>&gt;<i> one appropriate for this job, is it ?
</I>
PythonInitHandler is broken and doesn't work as advertised. See:

   <A HREF="http://issues.apache.org/jira/browse/MODPYTHON-209">http://issues.apache.org/jira/browse/MODPYTHON-209</A>

&gt;<i> To avoid to me any mis-understanding, the long-live connexion  
</I>&gt;<i> object will reside as a global module variable ? may be that why  
</I>&gt;<i> &quot;interpretter&quot; is usually montionned in PythonImport&quot; threads: the  
</I>&gt;<i> globals will survive because the python process is the same one and  
</I>&gt;<i> is never stoped by apache?
</I>
Interpreter name has to be specified with PythonImport as at point that
that directive is processed is outside of any request so not possible to
automatically determine what interpreter instance to perform the import
for. Obviously you have to ensure it is the same as what any request
handlers use. By default it would need to be virtual host name, but  
could be
something else if using PythonInterpreter directive.

I might suggest though that you read:

   <A HREF="http://www.dscpl.com.au/wiki/ModPython/Articles/">http://www.dscpl.com.au/wiki/ModPython/Articles/</A> 
TheProcessInterpreterModel

as your terminology suggest you might not quite understand the
relationship between process and interpreter instances.

Graham

&gt;<i> Graham Dumpleton a &#233;crit :
</I>&gt;&gt;<i> To avoid having to do it in lots of different places, for example  
</I>&gt;&gt;<i> if using
</I>&gt;&gt;<i> mod_python.publisher, you can define a fixup handler which does it
</I>&gt;&gt;<i> for you. The one fixup handler will be invoked for every request  
</I>&gt;&gt;<i> in that
</I>&gt;&gt;<i> context. You could even cache a reference to the database connection
</I>&gt;&gt;<i> handle in the request object ready for the subsequent response  
</I>&gt;&gt;<i> handler
</I>&gt;&gt;<i> to use it.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Graham
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On 27/12/2006, at 7:26 PM, m.banaouas wrote:
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022886.html">[mod_python] example of the PythonImport directive
</A></li>
	<LI>Next message: <A HREF="022888.html">[mod_python] example of the PythonImport directive
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22887">[ date ]</a>
              <a href="thread.html#22887">[ thread ]</a>
              <a href="subject.html#22887">[ subject ]</a>
              <a href="author.html#22887">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
