<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Re: Secure Sessions patch
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Re%3A%20Secure%20Sessions%20patch&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022822.html">
   <LINK REL="Next"  HREF="022821.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Re: Secure Sessions patch</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Re%3A%20Secure%20Sessions%20patch&In-Reply-To="
       TITLE="[mod_python] Re: Secure Sessions patch">grahamd at dscpl.com.au
       </A><BR>
    <I>Mon Dec 18 21:49:43 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="022822.html">[mod_python] eliminating last foo.py from url?
</A></li>
        <LI>Next message: <A HREF="022821.html">[mod_python] How to deal with old cached data showing?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22819">[ date ]</a>
              <a href="thread.html#22819">[ thread ]</a>
              <a href="subject.html#22819">[ subject ]</a>
              <a href="author.html#22819">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Steve Holden wrote ..
&gt;<i> Graham Dumpleton wrote:
</I>&gt;<i> &gt; Daniel Adler wrote ..
</I>&gt;<i> &gt;&gt; Hi,
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; I saw there was a discussion on this topic already:
</I>&gt;<i> &gt;&gt; <A HREF="http://www.modpython.org/pipermail/mod_python/2006-May/021260.html">http://www.modpython.org/pipermail/mod_python/2006-May/021260.html</A>
</I>&gt;<i> &gt;&gt; and came up with the same wish -
</I>&gt;<i> &gt;&gt; I want to force a session cookie to be explicitly created for https.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; I have added a &quot;secure&quot; parameter to the session class constructors.
</I>&gt;<i> &gt;&gt; If it is set AND req.is_https(), the cookie will be created wiht &quot;secure&quot;
</I>&gt;<i> &gt;&gt; set.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; A diff of session.py in release 3.2.10 with this feature is available
</I>&gt;<i> on
</I>&gt;<i> &gt;&gt; <A HREF="http://neoscientists.org/~plex/mod_python_3_2_10_session_with_secure_cookie.diff">http://neoscientists.org/~plex/mod_python_3_2_10_session_with_secure_cookie.diff</A>
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; I'd suggest that an explicit argument to Session.Session() is probably
</I>&gt;<i> &gt; not the best way of doing this. I am also dubious of it only being set
</I>&gt;<i> &gt; if HTTPS is used as that suggests that if first access is not via HTTPS,
</I>&gt;<i> &gt; that one could then continue to access the site thereafter without it
</I>&gt;<i> &gt; needing it to be HTTPS which defeats the purpose of having it in the
</I>&gt;<i> &gt; first place as you want to probably force it to be HTTPS always and not
</I>&gt;<i> &gt; allow HTTP at all.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; In place of an argument to Session.Session(), a PythonOption setting
</I>&gt;<i> &gt; would possibly be more appropriate and would then be similar with how
</I>&gt;<i> &gt; other aspects of cookies are configured for sessions. For example:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt;   PythonOption mod_python.session.secure: 1
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; By being an option it is easier to apply it to the complete URL
</I>&gt;<i> &gt; namespace for an application, especially if application is coded poorly
</I>&gt;<i> &gt; and doesn't have all session creation performed in one place only, or
</I>&gt;<i> &gt; you can't modify the code for the application easily.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; In being set this way, 'secure' should also perhaps always be set,
</I>&gt;<i> &gt; regardless of whether HTTPS is used. The outcome of this is that the
</I>&gt;<i> &gt; client would never send the cookie back if it wasn't HTTPS, thus result
</I>&gt;<i> &gt; would be always being pushed back to the login form (session creation
</I>&gt;<i> &gt; point) if not HTTPS, thereby clearly indicating that something is wrong
</I>&gt;<i> &gt; and also not inadvertently still letting someone in by accident through
</I>&gt;<i> &gt; HTTP.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Another possible issue is whether through Session instance it should
</I>&gt;<i> be
</I>&gt;<i> &gt; possible to access the cookie properties and interrogate if the cookie
</I>&gt;<i> &gt; for a session had the 'secure' attribute. If you don't have a means of
</I>&gt;<i> &gt; validating that it was secure cookie, then someone could modify the
</I>&gt;<i> &gt; cookie on the client side, remove the secure attribute and change from
</I>&gt;<i> &gt; using HTTPS to HTTP and possibly start to reveal information in traffic
</I>&gt;<i> &gt; that you didn't want to be revealed.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; On the latter point, one could argue that setting the PythonOption
</I>&gt;<i> &gt; should also be a trigger for the Session class to perform a validation
</I>&gt;<i> &gt; and always reject any cookie that doesn't have the 'secure' flag,
</I>&gt;<i> &gt; presuming that the 'secure' flag is actually sent back with the cookie
</I>&gt;<i> &gt; by the client.
</I>&gt;<i> &gt; 
</I>&gt;<i> I understood that browsers would flag cookies as secure if they received
</I>&gt;<i> them over https, and maintain separation between secure and non-secure
</I>&gt;<i> cookies. I wouldn't expect to see the secure flag represented inside the
</I>&gt;<i> cookie, as the two sets (secure and non-secure) should be disjoint. This
</I>&gt;<i> can cause session maintenance problems when some pages in the session 
</I>&gt;<i> are http and others are https.
</I>
When we do work out appropriate way of doing it and what it all means,
for good measure we probably want to allow people to set the 'httponly'
attribute of the cookie for a session as well. I release this is a defacto
standard set by Microsoft rather than a real standard attribute and not all
browsers support it, but someone will probably ask for it at some point.

Graham
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022822.html">[mod_python] eliminating last foo.py from url?
</A></li>
	<LI>Next message: <A HREF="022821.html">[mod_python] How to deal with old cached data showing?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22819">[ date ]</a>
              <a href="thread.html#22819">[ thread ]</a>
              <a href="subject.html#22819">[ subject ]</a>
              <a href="author.html#22819">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
