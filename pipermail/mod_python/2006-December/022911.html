<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] fixuphandler problem with mod_python-3.3.0b
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20fixuphandler%20problem%20with%20mod_python-3.3.0b&In-Reply-To=45978BCD.3070908%40wanadoo.fr">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022910.html">
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] fixuphandler problem with mod_python-3.3.0b</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20fixuphandler%20problem%20with%20mod_python-3.3.0b&In-Reply-To=45978BCD.3070908%40wanadoo.fr"
       TITLE="[mod_python] fixuphandler problem with mod_python-3.3.0b">grahamd at dscpl.com.au
       </A><BR>
    <I>Sun Dec 31 17:54:07 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="022910.html">[mod_python] fixuphandler problem with mod_python-3.3.0b
</A></li>
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22911">[ date ]</a>
              <a href="thread.html#22911">[ thread ]</a>
              <a href="subject.html#22911">[ subject ]</a>
              <a href="author.html#22911">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I am surprised then that what you had before even worked, as it
should have been:

   PythonFixupHandler fixuphandler

or:

   PythonFixupHandler fixuphandler::fixuphandler

Using a '.' in the value to the directive, ie.,

   PythonFixupHandler fixuphandler.fixuphandler

is not valid as far as being a way to specify the name of the
handler function within a module and should have resulted in
an attempt to import a submodule called 'fixuphandler' from a
package called 'fixuphandler'.

If it did work before then you have hit some quirk in old versions
of mod_python related somehow to how Python does imports internally.

Quoting the mod_python documentation:
   A handler has the following syntax:

     module[::object]

   Where module can be a full module name (package dot notation is

   accepted), and the optional object is the name of an object inside  
the module.

   The &quot;::&quot; was chosen for performance reasons. In order for Python
   to use objects inside modules, the modules first need to be imported.
   Having the separator as simply a &quot;.&quot;, would considerably complicate
   process of sequentially evaluating every word to determine whether
   it is a package, module, class etc. Using the (admittedly un- 
Python-like)
   &quot;::&quot; takes the time consuming work of figuring out where the  
module part
   ends and the object inside of it begins away from mod_python  
resulting
   in a modest performance gain.

So, the documentation only really guarantees that '::' will work to
distinguish function name from module. Whether '.' is going to work
in all situations is debatable and probably somewhat unspecified.

So, change the PythonFixupHandler directive to documented way of doing
it.

As to file structure. Where files are is okay, but still recommend  
the file
names have leading underscores so that mod_python.publisher will
ignore them and not expose their contents to access given that you
are using mod_python.publisher for the response handler phase.

Graham

On 31/12/2006, at 9:07 PM, m.banaouas wrote:

&gt;<i>
</I>&gt;<i> here is my directory organisation:
</I>&gt;<i> D:\mydir\
</I>&gt;<i> D:\mydir\fixuphandler.py
</I>&gt;<i> D:\mydir\api.py
</I>&gt;<i> there is no __init__.py at all.
</I>&gt;<i> however, I can make it change to match well practices ...
</I>&gt;<i>
</I>&gt;<i> Graham Dumpleton a &#233;crit :
</I>&gt;&gt;<i> Read description of import_module() in:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   <A HREF="http://www.modpython.org/live/mod_python-3.3.0b/doc-html/pyapi-">http://www.modpython.org/live/mod_python-3.3.0b/doc-html/pyapi-</A> 
</I>&gt;&gt;<i> apmeth.html
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> How 3.3.0b treats Python packages is a bit different.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Your error and configuration suggests that what you had previously  
</I>&gt;&gt;<i> was:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   ./fixuphandler/  # directory
</I>&gt;&gt;<i>       __init__.py # package init file.
</I>&gt;&gt;<i>       fixuphandler.py # handler file in directory
</I>&gt;&gt;<i>           fixuphandler() # handler function in file
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> A little messy, but the important thing is that it only worked  
</I>&gt;&gt;<i> before because you
</I>&gt;&gt;<i> had fixuphandler directory organised as a Python package with an  
</I>&gt;&gt;<i> __init__.py
</I>&gt;&gt;<i> file and mod_python had automatically add the parent handler  
</I>&gt;&gt;<i> directory into
</I>&gt;&gt;<i> sys.path. In 3.3.0b, it doesn't add the parent handler directory  
</I>&gt;&gt;<i> into sys.path as
</I>&gt;&gt;<i> that causes various problems. The new importer instead works out  
</I>&gt;&gt;<i> where to
</I>&gt;&gt;<i> import things from in a different way. On consequence of this  
</I>&gt;&gt;<i> though is that
</I>&gt;&gt;<i> stuff organised as Python packages in a parent handler directory  
</I>&gt;&gt;<i> will not be
</I>&gt;&gt;<i> found.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> You have a few options.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 1. Move 'fixuphandler' directory outside of document root and  
</I>&gt;&gt;<i> using PythonPath
</I>&gt;&gt;<i> to say where the parent directory of that directory now is.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 2. If 'fixuphandler/__init__.py' is empty, then delete that file  
</I>&gt;&gt;<i> and change
</I>&gt;&gt;<i> configuration to:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   PythonFixupHandler fixuphandler/fixuphandler
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 3. Remove 'fixuphandler/__init__.py' again, but use explicit  
</I>&gt;&gt;<i> reference to handler
</I>&gt;&gt;<i> file:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   PythonFixupHandler ~/fixuphandler/fixuphandler.py
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> If you had stuff in 'fixuphandler/__init__.py' and you expect it  
</I>&gt;&gt;<i> to be executed, then
</I>&gt;&gt;<i> you can only do 1 as is. You might want to reconsider  
</I>&gt;&gt;<i> restructuring your files
</I>&gt;&gt;<i> though anyway.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> BTW, if you do not have a 'fixuphandler/.htaccess' which has:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   deny from all
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> then easy for a user to access stuff in 'fixuphandler' directory  
</I>&gt;&gt;<i> that they shouldn't.
</I>&gt;&gt;<i> Ie. they could use URL of:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   fixuphandler/fixuphandler.py/fixuphandler
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> and mod_python.publisher will call the fixuphandler a second time.  
</I>&gt;&gt;<i> If it was
</I>&gt;&gt;<i> doing session stuff, that would cause a deadlock.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> If the only thing in 'fixuphandler' directory is  
</I>&gt;&gt;<i> 'fixuphandler.py', you would perhaps
</I>&gt;&gt;<i> be better off moving 'fixuphandler.py' to the parent directory and  
</I>&gt;&gt;<i> call it '_handlers.py'.
</I>&gt;&gt;<i> Because it now has a leading underscore, mod_python.publisher  
</I>&gt;&gt;<i> should ignore
</I>&gt;&gt;<i> it and not allow it to be accessed. The configuration would then be:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   PythonFixupHandler _handlers
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> or:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   PythonFixupHandler ~/_handlers.py
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Anyway, read through the documentation I reference, noting that  
</I>&gt;&gt;<i> import_module()
</I>&gt;&gt;<i> is what is used to load modules for the Python*Handler directives.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Graham
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022910.html">[mod_python] fixuphandler problem with mod_python-3.3.0b
</A></li>
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22911">[ date ]</a>
              <a href="thread.html#22911">[ thread ]</a>
              <a href="subject.html#22911">[ subject ]</a>
              <a href="author.html#22911">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
