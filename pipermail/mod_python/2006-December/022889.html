<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] example of the PythonImport directive
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20example%20of%20the%20PythonImport%20directive&In-Reply-To=459252A6.2060207%40wanadoo.fr">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022888.html">
   <LINK REL="Next"  HREF="022879.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] example of the PythonImport directive</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20example%20of%20the%20PythonImport%20directive&In-Reply-To=459252A6.2060207%40wanadoo.fr"
       TITLE="[mod_python] example of the PythonImport directive">grahamd at dscpl.com.au
       </A><BR>
    <I>Wed Dec 27 06:02:16 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="022888.html">[mod_python] example of the PythonImport directive
</A></li>
        <LI>Next message: <A HREF="022879.html">[mod_python] turbogears app deployment
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22889">[ date ]</a>
              <a href="thread.html#22889">[ thread ]</a>
              <a href="subject.html#22889">[ subject ]</a>
              <a href="author.html#22889">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Windows there is only one process handling requests so there is no  
need
to be worried about having to share stuff between processes.

Even in multi process MPM, you can't share the database connection  
handle
between processes anyway, each would need to have their own.

Graham

On 27/12/2006, at 10:01 PM, m.banaouas wrote:

&gt;<i> I looked at
</I>&gt;<i> <A HREF="http://www.dscpl.com.au/wiki/ModPython/Articles/">http://www.dscpl.com.au/wiki/ModPython/Articles/</A> 
</I>&gt;<i> TheProcessInterpreterModel
</I>&gt;<i> and of course found it very interesting, expecially for  
</I>&gt;<i> interpretter and process.
</I>&gt;<i> I must precise that my curent devloppement is under XP. So I'm  
</I>&gt;<i> concerned with winnt mode.
</I>&gt;<i> In any mode, we must do special stuff to make database connexion  
</I>&gt;<i> variable survive between requests.
</I>&gt;<i> If we avoid global variable as suggested by the article, shared  
</I>&gt;<i> memory seems to be the best solution, because database storage for  
</I>&gt;<i> database connexion variable makes no sense ...
</I>&gt;<i> Must I make moore interest about &quot;shared memory&quot; solutions like  
</I>&gt;<i> POSH (Python Object Sharing) or is there common module in python ?
</I>&gt;<i>
</I>&gt;<i> Graham Dumpleton a &#233;crit :
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On 27/12/2006, at 8:20 PM, m.banaouas wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;&gt; The fixup handler is probably the more elegant way to handle  
</I>&gt;<i> database
</I>&gt;<i> &gt;&gt; connexion
</I>&gt;<i> &gt;&gt; I suppose that this connexion (or pool of such objects) will  
</I>&gt;<i> &quot;survive&quot;
</I>&gt;<i> &gt;&gt; (kept alive) between successive requests?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Provided it is stored in a global module variable somewhere and  
</I>&gt;<i> suitable
</I>&gt;<i> &gt; protection is implemented so as deal with module reloading if  
</I>&gt;<i> appropriate.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;&gt; you suggest to cache them in the request object: do you mean  
</I>&gt;<i> like its
</I>&gt;<i> &gt;&gt; usually done with session id, added to all successif url or in  
</I>&gt;<i> hidden
</I>&gt;<i> &gt;&gt; field? or should I add their reference  in the request object  
</I>&gt;<i> during
</I>&gt;<i> &gt;&gt; fixup handler execution time?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The reference is added to the request object merely as a  
</I>&gt;<i> convenience so
</I>&gt;<i> &gt; the actual response handler doesn't itself have to go work out  
</I>&gt;<i> where to
</I>&gt;<i> &gt; get the database connection handle from. Thus:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;   def fixuphandler(req):
</I>&gt;<i> &gt;     # check if database connection initialised and if not  
</I>&gt;<i> initialise it
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     # cache a handle to database connection object in request object
</I>&gt;<i> &gt;     # so response handler can use it
</I>&gt;<i> &gt;     req.database = ...
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     return apache.OK
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Then later:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;   def handler(req):
</I>&gt;<i> &gt;     database = req.database
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     # do stuff with database
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     return apache.OK
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; In other words, it localises a lot of the database imports  
</I>&gt;<i> potentially
</I>&gt;<i> &gt; to one place and you don't end up having it spread through all your
</I>&gt;<i> &gt; handlers as well.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;&gt; from PythonHandler family, PythonInitHandler seems to be an  
</I>&gt;<i> other one appropriate for this job, is it ?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; PythonInitHandler is broken and doesn't work as advertised. See:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;   <A HREF="http://issues.apache.org/jira/browse/MODPYTHON-209">http://issues.apache.org/jira/browse/MODPYTHON-209</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;&gt; To avoid to me any mis-understanding, the long-live connexion  
</I>&gt;<i> object will reside as a global module variable ? may be that why  
</I>&gt;<i> &quot;interpretter&quot; is usually montionned in PythonImport&quot; threads: the  
</I>&gt;<i> globals will survive because the python process is the same one and  
</I>&gt;<i> is never stoped by apache?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Interpreter name has to be specified with PythonImport as at  
</I>&gt;<i> point that
</I>&gt;<i> &gt; that directive is processed is outside of any request so not  
</I>&gt;<i> possible to
</I>&gt;<i> &gt; automatically determine what interpreter instance to perform the  
</I>&gt;<i> import
</I>&gt;<i> &gt; for. Obviously you have to ensure it is the same as what any request
</I>&gt;<i> &gt; handlers use. By default it would need to be virtual host name,  
</I>&gt;<i> but could be
</I>&gt;<i> &gt; something else if using PythonInterpreter directive.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I might suggest though that you read:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;   <A HREF="http://www.dscpl.com.au/wiki/ModPython/Articles/">http://www.dscpl.com.au/wiki/ModPython/Articles/</A> 
</I>&gt;<i> TheProcessInterpreterModel
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; as your terminology suggest you might not quite understand the
</I>&gt;<i> &gt; relationship between process and interpreter instances.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Graham
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;&gt; Graham Dumpleton a &#233;crit :
</I>&gt;<i> &gt;&gt;&gt; To avoid having to do it in lots of different places, for  
</I>&gt;<i> example if using
</I>&gt;<i> &gt;&gt;&gt; mod_python.publisher, you can define a fixup handler which does it
</I>&gt;<i> &gt;&gt;&gt; for you. The one fixup handler will be invoked for every  
</I>&gt;<i> request in that
</I>&gt;<i> &gt;&gt;&gt; context. You could even cache a reference to the database  
</I>&gt;<i> connection
</I>&gt;<i> &gt;&gt;&gt; handle in the request object ready for the subsequent response  
</I>&gt;<i> handler
</I>&gt;<i> &gt;&gt;&gt; to use it.
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; Graham
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022888.html">[mod_python] example of the PythonImport directive
</A></li>
	<LI>Next message: <A HREF="022879.html">[mod_python] turbogears app deployment
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22889">[ date ]</a>
              <a href="thread.html#22889">[ thread ]</a>
              <a href="subject.html#22889">[ subject ]</a>
              <a href="author.html#22889">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
