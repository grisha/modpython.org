<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Upload progress indicator shows after upload?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Upload%20progress%20indicator%20shows%20after%20upload%3F&In-Reply-To=44CFE03E.40604%40gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025490.html">
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Upload progress indicator shows after upload?</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Martijn</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Upload%20progress%20indicator%20shows%20after%20upload%3F&In-Reply-To=44CFE03E.40604%40gmail.com"
       TITLE="[mod_python] Upload progress indicator shows after upload?">martijn at xs4us.nu
       </A><BR>
    <I>Thu Jul 31 05:17:20 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="025490.html">[mod_python] Pickle can't save classes instances in mod_python ?
</A></li>
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25491">[ date ]</a>
              <a href="thread.html#25491">[ thread ]</a>
              <a href="subject.html#25491">[ subject ]</a>
              <a href="author.html#25491">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I would suggest a few things.

In stead of images I would use a DIV with either a background image (use CSS 
repeat and a n imagewitdh of 1) with that you can make a nice progressbar)

Next you need to req.write and req.flush in your while bytes_left loop 
otherwise no updates are send to the browser. you can send something like:
&quot;&lt;script&gt;window.parent.getElementById('yourdiv').style.width=(maxwidth/100)*[yourcalculatedwith]&lt;/script&gt;&quot;
(this example is an indication it has to be checked) 

On the broser site, you can do a lot of things but I suggest using a hidden 
iframe where you set the target of the upload to...
You can also choose to put the progessbar in the Iframe, and do a &quot;show&quot; 
before the submit. Right after you can send another script to hide it again 
or make the iframe dissappear when it finished loading (by sending something 
right after the upload started: &lt;script 
defer=true&gt;window.parent.getElementById('YourIframe').visable=false&lt;/script&gt;
the defer=true will make it run after all the the page finished loading 

I used different ways to make a progressbar in different projects all is 
depending on how you organise things in your site. The req.write en even more 
important the req.flush in the loop should do the trick.

All the other stuff is not Mod_python related.

Martijn


On Wednesday 02 August 2006 01:14, jadacyrus wrote:
&gt;<i> Essentially this is what I have setup for my upload script:
</I>&gt;<i>
</I>&gt;<i> [code]
</I>&gt;<i>
</I>&gt;<i> #HTML Stuff here
</I>&gt;<i> #Declare variables etc...
</I>&gt;<i>
</I>&gt;<i>     while bytes_left &gt;= 0:
</I>&gt;<i>             fileData = req.form['filename'].file.read(1024)
</I>&gt;<i>             filebuffer = filebuffer + fileData
</I>&gt;<i>             bytes_left = bytes_left - 1024
</I>&gt;<i>             bytes_read = bytes_read + 1024
</I>&gt;<i>             percent = bytes_read/int(length) * 100
</I>&gt;<i>
</I>&gt;<i> #Some nested IF statements to display a progress indicator using images
</I>&gt;<i> based on the percent variable.
</I>&gt;<i>
</I>&gt;<i> [/code]
</I>&gt;<i>
</I>&gt;<i> This is contained in my upload.py in the function upFile which is called
</I>&gt;<i> from the POST method. However, It seems that the file uploads completely
</I>&gt;<i> first and then it will show the progress indications afterwards. However
</I>&gt;<i> this doesn't seem to be logically what my code should be doing. I'm
</I>&gt;<i> somewhat new to mod_python but not python in general, any suggestions?
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I></PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025490.html">[mod_python] Pickle can't save classes instances in mod_python ?
</A></li>
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25491">[ date ]</a>
              <a href="thread.html#25491">[ thread ]</a>
              <a href="subject.html#25491">[ subject ]</a>
              <a href="author.html#25491">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
