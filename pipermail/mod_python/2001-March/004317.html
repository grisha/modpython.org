<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] help needed with forms' parameters handling
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20help%20needed%20with%20forms%27%20parameters%20handling&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004316.html">
   <LINK REL="Next"  HREF="004318.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] help needed with forms' parameters handling</H1>
    <B>Petar Karafezov</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20help%20needed%20with%20forms%27%20parameters%20handling&In-Reply-To="
       TITLE="[mod_python] help needed with forms' parameters handling">petar at metamarkets.com
       </A><BR>
    <I>Fri Mar  9 10:20:43 EST 2001</I>
    <P><UL>
        <LI>Previous message: <A HREF="004316.html">[mod_python] That -DEAPI thing again.
</A></li>
        <LI>Next message: <A HREF="004318.html">[mod_python] help needed with forms' parameters handling
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4317">[ date ]</a>
              <a href="thread.html#4317">[ thread ]</a>
              <a href="subject.html#4317">[ subject ]</a>
              <a href="author.html#4317">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<table border=0 width="100%"><tr><td>
<!--beginarticle-->
<PRE>Hello all -

I am running Apache/1.3.14 (Unix) mod_python/2.7.2 Python/2.0. At this point
I am not even sure that this is a mod_python issue, as I have seen this
same behavior before I ported my cgi to mod_python. I am not sure what to do
at this point..

Here's the issue:

When you do a POST to a python script you obtain the parameters using the
util.FieldStorage, when using cgi it's cgi.FieldStorage. The returned result
is a dictionary { key, value }. Everything is OK if you just what to work
with this dictionary. However, if you try to pass this dictionary object to
urllib.urlencode, we raise an exception:

Mod_python error: &quot;PythonHandler parse2&quot;

Traceback (most recent call last):

  File &quot;/usr/local/lib/python2.0/site-packages/mod_python/apache.py&quot;, line
189, in Dispatch
    result = object(self.req)

  File &quot;/usr/local/apache/htdocs/test/parse2.py&quot;, line 147, in handler
    params=urllib.urlencode(form)	

  File &quot;/usr/local/lib/python2.0/urllib.py&quot;, line 1086, in urlencode
    for k, v in dict.items():

AttributeError: 'FieldStorage' instance has no attribute 'items'


Now, the funny part is that if I get this object 'form' - which was defined
as form=util.FieldStorage(req) and just get the keys and values and form a
new dictionary, I can pass that new one to urllib.urlencode with no
problems.

...
    newparams={}                       
    for key in form.keys():
          newparams[key]=form[key]
    params=urllib.urlencode(newparams) 
...

Again, I run into the same issue with both util.FieldStorage when working
with mod_python and with cgi.FieldStorage when using my cgi version.

I am quite happy with this workaround until I bumped into a different issue,
which I am not exactly sure if it's related or not. When there're multiple
checkboxes on a form:

&lt;input type=&quot;checkbox&quot;  name=&quot;frequencies&quot; value=&quot;DEM&quot; priority=&quot;6&quot; checked&gt;
&lt;input type=&quot;checkbox&quot;  name=&quot;frequencies&quot; value=&quot;HLF&quot; priority=&quot;6&quot;&gt;
&lt;input type=&quot;checkbox&quot;  name=&quot;frequencies&quot; value=&quot;DAY&quot; priority=&quot;6&quot;&gt;
&lt;input type=&quot;checkbox&quot;  name=&quot;frequencies&quot; value=&quot;WEK&quot; priority=&quot;6&quot;&gt;

and we have selected more than 1, then the form parameter value gets passed
to the server as an array. For example, if I'd select DEM and DAY from the
checkboxed above, my params would be:

'frequences' : ['DEM','DAY']

This is all great, but when I pass the parameters to the server - my python
script is playing the role of a proxy, then I am passing as value for
'frequences' the STRING &quot;['DEM','DAY']&quot; and not the ARRAY ['DEM','DAY']. 

So, somewhere in what I do/use the array gets converted to a string. The way
I see it is:

1) It could be the python's FieldStorage when I originally get the keys and
values
2) It could be that funky dictionary rewriting that I am doing before I pass
the form parameters to urllib.urlencode.
3) I could be something in what urlencode does.


I am not sure where to look at this point. 

Any ideas, anyone ?? Any help would be greatly appreciated!

Thanks for your help!

regards,

Petar Karafezov

MetaMarkets.com
415-575-3015
-------------------------------------------
Investing Out Loud at
<A HREF="http://www.metamarkets.com">http://www.metamarkets.com</A>
-------------------------------------------



</PRE>
<!--endarticle-->
</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004316.html">[mod_python] That -DEAPI thing again.
</A></li>
	<LI>Next message: <A HREF="004318.html">[mod_python] help needed with forms' parameters handling
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4317">[ date ]</a>
              <a href="thread.html#4317">[ thread ]</a>
              <a href="subject.html#4317">[ subject ]</a>
              <a href="author.html#4317">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
