<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] help needed with forms' parameters handling
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20help%20needed%20with%20forms%27%20parameters%20handling&In-Reply-To=86FC34EA3C4F074AA6BBFFE52ED83FED27BE3E%40METAEXCH.sfo.metamarkets.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011711.html">
   <LINK REL="Next"  HREF="011713.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] help needed with forms' parameters handling</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Gregory (Grisha) Trubetskoy</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20help%20needed%20with%20forms%27%20parameters%20handling&In-Reply-To=86FC34EA3C4F074AA6BBFFE52ED83FED27BE3E%40METAEXCH.sfo.metamarkets.com"
       TITLE="[mod_python] help needed with forms' parameters handling">grisha at verio.net
       </A><BR>
    <I>Fri Mar  9 13:39:34 EST 2001</I>
    <P><UL>
        <LI>Previous message: <A HREF="011711.html">[mod_python] help needed with forms' parameters handling
</A></li>
        <LI>Next message: <A HREF="011713.html">[mod_python] Re: help needed with forms' parameters handling
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11712">[ date ]</a>
              <a href="thread.html#11712">[ thread ]</a>
              <a href="subject.html#11712">[ subject ]</a>
              <a href="author.html#11712">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is probably because FieldStorage indeed doesn't have &quot;items()&quot; - just
like it says ;-)

May be in the future I'll add it. Until then - you'll have to copy it to
real dictionary, or you can subclass FieldStorage and add your own
items().

Grisha

On Fri, 9 Mar 2001, Petar Karafezov wrote:

&gt;<i> Hello all -
</I>&gt;<i>
</I>&gt;<i> I am running Apache/1.3.14 (Unix) mod_python/2.7.2 Python/2.0. At this point
</I>&gt;<i> I am not even sure that this is a mod_python issue, as I have seen this
</I>&gt;<i> same behavior before I ported my cgi to mod_python. I am not sure what to do
</I>&gt;<i> at this point..
</I>&gt;<i>
</I>&gt;<i> Here's the issue:
</I>&gt;<i>
</I>&gt;<i> When you do a POST to a python script you obtain the parameters using the
</I>&gt;<i> util.FieldStorage, when using cgi it's cgi.FieldStorage. The returned result
</I>&gt;<i> is a dictionary { key, value }. Everything is OK if you just what to work
</I>&gt;<i> with this dictionary. However, if you try to pass this dictionary object to
</I>&gt;<i> urllib.urlencode, we raise an exception:
</I>&gt;<i>
</I>&gt;<i> Mod_python error: &quot;PythonHandler parse2&quot;
</I>&gt;<i>
</I>&gt;<i> Traceback (most recent call last):
</I>&gt;<i>
</I>&gt;<i>   File &quot;/usr/local/lib/python2.0/site-packages/mod_python/apache.py&quot;, line
</I>&gt;<i> 189, in Dispatch
</I>&gt;<i>     result = object(self.req)
</I>&gt;<i>
</I>&gt;<i>   File &quot;/usr/local/apache/htdocs/test/parse2.py&quot;, line 147, in handler
</I>&gt;<i>     params=urllib.urlencode(form)
</I>&gt;<i>
</I>&gt;<i>   File &quot;/usr/local/lib/python2.0/urllib.py&quot;, line 1086, in urlencode
</I>&gt;<i>     for k, v in dict.items():
</I>&gt;<i>
</I>&gt;<i> AttributeError: 'FieldStorage' instance has no attribute 'items'
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Now, the funny part is that if I get this object 'form' - which was defined
</I>&gt;<i> as form=util.FieldStorage(req) and just get the keys and values and form a
</I>&gt;<i> new dictionary, I can pass that new one to urllib.urlencode with no
</I>&gt;<i> problems.
</I>&gt;<i>
</I>&gt;<i> ...
</I>&gt;<i>     newparams={}
</I>&gt;<i>     for key in form.keys():
</I>&gt;<i>           newparams[key]=form[key]
</I>&gt;<i>     params=urllib.urlencode(newparams)
</I>&gt;<i> ...
</I>&gt;<i>
</I>&gt;<i> Again, I run into the same issue with both util.FieldStorage when working
</I>&gt;<i> with mod_python and with cgi.FieldStorage when using my cgi version.
</I>&gt;<i>
</I>&gt;<i> I am quite happy with this workaround until I bumped into a different issue,
</I>&gt;<i> which I am not exactly sure if it's related or not. When there're multiple
</I>&gt;<i> checkboxes on a form:
</I>&gt;<i>
</I>&gt;<i> &lt;input type=&quot;checkbox&quot;  name=&quot;frequencies&quot; value=&quot;DEM&quot; priority=&quot;6&quot; checked&gt;
</I>&gt;<i> &lt;input type=&quot;checkbox&quot;  name=&quot;frequencies&quot; value=&quot;HLF&quot; priority=&quot;6&quot;&gt;
</I>&gt;<i> &lt;input type=&quot;checkbox&quot;  name=&quot;frequencies&quot; value=&quot;DAY&quot; priority=&quot;6&quot;&gt;
</I>&gt;<i> &lt;input type=&quot;checkbox&quot;  name=&quot;frequencies&quot; value=&quot;WEK&quot; priority=&quot;6&quot;&gt;
</I>&gt;<i>
</I>&gt;<i> and we have selected more than 1, then the form parameter value gets passed
</I>&gt;<i> to the server as an array. For example, if I'd select DEM and DAY from the
</I>&gt;<i> checkboxed above, my params would be:
</I>&gt;<i>
</I>&gt;<i> 'frequences' : ['DEM','DAY']
</I>&gt;<i>
</I>&gt;<i> This is all great, but when I pass the parameters to the server - my python
</I>&gt;<i> script is playing the role of a proxy, then I am passing as value for
</I>&gt;<i> 'frequences' the STRING &quot;['DEM','DAY']&quot; and not the ARRAY ['DEM','DAY'].
</I>&gt;<i>
</I>&gt;<i> So, somewhere in what I do/use the array gets converted to a string. The way
</I>&gt;<i> I see it is:
</I>&gt;<i>
</I>&gt;<i> 1) It could be the python's FieldStorage when I originally get the keys and
</I>&gt;<i> values
</I>&gt;<i> 2) It could be that funky dictionary rewriting that I am doing before I pass
</I>&gt;<i> the form parameters to urllib.urlencode.
</I>&gt;<i> 3) I could be something in what urlencode does.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I am not sure where to look at this point.
</I>&gt;<i>
</I>&gt;<i> Any ideas, anyone ?? Any help would be greatly appreciated!
</I>&gt;<i>
</I>&gt;<i> Thanks for your help!
</I>&gt;<i>
</I>&gt;<i> regards,
</I>&gt;<i>
</I>&gt;<i> Petar Karafezov
</I>&gt;<i>
</I>&gt;<i> MetaMarkets.com
</I>&gt;<i> 415-575-3015
</I>&gt;<i> -------------------------------------------
</I>&gt;<i> Investing Out Loud at
</I>&gt;<i> <A HREF="http://www.metamarkets.com">http://www.metamarkets.com</A>
</I>&gt;<i> -------------------------------------------
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://www.modpython.org/mailman/listinfo/mod_python">http://www.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i>
</I>

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011711.html">[mod_python] help needed with forms' parameters handling
</A></li>
	<LI>Next message: <A HREF="011713.html">[mod_python] Re: help needed with forms' parameters handling
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11712">[ date ]</a>
              <a href="thread.html#11712">[ thread ]</a>
              <a href="subject.html#11712">[ subject ]</a>
              <a href="author.html#11712">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
