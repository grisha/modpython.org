<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Custom handler thread safety
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Custom%20handler%20thread%20safety&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017327.html">
   <LINK REL="Next"  HREF="017342.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Custom handler thread safety</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Custom%20handler%20thread%20safety&In-Reply-To="
       TITLE="[mod_python] Custom handler thread safety">grahamd at dscpl.com.au
       </A><BR>
    <I>Thu Feb  3 19:44:35 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="017327.html">[mod_python] Custom handler thread safety
</A></li>
        <LI>Next message: <A HREF="017342.html">[mod_python] Custom handler thread safety
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17329">[ date ]</a>
              <a href="thread.html#17329">[ thread ]</a>
              <a href="subject.html#17329">[ subject ]</a>
              <a href="author.html#17329">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Huzaifa Tapal wrote ..
&gt;<i> Thanks Graham, your response helped a lot.  I wanted to ask another question
</I>&gt;<i> related to my original post.  If I am taking advantage of the shared memory
</I>&gt;<i> that using multithreaded MPM and storing objects such as db connections
</I>&gt;<i> and
</I>&gt;<i> parsed page templates, do you see a threat with not locking the thread
</I>&gt;<i> when
</I>&gt;<i> making use of those shared resources.
</I>&gt;<i> 
</I>&gt;<i> To be more clear, if I have resource object A in the shared memory and
</I>&gt;<i> without any kind of thread locking in place, Thread 1 is using lets say
</I>&gt;<i> the
</I>&gt;<i> database connection object, at the same time Thread 2 needs the same
</I>&gt;<i> connection object, would that cause any type of a Race Condition?
</I>&gt;<i> 
</I>&gt;<i> Do you think it's a good idea to wrap usage of those shared object such
</I>&gt;<i> as
</I>&gt;<i> when I am retrieving it from the cache with the lock.acquire() call on
</I>&gt;<i> the
</I>&gt;<i> thread?
</I>
What you need to do will depend on a few things.

Is the Python database connection object internally thread safe?

For a particular request, does it only need to use the database
connection once, or does it need to perform multiple actions
against the database of which all together she be performed
atomically?

Are the results of any database query being cached within your
shared data area?

Do you have PythonAutoReload set to &quot;On&quot; and relying on that
working for the module which holds your database connection
and shared data.

Try and give at least a Y/N answer for each.

In brief though, if the database connection object is in itself thread
safe, and that for a request only one database query/update is being
done and nothing is being cached resulting from that, you may well
not have to provide your own thread locks.

If this isn't the case, you may have to lock your shared data and
database connection with a single lock, while you possibly make
multiple queries/updates and save the result in your shared data
area. If you don't lock at a high enough level, classic problems of
another threading changing the database under you, or messing with
your shared data can happen.

I ask about the PythonAutoReload as there are lots of problems there
that most people don't seem to understand or appreciate. Thus, if you
are using apache.import_module() to load in your module containing
the database connections and shared data, indicate as much and I
can explain some of the problems there.

Graham
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017327.html">[mod_python] Custom handler thread safety
</A></li>
	<LI>Next message: <A HREF="017342.html">[mod_python] Custom handler thread safety
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17329">[ date ]</a>
              <a href="thread.html#17329">[ thread ]</a>
              <a href="subject.html#17329">[ subject ]</a>
              <a href="author.html#17329">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
