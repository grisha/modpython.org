<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Good idea to use apache.setup_cgi() with
	multithreadedmodel?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Good%20idea%20to%20use%20apache.setup_cgi%28%29%20with%0A%09multithreadedmodel%3F&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017495.html">
   <LINK REL="Next"  HREF="017497.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Good idea to use apache.setup_cgi() with
	multithreadedmodel?</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Huzaifa Tapal</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Good%20idea%20to%20use%20apache.setup_cgi%28%29%20with%0A%09multithreadedmodel%3F&In-Reply-To="
       TITLE="[mod_python] Good idea to use apache.setup_cgi() with
	multithreadedmodel?">huzaifa at hostway.com
       </A><BR>
    <I>Wed Feb 23 10:16:13 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="017495.html">[mod_python] Passing parameters to javascript from python script
</A></li>
        <LI>Next message: <A HREF="017497.html">[mod_python] communication between main_interpreter and
	subinterpreters
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17496">[ date ]</a>
              <a href="thread.html#17496">[ thread ]</a>
              <a href="subject.html#17496">[ subject ]</a>
              <a href="author.html#17496">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello All,

I have a custom handler that i have built that calls instantiates a web
application framework I have written and asks it process the request.  Since
this web app framework originally was designed for CGI and was used in CGI,
I am calling the apache.setup_cgi() to make the env seamless for the
framework.  I am running this under a multithreaded mpm apache configuration
and am running into problems with race conditions with multiple threads
accessing shared resources in memory.

Since my customer handler kind of resembles the provided cgihandler which is
not suited for a multithreaded env, I am wondering I am right in doing the
apache.setup_cgi() like I am.  My handler code looks like as follows:

def handler(req):
    
    #_lock.acquire()
    #try:   
    # setup the cgi environment
    env, si, so = apache.setup_cgi(req)
    
    # write the content type for testing purposes
    #sys.stdout.write(&quot;content-type: text/html\r\n\r\n&quot;)
    
    cache = req.get_options().get(&quot;CACHE&quot;, &quot;Off&quot;)
    if cache == &quot;Off&quot;:
        cache = 0

    try:    
        # load the driver
        driver = GlobalCache.getCachedItem(&quot;Driver&quot;)
        if not driver: 
            driver = Driver([&quot;./Driver.py&quot;], cache_projects=cache,
modpy_req=req)

            # cache if we have caching objects turned
            if cache:
                GlobalCache.setCachedItem(&quot;Driver&quot;,driver)
        
        # process the request
        driver.process()
    except: 
        pass    

    apache.restore_nocgi(env, si, so) 
    return apache.OK
    #finally:
    #    _lock.release()


Any help would be appreciated.  

Hozi

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050223/0b800428/attachment.html">http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050223/0b800428/attachment.html</A>
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017495.html">[mod_python] Passing parameters to javascript from python script
</A></li>
	<LI>Next message: <A HREF="017497.html">[mod_python] communication between main_interpreter and
	subinterpreters
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17496">[ date ]</a>
              <a href="thread.html#17496">[ thread ]</a>
              <a href="subject.html#17496">[ subject ]</a>
              <a href="author.html#17496">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
