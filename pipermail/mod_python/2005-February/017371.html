<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Re: Photo Album Viewer and req.path_into.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Re%3A%20Photo%20Album%20Viewer%20and%20req.path_into.&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017370.html">
   <LINK REL="Next"  HREF="017375.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Re: Photo Album Viewer and req.path_into.</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Re%3A%20Photo%20Album%20Viewer%20and%20req.path_into.&In-Reply-To="
       TITLE="[mod_python] Re: Photo Album Viewer and req.path_into.">grahamd at dscpl.com.au
       </A><BR>
    <I>Wed Feb  9 18:56:03 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="017370.html">[mod_python] Cookie vs. Session
</A></li>
        <LI>Next message: <A HREF="017375.html">[mod_python] Re: Photo Album Viewer and req.path_into.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17371">[ date ]</a>
              <a href="thread.html#17371">[ thread ]</a>
              <a href="subject.html#17371">[ subject ]</a>
              <a href="author.html#17371">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Shawn Harrison wrote ..
&gt;<i> &gt; Not knowing for sure what you are wanting to do, I am going to assume
</I>&gt;<i> that
</I>&gt;<i> &gt; you want to wrap image files in a HTML page automatically.
</I>&gt;<i> 
</I>&gt;<i> Yes, that's the idea, although I only gave photos as an example: What I
</I>&gt;<i> really mean is this:
</I>&gt;<i> * If my document root is /web/examplecom/www/, and
</I>&gt;<i> * I have a request handler at /web/example/www/photos/index.py, and
</I>&gt;<i> * the photos are in /web/example/www/photos/
</I>&gt;<i> * Vampire is the PythonHandler, and
</I>&gt;<i> * req.uri is /photos/2004/10/01/137, then
</I>&gt;<i> ? will the handler in /photos/index.py pick up the request?
</I>
If you expect the files/paths/URLs to be named exactly as you state,
then for the currently available version of Vampire, the short answer
is &quot;No&quot;.

Long ramble follows about it. This may or may not be of interest but
is helpful for me to do so as to explore the issues myself. The
information may be useful to someone, so why not on the mailing
list. :-)

Vampire supports virtual directories, but not a virtual directory which
completely and transparently overlays a physical directory. Ie., where
a request for a resource gets bumped through the virtual directory
handler if there isn't a physical resource which corresponds to the
request.

As described in my previous email, the closest you will get is to have
the virtual directory which overlays the physical directory be a 
distinct sub node of the physical directory (or as a distinct path in
itself).

That is:

  /photos/browse.py #virtual directory handler in file system

  /photos/2004/10/01/137.jpg # physical file access URL
  /photos/browse/2004/10/01/137 # virtual resource access

Having said this, it doesn't mean that Vampire couldn't support what
you want, as I can see how it could be enhanced to allow exactly what
you want. Some explanations of how Vampire does some things are
in order here. Its assumed that Apache 2.0 being used, as Apache 1.3
screws up things because it does some things wrongly, but they were
fixed in Apache 2.0.

First off if you have &quot;/photos/index.py&quot; and it contains &quot;handler_html()&quot;,
the URL &quot;/photos/index.html&quot; will resolve to that handler. By default
though, accessing &quot;/photos&quot; will yield &quot;Not Found&quot;.

This is because the Apache DirectoryIndex directive doesn't extend
into the URL namespace where Vampire is used. To support this though,
Vampire supports saying:

  PythonOption VampireDirectoryIndex index.html

Now if you access &quot;/photos&quot; it will resolve as if the request had been
for &quot;/photos/index.html&quot;.

Next thing to explain is virtual directories. These are implemented by
having a code file, for example &quot;/photos/browse.py&quot;, which contains a
&quot;handler()&quot; method.

If a request such as &quot;/photos/browse/2004/10/01/137&quot; occurs, the
handler is called, with &quot;req.path_info&quot; set to &quot;/2004/10/01/137&quot;.
The handler can then decide as to what to do with it.

For this to work though, there cannot also be a subdirectory in existance
called &quot;browse&quot; as Apache will give precedence to a search of the physical
subdirectory and will ignore the existance of &quot;/photos/browse.py&quot; and
as such will not trigger Vampire appropriately.

The reason that the two don't come together if the &quot;handler()&quot; method of
&quot;/photos/browse.py&quot; was actually in &quot;/photos/index.py&quot; is that Vampire
has an explicit check and disallows mapping to a directory index file if
the &quot;req.path_info&quot; field is not empty.

The thinking behind this is that the &quot;index.py&quot; file in that directory is mean't
to be an index file for that directory alone and shouldn't apply to a subdirectory
be it physical or virtual.

This doesn't mean that the two couldn't meet and thus &quot;handler()&quot; within
&quot;/photos/index.py&quot; be executed, but I believe it would be wrong to make
use of the &quot;VampireDirectoryIndex&quot; directive as the trigger for it.

Thus, what I see that could be done is for Vampire to support a new Python
option setting:

  PythonOption VampireVirtualDirectory index

What this would mean is that for the specific case where a virtual resource
within a directory is accessed, ie., there was no physical resource and there
was no other resource specific handler defined which could be matched, it
would fallback to executing the &quot;handler()&quot; method defined in the code file
&quot;/photo/index.py&quot;.

In theory, this would provide you with the ability to preserve the structure
you have now. I do need to investigate though how this interacts with another
feature of Vampire whereby there can be default fallback handlers for
specific resource types. I would need to decide which should take precedence.
My initial guess is that the virtual directory handler should override the other
but it may need to be more flexible than that.

&gt;<i> Based on the rest of your reply, I am inferring that Vampire can handle
</I>&gt;<i> dynamic object publishing from a database or filesystem, but that the 
</I>&gt;<i> set up would have to be different from what I've been using.
</I>
As Vampire is now, &quot;Yes&quot; and &quot;Yes&quot;.

&gt;<i> &gt; Firstly, Vampire is structured so as to avoid altogether use of sys.path
</I>&gt;<i> &gt; and all the complications that can arise because of it. Thus, you would
</I>&gt;<i> &gt; not add &quot;/web&quot; to sys.path. 
</I>&gt;<i> 
</I>&gt;<i> Having '/web' in sys.path is fairly basic to the architecture that I've
</I>&gt;<i> been developing. Every &quot;web service&quot; is a folder under /web, and each 
</I>&gt;<i> includes both request handlers and regular Python modules, including 
</I>&gt;<i> database access modules. I also want to be able to use Apache as one 
</I>&gt;<i> front end among many, not as the only one; so I need to be able to 
</I>&gt;<i> import modules in a more-or-less Python-native fashion.
</I>
Using the native &quot;import&quot; statement of Python has lots of issues though
in the context of mod_python, many of which have been covered in
discussions on the mailing list previously.

One can still mix handlers and Python modules in the same directory with
Vampire, but instead of using &quot;import&quot; you use &quot;vampire.importModule()&quot;
to load a module from the specific directory it resides in.

Thus, you could still do exactly what you do know, but by not using
&quot;sys.path&quot; and &quot;import&quot;, and instead using Vampire's import mechanism,
you would get some additional benefits because the issues that come
up with using &quot;import&quot; don't arise. The Vampire importing mechanism
also solves lots of problems that exist in &quot;apache.import_module()&quot;.

&gt;<i> Yes, it's an interesting example, and it provides a lot of information
</I>&gt;<i> about how Vampire would deal with various usage scenarios. You should 
</I>&gt;<i> add some of these details to your documentation.
</I>
Am slowly progressing towards being able to update the documentation.

Am currently in the middle of a rehosting of my web site from an Apache 1.3
to an Apache 2.0 site and moving from using PHP to mod_python/Vampire
for page composition. Also have heavy duty project at work, plus have 
been involved in dealing with some security issues with some Open Source
packages. Would love to be able to just sit down for a couple of weeks and
catch up with all my web site and Vampire stuff, but no such like right now.
Thus, everying in slow motion right now.

Graham
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017370.html">[mod_python] Cookie vs. Session
</A></li>
	<LI>Next message: <A HREF="017375.html">[mod_python] Re: Photo Album Viewer and req.path_into.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17371">[ date ]</a>
              <a href="thread.html#17371">[ thread ]</a>
              <a href="subject.html#17371">[ subject ]</a>
              <a href="author.html#17371">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
