<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] how do I eliminate the .py extension in url?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20how%20do%20I%20eliminate%20the%20.py%20extension%20in%20url%3F&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017390.html">
   <LINK REL="Next"  HREF="017389.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] how do I eliminate the .py extension in url?</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20how%20do%20I%20eliminate%20the%20.py%20extension%20in%20url%3F&In-Reply-To="
       TITLE="[mod_python] how do I eliminate the .py extension in url?">grahamd at dscpl.com.au
       </A><BR>
    <I>Thu Feb 10 21:02:15 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="017390.html">[mod_python] how do I eliminate the .py extension in url?
</A></li>
        <LI>Next message: <A HREF="017389.html">[mod_python] how do I eliminate the .py extension in url?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17386">[ date ]</a>
              <a href="thread.html#17386">[ thread ]</a>
              <a href="subject.html#17386">[ subject ]</a>
              <a href="author.html#17386">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Graham Dumpleton wrote ..
&gt;<i> Chris Jackson wrote ..
</I>&gt;<i> &gt; If you rename my_script.py to index.py, you can just reference your
</I>&gt;<i> &gt; handler like this:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; /scripts/my_handler
</I>&gt;<i> 
</I>&gt;<i> Except that calling things &quot;index.py&quot; opens up another big can of worms
</I>&gt;<i> if using publisher. See:
</I>&gt;<i> 
</I>&gt;<i>   <A HREF="http://issues.apache.org/jira/browse/MODPYTHON-9">http://issues.apache.org/jira/browse/MODPYTHON-9</A>
</I>&gt;<i>   <A HREF="http://issues.apache.org/jira/browse/MODPYTHON-10">http://issues.apache.org/jira/browse/MODPYTHON-10</A>
</I>&gt;<i>   <A HREF="http://issues.apache.org/jira/browse/MODPYTHON-11">http://issues.apache.org/jira/browse/MODPYTHON-11</A>
</I>&gt;<i> 
</I>&gt;<i> Although some disagree, mod_python.publisher is broken in a number of
</I>&gt;<i> ways and needs a good overhaul.
</I>&gt;<i> 
</I>&gt;<i> Soon maybe I will hack together something to give same style of interface
</I>&gt;<i> as publisher on top of Vampire just to show how much better things could
</I>&gt;<i> be. Alas, probably no time to do so. :-)
</I>
Found some time. :-)

As an experiment, what I did was to take a copy of mod_python.publisher
and simply replace the module loading section with calls to the module loader
in Vampire.

Result seems to fix all three of the issues listed above and also addresses:

  <A HREF="http://issues.apache.org/jira/browse/MODPYTHON-8">http://issues.apache.org/jira/browse/MODPYTHON-8</A>

as well, since Vampire uses a two level locking scheme on the module cache.

Use of the Vampire module loading and caching system will however introduce
some unexpected differences to what you would get with standard mod_python
module loader. The two main ones will be that module reloading cannot be
turned off and the second is that data isn't persistent across module reloads
unless you take special action. I will not bother going into the details of why
these two things are as they are, unless someone actually bothers to play with
this.

Anyway, below is a patch against the publisher.py file from 3.1.3. You shouldn't
just modify your installed &quot;publisher.py&quot; file. Simplest thing to do to experiment
is to copy it into your document tree where your handlers are and call it
&quot;_publisher.py&quot;. Then change SetHandler/AddHandler to &quot;_publisher&quot;. Make
the changes below to that copy of the file.

You will need to get a copy of Vampire.

*** /usr/local/src/mod_python-3.1.3/lib/python/mod_python/publisher.py	Fri Feb 11 12:42:24 2005
--- _publisher.py	Fri Feb 11 12:59:25 2005
***************
*** 28,35 ****
    5. Does not give special meaning to '.' and '..'.
  &quot;&quot;&quot;
  
! import apache
! import util
  
  import sys
  import os
--- 28,35 ----
    5. Does not give special meaning to '.' and '..'.
  &quot;&quot;&quot;
  
! from mod_python import apache
! from mod_python import util
  
  import sys
  import os
***************
*** 40,45 ****
--- 40,47 ----
  import new
  from types import *
  
+ import vampire
+ 
  imp_suffixes = &quot; &quot;.join([x[0][1:] for x in imp.get_suffixes()])
  
  def handler(req):
***************
*** 85,90 ****
--- 87,93 ----
          suff_matcher = re.compile(exp) # python caches these, so its fast
          module_name = suff_matcher.sub(&quot;&quot;, module_name)
  
+     &quot;&quot;&quot;
      # import module (or reload if needed)
      # the [path] argument tells import_module not to allow modules whose
      # full path is not in [path] or below.
***************
*** 110,116 ****
          except ImportError:
              # raise the original exception
              raise et, ev, etb
!         
      # does it have an __auth__?
      realm, user, passwd = process_auth(req, module)
  
--- 113,137 ----
          except ImportError:
              # raise the original exception
              raise et, ev, etb
!     &quot;&quot;&quot;
! 
!     # XXX
! 
!     try:
! 	#module = vampire.importModule(module_name,path,req=req)
! 	module = vampire.ModuleCache().importModule(module_name,path,req=req)
!     except OSError:
!         et, ev, etb = sys.exc_info()
!         func_path = module_name
!         module_name = &quot;index&quot;
!         try:
! 	    #module = vampire.importModule(module_name,path,req=req)
! 	    module = vampire.ModuleCache().importModule(module_name,path,req=req)
!         except OSError:
!             raise et, ev, etb
! 
!     # XXX
! 
      # does it have an __auth__?
      realm, user, passwd = process_auth(req, module)
  
</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017390.html">[mod_python] how do I eliminate the .py extension in url?
</A></li>
	<LI>Next message: <A HREF="017389.html">[mod_python] how do I eliminate the .py extension in url?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17386">[ date ]</a>
              <a href="thread.html#17386">[ thread ]</a>
              <a href="subject.html#17386">[ subject ]</a>
              <a href="author.html#17386">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
