<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Re: Photo Album Viewer and req.path_into.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Re%3A%20Photo%20Album%20Viewer%20and%20req.path_into.&In-Reply-To=1107993363.31152%40dscpl.user.openhosting.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017371.html">
   <LINK REL="Next"  HREF="017372.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Re: Photo Album Viewer and req.path_into.</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Re%3A%20Photo%20Album%20Viewer%20and%20req.path_into.&In-Reply-To=1107993363.31152%40dscpl.user.openhosting.com"
       TITLE="[mod_python] Re: Photo Album Viewer and req.path_into.">grahamd at dscpl.com.au
       </A><BR>
    <I>Thu Feb 10 04:02:32 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="017371.html">[mod_python] Re: Photo Album Viewer and req.path_into.
</A></li>
        <LI>Next message: <A HREF="017372.html">[mod_python] Single Persisten DB conn across multiple connections
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17375">[ date ]</a>
              <a href="thread.html#17375">[ thread ]</a>
              <a href="subject.html#17375">[ subject ]</a>
              <a href="author.html#17375">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On 10/02/2005, at 10:56 AM, Graham Dumpleton wrote:

&gt;<i> Shawn Harrison wrote ..
</I>&gt;&gt;&gt;<i> Not knowing for sure what you are wanting to do, I am going to assume
</I>&gt;&gt;<i> that
</I>&gt;&gt;&gt;<i> you want to wrap image files in a HTML page automatically.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Yes, that's the idea, although I only gave photos as an example: What 
</I>&gt;&gt;<i> I
</I>&gt;&gt;<i> really mean is this:
</I>&gt;&gt;<i> * If my document root is /web/examplecom/www/, and
</I>&gt;&gt;<i> * I have a request handler at /web/example/www/photos/index.py, and
</I>&gt;&gt;<i> * the photos are in /web/example/www/photos/
</I>&gt;&gt;<i> * Vampire is the PythonHandler, and
</I>&gt;&gt;<i> * req.uri is /photos/2004/10/01/137, then
</I>&gt;&gt;<i> ? will the handler in /photos/index.py pick up the request?
</I>&gt;<i>
</I>&gt;<i> If you expect the files/paths/URLs to be named exactly as you state,
</I>&gt;<i> then for the currently available version of Vampire, the short answer
</I>&gt;<i> is &quot;No&quot;.
</I>
Having thought more about this. The particular case where there is 
actually
a physical resource, but where you might want to represent it in a 
different
format, is much better handled in other ways in Vampire.

Take for example where physical file &quot;/photos/2004/10/01/137.jpg&quot; 
exists,
but where you want to be able to access it as 
&quot;/photos/2004/10/01/137.html&quot;
and thus have the image automatically framed in in appropriate HTML 
page.

One would take a modified version of handler I already sent you. What 
you
call it or where it is stored is irrelevant, but I'll save it as the 
file
&quot;/photos/index.py&quot; to match what you want.

Next thing is to put the &quot;.htaccess&quot; file in &quot;photos&quot; subdirectory with 
it
containing:

   Options -Indexes -MultiViews

   SetHandler python-program
   PythonHandler vampire
   PythonPath 'sys.path'
   PythonDebug On

   PythonOption VampireDefaultHandlers On

Ie., have added &quot;VampireDefaultHandlers&quot; option to enabled default 
handler
lookup in Vampire.

Then add into the &quot;photos&quot; directory the file &quot;.vampire&quot; which contains:

   [Handlers]

   handler_html = %(__config_root__)s/index.py

I know this doesn't follow the REST style of URLs that you were using, 
ie.,
no extension, but the actual image is still accessed with an extension 
so
using a &quot;.html&quot; extension makes more sense to me than a naked URL.

If you really wanted naked URLs, instead of &quot;handler_html&quot; in .vampire 
file
and in name of method of &quot;index.py&quot;, use just &quot;handler&quot;. The code will 
need
to be tweaked a bit as it strips off the &quot;.html&quot; extension in places, 
but
it will yield exactly what you wanted.

Anyway, for the &quot;.html&quot; case, setting this up this way means that 
Vampire
will if it cannot find an appropriate content handler in the directory
hierarchy itself to URL, fallback to using the default handler specified
by the &quot;.vampire&quot; configuration file.

The content handler can then determine if the URL equates to a virtual
resource matched to a physical image file. If it does, it returns a HTML
page which within itself loads the image. The content handler doesn't 
even
need to play with req.path_info as req.filename and req.uri are going to
be correct for the target already, one just needs to fiddle with the
extension to identify the associated physical image file.

When it comes down to accessing resources which are completely virtual,
ie., no physical equivalent in the document hierarchy, then that is 
where
the script for a virtual directory is used as described previously.

Include below is the code for the &quot;index.py&quot; content handler as 
described.

from mod_python import apache

import os
import posixpath

import vampire

_PAGE = &quot;&quot;&quot;
&lt;html&gt;
&lt;body&gt;
&lt;h1&gt;Photo: %(name)s&lt;/h1&gt;
&lt;img src=&quot;%(url)s&quot; /&gt;
&lt;/body&gt;
&lt;/html&gt;
&quot;&quot;&quot;

# Handler for virtual directory.

def handler_html(req):

   # Determine what type of image file it is.

   path = None
   extn = None

   allowed = [ &quot;.jpg&quot;, &quot;.gif&quot; ]

   stub = os.path.splitext(req.filename)[0]

   for suffix in allowed:
     file = stub + suffix

     if os.path.exists(file):
       path = file
       extn = suffix

   if path == None:
     return apache.HTTP_NOT_FOUND

   # Determine the URL to the actual image.

   config = vampire.loadConfig(req,&quot;.vampire&quot;)
   defaults = config.defaults()

   url = os.path.splitext(req.uri)[0] + extn
   name = 
os.path.splitext(req.uri[len(defaults[&quot;__baseurl_abs__&quot;]):][1:])[0]

   content = _PAGE % { &quot;name&quot;: name, &quot;url&quot;: url }

   # Return the rendered page content.

   req.content_type = &quot;text/html&quot;
   req.send_http_header()

   req.write(content)

   return apache.OK


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017371.html">[mod_python] Re: Photo Album Viewer and req.path_into.
</A></li>
	<LI>Next message: <A HREF="017372.html">[mod_python] Single Persisten DB conn across multiple connections
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17375">[ date ]</a>
              <a href="thread.html#17375">[ thread ]</a>
              <a href="subject.html#17375">[ subject ]</a>
              <a href="author.html#17375">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
