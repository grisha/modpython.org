<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Filtering POST requests (req.read ())
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Filtering%20POST%20requests%20%28req.read%20%28%29%29&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017439.html">
   <LINK REL="Next"  HREF="017440.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Filtering POST requests (req.read ())</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Vladimir Petrovic</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Filtering%20POST%20requests%20%28req.read%20%28%29%29&In-Reply-To="
       TITLE="[mod_python] Filtering POST requests (req.read ())">vladap at criticalpublics.com
       </A><BR>
    <I>Tue Feb 15 09:30:31 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="017439.html">[mod_python] Session problems
</A></li>
        <LI>Next message: <A HREF="017440.html">[mod_python] Filtering POST requests (req.read ())
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17435">[ date ]</a>
              <a href="thread.html#17435">[ thread ]</a>
              <a href="subject.html#17435">[ subject ]</a>
              <a href="author.html#17435">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>In my setup, apache is acting like a reverse proxy to the application server 
(Zope). The setup uses proxy rewrite rules. I would like to setup a modpython 
handler which will inspect all POST requests and it will block the request if 
some special field names are used.

I've setup PythonPostReadRequestHandler
with the following code:

fs = util.FieldStorage (req)
for k in fs.keys ():
  if not check_field_name (k): return apache.HTTP_FORBIDDEN

return apache.OK

If the POST request contain an invalid field apache returns FORBIDDEN error as 
it should. But if the request doesn't contain invalid field names, then the 
request is &quot;blocked&quot;, the client doesn't get any reply. The same happens if I 
just call req.read () inside the handler.

It seems that calls to req.read () inside FieldStorage use all request data 
that client sends, and after the handler returns the request gets blocked. Is 
there a way to solve this problem or is there an alternative way to inspect 
POST data ?

thank you,
Vladimir

</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017439.html">[mod_python] Session problems
</A></li>
	<LI>Next message: <A HREF="017440.html">[mod_python] Filtering POST requests (req.read ())
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17435">[ date ]</a>
              <a href="thread.html#17435">[ thread ]</a>
              <a href="subject.html#17435">[ subject ]</a>
              <a href="author.html#17435">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
