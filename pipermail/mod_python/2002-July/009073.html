<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Fw: slow child init problems
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Fw%3A%20slow%20child%20init%20problems&In-Reply-To=20020729162021.20546.qmail%40email.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009072.html">
   <LINK REL="Next"  HREF="009076.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
<table border=0 width="100%"><tr><td valign="top">
   <H1>[mod_python] Fw: slow child init problems</H1>
    <B>Gregory (Grisha) Trubetskoy</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Fw%3A%20slow%20child%20init%20problems&In-Reply-To=20020729162021.20546.qmail%40email.com"
       TITLE="[mod_python] Fw: slow child init problems">grisha at modpython.org
       </A><BR>
    <I>Mon Jul 29 21:36:14 EST 2002</I>
    <P><UL>
        <LI>Previous message: <A HREF="009072.html">[mod_python] Fw: slow child init problems
</A></li>
        <LI>Next message: <A HREF="009076.html">[mod_python] Fw: slow child init problems
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9073">[ date ]</a>
              <a href="thread.html#9073">[ thread ]</a>
              <a href="subject.html#9073">[ subject ]</a>
              <a href="author.html#9073">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, 29 Jul 2002, Jack Diederich wrote:

&gt;<i> The problem seems to be that the imports, even with the PythonImport
</I>&gt;<i> directive listing all of them aren't done until ChildInitHanlder(),
</I>&gt;<i> which is called the first time a child process gets its first hit,
</I>&gt;<i> apparently.  I say apparently because the difference between using
</I>&gt;<i> PythonImport or not is zero time-wise.
</I>
[snip]

&gt;<i> Why can't the work (whatever it is) be done _before_ the fork of the
</I>&gt;<i> children?
</I>
[snip]

First, you should look at making sure that everything runs under one
sub-interpreter. The information such as the name of the virtual host is
undefined until the actual request comes in, so PythonImport imports
everything under the interpreter named after the directory in the
surrounding &lt;Directory&gt; tag or the main interpreter. Your other code
probably runs in the subinterpreter for that virtual server, so it ends up
reimporting everything again. You can force everything to run under the
main interpreter by specifying &quot;PythonInterpreter main_interpreter&quot;.

It's possible that you're right that ChildInit gets executed on the first
hit, I can't answer this off the top of my head without digging in apache
source code or experimenting. The reason PythonImport stuff does not get
executed at Apache startup before it forks is because at that point Apache
is run as root.

IMHO PythonImport is bad and shouldn't be there. I understand the issue,
but PythonImport isn't the cleanest solution to it because of the way it
ends up having be implemented, and I can't think of anything clever that
would address this.

One simple hack to tackle this problem is to add something into your
Apache startup script that initiates the first hit using wget or fetch or
lynx or whatever. I've used this technique very successfuly before.

Grisha


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009072.html">[mod_python] Fw: slow child init problems
</A></li>
	<LI>Next message: <A HREF="009076.html">[mod_python] Fw: slow child init problems
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9073">[ date ]</a>
              <a href="thread.html#9073">[ thread ]</a>
              <a href="subject.html#9073">[ subject ]</a>
              <a href="author.html#9073">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
