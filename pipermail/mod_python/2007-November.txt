From martijn at xs4us.nu  Fri Nov  2 06:46:01 2007
From: martijn at xs4us.nu (Martijn Moeling)
Date: Fri Nov  2 06:46:18 2007
Subject: [mod_python] Mod Python, Webdav
References: <F2A508A3-F15D-442D-844C-67DAEF792320@indiana.edu>
	<88e286470710301724j5aee05dcx2cd7998dd5732b03@mail.gmail.com>
Message-ID: <B6C73A5E30565245BB6D32B5F5DF7A52172AAA@sense.emmastraat.pijnacker>

Hi All,
 
I use mod_Python as a backend for my browser based desktop. (think of it as a WebOs)
It is used at several places for production and it works great.
 
Basically it consists of a MySQL database and several .py modules with complete templating system for serving as a CMS too. the main goal hoever is to be able to build web base Apps which run side by side in a javascript based MDI so the browser window becomes a Desktop.
 
One of the main things an OS should do is take care of storage. and I think webdav is the way to go, however I would like to store the data in the MySQL database.
 
Whilst searching the net I found a lot of python related WebDAV stuff but since I just started thinking about using WebDAV, there just might be some of you able to point me in the right direction.
 
Next Webdav is just another protocol 'over' http so using mod_python it should not be to hard to modify existing python libs for a webdav server to integrate with mod python, right? or is there anything out there being used by one of you guy's?
 
Any tips, product names etc is highly appreciated!!
 
Kind regards,
 
 
Martijn Moeling
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20071102/701873da/attachment.html
From graham.dumpleton at gmail.com  Fri Nov  2 07:20:55 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Fri Nov  2 07:21:05 2007
Subject: [mod_python] Mod Python, Webdav
In-Reply-To: <B6C73A5E30565245BB6D32B5F5DF7A52172AAA@sense.emmastraat.pijnacker>
References: <F2A508A3-F15D-442D-844C-67DAEF792320@indiana.edu>
	<88e286470710301724j5aee05dcx2cd7998dd5732b03@mail.gmail.com>
	<B6C73A5E30565245BB6D32B5F5DF7A52172AAA@sense.emmastraat.pijnacker>
Message-ID: <88e286470711020420n1ba6f8f3n39fa3056135f9abb@mail.gmail.com>

On 02/11/2007, Martijn Moeling <martijn@xs4us.nu> wrote:
>
>
>
> Hi All,
>
> I use mod_Python as a backend for my browser based desktop. (think of it as
> a WebOs)
> It is used at several places for production and it works great.
>
> Basically it consists of a MySQL database and several .py modules with
> complete templating system for serving as a CMS too. the main goal hoever is
> to be able to build web base Apps which run side by side in a javascript
> based MDI so the browser window becomes a Desktop.
>
> One of the main things an OS should do is take care of storage. and I think
> webdav is the way to go, however I would like to store the data in the MySQL
> database.
>
> Whilst searching the net I found a lot of python related WebDAV stuff but
> since I just started thinking about using WebDAV, there just might be some
> of you able to point me in the right direction.
>
> Next Webdav is just another protocol 'over' http so using mod_python it
> should not be to hard to modify existing python libs for a webdav server to
> integrate with mod python, right? or is there anything out there being used
> by one of you guy's?
>
> Any tips, product names etc is highly appreciated!!

My personal opinion is that if one wants to use Python for webdav
stuff in the context of Apache, one would be better of developing a
custom Apache module that uses a bit of custom dispatch code, but
mainly employs SWIG bindings wrapping the internal Apache APIs, in
particular, SWIG bindings which wrap the existing public APIs for the
Apache mod_dav module.

By wrapping the Apache mod_dav module you have all the hard work done
for you and you don't have to worry about interpreting all the webdav
requests, but just implementing the callbacks which respond to the
request types.

For brief details of the Apache mod_dav C API, see:

  http://docx.itscales.com/group___m_o_d___d_a_v.html

Doing just this is something on my extended TODO list. Part of the
reason for implementing mod_wsgi was to in time break open the Python
interpreter management code to make it available to companion modules
such as a Python binding for Apache mod_dav. I have already started on
SWIG bindings for the main Apache API, but because I have other stuff
I need to get done first, haven't started looking at mod_dav in
particular yet.

Graham
From martijn at xs4us.nu  Fri Nov  2 08:14:27 2007
From: martijn at xs4us.nu (Martijn Moeling)
Date: Fri Nov  2 08:14:36 2007
Subject: [mod_python] Mod Python, Webdav
References: <F2A508A3-F15D-442D-844C-67DAEF792320@indiana.edu><88e286470710301724j5aee05dcx2cd7998dd5732b03@mail.gmail.com><B6C73A5E30565245BB6D32B5F5DF7A52172AAA@sense.emmastraat.pijnacker>
	<88e286470711020420n1ba6f8f3n39fa3056135f9abb@mail.gmail.com>
Message-ID: <B6C73A5E30565245BB6D32B5F5DF7A52172AAB@sense.emmastraat.pijnacker>

Graham,
 
I feel the same about this topic as you do, but I simply do not have the knowledge about the apache internals to start working on it, and more importantly since the development of the linux TCP/IP stack I have been able to avoid programming in C, besides that my knowledge of C has become to little, I allways hated using that language.
So please don't shoot me for not starting on that project.
 
Thank you for the info, In this list I have found someone who did what I want and I did send him an email, all python webdav related stuff seems to be rather old. but the current development with AJAX etc. makes a demand for webdav so things might change on that.
 
Kind regards,
 
Martijn Moeling 

________________________________

Van: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
Verzonden: vr 02.11.2007 12:20
Aan: Martijn Moeling
CC: mod_python
Onderwerp: Re: [mod_python] Mod Python, Webdav



On 02/11/2007, Martijn Moeling <martijn@xs4us.nu> wrote:
>
>
>
> Hi All,
>
> I use mod_Python as a backend for my browser based desktop. (think of it as
> a WebOs)
> It is used at several places for production and it works great.
>
> Basically it consists of a MySQL database and several .py modules with
> complete templating system for serving as a CMS too. the main goal hoever is
> to be able to build web base Apps which run side by side in a javascript
> based MDI so the browser window becomes a Desktop.
>
> One of the main things an OS should do is take care of storage. and I think
> webdav is the way to go, however I would like to store the data in the MySQL
> database.
>
> Whilst searching the net I found a lot of python related WebDAV stuff but
> since I just started thinking about using WebDAV, there just might be some
> of you able to point me in the right direction.
>
> Next Webdav is just another protocol 'over' http so using mod_python it
> should not be to hard to modify existing python libs for a webdav server to
> integrate with mod python, right? or is there anything out there being used
> by one of you guy's?
>
> Any tips, product names etc is highly appreciated!!

My personal opinion is that if one wants to use Python for webdav
stuff in the context of Apache, one would be better of developing a
custom Apache module that uses a bit of custom dispatch code, but
mainly employs SWIG bindings wrapping the internal Apache APIs, in
particular, SWIG bindings which wrap the existing public APIs for the
Apache mod_dav module.

By wrapping the Apache mod_dav module you have all the hard work done
for you and you don't have to worry about interpreting all the webdav
requests, but just implementing the callbacks which respond to the
request types.

For brief details of the Apache mod_dav C API, see:

  http://docx.itscales.com/group___m_o_d___d_a_v.html

Doing just this is something on my extended TODO list. Part of the
reason for implementing mod_wsgi was to in time break open the Python
interpreter management code to make it available to companion modules
such as a Python binding for Apache mod_dav. I have already started on
SWIG bindings for the main Apache API, but because I have other stuff
I need to get done first, haven't started looking at mod_dav in
particular yet.

Graham


-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20071102/db6037db/attachment.html
From graham.dumpleton at gmail.com  Sun Nov  4 05:15:12 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sun Nov  4 05:15:18 2007
Subject: [mod_python] mod_python or apache scalability?
In-Reply-To: <02c101c81eca$be96a570$3bc3f050$@com>
References: <022001c8040b$31c20790$954616b0$@com>
	<88e286470710011846h4e5af467h3074f4b02b703d05@mail.gmail.com>
	<02c101c81eca$be96a570$3bc3f050$@com>
Message-ID: <88e286470711040215n310aa34dhda7234b79c0292b9@mail.gmail.com>

On 04/11/2007, Alec Matusis <matusis@matusis.com> wrote:
> > FWIW, I personally would try and move from prefork to worker MPM as
> > the number of Apache child processes you are running with is to my
> > mind excessive. Using worker would certainly drop memory usage for a
> > start as you wouldn't need as many child processes to be started.
>
> I am just following up on this, since we tried worker MPM this weekend.
> On our dev/stage it worked perfectly.
> On live, worker MPM freed up about 2GB of memory compared to prefork.
> However, on live, it turned out to be unstable.
> This is what we say in the main error log:
>
> [Sun Nov 04 01:37:45 2007] [notice] child pid 20347 exit signal Segmentation
> fault (11)
> [Sun Nov 04 01:37:45 2007] [notice] child pid 20460 exit signal Aborted (6)
> [Sun Nov 04 01:37:45 2007] [notice] child pid 20515 exit signal Segmentation
> fault (11)
> *** glibc detected *** double free or corruption (!prev): 0x0000000000762c50
> ***
> *** glibc detected *** double free or corruption (!prev): 0x000000000075d100
> ***
> [Sun Nov 04 01:37:46 2007] [notice] child pid 20152 exit signal Segmentation
> fault (11)
>
> In the application log, we saw two types of errors:
>
> MySQLError: Connection to database failed
> OperationalError: (2006, 'MySQL server has gone away')
>
> and
>
> IOError: image file is truncated (44 bytes not processed)
>
> The first type has to do with MySQLdb module, but the second one occurred
> when large images were uploaded.

Which indicates that some third party package you are using is not
thread safe. This can occur if you are also using PHP as various of
its third party packages are not thread safe. Also ensure that you are
using the latest available Python database adapters and that they are
compiled against thread safe reentrant libraries.

Graham

> We had to revert to prefork as a result of this.
>
> On another note, I managed to empirically find the maximum ServerLimit for
> prefork, before the machine dies from swapping.
> It is 380 with 4GB RAM.
>
> > -----Original Message-----
> > From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> > Sent: Monday, October 01, 2007 6:47 PM
> > To: Alec Matusis
> > Cc: mod_python@modpython.org
> > Subject: Re: [mod_python] mod_python or apache scalability?
> >
> > On 01/10/2007, Alec Matusis <matusis@matusis.com> wrote:
> > > in the apache error log. We also got
> > >
> > > kernel: possible SYN flooding on port 80. Sending cookies.
> > >
> > > in /var/log/messages system log.
> >
> > Have you determined for certain that you aren't the target of an
> > external SYN Flood DOS attack?
> >
> > Do a Google search for 'kernel: possible SYN flooding on port 80.
> > Sending cookies' and you will find lots of stuff to read. Your running
> > out of or having a large number of socket connections may be
> > symptomatic of a large number of half open connections being created
> > and then being left in TIME_WAIT. Thus perhaps do some better analysis
> > of socket connection states using netstat. If not a SYN Flood, then
> > possibly follow some of the other suggestions in the pages you will
> > find when you do the search.
> >
> > FWIW, I personally would try and move from prefork to worker MPM as
> > the number of Apache child processes you are running with is to my
> > mind excessive. Using worker would certainly drop memory usage for a
> > start as you wouldn't need as many child processes to be started. I
> > wouldn't be concerned about running out of threads as when running
> > worker I wouldn't suggest more than 25 threads per process as a
> > starting point anyway. If your mod_python application was creating
> > lots of threads, you are likely to hit the thread limit with prefork
> > and not just worker so which MPM is used shouldn't be an issue in that
> > case.
> >
> > BTW, what operating system are you using?
> >
> > Graham
>
>
From graham.dumpleton at gmail.com  Sun Nov  4 05:32:35 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sun Nov  4 05:32:41 2007
Subject: [mod_python] mod_python or apache scalability?
In-Reply-To: <02c201c81ecc$b3656ef0$1a304cd0$@com>
References: <022001c8040b$31c20790$954616b0$@com>
	<88e286470710011846h4e5af467h3074f4b02b703d05@mail.gmail.com>
	<02c101c81eca$be96a570$3bc3f050$@com>
	<88e286470711040215n310aa34dhda7234b79c0292b9@mail.gmail.com>
	<02c201c81ecc$b3656ef0$1a304cd0$@com>
Message-ID: <88e286470711040232w49400695va54348964b6fedac@mail.gmail.com>

BTW, are you still using mod_python 3.1.4? Older mod_python versions
have various bugs and you would be much better upgrading to 3.3.1 if
you haven't already.

Graham

On 04/11/2007, Alec Matusis <matusis@matusis.com> wrote:
> > Which indicates that some third party package you are using is not
> > thread safe. This can occur if you are also using PHP as various of
> > its third party packages are not thread safe.
>
> We are not using PHP, only python with mod_python.
> The only third party packages we use are MySQLdb adapter and PIL image
> library.
>
> So I guess both PIL and MySQLdb have these problems.
>
>
> > -----Original Message-----
> > From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> > Sent: Sunday, November 04, 2007 2:15 AM
> > To: Alec Matusis
> > Cc: mod_python@modpython.org
> > Subject: Re: [mod_python] mod_python or apache scalability?
> >
> > On 04/11/2007, Alec Matusis <matusis@matusis.com> wrote:
> > > > FWIW, I personally would try and move from prefork to worker MPM as
> > > > the number of Apache child processes you are running with is to my
> > > > mind excessive. Using worker would certainly drop memory usage for
> > a
> > > > start as you wouldn't need as many child processes to be started.
> > >
> > > I am just following up on this, since we tried worker MPM this
> > weekend.
> > > On our dev/stage it worked perfectly.
> > > On live, worker MPM freed up about 2GB of memory compared to prefork.
> > > However, on live, it turned out to be unstable.
> > > This is what we say in the main error log:
> > >
> > > [Sun Nov 04 01:37:45 2007] [notice] child pid 20347 exit signal
> > Segmentation
> > > fault (11)
> > > [Sun Nov 04 01:37:45 2007] [notice] child pid 20460 exit signal
> > Aborted (6)
> > > [Sun Nov 04 01:37:45 2007] [notice] child pid 20515 exit signal
> > Segmentation
> > > fault (11)
> > > *** glibc detected *** double free or corruption (!prev):
> > 0x0000000000762c50
> > > ***
> > > *** glibc detected *** double free or corruption (!prev):
> > 0x000000000075d100
> > > ***
> > > [Sun Nov 04 01:37:46 2007] [notice] child pid 20152 exit signal
> > Segmentation
> > > fault (11)
> > >
> > > In the application log, we saw two types of errors:
> > >
> > > MySQLError: Connection to database failed
> > > OperationalError: (2006, 'MySQL server has gone away')
> > >
> > > and
> > >
> > > IOError: image file is truncated (44 bytes not processed)
> > >
> > > The first type has to do with MySQLdb module, but the second one
> > occurred
> > > when large images were uploaded.
> >
> > Which indicates that some third party package you are using is not
> > thread safe. This can occur if you are also using PHP as various of
> > its third party packages are not thread safe. Also ensure that you are
> > using the latest available Python database adapters and that they are
> > compiled against thread safe reentrant libraries.
> >
> > Graham
> >
> > > We had to revert to prefork as a result of this.
> > >
> > > On another note, I managed to empirically find the maximum
> > ServerLimit for
> > > prefork, before the machine dies from swapping.
> > > It is 380 with 4GB RAM.
> > >
> > > > -----Original Message-----
> > > > From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> > > > Sent: Monday, October 01, 2007 6:47 PM
> > > > To: Alec Matusis
> > > > Cc: mod_python@modpython.org
> > > > Subject: Re: [mod_python] mod_python or apache scalability?
> > > >
> > > > On 01/10/2007, Alec Matusis <matusis@matusis.com> wrote:
> > > > > in the apache error log. We also got
> > > > >
> > > > > kernel: possible SYN flooding on port 80. Sending cookies.
> > > > >
> > > > > in /var/log/messages system log.
> > > >
> > > > Have you determined for certain that you aren't the target of an
> > > > external SYN Flood DOS attack?
> > > >
> > > > Do a Google search for 'kernel: possible SYN flooding on port 80.
> > > > Sending cookies' and you will find lots of stuff to read. Your
> > running
> > > > out of or having a large number of socket connections may be
> > > > symptomatic of a large number of half open connections being
> > created
> > > > and then being left in TIME_WAIT. Thus perhaps do some better
> > analysis
> > > > of socket connection states using netstat. If not a SYN Flood, then
> > > > possibly follow some of the other suggestions in the pages you will
> > > > find when you do the search.
> > > >
> > > > FWIW, I personally would try and move from prefork to worker MPM as
> > > > the number of Apache child processes you are running with is to my
> > > > mind excessive. Using worker would certainly drop memory usage for
> > a
> > > > start as you wouldn't need as many child processes to be started. I
> > > > wouldn't be concerned about running out of threads as when running
> > > > worker I wouldn't suggest more than 25 threads per process as a
> > > > starting point anyway. If your mod_python application was creating
> > > > lots of threads, you are likely to hit the thread limit with
> > prefork
> > > > and not just worker so which MPM is used shouldn't be an issue in
> > that
> > > > case.
> > > >
> > > > BTW, what operating system are you using?
> > > >
> > > > Graham
> > >
> > >
>
>
From graham.dumpleton at gmail.com  Sun Nov  4 05:48:54 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sun Nov  4 05:49:00 2007
Subject: [mod_python] mod_python or apache scalability?
In-Reply-To: <02cc01c81ece$b88b43d0$29a1cb70$@com>
References: <022001c8040b$31c20790$954616b0$@com>
	<88e286470710011846h4e5af467h3074f4b02b703d05@mail.gmail.com>
	<02c101c81eca$be96a570$3bc3f050$@com>
	<88e286470711040215n310aa34dhda7234b79c0292b9@mail.gmail.com>
	<02c201c81ecc$b3656ef0$1a304cd0$@com>
	<88e286470711040232w49400695va54348964b6fedac@mail.gmail.com>
	<02cc01c81ece$b88b43d0$29a1cb70$@com>
Message-ID: <88e286470711040248l4a436c9awaa8bb1417e47e42a@mail.gmail.com>

Hmmm, I do remember vaguely hearing questions about PIL thread safety
before, so it might be an issue. :-(

Graham

On 04/11/2007, Alec Matusis <matusis@matusis.com> wrote:
> > BTW, are you still using mod_python 3.1.4?
>
> No, we went to apache 2.2.6/ mod_python 3.3.1 combination.
>
> I will get MySQLdb to work thread-safely, but with PIL I am not so
> optimistic...
>
> > -----Original Message-----
> > From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> > Sent: Sunday, November 04, 2007 2:33 AM
> > To: Alec Matusis
> > Cc: mod_python@modpython.org
> > Subject: Re: [mod_python] mod_python or apache scalability?
> >
> > BTW, are you still using mod_python 3.1.4? Older mod_python versions
> > have various bugs and you would be much better upgrading to 3.3.1 if
> > you haven't already.
> >
> > Graham
> >
> > On 04/11/2007, Alec Matusis <matusis@matusis.com> wrote:
> > > > Which indicates that some third party package you are using is not
> > > > thread safe. This can occur if you are also using PHP as various of
> > > > its third party packages are not thread safe.
> > >
> > > We are not using PHP, only python with mod_python.
> > > The only third party packages we use are MySQLdb adapter and PIL
> > image
> > > library.
> > >
> > > So I guess both PIL and MySQLdb have these problems.
> > >
> > >
> > > > -----Original Message-----
> > > > From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> > > > Sent: Sunday, November 04, 2007 2:15 AM
> > > > To: Alec Matusis
> > > > Cc: mod_python@modpython.org
> > > > Subject: Re: [mod_python] mod_python or apache scalability?
> > > >
> > > > On 04/11/2007, Alec Matusis <matusis@matusis.com> wrote:
> > > > > > FWIW, I personally would try and move from prefork to worker
> > MPM as
> > > > > > the number of Apache child processes you are running with is to
> > my
> > > > > > mind excessive. Using worker would certainly drop memory usage
> > for
> > > > a
> > > > > > start as you wouldn't need as many child processes to be
> > started.
> > > > >
> > > > > I am just following up on this, since we tried worker MPM this
> > > > weekend.
> > > > > On our dev/stage it worked perfectly.
> > > > > On live, worker MPM freed up about 2GB of memory compared to
> > prefork.
> > > > > However, on live, it turned out to be unstable.
> > > > > This is what we say in the main error log:
> > > > >
> > > > > [Sun Nov 04 01:37:45 2007] [notice] child pid 20347 exit signal
> > > > Segmentation
> > > > > fault (11)
> > > > > [Sun Nov 04 01:37:45 2007] [notice] child pid 20460 exit signal
> > > > Aborted (6)
> > > > > [Sun Nov 04 01:37:45 2007] [notice] child pid 20515 exit signal
> > > > Segmentation
> > > > > fault (11)
> > > > > *** glibc detected *** double free or corruption (!prev):
> > > > 0x0000000000762c50
> > > > > ***
> > > > > *** glibc detected *** double free or corruption (!prev):
> > > > 0x000000000075d100
> > > > > ***
> > > > > [Sun Nov 04 01:37:46 2007] [notice] child pid 20152 exit signal
> > > > Segmentation
> > > > > fault (11)
> > > > >
> > > > > In the application log, we saw two types of errors:
> > > > >
> > > > > MySQLError: Connection to database failed
> > > > > OperationalError: (2006, 'MySQL server has gone away')
> > > > >
> > > > > and
> > > > >
> > > > > IOError: image file is truncated (44 bytes not processed)
> > > > >
> > > > > The first type has to do with MySQLdb module, but the second one
> > > > occurred
> > > > > when large images were uploaded.
> > > >
> > > > Which indicates that some third party package you are using is not
> > > > thread safe. This can occur if you are also using PHP as various of
> > > > its third party packages are not thread safe. Also ensure that you
> > are
> > > > using the latest available Python database adapters and that they
> > are
> > > > compiled against thread safe reentrant libraries.
> > > >
> > > > Graham
> > > >
> > > > > We had to revert to prefork as a result of this.
> > > > >
> > > > > On another note, I managed to empirically find the maximum
> > > > ServerLimit for
> > > > > prefork, before the machine dies from swapping.
> > > > > It is 380 with 4GB RAM.
> > > > >
> > > > > > -----Original Message-----
> > > > > > From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> > > > > > Sent: Monday, October 01, 2007 6:47 PM
> > > > > > To: Alec Matusis
> > > > > > Cc: mod_python@modpython.org
> > > > > > Subject: Re: [mod_python] mod_python or apache scalability?
> > > > > >
> > > > > > On 01/10/2007, Alec Matusis <matusis@matusis.com> wrote:
> > > > > > > in the apache error log. We also got
> > > > > > >
> > > > > > > kernel: possible SYN flooding on port 80. Sending cookies.
> > > > > > >
> > > > > > > in /var/log/messages system log.
> > > > > >
> > > > > > Have you determined for certain that you aren't the target of
> > an
> > > > > > external SYN Flood DOS attack?
> > > > > >
> > > > > > Do a Google search for 'kernel: possible SYN flooding on port
> > 80.
> > > > > > Sending cookies' and you will find lots of stuff to read. Your
> > > > running
> > > > > > out of or having a large number of socket connections may be
> > > > > > symptomatic of a large number of half open connections being
> > > > created
> > > > > > and then being left in TIME_WAIT. Thus perhaps do some better
> > > > analysis
> > > > > > of socket connection states using netstat. If not a SYN Flood,
> > then
> > > > > > possibly follow some of the other suggestions in the pages you
> > will
> > > > > > find when you do the search.
> > > > > >
> > > > > > FWIW, I personally would try and move from prefork to worker
> > MPM as
> > > > > > the number of Apache child processes you are running with is to
> > my
> > > > > > mind excessive. Using worker would certainly drop memory usage
> > for
> > > > a
> > > > > > start as you wouldn't need as many child processes to be
> > started. I
> > > > > > wouldn't be concerned about running out of threads as when
> > running
> > > > > > worker I wouldn't suggest more than 25 threads per process as a
> > > > > > starting point anyway. If your mod_python application was
> > creating
> > > > > > lots of threads, you are likely to hit the thread limit with
> > > > prefork
> > > > > > and not just worker so which MPM is used shouldn't be an issue
> > in
> > > > that
> > > > > > case.
> > > > > >
> > > > > > BTW, what operating system are you using?
> > > > > >
> > > > > > Graham
> > > > >
> > > > >
> > >
> > >
>
>
From martijn at xs4us.nu  Sun Nov  4 08:16:23 2007
From: martijn at xs4us.nu (Martijn Moeling)
Date: Sun Nov  4 08:16:21 2007
Subject: [mod_python] mod_python or apache scalability?
In-Reply-To: <88e286470711040248l4a436c9awaa8bb1417e47e42a@mail.gmail.com>
References: <022001c8040b$31c20790$954616b0$@com>
	<88e286470710011846h4e5af467h3074f4b02b703d05@mail.gmail.com>
	<02c101c81eca$be96a570$3bc3f050$@com>
	<88e286470711040215n310aa34dhda7234b79c0292b9@mail.gmail.com>
	<02c201c81ecc$b3656ef0$1a304cd0$@com>
	<88e286470711040232w49400695va54348964b6fedac@mail.gmail.com>
	<02cc01c81ece$b88b43d0$29a1cb70$@com>
	<88e286470711040248l4a436c9awaa8bb1417e47e42a@mail.gmail.com>
Message-ID: <3315C807-972E-425D-8373-30E749A4AD68@xs4us.nu>

hi,

I use Pil without any problems, a I do with MySQLdb.

I had similair problems however, they turned out to be MySQLdb  
related and not in a way you suspect

Never ever use a global database connection variable. Create the  
database connection within your handler,
end register a cleanup for closing it. I fixed a lot of trouble by  
altering my system by making all "global" stuff a method or property  
of the req object.

The cleanup procedure cleans all objects which do anything to 3rd  
party external (net connected) stuff (like imap, MySQL)


think of something like this:


def handler_cleanup(req):
	req.db.cursor.close()
	req.db.close()

Def handler (req):
	req.db=MySQLdb.connection(...........)
	req.cursor=req.db.cursor(...)

	....
	....
	....
	req.register_cleanup(handler_cleanup,req)
	return apache.OK

All my application specific code are classes, and instantated as a  
req.something and req is passed to all functions, which is neat since  
it is passed by reference meaning stacks stay small to

If you use MySQLdb with mod_python use the above method, my  
production server is rock stable and handled over 1mln requests since  
last december without any reboots or problems.

Martijn

On Nov 4, 2007, at 11:48 AM, Graham Dumpleton wrote:

> Hmmm, I do remember vaguely hearing questions about PIL thread safety
> before, so it might be an issue. :-(
>
> Graham
>
> On 04/11/2007, Alec Matusis <matusis@matusis.com> wrote:
>>> BTW, are you still using mod_python 3.1.4?
>>
>> No, we went to apache 2.2.6/ mod_python 3.3.1 combination.
>>
>> I will get MySQLdb to work thread-safely, but with PIL I am not so
>> optimistic...
>>
>>> -----Original Message-----
>>> From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
>>> Sent: Sunday, November 04, 2007 2:33 AM
>>> To: Alec Matusis
>>> Cc: mod_python@modpython.org
>>> Subject: Re: [mod_python] mod_python or apache scalability?
>>>
>>> BTW, are you still using mod_python 3.1.4? Older mod_python versions
>>> have various bugs and you would be much better upgrading to 3.3.1 if
>>> you haven't already.
>>>
>>> Graham
>>>
>>> On 04/11/2007, Alec Matusis <matusis@matusis.com> wrote:
>>>>> Which indicates that some third party package you are using is not
>>>>> thread safe. This can occur if you are also using PHP as  
>>>>> various of
>>>>> its third party packages are not thread safe.
>>>>
>>>> We are not using PHP, only python with mod_python.
>>>> The only third party packages we use are MySQLdb adapter and PIL
>>> image
>>>> library.
>>>>
>>>> So I guess both PIL and MySQLdb have these problems.
>>>>
>>>>
>>>>> -----Original Message-----
>>>>> From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
>>>>> Sent: Sunday, November 04, 2007 2:15 AM
>>>>> To: Alec Matusis
>>>>> Cc: mod_python@modpython.org
>>>>> Subject: Re: [mod_python] mod_python or apache scalability?
>>>>>
>>>>> On 04/11/2007, Alec Matusis <matusis@matusis.com> wrote:
>>>>>>> FWIW, I personally would try and move from prefork to worker
>>> MPM as
>>>>>>> the number of Apache child processes you are running with is to
>>> my
>>>>>>> mind excessive. Using worker would certainly drop memory usage
>>> for
>>>>> a
>>>>>>> start as you wouldn't need as many child processes to be
>>> started.
>>>>>>
>>>>>> I am just following up on this, since we tried worker MPM this
>>>>> weekend.
>>>>>> On our dev/stage it worked perfectly.
>>>>>> On live, worker MPM freed up about 2GB of memory compared to
>>> prefork.
>>>>>> However, on live, it turned out to be unstable.
>>>>>> This is what we say in the main error log:
>>>>>>
>>>>>> [Sun Nov 04 01:37:45 2007] [notice] child pid 20347 exit signal
>>>>> Segmentation
>>>>>> fault (11)
>>>>>> [Sun Nov 04 01:37:45 2007] [notice] child pid 20460 exit signal
>>>>> Aborted (6)
>>>>>> [Sun Nov 04 01:37:45 2007] [notice] child pid 20515 exit signal
>>>>> Segmentation
>>>>>> fault (11)
>>>>>> *** glibc detected *** double free or corruption (!prev):
>>>>> 0x0000000000762c50
>>>>>> ***
>>>>>> *** glibc detected *** double free or corruption (!prev):
>>>>> 0x000000000075d100
>>>>>> ***
>>>>>> [Sun Nov 04 01:37:46 2007] [notice] child pid 20152 exit signal
>>>>> Segmentation
>>>>>> fault (11)
>>>>>>
>>>>>> In the application log, we saw two types of errors:
>>>>>>
>>>>>> MySQLError: Connection to database failed
>>>>>> OperationalError: (2006, 'MySQL server has gone away')
>>>>>>
>>>>>> and
>>>>>>
>>>>>> IOError: image file is truncated (44 bytes not processed)
>>>>>>
>>>>>> The first type has to do with MySQLdb module, but the second one
>>>>> occurred
>>>>>> when large images were uploaded.
>>>>>
>>>>> Which indicates that some third party package you are using is not
>>>>> thread safe. This can occur if you are also using PHP as  
>>>>> various of
>>>>> its third party packages are not thread safe. Also ensure that you
>>> are
>>>>> using the latest available Python database adapters and that they
>>> are
>>>>> compiled against thread safe reentrant libraries.
>>>>>
>>>>> Graham
>>>>>
>>>>>> We had to revert to prefork as a result of this.
>>>>>>
>>>>>> On another note, I managed to empirically find the maximum
>>>>> ServerLimit for
>>>>>> prefork, before the machine dies from swapping.
>>>>>> It is 380 with 4GB RAM.
>>>>>>
>>>>>>> -----Original Message-----
>>>>>>> From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
>>>>>>> Sent: Monday, October 01, 2007 6:47 PM
>>>>>>> To: Alec Matusis
>>>>>>> Cc: mod_python@modpython.org
>>>>>>> Subject: Re: [mod_python] mod_python or apache scalability?
>>>>>>>
>>>>>>> On 01/10/2007, Alec Matusis <matusis@matusis.com> wrote:
>>>>>>>> in the apache error log. We also got
>>>>>>>>
>>>>>>>> kernel: possible SYN flooding on port 80. Sending cookies.
>>>>>>>>
>>>>>>>> in /var/log/messages system log.
>>>>>>>
>>>>>>> Have you determined for certain that you aren't the target of
>>> an
>>>>>>> external SYN Flood DOS attack?
>>>>>>>
>>>>>>> Do a Google search for 'kernel: possible SYN flooding on port
>>> 80.
>>>>>>> Sending cookies' and you will find lots of stuff to read. Your
>>>>> running
>>>>>>> out of or having a large number of socket connections may be
>>>>>>> symptomatic of a large number of half open connections being
>>>>> created
>>>>>>> and then being left in TIME_WAIT. Thus perhaps do some better
>>>>> analysis
>>>>>>> of socket connection states using netstat. If not a SYN Flood,
>>> then
>>>>>>> possibly follow some of the other suggestions in the pages you
>>> will
>>>>>>> find when you do the search.
>>>>>>>
>>>>>>> FWIW, I personally would try and move from prefork to worker
>>> MPM as
>>>>>>> the number of Apache child processes you are running with is to
>>> my
>>>>>>> mind excessive. Using worker would certainly drop memory usage
>>> for
>>>>> a
>>>>>>> start as you wouldn't need as many child processes to be
>>> started. I
>>>>>>> wouldn't be concerned about running out of threads as when
>>> running
>>>>>>> worker I wouldn't suggest more than 25 threads per process as a
>>>>>>> starting point anyway. If your mod_python application was
>>> creating
>>>>>>> lots of threads, you are likely to hit the thread limit with
>>>>> prefork
>>>>>>> and not just worker so which MPM is used shouldn't be an issue
>>> in
>>>>> that
>>>>>>> case.
>>>>>>>
>>>>>>> BTW, what operating system are you using?
>>>>>>>
>>>>>>> Graham
>>>>>>
>>>>>>
>>>>
>>>>
>>
>>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From martijn at xs4us.nu  Mon Nov  5 06:02:29 2007
From: martijn at xs4us.nu (Martijn Moeling)
Date: Mon Nov  5 06:03:27 2007
Subject: [mod_python] mod_python or apache scalability?
References: <022001c8040b$31c20790$954616b0$@com>	<88e286470710011846h4e5af467h3074f4b02b703d05@mail.gmail.com>	<02c101c81eca$be96a570$3bc3f050$@com>	<88e286470711040215n310aa34dhda7234b79c0292b9@mail.gmail.com>	<02c201c81ecc$b3656ef0$1a304cd0$@com>	<88e286470711040232w49400695va54348964b6fedac@mail.gmail.com>	<02cc01c81ece$b88b43d0$29a1cb70$@com>	<88e286470711040248l4a436c9awaa8bb1417e47e42a@mail.gmail.com>
	<3315C807-972E-425D-8373-30E749A4AD68@xs4us.nu>
	<03d601c81f23$c39c83b0$4ad58b10$@com>
Message-ID: <B6C73A5E30565245BB6D32B5F5DF7A52172AEF@sense.emmastraat.pijnacker>

Hmm it looks to me that you have an upload limit in your apache config.
 
It might be the LimitRequestBody directive.
 
Another thing might be that your processing is faster than the data comes in, but I doubt that
Take a close look at you apache conf, and your apache error log (right after an upload or with tail -f /var/log/httpd/error_log (or where ever your logdir is)).
 
Martijn
 

________________________________

Van: Alec Matusis [mailto:matusis@matusis.com]
Verzonden: zo 04.11.2007 21:46
Aan: Martijn Moeling
CC: mod_python@modpython.org
Onderwerp: RE: [mod_python] mod_python or apache scalability?



> I had similair problems however, they turned out to be MySQLdb
> related and not in a way you suspect

Thanks! I will try separating MySQLdb connections. We do pass the connection
around currently.

However, how would you explain this PIL error:

    File "/path/publisher/publisher.py", line 78, in handler
 flow_instance.dispatch()
 File "/path/scripts/updateprofile.py", line 92, in dispatch
 im.save(full, self.im_format)
    File
"/usr/local/encap/Python-2.4.1/lib/python2.4/site-packages/PIL/Image.py",
line 1272, in save

 File
"/usr/local/encap/Python-2.4.1/lib/python2.4/site-packages/PIL/ImageFile.py"
, line 192, in load
 IOError: image file is truncated (14432 bytes not processed)

This only happened for large images, small ones uploaded fine.
The code is

def dispatch(self):
    pix = self.form['Filedata']
    try:
        im = Image.open(pix.file)
    except IOError:
        self.req.status = apache.HTTP_NOT_ACCEPTABLE
    im.save(full, self.im_format)

The error is in the last line. It did not occur with prefork.
   




> -----Original Message-----
> From: mod_python-bounces@modpython.org [mailto:mod_python-
> bounces@modpython.org] On Behalf Of Martijn Moeling
> Sent: Sunday, November 04, 2007 5:16 AM
> To: Graham Dumpleton
> Cc: mod_python@modpython.org; Alec Matusis
> Subject: Re: [mod_python] mod_python or apache scalability?
>
> hi,
>
> I use Pil without any problems, a I do with MySQLdb.
>
> I had similair problems however, they turned out to be MySQLdb
> related and not in a way you suspect
>
> Never ever use a global database connection variable. Create the
> database connection within your handler,
> end register a cleanup for closing it. I fixed a lot of trouble by
> altering my system by making all "global" stuff a method or property
> of the req object.
>
> The cleanup procedure cleans all objects which do anything to 3rd
> party external (net connected) stuff (like imap, MySQL)
>
>
> think of something like this:
>
>
> def handler_cleanup(req):
>       req.db.cursor.close()
>       req.db.close()
>
> Def handler (req):
>       req.db=MySQLdb.connection(...........)
>       req.cursor=req.db.cursor(...)
>
>       ....
>       ....
>       ....
>       req.register_cleanup(handler_cleanup,req)
>       return apache.OK
>
> All my application specific code are classes, and instantated as a
> req.something and req is passed to all functions, which is neat since
> it is passed by reference meaning stacks stay small to
>
> If you use MySQLdb with mod_python use the above method, my
> production server is rock stable and handled over 1mln requests since
> last december without any reboots or problems.
>
> Martijn
>
> On Nov 4, 2007, at 11:48 AM, Graham Dumpleton wrote:
>
> > Hmmm, I do remember vaguely hearing questions about PIL thread safety
> > before, so it might be an issue. :-(
> >
> > Graham
> >
> > On 04/11/2007, Alec Matusis <matusis@matusis.com> wrote:
> >>> BTW, are you still using mod_python 3.1.4?
> >>
> >> No, we went to apache 2.2.6/ mod_python 3.3.1 combination.
> >>
> >> I will get MySQLdb to work thread-safely, but with PIL I am not so
> >> optimistic...
> >>
> >>> -----Original Message-----
> >>> From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> >>> Sent: Sunday, November 04, 2007 2:33 AM
> >>> To: Alec Matusis
> >>> Cc: mod_python@modpython.org
> >>> Subject: Re: [mod_python] mod_python or apache scalability?
> >>>
> >>> BTW, are you still using mod_python 3.1.4? Older mod_python
> versions
> >>> have various bugs and you would be much better upgrading to 3.3.1
> if
> >>> you haven't already.
> >>>
> >>> Graham
> >>>
> >>> On 04/11/2007, Alec Matusis <matusis@matusis.com> wrote:
> >>>>> Which indicates that some third party package you are using is
> not
> >>>>> thread safe. This can occur if you are also using PHP as
> >>>>> various of
> >>>>> its third party packages are not thread safe.
> >>>>
> >>>> We are not using PHP, only python with mod_python.
> >>>> The only third party packages we use are MySQLdb adapter and PIL
> >>> image
> >>>> library.
> >>>>
> >>>> So I guess both PIL and MySQLdb have these problems.
> >>>>
> >>>>
> >>>>> -----Original Message-----
> >>>>> From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> >>>>> Sent: Sunday, November 04, 2007 2:15 AM
> >>>>> To: Alec Matusis
> >>>>> Cc: mod_python@modpython.org
> >>>>> Subject: Re: [mod_python] mod_python or apache scalability?
> >>>>>
> >>>>> On 04/11/2007, Alec Matusis <matusis@matusis.com> wrote:
> >>>>>>> FWIW, I personally would try and move from prefork to worker
> >>> MPM as
> >>>>>>> the number of Apache child processes you are running with is to
> >>> my
> >>>>>>> mind excessive. Using worker would certainly drop memory usage
> >>> for
> >>>>> a
> >>>>>>> start as you wouldn't need as many child processes to be
> >>> started.
> >>>>>>
> >>>>>> I am just following up on this, since we tried worker MPM this
> >>>>> weekend.
> >>>>>> On our dev/stage it worked perfectly.
> >>>>>> On live, worker MPM freed up about 2GB of memory compared to
> >>> prefork.
> >>>>>> However, on live, it turned out to be unstable.
> >>>>>> This is what we say in the main error log:
> >>>>>>
> >>>>>> [Sun Nov 04 01:37:45 2007] [notice] child pid 20347 exit signal
> >>>>> Segmentation
> >>>>>> fault (11)
> >>>>>> [Sun Nov 04 01:37:45 2007] [notice] child pid 20460 exit signal
> >>>>> Aborted (6)
> >>>>>> [Sun Nov 04 01:37:45 2007] [notice] child pid 20515 exit signal
> >>>>> Segmentation
> >>>>>> fault (11)
> >>>>>> *** glibc detected *** double free or corruption (!prev):
> >>>>> 0x0000000000762c50
> >>>>>> ***
> >>>>>> *** glibc detected *** double free or corruption (!prev):
> >>>>> 0x000000000075d100
> >>>>>> ***
> >>>>>> [Sun Nov 04 01:37:46 2007] [notice] child pid 20152 exit signal
> >>>>> Segmentation
> >>>>>> fault (11)
> >>>>>>
> >>>>>> In the application log, we saw two types of errors:
> >>>>>>
> >>>>>> MySQLError: Connection to database failed
> >>>>>> OperationalError: (2006, 'MySQL server has gone away')
> >>>>>>
> >>>>>> and
> >>>>>>
> >>>>>> IOError: image file is truncated (44 bytes not processed)
> >>>>>>
> >>>>>> The first type has to do with MySQLdb module, but the second one
> >>>>> occurred
> >>>>>> when large images were uploaded.
> >>>>>
> >>>>> Which indicates that some third party package you are using is
> not
> >>>>> thread safe. This can occur if you are also using PHP as
> >>>>> various of
> >>>>> its third party packages are not thread safe. Also ensure that
> you
> >>> are
> >>>>> using the latest available Python database adapters and that they
> >>> are
> >>>>> compiled against thread safe reentrant libraries.
> >>>>>
> >>>>> Graham
> >>>>>
> >>>>>> We had to revert to prefork as a result of this.
> >>>>>>
> >>>>>> On another note, I managed to empirically find the maximum
> >>>>> ServerLimit for
> >>>>>> prefork, before the machine dies from swapping.
> >>>>>> It is 380 with 4GB RAM.
> >>>>>>
> >>>>>>> -----Original Message-----
> >>>>>>> From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> >>>>>>> Sent: Monday, October 01, 2007 6:47 PM
> >>>>>>> To: Alec Matusis
> >>>>>>> Cc: mod_python@modpython.org
> >>>>>>> Subject: Re: [mod_python] mod_python or apache scalability?
> >>>>>>>
> >>>>>>> On 01/10/2007, Alec Matusis <matusis@matusis.com> wrote:
> >>>>>>>> in the apache error log. We also got
> >>>>>>>>
> >>>>>>>> kernel: possible SYN flooding on port 80. Sending cookies.
> >>>>>>>>
> >>>>>>>> in /var/log/messages system log.
> >>>>>>>
> >>>>>>> Have you determined for certain that you aren't the target of
> >>> an
> >>>>>>> external SYN Flood DOS attack?
> >>>>>>>
> >>>>>>> Do a Google search for 'kernel: possible SYN flooding on port
> >>> 80.
> >>>>>>> Sending cookies' and you will find lots of stuff to read. Your
> >>>>> running
> >>>>>>> out of or having a large number of socket connections may be
> >>>>>>> symptomatic of a large number of half open connections being
> >>>>> created
> >>>>>>> and then being left in TIME_WAIT. Thus perhaps do some better
> >>>>> analysis
> >>>>>>> of socket connection states using netstat. If not a SYN Flood,
> >>> then
> >>>>>>> possibly follow some of the other suggestions in the pages you
> >>> will
> >>>>>>> find when you do the search.
> >>>>>>>
> >>>>>>> FWIW, I personally would try and move from prefork to worker
> >>> MPM as
> >>>>>>> the number of Apache child processes you are running with is to
> >>> my
> >>>>>>> mind excessive. Using worker would certainly drop memory usage
> >>> for
> >>>>> a
> >>>>>>> start as you wouldn't need as many child processes to be
> >>> started. I
> >>>>>>> wouldn't be concerned about running out of threads as when
> >>> running
> >>>>>>> worker I wouldn't suggest more than 25 threads per process as a
> >>>>>>> starting point anyway. If your mod_python application was
> >>> creating
> >>>>>>> lots of threads, you are likely to hit the thread limit with
> >>>>> prefork
> >>>>>>> and not just worker so which MPM is used shouldn't be an issue
> >>> in
> >>>>> that
> >>>>>>> case.
> >>>>>>>
> >>>>>>> BTW, what operating system are you using?
> >>>>>>>
> >>>>>>> Graham
> >>>>>>
> >>>>>>
> >>>>
> >>>>
> >>
> >>
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python



-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20071105/2ccc7158/attachment.html
From elias.collas at gulfstream.com  Mon Nov  5 15:30:05 2007
From: elias.collas at gulfstream.com (elias.collas@gulfstream.com)
Date: Mon Nov  5 15:31:36 2007
Subject: [mod_python] Upgrading 3.2.10 -> 3.3.1
Message-ID: <OF3B399D07.6DC4BC6A-ON8525738A.006F20A1-8525738A.00709E5D@zeus.git.gulfaero.com>


I've checked the list archives and the mod_python FAQ but now it's time to
ask the experts:

I'm trying to upgrade to version 3.3.1 without breaking my production
3.2.10 server. Here are my specifics:

Apache 2.2.0
Python 2.4.3

I'm attempting to run a Virtual Host with an apache configured with
mod_python 3.3.1. Here's my .htaccess file. Most of the paths are symbolic
links to the python2.4 site-packages directory etc. I'm trying to avoid
loading anything with sys.path but something's not right.

SetHandler mod_python
PythonPath "['/cluster/stress/methods/downloads/mod_python-3.3.1
/lib/python', \
?   '/cluster/stress/u308168/site-python/python2.4',\
?   '/cluster/stress/u308168/site-python/simplejson-1.4-py2.4.egg', \
?   '/cluster/stress/u308168/site-python/lib-dynload', \
?   '/cluster/stress/u308168/site-python/Numeric', \
?   '/cluster/stress/u308168/site-python', \
?   '/cluster/stress/u308168/public_html/gflat']"
PythonHandler mod_python.publisher
PythonOption mod_python.session.session_type DbmSession
PythonOption mod_python.dbm_session.database_directory /scratch/u308168
PythonDebug On
PythonOption data_path /cluster/stress/methadmin/jfat/ncdata
<FilesMatch "\.(gif|jpe?g|png|css|js|tmpl)$">
   SetHandler default-handler
</FilesMatch>

When I run this, it appears that the mod_python is still loading the old
apache module. Here's the error I get:

Mod_python error: "PythonHandler mod_python.publisher"

Traceback (most recent call last):

  File
"/cluster/stress/methods/local/lib/python2.4/site-packages/mod_python/apache.py",
 line 299, in HandlerDispatch
    result = object(req)

  File "/cluster/stress/methods/downloads/mod_python-3.3.1
/lib/python/mod_python/publisher.py", line 204, in handler
    module = page_cache[req]

  File "/cluster/stress/methods/downloads/mod_python-3.3.1
/lib/python/mod_python/cache.py", line 82, in __getitem__
    return self._checkitem(name)[2]

  File "/cluster/stress/methods/downloads/mod_python-3.3.1
/lib/python/mod_python/cache.py", line 124, in _checkitem
    value = self.build(key, name, opened, entry)

  File "/cluster/stress/methods/downloads/mod_python-3.3.1
/lib/python/mod_python/publisher.py", line 77, in build
    return ModuleCache.build(self, key, req, opened, entry)

  File "/cluster/stress/methods/downloads/mod_python-3.3.1
/lib/python/mod_python/cache.py", line 371, in build
    exec opened in module.__dict__

  File "/cluster/stress/u308168/public_html/gflat/snlife/index.py", line 7,
in ?
    model = apache.import_module('../gflat.py')##, log=1)

  File
"/cluster/stress/methods/local/lib/python2.4/site-packages/mod_python/apache.py",
 line 461, in import_module
    f, p, d = imp.find_module(parts[i], path)

ImportError: No module named

Any suggestions?

Elias Collas
Stress Methods Group
Gulfstream Aerospace Corp

This e-mail message, including all attachments, is for the sole use of the
intended recipient(s) and may contain legally privileged and confidential
information.  If you are not an intended recipient, you are hereby notified
that you have either received this message in error or through
interception, and that any review, use, distribution, copying or disclosure
of this message or its attachments is strictly prohibited and is subject to
criminal and civil penalties.  All personal messages express solely the
sender's views and not those of Gulfstream Aerospace Corporation.  If you
received this message in error, please contact the sender by reply e-mail
and destroy all copies of the original message.



From graham.dumpleton at gmail.com  Mon Nov  5 16:28:35 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon Nov  5 16:28:38 2007
Subject: [mod_python] mod_python or apache scalability?
In-Reply-To: <B6C73A5E30565245BB6D32B5F5DF7A52172AEF@sense.emmastraat.pijnacker>
References: <022001c8040b$31c20790$954616b0$@com>
	<02c101c81eca$be96a570$3bc3f050$@com>
	<88e286470711040215n310aa34dhda7234b79c0292b9@mail.gmail.com>
	<02c201c81ecc$b3656ef0$1a304cd0$@com>
	<88e286470711040232w49400695va54348964b6fedac@mail.gmail.com>
	<02cc01c81ece$b88b43d0$29a1cb70$@com>
	<88e286470711040248l4a436c9awaa8bb1417e47e42a@mail.gmail.com>
	<3315C807-972E-425D-8373-30E749A4AD68@xs4us.nu>
	<03d601c81f23$c39c83b0$4ad58b10$@com>
	<B6C73A5E30565245BB6D32B5F5DF7A52172AEF@sense.emmastraat.pijnacker>
Message-ID: <88e286470711051328p3528293dr2cee06b9f5c5ce0f@mail.gmail.com>

The LimitRequestBody directive support in mod_python is broken and
most likely would have resulted in a 500 error occurring during
mod_python.publisher processing of the form even before the user code
was run.

My guess at the reason is that they have enabled in the new Apache
server compression on request content. This may not work with
mod_python because how it reads request content is broken, with it
only reading up until original Content-Length in certain cases. If
there is a mutating input filter such as content decompression, you
will get truncated input data.

https://issues.apache.org/jira/browse/MODPYTHON-240
https://issues.apache.org/jira/browse/MODPYTHON-212

So, OP should ensure that directives to accept compressed request
content are disabled.

Graham

On 05/11/2007, Martijn Moeling <martijn@xs4us.nu> wrote:
>
>
>
> Hmm it looks to me that you have an upload limit in your apache config.
>
> It might be the LimitRequestBody directive.
>
> Another thing might be that your processing is faster than the data comes
> in, but I doubt that
> Take a close look at you apache conf, and your apache error log (right after
> an upload or with tail -f /var/log/httpd/error_log (or where ever your
> logdir is)).
>
> Martijn
>
>
>  ________________________________
>  Van: Alec Matusis [mailto:matusis@matusis.com]
> Verzonden: zo 04.11.2007 21:46
> Aan: Martijn Moeling
> CC: mod_python@modpython.org
> Onderwerp: RE: [mod_python] mod_python or apache scalability?
>
>
>
>
> > I had similair problems however, they turned out to be MySQLdb
> > related and not in a way you suspect
>
> Thanks! I will try separating MySQLdb connections. We do pass the connection
> around currently.
>
> However, how would you explain this PIL error:
>
>     File "/path/publisher/publisher.py", line 78, in handler
>  flow_instance.dispatch()
>  File "/path/scripts/updateprofile.py", line 92, in
> dispatch
>  im.save(full, self.im_format)
>     File
> "/usr/local/encap/Python-2.4.1/lib/python2.4/site-packages/PIL/Image.py",
> line 1272, in save
>
>  File
> "/usr/local/encap/Python-2.4.1/lib/python2.4/site-packages/PIL/ImageFile.py"
> , line 192, in load
>  IOError: image file is truncated (14432 bytes not processed)
>
> This only happened for large images, small ones uploaded fine.
> The code is
>
> def dispatch(self):
>     pix = self.form['Filedata']
>     try:
>         im = Image.open(pix.file)
>     except IOError:
>         self.req.status = apache.HTTP_NOT_ACCEPTABLE
>     im.save(full, self.im_format)
>
> The error is in the last line. It did not occur with prefork.
>
>
>
>
>
> > -----Original Message-----
> > From: mod_python-bounces@modpython.org
> [mailto:mod_python-
> > bounces@modpython.org] On Behalf Of Martijn Moeling
> > Sent: Sunday, November 04, 2007 5:16 AM
> > To: Graham Dumpleton
> > Cc: mod_python@modpython.org; Alec Matusis
>
> > Subject: Re: [mod_python] mod_python or apache scalability?
> >
> > hi,
> >
> > I use Pil without any problems, a I do with MySQLdb.
> >
> > I had similair problems however, they turned out to be MySQLdb
> > related and not in a way you suspect
> >
> > Never ever use a global database connection variable. Create the
> > database connection within your handler,
> > end register a cleanup for closing it. I fixed a lot of trouble by
> > altering my system by making all "global" stuff a method or property
> > of the req object.
> >
> > The cleanup procedure cleans all objects which do anything to 3rd
> > party external (net connected) stuff (like imap, MySQL)
> >
> >
> > think of something like this:
> >
> >
> > def handler_cleanup(req):
> >       req.db.cursor.close()
> >       req.db.close()
> >
> > Def handler (req):
> >       req.db=MySQLdb.connection(...........)
> >       req.cursor=req.db.cursor(...)
> >
> >       ....
> >       ....
> >       ....
> >       req.register_cleanup(handler_cleanup,req)
> >       return apache.OK
> >
> > All my application specific code are classes, and instantated as a
> > req.something and req is passed to all functions, which is neat since
> > it is passed by reference meaning stacks stay small to
> >
> > If you use MySQLdb with mod_python use the above method, my
> > production server is rock stable and handled over 1mln requests since
> > last december without any reboots or problems.
> >
> > Martijn
> >
> > On Nov 4, 2007, at 11:48 AM, Graham Dumpleton wrote:
> >
> > > Hmmm, I do remember vaguely hearing questions about PIL thread safety
> > > before, so it might be an issue. :-(
> > >
> > > Graham
> > >
> > > On 04/11/2007, Alec Matusis <matusis@matusis.com> wrote:
> > >>> BTW, are you still using mod_python 3.1.4?
> > >>
> > >> No, we went to apache 2.2.6/ mod_python 3.3.1 combination.
> > >>
> > >> I will get MySQLdb to work thread-safely, but with PIL I am not so
> > >> optimistic...
> > >>
> > >>> -----Original Message-----
> > >>> From: Graham Dumpleton
> [mailto:graham.dumpleton@gmail.com]
> > >>> Sent: Sunday, November 04, 2007 2:33 AM
> > >>> To: Alec Matusis
> > >>> Cc: mod_python@modpython.org
> > >>> Subject: Re: [mod_python] mod_python or apache scalability?
> > >>>
> > >>> BTW, are you still using mod_python 3.1.4? Older mod_python
> > versions
> > >>> have various bugs and you would be much better upgrading to 3.3.1
> > if
> > >>> you haven't already.
> > >>>
> > >>> Graham
> > >>>
> > >>> On 04/11/2007, Alec Matusis <matusis@matusis.com> wrote:
> > >>>>> Which indicates that some third party package you are using is
> > not
> > >>>>> thread safe. This can occur if you are also using PHP as
> > >>>>> various of
> > >>>>> its third party packages are not thread safe.
> > >>>>
> > >>>> We are not using PHP, only python with mod_python.
> > >>>> The only third party packages we use are MySQLdb adapter and PIL
> > >>> image
> > >>>> library.
> > >>>>
> > >>>> So I guess both PIL and MySQLdb have these problems.
> > >>>>
> > >>>>
> > >>>>> -----Original Message-----
> > >>>>> From: Graham Dumpleton
> [mailto:graham.dumpleton@gmail.com]
> > >>>>> Sent: Sunday, November 04, 2007 2:15 AM
> > >>>>> To: Alec Matusis
> > >>>>> Cc: mod_python@modpython.org
> > >>>>> Subject: Re: [mod_python] mod_python or apache scalability?
> > >>>>>
> > >>>>> On 04/11/2007, Alec Matusis <matusis@matusis.com> wrote:
> > >>>>>>> FWIW, I personally would try and move from prefork to worker
> > >>> MPM as
> > >>>>>>> the number of Apache child processes you are running with is to
> > >>> my
> > >>>>>>> mind excessive. Using worker would certainly drop memory usage
> > >>> for
> > >>>>> a
> > >>>>>>> start as you wouldn't need as many child processes to be
> > >>> started.
> > >>>>>>
> > >>>>>> I am just following up on this, since we tried worker MPM this
> > >>>>> weekend.
> > >>>>>> On our dev/stage it worked perfectly.
> > >>>>>> On live, worker MPM freed up about 2GB of memory compared to
> > >>> prefork.
> > >>>>>> However, on live, it turned out to be unstable.
> > >>>>>> This is what we say in the main error log:
> > >>>>>>
> > >>>>>> [Sun Nov 04 01:37:45 2007] [notice] child pid 20347 exit signal
> > >>>>> Segmentation
> > >>>>>> fault (11)
> > >>>>>> [Sun Nov 04 01:37:45 2007] [notice] child pid 20460 exit signal
> > >>>>> Aborted (6)
> > >>>>>> [Sun Nov 04 01:37:45 2007] [notice] child pid 20515 exit signal
> > >>>>> Segmentation
> > >>>>>> fault (11)
> > >>>>>> *** glibc detected *** double free or corruption (!prev):
> > >>>>> 0x0000000000762c50
> > >>>>>> ***
> > >>>>>> *** glibc detected *** double free or corruption (!prev):
> > >>>>> 0x000000000075d100
> > >>>>>> ***
> > >>>>>> [Sun Nov 04 01:37:46 2007] [notice] child pid 20152 exit signal
> > >>>>> Segmentation
> > >>>>>> fault (11)
> > >>>>>>
> > >>>>>> In the application log, we saw two types of errors:
> > >>>>>>
> > >>>>>> MySQLError: Connection to database failed
> > >>>>>> OperationalError: (2006, 'MySQL server has gone away')
> > >>>>>>
> > >>>>>> and
> > >>>>>>
> > >>>>>> IOError: image file is truncated (44 bytes not processed)
> > >>>>>>
> > >>>>>> The first type has to do with MySQLdb module, but the second one
> > >>>>> occurred
> > >>>>>> when large images were uploaded.
> > >>>>>
> > >>>>> Which indicates that some third party package you are using is
> > not
> > >>>>> thread safe. This can occur if you are also using PHP as
> > >>>>> various of
> > >>>>> its third party packages are not thread safe. Also ensure that
> > you
> > >>> are
> > >>>>> using the latest available Python database adapters and that they
> > >>> are
> > >>>>> compiled against thread safe reentrant libraries.
> > >>>>>
> > >>>>> Graham
> > >>>>>
> > >>>>>> We had to revert to prefork as a result of this.
> > >>>>>>
> > >>>>>> On another note, I managed to empirically find the maximum
> > >>>>> ServerLimit for
> > >>>>>> prefork, before the machine dies from swapping.
> > >>>>>> It is 380 with 4GB RAM.
> > >>>>>>
> > >>>>>>> -----Original Message-----
> > >>>>>>> From: Graham Dumpleton
> [mailto:graham.dumpleton@gmail.com]
> > >>>>>>> Sent: Monday, October 01, 2007 6:47 PM
> > >>>>>>> To: Alec Matusis
> > >>>>>>> Cc: mod_python@modpython.org
> > >>>>>>> Subject: Re: [mod_python] mod_python or apache scalability?
> > >>>>>>>
> > >>>>>>> On 01/10/2007, Alec Matusis <matusis@matusis.com> wrote:
> > >>>>>>>> in the apache error log. We also got
> > >>>>>>>>
> > >>>>>>>> kernel: possible SYN flooding on port 80. Sending cookies.
> > >>>>>>>>
> > >>>>>>>> in /var/log/messages system log.
> > >>>>>>>
> > >>>>>>> Have you determined for certain that you aren't the target of
> > >>> an
> > >>>>>>> external SYN Flood DOS attack?
> > >>>>>>>
> > >>>>>>> Do a Google search for 'kernel: possible SYN flooding on port
> > >>> 80.
> > >>>>>>> Sending cookies' and you will find lots of stuff to read. Your
> > >>>>> running
> > >>>>>>> out of or having a large number of socket connections may be
> > >>>>>>> symptomatic of a large number of half open connections being
> > >>>>> created
> > >>>>>>> and then being left in TIME_WAIT. Thus perhaps do some better
> > >>>>> analysis
> > >>>>>>> of socket connection states using netstat. If not a SYN Flood,
> > >>> then
> > >>>>>>> possibly follow some of the other suggestions in the pages you
> > >>> will
> > >>>>>>> find when you do the search.
> > >>>>>>>
> > >>>>>>> FWIW, I personally would try and move from prefork to worker
> > >>> MPM as
> > >>>>>>> the number of Apache child processes you are running with is to
> > >>> my
> > >>>>>>> mind excessive. Using worker would certainly drop memory usage
> > >>> for
> > >>>>> a
> > >>>>>>> start as you wouldn't need as many child processes to be
> > >>> started. I
> > >>>>>>> wouldn't be concerned about running out of threads as when
> > >>> running
> > >>>>>>> worker I wouldn't suggest more than 25 threads per process as a
> > >>>>>>> starting point anyway. If your mod_python application was
> > >>> creating
> > >>>>>>> lots of threads, you are likely to hit the thread limit with
> > >>>>> prefork
> > >>>>>>> and not just worker so which MPM is used shouldn't be an issue
> > >>> in
> > >>>>> that
> > >>>>>>> case.
> > >>>>>>>
> > >>>>>>> BTW, what operating system are you using?
> > >>>>>>>
> > >>>>>>> Graham
> > >>>>>>
> > >>>>>>
> > >>>>
> > >>>>
> > >>
> > >>
> > > _______________________________________________
> > > Mod_python mailing list
> > > Mod_python@modpython.org
> > >
> http://mailman.modpython.org/mailman/listinfo/mod_python
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
From graham.dumpleton at gmail.com  Mon Nov  5 16:32:05 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon Nov  5 16:32:08 2007
Subject: [mod_python] Upgrading 3.2.10 -> 3.3.1
In-Reply-To: <OF3B399D07.6DC4BC6A-ON8525738A.006F20A1-8525738A.00709E5D@zeus.git.gulfaero.com>
References: <OF3B399D07.6DC4BC6A-ON8525738A.006F20A1-8525738A.00709E5D@zeus.git.gulfaero.com>
Message-ID: <88e286470711051332v11dd50b1w80b4ae8dcad19ee3@mail.gmail.com>

If you have installed multiple versions of Python installed in
different locations then you must ensure that PATH environment
variable of Apache when it starts up finds in that PATH the version
you want first. It doesn't actually run it, but Python internal
initialisation uses it as a reference point to determine where Python
lib directory is located.

Graham

On 06/11/2007, elias.collas@gulfstream.com <elias.collas@gulfstream.com> wrote:
>
> I've checked the list archives and the mod_python FAQ but now it's time to
> ask the experts:
>
> I'm trying to upgrade to version 3.3.1 without breaking my production
> 3.2.10 server. Here are my specifics:
>
> Apache 2.2.0
> Python 2.4.3
>
> I'm attempting to run a Virtual Host with an apache configured with
> mod_python 3.3.1. Here's my .htaccess file. Most of the paths are symbolic
> links to the python2.4 site-packages directory etc. I'm trying to avoid
> loading anything with sys.path but something's not right.
>
> SetHandler mod_python
> PythonPath "['/cluster/stress/methods/downloads/mod_python-3.3.1
> /lib/python', \
>    '/cluster/stress/u308168/site-python/python2.4',\
>    '/cluster/stress/u308168/site-python/simplejson-1.4-py2.4.egg', \
>    '/cluster/stress/u308168/site-python/lib-dynload', \
>    '/cluster/stress/u308168/site-python/Numeric', \
>    '/cluster/stress/u308168/site-python', \
>    '/cluster/stress/u308168/public_html/gflat']"
> PythonHandler mod_python.publisher
> PythonOption mod_python.session.session_type DbmSession
> PythonOption mod_python.dbm_session.database_directory /scratch/u308168
> PythonDebug On
> PythonOption data_path /cluster/stress/methadmin/jfat/ncdata
> <FilesMatch "\.(gif|jpe?g|png|css|js|tmpl)$">
>    SetHandler default-handler
> </FilesMatch>
>
> When I run this, it appears that the mod_python is still loading the old
> apache module. Here's the error I get:
>
> Mod_python error: "PythonHandler mod_python.publisher"
>
> Traceback (most recent call last):
>
>   File
> "/cluster/stress/methods/local/lib/python2.4/site-packages/mod_python/apache.py",
>  line 299, in HandlerDispatch
>     result = object(req)
>
>   File "/cluster/stress/methods/downloads/mod_python-3.3.1
> /lib/python/mod_python/publisher.py", line 204, in handler
>     module = page_cache[req]
>
>   File "/cluster/stress/methods/downloads/mod_python-3.3.1
> /lib/python/mod_python/cache.py", line 82, in __getitem__
>     return self._checkitem(name)[2]
>
>   File "/cluster/stress/methods/downloads/mod_python-3.3.1
> /lib/python/mod_python/cache.py", line 124, in _checkitem
>     value = self.build(key, name, opened, entry)
>
>   File "/cluster/stress/methods/downloads/mod_python-3.3.1
> /lib/python/mod_python/publisher.py", line 77, in build
>     return ModuleCache.build(self, key, req, opened, entry)
>
>   File "/cluster/stress/methods/downloads/mod_python-3.3.1
> /lib/python/mod_python/cache.py", line 371, in build
>     exec opened in module.__dict__
>
>   File "/cluster/stress/u308168/public_html/gflat/snlife/index.py", line 7,
> in ?
>     model = apache.import_module('../gflat.py')##, log=1)
>
>   File
> "/cluster/stress/methods/local/lib/python2.4/site-packages/mod_python/apache.py",
>  line 461, in import_module
>     f, p, d = imp.find_module(parts[i], path)
>
> ImportError: No module named
>
> Any suggestions?
>
> Elias Collas
> Stress Methods Group
> Gulfstream Aerospace Corp
>
> This e-mail message, including all attachments, is for the sole use of the
> intended recipient(s) and may contain legally privileged and confidential
> information.  If you are not an intended recipient, you are hereby notified
> that you have either received this message in error or through
> interception, and that any review, use, distribution, copying or disclosure
> of this message or its attachments is strictly prohibited and is subject to
> criminal and civil penalties.  All personal messages express solely the
> sender's views and not those of Gulfstream Aerospace Corporation.  If you
> received this message in error, please contact the sender by reply e-mail
> and destroy all copies of the original message.
>
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From elias.collas at gulfstream.com  Mon Nov  5 16:45:42 2007
From: elias.collas at gulfstream.com (elias.collas@gulfstream.com)
Date: Mon Nov  5 16:47:13 2007
Subject: [mod_python] Upgrading 3.2.10 -> 3.3.1
In-Reply-To: <88e286470711051332v11dd50b1w80b4ae8dcad19ee3@mail.gmail.com>
Message-ID: <OF6253C636.4CA5D5D8-ON8525738A.0076DE67-8525738A.00778AB8@zeus.git.gulfaero.com>

Hello Graham and thanks for the quick reply.

Sorry if I'm being dense, but...

I'm only running a single version of Python (2.4.3) that has mod_python
3.2.10 installed in its .../lib/site-packages directory but I'm trying to
get a second Apache instance to only see mod_python 3.3.1. Is there a way
to trick Apache to do this? My issue is that I'd rather not move the
mod_python package which is currently installed (3.2.10) until I test all
my apps against the latest mod_python.

Eli

"Graham Dumpleton" <graham.dumpleton@gmail.com> wrote on 11/05/2007
04:32:05 PM:

> If you have installed multiple versions of Python installed in
> different locations then you must ensure that PATH environment
> variable of Apache when it starts up finds in that PATH the version
> you want first. It doesn't actually run it, but Python internal
> initialisation uses it as a reference point to determine where Python
> lib directory is located.
>
> Graham
>

> >
> >
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >

From graham.dumpleton at gmail.com  Mon Nov  5 16:54:09 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon Nov  5 16:54:12 2007
Subject: [mod_python] Upgrading 3.2.10 -> 3.3.1
In-Reply-To: <OF6253C636.4CA5D5D8-ON8525738A.0076DE67-8525738A.00778AB8@zeus.git.gulfaero.com>
References: <88e286470711051332v11dd50b1w80b4ae8dcad19ee3@mail.gmail.com>
	<OF6253C636.4CA5D5D8-ON8525738A.0076DE67-8525738A.00778AB8@zeus.git.gulfaero.com>
Message-ID: <88e286470711051354q30dcab66vef773339b3e76145@mail.gmail.com>

On 06/11/2007, elias.collas@gulfstream.com <elias.collas@gulfstream.com> wrote:
> Hello Graham and thanks for the quick reply.
>
> Sorry if I'm being dense, but...
>
> I'm only running a single version of Python (2.4.3) that has mod_python
> 3.2.10 installed in its .../lib/site-packages directory but I'm trying to
> get a second Apache instance to only see mod_python 3.3.1. Is there a way
> to trick Apache to do this? My issue is that I'd rather not move the
> mod_python package which is currently installed (3.2.10) until I test all
> my apps against the latest mod_python.

Not easily done as you can obviously only have one mod_python version
installed into main Python site-packages directory.

A fiddle that should work is for you to create using Ian Bicking's
virtualenv package a distinct Python installation based on your
current one and then install in that all the required new packages you
want to use, including mod_python site-packages components. Then, in
the 'envvars' file in the same directory as your Apache httpd
executable add:

  PYTHONHOME=/some/path/env
  export PYTHONHOME

That path should refer to the top directory created by the virtualenv tool.

The Python code when being initialised will see PYTHONHOME and will
use that separate virtual environment as the source of all the Python
modules and not your main installation.

For information on virtualenv see:

  http://pypi.python.org/pypi/virtualenv

Graham

> "Graham Dumpleton" <graham.dumpleton@gmail.com> wrote on 11/05/2007
> 04:32:05 PM:
>
> > If you have installed multiple versions of Python installed in
> > different locations then you must ensure that PATH environment
> > variable of Apache when it starts up finds in that PATH the version
> > you want first. It doesn't actually run it, but Python internal
> > initialisation uses it as a reference point to determine where Python
> > lib directory is located.
> >
> > Graham
> >
>
> > >
> > >
> > >
> > > _______________________________________________
> > > Mod_python mailing list
> > > Mod_python@modpython.org
> > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > >
>
>
From elias.collas at gulfstream.com  Mon Nov  5 17:06:38 2007
From: elias.collas at gulfstream.com (elias.collas@gulfstream.com)
Date: Mon Nov  5 17:08:08 2007
Subject: [mod_python] Upgrading 3.2.10 -> 3.3.1
In-Reply-To: <88e286470711051354q30dcab66vef773339b3e76145@mail.gmail.com>
Message-ID: <OF04E2E5D0.6566EE56-ON8525738A.00795C0D-8525738A.00797536@zeus.git.gulfaero.com>

Thanks for the great suggestion. I'll give that a try.

"Graham Dumpleton" <graham.dumpleton@gmail.com> wrote on 11/05/2007
04:54:09 PM:

> A fiddle that should work is for you to create using Ian Bicking's
> virtualenv package a distinct Python installation based on your
> current one and then install in that all the required new packages you
> want to use, including mod_python site-packages components. Then, in
> the 'envvars' file in the same directory as your Apache httpd
> executable add:
>
>   PYTHONHOME=/some/path/env
>   export PYTHONHOME
>
> That path should refer to the top directory created by the virtualenv
tool.
>
> The Python code when being initialised will see PYTHONHOME and will
> use that separate virtual environment as the source of all the Python
> modules and not your main installation.
>
> For information on virtualenv see:
>
>   http://pypi.python.org/pypi/virtualenv
>
> Graham

From matusis at yahoo.com  Tue Nov  6 03:58:05 2007
From: matusis at yahoo.com (Alec Matusis)
Date: Tue Nov  6 03:59:18 2007
Subject: [mod_python] mod_python or apache scalability?
In-Reply-To: <88e286470711051328p3528293dr2cee06b9f5c5ce0f@mail.gmail.com>
References: <022001c8040b$31c20790$954616b0$@com>	<02c101c81eca$be96a570$3bc3f050$@com>	<88e286470711040215n310aa34dhda7234b79c0292b9@mail.gmail.com>	<02c201c81ecc$b3656ef0$1a304cd0$@com>	<88e286470711040232w49400695va54348964b6fedac@mail.gmail.com>	<02cc01c81ece$b88b43d0$29a1cb70$@com>	<88e286470711040248l4a436c9awaa8bb1417e47e42a@mail.gmail.com>	<3315C807-972E-425D-8373-30E749A4AD68@xs4us.nu>	<03d601c81f23$c39c83b0$4ad58b10$@com>	<B6C73A5E30565245BB6D32B5F5DF7A52172AEF@sense.emmastraat.pijnacker>
	<88e286470711051328p3528293dr2cee06b9f5c5ce0f@mail.gmail.com>
Message-ID: <074501c82053$25462eb0$6fd28c10$@com>

I found that this that 

IOError: image file is truncated (14432 bytes not processed)

has to do with using input filter

PythonInputFilter flashfilter FLASHFILTER
SetInputFilter FLASHFILTER

It somehow behaves differently in apache 2.2.6/mod_python 3.3.1 versus
2.0.54/ 3.1.4. For now, I removed this input filter (we can get away without
it), and it seems to work.

However, we have a bigger problem: we now have intermittent import errors
(one error per about 50-80 requests).

This code executed by publisher:

import modules
def _import( module_path ):
    runme = modules[ module_path ]
    #get the last part
    class_name = module_path.split('.')[-1]
    try:
        runme = getattr(runme, class_name ) <--- INTERMITTENT ERROR here
    except AttributeError:
        raise Exception,'Module does not contain class '+class_name+',
runme='+repr(runme)+' module_path='+repr(module_path)

produces this error:

Exception: Module does not contain class getprofile, runme=<module
'getprofile' from '/path/scripts/getprofile.py'> module_path='getprofile'

This used to always work with prefork. Is there anything not thread safe
about importing modules?

> -----Original Message-----
> From: mod_python-bounces@modpython.org [mailto:mod_python-
> bounces@modpython.org] On Behalf Of Graham Dumpleton
> Sent: Monday, November 05, 2007 1:29 PM
> To: Martijn Moeling
> Cc: mod_python@modpython.org; Alec Matusis
> Subject: Re: [mod_python] mod_python or apache scalability?
> 
> The LimitRequestBody directive support in mod_python is broken and
> most likely would have resulted in a 500 error occurring during
> mod_python.publisher processing of the form even before the user code
> was run.
> 
> My guess at the reason is that they have enabled in the new Apache
> server compression on request content. This may not work with
> mod_python because how it reads request content is broken, with it
> only reading up until original Content-Length in certain cases. If
> there is a mutating input filter such as content decompression, you
> will get truncated input data.
> 
> https://issues.apache.org/jira/browse/MODPYTHON-240
> https://issues.apache.org/jira/browse/MODPYTHON-212
> 
> So, OP should ensure that directives to accept compressed request
> content are disabled.
> 
> Graham
> 
> On 05/11/2007, Martijn Moeling <martijn@xs4us.nu> wrote:
> >
> >
> >
> > Hmm it looks to me that you have an upload limit in your apache
> config.
> >
> > It might be the LimitRequestBody directive.
> >
> > Another thing might be that your processing is faster than the data
> comes
> > in, but I doubt that
> > Take a close look at you apache conf, and your apache error log
> (right after
> > an upload or with tail -f /var/log/httpd/error_log (or where ever
> your
> > logdir is)).
> >
> > Martijn
> >
> >
> >  ________________________________
> >  Van: Alec Matusis [mailto:matusis@matusis.com]
> > Verzonden: zo 04.11.2007 21:46
> > Aan: Martijn Moeling
> > CC: mod_python@modpython.org
> > Onderwerp: RE: [mod_python] mod_python or apache scalability?
> >
> >
> >
> >
> > > I had similair problems however, they turned out to be MySQLdb
> > > related and not in a way you suspect
> >
> > Thanks! I will try separating MySQLdb connections. We do pass the
> connection
> > around currently.
> >
> > However, how would you explain this PIL error:
> >
> >     File "/path/publisher/publisher.py", line 78, in handler
> >  flow_instance.dispatch()
> >  File "/path/scripts/updateprofile.py", line 92, in
> > dispatch
> >  im.save(full, self.im_format)
> >     File
> > "/usr/local/encap/Python-2.4.1/lib/python2.4/site-
> packages/PIL/Image.py",
> > line 1272, in save
> >
> >  File
> > "/usr/local/encap/Python-2.4.1/lib/python2.4/site-
> packages/PIL/ImageFile.py"
> > , line 192, in load
> >  IOError: image file is truncated (14432 bytes not processed)
> >
> > This only happened for large images, small ones uploaded fine.
> > The code is
> >
> > def dispatch(self):
> >     pix = self.form['Filedata']
> >     try:
> >         im = Image.open(pix.file)
> >     except IOError:
> >         self.req.status = apache.HTTP_NOT_ACCEPTABLE
> >     im.save(full, self.im_format)
> >
> > The error is in the last line. It did not occur with prefork.
> >
> >
> >
> >
> >
> > > -----Original Message-----
> > > From: mod_python-bounces@modpython.org
> > [mailto:mod_python-
> > > bounces@modpython.org] On Behalf Of Martijn Moeling
> > > Sent: Sunday, November 04, 2007 5:16 AM
> > > To: Graham Dumpleton
> > > Cc: mod_python@modpython.org; Alec Matusis
> >
> > > Subject: Re: [mod_python] mod_python or apache scalability?
> > >
> > > hi,
> > >
> > > I use Pil without any problems, a I do with MySQLdb.
> > >
> > > I had similair problems however, they turned out to be MySQLdb
> > > related and not in a way you suspect
> > >
> > > Never ever use a global database connection variable. Create the
> > > database connection within your handler,
> > > end register a cleanup for closing it. I fixed a lot of trouble by
> > > altering my system by making all "global" stuff a method or
> property
> > > of the req object.
> > >
> > > The cleanup procedure cleans all objects which do anything to 3rd
> > > party external (net connected) stuff (like imap, MySQL)
> > >
> > >
> > > think of something like this:
> > >
> > >
> > > def handler_cleanup(req):
> > >       req.db.cursor.close()
> > >       req.db.close()
> > >
> > > Def handler (req):
> > >       req.db=MySQLdb.connection(...........)
> > >       req.cursor=req.db.cursor(...)
> > >
> > >       ....
> > >       ....
> > >       ....
> > >       req.register_cleanup(handler_cleanup,req)
> > >       return apache.OK
> > >
> > > All my application specific code are classes, and instantated as a
> > > req.something and req is passed to all functions, which is neat
> since
> > > it is passed by reference meaning stacks stay small to
> > >
> > > If you use MySQLdb with mod_python use the above method, my
> > > production server is rock stable and handled over 1mln requests
> since
> > > last december without any reboots or problems.
> > >
> > > Martijn
> > >
> > > On Nov 4, 2007, at 11:48 AM, Graham Dumpleton wrote:
> > >
> > > > Hmmm, I do remember vaguely hearing questions about PIL thread
> safety
> > > > before, so it might be an issue. :-(
> > > >
> > > > Graham
> > > >
> > > > On 04/11/2007, Alec Matusis <matusis@matusis.com> wrote:
> > > >>> BTW, are you still using mod_python 3.1.4?
> > > >>
> > > >> No, we went to apache 2.2.6/ mod_python 3.3.1 combination.
> > > >>
> > > >> I will get MySQLdb to work thread-safely, but with PIL I am not
> so
> > > >> optimistic...
> > > >>
> > > >>> -----Original Message-----
> > > >>> From: Graham Dumpleton
> > [mailto:graham.dumpleton@gmail.com]
> > > >>> Sent: Sunday, November 04, 2007 2:33 AM
> > > >>> To: Alec Matusis
> > > >>> Cc: mod_python@modpython.org
> > > >>> Subject: Re: [mod_python] mod_python or apache scalability?
> > > >>>
> > > >>> BTW, are you still using mod_python 3.1.4? Older mod_python
> > > versions
> > > >>> have various bugs and you would be much better upgrading to
> 3.3.1
> > > if
> > > >>> you haven't already.
> > > >>>
> > > >>> Graham
> > > >>>
> > > >>> On 04/11/2007, Alec Matusis <matusis@matusis.com> wrote:
> > > >>>>> Which indicates that some third party package you are using
> is
> > > not
> > > >>>>> thread safe. This can occur if you are also using PHP as
> > > >>>>> various of
> > > >>>>> its third party packages are not thread safe.
> > > >>>>
> > > >>>> We are not using PHP, only python with mod_python.
> > > >>>> The only third party packages we use are MySQLdb adapter and
> PIL
> > > >>> image
> > > >>>> library.
> > > >>>>
> > > >>>> So I guess both PIL and MySQLdb have these problems.
> > > >>>>
> > > >>>>
> > > >>>>> -----Original Message-----
> > > >>>>> From: Graham Dumpleton
> > [mailto:graham.dumpleton@gmail.com]
> > > >>>>> Sent: Sunday, November 04, 2007 2:15 AM
> > > >>>>> To: Alec Matusis
> > > >>>>> Cc: mod_python@modpython.org
> > > >>>>> Subject: Re: [mod_python] mod_python or apache scalability?
> > > >>>>>
> > > >>>>> On 04/11/2007, Alec Matusis <matusis@matusis.com> wrote:
> > > >>>>>>> FWIW, I personally would try and move from prefork to
> worker
> > > >>> MPM as
> > > >>>>>>> the number of Apache child processes you are running with
> is to
> > > >>> my
> > > >>>>>>> mind excessive. Using worker would certainly drop memory
> usage
> > > >>> for
> > > >>>>> a
> > > >>>>>>> start as you wouldn't need as many child processes to be
> > > >>> started.
> > > >>>>>>
> > > >>>>>> I am just following up on this, since we tried worker MPM
> this
> > > >>>>> weekend.
> > > >>>>>> On our dev/stage it worked perfectly.
> > > >>>>>> On live, worker MPM freed up about 2GB of memory compared to
> > > >>> prefork.
> > > >>>>>> However, on live, it turned out to be unstable.
> > > >>>>>> This is what we say in the main error log:
> > > >>>>>>
> > > >>>>>> [Sun Nov 04 01:37:45 2007] [notice] child pid 20347 exit
> signal
> > > >>>>> Segmentation
> > > >>>>>> fault (11)
> > > >>>>>> [Sun Nov 04 01:37:45 2007] [notice] child pid 20460 exit
> signal
> > > >>>>> Aborted (6)
> > > >>>>>> [Sun Nov 04 01:37:45 2007] [notice] child pid 20515 exit
> signal
> > > >>>>> Segmentation
> > > >>>>>> fault (11)
> > > >>>>>> *** glibc detected *** double free or corruption (!prev):
> > > >>>>> 0x0000000000762c50
> > > >>>>>> ***
> > > >>>>>> *** glibc detected *** double free or corruption (!prev):
> > > >>>>> 0x000000000075d100
> > > >>>>>> ***
> > > >>>>>> [Sun Nov 04 01:37:46 2007] [notice] child pid 20152 exit
> signal
> > > >>>>> Segmentation
> > > >>>>>> fault (11)
> > > >>>>>>
> > > >>>>>> In the application log, we saw two types of errors:
> > > >>>>>>
> > > >>>>>> MySQLError: Connection to database failed
> > > >>>>>> OperationalError: (2006, 'MySQL server has gone away')
> > > >>>>>>
> > > >>>>>> and
> > > >>>>>>
> > > >>>>>> IOError: image file is truncated (44 bytes not processed)
> > > >>>>>>
> > > >>>>>> The first type has to do with MySQLdb module, but the second
> one
> > > >>>>> occurred
> > > >>>>>> when large images were uploaded.
> > > >>>>>
> > > >>>>> Which indicates that some third party package you are using
> is
> > > not
> > > >>>>> thread safe. This can occur if you are also using PHP as
> > > >>>>> various of
> > > >>>>> its third party packages are not thread safe. Also ensure
> that
> > > you
> > > >>> are
> > > >>>>> using the latest available Python database adapters and that
> they
> > > >>> are
> > > >>>>> compiled against thread safe reentrant libraries.
> > > >>>>>
> > > >>>>> Graham
> > > >>>>>
> > > >>>>>> We had to revert to prefork as a result of this.
> > > >>>>>>
> > > >>>>>> On another note, I managed to empirically find the maximum
> > > >>>>> ServerLimit for
> > > >>>>>> prefork, before the machine dies from swapping.
> > > >>>>>> It is 380 with 4GB RAM.
> > > >>>>>>
> > > >>>>>>> -----Original Message-----
> > > >>>>>>> From: Graham Dumpleton
> > [mailto:graham.dumpleton@gmail.com]
> > > >>>>>>> Sent: Monday, October 01, 2007 6:47 PM
> > > >>>>>>> To: Alec Matusis
> > > >>>>>>> Cc: mod_python@modpython.org
> > > >>>>>>> Subject: Re: [mod_python] mod_python or apache scalability?
> > > >>>>>>>
> > > >>>>>>> On 01/10/2007, Alec Matusis <matusis@matusis.com> wrote:
> > > >>>>>>>> in the apache error log. We also got
> > > >>>>>>>>
> > > >>>>>>>> kernel: possible SYN flooding on port 80. Sending cookies.
> > > >>>>>>>>
> > > >>>>>>>> in /var/log/messages system log.
> > > >>>>>>>
> > > >>>>>>> Have you determined for certain that you aren't the target
> of
> > > >>> an
> > > >>>>>>> external SYN Flood DOS attack?
> > > >>>>>>>
> > > >>>>>>> Do a Google search for 'kernel: possible SYN flooding on
> port
> > > >>> 80.
> > > >>>>>>> Sending cookies' and you will find lots of stuff to read.
> Your
> > > >>>>> running
> > > >>>>>>> out of or having a large number of socket connections may
> be
> > > >>>>>>> symptomatic of a large number of half open connections
> being
> > > >>>>> created
> > > >>>>>>> and then being left in TIME_WAIT. Thus perhaps do some
> better
> > > >>>>> analysis
> > > >>>>>>> of socket connection states using netstat. If not a SYN
> Flood,
> > > >>> then
> > > >>>>>>> possibly follow some of the other suggestions in the pages
> you
> > > >>> will
> > > >>>>>>> find when you do the search.
> > > >>>>>>>
> > > >>>>>>> FWIW, I personally would try and move from prefork to
> worker
> > > >>> MPM as
> > > >>>>>>> the number of Apache child processes you are running with
> is to
> > > >>> my
> > > >>>>>>> mind excessive. Using worker would certainly drop memory
> usage
> > > >>> for
> > > >>>>> a
> > > >>>>>>> start as you wouldn't need as many child processes to be
> > > >>> started. I
> > > >>>>>>> wouldn't be concerned about running out of threads as when
> > > >>> running
> > > >>>>>>> worker I wouldn't suggest more than 25 threads per process
> as a
> > > >>>>>>> starting point anyway. If your mod_python application was
> > > >>> creating
> > > >>>>>>> lots of threads, you are likely to hit the thread limit
> with
> > > >>>>> prefork
> > > >>>>>>> and not just worker so which MPM is used shouldn't be an
> issue
> > > >>> in
> > > >>>>> that
> > > >>>>>>> case.
> > > >>>>>>>
> > > >>>>>>> BTW, what operating system are you using?
> > > >>>>>>>
> > > >>>>>>> Graham
> > > >>>>>>
> > > >>>>>>
> > > >>>>
> > > >>>>
> > > >>
> > > >>
> > > > _______________________________________________
> > > > Mod_python mailing list
> > > > Mod_python@modpython.org
> > > >
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> > >
> > > _______________________________________________
> > > Mod_python mailing list
> > > Mod_python@modpython.org
> > > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
> >
> >
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
> >
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From graham.dumpleton at gmail.com  Tue Nov  6 06:52:32 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue Nov  6 06:52:38 2007
Subject: [mod_python] mod_python or apache scalability?
In-Reply-To: <074501c82053$25462eb0$6fd28c10$@com>
References: <022001c8040b$31c20790$954616b0$@com>
	<02c201c81ecc$b3656ef0$1a304cd0$@com>
	<88e286470711040232w49400695va54348964b6fedac@mail.gmail.com>
	<02cc01c81ece$b88b43d0$29a1cb70$@com>
	<88e286470711040248l4a436c9awaa8bb1417e47e42a@mail.gmail.com>
	<3315C807-972E-425D-8373-30E749A4AD68@xs4us.nu>
	<03d601c81f23$c39c83b0$4ad58b10$@com>
	<B6C73A5E30565245BB6D32B5F5DF7A52172AEF@sense.emmastraat.pijnacker>
	<88e286470711051328p3528293dr2cee06b9f5c5ce0f@mail.gmail.com>
	<074501c82053$25462eb0$6fd28c10$@com>
Message-ID: <88e286470711060352k68e8ed74l7065e450d71cc16@mail.gmail.com>

On 06/11/2007, Alec Matusis <matusis@yahoo.com> wrote:
> I found that this that
>
> IOError: image file is truncated (14432 bytes not processed)
>
> has to do with using input filter
>
> PythonInputFilter flashfilter FLASHFILTER
> SetInputFilter FLASHFILTER
>
> It somehow behaves differently in apache 2.2.6/mod_python 3.3.1 versus
> 2.0.54/ 3.1.4. For now, I removed this input filter (we can get away without
> it), and it seems to work.
>
> However, we have a bigger problem: we now have intermittent import errors
> (one error per about 50-80 requests).
>
> This code executed by publisher:
>
> import modules
> def _import( module_path ):
>     runme = modules[ module_path ]
>     #get the last part
>     class_name = module_path.split('.')[-1]
>     try:
>         runme = getattr(runme, class_name ) <--- INTERMITTENT ERROR here
>     except AttributeError:
>         raise Exception,'Module does not contain class '+class_name+',
> runme='+repr(runme)+' module_path='+repr(module_path)
>
> produces this error:
>
> Exception: Module does not contain class getprofile, runme=<module
> 'getprofile' from '/path/scripts/getprofile.py'> module_path='getprofile'
>
> This used to always work with prefork. Is there anything not thread safe
> about importing modules?

The underlying Python and mod_python import mechanisms themselves are
never usually the problem. It is thread unsafe practices regarding
initialisation in the code around the imports.

So, if you have built your own form of module importer or higher level
layer for one and you haven't properly thread protected it, it is most
likely the cause.

So, what is 'modules' and '_import' and how are they used? How do you
ensure that two concurrently executing request handlers trying to
import the same module don't interfere with each other?

Graham

> > -----Original Message-----
> > From: mod_python-bounces@modpython.org [mailto:mod_python-
> > bounces@modpython.org] On Behalf Of Graham Dumpleton
> > Sent: Monday, November 05, 2007 1:29 PM
> > To: Martijn Moeling
> > Cc: mod_python@modpython.org; Alec Matusis
> > Subject: Re: [mod_python] mod_python or apache scalability?
> >
> > The LimitRequestBody directive support in mod_python is broken and
> > most likely would have resulted in a 500 error occurring during
> > mod_python.publisher processing of the form even before the user code
> > was run.
> >
> > My guess at the reason is that they have enabled in the new Apache
> > server compression on request content. This may not work with
> > mod_python because how it reads request content is broken, with it
> > only reading up until original Content-Length in certain cases. If
> > there is a mutating input filter such as content decompression, you
> > will get truncated input data.
> >
> > https://issues.apache.org/jira/browse/MODPYTHON-240
> > https://issues.apache.org/jira/browse/MODPYTHON-212
> >
> > So, OP should ensure that directives to accept compressed request
> > content are disabled.
> >
> > Graham
> >
> > On 05/11/2007, Martijn Moeling <martijn@xs4us.nu> wrote:
> > >
> > >
> > >
> > > Hmm it looks to me that you have an upload limit in your apache
> > config.
> > >
> > > It might be the LimitRequestBody directive.
> > >
> > > Another thing might be that your processing is faster than the data
> > comes
> > > in, but I doubt that
> > > Take a close look at you apache conf, and your apache error log
> > (right after
> > > an upload or with tail -f /var/log/httpd/error_log (or where ever
> > your
> > > logdir is)).
> > >
> > > Martijn
> > >
> > >
> > >  ________________________________
> > >  Van: Alec Matusis [mailto:matusis@matusis.com]
> > > Verzonden: zo 04.11.2007 21:46
> > > Aan: Martijn Moeling
> > > CC: mod_python@modpython.org
> > > Onderwerp: RE: [mod_python] mod_python or apache scalability?
> > >
> > >
> > >
> > >
> > > > I had similair problems however, they turned out to be MySQLdb
> > > > related and not in a way you suspect
> > >
> > > Thanks! I will try separating MySQLdb connections. We do pass the
> > connection
> > > around currently.
> > >
> > > However, how would you explain this PIL error:
> > >
> > >     File "/path/publisher/publisher.py", line 78, in handler
> > >  flow_instance.dispatch()
> > >  File "/path/scripts/updateprofile.py", line 92, in
> > > dispatch
> > >  im.save(full, self.im_format)
> > >     File
> > > "/usr/local/encap/Python-2.4.1/lib/python2.4/site-
> > packages/PIL/Image.py",
> > > line 1272, in save
> > >
> > >  File
> > > "/usr/local/encap/Python-2.4.1/lib/python2.4/site-
> > packages/PIL/ImageFile.py"
> > > , line 192, in load
> > >  IOError: image file is truncated (14432 bytes not processed)
> > >
> > > This only happened for large images, small ones uploaded fine.
> > > The code is
> > >
> > > def dispatch(self):
> > >     pix = self.form['Filedata']
> > >     try:
> > >         im = Image.open(pix.file)
> > >     except IOError:
> > >         self.req.status = apache.HTTP_NOT_ACCEPTABLE
> > >     im.save(full, self.im_format)
> > >
> > > The error is in the last line. It did not occur with prefork.
> > >
> > >
> > >
> > >
> > >
> > > > -----Original Message-----
> > > > From: mod_python-bounces@modpython.org
> > > [mailto:mod_python-
> > > > bounces@modpython.org] On Behalf Of Martijn Moeling
> > > > Sent: Sunday, November 04, 2007 5:16 AM
> > > > To: Graham Dumpleton
> > > > Cc: mod_python@modpython.org; Alec Matusis
> > >
> > > > Subject: Re: [mod_python] mod_python or apache scalability?
> > > >
> > > > hi,
> > > >
> > > > I use Pil without any problems, a I do with MySQLdb.
> > > >
> > > > I had similair problems however, they turned out to be MySQLdb
> > > > related and not in a way you suspect
> > > >
> > > > Never ever use a global database connection variable. Create the
> > > > database connection within your handler,
> > > > end register a cleanup for closing it. I fixed a lot of trouble by
> > > > altering my system by making all "global" stuff a method or
> > property
> > > > of the req object.
> > > >
> > > > The cleanup procedure cleans all objects which do anything to 3rd
> > > > party external (net connected) stuff (like imap, MySQL)
> > > >
> > > >
> > > > think of something like this:
> > > >
> > > >
> > > > def handler_cleanup(req):
> > > >       req.db.cursor.close()
> > > >       req.db.close()
> > > >
> > > > Def handler (req):
> > > >       req.db=MySQLdb.connection(...........)
> > > >       req.cursor=req.db.cursor(...)
> > > >
> > > >       ....
> > > >       ....
> > > >       ....
> > > >       req.register_cleanup(handler_cleanup,req)
> > > >       return apache.OK
> > > >
> > > > All my application specific code are classes, and instantated as a
> > > > req.something and req is passed to all functions, which is neat
> > since
> > > > it is passed by reference meaning stacks stay small to
> > > >
> > > > If you use MySQLdb with mod_python use the above method, my
> > > > production server is rock stable and handled over 1mln requests
> > since
> > > > last december without any reboots or problems.
> > > >
> > > > Martijn
> > > >
> > > > On Nov 4, 2007, at 11:48 AM, Graham Dumpleton wrote:
> > > >
> > > > > Hmmm, I do remember vaguely hearing questions about PIL thread
> > safety
> > > > > before, so it might be an issue. :-(
> > > > >
> > > > > Graham
> > > > >
> > > > > On 04/11/2007, Alec Matusis <matusis@matusis.com> wrote:
> > > > >>> BTW, are you still using mod_python 3.1.4?
> > > > >>
> > > > >> No, we went to apache 2.2.6/ mod_python 3.3.1 combination.
> > > > >>
> > > > >> I will get MySQLdb to work thread-safely, but with PIL I am not
> > so
> > > > >> optimistic...
> > > > >>
> > > > >>> -----Original Message-----
> > > > >>> From: Graham Dumpleton
> > > [mailto:graham.dumpleton@gmail.com]
> > > > >>> Sent: Sunday, November 04, 2007 2:33 AM
> > > > >>> To: Alec Matusis
> > > > >>> Cc: mod_python@modpython.org
> > > > >>> Subject: Re: [mod_python] mod_python or apache scalability?
> > > > >>>
> > > > >>> BTW, are you still using mod_python 3.1.4? Older mod_python
> > > > versions
> > > > >>> have various bugs and you would be much better upgrading to
> > 3.3.1
> > > > if
> > > > >>> you haven't already.
> > > > >>>
> > > > >>> Graham
> > > > >>>
> > > > >>> On 04/11/2007, Alec Matusis <matusis@matusis.com> wrote:
> > > > >>>>> Which indicates that some third party package you are using
> > is
> > > > not
> > > > >>>>> thread safe. This can occur if you are also using PHP as
> > > > >>>>> various of
> > > > >>>>> its third party packages are not thread safe.
> > > > >>>>
> > > > >>>> We are not using PHP, only python with mod_python.
> > > > >>>> The only third party packages we use are MySQLdb adapter and
> > PIL
> > > > >>> image
> > > > >>>> library.
> > > > >>>>
> > > > >>>> So I guess both PIL and MySQLdb have these problems.
> > > > >>>>
> > > > >>>>
> > > > >>>>> -----Original Message-----
> > > > >>>>> From: Graham Dumpleton
> > > [mailto:graham.dumpleton@gmail.com]
> > > > >>>>> Sent: Sunday, November 04, 2007 2:15 AM
> > > > >>>>> To: Alec Matusis
> > > > >>>>> Cc: mod_python@modpython.org
> > > > >>>>> Subject: Re: [mod_python] mod_python or apache scalability?
> > > > >>>>>
> > > > >>>>> On 04/11/2007, Alec Matusis <matusis@matusis.com> wrote:
> > > > >>>>>>> FWIW, I personally would try and move from prefork to
> > worker
> > > > >>> MPM as
> > > > >>>>>>> the number of Apache child processes you are running with
> > is to
> > > > >>> my
> > > > >>>>>>> mind excessive. Using worker would certainly drop memory
> > usage
> > > > >>> for
> > > > >>>>> a
> > > > >>>>>>> start as you wouldn't need as many child processes to be
> > > > >>> started.
> > > > >>>>>>
> > > > >>>>>> I am just following up on this, since we tried worker MPM
> > this
> > > > >>>>> weekend.
> > > > >>>>>> On our dev/stage it worked perfectly.
> > > > >>>>>> On live, worker MPM freed up about 2GB of memory compared to
> > > > >>> prefork.
> > > > >>>>>> However, on live, it turned out to be unstable.
> > > > >>>>>> This is what we say in the main error log:
> > > > >>>>>>
> > > > >>>>>> [Sun Nov 04 01:37:45 2007] [notice] child pid 20347 exit
> > signal
> > > > >>>>> Segmentation
> > > > >>>>>> fault (11)
> > > > >>>>>> [Sun Nov 04 01:37:45 2007] [notice] child pid 20460 exit
> > signal
> > > > >>>>> Aborted (6)
> > > > >>>>>> [Sun Nov 04 01:37:45 2007] [notice] child pid 20515 exit
> > signal
> > > > >>>>> Segmentation
> > > > >>>>>> fault (11)
> > > > >>>>>> *** glibc detected *** double free or corruption (!prev):
> > > > >>>>> 0x0000000000762c50
> > > > >>>>>> ***
> > > > >>>>>> *** glibc detected *** double free or corruption (!prev):
> > > > >>>>> 0x000000000075d100
> > > > >>>>>> ***
> > > > >>>>>> [Sun Nov 04 01:37:46 2007] [notice] child pid 20152 exit
> > signal
> > > > >>>>> Segmentation
> > > > >>>>>> fault (11)
> > > > >>>>>>
> > > > >>>>>> In the application log, we saw two types of errors:
> > > > >>>>>>
> > > > >>>>>> MySQLError: Connection to database failed
> > > > >>>>>> OperationalError: (2006, 'MySQL server has gone away')
> > > > >>>>>>
> > > > >>>>>> and
> > > > >>>>>>
> > > > >>>>>> IOError: image file is truncated (44 bytes not processed)
> > > > >>>>>>
> > > > >>>>>> The first type has to do with MySQLdb module, but the second
> > one
> > > > >>>>> occurred
> > > > >>>>>> when large images were uploaded.
> > > > >>>>>
> > > > >>>>> Which indicates that some third party package you are using
> > is
> > > > not
> > > > >>>>> thread safe. This can occur if you are also using PHP as
> > > > >>>>> various of
> > > > >>>>> its third party packages are not thread safe. Also ensure
> > that
> > > > you
> > > > >>> are
> > > > >>>>> using the latest available Python database adapters and that
> > they
> > > > >>> are
> > > > >>>>> compiled against thread safe reentrant libraries.
> > > > >>>>>
> > > > >>>>> Graham
> > > > >>>>>
> > > > >>>>>> We had to revert to prefork as a result of this.
> > > > >>>>>>
> > > > >>>>>> On another note, I managed to empirically find the maximum
> > > > >>>>> ServerLimit for
> > > > >>>>>> prefork, before the machine dies from swapping.
> > > > >>>>>> It is 380 with 4GB RAM.
> > > > >>>>>>
> > > > >>>>>>> -----Original Message-----
> > > > >>>>>>> From: Graham Dumpleton
> > > [mailto:graham.dumpleton@gmail.com]
> > > > >>>>>>> Sent: Monday, October 01, 2007 6:47 PM
> > > > >>>>>>> To: Alec Matusis
> > > > >>>>>>> Cc: mod_python@modpython.org
> > > > >>>>>>> Subject: Re: [mod_python] mod_python or apache scalability?
> > > > >>>>>>>
> > > > >>>>>>> On 01/10/2007, Alec Matusis <matusis@matusis.com> wrote:
> > > > >>>>>>>> in the apache error log. We also got
> > > > >>>>>>>>
> > > > >>>>>>>> kernel: possible SYN flooding on port 80. Sending cookies.
> > > > >>>>>>>>
> > > > >>>>>>>> in /var/log/messages system log.
> > > > >>>>>>>
> > > > >>>>>>> Have you determined for certain that you aren't the target
> > of
> > > > >>> an
> > > > >>>>>>> external SYN Flood DOS attack?
> > > > >>>>>>>
> > > > >>>>>>> Do a Google search for 'kernel: possible SYN flooding on
> > port
> > > > >>> 80.
> > > > >>>>>>> Sending cookies' and you will find lots of stuff to read.
> > Your
> > > > >>>>> running
> > > > >>>>>>> out of or having a large number of socket connections may
> > be
> > > > >>>>>>> symptomatic of a large number of half open connections
> > being
> > > > >>>>> created
> > > > >>>>>>> and then being left in TIME_WAIT. Thus perhaps do some
> > better
> > > > >>>>> analysis
> > > > >>>>>>> of socket connection states using netstat. If not a SYN
> > Flood,
> > > > >>> then
> > > > >>>>>>> possibly follow some of the other suggestions in the pages
> > you
> > > > >>> will
> > > > >>>>>>> find when you do the search.
> > > > >>>>>>>
> > > > >>>>>>> FWIW, I personally would try and move from prefork to
> > worker
> > > > >>> MPM as
> > > > >>>>>>> the number of Apache child processes you are running with
> > is to
> > > > >>> my
> > > > >>>>>>> mind excessive. Using worker would certainly drop memory
> > usage
> > > > >>> for
> > > > >>>>> a
> > > > >>>>>>> start as you wouldn't need as many child processes to be
> > > > >>> started. I
> > > > >>>>>>> wouldn't be concerned about running out of threads as when
> > > > >>> running
> > > > >>>>>>> worker I wouldn't suggest more than 25 threads per process
> > as a
> > > > >>>>>>> starting point anyway. If your mod_python application was
> > > > >>> creating
> > > > >>>>>>> lots of threads, you are likely to hit the thread limit
> > with
> > > > >>>>> prefork
> > > > >>>>>>> and not just worker so which MPM is used shouldn't be an
> > issue
> > > > >>> in
> > > > >>>>> that
> > > > >>>>>>> case.
> > > > >>>>>>>
> > > > >>>>>>> BTW, what operating system are you using?
> > > > >>>>>>>
> > > > >>>>>>> Graham
> > > > >>>>>>
> > > > >>>>>>
> > > > >>>>
> > > > >>>>
> > > > >>
> > > > >>
> > > > > _______________________________________________
> > > > > Mod_python mailing list
> > > > > Mod_python@modpython.org
> > > > >
> > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > > >
> > > > _______________________________________________
> > > > Mod_python mailing list
> > > > Mod_python@modpython.org
> > > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > >
> > >
> > >
> > >
> > > _______________________________________________
> > > Mod_python mailing list
> > > Mod_python@modpython.org
> > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > >
> > >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
From elias.collas at gulfstream.com  Tue Nov  6 09:58:55 2007
From: elias.collas at gulfstream.com (elias.collas@gulfstream.com)
Date: Tue Nov  6 10:00:54 2007
Subject: [mod_python] Upgrading 3.2.10 -> 3.3.1
In-Reply-To: <88e286470711051354q30dcab66vef773339b3e76145@mail.gmail.com>
Message-ID: <OFDDF614F6.BD037625-ON8525738B.005191C0-8525738B.00524CB4@zeus.git.gulfaero.com>

I've just upgraded to mod_python 3.3.1 and it has broken my apps. I'm
having problems importing some modules, so before I punt and set

PythonOption mod_python.legacy.importer

I would like to know how to import a module that I built with f2py. Here's
what I used to do:

import _nrlib   # _nrlib.so lives in the same directory as the importing
module

That didn't work, so I tried

from mod_python import apache
_nrlib = apache.import_module('~/_nrlib.so')

mod_python finds the file, but I here's some of my traceback:

File "/cluster/stress/u308168/public_html/gflat/splines.py", line 3, in
<module>
    _nrlib = apache.import_module('~/_nrlib.so')

  File
"/cluster/stress/methods/opt/lib/python2.5/site-packages/mod_python/importer.py",
 line 296, in import_module
    log, import_path)

  File
"/cluster/stress/methods/opt/lib/python2.5/site-packages/mod_python/importer.py",
 line 680, in import_module
    execfile(file, module.__dict__)

  File "/cluster/stress/u308168/public_html/gflat/_nrlib.so", line 1

SyntaxError: Non-ASCII character '\x8c' in file
/cluster/stress/u308168/public_html/gflat/_nrlib.so on line 2, but no
encoding declared; see http://www.python.org/peps/pep-0263.html for details
(_nrlib.so, line 1)





This e-mail message, including all attachments, is for the sole use of the
intended recipient(s) and may contain legally privileged and confidential
information.  If you are not an intended recipient, you are hereby notified
that you have either received this message in error or through
interception, and that any review, use, distribution, copying or disclosure
of this message or its attachments is strictly prohibited and is subject to
criminal and civil penalties.  All personal messages express solely the
sender's views and not those of Gulfstream Aerospace Corporation.  If you
received this message in error, please contact the sender by reply e-mail
and destroy all copies of the original message.


From kvs at acm.org  Tue Nov  6 10:15:39 2007
From: kvs at acm.org (Kathryn Van Stone)
Date: Tue Nov  6 10:17:20 2007
Subject: [mod_python] Problems with logging.
Message-ID: <08ED5B72-BBA8-40D5-8C2D-9425AF18C8C4@acm.org>


I am currently using mod_python version 3.3.1 with Apache 2.2.4 (and  
Python 2.5.1).  I've notice a difference between using  
apache.log_error and req.log_error. I modified mptest.py to the  
following:

from mod_python import apache

def handler(req):
     apache.log_error('Test log from apache', apache.APLOG_DEBUG)
     req.log_error('Test log from request', apache.APLOG_DEBUG)
     req.content_type = 'text/plain'
     req.write('Hello World')
     return apache.OK


I modified the apache configuration to set the log level to debug.  I  
get the request log message, but not the apache log message. When the  
log level is raised to APLOG_NOTICE, I get both messages.

Any thoughts on why there is a difference?  We have areas where  
getting the request object is a hassle and would like to use  
apache.log_error. (Also there are members of my team who don't like  
the 'requestobject.c(823)' showing up in the log as it adds almost no  
information)

-Kathy Van Stone
kvs@acm.org
From michelts at gmail.com  Tue Nov  6 11:36:59 2007
From: michelts at gmail.com (Michel Sabchuk)
Date: Tue Nov  6 11:37:04 2007
Subject: [mod_python] Compilation problem on a Suse 10.2
Message-ID: <588e81180711060836q308932c0s9620397a064f0b67@mail.gmail.com>

Hi guys!

I?m a django user and I have to recompile mod_python to use python
with shared libraries enabled. In a first try I could compile it but
it was compiled over 32 bits libraries and apache seems to be 64 bits.

Then I installed all the devel libraries as 64 bits and try a
recompilation, but now I can?t even compile it. I try the code above:

~root# LDFLAGS='-L/lib64' ./configure
...
~root# make
make[1]: Entering directory `/usr/local/mod_python-3.3.1/src'

Compiling for DSO.

/usr/sbin/apxs2 -I/usr/local/mod_python-3.3.1/src/include
-I/usr/include/apache2 -I/usr/local/include/python2.4 -c mod_python.c
_apachemodule.c requestobject.c tableobject.c util.c serverobject.c
connobject.c filterobject.c hlist.c hlistobject.c finfoobject.c
-L/lib64 -L/usr/local/lib/python2.4/config  -Xlinker -export-dynamic
   -lm  -lpython2.4   -lpthread -ldl  -lutil   -lm
/usr/lib64/apr-1/build/libtool --silent --mode=compile gcc -prefer-pic
-O2 -march=i586 -mtune=i686 -fmessage-length=0 -Wall
-D_FORTIFY_SOURCE=2 -g -fPIC -Wall -fno-strict-aliasing
-DLDAP_DEPRECATED  -DLINUX=2 -D_REENTRANT -D_GNU_SOURCE
-D_LARGEFILE64_SOURCE -DAP_DEBUG -pthread -I/usr/include/apache2
-I/usr/include   -I/usr/include/apr-1
-I/usr/local/mod_python-3.3.1/src/include -I/usr/include/apache2
-I/usr/local/include/python2.4  -c -o mod_python.lo mod_python.c &&
touch mod_python.slo
mod_python.c:1: error: CPU you selected does not support x86-64 instruction set
apxs:Error: Command failed with rc=65536
.
make[1]: *** [mod_python.so] Error 1
make[1]: Leaving directory `/usr/local/mod_python-3.3.1/src'
make: *** [do_dso] Error 2

...

I googled for something but I couldn?t find any usefull information
except that I need to change these libtool paramenters: -march=i586
-mtune=i686. How can I configure these parameters? Do you have any
other suggestion?

I?m not very familiar with x86_64 processor machines, how can I help
you to help me :-P

Thanks for all, best regards!

-- 
Michel Thadeu Sabchuk
Curitiba - Brasil

From elias.collas at gulfstream.com  Tue Nov  6 13:30:26 2007
From: elias.collas at gulfstream.com (elias.collas@gulfstream.com)
Date: Tue Nov  6 13:31:55 2007
Subject: [mod_python] Upgrading 3.2.10 -> 3.3.1
In-Reply-To: <OFDDF614F6.BD037625-ON8525738B.005191C0-8525738B.00524CB4@zeus.git.gulfaero.com>
Message-ID: <OF76077F1E.5F2C92D3-ON8525738B.00652D88-8525738B.0065A9D1@zeus.git.gulfaero.com>


I solved my own problem by putting _nrlib.so in a directory and using
PythonPath to point to it. Just like it says in the docs ;)

I also found an old post on this by Graham that gave me the hint. Thanks.

This e-mail message, including all attachments, is for the sole use of the
intended recipient(s) and may contain legally privileged and confidential
information.  If you are not an intended recipient, you are hereby notified
that you have either received this message in error or through
interception, and that any review, use, distribution, copying or disclosure
of this message or its attachments is strictly prohibited and is subject to
criminal and civil penalties.  All personal messages express solely the
sender's views and not those of Gulfstream Aerospace Corporation.  If you
received this message in error, please contact the sender by reply e-mail
and destroy all copies of the original message.



mod_python-bounces@modpython.org wrote on 11/06/2007 09:58:55 AM:

> I've just upgraded to mod_python 3.3.1 and it has broken my apps. I'm
> having problems importing some modules, so before I punt and set
>
> PythonOption mod_python.legacy.importer
>
> I would like to know how to import a module that I built with f2py.
Here's
> what I used to do:
>
> import _nrlib   # _nrlib.so lives in the same directory as the importing
> module
>
> That didn't work, so I tried
>
> from mod_python import apache
> _nrlib = apache.import_module('~/_nrlib.so')
>
> mod_python finds the file, but I here's some of my traceback:
>
> File "/cluster/stress/u308168/public_html/gflat/splines.py", line 3, in
> <module>
>     _nrlib = apache.import_module('~/_nrlib.so')
>
>   File
> "/cluster/stress/methods/opt/lib/python2.5/site-
> packages/mod_python/importer.py",
>  line 296, in import_module
>     log, import_path)
>
>   File
> "/cluster/stress/methods/opt/lib/python2.5/site-
> packages/mod_python/importer.py",
>  line 680, in import_module
>     execfile(file, module.__dict__)
>
>   File "/cluster/stress/u308168/public_html/gflat/_nrlib.so", line 1
>
> SyntaxError: Non-ASCII character '\x8c' in file
> /cluster/stress/u308168/public_html/gflat/_nrlib.so on line 2, but no
> encoding declared; see http://www.python.org/peps/pep-0263.html for
details
> (_nrlib.so, line 1)
>
>
>
>
>
> This e-mail message, including all attachments, is for the sole use of
the
> intended recipient(s) and may contain legally privileged and confidential
> information.  If you are not an intended recipient, you are hereby
notified
> that you have either received this message in error or through
> interception, and that any review, use, distribution, copying or
disclosure
> of this message or its attachments is strictly prohibited and is subject
to
> criminal and civil penalties.  All personal messages express solely the
> sender's views and not those of Gulfstream Aerospace Corporation.  If you
> received this message in error, please contact the sender by reply e-mail
> and destroy all copies of the original message.
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From jp at jochenpreusche.de  Tue Nov  6 14:26:26 2007
From: jp at jochenpreusche.de (Jochen Preusche)
Date: Tue Nov  6 14:26:35 2007
Subject: [mod_python] ImportError: No module named mptest
Message-ID: <4730BFE2.4050703@jochenpreusche.de>

Hi folks,

I just started with and mod_python. I get stuck with the Error message
below. Any help would be appreciated.

I'm using Ubuntu 7.04, Lampp, Apache/2.2.4 (Unix), mod_python/3.3.1 and
Python/2.5.1

I followed the instructions to this point
[http://modpython.org/live/current/doc-html/inst-trouble.html]

testing with the script describet at the tutorial. Unregarded the
scripts content it reports this one:

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
MOD_PYTHON ERROR

ProcessId:      14842
Interpreter:    'localhost'

ServerName:     'localhost'
DocumentRoot:   '/opt/lampp/htdocs'

URI:            '/test/mptest.py'
Location:       None
Directory:      '/opt/lampp/htdocs/'
Filename:       '/opt/lampp/htdocs/test/mptest.py'
PathInfo:       ''

Phase:          'PythonHandler'
Handler:        'mptest'

Traceback (most recent call last):

  File "/usr/lib/python2.5/site-packages/mod_python/importer.py", line
1537, in HandlerDispatch
    default=default_handler, arg=req, silent=hlist.silent)

  File "/usr/lib/python2.5/site-packages/mod_python/importer.py", line
1202, in _process_target
    module = import_module(module_name, path=path)

  File "/usr/lib/python2.5/site-packages/mod_python/importer.py", line
304, in import_module
    return __import__(module_name, {}, {}, ['*'])

ImportError: No module named mptest
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Here is what I've put in the httpd.config file:

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
LoadModule python_module /opt/lampp/modules/mod_python.so

<Directory /opt/lampp/htdocs>
	AddHandler mod_python .py
	PythonHandler mptest
	PythonDebug On
</Directory>

<Location /mpinfo>
      SetHandler mod_python
      PythonHandler mod_python.testhandler
</Location>
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

I guess there must be any file named mptest but I can't find it ...

Thank you for your time
From jp at jochenpreusche.de  Tue Nov  6 14:38:39 2007
From: jp at jochenpreusche.de (Jochen Preusche)
Date: Tue Nov  6 14:38:48 2007
Subject: [mod_python] ImportError: No module named mptest
In-Reply-To: <4730BFE2.4050703@jochenpreusche.de>
References: <4730BFE2.4050703@jochenpreusche.de>
Message-ID: <4730C2BF.5060905@jochenpreusche.de>

oops -- fixed. :o)
It shouldn't be placed in a subdir ..


Jochen Preusche schrieb:
> Hi folks,
> 
> I just started with and mod_python. I get stuck with the Error message
> below. Any help would be appreciated.
> 
> I'm using Ubuntu 7.04, Lampp, Apache/2.2.4 (Unix), mod_python/3.3.1 and
> Python/2.5.1
> 
> I followed the instructions to this point
> [http://modpython.org/live/current/doc-html/inst-trouble.html]
> 
> testing with the script describet at the tutorial. Unregarded the
> scripts content it reports this one:
> 
> ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
> MOD_PYTHON ERROR
> 
> ProcessId:      14842
> Interpreter:    'localhost'
> 
> ServerName:     'localhost'
> DocumentRoot:   '/opt/lampp/htdocs'
> 
> URI:            '/test/mptest.py'
> Location:       None
> Directory:      '/opt/lampp/htdocs/'
> Filename:       '/opt/lampp/htdocs/test/mptest.py'
> PathInfo:       ''
> 
> Phase:          'PythonHandler'
> Handler:        'mptest'
> 
> Traceback (most recent call last):
> 
>   File "/usr/lib/python2.5/site-packages/mod_python/importer.py", line
> 1537, in HandlerDispatch
>     default=default_handler, arg=req, silent=hlist.silent)
> 
>   File "/usr/lib/python2.5/site-packages/mod_python/importer.py", line
> 1202, in _process_target
>     module = import_module(module_name, path=path)
> 
>   File "/usr/lib/python2.5/site-packages/mod_python/importer.py", line
> 304, in import_module
>     return __import__(module_name, {}, {}, ['*'])
> 
> ImportError: No module named mptest
> ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
> 
> Here is what I've put in the httpd.config file:
> 
> ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
> LoadModule python_module /opt/lampp/modules/mod_python.so
> 
> <Directory /opt/lampp/htdocs>
> 	AddHandler mod_python .py
> 	PythonHandler mptest
> 	PythonDebug On
> </Directory>
> 
> <Location /mpinfo>
>       SetHandler mod_python
>       PythonHandler mod_python.testhandler
> </Location>
> ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
> 
> I guess there must be any file named mptest but I can't find it ...
> 
> Thank you for your time
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 
> 
From graham.dumpleton at gmail.com  Tue Nov  6 15:41:13 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue Nov  6 15:41:19 2007
Subject: [mod_python] Problems with logging.
In-Reply-To: <08ED5B72-BBA8-40D5-8C2D-9425AF18C8C4@acm.org>
References: <08ED5B72-BBA8-40D5-8C2D-9425AF18C8C4@acm.org>
Message-ID: <88e286470711061241i77a4d809w33920d4036be76e9@mail.gmail.com>

On 07/11/2007, Kathryn Van Stone <kvs@acm.org> wrote:
>
> I am currently using mod_python version 3.3.1 with Apache 2.2.4 (and
> Python 2.5.1).  I've notice a difference between using
> apache.log_error and req.log_error. I modified mptest.py to the
> following:
>
> from mod_python import apache
>
> def handler(req):
>      apache.log_error('Test log from apache', apache.APLOG_DEBUG)
>      req.log_error('Test log from request', apache.APLOG_DEBUG)
>      req.content_type = 'text/plain'
>      req.write('Hello World')
>      return apache.OK
>
>
> I modified the apache configuration to set the log level to debug.  I
> get the request log message, but not the apache log message. When the
> log level is raised to APLOG_NOTICE, I get both messages.

Known issue, or at least I knew about it. I can't see that I created
an issue for it in the bug tracker though. I also can't remember the
full details at the moment. I know I made sure I didn't make the same
mistake in mod_wsgi though. :-)

> Any thoughts on why there is a difference?  We have areas where
> getting the request object is a hassle and would like to use
> apache.log_error. (Also there are members of my team who don't like
> the 'requestobject.c(823)' showing up in the log as it adds almost no
> information)

That requestobject.c always show for DEBUG level statements is a
result of how Apache works, in that it in embeds the C code file/line
number of where ap_log_rerror() is called. It is non trivial and
perhaps not entirely reliable, to try and dynamically work out where
in the Python code the call to the Python wrapper for the function was
called. It may be possible to fudge things at the level of the call to
ap_log_rerror() and not pass APLOG_MARK as argument and split it out
into two separate zero arguments. Presume that ap_log_rerror() will
not crash if line information not supplied.

Graham
From graham.dumpleton at gmail.com  Tue Nov  6 15:54:03 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue Nov  6 15:54:09 2007
Subject: [mod_python] Problems with logging.
In-Reply-To: <88e286470711061241i77a4d809w33920d4036be76e9@mail.gmail.com>
References: <08ED5B72-BBA8-40D5-8C2D-9425AF18C8C4@acm.org>
	<88e286470711061241i77a4d809w33920d4036be76e9@mail.gmail.com>
Message-ID: <88e286470711061254w3d19dd0cu659bced066020c87@mail.gmail.com>

On 07/11/2007, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> On 07/11/2007, Kathryn Van Stone <kvs@acm.org> wrote:
> >
> > I am currently using mod_python version 3.3.1 with Apache 2.2.4 (and
> > Python 2.5.1).  I've notice a difference between using
> > apache.log_error and req.log_error. I modified mptest.py to the
> > following:
> >
> > from mod_python import apache
> >
> > def handler(req):
> >      apache.log_error('Test log from apache', apache.APLOG_DEBUG)
> >      req.log_error('Test log from request', apache.APLOG_DEBUG)
> >      req.content_type = 'text/plain'
> >      req.write('Hello World')
> >      return apache.OK
> >
> >
> > I modified the apache configuration to set the log level to debug.  I
> > get the request log message, but not the apache log message. When the
> > log level is raised to APLOG_NOTICE, I get both messages.
>
> Known issue, or at least I knew about it. I can't see that I created
> an issue for it in the bug tracker though. I also can't remember the
> full details at the moment. I know I made sure I didn't make the same
> mistake in mod_wsgi though. :-)
>
> > Any thoughts on why there is a difference?  We have areas where
> > getting the request object is a hassle and would like to use
> > apache.log_error. (Also there are members of my team who don't like
> > the 'requestobject.c(823)' showing up in the log as it adds almost no
> > information)
>
> That requestobject.c always show for DEBUG level statements is a
> result of how Apache works, in that it in embeds the C code file/line
> number of where ap_log_rerror() is called. It is non trivial and
> perhaps not entirely reliable, to try and dynamically work out where
> in the Python code the call to the Python wrapper for the function was
> called. It may be possible to fudge things at the level of the call to
> ap_log_rerror() and not pass APLOG_MARK as argument and split it out
> into two separate zero arguments. Presume that ap_log_rerror() will
> not crash if line information not supplied.

Quick one as bit rushed right now.

Use:

  from mod_python import apache
  apache.main_server.log_error(......)

for now.

This should mean values of LogLevel will be honoured.

I remember what the issues were now, but no time to go in to it.

Graham
From delobelle at blueyonder.co.uk  Tue Nov  6 16:41:49 2007
From: delobelle at blueyonder.co.uk (Arnaud Delobelle)
Date: Tue Nov  6 16:37:47 2007
Subject: [mod_python] PIL not working in mod_python on macosx 10.5
Message-ID: <AFFA0D5D-114E-4F26-ADE6-A11F6875895C@blueyonder.co.uk>

Hi

First thanks to Graham for pointing me in the right direction so that  
I was able to install mod_python on macosx 10.5.  Unfortunately I have  
run into another hitch:  the PIL (Python Imaging Library) is not  
working from within mod_python, even though it is working from command- 
line python:

If I create a new image from mod_python, I get the error "The _imaging  
C module is not installed".
The module _imaging.so is in /Library/Python/2.5/site-packages/PIL/ 
_imaging.so and I have checked that /Library/Python/2.5/site-packages/ 
PIL/ is present in sys.path from within mod_python.

I am now unable to progress any further... When I first unsuccessfully  
installed mod_python, the problem was that it compiled as an i386  
module whereas httpd is x86_64 on macosx 10.5 (on Intel Core 2 Duo).   
My first reaction was that _imaging.so was for the wrong architecture  
as well:

marigold:~ arno$ file /Library/Python/2.5/site-packages/PIL/_imaging.so
/Library/Python/2.5/site-packages/PIL/_imaging.so: Mach-O universal  
binary with 2 architectures
/Library/Python/2.5/site-packages/PIL/_imaging.so (for architecture  
i386):	Mach-O bundle i386
/Library/Python/2.5/site-packages/PIL/_imaging.so (for architecture  
ppc7400):	Mach-O bundle ppc

But on the other hand, the same goes for python:

marigold:~ arno$ file `which python`
/usr/bin/python: Mach-O universal binary with 2 architectures
/usr/bin/python (for architecture ppc7400):	Mach-O executable ppc
/usr/bin/python (for architecture i386):	Mach-O executable i386

Having no understanding of how mod_python works, I can't decide if  
this is the problem or not (forcing httpd to run as an i386 process  
would probably tell me the answer, but I don't know how to).  But if  
it is not, what prevents _imaging.so from loading?

Thanks for reading this far.

-- 
Arnaud


From elias.collas at gulfstream.com  Tue Nov  6 16:57:06 2007
From: elias.collas at gulfstream.com (elias.collas@gulfstream.com)
Date: Tue Nov  6 16:58:36 2007
Subject: [mod_python] Session problems with 3.3.1
Message-ID: <OFD6D8838D.0D8E885D-ON8525738B.0077EE46-8525738B.007895DC@zeus.git.gulfaero.com>


Graham,

I've read your article
http://www.dscpl.com.au/wiki/ModPython/Articles/IssuesWithSessionObjects
and when I implemented Sessions in my app with mp 3.2.10, I was careful to
avoid saving anything other than dictionaries in the session object.
Everything worked great in until I upgraded to 3.3.1. I'm using the legacy
importer (yes, I punted) and don't use apache.import_module() anywhere.
Here's the lovely traceback:

Mod_python error: "PythonHandler mod_python.publisher"

Traceback (most recent call last):

  File
"/cluster/stress/methods/opt/lib/python2.5/site-packages/mod_python/apache.py",
 line 395, in HandlerDispatch
    result = object(req)

  File
"/cluster/stress/methods/opt/lib/python2.5/site-packages/mod_python/publisher.py",
 line 213, in handler
    published = publish_object(req, object)

  File
"/cluster/stress/methods/opt/lib/python2.5/site-packages/mod_python/publisher.py",
 line 425, in publish_object
    return publish_object(req,util.apply_fs_data(object, req.form,
req=req))

  File
"/cluster/stress/methods/opt/lib/python2.5/site-packages/mod_python/util.py",
 line 554, in apply_fs_data
    return object(**args)

  File "/cluster/stress/u308168/public_html/gflat/minersrule/index.py",
line 56, in report
    sess.save()

  File
"/cluster/stress/methods/opt/lib/python2.5/site-packages/mod_python/Session.py",
 line 269, in save
    self.do_save(dict)

  File
"/cluster/stress/methods/opt/lib/python2.5/site-packages/mod_python/Session.py",
 line 407, in do_save
    dbm[self._sid] = cPickle.dumps(dict)

  File "/cluster/stress/methods/opt/lib/python2.5/copy_reg.py", line 69, in
_reduce_ex
    raise TypeError, "can't pickle %s objects" % base.__name__

TypeError: can't pickle StringO objects

Can you shed any light? Thanks for your time.



This e-mail message, including all attachments, is for the sole use of the
intended recipient(s) and may contain legally privileged and confidential
information.  If you are not an intended recipient, you are hereby notified
that you have either received this message in error or through
interception, and that any review, use, distribution, copying or disclosure
of this message or its attachments is strictly prohibited and is subject to
criminal and civil penalties.  All personal messages express solely the
sender's views and not those of Gulfstream Aerospace Corporation.  If you
received this message in error, please contact the sender by reply e-mail
and destroy all copies of the original message.


From elias.collas at gulfstream.com  Tue Nov  6 17:12:21 2007
From: elias.collas at gulfstream.com (elias.collas@gulfstream.com)
Date: Tue Nov  6 17:13:52 2007
Subject: [mod_python] Re: Session problems with 3.3.1
In-Reply-To: <OFD6D8838D.0D8E885D-ON8525738B.0077EE46-8525738B.007895DC@LocalDomain>
Message-ID: <OF595353CF.6BD18C22-ON8525738B.0078E556-8525738B.0079FB37@zeus.git.gulfaero.com>

It's always great when I can solve my own issues just seconds after posting
to the list. It's like murphy's law or something.

Anyway, I was saving only dictionaries to the session, but I was saving
form values as req.form['key'] which of course are StringField objects.
Apparently, with 3.3.1 you can't even pickle mod_python objects. The fix
was to use req.form['key'].value and all was well.

I swear I stared at this for hours and it only dawned on me what to try
after posting for help.

> TypeError: can't pickle StringO objects
>
> Can you shed any light? Thanks for your time.
>
>

From graham.dumpleton at gmail.com  Tue Nov  6 19:50:58 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue Nov  6 19:51:06 2007
Subject: [mod_python] Problems with logging.
In-Reply-To: <88e286470711061254w3d19dd0cu659bced066020c87@mail.gmail.com>
References: <08ED5B72-BBA8-40D5-8C2D-9425AF18C8C4@acm.org>
	<88e286470711061241i77a4d809w33920d4036be76e9@mail.gmail.com>
	<88e286470711061254w3d19dd0cu659bced066020c87@mail.gmail.com>
Message-ID: <88e286470711061650j3a10e00cy55374e3ed09e6aa2@mail.gmail.com>

On 07/11/2007, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> On 07/11/2007, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> > On 07/11/2007, Kathryn Van Stone <kvs@acm.org> wrote:
> > >
> > > I am currently using mod_python version 3.3.1 with Apache 2.2.4 (and
> > > Python 2.5.1).  I've notice a difference between using
> > > apache.log_error and req.log_error. I modified mptest.py to the
> > > following:
> > >
> > > from mod_python import apache
> > >
> > > def handler(req):
> > >      apache.log_error('Test log from apache', apache.APLOG_DEBUG)
> > >      req.log_error('Test log from request', apache.APLOG_DEBUG)
> > >      req.content_type = 'text/plain'
> > >      req.write('Hello World')
> > >      return apache.OK
> > >
> > >
> > > I modified the apache configuration to set the log level to debug.  I
> > > get the request log message, but not the apache log message. When the
> > > log level is raised to APLOG_NOTICE, I get both messages.
> >
> > Known issue, or at least I knew about it. I can't see that I created
> > an issue for it in the bug tracker though. I also can't remember the
> > full details at the moment. I know I made sure I didn't make the same
> > mistake in mod_wsgi though. :-)
> >
> > > Any thoughts on why there is a difference?  We have areas where
> > > getting the request object is a hassle and would like to use
> > > apache.log_error. (Also there are members of my team who don't like
> > > the 'requestobject.c(823)' showing up in the log as it adds almost no
> > > information)
> >
> > That requestobject.c always show for DEBUG level statements is a
> > result of how Apache works, in that it in embeds the C code file/line
> > number of where ap_log_rerror() is called. It is non trivial and
> > perhaps not entirely reliable, to try and dynamically work out where
> > in the Python code the call to the Python wrapper for the function was
> > called. It may be possible to fudge things at the level of the call to
> > ap_log_rerror() and not pass APLOG_MARK as argument and split it out
> > into two separate zero arguments. Presume that ap_log_rerror() will
> > not crash if line information not supplied.
>
> Quick one as bit rushed right now.
>
> Use:
>
>   from mod_python import apache
>   apache.main_server.log_error(......)
>
> for now.
>
> This should mean values of LogLevel will be honoured.
>
> I remember what the issues were now, but no time to go in to it.

Hmmm, had a chance to look at the code now and the issue I was
thinking of was fixed in mod_python 3.3.1.

The only thing I can think of now is that you are putting LogLevel
directive within a specific VirtualHost container, whereas
apache.log_error() and apache.main_server.log_error() are associated
with the global Apache configuration and would only pay attention to
LogLevel defined outside of all VirtualHost containers.

Graham
From graham.dumpleton at gmail.com  Tue Nov  6 19:59:15 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue Nov  6 19:59:21 2007
Subject: [mod_python] PIL not working in mod_python on macosx 10.5
In-Reply-To: <AFFA0D5D-114E-4F26-ADE6-A11F6875895C@blueyonder.co.uk>
References: <AFFA0D5D-114E-4F26-ADE6-A11F6875895C@blueyonder.co.uk>
Message-ID: <88e286470711061659q28a18244m32be4e91d1f0fb45@mail.gmail.com>

On 07/11/2007, Arnaud Delobelle <delobelle@blueyonder.co.uk> wrote:
> Hi
>
> First thanks to Graham for pointing me in the right direction so that
> I was able to install mod_python on macosx 10.5.  Unfortunately I have
> run into another hitch:  the PIL (Python Imaging Library) is not
> working from within mod_python, even though it is working from command-
> line python:
>
> If I create a new image from mod_python, I get the error "The _imaging
> C module is not installed".
> The module _imaging.so is in /Library/Python/2.5/site-packages/PIL/
> _imaging.so and I have checked that /Library/Python/2.5/site-packages/
> PIL/ is present in sys.path from within mod_python.
>
> I am now unable to progress any further... When I first unsuccessfully
> installed mod_python, the problem was that it compiled as an i386
> module whereas httpd is x86_64 on macosx 10.5 (on Intel Core 2 Duo).
> My first reaction was that _imaging.so was for the wrong architecture
> as well:
>
> marigold:~ arno$ file /Library/Python/2.5/site-packages/PIL/_imaging.so
> /Library/Python/2.5/site-packages/PIL/_imaging.so: Mach-O universal
> binary with 2 architectures
> /Library/Python/2.5/site-packages/PIL/_imaging.so (for architecture
> i386):  Mach-O bundle i386
> /Library/Python/2.5/site-packages/PIL/_imaging.so (for architecture
> ppc7400):       Mach-O bundle ppc
>
> But on the other hand, the same goes for python:
>
> marigold:~ arno$ file `which python`
> /usr/bin/python: Mach-O universal binary with 2 architectures
> /usr/bin/python (for architecture ppc7400):     Mach-O executable ppc
> /usr/bin/python (for architecture i386):        Mach-O executable i386
>
> Having no understanding of how mod_python works, I can't decide if
> this is the problem or not (forcing httpd to run as an i386 process
> would probably tell me the answer, but I don't know how to).  But if
> it is not, what prevents _imaging.so from loading?

There is most likely an error message getting output as to why from
mod_python internals or the OS, but unfortunately mod_python is
deficient in not promptly flushing any output to sys.stderr. Such
messages may only get flushed when Apache is shut down, so shutdown
Apache and look near end of log files for any strange messages.

Also suggest you construct a simple hello world test handler that
doesn't use any third party packages. Once that is working, add:

  import sys

  try:
    print >> sys.stderr, '#1"
    sys.stderr.flush()
    import _imaging
    print >> sys.stderr, '#2"
    sys.stderr.flush()
  except:
    print >> sys.stderr, '#3"
    sys.stderr.flush()
    raise

Post here what is output to the Apache error log file.

Graham
From pwhbeck at gmail.com  Tue Nov  6 20:42:40 2007
From: pwhbeck at gmail.com (Peter Hollenbeck)
Date: Tue Nov  6 20:42:43 2007
Subject: [mod_python] Mailing List Problem?
Message-ID: <255b859d0711061742y8b20aaw7ceab016ef32852f@mail.gmail.com>

I am new to mod_python and just subscribed to the mailing list.
I got an introductory email containing the following:

"General information about the mailing list is at:
http://mailman.modpython.org/mailman/listinfo/mod_python"

To see the collection of prior postings to the list, visit the
Mod_python Archives.
The link is:"http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/"

I click on this link and get "Server not found".

Where can I find the archives?

Thanks,
Peter Hollenbeck
From matusis at yahoo.com  Tue Nov  6 21:42:35 2007
From: matusis at yahoo.com (Alec Matusis)
Date: Tue Nov  6 21:42:44 2007
Subject: [mod_python] mod_python or apache scalability?
In-Reply-To: <88e286470711060352k68e8ed74l7065e450d71cc16@mail.gmail.com>
References: <022001c8040b$31c20790$954616b0$@com>	
	<02c201c81ecc$b3656ef0$1a304cd0$@com>	
	<88e286470711040232w49400695va54348964b6fedac@mail.gmail.com>	
	<02cc01c81ece$b88b43d0$29a1cb70$@com>	
	<88e286470711040248l4a436c9awaa8bb1417e47e42a@mail.gmail.com>	
	<3315C807-972E-425D-8373-30E749A4AD68@xs4us.nu>	
	<03d601c81f23$c39c83b0$4ad58b10$@com>	
	<B6C73A5E30565245BB6D32B5F5DF7A52172AEF@sense.emmastraat.pijnacker>	
	<88e286470711051328p3528293dr2cee06b9f5c5ce0f@mail.gmail.com>	
	<074501c82053$25462eb0$6fd28c10$@com>
	<88e286470711060352k68e8ed74l7065e450d71cc16@mail.gmail.com>
Message-ID: <006c01c820e7$da937450$8fba5cf0$@com>

> So, what is 'modules' and '_import' and how are they used? 

'modules' is 'from sys import modules', so it's sys.modules...

'_import' is used in the publisher like so:

publisher.py:

from common._import import _import

def handler(req):
    ...		
    dyn_path = req.uri[1:] #to get rid of '/' prefix
    module_path = string.replace(dyn_path,'/','.')
    runme = _import( module_path )
    ....


common/_import.py:

from sys import modules
def _import( module_path ):
    runme = modules[ module_path ]
    #get the last part
    class_name = module_path.split('.')[-1]
    try:
        runme = getattr(runme, class_name ) <--- INTERMITTENT ERROR here
    except AttributeError:
        raise Exception,'Module does not contain class '+class_name+',
runme='+repr(runme)+' module_path='+repr(module_path)

> How do you
> ensure that two concurrently executing request handlers trying to
> import the same module don't interfere with each other?

We do not insure that- the code was written for prefork MPM. 
What is the best way to insure that?


> -----Original Message-----
> From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> Sent: Tuesday, November 06, 2007 3:53 AM
> To: Alec Matusis
> Cc: Martijn Moeling; mod_python@modpython.org
> Subject: Re: [mod_python] mod_python or apache scalability?
> 
> On 06/11/2007, Alec Matusis <matusis@yahoo.com> wrote:
> > I found that this that
> >
> > IOError: image file is truncated (14432 bytes not processed)
> >
> > has to do with using input filter
> >
> > PythonInputFilter flashfilter FLASHFILTER
> > SetInputFilter FLASHFILTER
> >
> > It somehow behaves differently in apache 2.2.6/mod_python 3.3.1
> versus
> > 2.0.54/ 3.1.4. For now, I removed this input filter (we can get away
> without
> > it), and it seems to work.
> >
> > However, we have a bigger problem: we now have intermittent import
> errors
> > (one error per about 50-80 requests).
> >
> > This code executed by publisher:
> >
> > import modules
> > def _import( module_path ):
> >     runme = modules[ module_path ]
> >     #get the last part
> >     class_name = module_path.split('.')[-1]
> >     try:
> >         runme = getattr(runme, class_name ) <--- INTERMITTENT ERROR
> here
> >     except AttributeError:
> >         raise Exception,'Module does not contain class
> '+class_name+',
> > runme='+repr(runme)+' module_path='+repr(module_path)
> >
> > produces this error:
> >
> > Exception: Module does not contain class getprofile, runme=<module
> > 'getprofile' from '/path/scripts/getprofile.py'>
> module_path='getprofile'
> >
> > This used to always work with prefork. Is there anything not thread
> safe
> > about importing modules?
> 
> The underlying Python and mod_python import mechanisms themselves are
> never usually the problem. It is thread unsafe practices regarding
> initialisation in the code around the imports.
> 
> So, if you have built your own form of module importer or higher level
> layer for one and you haven't properly thread protected it, it is most
> likely the cause.
> 
> So, what is 'modules' and '_import' and how are they used? How do you
> ensure that two concurrently executing request handlers trying to
> import the same module don't interfere with each other?
> 
> Graham
> 
> > > -----Original Message-----
> > > From: mod_python-bounces@modpython.org [mailto:mod_python-
> > > bounces@modpython.org] On Behalf Of Graham Dumpleton
> > > Sent: Monday, November 05, 2007 1:29 PM
> > > To: Martijn Moeling
> > > Cc: mod_python@modpython.org; Alec Matusis
> > > Subject: Re: [mod_python] mod_python or apache scalability?
> > >
> > > The LimitRequestBody directive support in mod_python is broken and
> > > most likely would have resulted in a 500 error occurring during
> > > mod_python.publisher processing of the form even before the user
> code
> > > was run.
> > >
> > > My guess at the reason is that they have enabled in the new Apache
> > > server compression on request content. This may not work with
> > > mod_python because how it reads request content is broken, with it
> > > only reading up until original Content-Length in certain cases. If
> > > there is a mutating input filter such as content decompression, you
> > > will get truncated input data.
> > >
> > > https://issues.apache.org/jira/browse/MODPYTHON-240
> > > https://issues.apache.org/jira/browse/MODPYTHON-212
> > >
> > > So, OP should ensure that directives to accept compressed request
> > > content are disabled.
> > >
> > > Graham
> > >
> > > On 05/11/2007, Martijn Moeling <martijn@xs4us.nu> wrote:
> > > >
> > > >
> > > >
> > > > Hmm it looks to me that you have an upload limit in your apache
> > > config.
> > > >
> > > > It might be the LimitRequestBody directive.
> > > >
> > > > Another thing might be that your processing is faster than the
> data
> > > comes
> > > > in, but I doubt that
> > > > Take a close look at you apache conf, and your apache error log
> > > (right after
> > > > an upload or with tail -f /var/log/httpd/error_log (or where ever
> > > your
> > > > logdir is)).
> > > >
> > > > Martijn
> > > >
> > > >
> > > >  ________________________________
> > > >  Van: Alec Matusis [mailto:matusis@matusis.com]
> > > > Verzonden: zo 04.11.2007 21:46
> > > > Aan: Martijn Moeling
> > > > CC: mod_python@modpython.org
> > > > Onderwerp: RE: [mod_python] mod_python or apache scalability?
> > > >
> > > >
> > > >
> > > >
> > > > > I had similair problems however, they turned out to be MySQLdb
> > > > > related and not in a way you suspect
> > > >
> > > > Thanks! I will try separating MySQLdb connections. We do pass the
> > > connection
> > > > around currently.
> > > >
> > > > However, how would you explain this PIL error:
> > > >
> > > >     File "/path/publisher/publisher.py", line 78, in handler
> > > >  flow_instance.dispatch()
> > > >  File "/path/scripts/updateprofile.py", line 92, in
> > > > dispatch
> > > >  im.save(full, self.im_format)
> > > >     File
> > > > "/usr/local/encap/Python-2.4.1/lib/python2.4/site-
> > > packages/PIL/Image.py",
> > > > line 1272, in save
> > > >
> > > >  File
> > > > "/usr/local/encap/Python-2.4.1/lib/python2.4/site-
> > > packages/PIL/ImageFile.py"
> > > > , line 192, in load
> > > >  IOError: image file is truncated (14432 bytes not processed)
> > > >
> > > > This only happened for large images, small ones uploaded fine.
> > > > The code is
> > > >
> > > > def dispatch(self):
> > > >     pix = self.form['Filedata']
> > > >     try:
> > > >         im = Image.open(pix.file)
> > > >     except IOError:
> > > >         self.req.status = apache.HTTP_NOT_ACCEPTABLE
> > > >     im.save(full, self.im_format)
> > > >
> > > > The error is in the last line. It did not occur with prefork.
> > > >
> > > >
> > > >
> > > >
> > > >
> > > > > -----Original Message-----
> > > > > From: mod_python-bounces@modpython.org
> > > > [mailto:mod_python-
> > > > > bounces@modpython.org] On Behalf Of Martijn Moeling
> > > > > Sent: Sunday, November 04, 2007 5:16 AM
> > > > > To: Graham Dumpleton
> > > > > Cc: mod_python@modpython.org; Alec Matusis
> > > >
> > > > > Subject: Re: [mod_python] mod_python or apache scalability?
> > > > >
> > > > > hi,
> > > > >
> > > > > I use Pil without any problems, a I do with MySQLdb.
> > > > >
> > > > > I had similair problems however, they turned out to be MySQLdb
> > > > > related and not in a way you suspect
> > > > >
> > > > > Never ever use a global database connection variable. Create
> the
> > > > > database connection within your handler,
> > > > > end register a cleanup for closing it. I fixed a lot of trouble
> by
> > > > > altering my system by making all "global" stuff a method or
> > > property
> > > > > of the req object.
> > > > >
> > > > > The cleanup procedure cleans all objects which do anything to
> 3rd
> > > > > party external (net connected) stuff (like imap, MySQL)
> > > > >
> > > > >
> > > > > think of something like this:
> > > > >
> > > > >
> > > > > def handler_cleanup(req):
> > > > >       req.db.cursor.close()
> > > > >       req.db.close()
> > > > >
> > > > > Def handler (req):
> > > > >       req.db=MySQLdb.connection(...........)
> > > > >       req.cursor=req.db.cursor(...)
> > > > >
> > > > >       ....
> > > > >       ....
> > > > >       ....
> > > > >       req.register_cleanup(handler_cleanup,req)
> > > > >       return apache.OK
> > > > >
> > > > > All my application specific code are classes, and instantated
> as a
> > > > > req.something and req is passed to all functions, which is neat
> > > since
> > > > > it is passed by reference meaning stacks stay small to
> > > > >
> > > > > If you use MySQLdb with mod_python use the above method, my
> > > > > production server is rock stable and handled over 1mln requests
> > > since
> > > > > last december without any reboots or problems.
> > > > >
> > > > > Martijn
> > > > >
> > > > > On Nov 4, 2007, at 11:48 AM, Graham Dumpleton wrote:
> > > > >
> > > > > > Hmmm, I do remember vaguely hearing questions about PIL
> thread
> > > safety
> > > > > > before, so it might be an issue. :-(
> > > > > >
> > > > > > Graham
> > > > > >
> > > > > > On 04/11/2007, Alec Matusis <matusis@matusis.com> wrote:
> > > > > >>> BTW, are you still using mod_python 3.1.4?
> > > > > >>
> > > > > >> No, we went to apache 2.2.6/ mod_python 3.3.1 combination.
> > > > > >>
> > > > > >> I will get MySQLdb to work thread-safely, but with PIL I am
> not
> > > so
> > > > > >> optimistic...
> > > > > >>
> > > > > >>> -----Original Message-----
> > > > > >>> From: Graham Dumpleton
> > > > [mailto:graham.dumpleton@gmail.com]
> > > > > >>> Sent: Sunday, November 04, 2007 2:33 AM
> > > > > >>> To: Alec Matusis
> > > > > >>> Cc: mod_python@modpython.org
> > > > > >>> Subject: Re: [mod_python] mod_python or apache scalability?
> > > > > >>>
> > > > > >>> BTW, are you still using mod_python 3.1.4? Older mod_python
> > > > > versions
> > > > > >>> have various bugs and you would be much better upgrading to
> > > 3.3.1
> > > > > if
> > > > > >>> you haven't already.
> > > > > >>>
> > > > > >>> Graham
> > > > > >>>
> > > > > >>> On 04/11/2007, Alec Matusis <matusis@matusis.com> wrote:
> > > > > >>>>> Which indicates that some third party package you are
> using
> > > is
> > > > > not
> > > > > >>>>> thread safe. This can occur if you are also using PHP as
> > > > > >>>>> various of
> > > > > >>>>> its third party packages are not thread safe.
> > > > > >>>>
> > > > > >>>> We are not using PHP, only python with mod_python.
> > > > > >>>> The only third party packages we use are MySQLdb adapter
> and
> > > PIL
> > > > > >>> image
> > > > > >>>> library.
> > > > > >>>>
> > > > > >>>> So I guess both PIL and MySQLdb have these problems.
> > > > > >>>>
> > > > > >>>>
> > > > > >>>>> -----Original Message-----
> > > > > >>>>> From: Graham Dumpleton
> > > > [mailto:graham.dumpleton@gmail.com]
> > > > > >>>>> Sent: Sunday, November 04, 2007 2:15 AM
> > > > > >>>>> To: Alec Matusis
> > > > > >>>>> Cc: mod_python@modpython.org
> > > > > >>>>> Subject: Re: [mod_python] mod_python or apache
> scalability?
> > > > > >>>>>
> > > > > >>>>> On 04/11/2007, Alec Matusis <matusis@matusis.com> wrote:
> > > > > >>>>>>> FWIW, I personally would try and move from prefork to
> > > worker
> > > > > >>> MPM as
> > > > > >>>>>>> the number of Apache child processes you are running
> with
> > > is to
> > > > > >>> my
> > > > > >>>>>>> mind excessive. Using worker would certainly drop
> memory
> > > usage
> > > > > >>> for
> > > > > >>>>> a
> > > > > >>>>>>> start as you wouldn't need as many child processes to
> be
> > > > > >>> started.
> > > > > >>>>>>
> > > > > >>>>>> I am just following up on this, since we tried worker
> MPM
> > > this
> > > > > >>>>> weekend.
> > > > > >>>>>> On our dev/stage it worked perfectly.
> > > > > >>>>>> On live, worker MPM freed up about 2GB of memory
> compared to
> > > > > >>> prefork.
> > > > > >>>>>> However, on live, it turned out to be unstable.
> > > > > >>>>>> This is what we say in the main error log:
> > > > > >>>>>>
> > > > > >>>>>> [Sun Nov 04 01:37:45 2007] [notice] child pid 20347 exit
> > > signal
> > > > > >>>>> Segmentation
> > > > > >>>>>> fault (11)
> > > > > >>>>>> [Sun Nov 04 01:37:45 2007] [notice] child pid 20460 exit
> > > signal
> > > > > >>>>> Aborted (6)
> > > > > >>>>>> [Sun Nov 04 01:37:45 2007] [notice] child pid 20515 exit
> > > signal
> > > > > >>>>> Segmentation
> > > > > >>>>>> fault (11)
> > > > > >>>>>> *** glibc detected *** double free or corruption
> (!prev):
> > > > > >>>>> 0x0000000000762c50
> > > > > >>>>>> ***
> > > > > >>>>>> *** glibc detected *** double free or corruption
> (!prev):
> > > > > >>>>> 0x000000000075d100
> > > > > >>>>>> ***
> > > > > >>>>>> [Sun Nov 04 01:37:46 2007] [notice] child pid 20152 exit
> > > signal
> > > > > >>>>> Segmentation
> > > > > >>>>>> fault (11)
> > > > > >>>>>>
> > > > > >>>>>> In the application log, we saw two types of errors:
> > > > > >>>>>>
> > > > > >>>>>> MySQLError: Connection to database failed
> > > > > >>>>>> OperationalError: (2006, 'MySQL server has gone away')
> > > > > >>>>>>
> > > > > >>>>>> and
> > > > > >>>>>>
> > > > > >>>>>> IOError: image file is truncated (44 bytes not
> processed)
> > > > > >>>>>>
> > > > > >>>>>> The first type has to do with MySQLdb module, but the
> second
> > > one
> > > > > >>>>> occurred
> > > > > >>>>>> when large images were uploaded.
> > > > > >>>>>
> > > > > >>>>> Which indicates that some third party package you are
> using
> > > is
> > > > > not
> > > > > >>>>> thread safe. This can occur if you are also using PHP as
> > > > > >>>>> various of
> > > > > >>>>> its third party packages are not thread safe. Also ensure
> > > that
> > > > > you
> > > > > >>> are
> > > > > >>>>> using the latest available Python database adapters and
> that
> > > they
> > > > > >>> are
> > > > > >>>>> compiled against thread safe reentrant libraries.
> > > > > >>>>>
> > > > > >>>>> Graham
> > > > > >>>>>
> > > > > >>>>>> We had to revert to prefork as a result of this.
> > > > > >>>>>>
> > > > > >>>>>> On another note, I managed to empirically find the
> maximum
> > > > > >>>>> ServerLimit for
> > > > > >>>>>> prefork, before the machine dies from swapping.
> > > > > >>>>>> It is 380 with 4GB RAM.
> > > > > >>>>>>
> > > > > >>>>>>> -----Original Message-----
> > > > > >>>>>>> From: Graham Dumpleton
> > > > [mailto:graham.dumpleton@gmail.com]
> > > > > >>>>>>> Sent: Monday, October 01, 2007 6:47 PM
> > > > > >>>>>>> To: Alec Matusis
> > > > > >>>>>>> Cc: mod_python@modpython.org
> > > > > >>>>>>> Subject: Re: [mod_python] mod_python or apache
> scalability?
> > > > > >>>>>>>
> > > > > >>>>>>> On 01/10/2007, Alec Matusis <matusis@matusis.com>
> wrote:
> > > > > >>>>>>>> in the apache error log. We also got
> > > > > >>>>>>>>
> > > > > >>>>>>>> kernel: possible SYN flooding on port 80. Sending
> cookies.
> > > > > >>>>>>>>
> > > > > >>>>>>>> in /var/log/messages system log.
> > > > > >>>>>>>
> > > > > >>>>>>> Have you determined for certain that you aren't the
> target
> > > of
> > > > > >>> an
> > > > > >>>>>>> external SYN Flood DOS attack?
> > > > > >>>>>>>
> > > > > >>>>>>> Do a Google search for 'kernel: possible SYN flooding
> on
> > > port
> > > > > >>> 80.
> > > > > >>>>>>> Sending cookies' and you will find lots of stuff to
> read.
> > > Your
> > > > > >>>>> running
> > > > > >>>>>>> out of or having a large number of socket connections
> may
> > > be
> > > > > >>>>>>> symptomatic of a large number of half open connections
> > > being
> > > > > >>>>> created
> > > > > >>>>>>> and then being left in TIME_WAIT. Thus perhaps do some
> > > better
> > > > > >>>>> analysis
> > > > > >>>>>>> of socket connection states using netstat. If not a SYN
> > > Flood,
> > > > > >>> then
> > > > > >>>>>>> possibly follow some of the other suggestions in the
> pages
> > > you
> > > > > >>> will
> > > > > >>>>>>> find when you do the search.
> > > > > >>>>>>>
> > > > > >>>>>>> FWIW, I personally would try and move from prefork to
> > > worker
> > > > > >>> MPM as
> > > > > >>>>>>> the number of Apache child processes you are running
> with
> > > is to
> > > > > >>> my
> > > > > >>>>>>> mind excessive. Using worker would certainly drop
> memory
> > > usage
> > > > > >>> for
> > > > > >>>>> a
> > > > > >>>>>>> start as you wouldn't need as many child processes to
> be
> > > > > >>> started. I
> > > > > >>>>>>> wouldn't be concerned about running out of threads as
> when
> > > > > >>> running
> > > > > >>>>>>> worker I wouldn't suggest more than 25 threads per
> process
> > > as a
> > > > > >>>>>>> starting point anyway. If your mod_python application
> was
> > > > > >>> creating
> > > > > >>>>>>> lots of threads, you are likely to hit the thread limit
> > > with
> > > > > >>>>> prefork
> > > > > >>>>>>> and not just worker so which MPM is used shouldn't be
> an
> > > issue
> > > > > >>> in
> > > > > >>>>> that
> > > > > >>>>>>> case.
> > > > > >>>>>>>
> > > > > >>>>>>> BTW, what operating system are you using?
> > > > > >>>>>>>
> > > > > >>>>>>> Graham
> > > > > >>>>>>
> > > > > >>>>>>
> > > > > >>>>
> > > > > >>>>
> > > > > >>
> > > > > >>
> > > > > > _______________________________________________
> > > > > > Mod_python mailing list
> > > > > > Mod_python@modpython.org
> > > > > >
> > > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > > > >
> > > > > _______________________________________________
> > > > > Mod_python mailing list
> > > > > Mod_python@modpython.org
> > > > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > > >
> > > >
> > > >
> > > >
> > > > _______________________________________________
> > > > Mod_python mailing list
> > > > Mod_python@modpython.org
> > > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > > >
> > > >
> > > _______________________________________________
> > > Mod_python mailing list
> > > Mod_python@modpython.org
> > > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
> >

From matusis at yahoo.com  Tue Nov  6 22:40:24 2007
From: matusis at yahoo.com (Alec Matusis)
Date: Tue Nov  6 22:40:35 2007
Subject: [mod_python] mod_python or apache scalability?
In-Reply-To: <006c01c820e7$da937450$8fba5cf0$@com>
References: <022001c8040b$31c20790$954616b0$@com>		<02c201c81ecc$b3656ef0$1a304cd0$@com>		<88e286470711040232w49400695va54348964b6fedac@mail.gmail.com>		<02cc01c81ece$b88b43d0$29a1cb70$@com>		<88e286470711040248l4a436c9awaa8bb1417e47e42a@mail.gmail.com>		<3315C807-972E-425D-8373-30E749A4AD68@xs4us.nu>		<03d601c81f23$c39c83b0$4ad58b10$@com>		<B6C73A5E30565245BB6D32B5F5DF7A52172AEF@sense.emmastraat.pijnacker>		<88e286470711051328p3528293dr2cee06b9f5c5ce0f@mail.gmail.com>		<074501c82053$25462eb0$6fd28c10$@com>	<88e286470711060352k68e8ed74l7065e450d71cc16@mail.gmail.com>
	<006c01c820e7$da937450$8fba5cf0$@com>
Message-ID: <007701c820ef$eebcc3c0$cc364b40$@com>

After I wrote this, I realized that the problem was in 

from sys import modules
def _import( module_path ):
     runme = modules[ module_path ] 

sys.modules was trying to use already loaded modules.
I got rid of it, and forced it to actually load modules every time, which
got rid of errors.
I wonder if forcing to load modules comes with a CPU penalty compared to
prefork however.

> -----Original Message-----
> From: mod_python-bounces@modpython.org [mailto:mod_python-
> bounces@modpython.org] On Behalf Of Alec Matusis
> Sent: Tuesday, November 06, 2007 6:43 PM
> To: 'Graham Dumpleton'
> Cc: mod_python@modpython.org
> Subject: RE: [mod_python] mod_python or apache scalability?
> 
> > So, what is 'modules' and '_import' and how are they used?
> 
> 'modules' is 'from sys import modules', so it's sys.modules...
> 
> '_import' is used in the publisher like so:
> 
> publisher.py:
> 
> from common._import import _import
> 
> def handler(req):
>     ...
>     dyn_path = req.uri[1:] #to get rid of '/' prefix
>     module_path = string.replace(dyn_path,'/','.')
>     runme = _import( module_path )
>     ....
> 
> 
> common/_import.py:
> 
> from sys import modules
> def _import( module_path ):
>     runme = modules[ module_path ]
>     #get the last part
>     class_name = module_path.split('.')[-1]
>     try:
>         runme = getattr(runme, class_name ) <--- INTERMITTENT ERROR
> here
>     except AttributeError:
>         raise Exception,'Module does not contain class '+class_name+',
> runme='+repr(runme)+' module_path='+repr(module_path)
> 
> > How do you
> > ensure that two concurrently executing request handlers trying to
> > import the same module don't interfere with each other?
> 
> We do not insure that- the code was written for prefork MPM.
> What is the best way to insure that?
> 
> 
> > -----Original Message-----
> > From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> > Sent: Tuesday, November 06, 2007 3:53 AM
> > To: Alec Matusis
> > Cc: Martijn Moeling; mod_python@modpython.org
> > Subject: Re: [mod_python] mod_python or apache scalability?
> >
> > On 06/11/2007, Alec Matusis <matusis@yahoo.com> wrote:
> > > I found that this that
> > >
> > > IOError: image file is truncated (14432 bytes not processed)
> > >
> > > has to do with using input filter
> > >
> > > PythonInputFilter flashfilter FLASHFILTER
> > > SetInputFilter FLASHFILTER
> > >
> > > It somehow behaves differently in apache 2.2.6/mod_python 3.3.1
> > versus
> > > 2.0.54/ 3.1.4. For now, I removed this input filter (we can get
> away
> > without
> > > it), and it seems to work.
> > >
> > > However, we have a bigger problem: we now have intermittent import
> > errors
> > > (one error per about 50-80 requests).
> > >
> > > This code executed by publisher:
> > >
> > > import modules
> > > def _import( module_path ):
> > >     runme = modules[ module_path ]
> > >     #get the last part
> > >     class_name = module_path.split('.')[-1]
> > >     try:
> > >         runme = getattr(runme, class_name ) <--- INTERMITTENT ERROR
> > here
> > >     except AttributeError:
> > >         raise Exception,'Module does not contain class
> > '+class_name+',
> > > runme='+repr(runme)+' module_path='+repr(module_path)
> > >
> > > produces this error:
> > >
> > > Exception: Module does not contain class getprofile, runme=<module
> > > 'getprofile' from '/path/scripts/getprofile.py'>
> > module_path='getprofile'
> > >
> > > This used to always work with prefork. Is there anything not thread
> > safe
> > > about importing modules?
> >
> > The underlying Python and mod_python import mechanisms themselves are
> > never usually the problem. It is thread unsafe practices regarding
> > initialisation in the code around the imports.
> >
> > So, if you have built your own form of module importer or higher
> level
> > layer for one and you haven't properly thread protected it, it is
> most
> > likely the cause.
> >
> > So, what is 'modules' and '_import' and how are they used? How do you
> > ensure that two concurrently executing request handlers trying to
> > import the same module don't interfere with each other?
> >
> > Graham
> >
> > > > -----Original Message-----
> > > > From: mod_python-bounces@modpython.org [mailto:mod_python-
> > > > bounces@modpython.org] On Behalf Of Graham Dumpleton
> > > > Sent: Monday, November 05, 2007 1:29 PM
> > > > To: Martijn Moeling
> > > > Cc: mod_python@modpython.org; Alec Matusis
> > > > Subject: Re: [mod_python] mod_python or apache scalability?
> > > >
> > > > The LimitRequestBody directive support in mod_python is broken
> and
> > > > most likely would have resulted in a 500 error occurring during
> > > > mod_python.publisher processing of the form even before the user
> > code
> > > > was run.
> > > >
> > > > My guess at the reason is that they have enabled in the new
> Apache
> > > > server compression on request content. This may not work with
> > > > mod_python because how it reads request content is broken, with
> it
> > > > only reading up until original Content-Length in certain cases.
> If
> > > > there is a mutating input filter such as content decompression,
> you
> > > > will get truncated input data.
> > > >
> > > > https://issues.apache.org/jira/browse/MODPYTHON-240
> > > > https://issues.apache.org/jira/browse/MODPYTHON-212
> > > >
> > > > So, OP should ensure that directives to accept compressed request
> > > > content are disabled.
> > > >
> > > > Graham
> > > >
> > > > On 05/11/2007, Martijn Moeling <martijn@xs4us.nu> wrote:
> > > > >
> > > > >
> > > > >
> > > > > Hmm it looks to me that you have an upload limit in your apache
> > > > config.
> > > > >
> > > > > It might be the LimitRequestBody directive.
> > > > >
> > > > > Another thing might be that your processing is faster than the
> > data
> > > > comes
> > > > > in, but I doubt that
> > > > > Take a close look at you apache conf, and your apache error log
> > > > (right after
> > > > > an upload or with tail -f /var/log/httpd/error_log (or where
> ever
> > > > your
> > > > > logdir is)).
> > > > >
> > > > > Martijn
> > > > >
> > > > >
> > > > >  ________________________________
> > > > >  Van: Alec Matusis [mailto:matusis@matusis.com]
> > > > > Verzonden: zo 04.11.2007 21:46
> > > > > Aan: Martijn Moeling
> > > > > CC: mod_python@modpython.org
> > > > > Onderwerp: RE: [mod_python] mod_python or apache scalability?
> > > > >
> > > > >
> > > > >
> > > > >
> > > > > > I had similair problems however, they turned out to be
> MySQLdb
> > > > > > related and not in a way you suspect
> > > > >
> > > > > Thanks! I will try separating MySQLdb connections. We do pass
> the
> > > > connection
> > > > > around currently.
> > > > >
> > > > > However, how would you explain this PIL error:
> > > > >
> > > > >     File "/path/publisher/publisher.py", line 78, in handler
> > > > >  flow_instance.dispatch()
> > > > >  File "/path/scripts/updateprofile.py", line 92, in
> > > > > dispatch
> > > > >  im.save(full, self.im_format)
> > > > >     File
> > > > > "/usr/local/encap/Python-2.4.1/lib/python2.4/site-
> > > > packages/PIL/Image.py",
> > > > > line 1272, in save
> > > > >
> > > > >  File
> > > > > "/usr/local/encap/Python-2.4.1/lib/python2.4/site-
> > > > packages/PIL/ImageFile.py"
> > > > > , line 192, in load
> > > > >  IOError: image file is truncated (14432 bytes not processed)
> > > > >
> > > > > This only happened for large images, small ones uploaded fine.
> > > > > The code is
> > > > >
> > > > > def dispatch(self):
> > > > >     pix = self.form['Filedata']
> > > > >     try:
> > > > >         im = Image.open(pix.file)
> > > > >     except IOError:
> > > > >         self.req.status = apache.HTTP_NOT_ACCEPTABLE
> > > > >     im.save(full, self.im_format)
> > > > >
> > > > > The error is in the last line. It did not occur with prefork.
> > > > >
> > > > >
> > > > >
> > > > >
> > > > >
> > > > > > -----Original Message-----
> > > > > > From: mod_python-bounces@modpython.org
> > > > > [mailto:mod_python-
> > > > > > bounces@modpython.org] On Behalf Of Martijn Moeling
> > > > > > Sent: Sunday, November 04, 2007 5:16 AM
> > > > > > To: Graham Dumpleton
> > > > > > Cc: mod_python@modpython.org; Alec Matusis
> > > > >
> > > > > > Subject: Re: [mod_python] mod_python or apache scalability?
> > > > > >
> > > > > > hi,
> > > > > >
> > > > > > I use Pil without any problems, a I do with MySQLdb.
> > > > > >
> > > > > > I had similair problems however, they turned out to be
> MySQLdb
> > > > > > related and not in a way you suspect
> > > > > >
> > > > > > Never ever use a global database connection variable. Create
> > the
> > > > > > database connection within your handler,
> > > > > > end register a cleanup for closing it. I fixed a lot of
> trouble
> > by
> > > > > > altering my system by making all "global" stuff a method or
> > > > property
> > > > > > of the req object.
> > > > > >
> > > > > > The cleanup procedure cleans all objects which do anything to
> > 3rd
> > > > > > party external (net connected) stuff (like imap, MySQL)
> > > > > >
> > > > > >
> > > > > > think of something like this:
> > > > > >
> > > > > >
> > > > > > def handler_cleanup(req):
> > > > > >       req.db.cursor.close()
> > > > > >       req.db.close()
> > > > > >
> > > > > > Def handler (req):
> > > > > >       req.db=MySQLdb.connection(...........)
> > > > > >       req.cursor=req.db.cursor(...)
> > > > > >
> > > > > >       ....
> > > > > >       ....
> > > > > >       ....
> > > > > >       req.register_cleanup(handler_cleanup,req)
> > > > > >       return apache.OK
> > > > > >
> > > > > > All my application specific code are classes, and instantated
> > as a
> > > > > > req.something and req is passed to all functions, which is
> neat
> > > > since
> > > > > > it is passed by reference meaning stacks stay small to
> > > > > >
> > > > > > If you use MySQLdb with mod_python use the above method, my
> > > > > > production server is rock stable and handled over 1mln
> requests
> > > > since
> > > > > > last december without any reboots or problems.
> > > > > >
> > > > > > Martijn
> > > > > >
> > > > > > On Nov 4, 2007, at 11:48 AM, Graham Dumpleton wrote:
> > > > > >
> > > > > > > Hmmm, I do remember vaguely hearing questions about PIL
> > thread
> > > > safety
> > > > > > > before, so it might be an issue. :-(
> > > > > > >
> > > > > > > Graham
> > > > > > >
> > > > > > > On 04/11/2007, Alec Matusis <matusis@matusis.com> wrote:
> > > > > > >>> BTW, are you still using mod_python 3.1.4?
> > > > > > >>
> > > > > > >> No, we went to apache 2.2.6/ mod_python 3.3.1 combination.
> > > > > > >>
> > > > > > >> I will get MySQLdb to work thread-safely, but with PIL I
> am
> > not
> > > > so
> > > > > > >> optimistic...
> > > > > > >>
> > > > > > >>> -----Original Message-----
> > > > > > >>> From: Graham Dumpleton
> > > > > [mailto:graham.dumpleton@gmail.com]
> > > > > > >>> Sent: Sunday, November 04, 2007 2:33 AM
> > > > > > >>> To: Alec Matusis
> > > > > > >>> Cc: mod_python@modpython.org
> > > > > > >>> Subject: Re: [mod_python] mod_python or apache
> scalability?
> > > > > > >>>
> > > > > > >>> BTW, are you still using mod_python 3.1.4? Older
> mod_python
> > > > > > versions
> > > > > > >>> have various bugs and you would be much better upgrading
> to
> > > > 3.3.1
> > > > > > if
> > > > > > >>> you haven't already.
> > > > > > >>>
> > > > > > >>> Graham
> > > > > > >>>
> > > > > > >>> On 04/11/2007, Alec Matusis <matusis@matusis.com> wrote:
> > > > > > >>>>> Which indicates that some third party package you are
> > using
> > > > is
> > > > > > not
> > > > > > >>>>> thread safe. This can occur if you are also using PHP
> as
> > > > > > >>>>> various of
> > > > > > >>>>> its third party packages are not thread safe.
> > > > > > >>>>
> > > > > > >>>> We are not using PHP, only python with mod_python.
> > > > > > >>>> The only third party packages we use are MySQLdb adapter
> > and
> > > > PIL
> > > > > > >>> image
> > > > > > >>>> library.
> > > > > > >>>>
> > > > > > >>>> So I guess both PIL and MySQLdb have these problems.
> > > > > > >>>>
> > > > > > >>>>
> > > > > > >>>>> -----Original Message-----
> > > > > > >>>>> From: Graham Dumpleton
> > > > > [mailto:graham.dumpleton@gmail.com]
> > > > > > >>>>> Sent: Sunday, November 04, 2007 2:15 AM
> > > > > > >>>>> To: Alec Matusis
> > > > > > >>>>> Cc: mod_python@modpython.org
> > > > > > >>>>> Subject: Re: [mod_python] mod_python or apache
> > scalability?
> > > > > > >>>>>
> > > > > > >>>>> On 04/11/2007, Alec Matusis <matusis@matusis.com>
> wrote:
> > > > > > >>>>>>> FWIW, I personally would try and move from prefork to
> > > > worker
> > > > > > >>> MPM as
> > > > > > >>>>>>> the number of Apache child processes you are running
> > with
> > > > is to
> > > > > > >>> my
> > > > > > >>>>>>> mind excessive. Using worker would certainly drop
> > memory
> > > > usage
> > > > > > >>> for
> > > > > > >>>>> a
> > > > > > >>>>>>> start as you wouldn't need as many child processes to
> > be
> > > > > > >>> started.
> > > > > > >>>>>>
> > > > > > >>>>>> I am just following up on this, since we tried worker
> > MPM
> > > > this
> > > > > > >>>>> weekend.
> > > > > > >>>>>> On our dev/stage it worked perfectly.
> > > > > > >>>>>> On live, worker MPM freed up about 2GB of memory
> > compared to
> > > > > > >>> prefork.
> > > > > > >>>>>> However, on live, it turned out to be unstable.
> > > > > > >>>>>> This is what we say in the main error log:
> > > > > > >>>>>>
> > > > > > >>>>>> [Sun Nov 04 01:37:45 2007] [notice] child pid 20347
> exit
> > > > signal
> > > > > > >>>>> Segmentation
> > > > > > >>>>>> fault (11)
> > > > > > >>>>>> [Sun Nov 04 01:37:45 2007] [notice] child pid 20460
> exit
> > > > signal
> > > > > > >>>>> Aborted (6)
> > > > > > >>>>>> [Sun Nov 04 01:37:45 2007] [notice] child pid 20515
> exit
> > > > signal
> > > > > > >>>>> Segmentation
> > > > > > >>>>>> fault (11)
> > > > > > >>>>>> *** glibc detected *** double free or corruption
> > (!prev):
> > > > > > >>>>> 0x0000000000762c50
> > > > > > >>>>>> ***
> > > > > > >>>>>> *** glibc detected *** double free or corruption
> > (!prev):
> > > > > > >>>>> 0x000000000075d100
> > > > > > >>>>>> ***
> > > > > > >>>>>> [Sun Nov 04 01:37:46 2007] [notice] child pid 20152
> exit
> > > > signal
> > > > > > >>>>> Segmentation
> > > > > > >>>>>> fault (11)
> > > > > > >>>>>>
> > > > > > >>>>>> In the application log, we saw two types of errors:
> > > > > > >>>>>>
> > > > > > >>>>>> MySQLError: Connection to database failed
> > > > > > >>>>>> OperationalError: (2006, 'MySQL server has gone away')
> > > > > > >>>>>>
> > > > > > >>>>>> and
> > > > > > >>>>>>
> > > > > > >>>>>> IOError: image file is truncated (44 bytes not
> > processed)
> > > > > > >>>>>>
> > > > > > >>>>>> The first type has to do with MySQLdb module, but the
> > second
> > > > one
> > > > > > >>>>> occurred
> > > > > > >>>>>> when large images were uploaded.
> > > > > > >>>>>
> > > > > > >>>>> Which indicates that some third party package you are
> > using
> > > > is
> > > > > > not
> > > > > > >>>>> thread safe. This can occur if you are also using PHP
> as
> > > > > > >>>>> various of
> > > > > > >>>>> its third party packages are not thread safe. Also
> ensure
> > > > that
> > > > > > you
> > > > > > >>> are
> > > > > > >>>>> using the latest available Python database adapters and
> > that
> > > > they
> > > > > > >>> are
> > > > > > >>>>> compiled against thread safe reentrant libraries.
> > > > > > >>>>>
> > > > > > >>>>> Graham
> > > > > > >>>>>
> > > > > > >>>>>> We had to revert to prefork as a result of this.
> > > > > > >>>>>>
> > > > > > >>>>>> On another note, I managed to empirically find the
> > maximum
> > > > > > >>>>> ServerLimit for
> > > > > > >>>>>> prefork, before the machine dies from swapping.
> > > > > > >>>>>> It is 380 with 4GB RAM.
> > > > > > >>>>>>
> > > > > > >>>>>>> -----Original Message-----
> > > > > > >>>>>>> From: Graham Dumpleton
> > > > > [mailto:graham.dumpleton@gmail.com]
> > > > > > >>>>>>> Sent: Monday, October 01, 2007 6:47 PM
> > > > > > >>>>>>> To: Alec Matusis
> > > > > > >>>>>>> Cc: mod_python@modpython.org
> > > > > > >>>>>>> Subject: Re: [mod_python] mod_python or apache
> > scalability?
> > > > > > >>>>>>>
> > > > > > >>>>>>> On 01/10/2007, Alec Matusis <matusis@matusis.com>
> > wrote:
> > > > > > >>>>>>>> in the apache error log. We also got
> > > > > > >>>>>>>>
> > > > > > >>>>>>>> kernel: possible SYN flooding on port 80. Sending
> > cookies.
> > > > > > >>>>>>>>
> > > > > > >>>>>>>> in /var/log/messages system log.
> > > > > > >>>>>>>
> > > > > > >>>>>>> Have you determined for certain that you aren't the
> > target
> > > > of
> > > > > > >>> an
> > > > > > >>>>>>> external SYN Flood DOS attack?
> > > > > > >>>>>>>
> > > > > > >>>>>>> Do a Google search for 'kernel: possible SYN flooding
> > on
> > > > port
> > > > > > >>> 80.
> > > > > > >>>>>>> Sending cookies' and you will find lots of stuff to
> > read.
> > > > Your
> > > > > > >>>>> running
> > > > > > >>>>>>> out of or having a large number of socket connections
> > may
> > > > be
> > > > > > >>>>>>> symptomatic of a large number of half open
> connections
> > > > being
> > > > > > >>>>> created
> > > > > > >>>>>>> and then being left in TIME_WAIT. Thus perhaps do
> some
> > > > better
> > > > > > >>>>> analysis
> > > > > > >>>>>>> of socket connection states using netstat. If not a
> SYN
> > > > Flood,
> > > > > > >>> then
> > > > > > >>>>>>> possibly follow some of the other suggestions in the
> > pages
> > > > you
> > > > > > >>> will
> > > > > > >>>>>>> find when you do the search.
> > > > > > >>>>>>>
> > > > > > >>>>>>> FWIW, I personally would try and move from prefork to
> > > > worker
> > > > > > >>> MPM as
> > > > > > >>>>>>> the number of Apache child processes you are running
> > with
> > > > is to
> > > > > > >>> my
> > > > > > >>>>>>> mind excessive. Using worker would certainly drop
> > memory
> > > > usage
> > > > > > >>> for
> > > > > > >>>>> a
> > > > > > >>>>>>> start as you wouldn't need as many child processes to
> > be
> > > > > > >>> started. I
> > > > > > >>>>>>> wouldn't be concerned about running out of threads as
> > when
> > > > > > >>> running
> > > > > > >>>>>>> worker I wouldn't suggest more than 25 threads per
> > process
> > > > as a
> > > > > > >>>>>>> starting point anyway. If your mod_python application
> > was
> > > > > > >>> creating
> > > > > > >>>>>>> lots of threads, you are likely to hit the thread
> limit
> > > > with
> > > > > > >>>>> prefork
> > > > > > >>>>>>> and not just worker so which MPM is used shouldn't be
> > an
> > > > issue
> > > > > > >>> in
> > > > > > >>>>> that
> > > > > > >>>>>>> case.
> > > > > > >>>>>>>
> > > > > > >>>>>>> BTW, what operating system are you using?
> > > > > > >>>>>>>
> > > > > > >>>>>>> Graham
> > > > > > >>>>>>
> > > > > > >>>>>>
> > > > > > >>>>
> > > > > > >>>>
> > > > > > >>
> > > > > > >>
> > > > > > > _______________________________________________
> > > > > > > Mod_python mailing list
> > > > > > > Mod_python@modpython.org
> > > > > > >
> > > > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > > > > >
> > > > > > _______________________________________________
> > > > > > Mod_python mailing list
> > > > > > Mod_python@modpython.org
> > > > > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > > > >
> > > > >
> > > > >
> > > > >
> > > > > _______________________________________________
> > > > > Mod_python mailing list
> > > > > Mod_python@modpython.org
> > > > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > > > >
> > > > >
> > > > _______________________________________________
> > > > Mod_python mailing list
> > > > Mod_python@modpython.org
> > > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > >
> > >
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From mboorshtein at gmail.com  Tue Nov  6 23:42:43 2007
From: mboorshtein at gmail.com (Marc Boorshtein)
Date: Tue Nov  6 23:42:48 2007
Subject: [mod_python] Issues compiling mod_python 3.3.1
Message-ID: <800df6390711062042m3c4dd9ber735eb5d9d2a3ac17@mail.gmail.com>

All,

I'm trying to compile mod_python 3.3.1 on Solaris 8 using the apache
2.2.4 with gcc 3.4.6 from SunFreeware.com.  Configure succeeds but I
get the following error durring make:

ld: fatal: relocations remain against allocatable but non-writable sections
collect2: ld returned 1 exit status
apxs:Error: Command failed with rc=65536
.
make[1]: *** [mod_python.so] Error 1
make: *** [do_dso] Error 2

Any ideas?

Here's my python:

Python 2.5.1 (r251:54863, May 16 2007, 20:12:18)
[GCC 3.4.6] on sunos5


Any help would be greatly appreciated.

Thanks
Marc
From graham.dumpleton at gmail.com  Wed Nov  7 00:42:00 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Wed Nov  7 00:42:06 2007
Subject: [mod_python] Mailing List Problem?
In-Reply-To: <255b859d0711061742y8b20aaw7ceab016ef32852f@mail.gmail.com>
References: <255b859d0711061742y8b20aaw7ceab016ef32852f@mail.gmail.com>
Message-ID: <88e286470711062142q60f7edc0med9dfe7552d3cf53@mail.gmail.com>

Known issue. Read:

  https://issues.apache.org/jira/browse/MODPYTHON-44

for workaround.

The site is not under control of people now taking an interest in
mod_python and we haven't been able to get it changed.

Graham.

On 07/11/2007, Peter Hollenbeck <pwhbeck@gmail.com> wrote:
> I am new to mod_python and just subscribed to the mailing list.
> I got an introductory email containing the following:
>
> "General information about the mailing list is at:
> http://mailman.modpython.org/mailman/listinfo/mod_python"
>
> To see the collection of prior postings to the list, visit the
> Mod_python Archives.
> The link is:"http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/"
>
> I click on this link and get "Server not found".
>
> Where can I find the archives?
>
> Thanks,
> Peter Hollenbeck
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From graham.dumpleton at gmail.com  Wed Nov  7 00:49:25 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Wed Nov  7 00:49:28 2007
Subject: [mod_python] mod_python or apache scalability?
In-Reply-To: <007701c820ef$eebcc3c0$cc364b40$@com>
References: <022001c8040b$31c20790$954616b0$@com>
	<88e286470711040248l4a436c9awaa8bb1417e47e42a@mail.gmail.com>
	<3315C807-972E-425D-8373-30E749A4AD68@xs4us.nu>
	<03d601c81f23$c39c83b0$4ad58b10$@com>
	<B6C73A5E30565245BB6D32B5F5DF7A52172AEF@sense.emmastraat.pijnacker>
	<88e286470711051328p3528293dr2cee06b9f5c5ce0f@mail.gmail.com>
	<074501c82053$25462eb0$6fd28c10$@com>
	<88e286470711060352k68e8ed74l7065e450d71cc16@mail.gmail.com>
	<006c01c820e7$da937450$8fba5cf0$@com>
	<007701c820ef$eebcc3c0$cc364b40$@com>
Message-ID: <88e286470711062149w1244fb5fy587681ba1fc77114@mail.gmail.com>

On 07/11/2007, Alec Matusis <matusis@yahoo.com> wrote:
> After I wrote this, I realized that the problem was in
>
> from sys import modules
> def _import( module_path ):
>      runme = modules[ module_path ]
>
> sys.modules was trying to use already loaded modules.
> I got rid of it, and forced it to actually load modules every time, which
> got rid of errors.
> I wonder if forcing to load modules comes with a CPU penalty compared to
> prefork however.

Can't tell. You still haven't showed how the modules are actually
being imported.

Why aren't you just using apache.import_module() from mod_python? See:

  http://www.modpython.org/live/current/doc-html/pyapi-apmeth.html

Graham

> > -----Original Message-----
> > From: mod_python-bounces@modpython.org [mailto:mod_python-
> > bounces@modpython.org] On Behalf Of Alec Matusis
> > Sent: Tuesday, November 06, 2007 6:43 PM
> > To: 'Graham Dumpleton'
> > Cc: mod_python@modpython.org
> > Subject: RE: [mod_python] mod_python or apache scalability?
> >
> > > So, what is 'modules' and '_import' and how are they used?
> >
> > 'modules' is 'from sys import modules', so it's sys.modules...
> >
> > '_import' is used in the publisher like so:
> >
> > publisher.py:
> >
> > from common._import import _import
> >
> > def handler(req):
> >     ...
> >     dyn_path = req.uri[1:] #to get rid of '/' prefix
> >     module_path = string.replace(dyn_path,'/','.')
> >     runme = _import( module_path )
> >     ....
> >
> >
> > common/_import.py:
> >
> > from sys import modules
> > def _import( module_path ):
> >     runme = modules[ module_path ]
> >     #get the last part
> >     class_name = module_path.split('.')[-1]
> >     try:
> >         runme = getattr(runme, class_name ) <--- INTERMITTENT ERROR
> > here
> >     except AttributeError:
> >         raise Exception,'Module does not contain class '+class_name+',
> > runme='+repr(runme)+' module_path='+repr(module_path)
> >
> > > How do you
> > > ensure that two concurrently executing request handlers trying to
> > > import the same module don't interfere with each other?
> >
> > We do not insure that- the code was written for prefork MPM.
> > What is the best way to insure that?
> >
> >
> > > -----Original Message-----
> > > From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> > > Sent: Tuesday, November 06, 2007 3:53 AM
> > > To: Alec Matusis
> > > Cc: Martijn Moeling; mod_python@modpython.org
> > > Subject: Re: [mod_python] mod_python or apache scalability?
> > >
> > > On 06/11/2007, Alec Matusis <matusis@yahoo.com> wrote:
> > > > I found that this that
> > > >
> > > > IOError: image file is truncated (14432 bytes not processed)
> > > >
> > > > has to do with using input filter
> > > >
> > > > PythonInputFilter flashfilter FLASHFILTER
> > > > SetInputFilter FLASHFILTER
> > > >
> > > > It somehow behaves differently in apache 2.2.6/mod_python 3.3.1
> > > versus
> > > > 2.0.54/ 3.1.4. For now, I removed this input filter (we can get
> > away
> > > without
> > > > it), and it seems to work.
> > > >
> > > > However, we have a bigger problem: we now have intermittent import
> > > errors
> > > > (one error per about 50-80 requests).
> > > >
> > > > This code executed by publisher:
> > > >
> > > > import modules
> > > > def _import( module_path ):
> > > >     runme = modules[ module_path ]
> > > >     #get the last part
> > > >     class_name = module_path.split('.')[-1]
> > > >     try:
> > > >         runme = getattr(runme, class_name ) <--- INTERMITTENT ERROR
> > > here
> > > >     except AttributeError:
> > > >         raise Exception,'Module does not contain class
> > > '+class_name+',
> > > > runme='+repr(runme)+' module_path='+repr(module_path)
> > > >
> > > > produces this error:
> > > >
> > > > Exception: Module does not contain class getprofile, runme=<module
> > > > 'getprofile' from '/path/scripts/getprofile.py'>
> > > module_path='getprofile'
> > > >
> > > > This used to always work with prefork. Is there anything not thread
> > > safe
> > > > about importing modules?
> > >
> > > The underlying Python and mod_python import mechanisms themselves are
> > > never usually the problem. It is thread unsafe practices regarding
> > > initialisation in the code around the imports.
> > >
> > > So, if you have built your own form of module importer or higher
> > level
> > > layer for one and you haven't properly thread protected it, it is
> > most
> > > likely the cause.
> > >
> > > So, what is 'modules' and '_import' and how are they used? How do you
> > > ensure that two concurrently executing request handlers trying to
> > > import the same module don't interfere with each other?
> > >
> > > Graham
> > >
> > > > > -----Original Message-----
> > > > > From: mod_python-bounces@modpython.org [mailto:mod_python-
> > > > > bounces@modpython.org] On Behalf Of Graham Dumpleton
> > > > > Sent: Monday, November 05, 2007 1:29 PM
> > > > > To: Martijn Moeling
> > > > > Cc: mod_python@modpython.org; Alec Matusis
> > > > > Subject: Re: [mod_python] mod_python or apache scalability?
> > > > >
> > > > > The LimitRequestBody directive support in mod_python is broken
> > and
> > > > > most likely would have resulted in a 500 error occurring during
> > > > > mod_python.publisher processing of the form even before the user
> > > code
> > > > > was run.
> > > > >
> > > > > My guess at the reason is that they have enabled in the new
> > Apache
> > > > > server compression on request content. This may not work with
> > > > > mod_python because how it reads request content is broken, with
> > it
> > > > > only reading up until original Content-Length in certain cases.
> > If
> > > > > there is a mutating input filter such as content decompression,
> > you
> > > > > will get truncated input data.
> > > > >
> > > > > https://issues.apache.org/jira/browse/MODPYTHON-240
> > > > > https://issues.apache.org/jira/browse/MODPYTHON-212
> > > > >
> > > > > So, OP should ensure that directives to accept compressed request
> > > > > content are disabled.
> > > > >
> > > > > Graham
> > > > >
> > > > > On 05/11/2007, Martijn Moeling <martijn@xs4us.nu> wrote:
> > > > > >
> > > > > >
> > > > > >
> > > > > > Hmm it looks to me that you have an upload limit in your apache
> > > > > config.
> > > > > >
> > > > > > It might be the LimitRequestBody directive.
> > > > > >
> > > > > > Another thing might be that your processing is faster than the
> > > data
> > > > > comes
> > > > > > in, but I doubt that
> > > > > > Take a close look at you apache conf, and your apache error log
> > > > > (right after
> > > > > > an upload or with tail -f /var/log/httpd/error_log (or where
> > ever
> > > > > your
> > > > > > logdir is)).
> > > > > >
> > > > > > Martijn
> > > > > >
> > > > > >
> > > > > >  ________________________________
> > > > > >  Van: Alec Matusis [mailto:matusis@matusis.com]
> > > > > > Verzonden: zo 04.11.2007 21:46
> > > > > > Aan: Martijn Moeling
> > > > > > CC: mod_python@modpython.org
> > > > > > Onderwerp: RE: [mod_python] mod_python or apache scalability?
> > > > > >
> > > > > >
> > > > > >
> > > > > >
> > > > > > > I had similair problems however, they turned out to be
> > MySQLdb
> > > > > > > related and not in a way you suspect
> > > > > >
> > > > > > Thanks! I will try separating MySQLdb connections. We do pass
> > the
> > > > > connection
> > > > > > around currently.
> > > > > >
> > > > > > However, how would you explain this PIL error:
> > > > > >
> > > > > >     File "/path/publisher/publisher.py", line 78, in handler
> > > > > >  flow_instance.dispatch()
> > > > > >  File "/path/scripts/updateprofile.py", line 92, in
> > > > > > dispatch
> > > > > >  im.save(full, self.im_format)
> > > > > >     File
> > > > > > "/usr/local/encap/Python-2.4.1/lib/python2.4/site-
> > > > > packages/PIL/Image.py",
> > > > > > line 1272, in save
> > > > > >
> > > > > >  File
> > > > > > "/usr/local/encap/Python-2.4.1/lib/python2.4/site-
> > > > > packages/PIL/ImageFile.py"
> > > > > > , line 192, in load
> > > > > >  IOError: image file is truncated (14432 bytes not processed)
> > > > > >
> > > > > > This only happened for large images, small ones uploaded fine.
> > > > > > The code is
> > > > > >
> > > > > > def dispatch(self):
> > > > > >     pix = self.form['Filedata']
> > > > > >     try:
> > > > > >         im = Image.open(pix.file)
> > > > > >     except IOError:
> > > > > >         self.req.status = apache.HTTP_NOT_ACCEPTABLE
> > > > > >     im.save(full, self.im_format)
> > > > > >
> > > > > > The error is in the last line. It did not occur with prefork.
> > > > > >
> > > > > >
> > > > > >
> > > > > >
> > > > > >
> > > > > > > -----Original Message-----
> > > > > > > From: mod_python-bounces@modpython.org
> > > > > > [mailto:mod_python-
> > > > > > > bounces@modpython.org] On Behalf Of Martijn Moeling
> > > > > > > Sent: Sunday, November 04, 2007 5:16 AM
> > > > > > > To: Graham Dumpleton
> > > > > > > Cc: mod_python@modpython.org; Alec Matusis
> > > > > >
> > > > > > > Subject: Re: [mod_python] mod_python or apache scalability?
> > > > > > >
> > > > > > > hi,
> > > > > > >
> > > > > > > I use Pil without any problems, a I do with MySQLdb.
> > > > > > >
> > > > > > > I had similair problems however, they turned out to be
> > MySQLdb
> > > > > > > related and not in a way you suspect
> > > > > > >
> > > > > > > Never ever use a global database connection variable. Create
> > > the
> > > > > > > database connection within your handler,
> > > > > > > end register a cleanup for closing it. I fixed a lot of
> > trouble
> > > by
> > > > > > > altering my system by making all "global" stuff a method or
> > > > > property
> > > > > > > of the req object.
> > > > > > >
> > > > > > > The cleanup procedure cleans all objects which do anything to
> > > 3rd
> > > > > > > party external (net connected) stuff (like imap, MySQL)
> > > > > > >
> > > > > > >
> > > > > > > think of something like this:
> > > > > > >
> > > > > > >
> > > > > > > def handler_cleanup(req):
> > > > > > >       req.db.cursor.close()
> > > > > > >       req.db.close()
> > > > > > >
> > > > > > > Def handler (req):
> > > > > > >       req.db=MySQLdb.connection(...........)
> > > > > > >       req.cursor=req.db.cursor(...)
> > > > > > >
> > > > > > >       ....
> > > > > > >       ....
> > > > > > >       ....
> > > > > > >       req.register_cleanup(handler_cleanup,req)
> > > > > > >       return apache.OK
> > > > > > >
> > > > > > > All my application specific code are classes, and instantated
> > > as a
> > > > > > > req.something and req is passed to all functions, which is
> > neat
> > > > > since
> > > > > > > it is passed by reference meaning stacks stay small to
> > > > > > >
> > > > > > > If you use MySQLdb with mod_python use the above method, my
> > > > > > > production server is rock stable and handled over 1mln
> > requests
> > > > > since
> > > > > > > last december without any reboots or problems.
> > > > > > >
> > > > > > > Martijn
> > > > > > >
> > > > > > > On Nov 4, 2007, at 11:48 AM, Graham Dumpleton wrote:
> > > > > > >
> > > > > > > > Hmmm, I do remember vaguely hearing questions about PIL
> > > thread
> > > > > safety
> > > > > > > > before, so it might be an issue. :-(
> > > > > > > >
> > > > > > > > Graham
> > > > > > > >
> > > > > > > > On 04/11/2007, Alec Matusis <matusis@matusis.com> wrote:
> > > > > > > >>> BTW, are you still using mod_python 3.1.4?
> > > > > > > >>
> > > > > > > >> No, we went to apache 2.2.6/ mod_python 3.3.1 combination.
> > > > > > > >>
> > > > > > > >> I will get MySQLdb to work thread-safely, but with PIL I
> > am
> > > not
> > > > > so
> > > > > > > >> optimistic...
> > > > > > > >>
> > > > > > > >>> -----Original Message-----
> > > > > > > >>> From: Graham Dumpleton
> > > > > > [mailto:graham.dumpleton@gmail.com]
> > > > > > > >>> Sent: Sunday, November 04, 2007 2:33 AM
> > > > > > > >>> To: Alec Matusis
> > > > > > > >>> Cc: mod_python@modpython.org
> > > > > > > >>> Subject: Re: [mod_python] mod_python or apache
> > scalability?
> > > > > > > >>>
> > > > > > > >>> BTW, are you still using mod_python 3.1.4? Older
> > mod_python
> > > > > > > versions
> > > > > > > >>> have various bugs and you would be much better upgrading
> > to
> > > > > 3.3.1
> > > > > > > if
> > > > > > > >>> you haven't already.
> > > > > > > >>>
> > > > > > > >>> Graham
> > > > > > > >>>
> > > > > > > >>> On 04/11/2007, Alec Matusis <matusis@matusis.com> wrote:
> > > > > > > >>>>> Which indicates that some third party package you are
> > > using
> > > > > is
> > > > > > > not
> > > > > > > >>>>> thread safe. This can occur if you are also using PHP
> > as
> > > > > > > >>>>> various of
> > > > > > > >>>>> its third party packages are not thread safe.
> > > > > > > >>>>
> > > > > > > >>>> We are not using PHP, only python with mod_python.
> > > > > > > >>>> The only third party packages we use are MySQLdb adapter
> > > and
> > > > > PIL
> > > > > > > >>> image
> > > > > > > >>>> library.
> > > > > > > >>>>
> > > > > > > >>>> So I guess both PIL and MySQLdb have these problems.
> > > > > > > >>>>
> > > > > > > >>>>
> > > > > > > >>>>> -----Original Message-----
> > > > > > > >>>>> From: Graham Dumpleton
> > > > > > [mailto:graham.dumpleton@gmail.com]
> > > > > > > >>>>> Sent: Sunday, November 04, 2007 2:15 AM
> > > > > > > >>>>> To: Alec Matusis
> > > > > > > >>>>> Cc: mod_python@modpython.org
> > > > > > > >>>>> Subject: Re: [mod_python] mod_python or apache
> > > scalability?
> > > > > > > >>>>>
> > > > > > > >>>>> On 04/11/2007, Alec Matusis <matusis@matusis.com>
> > wrote:
> > > > > > > >>>>>>> FWIW, I personally would try and move from prefork to
> > > > > worker
> > > > > > > >>> MPM as
> > > > > > > >>>>>>> the number of Apache child processes you are running
> > > with
> > > > > is to
> > > > > > > >>> my
> > > > > > > >>>>>>> mind excessive. Using worker would certainly drop
> > > memory
> > > > > usage
> > > > > > > >>> for
> > > > > > > >>>>> a
> > > > > > > >>>>>>> start as you wouldn't need as many child processes to
> > > be
> > > > > > > >>> started.
> > > > > > > >>>>>>
> > > > > > > >>>>>> I am just following up on this, since we tried worker
> > > MPM
> > > > > this
> > > > > > > >>>>> weekend.
> > > > > > > >>>>>> On our dev/stage it worked perfectly.
> > > > > > > >>>>>> On live, worker MPM freed up about 2GB of memory
> > > compared to
> > > > > > > >>> prefork.
> > > > > > > >>>>>> However, on live, it turned out to be unstable.
> > > > > > > >>>>>> This is what we say in the main error log:
> > > > > > > >>>>>>
> > > > > > > >>>>>> [Sun Nov 04 01:37:45 2007] [notice] child pid 20347
> > exit
> > > > > signal
> > > > > > > >>>>> Segmentation
> > > > > > > >>>>>> fault (11)
> > > > > > > >>>>>> [Sun Nov 04 01:37:45 2007] [notice] child pid 20460
> > exit
> > > > > signal
> > > > > > > >>>>> Aborted (6)
> > > > > > > >>>>>> [Sun Nov 04 01:37:45 2007] [notice] child pid 20515
> > exit
> > > > > signal
> > > > > > > >>>>> Segmentation
> > > > > > > >>>>>> fault (11)
> > > > > > > >>>>>> *** glibc detected *** double free or corruption
> > > (!prev):
> > > > > > > >>>>> 0x0000000000762c50
> > > > > > > >>>>>> ***
> > > > > > > >>>>>> *** glibc detected *** double free or corruption
> > > (!prev):
> > > > > > > >>>>> 0x000000000075d100
> > > > > > > >>>>>> ***
> > > > > > > >>>>>> [Sun Nov 04 01:37:46 2007] [notice] child pid 20152
> > exit
> > > > > signal
> > > > > > > >>>>> Segmentation
> > > > > > > >>>>>> fault (11)
> > > > > > > >>>>>>
> > > > > > > >>>>>> In the application log, we saw two types of errors:
> > > > > > > >>>>>>
> > > > > > > >>>>>> MySQLError: Connection to database failed
> > > > > > > >>>>>> OperationalError: (2006, 'MySQL server has gone away')
> > > > > > > >>>>>>
> > > > > > > >>>>>> and
> > > > > > > >>>>>>
> > > > > > > >>>>>> IOError: image file is truncated (44 bytes not
> > > processed)
> > > > > > > >>>>>>
> > > > > > > >>>>>> The first type has to do with MySQLdb module, but the
> > > second
> > > > > one
> > > > > > > >>>>> occurred
> > > > > > > >>>>>> when large images were uploaded.
> > > > > > > >>>>>
> > > > > > > >>>>> Which indicates that some third party package you are
> > > using
> > > > > is
> > > > > > > not
> > > > > > > >>>>> thread safe. This can occur if you are also using PHP
> > as
> > > > > > > >>>>> various of
> > > > > > > >>>>> its third party packages are not thread safe. Also
> > ensure
> > > > > that
> > > > > > > you
> > > > > > > >>> are
> > > > > > > >>>>> using the latest available Python database adapters and
> > > that
> > > > > they
> > > > > > > >>> are
> > > > > > > >>>>> compiled against thread safe reentrant libraries.
> > > > > > > >>>>>
> > > > > > > >>>>> Graham
> > > > > > > >>>>>
> > > > > > > >>>>>> We had to revert to prefork as a result of this.
> > > > > > > >>>>>>
> > > > > > > >>>>>> On another note, I managed to empirically find the
> > > maximum
> > > > > > > >>>>> ServerLimit for
> > > > > > > >>>>>> prefork, before the machine dies from swapping.
> > > > > > > >>>>>> It is 380 with 4GB RAM.
> > > > > > > >>>>>>
> > > > > > > >>>>>>> -----Original Message-----
> > > > > > > >>>>>>> From: Graham Dumpleton
> > > > > > [mailto:graham.dumpleton@gmail.com]
> > > > > > > >>>>>>> Sent: Monday, October 01, 2007 6:47 PM
> > > > > > > >>>>>>> To: Alec Matusis
> > > > > > > >>>>>>> Cc: mod_python@modpython.org
> > > > > > > >>>>>>> Subject: Re: [mod_python] mod_python or apache
> > > scalability?
> > > > > > > >>>>>>>
> > > > > > > >>>>>>> On 01/10/2007, Alec Matusis <matusis@matusis.com>
> > > wrote:
> > > > > > > >>>>>>>> in the apache error log. We also got
> > > > > > > >>>>>>>>
> > > > > > > >>>>>>>> kernel: possible SYN flooding on port 80. Sending
> > > cookies.
> > > > > > > >>>>>>>>
> > > > > > > >>>>>>>> in /var/log/messages system log.
> > > > > > > >>>>>>>
> > > > > > > >>>>>>> Have you determined for certain that you aren't the
> > > target
> > > > > of
> > > > > > > >>> an
> > > > > > > >>>>>>> external SYN Flood DOS attack?
> > > > > > > >>>>>>>
> > > > > > > >>>>>>> Do a Google search for 'kernel: possible SYN flooding
> > > on
> > > > > port
> > > > > > > >>> 80.
> > > > > > > >>>>>>> Sending cookies' and you will find lots of stuff to
> > > read.
> > > > > Your
> > > > > > > >>>>> running
> > > > > > > >>>>>>> out of or having a large number of socket connections
> > > may
> > > > > be
> > > > > > > >>>>>>> symptomatic of a large number of half open
> > connections
> > > > > being
> > > > > > > >>>>> created
> > > > > > > >>>>>>> and then being left in TIME_WAIT. Thus perhaps do
> > some
> > > > > better
> > > > > > > >>>>> analysis
> > > > > > > >>>>>>> of socket connection states using netstat. If not a
> > SYN
> > > > > Flood,
> > > > > > > >>> then
> > > > > > > >>>>>>> possibly follow some of the other suggestions in the
> > > pages
> > > > > you
> > > > > > > >>> will
> > > > > > > >>>>>>> find when you do the search.
> > > > > > > >>>>>>>
> > > > > > > >>>>>>> FWIW, I personally would try and move from prefork to
> > > > > worker
> > > > > > > >>> MPM as
> > > > > > > >>>>>>> the number of Apache child processes you are running
> > > with
> > > > > is to
> > > > > > > >>> my
> > > > > > > >>>>>>> mind excessive. Using worker would certainly drop
> > > memory
> > > > > usage
> > > > > > > >>> for
> > > > > > > >>>>> a
> > > > > > > >>>>>>> start as you wouldn't need as many child processes to
> > > be
> > > > > > > >>> started. I
> > > > > > > >>>>>>> wouldn't be concerned about running out of threads as
> > > when
> > > > > > > >>> running
> > > > > > > >>>>>>> worker I wouldn't suggest more than 25 threads per
> > > process
> > > > > as a
> > > > > > > >>>>>>> starting point anyway. If your mod_python application
> > > was
> > > > > > > >>> creating
> > > > > > > >>>>>>> lots of threads, you are likely to hit the thread
> > limit
> > > > > with
> > > > > > > >>>>> prefork
> > > > > > > >>>>>>> and not just worker so which MPM is used shouldn't be
> > > an
> > > > > issue
> > > > > > > >>> in
> > > > > > > >>>>> that
> > > > > > > >>>>>>> case.
> > > > > > > >>>>>>>
> > > > > > > >>>>>>> BTW, what operating system are you using?
> > > > > > > >>>>>>>
> > > > > > > >>>>>>> Graham
> > > > > > > >>>>>>
> > > > > > > >>>>>>
> > > > > > > >>>>
> > > > > > > >>>>
> > > > > > > >>
> > > > > > > >>
> > > > > > > > _______________________________________________
> > > > > > > > Mod_python mailing list
> > > > > > > > Mod_python@modpython.org
> > > > > > > >
> > > > > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > > > > > >
> > > > > > > _______________________________________________
> > > > > > > Mod_python mailing list
> > > > > > > Mod_python@modpython.org
> > > > > > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > > > > >
> > > > > >
> > > > > >
> > > > > >
> > > > > > _______________________________________________
> > > > > > Mod_python mailing list
> > > > > > Mod_python@modpython.org
> > > > > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > > > > >
> > > > > >
> > > > > _______________________________________________
> > > > > Mod_python mailing list
> > > > > Mod_python@modpython.org
> > > > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > > >
> > > >
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
From graham.dumpleton at gmail.com  Wed Nov  7 00:52:32 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Wed Nov  7 00:52:34 2007
Subject: [mod_python] Issues compiling mod_python 3.3.1
In-Reply-To: <800df6390711062042m3c4dd9ber735eb5d9d2a3ac17@mail.gmail.com>
References: <800df6390711062042m3c4dd9ber735eb5d9d2a3ac17@mail.gmail.com>
Message-ID: <88e286470711062152v19682827s454623500d4d3f30@mail.gmail.com>

Searching on the mod_python site for the error and you will find:

  http://www.modpython.org/pipermail/mod_python/2007-April/023421.html

Graham

On 07/11/2007, Marc Boorshtein <mboorshtein@gmail.com> wrote:
> All,
>
> I'm trying to compile mod_python 3.3.1 on Solaris 8 using the apache
> 2.2.4 with gcc 3.4.6 from SunFreeware.com.  Configure succeeds but I
> get the following error durring make:
>
> ld: fatal: relocations remain against allocatable but non-writable sections
> collect2: ld returned 1 exit status
> apxs:Error: Command failed with rc=65536
> .
> make[1]: *** [mod_python.so] Error 1
> make: *** [do_dso] Error 2
>
> Any ideas?
>
> Here's my python:
>
> Python 2.5.1 (r251:54863, May 16 2007, 20:12:18)
> [GCC 3.4.6] on sunos5
>
>
> Any help would be greatly appreciated.
>
> Thanks
> Marc
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From delobelle at blueyonder.co.uk  Wed Nov  7 01:27:58 2007
From: delobelle at blueyonder.co.uk (Arnaud Delobelle)
Date: Wed Nov  7 01:23:57 2007
Subject: [mod_python] PIL not working in mod_python on macosx 10.5
In-Reply-To: <88e286470711061659q28a18244m32be4e91d1f0fb45@mail.gmail.com>
References: <AFFA0D5D-114E-4F26-ADE6-A11F6875895C@blueyonder.co.uk>
	<88e286470711061659q28a18244m32be4e91d1f0fb45@mail.gmail.com>
Message-ID: <4DF18420-25ED-4990-B531-9856A31509E7@blueyonder.co.uk>


On 7 Nov 2007, at 00:59, Graham Dumpleton wrote:
>
[...]
> Post here what is output to the Apache error log file.


This is the tail of error_log:

	File "/Users/arno/Sites/square.py", line 43, in <module>
     		import _imaging

	ImportError: dlopen(/Library/Python/2.5/site-packages/PIL/ 
_imaging.so, 2): no suitable image found.  Did find:
	/Library/Python/2.5/site-packages/PIL/_imaging.so: no matching  
architecture in universal wrapper
So this is as I suspected first.  But how is that as python is i386/ 
ppc and so is _imaging.so?

-- 
Arnaud


From jeffmess at gmail.com  Wed Nov  7 02:56:01 2007
From: jeffmess at gmail.com (Jeff van Aswegen)
Date: Wed Nov  7 02:56:07 2007
Subject: [mod_python] Form submission without reloading the page
Message-ID: <3ad7a1e40711062356h57a98ef8gfe82af4a8063ab1b@mail.gmail.com>

Hi there

Does anyone have any idea on how to submit a form without reloading
the page? I would like to take the information the user has placed in
the form,
throw it to a function which will insert into the database and then
clear the fields and set the focus back to the first field. Just need
to find out
how to submit forms without reloading. Any help would be great.

Thanks

Jeff
From oskar.blom at gmail.com  Wed Nov  7 03:07:37 2007
From: oskar.blom at gmail.com (Oskar Blom)
Date: Wed Nov  7 03:07:42 2007
Subject: [mod_python] Form submission without reloading the page
In-Reply-To: <3ad7a1e40711062356h57a98ef8gfe82af4a8063ab1b@mail.gmail.com>
References: <3ad7a1e40711062356h57a98ef8gfe82af4a8063ab1b@mail.gmail.com>
Message-ID: <af39cecf0711070007g592a3376i366527b1ec439acc@mail.gmail.com>

On Nov 7, 2007 8:56 AM, Jeff van Aswegen <jeffmess@gmail.com> wrote:
> Hi there
>
> Does anyone have any idea on how to submit a form without reloading
> the page? I would like to take the information the user has placed in
> the form,
> throw it to a function which will insert into the database and then
> clear the fields and set the focus back to the first field. Just need
> to find out
> how to submit forms without reloading. Any help would be great.
>
> Thanks
>
> Jeff
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>

You'll need to call the insert functionality (server side) through
javascript (client side). This can be accomplished with some sort of
AJAX technique. There are quite a few frameworks for that sort of
stuff. To get a general understanding, have a look at
http://www.w3schools.com/ajax/ajax_intro.asp
Hope that helps.

-- 
Oskar Blom
+46 703 79 32 32
From graham.dumpleton at gmail.com  Wed Nov  7 03:38:31 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Wed Nov  7 03:38:36 2007
Subject: [mod_python] PIL not working in mod_python on macosx 10.5
In-Reply-To: <4DF18420-25ED-4990-B531-9856A31509E7@blueyonder.co.uk>
References: <AFFA0D5D-114E-4F26-ADE6-A11F6875895C@blueyonder.co.uk>
	<88e286470711061659q28a18244m32be4e91d1f0fb45@mail.gmail.com>
	<4DF18420-25ED-4990-B531-9856A31509E7@blueyonder.co.uk>
Message-ID: <88e286470711070038m533387bdt87116624ff21496b@mail.gmail.com>

On 07/11/2007, Arnaud Delobelle <delobelle@blueyonder.co.uk> wrote:
>
> On 7 Nov 2007, at 00:59, Graham Dumpleton wrote:
> >
> [...]
> > Post here what is output to the Apache error log file.
>
>
> This is the tail of error_log:
>
>         File "/Users/arno/Sites/square.py", line 43, in <module>
>                 import _imaging
>
>         ImportError: dlopen(/Library/Python/2.5/site-packages/PIL/
> _imaging.so, 2): no suitable image found.  Did find:
>         /Library/Python/2.5/site-packages/PIL/_imaging.so: no matching
> architecture in universal wrapper
> So this is as I suspected first.  But how is that as python is i386/
> ppc and so is _imaging.so?

Both Python framework and httpd on Leopard are x86_64 capable. Quoting
from previous where this was already worked out:

[Macintosh:Library/Frameworks/Python.framework] benha% file Python
Python: Mach-O universal binary with 4 architectures
Python (for architecture ppc7400): Mach-O dynamically linked shared library ppc
Python (for architecture ppc64): Mach-O 64-bit dynamically linked
shared library ppc64
Python (for architecture i386): Mach-O dynamically linked shared library i386
Python (for architecture x86_64): Mach-O 64-bit dynamically linked
shared library x86_64

[Macintosh:~/Documents/Development] benha% file /usr/sbin/httpd
/usr/sbin/httpd: Mach-O universal binary with 4 architectures
/usr/sbin/httpd (for architecture ppc7400): Mach-O executable ppc
/usr/sbin/httpd (for architecture ppc64): Mach-O 64-bit executable ppc64
/usr/sbin/httpd (for architecture i386): Mach-O executable i386
/usr/sbin/httpd (for architecture x86_64): Mach-O 64-bit executable x86_64

So, if you CPU is 64 bit then all the libraries and loadable modules
must also be 64 bit capable as Apache will run as x86_64.

This would be irrespective of whether the 'python' program itself
isn't x86_64. Ie.,

marigold:~ arno$ file `which python`
/usr/bin/python: Mach-O universal binary with 2 architectures
/usr/bin/python (for architecture ppc7400):     Mach-O executable ppc
/usr/bin/python (for architecture i386):        Mach-O executable i386

You just need to rebuild PIL, modifying the makefiles as necessary to
ensure that it generates a full fat binary.

For the prior discussions, go to:

  http://www.modpython.org/pipermail/mod_python/2007-October/thread.html

and look for all the Leopard threads down near the end.

I do find it awfully strange that the Python framework is fully fat
and the 'python' program isn't. Apple seems to have screwed up various
things with Apache and Python. :-(

Graham
From delobelle at blueyonder.co.uk  Wed Nov  7 15:06:27 2007
From: delobelle at blueyonder.co.uk (Arnaud Delobelle)
Date: Wed Nov  7 15:02:28 2007
Subject: [mod_python] PIL not working in mod_python on macosx 10.5
In-Reply-To: <88e286470711070038m533387bdt87116624ff21496b@mail.gmail.com>
References: <AFFA0D5D-114E-4F26-ADE6-A11F6875895C@blueyonder.co.uk>
	<88e286470711061659q28a18244m32be4e91d1f0fb45@mail.gmail.com>
	<4DF18420-25ED-4990-B531-9856A31509E7@blueyonder.co.uk>
	<88e286470711070038m533387bdt87116624ff21496b@mail.gmail.com>
Message-ID: <F0919BD5-7FD1-42CF-9243-16A60FEF12BC@blueyonder.co.uk>


On 7 Nov 2007, at 08:38, Graham Dumpleton wrote:

> On 07/11/2007, Arnaud Delobelle <delobelle@blueyonder.co.uk> wrote:
>>
>> On 7 Nov 2007, at 00:59, Graham Dumpleton wrote:
>>>
>> [...]
>>> Post here what is output to the Apache error log file.
>>
>>
>> This is the tail of error_log:
>>
>>        File "/Users/arno/Sites/square.py", line 43, in <module>
>>                import _imaging
>>
>>        ImportError: dlopen(/Library/Python/2.5/site-packages/PIL/
>> _imaging.so, 2): no suitable image found.  Did find:
>>        /Library/Python/2.5/site-packages/PIL/_imaging.so: no matching
>> architecture in universal wrapper
>> So this is as I suspected first.  But how is that as python is i386/
>> ppc and so is _imaging.so?
>
> Both Python framework and httpd on Leopard are x86_64 capable. Quoting
> from previous where this was already worked out:
>

I didn't realise this thanks.

> You just need to rebuild PIL, modifying the makefiles as necessary to
> ensure that it generates a full fat binary.
>
OK I've done this and it works now.  There aren't any makefiles in  
PIL, it's all done through a setup.py script.  If anyone is  
insterested, I used the following awful hack: after the lines

from distutils import sysconfig
from distutils.core import Extension, setup
from distutils.command.build_ext import build_ext

add the following lines

OrigExtension = Extension
def Extension(*args, **kwargs):
     extra_args = ['-arch', 'ppc', '-arch', 'ppc64', '-arch', 'i386',  
'-arch', 'x86_64']
     kwargs['extra_compile_args'] = extra_args +  
kwargs.get('extra_args', [])
     kwargs['extra_link_args'] = extra_args +  
kwargs.get('extra_link_args', [])
     return OrigExtension(*args, **kwargs)


Then every extension built in the script is built for all 4  
architectures.
[...]
> I do find it awfully strange that the Python framework is fully fat
> and the 'python' program isn't. Apple seems to have screwed up various
> things with Apache and Python. :-(
>

Yes

> Graham
>

Thanks again for your feedback and advice, even though this problem is  
not related to mod_python in the end.

-- 
Arnaud


From delobelle at blueyonder.co.uk  Wed Nov  7 15:45:23 2007
From: delobelle at blueyonder.co.uk (Arnaud Delobelle)
Date: Wed Nov  7 15:41:21 2007
Subject: [mod_python] PIL not working in mod_python on macosx 10.5
In-Reply-To: <F0919BD5-7FD1-42CF-9243-16A60FEF12BC@blueyonder.co.uk>
References: <AFFA0D5D-114E-4F26-ADE6-A11F6875895C@blueyonder.co.uk>
	<88e286470711061659q28a18244m32be4e91d1f0fb45@mail.gmail.com>
	<4DF18420-25ED-4990-B531-9856A31509E7@blueyonder.co.uk>
	<88e286470711070038m533387bdt87116624ff21496b@mail.gmail.com>
	<F0919BD5-7FD1-42CF-9243-16A60FEF12BC@blueyonder.co.uk>
Message-ID: <C7E127C2-F0A9-4BB9-905F-A38BC22E673C@blueyonder.co.uk>


On 7 Nov 2007, at 20:06, Arnaud Delobelle wrote:
> OK I've done this and it works now.  There aren't any makefiles in  
> PIL, it's all done through a setup.py script.  If anyone is  
> insterested, I used the following awful hack: after the lines
>
> from distutils import sysconfig
> from distutils.core import Extension, setup
> from distutils.command.build_ext import build_ext
>
> add the following lines
>
> OrigExtension = Extension
> def Extension(*args, **kwargs):
>    extra_args = ['-arch', 'ppc', '-arch', 'ppc64', '-arch', 'i386',  
> '-arch', 'x86_64']
>    kwargs['extra_compile_args'] = extra_args +  
> kwargs.get('extra_args', [])
This should obviously read:
       kwargs['extra_compile_args'] = extra_args +  
kwargs.get('extra_compile_args', [])

>
>    kwargs['extra_link_args'] = extra_args +  
> kwargs.get('extra_link_args', [])
>    return OrigExtension(*args, **kwargs)
>

-- 
Arnaud


From matusis at yahoo.com  Wed Nov  7 16:23:28 2007
From: matusis at yahoo.com (Alec Matusis)
Date: Wed Nov  7 16:23:46 2007
Subject: [mod_python] mod_python or apache scalability?
In-Reply-To: <88e286470711062149w1244fb5fy587681ba1fc77114@mail.gmail.com>
References: <022001c8040b$31c20790$954616b0$@com>	
	<88e286470711040248l4a436c9awaa8bb1417e47e42a@mail.gmail.com>	
	<3315C807-972E-425D-8373-30E749A4AD68@xs4us.nu>	
	<03d601c81f23$c39c83b0$4ad58b10$@com>	
	<B6C73A5E30565245BB6D32B5F5DF7A52172AEF@sense.emmastraat.pijnacker>	
	<88e286470711051328p3528293dr2cee06b9f5c5ce0f@mail.gmail.com>	
	<074501c82053$25462eb0$6fd28c10$@com>	
	<88e286470711060352k68e8ed74l7065e450d71cc16@mail.gmail.com>	
	<006c01c820e7$da937450$8fba5cf0$@com>	
	<007701c820ef$eebcc3c0$cc364b40$@com>
	<88e286470711062149w1244fb5fy587681ba1fc77114@mail.gmail.com>
Message-ID: <030601c82184$70b1cf80$52156e80$@com>

I got it to work, thanks!

The performance gain is tremendous:

The 4GB machine now hasabout 3GB available RAM (1.5 free and 1.5 in
cache/buffers). With prefork, I managed to hit the swap (with ServerLimit
430).

Load average actually dropped from 2.5 with prefork to 1.2 with worker.

DB machine load average did not change.

I am glad we are using mod_python, because I believe mod_php for example
cannot be used with prefork.

Our problem was that we used sys.modules trying to reuse imported modules,
which was a bad idea with worker MPM.


> -----Original Message-----
> From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> Sent: Tuesday, November 06, 2007 9:49 PM
> To: Alec Matusis
> Cc: mod_python@modpython.org
> Subject: Re: [mod_python] mod_python or apache scalability?
> 
> On 07/11/2007, Alec Matusis <matusis@yahoo.com> wrote:
> > After I wrote this, I realized that the problem was in
> >
> > from sys import modules
> > def _import( module_path ):
> >      runme = modules[ module_path ]
> >
> > sys.modules was trying to use already loaded modules.
> > I got rid of it, and forced it to actually load modules every time,
> which
> > got rid of errors.
> > I wonder if forcing to load modules comes with a CPU penalty compared
> to
> > prefork however.
> 
> Can't tell. You still haven't showed how the modules are actually
> being imported.
> 
> Why aren't you just using apache.import_module() from mod_python? See:
> 
>   http://www.modpython.org/live/current/doc-html/pyapi-apmeth.html
> 
> Graham
> 
> > > -----Original Message-----
> > > From: mod_python-bounces@modpython.org [mailto:mod_python-
> > > bounces@modpython.org] On Behalf Of Alec Matusis
> > > Sent: Tuesday, November 06, 2007 6:43 PM
> > > To: 'Graham Dumpleton'
> > > Cc: mod_python@modpython.org
> > > Subject: RE: [mod_python] mod_python or apache scalability?
> > >
> > > > So, what is 'modules' and '_import' and how are they used?
> > >
> > > 'modules' is 'from sys import modules', so it's sys.modules...
> > >
> > > '_import' is used in the publisher like so:
> > >
> > > publisher.py:
> > >
> > > from common._import import _import
> > >
> > > def handler(req):
> > >     ...
> > >     dyn_path = req.uri[1:] #to get rid of '/' prefix
> > >     module_path = string.replace(dyn_path,'/','.')
> > >     runme = _import( module_path )
> > >     ....
> > >
> > >
> > > common/_import.py:
> > >
> > > from sys import modules
> > > def _import( module_path ):
> > >     runme = modules[ module_path ]
> > >     #get the last part
> > >     class_name = module_path.split('.')[-1]
> > >     try:
> > >         runme = getattr(runme, class_name ) <--- INTERMITTENT ERROR
> > > here
> > >     except AttributeError:
> > >         raise Exception,'Module does not contain class
> '+class_name+',
> > > runme='+repr(runme)+' module_path='+repr(module_path)
> > >
> > > > How do you
> > > > ensure that two concurrently executing request handlers trying to
> > > > import the same module don't interfere with each other?
> > >
> > > We do not insure that- the code was written for prefork MPM.
> > > What is the best way to insure that?
> > >
> > >
> > > > -----Original Message-----
> > > > From: Graham Dumpleton [mailto:graham.dumpleton@gmail.com]
> > > > Sent: Tuesday, November 06, 2007 3:53 AM
> > > > To: Alec Matusis
> > > > Cc: Martijn Moeling; mod_python@modpython.org
> > > > Subject: Re: [mod_python] mod_python or apache scalability?
> > > >
> > > > On 06/11/2007, Alec Matusis <matusis@yahoo.com> wrote:
> > > > > I found that this that
> > > > >
> > > > > IOError: image file is truncated (14432 bytes not processed)
> > > > >
> > > > > has to do with using input filter
> > > > >
> > > > > PythonInputFilter flashfilter FLASHFILTER
> > > > > SetInputFilter FLASHFILTER
> > > > >
> > > > > It somehow behaves differently in apache 2.2.6/mod_python 3.3.1
> > > > versus
> > > > > 2.0.54/ 3.1.4. For now, I removed this input filter (we can get
> > > away
> > > > without
> > > > > it), and it seems to work.
> > > > >
> > > > > However, we have a bigger problem: we now have intermittent
> import
> > > > errors
> > > > > (one error per about 50-80 requests).
> > > > >
> > > > > This code executed by publisher:
> > > > >
> > > > > import modules
> > > > > def _import( module_path ):
> > > > >     runme = modules[ module_path ]
> > > > >     #get the last part
> > > > >     class_name = module_path.split('.')[-1]
> > > > >     try:
> > > > >         runme = getattr(runme, class_name ) <--- INTERMITTENT
> ERROR
> > > > here
> > > > >     except AttributeError:
> > > > >         raise Exception,'Module does not contain class
> > > > '+class_name+',
> > > > > runme='+repr(runme)+' module_path='+repr(module_path)
> > > > >
> > > > > produces this error:
> > > > >
> > > > > Exception: Module does not contain class getprofile,
> runme=<module
> > > > > 'getprofile' from '/path/scripts/getprofile.py'>
> > > > module_path='getprofile'
> > > > >
> > > > > This used to always work with prefork. Is there anything not
> thread
> > > > safe
> > > > > about importing modules?
> > > >
> > > > The underlying Python and mod_python import mechanisms themselves
> are
> > > > never usually the problem. It is thread unsafe practices
> regarding
> > > > initialisation in the code around the imports.
> > > >
> > > > So, if you have built your own form of module importer or higher
> > > level
> > > > layer for one and you haven't properly thread protected it, it is
> > > most
> > > > likely the cause.
> > > >
> > > > So, what is 'modules' and '_import' and how are they used? How do
> you
> > > > ensure that two concurrently executing request handlers trying to
> > > > import the same module don't interfere with each other?
> > > >
> > > > Graham
> > > >
> > > > > > -----Original Message-----
> > > > > > From: mod_python-bounces@modpython.org [mailto:mod_python-
> > > > > > bounces@modpython.org] On Behalf Of Graham Dumpleton
> > > > > > Sent: Monday, November 05, 2007 1:29 PM
> > > > > > To: Martijn Moeling
> > > > > > Cc: mod_python@modpython.org; Alec Matusis
> > > > > > Subject: Re: [mod_python] mod_python or apache scalability?
> > > > > >
> > > > > > The LimitRequestBody directive support in mod_python is
> broken
> > > and
> > > > > > most likely would have resulted in a 500 error occurring
> during
> > > > > > mod_python.publisher processing of the form even before the
> user
> > > > code
> > > > > > was run.
> > > > > >
> > > > > > My guess at the reason is that they have enabled in the new
> > > Apache
> > > > > > server compression on request content. This may not work with
> > > > > > mod_python because how it reads request content is broken,
> with
> > > it
> > > > > > only reading up until original Content-Length in certain
> cases.
> > > If
> > > > > > there is a mutating input filter such as content
> decompression,
> > > you
> > > > > > will get truncated input data.
> > > > > >
> > > > > > https://issues.apache.org/jira/browse/MODPYTHON-240
> > > > > > https://issues.apache.org/jira/browse/MODPYTHON-212
> > > > > >
> > > > > > So, OP should ensure that directives to accept compressed
> request
> > > > > > content are disabled.
> > > > > >
> > > > > > Graham
> > > > > >
> > > > > > On 05/11/2007, Martijn Moeling <martijn@xs4us.nu> wrote:
> > > > > > >
> > > > > > >
> > > > > > >
> > > > > > > Hmm it looks to me that you have an upload limit in your
> apache
> > > > > > config.
> > > > > > >
> > > > > > > It might be the LimitRequestBody directive.
> > > > > > >
> > > > > > > Another thing might be that your processing is faster than
> the
> > > > data
> > > > > > comes
> > > > > > > in, but I doubt that
> > > > > > > Take a close look at you apache conf, and your apache error
> log
> > > > > > (right after
> > > > > > > an upload or with tail -f /var/log/httpd/error_log (or
> where
> > > ever
> > > > > > your
> > > > > > > logdir is)).
> > > > > > >
> > > > > > > Martijn
> > > > > > >
> > > > > > >
> > > > > > >  ________________________________
> > > > > > >  Van: Alec Matusis [mailto:matusis@matusis.com]
> > > > > > > Verzonden: zo 04.11.2007 21:46
> > > > > > > Aan: Martijn Moeling
> > > > > > > CC: mod_python@modpython.org
> > > > > > > Onderwerp: RE: [mod_python] mod_python or apache
> scalability?
> > > > > > >
> > > > > > >
> > > > > > >
> > > > > > >
> > > > > > > > I had similair problems however, they turned out to be
> > > MySQLdb
> > > > > > > > related and not in a way you suspect
> > > > > > >
> > > > > > > Thanks! I will try separating MySQLdb connections. We do
> pass
> > > the
> > > > > > connection
> > > > > > > around currently.
> > > > > > >
> > > > > > > However, how would you explain this PIL error:
> > > > > > >
> > > > > > >     File "/path/publisher/publisher.py", line 78, in
> handler
> > > > > > >  flow_instance.dispatch()
> > > > > > >  File "/path/scripts/updateprofile.py", line 92, in
> > > > > > > dispatch
> > > > > > >  im.save(full, self.im_format)
> > > > > > >     File
> > > > > > > "/usr/local/encap/Python-2.4.1/lib/python2.4/site-
> > > > > > packages/PIL/Image.py",
> > > > > > > line 1272, in save
> > > > > > >
> > > > > > >  File
> > > > > > > "/usr/local/encap/Python-2.4.1/lib/python2.4/site-
> > > > > > packages/PIL/ImageFile.py"
> > > > > > > , line 192, in load
> > > > > > >  IOError: image file is truncated (14432 bytes not
> processed)
> > > > > > >
> > > > > > > This only happened for large images, small ones uploaded
> fine.
> > > > > > > The code is
> > > > > > >
> > > > > > > def dispatch(self):
> > > > > > >     pix = self.form['Filedata']
> > > > > > >     try:
> > > > > > >         im = Image.open(pix.file)
> > > > > > >     except IOError:
> > > > > > >         self.req.status = apache.HTTP_NOT_ACCEPTABLE
> > > > > > >     im.save(full, self.im_format)
> > > > > > >
> > > > > > > The error is in the last line. It did not occur with
> prefork.
> > > > > > >
> > > > > > >
> > > > > > >
> > > > > > >
> > > > > > >
> > > > > > > > -----Original Message-----
> > > > > > > > From: mod_python-bounces@modpython.org
> > > > > > > [mailto:mod_python-
> > > > > > > > bounces@modpython.org] On Behalf Of Martijn Moeling
> > > > > > > > Sent: Sunday, November 04, 2007 5:16 AM
> > > > > > > > To: Graham Dumpleton
> > > > > > > > Cc: mod_python@modpython.org; Alec Matusis
> > > > > > >
> > > > > > > > Subject: Re: [mod_python] mod_python or apache
> scalability?
> > > > > > > >
> > > > > > > > hi,
> > > > > > > >
> > > > > > > > I use Pil without any problems, a I do with MySQLdb.
> > > > > > > >
> > > > > > > > I had similair problems however, they turned out to be
> > > MySQLdb
> > > > > > > > related and not in a way you suspect
> > > > > > > >
> > > > > > > > Never ever use a global database connection variable.
> Create
> > > > the
> > > > > > > > database connection within your handler,
> > > > > > > > end register a cleanup for closing it. I fixed a lot of
> > > trouble
> > > > by
> > > > > > > > altering my system by making all "global" stuff a method
> or
> > > > > > property
> > > > > > > > of the req object.
> > > > > > > >
> > > > > > > > The cleanup procedure cleans all objects which do
> anything to
> > > > 3rd
> > > > > > > > party external (net connected) stuff (like imap, MySQL)
> > > > > > > >
> > > > > > > >
> > > > > > > > think of something like this:
> > > > > > > >
> > > > > > > >
> > > > > > > > def handler_cleanup(req):
> > > > > > > >       req.db.cursor.close()
> > > > > > > >       req.db.close()
> > > > > > > >
> > > > > > > > Def handler (req):
> > > > > > > >       req.db=MySQLdb.connection(...........)
> > > > > > > >       req.cursor=req.db.cursor(...)
> > > > > > > >
> > > > > > > >       ....
> > > > > > > >       ....
> > > > > > > >       ....
> > > > > > > >       req.register_cleanup(handler_cleanup,req)
> > > > > > > >       return apache.OK
> > > > > > > >
> > > > > > > > All my application specific code are classes, and
> instantated
> > > > as a
> > > > > > > > req.something and req is passed to all functions, which
> is
> > > neat
> > > > > > since
> > > > > > > > it is passed by reference meaning stacks stay small to
> > > > > > > >
> > > > > > > > If you use MySQLdb with mod_python use the above method,
> my
> > > > > > > > production server is rock stable and handled over 1mln
> > > requests
> > > > > > since
> > > > > > > > last december without any reboots or problems.
> > > > > > > >
> > > > > > > > Martijn
> > > > > > > >
> > > > > > > > On Nov 4, 2007, at 11:48 AM, Graham Dumpleton wrote:
> > > > > > > >
> > > > > > > > > Hmmm, I do remember vaguely hearing questions about PIL
> > > > thread
> > > > > > safety
> > > > > > > > > before, so it might be an issue. :-(
> > > > > > > > >
> > > > > > > > > Graham
> > > > > > > > >
> > > > > > > > > On 04/11/2007, Alec Matusis <matusis@matusis.com>
> wrote:
> > > > > > > > >>> BTW, are you still using mod_python 3.1.4?
> > > > > > > > >>
> > > > > > > > >> No, we went to apache 2.2.6/ mod_python 3.3.1
> combination.
> > > > > > > > >>
> > > > > > > > >> I will get MySQLdb to work thread-safely, but with PIL
> I
> > > am
> > > > not
> > > > > > so
> > > > > > > > >> optimistic...
> > > > > > > > >>
> > > > > > > > >>> -----Original Message-----
> > > > > > > > >>> From: Graham Dumpleton
> > > > > > > [mailto:graham.dumpleton@gmail.com]
> > > > > > > > >>> Sent: Sunday, November 04, 2007 2:33 AM
> > > > > > > > >>> To: Alec Matusis
> > > > > > > > >>> Cc: mod_python@modpython.org
> > > > > > > > >>> Subject: Re: [mod_python] mod_python or apache
> > > scalability?
> > > > > > > > >>>
> > > > > > > > >>> BTW, are you still using mod_python 3.1.4? Older
> > > mod_python
> > > > > > > > versions
> > > > > > > > >>> have various bugs and you would be much better
> upgrading
> > > to
> > > > > > 3.3.1
> > > > > > > > if
> > > > > > > > >>> you haven't already.
> > > > > > > > >>>
> > > > > > > > >>> Graham
> > > > > > > > >>>
> > > > > > > > >>> On 04/11/2007, Alec Matusis <matusis@matusis.com>
> wrote:
> > > > > > > > >>>>> Which indicates that some third party package you
> are
> > > > using
> > > > > > is
> > > > > > > > not
> > > > > > > > >>>>> thread safe. This can occur if you are also using
> PHP
> > > as
> > > > > > > > >>>>> various of
> > > > > > > > >>>>> its third party packages are not thread safe.
> > > > > > > > >>>>
> > > > > > > > >>>> We are not using PHP, only python with mod_python.
> > > > > > > > >>>> The only third party packages we use are MySQLdb
> adapter
> > > > and
> > > > > > PIL
> > > > > > > > >>> image
> > > > > > > > >>>> library.
> > > > > > > > >>>>
> > > > > > > > >>>> So I guess both PIL and MySQLdb have these problems.
> > > > > > > > >>>>
> > > > > > > > >>>>
> > > > > > > > >>>>> -----Original Message-----
> > > > > > > > >>>>> From: Graham Dumpleton
> > > > > > > [mailto:graham.dumpleton@gmail.com]
> > > > > > > > >>>>> Sent: Sunday, November 04, 2007 2:15 AM
> > > > > > > > >>>>> To: Alec Matusis
> > > > > > > > >>>>> Cc: mod_python@modpython.org
> > > > > > > > >>>>> Subject: Re: [mod_python] mod_python or apache
> > > > scalability?
> > > > > > > > >>>>>
> > > > > > > > >>>>> On 04/11/2007, Alec Matusis <matusis@matusis.com>
> > > wrote:
> > > > > > > > >>>>>>> FWIW, I personally would try and move from
> prefork to
> > > > > > worker
> > > > > > > > >>> MPM as
> > > > > > > > >>>>>>> the number of Apache child processes you are
> running
> > > > with
> > > > > > is to
> > > > > > > > >>> my
> > > > > > > > >>>>>>> mind excessive. Using worker would certainly drop
> > > > memory
> > > > > > usage
> > > > > > > > >>> for
> > > > > > > > >>>>> a
> > > > > > > > >>>>>>> start as you wouldn't need as many child
> processes to
> > > > be
> > > > > > > > >>> started.
> > > > > > > > >>>>>>
> > > > > > > > >>>>>> I am just following up on this, since we tried
> worker
> > > > MPM
> > > > > > this
> > > > > > > > >>>>> weekend.
> > > > > > > > >>>>>> On our dev/stage it worked perfectly.
> > > > > > > > >>>>>> On live, worker MPM freed up about 2GB of memory
> > > > compared to
> > > > > > > > >>> prefork.
> > > > > > > > >>>>>> However, on live, it turned out to be unstable.
> > > > > > > > >>>>>> This is what we say in the main error log:
> > > > > > > > >>>>>>
> > > > > > > > >>>>>> [Sun Nov 04 01:37:45 2007] [notice] child pid
> 20347
> > > exit
> > > > > > signal
> > > > > > > > >>>>> Segmentation
> > > > > > > > >>>>>> fault (11)
> > > > > > > > >>>>>> [Sun Nov 04 01:37:45 2007] [notice] child pid
> 20460
> > > exit
> > > > > > signal
> > > > > > > > >>>>> Aborted (6)
> > > > > > > > >>>>>> [Sun Nov 04 01:37:45 2007] [notice] child pid
> 20515
> > > exit
> > > > > > signal
> > > > > > > > >>>>> Segmentation
> > > > > > > > >>>>>> fault (11)
> > > > > > > > >>>>>> *** glibc detected *** double free or corruption
> > > > (!prev):
> > > > > > > > >>>>> 0x0000000000762c50
> > > > > > > > >>>>>> ***
> > > > > > > > >>>>>> *** glibc detected *** double free or corruption
> > > > (!prev):
> > > > > > > > >>>>> 0x000000000075d100
> > > > > > > > >>>>>> ***
> > > > > > > > >>>>>> [Sun Nov 04 01:37:46 2007] [notice] child pid
> 20152
> > > exit
> > > > > > signal
> > > > > > > > >>>>> Segmentation
> > > > > > > > >>>>>> fault (11)
> > > > > > > > >>>>>>
> > > > > > > > >>>>>> In the application log, we saw two types of
> errors:
> > > > > > > > >>>>>>
> > > > > > > > >>>>>> MySQLError: Connection to database failed
> > > > > > > > >>>>>> OperationalError: (2006, 'MySQL server has gone
> away')
> > > > > > > > >>>>>>
> > > > > > > > >>>>>> and
> > > > > > > > >>>>>>
> > > > > > > > >>>>>> IOError: image file is truncated (44 bytes not
> > > > processed)
> > > > > > > > >>>>>>
> > > > > > > > >>>>>> The first type has to do with MySQLdb module, but
> the
> > > > second
> > > > > > one
> > > > > > > > >>>>> occurred
> > > > > > > > >>>>>> when large images were uploaded.
> > > > > > > > >>>>>
> > > > > > > > >>>>> Which indicates that some third party package you
> are
> > > > using
> > > > > > is
> > > > > > > > not
> > > > > > > > >>>>> thread safe. This can occur if you are also using
> PHP
> > > as
> > > > > > > > >>>>> various of
> > > > > > > > >>>>> its third party packages are not thread safe. Also
> > > ensure
> > > > > > that
> > > > > > > > you
> > > > > > > > >>> are
> > > > > > > > >>>>> using the latest available Python database adapters
> and
> > > > that
> > > > > > they
> > > > > > > > >>> are
> > > > > > > > >>>>> compiled against thread safe reentrant libraries.
> > > > > > > > >>>>>
> > > > > > > > >>>>> Graham
> > > > > > > > >>>>>
> > > > > > > > >>>>>> We had to revert to prefork as a result of this.
> > > > > > > > >>>>>>
> > > > > > > > >>>>>> On another note, I managed to empirically find the
> > > > maximum
> > > > > > > > >>>>> ServerLimit for
> > > > > > > > >>>>>> prefork, before the machine dies from swapping.
> > > > > > > > >>>>>> It is 380 with 4GB RAM.
> > > > > > > > >>>>>>
> > > > > > > > >>>>>>> -----Original Message-----
> > > > > > > > >>>>>>> From: Graham Dumpleton
> > > > > > > [mailto:graham.dumpleton@gmail.com]
> > > > > > > > >>>>>>> Sent: Monday, October 01, 2007 6:47 PM
> > > > > > > > >>>>>>> To: Alec Matusis
> > > > > > > > >>>>>>> Cc: mod_python@modpython.org
> > > > > > > > >>>>>>> Subject: Re: [mod_python] mod_python or apache
> > > > scalability?
> > > > > > > > >>>>>>>
> > > > > > > > >>>>>>> On 01/10/2007, Alec Matusis <matusis@matusis.com>
> > > > wrote:
> > > > > > > > >>>>>>>> in the apache error log. We also got
> > > > > > > > >>>>>>>>
> > > > > > > > >>>>>>>> kernel: possible SYN flooding on port 80.
> Sending
> > > > cookies.
> > > > > > > > >>>>>>>>
> > > > > > > > >>>>>>>> in /var/log/messages system log.
> > > > > > > > >>>>>>>
> > > > > > > > >>>>>>> Have you determined for certain that you aren't
> the
> > > > target
> > > > > > of
> > > > > > > > >>> an
> > > > > > > > >>>>>>> external SYN Flood DOS attack?
> > > > > > > > >>>>>>>
> > > > > > > > >>>>>>> Do a Google search for 'kernel: possible SYN
> flooding
> > > > on
> > > > > > port
> > > > > > > > >>> 80.
> > > > > > > > >>>>>>> Sending cookies' and you will find lots of stuff
> to
> > > > read.
> > > > > > Your
> > > > > > > > >>>>> running
> > > > > > > > >>>>>>> out of or having a large number of socket
> connections
> > > > may
> > > > > > be
> > > > > > > > >>>>>>> symptomatic of a large number of half open
> > > connections
> > > > > > being
> > > > > > > > >>>>> created
> > > > > > > > >>>>>>> and then being left in TIME_WAIT. Thus perhaps do
> > > some
> > > > > > better
> > > > > > > > >>>>> analysis
> > > > > > > > >>>>>>> of socket connection states using netstat. If not
> a
> > > SYN
> > > > > > Flood,
> > > > > > > > >>> then
> > > > > > > > >>>>>>> possibly follow some of the other suggestions in
> the
> > > > pages
> > > > > > you
> > > > > > > > >>> will
> > > > > > > > >>>>>>> find when you do the search.
> > > > > > > > >>>>>>>
> > > > > > > > >>>>>>> FWIW, I personally would try and move from
> prefork to
> > > > > > worker
> > > > > > > > >>> MPM as
> > > > > > > > >>>>>>> the number of Apache child processes you are
> running
> > > > with
> > > > > > is to
> > > > > > > > >>> my
> > > > > > > > >>>>>>> mind excessive. Using worker would certainly drop
> > > > memory
> > > > > > usage
> > > > > > > > >>> for
> > > > > > > > >>>>> a
> > > > > > > > >>>>>>> start as you wouldn't need as many child
> processes to
> > > > be
> > > > > > > > >>> started. I
> > > > > > > > >>>>>>> wouldn't be concerned about running out of
> threads as
> > > > when
> > > > > > > > >>> running
> > > > > > > > >>>>>>> worker I wouldn't suggest more than 25 threads
> per
> > > > process
> > > > > > as a
> > > > > > > > >>>>>>> starting point anyway. If your mod_python
> application
> > > > was
> > > > > > > > >>> creating
> > > > > > > > >>>>>>> lots of threads, you are likely to hit the thread
> > > limit
> > > > > > with
> > > > > > > > >>>>> prefork
> > > > > > > > >>>>>>> and not just worker so which MPM is used
> shouldn't be
> > > > an
> > > > > > issue
> > > > > > > > >>> in
> > > > > > > > >>>>> that
> > > > > > > > >>>>>>> case.
> > > > > > > > >>>>>>>
> > > > > > > > >>>>>>> BTW, what operating system are you using?
> > > > > > > > >>>>>>>
> > > > > > > > >>>>>>> Graham
> > > > > > > > >>>>>>
> > > > > > > > >>>>>>
> > > > > > > > >>>>
> > > > > > > > >>>>
> > > > > > > > >>
> > > > > > > > >>
> > > > > > > > > _______________________________________________
> > > > > > > > > Mod_python mailing list
> > > > > > > > > Mod_python@modpython.org
> > > > > > > > >
> > > > > > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > > > > > > >
> > > > > > > > _______________________________________________
> > > > > > > > Mod_python mailing list
> > > > > > > > Mod_python@modpython.org
> > > > > > > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > > > > > >
> > > > > > >
> > > > > > >
> > > > > > >
> > > > > > > _______________________________________________
> > > > > > > Mod_python mailing list
> > > > > > > Mod_python@modpython.org
> > > > > > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > > > > > >
> > > > > > >
> > > > > > _______________________________________________
> > > > > > Mod_python mailing list
> > > > > > Mod_python@modpython.org
> > > > > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > > > >
> > > > >
> > >
> > > _______________________________________________
> > > Mod_python mailing list
> > > Mod_python@modpython.org
> > > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
> >

From paul at orbitalconsulting.com.au  Wed Nov  7 22:50:53 2007
From: paul at orbitalconsulting.com.au (Paul Hutton)
Date: Wed Nov  7 22:51:04 2007
Subject: [mod_python] setting up mod_python
Message-ID: <23377ED966B97642BD4EBCDA2A9B5CFE6006@otter.blueskies.ws>

Hi,

 

I have just set up mod_python and although the mpinfo testhandler is
working correctly I do not get the correct result when performing the
mptest.py test. I get the actual code displayed in the browser which
makes me think that there is an application type missing or something.
Can someone please confirm this?

 

Thanks and best regards,

 

Paul Hutton

Managing Director

Orbital Consulting Pty Ltd

 

a: 37 Cromer Road, Cromer, NSW 2099

t:  +61 2 8003 5336

m: +61 410 406 459

f:   +61 2 9972 7729

e: paul@orbitalconsulting.com.au <mailto:paul@orbitalconsulting.com.au> 

 

Orbital Consulting..... revolving around the world of IT

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20071108/82a80d25/attachment.html
From graham.dumpleton at gmail.com  Wed Nov  7 23:02:26 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Wed Nov  7 23:02:34 2007
Subject: [mod_python] setting up mod_python
In-Reply-To: <23377ED966B97642BD4EBCDA2A9B5CFE6006@otter.blueskies.ws>
References: <23377ED966B97642BD4EBCDA2A9B5CFE6006@otter.blueskies.ws>
Message-ID: <88e286470711072002t3010e78bw77af385a5b077dbe@mail.gmail.com>

Try with instructions:

http://www.dscpl.com.au/wiki/ModPython/Articles/GettingModPythonWorking

These explain things a bit better.

If that doesn't work, you will need to be more specific about what you
have done in your configuration and where.

Graham

On 08/11/2007, Paul Hutton <paul@orbitalconsulting.com.au> wrote:
>
>
>
>
> Hi,
>
>
>
> I have just set up mod_python and although the mpinfo testhandler is working
> correctly I do not get the correct result when performing the mptest.py
> test. I get the actual code displayed in the browser which makes me think
> that there is an application type missing or something. Can someone please
> confirm this?
>
>
>
> Thanks and best regards,
>
>
>
> Paul Hutton
>
> Managing Director
>
> Orbital Consulting Pty Ltd
>
>
>
> a: 37 Cromer Road, Cromer, NSW 2099
>
> t:  +61 2 8003 5336
>
> m: +61 410 406 459
>
> f:   +61 2 9972 7729
>
> e: paul@orbitalconsulting.com.au
>
>
>
> Orbital Consulting..... revolving around the world of IT
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
From jeffmess at gmail.com  Thu Nov  8 09:41:37 2007
From: jeffmess at gmail.com (Jeff van Aswegen)
Date: Thu Nov  8 09:41:44 2007
Subject: [mod_python] Re: Mod_python Digest, Vol 56, Issue 10
In-Reply-To: <200711071700.lA7H0EpY030618@modpython.org>
References: <200711071700.lA7H0EpY030618@modpython.org>
Message-ID: <3ad7a1e40711080641k5756e40aydeecdaaf3df8f2b1@mail.gmail.com>

Hi Guys

I sent an e-mail yesterday regarding submitting a form without
reloading the page. I've been looking into
xmlhttprequest and I have written a small app which works fine with
PHP but I am struggling to get it working
with mod_python. Here is a simplified version of what I have so far.

req.write("""
	<form name="form">
	<input type="text" name="news_title" id="news_title">
	<input type="text" name="news_content" id="news_content">
	<a onclick="javascript:ajaxform('index.py/somefunction', 'form',
'content');" style="cursor: pointer;">Submit</a>
	</form>

	<div id="content">

	</div>
""")

I'm not going to place my javascript here unless you need it for some
reason. Basically it creates an xmlhttp instance
and sends it with the following.

http_request.open('GET', url, true);

My PHP code which does what I want for the time being is.

<?php
echo '<pre>';
print_r($_REQUEST);
echo '</pre>';
?>

All I want is to basically take the PHP code and get it working in
mod_python. I can then take the data and process it in the
background while the user can redo the form. So I also want to avoid
mod_python.util.redirect() as I don't want the page
to reload.

The problem is I cannot find the equivalent function of $_REQUEST
under mod_python - if there even is one. I would appreciate any
help or if someone can possibly point e in the right direction.
From pavpanchekha at gmail.com  Thu Nov  8 13:11:29 2007
From: pavpanchekha at gmail.com (Pavel Panchekha)
Date: Thu Nov  8 13:11:35 2007
Subject: [mod_python] linking to css from publisher
Message-ID: <51b824cd0711081011o3cb8d612ubdd66d882d60acae@mail.gmail.com>

I'm writing a site in mod_python publisher. However, I have a slight
problem. I have a separate folder for css files: resources/styles. When I
request index.py, it outputs a psp template that links to the said css file.
So far, so good. But when I submit a form to index.py/add, the same template
links again to resources/styles, which the browser interprets as
index.py/resources/styles,
which does not exist.

How do I go about fixing this? Is there any rewrite rule that would allow
this (I've tried, but maybe there is such a rule)? Should I switch to psp
(ouch)? Is there any magic command?\

I have Apache/2.2.4 (Ubuntu) mod_python/3.3.1 Python/2.5.1
The current .htaccess

AddHandler mod_python .py
PythonHandler mod_python.publisher
PythonDebug On

DirectoryIndex index.py index.html

-- 
 -  Pavel Panchekha
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20071108/879d948a/attachment.html
From list at joreybump.com  Thu Nov  8 13:36:12 2007
From: list at joreybump.com (Jorey Bump)
Date: Thu Nov  8 13:36:23 2007
Subject: [mod_python] linking to css from publisher
In-Reply-To: <51b824cd0711081011o3cb8d612ubdd66d882d60acae@mail.gmail.com>
References: <51b824cd0711081011o3cb8d612ubdd66d882d60acae@mail.gmail.com>
Message-ID: <4733571C.5060509@joreybump.com>

Pavel Panchekha wrote, at 11/08/2007 01:11 PM:
> I'm writing a site in mod_python publisher. However, I have a slight 
> problem. I have a separate folder for css files: resources/styles. When 
> I request index.py, it outputs a psp template that links to the said css 
> file. So far, so good. But when I submit a form to index.py/add, the 
> same template links again to resources/styles, which the browser 
> interprets as index.py/resources/styles, which does not exist.
> 
> How do I go about fixing this? 

Use an absolute path from the site root:

  <link rel="stylesheet" type="text/css" 
href="/resources/styles/main.css" />

From davidjanes at blogmatrix.com  Fri Nov  9 08:53:56 2007
From: davidjanes at blogmatrix.com (David Janes)
Date: Fri Nov  9 08:56:41 2007
Subject: [mod_python] Session.py: filesession_cleanup (I)
Message-ID: <21e523c20711090553g6f14ea6aocf8322d210d26f74@mail.gmail.com>

I'm getting random hangs on a mod_python based system under moderately load.
I haven't tracked down the problem yet, but based on some error logging I've
been doing code inspection and have a few comments/questions.

(1)
In Session.py, function filesession_cleanup, lines 624-638 there's a
try/except block that returns on an exception. However, to get to this
block, 'lockfp' has to be open -- and there is no close in the exception
block.

Should not this code block be moved inside the next try/finally block which
ensures the file object is closed?

(2)
In my logs I am getting the error message

python_cleanup: Error calling cleanup object <function filesession_cleanup
at 0xb7b22924>
exceptions.TypeError: not enough arguments for format string

The likely culprit for this error is line 705 (-707):

            req.log_error("FileSession cleanup incomplete: next cleanup will
start at index %d (%02x)"
                        % (next_i,),
                        apache.APLOG_NOTICE)

Does this make sense?

Regards, etc...
David

-- 
David Janes
Founder, BlogMatrix
http://www.blogmatrix.com
http://blogmatrix.blogmatrix.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20071109/64dcad5d/attachment.html
From jpg at jgassociates.ca  Fri Nov  9 09:29:05 2007
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Fri Nov  9 09:28:41 2007
Subject: [mod_python] Session.py: filesession_cleanup (I)
In-Reply-To: <21e523c20711090553g6f14ea6aocf8322d210d26f74@mail.gmail.com>
References: <21e523c20711090553g6f14ea6aocf8322d210d26f74@mail.gmail.com>
Message-ID: <47346EB1.8040809@jgassociates.ca>

David Janes wrote:
> I'm getting random hangs on a mod_python based system under moderately 
> load. I haven't tracked down the problem yet, but based on some error 
> logging I've been doing code inspection and have a few comments/questions.
> 
> (1)
> In Session.py, function filesession_cleanup, lines 624-638 there's a 
> try/except block that returns on an exception. However, to get to this 
> block, 'lockfp' has to be open -- and there is no close in the exception 
> block.
> 
> Should not this code block be moved inside the next try/finally block 
> which ensures the file object is closed?

I don't have time to review the code right now. I'll look at it later today.

> (2)
> In my logs I am getting the error message
> 
> python_cleanup: Error calling cleanup object <function 
> filesession_cleanup at 0xb7b22924>
> exceptions.TypeError: not enough arguments for format string
> 
> The likely culprit for this error is line 705 (-707):
> 
>             req.log_error("FileSession cleanup incomplete: next cleanup 
> will start at index %d (%02x)"
>                         % (next_i,),
>                         apache.APLOG_NOTICE)
> 
> Does this make sense?

No, and I don't know how this slipped through my testing when I wrote 
this code. :(

It should read:

req.log_error("FileSession cleanup incomplete: next cleanup will start 
at index %d (%02x)"
                         % (next_i, next_i),
                         apache.APLOG_NOTICE)

Jim
From jpg at jgassociates.ca  Fri Nov  9 16:21:59 2007
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Fri Nov  9 16:18:29 2007
Subject: [mod_python] Session.py: filesession_cleanup (I)
In-Reply-To: <21e523c20711090553g6f14ea6aocf8322d210d26f74@mail.gmail.com>
References: <21e523c20711090553g6f14ea6aocf8322d210d26f74@mail.gmail.com>
Message-ID: <4734CF77.4070301@jgassociates.ca>

David Janes wrote:
> I'm getting random hangs on a mod_python based system under moderately 
> load. I haven't tracked down the problem yet, but based on some error 
> logging I've been doing code inspection and have a few comments/questions.
> 
> (1)
> In Session.py, function filesession_cleanup, lines 624-638 there's a 
> try/except block that returns on an exception. However, to get to this 
> block, 'lockfp' has to be open -- and there is no close in the exception 
> block.
> 
> Should not this code block be moved inside the next try/finally block 
> which ensures the file object is closed?

I think it's ok as written. The purpose of the lockfile is to make sure 
that another process is not already running the cleanup.

lockfp = os.open(lockfile, os.O_CREAT | os.O_EXCL | os.O_WRONLY, 0660)

The lockfile is being opened with the os.O_EXCL flag, so if another 
process has the file open *this* process will fail to open the file and 
raise an exception.

I can see why there might be some confusion though as the try/except 
block is doing double duty - making sure another cleanup is not already 
running *and* removing a potentially stale lockfile. Short circuiting 
the cleanup in the case of a stale lock file here (with the return) is 
not really that big of a deal. It's not imperative that we run the 
cleanup *right now*, just so long as the cleanup happens in the near 
future where "near" is a pretty fuzzy number.

> (2)
> In my logs I am getting the error message
> 
> python_cleanup: Error calling cleanup object <function 
> filesession_cleanup at 0xb7b22924>
> exceptions.TypeError: not enough arguments for format string
> 
> The likely culprit for this error is line 705 (-707):
> 
>             req.log_error("FileSession cleanup incomplete: next cleanup 
> will start at index %d (%02x)"
>                         % (next_i,),
>                         apache.APLOG_NOTICE)
> 
> Does this make sense?

As I previously noted that one is a bug and should read:

req.log_error("FileSession cleanup incomplete: next cleanup will start 
at index %d (%02x)"
                         % (next_i, next_i),
                         apache.APLOG_NOTICE)



I'll fix it in svn.

Just out of curiosity how many session objects do you figure you have?

Jim
From pwhbeck at gmail.com  Fri Nov  9 21:25:38 2007
From: pwhbeck at gmail.com (Peter Hollenbeck)
Date: Fri Nov  9 21:25:45 2007
Subject: [mod_python] [SPAM] URL returned by test.py
Message-ID: <255b859d0711091825g20506f11s4dbe595f69822875@mail.gmail.com>

Apache root is /srv/www/htdocs

I open http://localhost/test.html
Test.html calls test.py
Test.py returns an html page with a link to an image in
/srv/www/htdocs/pics/1998/...
But the link displayed in the browser is
    http://localhost/test/test.py/pics/1998/...
not
    http://localhost/pics/1998/...

Can anyone tell me why this is?
What can I do to get the link without "/test/test.py"

Thanks very much,
Peter Hollenbeck


SUSE 10.2 Linux
Apache 2.2.4
mod_python 3.3.1 (I think)

/srv/www/htdocs/test.html:
      <html>
      <p>
      mod_python test
      <p>
      <form action="test/test.py/test" method="POST">
          <input type="submit">
      </form>
      </html>

/srv/www/htdocs/test/test.py
def test():
    link = '<a href="pics/1998/9804/bcsi/98042118.jpg"><img
src="pics/1998/9804/bcsi/98042118tn.jpg">Logging road</a>'

    htmlpage = '<html><body>'+link+'</body></html>'
    rc = """$"""
    rc = rc.replace('$', htmlpage)
    return rc
From scarfboy at gmail.com  Sat Nov 10 11:51:05 2007
From: scarfboy at gmail.com (Bart)
Date: Sat Nov 10 11:51:08 2007
Subject: [mod_python] [SPAM] URL returned by test.py
In-Reply-To: <255b859d0711091825g20506f11s4dbe595f69822875@mail.gmail.com>
References: <255b859d0711091825g20506f11s4dbe595f69822875@mail.gmail.com>
Message-ID: <b71082d80711100851r583876d5h3c1efc4270f1cf9a@mail.gmail.com>

It's because of the somewhat strange way URLs work in the
python-publisher. In it, you always get the filename of the handler in
the URL, which to any client and their path calculations looks like an
extra directory.
Basically, every relative URL (like your href) will have to have an extra '../'

(You could use absolute URLs (within the (v)host), but if you ever
want to move things to another directory, you'ld have to go through
all your code to change the URLs.)

--Bart


On Nov 10, 2007 3:25 AM, Peter Hollenbeck <pwhbeck@gmail.com> wrote:
> Apache root is /srv/www/htdocs
>
> I open http://localhost/test.html
> Test.html calls test.py
> Test.py returns an html page with a link to an image in
> /srv/www/htdocs/pics/1998/...
> But the link displayed in the browser is
>     http://localhost/test/test.py/pics/1998/...
> not
>     http://localhost/pics/1998/...
>
> Can anyone tell me why this is?
> What can I do to get the link without "/test/test.py"
>
> Thanks very much,
> Peter Hollenbeck
>
>
> SUSE 10.2 Linux
> Apache 2.2.4
> mod_python 3.3.1 (I think)
>
> /srv/www/htdocs/test.html:
>       <html>
>       <p>
>       mod_python test
>       <p>
>       <form action="test/test.py/test" method="POST">
>           <input type="submit">
>       </form>
>       </html>
>
> /srv/www/htdocs/test/test.py
> def test():
>     link = '<a href="pics/1998/9804/bcsi/98042118.jpg"><img
> src="pics/1998/9804/bcsi/98042118tn.jpg">Logging road</a>'
>
>     htmlpage = '<html><body>'+link+'</body></html>'
>     rc = """$"""
>     rc = rc.replace('$', htmlpage)
>     return rc
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From list at joreybump.com  Sat Nov 10 14:14:18 2007
From: list at joreybump.com (Jorey Bump)
Date: Sat Nov 10 14:14:24 2007
Subject: [mod_python] [SPAM] URL returned by test.py
In-Reply-To: <255b859d0711091825g20506f11s4dbe595f69822875@mail.gmail.com>
References: <255b859d0711091825g20506f11s4dbe595f69822875@mail.gmail.com>
Message-ID: <4736030A.2020405@joreybump.com>

Peter Hollenbeck wrote, at 11/09/2007 09:25 PM:

> I open http://localhost/test.html
> Test.html calls test.py
> Test.py returns an html page with a link to an image in
> /srv/www/htdocs/pics/1998/...
> But the link displayed in the browser is
>     http://localhost/test/test.py/pics/1998/...
> not
>     http://localhost/pics/1998/...
> 
> Can anyone tell me why this is?

You are using a relative path.

> What can I do to get the link without "/test/test.py"

Use an absolute path from the site root.

Change this:

>     link = '<a href="pics/1998/9804/bcsi/98042118.jpg"><img
> src="pics/1998/9804/bcsi/98042118tn.jpg">Logging road</a>'

To this:

     link = '<a href="/pics/1998/9804/bcsi/98042118.jpg"><img 
src="/pics/1998/9804/bcsi/98042118tn.jpg">Logging road</a>'

This problem would occur using any language. It's not specific to 
mod_python. The browser will treat relative paths as relative from the 
currently displayed page.


From graham.dumpleton at gmail.com  Sat Nov 10 16:40:29 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sat Nov 10 16:40:35 2007
Subject: [mod_python] [SPAM] URL returned by test.py
In-Reply-To: <4736030A.2020405@joreybump.com>
References: <255b859d0711091825g20506f11s4dbe595f69822875@mail.gmail.com>
	<4736030A.2020405@joreybump.com>
Message-ID: <88e286470711101340v233e101djfbedc32706196c3a@mail.gmail.com>

Also read:

  http://www.modpython.org/pipermail/mod_python/2006-March/020501.html

Can't remember though if I posted a slightly more updated version of
that code though. It may have a slight error in it from memory.

Graham

On 11/11/2007, Jorey Bump <list@joreybump.com> wrote:
> Peter Hollenbeck wrote, at 11/09/2007 09:25 PM:
>
> > I open http://localhost/test.html
> > Test.html calls test.py
> > Test.py returns an html page with a link to an image in
> > /srv/www/htdocs/pics/1998/...
> > But the link displayed in the browser is
> >     http://localhost/test/test.py/pics/1998/...
> > not
> >     http://localhost/pics/1998/...
> >
> > Can anyone tell me why this is?
>
> You are using a relative path.
>
> > What can I do to get the link without "/test/test.py"
>
> Use an absolute path from the site root.
>
> Change this:
>
> >     link = '<a href="pics/1998/9804/bcsi/98042118.jpg"><img
> > src="pics/1998/9804/bcsi/98042118tn.jpg">Logging road</a>'
>
> To this:
>
>      link = '<a href="/pics/1998/9804/bcsi/98042118.jpg"><img
> src="/pics/1998/9804/bcsi/98042118tn.jpg">Logging road</a>'
>
> This problem would occur using any language. It's not specific to
> mod_python. The browser will treat relative paths as relative from the
> currently displayed page.
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From Wayne.Collier at noaa.gov  Thu Nov 15 12:29:46 2007
From: Wayne.Collier at noaa.gov (wayne collier)
Date: Thu Nov 15 12:30:02 2007
Subject: [mod_python] Help with multiple repeat error from apache server
Message-ID: <473C820A.8E5B6ACD@noaa.gov>

Can some one help me with this ?multiple repeat error?. I seem to get on
every page load. Before I got this, I was fiddling around with
authentication with apache. How do you troubleshoot this?

Configuration:
Linux Red Hat 3.4.6-3
Apache 2.0.52
mod_python 3.2.8
Python 2.4.3

Output:
Mod_python error: "PythonHandler vampire::publisher"

Traceback (most recent call last):

  File "/usr/local/lib/python2.4/site-packages/mod_python/apache.py",
line 299, in HandlerDispatch
    result = object(req)

  File "/usr/local/lib/python2.4/site-packages/vampire/lookup.py", line
969, in _publisher
    suff_matcher = re.compile(exp)

  File "/usr/local/lib/python2.4/sre.py", line 180, in compile
    return _compile(pattern, flags)

  File "/usr/local/lib/python2.4/sre.py", line 227, in _compile
    raise error, v # invalid expression

error: multiple repeat

log file:

[Thu Nov 15 12:00:37 2007] [error] [client 10.60.7.170] PythonHandler
vampire::publisher: Traceback (most recent call last):, referer:
http://mingus.../dev/index.html
[Thu Nov 15 12:00:37 2007] [error] [client 10.60.7.170] PythonHandler
vampire::publisher:   File
"/usr/local/lib/python2.4/site-packages/mod_python/apache.py", line 299,
in HandlerDispatch\n    result = object(req), referer: http://
mingus.../dev/index.html
[Thu Nov 15 12:00:37 2007] [error] [client 10.60.7.170] PythonHandler
vampire::publisher:   File
"/usr/local/lib/python2.4/site-packages/vampire/lookup.py", line 969, in
_publisher\n    suff_matcher = re.compile(exp), referer:
http://mingus..../dev/index.html
[Thu Nov 15 12:00:37 2007] [error] [client 10.60.7.170] PythonHandler
vampire::publisher:   File "/usr/local/lib/python2.4/sre.py", line 180,
in compile\n    return _compile(pattern, flags), referer:
http://mingus.ncd-tcn.noaa.gov/dev/index.html
[Thu Nov 15 12:00:37 2007] [error] [client 10.60.7.170] PythonHandler
vampire::publisher:   File "/usr/local/lib/python2.4/sre.py", line 227,
in _compile\n    raise error, v # invalid expression, referer:
http://mingus...../dev/index.html
[Thu Nov 15 12:00:37 2007] [error] [client 10.60.7.170] PythonHandler
vampire::publisher: error: multiple repeat, referer:
http://mingus..../dev/index.html


Apache directive :

<Directory /var/www/html_dev/python>
    AddHandler mod_python .py .psp
        PythonHandler vampire::publisher
        PythonPath "['/var/www/html/python'] + sys.path"
    PythonDebug On
        Options  -Indexes -MultiViews

</Directory>


-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20071115/67760b76/attachment.html
From graham.dumpleton at gmail.com  Thu Nov 15 16:13:55 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu Nov 15 16:14:03 2007
Subject: [mod_python] Help with multiple repeat error from apache server
In-Reply-To: <473C820A.8E5B6ACD@noaa.gov>
References: <473C820A.8E5B6ACD@noaa.gov>
Message-ID: <88e286470711151313n760b7e7eha91f851998c2765@mail.gmail.com>

On 16/11/2007, wayne collier <Wayne.Collier@noaa.gov> wrote:
>  Can some one help me with this "multiple repeat error". I seem to get on
> every page load. Before I got this, I was fiddling around with
> authentication with apache. How do you troubleshoot this?
>
> Configuration:
> Linux Red Hat 3.4.6-3
> Apache 2.0.52
> mod_python 3.2.8
> Python 2.4.3
>
> Output:
> Mod_python error: "PythonHandler vampire::publisher"
>
> Traceback (most recent call last):
>
>   File
> "/usr/local/lib/python2.4/site-packages/mod_python/apache.py",
> line 299, in HandlerDispatch
>     result = object(req)
>
>   File
> "/usr/local/lib/python2.4/site-packages/vampire/lookup.py",
> line 969, in _publisher
>     suff_matcher = re.compile(exp)
>
>   File "/usr/local/lib/python2.4/sre.py", line 180, in
> compile
>     return _compile(pattern, flags)
>
>   File "/usr/local/lib/python2.4/sre.py", line 227, in
> _compile
>     raise error, v # invalid expression
>
> error: multiple repeat
>
> log file:
>
> [Thu Nov 15 12:00:37 2007] [error] [client 10.60.7.170] PythonHandler
> vampire::publisher: Traceback (most recent call last):, referer:
> http://mingus.../dev/index.html
> [Thu Nov 15 12:00:37 2007] [error] [client 10.60.7.170] PythonHandler
> vampire::publisher:   File
> "/usr/local/lib/python2.4/site-packages/mod_python/apache.py",
> line 299, in HandlerDispatch\n    result = object(req), referer: http://
> mingus.../dev/index.html
> [Thu Nov 15 12:00:37 2007] [error] [client 10.60.7.170] PythonHandler
> vampire::publisher:   File
> "/usr/local/lib/python2.4/site-packages/vampire/lookup.py",
> line 969, in _publisher\n    suff_matcher = re.compile(exp), referer:
> http://mingus..../dev/index.html
> [Thu Nov 15 12:00:37 2007] [error] [client 10.60.7.170] PythonHandler
> vampire::publisher:   File
> "/usr/local/lib/python2.4/sre.py", line 180, in compile\n
>  return _compile(pattern, flags), referer:
> http://mingus.ncd-tcn.noaa.gov/dev/index.html
> [Thu Nov 15 12:00:37 2007] [error] [client 10.60.7.170] PythonHandler
> vampire::publisher:   File
> "/usr/local/lib/python2.4/sre.py", line 227, in _compile\n
>   raise error, v # invalid expression, referer:
> http://mingus...../dev/index.html
> [Thu Nov 15 12:00:37 2007] [error] [client 10.60.7.170] PythonHandler
> vampire::publisher: error: multiple repeat, referer:
> http://mingus..../dev/index.html
>
>
> Apache directive :
>
> <Directory /var/www/html_dev/python>
>     AddHandler mod_python .py .psp

What happens if you have:

  AddHandler mod_python .py

It doesn't make sense to push .psp files through vampire::publisher.

Graham

>         PythonHandler vampire::publisher
>         PythonPath "['/var/www/html/python'] + sys.path"
>     PythonDebug On
>         Options  -Indexes -MultiViews
>
> </Directory>
From cguin at bbn.com  Fri Nov 16 13:44:31 2007
From: cguin at bbn.com (Chris Guin)
Date: Fri Nov 16 13:48:40 2007
Subject: [mod_python] Thread stopping and asynchronous calls
Message-ID: <7.0.0.16.2.20071116133618.024ebed0@bbn.com>

I've been working on a custom chat server for Django (using 
mod_python), but have been hugely frustrated with the behavior of my 
"listening thread."  The thread stops at either the time.sleep() or 
select.select() call and never returns - usually when a lot of 
asynchronous requests are being answered by the server, although not 
always (even with one or two browsers left running over night, the 
thread will eventually stop).  Increasing the frequency of the async 
requests or increasing the number of browsers raises the chance of 
stoppage to near certain levels - but there's still a high random factor to it.

I have guaranteed that there is only one "listening thread" running 
at any time, and have commented out all database and network accesses 
(so my listening thread is just printing out debug statements and 
calling time.sleep() and my AJAX calls only retrieve random 
numbers).  The problem still occurs, and in the same manner.  Nor is 
it a gradual slowdown - time.sleep() takes the correct number of 
seconds to return right up until the time it fails to return at all.

When Apache starts up it says: "mod_python: Creating 8 session 
mutexes based on 256 max processes and 0 max threads."  This looks a 
little suspicious - is there a mod_python setting that I have 
incorrect?  My understanding of the workings of mod_python is fairly 
weak, so this may not even the right group to be posting to.

Thanks for any help you could give,
Chris Guin


From graham.dumpleton at gmail.com  Fri Nov 16 16:51:01 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Fri Nov 16 16:51:08 2007
Subject: [mod_python] Thread stopping and asynchronous calls
In-Reply-To: <7.0.0.16.2.20071116133618.024ebed0@bbn.com>
References: <7.0.0.16.2.20071116133618.024ebed0@bbn.com>
Message-ID: <88e286470711161351m22863ccyed52add2703a77ff@mail.gmail.com>

Huh, are you saying that you are creating a listener socket in the
Apache child process from mod_python. You can't really do this as
Apache is a multi processor web server and you cant have multiple
processes creating a listener socket on the same port. Thus all but
the first Apache child process would fail. When that process gets
recycled by Apache, none of the other Apache child processes would
take over and thus no listener anymore.

Graham

On 17/11/2007, Chris Guin <cguin@bbn.com> wrote:
> I've been working on a custom chat server for Django (using
> mod_python), but have been hugely frustrated with the behavior of my
> "listening thread."  The thread stops at either the time.sleep() or
> select.select() call and never returns - usually when a lot of
> asynchronous requests are being answered by the server, although not
> always (even with one or two browsers left running over night, the
> thread will eventually stop).  Increasing the frequency of the async
> requests or increasing the number of browsers raises the chance of
> stoppage to near certain levels - but there's still a high random factor to it.
>
> I have guaranteed that there is only one "listening thread" running
> at any time, and have commented out all database and network accesses
> (so my listening thread is just printing out debug statements and
> calling time.sleep() and my AJAX calls only retrieve random
> numbers).  The problem still occurs, and in the same manner.  Nor is
> it a gradual slowdown - time.sleep() takes the correct number of
> seconds to return right up until the time it fails to return at all.
>
> When Apache starts up it says: "mod_python: Creating 8 session
> mutexes based on 256 max processes and 0 max threads."  This looks a
> little suspicious - is there a mod_python setting that I have
> incorrect?  My understanding of the workings of mod_python is fairly
> weak, so this may not even the right group to be posting to.
>
> Thanks for any help you could give,
> Chris Guin
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From graham.dumpleton at gmail.com  Fri Nov 16 17:22:19 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Fri Nov 16 17:22:25 2007
Subject: [mod_python] Thread stopping and asynchronous calls
In-Reply-To: <7.0.0.16.2.20071116165857.024bfe88@bbn.com>
References: <7.0.0.16.2.20071116133618.024ebed0@bbn.com>
	<88e286470711161351m22863ccyed52add2703a77ff@mail.gmail.com>
	<7.0.0.16.2.20071116165857.024bfe88@bbn.com>
Message-ID: <88e286470711161422j600bde64g48f1a77983a06348@mail.gmail.com>

Apache will kill of child processes based on exceeding
MaxRequestsPerChild. Also, if it has to create additional processes to
meet demand, when demand drops off, it randomly kills of processes to
drop back to idle state number of processes.

Graham

On 17/11/2007, Chris Guin <cguin@bbn.com> wrote:
> The idea isn't to have multiple processes, but just one - I guess the
> big obvious thing I didn't think about was that there's no reason to
> have the thread running within the python interpreter started up from
> Apache.  Since it's already communicating via database messages, I
> should just figure out how to separate it from mod_python/Apache-land
> and run it stand alone.  I wasn't aware that Apache would forcibly
> terminate one of its own processes - that would certainly explain the
> behavior, although why it would do that in the thick of a lot of
> requests isn't obvious to me.
>
> Thanks for your patience,
> Chris
>
> At 04:51 PM 11/16/2007, you wrote:
> >Huh, are you saying that you are creating a listener socket in the
> >Apache child process from mod_python. You can't really do this as
> >Apache is a multi processor web server and you cant have multiple
> >processes creating a listener socket on the same port. Thus all but
> >the first Apache child process would fail. When that process gets
> >recycled by Apache, none of the other Apache child processes would
> >take over and thus no listener anymore.
> >
> >Graham
> >
> >On 17/11/2007, Chris Guin <cguin@bbn.com> wrote:
> > > I've been working on a custom chat server for Django (using
> > > mod_python), but have been hugely frustrated with the behavior of my
> > > "listening thread."  The thread stops at either the time.sleep() or
> > > select.select() call and never returns - usually when a lot of
> > > asynchronous requests are being answered by the server, although not
> > > always (even with one or two browsers left running over night, the
> > > thread will eventually stop).  Increasing the frequency of the async
> > > requests or increasing the number of browsers raises the chance of
> > > stoppage to near certain levels - but there's still a high random
> > factor to it.
> > >
> > > I have guaranteed that there is only one "listening thread" running
> > > at any time, and have commented out all database and network accesses
> > > (so my listening thread is just printing out debug statements and
> > > calling time.sleep() and my AJAX calls only retrieve random
> > > numbers).  The problem still occurs, and in the same manner.  Nor is
> > > it a gradual slowdown - time.sleep() takes the correct number of
> > > seconds to return right up until the time it fails to return at all.
> > >
> > > When Apache starts up it says: "mod_python: Creating 8 session
> > > mutexes based on 256 max processes and 0 max threads."  This looks a
> > > little suspicious - is there a mod_python setting that I have
> > > incorrect?  My understanding of the workings of mod_python is fairly
> > > weak, so this may not even the right group to be posting to.
> > >
> > > Thanks for any help you could give,
> > > Chris Guin
> > >
> > >
> > > _______________________________________________
> > > Mod_python mailing list
> > > Mod_python@modpython.org
> > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > >
>
>
>
From edgardalvescosta at gmail.com  Sun Nov 18 07:35:06 2007
From: edgardalvescosta at gmail.com (EdgardCosta)
Date: Sun Nov 18 07:35:23 2007
Subject: [mod_python] How declared correctly the way in the pg.html to the
	apache server can resolv the script python correctly
Message-ID: <1195389306.3222.23.camel@ednote>



Friends mod_python,

I'm new in mod_python.

I made some simples scripts and run then in apache server without
troubles. But, whem i tryied rum html pages with forms, something goes
wrong.

In the tutorial says: <form action="form.py/email" method="POST">, where
form.py is the script, and email is the function. All right. My form
declaration: <form name="form1" method="post"
action="testepython.py/form1"><label>primeiro numero</label>,where
testepython is the script and form1 is the function. 

In my browser when a run the url:http://anything/form.html, the apache
returns to my a 404 error. In the log I have: File does not
exist: /net/www/testepython.py, referer:
http://mydomain/testepython.html.

Ok, the error says that the script doesn't is in the wwwroot. But the
folder in the configuration is wwwroot/python. 

How can i write the declartion in the form.html, thats could resolve the
script python?

-- 
Edgard Costa <edgardalvescosta@gmail.com>


-- 
EdgardCosta <edgardalvescosta@gmail.com>

From graham.dumpleton at gmail.com  Sun Nov 18 16:03:20 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sun Nov 18 16:03:25 2007
Subject: [mod_python] How declared correctly the way in the pg.html to the
	apache server can resolv the script python correctly
In-Reply-To: <1195389306.3222.23.camel@ednote>
References: <1195389306.3222.23.camel@ednote>
Message-ID: <88e286470711181303k3b1a8bb1hab9c0de41c341de3@mail.gmail.com>

If your Python script is in a subdirectory of where the .html form is,
have you tried:

  action="python/testepython.py/form1"

Graham

On 18/11/2007, EdgardCosta <edgardalvescosta@gmail.com> wrote:
>
>
> Friends mod_python,
>
> I'm new in mod_python.
>
> I made some simples scripts and run then in apache server without
> troubles. But, whem i tryied rum html pages with forms, something goes
> wrong.
>
> In the tutorial says: <form action="form.py/email" method="POST">, where
> form.py is the script, and email is the function. All right. My form
> declaration: <form name="form1" method="post"
> action="testepython.py/form1"><label>primeiro numero</label>,where
> testepython is the script and form1 is the function.
>
> In my browser when a run the url:http://anything/form.html, the apache
> returns to my a 404 error. In the log I have: File does not
> exist: /net/www/testepython.py, referer:
> http://mydomain/testepython.html.
>
> Ok, the error says that the script doesn't is in the wwwroot. But the
> folder in the configuration is wwwroot/python.
>
> How can i write the declartion in the form.html, thats could resolve the
> script python?
>
> --
> Edgard Costa <edgardalvescosta@gmail.com>
>
>
> --
> EdgardCosta <edgardalvescosta@gmail.com>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From graham.dumpleton at gmail.com  Sun Nov 18 16:20:53 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sun Nov 18 16:20:59 2007
Subject: [mod_python] How declared correctly the way in the pg.html to the
	apache server can resolv the script python correctly
In-Reply-To: <1195420395.12499.2.camel@ubuntuserver>
References: <1195389306.3222.23.camel@ednote>
	<88e286470711181303k3b1a8bb1hab9c0de41c341de3@mail.gmail.com>
	<1195420395.12499.2.camel@ubuntuserver>
Message-ID: <88e286470711181320h72d09402xcddd1d4b4213922@mail.gmail.com>

On 19/11/2007, EdgardCosta <edgardalvescosta@gmail.com> wrote:
> Thanks.
>
> I've tryied. But don't work.
>
> Something in the apache2 configuration is the problem and i don't
> realized what is

Please keep followups on the mailing list by using reply-all.

As to your config problem, you haven't explained enough about what you
have actually used in the configuration or what you have tried in
getting this to work to know, would just be guessing.

Have you actually got a publisher handler working that doesn't involve
a form as a first step?

What URL did you use for that?

Where in the file system is your HTML form file kept?

Where in the file system is your publisher code file kept?

What is the Apache configuration snippet you use to configure
mod_python to use publisher?

Graham
From edgardalvescosta at gmail.com  Mon Nov 19 05:07:18 2007
From: edgardalvescosta at gmail.com (EdgardCosta)
Date: Mon Nov 19 05:06:37 2007
Subject: [mod_python] How declared correctly the way in the pg.html to
	the apache server can resolv the script python correctly
In-Reply-To: <88e286470711181320h72d09402xcddd1d4b4213922@mail.gmail.com>
References: <1195389306.3222.23.camel@ednote>
	<88e286470711181303k3b1a8bb1hab9c0de41c341de3@mail.gmail.com>
	<1195420395.12499.2.camel@ubuntuserver>
	<88e286470711181320h72d09402xcddd1d4b4213922@mail.gmail.com>
Message-ID: <1195466838.9637.11.camel@ubuntuserver>

Graham,

First sorry, I simply forgot the address that i had replied.

Your questions:
Your config problem, you haven't explained enough about what you
have actually used in the configuration

My apache2 configuration to run mod_python is the simple one. This is in
the oficial tutorial.

 <Directory /net/www/python/>
        SetHandler mod_python
        PythonHandler mod_python.publisher
        PythonDebug On

Have you actually got a publisher handler working that doesn't involve
a form as a first step?]

Yes. A few.


What URL did you use for that?

I'm using a no-ip dns. It is to my local network only.

Where in the file system is your HTML form file kept?

I built a different way to this. The default is /var/www/ and I put it
in /net/www

Where in the file system is your publisher code file kept?

It is in /net/www/python

What is the Apache configuration snippet you use to configure
mod_python to use publisher?

The configuration is the the that a wrote in above this message.

Thanks for all

-- 
EdgardCosta <edgardalvescosta@gmail.com>

From graham.dumpleton at gmail.com  Mon Nov 19 06:03:23 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon Nov 19 06:03:29 2007
Subject: [mod_python] How declared correctly the way in the pg.html to the
	apache server can resolv the script python correctly
In-Reply-To: <1195466838.9637.11.camel@ubuntuserver>
References: <1195389306.3222.23.camel@ednote>
	<88e286470711181303k3b1a8bb1hab9c0de41c341de3@mail.gmail.com>
	<1195420395.12499.2.camel@ubuntuserver>
	<88e286470711181320h72d09402xcddd1d4b4213922@mail.gmail.com>
	<1195466838.9637.11.camel@ubuntuserver>
Message-ID: <88e286470711190303m58237147w33f2dba15bdc36b5@mail.gmail.com>

On 19/11/2007, EdgardCosta <edgardalvescosta@gmail.com> wrote:
> Graham,
>
> First sorry, I simply forgot the address that i had replied.
>
> Your questions:
> Your config problem, you haven't explained enough about what you
> have actually used in the configuration
>
> My apache2 configuration to run mod_python is the simple one. This is in
> the oficial tutorial.
>
>  <Directory /net/www/python/>
>         SetHandler mod_python
>         PythonHandler mod_python.publisher
>         PythonDebug On
>
> Have you actually got a publisher handler working that doesn't involve
> a form as a first step?]
>
> Yes. A few.
>
>
> What URL did you use for that?
>
> I'm using a no-ip dns. It is to my local network only.

But what URL address did you use to access it from your web browser.

Your problem is mostly due incorrect relative URL in the form action.
Thus knowing what the URL is for the static HTML page or publisher
handler that you are using to generate the page is important. This is
why I am asking.

Graham

> Where in the file system is your HTML form file kept?
>
> I built a different way to this. The default is /var/www/ and I put it
> in /net/www
>
> Where in the file system is your publisher code file kept?
>
> It is in /net/www/python
>
> What is the Apache configuration snippet you use to configure
> mod_python to use publisher?
>
> The configuration is the the that a wrote in above this message.
>
> Thanks for all
From edgardalvescosta at gmail.com  Mon Nov 19 06:20:56 2007
From: edgardalvescosta at gmail.com (EdgardCosta)
Date: Mon Nov 19 06:20:13 2007
Subject: [mod_python] How declared correctly the way in the pg.html to
	the apache server can resolv the script python correctly
In-Reply-To: <88e286470711190303m58237147w33f2dba15bdc36b5@mail.gmail.com>
References: <1195389306.3222.23.camel@ednote>
	<88e286470711181303k3b1a8bb1hab9c0de41c341de3@mail.gmail.com>
	<1195420395.12499.2.camel@ubuntuserver>
	<88e286470711181320h72d09402xcddd1d4b4213922@mail.gmail.com>
	<1195466838.9637.11.camel@ubuntuserver>
	<88e286470711190303m58237147w33f2dba15bdc36b5@mail.gmail.com>
Message-ID: <1195471256.10720.15.camel@ubuntuserver>

Graham.

Sorry agaim, if i don't understand your question

what URL address did you use to access it from your web browser

I'm using this url: http://edgardalvescosta.no-ip.org/testepython.html
and the the response should be
http://edgardalvescosta.no-ip.org/python/testepython.py/form1

Edgard

Em Seg, 2007-11-19 ?s 22:03 +1100, Graham Dumpleton escreveu:
> On 19/11/2007, EdgardCosta <edgardalvescosta@gmail.com> wrote:
> > Graham,
> >
> > First sorry, I simply forgot the address that i had replied.
> >
> > Your questions:
> > Your config problem, you haven't explained enough about what you
> > have actually used in the configuration
> >
> > My apache2 configuration to run mod_python is the simple one. This is in
> > the oficial tutorial.
> >
> >  <Directory /net/www/python/>
> >         SetHandler mod_python
> >         PythonHandler mod_python.publisher
> >         PythonDebug On
> >
> > Have you actually got a publisher handler working that doesn't involve
> > a form as a first step?]
> >
> > Yes. A few.
> >
> >
> > What URL did you use for that?
> >
> > I'm using a no-ip dns. It is to my local network only.
> 
> But what URL address did you use to access it from your web browser.
> 
> Your problem is mostly due incorrect relative URL in the form action.
> Thus knowing what the URL is for the static HTML page or publisher
> handler that you are using to generate the page is important. This is
> why I am asking.
> 
> Graham
> 
> > Where in the file system is your HTML form file kept?
> >
> > I built a different way to this. The default is /var/www/ and I put it
> > in /net/www
> >
> > Where in the file system is your publisher code file kept?
> >
> > It is in /net/www/python
> >
> > What is the Apache configuration snippet you use to configure
> > mod_python to use publisher?
> >
> > The configuration is the the that a wrote in above this message.
> >
> > Thanks for all
-- 
Edgard Costa

edgardalvescosta@gmail.com

Viste: www.prontuarioeltronico.odo.br

From graham.dumpleton at gmail.com  Mon Nov 19 16:18:59 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon Nov 19 16:19:05 2007
Subject: [mod_python] How declared correctly the way in the pg.html to the
	apache server can resolv the script python correctly
In-Reply-To: <1195471256.10720.15.camel@ubuntuserver>
References: <1195389306.3222.23.camel@ednote>
	<88e286470711181303k3b1a8bb1hab9c0de41c341de3@mail.gmail.com>
	<1195420395.12499.2.camel@ubuntuserver>
	<88e286470711181320h72d09402xcddd1d4b4213922@mail.gmail.com>
	<1195466838.9637.11.camel@ubuntuserver>
	<88e286470711190303m58237147w33f2dba15bdc36b5@mail.gmail.com>
	<1195471256.10720.15.camel@ubuntuserver>
Message-ID: <88e286470711191318l60be89b0se7760cc4dd7a1eb8@mail.gmail.com>

If that is the case, the action should be what I said originally:

  action="python/testepython.py/form1"

If that doesn't work, try:

  action="http://edgardalvescosta.no-ip.org/python/testepython.py/form1"

If that still doesn't work, then test that the full URL works from the
browser by using:

  http://edgardalvescosta.no-ip.org/python/testepython.py/form1?a=b&c=d

Where the part after '?' equates to the form arguments that the handler accepts.

If it doesn't work when you put this address direct into the browser,
then it isn't going to work from the HTML form.

Graham

On 19/11/2007, EdgardCosta <edgardalvescosta@gmail.com> wrote:
> Graham.
>
> Sorry agaim, if i don't understand your question
>
> what URL address did you use to access it from your web browser
>
> I'm using this url: http://edgardalvescosta.no-ip.org/testepython.html
> and the the response should be
> http://edgardalvescosta.no-ip.org/python/testepython.py/form1
>
> Edgard
>
> Em Seg, 2007-11-19 ?s 22:03 +1100, Graham Dumpleton escreveu:
> > On 19/11/2007, EdgardCosta <edgardalvescosta@gmail.com> wrote:
> > > Graham,
> > >
> > > First sorry, I simply forgot the address that i had replied.
> > >
> > > Your questions:
> > > Your config problem, you haven't explained enough about what you
> > > have actually used in the configuration
> > >
> > > My apache2 configuration to run mod_python is the simple one. This is in
> > > the oficial tutorial.
> > >
> > >  <Directory /net/www/python/>
> > >         SetHandler mod_python
> > >         PythonHandler mod_python.publisher
> > >         PythonDebug On
> > >
> > > Have you actually got a publisher handler working that doesn't involve
> > > a form as a first step?]
> > >
> > > Yes. A few.
> > >
> > >
> > > What URL did you use for that?
> > >
> > > I'm using a no-ip dns. It is to my local network only.
> >
> > But what URL address did you use to access it from your web browser.
> >
> > Your problem is mostly due incorrect relative URL in the form action.
> > Thus knowing what the URL is for the static HTML page or publisher
> > handler that you are using to generate the page is important. This is
> > why I am asking.
> >
> > Graham
> >
> > > Where in the file system is your HTML form file kept?
> > >
> > > I built a different way to this. The default is /var/www/ and I put it
> > > in /net/www
> > >
> > > Where in the file system is your publisher code file kept?
> > >
> > > It is in /net/www/python
> > >
> > > What is the Apache configuration snippet you use to configure
> > > mod_python to use publisher?
> > >
> > > The configuration is the the that a wrote in above this message.
> > >
> > > Thanks for all
> --
> Edgard Costa
>
> edgardalvescosta@gmail.com
>
> Viste: www.prontuarioeltronico.odo.br
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>

From knordstrom at library.unt.edu  Mon Nov 19 16:35:39 2007
From: knordstrom at library.unt.edu (Kurt Nordstrom)
Date: Mon Nov 19 16:36:27 2007
Subject: [mod_python] Large File Upload Issues
In-Reply-To: <88e286470710181503t290d95bfn1c221fc87367baa5@mail.gmail.com>
References: <4717E060.80408@library.unt.edu>
	<88e286470710181503t290d95bfn1c221fc87367baa5@mail.gmail.com>
Message-ID: <474201AB.5040508@library.unt.edu>

Well, it's been a while, but my boss has nudged me into posting the fix 
we came up with for this issue.  Just y'know, in the interests of 
closure, and in case somebody else is trying something similar.  The 
working code looks like:

from mod_python import apache

import os

def handler(request):
    #request.content_type = "text/plain"
    content_length = int(request.headers_in["Content-Length"])
    outPath = "/home/vphill/test/upload_out.dat"
    outFile = open(outPath, "w")
    conn = request.connection
    i = 0
    buf = ""
    while i < content_length:
        c = conn.read()
        if c == "":
            break
        buf = buf + c
        if len(buf) >= 102400:
            outFile.write(buf)
            outFile.flush()
            buf = ""
        i += len(c)
    if len(buf):
        outFile.write(buf)
        outFile.flush()
    outFile.close()
    talkBack = "Recieved %s bytes\n" % os.stat(outPath).st_size
    request.set_content_length(len(talkBack))
    request.write(talkBack)
    return apache.OK

We've had success using it (with curl as the sender) to receive files exceeding 2 GB in size.

So it just goes to show, if the programmer can't fix it, let the librarian look at it.

Hope this helps someone.



Graham Dumpleton wrote:
> Read one byte at a time is exceedingly inefficient. Rather than
> reinvent the wheel, perhaps look at Tramline.
>
>   http://www.infrae.com/products/tramline
>
> Personally I don't believe that Python is a good way of doing this and
> for best performance it should be done as an Apache module in C code.
> At least though the Tramline approach is more efficient than your
> current approach.
>
> Graham
>
> On 19/10/2007, Kurt Nordstrom <knordstrom@library.unt.edu> wrote:
>   
>> We're working on a webapp that will need to receive, from its clients,
>> fairly large files (it's an archival storage system).  The logical way
>> to do this seems to be to use http PUT, with appropriate code on the
>> server side to store the file to the proper place.
>>
>> Borrowing and modifying some code posted back in '05 to this list by a
>> Jeremy Jones, I have been playing with this:
>>
>> from mod_python import apache
>>
>> import os
>>
>> def handler(request):
>>     #request.content_type = "text/plain"
>>     content_length = int(request.headers_in["Content-Length"])
>>     outPath = "/home/webtmp/upload_out.dat"
>>     outFile = open(outPath, "w")
>>     conn = request.connection
>>     i = 0
>>     buf = ""
>>     while i < content_length:
>>         c = conn.read(1)
>>         if c == "":
>>             break
>>         buf = buf + c
>>         if len(buf) >= 102400:
>>             outFile.write(buf)
>>             outFile.flush()
>>             buf = ""
>>         i += 1
>>     if len(buf):
>>         outFile.write(buf)
>>         outFile.flush()
>>     outFile.close()
>>     talkBack = "Recieved %s bytes\n" % os.stat(outPath).st_size
>>     request.set_content_length(len(talkBack))
>>     request.write(talkBack)
>>     return apache.OK
>>     


-- 
===
Kurt Nordstrom
Programmer
University of North Texas Libraries
Digital Projects Unit
(940) 891-6747

From edgardalvescosta at gmail.com  Mon Nov 19 16:46:49 2007
From: edgardalvescosta at gmail.com (EdgardCosta)
Date: Mon Nov 19 16:46:06 2007
Subject: [mod_python] How declared correctly the way in the pg.html to
	the apache server can resolv the script python correctly
Message-ID: <1195508809.9604.7.camel@ubuntuserver>

Graham

I made some modifications and get this messeage on browser when a set
this: http://edgardalvescosta.no-ip.org/python/testepython.py/form1 

MOD_PYTHON ERROR

ProcessId: 9376
Interpreter: '127.0.1.1'

ServerName: '127.0.1.1'
DocumentRoot: '/net/www/'

URI: '/python/testepython.py/form1'
Location: None
Directory: '/net/www/python/'
Filename: '/net/www/python/testepython.py'
PathInfo: '/form1'

Phase: 'PythonHandler'
Handler: 'mod_python.publisher'

Traceback (most recent call last):

File "/usr/lib/python2.5/site-packages/mod_python/importer.py", line
1537, in HandlerDispatch
default=default_handler, arg=req, silent=hlist.silent)

File "/usr/lib/python2.5/site-packages/mod_python/importer.py", line
1229, in _process_target
result = _execute_target(config, req, object, arg)

File "/usr/lib/python2.5/site-packages/mod_python/importer.py", line
1128, in _execute_target
result = object(arg)

File "/usr/lib/python2.5/site-packages/mod_python/publisher.py",
line 213, in handler
published = publish_object(req, object)

File "/usr/lib/python2.5/site-packages/mod_python/publisher.py",
line 425, in publish_object
return publish_object(req,util.apply_fs_data(object, req.form,
req=req))

File "/usr/lib/python2.5/site-packages/mod_python/util.py", line
554, in apply_fs_data
return object(**args)

TypeError: form1() takes exactly 3 non-keyword arguments (1 given)


MODULE CACHE DETAILS

Accessed: Mon Nov 19 13:51:21 2007
Generation: 0

_mp_59ea5b85ba1103bcdaa0f7734753b861 {
FileName: '/net/www/python/testepython.py'
Instance: 1 [IMPORT]
Generation: 1
Modified: Mon Nov 19 12:56:29 2007
Imported: Mon Nov 19 13:51:21 2007
}

This lines show some clues??

EdgardCosta

From graham.dumpleton at gmail.com  Mon Nov 19 16:55:38 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon Nov 19 16:55:45 2007
Subject: [mod_python] How declared correctly the way in the pg.html to the
	apache server can resolv the script python correctly
In-Reply-To: <1195508809.9604.7.camel@ubuntuserver>
References: <1195508809.9604.7.camel@ubuntuserver>
Message-ID: <88e286470711191355j1831ebd2o75039e886b47f096@mail.gmail.com>

You didn't supply any form arguments using a query string at the end
of the URL like I said you should.

You may want to do some research on the difference between form posts
using GET vs POST. The  publisher handler will accept either. The
names of the form arguments, which in your case there appear to be 2,
would be whatever you called the function parameters of your published
function. Since you have not even shown the prototype of your
published form function I have no idea what they are.

Graham

On 20/11/2007, EdgardCosta <edgardalvescosta@gmail.com> wrote:
> Graham
>
> I made some modifications and get this messeage on browser when a set
> this: http://edgardalvescosta.no-ip.org/python/testepython.py/form1
>
> MOD_PYTHON ERROR
>
> ProcessId: 9376
> Interpreter: '127.0.1.1'
>
> ServerName: '127.0.1.1'
> DocumentRoot: '/net/www/'
>
> URI: '/python/testepython.py/form1'
> Location: None
> Directory: '/net/www/python/'
> Filename: '/net/www/python/testepython.py'
> PathInfo: '/form1'
>
> Phase: 'PythonHandler'
> Handler: 'mod_python.publisher'
>
> Traceback (most recent call last):
>
> File "/usr/lib/python2.5/site-packages/mod_python/importer.py", line
> 1537, in HandlerDispatch
> default=default_handler, arg=req, silent=hlist.silent)
>
> File "/usr/lib/python2.5/site-packages/mod_python/importer.py", line
> 1229, in _process_target
> result = _execute_target(config, req, object, arg)
>
> File "/usr/lib/python2.5/site-packages/mod_python/importer.py", line
> 1128, in _execute_target
> result = object(arg)
>
> File "/usr/lib/python2.5/site-packages/mod_python/publisher.py",
> line 213, in handler
> published = publish_object(req, object)
>
> File "/usr/lib/python2.5/site-packages/mod_python/publisher.py",
> line 425, in publish_object
> return publish_object(req,util.apply_fs_data(object, req.form,
> req=req))
>
> File "/usr/lib/python2.5/site-packages/mod_python/util.py", line
> 554, in apply_fs_data
> return object(**args)
>
> TypeError: form1() takes exactly 3 non-keyword arguments (1 given)
>
>
> MODULE CACHE DETAILS
>
> Accessed: Mon Nov 19 13:51:21 2007
> Generation: 0
>
> _mp_59ea5b85ba1103bcdaa0f7734753b861 {
> FileName: '/net/www/python/testepython.py'
> Instance: 1 [IMPORT]
> Generation: 1
> Modified: Mon Nov 19 12:56:29 2007
> Imported: Mon Nov 19 13:51:21 2007
> }
>
> This lines show some clues??
>
> EdgardCosta
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From edgardalvescosta at gmail.com  Tue Nov 20 04:56:33 2007
From: edgardalvescosta at gmail.com (EdgardCosta)
Date: Tue Nov 20 04:55:47 2007
Subject: [SPAM] Re: [mod_python] How declared correctly the way in the pg.html
	to the apache server can resolv the script python correctly
Message-ID: <1195552594.9847.3.camel@ubuntuserver>

Graham

I`ve made the modifications that you sad in youn last email. The error
is the same that i'd posted.

I'll try to build a page with a form in it like form.py and see if it is
resolved by another script py

If i have sucess i'll email to list, ok

Thanks for all



-- 
EdgardCosta <edgardalvescosta@gmail.com>

From graham.dumpleton at gmail.com  Tue Nov 20 05:26:37 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue Nov 20 05:26:44 2007
Subject: [SPAM] Re: [mod_python] How declared correctly the way in the
	pg.html to the apache server can resolv the script python correctly
In-Reply-To: <1195552594.9847.3.camel@ubuntuserver>
References: <1195552594.9847.3.camel@ubuntuserver>
Message-ID: <88e286470711200226v10d4e31h929fe737a95f92db@mail.gmail.com>

Maybe work through this tutorial and see if things make more sense.

  http://webpython.codepoint.net/mod_python

Graham

On 20/11/2007, EdgardCosta <edgardalvescosta@gmail.com> wrote:
> Graham
>
> I`ve made the modifications that you sad in youn last email. The error
> is the same that i'd posted.
>
> I'll try to build a page with a form in it like form.py and see if it is
> resolved by another script py
>
> If i have sucess i'll email to list, ok
>
> Thanks for all
>
>
>
> --
> EdgardCosta <edgardalvescosta@gmail.com>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From edgardalvescosta at gmail.com  Tue Nov 20 05:32:51 2007
From: edgardalvescosta at gmail.com (EdgardCosta)
Date: Tue Nov 20 05:32:02 2007
Subject: [SPAM] Re: [mod_python] How declared correctly the way in the pg.html
	to the apache server can resolv the script python correctly
Message-ID: <1195554771.9847.6.camel@ubuntuserver>

Graham

I'll read it. Thanks


-- 
EdgardCosta <edgardalvescosta@gmail.com>

From edgardalvescosta at gmail.com  Tue Nov 20 21:05:49 2007
From: edgardalvescosta at gmail.com (EdgardCosta)
Date: Tue Nov 20 21:06:05 2007
Subject: [mod_python] How declared correctly the way in the pg.html to
	the apache server can resolv the script python correctly
Message-ID: <1195610749.8967.22.camel@ednote>

Graham

Everything is under control??

Well the first problem with the pages is solved.

To the friends that will read all the messages i have to say that: the
mod_python is very smart. We don't have to write a several pages to show
each one.

In each function that we define, example: def 1(), def 2(), when we
write in the browser: www.domain/file/anything.py/1 show the pages
defined by function def(1). If def 2 () is so diferent of the 1, the
user will think that is a new one.

In relation to the form the mod_python works in the same way. We don't
have to write the form and the page with the response. The both are in
the same file. After the user submit something the function that have to
resolve the form's variables and show it like a new page.

Well, back to my trouble. I didn't get my form resolved. Now with the
rewrite the form and the response in the same file 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20071121/8154ea4f/attachment.html
From edgardalvescosta at gmail.com  Tue Nov 20 21:25:16 2007
From: edgardalvescosta at gmail.com (EdgardCosta)
Date: Tue Nov 20 21:25:27 2007
Subject: [mod_python] How declared correctly the way in the pg.html to
	the apache server can resolv the script python correctly
Message-ID: <1195611916.8967.42.camel@ednote>

Graham

95% of my problems wiht the form are resolved. The tutorial that you
post show a diferent way of write.

The mod_python see each function declared in a file like a new page.

So, the same happens with the form and your response.

In my case i post in each textfield values that are numbers. I want do
this: textfield1+textfield2.

The function don't understand intenger. Only string.

My results is like this: textfield1textfiel2. Exemple. 2+2=4 ; 22

How could i declared the variables correctly;

The code:

#!/pyhton/python
#formulario editado com kompozer
#autor: Edgard Costa

import cgi

def form1():
        b="""\

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
"http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta content="text/html; charset=ISO-8859-1"
http-equiv="content-type">
  <title>form.py</title>
</head>
<body>
<!-- method can be get or post -->
<div style="text-align: center;"><br>
Formularios Teste<br>
<br>
<form method="post" action="./show" name="form1">
  <div style="text-align: center;"></div>
  <table style="text-align: left; margin-left: auto; margin-right: auto;
height: 31px; width: 599px;" border="0" cellpadding="2" cellspacing="2">
    <tbody>
      <tr>
        <td style="text-align: center; width: 150px;"
valign="undefined">soma1</td>
        <td style="text-align: left; width: 227px;"
valign="undefined"><input name="soma1"></td>
      </tr>
      <tr>
        <td style="text-align: center; width: 150px;"
valign="undefined">soma2</td>
        <td style="text-align: left; width: 227px;"
valign="undefined"><input name="soma2"></td>
      </tr>
      <tr>
        <td style="text-align: center; width: 150px;"
valign="undefined"></td>
        <td style="text-align: left; width: 227px;"
valign="undefined"><button name="Soma"></button></td>
        <td align="center" valign="undefined"></td>
      </tr>
    </tbody>
  </table>
  <br>
</form>
<br>
mod_python<br>
<br>
<br>
<br>
</div>
</body>
</html>

        """
        return b

def show(req):
        soma1=req.form.getfirst('soma1','')
        soma2=req.form.getfirst('soma2','')
        c=soma1+soma2
        c=cgi.escape(c)

        r="""\
        <html>a soma eh:%s</html>
        """
        return r % c

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20071121/7dbffe6e/attachment.html
From graham.dumpleton at gmail.com  Tue Nov 20 21:51:31 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue Nov 20 21:51:37 2007
Subject: [mod_python] How declared correctly the way in the pg.html to the
	apache server can resolv the script python correctly
In-Reply-To: <1195611916.8967.42.camel@ednote>
References: <1195611916.8967.42.camel@ednote>
Message-ID: <88e286470711201851t4bcc5bbye62334fc1319dd5a@mail.gmail.com>

>  def show(req):
>          soma1=req.form.getfirst('soma1','')
>          soma2=req.form.getfirst('soma2','')
>          c=soma1+soma2
>          c=cgi.escape(c)
>
>          r="""\
>          <html>a soma eh:%s</html>
>          """
>          return r % c

Ignoring proper error checking, you can just do:

  def show(soma1, soma2):
      return "<html>a soma eh:%d</html>" % int(soma1) + int(soma2)

All field values are strings, so you just need to convert them to correct type.

Graham
From edgardalvescosta at gmail.com  Wed Nov 21 04:19:44 2007
From: edgardalvescosta at gmail.com (EdgardCosta)
Date: Wed Nov 21 04:24:02 2007
Subject: [SPAM] Re: [mod_python] How declared correctly the way in the pg.html
	to the apache server can resolv the script python correctl
Message-ID: <1195636785.9603.7.camel@ubuntuserver>

Graham,

Thanks and Sorry. I send yesterday two messages. One of then isn't
complete. My sun push the enter and send the message.

Only one question. If we can build a complete site in one file with the
mod_pyhton, the security is better or not?


-- 
EdgardCosta <edgardalvescosta@gmail.com>

From graham.dumpleton at gmail.com  Wed Nov 21 04:35:39 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Wed Nov 21 04:35:57 2007
Subject: [SPAM] Re: [mod_python] How declared correctly the way in the
	pg.html to the apache server can resolv the script python correctl
In-Reply-To: <1195636785.9603.7.camel@ubuntuserver>
References: <1195636785.9603.7.camel@ubuntuserver>
Message-ID: <88e286470711210135i7cf95278i16ea77e1c5c9fb00@mail.gmail.com>

Depends. Main file for publisher stuff needs to be in directory
exposed by Apache. Thus, whether you split top level functions across
multiple files makes no difference as still in exposed directory.

What people often do to limit risk, especially if stuff like database
logins and passwords in files, is to put the bulk of code in totally
distinct Python modules located outside of the exposed directory and
found via import by directory listed in sys.path. Ie., main publisher
file would then just have:

  from import myapplication.main index

That way if Apache configuration is screwed up, only part of your code
that someone may inadvertently see is that one line, which isn't
particularly useful to them.

Graham

On 21/11/2007, EdgardCosta <edgardalvescosta@gmail.com> wrote:
> Graham,
>
> Thanks and Sorry. I send yesterday two messages. One of then isn't
> complete. My sun push the enter and send the message.
>
> Only one question. If we can build a complete site in one file with the
> mod_pyhton, the security is better or not?
>
>
> --
> EdgardCosta <edgardalvescosta@gmail.com>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From simonrolin at gmail.com  Wed Nov 21 14:39:48 2007
From: simonrolin at gmail.com (Simon)
Date: Wed Nov 21 14:39:55 2007
Subject: [mod_python] Re: Mod_python Digest, Vol 56, Issue 21
In-Reply-To: <200711211700.lALH0FLt022797@modpython.org>
References: <200711211700.lALH0FLt022797@modpython.org>
Message-ID: <6e86106f0711211139o11f4ff38je329229f5f12146c@mail.gmail.com>

Hi all of you,

I'm new to modpython and I'm actually facing some problem when trying to
upload file.... I've read a lot but have not found any answer...

Here is my HTML of my form:

<form action=Upload2.py method=Post enctype="mutlipart/form-data">

<input type="file" name="file" value=""><div class="button"><input
type="submit" name="submit" value="Rechercher" class="submit"
/></div></form>


and here is Upload2 function:

def Upload2(req):
    timer = ExecTime()
    _session(req)
    myPage = page.Page(req,"Ajouter une photo")
    fileitem = req.form['file']
    myPage.add("Type is :" + str(type(fileitem)) + "<br />")
    if fileitem.filename:
        import os
        # strip leading path from file name to avoid directory traversal
attacks
        fname = os.path.basename(fileitem.filename)
        # build absolute path to files directory
        dir_path = os.path.join(os.path.dirname(req.filename), 'files')
        open(os.path.join(dir_path, fname), 'wb').write(fileitem.file.read
())
        myPage.add("The file" + fname)
    else:
        myPage.add('No file was uploaded')
        myPage.add(str(req.form))
    myPage.execTime = timer.stop()
    myPage.send()


myPage being a class to generate the page....

and here is the result...:
Type is :
No file was uploaded{'submit': [Field('submit', 'Rechercher')], 'file':
[Field('file', '08 - Big Furry Head.m4a')]}

Does someone have any idea of what's going wrong????

It would be really great because it's actually 4 day's I'm trying to find an
answer but without any succes...

I promise you I'have really search a lot before sending you this email....

Thanks a lot for your answers!

Simon
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20071121/49970fbb/attachment.html
From simonrolin at gmail.com  Wed Nov 21 14:41:59 2007
From: simonrolin at gmail.com (Simon)
Date: Wed Nov 21 14:42:07 2007
Subject: [mod_python] subscribe Uploading file troubles...
Message-ID: <6e86106f0711211141s68e72d57pbcbf2fad9673d2fa@mail.gmail.com>

---------- Forwarded message ----------
From: Simon <simonrolin@gmail.com>
Date: 21 nov. 2007 20:39
Subject: Re: Mod_python Digest, Vol 56, Issue 21
To: mod_python@modpython.org

Hi all of you,

I'm new to modpython and I'm actually facing some problem when trying to
upload file.... I've read a lot but have not found any answer...

Here is my HTML of my form:

<form action=Upload2.py method=Post
enctype="mutlipart/form-data">

<input type=
"file" name="file" value=""><
div class="button"><input type=
"submit" name="submit" value="Rechercher" class="submit" /></div></
form>


and here is Upload2 function:

def Upload2(req):
    timer = ExecTime()
    _session(req)
    myPage = page.Page(req,"Ajouter une photo")
    fileitem = req.form['file']
    myPage.add("Type is :" + str(type(fileitem)) + "<br />")
    if fileitem.filename:
        import os
        # strip leading path from file name to avoid directory traversal
attacks
        fname = os.path.basename(fileitem.filename)
        # build absolute path to files directory
        dir_path = os.path.join(os.path.dirname(req.filename), 'files')
        open(os.path.join(dir_path, fname), 'wb').write( fileitem.file.read
())
        myPage.add("The file" + fname)
    else:
        myPage.add('No file was uploaded')
        myPage.add(str(req.form))
    myPage.execTime = timer.stop()
    myPage.send()


myPage being a class to generate the page....

and here is the result...:
Type is :
No file was uploaded{'submit': [Field('submit', 'Rechercher')], 'file':
[Field('file', '08 - Big Furry Head.m4a')]}

Does someone have any idea of what's going wrong????

It would be really great because it's actually 4 day's I'm trying to find an
answer but without any succes...

I promise you I'have really search a lot before sending you this email....

Thanks a lot for your answers!

Simon


-- 
--  :-) Simon Rolin ;-)  --
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20071121/8adecc23/attachment.html
From graham.dumpleton at gmail.com  Wed Nov 21 17:14:28 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Wed Nov 21 17:14:33 2007
Subject: [mod_python] subscribe Uploading file troubles...
In-Reply-To: <6e86106f0711211141s68e72d57pbcbf2fad9673d2fa@mail.gmail.com>
References: <6e86106f0711211141s68e72d57pbcbf2fad9673d2fa@mail.gmail.com>
Message-ID: <88e286470711211414h5d8b2d55vfb4970afd934c24@mail.gmail.com>

On 22/11/2007, Simon <simonrolin@gmail.com> wrote:
>
>
> ---------- Forwarded message ----------
> From: Simon <simonrolin@gmail.com>
> Date: 21 nov. 2007 20:39
>  Subject: Re: Mod_python Digest, Vol 56, Issue 21
> To: mod_python@modpython.org
>
> Hi all of you,
>
> I'm new to modpython and I'm actually facing some problem when trying to
> upload file.... I've read a lot but have not found any answer...
>
> Here is my HTML of my form:
> <form action=Upload2.py method=Post
> enctype="mutlipart/form-data">
>
> <input type=
> "file" name="file" value=""><
> div class="button"><input type=
> "submit" name="submit" value="Rechercher"
> class="submit" /></div></
> form>
>
> and here is Upload2 function:
>
> def Upload2(req):
>     timer = ExecTime()
>     _session(req)
>     myPage = page.Page(req,"Ajouter une photo")
>     fileitem = req.form['file']
>     myPage.add("Type is :" + str(type(fileitem)) + "<br />")

A Python type string has <> characters in it. Parse it through
cgi.escape() so you can view the actual type string. Then repost
output as at the moment can't tell what the type is.

Graham

>     if fileitem.filename:
>         import os
>         # strip leading path from file name to avoid directory traversal
> attacks
>         fname = os.path.basename(fileitem.filename)
>         # build absolute path to files directory
>         dir_path = os.path.join(os.path.dirname(req.filename), 'files')
>         open(os.path.join(dir_path, fname), 'wb').write(
> fileitem.file.read())
>         myPage.add("The file" + fname)
>     else:
>         myPage.add('No file was uploaded')
>         myPage.add(str(req.form))
>     myPage.execTime = timer.stop()
>     myPage.send()
>
>
> myPage being a class to generate the page....
>
> and here is the result...:
> Type is :
> No file was uploaded{'submit': [Field('submit', 'Rechercher')], 'file':
> [Field('file', '08 - Big Furry Head.m4a')]}
>
> Does someone have any idea of what's going wrong????
>
> It would be really great because it's actually 4 day's I'm trying to find an
> answer but without any succes...
>
> I promise you I'have really search a lot before sending you this email....
>
> Thanks a lot for your answers!
>
> Simon
>
>
> --
> --  :-) Simon Rolin ;-)  --
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
From simonrolin at gmail.com  Wed Nov 21 19:49:33 2007
From: simonrolin at gmail.com (Simon)
Date: Wed Nov 21 19:49:41 2007
Subject: Fwd: [mod_python] subscribe Uploading file troubles...
In-Reply-To: <6e86106f0711211648m57920698re50864f41b50e9ea@mail.gmail.com>
References: <6e86106f0711211141s68e72d57pbcbf2fad9673d2fa@mail.gmail.com>
	<88e286470711211414h5d8b2d55vfb4970afd934c24@mail.gmail.com>
	<6e86106f0711211648m57920698re50864f41b50e9ea@mail.gmail.com>
Message-ID: <6e86106f0711211649k1e8a21d3t9f74bc44629f74c2@mail.gmail.com>

---------- Forwarded message ----------
From: Simon <simonrolin@gmail.com>
Date: 22 nov. 2007 01:48
Subject: Re: [mod_python] subscribe Uploading file troubles...
To: Graham Dumpleton <graham.dumpleton@gmail.com>



2007/11/21, Graham Dumpleton <graham.dumpleton@gmail.com>:
>
> On 22/11/2007, Simon <simonrolin@gmail.com> wrote:
> >
> >
> > ---------- Forwarded message ----------
> > From: Simon < simonrolin@gmail.com>
> > Date: 21 nov. 2007 20:39
> >  Subject: Re: Mod_python Digest, Vol 56, Issue 21
> > To: mod_python@modpython.org
> >
> > Hi all of you,
> >
> > I'm new to modpython and I'm actually facing some problem when trying to
> > upload file.... I've read a lot but have not found any answer...
> >
> > Here is my HTML of my form:
> > <form action=Upload2.py method=Post
> > enctype="mutlipart/form-data">
> >
> > <input type=
> > "file" name="file" value=""><
> > div class="button"><input type=
> > "submit" name="submit" value="Rechercher"
> > class="submit" /></div></
> > form>
> >
> > and here is Upload2 function:
> >
> > def Upload2(req):
> >     timer = ExecTime()
> >     _session(req)
> >     myPage = page.Page(req,"Ajouter une photo")
> >     fileitem = req.form['file']
> >     myPage.add("Type is :" + str(type(fileitem)) + "<br />")
>
> A Python type string has <> characters in it. Parse it through
> cgi.escape() so you can view the actual type string. Then repost
> output as at the moment can't tell what the type is.
>
> Graham


Graham, thanks for answering so fast....

So, fileitem or req.form['file'] is from type <class
'mod_python.util.StringField'
>...
If I do the same with fileitem.file, i have : <type ' cStringIO.StringI'>

Any idea? Why does fileitem.filename is None?

Thanks a lot for your help, really great!

Simon

>     if fileitem.filename:
> >         import os
> >         # strip leading path from file name to avoid directory traversal
>
> > attacks
> >         fname = os.path.basename(fileitem.filename)
> >         # build absolute path to files directory
> >         dir_path = os.path.join(os.path.dirname(req.filename), 'files')
> >         open(os.path.join(dir_path, fname), 'wb').write(
> > fileitem.file.read())
> >         myPage.add("The file" + fname)
> >     else:
> >         myPage.add('No file was uploaded')
> >         myPage.add(str(req.form))
> >     myPage.execTime = timer.stop()
> >     myPage.send()
> >
> >
> > myPage being a class to generate the page....
> >
> > and here is the result...:
> > Type is :
> > No file was uploaded{'submit': [Field('submit', 'Rechercher')], 'file':
> > [Field('file', '08 - Big Furry Head.m4a')]}
> >
> > Does someone have any idea of what's going wrong????
> >
> > It would be really great because it's actually 4 day's I'm trying to
> find an
> > answer but without any succes...
> >
> > I promise you I'have really search a lot before sending you this
> email....
> >
> > Thanks a lot for your answers!
> >
> > Simon
> >
> >
> > --
> > --  :-) Simon Rolin ;-)  --
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
> >
>



-- 
--  :-) Simon Rolin ;-)  --

-- 
--  :-) Simon Rolin ;-)  --
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20071122/0f7d7b04/attachment-0001.html
From graham.dumpleton at gmail.com  Wed Nov 21 19:55:57 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Wed Nov 21 19:56:05 2007
Subject: [mod_python] subscribe Uploading file troubles...
In-Reply-To: <6e86106f0711211649k1e8a21d3t9f74bc44629f74c2@mail.gmail.com>
References: <6e86106f0711211141s68e72d57pbcbf2fad9673d2fa@mail.gmail.com>
	<88e286470711211414h5d8b2d55vfb4970afd934c24@mail.gmail.com>
	<6e86106f0711211648m57920698re50864f41b50e9ea@mail.gmail.com>
	<6e86106f0711211649k1e8a21d3t9f74bc44629f74c2@mail.gmail.com>
Message-ID: <88e286470711211655l292b26aaqfb928b33ef42367b@mail.gmail.com>

Do you get the same if you remove:

  value=""

from options for file upload form input element.

Sorry, I don't do file upload stuff very often so just comparing it to:

  http://webpython.codepoint.net/mod_python_publisher_file_upload

and I see that as a difference.

BTW, what version of mod_python are you using? Hope you aren't using a
really old version and following documentation for newer version.

Graham

On 22/11/2007, Simon <simonrolin@gmail.com> wrote:
>
>
> ---------- Forwarded message ----------
> From: Simon <simonrolin@gmail.com>
> Date: 22 nov. 2007 01:48
>  Subject: Re: [mod_python] subscribe Uploading file troubles...
> To: Graham Dumpleton <graham.dumpleton@gmail.com>
>
>
>
>  2007/11/21, Graham Dumpleton <graham.dumpleton@gmail.com>:
>
> > On 22/11/2007, Simon <simonrolin@gmail.com> wrote:
> > >
> > >
> > > ---------- Forwarded message ----------
> > > From: Simon < simonrolin@gmail.com>
> > > Date: 21 nov. 2007 20:39
> > >  Subject: Re: Mod_python Digest, Vol 56, Issue 21
> > > To: mod_python@modpython.org
> > >
> > > Hi all of you,
> > >
> > > I'm new to modpython and I'm actually facing some problem when trying to
> > > upload file.... I've read a lot but have not found any answer...
> > >
> > > Here is my HTML of my form:
> > > <form action=Upload2.py method=Post
> > > enctype="mutlipart/form-data">
> > >
> > > <input type=
> > > "file" name="file" value=""><
> > > div class="button"><input type=
> > > "submit" name="submit" value="Rechercher"
> > > class="submit" /></div></
> > > form>
> > >
> > > and here is Upload2 function:
> > >
> > > def Upload2(req):
> > >     timer = ExecTime()
> > >     _session(req)
> > >     myPage = page.Page(req,"Ajouter une photo")
> > >     fileitem = req.form['file']
> > >     myPage.add("Type is :" + str(type(fileitem)) + "<br />")
> >
> > A Python type string has <> characters in it. Parse it through
> > cgi.escape() so you can view the actual type string. Then repost
> > output as at the moment can't tell what the type is.
> >
> > Graham
>
>
> Graham, thanks for answering so fast....
>
>  So, fileitem or req.form['file'] is from type <class
> 'mod_python.util.StringField' >...
>  If I do the same with fileitem.file, i have : <type ' cStringIO.StringI'>
>
>  Any idea? Why does fileitem.filename is None?
>
>  Thanks a lot for your help, really great!
>
>  Simon
>
> > >     if fileitem.filename :
> > >         import os
> > >         # strip leading path from file name to avoid directory traversal
> > > attacks
> > >         fname = os.path.basename(fileitem.filename)
> > >         # build absolute path to files directory
> > >         dir_path = os.path.join(os.path.dirname(req.filename), 'files')
> > >         open(os.path.join(dir_path, fname), 'wb').write(
> > > fileitem.file.read())
> > >         myPage.add("The file" + fname)
> > >     else:
> > >         myPage.add('No file was uploaded')
> > >         myPage.add(str(req.form))
> > >     myPage.execTime = timer.stop()
> > >     myPage.send()
> > >
> > >
> > > myPage being a class to generate the page....
> > >
> > > and here is the result...:
> > > Type is :
> > > No file was uploaded{'submit': [Field('submit', 'Rechercher')], 'file':
> > > [Field('file', '08 - Big Furry Head.m4a')]}
> > >
> > > Does someone have any idea of what's going wrong????
> > >
> > > It would be really great because it's actually 4 day's I'm trying to
> find an
> > > answer but without any succes...
> > >
> > > I promise you I'have really search a lot before sending you this
> email....
> > >
> > > Thanks a lot for your answers!
> > >
> > > Simon
> > >
> > >
> > > --
> > > --  :-) Simon Rolin ;-)  --
> > > _______________________________________________
> > > Mod_python mailing list
> > > Mod_python@modpython.org
> > >
> http://mailman.modpython.org/mailman/listinfo/mod_python
> > >
> > >
> >
>
>
>
> --
> --  :-) Simon Rolin ;-)  --
>
> --
> --  :-) Simon Rolin ;-)  --
From simonrolin at gmail.com  Wed Nov 21 20:14:25 2007
From: simonrolin at gmail.com (Simon)
Date: Wed Nov 21 20:14:33 2007
Subject: [mod_python] subscribe Uploading file troubles...
In-Reply-To: <88e286470711211655l292b26aaqfb928b33ef42367b@mail.gmail.com>
References: <6e86106f0711211141s68e72d57pbcbf2fad9673d2fa@mail.gmail.com>
	<88e286470711211414h5d8b2d55vfb4970afd934c24@mail.gmail.com>
	<6e86106f0711211648m57920698re50864f41b50e9ea@mail.gmail.com>
	<6e86106f0711211649k1e8a21d3t9f74bc44629f74c2@mail.gmail.com>
	<88e286470711211655l292b26aaqfb928b33ef42367b@mail.gmail.com>
Message-ID: <6e86106f0711211714s3ccfafc4p85f2839e3e98dca3@mail.gmail.com>

Thanks for your (again) very fast answer...
Unfortunately, I'm getting the same results without the value=""...
About versions, 'SERVER_SOFTWARE': 'Apache/2.2.4 (Ubuntu) mod_python/3.3.1
Python/2.5.1'...
Do you think I could be linked to the version I'm using? Should I try with
another one?

Simon

2007/11/22, Graham Dumpleton <graham.dumpleton@gmail.com>:
>
> Do you get the same if you remove:
>
>   value=""
>
> from options for file upload form input element.
>
> Sorry, I don't do file upload stuff very often so just comparing it to:
>
>   http://webpython.codepoint.net/mod_python_publisher_file_upload
>
> and I see that as a difference.
>
> BTW, what version of mod_python are you using? Hope you aren't using a
> really old version and following documentation for newer version.
>
> Graham
>
> On 22/11/2007, Simon <simonrolin@gmail.com> wrote:
> >
> >
> > ---------- Forwarded message ----------
> > From: Simon <simonrolin@gmail.com>
> > Date: 22 nov. 2007 01:48
> >  Subject: Re: [mod_python] subscribe Uploading file troubles...
> > To: Graham Dumpleton <graham.dumpleton@gmail.com>
> >
> >
> >
> >  2007/11/21, Graham Dumpleton <graham.dumpleton@gmail.com>:
> >
> > > On 22/11/2007, Simon <simonrolin@gmail.com> wrote:
> > > >
> > > >
> > > > ---------- Forwarded message ----------
> > > > From: Simon < simonrolin@gmail.com>
> > > > Date: 21 nov. 2007 20:39
> > > >  Subject: Re: Mod_python Digest, Vol 56, Issue 21
> > > > To: mod_python@modpython.org
> > > >
> > > > Hi all of you,
> > > >
> > > > I'm new to modpython and I'm actually facing some problem when
> trying to
> > > > upload file.... I've read a lot but have not found any answer...
> > > >
> > > > Here is my HTML of my form:
> > > > <form action=Upload2.py method=Post
> > > > enctype="mutlipart/form-data">
> > > >
> > > > <input type=
> > > > "file" name="file" value=""><
> > > > div class="button"><input type=
> > > > "submit" name="submit" value="Rechercher"
> > > > class="submit" /></div></
> > > > form>
> > > >
> > > > and here is Upload2 function:
> > > >
> > > > def Upload2(req):
> > > >     timer = ExecTime()
> > > >     _session(req)
> > > >     myPage = page.Page(req,"Ajouter une photo")
> > > >     fileitem = req.form['file']
> > > >     myPage.add("Type is :" + str(type(fileitem)) + "<br />")
> > >
> > > A Python type string has <> characters in it. Parse it through
> > > cgi.escape() so you can view the actual type string. Then repost
> > > output as at the moment can't tell what the type is.
> > >
> > > Graham
> >
> >
> > Graham, thanks for answering so fast....
> >
> >  So, fileitem or req.form['file'] is from type <class
> > 'mod_python.util.StringField' >...
> >  If I do the same with fileitem.file, i have : <type ' cStringIO.StringI
> '>
> >
> >  Any idea? Why does fileitem.filename is None?
> >
> >  Thanks a lot for your help, really great!
> >
> >  Simon
> >
> > > >     if fileitem.filename :
> > > >         import os
> > > >         # strip leading path from file name to avoid directory
> traversal
> > > > attacks
> > > >         fname = os.path.basename(fileitem.filename)
> > > >         # build absolute path to files directory
> > > >         dir_path = os.path.join(os.path.dirname(req.filename),
> 'files')
> > > >         open(os.path.join(dir_path, fname), 'wb').write(
> > > > fileitem.file.read())
> > > >         myPage.add("The file" + fname)
> > > >     else:
> > > >         myPage.add('No file was uploaded')
> > > >         myPage.add(str(req.form))
> > > >     myPage.execTime = timer.stop()
> > > >     myPage.send()
> > > >
> > > >
> > > > myPage being a class to generate the page....
> > > >
> > > > and here is the result...:
> > > > Type is :
> > > > No file was uploaded{'submit': [Field('submit', 'Rechercher')],
> 'file':
> > > > [Field('file', '08 - Big Furry Head.m4a')]}
> > > >
> > > > Does someone have any idea of what's going wrong????
> > > >
> > > > It would be really great because it's actually 4 day's I'm trying to
> > find an
> > > > answer but without any succes...
> > > >
> > > > I promise you I'have really search a lot before sending you this
> > email....
> > > >
> > > > Thanks a lot for your answers!
> > > >
> > > > Simon
> > > >
> > > >
> > > > --
> > > > --  :-) Simon Rolin ;-)  --
> > > > _______________________________________________
> > > > Mod_python mailing list
> > > > Mod_python@modpython.org
> > > >
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> > > >
> > > >
> > >
> >
> >
> >
> > --
> > --  :-) Simon Rolin ;-)  --
> >
> > --
> > --  :-) Simon Rolin ;-)  --
>



-- 
--  :-) Simon Rolin ;-)  --
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20071122/06a6dd9d/attachment.html
From graham.dumpleton at gmail.com  Wed Nov 21 22:23:21 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Wed Nov 21 22:23:28 2007
Subject: [mod_python] subscribe Uploading file troubles...
In-Reply-To: <6e86106f0711211714s3ccfafc4p85f2839e3e98dca3@mail.gmail.com>
References: <6e86106f0711211141s68e72d57pbcbf2fad9673d2fa@mail.gmail.com>
	<88e286470711211414h5d8b2d55vfb4970afd934c24@mail.gmail.com>
	<6e86106f0711211648m57920698re50864f41b50e9ea@mail.gmail.com>
	<6e86106f0711211649k1e8a21d3t9f74bc44629f74c2@mail.gmail.com>
	<88e286470711211655l292b26aaqfb928b33ef42367b@mail.gmail.com>
	<6e86106f0711211714s3ccfafc4p85f2839e3e98dca3@mail.gmail.com>
Message-ID: <88e286470711211923s221c23dax64f12986b0e111fc@mail.gmail.com>

Do you really have:

  enctype="mutlipart/form-data"

Maybe check the spelling. :-)

Graham

On 22/11/2007, Simon <simonrolin@gmail.com> wrote:
> Thanks for your (again) very fast answer...
> Unfortunately, I'm getting the same results without the value=""...
> About versions, 'SERVER_SOFTWARE': 'Apache/2.2.4 (Ubuntu) mod_python/3.3.1
> Python/2.5.1'...
> Do you think I could be linked to the version I'm using? Should I try with
> another one?
>
> Simon
>
> 2007/11/22, Graham Dumpleton < graham.dumpleton@gmail.com>:
> > Do you get the same if you remove:
> >
> >   value=""
> >
> > from options for file upload form input element.
> >
> > Sorry, I don't do file upload stuff very often so just comparing it to:
> >
> >
> http://webpython.codepoint.net/mod_python_publisher_file_upload
> >
> > and I see that as a difference.
> >
> > BTW, what version of mod_python are you using? Hope you aren't using a
> > really old version and following documentation for newer version.
> >
> > Graham
> >
> > On 22/11/2007, Simon <simonrolin@gmail.com> wrote:
> > >
> > >
> > > ---------- Forwarded message ----------
> > > From: Simon < simonrolin@gmail.com>
> > > Date: 22 nov. 2007 01:48
> > >  Subject: Re: [mod_python] subscribe Uploading file troubles...
> > > To: Graham Dumpleton <graham.dumpleton@gmail.com >
> > >
> > >
> > >
> > >  2007/11/21, Graham Dumpleton <graham.dumpleton@gmail.com>:
> > >
> > > > On 22/11/2007, Simon < simonrolin@gmail.com> wrote:
> > > > >
> > > > >
> > > > > ---------- Forwarded message ----------
> > > > > From: Simon < simonrolin@gmail.com >
> > > > > Date: 21 nov. 2007 20:39
> > > > >  Subject: Re: Mod_python Digest, Vol 56, Issue 21
> > > > > To: mod_python@modpython.org
> > > > >
> > > > > Hi all of you,
> > > > >
> > > > > I'm new to modpython and I'm actually facing some problem when
> trying to
> > > > > upload file.... I've read a lot but have not found any answer...
> > > > >
> > > > > Here is my HTML of my form:
> > > > > <form action=Upload2.py method=Post
> > > > > enctype="mutlipart/form-data">
> > > > >
> > > > > <input type=
> > > > > "file" name="file" value=""><
> > > > > div class="button"><input type=
> > > > > "submit" name="submit" value="Rechercher"
> > > > > class="submit" /></div></
> > > > > form>
> > > > >
> > > > > and here is Upload2 function:
> > > > >
> > > > > def Upload2(req):
> > > > >     timer = ExecTime()
> > > > >     _session(req)
> > > > >     myPage = page.Page(req,"Ajouter une photo")
> > > > >     fileitem = req.form['file']
> > > > >     myPage.add("Type is :" + str(type(fileitem)) + "<br />")
> > > >
> > > > A Python type string has <> characters in it. Parse it through
> > > > cgi.escape() so you can view the actual type string. Then repost
> > > > output as at the moment can't tell what the type is.
> > > >
> > > > Graham
> > >
> > >
> > > Graham, thanks for answering so fast....
> > >
> > >  So, fileitem or req.form['file'] is from type <class
> > > 'mod_python.util.StringField' >...
> > >  If I do the same with fileitem.file, i have : <type '
> cStringIO.StringI'>
> > >
> > >  Any idea? Why does fileitem.filename is None?
> > >
> > >  Thanks a lot for your help, really great!
> > >
> > >  Simon
> > >
> > > > >     if fileitem.filename :
> > > > >         import os
> > > > >         # strip leading path from file name to avoid directory
> traversal
> > > > > attacks
> > > > >         fname = os.path.basename(fileitem.filename)
> > > > >         # build absolute path to files directory
> > > > >         dir_path = os.path.join(os.path.dirname(req.filename),
> 'files')
> > > > >         open(os.path.join(dir_path, fname), 'wb').write(
> > > > > fileitem.file.read())
> > > > >         myPage.add("The file" + fname)
> > > > >     else:
> > > > >         myPage.add('No file was uploaded')
> > > > >         myPage.add(str(req.form))
> > > > >     myPage.execTime = timer.stop()
> > > > >     myPage.send()
> > > > >
> > > > >
> > > > > myPage being a class to generate the page....
> > > > >
> > > > > and here is the result...:
> > > > > Type is :
> > > > > No file was uploaded{'submit': [Field('submit', 'Rechercher')],
> 'file':
> > > > > [Field('file', '08 - Big Furry Head.m4a')]}
> > > > >
> > > > > Does someone have any idea of what's going wrong????
> > > > >
> > > > > It would be really great because it's actually 4 day's I'm trying to
> > > find an
> > > > > answer but without any succes...
> > > > >
> > > > > I promise you I'have really search a lot before sending you this
> > > email....
> > > > >
> > > > > Thanks a lot for your answers!
> > > > >
> > > > > Simon
> > > > >
> > > > >
> > > > > --
> > > > > --  :-) Simon Rolin ;-)  --
> > > > > _______________________________________________
> > > > > Mod_python mailing list
> > > > > Mod_python@modpython.org
> > > > >
> > >
> http://mailman.modpython.org/mailman/listinfo/mod_python
> > > > >
> > > > >
> > > >
> > >
> > >
> > >
> > > --
> > > --  :-) Simon Rolin ;-)  --
> > >
> > > --
> > > --  :-) Simon Rolin ;-)  --
> >
>
>
>
> --
> --  :-) Simon Rolin ;-)  --
From clodoaldo.pinto.neto at gmail.com  Thu Nov 22 05:35:52 2007
From: clodoaldo.pinto.neto at gmail.com (Clodoaldo)
Date: Thu Nov 22 05:36:01 2007
Subject: [mod_python] subscribe Uploading file troubles...
In-Reply-To: <6e86106f0711211649k1e8a21d3t9f74bc44629f74c2@mail.gmail.com>
References: <6e86106f0711211141s68e72d57pbcbf2fad9673d2fa@mail.gmail.com>
	<88e286470711211414h5d8b2d55vfb4970afd934c24@mail.gmail.com>
	<6e86106f0711211648m57920698re50864f41b50e9ea@mail.gmail.com>
	<6e86106f0711211649k1e8a21d3t9f74bc44629f74c2@mail.gmail.com>
Message-ID: <a595de7a0711220235u4c31a006lb842f5d8c8a0167e@mail.gmail.com>

2007/11/21, Simon <simonrolin@gmail.com>:
>
>
> ---------- Forwarded message ----------
> From: Simon <simonrolin@gmail.com>
> Date: 22 nov. 2007 01:48
>  Subject: Re: [mod_python] subscribe Uploading file troubles...
> To: Graham Dumpleton <graham.dumpleton@gmail.com>
>
>
>
>
>  2007/11/21, Graham Dumpleton <graham.dumpleton@gmail.com>:
>
> > On 22/11/2007, Simon <simonrolin@gmail.com> wrote:
> > >
> > >
> > > ---------- Forwarded message ----------
> > > From: Simon < simonrolin@gmail.com>
> > > Date: 21 nov. 2007 20:39
> > >  Subject: Re: Mod_python Digest, Vol 56, Issue 21
> > > To: mod_python@modpython.org
> > >
> > > Hi all of you,
> > >
> > > I'm new to modpython and I'm actually facing some problem when trying to
> > > upload file.... I've read a lot but have not found any answer...
> > >
> > > Here is my HTML of my form:
> > > <form action=Upload2.py method=Post
> > > enctype="mutlipart/form-data">
> > >
> > > <input type=
> > > "file" name="file" value=""><
> > > div class="button"><input type=
> > > "submit" name="submit" value="Rechercher"
> > > class="submit" /></div></
> > > form>
> > >
> > > and here is Upload2 function:
> > >
> > > def Upload2(req):
> > >     timer = ExecTime()
> > >     _session(req)
> > >     myPage = page.Page(req,"Ajouter une photo")
> > >     fileitem = req.form['file']
> > >     myPage.add("Type is :" + str(type(fileitem)) + "<br />")
> >
> > A Python type string has <> characters in it. Parse it through
> > cgi.escape() so you can view the actual type string. Then repost
> > output as at the moment can't tell what the type is.
> >
> > Graham
>
>
> Graham, thanks for answering so fast....
>
>  So, fileitem or req.form['file'] is from type <class
> 'mod_python.util.StringField' >...
>  If I do the same with fileitem.file, i have : <type ' cStringIO.StringI'>
>
>  Any idea? Why does fileitem.filename is None?
>
>  Thanks a lot for your help, really great!

In a very fast test this is what I get for this code:

      message = 'fileitem: "%s" fileitem.file "%s"' % \
      (cgi.escape(str(fileitem)), cgi.escape(str(fileitem.file)))

fileitem: "Field('file',
'[settings]\nusername=Kakao\nteam=13802\nasknet=no\nmachineid=1\nlocal=162\n\n[http]\nactive=no\nhost=localhost\nport=8080\n\n')"
fileitem.file "<open file '<fdopen>', mode 'w+b' at 0xb7a95698>"


fileitem is of type Field as the manual says it should be. I'm leaving
to work now and i will try again to night.

Clodoaldo Pinto Neto
From edgardalvescosta at gmail.com  Thu Nov 22 05:42:35 2007
From: edgardalvescosta at gmail.com (EdgardCosta)
Date: Thu Nov 22 05:41:43 2007
Subject: [mod_python] mod_python and other web server that not apache
Message-ID: <1195728155.10027.10.camel@ubuntuserver>

Hi

I receved a question in other maillist that anserwer if the python can
run in other webserver whitout be the apache.
I think that the apache is the only one. Or Iam wrong?
-- 
EdgardCosta <edgardalvescosta@gmail.com>

From graham.dumpleton at gmail.com  Thu Nov 22 06:19:00 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu Nov 22 06:19:10 2007
Subject: [mod_python] mod_python and other web server that not apache
In-Reply-To: <1195728155.10027.10.camel@ubuntuserver>
References: <1195728155.10027.10.camel@ubuntuserver>
Message-ID: <88e286470711220319l433836c3s76bd2dc9fa59f540@mail.gmail.com>

On 22/11/2007, EdgardCosta <edgardalvescosta@gmail.com> wrote:
> Hi
>
> I receved a question in other maillist that anserwer if the python can
> run in other webserver whitout be the apache.
> I think that the apache is the only one. Or Iam wrong?

Options for running web applications written in Python are as follows:

1. Web server is actually written in Python and Python web application
sits on top of that in the same process. This web server may be the
direct public facing web server, or may be hosted behind another web
server such as Apache, lighttpd or nginx, with requests being proxied
from the front end web server using the corresponding mod_proxy like
module for the front end web server. There are various web servers
available written in Python.

2. Python web application runs within an instance of the Python
interpreter which runs embedded within a web server which is written
in C. This option only currently exists for Apache. Two Apache modules
exist for this. These are mod_python and mod_wsgi
(http://www.modwsgi.org).

You obviously know about mod_python. Whereas mod_python provides its
own specific APIs and thus a web application written direct for that
isn't portable to any other hosting option, in mod_wsgi the Python
WSGI standard is used. An application written to the Python WSGI
standard is portable to any of the options listed here. There are even
workable, although not perfect, WSGI adapters for mod_python.

3. Python web application runs within a daemon process separate to the
web server and requests are proxied from the web server to this daemon
process. The web server is written in C. Rather than HTTP protocol
being used as in option 1 above, an alternate protocol is used. There
are actually a number of different variations on this theme.

3a. In the case of the mod_wsgi module, it supports a daemon mode in
addition to embedded mode. It uses it own internal protocol for
proxying data. This is done as mod_wsgi daemon processes are a direct
fork of the Apache child processes and so they are tightly coupled.

3b. Next are solutions based on FASTGCI protocol for proxying of
request to daemon process. The daemon process can either be started
separately, or be forked from Apache, but then a distinct application
executed. The application run in this case would actually be the
Python executable. A module such as flup would be used which
understands the FASTCGI protocol thereby allowing communication with
the web server. Web applications may be written direct to flup
interface to FASTCGI protocol, or written to WSGI standard and a
flup/WSGI adapter used.

3c. Like 3b, but SCGI protocol used instead. The flup package would
still be used as it also supports SCGI.

3d. Like 3b, but AJP protocol used instead. The flup package would
still be used as it also supports AJP.

Although 3a, and I think 3c and 3d are specific to Apache, the FASTCGI
protocol described is also supported by lighttpd and nginx.

If you want the most portable option for writing a Python web
application, write it to the WSGI standard or use an existing
framework which supports that standard. That way you can use any of
the above options.

Hope this answers your question.

Graham
From clodoaldo.pinto.neto at gmail.com  Thu Nov 22 06:21:41 2007
From: clodoaldo.pinto.neto at gmail.com (Clodoaldo)
Date: Thu Nov 22 06:21:47 2007
Subject: [mod_python] mod_python and other web server that not apache
In-Reply-To: <1195728155.10027.10.camel@ubuntuserver>
References: <1195728155.10027.10.camel@ubuntuserver>
Message-ID: <a595de7a0711220321k41003661kb7b017c3081655f@mail.gmail.com>

2007/11/22, EdgardCosta <edgardalvescosta@gmail.com>:
> Hi
>
> I receved a question in other maillist that anserwer if the python can
> run in other webserver whitout be the apache.
> I think that the apache is the only one. Or Iam wrong?

mod_python is an apache module. It will only run in apache.

Regards,
Clodoaldo Pinto Neto
From graham.dumpleton at gmail.com  Thu Nov 22 06:24:14 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu Nov 22 06:24:18 2007
Subject: [mod_python] mod_python and other web server that not apache
In-Reply-To: <88e286470711220319l433836c3s76bd2dc9fa59f540@mail.gmail.com>
References: <1195728155.10027.10.camel@ubuntuserver>
	<88e286470711220319l433836c3s76bd2dc9fa59f540@mail.gmail.com>
Message-ID: <88e286470711220324j2ad3d686xbcbab8afab062874@mail.gmail.com>

Missed the following:

4. Use Python running as CGI script. Should be supported by most web
servers, but slow. :-)

Graham

On 22/11/2007, Graham Dumpleton <graham.dumpleton@gmail.com> wrote:
> On 22/11/2007, EdgardCosta <edgardalvescosta@gmail.com> wrote:
> > Hi
> >
> > I receved a question in other maillist that anserwer if the python can
> > run in other webserver whitout be the apache.
> > I think that the apache is the only one. Or Iam wrong?
>
> Options for running web applications written in Python are as follows:
>
> 1. Web server is actually written in Python and Python web application
> sits on top of that in the same process. This web server may be the
> direct public facing web server, or may be hosted behind another web
> server such as Apache, lighttpd or nginx, with requests being proxied
> from the front end web server using the corresponding mod_proxy like
> module for the front end web server. There are various web servers
> available written in Python.
>
> 2. Python web application runs within an instance of the Python
> interpreter which runs embedded within a web server which is written
> in C. This option only currently exists for Apache. Two Apache modules
> exist for this. These are mod_python and mod_wsgi
> (http://www.modwsgi.org).
>
> You obviously know about mod_python. Whereas mod_python provides its
> own specific APIs and thus a web application written direct for that
> isn't portable to any other hosting option, in mod_wsgi the Python
> WSGI standard is used. An application written to the Python WSGI
> standard is portable to any of the options listed here. There are even
> workable, although not perfect, WSGI adapters for mod_python.
>
> 3. Python web application runs within a daemon process separate to the
> web server and requests are proxied from the web server to this daemon
> process. The web server is written in C. Rather than HTTP protocol
> being used as in option 1 above, an alternate protocol is used. There
> are actually a number of different variations on this theme.
>
> 3a. In the case of the mod_wsgi module, it supports a daemon mode in
> addition to embedded mode. It uses it own internal protocol for
> proxying data. This is done as mod_wsgi daemon processes are a direct
> fork of the Apache child processes and so they are tightly coupled.
>
> 3b. Next are solutions based on FASTGCI protocol for proxying of
> request to daemon process. The daemon process can either be started
> separately, or be forked from Apache, but then a distinct application
> executed. The application run in this case would actually be the
> Python executable. A module such as flup would be used which
> understands the FASTCGI protocol thereby allowing communication with
> the web server. Web applications may be written direct to flup
> interface to FASTCGI protocol, or written to WSGI standard and a
> flup/WSGI adapter used.
>
> 3c. Like 3b, but SCGI protocol used instead. The flup package would
> still be used as it also supports SCGI.
>
> 3d. Like 3b, but AJP protocol used instead. The flup package would
> still be used as it also supports AJP.
>
> Although 3a, and I think 3c and 3d are specific to Apache, the FASTCGI
> protocol described is also supported by lighttpd and nginx.
>
> If you want the most portable option for writing a Python web
> application, write it to the WSGI standard or use an existing
> framework which supports that standard. That way you can use any of
> the above options.
>
> Hope this answers your question.
>
> Graham
>
From simonrolin at gmail.com  Thu Nov 22 12:32:22 2007
From: simonrolin at gmail.com (Simon)
Date: Thu Nov 22 12:32:32 2007
Subject: [mod_python]Uploading file troubles...
Message-ID: <6e86106f0711220932pad1cea2v3ace40e11e84182c@mail.gmail.com>

Graham, Clodoaldo,

I really want to thanks both of you, it works!

Before working with modpython I was working on zope3 but was unable to
receive some help and this is why is decided to change!

What you have done for me is really great and I promise I will do all what I
can to help the others with modpython!

Thanks a lot!

Simon

2007/11/22, Clodoaldo <clodoaldo.pinto.neto@gmail.com>:
>
> 2007/11/21, Simon <simonrolin@gmail.com>:
> >
> >
> > ---------- Forwarded message ----------
> > From: Simon <simonrolin@gmail.com >
> > Date: 22 nov. 2007 01:48
> >  Subject: Re: [mod_python] subscribe Uploading file troubles...
> > To: Graham Dumpleton <graham.dumpleton@gmail.com >
> >
> >
> >
> >
> >  2007/11/21, Graham Dumpleton <graham.dumpleton@gmail.com>:
> >
> > > On 22/11/2007, Simon < simonrolin@gmail.com> wrote:
> > > >
> > > >
> > > > ---------- Forwarded message ----------
> > > > From: Simon < simonrolin@gmail.com >
> > > > Date: 21 nov. 2007 20:39
> > > >  Subject: Re: Mod_python Digest, Vol 56, Issue 21
> > > > To: mod_python@modpython.org
> > > >
> > > > Hi all of you,
> > > >
> > > > I'm new to modpython and I'm actually facing some problem when
> trying to
> > > > upload file.... I've read a lot but have not found any answer...
> > > >
> > > > Here is my HTML of my form:
> > > > <form action=Upload2.py method=Post
> > > > enctype="mutlipart/form-data">
> > > >
> > > > <input type=
> > > > "file" name="file" value=""><
> > > > div class="button"><input type=
> > > > "submit" name="submit" value="Rechercher"
> > > > class="submit" /></div></
> > > > form>
> > > >
> > > > and here is Upload2 function:
> > > >
> > > > def Upload2(req):
> > > >     timer = ExecTime()
> > > >     _session(req)
> > > >     myPage = page.Page(req,"Ajouter une photo")
> > > >     fileitem = req.form['file']
> > > >     myPage.add("Type is :" + str(type(fileitem)) + "<br />")
> > >
> > > A Python type string has <> characters in it. Parse it through
> > > cgi.escape() so you can view the actual type string. Then repost
> > > output as at the moment can't tell what the type is.
> > >
> > > Graham
> >
> >
> > Graham, thanks for answering so fast....
> >
> >  So, fileitem or req.form['file'] is from type <class
> > 'mod_python.util.StringField' >...
> >  If I do the same with fileitem.file, i have : <type ' cStringIO.StringI
> '>
> >
> >  Any idea? Why does fileitem.filename is None?
> >
> >  Thanks a lot for your help, really great!
>
> In a very fast test this is what I get for this code:
>
>       message = 'fileitem: "%s" fileitem.file "%s"' % \
>       (cgi.escape(str(fileitem)), cgi.escape(str(fileitem.file)))
>
> fileitem: "Field('file',
>
> '[settings]\nusername=Kakao\nteam=13802\nasknet=no\nmachineid=1\nlocal=162\n\n[http]\nactive=no\nhost=localhost\nport=8080\n\n')"
> fileitem.file "<open file '<fdopen>', mode 'w+b' at 0xb7a95698>"
>
>
> fileitem is of type Field as the manual says it should be. I'm leaving
> to work now and i will try again to night.
>
> Clodoaldo Pinto Neto
>



-- 
--  :-) Simon Rolin ;-)  --

-- 
--  :-) Simon Rolin ;-)  --
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20071122/0f41a0f8/attachment.html
From graham.dumpleton at gmail.com  Thu Nov 22 16:06:35 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu Nov 22 16:06:39 2007
Subject: [mod_python]Uploading file troubles...
In-Reply-To: <6e86106f0711220932pad1cea2v3ace40e11e84182c@mail.gmail.com>
References: <6e86106f0711220932pad1cea2v3ace40e11e84182c@mail.gmail.com>
Message-ID: <88e286470711221306u592e6663tf0c8ace8a4b4fbda@mail.gmail.com>

It will help us if you explain what the final problem was. Ie., what
you had to change to make it work.

Graham

On 23/11/2007, Simon <simonrolin@gmail.com> wrote:
> Graham, Clodoaldo,
>
> I really want to thanks both of you, it works!
>
> Before working with modpython I was working on zope3 but was unable to
> receive some help and this is why is decided to change!
>
> What you have done for me is really great and I promise I will do all what I
> can to help the others with modpython!
>
> Thanks a lot!
>
> Simon
>
> 2007/11/22, Clodoaldo <clodoaldo.pinto.neto@gmail.com >:
> > 2007/11/21, Simon <simonrolin@gmail.com>:
> > >
> > >
> > > ---------- Forwarded message ----------
> > > From: Simon <simonrolin@gmail.com >
> > > Date: 22 nov. 2007 01:48
> > >  Subject: Re: [mod_python] subscribe Uploading file troubles...
> > > To: Graham Dumpleton < graham.dumpleton@gmail.com >
> > >
> > >
> > >
> > >
> > >  2007/11/21, Graham Dumpleton <graham.dumpleton@gmail.com >:
> > >
> > > > On 22/11/2007, Simon < simonrolin@gmail.com> wrote:
> > > > >
> > > > >
> > > > > ---------- Forwarded message ----------
> > > > > From: Simon < simonrolin@gmail.com >
> > > > > Date: 21 nov. 2007 20:39
> > > > >  Subject: Re: Mod_python Digest, Vol 56, Issue 21
> > > > > To: mod_python@modpython.org
> > > > >
> > > > > Hi all of you,
> > > > >
> > > > > I'm new to modpython and I'm actually facing some problem when
> trying to
> > > > > upload file.... I've read a lot but have not found any answer...
> > > > >
> > > > > Here is my HTML of my form:
> > > > > <form action=Upload2.py method=Post
> > > > > enctype="mutlipart/form-data">
> > > > >
> > > > > <input type=
> > > > > "file" name="file" value=""><
> > > > > div class="button"><input type=
> > > > > "submit" name="submit" value="Rechercher"
> > > > > class="submit" /></div></
> > > > > form>
> > > > >
> > > > > and here is Upload2 function:
> > > > >
> > > > > def Upload2(req):
> > > > >     timer = ExecTime()
> > > > >     _session(req)
> > > > >     myPage = page.Page(req,"Ajouter une photo")
> > > > >     fileitem = req.form['file']
> > > > >     myPage.add("Type is :" + str(type(fileitem)) + "<br />")
> > > >
> > > > A Python type string has <> characters in it. Parse it through
> > > > cgi.escape() so you can view the actual type string. Then repost
> > > > output as at the moment can't tell what the type is.
> > > >
> > > > Graham
> > >
> > >
> > > Graham, thanks for answering so fast....
> > >
> > >  So, fileitem or req.form['file'] is from type <class
> > > 'mod_python.util.StringField' >...
> > >  If I do the same with fileitem.file, i have : <type '
> cStringIO.StringI'>
> > >
> > >  Any idea? Why does fileitem.filename is None?
> > >
> > >  Thanks a lot for your help, really great!
> >
> > In a very fast test this is what I get for this code:
> >
> >       message = 'fileitem: "%s" fileitem.file "%s"' % \
> >       (cgi.escape(str(fileitem)), cgi.escape(str(fileitem.file)))
> >
> > fileitem: "Field('file',
> >
> '[settings]\nusername=Kakao\nteam=13802\nasknet=no\nmachineid=1\nlocal=162\n\n[http]\nactive=no\nhost=localhost\nport=8080\n\n')"
> > fileitem.file "<open file '<fdopen>', mode 'w+b' at 0xb7a95698>"
> >
> >
> > fileitem is of type Field as the manual says it should be. I'm leaving
> > to work now and i will try again to night.
> >
> > Clodoaldo Pinto Neto
> >
>
>
>
> --
> --  :-) Simon Rolin ;-)  --
>
> --
> --  :-) Simon Rolin ;-)  --
From ruben at ozonomultimedia.com  Thu Nov 22 16:08:52 2007
From: ruben at ozonomultimedia.com (Ruben da Silva Iglesias)
Date: Thu Nov 22 16:08:57 2007
Subject: [mod_python] Session subdomains
Message-ID: <4745EFE4.4090603@ozonomultimedia.com>

I'm using Debian etch (Mod_python Version: 3.2.10-4)

I want to use the same session for xx.mydomain.com and yy.mydomain.com

In documentation (4.8.1) shows:

"In order to have a session which spans across common sub domains, you 
can specify the parent domain using the 
mod_python.session.application_domain  option ("PythonOption 
mod_python.session.application_domain mod_python.org" in server 
configuration)."

I put: "PythonOption mod_python.session.application_domain mydomain.com"
in virtual server apache file.

Ok, just done that, but... it did'nt work
Then i read the variable with req.get_options() and it's set!

I login in a subdomain, xx.domain.com and all works ok, i have a 
session, but when i change to the other subdomain i'm not logged in, the 
server sends my another session.

(in firefox-web developer-Cookies i see the two different session 
cookies established, one for each subdomain: HOST xx.mydomain.com and 
HOST yy.mydomain.com)

Can't version 3.2.10 do that?
I'm doing something wrong?

THANKS
Rub?n
From graham.dumpleton at gmail.com  Thu Nov 22 16:23:14 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu Nov 22 16:23:20 2007
Subject: [mod_python] Session subdomains
In-Reply-To: <4745EFE4.4090603@ozonomultimedia.com>
References: <4745EFE4.4090603@ozonomultimedia.com>
Message-ID: <88e286470711221323i24324955p7584a12a05586f3c@mail.gmail.com>

On 23/11/2007, Ruben da Silva Iglesias <ruben@ozonomultimedia.com> wrote:
> I'm using Debian etch (Mod_python Version: 3.2.10-4)
>
> I want to use the same session for xx.mydomain.com and yy.mydomain.com
>
> In documentation (4.8.1) shows:
>
> "In order to have a session which spans across common sub domains, you
> can specify the parent domain using the
> mod_python.session.application_domain  option ("PythonOption
> mod_python.session.application_domain mod_python.org" in server
> configuration)."
>
> I put: "PythonOption mod_python.session.application_domain mydomain.com"
> in virtual server apache file.
>
> Ok, just done that, but... it did'nt work
> Then i read the variable with req.get_options() and it's set!
>
> I login in a subdomain, xx.domain.com and all works ok, i have a
> session, but when i change to the other subdomain i'm not logged in, the
> server sends my another session.
>
> (in firefox-web developer-Cookies i see the two different session
> cookies established, one for each subdomain: HOST xx.mydomain.com and
> HOST yy.mydomain.com)
>
> Can't version 3.2.10 do that?
> I'm doing something wrong?

It is always a good idea to read the documentation for the version of
mod_python you are using.

http://www.modpython.org/live/mod_python-3.2.10/doc-html/

Do that and you will find that no such feature exists for the older
version you are using. In other words, you will need to upgrade to the
newest version of mod_python if you want this feature.

Graham
From ruben at ozonomultimedia.com  Thu Nov 22 17:15:58 2007
From: ruben at ozonomultimedia.com (Ruben da Silva Iglesias)
Date: Thu Nov 22 17:16:04 2007
Subject: [mod_python] Session subdomains
In-Reply-To: <88e286470711221323i24324955p7584a12a05586f3c@mail.gmail.com>
References: <4745EFE4.4090603@ozonomultimedia.com>
	<88e286470711221323i24324955p7584a12a05586f3c@mail.gmail.com>
Message-ID: <4745FF9E.7050203@ozonomultimedia.com>

GREAT!!
I FOUND your modification http://issues.apache.org/jira/browse/MODPYTHON-149

         if config.has_key("mod_python.session.application_domain"):
             c.domain = config["mod_python.session.application_domain"]

I overwrite the Session.py and it works!!


Graham Dumpleton escribi?:
> On 23/11/2007, Ruben da Silva Iglesias <ruben@ozonomultimedia.com> wrote:
>> I'm using Debian etch (Mod_python Version: 3.2.10-4)
>>
>> I want to use the same session for xx.mydomain.com and yy.mydomain.com
>>
>> In documentation (4.8.1) shows:
>>
>> "In order to have a session which spans across common sub domains, you
>> can specify the parent domain using the
>> mod_python.session.application_domain  option ("PythonOption
>> mod_python.session.application_domain mod_python.org" in server
>> configuration)."
>>
>> I put: "PythonOption mod_python.session.application_domain mydomain.com"
>> in virtual server apache file.
>>
>> Ok, just done that, but... it did'nt work
>> Then i read the variable with req.get_options() and it's set!
>>
>> I login in a subdomain, xx.domain.com and all works ok, i have a
>> session, but when i change to the other subdomain i'm not logged in, the
>> server sends my another session.
>>
>> (in firefox-web developer-Cookies i see the two different session
>> cookies established, one for each subdomain: HOST xx.mydomain.com and
>> HOST yy.mydomain.com)
>>
>> Can't version 3.2.10 do that?
>> I'm doing something wrong?
> 
> It is always a good idea to read the documentation for the version of
> mod_python you are using.
> 
> http://www.modpython.org/live/mod_python-3.2.10/doc-html/
> 
> Do that and you will find that no such feature exists for the older
> version you are using. In other words, you will need to upgrade to the
> newest version of mod_python if you want this feature.
> 
> Graham

From eyking at cs.dal.ca  Thu Nov 22 18:22:30 2007
From: eyking at cs.dal.ca (Paul Eyking)
Date: Thu Nov 22 18:22:36 2007
Subject: [mod_python] OS X Leopard mod_python issues (cont.)
Message-ID: <10EAE219-8AC8-4C1B-8B89-E3663871D37A@cs.dal.ca>

Hey all,

I saw the previous posts to this mailing list from the archives in  
October. I followed all of those instructions and (think) I've solved  
the issue regarding the module not being installed as a 4-way  
universal, however, now I'm getting a different error, has anyone seen  
this?

eyk@Pauls-Computer~$ sudo apachectl configtest
httpd: Syntax error on line 113 of /private/etc/apache2/httpd.conf:  
Cannot load /usr/libexec/apache2/mod_python.so into server: dlopen(/ 
usr/libexec/apache2/mod_python.so, 10): Symbol not found:  
_PyObject_GenericGetAttr\n  Referenced from: /usr/libexec/apache2/ 
mod_python.so\n  Expected in: dynamic lookup\n

Cheers,

Paul
From graham.dumpleton at gmail.com  Thu Nov 22 18:30:17 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu Nov 22 18:30:19 2007
Subject: [mod_python] OS X Leopard mod_python issues (cont.)
In-Reply-To: <10EAE219-8AC8-4C1B-8B89-E3663871D37A@cs.dal.ca>
References: <10EAE219-8AC8-4C1B-8B89-E3663871D37A@cs.dal.ca>
Message-ID: <88e286470711221530m6651cd1fjbc23be0c87fa84a4@mail.gmail.com>

On 23/11/2007, Paul Eyking <eyking@cs.dal.ca> wrote:
> Hey all,
>
> I saw the previous posts to this mailing list from the archives in
> October. I followed all of those instructions and (think) I've solved
> the issue regarding the module not being installed as a 4-way
> universal, however, now I'm getting a different error, has anyone seen
> this?
>
> eyk@Pauls-Computer~$ sudo apachectl configtest
> httpd: Syntax error on line 113 of /private/etc/apache2/httpd.conf:
> Cannot load /usr/libexec/apache2/mod_python.so into server: dlopen(/
> usr/libexec/apache2/mod_python.so, 10): Symbol not found:
> _PyObject_GenericGetAttr\n  Referenced from: /usr/libexec/apache2/
> mod_python.so\n  Expected in: dynamic lookup\n

What do you get when you run:

  otool -L /usr/libexec/apache2/mod_python.so

Are you using the standard Python 2.5 that comes with the box or some
other version you have installed separately?

Graham
From eyking at cs.dal.ca  Thu Nov 22 18:38:45 2007
From: eyking at cs.dal.ca (Paul Eyking)
Date: Thu Nov 22 18:38:51 2007
Subject: [mod_python] OS X Leopard mod_python issues (cont.)
In-Reply-To: <88e286470711221530m6651cd1fjbc23be0c87fa84a4@mail.gmail.com>
References: <10EAE219-8AC8-4C1B-8B89-E3663871D37A@cs.dal.ca>
	<88e286470711221530m6651cd1fjbc23be0c87fa84a4@mail.gmail.com>
Message-ID: <E5E2D74D-BC03-46ED-A251-6DCFE584721A@cs.dal.ca>

Here is the output from otool:

eyk@Pauls-Computer~/Sources/mod_python-3.3.1$ otool -L /usr/libexec/ 
apache2/mod_python.so
/usr/libexec/apache2/mod_python.so:
	/usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current  
version 111.0.0)
	/Library/Frameworks/Python.framework/Versions/2.5/Python  
(compatibility version 2.5.0, current version 2.5.0)
	/usr/lib/libgcc_s.1.dylib (compatibility version 1.0.0, current  
version 1.0.0)

Cheers,

Paul

On 22-Nov-07, at 7:30 PM, Graham Dumpleton wrote:

> On 23/11/2007, Paul Eyking <eyking@cs.dal.ca> wrote:
>> Hey all,
>>
>> I saw the previous posts to this mailing list from the archives in
>> October. I followed all of those instructions and (think) I've solved
>> the issue regarding the module not being installed as a 4-way
>> universal, however, now I'm getting a different error, has anyone  
>> seen
>> this?
>>
>> eyk@Pauls-Computer~$ sudo apachectl configtest
>> httpd: Syntax error on line 113 of /private/etc/apache2/httpd.conf:
>> Cannot load /usr/libexec/apache2/mod_python.so into server: dlopen(/
>> usr/libexec/apache2/mod_python.so, 10): Symbol not found:
>> _PyObject_GenericGetAttr\n  Referenced from: /usr/libexec/apache2/
>> mod_python.so\n  Expected in: dynamic lookup\n
>
> What do you get when you run:
>
>  otool -L /usr/libexec/apache2/mod_python.so
>
> Are you using the standard Python 2.5 that comes with the box or some
> other version you have installed separately?
>
> Graham

From graham.dumpleton at gmail.com  Thu Nov 22 18:47:27 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu Nov 22 18:47:30 2007
Subject: [mod_python] OS X Leopard mod_python issues (cont.)
In-Reply-To: <E5E2D74D-BC03-46ED-A251-6DCFE584721A@cs.dal.ca>
References: <10EAE219-8AC8-4C1B-8B89-E3663871D37A@cs.dal.ca>
	<88e286470711221530m6651cd1fjbc23be0c87fa84a4@mail.gmail.com>
	<E5E2D74D-BC03-46ED-A251-6DCFE584721A@cs.dal.ca>
Message-ID: <88e286470711221547gcc98b36p125242f32d622393@mail.gmail.com>

On 23/11/2007, Paul Eyking <eyking@cs.dal.ca> wrote:
> Here is the output from otool:
>
> eyk@Pauls-Computer~/Sources/mod_python-3.3.1$ otool -L /usr/libexec/
> apache2/mod_python.so
> /usr/libexec/apache2/mod_python.so:
>         /usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current
> version 111.0.0)
>         /Library/Frameworks/Python.framework/Versions/2.5/Python
> (compatibility version 2.5.0, current version 2.5.0)
>         /usr/lib/libgcc_s.1.dylib (compatibility version 1.0.0, current
> version 1.0.0)

What about my other question:

Are you using the standard Python 2.5 that comes with the box or some
other version you have installed separately?

Of for that matter, do you have any other versions of Python installed?

On a Leopard system there shouldn't be a
'/Library/Frameworks/Python.framework', which suggests you have a
conflicting version of Python installed. Did you perhaps do an OS
upgrade rather than a fresh install and so still have an older Python
2.5 on the system from Tiger?

Graham

> On 22-Nov-07, at 7:30 PM, Graham Dumpleton wrote:
>
> > On 23/11/2007, Paul Eyking <eyking@cs.dal.ca> wrote:
> >> Hey all,
> >>
> >> I saw the previous posts to this mailing list from the archives in
> >> October. I followed all of those instructions and (think) I've solved
> >> the issue regarding the module not being installed as a 4-way
> >> universal, however, now I'm getting a different error, has anyone
> >> seen
> >> this?
> >>
> >> eyk@Pauls-Computer~$ sudo apachectl configtest
> >> httpd: Syntax error on line 113 of /private/etc/apache2/httpd.conf:
> >> Cannot load /usr/libexec/apache2/mod_python.so into server: dlopen(/
> >> usr/libexec/apache2/mod_python.so, 10): Symbol not found:
> >> _PyObject_GenericGetAttr\n  Referenced from: /usr/libexec/apache2/
> >> mod_python.so\n  Expected in: dynamic lookup\n
> >
> > What do you get when you run:
> >
> >  otool -L /usr/libexec/apache2/mod_python.so
> >
> > Are you using the standard Python 2.5 that comes with the box or some
> > other version you have installed separately?
> >
> > Graham
>
>
From eyking at cs.dal.ca  Thu Nov 22 19:22:12 2007
From: eyking at cs.dal.ca (Paul Eyking)
Date: Thu Nov 22 19:22:19 2007
Subject: Fwd: [mod_python] OS X Leopard mod_python issues (cont.)
References: <ED0F392C-8B0B-4830-8B46-E44BAEF65DAB@cs.dal.ca>
Message-ID: <59E3A912-921E-487F-BBFA-7165D969C7B3@cs.dal.ca>


> Hi Graham,
>
> First off, thank you for the quick replies. To answer your question  
> about the Python installation, it may have been MacPorts that  
> installed the odd version of Python you noticed.
>
> I attempted to install mysqldb (python-mysql) via MacPorts and  
> noticed that it attempted to install Python25. However, I ran the  
> following command on both my MacBook, and that of a friend, and we  
> both had identical results.
>
> Last login: Thu Nov 22 20:08:53 on ttys000
> eyk@Pauls-Computer~$ cd /usr/bin/
> eyk@Pauls-Computer/usr/bin$ ls -l | grep python
> lrwxr-xr-x   1 root   wheel           72 22 Nov 18:53 python - 
> > ../../System/Library/Frameworks/Python.framework/Versions/2.5/bin/ 
> python
> lrwxr-xr-x   1 root   wheel           79 29 Oct 22:35 python-config - 
> > ../../System/Library/Frameworks/Python.framework/Versions/2.5/bin/ 
> python-config
> lrwxr-xr-x   1 root   wheel           75 29 Oct 22:35 python2.5 - 
> > ../../System/Library/Frameworks/Python.framework/Versions/2.5/bin/ 
> python2.5
> lrwxr-xr-x   1 root   wheel           82 29 Oct 22:35 python2.5- 
> config -> ../../System/Library/Frameworks/Python.framework/Versions/ 
> 2.5/bin/python2.5-config
> lrwxr-xr-x   1 root   wheel           73 29 Oct 22:35 pythonw - 
> > ../../System/Library/Frameworks/Python.framework/Versions/2.5/bin/ 
> pythonw
> lrwxr-xr-x   1 root   wheel           76 29 Oct 22:35 pythonw2.5 - 
> > ../../System/Library/Frameworks/Python.framework/Versions/2.5/bin/ 
> pythonw2.5
> eyk@Pauls-Computer/usr/bin$
>
> Is this not the 'out-of-the-box' Python installation that comes with  
> Leopard?
>
> Cheers,
>
> Paul
>
>
> On 22-Nov-07, at 7:47 PM, Graham Dumpleton wrote:
>
>> On 23/11/2007, Paul Eyking <eyking@cs.dal.ca> wrote:
>>> Here is the output from otool:
>>>
>>> eyk@Pauls-Computer~/Sources/mod_python-3.3.1$ otool -L /usr/libexec/
>>> apache2/mod_python.so
>>> /usr/libexec/apache2/mod_python.so:
>>>      /usr/lib/libSystem.B.dylib (compatibility version 1.0.0,  
>>> current
>>> version 111.0.0)
>>>      /Library/Frameworks/Python.framework/Versions/2.5/Python
>>> (compatibility version 2.5.0, current version 2.5.0)
>>>      /usr/lib/libgcc_s.1.dylib (compatibility version 1.0.0, current
>>> version 1.0.0)
>>
>> What about my other question:
>>
>> Are you using the standard Python 2.5 that comes with the box or some
>> other version you have installed separately?
>>
>> Of for that matter, do you have any other versions of Python  
>> installed?
>>
>> On a Leopard system there shouldn't be a
>> '/Library/Frameworks/Python.framework', which suggests you have a
>> conflicting version of Python installed. Did you perhaps do an OS
>> upgrade rather than a fresh install and so still have an older Python
>> 2.5 on the system from Tiger?
>>
>> Graham
>>
>>> On 22-Nov-07, at 7:30 PM, Graham Dumpleton wrote:
>>>
>>>> On 23/11/2007, Paul Eyking <eyking@cs.dal.ca> wrote:
>>>>> Hey all,
>>>>>
>>>>> I saw the previous posts to this mailing list from the archives in
>>>>> October. I followed all of those instructions and (think) I've  
>>>>> solved
>>>>> the issue regarding the module not being installed as a 4-way
>>>>> universal, however, now I'm getting a different error, has anyone
>>>>> seen
>>>>> this?
>>>>>
>>>>> eyk@Pauls-Computer~$ sudo apachectl configtest
>>>>> httpd: Syntax error on line 113 of /private/etc/apache2/ 
>>>>> httpd.conf:
>>>>> Cannot load /usr/libexec/apache2/mod_python.so into server:  
>>>>> dlopen(/
>>>>> usr/libexec/apache2/mod_python.so, 10): Symbol not found:
>>>>> _PyObject_GenericGetAttr\n  Referenced from: /usr/libexec/apache2/
>>>>> mod_python.so\n  Expected in: dynamic lookup\n
>>>>
>>>> What do you get when you run:
>>>>
>>>> otool -L /usr/libexec/apache2/mod_python.so
>>>>
>>>> Are you using the standard Python 2.5 that comes with the box or  
>>>> some
>>>> other version you have installed separately?
>>>>
>>>> Graham
>>>
>>>
>

From graham.dumpleton at gmail.com  Thu Nov 22 19:24:02 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu Nov 22 19:24:08 2007
Subject: [mod_python] OS X Leopard mod_python issues (cont.)
In-Reply-To: <ED0F392C-8B0B-4830-8B46-E44BAEF65DAB@cs.dal.ca>
References: <10EAE219-8AC8-4C1B-8B89-E3663871D37A@cs.dal.ca>
	<88e286470711221530m6651cd1fjbc23be0c87fa84a4@mail.gmail.com>
	<E5E2D74D-BC03-46ED-A251-6DCFE584721A@cs.dal.ca>
	<88e286470711221547gcc98b36p125242f32d622393@mail.gmail.com>
	<ED0F392C-8B0B-4830-8B46-E44BAEF65DAB@cs.dal.ca>
Message-ID: <88e286470711221624q6ee83219w6213edaffbd32308@mail.gmail.com>

On 23/11/2007, Paul Eyking <eyking@cs.dal.ca> wrote:
> Hi Graham,
>
> First off, thank you for the quick replies. To answer your question
> about the Python installation, it may have been MacPorts that
> installed the odd version of Python you noticed.
>
> I attempted to install mysqldb (python-mysql) via MacPorts and noticed
> that it attempted to install Python25. However, I ran the following
> command on both my MacBook, and that of a friend, and we both had
> identical results.
>
> Last login: Thu Nov 22 20:08:53 on ttys000
> eyk@Pauls-Computer~$ cd /usr/bin/
> eyk@Pauls-Computer/usr/bin$ ls -l | grep python
> lrwxr-xr-x   1 root   wheel           72 22 Nov 18:53 python -> ../../
> System/Library/Frameworks/Python.framework/Versions/2.5/bin/python
> lrwxr-xr-x   1 root   wheel           79 29 Oct 22:35 python-config -
>  > ../../System/Library/Frameworks/Python.framework/Versions/2.5/bin/
> python-config
> lrwxr-xr-x   1 root   wheel           75 29 Oct 22:35 python2.5 -
>  > ../../System/Library/Frameworks/Python.framework/Versions/2.5/bin/
> python2.5
> lrwxr-xr-x   1 root   wheel           82 29 Oct 22:35 python2.5-config
> -> ../../System/Library/Frameworks/Python.framework/Versions/2.5/bin/
> python2.5-config
> lrwxr-xr-x   1 root   wheel           73 29 Oct 22:35 pythonw -> ../../
> System/Library/Frameworks/Python.framework/Versions/2.5/bin/pythonw
> lrwxr-xr-x   1 root   wheel           76 29 Oct 22:35 pythonw2.5 -
>  > ../../System/Library/Frameworks/Python.framework/Versions/2.5/bin/
> pythonw2.5
> eyk@Pauls-Computer/usr/bin$
>
> Is this not the 'out-of-the-box' Python installation that comes with
> Leopard?

Your output from otool showed that:

  /Library/Frameworks/Python.framework/Versions/2.5/Python

was being found instead of:

  /System/Library/Frameworks/Python.framework

On a brand new install of Leopard I looked at, there is no Python
framework under /Library/Frameworks, only under
/System/Library/Frameworks.

Thus the /Library/Frameworks version must be an impostor possibly put
there by MacPorts, with it being incompatible and causing problems.

You will either have to get rid of the MacPorts version of Python and
build python-mysql yourself, or make mod_python use MacPorts Python
instead. To do the latter, see comments in:

  http://code.google.com/p/modwsgi/wiki/InstallationOnMacOSX

about build mod_wsgi with MacPorts and adapt for mod_python.

Graham

> On 22-Nov-07, at 7:47 PM, Graham Dumpleton wrote:
>
> > On 23/11/2007, Paul Eyking <eyking@cs.dal.ca> wrote:
> >> Here is the output from otool:
> >>
> >> eyk@Pauls-Computer~/Sources/mod_python-3.3.1$ otool -L /usr/libexec/
> >> apache2/mod_python.so
> >> /usr/libexec/apache2/mod_python.so:
> >>       /usr/lib/libSystem.B.dylib (compatibility version 1.0.0,
> >> current
> >> version 111.0.0)
> >>       /Library/Frameworks/Python.framework/Versions/2.5/Python
> >> (compatibility version 2.5.0, current version 2.5.0)
> >>       /usr/lib/libgcc_s.1.dylib (compatibility version 1.0.0, current
> >> version 1.0.0)
> >
> > What about my other question:
> >
> > Are you using the standard Python 2.5 that comes with the box or some
> > other version you have installed separately?
> >
> > Of for that matter, do you have any other versions of Python
> > installed?
> >
> > On a Leopard system there shouldn't be a
> > '/Library/Frameworks/Python.framework', which suggests you have a
> > conflicting version of Python installed. Did you perhaps do an OS
> > upgrade rather than a fresh install and so still have an older Python
> > 2.5 on the system from Tiger?
> >
> > Graham
> >
> >> On 22-Nov-07, at 7:30 PM, Graham Dumpleton wrote:
> >>
> >>> On 23/11/2007, Paul Eyking <eyking@cs.dal.ca> wrote:
> >>>> Hey all,
> >>>>
> >>>> I saw the previous posts to this mailing list from the archives in
> >>>> October. I followed all of those instructions and (think) I've
> >>>> solved
> >>>> the issue regarding the module not being installed as a 4-way
> >>>> universal, however, now I'm getting a different error, has anyone
> >>>> seen
> >>>> this?
> >>>>
> >>>> eyk@Pauls-Computer~$ sudo apachectl configtest
> >>>> httpd: Syntax error on line 113 of /private/etc/apache2/httpd.conf:
> >>>> Cannot load /usr/libexec/apache2/mod_python.so into server:
> >>>> dlopen(/
> >>>> usr/libexec/apache2/mod_python.so, 10): Symbol not found:
> >>>> _PyObject_GenericGetAttr\n  Referenced from: /usr/libexec/apache2/
> >>>> mod_python.so\n  Expected in: dynamic lookup\n
> >>>
> >>> What do you get when you run:
> >>>
> >>> otool -L /usr/libexec/apache2/mod_python.so
> >>>
> >>> Are you using the standard Python 2.5 that comes with the box or
> >>> some
> >>> other version you have installed separately?
> >>>
> >>> Graham
> >>
> >>
>
>
From chris.lyon at spritenote.co.uk  Fri Nov 23 07:50:54 2007
From: chris.lyon at spritenote.co.uk (chris lyon)
Date: Fri Nov 23 07:49:53 2007
Subject: [mod_python] Trouble with python versions.
Message-ID: <4746CCAE.6080606@spritenote.co.uk>

I'm trying to run django on Mandriva 10.1 and to this end I'm loading 
mod_python. The default Mandriva installation supplies python 2.4.3 and 
apache 2.2.3. I wish to use python 2.5.1 as I require yield() as a 
function but need to retain the original python version for the various 
config duties it performs. So I have installed python2.5.1 which I can 
start on the command line as python2.5 as opposed to python.
Upon running the django version which also runs under python2.4.3 I get 
Segmentation fault and after following the guides on-line, have upgraded 
Apache to 2.2.6 which allows me to import mod_python successfully under 
2.5.1 but not under 2.4.3.

I configure with
./configure --with-apxs=/usr/local/apache2/bin/apxs 
--with-python=/usr/bin/python2.5

and have the following directives in httpd.conf

LoadModule python_module /usr/local/apache2/modules/mod_python.so

<Location "/SUEagles/">
    SetHandler python-program
    PythonHandler django.core.handlers.modpython
    SetEnv DJANGO_SETTINGS_MODULE football.settings
    PythonPath "['/home/chris/SUFC/django'] + sys.path"
    PythonDebug On
</Location>

mod_python.so is the only version on the machine, in the location described.

However upon starting apache I get

[Fri Nov 23 11:34:15 2007] [notice] mod_python: using mutex_directory /tmp
[Fri Nov 23 11:34:15 2007] [notice] Apache/2.2.6 (Unix) mod_python/3.3.1 
Python/2.4.3 configured -- resuming normal operations

and the segmentation errors occur. Ho do I get this configuration to use 
python2.5, I understood that was the function of the with-python directive.

Chris

From clodoaldo.pinto.neto at gmail.com  Fri Nov 23 09:07:53 2007
From: clodoaldo.pinto.neto at gmail.com (Clodoaldo)
Date: Fri Nov 23 09:07:59 2007
Subject: [mod_python] mod_python and other web server that not apache
In-Reply-To: <88e286470711220319l433836c3s76bd2dc9fa59f540@mail.gmail.com>
References: <1195728155.10027.10.camel@ubuntuserver>
	<88e286470711220319l433836c3s76bd2dc9fa59f540@mail.gmail.com>
Message-ID: <a595de7a0711230607xa158712pa2d2ea9ab335aec5@mail.gmail.com>

2007/11/22, Graham Dumpleton <graham.dumpleton@gmail.com>:
> On 22/11/2007, EdgardCosta <edgardalvescosta@gmail.com> wrote:
> > Hi
> >
> > I receved a question in other maillist that anserwer if the python can
> > run in other webserver whitout be the apache.
> > I think that the apache is the only one. Or Iam wrong?
>
> Options for running web applications written in Python are as follows:
>
> 1. Web server is actually written in Python and Python web application
> sits on top of that in the same process. This web server may be the
> direct public facing web server, or may be hosted behind another web
> server such as Apache, lighttpd or nginx, with requests being proxied
> from the front end web server using the corresponding mod_proxy like
> module for the front end web server. There are various web servers
> available written in Python.
>
> 2. Python web application runs within an instance of the Python
> interpreter which runs embedded within a web server which is written
> in C. This option only currently exists for Apache. Two Apache modules
> exist for this. These are mod_python and mod_wsgi
> (http://www.modwsgi.org).
>
> You obviously know about mod_python. Whereas mod_python provides its
> own specific APIs and thus a web application written direct for that
> isn't portable to any other hosting option, in mod_wsgi the Python
> WSGI standard is used. An application written to the Python WSGI
> standard is portable to any of the options listed here. There are even
> workable, although not perfect, WSGI adapters for mod_python.
>
> 3. Python web application runs within a daemon process separate to the
> web server and requests are proxied from the web server to this daemon
> process. The web server is written in C. Rather than HTTP protocol
> being used as in option 1 above, an alternate protocol is used. There
> are actually a number of different variations on this theme.
>
> 3a. In the case of the mod_wsgi module, it supports a daemon mode in
> addition to embedded mode. It uses it own internal protocol for
> proxying data. This is done as mod_wsgi daemon processes are a direct
> fork of the Apache child processes and so they are tightly coupled.
>
> 3b. Next are solutions based on FASTGCI protocol for proxying of
> request to daemon process. The daemon process can either be started
> separately, or be forked from Apache, but then a distinct application
> executed. The application run in this case would actually be the
> Python executable. A module such as flup would be used which
> understands the FASTCGI protocol thereby allowing communication with
> the web server. Web applications may be written direct to flup
> interface to FASTCGI protocol, or written to WSGI standard and a
> flup/WSGI adapter used.
>
> 3c. Like 3b, but SCGI protocol used instead. The flup package would
> still be used as it also supports SCGI.
>
> 3d. Like 3b, but AJP protocol used instead. The flup package would
> still be used as it also supports AJP.
>
> Although 3a, and I think 3c and 3d are specific to Apache, the FASTCGI
> protocol described is also supported by lighttpd and nginx.
>
> If you want the most portable option for writing a Python web
> application, write it to the WSGI standard or use an existing
> framework which supports that standard. That way you can use any of
> the above options.

Graham,

This is the most comprehensive and at the same time the most concise
listing of the available technologies to deploy python on the web i
have read.

I was wondering if it would be a good idea to create a Wikipedia
article with your text. Would you care? What do you think?

Regards, Clodoaldo Pinto Neto
From simonrolin at gmail.com  Fri Nov 23 16:39:14 2007
From: simonrolin at gmail.com (Simon)
Date: Fri Nov 23 16:39:22 2007
Subject: [mod_python]Uploading file troubles...
In-Reply-To: <88e286470711221306u592e6663tf0c8ace8a4b4fbda@mail.gmail.com>
References: <6e86106f0711220932pad1cea2v3ace40e11e84182c@mail.gmail.com>
	<88e286470711221306u592e6663tf0c8ace8a4b4fbda@mail.gmail.com>
Message-ID: <6e86106f0711231339k213fe940v9e9bd40f4f34a950@mail.gmail.com>

Dearest list,

To finish my story the mistake I did was to write "mutlipart/form-data" in
place of "multipart/form-data"...

So for those who have to deal with file upload, what is describe in
http://webpython.codepoint.net/mod_python_publisher_file_upload is working
well!

If some of you have some troubles on this subject, write me at
simonrolin@gmail.com and i will do my best to help you ASAP...

Simon


2007/11/22, Graham Dumpleton <graham.dumpleton@gmail.com>:
>
> It will help us if you explain what the final problem was. Ie., what
> you had to change to make it work.
>
> Graham
>
> On 23/11/2007, Simon <simonrolin@gmail.com> wrote:
> > Graham, Clodoaldo,
> >
> > I really want to thanks both of you, it works!
> >
> > Before working with modpython I was working on zope3 but was unable to
> > receive some help and this is why is decided to change!
> >
> > What you have done for me is really great and I promise I will do all
> what I
> > can to help the others with modpython!
> >
> > Thanks a lot!
> >
> > Simon
> >
> > 2007/11/22, Clodoaldo <clodoaldo.pinto.neto@gmail.com >:
> > > 2007/11/21, Simon <simonrolin@gmail.com>:
> > > >
> > > >
> > > > ---------- Forwarded message ----------
> > > > From: Simon <simonrolin@gmail.com >
> > > > Date: 22 nov. 2007 01:48
> > > >  Subject: Re: [mod_python] subscribe Uploading file troubles...
> > > > To: Graham Dumpleton < graham.dumpleton@gmail.com >
> > > >
> > > >
> > > >
> > > >
> > > >  2007/11/21, Graham Dumpleton <graham.dumpleton@gmail.com >:
> > > >
> > > > > On 22/11/2007, Simon < simonrolin@gmail.com> wrote:
> > > > > >
> > > > > >
> > > > > > ---------- Forwarded message ----------
> > > > > > From: Simon < simonrolin@gmail.com >
> > > > > > Date: 21 nov. 2007 20:39
> > > > > >  Subject: Re: Mod_python Digest, Vol 56, Issue 21
> > > > > > To: mod_python@modpython.org
> > > > > >
> > > > > > Hi all of you,
> > > > > >
> > > > > > I'm new to modpython and I'm actually facing some problem when
> > trying to
> > > > > > upload file.... I've read a lot but have not found any answer...
> > > > > >
> > > > > > Here is my HTML of my form:
> > > > > > <form action=Upload2.py method=Post
> > > > > > enctype="mutlipart/form-data">
> > > > > >
> > > > > > <input type=
> > > > > > "file" name="file" value=""><
> > > > > > div class="button"><input type=
> > > > > > "submit" name="submit" value="Rechercher"
> > > > > > class="submit" /></div></
> > > > > > form>
> > > > > >
> > > > > > and here is Upload2 function:
> > > > > >
> > > > > > def Upload2(req):
> > > > > >     timer = ExecTime()
> > > > > >     _session(req)
> > > > > >     myPage = page.Page(req,"Ajouter une photo")
> > > > > >     fileitem = req.form['file']
> > > > > >     myPage.add("Type is :" + str(type(fileitem)) + "<br />")
> > > > >
> > > > > A Python type string has <> characters in it. Parse it through
> > > > > cgi.escape() so you can view the actual type string. Then repost
> > > > > output as at the moment can't tell what the type is.
> > > > >
> > > > > Graham
> > > >
> > > >
> > > > Graham, thanks for answering so fast....
> > > >
> > > >  So, fileitem or req.form['file'] is from type <class
> > > > 'mod_python.util.StringField' >...
> > > >  If I do the same with fileitem.file, i have : <type '
> > cStringIO.StringI'>
> > > >
> > > >  Any idea? Why does fileitem.filename is None?
> > > >
> > > >  Thanks a lot for your help, really great!
> > >
> > > In a very fast test this is what I get for this code:
> > >
> > >       message = 'fileitem: "%s" fileitem.file "%s"' % \
> > >       (cgi.escape(str(fileitem)), cgi.escape(str(fileitem.file)))
> > >
> > > fileitem: "Field('file',
> > >
> >
> '[settings]\nusername=Kakao\nteam=13802\nasknet=no\nmachineid=1\nlocal=162\n\n[http]\nactive=no\nhost=localhost\nport=8080\n\n')"
> > > fileitem.file "<open file '<fdopen>', mode 'w+b' at 0xb7a95698>"
> > >
> > >
> > > fileitem is of type Field as the manual says it should be. I'm leaving
> > > to work now and i will try again to night.
> > >
> > > Clodoaldo Pinto Neto
> > >
> >
> >
> >
> > --
> > --  :-) Simon Rolin ;-)  --
> >
> > --
> > --  :-) Simon Rolin ;-)  --
>



-- 
--  :-) Simon Rolin ;-)  --
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20071123/d4abe1b8/attachment.html
From graham.dumpleton at gmail.com  Fri Nov 23 20:20:50 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Fri Nov 23 20:20:53 2007
Subject: [mod_python] Trouble with python versions.
In-Reply-To: <4746CCAE.6080606@spritenote.co.uk>
References: <4746CCAE.6080606@spritenote.co.uk>
Message-ID: <88e286470711231720n1335318bpb186ae29aad20ead@mail.gmail.com>

Did you run:

  make distclean

after having done previous failed builds of mod_python?

Did you make sure you did a full Apache 'stop' rather than a
'restart'? A 'restart' may not unload the old Python libraries from
Apache process memory properly.

What do you get if you run:

  ldd mod_python.so

Graham

On 23/11/2007, chris lyon <chris.lyon@spritenote.co.uk> wrote:
> I'm trying to run django on Mandriva 10.1 and to this end I'm loading
> mod_python. The default Mandriva installation supplies python 2.4.3 and
> apache 2.2.3. I wish to use python 2.5.1 as I require yield() as a
> function but need to retain the original python version for the various
> config duties it performs. So I have installed python2.5.1 which I can
> start on the command line as python2.5 as opposed to python.
> Upon running the django version which also runs under python2.4.3 I get
> Segmentation fault and after following the guides on-line, have upgraded
> Apache to 2.2.6 which allows me to import mod_python successfully under
> 2.5.1 but not under 2.4.3.
>
> I configure with
> ./configure --with-apxs=/usr/local/apache2/bin/apxs
> --with-python=/usr/bin/python2.5
>
> and have the following directives in httpd.conf
>
> LoadModule python_module /usr/local/apache2/modules/mod_python.so
>
> <Location "/SUEagles/">
>     SetHandler python-program
>     PythonHandler django.core.handlers.modpython
>     SetEnv DJANGO_SETTINGS_MODULE football.settings
>     PythonPath "['/home/chris/SUFC/django'] + sys.path"
>     PythonDebug On
> </Location>
>
> mod_python.so is the only version on the machine, in the location described.
>
> However upon starting apache I get
>
> [Fri Nov 23 11:34:15 2007] [notice] mod_python: using mutex_directory /tmp
> [Fri Nov 23 11:34:15 2007] [notice] Apache/2.2.6 (Unix) mod_python/3.3.1
> Python/2.4.3 configured -- resuming normal operations
>
> and the segmentation errors occur. Ho do I get this configuration to use
> python2.5, I understood that was the function of the with-python directive.
>
> Chris
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From graham.dumpleton at gmail.com  Sat Nov 24 03:41:26 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sat Nov 24 03:41:32 2007
Subject: [mod_python] mod_python and other web server that not apache
In-Reply-To: <a595de7a0711230607xa158712pa2d2ea9ab335aec5@mail.gmail.com>
References: <1195728155.10027.10.camel@ubuntuserver>
	<88e286470711220319l433836c3s76bd2dc9fa59f540@mail.gmail.com>
	<a595de7a0711230607xa158712pa2d2ea9ab335aec5@mail.gmail.com>
Message-ID: <88e286470711240041i440e11b8k72a263ef4585a0a@mail.gmail.com>

On 24/11/2007, Clodoaldo <clodoaldo.pinto.neto@gmail.com> wrote:
> 2007/11/22, Graham Dumpleton <graham.dumpleton@gmail.com>:
> > On 22/11/2007, EdgardCosta <edgardalvescosta@gmail.com> wrote:
> > > Hi
> > >
> > > I receved a question in other maillist that anserwer if the python can
> > > run in other webserver whitout be the apache.
> > > I think that the apache is the only one. Or Iam wrong?
> >
> > Options for running web applications written in Python are as follows:
> >
> > 1. Web server is actually written in Python and Python web application
> > sits on top of that in the same process. This web server may be the
> > direct public facing web server, or may be hosted behind another web
> > server such as Apache, lighttpd or nginx, with requests being proxied
> > from the front end web server using the corresponding mod_proxy like
> > module for the front end web server. There are various web servers
> > available written in Python.
> >
> > 2. Python web application runs within an instance of the Python
> > interpreter which runs embedded within a web server which is written
> > in C. This option only currently exists for Apache. Two Apache modules
> > exist for this. These are mod_python and mod_wsgi
> > (http://www.modwsgi.org).
> >
> > You obviously know about mod_python. Whereas mod_python provides its
> > own specific APIs and thus a web application written direct for that
> > isn't portable to any other hosting option, in mod_wsgi the Python
> > WSGI standard is used. An application written to the Python WSGI
> > standard is portable to any of the options listed here. There are even
> > workable, although not perfect, WSGI adapters for mod_python.
> >
> > 3. Python web application runs within a daemon process separate to the
> > web server and requests are proxied from the web server to this daemon
> > process. The web server is written in C. Rather than HTTP protocol
> > being used as in option 1 above, an alternate protocol is used. There
> > are actually a number of different variations on this theme.
> >
> > 3a. In the case of the mod_wsgi module, it supports a daemon mode in
> > addition to embedded mode. It uses it own internal protocol for
> > proxying data. This is done as mod_wsgi daemon processes are a direct
> > fork of the Apache child processes and so they are tightly coupled.
> >
> > 3b. Next are solutions based on FASTGCI protocol for proxying of
> > request to daemon process. The daemon process can either be started
> > separately, or be forked from Apache, but then a distinct application
> > executed. The application run in this case would actually be the
> > Python executable. A module such as flup would be used which
> > understands the FASTCGI protocol thereby allowing communication with
> > the web server. Web applications may be written direct to flup
> > interface to FASTCGI protocol, or written to WSGI standard and a
> > flup/WSGI adapter used.
> >
> > 3c. Like 3b, but SCGI protocol used instead. The flup package would
> > still be used as it also supports SCGI.
> >
> > 3d. Like 3b, but AJP protocol used instead. The flup package would
> > still be used as it also supports AJP.
> >
> > Although 3a, and I think 3c and 3d are specific to Apache, the FASTCGI
> > protocol described is also supported by lighttpd and nginx.
> >
> > If you want the most portable option for writing a Python web
> > application, write it to the WSGI standard or use an existing
> > framework which supports that standard. That way you can use any of
> > the above options.
>
> Graham,
>
> This is the most comprehensive and at the same time the most concise
> listing of the available technologies to deploy python on the web i
> have read.
>
> I was wondering if it would be a good idea to create a Wikipedia
> article with your text. Would you care? What do you think?

I'd rather you didn't. It hardly does the topic justice and if
something is done I'd prefer it be done properly.

I have floated an idea a number of times in different forums of trying
to get a group of people together to properly document, at least for
WSGI, what all the hosting solutions are that are available. This
would include general descriptions, setup instructions for simple
cases and the pros and cons of each as well as comparative benchmarks
for a range of different scenarios with the same WSGI application code
used for each hosting solution. The idea is so that there is some
decent information on which to base decisions of what to use, rather
than people relying on the incomplete, or misinformed opinion that is
out there.

Needless to say, no one was interested and I don't have time myself for it now.

Graham
From god at skri.org  Sun Nov 25 15:32:33 2007
From: god at skri.org (Simon Kesenci)
Date: Sun Nov 25 15:32:41 2007
Subject: [mod_python] Mac OS X Leopard upset my mod_python test bed.
Message-ID: <BFFC4290-0C4B-43D8-9F38-1B140A35B767@skri.org>

I recently upgraded my PowerBook (PPC) to Leopard.  Piece by piece I  
started reassembling my web server test bed (httpd 2.2.6, Python  
2.5.1, mod_python 3.3.1), which worked perfectly on Tiger.  I built  
everything from their sources.

This time around I got everything to work except for mod_python.  My  
procedure had the following non-standard edits:

httpd 2.2.6:
     Changed APR_HAS_SENDFILE to 0 in srclib/apr/include/apr.h
     After installation I backed up /usr/sbin/httpd and entered
       ln -s /usr/local/apache2/bin/httpd /usr/sbin/httpd.
     (This allows you to activate the compiled httpd from the Sharing  
Preferences, which will also have the built-in firewall open and close  
port 80 in sync with the server.)

Python 2.5.1:
     After ./configure --enable-framework I added -DSETPGRP_HAVE_ARG  
to the top-level Makefile (make exits with an error otherwise due to a  
lack of arguments to setpgrp()).

Both of the above work as expected, but when I threw mod_python into  
the mix I kept getting the following error:

[Sun Nov 25 09:43:22 2007] [error] make_obcallback: could not import  
mod_python.apache.\n
ImportError: No module named mod_python.apache
[Sun Nov 25 09:43:22 2007] [error] make_obcallback: Python path being  
used "['/usr/lib/python25.zip', '/usr/lib/python2.5', '/usr/lib/ 
python2.5/plat-darwin', '/usr/lib/python2.5/plat-mac', '/usr/lib/ 
python2.5/plat-mac/lib-scriptpackages', '/usr/lib/python2.5/lib-tk', '/ 
usr/lib/python2.5/lib-dynload', '/Library/Python/2.5/site-packages']".
[Sun Nov 25 09:43:22 2007] [error] get_interpreter: no interpreter  
callback found.
[Sun Nov 25 09:43:22 2007] [error] [client 10.0.1.2] python_handler:  
Can't get/create interpreter., referer: http://10.0.1.2/~simon/test/

I used a number of scripts to test the installation, including  
mptest.py from the mod_python doc.  The last script I used to test did  
not import mod_python.apache explicitly:

from mod_python import util

def index(req):
   util.redirect(req, 'www.example.com')

While installing mod_python the output made clear that it took up the  
interpreter in /usr/local/bin rather than the one provided by Apple  
in /usr/bin and installed under /Library/Frameworks/Python.framework/ 
Versions/2.5/lib/python2.5/site-packages/ rather than /Library/Python/ 
2.5/site-packages.

I don't know from where it pulled that path.  The interpreter I  
compiled uses the path:

['', '/Library/Frameworks/Python.framework/Versions/2.5/lib/ 
python25.zip', '/Library/Frameworks/Python.framework/Versions/2.5/lib/ 
python2.5', '/Library/Frameworks/Python.framework/Versions/2.5/lib/ 
python2.5/plat-darwin', '/Library/Frameworks/Python.framework/Versions/ 
2.5/lib/python2.5/plat-mac', '/Library/Frameworks/Python.framework/ 
Versions/2.5/lib/python2.5/plat-mac/lib-scriptpackages', '/Library/ 
Frameworks/Python.framework/Versions/2.5/lib/python2.5/lib-tk', '/ 
Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/lib- 
dynload', '/Library/Frameworks/Python.framework/Versions/2.5/lib/ 
python2.5/site-packages']

The interpreter provided by Apple uses:

['', '/System/Library/Frameworks/Python.framework/Versions/2.5/lib/ 
python25.zip', '/System/Library/Frameworks/Python.framework/Versions/ 
2.5/lib/python2.5', '/System/Library/Frameworks/Python.framework/ 
Versions/2.5/lib/python2.5/plat-darwin', '/System/Library/Frameworks/ 
Python.framework/Versions/2.5/lib/python2.5/plat-mac', '/System/ 
Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/plat- 
mac/lib-scriptpackages', '/System/Library/Frameworks/Python.framework/ 
Versions/2.5/Extras/lib/python', '/System/Library/Frameworks/ 
Python.framework/Versions/2.5/lib/python2.5/lib-tk', '/System/Library/ 
Frameworks/Python.framework/Versions/2.5/lib/python2.5/lib-dynload', '/ 
Library/Python/2.5/site-packages', '/System/Library/Frameworks/ 
Python.framework/Versions/2.5/Extras/lib/python/PyObjC']

This morning I logged on to my Linux web server and installed all  
these packages from source without any problems.

--S.

From graham.dumpleton at gmail.com  Sun Nov 25 17:17:10 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sun Nov 25 17:17:16 2007
Subject: [mod_python] Mac OS X Leopard upset my mod_python test bed.
In-Reply-To: <BFFC4290-0C4B-43D8-9F38-1B140A35B767@skri.org>
References: <BFFC4290-0C4B-43D8-9F38-1B140A35B767@skri.org>
Message-ID: <88e286470711251417u255499deoc4dc28a0ab022765@mail.gmail.com>

In 'envvars' file in the same directory as the real httpd you want to run, add:

  PYTHONHOME=/usr/local
  export PYTHONHOME

Alternatively, you must ensure that the PATH of the user that Apache
is started as has /usr/local/bin in its path before /usr/bin, else it
will find the wrong 'python' executable and thus end up looking in the
wrong location for the corresponding lib directory.

Search the mod_python mailing lists for past discussions on this issue.

BTW, why do you want to install your own version of Python 2.5, what
is wrong with the Python 2.5 that the operating system ships?

Graham

On 26/11/2007, Simon Kesenci <god@skri.org> wrote:
> I recently upgraded my PowerBook (PPC) to Leopard.  Piece by piece I
> started reassembling my web server test bed (httpd 2.2.6, Python
> 2.5.1, mod_python 3.3.1), which worked perfectly on Tiger.  I built
> everything from their sources.
>
> This time around I got everything to work except for mod_python.  My
> procedure had the following non-standard edits:
>
> httpd 2.2.6:
>      Changed APR_HAS_SENDFILE to 0 in srclib/apr/include/apr.h
>      After installation I backed up /usr/sbin/httpd and entered
>        ln -s /usr/local/apache2/bin/httpd /usr/sbin/httpd.
>      (This allows you to activate the compiled httpd from the Sharing
> Preferences, which will also have the built-in firewall open and close
> port 80 in sync with the server.)
>
> Python 2.5.1:
>      After ./configure --enable-framework I added -DSETPGRP_HAVE_ARG
> to the top-level Makefile (make exits with an error otherwise due to a
> lack of arguments to setpgrp()).
>
> Both of the above work as expected, but when I threw mod_python into
> the mix I kept getting the following error:
>
> [Sun Nov 25 09:43:22 2007] [error] make_obcallback: could not import
> mod_python.apache.\n
> ImportError: No module named mod_python.apache
> [Sun Nov 25 09:43:22 2007] [error] make_obcallback: Python path being
> used "['/usr/lib/python25.zip', '/usr/lib/python2.5', '/usr/lib/
> python2.5/plat-darwin', '/usr/lib/python2.5/plat-mac', '/usr/lib/
> python2.5/plat-mac/lib-scriptpackages', '/usr/lib/python2.5/lib-tk', '/
> usr/lib/python2.5/lib-dynload', '/Library/Python/2.5/site-packages']".
> [Sun Nov 25 09:43:22 2007] [error] get_interpreter: no interpreter
> callback found.
> [Sun Nov 25 09:43:22 2007] [error] [client 10.0.1.2] python_handler:
> Can't get/create interpreter., referer: http://10.0.1.2/~simon/test/
>
> I used a number of scripts to test the installation, including
> mptest.py from the mod_python doc.  The last script I used to test did
> not import mod_python.apache explicitly:
>
> from mod_python import util
>
> def index(req):
>    util.redirect(req, 'www.example.com')
>
> While installing mod_python the output made clear that it took up the
> interpreter in /usr/local/bin rather than the one provided by Apple
> in /usr/bin and installed under /Library/Frameworks/Python.framework/
> Versions/2.5/lib/python2.5/site-packages/ rather than /Library/Python/
> 2.5/site-packages.
>
> I don't know from where it pulled that path.  The interpreter I
> compiled uses the path:
>
> ['', '/Library/Frameworks/Python.framework/Versions/2.5/lib/
> python25.zip', '/Library/Frameworks/Python.framework/Versions/2.5/lib/
> python2.5', '/Library/Frameworks/Python.framework/Versions/2.5/lib/
> python2.5/plat-darwin', '/Library/Frameworks/Python.framework/Versions/
> 2.5/lib/python2.5/plat-mac', '/Library/Frameworks/Python.framework/
> Versions/2.5/lib/python2.5/plat-mac/lib-scriptpackages', '/Library/
> Frameworks/Python.framework/Versions/2.5/lib/python2.5/lib-tk', '/
> Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/lib-
> dynload', '/Library/Frameworks/Python.framework/Versions/2.5/lib/
> python2.5/site-packages']
>
> The interpreter provided by Apple uses:
>
> ['', '/System/Library/Frameworks/Python.framework/Versions/2.5/lib/
> python25.zip', '/System/Library/Frameworks/Python.framework/Versions/
> 2.5/lib/python2.5', '/System/Library/Frameworks/Python.framework/
> Versions/2.5/lib/python2.5/plat-darwin', '/System/Library/Frameworks/
> Python.framework/Versions/2.5/lib/python2.5/plat-mac', '/System/
> Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/plat-
> mac/lib-scriptpackages', '/System/Library/Frameworks/Python.framework/
> Versions/2.5/Extras/lib/python', '/System/Library/Frameworks/
> Python.framework/Versions/2.5/lib/python2.5/lib-tk', '/System/Library/
> Frameworks/Python.framework/Versions/2.5/lib/python2.5/lib-dynload', '/
> Library/Python/2.5/site-packages', '/System/Library/Frameworks/
> Python.framework/Versions/2.5/Extras/lib/python/PyObjC']
>
> This morning I logged on to my Linux web server and installed all
> these packages from source without any problems.
>
> --S.
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From god at skri.org  Sun Nov 25 21:09:05 2007
From: god at skri.org (Simon Kesenci)
Date: Sun Nov 25 21:09:13 2007
Subject: [mod_python] Mac OS X Leopard upset my mod_python test bed.
In-Reply-To: <88e286470711251417u255499deoc4dc28a0ab022765@mail.gmail.com>
References: <BFFC4290-0C4B-43D8-9F38-1B140A35B767@skri.org>
	<88e286470711251417u255499deoc4dc28a0ab022765@mail.gmail.com>
Message-ID: <66081662-AD86-4D5F-BEF2-6E4A143ACE66@skri.org>

I haven't found a discussion of this problem in the archives.

Strange stuff.  It started working properly after I removed the /usr/ 
sbin/httpd symlink and copied the compiled version there.  It works  
without setting PYTHONHOME and without /usr/local/bin in root's path.

To answer your question, using the OS-provided installation (whatever  
the OS) leaves your software to the mercies of the OS's update schedule.

--S.

On Nov 25, 2007, at 14:17, Graham Dumpleton wrote:

> In 'envvars' file in the same directory as the real httpd you want  
> to run, add:
>
>  PYTHONHOME=/usr/local
>  export PYTHONHOME
>
> Alternatively, you must ensure that the PATH of the user that Apache
> is started as has /usr/local/bin in its path before /usr/bin, else it
> will find the wrong 'python' executable and thus end up looking in the
> wrong location for the corresponding lib directory.
>
> Search the mod_python mailing lists for past discussions on this  
> issue.
>
> BTW, why do you want to install your own version of Python 2.5, what
> is wrong with the Python 2.5 that the operating system ships?
>
> Graham
>
> On 26/11/2007, Simon Kesenci <god@skri.org> wrote:
>> I recently upgraded my PowerBook (PPC) to Leopard.  Piece by piece I
>> started reassembling my web server test bed (httpd 2.2.6, Python
>> 2.5.1, mod_python 3.3.1), which worked perfectly on Tiger.  I built
>> everything from their sources.
>>
>> This time around I got everything to work except for mod_python.  My
>> procedure had the following non-standard edits:
>>
>> httpd 2.2.6:
>>     Changed APR_HAS_SENDFILE to 0 in srclib/apr/include/apr.h
>>     After installation I backed up /usr/sbin/httpd and entered
>>       ln -s /usr/local/apache2/bin/httpd /usr/sbin/httpd.
>>     (This allows you to activate the compiled httpd from the Sharing
>> Preferences, which will also have the built-in firewall open and  
>> close
>> port 80 in sync with the server.)
>>
>> Python 2.5.1:
>>     After ./configure --enable-framework I added -DSETPGRP_HAVE_ARG
>> to the top-level Makefile (make exits with an error otherwise due  
>> to a
>> lack of arguments to setpgrp()).
>>
>> Both of the above work as expected, but when I threw mod_python into
>> the mix I kept getting the following error:
>>
>> [Sun Nov 25 09:43:22 2007] [error] make_obcallback: could not import
>> mod_python.apache.\n
>> ImportError: No module named mod_python.apache
>> [Sun Nov 25 09:43:22 2007] [error] make_obcallback: Python path being
>> used "['/usr/lib/python25.zip', '/usr/lib/python2.5', '/usr/lib/
>> python2.5/plat-darwin', '/usr/lib/python2.5/plat-mac', '/usr/lib/
>> python2.5/plat-mac/lib-scriptpackages', '/usr/lib/python2.5/lib- 
>> tk', '/
>> usr/lib/python2.5/lib-dynload', '/Library/Python/2.5/site- 
>> packages']".
>> [Sun Nov 25 09:43:22 2007] [error] get_interpreter: no interpreter
>> callback found.
>> [Sun Nov 25 09:43:22 2007] [error] [client 10.0.1.2] python_handler:
>> Can't get/create interpreter., referer: http://10.0.1.2/~simon/test/
>>
>> I used a number of scripts to test the installation, including
>> mptest.py from the mod_python doc.  The last script I used to test  
>> did
>> not import mod_python.apache explicitly:
>>
>> from mod_python import util
>>
>> def index(req):
>>   util.redirect(req, 'www.example.com')
>>
>> While installing mod_python the output made clear that it took up the
>> interpreter in /usr/local/bin rather than the one provided by Apple
>> in /usr/bin and installed under /Library/Frameworks/Python.framework/
>> Versions/2.5/lib/python2.5/site-packages/ rather than /Library/ 
>> Python/
>> 2.5/site-packages.
>>
>> I don't know from where it pulled that path.  The interpreter I
>> compiled uses the path:
>>
>> ['', '/Library/Frameworks/Python.framework/Versions/2.5/lib/
>> python25.zip', '/Library/Frameworks/Python.framework/Versions/2.5/ 
>> lib/
>> python2.5', '/Library/Frameworks/Python.framework/Versions/2.5/lib/
>> python2.5/plat-darwin', '/Library/Frameworks/Python.framework/ 
>> Versions/
>> 2.5/lib/python2.5/plat-mac', '/Library/Frameworks/Python.framework/
>> Versions/2.5/lib/python2.5/plat-mac/lib-scriptpackages', '/Library/
>> Frameworks/Python.framework/Versions/2.5/lib/python2.5/lib-tk', '/
>> Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/lib-
>> dynload', '/Library/Frameworks/Python.framework/Versions/2.5/lib/
>> python2.5/site-packages']
>>
>> The interpreter provided by Apple uses:
>>
>> ['', '/System/Library/Frameworks/Python.framework/Versions/2.5/lib/
>> python25.zip', '/System/Library/Frameworks/Python.framework/Versions/
>> 2.5/lib/python2.5', '/System/Library/Frameworks/Python.framework/
>> Versions/2.5/lib/python2.5/plat-darwin', '/System/Library/Frameworks/
>> Python.framework/Versions/2.5/lib/python2.5/plat-mac', '/System/
>> Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/plat-
>> mac/lib-scriptpackages', '/System/Library/Frameworks/ 
>> Python.framework/
>> Versions/2.5/Extras/lib/python', '/System/Library/Frameworks/
>> Python.framework/Versions/2.5/lib/python2.5/lib-tk', '/System/ 
>> Library/
>> Frameworks/Python.framework/Versions/2.5/lib/python2.5/lib- 
>> dynload', '/
>> Library/Python/2.5/site-packages', '/System/Library/Frameworks/
>> Python.framework/Versions/2.5/Extras/lib/python/PyObjC']
>>
>> This morning I logged on to my Linux web server and installed all
>> these packages from source without any problems.
>>
>> --S.
>>
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>

From graham.dumpleton at gmail.com  Sun Nov 25 21:21:16 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sun Nov 25 21:21:22 2007
Subject: [mod_python] Mac OS X Leopard upset my mod_python test bed.
In-Reply-To: <66081662-AD86-4D5F-BEF2-6E4A143ACE66@skri.org>
References: <BFFC4290-0C4B-43D8-9F38-1B140A35B767@skri.org>
	<88e286470711251417u255499deoc4dc28a0ab022765@mail.gmail.com>
	<66081662-AD86-4D5F-BEF2-6E4A143ACE66@skri.org>
Message-ID: <88e286470711251821l493fa193vdf8b1673cd3c4d69@mail.gmail.com>

On 26/11/2007, Simon Kesenci <god@skri.org> wrote:
> I haven't found a discussion of this problem in the archives.
>
> Strange stuff.  It started working properly after I removed the /usr/
> sbin/httpd symlink and copied the compiled version there.  It works
> without setting PYTHONHOME and without /usr/local/bin in root's path.

More than likely you used 'sudo' to restart Apache and it therefore
picked up your personal PATH which had /usr/local/bin first. Do a:

  sudo -H apachcetl stop
  sudo -H apachectl start

and see if you are so lucky. The -H option prevents your personal user
environment transferring over to Apache startup environment.

Graham

> To answer your question, using the OS-provided installation (whatever
> the OS) leaves your software to the mercies of the OS's update schedule.
>
> --S.
>
> On Nov 25, 2007, at 14:17, Graham Dumpleton wrote:
>
> > In 'envvars' file in the same directory as the real httpd you want
> > to run, add:
> >
> >  PYTHONHOME=/usr/local
> >  export PYTHONHOME
> >
> > Alternatively, you must ensure that the PATH of the user that Apache
> > is started as has /usr/local/bin in its path before /usr/bin, else it
> > will find the wrong 'python' executable and thus end up looking in the
> > wrong location for the corresponding lib directory.
> >
> > Search the mod_python mailing lists for past discussions on this
> > issue.
> >
> > BTW, why do you want to install your own version of Python 2.5, what
> > is wrong with the Python 2.5 that the operating system ships?
> >
> > Graham
> >
> > On 26/11/2007, Simon Kesenci <god@skri.org> wrote:
> >> I recently upgraded my PowerBook (PPC) to Leopard.  Piece by piece I
> >> started reassembling my web server test bed (httpd 2.2.6, Python
> >> 2.5.1, mod_python 3.3.1), which worked perfectly on Tiger.  I built
> >> everything from their sources.
> >>
> >> This time around I got everything to work except for mod_python.  My
> >> procedure had the following non-standard edits:
> >>
> >> httpd 2.2.6:
> >>     Changed APR_HAS_SENDFILE to 0 in srclib/apr/include/apr.h
> >>     After installation I backed up /usr/sbin/httpd and entered
> >>       ln -s /usr/local/apache2/bin/httpd /usr/sbin/httpd.
> >>     (This allows you to activate the compiled httpd from the Sharing
> >> Preferences, which will also have the built-in firewall open and
> >> close
> >> port 80 in sync with the server.)
> >>
> >> Python 2.5.1:
> >>     After ./configure --enable-framework I added -DSETPGRP_HAVE_ARG
> >> to the top-level Makefile (make exits with an error otherwise due
> >> to a
> >> lack of arguments to setpgrp()).
> >>
> >> Both of the above work as expected, but when I threw mod_python into
> >> the mix I kept getting the following error:
> >>
> >> [Sun Nov 25 09:43:22 2007] [error] make_obcallback: could not import
> >> mod_python.apache.\n
> >> ImportError: No module named mod_python.apache
> >> [Sun Nov 25 09:43:22 2007] [error] make_obcallback: Python path being
> >> used "['/usr/lib/python25.zip', '/usr/lib/python2.5', '/usr/lib/
> >> python2.5/plat-darwin', '/usr/lib/python2.5/plat-mac', '/usr/lib/
> >> python2.5/plat-mac/lib-scriptpackages', '/usr/lib/python2.5/lib-
> >> tk', '/
> >> usr/lib/python2.5/lib-dynload', '/Library/Python/2.5/site-
> >> packages']".
> >> [Sun Nov 25 09:43:22 2007] [error] get_interpreter: no interpreter
> >> callback found.
> >> [Sun Nov 25 09:43:22 2007] [error] [client 10.0.1.2] python_handler:
> >> Can't get/create interpreter., referer: http://10.0.1.2/~simon/test/
> >>
> >> I used a number of scripts to test the installation, including
> >> mptest.py from the mod_python doc.  The last script I used to test
> >> did
> >> not import mod_python.apache explicitly:
> >>
> >> from mod_python import util
> >>
> >> def index(req):
> >>   util.redirect(req, 'www.example.com')
> >>
> >> While installing mod_python the output made clear that it took up the
> >> interpreter in /usr/local/bin rather than the one provided by Apple
> >> in /usr/bin and installed under /Library/Frameworks/Python.framework/
> >> Versions/2.5/lib/python2.5/site-packages/ rather than /Library/
> >> Python/
> >> 2.5/site-packages.
> >>
> >> I don't know from where it pulled that path.  The interpreter I
> >> compiled uses the path:
> >>
> >> ['', '/Library/Frameworks/Python.framework/Versions/2.5/lib/
> >> python25.zip', '/Library/Frameworks/Python.framework/Versions/2.5/
> >> lib/
> >> python2.5', '/Library/Frameworks/Python.framework/Versions/2.5/lib/
> >> python2.5/plat-darwin', '/Library/Frameworks/Python.framework/
> >> Versions/
> >> 2.5/lib/python2.5/plat-mac', '/Library/Frameworks/Python.framework/
> >> Versions/2.5/lib/python2.5/plat-mac/lib-scriptpackages', '/Library/
> >> Frameworks/Python.framework/Versions/2.5/lib/python2.5/lib-tk', '/
> >> Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/lib-
> >> dynload', '/Library/Frameworks/Python.framework/Versions/2.5/lib/
> >> python2.5/site-packages']
> >>
> >> The interpreter provided by Apple uses:
> >>
> >> ['', '/System/Library/Frameworks/Python.framework/Versions/2.5/lib/
> >> python25.zip', '/System/Library/Frameworks/Python.framework/Versions/
> >> 2.5/lib/python2.5', '/System/Library/Frameworks/Python.framework/
> >> Versions/2.5/lib/python2.5/plat-darwin', '/System/Library/Frameworks/
> >> Python.framework/Versions/2.5/lib/python2.5/plat-mac', '/System/
> >> Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/plat-
> >> mac/lib-scriptpackages', '/System/Library/Frameworks/
> >> Python.framework/
> >> Versions/2.5/Extras/lib/python', '/System/Library/Frameworks/
> >> Python.framework/Versions/2.5/lib/python2.5/lib-tk', '/System/
> >> Library/
> >> Frameworks/Python.framework/Versions/2.5/lib/python2.5/lib-
> >> dynload', '/
> >> Library/Python/2.5/site-packages', '/System/Library/Frameworks/
> >> Python.framework/Versions/2.5/Extras/lib/python/PyObjC']
> >>
> >> This morning I logged on to my Linux web server and installed all
> >> these packages from source without any problems.
> >>
> >> --S.
> >>
> >> _______________________________________________
> >> Mod_python mailing list
> >> Mod_python@modpython.org
> >> http://mailman.modpython.org/mailman/listinfo/mod_python
> >>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From god at skri.org  Sun Nov 25 22:47:12 2007
From: god at skri.org (Simon Kesenci)
Date: Sun Nov 25 22:47:20 2007
Subject: [mod_python] Mac OS X Leopard upset my mod_python test bed.
In-Reply-To: <88e286470711251821l493fa193vdf8b1673cd3c4d69@mail.gmail.com>
References: <BFFC4290-0C4B-43D8-9F38-1B140A35B767@skri.org>
	<88e286470711251417u255499deoc4dc28a0ab022765@mail.gmail.com>
	<66081662-AD86-4D5F-BEF2-6E4A143ACE66@skri.org>
	<88e286470711251821l493fa193vdf8b1673cd3c4d69@mail.gmail.com>
Message-ID: <72F7E125-E3E3-4DFD-84CC-5838D2F7965B@skri.org>

Not sure how the Sharing Preferences starts apache but I suspect it  
uses something similar to sudo.  At any rate I tried starting it the  
way you described and mod_python still worked as expected.

I then removed /usr/local/bin from my personal account's path and  
logged back in, confirmed that the path lacked /usr/local/bin, used  
sudo -H to start apache again and mod_python still worked.

I then renamed /usr/local/bin to /usr/local/bin2, restarted apache and  
mod_python still worked.

It seems mod_python only needs to find the executable at the time you  
compile mod_python.

Though I have my setup working, the question of where mod_python got  
the path in the error log in my original message remains.  Neither  
interpreter on my computer yields that result via sys.path (although  
some of the items in that list correspond, via symlinks, to locations  
on the path from the interpreter that came with Leopard).

--S.

On Nov 25, 2007, at 18:21, Graham Dumpleton wrote:

> On 26/11/2007, Simon Kesenci <god@skri.org> wrote:
>> I haven't found a discussion of this problem in the archives.
>>
>> Strange stuff.  It started working properly after I removed the /usr/
>> sbin/httpd symlink and copied the compiled version there.  It works
>> without setting PYTHONHOME and without /usr/local/bin in root's path.
>
> More than likely you used 'sudo' to restart Apache and it therefore
> picked up your personal PATH which had /usr/local/bin first. Do a:
>
>  sudo -H apachcetl stop
>  sudo -H apachectl start
>
> and see if you are so lucky. The -H option prevents your personal user
> environment transferring over to Apache startup environment.
>
> Graham
>
>> To answer your question, using the OS-provided installation (whatever
>> the OS) leaves your software to the mercies of the OS's update  
>> schedule.
>>
>> --S.
>>
>> On Nov 25, 2007, at 14:17, Graham Dumpleton wrote:
>>
>>> In 'envvars' file in the same directory as the real httpd you want
>>> to run, add:
>>>
>>> PYTHONHOME=/usr/local
>>> export PYTHONHOME
>>>
>>> Alternatively, you must ensure that the PATH of the user that Apache
>>> is started as has /usr/local/bin in its path before /usr/bin, else  
>>> it
>>> will find the wrong 'python' executable and thus end up looking in  
>>> the
>>> wrong location for the corresponding lib directory.
>>>
>>> Search the mod_python mailing lists for past discussions on this
>>> issue.
>>>
>>> BTW, why do you want to install your own version of Python 2.5, what
>>> is wrong with the Python 2.5 that the operating system ships?
>>>
>>> Graham
>>>
>>> On 26/11/2007, Simon Kesenci <god@skri.org> wrote:
>>>> I recently upgraded my PowerBook (PPC) to Leopard.  Piece by  
>>>> piece I
>>>> started reassembling my web server test bed (httpd 2.2.6, Python
>>>> 2.5.1, mod_python 3.3.1), which worked perfectly on Tiger.  I built
>>>> everything from their sources.
>>>>
>>>> This time around I got everything to work except for mod_python.   
>>>> My
>>>> procedure had the following non-standard edits:
>>>>
>>>> httpd 2.2.6:
>>>>    Changed APR_HAS_SENDFILE to 0 in srclib/apr/include/apr.h
>>>>    After installation I backed up /usr/sbin/httpd and entered
>>>>      ln -s /usr/local/apache2/bin/httpd /usr/sbin/httpd.
>>>>    (This allows you to activate the compiled httpd from the Sharing
>>>> Preferences, which will also have the built-in firewall open and
>>>> close
>>>> port 80 in sync with the server.)
>>>>
>>>> Python 2.5.1:
>>>>    After ./configure --enable-framework I added -DSETPGRP_HAVE_ARG
>>>> to the top-level Makefile (make exits with an error otherwise due
>>>> to a
>>>> lack of arguments to setpgrp()).
>>>>
>>>> Both of the above work as expected, but when I threw mod_python  
>>>> into
>>>> the mix I kept getting the following error:
>>>>
>>>> [Sun Nov 25 09:43:22 2007] [error] make_obcallback: could not  
>>>> import
>>>> mod_python.apache.\n
>>>> ImportError: No module named mod_python.apache
>>>> [Sun Nov 25 09:43:22 2007] [error] make_obcallback: Python path  
>>>> being
>>>> used "['/usr/lib/python25.zip', '/usr/lib/python2.5', '/usr/lib/
>>>> python2.5/plat-darwin', '/usr/lib/python2.5/plat-mac', '/usr/lib/
>>>> python2.5/plat-mac/lib-scriptpackages', '/usr/lib/python2.5/lib-
>>>> tk', '/
>>>> usr/lib/python2.5/lib-dynload', '/Library/Python/2.5/site-
>>>> packages']".
>>>> [Sun Nov 25 09:43:22 2007] [error] get_interpreter: no interpreter
>>>> callback found.
>>>> [Sun Nov 25 09:43:22 2007] [error] [client 10.0.1.2]  
>>>> python_handler:
>>>> Can't get/create interpreter., referer: http://10.0.1.2/~simon/ 
>>>> test/
>>>>
>>>> I used a number of scripts to test the installation, including
>>>> mptest.py from the mod_python doc.  The last script I used to test
>>>> did
>>>> not import mod_python.apache explicitly:
>>>>
>>>> from mod_python import util
>>>>
>>>> def index(req):
>>>>  util.redirect(req, 'www.example.com')
>>>>
>>>> While installing mod_python the output made clear that it took up  
>>>> the
>>>> interpreter in /usr/local/bin rather than the one provided by Apple
>>>> in /usr/bin and installed under /Library/Frameworks/ 
>>>> Python.framework/
>>>> Versions/2.5/lib/python2.5/site-packages/ rather than /Library/
>>>> Python/
>>>> 2.5/site-packages.
>>>>
>>>> I don't know from where it pulled that path.  The interpreter I
>>>> compiled uses the path:
>>>>
>>>> ['', '/Library/Frameworks/Python.framework/Versions/2.5/lib/
>>>> python25.zip', '/Library/Frameworks/Python.framework/Versions/2.5/
>>>> lib/
>>>> python2.5', '/Library/Frameworks/Python.framework/Versions/2.5/lib/
>>>> python2.5/plat-darwin', '/Library/Frameworks/Python.framework/
>>>> Versions/
>>>> 2.5/lib/python2.5/plat-mac', '/Library/Frameworks/Python.framework/
>>>> Versions/2.5/lib/python2.5/plat-mac/lib-scriptpackages', '/Library/
>>>> Frameworks/Python.framework/Versions/2.5/lib/python2.5/lib-tk', '/
>>>> Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/lib-
>>>> dynload', '/Library/Frameworks/Python.framework/Versions/2.5/lib/
>>>> python2.5/site-packages']
>>>>
>>>> The interpreter provided by Apple uses:
>>>>
>>>> ['', '/System/Library/Frameworks/Python.framework/Versions/2.5/lib/
>>>> python25.zip', '/System/Library/Frameworks/Python.framework/ 
>>>> Versions/
>>>> 2.5/lib/python2.5', '/System/Library/Frameworks/Python.framework/
>>>> Versions/2.5/lib/python2.5/plat-darwin', '/System/Library/ 
>>>> Frameworks/
>>>> Python.framework/Versions/2.5/lib/python2.5/plat-mac', '/System/
>>>> Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/ 
>>>> plat-
>>>> mac/lib-scriptpackages', '/System/Library/Frameworks/
>>>> Python.framework/
>>>> Versions/2.5/Extras/lib/python', '/System/Library/Frameworks/
>>>> Python.framework/Versions/2.5/lib/python2.5/lib-tk', '/System/
>>>> Library/
>>>> Frameworks/Python.framework/Versions/2.5/lib/python2.5/lib-
>>>> dynload', '/
>>>> Library/Python/2.5/site-packages', '/System/Library/Frameworks/
>>>> Python.framework/Versions/2.5/Extras/lib/python/PyObjC']
>>>>
>>>> This morning I logged on to my Linux web server and installed all
>>>> these packages from source without any problems.
>>>>
>>>> --S.
>>>>
>>>> _______________________________________________
>>>> Mod_python mailing list
>>>> Mod_python@modpython.org
>>>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>>>
>>
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>

From graham.dumpleton at gmail.com  Sun Nov 25 22:50:44 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sun Nov 25 22:50:48 2007
Subject: [mod_python] Mac OS X Leopard upset my mod_python test bed.
In-Reply-To: <72F7E125-E3E3-4DFD-84CC-5838D2F7965B@skri.org>
References: <BFFC4290-0C4B-43D8-9F38-1B140A35B767@skri.org>
	<88e286470711251417u255499deoc4dc28a0ab022765@mail.gmail.com>
	<66081662-AD86-4D5F-BEF2-6E4A143ACE66@skri.org>
	<88e286470711251821l493fa193vdf8b1673cd3c4d69@mail.gmail.com>
	<72F7E125-E3E3-4DFD-84CC-5838D2F7965B@skri.org>
Message-ID: <88e286470711251950v5800db85o1f6ae063681942af@mail.gmail.com>

If you run a mod_python test handler and display back sys.path to your
browser, what does it show?

Graham

On 26/11/2007, Simon Kesenci <god@skri.org> wrote:
> Not sure how the Sharing Preferences starts apache but I suspect it
> uses something similar to sudo.  At any rate I tried starting it the
> way you described and mod_python still worked as expected.
>
> I then removed /usr/local/bin from my personal account's path and
> logged back in, confirmed that the path lacked /usr/local/bin, used
> sudo -H to start apache again and mod_python still worked.
>
> I then renamed /usr/local/bin to /usr/local/bin2, restarted apache and
> mod_python still worked.
>
> It seems mod_python only needs to find the executable at the time you
> compile mod_python.
>
> Though I have my setup working, the question of where mod_python got
> the path in the error log in my original message remains.  Neither
> interpreter on my computer yields that result via sys.path (although
> some of the items in that list correspond, via symlinks, to locations
> on the path from the interpreter that came with Leopard).
>
> --S.
>
> On Nov 25, 2007, at 18:21, Graham Dumpleton wrote:
>
> > On 26/11/2007, Simon Kesenci <god@skri.org> wrote:
> >> I haven't found a discussion of this problem in the archives.
> >>
> >> Strange stuff.  It started working properly after I removed the /usr/
> >> sbin/httpd symlink and copied the compiled version there.  It works
> >> without setting PYTHONHOME and without /usr/local/bin in root's path.
> >
> > More than likely you used 'sudo' to restart Apache and it therefore
> > picked up your personal PATH which had /usr/local/bin first. Do a:
> >
> >  sudo -H apachcetl stop
> >  sudo -H apachectl start
> >
> > and see if you are so lucky. The -H option prevents your personal user
> > environment transferring over to Apache startup environment.
> >
> > Graham
> >
> >> To answer your question, using the OS-provided installation (whatever
> >> the OS) leaves your software to the mercies of the OS's update
> >> schedule.
> >>
> >> --S.
> >>
> >> On Nov 25, 2007, at 14:17, Graham Dumpleton wrote:
> >>
> >>> In 'envvars' file in the same directory as the real httpd you want
> >>> to run, add:
> >>>
> >>> PYTHONHOME=/usr/local
> >>> export PYTHONHOME
> >>>
> >>> Alternatively, you must ensure that the PATH of the user that Apache
> >>> is started as has /usr/local/bin in its path before /usr/bin, else
> >>> it
> >>> will find the wrong 'python' executable and thus end up looking in
> >>> the
> >>> wrong location for the corresponding lib directory.
> >>>
> >>> Search the mod_python mailing lists for past discussions on this
> >>> issue.
> >>>
> >>> BTW, why do you want to install your own version of Python 2.5, what
> >>> is wrong with the Python 2.5 that the operating system ships?
> >>>
> >>> Graham
> >>>
> >>> On 26/11/2007, Simon Kesenci <god@skri.org> wrote:
> >>>> I recently upgraded my PowerBook (PPC) to Leopard.  Piece by
> >>>> piece I
> >>>> started reassembling my web server test bed (httpd 2.2.6, Python
> >>>> 2.5.1, mod_python 3.3.1), which worked perfectly on Tiger.  I built
> >>>> everything from their sources.
> >>>>
> >>>> This time around I got everything to work except for mod_python.
> >>>> My
> >>>> procedure had the following non-standard edits:
> >>>>
> >>>> httpd 2.2.6:
> >>>>    Changed APR_HAS_SENDFILE to 0 in srclib/apr/include/apr.h
> >>>>    After installation I backed up /usr/sbin/httpd and entered
> >>>>      ln -s /usr/local/apache2/bin/httpd /usr/sbin/httpd.
> >>>>    (This allows you to activate the compiled httpd from the Sharing
> >>>> Preferences, which will also have the built-in firewall open and
> >>>> close
> >>>> port 80 in sync with the server.)
> >>>>
> >>>> Python 2.5.1:
> >>>>    After ./configure --enable-framework I added -DSETPGRP_HAVE_ARG
> >>>> to the top-level Makefile (make exits with an error otherwise due
> >>>> to a
> >>>> lack of arguments to setpgrp()).
> >>>>
> >>>> Both of the above work as expected, but when I threw mod_python
> >>>> into
> >>>> the mix I kept getting the following error:
> >>>>
> >>>> [Sun Nov 25 09:43:22 2007] [error] make_obcallback: could not
> >>>> import
> >>>> mod_python.apache.\n
> >>>> ImportError: No module named mod_python.apache
> >>>> [Sun Nov 25 09:43:22 2007] [error] make_obcallback: Python path
> >>>> being
> >>>> used "['/usr/lib/python25.zip', '/usr/lib/python2.5', '/usr/lib/
> >>>> python2.5/plat-darwin', '/usr/lib/python2.5/plat-mac', '/usr/lib/
> >>>> python2.5/plat-mac/lib-scriptpackages', '/usr/lib/python2.5/lib-
> >>>> tk', '/
> >>>> usr/lib/python2.5/lib-dynload', '/Library/Python/2.5/site-
> >>>> packages']".
> >>>> [Sun Nov 25 09:43:22 2007] [error] get_interpreter: no interpreter
> >>>> callback found.
> >>>> [Sun Nov 25 09:43:22 2007] [error] [client 10.0.1.2]
> >>>> python_handler:
> >>>> Can't get/create interpreter., referer: http://10.0.1.2/~simon/
> >>>> test/
> >>>>
> >>>> I used a number of scripts to test the installation, including
> >>>> mptest.py from the mod_python doc.  The last script I used to test
> >>>> did
> >>>> not import mod_python.apache explicitly:
> >>>>
> >>>> from mod_python import util
> >>>>
> >>>> def index(req):
> >>>>  util.redirect(req, 'www.example.com')
> >>>>
> >>>> While installing mod_python the output made clear that it took up
> >>>> the
> >>>> interpreter in /usr/local/bin rather than the one provided by Apple
> >>>> in /usr/bin and installed under /Library/Frameworks/
> >>>> Python.framework/
> >>>> Versions/2.5/lib/python2.5/site-packages/ rather than /Library/
> >>>> Python/
> >>>> 2.5/site-packages.
> >>>>
> >>>> I don't know from where it pulled that path.  The interpreter I
> >>>> compiled uses the path:
> >>>>
> >>>> ['', '/Library/Frameworks/Python.framework/Versions/2.5/lib/
> >>>> python25.zip', '/Library/Frameworks/Python.framework/Versions/2.5/
> >>>> lib/
> >>>> python2.5', '/Library/Frameworks/Python.framework/Versions/2.5/lib/
> >>>> python2.5/plat-darwin', '/Library/Frameworks/Python.framework/
> >>>> Versions/
> >>>> 2.5/lib/python2.5/plat-mac', '/Library/Frameworks/Python.framework/
> >>>> Versions/2.5/lib/python2.5/plat-mac/lib-scriptpackages', '/Library/
> >>>> Frameworks/Python.framework/Versions/2.5/lib/python2.5/lib-tk', '/
> >>>> Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/lib-
> >>>> dynload', '/Library/Frameworks/Python.framework/Versions/2.5/lib/
> >>>> python2.5/site-packages']
> >>>>
> >>>> The interpreter provided by Apple uses:
> >>>>
> >>>> ['', '/System/Library/Frameworks/Python.framework/Versions/2.5/lib/
> >>>> python25.zip', '/System/Library/Frameworks/Python.framework/
> >>>> Versions/
> >>>> 2.5/lib/python2.5', '/System/Library/Frameworks/Python.framework/
> >>>> Versions/2.5/lib/python2.5/plat-darwin', '/System/Library/
> >>>> Frameworks/
> >>>> Python.framework/Versions/2.5/lib/python2.5/plat-mac', '/System/
> >>>> Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/
> >>>> plat-
> >>>> mac/lib-scriptpackages', '/System/Library/Frameworks/
> >>>> Python.framework/
> >>>> Versions/2.5/Extras/lib/python', '/System/Library/Frameworks/
> >>>> Python.framework/Versions/2.5/lib/python2.5/lib-tk', '/System/
> >>>> Library/
> >>>> Frameworks/Python.framework/Versions/2.5/lib/python2.5/lib-
> >>>> dynload', '/
> >>>> Library/Python/2.5/site-packages', '/System/Library/Frameworks/
> >>>> Python.framework/Versions/2.5/Extras/lib/python/PyObjC']
> >>>>
> >>>> This morning I logged on to my Linux web server and installed all
> >>>> these packages from source without any problems.
> >>>>
> >>>> --S.
> >>>>
> >>>> _______________________________________________
> >>>> Mod_python mailing list
> >>>> Mod_python@modpython.org
> >>>> http://mailman.modpython.org/mailman/listinfo/mod_python
> >>>>
> >>
> >> _______________________________________________
> >> Mod_python mailing list
> >> Mod_python@modpython.org
> >> http://mailman.modpython.org/mailman/listinfo/mod_python
> >>
>
>
From god at skri.org  Sun Nov 25 23:12:06 2007
From: god at skri.org (Simon Kesenci)
Date: Sun Nov 25 23:12:15 2007
Subject: [mod_python] Mac OS X Leopard upset my mod_python test bed.
In-Reply-To: <88e286470711251950v5800db85o1f6ae063681942af@mail.gmail.com>
References: <BFFC4290-0C4B-43D8-9F38-1B140A35B767@skri.org>
	<88e286470711251417u255499deoc4dc28a0ab022765@mail.gmail.com>
	<66081662-AD86-4D5F-BEF2-6E4A143ACE66@skri.org>
	<88e286470711251821l493fa193vdf8b1673cd3c4d69@mail.gmail.com>
	<72F7E125-E3E3-4DFD-84CC-5838D2F7965B@skri.org>
	<88e286470711251950v5800db85o1f6ae063681942af@mail.gmail.com>
Message-ID: <6BEE7180-5F32-4936-B30C-901FF0CB2720@skri.org>

It shows the same result as for sys.path from the interpreter I  
compiled, minus the first item (''; no newline after <pre> in the  
source).

/Library/Frameworks/Python.framework/Versions/2.5/lib/python25.zip / 
Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5 / 
Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/plat- 
darwin /Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/ 
plat-mac /Library/Frameworks/Python.framework/Versions/2.5/lib/ 
python2.5/plat-mac/lib-scriptpackages /Library/Frameworks/ 
Python.framework/Versions/2.5/lib/python2.5/lib-tk /Library/Frameworks/ 
Python.framework/Versions/2.5/lib/python2.5/lib-dynload /Library/ 
Frameworks/Python.framework/Versions/2.5/lib/python2.5/site-packages


--S.

On Nov 25, 2007, at 19:50, Graham Dumpleton wrote:

> If you run a mod_python test handler and display back sys.path to your
> browser, what does it show?
>
> Graham
>
> On 26/11/2007, Simon Kesenci <god@skri.org> wrote:
>> Not sure how the Sharing Preferences starts apache but I suspect it
>> uses something similar to sudo.  At any rate I tried starting it the
>> way you described and mod_python still worked as expected.
>>
>> I then removed /usr/local/bin from my personal account's path and
>> logged back in, confirmed that the path lacked /usr/local/bin, used
>> sudo -H to start apache again and mod_python still worked.
>>
>> I then renamed /usr/local/bin to /usr/local/bin2, restarted apache  
>> and
>> mod_python still worked.
>>
>> It seems mod_python only needs to find the executable at the time you
>> compile mod_python.
>>
>> Though I have my setup working, the question of where mod_python got
>> the path in the error log in my original message remains.  Neither
>> interpreter on my computer yields that result via sys.path (although
>> some of the items in that list correspond, via symlinks, to locations
>> on the path from the interpreter that came with Leopard).
>>
>> --S.
>>
>> On Nov 25, 2007, at 18:21, Graham Dumpleton wrote:
>>
>>> On 26/11/2007, Simon Kesenci <god@skri.org> wrote:
>>>> I haven't found a discussion of this problem in the archives.
>>>>
>>>> Strange stuff.  It started working properly after I removed the / 
>>>> usr/
>>>> sbin/httpd symlink and copied the compiled version there.  It works
>>>> without setting PYTHONHOME and without /usr/local/bin in root's  
>>>> path.
>>>
>>> More than likely you used 'sudo' to restart Apache and it therefore
>>> picked up your personal PATH which had /usr/local/bin first. Do a:
>>>
>>> sudo -H apachcetl stop
>>> sudo -H apachectl start
>>>
>>> and see if you are so lucky. The -H option prevents your personal  
>>> user
>>> environment transferring over to Apache startup environment.
>>>
>>> Graham
>>>
>>>> To answer your question, using the OS-provided installation  
>>>> (whatever
>>>> the OS) leaves your software to the mercies of the OS's update
>>>> schedule.
>>>>
>>>> --S.
>>>>
>>>> On Nov 25, 2007, at 14:17, Graham Dumpleton wrote:
>>>>
>>>>> In 'envvars' file in the same directory as the real httpd you want
>>>>> to run, add:
>>>>>
>>>>> PYTHONHOME=/usr/local
>>>>> export PYTHONHOME
>>>>>
>>>>> Alternatively, you must ensure that the PATH of the user that  
>>>>> Apache
>>>>> is started as has /usr/local/bin in its path before /usr/bin, else
>>>>> it
>>>>> will find the wrong 'python' executable and thus end up looking in
>>>>> the
>>>>> wrong location for the corresponding lib directory.
>>>>>
>>>>> Search the mod_python mailing lists for past discussions on this
>>>>> issue.
>>>>>
>>>>> BTW, why do you want to install your own version of Python 2.5,  
>>>>> what
>>>>> is wrong with the Python 2.5 that the operating system ships?
>>>>>
>>>>> Graham
>>>>>
>>>>> On 26/11/2007, Simon Kesenci <god@skri.org> wrote:
>>>>>> I recently upgraded my PowerBook (PPC) to Leopard.  Piece by
>>>>>> piece I
>>>>>> started reassembling my web server test bed (httpd 2.2.6, Python
>>>>>> 2.5.1, mod_python 3.3.1), which worked perfectly on Tiger.  I  
>>>>>> built
>>>>>> everything from their sources.
>>>>>>
>>>>>> This time around I got everything to work except for mod_python.
>>>>>> My
>>>>>> procedure had the following non-standard edits:
>>>>>>
>>>>>> httpd 2.2.6:
>>>>>>   Changed APR_HAS_SENDFILE to 0 in srclib/apr/include/apr.h
>>>>>>   After installation I backed up /usr/sbin/httpd and entered
>>>>>>     ln -s /usr/local/apache2/bin/httpd /usr/sbin/httpd.
>>>>>>   (This allows you to activate the compiled httpd from the  
>>>>>> Sharing
>>>>>> Preferences, which will also have the built-in firewall open and
>>>>>> close
>>>>>> port 80 in sync with the server.)
>>>>>>
>>>>>> Python 2.5.1:
>>>>>>   After ./configure --enable-framework I added -DSETPGRP_HAVE_ARG
>>>>>> to the top-level Makefile (make exits with an error otherwise due
>>>>>> to a
>>>>>> lack of arguments to setpgrp()).
>>>>>>
>>>>>> Both of the above work as expected, but when I threw mod_python
>>>>>> into
>>>>>> the mix I kept getting the following error:
>>>>>>
>>>>>> [Sun Nov 25 09:43:22 2007] [error] make_obcallback: could not
>>>>>> import
>>>>>> mod_python.apache.\n
>>>>>> ImportError: No module named mod_python.apache
>>>>>> [Sun Nov 25 09:43:22 2007] [error] make_obcallback: Python path
>>>>>> being
>>>>>> used "['/usr/lib/python25.zip', '/usr/lib/python2.5', '/usr/lib/
>>>>>> python2.5/plat-darwin', '/usr/lib/python2.5/plat-mac', '/usr/lib/
>>>>>> python2.5/plat-mac/lib-scriptpackages', '/usr/lib/python2.5/lib-
>>>>>> tk', '/
>>>>>> usr/lib/python2.5/lib-dynload', '/Library/Python/2.5/site-
>>>>>> packages']".
>>>>>> [Sun Nov 25 09:43:22 2007] [error] get_interpreter: no  
>>>>>> interpreter
>>>>>> callback found.
>>>>>> [Sun Nov 25 09:43:22 2007] [error] [client 10.0.1.2]
>>>>>> python_handler:
>>>>>> Can't get/create interpreter., referer: http://10.0.1.2/~simon/
>>>>>> test/
>>>>>>
>>>>>> I used a number of scripts to test the installation, including
>>>>>> mptest.py from the mod_python doc.  The last script I used to  
>>>>>> test
>>>>>> did
>>>>>> not import mod_python.apache explicitly:
>>>>>>
>>>>>> from mod_python import util
>>>>>>
>>>>>> def index(req):
>>>>>> util.redirect(req, 'www.example.com')
>>>>>>
>>>>>> While installing mod_python the output made clear that it took up
>>>>>> the
>>>>>> interpreter in /usr/local/bin rather than the one provided by  
>>>>>> Apple
>>>>>> in /usr/bin and installed under /Library/Frameworks/
>>>>>> Python.framework/
>>>>>> Versions/2.5/lib/python2.5/site-packages/ rather than /Library/
>>>>>> Python/
>>>>>> 2.5/site-packages.
>>>>>>
>>>>>> I don't know from where it pulled that path.  The interpreter I
>>>>>> compiled uses the path:
>>>>>>
>>>>>> ['', '/Library/Frameworks/Python.framework/Versions/2.5/lib/
>>>>>> python25.zip', '/Library/Frameworks/Python.framework/Versions/ 
>>>>>> 2.5/
>>>>>> lib/
>>>>>> python2.5', '/Library/Frameworks/Python.framework/Versions/2.5/ 
>>>>>> lib/
>>>>>> python2.5/plat-darwin', '/Library/Frameworks/Python.framework/
>>>>>> Versions/
>>>>>> 2.5/lib/python2.5/plat-mac', '/Library/Frameworks/ 
>>>>>> Python.framework/
>>>>>> Versions/2.5/lib/python2.5/plat-mac/lib-scriptpackages', '/ 
>>>>>> Library/
>>>>>> Frameworks/Python.framework/Versions/2.5/lib/python2.5/lib-tk',  
>>>>>> '/
>>>>>> Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/ 
>>>>>> lib-
>>>>>> dynload', '/Library/Frameworks/Python.framework/Versions/2.5/lib/
>>>>>> python2.5/site-packages']
>>>>>>
>>>>>> The interpreter provided by Apple uses:
>>>>>>
>>>>>> ['', '/System/Library/Frameworks/Python.framework/Versions/2.5/ 
>>>>>> lib/
>>>>>> python25.zip', '/System/Library/Frameworks/Python.framework/
>>>>>> Versions/
>>>>>> 2.5/lib/python2.5', '/System/Library/Frameworks/Python.framework/
>>>>>> Versions/2.5/lib/python2.5/plat-darwin', '/System/Library/
>>>>>> Frameworks/
>>>>>> Python.framework/Versions/2.5/lib/python2.5/plat-mac', '/System/
>>>>>> Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/
>>>>>> plat-
>>>>>> mac/lib-scriptpackages', '/System/Library/Frameworks/
>>>>>> Python.framework/
>>>>>> Versions/2.5/Extras/lib/python', '/System/Library/Frameworks/
>>>>>> Python.framework/Versions/2.5/lib/python2.5/lib-tk', '/System/
>>>>>> Library/
>>>>>> Frameworks/Python.framework/Versions/2.5/lib/python2.5/lib-
>>>>>> dynload', '/
>>>>>> Library/Python/2.5/site-packages', '/System/Library/Frameworks/
>>>>>> Python.framework/Versions/2.5/Extras/lib/python/PyObjC']
>>>>>>
>>>>>> This morning I logged on to my Linux web server and installed all
>>>>>> these packages from source without any problems.
>>>>>>
>>>>>> --S.
>>>>>>
>>>>>> _______________________________________________
>>>>>> Mod_python mailing list
>>>>>> Mod_python@modpython.org
>>>>>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>>>>>
>>>>
>>>> _______________________________________________
>>>> Mod_python mailing list
>>>> Mod_python@modpython.org
>>>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>>>
>>
>>

From graham.dumpleton at gmail.com  Sun Nov 25 23:25:02 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sun Nov 25 23:25:08 2007
Subject: [mod_python] Mac OS X Leopard upset my mod_python test bed.
In-Reply-To: <6BEE7180-5F32-4936-B30C-901FF0CB2720@skri.org>
References: <BFFC4290-0C4B-43D8-9F38-1B140A35B767@skri.org>
	<88e286470711251417u255499deoc4dc28a0ab022765@mail.gmail.com>
	<66081662-AD86-4D5F-BEF2-6E4A143ACE66@skri.org>
	<88e286470711251821l493fa193vdf8b1673cd3c4d69@mail.gmail.com>
	<72F7E125-E3E3-4DFD-84CC-5838D2F7965B@skri.org>
	<88e286470711251950v5800db85o1f6ae063681942af@mail.gmail.com>
	<6BEE7180-5F32-4936-B30C-901FF0CB2720@skri.org>
Message-ID: <88e286470711252025x3dd80c11vbb7a18bbdcc65e4@mail.gmail.com>

Okay, I think I understand now. Although you have new 'python'
installed in /usr/local/bin, it hasn't installed library stuff in
/usr/local/lib, but has used
/Library/Frameworks/Python.framework/Versions/2.5/lib instead. Because
of that it will probably work, although I'd be cautious about same
major/minor version being installed under /Library.

The workarounds I described are only needed if the Python you built
was for example putting library stuff under /usr/local and thus not in
normal framework search locations.

Whatever works I guess. :-)

On 26/11/2007, Simon Kesenci <god@skri.org> wrote:
> It shows the same result as for sys.path from the interpreter I
> compiled, minus the first item (''; no newline after <pre> in the
> source).
>
> /Library/Frameworks/Python.framework/Versions/2.5/lib/python25.zip /
> Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5 /
> Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/plat-
> darwin /Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/
> plat-mac /Library/Frameworks/Python.framework/Versions/2.5/lib/
> python2.5/plat-mac/lib-scriptpackages /Library/Frameworks/
> Python.framework/Versions/2.5/lib/python2.5/lib-tk /Library/Frameworks/
> Python.framework/Versions/2.5/lib/python2.5/lib-dynload /Library/
> Frameworks/Python.framework/Versions/2.5/lib/python2.5/site-packages
>
>
> --S.
>
> On Nov 25, 2007, at 19:50, Graham Dumpleton wrote:
>
> > If you run a mod_python test handler and display back sys.path to your
> > browser, what does it show?
> >
> > Graham
> >
> > On 26/11/2007, Simon Kesenci <god@skri.org> wrote:
> >> Not sure how the Sharing Preferences starts apache but I suspect it
> >> uses something similar to sudo.  At any rate I tried starting it the
> >> way you described and mod_python still worked as expected.
> >>
> >> I then removed /usr/local/bin from my personal account's path and
> >> logged back in, confirmed that the path lacked /usr/local/bin, used
> >> sudo -H to start apache again and mod_python still worked.
> >>
> >> I then renamed /usr/local/bin to /usr/local/bin2, restarted apache
> >> and
> >> mod_python still worked.
> >>
> >> It seems mod_python only needs to find the executable at the time you
> >> compile mod_python.
> >>
> >> Though I have my setup working, the question of where mod_python got
> >> the path in the error log in my original message remains.  Neither
> >> interpreter on my computer yields that result via sys.path (although
> >> some of the items in that list correspond, via symlinks, to locations
> >> on the path from the interpreter that came with Leopard).
> >>
> >> --S.
> >>
> >> On Nov 25, 2007, at 18:21, Graham Dumpleton wrote:
> >>
> >>> On 26/11/2007, Simon Kesenci <god@skri.org> wrote:
> >>>> I haven't found a discussion of this problem in the archives.
> >>>>
> >>>> Strange stuff.  It started working properly after I removed the /
> >>>> usr/
> >>>> sbin/httpd symlink and copied the compiled version there.  It works
> >>>> without setting PYTHONHOME and without /usr/local/bin in root's
> >>>> path.
> >>>
> >>> More than likely you used 'sudo' to restart Apache and it therefore
> >>> picked up your personal PATH which had /usr/local/bin first. Do a:
> >>>
> >>> sudo -H apachcetl stop
> >>> sudo -H apachectl start
> >>>
> >>> and see if you are so lucky. The -H option prevents your personal
> >>> user
> >>> environment transferring over to Apache startup environment.
> >>>
> >>> Graham
> >>>
> >>>> To answer your question, using the OS-provided installation
> >>>> (whatever
> >>>> the OS) leaves your software to the mercies of the OS's update
> >>>> schedule.
> >>>>
> >>>> --S.
> >>>>
> >>>> On Nov 25, 2007, at 14:17, Graham Dumpleton wrote:
> >>>>
> >>>>> In 'envvars' file in the same directory as the real httpd you want
> >>>>> to run, add:
> >>>>>
> >>>>> PYTHONHOME=/usr/local
> >>>>> export PYTHONHOME
> >>>>>
> >>>>> Alternatively, you must ensure that the PATH of the user that
> >>>>> Apache
> >>>>> is started as has /usr/local/bin in its path before /usr/bin, else
> >>>>> it
> >>>>> will find the wrong 'python' executable and thus end up looking in
> >>>>> the
> >>>>> wrong location for the corresponding lib directory.
> >>>>>
> >>>>> Search the mod_python mailing lists for past discussions on this
> >>>>> issue.
> >>>>>
> >>>>> BTW, why do you want to install your own version of Python 2.5,
> >>>>> what
> >>>>> is wrong with the Python 2.5 that the operating system ships?
> >>>>>
> >>>>> Graham
> >>>>>
> >>>>> On 26/11/2007, Simon Kesenci <god@skri.org> wrote:
> >>>>>> I recently upgraded my PowerBook (PPC) to Leopard.  Piece by
> >>>>>> piece I
> >>>>>> started reassembling my web server test bed (httpd 2.2.6, Python
> >>>>>> 2.5.1, mod_python 3.3.1), which worked perfectly on Tiger.  I
> >>>>>> built
> >>>>>> everything from their sources.
> >>>>>>
> >>>>>> This time around I got everything to work except for mod_python.
> >>>>>> My
> >>>>>> procedure had the following non-standard edits:
> >>>>>>
> >>>>>> httpd 2.2.6:
> >>>>>>   Changed APR_HAS_SENDFILE to 0 in srclib/apr/include/apr.h
> >>>>>>   After installation I backed up /usr/sbin/httpd and entered
> >>>>>>     ln -s /usr/local/apache2/bin/httpd /usr/sbin/httpd.
> >>>>>>   (This allows you to activate the compiled httpd from the
> >>>>>> Sharing
> >>>>>> Preferences, which will also have the built-in firewall open and
> >>>>>> close
> >>>>>> port 80 in sync with the server.)
> >>>>>>
> >>>>>> Python 2.5.1:
> >>>>>>   After ./configure --enable-framework I added -DSETPGRP_HAVE_ARG
> >>>>>> to the top-level Makefile (make exits with an error otherwise due
> >>>>>> to a
> >>>>>> lack of arguments to setpgrp()).
> >>>>>>
> >>>>>> Both of the above work as expected, but when I threw mod_python
> >>>>>> into
> >>>>>> the mix I kept getting the following error:
> >>>>>>
> >>>>>> [Sun Nov 25 09:43:22 2007] [error] make_obcallback: could not
> >>>>>> import
> >>>>>> mod_python.apache.\n
> >>>>>> ImportError: No module named mod_python.apache
> >>>>>> [Sun Nov 25 09:43:22 2007] [error] make_obcallback: Python path
> >>>>>> being
> >>>>>> used "['/usr/lib/python25.zip', '/usr/lib/python2.5', '/usr/lib/
> >>>>>> python2.5/plat-darwin', '/usr/lib/python2.5/plat-mac', '/usr/lib/
> >>>>>> python2.5/plat-mac/lib-scriptpackages', '/usr/lib/python2.5/lib-
> >>>>>> tk', '/
> >>>>>> usr/lib/python2.5/lib-dynload', '/Library/Python/2.5/site-
> >>>>>> packages']".
> >>>>>> [Sun Nov 25 09:43:22 2007] [error] get_interpreter: no
> >>>>>> interpreter
> >>>>>> callback found.
> >>>>>> [Sun Nov 25 09:43:22 2007] [error] [client 10.0.1.2]
> >>>>>> python_handler:
> >>>>>> Can't get/create interpreter., referer: http://10.0.1.2/~simon/
> >>>>>> test/
> >>>>>>
> >>>>>> I used a number of scripts to test the installation, including
> >>>>>> mptest.py from the mod_python doc.  The last script I used to
> >>>>>> test
> >>>>>> did
> >>>>>> not import mod_python.apache explicitly:
> >>>>>>
> >>>>>> from mod_python import util
> >>>>>>
> >>>>>> def index(req):
> >>>>>> util.redirect(req, 'www.example.com')
> >>>>>>
> >>>>>> While installing mod_python the output made clear that it took up
> >>>>>> the
> >>>>>> interpreter in /usr/local/bin rather than the one provided by
> >>>>>> Apple
> >>>>>> in /usr/bin and installed under /Library/Frameworks/
> >>>>>> Python.framework/
> >>>>>> Versions/2.5/lib/python2.5/site-packages/ rather than /Library/
> >>>>>> Python/
> >>>>>> 2.5/site-packages.
> >>>>>>
> >>>>>> I don't know from where it pulled that path.  The interpreter I
> >>>>>> compiled uses the path:
> >>>>>>
> >>>>>> ['', '/Library/Frameworks/Python.framework/Versions/2.5/lib/
> >>>>>> python25.zip', '/Library/Frameworks/Python.framework/Versions/
> >>>>>> 2.5/
> >>>>>> lib/
> >>>>>> python2.5', '/Library/Frameworks/Python.framework/Versions/2.5/
> >>>>>> lib/
> >>>>>> python2.5/plat-darwin', '/Library/Frameworks/Python.framework/
> >>>>>> Versions/
> >>>>>> 2.5/lib/python2.5/plat-mac', '/Library/Frameworks/
> >>>>>> Python.framework/
> >>>>>> Versions/2.5/lib/python2.5/plat-mac/lib-scriptpackages', '/
> >>>>>> Library/
> >>>>>> Frameworks/Python.framework/Versions/2.5/lib/python2.5/lib-tk',
> >>>>>> '/
> >>>>>> Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/
> >>>>>> lib-
> >>>>>> dynload', '/Library/Frameworks/Python.framework/Versions/2.5/lib/
> >>>>>> python2.5/site-packages']
> >>>>>>
> >>>>>> The interpreter provided by Apple uses:
> >>>>>>
> >>>>>> ['', '/System/Library/Frameworks/Python.framework/Versions/2.5/
> >>>>>> lib/
> >>>>>> python25.zip', '/System/Library/Frameworks/Python.framework/
> >>>>>> Versions/
> >>>>>> 2.5/lib/python2.5', '/System/Library/Frameworks/Python.framework/
> >>>>>> Versions/2.5/lib/python2.5/plat-darwin', '/System/Library/
> >>>>>> Frameworks/
> >>>>>> Python.framework/Versions/2.5/lib/python2.5/plat-mac', '/System/
> >>>>>> Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/
> >>>>>> plat-
> >>>>>> mac/lib-scriptpackages', '/System/Library/Frameworks/
> >>>>>> Python.framework/
> >>>>>> Versions/2.5/Extras/lib/python', '/System/Library/Frameworks/
> >>>>>> Python.framework/Versions/2.5/lib/python2.5/lib-tk', '/System/
> >>>>>> Library/
> >>>>>> Frameworks/Python.framework/Versions/2.5/lib/python2.5/lib-
> >>>>>> dynload', '/
> >>>>>> Library/Python/2.5/site-packages', '/System/Library/Frameworks/
> >>>>>> Python.framework/Versions/2.5/Extras/lib/python/PyObjC']
> >>>>>>
> >>>>>> This morning I logged on to my Linux web server and installed all
> >>>>>> these packages from source without any problems.
> >>>>>>
> >>>>>> --S.
> >>>>>>
> >>>>>> _______________________________________________
> >>>>>> Mod_python mailing list
> >>>>>> Mod_python@modpython.org
> >>>>>> http://mailman.modpython.org/mailman/listinfo/mod_python
> >>>>>>
> >>>>
> >>>> _______________________________________________
> >>>> Mod_python mailing list
> >>>> Mod_python@modpython.org
> >>>> http://mailman.modpython.org/mailman/listinfo/mod_python
> >>>>
> >>
> >>
>
>
From harish at octopart.com  Mon Nov 26 13:39:27 2007
From: harish at octopart.com (Harish Agarwal)
Date: Mon Nov 26 13:39:38 2007
Subject: [mod_python] Session Hanging Problems
Message-ID: <223DABED-F63D-45B0-B1CF-B8F6A75E8E2A@octopart.com>

I'm using session handling with ModPython 3.3.1.  Originally I was  
using DbmSession and have since transitioned to a custom MySQL Session  
handler.  With both session types, however, I've noticed that session  
initialization intermittently hangs (not forever, but takes as long as  
four minutes to complete), at a low-ish (a handful of times every  
hour, while receiving, say, on order of a thousand or so requests  
every hour) frequency which seems to scale with the amount of traffic  
we're receiving.  I had read that long DbmSession cleanups can cause  
problems, which is why I transitioned to the MySQL system, which takes  
< 1 second to complete, but I'm still noticing the long session init  
times.


I put some debugging statements into the code and it seems to be  
related to session locking.  In particular, it is this function call  
in the lock method of the BaseSession class:


_apache._global_lock(self._req.server, self._sid)


which is taking some time to complete. I'm not familiar with  
_apache._global_lock (is it used to apply a mutex lock to the  
session?) and am having trouble finding information describing its  
usage - but it seems likely that this is the root cause.  In the past  
I've had problems with session locking but have since transitioned the  
code to ensure that only one session is created per request, as such:

if not hasattr(req,'session'):
             req.session = Session.MySQLSession(req)


Can anyone tell me if this kind of behavior is normal or is indicative  
of some common configuration or coding error?  Any help would be  
greatly appreciated.

Thanks,
-Harish
From davidjanes at blogmatrix.com  Mon Nov 26 13:55:39 2007
From: davidjanes at blogmatrix.com (David Janes)
Date: Mon Nov 26 13:55:47 2007
Subject: [mod_python] Session Hanging Problems
In-Reply-To: <223DABED-F63D-45B0-B1CF-B8F6A75E8E2A@octopart.com>
References: <223DABED-F63D-45B0-B1CF-B8F6A75E8E2A@octopart.com>
Message-ID: <21e523c20711261055h6d7c4007gb0754fcc1428ea81@mail.gmail.com>

All I can say is "we too" -- we're using FileSession. We have not been
able to come up with a cure, though we've minimized use of sessions
which brings the frequency down significantly.

Regards, etc...
David

On Nov 26, 2007 1:39 PM, Harish Agarwal <harish@octopart.com> wrote:
> I'm using session handling with ModPython 3.3.1.  Originally I was
> using DbmSession and have since transitioned to a custom MySQL Session
> handler.  With both session types, however, I've noticed that session
> initialization intermittently hangs (not forever, but takes as long as
> four minutes to complete), at a low-ish (a handful of times every
> hour, while receiving, say, on order of a thousand or so requests
> every hour) frequency which seems to scale with the amount of traffic
> we're receiving.  I had read that long DbmSession cleanups can cause
> problems, which is why I transitioned to the MySQL system, which takes
> < 1 second to complete, but I'm still noticing the long session init
> times.
>
>
> I put some debugging statements into the code and it seems to be
> related to session locking.  In particular, it is this function call
> in the lock method of the BaseSession class:
>
>
> _apache._global_lock(self._req.server, self._sid)
>
>
> which is taking some time to complete. I'm not familiar with
> _apache._global_lock (is it used to apply a mutex lock to the
> session?) and am having trouble finding information describing its
> usage - but it seems likely that this is the root cause.  In the past
> I've had problems with session locking but have since transitioned the
> code to ensure that only one session is created per request, as such:
>
> if not hasattr(req,'session'):
>              req.session = Session.MySQLSession(req)
>
>
> Can anyone tell me if this kind of behavior is normal or is indicative
> of some common configuration or coding error?  Any help would be
> greatly appreciated.
>
> Thanks,
> -Harish
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>



-- 
David Janes
Founder, BlogMatrix
http://www.blogmatrix.com
http://blogmatrix.blogmatrix.com
From dlenwell at gmail.com  Mon Nov 26 14:21:31 2007
From: dlenwell at gmail.com (David Lenwell)
Date: Mon Nov 26 14:21:44 2007
Subject: [mod_python] Session Hanging Problems
In-Reply-To: <21e523c20711261055h6d7c4007gb0754fcc1428ea81@mail.gmail.com>
References: <223DABED-F63D-45B0-B1CF-B8F6A75E8E2A@octopart.com>
	<21e523c20711261055h6d7c4007gb0754fcc1428ea81@mail.gmail.com>
Message-ID: <FAE275BD-DC2B-433E-B2C2-21C6AE67AA28@gmail.com>

yeah .. its very broken for me too .. What I am working on is my own  
session handler.. I don't feel that mysql is a valid replacement  
because it puts unnecessary load on your database server.

We are debating on open sourcing the code I am working on. if I win  
the argument that open source can be good for us then I will  
contribute my code to the project.


On Nov 26, 2007, at 10:55 AM, David Janes wrote:

> All I can say is "we too" -- we're using FileSession. We have not been
> able to come up with a cure, though we've minimized use of sessions
> which brings the frequency down significantly.
>
> Regards, etc...
> David
>
> On Nov 26, 2007 1:39 PM, Harish Agarwal <harish@octopart.com> wrote:
>> I'm using session handling with ModPython 3.3.1.  Originally I was
>> using DbmSession and have since transitioned to a custom MySQL  
>> Session
>> handler.  With both session types, however, I've noticed that session
>> initialization intermittently hangs (not forever, but takes as long  
>> as
>> four minutes to complete), at a low-ish (a handful of times every
>> hour, while receiving, say, on order of a thousand or so requests
>> every hour) frequency which seems to scale with the amount of traffic
>> we're receiving.  I had read that long DbmSession cleanups can cause
>> problems, which is why I transitioned to the MySQL system, which  
>> takes
>> < 1 second to complete, but I'm still noticing the long session init
>> times.
>>
>>
>> I put some debugging statements into the code and it seems to be
>> related to session locking.  In particular, it is this function call
>> in the lock method of the BaseSession class:
>>
>>
>> _apache._global_lock(self._req.server, self._sid)
>>
>>
>> which is taking some time to complete. I'm not familiar with
>> _apache._global_lock (is it used to apply a mutex lock to the
>> session?) and am having trouble finding information describing its
>> usage - but it seems likely that this is the root cause.  In the past
>> I've had problems with session locking but have since transitioned  
>> the
>> code to ensure that only one session is created per request, as such:
>>
>> if not hasattr(req,'session'):
>>             req.session = Session.MySQLSession(req)
>>
>>
>> Can anyone tell me if this kind of behavior is normal or is  
>> indicative
>> of some common configuration or coding error?  Any help would be
>> greatly appreciated.
>>
>> Thanks,
>> -Harish
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>
>
>
>
> -- 
> David Janes
> Founder, BlogMatrix
> http://www.blogmatrix.com
> http://blogmatrix.blogmatrix.com
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From harish at octopart.com  Mon Nov 26 14:29:36 2007
From: harish at octopart.com (Harish Agarwal)
Date: Mon Nov 26 14:30:05 2007
Subject: [mod_python] Session Hanging Problems
In-Reply-To: <FAE275BD-DC2B-433E-B2C2-21C6AE67AA28@gmail.com>
References: <223DABED-F63D-45B0-B1CF-B8F6A75E8E2A@octopart.com>
	<21e523c20711261055h6d7c4007gb0754fcc1428ea81@mail.gmail.com>
	<FAE275BD-DC2B-433E-B2C2-21C6AE67AA28@gmail.com>
Message-ID: <065D83D9-E2B6-458F-ABC6-748A5B9AC102@octopart.com>

Did you also have problems with _apache._global_lock?  For now, I'm  
not too worried about the database load (if necessary we can  
transition to an in memory session handler as well), I'd just like to  
understand the source of the problems as I have a feeling this problem  
will always show up (as the other David has noticed this problem with  
FileSession as well) as long as we're inheriting our session handler  
from BaseSession.

Thanks,
Harish

On Nov 26, 2007, at 11:21 AM, David Lenwell wrote:

> yeah .. its very broken for me too .. What I am working on is my own  
> session handler.. I don't feel that mysql is a valid replacement  
> because it puts unnecessary load on your database server.
>
> We are debating on open sourcing the code I am working on. if I win  
> the argument that open source can be good for us then I will  
> contribute my code to the project.
>
>
> On Nov 26, 2007, at 10:55 AM, David Janes wrote:
>
>> All I can say is "we too" -- we're using FileSession. We have not  
>> been
>> able to come up with a cure, though we've minimized use of sessions
>> which brings the frequency down significantly.
>>
>> Regards, etc...
>> David
>>
>> On Nov 26, 2007 1:39 PM, Harish Agarwal <harish@octopart.com> wrote:
>>> I'm using session handling with ModPython 3.3.1.  Originally I was
>>> using DbmSession and have since transitioned to a custom MySQL  
>>> Session
>>> handler.  With both session types, however, I've noticed that  
>>> session
>>> initialization intermittently hangs (not forever, but takes as  
>>> long as
>>> four minutes to complete), at a low-ish (a handful of times every
>>> hour, while receiving, say, on order of a thousand or so requests
>>> every hour) frequency which seems to scale with the amount of  
>>> traffic
>>> we're receiving.  I had read that long DbmSession cleanups can cause
>>> problems, which is why I transitioned to the MySQL system, which  
>>> takes
>>> < 1 second to complete, but I'm still noticing the long session init
>>> times.
>>>
>>>
>>> I put some debugging statements into the code and it seems to be
>>> related to session locking.  In particular, it is this function call
>>> in the lock method of the BaseSession class:
>>>
>>>
>>> _apache._global_lock(self._req.server, self._sid)
>>>
>>>
>>> which is taking some time to complete. I'm not familiar with
>>> _apache._global_lock (is it used to apply a mutex lock to the
>>> session?) and am having trouble finding information describing its
>>> usage - but it seems likely that this is the root cause.  In the  
>>> past
>>> I've had problems with session locking but have since transitioned  
>>> the
>>> code to ensure that only one session is created per request, as  
>>> such:
>>>
>>> if not hasattr(req,'session'):
>>>            req.session = Session.MySQLSession(req)
>>>
>>>
>>> Can anyone tell me if this kind of behavior is normal or is  
>>> indicative
>>> of some common configuration or coding error?  Any help would be
>>> greatly appreciated.
>>>
>>> Thanks,
>>> -Harish
>>> _______________________________________________
>>> Mod_python mailing list
>>> Mod_python@modpython.org
>>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>>
>>
>>
>>
>> -- 
>> David Janes
>> Founder, BlogMatrix
>> http://www.blogmatrix.com
>> http://blogmatrix.blogmatrix.com
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>

From davidjanes at blogmatrix.com  Mon Nov 26 14:50:01 2007
From: davidjanes at blogmatrix.com (David Janes)
Date: Mon Nov 26 14:50:07 2007
Subject: [mod_python] Session Hanging Problems
In-Reply-To: <FAE275BD-DC2B-433E-B2C2-21C6AE67AA28@gmail.com>
References: <223DABED-F63D-45B0-B1CF-B8F6A75E8E2A@octopart.com>
	<21e523c20711261055h6d7c4007gb0754fcc1428ea81@mail.gmail.com>
	<FAE275BD-DC2B-433E-B2C2-21C6AE67AA28@gmail.com>
Message-ID: <21e523c20711261150u5095ca9di4f95d125607df510@mail.gmail.com>

I'd be certainly interested in a non-mod_python session handler, since
I'm suspecting we'll be going to a non-Apache solution soon (since we
don't really take advantage of any Apache features right now) and we
were considering writing a generic one -- or adapting mod_python's
handlers.

On the other hand as Harish notes, it would be good to solve the
problem for mod_python as mod_python's been very good to us! I'm
wondering if there's any need at all to touch the Apache global lock
anyway, or if it can worked around another way.

Regards, etc...

PS: this is what I'm working on right now:
http://www.onaswarm.com

On Nov 26, 2007 2:21 PM, David Lenwell <dlenwell@gmail.com> wrote:
> yeah .. its very broken for me too .. What I am working on is my own
> session handler.. I don't feel that mysql is a valid replacement
> because it puts unnecessary load on your database server.
>
> We are debating on open sourcing the code I am working on. if I win
> the argument that open source can be good for us then I will
> contribute my code to the project.
>
>
>
> On Nov 26, 2007, at 10:55 AM, David Janes wrote:
>
> > All I can say is "we too" -- we're using FileSession. We have not been
> > able to come up with a cure, though we've minimized use of sessions
> > which brings the frequency down significantly.
> >
> > Regards, etc...
> > David
> >
> > On Nov 26, 2007 1:39 PM, Harish Agarwal <harish@octopart.com> wrote:
> >> I'm using session handling with ModPython 3.3.1.  Originally I was
> >> using DbmSession and have since transitioned to a custom MySQL
> >> Session
> >> handler.  With both session types, however, I've noticed that session
> >> initialization intermittently hangs (not forever, but takes as long
> >> as
> >> four minutes to complete), at a low-ish (a handful of times every
> >> hour, while receiving, say, on order of a thousand or so requests
> >> every hour) frequency which seems to scale with the amount of traffic
> >> we're receiving.  I had read that long DbmSession cleanups can cause
> >> problems, which is why I transitioned to the MySQL system, which
> >> takes
> >> < 1 second to complete, but I'm still noticing the long session init
> >> times.
> >>
> >>
> >> I put some debugging statements into the code and it seems to be
> >> related to session locking.  In particular, it is this function call
> >> in the lock method of the BaseSession class:
> >>
> >>
> >> _apache._global_lock(self._req.server, self._sid)
> >>
> >>
> >> which is taking some time to complete. I'm not familiar with
> >> _apache._global_lock (is it used to apply a mutex lock to the
> >> session?) and am having trouble finding information describing its
> >> usage - but it seems likely that this is the root cause.  In the past
> >> I've had problems with session locking but have since transitioned
> >> the
> >> code to ensure that only one session is created per request, as such:
> >>
> >> if not hasattr(req,'session'):
> >>             req.session = Session.MySQLSession(req)
> >>
> >>
> >> Can anyone tell me if this kind of behavior is normal or is
> >> indicative
> >> of some common configuration or coding error?  Any help would be
> >> greatly appreciated.
> >>
> >> Thanks,
> >> -Harish
> >> _______________________________________________
> >> Mod_python mailing list
> >> Mod_python@modpython.org
> >> http://mailman.modpython.org/mailman/listinfo/mod_python
> >>
> >
> >
> >
> > --
> > David Janes
> > Founder, BlogMatrix
> > http://www.blogmatrix.com
> > http://blogmatrix.blogmatrix.com
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
>
>



-- 
David Janes
Founder, BlogMatrix
http://www.blogmatrix.com
http://blogmatrix.blogmatrix.com
From dlenwell at gmail.com  Mon Nov 26 14:50:08 2007
From: dlenwell at gmail.com (David Lenwell)
Date: Mon Nov 26 14:50:20 2007
Subject: [mod_python] Session Hanging Problems
In-Reply-To: <065D83D9-E2B6-458F-ABC6-748A5B9AC102@octopart.com>
References: <223DABED-F63D-45B0-B1CF-B8F6A75E8E2A@octopart.com>
	<21e523c20711261055h6d7c4007gb0754fcc1428ea81@mail.gmail.com>
	<FAE275BD-DC2B-433E-B2C2-21C6AE67AA28@gmail.com>
	<065D83D9-E2B6-458F-ABC6-748A5B9AC102@octopart.com>
Message-ID: <7D15204B-21C4-47BF-A828-16C5B22EA9ED@gmail.com>

I did .. and then it stopped and I can't explain why .. our software  
is in alpha right now until I finish our custom session solution .. we  
won't go into production until I have this handled.  I messed with  
file permission, forcing different file dbm file names .. it  
eventually works but like you said it hangs for about 4 minutes with  
no explanation.

The database load is fine if you set it up right.. We played with  
running a separate version of mysql cluster across all our web servers  
since it keeps its data in memory, its pretty fast but I think we are  
transitioning to a shared memcache solution .. its all still in the  
air really until I can make something rock solid .. downtime isn't  
really an option.




On Nov 26, 2007, at 11:29 AM, Harish Agarwal wrote:

> Did you also have problems with _apache._global_lock?  For now, I'm  
> not too worried about the database load (if necessary we can  
> transition to an in memory session handler as well), I'd just like  
> to understand the source of the problems as I have a feeling this  
> problem will always show up (as the other David has noticed this  
> problem with FileSession as well) as long as we're inheriting our  
> session handler from BaseSession.
>
> Thanks,
> Harish
>
> On Nov 26, 2007, at 11:21 AM, David Lenwell wrote:
>
>> yeah .. its very broken for me too .. What I am working on is my  
>> own session handler.. I don't feel that mysql is a valid  
>> replacement because it puts unnecessary load on your database server.
>>
>> We are debating on open sourcing the code I am working on. if I win  
>> the argument that open source can be good for us then I will  
>> contribute my code to the project.
>>
>>
>> On Nov 26, 2007, at 10:55 AM, David Janes wrote:
>>
>>> All I can say is "we too" -- we're using FileSession. We have not  
>>> been
>>> able to come up with a cure, though we've minimized use of sessions
>>> which brings the frequency down significantly.
>>>
>>> Regards, etc...
>>> David
>>>
>>> On Nov 26, 2007 1:39 PM, Harish Agarwal <harish@octopart.com> wrote:
>>>> I'm using session handling with ModPython 3.3.1.  Originally I was
>>>> using DbmSession and have since transitioned to a custom MySQL  
>>>> Session
>>>> handler.  With both session types, however, I've noticed that  
>>>> session
>>>> initialization intermittently hangs (not forever, but takes as  
>>>> long as
>>>> four minutes to complete), at a low-ish (a handful of times every
>>>> hour, while receiving, say, on order of a thousand or so requests
>>>> every hour) frequency which seems to scale with the amount of  
>>>> traffic
>>>> we're receiving.  I had read that long DbmSession cleanups can  
>>>> cause
>>>> problems, which is why I transitioned to the MySQL system, which  
>>>> takes
>>>> < 1 second to complete, but I'm still noticing the long session  
>>>> init
>>>> times.
>>>>
>>>>
>>>> I put some debugging statements into the code and it seems to be
>>>> related to session locking.  In particular, it is this function  
>>>> call
>>>> in the lock method of the BaseSession class:
>>>>
>>>>
>>>> _apache._global_lock(self._req.server, self._sid)
>>>>
>>>>
>>>> which is taking some time to complete. I'm not familiar with
>>>> _apache._global_lock (is it used to apply a mutex lock to the
>>>> session?) and am having trouble finding information describing its
>>>> usage - but it seems likely that this is the root cause.  In the  
>>>> past
>>>> I've had problems with session locking but have since  
>>>> transitioned the
>>>> code to ensure that only one session is created per request, as  
>>>> such:
>>>>
>>>> if not hasattr(req,'session'):
>>>>           req.session = Session.MySQLSession(req)
>>>>
>>>>
>>>> Can anyone tell me if this kind of behavior is normal or is  
>>>> indicative
>>>> of some common configuration or coding error?  Any help would be
>>>> greatly appreciated.
>>>>
>>>> Thanks,
>>>> -Harish
>>>> _______________________________________________
>>>> Mod_python mailing list
>>>> Mod_python@modpython.org
>>>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>>>
>>>
>>>
>>>
>>> -- 
>>> David Janes
>>> Founder, BlogMatrix
>>> http://www.blogmatrix.com
>>> http://blogmatrix.blogmatrix.com
>>> _______________________________________________
>>> Mod_python mailing list
>>> Mod_python@modpython.org
>>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From harish at octopart.com  Mon Nov 26 15:08:28 2007
From: harish at octopart.com (Harish Agarwal)
Date: Mon Nov 26 15:08:44 2007
Subject: [mod_python] Session Hanging Problems
In-Reply-To: <21e523c20711261150u5095ca9di4f95d125607df510@mail.gmail.com>
References: <223DABED-F63D-45B0-B1CF-B8F6A75E8E2A@octopart.com>
	<21e523c20711261055h6d7c4007gb0754fcc1428ea81@mail.gmail.com>
	<FAE275BD-DC2B-433E-B2C2-21C6AE67AA28@gmail.com>
	<21e523c20711261150u5095ca9di4f95d125607df510@mail.gmail.com>
Message-ID: <BC3077B7-617E-4594-A83D-E24BE050C175@octopart.com>

Not sure if this helps at all, but I'm noticing that when the problem  
appears, it affects all of the incoming requests for a short  
duration.  The time logged to complete the call to  
_apache._global_lock decreases with each subsequent 'hung' request.

For instance, the last time I noticed a hang in the log files, the  
first hang took about 1000 seconds to complete (the hanging is getting  
much worse today as traffic has picked up after Thanksgiving), and the  
last hang in the 'batch' took about 70 seconds to complete.  The log  
statements were all printed out at more or less the same time, which  
makes me suspect that the requests came in at various points during  
the hang, which lasted a total of 1000 seconds, and then the hang was  
resolved at the same time for each one, at which point the log  
statements were printed.

I didn't have any problems accessing the site during this period of  
time, but that could be because I didn't hit the particular mod_python  
interpreter which was hanging.


Harish


On Nov 26, 2007, at 11:50 AM, David Janes wrote:

> I'd be certainly interested in a non-mod_python session handler, since
> I'm suspecting we'll be going to a non-Apache solution soon (since we
> don't really take advantage of any Apache features right now) and we
> were considering writing a generic one -- or adapting mod_python's
> handlers.
>
> On the other hand as Harish notes, it would be good to solve the
> problem for mod_python as mod_python's been very good to us! I'm
> wondering if there's any need at all to touch the Apache global lock
> anyway, or if it can worked around another way.
>
> Regards, etc...
>
> PS: this is what I'm working on right now:
> http://www.onaswarm.com
>
> On Nov 26, 2007 2:21 PM, David Lenwell <dlenwell@gmail.com> wrote:
>> yeah .. its very broken for me too .. What I am working on is my own
>> session handler.. I don't feel that mysql is a valid replacement
>> because it puts unnecessary load on your database server.
>>
>> We are debating on open sourcing the code I am working on. if I win
>> the argument that open source can be good for us then I will
>> contribute my code to the project.
>>
>>
>>
>> On Nov 26, 2007, at 10:55 AM, David Janes wrote:
>>
>>> All I can say is "we too" -- we're using FileSession. We have not  
>>> been
>>> able to come up with a cure, though we've minimized use of sessions
>>> which brings the frequency down significantly.
>>>
>>> Regards, etc...
>>> David
>>>
>>> On Nov 26, 2007 1:39 PM, Harish Agarwal <harish@octopart.com> wrote:
>>>> I'm using session handling with ModPython 3.3.1.  Originally I was
>>>> using DbmSession and have since transitioned to a custom MySQL
>>>> Session
>>>> handler.  With both session types, however, I've noticed that  
>>>> session
>>>> initialization intermittently hangs (not forever, but takes as long
>>>> as
>>>> four minutes to complete), at a low-ish (a handful of times every
>>>> hour, while receiving, say, on order of a thousand or so requests
>>>> every hour) frequency which seems to scale with the amount of  
>>>> traffic
>>>> we're receiving.  I had read that long DbmSession cleanups can  
>>>> cause
>>>> problems, which is why I transitioned to the MySQL system, which
>>>> takes
>>>> < 1 second to complete, but I'm still noticing the long session  
>>>> init
>>>> times.
>>>>
>>>>
>>>> I put some debugging statements into the code and it seems to be
>>>> related to session locking.  In particular, it is this function  
>>>> call
>>>> in the lock method of the BaseSession class:
>>>>
>>>>
>>>> _apache._global_lock(self._req.server, self._sid)
>>>>
>>>>
>>>> which is taking some time to complete. I'm not familiar with
>>>> _apache._global_lock (is it used to apply a mutex lock to the
>>>> session?) and am having trouble finding information describing its
>>>> usage - but it seems likely that this is the root cause.  In the  
>>>> past
>>>> I've had problems with session locking but have since transitioned
>>>> the
>>>> code to ensure that only one session is created per request, as  
>>>> such:
>>>>
>>>> if not hasattr(req,'session'):
>>>>            req.session = Session.MySQLSession(req)
>>>>
>>>>
>>>> Can anyone tell me if this kind of behavior is normal or is
>>>> indicative
>>>> of some common configuration or coding error?  Any help would be
>>>> greatly appreciated.
>>>>
>>>> Thanks,
>>>> -Harish
>>>> _______________________________________________
>>>> Mod_python mailing list
>>>> Mod_python@modpython.org
>>>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>>>
>>>
>>>
>>>
>>> --
>>> David Janes
>>> Founder, BlogMatrix
>>> http://www.blogmatrix.com
>>> http://blogmatrix.blogmatrix.com
>>> _______________________________________________
>>> Mod_python mailing list
>>> Mod_python@modpython.org
>>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>
>>
>
>
>
> -- 
> David Janes
> Founder, BlogMatrix
> http://www.blogmatrix.com
> http://blogmatrix.blogmatrix.com

From davidjanes at blogmatrix.com  Mon Nov 26 15:19:51 2007
From: davidjanes at blogmatrix.com (David Janes)
Date: Mon Nov 26 15:19:57 2007
Subject: [mod_python] Session Hanging Problems
In-Reply-To: <BC3077B7-617E-4594-A83D-E24BE050C175@octopart.com>
References: <223DABED-F63D-45B0-B1CF-B8F6A75E8E2A@octopart.com>
	<21e523c20711261055h6d7c4007gb0754fcc1428ea81@mail.gmail.com>
	<FAE275BD-DC2B-433E-B2C2-21C6AE67AA28@gmail.com>
	<21e523c20711261150u5095ca9di4f95d125607df510@mail.gmail.com>
	<BC3077B7-617E-4594-A83D-E24BE050C175@octopart.com>
Message-ID: <21e523c20711261219y5bc6070dm1bb3b79465070cbe@mail.gmail.com>

Perhaps because of Apache process cycling?

Regards, etc...

On Nov 26, 2007 3:08 PM, Harish Agarwal <harish@octopart.com> wrote:
> Not sure if this helps at all, but I'm noticing that when the problem
> appears, it affects all of the incoming requests for a short
> duration.  The time logged to complete the call to
> _apache._global_lock decreases with each subsequent 'hung' request.
>
> For instance, the last time I noticed a hang in the log files, the
> first hang took about 1000 seconds to complete (the hanging is getting
> much worse today as traffic has picked up after Thanksgiving), and the
> last hang in the 'batch' took about 70 seconds to complete.  The log
> statements were all printed out at more or less the same time, which
> makes me suspect that the requests came in at various points during
> the hang, which lasted a total of 1000 seconds, and then the hang was
> resolved at the same time for each one, at which point the log
> statements were printed.
>
> I didn't have any problems accessing the site during this period of
> time, but that could be because I didn't hit the particular mod_python
> interpreter which was hanging.
>
>
> Harish
>
>
>
> On Nov 26, 2007, at 11:50 AM, David Janes wrote:
>
> > I'd be certainly interested in a non-mod_python session handler, since
> > I'm suspecting we'll be going to a non-Apache solution soon (since we
> > don't really take advantage of any Apache features right now) and we
> > were considering writing a generic one -- or adapting mod_python's
> > handlers.
> >
> > On the other hand as Harish notes, it would be good to solve the
> > problem for mod_python as mod_python's been very good to us! I'm
> > wondering if there's any need at all to touch the Apache global lock
> > anyway, or if it can worked around another way.
> >
> > Regards, etc...
> >
> > PS: this is what I'm working on right now:
> > http://www.onaswarm.com
> >
> > On Nov 26, 2007 2:21 PM, David Lenwell <dlenwell@gmail.com> wrote:
> >> yeah .. its very broken for me too .. What I am working on is my own
> >> session handler.. I don't feel that mysql is a valid replacement
> >> because it puts unnecessary load on your database server.
> >>
> >> We are debating on open sourcing the code I am working on. if I win
> >> the argument that open source can be good for us then I will
> >> contribute my code to the project.
> >>
> >>
> >>
> >> On Nov 26, 2007, at 10:55 AM, David Janes wrote:
> >>
> >>> All I can say is "we too" -- we're using FileSession. We have not
> >>> been
> >>> able to come up with a cure, though we've minimized use of sessions
> >>> which brings the frequency down significantly.
> >>>
> >>> Regards, etc...
> >>> David
> >>>
> >>> On Nov 26, 2007 1:39 PM, Harish Agarwal <harish@octopart.com> wrote:
> >>>> I'm using session handling with ModPython 3.3.1.  Originally I was
> >>>> using DbmSession and have since transitioned to a custom MySQL
> >>>> Session
> >>>> handler.  With both session types, however, I've noticed that
> >>>> session
> >>>> initialization intermittently hangs (not forever, but takes as long
> >>>> as
> >>>> four minutes to complete), at a low-ish (a handful of times every
> >>>> hour, while receiving, say, on order of a thousand or so requests
> >>>> every hour) frequency which seems to scale with the amount of
> >>>> traffic
> >>>> we're receiving.  I had read that long DbmSession cleanups can
> >>>> cause
> >>>> problems, which is why I transitioned to the MySQL system, which
> >>>> takes
> >>>> < 1 second to complete, but I'm still noticing the long session
> >>>> init
> >>>> times.
> >>>>
> >>>>
> >>>> I put some debugging statements into the code and it seems to be
> >>>> related to session locking.  In particular, it is this function
> >>>> call
> >>>> in the lock method of the BaseSession class:
> >>>>
> >>>>
> >>>> _apache._global_lock(self._req.server, self._sid)
> >>>>
> >>>>
> >>>> which is taking some time to complete. I'm not familiar with
> >>>> _apache._global_lock (is it used to apply a mutex lock to the
> >>>> session?) and am having trouble finding information describing its
> >>>> usage - but it seems likely that this is the root cause.  In the
> >>>> past
> >>>> I've had problems with session locking but have since transitioned
> >>>> the
> >>>> code to ensure that only one session is created per request, as
> >>>> such:
> >>>>
> >>>> if not hasattr(req,'session'):
> >>>>            req.session = Session.MySQLSession(req)
> >>>>
> >>>>
> >>>> Can anyone tell me if this kind of behavior is normal or is
> >>>> indicative
> >>>> of some common configuration or coding error?  Any help would be
> >>>> greatly appreciated.
> >>>>
> >>>> Thanks,
> >>>> -Harish
> >>>> _______________________________________________
> >>>> Mod_python mailing list
> >>>> Mod_python@modpython.org
> >>>> http://mailman.modpython.org/mailman/listinfo/mod_python
> >>>>
> >>>
> >>>
> >>>
> >>> --
> >>> David Janes
> >>> Founder, BlogMatrix
> >>> http://www.blogmatrix.com
> >>> http://blogmatrix.blogmatrix.com
> >>> _______________________________________________
> >>> Mod_python mailing list
> >>> Mod_python@modpython.org
> >>> http://mailman.modpython.org/mailman/listinfo/mod_python
> >>
> >>
> >
> >
> >
> > --
> > David Janes
> > Founder, BlogMatrix
> > http://www.blogmatrix.com
> > http://blogmatrix.blogmatrix.com
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>



-- 
David Janes
Founder, BlogMatrix
http://www.blogmatrix.com
http://blogmatrix.blogmatrix.com
From paul at orbitalconsulting.com.au  Mon Nov 26 16:15:20 2007
From: paul at orbitalconsulting.com.au (Paul Hutton)
Date: Mon Nov 26 16:15:37 2007
Subject: [mod_python] unsubscribe
Message-ID: <23377ED966B97642BD4EBCDA2A9B5CFE606B@otter.blueskies.ws>

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20071127/643f33d5/attachment.html
From graham.dumpleton at gmail.com  Mon Nov 26 16:38:57 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Mon Nov 26 16:39:03 2007
Subject: [mod_python] Session Hanging Problems
In-Reply-To: <223DABED-F63D-45B0-B1CF-B8F6A75E8E2A@octopart.com>
References: <223DABED-F63D-45B0-B1CF-B8F6A75E8E2A@octopart.com>
Message-ID: <88e286470711261338l1da01282s6f8a9cc309d7b5a0@mail.gmail.com>

On 27/11/2007, Harish Agarwal <harish@octopart.com> wrote:
> I'm using session handling with ModPython 3.3.1.  Originally I was
> using DbmSession and have since transitioned to a custom MySQL Session
> handler.  With both session types, however, I've noticed that session
> initialization intermittently hangs (not forever, but takes as long as
> four minutes to complete), at a low-ish (a handful of times every
> hour, while receiving, say, on order of a thousand or so requests
> every hour) frequency which seems to scale with the amount of traffic
> we're receiving.  I had read that long DbmSession cleanups can cause
> problems, which is why I transitioned to the MySQL system, which takes
> < 1 second to complete, but I'm still noticing the long session init
> times.
>
>
> I put some debugging statements into the code and it seems to be
> related to session locking.  In particular, it is this function call
> in the lock method of the BaseSession class:
>
>
> _apache._global_lock(self._req.server, self._sid)
>
>
> which is taking some time to complete. I'm not familiar with
> _apache._global_lock (is it used to apply a mutex lock to the
> session?) and am having trouble finding information describing its
> usage - but it seems likely that this is the root cause.  In the past
> I've had problems with session locking but have since transitioned the
> code to ensure that only one session is created per request, as such:
>
> if not hasattr(req,'session'):
>              req.session = Session.MySQLSession(req)
>
>
> Can anyone tell me if this kind of behavior is normal or is indicative
> of some common configuration or coding error?  Any help would be
> greatly appreciated.

Ignoring hangs, how long does your longest request normally take to
execute? Are you perhaps performing file uploads that take a
significant amount of time and are holding a session locked for the
whole period of the request?

To at least allow some level of concurrency, from memory mod_python
holds a small pool of cross process mutex locks. Based on the session
ID (I think) it should consistently pick the same mutex lock each
time. Thus, if a request comes in with the same session ID it would be
blocked while the existing request for that session runs. If however
another request comes in with a different session ID, but where it
maps to the same mutex lock from the pool, it will also be blocked
until the request holding that lock has completed.

What this means is that the number of mutex locks in the pool
effectively dictates how many parallel session based requests you can
have executed across the whole of the Apache server. Thus, if you have
requests that take a long time while still holding the session lock,
it can lock out other requests until it completes.

One can makes things a bit better by increasing the number of mutex
locks in the pool, but you have to be careful not to create too many
in case it is using sysvsem and your OS doesn't allocate enough.

The only other thing to do is to release the lock explicitly as soon
as you no longer need it and don't rely on the cleanup handler for the
request to unlock it.

In other words, what your application is doing, your own code and how
you have written it could be the problem, and not necessarily
mod_python itself.

If my memory has totally faded and my description is wrong, someone
please correct me. :-)

Graham
From harish at octopart.com  Mon Nov 26 17:06:37 2007
From: harish at octopart.com (Harish Agarwal)
Date: Mon Nov 26 17:06:47 2007
Subject: [mod_python] Session Hanging Problems
In-Reply-To: <88e286470711261338l1da01282s6f8a9cc309d7b5a0@mail.gmail.com>
References: <223DABED-F63D-45B0-B1CF-B8F6A75E8E2A@octopart.com>
	<88e286470711261338l1da01282s6f8a9cc309d7b5a0@mail.gmail.com>
Message-ID: <A95B1B46-32DF-452E-9EE4-9C44DB17A332@octopart.com>

On Nov 26, 2007, at 1:38 PM, Graham Dumpleton wrote:

> On 27/11/2007, Harish Agarwal <harish@octopart.com> wrote:
>> I'm using session handling with ModPython 3.3.1.  Originally I was
>> using DbmSession and have since transitioned to a custom MySQL  
>> Session
>> handler.  With both session types, however, I've noticed that session
>> initialization intermittently hangs (not forever, but takes as long  
>> as
>> four minutes to complete), at a low-ish (a handful of times every
>> hour, while receiving, say, on order of a thousand or so requests
>> every hour) frequency which seems to scale with the amount of traffic
>> we're receiving.  I had read that long DbmSession cleanups can cause
>> problems, which is why I transitioned to the MySQL system, which  
>> takes
>> < 1 second to complete, but I'm still noticing the long session init
>> times.
>>
>>
>> I put some debugging statements into the code and it seems to be
>> related to session locking.  In particular, it is this function call
>> in the lock method of the BaseSession class:
>>
>>
>> _apache._global_lock(self._req.server, self._sid)
>>
>>
>> which is taking some time to complete. I'm not familiar with
>> _apache._global_lock (is it used to apply a mutex lock to the
>> session?) and am having trouble finding information describing its
>> usage - but it seems likely that this is the root cause.  In the past
>> I've had problems with session locking but have since transitioned  
>> the
>> code to ensure that only one session is created per request, as such:
>>
>> if not hasattr(req,'session'):
>>             req.session = Session.MySQLSession(req)
>>
>>
>> Can anyone tell me if this kind of behavior is normal or is  
>> indicative
>> of some common configuration or coding error?  Any help would be
>> greatly appreciated.
>
> Ignoring hangs, how long does your longest request normally take to
> execute? Are you perhaps performing file uploads that take a
> significant amount of time and are holding a session locked for the
> whole period of the request?
>
> To at least allow some level of concurrency, from memory mod_python
> holds a small pool of cross process mutex locks. Based on the session
> ID (I think) it should consistently pick the same mutex lock each
> time. Thus, if a request comes in with the same session ID it would be
> blocked while the existing request for that session runs. If however
> another request comes in with a different session ID, but where it
> maps to the same mutex lock from the pool, it will also be blocked
> until the request holding that lock has completed.
>
> What this means is that the number of mutex locks in the pool
> effectively dictates how many parallel session based requests you can
> have executed across the whole of the Apache server. Thus, if you have
> requests that take a long time while still holding the session lock,
> it can lock out other requests until it completes.
>
> One can makes things a bit better by increasing the number of mutex
> locks in the pool, but you have to be careful not to create too many
> in case it is using sysvsem and your OS doesn't allocate enough.
>
> The only other thing to do is to release the lock explicitly as soon
> as you no longer need it and don't rely on the cleanup handler for the
> request to unlock it.
>
> In other words, what your application is doing, your own code and how
> you have written it could be the problem, and not necessarily
> mod_python itself.
>
> If my memory has totally faded and my description is wrong, someone
> please correct me. :-)
>
> Graham


Thanks!  This is really helpful and explains the symptoms of the  
problem.  I don't believe our requests should be taking very long at  
all (at most, ten seconds), though I don't explicitly clear the  
session lock at any point.  I'll play around with both session  
unlocking and the number of mutex locks.

-Harish

From davidjanes at blogmatrix.com  Tue Nov 27 14:06:03 2007
From: davidjanes at blogmatrix.com (David Janes)
Date: Tue Nov 27 14:06:12 2007
Subject: [mod_python] Session Hanging Problems
In-Reply-To: <A95B1B46-32DF-452E-9EE4-9C44DB17A332@octopart.com>
References: <223DABED-F63D-45B0-B1CF-B8F6A75E8E2A@octopart.com>
	<88e286470711261338l1da01282s6f8a9cc309d7b5a0@mail.gmail.com>
	<A95B1B46-32DF-452E-9EE4-9C44DB17A332@octopart.com>
Message-ID: <21e523c20711271106qce6fd95s5f0efc347dccd04c@mail.gmail.com>

Here's what I'm experimenting with right now -- I'm subclassing
FileSession and overriding all the lock methods. Obviously this will
have to be adapted for people not working in the FileSession world.

Regards, etc...

    class BMFileSession(Session.FileSession):
        def __init__(self, req, sid = None):
            self.bm_lockf = None
            ... more init stuff ...


        def lock(self):
            if self._lock:
                self.bm_lock(self._req.server, self._sid)
                self._locked = 1
                self._req.register_cleanup(Session.unlock_session_cleanup, self)

        def unlock(self):
            if self._lock and self._locked:
                self.bm_unlock(self._req.server, self._sid)
                self._locked = 0

        def lock_file(self):
            if not self._locked:
                self.bm_lock(self._req.server, self._sid)
                self._locked = 1

        def unlock_file(self):
            if self._locked and not self._lock:
                self.bm_unlock(self._req.server, self._sid)
                self._locked = 0

        def bm_lockfile(self, sid):
            lockdir = os.path.join(self._sessdir, sid[:2])
            if not os.path.exists(lockdir):
                os.makedirs(lockdir)

            return  os.path.join(lockdir, sid)

        def bm_lock(self, server, sid):
            if self.bm_lockf:
                try: self.bm_lockf.close()
                except: pass

            self.bm_lockf = open(self.bm_lockfile(sid), 'a+')
            fcntl.lockf(self.bm_lockf, fcntl.LOCK_EX)

        def bm_unlock(self, server, sid):
            if self.bm_lockf:
                fcntl.lockf(self.bm_lockf, fcntl.LOCK_UN)

                try: self.bm_lockf.close()
                except: pass

                self.bm_lockf = None
From martijn at xs4us.nu  Wed Nov 28 03:04:23 2007
From: martijn at xs4us.nu (Martijn Moeling)
Date: Wed Nov 28 03:04:57 2007
Subject: [mod_python] Session Hanging Problems
References: <223DABED-F63D-45B0-B1CF-B8F6A75E8E2A@octopart.com><88e286470711261338l1da01282s6f8a9cc309d7b5a0@mail.gmail.com><A95B1B46-32DF-452E-9EE4-9C44DB17A332@octopart.com>
	<21e523c20711271106qce6fd95s5f0efc347dccd04c@mail.gmail.com>
Message-ID: <B6C73A5E30565245BB6D32B5F5DF7A52172B10@sense.emmastraat.pijnacker>

See below what I did to use MySQL as a session store.
This is done since I use multiple mod_python frond ends to connect to one DB server.
 
Martijn
 
(these are changes made to the original Session.py from the mod_python package)
 
 
###########################################################################
## MySQLSession
## M. Moeling, martijn@xs4us.nu <mailto:martijn@xs4us.nu> 
##
## In order to use MySQLSession:
## in your handler.py:        
## import MySQLdb
##
##  Use:
##        req.db = MySQLdb.connect(host=Chost,user=Cuser,passwd=Cpasswd,db=Cdb)
##        req.cursor = req.db.cursor()
## 
##  When req.cursor is existing, Session.py will default to MySQLSession
##  Can be overruled with pythonoptions in apacheconfig
##
## To create table in MySQL use the following:
## CREATE TABLE `Session` (
##  `sid` varchar(50) NOT NULL,
##  `store` text NOT NULL,
##  PRIMARY KEY  (`sid`)
## ) TYPE=MyISAM;
        
def MySQL_cleanup(req):
    req.cursor.execute("Select * from Session")
    AllSessions = req.cursor.fetchall()
    stale=0
    total=0
    for record in AllSessions:
        total+=1
        session = cPickle.loads(record[1])
        if (time.time() - session["_accessed"]) > session["_timeout"]:
            stale+=1
            req.cursor.execute("DELETE FROM Session where sid='"+record[0]+"'")        
    req.log_error("MySQLSession: Removed: "+str(stale)+" stale records from "+str(total)+" in total",apache.APLOG_NOTICE)
        
class MySQLSession(BaseSession):

    def __init__(self, req, sid=0, secret=None, timeout=0, lock=1):
        BaseSession.__init__(self, req, sid=sid, secret=secret,
                             timeout=timeout, lock=lock)
    def do_cleanup(self):
        self._req.register_cleanup(MySQL_cleanup, self._req)
        self._req.log_error("MySQLSession: registered session cleanup.",apache.APLOG_NOTICE)
    def do_load(self):
        self._req.cursor.execute("Select store from Session where sid='"+self._sid+"'")
        store=self._req.cursor.fetchone()
        if self._req.cursor.rowcount==1:
            return cPickle.loads(store[0].encode('utf-8'))
        return None
    def do_save(self, dict):
        self._req.cursor.execute("Select store from Session where sid='"+self._sid+"'")
        store=self._req.cursor.fetchone()
        if self._req.cursor.rowcount==1:
            Query="Update Session set store=\""+cPickle.dumps(dict)+"\" where sid='"+self._sid+"'"
        else:
            Query="Insert into Session (sid,store) values (\""+self._sid+"\",\""+cPickle.dumps(dict)+"\")"           
        self._req.cursor.execute(Query)
            
        
    def do_delete(self):
        try:
            self._req.cursor.execute("DELETE FROM Session where sid='"+self._sid+"'")
        except:
            pass

###########################################################################
## Session
## Changes made for MySQLSession
## the application should set req.cursor as an MySQLdb cursor object

def Session(req, sid=0, secret=None, timeout=0, lock=1):
    opts = req.get_options()
    if opts.has_key('session'):
        # Check the apache config for the type of session
        sess_type = opts['session']
    else:
        ## MySQLSession is default when req.cursor exists
        if req.cursor:
            sess_type = 'MySQLSession'
        else:
        ## END of MySQLSession modification
            # no session class in config so get the default for the platform
            threaded = _apache.mpm_query(apache.AP_MPMQ_IS_THREADED)
            forked = _apache.mpm_query(apache.AP_MPMQ_IS_FORKED)
            daemons =  _apache.mpm_query(apache.AP_MPMQ_MAX_DAEMONS)
            if (threaded and ((not forked) or (daemons == 1))):
                sess_type = 'MemorySession'
            else:
                sess_type = 'DbmSession'
    if sess_type == 'FileSession':
        sess =  FileSession
    elif sess_type == 'DbmSession':
        sess = DbmSession
    elif sess_type == 'MemorySession':
        sess = MemorySession
    ## Added for MySQLSession
    elif sess_type == 'MySQLSession':
        sess = MySQLSession
    else:
        # TODO Add capability to load a user defined class
        # For now, just raise an exception.
        raise Exception, 'Unknown session type %s' % sess_type
    return sess(req, sid=sid, secret=secret,
                         timeout=timeout, lock=lock)

 

________________________________

Van: mod_python-bounces@modpython.org namens David Janes
Verzonden: di 27.11.2007 20:06
Aan: Harish Agarwal
CC: mod_python@modpython.org; Graham Dumpleton
Onderwerp: Re: [mod_python] Session Hanging Problems



Here's what I'm experimenting with right now -- I'm subclassing
FileSession and overriding all the lock methods. Obviously this will
have to be adapted for people not working in the FileSession world.

Regards, etc...

    class BMFileSession(Session.FileSession):
        def __init__(self, req, sid = None):
            self.bm_lockf = None
            ... more init stuff ...


        def lock(self):
            if self._lock:
                self.bm_lock(self._req.server, self._sid)
                self._locked = 1
                self._req.register_cleanup(Session.unlock_session_cleanup, self)

        def unlock(self):
            if self._lock and self._locked:
                self.bm_unlock(self._req.server, self._sid)
                self._locked = 0

        def lock_file(self):
            if not self._locked:
                self.bm_lock(self._req.server, self._sid)
                self._locked = 1

        def unlock_file(self):
            if self._locked and not self._lock:
                self.bm_unlock(self._req.server, self._sid)
                self._locked = 0

        def bm_lockfile(self, sid):
            lockdir = os.path.join(self._sessdir, sid[:2])
            if not os.path.exists(lockdir):
                os.makedirs(lockdir)

            return  os.path.join(lockdir, sid)

        def bm_lock(self, server, sid):
            if self.bm_lockf:
                try: self.bm_lockf.close()
                except: pass

            self.bm_lockf = open(self.bm_lockfile(sid), 'a+')
            fcntl.lockf(self.bm_lockf, fcntl.LOCK_EX)

        def bm_unlock(self, server, sid):
            if self.bm_lockf:
                fcntl.lockf(self.bm_lockf, fcntl.LOCK_UN)

                try: self.bm_lockf.close()
                except: pass

                self.bm_lockf = None
_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://mailman.modpython.org/mailman/listinfo/mod_python


-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20071128/0aaa4735/attachment.html
From wilsonta72 at gmail.com  Wed Nov 28 04:42:06 2007
From: wilsonta72 at gmail.com (Troy Wilson)
Date: Wed Nov 28 04:43:20 2007
Subject: [mod_python] Possible Bug in PythonHandlerModule directive
Message-ID: <c8aeab710711280142y4abc2cd1m8eac3815c6df28f3@mail.gmail.com>

Hi all,

I can not seem to get the PythonHandlerModule directive to work. The
following conf works:
-------------------------------------------------------------
<Directory /home/test/public_html>
                Options -Indexes -MultiViews
                <IfModule mod_python.c>
                        SetHandler python-program
                        PythonAuthenHandler handler
                        PythonAuthzHandler handler
                        PythonHandler handler
                        PythonDebug On
                        PythonInterpreter test
                        PythonAutoReload On
                        AuthType python-auth
                        AuthName "Restricted"
                        require valid-user
                </IfModule>
</Directory>
-----------------------------------------------

While this setup produces a 401 error:
---------------------------------------------------
 <Directory /home/test/public_html>
                Options -Indexes -MultiViews
                <IfModule mod_python.c>
                        SetHandler python-program
                        PythonHandlerModule handler
                        PythonDebug On
                        PythonInterpreter test
                        PythonAutoReload On
                        AuthType python-auth
                        AuthName "Restricted"
                        require valid-user
                </IfModule>
</Directory>
------------------------------------------------

The simplest form of the handler code:
--------------------------------------------------
from mod_python import apache

def authenhandler(req):
        req.user = "test"
        return apache.OK

def authzhandler(req):
        return apache.OK

def handler(req):
        return apache.OK

---------------------------------------------------------

My understanding was that the PythonHandlerModule directive would search
inside the handler code for a function matching the phase. It does not seem
to do this.Have I misinterpreted what this directive was meant to achieve?

Cheers Troy
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20071128/cf6ee0e1/attachment-0001.html
From graham.dumpleton at gmail.com  Wed Nov 28 04:51:14 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Wed Nov 28 04:51:21 2007
Subject: [mod_python] Possible Bug in PythonHandlerModule directive
In-Reply-To: <c8aeab710711280142y4abc2cd1m8eac3815c6df28f3@mail.gmail.com>
References: <c8aeab710711280142y4abc2cd1m8eac3815c6df28f3@mail.gmail.com>
Message-ID: <88e286470711280151s4191a454u37423a88cf2319d3@mail.gmail.com>

What version of mod_python are you using? There were bugs in that
directive which were possibly only fixed in mod_python 3.3.

Graham

On 28/11/2007, Troy Wilson <wilsonta72@gmail.com> wrote:
> Hi all,
>
> I can not seem to get the PythonHandlerModule directive to work. The
> following conf works:
> -------------------------------------------------------------
> <Directory /home/test/public_html>
>                 Options -Indexes -MultiViews
>                 <IfModule mod_python.c>
>                         SetHandler python-program
>                         PythonAuthenHandler handler
>                         PythonAuthzHandler handler
>                         PythonHandler handler
>                         PythonDebug On
>                         PythonInterpreter test
>                         PythonAutoReload On
>                         AuthType python-auth
>                         AuthName "Restricted"
>                         require valid-user
>                 </IfModule>
> </Directory>
> -----------------------------------------------
>
> While this setup produces a 401 error:
> ---------------------------------------------------
>  <Directory /home/test/public_html>
>                 Options -Indexes -MultiViews
>                 <IfModule mod_python.c>
>                         SetHandler python-program
>                         PythonHandlerModule handler
>                         PythonDebug On
>                         PythonInterpreter test
>                         PythonAutoReload On
>                         AuthType python-auth
>                         AuthName "Restricted"
>                         require valid-user
>                 </IfModule>
> </Directory>
> ------------------------------------------------
>
> The simplest form of the handler code:
> --------------------------------------------------
> from mod_python import apache
>
> def authenhandler(req):
>         req.user = "test"
>         return apache.OK
>
> def authzhandler(req):
>         return apache.OK
>
> def handler(req):
>         return apache.OK
>
> ---------------------------------------------------------
>
> My understanding was that the PythonHandlerModule directive would search
> inside the handler code for a function matching the phase. It does not seem
> to do this.Have I misinterpreted what this directive was meant to achieve?
>
> Cheers Troy
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
From ah at hatzis.de  Wed Nov 28 06:21:21 2007
From: ah at hatzis.de (Anastasios Hatzis)
Date: Wed Nov 28 06:21:35 2007
Subject: [mod_python] Mailman HTML templates to include PSP
Message-ID: <200711281221.26576.ah@hatzis.de>

Hi!

I run two web-sites on Apache and mod_python (Debiab 4 current stable). I 
would like to integrate the PSP chunks of these websites into the HTML 
templates of Mailman 2.1.9 which I use for all lists on these sites.

The patterns on all Web-pages of the sites is like this:

http://www.foo.org/index.html:

<%@ include file="head.psp"%>
  <p>
    Some content
  </p>
<%@ include file="sidebar.psp"%>
<%@ include file="foot.psp"%>

head.psp contains the top-level navigation which changes rather often. 
sidebar.psp is context-sensitive for each page.
foot.psp is on all pages the same and changes are rare.

Each site has multiple lists. The mailman pages are in 
http://lists.foo.org/cgi-bin/*

The same is for www.bar.org.

I would like to integrate the corresponding PSP files into the mailman HTML 
templates. For now I have copied and pasted the static HTML rendered by the 
PSP files into the HTML templates of the mailman lists.

Since I don't want to copy & paste into the mailman templates each time the 
PSP chunks do change I would prefer a dynamic approach that works like the 
rest of my sites.

Any idea how I can include the PSP chunks into the mailman HTML templates - or 
an alternative with the same effect?

Thank you.

Best regards,
Anastasios
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 307 bytes
Desc: not available
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20071128/d6610b4c/attachment.bin
From graham.dumpleton at gmail.com  Wed Nov 28 16:02:01 2007
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Wed Nov 28 16:02:10 2007
Subject: [mod_python] Mailman HTML templates to include PSP
In-Reply-To: <200711281221.26576.ah@hatzis.de>
References: <200711281221.26576.ah@hatzis.de>
Message-ID: <88e286470711281302v7bf34f3gefccf6255c607b42@mail.gmail.com>

Use Apache SSI:

  http://httpd.apache.org/docs/2.0/howto/ssi.html
  http://www.modpython.org/live/current/doc-html/ssi.html

You could do it in two ways. First is to include PSP chunk output into
static HTML files using SSI. Second is to ditch PSP and use Python
code snippets direct in the static HTML file and produce equivalent
HTML on the fly from there.

You will need mod_python 3.3 for the latter though. You don't specify
which version of mod_python you are using.

Graham

On 28/11/2007, Anastasios Hatzis <ah@hatzis.de> wrote:
> Hi!
>
> I run two web-sites on Apache and mod_python (Debiab 4 current stable). I
> would like to integrate the PSP chunks of these websites into the HTML
> templates of Mailman 2.1.9 which I use for all lists on these sites.
>
> The patterns on all Web-pages of the sites is like this:
>
> http://www.foo.org/index.html:
>
> <%@ include file="head.psp"%>
>   <p>
>     Some content
>   </p>
> <%@ include file="sidebar.psp"%>
> <%@ include file="foot.psp"%>
>
> head.psp contains the top-level navigation which changes rather often.
> sidebar.psp is context-sensitive for each page.
> foot.psp is on all pages the same and changes are rare.
>
> Each site has multiple lists. The mailman pages are in
> http://lists.foo.org/cgi-bin/*
>
> The same is for www.bar.org.
>
> I would like to integrate the corresponding PSP files into the mailman HTML
> templates. For now I have copied and pasted the static HTML rendered by the
> PSP files into the HTML templates of the mailman lists.
>
> Since I don't want to copy & paste into the mailman templates each time the
> PSP chunks do change I would prefer a dynamic approach that works like the
> rest of my sites.
>
> Any idea how I can include the PSP chunks into the mailman HTML templates - or
> an alternative with the same effect?
>
> Thank you.
>
> Best regards,
> Anastasios
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
>
From ah at hatzis.de  Thu Nov 29 11:14:46 2007
From: ah at hatzis.de (Anastasios Hatzis)
Date: Thu Nov 29 11:14:59 2007
Subject: [mod_python] Mailman HTML templates to include PSP
In-Reply-To: <88e286470711281302v7bf34f3gefccf6255c607b42@mail.gmail.com>
References: <200711281221.26576.ah@hatzis.de>
	<88e286470711281302v7bf34f3gefccf6255c607b42@mail.gmail.com>
Message-ID: <200711291714.50582.ah@hatzis.de>

On Wednesday 28 November 2007, Graham Dumpleton wrote:
> Use Apache SSI:
>
>   http://httpd.apache.org/docs/2.0/howto/ssi.html
>   http://www.modpython.org/live/current/doc-html/ssi.html
>
> You could do it in two ways. First is to include PSP chunk output into
> static HTML files using SSI. Second is to ditch PSP and use Python
> code snippets direct in the static HTML file and produce equivalent
> HTML on the fly from there.

Graham, 
many thanks for your advice. OK, so I will try with the first way, SSI to 
include PSP chunk output.

>
> You will need mod_python 3.3 for the latter though. You don't specify
> which version of mod_python you are using.

Sorry, this is Apache/2.2.3 (Debian) mod_python/3.2.10 Python/2.4.4

Thanks again.

Best regards,
Anastasios

>
> Graham
>
> On 28/11/2007, Anastasios Hatzis <ah@hatzis.de> wrote:
> > Hi!
> >
> > I run two web-sites on Apache and mod_python (Debiab 4 current stable). I
> > would like to integrate the PSP chunks of these websites into the HTML
> > templates of Mailman 2.1.9 which I use for all lists on these sites.
> >
> > The patterns on all Web-pages of the sites is like this:
> >
> > http://www.foo.org/index.html:
> >
> > <%@ include file="head.psp"%>
> >   <p>
> >     Some content
> >   </p>
> > <%@ include file="sidebar.psp"%>
> > <%@ include file="foot.psp"%>
> >
> > head.psp contains the top-level navigation which changes rather often.
> > sidebar.psp is context-sensitive for each page.
> > foot.psp is on all pages the same and changes are rare.
> >
> > Each site has multiple lists. The mailman pages are in
> > http://lists.foo.org/cgi-bin/*
> >
> > The same is for www.bar.org.
> >
> > I would like to integrate the corresponding PSP files into the mailman
> > HTML templates. For now I have copied and pasted the static HTML rendered
> > by the PSP files into the HTML templates of the mailman lists.
> >
> > Since I don't want to copy & paste into the mailman templates each time
> > the PSP chunks do change I would prefer a dynamic approach that works
> > like the rest of my sites.
> >
> > Any idea how I can include the PSP chunks into the mailman HTML templates
> > - or an alternative with the same effect?
> >
> > Thank you.
> >
> > Best regards,
> > Anastasios
> >
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 307 bytes
Desc: not available
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20071129/15bef2a6/attachment.bin
From edgardalvescosta at gmail.com  Fri Nov 30 05:56:34 2007
From: edgardalvescosta at gmail.com (EdgardCosta)
Date: Fri Nov 30 05:55:07 2007
Subject: [mod_python] Please urls with examples with applications build
	using mod_python
Message-ID: <1196420194.9842.42.camel@ubuntuserver>

Hi everybody

I'm need two things. Urls examples with application that was builded
using mod_python and some tutorials that show how do i write menus bars,
and link it with other web pags and others things. I know how to do this
things with wxpython and C cross plataforms. But in a web i don't make
any ideia. I don't want to use Zope and Plones applications and the
others like that. I want to write the things by myself.

Best regards

exit()

-- 
EdgardCosta <edgardalvescosta@gmail.com>

From wilsonta72 at gmail.com  Fri Nov 30 19:08:14 2007
From: wilsonta72 at gmail.com (Troy Wilson)
Date: Fri Nov 30 19:08:21 2007
Subject: [mod_python] Possible Bug in PythonHandlerModule directive
In-Reply-To: <88e286470711280151s4191a454u37423a88cf2319d3@mail.gmail.com>
References: <c8aeab710711280142y4abc2cd1m8eac3815c6df28f3@mail.gmail.com>
	<88e286470711280151s4191a454u37423a88cf2319d3@mail.gmail.com>
Message-ID: <c8aeab710711301608x78ebd87bqf696a83f409d4abb@mail.gmail.com>

I was using 3.2.8. Have upgraded to current and it all works fine.

Thanks.

On Nov 28, 2007 7:51 PM, Graham Dumpleton <graham.dumpleton@gmail.com>
wrote:

> What version of mod_python are you using? There were bugs in that
> directive which were possibly only fixed in mod_python 3.3.
>
> Graham
>
> On 28/11/2007, Troy Wilson <wilsonta72@gmail.com> wrote:
> > Hi all,
> >
> > I can not seem to get the PythonHandlerModule directive to work. The
> > following conf works:
> > -------------------------------------------------------------
> > <Directory /home/test/public_html>
> >                 Options -Indexes -MultiViews
> >                 <IfModule mod_python.c>
> >                         SetHandler python-program
> >                         PythonAuthenHandler handler
> >                         PythonAuthzHandler handler
> >                         PythonHandler handler
> >                         PythonDebug On
> >                         PythonInterpreter test
> >                         PythonAutoReload On
> >                         AuthType python-auth
> >                         AuthName "Restricted"
> >                         require valid-user
> >                 </IfModule>
> > </Directory>
> > -----------------------------------------------
> >
> > While this setup produces a 401 error:
> > ---------------------------------------------------
> >  <Directory /home/test/public_html>
> >                 Options -Indexes -MultiViews
> >                 <IfModule mod_python.c>
> >                         SetHandler python-program
> >                         PythonHandlerModule handler
> >                         PythonDebug On
> >                         PythonInterpreter test
> >                         PythonAutoReload On
> >                         AuthType python-auth
> >                         AuthName "Restricted"
> >                         require valid-user
> >                 </IfModule>
> > </Directory>
> > ------------------------------------------------
> >
> > The simplest form of the handler code:
> > --------------------------------------------------
> > from mod_python import apache
> >
> > def authenhandler(req):
> >         req.user = "test"
> >         return apache.OK
> >
> > def authzhandler(req):
> >         return apache.OK
> >
> > def handler(req):
> >         return apache.OK
> >
> > ---------------------------------------------------------
> >
> > My understanding was that the PythonHandlerModule directive would search
> > inside the handler code for a function matching the phase. It does not
> seem
> > to do this.Have I misinterpreted what this directive was meant to
> achieve?
> >
> > Cheers Troy
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20071201/d46a8f14/attachment.html
