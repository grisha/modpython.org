From azaroth at liverpool.ac.uk  Tue Jul  1 15:53:15 2003
From: azaroth at liverpool.ac.uk (Robert Sanderson)
Date: Fri Jan  9 21:47:33 2004
Subject: [mod_python] ConnectionHandler sigsegv (fwd)
In-Reply-To: <20030630092522.B53253@onyx.ispol.com>
Message-ID: <Pine.LNX.4.44.0307011548230.12884-100000@gondolin.hist.liv.ac.uk>


> The normal way of dealing with this sort of thing is by calling select()
> on a socket which will then call your function when there is anything to
> read. I don't know whether APR provides this.

Right. I can't see it anywhere, but that doesn't mean it's not available. 
 
> I think your only option is to read a byte at a time, making sure that
> when you receivie a complete frame/packet/whatever you stop reading so as
> to not block indefinitely.

Yep, I've now successfully implemented a Z39.50 connection handler using 
mod_python and PyZ3950 under Apache using this technique, though it's not 
pretty having to try to parse a PDU after reading in each byte. 

Cheers,

Rob

-- 
      ,'/:.          Rob Sanderson (azaroth@liverpool.ac.uk)
    ,'-/::::.        http://www.o-r-g.org/~azaroth/
  ,'--/::(@)::.      Special Collections and Archives, extension 3142
,'---/::::::::::.    Nebmedes:  telnet: nebmedes.o-r-g.org 7777
____/:::::::::::::.                WWW:  http://nebmedes.o-r-g.org:8000/
I L L U M I N A T I

From grisha at modpython.org  Tue Jul  1 12:12:58 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:33 2004
Subject: [mod_python] ConnectionHandler sigsegv (fwd)
In-Reply-To: <Pine.LNX.4.44.0307011548230.12884-100000@gondolin.hist.liv.ac.uk>
References: <Pine.LNX.4.44.0307011548230.12884-100000@gondolin.hist.liv.ac.uk>
Message-ID: <20030701114138.D75368@onyx.ispol.com>



On Tue, 1 Jul 2003, Robert Sanderson wrote:

> > I think your only option is to read a byte at a time, making sure that
> > when you receivie a complete frame/packet/whatever you stop reading so as
> > to not block indefinitely.
>
> Yep, I've now successfully implemented a Z39.50 connection handler using
> mod_python and PyZ3950 under Apache

Cool (even though I don't know what Z39.50 is :-) )

> using this technique, though it's not pretty having to try to parse a
> PDU after reading in each byte.

This is a pretty common technique in C, but in Python it is definitely
very inefficient because every "byte" is really a string... You could
probably get some improvement from using Python buffer(). I imagine this
will be a fairly common problem for people who implement connections, so
if you have any ideas on how it can be improved, please be sure to share
them on the list.

Grisha
From alexiev at activesolutions.bg  Wed Jul  2 17:18:35 2003
From: alexiev at activesolutions.bg (Alexiev Nikolay)
Date: Fri Jan  9 21:47:33 2004
Subject: [mod_python] Cookie
Message-ID: <00ce01c340a4$d30e74a0$0a01010a@dev1>

I want to save 2 cookies using mod_python & Cookie modul. Can somebody help
me, please?
10x

Best regards,
Alexiev, Nikolay

From grisha at modpython.org  Wed Jul  2 17:31:20 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:33 2004
Subject: [mod_python] Cookie
In-Reply-To: <00ce01c340a4$d30e74a0$0a01010a@dev1>
References: <00ce01c340a4$d30e74a0$0a01010a@dev1>
Message-ID: <20030702172715.A10551@onyx.ispol.com>


Something like this:

c1 = Cookie.SimpleCookie("cookie1=value1")
req.headers_out["Set-Cookie"] = c1.output(header="").strip()

c2 = Cookie.SimpleCookie("cookie2=value2")
req.headers_out.add("Set-Cookie") = c2.output(header="").strip()


Using the standard lib Cookie module is a bit ugly with mod_python because
Cookie was designed with CGI in mind, which is why the next release of
mod_python will have its own Cookie module.

Grisha


On Wed, 2 Jul 2003, Alexiev Nikolay wrote:

> I want to save 2 cookies using mod_python & Cookie modul. Can somebody help
> me, please?
> 10x
>
> Best regards,
> Alexiev, Nikolay
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From dlrubin at yahoo.com  Wed Jul  2 17:46:52 2003
From: dlrubin at yahoo.com (Daniel Rubin)
Date: Fri Jan  9 21:47:33 2004
Subject: [mod_python] problem creating an instance and debugging
Message-ID: <20030703004652.45793.qmail@web13904.mail.yahoo.com>

I successfully installed mod_python 3.0.3 and have it
working with apache, but one of my handlers isn't
working and I'm unable to get mod_python to record any
error messages about this particular event to the
apache error log. Basically, I have a handler called
xmlrpc that creates a python object called obj.  The
library needed to make this object gets imported
within xmlrpc.py just fine, but right at the line
where I create a new instance of obj (foo = obj()) I
get a stack dump (see below), and there are no errors
in the apache logs.  The xmlrpc.py program runs just
fine as a cgi within apache. It's when it runs with
mod_python that this fails. Any ideas?

in httpd.conf:
<Directory "/home/rubin/opt/apache/htdocs/xmlrpc">
    AddHandler python-program .py
    PythonHandler xmlrpc
    PythonDebug On
</Directory>

The stack dump:

  File "/test.py", line 52, in ?
    p = do_test(data)
  File "/test.py", line 44, in do_test
    return server.do_test(data)
  File "/home/lib/python2.2/xmlrpclib.py", line 821,
in __call__
    return self.__send(self.__name, args)
  File "/home/lib/python2.2/xmlrpclib.py", line 975,
in __request
    verbose=self.__verbose
  File "/home/lib/python2.2/xmlrpclib.py", line 853,
in request
    return self.parse_response(h.getfile())
  File "/home/lib/python2.2/xmlrpclib.py", line 886,
in parse_response
    response = f.read(1024)
  File "/home/lib/python2.2/httplib.py", line 1140, in
read
    assert not self._line_consumed and self._line_left
AssertionError



__________________________________
Do you Yahoo!?
SBC Yahoo! DSL - Now only $29.95 per month!
http://sbc.yahoo.com
From gnb at itga.com.au  Thu Jul  3 11:46:59 2003
From: gnb at itga.com.au (Gregory Bond)
Date: Fri Jan  9 21:47:33 2004
Subject: [mod_python] problem creating an instance and debugging 
In-Reply-To: Your message of Wed, 02 Jul 2003 17:46:52 -0700.
Message-ID: <200307030146.LAA14756@lightning.itga.com.au>

> working and I'm unable to get mod_python to record any
> error messages about this particular event to the
> apache error log.

stderr in mod_python goes to the apache error log but it is buffered.  You 
need to use sys.stderr.flush() at appropriate times.

See FAQ 2.3:
	http://www.modpython.org/FAQ/faqw.py?req=show&file=faq02.003.htp

From dustin at ywlcs.org  Wed Jul  2 21:02:43 2003
From: dustin at ywlcs.org (Dustin Mitchell)
Date: Fri Jan  9 21:47:34 2004
Subject: [mod_python] problem creating an instance and debugging
In-Reply-To: <20030703004652.45793.qmail@web13904.mail.yahoo.com>
References: <20030703004652.45793.qmail@web13904.mail.yahoo.com>
Message-ID: <20030703020242.GD23014@eleanor.internal.ywlcs.org>

On Wed, Jul 02, 2003 at 05:46:52PM -0700, Daniel Rubin wrote:
<snip snip>
> in parse_response
>     response = f.read(1024)
>   File "/home/lib/python2.2/httplib.py", line 1140, in
> read
>     assert not self._line_consumed and self._line_left
> AssertionError

Looking at this assertion, it seems valid.  Which is to say, in a linear
code flow, it should never get triggered.  My conjuecture then would be
that this is a threading issue.  Is your code using global variables of
any sort?  I'm pretty confident xmlrpclib and httplib are thread-safe,
but perhaps someone knows something to the contrary?

Dustin

-- 

  Dustin Mitchell
  dustin@ywlcs.org/djmitche@alumni.uchicago.edu
  http://people.cs.uchicago.edu/~dustin/
From dlrubin at yahoo.com  Wed Jul  2 20:28:35 2003
From: dlrubin at yahoo.com (Daniel Rubin)
Date: Fri Jan  9 21:47:34 2004
Subject: [mod_python] problem creating an instance and debugging 
In-Reply-To: <200307030146.LAA14756@lightning.itga.com.au>
Message-ID: <20030703032835.32306.qmail@web13905.mail.yahoo.com>

Putting sys.stderr.flush() into my xmlrpc.py doesn't
cause anything to get written to the apache log file.
I've even tried sys.stderr.write("stuff") and it
doesn't seem to appear anywhere (console nor apache
logs). Is there no way to track what's going on in the
code running on the server side in mod_python?

Thanks,
Daniel


--- Gregory Bond <gnb@itga.com.au> wrote:
> > working and I'm unable to get mod_python to record
> any
> > error messages about this particular event to the
> > apache error log.
> 
> stderr in mod_python goes to the apache error log
> but it is buffered.  You 
> need to use sys.stderr.flush() at appropriate times.
> 
> See FAQ 2.3:
> 
>
http://www.modpython.org/FAQ/faqw.py?req=show&file=faq02.003.htp
> 


__________________________________
Do you Yahoo!?
SBC Yahoo! DSL - Now only $29.95 per month!
http://sbc.yahoo.com
From gnb at itga.com.au  Thu Jul  3 14:03:17 2003
From: gnb at itga.com.au (Gregory Bond)
Date: Fri Jan  9 21:47:34 2004
Subject: [mod_python] problem creating an instance and debugging 
In-Reply-To: Your message of Wed, 02 Jul 2003 20:28:35 -0700.
Message-ID: <200307030403.OAA27049@lightning.itga.com.au>

> I've even tried sys.stderr.write("stuff") and it
> doesn't seem to appear anywhere (console nor apache
> logs). 

Well, it works fine to the error_log for me!  (apache1 and apache2 on Unix).
It may be something to do with your apache config, in particular the virtual
host logging setup.


From mike.looijmans at asml.com  Thu Jul  3 07:36:59 2003
From: mike.looijmans at asml.com (Mike Looijmans)
Date: Fri Jan  9 21:47:34 2004
Subject: [mod_python] Cookie
Message-ID: <01c34125$1f3a0f80$926a1e6e@wsasd464>

>I want to save 2 cookies using mod_python & Cookie modul. Can somebody help
>me, please?


Put your cookies in a SimpleCookie or SmartCookie, and use:

req.headers_out.add('Set-Cookie', cookies.output(header='',
sep='\r\nSet-Cookie:'))

to add them all in one shot.

--
Mike Looijmans
Private: http://www.milosoftware.com
-- Sorry about the nonsense below --



-- 
The information contained in this communication and any attachments is confidential and may be privileged, and is for the sole use of the intended recipient(s). Any unauthorized review, use, disclosure or distribution is prohibited. If you are not the intended recipient, please notify the sender immediately by replying to this message and destroy all copies of this message and any attachments. ASML is neither liable for the proper and complete transmission of the information contained in this communication, nor for any delay in its receipt.


From mike.looijmans at asml.com  Thu Jul  3 07:42:58 2003
From: mike.looijmans at asml.com (Mike Looijmans)
Date: Fri Jan  9 21:47:34 2004
Subject: [mod_python] Cookie
Message-ID: <01c34125$f5351d00$926a1e6e@wsasd464>

>Using the standard lib Cookie module is a bit ugly with mod_python because
>Cookie was designed with CGI in mind, which is why the next release of
>mod_python will have its own Cookie module.


Something like:

Request.cookie

so that Request has a 'cookie' object by default, which parses the 'cookie'
headers at the first call to Request.cookie. When setting it, it outputs the
cookie to the headers.

It would be a requirement to use the same interface as Cookie does, since that
allows CGI and mod_python code to share that part.

Mike.
-- My message ends here --



-- 
The information contained in this communication and any attachments is confidential and may be privileged, and is for the sole use of the intended recipient(s). Any unauthorized review, use, disclosure or distribution is prohibited. If you are not the intended recipient, please notify the sender immediately by replying to this message and destroy all copies of this message and any attachments. ASML is neither liable for the proper and complete transmission of the information contained in this communication, nor for any delay in its receipt.


From bill at rfa.org  Thu Jul  3 10:07:44 2003
From: bill at rfa.org (Bill Eldridge)
Date: Fri Jan  9 21:47:34 2004
Subject: [mod_python] Cookie
In-Reply-To: <20030702172715.A10551@onyx.ispol.com>
References: <00ce01c340a4$d30e74a0$0a01010a@dev1>
	<20030702172715.A10551@onyx.ispol.com>
Message-ID: <3F03E450.3070203@rfa.org>


PSO also has a session module that can be split off for
mod_python:

http://www.scriptfoundry.com/modules/pso/doc/session-modpython.html
http://www.scriptfoundry.com/modules/pso


Gregory (Grisha) Trubetskoy wrote:

>Something like this:
>
>c1 = Cookie.SimpleCookie("cookie1=value1")
>req.headers_out["Set-Cookie"] = c1.output(header="").strip()
>
>c2 = Cookie.SimpleCookie("cookie2=value2")
>req.headers_out.add("Set-Cookie") = c2.output(header="").strip()
>
>
>Using the standard lib Cookie module is a bit ugly with mod_python because
>Cookie was designed with CGI in mind, which is why the next release of
>mod_python will have its own Cookie module.
>
>Grisha
>
>
>On Wed, 2 Jul 2003, Alexiev Nikolay wrote:
>
>  
>
>>I want to save 2 cookies using mod_python & Cookie modul. Can somebody help
>>me, please?
>>10x
>>
>>Best regards,
>>Alexiev, Nikolay
>>
>>_______________________________________________
>>Mod_python mailing list
>>Mod_python@modpython.org
>>http://mailman.modpython.org/mailman/listinfo/mod_python
>>
>>    
>>
>_______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org
>http://mailman.modpython.org/mailman/listinfo/mod_python
>  
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20030703/42c7f02a/attachment.htm
From alexiev at activesolutions.bg  Thu Jul  3 14:39:49 2003
From: alexiev at activesolutions.bg (Alexiev Nikolay)
Date: Fri Jan  9 21:47:34 2004
Subject: [mod_python] Save cookie and redirect
Message-ID: <012101c34157$cfb52020$0a01010a@dev1>

I try to set cookie and redirect with one response. Redirect works fine but
cookie dosn't exist. What can I do?


HTTP_MOVED_PERMANENTLY = 301
req.headers_out.add('Set-Cookie', cookies.output(header='',
sep='\r\nSet-Cookie:'))
req.headers_out.add('Location', redirect)
req.status = HTTP_MOVED_PERMANENTLY

From manfred.stienstra at dwerg.net  Thu Jul  3 13:57:04 2003
From: manfred.stienstra at dwerg.net (Manfred Stienstra)
Date: Fri Jan  9 21:47:34 2004
Subject: [mod_python] Save cookie and redirect
In-Reply-To: <012101c34157$cfb52020$0a01010a@dev1>
References: <012101c34157$cfb52020$0a01010a@dev1>
Message-ID: <200307031357.04468.manfred.stienstra@dwerg.net>

On Thursday 03 July 2003 13:39, Alexiev Nikolay wrote:
> I try to set cookie and redirect with one response. Redirect works fine but
> cookie dosn't exist. What can I do?
>
>
> HTTP_MOVED_PERMANENTLY = 301
> req.headers_out.add('Set-Cookie', cookies.output(header='',
> sep='\r\nSet-Cookie:'))
> req.headers_out.add('Location', redirect)
> req.status = HTTP_MOVED_PERMANENTLY

First set the cookie and after that redirect. If it's a login page you could 
display a page saying something like 'successfully logged in' (setting the 
cookie) and after that (5 secs or something) you redirect.

Manfred

From dustin at ywlcs.org  Thu Jul  3 08:22:11 2003
From: dustin at ywlcs.org (Dustin Mitchell)
Date: Fri Jan  9 21:47:34 2004
Subject: [mod_python] problem creating an instance and debugging
In-Reply-To: <20030703032835.32306.qmail@web13905.mail.yahoo.com>
References: <200307030146.LAA14756@lightning.itga.com.au>
	<20030703032835.32306.qmail@web13905.mail.yahoo.com>
Message-ID: <20030703132210.GI23014@eleanor.internal.ywlcs.org>

On Wed, Jul 02, 2003 at 08:28:35PM -0700, Daniel Rubin wrote:
> Putting sys.stderr.flush() into my xmlrpc.py doesn't
> cause anything to get written to the apache log file.
> I've even tried sys.stderr.write("stuff") and it
> doesn't seem to appear anywhere (console nor apache
> logs). Is there no way to track what's going on in the
> code running on the server side in mod_python?

I usually open an external file in append mode and write to that.  Then
I tail -f that file, and there's the information I wanted!  It has the
advantage that nothing in the Apache config can cause me to miss
selected messages or anything like that.

Dustin

-- 

  Dustin Mitchell
  dustin@ywlcs.org/djmitche@alumni.uchicago.edu
  http://people.cs.uchicago.edu/~dustin/
From grisha at modpython.org  Thu Jul  3 09:46:00 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:34 2004
Subject: [mod_python] problem creating an instance and debugging 
In-Reply-To: <20030703032835.32306.qmail@web13905.mail.yahoo.com>
References: <20030703032835.32306.qmail@web13905.mail.yahoo.com>
Message-ID: <20030703094320.P12723@onyx.ispol.com>


Why not just use apache.log_error or req.log_error?

http://www.modpython.org/live/current/doc-html/pyapi-apmeth.html#l2h-18

On Wed, 2 Jul 2003, Daniel Rubin wrote:

> Putting sys.stderr.flush() into my xmlrpc.py doesn't
> cause anything to get written to the apache log file.
> I've even tried sys.stderr.write("stuff") and it
> doesn't seem to appear anywhere (console nor apache
> logs). Is there no way to track what's going on in the
> code running on the server side in mod_python?
>
> Thanks,
> Daniel
>
>
> --- Gregory Bond <gnb@itga.com.au> wrote:
> > > working and I'm unable to get mod_python to record
> > any
> > > error messages about this particular event to the
> > > apache error log.
> >
> > stderr in mod_python goes to the apache error log
> > but it is buffered.  You
> > need to use sys.stderr.flush() at appropriate times.
> >
> > See FAQ 2.3:
> >
> >
> http://www.modpython.org/FAQ/faqw.py?req=show&file=faq02.003.htp
> >
>
>
> __________________________________
> Do you Yahoo!?
> SBC Yahoo! DSL - Now only $29.95 per month!
> http://sbc.yahoo.com
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From dlrubin at yahoo.com  Thu Jul  3 07:30:13 2003
From: dlrubin at yahoo.com (Daniel Rubin)
Date: Fri Jan  9 21:47:34 2004
Subject: [mod_python] problem creating an instance and debugging 
In-Reply-To: <20030703094320.P12723@onyx.ispol.com>
Message-ID: <20030703143013.36335.qmail@web13907.mail.yahoo.com>

The problem is that the xmlrpc.py script on the server
dies at a line of code that doesn't cause an Exception
to be thrown, so nothing executes after that line of
code and lines calling a log event will never get
executed.  And for some reason, no error message is
appearing in the apache error log (I have a pretty
standard httpd.conf).

--- "Gregory (Grisha) Trubetskoy"
<grisha@modpython.org> wrote:
> 
> Why not just use apache.log_error or req.log_error?
> 
>
http://www.modpython.org/live/current/doc-html/pyapi-apmeth.html#l2h-18
> 
> On Wed, 2 Jul 2003, Daniel Rubin wrote:
> 
> > Putting sys.stderr.flush() into my xmlrpc.py
> doesn't
> > cause anything to get written to the apache log
> file.
> > I've even tried sys.stderr.write("stuff") and it
> > doesn't seem to appear anywhere (console nor
> apache
> > logs). Is there no way to track what's going on in
> the
> > code running on the server side in mod_python?
> >
> > Thanks,
> > Daniel
> >
> >
> > --- Gregory Bond <gnb@itga.com.au> wrote:
> > > > working and I'm unable to get mod_python to
> record
> > > any
> > > > error messages about this particular event to
> the
> > > > apache error log.
> > >
> > > stderr in mod_python goes to the apache error
> log
> > > but it is buffered.  You
> > > need to use sys.stderr.flush() at appropriate
> times.
> > >
> > > See FAQ 2.3:
> > >
> > >
> >
>
http://www.modpython.org/FAQ/faqw.py?req=show&file=faq02.003.htp
> > >
> >
> >
> > __________________________________
> > Do you Yahoo!?
> > SBC Yahoo! DSL - Now only $29.95 per month!
> > http://sbc.yahoo.com
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> >
>
http://mailman.modpython.org/mailman/listinfo/mod_python
> >


__________________________________
Do you Yahoo!?
SBC Yahoo! DSL - Now only $29.95 per month!
http://sbc.yahoo.com
From grisha at modpython.org  Thu Jul  3 10:47:15 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:34 2004
Subject: [mod_python] problem creating an instance and debugging
In-Reply-To: <20030703004652.45793.qmail@web13904.mail.yahoo.com>
References: <20030703004652.45793.qmail@web13904.mail.yahoo.com>
Message-ID: <20030703104322.J23236@onyx.ispol.com>



On Wed, 2 Jul 2003, Daniel Rubin wrote:

> within xmlrpc.py just fine, but right at the line where I create a new
> instance of obj (foo = obj()) I get a stack dump (see below), and there
> are no errors in the apache logs.

I'm confused - how do you know you get a stack dump?

Also - which are you most concerned with - the fact that there is nothing
in the logs, or that you get a stack dump under mod_python whereas as a
CGI it works ok?

Grisha
From grisha at modpython.org  Thu Jul  3 10:58:33 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:34 2004
Subject: [mod_python] Save cookie and redirect
In-Reply-To: <200307031357.04468.manfred.stienstra@dwerg.net>
References: <012101c34157$cfb52020$0a01010a@dev1>
	<200307031357.04468.manfred.stienstra@dwerg.net>
Message-ID: <20030703104837.L23236@onyx.ispol.com>


Could it be that the location that you're redirecting to isn't valid for
this cookie? IIRC, the default path attribute is the full path, i.e. if
cookie was issued in /my/location1/blah and you're redirecting to
/my/location2/blah, the browser won't send the cookie (unless you
explicitely specify path=/my)

Grisha

On Thu, 3 Jul 2003, Manfred Stienstra wrote:

> On Thursday 03 July 2003 13:39, Alexiev Nikolay wrote:
> > I try to set cookie and redirect with one response. Redirect works fine but
> > cookie dosn't exist. What can I do?
> >
> >
> > HTTP_MOVED_PERMANENTLY = 301
> > req.headers_out.add('Set-Cookie', cookies.output(header='',
> > sep='\r\nSet-Cookie:'))
> > req.headers_out.add('Location', redirect)
> > req.status = HTTP_MOVED_PERMANENTLY
>
> First set the cookie and after that redirect. If it's a login page you could
> display a page saying something like 'successfully logged in' (setting the
> cookie) and after that (5 secs or something) you redirect.
>
> Manfred
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From dlrubin at yahoo.com  Thu Jul  3 09:11:20 2003
From: dlrubin at yahoo.com (Daniel Rubin)
Date: Fri Jan  9 21:47:34 2004
Subject: [mod_python] problem creating an instance and debugging
In-Reply-To: <20030703104322.J23236@onyx.ispol.com>
Message-ID: <20030703161120.58394.qmail@web13908.mail.yahoo.com>

I get the stack dump from the client program that
calls the function in xmlrpc.py running on the apache
server.  The client program gets the stack dump from a
call inside xmlrpclib that is trying to get a response
back from the xmlrpc.py running on the server.  An
error is happening in the xmlrpc.py program, and this
isn't making it's own stack dump or errors written to
the apache logs on the server. So I can't debug what
the nature of the error that is happening in the
remotely called function.

My main concern is that or that I get a stack dump
under mod_python whereas as a CGI it works ok. I'm
concerned about the lack of error logging to apache
only because it might help me figure out what's going
wrong with the code running in mod_python.


--- "Gregory (Grisha) Trubetskoy"
<grisha@modpython.org> wrote:
> 
> 
> On Wed, 2 Jul 2003, Daniel Rubin wrote:
> 
> > within xmlrpc.py just fine, but right at the line
> where I create a new
> > instance of obj (foo = obj()) I get a stack dump
> (see below), and there
> > are no errors in the apache logs.
> 
> I'm confused - how do you know you get a stack dump?
> 
> Also - which are you most concerned with - the fact
> that there is nothing
> in the logs, or that you get a stack dump under
> mod_python whereas as a
> CGI it works ok?
> 
> Grisha


__________________________________
Do you Yahoo!?
SBC Yahoo! DSL - Now only $29.95 per month!
http://sbc.yahoo.com
From grisha at modpython.org  Thu Jul  3 13:31:54 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:34 2004
Subject: [mod_python] problem creating an instance and debugging
In-Reply-To: <20030703161120.58394.qmail@web13908.mail.yahoo.com>
References: <20030703161120.58394.qmail@web13908.mail.yahoo.com>
Message-ID: <20030703132213.X23236@onyx.ispol.com>



On Thu, 3 Jul 2003, Daniel Rubin wrote:

> An error is happening in the xmlrpc.py program, and this isn't making
> it's own stack dump or errors written to the apache logs on the server.
> So I can't debug what the nature of the error that is happening in the
> remotely called function.

So, tell me if I understand this correctly (I'm not familiar with
xmlrpc.py) -

Xmlrpc.py is a CGI script which reports its errors by writing them to
stderr. Something happens when you run it under mod_python, and you don't
know what it is because stderr goes nowhere.

As far as I know, stderr output may end up in your error log, but I don't
think that's guaranteed and may be dependent on how your httpd was
compiled.  I think there is really no solution to this other than to tweak
xmlrpc into raising its exception or using mod_python's log_error to
report it.

HTH,

Grisha
From dlrubin at yahoo.com  Thu Jul  3 11:41:10 2003
From: dlrubin at yahoo.com (Daniel Rubin)
Date: Fri Jan  9 21:47:34 2004
Subject: [mod_python] problem creating an instance and debugging
In-Reply-To: <20030703132213.X23236@onyx.ispol.com>
Message-ID: <20030703184110.41206.qmail@web13905.mail.yahoo.com>

Here's the xmlrpc.py code. My client code is calling
the "evaluate" function via a call like this:
server = xmlrpclib.ServerProxy(myURI)
server.evaluate(data)

If I put the "return data" statement right before the
"model=Model()" statement, then things work fine. If I
put the return statement after it, then I get the
stack dump I showed you earlier. The code never jupmps
to the except: clause, and no errors are being written
to the apache logs (and my conf file is set to record
everything with no virtual hosts).


from mod_python import apache
import xmlrpclib

def evaluate(data):
     import MyTools import Model
     try:
          model = Model()  <--an error happens here
          return data
     except:
          open("/tmp/test_xmlrpc01",
'w').write("RUNNING ON %s" % findings)
          import traceback
         
traceback.print_exc(file=open("/tmp/test_xmlrpc03",
'w'))
          raise

def handler(req):
    import sys
    
    module = sys.modules[__name__]

    # Load the method and arguments from the client.
    content = req.read()

    # xmlrpclib fails if there are characters with
ASCII code >= 128.
    # Thus, change anything greater than that to a
space.
    table = ''.join(map(chr, range(128))) + " "*128
    content = content.translate(table)
        
    args, method_name = xmlrpclib.loads(content)

    # Call the method.
    if hasattr(module, method_name):
        try:
            retval = getattr(module,
method_name)(*args)
        except Exception, x:
            retval = xmlrpclib.Fault(
                0, "Exception (%s) raised: %s" %
(Exception.__name__, str(x)))
        except x:
            retval = xmlrpclib.Fault(
                0, "General exception raised: %s" %
str(x))
    else:
        retval = xmlrpclib.Fault(
            0, "This server does not provide: '%s'" %
method_name)

    # Marshal the return value and write the results
back to the
    # client.
    req.content_type = "text/xml"
    marshalled = xmlrpclib.dumps((retval,),
methodresponse=1)
    req.write(marshalled)
    
    return apache.OK



--- "Gregory (Grisha) Trubetskoy"
<grisha@modpython.org> wrote:
> 
> 
> On Thu, 3 Jul 2003, Daniel Rubin wrote:
> 
> > An error is happening in the xmlrpc.py program,
> and this isn't making
> > it's own stack dump or errors written to the
> apache logs on the server.
> > So I can't debug what the nature of the error that
> is happening in the
> > remotely called function.
> 
> So, tell me if I understand this correctly (I'm not
> familiar with
> xmlrpc.py) -
> 
> Xmlrpc.py is a CGI script which reports its errors
> by writing them to
> stderr. Something happens when you run it under
> mod_python, and you don't
> know what it is because stderr goes nowhere.
> 
> As far as I know, stderr output may end up in your
> error log, but I don't
> think that's guaranteed and may be dependent on how
> your httpd was
> compiled.  I think there is really no solution to
> this other than to tweak
> xmlrpc into raising its exception or using
> mod_python's log_error to
> report it.
> 
> HTH,
> 
> Grisha


__________________________________
Do you Yahoo!?
SBC Yahoo! DSL - Now only $29.95 per month!
http://sbc.yahoo.com
From harm-modpython at tty.nl  Fri Jul  4 19:00:39 2003
From: harm-modpython at tty.nl (harm)
Date: Fri Jan  9 21:47:34 2004
Subject: [mod_python] OSx compile problem
Message-ID: <20030704170039.GA5999@godel>


Moi,

somehow compiling on OSX does not work for me (OSX 10.2) with python 2.2.3,
mod_python 2.7.8 and apache 1.3.27


trying a static build gives:

gcc  -DDARWIN -DUSE_HSREGEX -DUSE_EXPAT -I./lib/expat-lite -DNO_DL_NEEDED
`./apaci` -u __dummy -u _PyMac_Error -framework System -framework
CoreServices -framework Foundation        \
      -o httpd buildmark.o modules.o modules/python/libpython.a
modules/standard/libstandard.a main/libmain.a ./os/unix/libos.a ap/libap.a
regex/libregex.a lib/expat-lite/libexpat.a  -lm
/usr/local/lib/python2.2/config/libpython2.2.a   -ldl                 
ld: table of contents for archive: modules/python/libpython.a is out of
date; rerun ranlib(1) (can't load from it)
make[2]: *** [target_static] Error 1
make[1]: *** [build-std] Error 2
make: *** [build] Error 2
[Harmens-Computer:/tmp/apache_1.3.27] harmen%



A DSO gives:
Compiling for DSO. For static, do "make static"

/usr/local/apache/sbin/apxs -I/tmp/mod_python-2.7.8/src/include
-I/usr/local/apache/include -I/usr/local/include/python2.2 -c mod_python.o
_apachemodule.o requestobject.o tableobject.o util.o serverobject.o
connobject.o  -lm  /usr/local/lib/python2.2/config/libpython2.2.a   -ldl                 
  -o mod_python.so mod_python.o _apachemodule.o requestobject.o
tableobject.o util.o serverobject.o connobject.o -lm
/usr/local/lib/python2.2/config/libpython2.2.a -ldl 
apxs:Break: Command failed with rc=16777215
make[1]: *** [mod_python.so] Error 1
make: *** [do_dso] Error 2
[Harmens-Computer:/tmp/mod_python-2.7.8] harmen% 




The ./configure output indicates it does take the right freshly recompiled nonthreaded python libs.  Any hints?

Thanks,
Harmen



(Hope this email does get through, my excuse for any doubles)

-- 
                               The Moon is Waxing Crescent (13% of Full)
From grisha at modpython.org  Fri Jul  4 15:10:21 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:34 2004
Subject: [mod_python] OSx compile problem
In-Reply-To: <20030704170039.GA5999@godel>
References: <20030704170039.GA5999@godel>
Message-ID: <20030704150856.U35122@onyx.ispol.com>



On Fri, 4 Jul 2003, harm wrote:

> somehow compiling on OSX does not work for me (OSX 10.2) with python 2.2.3,
>
> The ./configure output indicates it does take the right freshly
> recompiled nonthreaded python libs.  Any hints?

Check the README - there are some problems with darwin's libtool and the
way dynamic linking works, but the README has the steps to get it
compiled.

Grisha
From harm-modpython at tty.nl  Sat Jul  5 00:08:19 2003
From: harm-modpython at tty.nl (harm)
Date: Fri Jan  9 21:47:34 2004
Subject: [mod_python] OSx compile problem
In-Reply-To: <20030704150856.U35122@onyx.ispol.com>
References: <20030704170039.GA5999@godel>
	<20030704150856.U35122@onyx.ispol.com>
Message-ID: <20030704220819.GA6079@godel>

On Fri, Jul 04, 2003 at 03:10:21PM -0400, Gregory (Grisha) Trubetskoy wrote:
> 
> 
> On Fri, 4 Jul 2003, harm wrote:
> 
> > somehow compiling on OSX does not work for me (OSX 10.2) with python 2.2.3,
> >
> > The ./configure output indicates it does take the right freshly
> > recompiled nonthreaded python libs.  Any hints?
> 
> Check the README - there are some problems with darwin's libtool and the
> way dynamic linking works, but the README has the steps to get it
> compiled.

Ah! The readme in 3.0.3 has the info, indeed. Too bad I was trying to
install 2.7.8, which does not have that info :)

Thanks, 

Harmen
> 
> Grisha
> 

-- 
                               The Moon is Waxing Crescent (27% of Full)
From michel_ts at yahoo.com.br  Sat Jul  5 10:39:59 2003
From: michel_ts at yahoo.com.br (=?iso-8859-1?q?Michel=20Thadeu?=)
Date: Fri Jan  9 21:47:34 2004
Subject: [mod_python] A problem with publisher method...
Message-ID: <20030705133959.23742.qmail@web40408.mail.yahoo.com>

Hi guys!

I still have trouble with publisher method, I read a bite about and now
I imagine what is my problem...

The problem is with index, I want to access something like this:

http://127.0.0.1/mypage/test.py or better .../mypage/ (accessing the
index.py), but if I create an index function in test.py ou index.py, it
said 404notfound...

if I access index like in http://127.0.0.1/mypage/index.py/index it
goes ok. I think it conflitates in some point...

What could be the problem?

thanks for help and sorry my poor english!

[]'s

--
Michel Thadeu Sabchuk
Curitiba - Paran? - Brasil

=====
--
Michel Thadeu Sabchuk
Curitiba/PR

_______________________________________________________________________
Yahoo! Mail
Mais espa?o, mais seguran?a e gratuito: caixa postal de 6MB, antiv?rus, prote??o contra spam.
http://br.mail.yahoo.com/
From pascalbarbedor at free.fr  Sun Jul  6 11:29:36 2003
From: pascalbarbedor at free.fr (pascal barbedor)
Date: Fri Jan  9 21:47:34 2004
Subject: [mod_python] Fw: pb with apache readme dir include
Message-ID: <001601c343a1$32b7d550$468f933e@allalswqm99ewu>


>
>
> Hi
>
> I have the following problem with mod_python :
>
> set up a directory like this
>
>
> <Directory "c:/home/">
> AddHandler python-program .py .html
> PythonHandler eindex
> PythonDebug On
> DirectoryIndex index.html eindex.py
> Options Indexes
> Order allow,deny
> Allow from all
> </Directory>
>
> this works ok, I intercept also .html files in the eindex.py script.
>
> now if I call a subdirectory of home, like /home/subdir, control is passed
> to apache
> wich produces a standard directory index
>
> so far so good.
>
>
> now if a readme.html is located in the subdir, apache appends it to the
> directoryindex page,
> as it is normal by default.
>
> but then something interferes and it is like if the appended reame.html
was
> processed by the eindex.py above (but it is located in the subdir) and not
> by apache, though the bare directory index is here.
>
> of course if AddHandler python-program .py  (without .html) everything
goes
> well.
>
> I tried to add
> sethandler default-handler for home/subdir but it does not work
>
>
>
>
> pascal
>

From gnb at itga.com.au  Mon Jul  7 14:20:28 2003
From: gnb at itga.com.au (Gregory Bond)
Date: Fri Jan  9 21:47:34 2004
Subject: [mod_python] Compiling 2.7 statically
Message-ID: <200307070420.OAA24234@lightning.itga.com.au>

I'm trying to compile mod_python 2.7 (plus mod_ssl) statically into apache
1.3.27.  I'm using Python 2.1.1 on Solaris 6.

The first problem is that the Apache link step fails, because the mod_python 
library (libpython.a) refers to symbols in the libpython2.1.a library, and 
this is never referenced anywhere.  

I worked around that by adding ".../libpython2.1.a -lm" to EXTRA_LIBS in src/
Makefile.

This allows me to build an apache binary, and get the "Hello World" mod_python 
app working.  But as soon as I try any substantial application, I get errors 
like this:

PythonHandler oneaccount: ImportError: ld.so.1: /opt/apache/bin/httpd: fatal: relocation error: file /usr/local/lib/python2.1/lib-dynload/cStringIO.so: symbol PyCObject_FromVoidPtr: referenced symbol not found

which makes sense as these symbols are potentially not needed by mod_python 
therefore the relevent .o files aren't sucked in from the .a file.  

So how do I make this work? Or is statically compiling in mod_python a doomed 
exercise?



From stian at soiland.no  Mon Jul  7 18:15:16 2003
From: stian at soiland.no (Stian =?iso-8859-1?Q?S=F8iland?=)
Date: Fri Jan  9 21:47:34 2004
Subject: [mod_python] mod_python weirdness, maybe related to importing?
In-Reply-To: <20030610081422.GC28085@tummy.com>
References: <20030610055927.GB28085@tummy.com> <3EE584EE.9090503@sjsoft.com>
	<20030610081422.GC28085@tummy.com>
Message-ID: <20030707161516.GA614@itea.ntnu.no>

On 1970-01-01 01:00:00, Sean Reifschneider wrote:
   ~~~~
(.. importing the mail archives appearantly does not work that well
anymore :=) )

> On Tue, Jun 10, 2003 at 09:12:46AM +0200, David Fraser wrote:
> >Do you mean you're using this import mechanism when you have the problem 
> >with jotweb.input.Request below?
> 
> I mean that the imp module call is loading a module which then does an
> "import jotweb.input".  If in the jotweb I don't have the __init__.py
> import all sub-packages or sub-modules, I will get an AttributeError
> such as:
> 
>   AttributeError: 'module' object has no attribute 'input'

I can confirm the very same problem. We've been scratching our heads
today.

[ in this post I'll be quoting python code like /print "Python example"/ ]


We're using mod_python.publisher as PythonHandler, and have some
library functions in /usr/local/nav/navme/lib/python.

As our PythonPath seems to be totally mucked up, refering to
/usr/lib/python and so on, we .. as a quickfix.. set it manually

PythonPath "['', '/usr/local/lib/python2.2/site-packages',
    '/usr/lib/apache/python/lib/python2.2',
    '/usr/lib/apache/python/lib/python2.2/plat-linux2',
    '/usr/lib/apache/python/lib/python2.2/lib-tk',
    '/usr/lib/apache/python/lib/python2.2/lib-dynload',
    '/usr/lib/apache/python/lib/python2.2/site-packages',
    '/usr/local/nav/navme/lib/python',
    '/usr/local/lib/python2.2/site-packages', '.']"

(/usr/lib/apache/python/lib/python2.2 is our threadless installation,
this is Apache/1.3.27 (Unix) (Red-Hat/Linux) mod_python/2.7.8
Python/2.2.2 mod_ssl/2.8.12 OpenSSL/0.9.6b PHP/4.1.2)


The problem was weird, in a method logout() in index.py, we try
/from nav.web import state/. This always fail, both if we do it on a
module level or inside the function.

However, /from nav.web import auth/ works fine. The permissions are
perfect, there are no .pyc-files hanging around, and there is really no
big differences between the two files.

Actually we found out that symlinking nav/web to nav/webb - and trying
/from nav.webb import auth/  WORKED, suggesting some problems with
caching. Several apache-restarts gives no more help.

Using /usr/lib/apache/python/lib/python2.2/bin/python from the shell,
running as httpd, with the same PythonPath as above (verified by
req.write("%s" % sys.path)  ), from nav import auth works perfect.


The 'fix' you suggested, using import auth in nav/web/__init__.py - DID
work, however, as in your case, there is no reason why this should be
neccessary. 

In SOME of the cases in this testing, the error message is not from
/usr/local/nav/navme/apache/webroot/index.py (where the import actually
happens), but from mod_python/apache.py in the function import_module.
This function looks pretty weird to me, I tried adding some debug
sentences to follow the execution paths.


However, it turns out that our trouble-module nav.web.state is used as a
fixup handler as well, PythonFixupHandler nav.web.state.

Renaming to /PythonFixupHandler nav.webb.state/ removes the bug, 
/from nav.web import state/  suddenly works again.


So in our case, the problem is related to the module being used both in
handlers and imported by submodules. Appearently the errors from
mod_python.apache.import_module appears only those times the
PythonFixupHandler won't load. 

(debug messages reveal that import_module is NOT called by the normal
import sentence - that's good, as I couldn't understand how it could
have been called at that time :=) )



However, the problem is still unsolved, although the __init__.py-import
is  a working workaround (the symlink magic is NOT! :=) )

Is your problem-module a part of other headers (or imports) as well?


    (our team is also very pissed of by the need to restart apache every
    minute to force reloading of all modules.  It's seems like a 
    boring job to do like in 3.1 - as it still does not assure that
    modules are reloaded only once and in the correct order.

    A simple-but-stupid reload-all-modules-known-to-python fix did NOT
    work, as subclasses in different modules get totally confused being
    subclassed by some class that no longer exist. The problem is
    reloading in the correct order, and only once per request.

    Is there a nice way to UNLOAD all classes?  I'm thinking of
    something like /del sys.modules['mymodule']/ - but.. I'll have to
    check the module to see if it's mine or some internal python module
    first :=) )


-- 
Stian S?iland               Work toward win-win situation. Win-lose
Trondheim, Norway           is where you win and the other lose.
http://www.soiland.no/      Lose-lose and lose-win are left as an
                            exercise to the reader.  [Limoncelli/Hogan]


From stian at soiland.no  Mon Jul  7 18:19:49 2003
From: stian at soiland.no (Stian =?iso-8859-1?Q?S=F8iland?=)
Date: Fri Jan  9 21:47:34 2004
Subject: [mod_python] mod_python weirdness, maybe related to importing?
In-Reply-To: <20030616005419.GM8892@tummy.com>
References: <200306160025.KAA13272@lightning.itga.com.au>
	<20030616005419.GM8892@tummy.com>
Message-ID: <20030707161949.GB614@itea.ntnu.no>

On 1970-01-01 01:00:00, Sean Reifschneider wrote:

> Also, I'm running into cases where I'm setting values within modules in
> my handler, and then when I call code in the module those values are
> reset.  I've resorted to shoving request-persistent data into
> __builtins__, which works around the latter problem, and re-structuring
> some code so that my entire object heirarchy *CAN* be imported all at
> once.

Btw, a good tip to store some info from here to there is to store them
as attributes in the req object. We've created req.session by loading it
in the PythonFixupHandler mentioned in an earlier post, req.session is
available to all subsequent request handlers.

(and in some cases, weird enough, after the request is finished, the
attribute still remains in req.session for the NEXT call.. leading
to..
  
  def fixuphandler(req):
      req.session = None
)




-- 
Stian S?iland               Work toward win-win situation. Win-lose
Trondheim, Norway           is where you win and the other lose.
http://www.soiland.no/      Lose-lose and lose-win are left as an
                            exercise to the reader.  [Limoncelli/Hogan]

From stian at soiland.no  Mon Jul  7 18:33:44 2003
From: stian at soiland.no (Stian =?iso-8859-1?Q?S=F8iland?=)
Date: Fri Jan  9 21:47:34 2004
Subject: [mod_python] mod_python weirdness, maybe related to importing?
Message-ID: <20030707163344.GE614@itea.ntnu.no>

On 1970-01-01 01:00:00, Sean Reifschneider wrote:

> Also, I'm running into cases where I'm setting values within modules in
> my handler, and then when I call code in the module those values are
> reset.  I've resorted to shoving request-persistent data into
> __builtins__, which works around the latter problem, and re-structuring
> some code so that my entire object heirarchy *CAN* be imported all at
> once.

Btw, a good tip to store some info from here to there is to store them
as attributes in the req object. We've created req.session by loading it
in the PythonFixupHandler mentioned in an earlier post, req.session is
available to all subsequent request handlers.

(and in some cases, weird enough, after the request is finished, the
attribute still remains in req.session for the NEXT call.. leading
to..
  
  def fixuphandler(req):
      req.session = None
)




-- 
Stian S?iland               Work toward win-win situation. Win-lose
Trondheim, Norway           is where you win and the other lose.
http://www.soiland.no/      Lose-lose and lose-win are left as an
                            exercise to the reader.  [Limoncelli/Hogan]

From stian at soiland.no  Mon Jul  7 18:33:14 2003
From: stian at soiland.no (Stian =?iso-8859-1?Q?S=F8iland?=)
Date: Fri Jan  9 21:47:34 2004
Subject: [mod_python] mod_python weirdness, maybe related to importing?
Message-ID: <20030707163314.GD614@itea.ntnu.no>

(as I found out, posting before subscribing is a bad idea =) 

On 1970-01-01 01:00:00, Sean Reifschneider wrote:
   ~~~~
(.. importing the mail archives appearantly does not work that well
anymore :=) )

> On Tue, Jun 10, 2003 at 09:12:46AM +0200, David Fraser wrote:
> >Do you mean you're using this import mechanism when you have the problem 
> >with jotweb.input.Request below?
> 
> I mean that the imp module call is loading a module which then does an
> "import jotweb.input".  If in the jotweb I don't have the __init__.py
> import all sub-packages or sub-modules, I will get an AttributeError
> such as:
> 
>   AttributeError: 'module' object has no attribute 'input'

I can confirm the very same problem. We've been scratching our heads
today.

[ in this post I'll be quoting python code like /print "Python example"/ ]


We're using mod_python.publisher as PythonHandler, and have some
library functions in /usr/local/nav/navme/lib/python.

As our PythonPath seems to be totally mucked up, refering to
/usr/lib/python and so on, we .. as a quickfix.. set it manually

PythonPath "['', '/usr/local/lib/python2.2/site-packages',
    '/usr/lib/apache/python/lib/python2.2',
    '/usr/lib/apache/python/lib/python2.2/plat-linux2',
    '/usr/lib/apache/python/lib/python2.2/lib-tk',
    '/usr/lib/apache/python/lib/python2.2/lib-dynload',
    '/usr/lib/apache/python/lib/python2.2/site-packages',
    '/usr/local/nav/navme/lib/python',
    '/usr/local/lib/python2.2/site-packages', '.']"

(/usr/lib/apache/python/lib/python2.2 is our threadless installation,
this is Apache/1.3.27 (Unix) (Red-Hat/Linux) mod_python/2.7.8
Python/2.2.2 mod_ssl/2.8.12 OpenSSL/0.9.6b PHP/4.1.2)


The problem was weird, in a method logout() in index.py, we try
/from nav.web import state/. This always fail, both if we do it on a
module level or inside the function.

However, /from nav.web import auth/ works fine. The permissions are
perfect, there are no .pyc-files hanging around, and there is really no
big differences between the two files.

Actually we found out that symlinking nav/web to nav/webb - and trying
/from nav.webb import auth/  WORKED, suggesting some problems with
caching. Several apache-restarts gives no more help.

Using /usr/lib/apache/python/lib/python2.2/bin/python from the shell,
running as httpd, with the same PythonPath as above (verified by
req.write("%s" % sys.path)  ), from nav import auth works perfect.


The 'fix' you suggested, using import auth in nav/web/__init__.py - DID
work, however, as in your case, there is no reason why this should be
neccessary. 

In SOME of the cases in this testing, the error message is not from
/usr/local/nav/navme/apache/webroot/index.py (where the import actually
happens), but from mod_python/apache.py in the function import_module.
This function looks pretty weird to me, I tried adding some debug
sentences to follow the execution paths.


However, it turns out that our trouble-module nav.web.state is used as a
fixup handler as well, PythonFixupHandler nav.web.state.

Renaming to /PythonFixupHandler nav.webb.state/ removes the bug, 
/from nav.web import state/  suddenly works again.


So in our case, the problem is related to the module being used both in
handlers and imported by submodules. Appearently the errors from
mod_python.apache.import_module appears only those times the
PythonFixupHandler won't load. 

(debug messages reveal that import_module is NOT called by the normal
import sentence - that's good, as I couldn't understand how it could
have been called at that time :=) )



However, the problem is still unsolved, although the __init__.py-import
is  a working workaround (the symlink magic is NOT! :=) )

Is your problem-module a part of other headers (or imports) as well?


    (our team is also very pissed of by the need to restart apache every
    minute to force reloading of all modules.  It's seems like a 
    boring job to do like in 3.1 - as it still does not assure that
    modules are reloaded only once and in the correct order.

    A simple-but-stupid reload-all-modules-known-to-python fix did NOT
    work, as subclasses in different modules get totally confused being
    subclassed by some class that no longer exist. The problem is
    reloading in the correct order, and only once per request.

    Is there a nice way to UNLOAD all classes?  I'm thinking of
    something like /del sys.modules['mymodule']/ - but.. I'll have to
    check the module to see if it's mine or some internal python module
    first :=) )


-- 
Stian S?iland               Work toward win-win situation. Win-lose
Trondheim, Norway           is where you win and the other lose.
http://www.soiland.no/      Lose-lose and lose-win are left as an
                            exercise to the reader.  [Limoncelli/Hogan]

----- End forwarded message -----

-- 
Stian S?iland               Work toward win-win situation. Win-lose
Trondheim, Norway           is where you win and the other lose.
http://www.soiland.no/      Lose-lose and lose-win are left as an
                            exercise to the reader.  [Limoncelli/Hogan]

From jafo at tummy.com  Tue Jul  8 01:42:00 2003
From: jafo at tummy.com (Sean Reifschneider)
Date: Fri Jan  9 21:47:34 2004
Subject: [mod_python] mod_python weirdness, maybe related to importing?
In-Reply-To: <20030707161949.GB614@itea.ntnu.no>
References: <200306160025.KAA13272@lightning.itga.com.au>
	<20030616005419.GM8892@tummy.com> <20030707161949.GB614@itea.ntnu.no>
Message-ID: <20030708074200.GH1996@tummy.com>

On Mon, Jul 07, 2003 at 06:19:49PM +0200, Stian S?iland wrote:
>Btw, a good tip to store some info from here to there is to store them
>as attributes in the req object. We've created req.session by loading it

Yeah, unfortunately I can't really use that.  My handler calls into
SimpleTAL, and the code that really needs to use the extra data no
longer has access to the request object.

Sean
-- 
 *** Quits: TITANIC (Excess Flood)
Sean Reifschneider, Member of Technical Staff <jafo@tummy.com>
tummy.com, ltd. - Linux Consulting since 1995.  Qmail, Python, SysAdmin
      Back off man. I'm a scientist.   http://HackingSociety.org/
From matt at pollenation.net  Wed Jul  9 17:35:26 2003
From: matt at pollenation.net (Matt Goodall)
Date: Fri Jan  9 21:47:34 2004
Subject: [mod_python] missing path element in path_info
Message-ID: <1057768526.27471.335.camel@localhost>

Hi,

Over in the world of Albatross
(http://www.object-craft.com.au/projects/albatross/) we've been playing
with path_info and have come across something that we don't quite
understand.

Here's some example code to demonstrate:

----- .htaccess -----
DirectoryIndex app.py
SetHandler python-program
PythonHandler app
-----

----- app.py -----
from mod_python import apache
                                                                                def handler(req):
    req.content_type = 'text/plain'
    req.send_http_header()

    req.write('the_request: %s\n' % req.the_request)
    req.write('unparsed_uri: %s\n' % req.unparsed_uri)
    req.write('uri: %s\n' % req.uri)
    req.write('filename: %s\n' % req.filename)
    req.write('path_info: %s\n' % req.path_info)

    return apache.OK
-----

If I put those files in /~matt/test on the web server then this is what
I see for each URL:

        = URL /~matt/test/1/2/3 =
        the_request: GET /~matt/test/app.py/1/2/3 HTTP/1.1
        unparsed_uri: /~matt/test/app.py/1/2/3
        uri: /~matt/test/app.py/1/2/3
        filename: /home/matt/public_html/test/app.py
        path_info: /1/2/3
        
        = /~matt/test/app.py/1/2/3 =
        the_request: GET /~matt/test/app.py/1/2/3 HTTP/1.1
        unparsed_uri: /~matt/test/app.py/1/2/3
        uri: /~matt/test/app.py/1/2/3
        filename: /home/matt/public_html/test/app.py
        path_info: /1/2/3
        
        = /~matt/test/1/2/3 =
        the_request: GET /~matt/test/1/2/3 HTTP/1.1
        unparsed_uri: /~matt/test/1/2/3
        uri: /~matt/test/1/2/3
        filename: /home/matt/public_html/test/1
        path_info: /2/3
        
The first two are as expected but the last one drops app.py completely
and thinks that the first element of path_info is part of the filename.

Can anyone explain this?

Server details:

	Apache 1.3.27
	mod_python 2.7.8
	Linux 2.4.x, Gentoo and Debian (I think).

Thanks in advance.

- Matt

-- 
Matt Goodall, Pollenation Internet Ltd
w: http://www.pollenation.net
e: matt@pollenation.net
From grisha at modpython.org  Wed Jul  9 13:10:30 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:34 2004
Subject: [mod_python] missing path element in path_info
In-Reply-To: <1057768526.27471.335.camel@localhost>
References: <1057768526.27471.335.camel@localhost>
Message-ID: <20030709130315.K99051@onyx.ispol.com>


I am not sure I understand the difference between the first two, the
request seems to be the same. What are the url's that you're trying to
access (from the browser point of view)?

In the last one, the reason "1" is not part of path_info: path_info is
something apache figures out. I think the rule is that it sees that "test"
is a directory, and the next thing after it isn't, thus, it must refer to
a file (whether or not the file exists doesn't matter). Everything after a
file is path_info.

On Wed, 9 Jul 2003, Matt Goodall wrote:

> Hi,
>
> Over in the world of Albatross
> (http://www.object-craft.com.au/projects/albatross/) we've been playing
> with path_info and have come across something that we don't quite
> understand.
>
> Here's some example code to demonstrate:
>
> ----- .htaccess -----
> DirectoryIndex app.py
> SetHandler python-program
> PythonHandler app
> -----
>
> ----- app.py -----
> from mod_python import apache
>                                                                                 def handler(req):
>     req.content_type = 'text/plain'
>     req.send_http_header()
>
>     req.write('the_request: %s\n' % req.the_request)
>     req.write('unparsed_uri: %s\n' % req.unparsed_uri)
>     req.write('uri: %s\n' % req.uri)
>     req.write('filename: %s\n' % req.filename)
>     req.write('path_info: %s\n' % req.path_info)
>
>     return apache.OK
> -----
>
> If I put those files in /~matt/test on the web server then this is what
> I see for each URL:
>
>         = URL /~matt/test/1/2/3 =
>         the_request: GET /~matt/test/app.py/1/2/3 HTTP/1.1
>         unparsed_uri: /~matt/test/app.py/1/2/3
>         uri: /~matt/test/app.py/1/2/3
>         filename: /home/matt/public_html/test/app.py
>         path_info: /1/2/3
>
>         = /~matt/test/app.py/1/2/3 =
>         the_request: GET /~matt/test/app.py/1/2/3 HTTP/1.1
>         unparsed_uri: /~matt/test/app.py/1/2/3
>         uri: /~matt/test/app.py/1/2/3
>         filename: /home/matt/public_html/test/app.py
>         path_info: /1/2/3
>
>         = /~matt/test/1/2/3 =
>         the_request: GET /~matt/test/1/2/3 HTTP/1.1
>         unparsed_uri: /~matt/test/1/2/3
>         uri: /~matt/test/1/2/3
>         filename: /home/matt/public_html/test/1
>         path_info: /2/3
>
> The first two are as expected but the last one drops app.py completely
> and thinks that the first element of path_info is part of the filename.
>
> Can anyone explain this?
>
> Server details:
>
> 	Apache 1.3.27
> 	mod_python 2.7.8
> 	Linux 2.4.x, Gentoo and Debian (I think).
>
> Thanks in advance.
>
> - Matt
>
> --
> Matt Goodall, Pollenation Internet Ltd
> w: http://www.pollenation.net
> e: matt@pollenation.net
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From matt at pollenation.net  Wed Jul  9 20:36:12 2003
From: matt at pollenation.net (Matt Goodall)
Date: Fri Jan  9 21:47:35 2004
Subject: [mod_python] missing path element in path_info
In-Reply-To: <20030709130315.K99051@onyx.ispol.com>
References: <1057768526.27471.335.camel@localhost>
	 <20030709130315.K99051@onyx.ispol.com>
Message-ID: <1057779371.28628.484.camel@localhost>

On Wed, 2003-07-09 at 18:10, Gregory (Grisha) Trubetskoy wrote:
> I am not sure I understand the difference between the first two, the
> request seems to be the same. What are the url's that you're trying to
> access (from the browser point of view)?

OK, I'm not having a good day ... I can't even copy and paste correctly
anymore! The example output should have been as follows, where the
browser URL is between the '= =', just above the request attribute list.

  = /~matt/test/ =
  the_request: GET /~matt/test/ HTTP/1.1
  unparsed_uri: /~matt/test/app.py
  uri: /~matt/test/app.py
  filename: /home/matt/public_html/test/app.py
  path_info:

  = /~matt/test/app.py/1/2/3 =
  the_request: GET /~matt/test/app.py/1/2/3 HTTP/1.1
  unparsed_uri: /~matt/test/app.py/1/2/3
  uri: /~matt/test/app.py/1/2/3
  filename: /home/matt/public_html/test/app.py
  path_info: /1/2/3

  = /~matt/test/1/2/3 =
  the_request: GET /~matt/test/1/2/3 HTTP/1.1
  unparsed_uri: /~matt/test/1/2/3
  uri: /~matt/test/1/2/3
  filename: /home/matt/public_html/test/1
  path_info: /2/3

The first example demonstrates that app.py is sometimes part of the
filename even when it is not part of the browser's URL. As I mentioned
before, it is only example 3 that was a surprise.

> 
> In the last one, the reason "1" is not part of path_info: path_info is
> something apache figures out. I think the rule is that it sees that "test"
> is a directory, and the next thing after it isn't, thus, it must refer to
> a file (whether or not the file exists doesn't matter). Everything after a
> file is path_info.

I think this answers the original question anyway.

Is there actually a foolproof way of working out the correct base uri of
the application (i.e. the path, with or without the app.py) from the
information in the request alone? The results I would like are below but
I'm not convinced enough information is available:

  URL                        app base uri         path info
  -------------------------  -------------------  ----------
  /~matt/test/               /~matt/test          /
  /~matt/test/app.py/1/2/3   /~matt/test/app.py   /1/2/3
  /~matt/test/1/2/3          /~matt/test          /1/2/3


Of course, the alternative is for the developer to specify the base uri
in configuration code which is how Albatross currently works.

Thanks, Matt


> 
> On Wed, 9 Jul 2003, Matt Goodall wrote:
> 
> > Hi,
> >
> > Over in the world of Albatross
> > (http://www.object-craft.com.au/projects/albatross/) we've been playing
> > with path_info and have come across something that we don't quite
> > understand.
> >
> > Here's some example code to demonstrate:
> >
> > ----- .htaccess -----
> > DirectoryIndex app.py
> > SetHandler python-program
> > PythonHandler app
> > -----
> >
> > ----- app.py -----
> > from mod_python import apache
> >                                                                                 def handler(req):
> >     req.content_type = 'text/plain'
> >     req.send_http_header()
> >
> >     req.write('the_request: %s\n' % req.the_request)
> >     req.write('unparsed_uri: %s\n' % req.unparsed_uri)
> >     req.write('uri: %s\n' % req.uri)
> >     req.write('filename: %s\n' % req.filename)
> >     req.write('path_info: %s\n' % req.path_info)
> >
> >     return apache.OK
> > -----
> >
> > If I put those files in /~matt/test on the web server then this is what
> > I see for each URL:
> >
> >         = URL /~matt/test/1/2/3 =
> >         the_request: GET /~matt/test/app.py/1/2/3 HTTP/1.1
> >         unparsed_uri: /~matt/test/app.py/1/2/3
> >         uri: /~matt/test/app.py/1/2/3
> >         filename: /home/matt/public_html/test/app.py
> >         path_info: /1/2/3
> >
> >         = /~matt/test/app.py/1/2/3 =
> >         the_request: GET /~matt/test/app.py/1/2/3 HTTP/1.1
> >         unparsed_uri: /~matt/test/app.py/1/2/3
> >         uri: /~matt/test/app.py/1/2/3
> >         filename: /home/matt/public_html/test/app.py
> >         path_info: /1/2/3
> >
> >         = /~matt/test/1/2/3 =
> >         the_request: GET /~matt/test/1/2/3 HTTP/1.1
> >         unparsed_uri: /~matt/test/1/2/3
> >         uri: /~matt/test/1/2/3
> >         filename: /home/matt/public_html/test/1
> >         path_info: /2/3
> >
> > The first two are as expected but the last one drops app.py completely
> > and thinks that the first element of path_info is part of the filename.
> >
> > Can anyone explain this?
> >
> > Server details:
> >
> > 	Apache 1.3.27
> > 	mod_python 2.7.8
> > 	Linux 2.4.x, Gentoo and Debian (I think).
> >
> > Thanks in advance.
> >
> > - Matt
> >
> > --
> > Matt Goodall, Pollenation Internet Ltd
> > w: http://www.pollenation.net
> > e: matt@pollenation.net
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
-- 
Matt Goodall, Pollenation Internet Ltd
w: http://www.pollenation.net
e: matt@pollenation.net
From grisha at modpython.org  Wed Jul  9 16:32:39 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:35 2004
Subject: [mod_python] missing path element in path_info
In-Reply-To: <1057779371.28628.484.camel@localhost>
References: <1057768526.27471.335.camel@localhost>
	<20030709130315.K99051@onyx.ispol.com>
	<1057779371.28628.484.camel@localhost>
Message-ID: <20030709160740.D600@onyx.ispol.com>



On Wed, 9 Jul 2003, Matt Goodall wrote:

> Is there actually a foolproof way of working out the correct base uri of
> the application (i.e. the path, with or without the app.py) from the
> information in the request alone? The results I would like are below but
> I'm not convinced enough information is available:
>
>   URL                        app base uri         path info
>   -------------------------  -------------------  ----------
>   /~matt/test/               /~matt/test          /
>   /~matt/test/app.py/1/2/3   /~matt/test/app.py   /1/2/3
>   /~matt/test/1/2/3          /~matt/test          /1/2/3

Hmm... This is a flawed question, since path_info in the last line is
really /2/3.

If you look at http://cgi-spec.golux.com/draft-coar-cgi-v11-03.txt section
6.1.6, it formally defines what path info is. However, it relies on the
notion of a "script", which is always present in CGI, but is meaningless
in mod_python since we're not running scripts but provide phase handlers
for apache...

Anyway, the answer to your question is that it is impossible or very
difficult to do, because the transformation from "~matt/test" to
"/home/matt/public_html/test" is not "reversible" and is hidden somewhere
in apache config, yet this mapping is necessary to produce the results
above.

Grisha
From matt at pollenation.net  Wed Jul  9 22:20:10 2003
From: matt at pollenation.net (Matt Goodall)
Date: Fri Jan  9 21:47:35 2004
Subject: [mod_python] missing path element in path_info
In-Reply-To: <20030709160740.D600@onyx.ispol.com>
References: <1057768526.27471.335.camel@localhost>
	<20030709130315.K99051@onyx.ispol.com>
	<20030709160740.D600@onyx.ispol.com>
Message-ID: <1057785610.27471.509.camel@localhost>

On Wed, 2003-07-09 at 21:32, Gregory (Grisha) Trubetskoy wrote:
> Anyway, the answer to your question is that it is impossible or very
> difficult to do, because the transformation from "~matt/test" to
> "/home/matt/public_html/test" is not "reversible" and is hidden somewhere
> in apache config, yet this mapping is necessary to produce the results
> above.

Thanks Grisha.

That's the conclusion I had come to from dumping anything available in
the request object to a log file, but it was worth checking here too.

Cheers, Matt

-- 
Matt Goodall, Pollenation Internet Ltd
w: http://www.pollenation.net
e: matt@pollenation.net
From jmartinson at info234.com  Thu Jul 10 17:00:03 2003
From: jmartinson at info234.com (Jacob Martinson)
Date: Fri Jan  9 21:47:35 2004
Subject: [mod_python] Problem with win32 installation - can't authenticate
Message-ID: <5.2.1.1.0.20030710135957.00b2f050@localhost>

My problem: after installing apache(win32), python(win32) and 
modpython(win32) the basic test works for returning 'hello world' but when 
i try the authentication example from the documentation, I am not able to 
authenticate.  After a little investigation, I find that both req.user and 
req.get_basic_auth_pw() are None.

I am prompted for username/password, but I can't authenticate 
successfully.  Also, if I ignore req.user and password and just return 
apache.OK, it allows me to access the file I am requesting.

Here's the relevant parts of my apache config:

LoadModule python_module modules/mod_python.so

<Directory "c:\Documents and Settings\jmartinson\docroot">
   AddHandler python-program .py
   PythonHandler mptest
   PythonDebug On
</Directory>

<Directory "c:\Documents and Settings\jmartinson\docroot\test1">
     AddHandler python-program .py
     PythonHandler myscript
     PythonAuthenHandler myscript
     PythonDebug Off
     AuthType Basic
     AuthName "Restricted Area"
     require valid-user
</Directory>

Here's my handler (myscript.py):

from mod_python import apache
def authenhandler(req):
         user = req.user
         pw = req.get_basic_auth_pw()
         req.write( str(user) + ':' + str(pw) + str('\n') )
         return apache.OK

         if user == "spam":
                 return apache.OK
         else:
                 return apache.HTTP_UNAUTHORIZED

I put in the first "return apache.OK" for testing purposes.  If I take that 
out authentication still won't work.  I also took out the second half of 
the if statement testing the password too.

Version info:
apache: 
http://apache.oregonstate.edu/httpd/binaries/win32/apache_2.0.47-win32-x86-no_ssl.msi
modpython: 
http://apache.webmeta.com/httpd/modpython/win/3.0.3/mod_python-3.0.3.win32.exe
python: http://python.org/ftp/python/2.2.3/Python-2.2.3.exe

I would much rather be using modpython under a unix environment, but I am 
doing this on my work laptop and I don't have the option of eliminating the 
Windows environment and I can't get apache to compile under cygwin.

Any information or suggestions are greatly appreciated!

-Jacob 

From grisha at modpython.org  Thu Jul 10 19:50:38 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:35 2004
Subject: [mod_python] Problem with win32 installation - can't authenticate
In-Reply-To: <5.2.1.1.0.20030710135957.00b2f050@localhost>
References: <5.2.1.1.0.20030710135957.00b2f050@localhost>
Message-ID: <20030710194534.K53265@onyx.ispol.com>



On Thu, 10 Jul 2003, Jacob Martinson wrote:

> I am prompted for username/password, but I can't authenticate
> successfully.  Also, if I ignore req.user and password and just return
> apache.OK, it allows me to access the file I am requesting.

When you say "can't authenticate" - does the browser come back with the
user/password dialog, or some other thing?

I just tried your example, and it worked for me.... In the old versions of
apache you had to call to call get_basic_auth_pw() before trying to read
value of req.user, but that's not longer true I think. May be tried
swapping those two lines, but I think the problem is elsewhere.

Grisha
From jmartinson at info234.com  Thu Jul 10 18:55:49 2003
From: jmartinson at info234.com (Jacob Martinson)
Date: Fri Jan  9 21:47:35 2004
Subject: [mod_python] Problem with win32 installation - can't
  authenticate
In-Reply-To: <20030710194534.K53265@onyx.ispol.com>
References: <5.2.1.1.0.20030710135957.00b2f050@localhost>
 <5.2.1.1.0.20030710135957.00b2f050@localhost>
Message-ID: <5.2.1.1.0.20030710185116.00b2ecd8@localhost>

Grisha,

The browser comes back with a prompt again a number of times and then 
eventually I end up at the access forbidden page.  The strangest thing just 
happened though... I switched the order of getting the username and 
password, and it started working!  I haven't changed anything in the apache 
config between then and now.

Thanks!

-Jacob

At 07:50 PM 7/10/2003 -0400, Gregory (Grisha) Trubetskoy wrote:


>On Thu, 10 Jul 2003, Jacob Martinson wrote:
>
> > I am prompted for username/password, but I can't authenticate
> > successfully.  Also, if I ignore req.user and password and just return
> > apache.OK, it allows me to access the file I am requesting.
>
>When you say "can't authenticate" - does the browser come back with the
>user/password dialog, or some other thing?
>
>I just tried your example, and it worked for me.... In the old versions of
>apache you had to call to call get_basic_auth_pw() before trying to read
>value of req.user, but that's not longer true I think. May be tried
>swapping those two lines, but I think the problem is elsewhere.
>
>Grisha

From grisha at modpython.org  Thu Jul 10 21:00:37 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:35 2004
Subject: [mod_python] Problem with win32 installation - can't
	authenticate
In-Reply-To: <5.2.1.1.0.20030710185116.00b2ecd8@localhost>
References: <5.2.1.1.0.20030710135957.00b2f050@localhost>
	<5.2.1.1.0.20030710185116.00b2ecd8@localhost>
Message-ID: <20030710205649.Y56783@onyx.ispol.com>


Thanks Jacob for the config -

I figured it out - it has to do with the placement of LoadModule in the
config file. I tend to put mine first, which makes mod_auth first in line
to process, and it internally calls get_basic_auth_pw() thereby filling in
the req.user value. But if you place mod_python after mod_auth, then
mod_python is called first, and req->user is NULL (or req.user is None).

I'll make sure this is corrected in the docs for the next release.

Grisha

On Thu, 10 Jul 2003, Jacob Martinson wrote:

> Grisha,
>
> The browser comes back with a prompt again a number of times and then
> eventually I end up at the access forbidden page.  The strangest thing just
> happened though... I switched the order of getting the username and
> password, and it started working!  I haven't changed anything in the apache
> config between then and now.
>
> Thanks!
>
> -Jacob
>
> At 07:50 PM 7/10/2003 -0400, Gregory (Grisha) Trubetskoy wrote:
>
>
> >On Thu, 10 Jul 2003, Jacob Martinson wrote:
> >
> > > I am prompted for username/password, but I can't authenticate
> > > successfully.  Also, if I ignore req.user and password and just return
> > > apache.OK, it allows me to access the file I am requesting.
> >
> >When you say "can't authenticate" - does the browser come back with the
> >user/password dialog, or some other thing?
> >
> >I just tried your example, and it worked for me.... In the old versions of
> >apache you had to call to call get_basic_auth_pw() before trying to read
> >value of req.user, but that's not longer true I think. May be tried
> >swapping those two lines, but I think the problem is elsewhere.
> >
> >Grisha
>
From jmartinson at info234.com  Thu Jul 10 20:02:22 2003
From: jmartinson at info234.com (Jacob Martinson)
Date: Fri Jan  9 21:47:35 2004
Subject: [mod_python] Problem with win32 installation - can't 
  authenticate
In-Reply-To: <20030710205649.Y56783@onyx.ispol.com>
References: <5.2.1.1.0.20030710185116.00b2ecd8@localhost>
 <5.2.1.1.0.20030710135957.00b2f050@localhost>
 <5.2.1.1.0.20030710135957.00b2f050@localhost>
 <5.2.1.1.0.20030710185116.00b2ecd8@localhost>
Message-ID: <5.2.1.1.0.20030710200107.00ba7598@localhost>

Thanks again for the excellent and fast response!!!

At 09:00 PM 7/10/2003 -0400, Gregory (Grisha) Trubetskoy wrote:

>Thanks Jacob for the config -
>
>I figured it out - it has to do with the placement of LoadModule in the
>config file. I tend to put mine first, which makes mod_auth first in line
>to process, and it internally calls get_basic_auth_pw() thereby filling in
>the req.user value. But if you place mod_python after mod_auth, then
>mod_python is called first, and req->user is NULL (or req.user is None).
>
>I'll make sure this is corrected in the docs for the next release.
>
>Grisha
>
>On Thu, 10 Jul 2003, Jacob Martinson wrote:
>
> > Grisha,
> >
> > The browser comes back with a prompt again a number of times and then
> > eventually I end up at the access forbidden page.  The strangest thing just
> > happened though... I switched the order of getting the username and
> > password, and it started working!  I haven't changed anything in the apache
> > config between then and now.
> >
> > Thanks!
> >
> > -Jacob
> >
> > At 07:50 PM 7/10/2003 -0400, Gregory (Grisha) Trubetskoy wrote:
> >
> >
> > >On Thu, 10 Jul 2003, Jacob Martinson wrote:
> > >
> > > > I am prompted for username/password, but I can't authenticate
> > > > successfully.  Also, if I ignore req.user and password and just return
> > > > apache.OK, it allows me to access the file I am requesting.
> > >
> > >When you say "can't authenticate" - does the browser come back with the
> > >user/password dialog, or some other thing?
> > >
> > >I just tried your example, and it worked for me.... In the old versions of
> > >apache you had to call to call get_basic_auth_pw() before trying to read
> > >value of req.user, but that's not longer true I think. May be tried
> > >swapping those two lines, but I think the problem is elsewhere.
> > >
> > >Grisha
> >

From dustin at ywlcs.org  Thu Jul 10 21:31:20 2003
From: dustin at ywlcs.org (Dustin Mitchell)
Date: Fri Jan  9 21:47:35 2004
Subject: [mod_python] Using shared memory to do global persistence
In-Reply-To: <20030710215743.V56783@onyx.ispol.com>
References: <200306250732.15699.jgardner@jonathangardner.net>
	<20030626183642.GB5652@lyra.org> <20030708153302.C69691@onyx.ispol.com>
	<20030710215743.V56783@onyx.ispol.com>
Message-ID: <20030711023119.GI18379@eleanor.internal.ywlcs.org>

On Thu, Jul 10, 2003 at 10:12:26PM -0400, Gregory (Grisha) Trubetskoy wrote:
> 1. Something using or similar to POSH. This would rule, but it's too much
> work. Posh also relies on it having the cotrol over forking(), which won't
> work in our situation (i think).

Wouldn't a child_init hook do the trick?  That would mean, however,
that all shared objects had to be created (in Python) before child
initializations..

Dustin

-- 

  Dustin Mitchell
  dustin@ywlcs.org/djmitche@alumni.uchicago.edu
  http://people.cs.uchicago.edu/~dustin/
From Denis.Walrave at trema.com  Fri Jul 11 19:04:12 2003
From: Denis.Walrave at trema.com (Denis Walrave)
Date: Fri Jan  9 21:47:35 2004
Subject: [mod_python] apache.py typo fix... ?
Message-ID: <2F520D7DB7B17E4E9EC4ADEC448778F4013B7A89@labsex1.corp.trema.com>

$Id: apache.py,v 1.68 2003/02/28 04:55:15 grisha Exp $

 

def restore_nocgi(sav_env, si, so):

    """ see setup_cgi() """

 

    osenv = os.environ

 

    # restore env

    for k in osenv.keys():

        del osenv[k]

    for k in sav_env:

        osenv[k] = env[k] ######## I would suggest 'sav_env[k]'

 

    sys.stdout = si

    sys.stdin = so

 

Denis Walrave

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20030711/2f640737/attachment.htm
From fitnah55 at hotmail.com  Wed Jul 16 11:49:00 2003
From: fitnah55 at hotmail.com (k d)
Date: Fri Jan  9 21:47:35 2004
Subject: [mod_python] 
	apache API and mod_python <-> protocol module integration
Message-ID: <BAY1-F124Z7fIZHO1g400002f0f@hotmail.com>

alright i'm just starting to look into this to see how feasable it is and 
what has to be done

if anyone has any comments on how the mod_python handler can be invoked 
through a protocol module such that the primary codebase of a particular 
application can be reused in multiple gateways, i'd appreciate it

basically what i'm looking at right now is a low level telnet protocol 
module that is reasonably transparent... that can be augmented to support 
full telnet, pop/3, imap, smtp, whatever... but that has sufficient design 
to invoke a mod_python handler, so that the pop/3 could be implemented in 
python, or whatever would be added on top.. (or potentially the pop/3 could 
be added directly to the protocol module)

the basic idea is that apache2 by default accepts http like connections, 
which aren't conducive to the synchronous communication of telnet..  
keep-alive is vaguely similar but not good enough for the purposes of 
allowing a telnet or pop/3 gateway

i've never looked at the apache2 api before so i'm just digging into that 
today

_________________________________________________________________
MSN 8 with e-mail virus protection service: 2 months FREE*  
http://join.msn.com/?page=features/virus

From azaroth at liverpool.ac.uk  Wed Jul 16 17:17:19 2003
From: azaroth at liverpool.ac.uk (Robert Sanderson)
Date: Fri Jan  9 21:47:35 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
 integration
In-Reply-To: <BAY1-F124Z7fIZHO1g400002f0f@hotmail.com>
Message-ID: <Pine.LNX.4.44.0307161709550.2478-100000@gondolin.hist.liv.ac.uk>


> the basic idea is that apache2 by default accepts http like connections, 
> which aren't conducive to the synchronous communication of telnet..  
> keep-alive is vaguely similar but not good enough for the purposes of 
> allowing a telnet or pop/3 gateway

Currently, as I found when implementing Z39.50, it's a real pain as 
there's no way to read in all available data, and if you try to read past 
the end of the available data the read will block.

This makes it useless for something like (say) an IRC or MUD style server 
where there might be data flowing in either direction at any given time.  
Mod_Perl on the other hand has a better system:
http://perl.apache.org/docs/2.0/user/handlers/protocols.html

When I get time, I'm going to look at how to implement this in mod_python, 
but that might not be for a while, so if anyone else wants to weigh in, 
please do so and let me know :)

Rob

-- 
      ,'/:.          Rob Sanderson (azaroth@liverpool.ac.uk)
    ,'-/::::.        http://www.o-r-g.org/~azaroth/
  ,'--/::(@)::.      Special Collections and Archives, extension 3142
,'---/::::::::::.    Nebmedes:  telnet: nebmedes.o-r-g.org 7777
____/:::::::::::::.                WWW:  http://nebmedes.o-r-g.org:8000/
I L L U M I N A T I

From dustin at ywlcs.org  Wed Jul 16 11:33:30 2003
From: dustin at ywlcs.org (Dustin Mitchell)
Date: Fri Jan  9 21:47:35 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
	integration
In-Reply-To: <Pine.LNX.4.44.0307161709550.2478-100000@gondolin.hist.liv.ac.uk>
References: <BAY1-F124Z7fIZHO1g400002f0f@hotmail.com>
	<Pine.LNX.4.44.0307161709550.2478-100000@gondolin.hist.liv.ac.uk>
Message-ID: <20030716163329.GQ18379@eleanor.internal.ywlcs.org>

On Wed, Jul 16, 2003 at 05:17:19PM +0100, Robert Sanderson wrote:
> 
> > the basic idea is that apache2 by default accepts http like connections, 
> > which aren't conducive to the synchronous communication of telnet..  
> > keep-alive is vaguely similar but not good enough for the purposes of 
> > allowing a telnet or pop/3 gateway

There's talk of doing exactly this over on the Apache-dev list (though
doing it in C).  Somebody produced a small DNS server in Apache for a
masters project (netairt -- very cool!) and the apache people had a
short discussion of supporting UDP and telnet-like connections just
like what you describe.  The upshot of this is that right now Apache
really don't support either of these types of connections, even in its
native C.

See the thread beginning:

 Messsage-ID: <Pine.GSO.4.53.0307142254390.25665@flits.cs.vu.nl>
 From: Michal Szymaniak <michal@cs.vu.nl>
 Subject: DNS+HTTP redirection system inside an Apache module

Dustin

-- 

  Dustin Mitchell
  dustin@ywlcs.org/djmitche@alumni.uchicago.edu
  http://people.cs.uchicago.edu/~dustin/
From grisha at modpython.org  Wed Jul 16 13:59:58 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:35 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
 integration
In-Reply-To: <Pine.LNX.4.44.0307161709550.2478-100000@gondolin.hist.liv.ac.uk>
References: <Pine.LNX.4.44.0307161709550.2478-100000@gondolin.hist.liv.ac.uk>
Message-ID: <20030716134923.B92465@onyx.ispol.com>



On Wed, 16 Jul 2003, Robert Sanderson wrote:

> > the basic idea is that apache2 by default accepts http like connections,
> > which aren't conducive to the synchronous communication of telnet..

There is an example of a simple echo module here:

http://www.modpython.org/live/current/doc-html/pyapi-conn.html

> > keep-alive is vaguely similar but not good enough for the purposes of
> > allowing a telnet or pop/3 gateway
>
> Currently, as I found when implementing Z39.50, it's a real pain as
> there's no way to read in all available data, and if you try to read past
> the end of the available data the read will block.

This is not a problem of mod_python or Apache, this is the way sockets
work. If your protocol is such that you know ahead of time how much to
read (e.g. HTTP), then you can request this much data in one read.
Otherwise, you must read in smallest unit sizes of your protocol, which
(I'm guessing) is 1 byte in case of Z39.50.

> This makes it useless for something like (say) an IRC or MUD style
> server where there might be data flowing in either direction at any
> given time.  Mod_Perl on the other hand has a better system:
> http://perl.apache.org/docs/2.0/user/handlers/protocols.html

Mod_perl doesn't do it any differently (unless I'm missing something). I
don't think implementing an IRC or MUD server in mod_perl is going to be
any different.

BTW, if using Apache is not a requirement, then doing something like this
might be easier in twisted (twistedmatrix.com).

Grisha
From dustin at ywlcs.org  Wed Jul 16 13:25:15 2003
From: dustin at ywlcs.org (Dustin Mitchell)
Date: Fri Jan  9 21:47:35 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
	integration
In-Reply-To: <20030716134923.B92465@onyx.ispol.com>
References: <Pine.LNX.4.44.0307161709550.2478-100000@gondolin.hist.liv.ac.uk>
	<20030716134923.B92465@onyx.ispol.com>
Message-ID: <20030716182515.GR18379@eleanor.internal.ywlcs.org>

On Wed, Jul 16, 2003 at 01:59:58PM -0400, Gregory (Grisha) Trubetskoy wrote:
> This is not a problem of mod_python or Apache, this is the way sockets
> work. If your protocol is such that you know ahead of time how much to
> read (e.g. HTTP), then you can request this much data in one read.
> Otherwise, you must read in smallest unit sizes of your protocol, which
> (I'm guessing) is 1 byte in case of Z39.50.

This is not strictly true, as long as you're OK with possibly getting a
bit of *extra* data beyond a particular PDU (a little bit of buffering
can take care of that).  Apache has to do this to read the HTTP header,
which is not of a fixed length.

The socket blocking read interface is structured such that it will block
when *no* data is available, and will return *up to* the quantity
specified in the recv() call if it is available.  However, if some
smaller amount of data is available, that data will be returned
immediately.

To demonstrate, I hacked this together:

from socket import *
s = socket(AF_INET, SOCK_STREAM)
s.bind(("", 9900))
s.listen(5)
while 1:
  ss, sa = s.accept()
  print "Connect from '%s'" % (sa,)
  while 1:
    data = ss.recv(100)
    if not data: break
    print " Received: %s" % `data`
  print "Connection closed from '%s'" % (sa,)

Then connected with telnet and typed "Hello" and "World" on separate
lines.  Telnet, by default, buffers lines of input until a newline, but
you will note that in the two returns from ss.recv(), neither contained
100 bytes of data:

Connect from '('127.0.0.1', 56260)'
 Received: 'Hello\r\n'
 Received: 'World\r\n'
Connection closed from '('127.0.0.1', 56260)'

Further, a loop such as:
  for i in 'hello world': s.send(i)
will produce output like this:

Connect from '('127.0.0.1', 56277)'
 Received: 'h'
 Received: 'ello world'
Connection closed from '('127.0.0.1', 56277)'

Either the client or the server's socket implementation is buffering the
characters because they're appearing so quickly, which cuts down on the
number of recv() calls which must be made.

I can't speak for the Apache sockets API, or the Python interface
thereto, but sockets themselves *do* support this interface (they'd be
pretty useless if they didn't!).  I highly recommend W. Richard
Stevens' TCP/IP Illustrated for an in-depth and very readable
discussion of this and many other crucial implementation details of
TCP/IP.

Dustin

-- 

  Dustin Mitchell
  dustin@ywlcs.org/djmitche@alumni.uchicago.edu
  http://people.cs.uchicago.edu/~dustin/
From fitnah55 at hotmail.com  Wed Jul 16 14:56:14 2003
From: fitnah55 at hotmail.com (k d)
Date: Fri Jan  9 21:47:35 2004
Subject: [mod_python] apache API and mod_python <-> protocol module
	integration
Message-ID: <BAY1-F40gNVRIbQlwhL0000bd01@hotmail.com>

>There is an example of a simple echo module here:
>
>http://www.modpython.org/live/current/doc-html/pyapi-conn.html

whoa... i totally forgot modpython had a connection handler

do you think its possible to get it to work with character mode input and 
proper display environment?  like a fully functional telnet not just a hack?

>BTW, if using Apache is not a requirement, then doing something like this
>might be easier in twisted (twistedmatrix.com).

yeh i checked out twisted but it's really heavy on stuff i don't need, plus 
the multiplexing and python persistency is a requirement, so 
apache2/modpython is a definite must have..

as far as implementing the protocol i can probably dupe code in twisted, but 
its not fully functional either so it'd just serve as a rough sketch to help 
with initial design

the only problems i really see that i might have are getting proper ascii 
transmission and getting hotkey capable character input

i'm super stoked that i don't have to deal with an apache2 protocol module 
to do it though! woohoo!

_________________________________________________________________
STOP MORE SPAM with the new MSN 8 and get 2 months FREE*  
http://join.msn.com/?page=features/junkmail

From chris at vindaloo.com  Wed Jul 16 14:58:49 2003
From: chris at vindaloo.com (Christopher Sean Hilton)
Date: Fri Jan  9 21:47:35 2004
Subject: [mod_python] Getting access to a file from a post.
In-Reply-To: <20030716134923.B92465@onyx.ispol.com>
References: <Pine.LNX.4.44.0307161709550.2478-100000@gondolin.hist.liv.ac.uk>
	<20030716134923.B92465@onyx.ispol.com>
Message-ID: <20030716185849.GA1129@dagobah.pvt.vindaloo.com>

-----BEGIN PGP SIGNED MESSAGE-----

I'm trying to generate an xml transaction handler using apache,
modpython, python and sax. I would like to be able to post a file to
this website/handler with something like curl and have modpython
process the file. Something like

     $ cat MyXmlFile.xml | \
     >   curl https://www.example.com/iface.py/XmlHandler

My python looks like this:

     $ cat /var/www/data/www.example.com/iface.py
     #! /usr/local/bin/python2.1
     
     from mod_python import apache

     def XmlHandler(req):
        XmlData = req.readlines()
        ...

This does not get the contens of the file that I posted, in fact it's
empty. Is there any way short of using traditional CGI of getting this
file?

Thanks in advance and if I'm missing something in the manual please
feel free to give me a poke that sets me in the right direction.

Chris

- -- 
Chris Hilton                                 chilton-at-vindaloo-dot-com
- ------------------------------------------------------------------------
                "All I was doing was trying to get home from work!"
                                                 -- Rosa Parks
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.1 (FreeBSD)

iQEVAwUBPxWgWILaxorQlXotAQE23Qf9Ec2xBSXHtX6JN9QSwocetyTrDqBecpto
5lkvq6YlwGF4M5Ei5eUBFjOmAo3OydM83zKMzdzJTgrlOOr6p/JmAxV0YH3qm7QI
+ON/vfoNDxVsPCeQPU/B1dEwkRdjtT2dMda68Ce8dG6go/1McKwUGxIm7/J4Qifs
Bt02IeGLhu+03VIfm03dROn95P3LxqiuTUXbHiQYky9k23ahQjZ8O3XXb+3fyYa4
E44ZG0O9T/H5Xig1rTrbAASao86HNolgnbKR2zNbivtOblgl/p1KSWofkqfRaLRz
JcT0jlSrQB1RvG2rZUz2qy1EPunZ2YUgS1gR+MmTJBmGTxYnIRCzJw==
=tbTY
-----END PGP SIGNATURE-----

From fitnah55 at hotmail.com  Wed Jul 16 17:00:43 2003
From: fitnah55 at hotmail.com (fitnah55)
Date: Fri Jan  9 21:47:35 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
	integration
In-Reply-To: <20030716134923.B92465@onyx.ispol.com>
Message-ID: <004c01c34bdd$521e02e0$24c0c20a@computer>


hey..

how do i get the connectionhandler to work properly under a virtual host
and/or
just for a particular port?

everything is running off of a single IP address through about 5 domains
and 20 virtual hosts..

i need telnet access potentially across all of the hosts

all of this from the single application framework




> -----Original Message-----
> From: Gregory (Grisha) Trubetskoy [mailto:grisha@modpython.org] 
> Sent: Wednesday, July 16, 2003 2:00 PM
> To: Robert Sanderson
> Cc: k d; mod_python@modpython.org
> Subject: Re: [mod_python] apache API and mod_python <-> 
> protocol module integration
> 
> 
> 
> 
> On Wed, 16 Jul 2003, Robert Sanderson wrote:
> 
> > > the basic idea is that apache2 by default accepts http 
> like connections,
> > > which aren't conducive to the synchronous communication 
> of telnet..
> 
> There is an example of a simple echo module here:
> 
http://www.modpython.org/live/current/doc-html/pyapi-conn.html

> > keep-alive is vaguely similar but not good enough for the purposes
of
> > allowing a telnet or pop/3 gateway
>
> Currently, as I found when implementing Z39.50, it's a real pain as
> there's no way to read in all available data, and if you try to read
past
> the end of the available data the read will block.

This is not a problem of mod_python or Apache, this is the way sockets
work. If your protocol is such that you know ahead of time how much to
read (e.g. HTTP), then you can request this much data in one read.
Otherwise, you must read in smallest unit sizes of your protocol, which
(I'm guessing) is 1 byte in case of Z39.50.

> This makes it useless for something like (say) an IRC or MUD style
> server where there might be data flowing in either direction at any
> given time.  Mod_Perl on the other hand has a better system:
> http://perl.apache.org/docs/2.0/user/handlers/protocols.html

Mod_perl doesn't do it any differently (unless I'm missing something). I
don't think implementing an IRC or MUD server in mod_perl is going to be
any different.

BTW, if using Apache is not a requirement, then doing something like
this
might be easier in twisted (twistedmatrix.com).

Grisha
From fitnah55 at hotmail.com  Wed Jul 16 17:09:50 2003
From: fitnah55 at hotmail.com (fitnah55)
Date: Fri Jan  9 21:47:35 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
	integration
In-Reply-To: <20030716134923.B92465@onyx.ispol.com>
Message-ID: <004d01c34bde$98310c40$24c0c20a@computer>


duh.. add the port to listen

heh

coincidentally, i don't think the echo example is working

[Tue Jul 15 13:03:18 2003] [error] python_connection:
ConnectionDispatch() returned nothing.

hmm

From grisha at modpython.org  Wed Jul 16 20:47:22 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:35 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
 integration
In-Reply-To: <20030716182515.GR18379@eleanor.internal.ywlcs.org>
References: <Pine.LNX.4.44.0307161709550.2478-100000@gondolin.hist.liv.ac.uk>
	<20030716182515.GR18379@eleanor.internal.ywlcs.org>
Message-ID: <20030716161514.Q95093@onyx.ispol.com>


Well, after some looking, apparently the APR does work this way, it's just
that the way the connection handler was coded probably because I didn't
understand APR well enough at the time I made it loop until specified
length of bytes was read (I started out with replicating req.read(), which
knows how much data there is to read).

I attached a patch to the connobject.c that changes its behaviour so that
read(len) will read at most len bytes, and will only block if no data is
available. And len is an optional argument.

Here is a connection handler code that does the exact same thing you had
below. (note that print writes to stdout, which is visible if you run
httpd with -X (stay in foreground) option:

from mod_python import apache

def connectionhandler(conn):

    print "Connect from '%s'" % `conn.remote_addr`

    while 1:
        data = conn.read()
        if not data: break
        print " Received: %s" % `data`

    print "Connection closed from '%s'" % `conn.remote_addr`

    return apache.OK

And here's the result:

$ ./bin/httpd -X
Connect from '('0.0.0.0', 3513)'
 Received: 'Hello\r\n'
 Received: 'World\r\n'
Connection closed from '('0.0.0.0', 3513)'

If I do 'for i in "Hello World"' thing, I get this:

Connect from '('0.0.0.0', 3524)'
 Received: 'Hello World'
Connection closed from '('0.0.0.0', 3524)'

Grisha

On Wed, 16 Jul 2003, Dustin Mitchell wrote:

> On Wed, Jul 16, 2003 at 01:59:58PM -0400, Gregory (Grisha) Trubetskoy wrote:
> > This is not a problem of mod_python or Apache, this is the way sockets
> > work. If your protocol is such that you know ahead of time how much to
> > read (e.g. HTTP), then you can request this much data in one read.
> > Otherwise, you must read in smallest unit sizes of your protocol, which
> > (I'm guessing) is 1 byte in case of Z39.50.
>
> This is not strictly true, as long as you're OK with possibly getting a
> bit of *extra* data beyond a particular PDU (a little bit of buffering
> can take care of that).  Apache has to do this to read the HTTP header,
> which is not of a fixed length.
>
> The socket blocking read interface is structured such that it will block
> when *no* data is available, and will return *up to* the quantity
> specified in the recv() call if it is available.  However, if some
> smaller amount of data is available, that data will be returned
> immediately.
>
> To demonstrate, I hacked this together:
>
> from socket import *
> s = socket(AF_INET, SOCK_STREAM)
> s.bind(("", 9900))
> s.listen(5)
> while 1:
>   ss, sa = s.accept()
>   print "Connect from '%s'" % (sa,)
>   while 1:
>     data = ss.recv(100)
>     if not data: break
>     print " Received: %s" % `data`
>   print "Connection closed from '%s'" % (sa,)
>
> Then connected with telnet and typed "Hello" and "World" on separate
> lines.  Telnet, by default, buffers lines of input until a newline, but
> you will note that in the two returns from ss.recv(), neither contained
> 100 bytes of data:
>
> Connect from '('127.0.0.1', 56260)'
>  Received: 'Hello\r\n'
>  Received: 'World\r\n'
> Connection closed from '('127.0.0.1', 56260)'
>
> Further, a loop such as:
>   for i in 'hello world': s.send(i)
> will produce output like this:
>
> Connect from '('127.0.0.1', 56277)'
>  Received: 'h'
>  Received: 'ello world'
> Connection closed from '('127.0.0.1', 56277)'
>
> Either the client or the server's socket implementation is buffering the
> characters because they're appearing so quickly, which cuts down on the
> number of recv() calls which must be made.
>
> I can't speak for the Apache sockets API, or the Python interface
> thereto, but sockets themselves *do* support this interface (they'd be
> pretty useless if they didn't!).  I highly recommend W. Richard
> Stevens' TCP/IP Illustrated for an in-depth and very readable
> discussion of this and many other crucial implementation details of
> TCP/IP.
>
> Dustin
>
> --
>
>   Dustin Mitchell
>   dustin@ywlcs.org/djmitche@alumni.uchicago.edu
>   http://people.cs.uchicago.edu/~dustin/
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
-------------- next part --------------
Index: connobject.c
===================================================================
RCS file: /home/cvs/httpd-python/src/connobject.c,v
retrieving revision 1.14
diff -u -r1.14 connobject.c
--- connobject.c	23 Jan 2003 22:34:18 -0000	1.14
+++ connobject.c	17 Jul 2003 00:35:28 -0000
@@ -113,8 +113,10 @@
 
     bb = apr_brigade_create(c->pool, c->bucket_alloc);
 
+    bufsize = len == 0 ? HUGE_STRING_LEN : len;
+
     Py_BEGIN_ALLOW_THREADS;
-    rc = ap_get_brigade(c->input_filters, bb, mode, APR_BLOCK_READ, len);
+    rc = ap_get_brigade(c->input_filters, bb, mode, APR_BLOCK_READ, bufsize);
     Py_END_ALLOW_THREADS;
 
     if (! APR_STATUS_IS_SUCCESS(rc)) {
@@ -135,7 +137,6 @@
         return Py_None;
     }
 
-    bufsize = len == 0 ? HUGE_STRING_LEN : len;
     result = PyString_FromStringAndSize(NULL, bufsize);
 
     /* possibly no more memory */
@@ -180,7 +181,7 @@
 	}
 
 
-        if (mode == AP_MODE_GETLINE) {
+        if (mode == AP_MODE_GETLINE || len == 0) {
             apr_bucket_delete(b);
             break;
         }
@@ -208,11 +209,8 @@
 
     long len = 0;
 
-    if (! PyArg_ParseTuple(args, "l|i", &len)) 
+    if (! PyArg_ParseTuple(args, "|l", &len)) 
         return NULL;
-
-    if (len == 0)
-        return PyString_FromString("");
 
     if (len == -1)
         return _conn_read(self->conn, AP_MODE_EXHAUSTIVE, 0);
From fitnah55 at hotmail.com  Wed Jul 16 21:17:04 2003
From: fitnah55 at hotmail.com (fitnah55)
Date: Fri Jan  9 21:47:35 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
	integration
In-Reply-To: <20030716161514.Q95093@onyx.ispol.com>
Message-ID: <005501c34c01$21dc7480$24c0c20a@computer>


hey i really appreciate it i'll check this out, i think mine is screwed
somehow though, as i can't get it to deal with a connection handler at
all

> I attached a patch to the connobject.c that changes its behaviour so
that
> read(len) will read at most len bytes, and will only block if no data
is
> available. And len is an optional argument.
From fitnah55 at hotmail.com  Wed Jul 16 22:01:36 2003
From: fitnah55 at hotmail.com (fitnah55)
Date: Fri Jan  9 21:47:35 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
	integration
In-Reply-To: <20030716161514.Q95093@onyx.ispol.com>
Message-ID: <005a01c34c07$5a7f4c80$24c0c20a@computer>


alright i just added the patch to my build directory.. and it wouldn't
compile.  OKAY.  what is the freakin point of maintaining an accurate
build archive if the freakin thing gets attacked by gremlins??

okay so i tossed the original build (which without a doubt has not been
changed by any legitimate or accidental work of my own on a machine that
isn't accessable from remote), untarred the same archive, patched,
rebuilt,
no problem... damn gremlins

BUT

i'm still getting the same error with the actual connection test...

any ideas?

[Tue Jul 15 17:56:44 2003] [error] python_connection:
ConnectionDispatch() returned nothing.


> -----Original Message-----
> From: mod_python-bounces@modpython.org 
> [mailto:mod_python-bounces@modpython.org] On Behalf Of 
> Gregory (Grisha) Trubetskoy
> Sent: Wednesday, July 16, 2003 8:47 PM
> To: Dustin Mitchell
> Cc: mod_python@modpython.org
> Subject: Re: [mod_python] apache API and mod_python <-> 
> protocol module integration
> 
> 
> 
> Well, after some looking, apparently the APR does work this 
> way, it's just
> that the way the connection handler was coded probably 
> because I didn't
> understand APR well enough at the time I made it loop until specified
> length of bytes was read (I started out with replicating 
> req.read(), which
> knows how much data there is to read).
> 
> I attached a patch to the connobject.c that changes its 
> behaviour so that
> read(len) will read at most len bytes, and will only block if 
> no data is
> available. And len is an optional argument.
> 
> Here is a connection handler code that does the exact same 
> thing you had
> below. (note that print writes to stdout, which is visible if you run
> httpd with -X (stay in foreground) option:
> 
> from mod_python import apache
> 
> def connectionhandler(conn):
> 
>     print "Connect from '%s'" % `conn.remote_addr`
> 
>     while 1:
>         data = conn.read()
>         if not data: break
>         print " Received: %s" % `data`
> 
>     print "Connection closed from '%s'" % `conn.remote_addr`
> 
>     return apache.OK
> 
> And here's the result:
> 
> $ ./bin/httpd -X
> Connect from '('0.0.0.0', 3513)'
>  Received: 'Hello\r\n'
>  Received: 'World\r\n'
> Connection closed from '('0.0.0.0', 3513)'
> 
> If I do 'for i in "Hello World"' thing, I get this:
> 
> Connect from '('0.0.0.0', 3524)'
>  Received: 'Hello World'
> Connection closed from '('0.0.0.0', 3524)'
> 
> Grisha
> 
> On Wed, 16 Jul 2003, Dustin Mitchell wrote:
> 
> > On Wed, Jul 16, 2003 at 01:59:58PM -0400, Gregory (Grisha) 
> Trubetskoy wrote:
> > > This is not a problem of mod_python or Apache, this is 
> the way sockets
> > > work. If your protocol is such that you know ahead of 
> time how much to
> > > read (e.g. HTTP), then you can request this much data in one read.
> > > Otherwise, you must read in smallest unit sizes of your 
> protocol, which
> > > (I'm guessing) is 1 byte in case of Z39.50.
> >
> > This is not strictly true, as long as you're OK with 
> possibly getting a
> > bit of *extra* data beyond a particular PDU (a little bit 
> of buffering
> > can take care of that).  Apache has to do this to read the 
> HTTP header,
> > which is not of a fixed length.
> >
> > The socket blocking read interface is structured such that 
> it will block
> > when *no* data is available, and will return *up to* the quantity
> > specified in the recv() call if it is available.  However, if some
> > smaller amount of data is available, that data will be returned
> > immediately.
> >
> > To demonstrate, I hacked this together:
> >
> > from socket import *
> > s = socket(AF_INET, SOCK_STREAM)
> > s.bind(("", 9900))
> > s.listen(5)
> > while 1:
> >   ss, sa = s.accept()
> >   print "Connect from '%s'" % (sa,)
> >   while 1:
> >     data = ss.recv(100)
> >     if not data: break
> >     print " Received: %s" % `data`
> >   print "Connection closed from '%s'" % (sa,)
> >
> > Then connected with telnet and typed "Hello" and "World" on separate
> > lines.  Telnet, by default, buffers lines of input until a 
> newline, but
> > you will note that in the two returns from ss.recv(), 
> neither contained
> > 100 bytes of data:
> >
> > Connect from '('127.0.0.1', 56260)'
> >  Received: 'Hello\r\n'
> >  Received: 'World\r\n'
> > Connection closed from '('127.0.0.1', 56260)'
> >
> > Further, a loop such as:
> >   for i in 'hello world': s.send(i)
> > will produce output like this:
> >
> > Connect from '('127.0.0.1', 56277)'
> >  Received: 'h'
> >  Received: 'ello world'
> > Connection closed from '('127.0.0.1', 56277)'
> >
> > Either the client or the server's socket implementation is 
> buffering the
> > characters because they're appearing so quickly, which cuts 
> down on the
> > number of recv() calls which must be made.
> >
> > I can't speak for the Apache sockets API, or the Python interface
> > thereto, but sockets themselves *do* support this interface 
> (they'd be
> > pretty useless if they didn't!).  I highly recommend W. Richard
> > Stevens' TCP/IP Illustrated for an in-depth and very readable
> > discussion of this and many other crucial implementation details of
> > TCP/IP.
> >
> > Dustin
> >
> > --
> >
> >   Dustin Mitchell
> >   dustin@ywlcs.org/djmitche@alumni.uchicago.edu
> >   http://people.cs.uchicago.edu/~dustin/
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
> 
From grisha at modpython.org  Wed Jul 16 23:20:22 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:35 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
 integration
In-Reply-To: <004d01c34bde$98310c40$24c0c20a@computer>
References: <004d01c34bde$98310c40$24c0c20a@computer>
Message-ID: <20030716231830.N5431@onyx.ispol.com>


There is some sort of an error in your code, but because of a bug that was
fixed earlier your mod_python doesn't log the error in the log correctly.

Attached is another patch, this time to apache.py, that should log the
error correctly.

Grisha

On Wed, 16 Jul 2003, fitnah55 wrote:

>
> duh.. add the port to listen
>
> heh
>
> coincidentally, i don't think the echo example is working
>
> [Tue Jul 15 13:03:18 2003] [error] python_connection:
> ConnectionDispatch() returned nothing.
>
> hmm
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
-------------- next part --------------
--- apache.py	12 Jul 2003 02:40:45 -0000	1.70
+++ apache.py	16 Jul 2003 20:23:24 -0000	1.71
@@ -54,7 +54,7 @@
  #
  # Originally developed by Gregory Trubetskoy.
  #
- # $Id: apache.py,v 1.70 2003/07/12 02:40:45 grisha Exp $
+ # $Id: apache.py,v 1.71 2003/07/16 20:23:24 grisha Exp $
 
 import sys
 import traceback
@@ -103,7 +103,7 @@
         try:
 
             handler = conn.hlist.handler
-            
+
             # split module::handler
             l = handler.split('::', 1)
             module_name = l[0]
@@ -115,7 +115,7 @@
 
             # add the directory to pythonpath if
             # not there yet, or pythonpath specified
-            
+
             if config.has_key("PythonPath"):
                 # we want to do as little evaling as possible,
                 # so we remember the path in un-evaled form and
@@ -161,7 +161,8 @@
             try:
                 exc_type, exc_value, exc_traceback = sys.exc_info()
                 result = self.ReportError(exc_type, exc_value, exc_traceback, srv=conn.base_server,
-                                          phase=filter.name, hname=handler, debug=debug)
+                                          phase="ConnectionHandler",
+                                          hname=handler, debug=debug)
             finally:
                 exc_traceback = None
 
From chris at vindaloo.com  Wed Jul 16 14:58:49 2003
From: chris at vindaloo.com (Christopher Sean Hilton)
Date: Fri Jan  9 21:47:35 2004
Subject: [mod_python] Getting access to a file from a post.
In-Reply-To: <20030716134923.B92465@onyx.ispol.com>
References: <Pine.LNX.4.44.0307161709550.2478-100000@gondolin.hist.liv.ac.uk>
	<20030716134923.B92465@onyx.ispol.com>
Message-ID: <20030716185849.GA1129@dagobah.pvt.vindaloo.com>

-----BEGIN PGP SIGNED MESSAGE-----

I'm trying to generate an xml transaction handler using apache,
modpython, python and sax. I would like to be able to post a file to
this website/handler with something like curl and have modpython
process the file. Something like

     $ cat MyXmlFile.xml | \
     >   curl https://www.example.com/iface.py/XmlHandler

My python looks like this:

     $ cat /var/www/data/www.example.com/iface.py
     #! /usr/local/bin/python2.1
     
     from mod_python import apache

     def XmlHandler(req):
        XmlData = req.readlines()
        ...

This does not get the contens of the file that I posted, in fact it's
empty. Is there any way short of using traditional CGI of getting this
file?

Thanks in advance and if I'm missing something in the manual please
feel free to give me a poke that sets me in the right direction.

Chris

- -- 
Chris Hilton                                 chilton-at-vindaloo-dot-com
- ------------------------------------------------------------------------
                "All I was doing was trying to get home from work!"
                                                 -- Rosa Parks
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.1 (FreeBSD)

iQEVAwUBPxWgWILaxorQlXotAQE23Qf9Ec2xBSXHtX6JN9QSwocetyTrDqBecpto
5lkvq6YlwGF4M5Ei5eUBFjOmAo3OydM83zKMzdzJTgrlOOr6p/JmAxV0YH3qm7QI
+ON/vfoNDxVsPCeQPU/B1dEwkRdjtT2dMda68Ce8dG6go/1McKwUGxIm7/J4Qifs
Bt02IeGLhu+03VIfm03dROn95P3LxqiuTUXbHiQYky9k23ahQjZ8O3XXb+3fyYa4
E44ZG0O9T/H5Xig1rTrbAASao86HNolgnbKR2zNbivtOblgl/p1KSWofkqfRaLRz
JcT0jlSrQB1RvG2rZUz2qy1EPunZ2YUgS1gR+MmTJBmGTxYnIRCzJw==
=tbTY
-----END PGP SIGNATURE-----

From azaroth at liverpool.ac.uk  Thu Jul 17 11:57:18 2003
From: azaroth at liverpool.ac.uk (Robert Sanderson)
Date: Fri Jan  9 21:47:35 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
 integration
In-Reply-To: <20030716161514.Q95093@onyx.ispol.com>
Message-ID: <Pine.LNX.4.44.0307171155380.6759-100000@gondolin.hist.liv.ac.uk>


> I attached a patch to the connobject.c that changes its behaviour so that
> read(len) will read at most len bytes, and will only block if no data is
> available. And len is an optional argument.

Great stuff, thanks for this Grisha.  It really is useful to us :)

Rob

-- 
      ,'/:.          Rob Sanderson (azaroth@liverpool.ac.uk)
    ,'-/::::.        http://www.o-r-g.org/~azaroth/
  ,'--/::(@)::.      Special Collections and Archives, extension 3142
,'---/::::::::::.    Nebmedes:  telnet: nebmedes.o-r-g.org 7777
____/:::::::::::::.                WWW:  http://nebmedes.o-r-g.org:8000/
I L L U M I N A T I

From chris at vindaloo.com  Thu Jul 17 09:09:54 2003
From: chris at vindaloo.com (Christopher Sean Hilton)
Date: Fri Jan  9 21:47:35 2004
Subject: [mod_python] Getting access to a file from a post.
In-Reply-To: <20030717034737.GZ18379@eleanor.internal.ywlcs.org>
References: <Pine.LNX.4.44.0307161709550.2478-100000@gondolin.hist.liv.ac.uk>
	<20030716134923.B92465@onyx.ispol.com>
	<20030716185849.GA1129@dagobah.pvt.vindaloo.com>
	<20030717034737.GZ18379@eleanor.internal.ywlcs.org>
Message-ID: <20030717130954.GA526@dagobah.pvt.vindaloo.com>

On Wed, Jul 16, 2003 at 10:47:37PM -0500, Dustin Mitchell wrote:

[snip]

> 
> If I'm not mistaken, you're using the publisher handler for this, and
> curl will generate a POST request.  Publisher, by virtue of using
> util.FieldStorage, will try to read that POST data as form data
> (depending on the content-type; it might just throw up a
> NOT_IMPLEMENTED). 
> 
> So the long and short of it is that publisher will gobble your request
> body, because publisher is intended to talk to a web browser, which
> only sends a certain kind of data there (form data).  If you'd like to
> parse some other format of request body, you'll have to forgo publisher
> and do that in a native handler.  That handler could look very much like
> what you've got:
> 
> # note the name 'handler' is mandatory
> def handler(req):
>   XmlData = req.readlines() # are you sure you want a list of lines?
>   ...
> 
> and in your Apache config,
> 
>   PythonHandler iface
> 
> Hope this helps.  Hope I'm right.  Please correct me if I am not.
> 

The assumption that I'm using the Publisher is correct. I will try the
code I have against the native handler this morning and post my
results to the list.

Thanks
 - Chris

-- 
Chris Hilton                                 chilton-at-vindaloo-dot-com
------------------------------------------------------------------------
                "All I was doing was trying to get home from work!"
                                                 -- Rosa Parks
From fitnah55 at hotmail.com  Thu Jul 17 11:30:15 2003
From: fitnah55 at hotmail.com (fitnah55)
Date: Fri Jan  9 21:47:35 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
	integration
In-Reply-To: <20030716231830.N5431@onyx.ispol.com>
Message-ID: <000301c34c78$52215ad0$24c0c20a@computer>


path problem.. couldn't specify that the connection handler was in a
specific
place, so i added a blah.pth file to site-packages pointing to the lib
directory of the host..

i can actually run the virtual host without specifying a documentroot so
i
guess that works out fine

but i'm not so sure canonical name type name based virtual hosts will
work
with this as is though?

i think right now using the virtual host directive is essentially just
giving
it its own error log

i can actually start developing a rudimentary design now though so
that's
pretty cool... it took a lot less effort than i thought when i first
started
looking into it


> -----Original Message-----
> From: Gregory (Grisha) Trubetskoy [mailto:grisha@modpython.org] 
> Sent: Wednesday, July 16, 2003 11:20 PM
> To: fitnah55
> Cc: mod_python@modpython.org
> Subject: RE: [mod_python] apache API and mod_python <-> 
> protocol module integration
> 
> 
> 
> There is some sort of an error in your code, but because of a 
> bug that was
> fixed earlier your mod_python doesn't log the error in the 
> log correctly.
> 
> Attached is another patch, this time to apache.py, that should log the
> error correctly.
> 
> Grisha
> 
> On Wed, 16 Jul 2003, fitnah55 wrote:
> 
> >
> > duh.. add the port to listen
> >
> > heh
> >
> > coincidentally, i don't think the echo example is working
> >
> > [Tue Jul 15 13:03:18 2003] [error] python_connection:
> > ConnectionDispatch() returned nothing.
> >
> > hmm
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
> 
From grisha at modpython.org  Thu Jul 17 11:47:13 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:36 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
 integration
In-Reply-To: <000301c34c78$52215ad0$24c0c20a@computer>
References: <000301c34c78$52215ad0$24c0c20a@computer>
Message-ID: <20030717114409.V19822@onyx.ispol.com>



On Thu, 17 Jul 2003, fitnah55 wrote:

> but i'm not so sure canonical name type name based virtual hosts will
> work with this as is though?

Name-based hosts certainly will not work because the name comes from the
Host: header, but we're not at the HTTP level here.

> i think right now using the virtual host directive is essentially just
> giving it its own error log

It's more than that, it will let you associate a connection handler with a
particular ip:port.

> i can actually start developing a rudimentary design now though so
> that's pretty cool... it took a lot less effort than i thought when i
> first started looking into it

That's good to know!

Grisha

>
>
> > -----Original Message-----
> > From: Gregory (Grisha) Trubetskoy [mailto:grisha@modpython.org]
> > Sent: Wednesday, July 16, 2003 11:20 PM
> > To: fitnah55
> > Cc: mod_python@modpython.org
> > Subject: RE: [mod_python] apache API and mod_python <->
> > protocol module integration
> >
> >
> >
> > There is some sort of an error in your code, but because of a
> > bug that was
> > fixed earlier your mod_python doesn't log the error in the
> > log correctly.
> >
> > Attached is another patch, this time to apache.py, that should log the
> > error correctly.
> >
> > Grisha
> >
> > On Wed, 16 Jul 2003, fitnah55 wrote:
> >
> > >
> > > duh.. add the port to listen
> > >
> > > heh
> > >
> > > coincidentally, i don't think the echo example is working
> > >
> > > [Tue Jul 15 13:03:18 2003] [error] python_connection:
> > > ConnectionDispatch() returned nothing.
> > >
> > > hmm
> > >
> > > _______________________________________________
> > > Mod_python mailing list
> > > Mod_python@modpython.org
> > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > >
> >
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From azaroth at liverpool.ac.uk  Thu Jul 17 17:18:45 2003
From: azaroth at liverpool.ac.uk (Robert Sanderson)
Date: Fri Jan  9 21:47:36 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
 integration
In-Reply-To: <000301c34c78$52215ad0$24c0c20a@computer>
Message-ID: <Pine.LNX.4.44.0307171710380.11776-100000@gondolin.hist.liv.ac.uk>


You can check the address it was received on and decline to handle 
anything received on the wrong port. Then it'll fall through to the 
normal handlers.

For example:

def connectionhandler(conn):
  if (conn.local_addr[0] != SERVER_IP or conn.local_addr[1] != SERVER_PORT):
    return apache.DECLINED
  elif (conn.base_server.server_hostname != SERVER_NAME):
    return apache.DECLINED
  else:
    # XXX do everything here

  return apache.OK


Also look at conn.base_server for the server object's other bits and 
pieces.

http://www.modpython.org/live/current/doc-html/pyapi-mpconn-mem.html
http://www.modpython.org/live/current/doc-html/pyapi-mpsrv-mem.html

Rob


On Thu, 17 Jul 2003, fitnah55 wrote:

> 
> path problem.. couldn't specify that the connection handler was in a
> specific
> place, so i added a blah.pth file to site-packages pointing to the lib
> directory of the host..
> 
> i can actually run the virtual host without specifying a documentroot so
> i
> guess that works out fine
> 
> but i'm not so sure canonical name type name based virtual hosts will
> work
> with this as is though?
> 
> i think right now using the virtual host directive is essentially just
> giving
> it its own error log
> 
> i can actually start developing a rudimentary design now though so
> that's
> pretty cool... it took a lot less effort than i thought when i first
> started
> looking into it
> 
> 
> > -----Original Message-----
> > From: Gregory (Grisha) Trubetskoy [mailto:grisha@modpython.org] 
> > Sent: Wednesday, July 16, 2003 11:20 PM
> > To: fitnah55
> > Cc: mod_python@modpython.org
> > Subject: RE: [mod_python] apache API and mod_python <-> 
> > protocol module integration
> > 
> > 
> > 
> > There is some sort of an error in your code, but because of a 
> > bug that was
> > fixed earlier your mod_python doesn't log the error in the 
> > log correctly.
> > 
> > Attached is another patch, this time to apache.py, that should log the
> > error correctly.
> > 
> > Grisha
> > 
> > On Wed, 16 Jul 2003, fitnah55 wrote:
> > 
> > >
> > > duh.. add the port to listen
> > >
> > > heh
> > >
> > > coincidentally, i don't think the echo example is working
> > >
> > > [Tue Jul 15 13:03:18 2003] [error] python_connection:
> > > ConnectionDispatch() returned nothing.
> > >
> > > hmm
> > >
> > > _______________________________________________
> > > Mod_python mailing list
> > > Mod_python@modpython.org
> > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > >
> > 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 

-- 
      ,'/:.          Rob Sanderson (azaroth@liverpool.ac.uk)
    ,'-/::::.        http://www.o-r-g.org/~azaroth/
  ,'--/::(@)::.      Special Collections and Archives, extension 3142
,'---/::::::::::.    Nebmedes:  telnet: nebmedes.o-r-g.org 7777
____/:::::::::::::.                WWW:  http://nebmedes.o-r-g.org:8000/
I L L U M I N A T I

From grisha at modpython.org  Thu Jul 17 13:09:08 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:36 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
 integration
In-Reply-To: <Pine.LNX.4.44.0307171710380.11776-100000@gondolin.hist.liv.ac.uk>
References: <Pine.LNX.4.44.0307171710380.11776-100000@gondolin.hist.liv.ac.uk>
Message-ID: <20030717130605.V19963@onyx.ispol.com>


I think this is unnecessary. Something like this in the config will make
your handler listen on 1.1.1.1:8888 only:

Listen 2.2.2.2:80
Listen 1.1.1.1:8888

<VirtualHost 1.1.1.1:8888>

	PythonConnectionHandler blah
	...

</VirtualHost>


On Thu, 17 Jul 2003, Robert Sanderson wrote:

>
> You can check the address it was received on and decline to handle
> anything received on the wrong port. Then it'll fall through to the
> normal handlers.
>
> For example:
>
> def connectionhandler(conn):
>   if (conn.local_addr[0] != SERVER_IP or conn.local_addr[1] != SERVER_PORT):
>     return apache.DECLINED
>   elif (conn.base_server.server_hostname != SERVER_NAME):
>     return apache.DECLINED
>   else:
>     # XXX do everything here
>
>   return apache.OK
>
>
> Also look at conn.base_server for the server object's other bits and
> pieces.
>
> http://www.modpython.org/live/current/doc-html/pyapi-mpconn-mem.html
> http://www.modpython.org/live/current/doc-html/pyapi-mpsrv-mem.html
>
> Rob
>
>
> On Thu, 17 Jul 2003, fitnah55 wrote:
>
> >
> > path problem.. couldn't specify that the connection handler was in a
> > specific
> > place, so i added a blah.pth file to site-packages pointing to the lib
> > directory of the host..
> >
> > i can actually run the virtual host without specifying a documentroot so
> > i
> > guess that works out fine
> >
> > but i'm not so sure canonical name type name based virtual hosts will
> > work
> > with this as is though?
> >
> > i think right now using the virtual host directive is essentially just
> > giving
> > it its own error log
> >
> > i can actually start developing a rudimentary design now though so
> > that's
> > pretty cool... it took a lot less effort than i thought when i first
> > started
> > looking into it
> >
> >
> > > -----Original Message-----
> > > From: Gregory (Grisha) Trubetskoy [mailto:grisha@modpython.org]
> > > Sent: Wednesday, July 16, 2003 11:20 PM
> > > To: fitnah55
> > > Cc: mod_python@modpython.org
> > > Subject: RE: [mod_python] apache API and mod_python <->
> > > protocol module integration
> > >
> > >
> > >
> > > There is some sort of an error in your code, but because of a
> > > bug that was
> > > fixed earlier your mod_python doesn't log the error in the
> > > log correctly.
> > >
> > > Attached is another patch, this time to apache.py, that should log the
> > > error correctly.
> > >
> > > Grisha
> > >
> > > On Wed, 16 Jul 2003, fitnah55 wrote:
> > >
> > > >
> > > > duh.. add the port to listen
> > > >
> > > > heh
> > > >
> > > > coincidentally, i don't think the echo example is working
> > > >
> > > > [Tue Jul 15 13:03:18 2003] [error] python_connection:
> > > > ConnectionDispatch() returned nothing.
> > > >
> > > > hmm
> > > >
> > > > _______________________________________________
> > > > Mod_python mailing list
> > > > Mod_python@modpython.org
> > > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > > >
> > >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
>
> --
>       ,'/:.          Rob Sanderson (azaroth@liverpool.ac.uk)
>     ,'-/::::.        http://www.o-r-g.org/~azaroth/
>   ,'--/::(@)::.      Special Collections and Archives, extension 3142
> ,'---/::::::::::.    Nebmedes:  telnet: nebmedes.o-r-g.org 7777
> ____/:::::::::::::.                WWW:  http://nebmedes.o-r-g.org:8000/
> I L L U M I N A T I
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From fitnah55 at hotmail.com  Thu Jul 17 13:14:53 2003
From: fitnah55 at hotmail.com (fitnah55)
Date: Fri Jan  9 21:47:36 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
	integration
In-Reply-To: <20030717130605.V19963@onyx.ispol.com>
Message-ID: <000a01c34c86$efe09f70$24c0c20a@computer>


doesn't really help if the box only has one IP..  IPv6 isn't a
reality yet, and IPs are extremely expensive

i don't think there's any viable solution without changing the
telnet protocol *erk*


> I think this is unnecessary. Something like this in the 
> config will make
> your handler listen on 1.1.1.1:8888 only:
> 
> Listen 2.2.2.2:80
> Listen 1.1.1.1:8888
> 
> <VirtualHost 1.1.1.1:8888>
> 
> 	PythonConnectionHandler blah
> 	...
> 
> </VirtualHost>
> 
> 
> On Thu, 17 Jul 2003, Robert Sanderson wrote:
> 
> >
> > You can check the address it was received on and decline to handle
> > anything received on the wrong port. Then it'll fall through to the
> > normal handlers.
> >
> > For example:
> >
> > def connectionhandler(conn):
> >   if (conn.local_addr[0] != SERVER_IP or conn.local_addr[1] 
> != SERVER_PORT):
> >     return apache.DECLINED
> >   elif (conn.base_server.server_hostname != SERVER_NAME):
> >     return apache.DECLINED
> >   else:
> >     # XXX do everything here
> >
> >   return apache.OK
> >
> >
> > Also look at conn.base_server for the server object's other bits and
> > pieces.
> >
> > http://www.modpython.org/live/current/doc-html/pyapi-mpconn-mem.html
> > http://www.modpython.org/live/current/doc-html/pyapi-mpsrv-mem.html
> >
> > Rob
> >
> >
> > On Thu, 17 Jul 2003, fitnah55 wrote:
> >
> > >
> > > path problem.. couldn't specify that the connection 
> handler was in a
> > > specific
> > > place, so i added a blah.pth file to site-packages 
> pointing to the lib
> > > directory of the host..
> > >
> > > i can actually run the virtual host without specifying a 
> documentroot so
> > > i
> > > guess that works out fine
> > >
> > > but i'm not so sure canonical name type name based 
> virtual hosts will
> > > work
> > > with this as is though?
> > >
> > > i think right now using the virtual host directive is 
> essentially just
> > > giving
> > > it its own error log
> > >
> > > i can actually start developing a rudimentary design now though so
> > > that's
> > > pretty cool... it took a lot less effort than i thought 
> when i first
> > > started
> > > looking into it
> > >
> > >
From fitnah55 at hotmail.com  Thu Jul 17 21:14:18 2003
From: fitnah55 at hotmail.com (fitnah55)
Date: Fri Jan  9 21:47:36 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
	integration
In-Reply-To: <20030716161514.Q95093@onyx.ispol.com>
Message-ID: <001101c34cc9$e9901fe0$24c0c20a@computer>


okay i'm still having a little problem with this, since i'm trying to
get telnet into full duplex character mode..

apparently the connection object is buffering the input for a CRLF
and i cant quite isolate where this is actually occuring

i see the GETLINE and GETBYTES stuff but so far i cant follow the
flow so well

im sending IAC+DO+ECHO and IAC+DO+SGA (supress go ahead) which should
get the client into the right mode, but the connection read buffer is
still boggling me, if u have any idea

> Well, after some looking, apparently the APR does work this 
> way, it's just
> that the way the connection handler was coded probably 
> because I didn't
> understand APR well enough at the time I made it loop until specified
> length of bytes was read (I started out with replicating 
> req.read(), which
> knows how much data there is to read).
> 
> I attached a patch to the connobject.c that changes its 
> behaviour so that
> read(len) will read at most len bytes, and will only block if 
> no data is
> available. And len is an optional argument.
> 
From greenbeard400 at yahoo.com  Thu Jul 17 20:54:14 2003
From: greenbeard400 at yahoo.com (Greenbeard)
Date: Fri Jan  9 21:47:36 2004
Subject: [mod_python] Passing Cursor Objects 
Message-ID: <20030718035414.67298.qmail@web21302.mail.yahoo.com>

Is it possible to pass the acutal cursor between
requests? 

I can attach the cursor as a <input>


I am using the publisher handler here...


def x(req):
  <snip>
   cursor = dbconn.cursor()
   


__________________________________
Do you Yahoo!?
SBC Yahoo! DSL - Now only $29.95 per month!
http://sbc.yahoo.com
From greenbeard400 at yahoo.com  Thu Jul 17 21:00:43 2003
From: greenbeard400 at yahoo.com (Greenbeard)
Date: Fri Jan  9 21:47:36 2004
Subject: [mod_python] Passing Cursor Objects 
Message-ID: <20030718040043.26298.qmail@web21310.mail.yahoo.com>

Sorry bout the premature email.  Stupid touchpad on
the laptop here.....

Is it possible to pass the acutal cursor between
requests? 

I can attach the cursor as a value on an <input> tag
and when I submit the form and I print the variable
passed I get the <MySQLdb.cursors.Cursor instance at
0x04AC1038> but if I reference it in future operations
I get "'str' object has no attribute 'execute' "

Based on the documentation I see that I could pass the
connection or I can move the cursor information out of
the cursor and pass it as a string.  But am I missing
something here that would allow me to use the cursor
object?  

I am using the publisher handler if that makes a
difference. 

Thanks! 

__________________________________
Do you Yahoo!?
SBC Yahoo! DSL - Now only $29.95 per month!
http://sbc.yahoo.com
From dustin at ywlcs.org  Thu Jul 17 23:38:45 2003
From: dustin at ywlcs.org (Dustin Mitchell)
Date: Fri Jan  9 21:47:36 2004
Subject: [mod_python] Passing Cursor Objects
In-Reply-To: <20030718040043.26298.qmail@web21310.mail.yahoo.com>
References: <20030718040043.26298.qmail@web21310.mail.yahoo.com>
Message-ID: <20030718043845.GX18379@eleanor.internal.ywlcs.org>

On Thu, Jul 17, 2003 at 09:00:43PM -0700, Greenbeard wrote:
> Sorry bout the premature email.  Stupid touchpad on
> the laptop here.....
> 
> Is it possible to pass the acutal cursor between
> requests? 
> 
> I can attach the cursor as a value on an <input> tag
> and when I submit the form and I print the variable
> passed I get the <MySQLdb.cursors.Cursor instance at
> 0x04AC1038> but if I reference it in future operations
> I get "'str' object has no attribute 'execute' "
> 
> Based on the documentation I see that I could pass the
> connection or I can move the cursor information out of
> the cursor and pass it as a string.  But am I missing
> something here that would allow me to use the cursor
> object?  
> 
> I am using the publisher handler if that makes a
> difference. 

Nope, you can't do it.  Basically all you can send to the client (the
browser) is text.   Most browsers are nice enough to send your text
back unmangled, but they're certainly not capable of anything more
complicated.  A cursor is deeply tied into the current state of the
Python Database API, the MySQL server, and whatnot -- all that state
certainly can't be tied up in a string and recreated for the next
request from the browser.

The text you see (<MySQLdb.cursors.Cursor instance at 0x04AC1038>) is
Python's best effor at turning this cursor into a string.  But all it
says is "I had this object here at this address with all this state in
it".  When the request comes back from the browser (milliseconds,
seconds, days later) that object is dead and gone.  Could be Apache
restarted.  MySQL restarted.  The server started smoking and was
replaced.  That cursor is no longer viable.

While I'm on the subject, another good reason not to send things like
this to your client (the browser) is this: you're not sure you'll get
it back.  If you had a way to "reserve" cursors on the server, such
that a browser could indicate "I was using cursor number 243" (perhaps
with an input tag), what would happen if the browser never send another
request?  That cursor would sit around, using up resources.  A couple
dozen idle cursors, and you'll have a DOS'd server..

So the long and short of it is you'll have to open a new cursor for
each request from the web.  It may help to think about the state of the
cursor that's most important to you: not the connection ID to the MySQL
server or anything like that.  It's probably the row number the user
last viewed, along with the components of the query.  If you put *that*
information into the generated HTML in such a way that the browser will
send it back to you (again, <input> tags are good for this), then
you'll be able to create a cursor in the necessary state by grabbing
any old cursor and executing the appropriate query.

I hope this helps.  I try to err on the side of too much explaination.

Dustin

--

  Dustin Mitchell
  dustin@ywlcs.org/djmitche@alumni.uchicago.edu
  http://people.cs.uchicago.edu/~dustin/
From mike.looijmans at asml.com  Fri Jul 18 07:10:37 2003
From: mike.looijmans at asml.com (Mike Looijmans)
Date: Fri Jan  9 21:47:36 2004
Subject: [mod_python] Passing Cursor Objects
Message-ID: <01c34cea$ec7a4480$926a1e6e@wsasd464>

Good explanation, I'm sure you're erring on the 'too much' side here.

Anyway, MySQL has a quite nice LIMIT command for this purpose. You can not
only get the 'first 10' rows, but you can also make it fetch the last 10 or
from 30-40. So all you need is to keep track of where you were and what the
query was (you could make the page into a form and add <input type=hidden>
tags and prev/next submit buttons. Or you could put the query into the url.

If you have really long queries (URLs are limited to 6kB) consider using
either POST requests or store the query into the database and supply a
'handle' (row ID) instead. Throw away the query after an hour or so...


>So the long and short of it is you'll have to open a new cursor for
>each request from the web.  It may help to think about the state of the
>cursor that's most important to you: not the connection ID to the MySQL
>server or anything like that.  It's probably the row number the user
>last viewed, along with the components of the query.  If you put *that*
>information into the generated HTML in such a way that the browser will
>send it back to you (again, <input> tags are good for this), then
>you'll be able to create a cursor in the necessary state by grabbing
>any old cursor and executing the appropriate query.
>
>I hope this helps.  I try to err on the side of too much explaination.




-- 
The information contained in this communication and any attachments is confidential and may be privileged, and is for the sole use of the intended recipient(s). Any unauthorized review, use, disclosure or distribution is prohibited. If you are not the intended recipient, please notify the sender immediately by replying to this message and destroy all copies of this message and any attachments. ASML is neither liable for the proper and complete transmission of the information contained in this communication, nor for any delay in its receipt.


From davidf at sjsoft.com  Fri Jul 18 09:58:00 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 21:47:36 2004
Subject: [mod_python] Passing Cursor Objects
In-Reply-To: <01c34cea$ec7a4480$926a1e6e@wsasd464>
References: <01c34cea$ec7a4480$926a1e6e@wsasd464>
Message-ID: <3F17A888.9000704@sjsoft.com>

Mike Looijmans wrote:

>Good explanation, I'm sure you're erring on the 'too much' side here.
>
>Anyway, MySQL has a quite nice LIMIT command for this purpose. You can not
>only get the 'first 10' rows, but you can also make it fetch the last 10 or
>from 30-40. So all you need is to keep track of where you were and what the
>query was (you could make the page into a form and add <input type=hidden>
>tags and prev/next submit buttons. Or you could put the query into the url.
>
>If you have really long queries (URLs are limited to 6kB) consider using
>either POST requests or store the query into the database and supply a
>'handle' (row ID) instead. Throw away the query after an hour or so...
>  
>
>>So the long and short of it is you'll have to open a new cursor for
>>each request from the web.  It may help to think about the state of the
>>cursor that's most important to you: not the connection ID to the MySQL
>>server or anything like that.  It's probably the row number the user
>>last viewed, along with the components of the query.  If you put *that*
>>information into the generated HTML in such a way that the browser will
>>send it back to you (again, <input> tags are good for this), then
>>you'll be able to create a cursor in the necessary state by grabbing
>>any old cursor and executing the appropriate query.
>>
>>I hope this helps.  I try to err on the side of too much explaination.
>>    
>>
Or if you did really, even after those explanations, want to store the 
cursor, you could create a unique key for it, save it in a global 
dictionary (but note problems with different threads/processes), get the 
client to remember the key (cookie/hidden field/URL) and retrieve the 
cursor using the key on the next request...
But you probably really don't need to do that.

David


From fitnah55 at hotmail.com  Fri Jul 18 13:43:53 2003
From: fitnah55 at hotmail.com (fitnah55)
Date: Fri Jan  9 21:47:36 2004
Subject: [mod_python]  apache API and mod_python <-> protocol
	moduleintegration
In-Reply-To: <001101c34cc9$e9901fe0$24c0c20a@computer>
Message-ID: <000701c34d54$27753450$24c0c20a@computer>


okay i checked the client side by putting it into forced character
at a time mode, and now i can get the python handler to print to
stdout that its getting the characters a character at a time - but
the 'echo' part is still buffering until a CRLF is detected.. which
when i put the client into forced mode, it only sends CR and not the
LF..

i'm going to look at the conn_object.c code and the apache.py code
again, but i am having difficulty following what all is going on


> okay i'm still having a little problem with this, since i'm trying to
> get telnet into full duplex character mode..
> 
> apparently the connection object is buffering the input for a CRLF
> and i cant quite isolate where this is actually occuring
> 
> i see the GETLINE and GETBYTES stuff but so far i cant follow the
> flow so well
> 
> im sending IAC+DO+ECHO and IAC+DO+SGA (supress go ahead) which should
> get the client into the right mode, but the connection read buffer is
> still boggling me, if u have any idea
> 
From fitnah55 at hotmail.com  Fri Jul 18 13:47:42 2003
From: fitnah55 at hotmail.com (fitnah55)
Date: Fri Jan  9 21:47:36 2004
Subject: [mod_python]  apache API and mod_python <-> protocol
	moduleintegration
Message-ID: <000c01c34d54$b0153f80$24c0c20a@computer>


ahh nevermind, modpython is working as expected

its definitely something with the protocol negotiation... sigh

rfc's on telnet suck


> -----Original Message-----
> From: fitnah55 [mailto:fitnah55@hotmail.com] 
> Sent: Friday, July 18, 2003 1:44 PM
> To: 'mod_python@modpython.org'
> Subject: RE: [mod_python] apache API and mod_python <-> 
> protocol moduleintegration
> 
> 
> 
> okay i checked the client side by putting it into forced character
> at a time mode, and now i can get the python handler to print to
> stdout that its getting the characters a character at a time - but
> the 'echo' part is still buffering until a CRLF is detected.. which
> when i put the client into forced mode, it only sends CR and not the
> LF..
> 
> i'm going to look at the conn_object.c code and the apache.py code
> again, but i am having difficulty following what all is going on
> 
> 
> > okay i'm still having a little problem with this, since i'm 
> trying to
> > get telnet into full duplex character mode..
> > 
> > apparently the connection object is buffering the input for a CRLF
> > and i cant quite isolate where this is actually occuring
> > 
> > i see the GETLINE and GETBYTES stuff but so far i cant follow the
> > flow so well
> > 
> > im sending IAC+DO+ECHO and IAC+DO+SGA (supress go ahead) 
> which should
> > get the client into the right mode, but the connection read 
> buffer is
> > still boggling me, if u have any idea
> > 
> 
From hawkeesk8 at yahoo.com  Sun Jul 20 09:10:39 2003
From: hawkeesk8 at yahoo.com (Kevin Smith)
Date: Fri Jan  9 21:47:36 2004
Subject: [mod_python] Adding user-defined objects to the request
Message-ID: <20030720161039.30358.qmail@web10706.mail.yahoo.com>

Hi,

I have been playing with mod_python for a while now
and would like to add my own non-trivial objects to
the request object.

I know that it is easy to add objects that are
built-in types such as:

session = {'Id':'&YFH%^%231234'}
req.session = session

Then, req.session, will be available to downstream
handlers to process.  But simply adding an object
doesn't appear to work if it is a user-defined type. 
I would like to do something similar to the following:

Class Session():
...

session = Session()
...
req.session = session

And then, later, in a downstream handler use my
defined methods:

req.session.athenticate()

I have searched the mailing list and the web in
general and can't find anything that is sending me in
the right direction nor telling me it is impossible. 
I have looked at pso and jotweb.  pso appears to
accomplish something similar to what I want but it
will take me weeks to unravel the trickery going on! 
I would just use pso but it does not implement an
authentication token the way I need to based on our
security needs.

Can someone help?

Many thanks in advance.

__________________________________
Do you Yahoo!?
SBC Yahoo! DSL - Now only $29.95 per month!
http://sbc.yahoo.com
From stian at soiland.no  Sun Jul 20 18:40:57 2003
From: stian at soiland.no (Stian =?iso-8859-1?Q?S=F8iland?=)
Date: Fri Jan  9 21:47:36 2004
Subject: [mod_python] Adding user-defined objects to the request
In-Reply-To: <20030720161039.30358.qmail@web10706.mail.yahoo.com>
References: <20030720161039.30358.qmail@web10706.mail.yahoo.com>
Message-ID: <20030720164057.GA24916@itea.ntnu.no>

On 2003-07-20 18:10:39, Kevin Smith wrote:

> session = {'Id':'&YFH%^%231234'}
> req.session = session
> 
> Then, req.session, will be available to downstream
> handlers to process.  But simply adding an object
> doesn't appear to work if it is a user-defined type. 
> I would like to do something similar to the following:
> 
> Class Session():
> ...

I can't see why this should not work, we do the same thing, but with a
user defined Session (that basically just store itself to disk on
__del__). Are you sure you don't have a path problem or namespace
problem? What is type(req.session) and repr(req.session) further down in
your pipeline?

-- 
Stian S?iland               Work toward win-win situation. Win-lose
Trondheim, Norway           is where you win and the other lose.
http://www.soiland.no/      Lose-lose and lose-win are left as an
                            exercise to the reader.  [Limoncelli/Hogan]

From gnb at itga.com.au  Mon Jul 21 16:29:11 2003
From: gnb at itga.com.au (Gregory Bond)
Date: Fri Jan  9 21:47:36 2004
Subject: [mod_python] 2.7.8: os.error no longer == OSError
Message-ID: <200307210629.QAA06995@lightning.itga.com.au>

I've got
	Apache/1.3.27 (Unix) mod_python/2.7.8 Python/2.1.1 configured
on Solaris 2.6.

Consider an mptest.py that looks like this:
	from mod_python import apache

	import os

	def handler(req):
		req.send_http_header()
		try:
			os.stat('/tmp/not.existing')
		except os.error:
			req.write("caught os.error")
		except OSError:
			req.write("Caught OSError")
		return apache.OK


This always returns "Caught OSError", never "caught os.error".  This breaks a 
whole lotta stuff, including builtin functions like os.path.exists() which 
use the "os.error" form.

What can I conceivably have done to break this????


From gnb at itga.com.au  Mon Jul 21 17:48:14 2003
From: gnb at itga.com.au (Gregory Bond)
Date: Fri Jan  9 21:47:36 2004
Subject: [mod_python] 2.7.8: import exceptions -> os.error no longer ==
	OSError 
In-Reply-To: Your message of Mon, 21 Jul 2003 16:29:11 +1000.
Message-ID: <200307210748.RAA13476@lightning.itga.com.au>

I've done some more work and it appears that doing
	import exceptions
from inside mod_python buggers things more than somewhat for every mod_python 
script run in that process from then on.

(This was in some old and unconverted python 1.3-era code)

------------
def handler(req):
        req.send_http_header()
        req.write("before import exceptions\n")
        req.write("OSError is %d\n" % id(OSError))
        req.write("os.error is %d\n" % id(os.error))
        import exceptions
        req.write("after import exceptions\n")
        req.write("OSError is %d\n" % id(OSError))
        req.write("os.error is %d\n" % id(os.error))

        return apache.OK

------------
before import exceptions
OSError is 539788
os.error is 539788
after import exceptions
OSError is 1258380
os.error is 539788

----------
But if I run the same code (writing to stdout, rather than a req structure) 
from the command line it works OK:
----
import os, sys
req = sys.stdout

req.write("before import exceptions\n")
req.write("OSError is %d\n" % id(OSError))
req.write("os.error is %d\n" % id(os.error))
import exceptions
req.write("after import exceptions\n")
req.write("OSError is %d\n" % id(OSError))
req.write("os.error is %d\n" % id(os.error))
-----
lightning$ python t.py
before import exceptions
OSError is 900204
os.error is 900204
after import exceptions
OSError is 900204
os.error is 900204


From hawkeesk8 at yahoo.com  Mon Jul 21 03:21:25 2003
From: hawkeesk8 at yahoo.com (Kevin Smith)
Date: Fri Jan  9 21:47:36 2004
Subject: [mod_python] Adding user-defined objects to the request
In-Reply-To: <20030720164057.GA24916@itea.ntnu.no>
Message-ID: <20030721102125.65136.qmail@web10706.mail.yahoo.com>

Actually, I think I may have just found the problem
which brings up another question ...

I was trying to do the addition of the object to the
request in the InitHandler.  I then noticed that I
could not even get a simple type to add to the request
in this phase of the handling.  Is that normal
behaviour?  The earliest that I seemed to be able to
add an object to the request was HeaderParser phase.

Can someone confirm or deny that the HeaderParser is
the earliest (inside a 'Location/Directory' context)
that you can add objects/attributes to the request?

In light of this, and Stian's comment, I shall try to
add my user-defined object at this phase instead.

Thanks
--- Stian Siland <stian@soiland.no> wrote:
> On 2003-07-20 18:10:39, Kevin Smith wrote:
> 
> > session = {'Id':'&YFH%^%231234'}
> > req.session = session
> > 
> > Then, req.session, will be available to downstream
> > handlers to process.  But simply adding an object
> > doesn't appear to work if it is a user-defined
> type. 
> > I would like to do something similar to the
> following:
> > 
> > Class Session():
> > ...
> 
> I can't see why this should not work, we do the same
> thing, but with a
> user defined Session (that basically just store
> itself to disk on
> __del__). Are you sure you don't have a path problem
> or namespace
> problem? What is type(req.session) and
> repr(req.session) further down in
> your pipeline?
> 
> -- 
> Stian Siland               Work toward win-win
> situation. Win-lose
> Trondheim, Norway           is where you win and the
> other lose.
> http://www.soiland.no/      Lose-lose and lose-win
> are left as an
>                             exercise to the reader. 
[Limoncelli/Hogan]


__________________________________
Do you Yahoo!?
SBC Yahoo! DSL - Now only $29.95 per month!
http://sbc.yahoo.com
From grisha at modpython.org  Mon Jul 21 10:47:15 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:36 2004
Subject: [mod_python] 2.7.8: os.error no longer == OSError
In-Reply-To: <200307210629.QAA06995@lightning.itga.com.au>
References: <200307210629.QAA06995@lightning.itga.com.au>
Message-ID: <20030721104016.I97244@onyx.ispol.com>



On Mon, 21 Jul 2003, Gregory Bond wrote:

> I've got
> 	Apache/1.3.27 (Unix) mod_python/2.7.8 Python/2.1.1 configured

[snip]

I think it's the same problem as the one causing this:
http://www.modpython.org/FAQ/faqw.py?req=all#5.4

Try upgrading to Python 2.2.3, I'm almost certain it will fix this.

(I'd upgrade to Apache 2.0.x and mod_python 3.0.3 too if that's an option)

Grisha
From sabu at pure-elite.org  Wed Jul 23 03:38:02 2003
From: sabu at pure-elite.org (Xavier)
Date: Fri Jan  9 21:47:36 2004
Subject: [mod_python] Errors off of a fresh install.
Message-ID: <33780.24.199.120.198.1058967482.squirrel@mail.darkscape.net>

Greetings,

I went ahead and installed the mod_python-3.0.3 dist with a fresh
installation of python 2.2, apache 2.0.47, and php4*.  I followed all of
the compile/installation instructions and went ahead with the testing.

While testing the generic (with fine indentation) mptest.py code -- I ran
into the "Internal error"/500 from apache.  Here is why it won't execute:

[Wed Jul 23 09:13:28 2003] [error] make_obcallback: could not import
mod_python.apache.

ImportError: No module named mod_python.apache

I then opened up python and tried to import "mod_python.apache" only to
get this in return:

Traceback (most recent call last):
  File "<stdin>", line 1, in ?
  File "/usr/lib/python2.2/site-packages/mod_python/apache.py", line 67, in ?
    import _apache
ImportError: No module named _apache

Has anyone else ran into this same fault? anyoneh ave any solutions? I'd
like to get mod_python_+Roadkill working and hopefully this is a fixable
problem.

Thanks,
-- Xavier.

From gnb at itga.com.au  Thu Jul 24 09:41:51 2003
From: gnb at itga.com.au (Gregory Bond)
Date: Fri Jan  9 21:47:36 2004
Subject: [mod_python] Errors off of a fresh install. 
In-Reply-To: Your message of Wed, 23 Jul 2003 03:38:02 -1000.
Message-ID: <200307232341.JAA02393@lightning.itga.com.au>

> [Wed Jul 23 09:13:28 2003] [error] make_obcallback: could not import
> mod_python.apache.
> ImportError: No module named mod_python.apache

See the very first question in the FAQ :
	http://www.modpython.org/FAQ/faqw.py?req=show&file=faq02.001.htp

> I then opened up python and tried to import "mod_python.apache" only to
> get this in return:
> ImportError: No module named _apache

Also in the FAQ:
	http://www.modpython.org/FAQ/faqw.py?req=show&file=faq02.002.htp

From hawkeesk8 at yahoo.com  Thu Jul 24 08:46:53 2003
From: hawkeesk8 at yahoo.com (Kevin Smith)
Date: Fri Jan  9 21:47:36 2004
Subject: [mod_python] apxs:Error: Command failed with rc=65536
Message-ID: <20030724154653.51378.qmail@web10704.mail.yahoo.com>

Hi,

I am getting the infamous "apxs:Error: Command failed
with rc=65536" error when trying to compile mod_python
3.0.3 against Apache 2.0.40 on RH9.

I have seen this error mentioned before on this list
and under each circumstance the reply was that the
version of python is too old.

However, I am running a compiled from source, Python
2.3c1 and the 'out-of-the-box' apache 2.0.40 (both
httpd and httpd-devel) that comes with RH9.

I issue ./configure --with-apxs=/usr/sbin/apxs
--with-python=/usr/local/bin/python
and then when I do the make I get the following (only
the last number of lines have been  included because I
don't think there were problems previous to this):

requestobject.c: In function `getreq_recmbr_off':
requestobject.c:1055: `LONG_LONG' undeclared (first
use in this function)
requestobject.c:1055: (Each undeclared identifier is
reported only once
requestobject.c:1055: for each function it appears
in.)
requestobject.c:1056: parse error before "l"
requestobject.c:1057: `l' undeclared (first use in
this function)
requestobject.c: At top level:
requestobject.c:1270: warning: initialization from
incompatible pointer type
apxs:Error: Command failed with rc=65536
.
make[1]: *** [mod_python.so] Error 1
make[1]: Leaving directory
`/usr/local/mod_python-3.0.3/src'
make: *** [do_dso] Error 2

I'm stumped.

Cheers


__________________________________
Do you Yahoo!?
Yahoo! SiteBuilder - Free, easy-to-use web site design software
http://sitebuilder.yahoo.com
From eu5698 at hotmail.com  Fri Jul 25 15:25:46 2003
From: eu5698 at hotmail.com (Rui Santos)
Date: Fri Jan  9 21:47:36 2004
Subject: [mod_python] problem to install mod_python
Message-ID: <LAW15-DAV73ur2iz2Mb00004329@hotmail.com>

hello.

i have been follow this steps: 

http://www.modpython.org/live/mod_python-2.7.8/doc-html/app-wininst.html

but when i test the apache then give me one error:

Invalid command 'PythonHandler'.

i use: 
a.. Python 2.2.3
a.. Apache 1.3.28 .



with the best compliments 
Rui Santos 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20030725/e5177210/attachment.htm
From tnienstedt at telesyn.com  Sat Jul 26 09:30:54 2003
From: tnienstedt at telesyn.com (Ted Nienstedt)
Date: Fri Jan  9 21:47:36 2004
Subject: [mod_python] qdemo/publish_error not working for IE with mod_python
Message-ID: <000201c3537a$23974ea0$2e1210ac@telesyn.corp>

I installed Quixote on Linux RedHat 9 and installed the qdemo as
described in
http://www.mems-exchange.org/software/quixote/doc/web-server.html,
and also doc/demo.txt .  Everything worked fine with the cgi-bin in the
URL.  I've since switched to mod_python and added the <LocationMatch>
directive to httpd.conf.
Once I made the switch to mod_python I encountered a couple of apparent
"bugs" in quixote's http_request.py which I fixed by passing an empty
string instead of None in the 2nd arg of environ.get().  After making
this fix everything works with mod_python, but qdemo/publish_error from
IE returns the standard IE 400 Bad Request.
It works fine with mod_python from Opera or from the local lunix machine
with Mozilla.
Any clues or suggestions?
Thanks,
Ted
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20030726/321fcafc/attachment.htm
From indrek at inversion.ee  Wed Jul 30 11:33:51 2003
From: indrek at inversion.ee (Indrek =?ISO-8859-1?Q?J=E4rve?=)
Date: Fri Jan  9 21:47:36 2004
Subject: [mod_python] A few questions about requestobject.c
Message-ID: <1059554030.13258.71.camel@hercules.dustbite.org>

Hi,

I've been messing around in requestobject.c for a few hours and started
wondering about the way a few things work. Since I'm not sure whether
they are design decisions, apache related stuff or just weird things, I
thought I'd ask the list :)

1. The use of apr_palloc

Multipart POST forms are parsed in util.py/FieldStorage using req's
req_readline function, which happily apr_palloc'ates enough memory to
read the remaining request data into memory, but never seems to free it
(nasty if the users have a habit of uploading 100+MB files, especially
once multiplied with the number of apache processes). Since the pool
used is attached to the apache request, I'm not sure I should freely
apr_pool_clear() or apr_pool_destroy() it either.

I managed to release memory by replacing apr_palloc with malloc and
adding a few free()s where required, but is this the right approach?

2. The use of PyString_FromStringAndSize()

Again in the req_readline() function, the result variable is initialized
at the size of the full remaining request data. Could the result
variable initialization perhaps be moved a bit further down to

a) when checking if rbuff from previous reads has a '\n' in it (perhaps
check with strchr and then initialize if needed) and 
b) after reading data from request and before copying it to the result.

At both these places it should be more obvious how much memory needs to
be allocated.


If I managed to make no sense at all and got something mixed up, please
let me know. However, I feel that at least the first point could use
some attention, as it creates a problem when uploading big files through
mod_python enabled scripts.

Regards,
Indrek

From grisha at modpython.org  Wed Jul 30 09:05:53 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:36 2004
Subject: [mod_python] A few questions about requestobject.c
In-Reply-To: <1059554030.13258.71.camel@hercules.dustbite.org>
References: <1059554030.13258.71.camel@hercules.dustbite.org>
Message-ID: <20030730085411.W86294@onyx.ispol.com>



On Wed, 30 Jul 2003, Indrek [ISO-8859-1] J?rve wrote:
>
> I've been messing around in requestobject.c for a few hours and started
> wondering about the way a few things work. Since I'm not sure whether
> they are design decisions, apache related stuff or just weird things, I
> thought I'd ask the list :)

It's been so long we lost track of which of the three they are :-) (BTW, a
better list for this sort of thing is python-dev@httpd.apache.org).

> 1. The use of apr_palloc
>
> Multipart POST forms are parsed in util.py/FieldStorage using req's
> req_readline function, which happily apr_palloc'ates enough memory to
> read the remaining request data into memory, but never seems to free it
> (nasty if the users have a habit of uploading 100+MB files, especially
> once multiplied with the number of apache processes). Since the pool
> used is attached to the apache request, I'm not sure I should freely
> apr_pool_clear() or apr_pool_destroy() it either.
>
> I managed to release memory by replacing apr_palloc with malloc and
> adding a few free()s where required, but is this the right approach?

Yes, this would definitely be a problem because that memory isn't freed
until the end of the request... We could either create a separate pool,
which then can be apr_pool_cleared(), or just use malloc like you have...
I'll see if I can take a look at it later today. If you have a patch you
could send in, that'd be nice.

>
> 2. The use of PyString_FromStringAndSize()
>
> Again in the req_readline() function, the result variable is initialized
> at the size of the full remaining request data.

This would be a problem with 100M files too... Another thing that occured
to me is that it could be better to rewrite the request read() functions
to use the buckets interface, this way none of this would be an issue.

Grisha
From azaroth at liverpool.ac.uk  Tue Jul  1 15:53:15 2003
From: azaroth at liverpool.ac.uk (Robert Sanderson)
Date: Fri Jan  9 21:53:40 2004
Subject: [mod_python] ConnectionHandler sigsegv (fwd)
In-Reply-To: <20030630092522.B53253@onyx.ispol.com>
Message-ID: <Pine.LNX.4.44.0307011548230.12884-100000@gondolin.hist.liv.ac.uk>


> The normal way of dealing with this sort of thing is by calling select()
> on a socket which will then call your function when there is anything to
> read. I don't know whether APR provides this.

Right. I can't see it anywhere, but that doesn't mean it's not available. 
 
> I think your only option is to read a byte at a time, making sure that
> when you receivie a complete frame/packet/whatever you stop reading so as
> to not block indefinitely.

Yep, I've now successfully implemented a Z39.50 connection handler using 
mod_python and PyZ3950 under Apache using this technique, though it's not 
pretty having to try to parse a PDU after reading in each byte. 

Cheers,

Rob

-- 
      ,'/:.          Rob Sanderson (azaroth@liverpool.ac.uk)
    ,'-/::::.        http://www.o-r-g.org/~azaroth/
  ,'--/::(@)::.      Special Collections and Archives, extension 3142
,'---/::::::::::.    Nebmedes:  telnet: nebmedes.o-r-g.org 7777
____/:::::::::::::.                WWW:  http://nebmedes.o-r-g.org:8000/
I L L U M I N A T I

From grisha at modpython.org  Tue Jul  1 12:12:58 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:41 2004
Subject: [mod_python] ConnectionHandler sigsegv (fwd)
In-Reply-To: <Pine.LNX.4.44.0307011548230.12884-100000@gondolin.hist.liv.ac.uk>
References: <Pine.LNX.4.44.0307011548230.12884-100000@gondolin.hist.liv.ac.uk>
Message-ID: <20030701114138.D75368@onyx.ispol.com>



On Tue, 1 Jul 2003, Robert Sanderson wrote:

> > I think your only option is to read a byte at a time, making sure that
> > when you receivie a complete frame/packet/whatever you stop reading so as
> > to not block indefinitely.
>
> Yep, I've now successfully implemented a Z39.50 connection handler using
> mod_python and PyZ3950 under Apache

Cool (even though I don't know what Z39.50 is :-) )

> using this technique, though it's not pretty having to try to parse a
> PDU after reading in each byte.

This is a pretty common technique in C, but in Python it is definitely
very inefficient because every "byte" is really a string... You could
probably get some improvement from using Python buffer(). I imagine this
will be a fairly common problem for people who implement connections, so
if you have any ideas on how it can be improved, please be sure to share
them on the list.

Grisha
From alexiev at activesolutions.bg  Wed Jul  2 17:18:35 2003
From: alexiev at activesolutions.bg (Alexiev Nikolay)
Date: Fri Jan  9 21:53:41 2004
Subject: [mod_python] Cookie
Message-ID: <00ce01c340a4$d30e74a0$0a01010a@dev1>

I want to save 2 cookies using mod_python & Cookie modul. Can somebody help
me, please?
10x

Best regards,
Alexiev, Nikolay

From grisha at modpython.org  Wed Jul  2 17:31:20 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:41 2004
Subject: [mod_python] Cookie
In-Reply-To: <00ce01c340a4$d30e74a0$0a01010a@dev1>
References: <00ce01c340a4$d30e74a0$0a01010a@dev1>
Message-ID: <20030702172715.A10551@onyx.ispol.com>


Something like this:

c1 = Cookie.SimpleCookie("cookie1=value1")
req.headers_out["Set-Cookie"] = c1.output(header="").strip()

c2 = Cookie.SimpleCookie("cookie2=value2")
req.headers_out.add("Set-Cookie") = c2.output(header="").strip()


Using the standard lib Cookie module is a bit ugly with mod_python because
Cookie was designed with CGI in mind, which is why the next release of
mod_python will have its own Cookie module.

Grisha


On Wed, 2 Jul 2003, Alexiev Nikolay wrote:

> I want to save 2 cookies using mod_python & Cookie modul. Can somebody help
> me, please?
> 10x
>
> Best regards,
> Alexiev, Nikolay
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From dlrubin at yahoo.com  Wed Jul  2 17:46:52 2003
From: dlrubin at yahoo.com (Daniel Rubin)
Date: Fri Jan  9 21:53:41 2004
Subject: [mod_python] problem creating an instance and debugging
Message-ID: <20030703004652.45793.qmail@web13904.mail.yahoo.com>

I successfully installed mod_python 3.0.3 and have it
working with apache, but one of my handlers isn't
working and I'm unable to get mod_python to record any
error messages about this particular event to the
apache error log. Basically, I have a handler called
xmlrpc that creates a python object called obj.  The
library needed to make this object gets imported
within xmlrpc.py just fine, but right at the line
where I create a new instance of obj (foo = obj()) I
get a stack dump (see below), and there are no errors
in the apache logs.  The xmlrpc.py program runs just
fine as a cgi within apache. It's when it runs with
mod_python that this fails. Any ideas?

in httpd.conf:
<Directory "/home/rubin/opt/apache/htdocs/xmlrpc">
    AddHandler python-program .py
    PythonHandler xmlrpc
    PythonDebug On
</Directory>

The stack dump:

  File "/test.py", line 52, in ?
    p = do_test(data)
  File "/test.py", line 44, in do_test
    return server.do_test(data)
  File "/home/lib/python2.2/xmlrpclib.py", line 821,
in __call__
    return self.__send(self.__name, args)
  File "/home/lib/python2.2/xmlrpclib.py", line 975,
in __request
    verbose=self.__verbose
  File "/home/lib/python2.2/xmlrpclib.py", line 853,
in request
    return self.parse_response(h.getfile())
  File "/home/lib/python2.2/xmlrpclib.py", line 886,
in parse_response
    response = f.read(1024)
  File "/home/lib/python2.2/httplib.py", line 1140, in
read
    assert not self._line_consumed and self._line_left
AssertionError



__________________________________
Do you Yahoo!?
SBC Yahoo! DSL - Now only $29.95 per month!
http://sbc.yahoo.com
From gnb at itga.com.au  Thu Jul  3 11:46:59 2003
From: gnb at itga.com.au (Gregory Bond)
Date: Fri Jan  9 21:53:41 2004
Subject: [mod_python] problem creating an instance and debugging 
In-Reply-To: Your message of Wed, 02 Jul 2003 17:46:52 -0700.
Message-ID: <200307030146.LAA14756@lightning.itga.com.au>

> working and I'm unable to get mod_python to record any
> error messages about this particular event to the
> apache error log.

stderr in mod_python goes to the apache error log but it is buffered.  You 
need to use sys.stderr.flush() at appropriate times.

See FAQ 2.3:
	http://www.modpython.org/FAQ/faqw.py?req=show&file=faq02.003.htp

From dustin at ywlcs.org  Wed Jul  2 21:02:43 2003
From: dustin at ywlcs.org (Dustin Mitchell)
Date: Fri Jan  9 21:53:41 2004
Subject: [mod_python] problem creating an instance and debugging
In-Reply-To: <20030703004652.45793.qmail@web13904.mail.yahoo.com>
References: <20030703004652.45793.qmail@web13904.mail.yahoo.com>
Message-ID: <20030703020242.GD23014@eleanor.internal.ywlcs.org>

On Wed, Jul 02, 2003 at 05:46:52PM -0700, Daniel Rubin wrote:
<snip snip>
> in parse_response
>     response = f.read(1024)
>   File "/home/lib/python2.2/httplib.py", line 1140, in
> read
>     assert not self._line_consumed and self._line_left
> AssertionError

Looking at this assertion, it seems valid.  Which is to say, in a linear
code flow, it should never get triggered.  My conjuecture then would be
that this is a threading issue.  Is your code using global variables of
any sort?  I'm pretty confident xmlrpclib and httplib are thread-safe,
but perhaps someone knows something to the contrary?

Dustin

-- 

  Dustin Mitchell
  dustin@ywlcs.org/djmitche@alumni.uchicago.edu
  http://people.cs.uchicago.edu/~dustin/
From dlrubin at yahoo.com  Wed Jul  2 20:28:35 2003
From: dlrubin at yahoo.com (Daniel Rubin)
Date: Fri Jan  9 21:53:41 2004
Subject: [mod_python] problem creating an instance and debugging 
In-Reply-To: <200307030146.LAA14756@lightning.itga.com.au>
Message-ID: <20030703032835.32306.qmail@web13905.mail.yahoo.com>

Putting sys.stderr.flush() into my xmlrpc.py doesn't
cause anything to get written to the apache log file.
I've even tried sys.stderr.write("stuff") and it
doesn't seem to appear anywhere (console nor apache
logs). Is there no way to track what's going on in the
code running on the server side in mod_python?

Thanks,
Daniel


--- Gregory Bond <gnb@itga.com.au> wrote:
> > working and I'm unable to get mod_python to record
> any
> > error messages about this particular event to the
> > apache error log.
> 
> stderr in mod_python goes to the apache error log
> but it is buffered.  You 
> need to use sys.stderr.flush() at appropriate times.
> 
> See FAQ 2.3:
> 
>
http://www.modpython.org/FAQ/faqw.py?req=show&file=faq02.003.htp
> 


__________________________________
Do you Yahoo!?
SBC Yahoo! DSL - Now only $29.95 per month!
http://sbc.yahoo.com
From gnb at itga.com.au  Thu Jul  3 14:03:17 2003
From: gnb at itga.com.au (Gregory Bond)
Date: Fri Jan  9 21:53:41 2004
Subject: [mod_python] problem creating an instance and debugging 
In-Reply-To: Your message of Wed, 02 Jul 2003 20:28:35 -0700.
Message-ID: <200307030403.OAA27049@lightning.itga.com.au>

> I've even tried sys.stderr.write("stuff") and it
> doesn't seem to appear anywhere (console nor apache
> logs). 

Well, it works fine to the error_log for me!  (apache1 and apache2 on Unix).
It may be something to do with your apache config, in particular the virtual
host logging setup.


From mike.looijmans at asml.com  Thu Jul  3 07:36:59 2003
From: mike.looijmans at asml.com (Mike Looijmans)
Date: Fri Jan  9 21:53:41 2004
Subject: [mod_python] Cookie
Message-ID: <01c34125$1f3a0f80$926a1e6e@wsasd464>

>I want to save 2 cookies using mod_python & Cookie modul. Can somebody help
>me, please?


Put your cookies in a SimpleCookie or SmartCookie, and use:

req.headers_out.add('Set-Cookie', cookies.output(header='',
sep='\r\nSet-Cookie:'))

to add them all in one shot.

--
Mike Looijmans
Private: http://www.milosoftware.com
-- Sorry about the nonsense below --



-- 
The information contained in this communication and any attachments is confidential and may be privileged, and is for the sole use of the intended recipient(s). Any unauthorized review, use, disclosure or distribution is prohibited. If you are not the intended recipient, please notify the sender immediately by replying to this message and destroy all copies of this message and any attachments. ASML is neither liable for the proper and complete transmission of the information contained in this communication, nor for any delay in its receipt.


From mike.looijmans at asml.com  Thu Jul  3 07:42:58 2003
From: mike.looijmans at asml.com (Mike Looijmans)
Date: Fri Jan  9 21:53:41 2004
Subject: [mod_python] Cookie
Message-ID: <01c34125$f5351d00$926a1e6e@wsasd464>

>Using the standard lib Cookie module is a bit ugly with mod_python because
>Cookie was designed with CGI in mind, which is why the next release of
>mod_python will have its own Cookie module.


Something like:

Request.cookie

so that Request has a 'cookie' object by default, which parses the 'cookie'
headers at the first call to Request.cookie. When setting it, it outputs the
cookie to the headers.

It would be a requirement to use the same interface as Cookie does, since that
allows CGI and mod_python code to share that part.

Mike.
-- My message ends here --



-- 
The information contained in this communication and any attachments is confidential and may be privileged, and is for the sole use of the intended recipient(s). Any unauthorized review, use, disclosure or distribution is prohibited. If you are not the intended recipient, please notify the sender immediately by replying to this message and destroy all copies of this message and any attachments. ASML is neither liable for the proper and complete transmission of the information contained in this communication, nor for any delay in its receipt.


From bill at rfa.org  Thu Jul  3 10:07:44 2003
From: bill at rfa.org (Bill Eldridge)
Date: Fri Jan  9 21:53:41 2004
Subject: [mod_python] Cookie
In-Reply-To: <20030702172715.A10551@onyx.ispol.com>
References: <00ce01c340a4$d30e74a0$0a01010a@dev1>
	<20030702172715.A10551@onyx.ispol.com>
Message-ID: <3F03E450.3070203@rfa.org>


PSO also has a session module that can be split off for
mod_python:

http://www.scriptfoundry.com/modules/pso/doc/session-modpython.html
http://www.scriptfoundry.com/modules/pso


Gregory (Grisha) Trubetskoy wrote:

>Something like this:
>
>c1 = Cookie.SimpleCookie("cookie1=value1")
>req.headers_out["Set-Cookie"] = c1.output(header="").strip()
>
>c2 = Cookie.SimpleCookie("cookie2=value2")
>req.headers_out.add("Set-Cookie") = c2.output(header="").strip()
>
>
>Using the standard lib Cookie module is a bit ugly with mod_python because
>Cookie was designed with CGI in mind, which is why the next release of
>mod_python will have its own Cookie module.
>
>Grisha
>
>
>On Wed, 2 Jul 2003, Alexiev Nikolay wrote:
>
>  
>
>>I want to save 2 cookies using mod_python & Cookie modul. Can somebody help
>>me, please?
>>10x
>>
>>Best regards,
>>Alexiev, Nikolay
>>
>>_______________________________________________
>>Mod_python mailing list
>>Mod_python@modpython.org
>>http://mailman.modpython.org/mailman/listinfo/mod_python
>>
>>    
>>
>_______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org
>http://mailman.modpython.org/mailman/listinfo/mod_python
>  
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20030703/42c7f02a/attachment-0001.htm
From alexiev at activesolutions.bg  Thu Jul  3 14:39:49 2003
From: alexiev at activesolutions.bg (Alexiev Nikolay)
Date: Fri Jan  9 21:53:41 2004
Subject: [mod_python] Save cookie and redirect
Message-ID: <012101c34157$cfb52020$0a01010a@dev1>

I try to set cookie and redirect with one response. Redirect works fine but
cookie dosn't exist. What can I do?


HTTP_MOVED_PERMANENTLY = 301
req.headers_out.add('Set-Cookie', cookies.output(header='',
sep='\r\nSet-Cookie:'))
req.headers_out.add('Location', redirect)
req.status = HTTP_MOVED_PERMANENTLY

From manfred.stienstra at dwerg.net  Thu Jul  3 13:57:04 2003
From: manfred.stienstra at dwerg.net (Manfred Stienstra)
Date: Fri Jan  9 21:53:41 2004
Subject: [mod_python] Save cookie and redirect
In-Reply-To: <012101c34157$cfb52020$0a01010a@dev1>
References: <012101c34157$cfb52020$0a01010a@dev1>
Message-ID: <200307031357.04468.manfred.stienstra@dwerg.net>

On Thursday 03 July 2003 13:39, Alexiev Nikolay wrote:
> I try to set cookie and redirect with one response. Redirect works fine but
> cookie dosn't exist. What can I do?
>
>
> HTTP_MOVED_PERMANENTLY = 301
> req.headers_out.add('Set-Cookie', cookies.output(header='',
> sep='\r\nSet-Cookie:'))
> req.headers_out.add('Location', redirect)
> req.status = HTTP_MOVED_PERMANENTLY

First set the cookie and after that redirect. If it's a login page you could 
display a page saying something like 'successfully logged in' (setting the 
cookie) and after that (5 secs or something) you redirect.

Manfred

From dustin at ywlcs.org  Thu Jul  3 08:22:11 2003
From: dustin at ywlcs.org (Dustin Mitchell)
Date: Fri Jan  9 21:53:41 2004
Subject: [mod_python] problem creating an instance and debugging
In-Reply-To: <20030703032835.32306.qmail@web13905.mail.yahoo.com>
References: <200307030146.LAA14756@lightning.itga.com.au>
	<20030703032835.32306.qmail@web13905.mail.yahoo.com>
Message-ID: <20030703132210.GI23014@eleanor.internal.ywlcs.org>

On Wed, Jul 02, 2003 at 08:28:35PM -0700, Daniel Rubin wrote:
> Putting sys.stderr.flush() into my xmlrpc.py doesn't
> cause anything to get written to the apache log file.
> I've even tried sys.stderr.write("stuff") and it
> doesn't seem to appear anywhere (console nor apache
> logs). Is there no way to track what's going on in the
> code running on the server side in mod_python?

I usually open an external file in append mode and write to that.  Then
I tail -f that file, and there's the information I wanted!  It has the
advantage that nothing in the Apache config can cause me to miss
selected messages or anything like that.

Dustin

-- 

  Dustin Mitchell
  dustin@ywlcs.org/djmitche@alumni.uchicago.edu
  http://people.cs.uchicago.edu/~dustin/
From grisha at modpython.org  Thu Jul  3 09:46:00 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:41 2004
Subject: [mod_python] problem creating an instance and debugging 
In-Reply-To: <20030703032835.32306.qmail@web13905.mail.yahoo.com>
References: <20030703032835.32306.qmail@web13905.mail.yahoo.com>
Message-ID: <20030703094320.P12723@onyx.ispol.com>


Why not just use apache.log_error or req.log_error?

http://www.modpython.org/live/current/doc-html/pyapi-apmeth.html#l2h-18

On Wed, 2 Jul 2003, Daniel Rubin wrote:

> Putting sys.stderr.flush() into my xmlrpc.py doesn't
> cause anything to get written to the apache log file.
> I've even tried sys.stderr.write("stuff") and it
> doesn't seem to appear anywhere (console nor apache
> logs). Is there no way to track what's going on in the
> code running on the server side in mod_python?
>
> Thanks,
> Daniel
>
>
> --- Gregory Bond <gnb@itga.com.au> wrote:
> > > working and I'm unable to get mod_python to record
> > any
> > > error messages about this particular event to the
> > > apache error log.
> >
> > stderr in mod_python goes to the apache error log
> > but it is buffered.  You
> > need to use sys.stderr.flush() at appropriate times.
> >
> > See FAQ 2.3:
> >
> >
> http://www.modpython.org/FAQ/faqw.py?req=show&file=faq02.003.htp
> >
>
>
> __________________________________
> Do you Yahoo!?
> SBC Yahoo! DSL - Now only $29.95 per month!
> http://sbc.yahoo.com
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From dlrubin at yahoo.com  Thu Jul  3 07:30:13 2003
From: dlrubin at yahoo.com (Daniel Rubin)
Date: Fri Jan  9 21:53:41 2004
Subject: [mod_python] problem creating an instance and debugging 
In-Reply-To: <20030703094320.P12723@onyx.ispol.com>
Message-ID: <20030703143013.36335.qmail@web13907.mail.yahoo.com>

The problem is that the xmlrpc.py script on the server
dies at a line of code that doesn't cause an Exception
to be thrown, so nothing executes after that line of
code and lines calling a log event will never get
executed.  And for some reason, no error message is
appearing in the apache error log (I have a pretty
standard httpd.conf).

--- "Gregory (Grisha) Trubetskoy"
<grisha@modpython.org> wrote:
> 
> Why not just use apache.log_error or req.log_error?
> 
>
http://www.modpython.org/live/current/doc-html/pyapi-apmeth.html#l2h-18
> 
> On Wed, 2 Jul 2003, Daniel Rubin wrote:
> 
> > Putting sys.stderr.flush() into my xmlrpc.py
> doesn't
> > cause anything to get written to the apache log
> file.
> > I've even tried sys.stderr.write("stuff") and it
> > doesn't seem to appear anywhere (console nor
> apache
> > logs). Is there no way to track what's going on in
> the
> > code running on the server side in mod_python?
> >
> > Thanks,
> > Daniel
> >
> >
> > --- Gregory Bond <gnb@itga.com.au> wrote:
> > > > working and I'm unable to get mod_python to
> record
> > > any
> > > > error messages about this particular event to
> the
> > > > apache error log.
> > >
> > > stderr in mod_python goes to the apache error
> log
> > > but it is buffered.  You
> > > need to use sys.stderr.flush() at appropriate
> times.
> > >
> > > See FAQ 2.3:
> > >
> > >
> >
>
http://www.modpython.org/FAQ/faqw.py?req=show&file=faq02.003.htp
> > >
> >
> >
> > __________________________________
> > Do you Yahoo!?
> > SBC Yahoo! DSL - Now only $29.95 per month!
> > http://sbc.yahoo.com
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> >
>
http://mailman.modpython.org/mailman/listinfo/mod_python
> >


__________________________________
Do you Yahoo!?
SBC Yahoo! DSL - Now only $29.95 per month!
http://sbc.yahoo.com
From grisha at modpython.org  Thu Jul  3 10:47:15 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:41 2004
Subject: [mod_python] problem creating an instance and debugging
In-Reply-To: <20030703004652.45793.qmail@web13904.mail.yahoo.com>
References: <20030703004652.45793.qmail@web13904.mail.yahoo.com>
Message-ID: <20030703104322.J23236@onyx.ispol.com>



On Wed, 2 Jul 2003, Daniel Rubin wrote:

> within xmlrpc.py just fine, but right at the line where I create a new
> instance of obj (foo = obj()) I get a stack dump (see below), and there
> are no errors in the apache logs.

I'm confused - how do you know you get a stack dump?

Also - which are you most concerned with - the fact that there is nothing
in the logs, or that you get a stack dump under mod_python whereas as a
CGI it works ok?

Grisha
From grisha at modpython.org  Thu Jul  3 10:58:33 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:41 2004
Subject: [mod_python] Save cookie and redirect
In-Reply-To: <200307031357.04468.manfred.stienstra@dwerg.net>
References: <012101c34157$cfb52020$0a01010a@dev1>
	<200307031357.04468.manfred.stienstra@dwerg.net>
Message-ID: <20030703104837.L23236@onyx.ispol.com>


Could it be that the location that you're redirecting to isn't valid for
this cookie? IIRC, the default path attribute is the full path, i.e. if
cookie was issued in /my/location1/blah and you're redirecting to
/my/location2/blah, the browser won't send the cookie (unless you
explicitely specify path=/my)

Grisha

On Thu, 3 Jul 2003, Manfred Stienstra wrote:

> On Thursday 03 July 2003 13:39, Alexiev Nikolay wrote:
> > I try to set cookie and redirect with one response. Redirect works fine but
> > cookie dosn't exist. What can I do?
> >
> >
> > HTTP_MOVED_PERMANENTLY = 301
> > req.headers_out.add('Set-Cookie', cookies.output(header='',
> > sep='\r\nSet-Cookie:'))
> > req.headers_out.add('Location', redirect)
> > req.status = HTTP_MOVED_PERMANENTLY
>
> First set the cookie and after that redirect. If it's a login page you could
> display a page saying something like 'successfully logged in' (setting the
> cookie) and after that (5 secs or something) you redirect.
>
> Manfred
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From dlrubin at yahoo.com  Thu Jul  3 09:11:20 2003
From: dlrubin at yahoo.com (Daniel Rubin)
Date: Fri Jan  9 21:53:41 2004
Subject: [mod_python] problem creating an instance and debugging
In-Reply-To: <20030703104322.J23236@onyx.ispol.com>
Message-ID: <20030703161120.58394.qmail@web13908.mail.yahoo.com>

I get the stack dump from the client program that
calls the function in xmlrpc.py running on the apache
server.  The client program gets the stack dump from a
call inside xmlrpclib that is trying to get a response
back from the xmlrpc.py running on the server.  An
error is happening in the xmlrpc.py program, and this
isn't making it's own stack dump or errors written to
the apache logs on the server. So I can't debug what
the nature of the error that is happening in the
remotely called function.

My main concern is that or that I get a stack dump
under mod_python whereas as a CGI it works ok. I'm
concerned about the lack of error logging to apache
only because it might help me figure out what's going
wrong with the code running in mod_python.


--- "Gregory (Grisha) Trubetskoy"
<grisha@modpython.org> wrote:
> 
> 
> On Wed, 2 Jul 2003, Daniel Rubin wrote:
> 
> > within xmlrpc.py just fine, but right at the line
> where I create a new
> > instance of obj (foo = obj()) I get a stack dump
> (see below), and there
> > are no errors in the apache logs.
> 
> I'm confused - how do you know you get a stack dump?
> 
> Also - which are you most concerned with - the fact
> that there is nothing
> in the logs, or that you get a stack dump under
> mod_python whereas as a
> CGI it works ok?
> 
> Grisha


__________________________________
Do you Yahoo!?
SBC Yahoo! DSL - Now only $29.95 per month!
http://sbc.yahoo.com
From grisha at modpython.org  Thu Jul  3 13:31:54 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:41 2004
Subject: [mod_python] problem creating an instance and debugging
In-Reply-To: <20030703161120.58394.qmail@web13908.mail.yahoo.com>
References: <20030703161120.58394.qmail@web13908.mail.yahoo.com>
Message-ID: <20030703132213.X23236@onyx.ispol.com>



On Thu, 3 Jul 2003, Daniel Rubin wrote:

> An error is happening in the xmlrpc.py program, and this isn't making
> it's own stack dump or errors written to the apache logs on the server.
> So I can't debug what the nature of the error that is happening in the
> remotely called function.

So, tell me if I understand this correctly (I'm not familiar with
xmlrpc.py) -

Xmlrpc.py is a CGI script which reports its errors by writing them to
stderr. Something happens when you run it under mod_python, and you don't
know what it is because stderr goes nowhere.

As far as I know, stderr output may end up in your error log, but I don't
think that's guaranteed and may be dependent on how your httpd was
compiled.  I think there is really no solution to this other than to tweak
xmlrpc into raising its exception or using mod_python's log_error to
report it.

HTH,

Grisha
From dlrubin at yahoo.com  Thu Jul  3 11:41:10 2003
From: dlrubin at yahoo.com (Daniel Rubin)
Date: Fri Jan  9 21:53:41 2004
Subject: [mod_python] problem creating an instance and debugging
In-Reply-To: <20030703132213.X23236@onyx.ispol.com>
Message-ID: <20030703184110.41206.qmail@web13905.mail.yahoo.com>

Here's the xmlrpc.py code. My client code is calling
the "evaluate" function via a call like this:
server = xmlrpclib.ServerProxy(myURI)
server.evaluate(data)

If I put the "return data" statement right before the
"model=Model()" statement, then things work fine. If I
put the return statement after it, then I get the
stack dump I showed you earlier. The code never jupmps
to the except: clause, and no errors are being written
to the apache logs (and my conf file is set to record
everything with no virtual hosts).


from mod_python import apache
import xmlrpclib

def evaluate(data):
     import MyTools import Model
     try:
          model = Model()  <--an error happens here
          return data
     except:
          open("/tmp/test_xmlrpc01",
'w').write("RUNNING ON %s" % findings)
          import traceback
         
traceback.print_exc(file=open("/tmp/test_xmlrpc03",
'w'))
          raise

def handler(req):
    import sys
    
    module = sys.modules[__name__]

    # Load the method and arguments from the client.
    content = req.read()

    # xmlrpclib fails if there are characters with
ASCII code >= 128.
    # Thus, change anything greater than that to a
space.
    table = ''.join(map(chr, range(128))) + " "*128
    content = content.translate(table)
        
    args, method_name = xmlrpclib.loads(content)

    # Call the method.
    if hasattr(module, method_name):
        try:
            retval = getattr(module,
method_name)(*args)
        except Exception, x:
            retval = xmlrpclib.Fault(
                0, "Exception (%s) raised: %s" %
(Exception.__name__, str(x)))
        except x:
            retval = xmlrpclib.Fault(
                0, "General exception raised: %s" %
str(x))
    else:
        retval = xmlrpclib.Fault(
            0, "This server does not provide: '%s'" %
method_name)

    # Marshal the return value and write the results
back to the
    # client.
    req.content_type = "text/xml"
    marshalled = xmlrpclib.dumps((retval,),
methodresponse=1)
    req.write(marshalled)
    
    return apache.OK



--- "Gregory (Grisha) Trubetskoy"
<grisha@modpython.org> wrote:
> 
> 
> On Thu, 3 Jul 2003, Daniel Rubin wrote:
> 
> > An error is happening in the xmlrpc.py program,
> and this isn't making
> > it's own stack dump or errors written to the
> apache logs on the server.
> > So I can't debug what the nature of the error that
> is happening in the
> > remotely called function.
> 
> So, tell me if I understand this correctly (I'm not
> familiar with
> xmlrpc.py) -
> 
> Xmlrpc.py is a CGI script which reports its errors
> by writing them to
> stderr. Something happens when you run it under
> mod_python, and you don't
> know what it is because stderr goes nowhere.
> 
> As far as I know, stderr output may end up in your
> error log, but I don't
> think that's guaranteed and may be dependent on how
> your httpd was
> compiled.  I think there is really no solution to
> this other than to tweak
> xmlrpc into raising its exception or using
> mod_python's log_error to
> report it.
> 
> HTH,
> 
> Grisha


__________________________________
Do you Yahoo!?
SBC Yahoo! DSL - Now only $29.95 per month!
http://sbc.yahoo.com
From harm-modpython at tty.nl  Fri Jul  4 19:00:39 2003
From: harm-modpython at tty.nl (harm)
Date: Fri Jan  9 21:53:41 2004
Subject: [mod_python] OSx compile problem
Message-ID: <20030704170039.GA5999@godel>


Moi,

somehow compiling on OSX does not work for me (OSX 10.2) with python 2.2.3,
mod_python 2.7.8 and apache 1.3.27


trying a static build gives:

gcc  -DDARWIN -DUSE_HSREGEX -DUSE_EXPAT -I./lib/expat-lite -DNO_DL_NEEDED
`./apaci` -u __dummy -u _PyMac_Error -framework System -framework
CoreServices -framework Foundation        \
      -o httpd buildmark.o modules.o modules/python/libpython.a
modules/standard/libstandard.a main/libmain.a ./os/unix/libos.a ap/libap.a
regex/libregex.a lib/expat-lite/libexpat.a  -lm
/usr/local/lib/python2.2/config/libpython2.2.a   -ldl                 
ld: table of contents for archive: modules/python/libpython.a is out of
date; rerun ranlib(1) (can't load from it)
make[2]: *** [target_static] Error 1
make[1]: *** [build-std] Error 2
make: *** [build] Error 2
[Harmens-Computer:/tmp/apache_1.3.27] harmen%



A DSO gives:
Compiling for DSO. For static, do "make static"

/usr/local/apache/sbin/apxs -I/tmp/mod_python-2.7.8/src/include
-I/usr/local/apache/include -I/usr/local/include/python2.2 -c mod_python.o
_apachemodule.o requestobject.o tableobject.o util.o serverobject.o
connobject.o  -lm  /usr/local/lib/python2.2/config/libpython2.2.a   -ldl                 
  -o mod_python.so mod_python.o _apachemodule.o requestobject.o
tableobject.o util.o serverobject.o connobject.o -lm
/usr/local/lib/python2.2/config/libpython2.2.a -ldl 
apxs:Break: Command failed with rc=16777215
make[1]: *** [mod_python.so] Error 1
make: *** [do_dso] Error 2
[Harmens-Computer:/tmp/mod_python-2.7.8] harmen% 




The ./configure output indicates it does take the right freshly recompiled nonthreaded python libs.  Any hints?

Thanks,
Harmen



(Hope this email does get through, my excuse for any doubles)

-- 
                               The Moon is Waxing Crescent (13% of Full)
From grisha at modpython.org  Fri Jul  4 15:10:21 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:41 2004
Subject: [mod_python] OSx compile problem
In-Reply-To: <20030704170039.GA5999@godel>
References: <20030704170039.GA5999@godel>
Message-ID: <20030704150856.U35122@onyx.ispol.com>



On Fri, 4 Jul 2003, harm wrote:

> somehow compiling on OSX does not work for me (OSX 10.2) with python 2.2.3,
>
> The ./configure output indicates it does take the right freshly
> recompiled nonthreaded python libs.  Any hints?

Check the README - there are some problems with darwin's libtool and the
way dynamic linking works, but the README has the steps to get it
compiled.

Grisha
From harm-modpython at tty.nl  Sat Jul  5 00:08:19 2003
From: harm-modpython at tty.nl (harm)
Date: Fri Jan  9 21:53:42 2004
Subject: [mod_python] OSx compile problem
In-Reply-To: <20030704150856.U35122@onyx.ispol.com>
References: <20030704170039.GA5999@godel>
	<20030704150856.U35122@onyx.ispol.com>
Message-ID: <20030704220819.GA6079@godel>

On Fri, Jul 04, 2003 at 03:10:21PM -0400, Gregory (Grisha) Trubetskoy wrote:
> 
> 
> On Fri, 4 Jul 2003, harm wrote:
> 
> > somehow compiling on OSX does not work for me (OSX 10.2) with python 2.2.3,
> >
> > The ./configure output indicates it does take the right freshly
> > recompiled nonthreaded python libs.  Any hints?
> 
> Check the README - there are some problems with darwin's libtool and the
> way dynamic linking works, but the README has the steps to get it
> compiled.

Ah! The readme in 3.0.3 has the info, indeed. Too bad I was trying to
install 2.7.8, which does not have that info :)

Thanks, 

Harmen
> 
> Grisha
> 

-- 
                               The Moon is Waxing Crescent (27% of Full)
From michel_ts at yahoo.com.br  Sat Jul  5 10:39:59 2003
From: michel_ts at yahoo.com.br (=?iso-8859-1?q?Michel=20Thadeu?=)
Date: Fri Jan  9 21:53:42 2004
Subject: [mod_python] A problem with publisher method...
Message-ID: <20030705133959.23742.qmail@web40408.mail.yahoo.com>

Hi guys!

I still have trouble with publisher method, I read a bite about and now
I imagine what is my problem...

The problem is with index, I want to access something like this:

http://127.0.0.1/mypage/test.py or better .../mypage/ (accessing the
index.py), but if I create an index function in test.py ou index.py, it
said 404notfound...

if I access index like in http://127.0.0.1/mypage/index.py/index it
goes ok. I think it conflitates in some point...

What could be the problem?

thanks for help and sorry my poor english!

[]'s

--
Michel Thadeu Sabchuk
Curitiba - Paran? - Brasil

=====
--
Michel Thadeu Sabchuk
Curitiba/PR

_______________________________________________________________________
Yahoo! Mail
Mais espa?o, mais seguran?a e gratuito: caixa postal de 6MB, antiv?rus, prote??o contra spam.
http://br.mail.yahoo.com/
From pascalbarbedor at free.fr  Sun Jul  6 11:29:36 2003
From: pascalbarbedor at free.fr (pascal barbedor)
Date: Fri Jan  9 21:53:42 2004
Subject: [mod_python] Fw: pb with apache readme dir include
Message-ID: <001601c343a1$32b7d550$468f933e@allalswqm99ewu>


>
>
> Hi
>
> I have the following problem with mod_python :
>
> set up a directory like this
>
>
> <Directory "c:/home/">
> AddHandler python-program .py .html
> PythonHandler eindex
> PythonDebug On
> DirectoryIndex index.html eindex.py
> Options Indexes
> Order allow,deny
> Allow from all
> </Directory>
>
> this works ok, I intercept also .html files in the eindex.py script.
>
> now if I call a subdirectory of home, like /home/subdir, control is passed
> to apache
> wich produces a standard directory index
>
> so far so good.
>
>
> now if a readme.html is located in the subdir, apache appends it to the
> directoryindex page,
> as it is normal by default.
>
> but then something interferes and it is like if the appended reame.html
was
> processed by the eindex.py above (but it is located in the subdir) and not
> by apache, though the bare directory index is here.
>
> of course if AddHandler python-program .py  (without .html) everything
goes
> well.
>
> I tried to add
> sethandler default-handler for home/subdir but it does not work
>
>
>
>
> pascal
>

From gnb at itga.com.au  Mon Jul  7 14:20:28 2003
From: gnb at itga.com.au (Gregory Bond)
Date: Fri Jan  9 21:53:42 2004
Subject: [mod_python] Compiling 2.7 statically
Message-ID: <200307070420.OAA24234@lightning.itga.com.au>

I'm trying to compile mod_python 2.7 (plus mod_ssl) statically into apache
1.3.27.  I'm using Python 2.1.1 on Solaris 6.

The first problem is that the Apache link step fails, because the mod_python 
library (libpython.a) refers to symbols in the libpython2.1.a library, and 
this is never referenced anywhere.  

I worked around that by adding ".../libpython2.1.a -lm" to EXTRA_LIBS in src/
Makefile.

This allows me to build an apache binary, and get the "Hello World" mod_python 
app working.  But as soon as I try any substantial application, I get errors 
like this:

PythonHandler oneaccount: ImportError: ld.so.1: /opt/apache/bin/httpd: fatal: relocation error: file /usr/local/lib/python2.1/lib-dynload/cStringIO.so: symbol PyCObject_FromVoidPtr: referenced symbol not found

which makes sense as these symbols are potentially not needed by mod_python 
therefore the relevent .o files aren't sucked in from the .a file.  

So how do I make this work? Or is statically compiling in mod_python a doomed 
exercise?



From stian at soiland.no  Mon Jul  7 18:15:16 2003
From: stian at soiland.no (Stian =?iso-8859-1?Q?S=F8iland?=)
Date: Fri Jan  9 21:53:42 2004
Subject: [mod_python] mod_python weirdness, maybe related to importing?
In-Reply-To: <20030610081422.GC28085@tummy.com>
References: <20030610055927.GB28085@tummy.com> <3EE584EE.9090503@sjsoft.com>
	<20030610081422.GC28085@tummy.com>
Message-ID: <20030707161516.GA614@itea.ntnu.no>

On 1970-01-01 01:00:00, Sean Reifschneider wrote:
   ~~~~
(.. importing the mail archives appearantly does not work that well
anymore :=) )

> On Tue, Jun 10, 2003 at 09:12:46AM +0200, David Fraser wrote:
> >Do you mean you're using this import mechanism when you have the problem 
> >with jotweb.input.Request below?
> 
> I mean that the imp module call is loading a module which then does an
> "import jotweb.input".  If in the jotweb I don't have the __init__.py
> import all sub-packages or sub-modules, I will get an AttributeError
> such as:
> 
>   AttributeError: 'module' object has no attribute 'input'

I can confirm the very same problem. We've been scratching our heads
today.

[ in this post I'll be quoting python code like /print "Python example"/ ]


We're using mod_python.publisher as PythonHandler, and have some
library functions in /usr/local/nav/navme/lib/python.

As our PythonPath seems to be totally mucked up, refering to
/usr/lib/python and so on, we .. as a quickfix.. set it manually

PythonPath "['', '/usr/local/lib/python2.2/site-packages',
    '/usr/lib/apache/python/lib/python2.2',
    '/usr/lib/apache/python/lib/python2.2/plat-linux2',
    '/usr/lib/apache/python/lib/python2.2/lib-tk',
    '/usr/lib/apache/python/lib/python2.2/lib-dynload',
    '/usr/lib/apache/python/lib/python2.2/site-packages',
    '/usr/local/nav/navme/lib/python',
    '/usr/local/lib/python2.2/site-packages', '.']"

(/usr/lib/apache/python/lib/python2.2 is our threadless installation,
this is Apache/1.3.27 (Unix) (Red-Hat/Linux) mod_python/2.7.8
Python/2.2.2 mod_ssl/2.8.12 OpenSSL/0.9.6b PHP/4.1.2)


The problem was weird, in a method logout() in index.py, we try
/from nav.web import state/. This always fail, both if we do it on a
module level or inside the function.

However, /from nav.web import auth/ works fine. The permissions are
perfect, there are no .pyc-files hanging around, and there is really no
big differences between the two files.

Actually we found out that symlinking nav/web to nav/webb - and trying
/from nav.webb import auth/  WORKED, suggesting some problems with
caching. Several apache-restarts gives no more help.

Using /usr/lib/apache/python/lib/python2.2/bin/python from the shell,
running as httpd, with the same PythonPath as above (verified by
req.write("%s" % sys.path)  ), from nav import auth works perfect.


The 'fix' you suggested, using import auth in nav/web/__init__.py - DID
work, however, as in your case, there is no reason why this should be
neccessary. 

In SOME of the cases in this testing, the error message is not from
/usr/local/nav/navme/apache/webroot/index.py (where the import actually
happens), but from mod_python/apache.py in the function import_module.
This function looks pretty weird to me, I tried adding some debug
sentences to follow the execution paths.


However, it turns out that our trouble-module nav.web.state is used as a
fixup handler as well, PythonFixupHandler nav.web.state.

Renaming to /PythonFixupHandler nav.webb.state/ removes the bug, 
/from nav.web import state/  suddenly works again.


So in our case, the problem is related to the module being used both in
handlers and imported by submodules. Appearently the errors from
mod_python.apache.import_module appears only those times the
PythonFixupHandler won't load. 

(debug messages reveal that import_module is NOT called by the normal
import sentence - that's good, as I couldn't understand how it could
have been called at that time :=) )



However, the problem is still unsolved, although the __init__.py-import
is  a working workaround (the symlink magic is NOT! :=) )

Is your problem-module a part of other headers (or imports) as well?


    (our team is also very pissed of by the need to restart apache every
    minute to force reloading of all modules.  It's seems like a 
    boring job to do like in 3.1 - as it still does not assure that
    modules are reloaded only once and in the correct order.

    A simple-but-stupid reload-all-modules-known-to-python fix did NOT
    work, as subclasses in different modules get totally confused being
    subclassed by some class that no longer exist. The problem is
    reloading in the correct order, and only once per request.

    Is there a nice way to UNLOAD all classes?  I'm thinking of
    something like /del sys.modules['mymodule']/ - but.. I'll have to
    check the module to see if it's mine or some internal python module
    first :=) )


-- 
Stian S?iland               Work toward win-win situation. Win-lose
Trondheim, Norway           is where you win and the other lose.
http://www.soiland.no/      Lose-lose and lose-win are left as an
                            exercise to the reader.  [Limoncelli/Hogan]


From stian at soiland.no  Mon Jul  7 18:19:49 2003
From: stian at soiland.no (Stian =?iso-8859-1?Q?S=F8iland?=)
Date: Fri Jan  9 21:53:42 2004
Subject: [mod_python] mod_python weirdness, maybe related to importing?
In-Reply-To: <20030616005419.GM8892@tummy.com>
References: <200306160025.KAA13272@lightning.itga.com.au>
	<20030616005419.GM8892@tummy.com>
Message-ID: <20030707161949.GB614@itea.ntnu.no>

On 1970-01-01 01:00:00, Sean Reifschneider wrote:

> Also, I'm running into cases where I'm setting values within modules in
> my handler, and then when I call code in the module those values are
> reset.  I've resorted to shoving request-persistent data into
> __builtins__, which works around the latter problem, and re-structuring
> some code so that my entire object heirarchy *CAN* be imported all at
> once.

Btw, a good tip to store some info from here to there is to store them
as attributes in the req object. We've created req.session by loading it
in the PythonFixupHandler mentioned in an earlier post, req.session is
available to all subsequent request handlers.

(and in some cases, weird enough, after the request is finished, the
attribute still remains in req.session for the NEXT call.. leading
to..
  
  def fixuphandler(req):
      req.session = None
)




-- 
Stian S?iland               Work toward win-win situation. Win-lose
Trondheim, Norway           is where you win and the other lose.
http://www.soiland.no/      Lose-lose and lose-win are left as an
                            exercise to the reader.  [Limoncelli/Hogan]

From stian at soiland.no  Mon Jul  7 18:33:44 2003
From: stian at soiland.no (Stian =?iso-8859-1?Q?S=F8iland?=)
Date: Fri Jan  9 21:53:42 2004
Subject: [mod_python] mod_python weirdness, maybe related to importing?
Message-ID: <20030707163344.GE614@itea.ntnu.no>

On 1970-01-01 01:00:00, Sean Reifschneider wrote:

> Also, I'm running into cases where I'm setting values within modules in
> my handler, and then when I call code in the module those values are
> reset.  I've resorted to shoving request-persistent data into
> __builtins__, which works around the latter problem, and re-structuring
> some code so that my entire object heirarchy *CAN* be imported all at
> once.

Btw, a good tip to store some info from here to there is to store them
as attributes in the req object. We've created req.session by loading it
in the PythonFixupHandler mentioned in an earlier post, req.session is
available to all subsequent request handlers.

(and in some cases, weird enough, after the request is finished, the
attribute still remains in req.session for the NEXT call.. leading
to..
  
  def fixuphandler(req):
      req.session = None
)




-- 
Stian S?iland               Work toward win-win situation. Win-lose
Trondheim, Norway           is where you win and the other lose.
http://www.soiland.no/      Lose-lose and lose-win are left as an
                            exercise to the reader.  [Limoncelli/Hogan]

From stian at soiland.no  Mon Jul  7 18:33:14 2003
From: stian at soiland.no (Stian =?iso-8859-1?Q?S=F8iland?=)
Date: Fri Jan  9 21:53:42 2004
Subject: [mod_python] mod_python weirdness, maybe related to importing?
Message-ID: <20030707163314.GD614@itea.ntnu.no>

(as I found out, posting before subscribing is a bad idea =) 

On 1970-01-01 01:00:00, Sean Reifschneider wrote:
   ~~~~
(.. importing the mail archives appearantly does not work that well
anymore :=) )

> On Tue, Jun 10, 2003 at 09:12:46AM +0200, David Fraser wrote:
> >Do you mean you're using this import mechanism when you have the problem 
> >with jotweb.input.Request below?
> 
> I mean that the imp module call is loading a module which then does an
> "import jotweb.input".  If in the jotweb I don't have the __init__.py
> import all sub-packages or sub-modules, I will get an AttributeError
> such as:
> 
>   AttributeError: 'module' object has no attribute 'input'

I can confirm the very same problem. We've been scratching our heads
today.

[ in this post I'll be quoting python code like /print "Python example"/ ]


We're using mod_python.publisher as PythonHandler, and have some
library functions in /usr/local/nav/navme/lib/python.

As our PythonPath seems to be totally mucked up, refering to
/usr/lib/python and so on, we .. as a quickfix.. set it manually

PythonPath "['', '/usr/local/lib/python2.2/site-packages',
    '/usr/lib/apache/python/lib/python2.2',
    '/usr/lib/apache/python/lib/python2.2/plat-linux2',
    '/usr/lib/apache/python/lib/python2.2/lib-tk',
    '/usr/lib/apache/python/lib/python2.2/lib-dynload',
    '/usr/lib/apache/python/lib/python2.2/site-packages',
    '/usr/local/nav/navme/lib/python',
    '/usr/local/lib/python2.2/site-packages', '.']"

(/usr/lib/apache/python/lib/python2.2 is our threadless installation,
this is Apache/1.3.27 (Unix) (Red-Hat/Linux) mod_python/2.7.8
Python/2.2.2 mod_ssl/2.8.12 OpenSSL/0.9.6b PHP/4.1.2)


The problem was weird, in a method logout() in index.py, we try
/from nav.web import state/. This always fail, both if we do it on a
module level or inside the function.

However, /from nav.web import auth/ works fine. The permissions are
perfect, there are no .pyc-files hanging around, and there is really no
big differences between the two files.

Actually we found out that symlinking nav/web to nav/webb - and trying
/from nav.webb import auth/  WORKED, suggesting some problems with
caching. Several apache-restarts gives no more help.

Using /usr/lib/apache/python/lib/python2.2/bin/python from the shell,
running as httpd, with the same PythonPath as above (verified by
req.write("%s" % sys.path)  ), from nav import auth works perfect.


The 'fix' you suggested, using import auth in nav/web/__init__.py - DID
work, however, as in your case, there is no reason why this should be
neccessary. 

In SOME of the cases in this testing, the error message is not from
/usr/local/nav/navme/apache/webroot/index.py (where the import actually
happens), but from mod_python/apache.py in the function import_module.
This function looks pretty weird to me, I tried adding some debug
sentences to follow the execution paths.


However, it turns out that our trouble-module nav.web.state is used as a
fixup handler as well, PythonFixupHandler nav.web.state.

Renaming to /PythonFixupHandler nav.webb.state/ removes the bug, 
/from nav.web import state/  suddenly works again.


So in our case, the problem is related to the module being used both in
handlers and imported by submodules. Appearently the errors from
mod_python.apache.import_module appears only those times the
PythonFixupHandler won't load. 

(debug messages reveal that import_module is NOT called by the normal
import sentence - that's good, as I couldn't understand how it could
have been called at that time :=) )



However, the problem is still unsolved, although the __init__.py-import
is  a working workaround (the symlink magic is NOT! :=) )

Is your problem-module a part of other headers (or imports) as well?


    (our team is also very pissed of by the need to restart apache every
    minute to force reloading of all modules.  It's seems like a 
    boring job to do like in 3.1 - as it still does not assure that
    modules are reloaded only once and in the correct order.

    A simple-but-stupid reload-all-modules-known-to-python fix did NOT
    work, as subclasses in different modules get totally confused being
    subclassed by some class that no longer exist. The problem is
    reloading in the correct order, and only once per request.

    Is there a nice way to UNLOAD all classes?  I'm thinking of
    something like /del sys.modules['mymodule']/ - but.. I'll have to
    check the module to see if it's mine or some internal python module
    first :=) )


-- 
Stian S?iland               Work toward win-win situation. Win-lose
Trondheim, Norway           is where you win and the other lose.
http://www.soiland.no/      Lose-lose and lose-win are left as an
                            exercise to the reader.  [Limoncelli/Hogan]

----- End forwarded message -----

-- 
Stian S?iland               Work toward win-win situation. Win-lose
Trondheim, Norway           is where you win and the other lose.
http://www.soiland.no/      Lose-lose and lose-win are left as an
                            exercise to the reader.  [Limoncelli/Hogan]

From jafo at tummy.com  Tue Jul  8 01:42:00 2003
From: jafo at tummy.com (Sean Reifschneider)
Date: Fri Jan  9 21:53:42 2004
Subject: [mod_python] mod_python weirdness, maybe related to importing?
In-Reply-To: <20030707161949.GB614@itea.ntnu.no>
References: <200306160025.KAA13272@lightning.itga.com.au>
	<20030616005419.GM8892@tummy.com> <20030707161949.GB614@itea.ntnu.no>
Message-ID: <20030708074200.GH1996@tummy.com>

On Mon, Jul 07, 2003 at 06:19:49PM +0200, Stian S?iland wrote:
>Btw, a good tip to store some info from here to there is to store them
>as attributes in the req object. We've created req.session by loading it

Yeah, unfortunately I can't really use that.  My handler calls into
SimpleTAL, and the code that really needs to use the extra data no
longer has access to the request object.

Sean
-- 
 *** Quits: TITANIC (Excess Flood)
Sean Reifschneider, Member of Technical Staff <jafo@tummy.com>
tummy.com, ltd. - Linux Consulting since 1995.  Qmail, Python, SysAdmin
      Back off man. I'm a scientist.   http://HackingSociety.org/
From matt at pollenation.net  Wed Jul  9 17:35:26 2003
From: matt at pollenation.net (Matt Goodall)
Date: Fri Jan  9 21:53:42 2004
Subject: [mod_python] missing path element in path_info
Message-ID: <1057768526.27471.335.camel@localhost>

Hi,

Over in the world of Albatross
(http://www.object-craft.com.au/projects/albatross/) we've been playing
with path_info and have come across something that we don't quite
understand.

Here's some example code to demonstrate:

----- .htaccess -----
DirectoryIndex app.py
SetHandler python-program
PythonHandler app
-----

----- app.py -----
from mod_python import apache
                                                                                def handler(req):
    req.content_type = 'text/plain'
    req.send_http_header()

    req.write('the_request: %s\n' % req.the_request)
    req.write('unparsed_uri: %s\n' % req.unparsed_uri)
    req.write('uri: %s\n' % req.uri)
    req.write('filename: %s\n' % req.filename)
    req.write('path_info: %s\n' % req.path_info)

    return apache.OK
-----

If I put those files in /~matt/test on the web server then this is what
I see for each URL:

        = URL /~matt/test/1/2/3 =
        the_request: GET /~matt/test/app.py/1/2/3 HTTP/1.1
        unparsed_uri: /~matt/test/app.py/1/2/3
        uri: /~matt/test/app.py/1/2/3
        filename: /home/matt/public_html/test/app.py
        path_info: /1/2/3
        
        = /~matt/test/app.py/1/2/3 =
        the_request: GET /~matt/test/app.py/1/2/3 HTTP/1.1
        unparsed_uri: /~matt/test/app.py/1/2/3
        uri: /~matt/test/app.py/1/2/3
        filename: /home/matt/public_html/test/app.py
        path_info: /1/2/3
        
        = /~matt/test/1/2/3 =
        the_request: GET /~matt/test/1/2/3 HTTP/1.1
        unparsed_uri: /~matt/test/1/2/3
        uri: /~matt/test/1/2/3
        filename: /home/matt/public_html/test/1
        path_info: /2/3
        
The first two are as expected but the last one drops app.py completely
and thinks that the first element of path_info is part of the filename.

Can anyone explain this?

Server details:

	Apache 1.3.27
	mod_python 2.7.8
	Linux 2.4.x, Gentoo and Debian (I think).

Thanks in advance.

- Matt

-- 
Matt Goodall, Pollenation Internet Ltd
w: http://www.pollenation.net
e: matt@pollenation.net
From grisha at modpython.org  Wed Jul  9 13:10:30 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:42 2004
Subject: [mod_python] missing path element in path_info
In-Reply-To: <1057768526.27471.335.camel@localhost>
References: <1057768526.27471.335.camel@localhost>
Message-ID: <20030709130315.K99051@onyx.ispol.com>


I am not sure I understand the difference between the first two, the
request seems to be the same. What are the url's that you're trying to
access (from the browser point of view)?

In the last one, the reason "1" is not part of path_info: path_info is
something apache figures out. I think the rule is that it sees that "test"
is a directory, and the next thing after it isn't, thus, it must refer to
a file (whether or not the file exists doesn't matter). Everything after a
file is path_info.

On Wed, 9 Jul 2003, Matt Goodall wrote:

> Hi,
>
> Over in the world of Albatross
> (http://www.object-craft.com.au/projects/albatross/) we've been playing
> with path_info and have come across something that we don't quite
> understand.
>
> Here's some example code to demonstrate:
>
> ----- .htaccess -----
> DirectoryIndex app.py
> SetHandler python-program
> PythonHandler app
> -----
>
> ----- app.py -----
> from mod_python import apache
>                                                                                 def handler(req):
>     req.content_type = 'text/plain'
>     req.send_http_header()
>
>     req.write('the_request: %s\n' % req.the_request)
>     req.write('unparsed_uri: %s\n' % req.unparsed_uri)
>     req.write('uri: %s\n' % req.uri)
>     req.write('filename: %s\n' % req.filename)
>     req.write('path_info: %s\n' % req.path_info)
>
>     return apache.OK
> -----
>
> If I put those files in /~matt/test on the web server then this is what
> I see for each URL:
>
>         = URL /~matt/test/1/2/3 =
>         the_request: GET /~matt/test/app.py/1/2/3 HTTP/1.1
>         unparsed_uri: /~matt/test/app.py/1/2/3
>         uri: /~matt/test/app.py/1/2/3
>         filename: /home/matt/public_html/test/app.py
>         path_info: /1/2/3
>
>         = /~matt/test/app.py/1/2/3 =
>         the_request: GET /~matt/test/app.py/1/2/3 HTTP/1.1
>         unparsed_uri: /~matt/test/app.py/1/2/3
>         uri: /~matt/test/app.py/1/2/3
>         filename: /home/matt/public_html/test/app.py
>         path_info: /1/2/3
>
>         = /~matt/test/1/2/3 =
>         the_request: GET /~matt/test/1/2/3 HTTP/1.1
>         unparsed_uri: /~matt/test/1/2/3
>         uri: /~matt/test/1/2/3
>         filename: /home/matt/public_html/test/1
>         path_info: /2/3
>
> The first two are as expected but the last one drops app.py completely
> and thinks that the first element of path_info is part of the filename.
>
> Can anyone explain this?
>
> Server details:
>
> 	Apache 1.3.27
> 	mod_python 2.7.8
> 	Linux 2.4.x, Gentoo and Debian (I think).
>
> Thanks in advance.
>
> - Matt
>
> --
> Matt Goodall, Pollenation Internet Ltd
> w: http://www.pollenation.net
> e: matt@pollenation.net
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From matt at pollenation.net  Wed Jul  9 20:36:12 2003
From: matt at pollenation.net (Matt Goodall)
Date: Fri Jan  9 21:53:42 2004
Subject: [mod_python] missing path element in path_info
In-Reply-To: <20030709130315.K99051@onyx.ispol.com>
References: <1057768526.27471.335.camel@localhost>
	 <20030709130315.K99051@onyx.ispol.com>
Message-ID: <1057779371.28628.484.camel@localhost>

On Wed, 2003-07-09 at 18:10, Gregory (Grisha) Trubetskoy wrote:
> I am not sure I understand the difference between the first two, the
> request seems to be the same. What are the url's that you're trying to
> access (from the browser point of view)?

OK, I'm not having a good day ... I can't even copy and paste correctly
anymore! The example output should have been as follows, where the
browser URL is between the '= =', just above the request attribute list.

  = /~matt/test/ =
  the_request: GET /~matt/test/ HTTP/1.1
  unparsed_uri: /~matt/test/app.py
  uri: /~matt/test/app.py
  filename: /home/matt/public_html/test/app.py
  path_info:

  = /~matt/test/app.py/1/2/3 =
  the_request: GET /~matt/test/app.py/1/2/3 HTTP/1.1
  unparsed_uri: /~matt/test/app.py/1/2/3
  uri: /~matt/test/app.py/1/2/3
  filename: /home/matt/public_html/test/app.py
  path_info: /1/2/3

  = /~matt/test/1/2/3 =
  the_request: GET /~matt/test/1/2/3 HTTP/1.1
  unparsed_uri: /~matt/test/1/2/3
  uri: /~matt/test/1/2/3
  filename: /home/matt/public_html/test/1
  path_info: /2/3

The first example demonstrates that app.py is sometimes part of the
filename even when it is not part of the browser's URL. As I mentioned
before, it is only example 3 that was a surprise.

> 
> In the last one, the reason "1" is not part of path_info: path_info is
> something apache figures out. I think the rule is that it sees that "test"
> is a directory, and the next thing after it isn't, thus, it must refer to
> a file (whether or not the file exists doesn't matter). Everything after a
> file is path_info.

I think this answers the original question anyway.

Is there actually a foolproof way of working out the correct base uri of
the application (i.e. the path, with or without the app.py) from the
information in the request alone? The results I would like are below but
I'm not convinced enough information is available:

  URL                        app base uri         path info
  -------------------------  -------------------  ----------
  /~matt/test/               /~matt/test          /
  /~matt/test/app.py/1/2/3   /~matt/test/app.py   /1/2/3
  /~matt/test/1/2/3          /~matt/test          /1/2/3


Of course, the alternative is for the developer to specify the base uri
in configuration code which is how Albatross currently works.

Thanks, Matt


> 
> On Wed, 9 Jul 2003, Matt Goodall wrote:
> 
> > Hi,
> >
> > Over in the world of Albatross
> > (http://www.object-craft.com.au/projects/albatross/) we've been playing
> > with path_info and have come across something that we don't quite
> > understand.
> >
> > Here's some example code to demonstrate:
> >
> > ----- .htaccess -----
> > DirectoryIndex app.py
> > SetHandler python-program
> > PythonHandler app
> > -----
> >
> > ----- app.py -----
> > from mod_python import apache
> >                                                                                 def handler(req):
> >     req.content_type = 'text/plain'
> >     req.send_http_header()
> >
> >     req.write('the_request: %s\n' % req.the_request)
> >     req.write('unparsed_uri: %s\n' % req.unparsed_uri)
> >     req.write('uri: %s\n' % req.uri)
> >     req.write('filename: %s\n' % req.filename)
> >     req.write('path_info: %s\n' % req.path_info)
> >
> >     return apache.OK
> > -----
> >
> > If I put those files in /~matt/test on the web server then this is what
> > I see for each URL:
> >
> >         = URL /~matt/test/1/2/3 =
> >         the_request: GET /~matt/test/app.py/1/2/3 HTTP/1.1
> >         unparsed_uri: /~matt/test/app.py/1/2/3
> >         uri: /~matt/test/app.py/1/2/3
> >         filename: /home/matt/public_html/test/app.py
> >         path_info: /1/2/3
> >
> >         = /~matt/test/app.py/1/2/3 =
> >         the_request: GET /~matt/test/app.py/1/2/3 HTTP/1.1
> >         unparsed_uri: /~matt/test/app.py/1/2/3
> >         uri: /~matt/test/app.py/1/2/3
> >         filename: /home/matt/public_html/test/app.py
> >         path_info: /1/2/3
> >
> >         = /~matt/test/1/2/3 =
> >         the_request: GET /~matt/test/1/2/3 HTTP/1.1
> >         unparsed_uri: /~matt/test/1/2/3
> >         uri: /~matt/test/1/2/3
> >         filename: /home/matt/public_html/test/1
> >         path_info: /2/3
> >
> > The first two are as expected but the last one drops app.py completely
> > and thinks that the first element of path_info is part of the filename.
> >
> > Can anyone explain this?
> >
> > Server details:
> >
> > 	Apache 1.3.27
> > 	mod_python 2.7.8
> > 	Linux 2.4.x, Gentoo and Debian (I think).
> >
> > Thanks in advance.
> >
> > - Matt
> >
> > --
> > Matt Goodall, Pollenation Internet Ltd
> > w: http://www.pollenation.net
> > e: matt@pollenation.net
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
-- 
Matt Goodall, Pollenation Internet Ltd
w: http://www.pollenation.net
e: matt@pollenation.net
From grisha at modpython.org  Wed Jul  9 16:32:39 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:42 2004
Subject: [mod_python] missing path element in path_info
In-Reply-To: <1057779371.28628.484.camel@localhost>
References: <1057768526.27471.335.camel@localhost>
	<20030709130315.K99051@onyx.ispol.com>
	<1057779371.28628.484.camel@localhost>
Message-ID: <20030709160740.D600@onyx.ispol.com>



On Wed, 9 Jul 2003, Matt Goodall wrote:

> Is there actually a foolproof way of working out the correct base uri of
> the application (i.e. the path, with or without the app.py) from the
> information in the request alone? The results I would like are below but
> I'm not convinced enough information is available:
>
>   URL                        app base uri         path info
>   -------------------------  -------------------  ----------
>   /~matt/test/               /~matt/test          /
>   /~matt/test/app.py/1/2/3   /~matt/test/app.py   /1/2/3
>   /~matt/test/1/2/3          /~matt/test          /1/2/3

Hmm... This is a flawed question, since path_info in the last line is
really /2/3.

If you look at http://cgi-spec.golux.com/draft-coar-cgi-v11-03.txt section
6.1.6, it formally defines what path info is. However, it relies on the
notion of a "script", which is always present in CGI, but is meaningless
in mod_python since we're not running scripts but provide phase handlers
for apache...

Anyway, the answer to your question is that it is impossible or very
difficult to do, because the transformation from "~matt/test" to
"/home/matt/public_html/test" is not "reversible" and is hidden somewhere
in apache config, yet this mapping is necessary to produce the results
above.

Grisha
From matt at pollenation.net  Wed Jul  9 22:20:10 2003
From: matt at pollenation.net (Matt Goodall)
Date: Fri Jan  9 21:53:42 2004
Subject: [mod_python] missing path element in path_info
In-Reply-To: <20030709160740.D600@onyx.ispol.com>
References: <1057768526.27471.335.camel@localhost>
	<20030709130315.K99051@onyx.ispol.com>
	<20030709160740.D600@onyx.ispol.com>
Message-ID: <1057785610.27471.509.camel@localhost>

On Wed, 2003-07-09 at 21:32, Gregory (Grisha) Trubetskoy wrote:
> Anyway, the answer to your question is that it is impossible or very
> difficult to do, because the transformation from "~matt/test" to
> "/home/matt/public_html/test" is not "reversible" and is hidden somewhere
> in apache config, yet this mapping is necessary to produce the results
> above.

Thanks Grisha.

That's the conclusion I had come to from dumping anything available in
the request object to a log file, but it was worth checking here too.

Cheers, Matt

-- 
Matt Goodall, Pollenation Internet Ltd
w: http://www.pollenation.net
e: matt@pollenation.net
From jmartinson at info234.com  Thu Jul 10 17:00:03 2003
From: jmartinson at info234.com (Jacob Martinson)
Date: Fri Jan  9 21:53:42 2004
Subject: [mod_python] Problem with win32 installation - can't authenticate
Message-ID: <5.2.1.1.0.20030710135957.00b2f050@localhost>

My problem: after installing apache(win32), python(win32) and 
modpython(win32) the basic test works for returning 'hello world' but when 
i try the authentication example from the documentation, I am not able to 
authenticate.  After a little investigation, I find that both req.user and 
req.get_basic_auth_pw() are None.

I am prompted for username/password, but I can't authenticate 
successfully.  Also, if I ignore req.user and password and just return 
apache.OK, it allows me to access the file I am requesting.

Here's the relevant parts of my apache config:

LoadModule python_module modules/mod_python.so

<Directory "c:\Documents and Settings\jmartinson\docroot">
   AddHandler python-program .py
   PythonHandler mptest
   PythonDebug On
</Directory>

<Directory "c:\Documents and Settings\jmartinson\docroot\test1">
     AddHandler python-program .py
     PythonHandler myscript
     PythonAuthenHandler myscript
     PythonDebug Off
     AuthType Basic
     AuthName "Restricted Area"
     require valid-user
</Directory>

Here's my handler (myscript.py):

from mod_python import apache
def authenhandler(req):
         user = req.user
         pw = req.get_basic_auth_pw()
         req.write( str(user) + ':' + str(pw) + str('\n') )
         return apache.OK

         if user == "spam":
                 return apache.OK
         else:
                 return apache.HTTP_UNAUTHORIZED

I put in the first "return apache.OK" for testing purposes.  If I take that 
out authentication still won't work.  I also took out the second half of 
the if statement testing the password too.

Version info:
apache: 
http://apache.oregonstate.edu/httpd/binaries/win32/apache_2.0.47-win32-x86-no_ssl.msi
modpython: 
http://apache.webmeta.com/httpd/modpython/win/3.0.3/mod_python-3.0.3.win32.exe
python: http://python.org/ftp/python/2.2.3/Python-2.2.3.exe

I would much rather be using modpython under a unix environment, but I am 
doing this on my work laptop and I don't have the option of eliminating the 
Windows environment and I can't get apache to compile under cygwin.

Any information or suggestions are greatly appreciated!

-Jacob 

From grisha at modpython.org  Thu Jul 10 19:50:38 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:42 2004
Subject: [mod_python] Problem with win32 installation - can't authenticate
In-Reply-To: <5.2.1.1.0.20030710135957.00b2f050@localhost>
References: <5.2.1.1.0.20030710135957.00b2f050@localhost>
Message-ID: <20030710194534.K53265@onyx.ispol.com>



On Thu, 10 Jul 2003, Jacob Martinson wrote:

> I am prompted for username/password, but I can't authenticate
> successfully.  Also, if I ignore req.user and password and just return
> apache.OK, it allows me to access the file I am requesting.

When you say "can't authenticate" - does the browser come back with the
user/password dialog, or some other thing?

I just tried your example, and it worked for me.... In the old versions of
apache you had to call to call get_basic_auth_pw() before trying to read
value of req.user, but that's not longer true I think. May be tried
swapping those two lines, but I think the problem is elsewhere.

Grisha
From jmartinson at info234.com  Thu Jul 10 18:55:49 2003
From: jmartinson at info234.com (Jacob Martinson)
Date: Fri Jan  9 21:53:42 2004
Subject: [mod_python] Problem with win32 installation - can't
  authenticate
In-Reply-To: <20030710194534.K53265@onyx.ispol.com>
References: <5.2.1.1.0.20030710135957.00b2f050@localhost>
 <5.2.1.1.0.20030710135957.00b2f050@localhost>
Message-ID: <5.2.1.1.0.20030710185116.00b2ecd8@localhost>

Grisha,

The browser comes back with a prompt again a number of times and then 
eventually I end up at the access forbidden page.  The strangest thing just 
happened though... I switched the order of getting the username and 
password, and it started working!  I haven't changed anything in the apache 
config between then and now.

Thanks!

-Jacob

At 07:50 PM 7/10/2003 -0400, Gregory (Grisha) Trubetskoy wrote:


>On Thu, 10 Jul 2003, Jacob Martinson wrote:
>
> > I am prompted for username/password, but I can't authenticate
> > successfully.  Also, if I ignore req.user and password and just return
> > apache.OK, it allows me to access the file I am requesting.
>
>When you say "can't authenticate" - does the browser come back with the
>user/password dialog, or some other thing?
>
>I just tried your example, and it worked for me.... In the old versions of
>apache you had to call to call get_basic_auth_pw() before trying to read
>value of req.user, but that's not longer true I think. May be tried
>swapping those two lines, but I think the problem is elsewhere.
>
>Grisha

From grisha at modpython.org  Thu Jul 10 21:00:37 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:42 2004
Subject: [mod_python] Problem with win32 installation - can't
	authenticate
In-Reply-To: <5.2.1.1.0.20030710185116.00b2ecd8@localhost>
References: <5.2.1.1.0.20030710135957.00b2f050@localhost>
	<5.2.1.1.0.20030710185116.00b2ecd8@localhost>
Message-ID: <20030710205649.Y56783@onyx.ispol.com>


Thanks Jacob for the config -

I figured it out - it has to do with the placement of LoadModule in the
config file. I tend to put mine first, which makes mod_auth first in line
to process, and it internally calls get_basic_auth_pw() thereby filling in
the req.user value. But if you place mod_python after mod_auth, then
mod_python is called first, and req->user is NULL (or req.user is None).

I'll make sure this is corrected in the docs for the next release.

Grisha

On Thu, 10 Jul 2003, Jacob Martinson wrote:

> Grisha,
>
> The browser comes back with a prompt again a number of times and then
> eventually I end up at the access forbidden page.  The strangest thing just
> happened though... I switched the order of getting the username and
> password, and it started working!  I haven't changed anything in the apache
> config between then and now.
>
> Thanks!
>
> -Jacob
>
> At 07:50 PM 7/10/2003 -0400, Gregory (Grisha) Trubetskoy wrote:
>
>
> >On Thu, 10 Jul 2003, Jacob Martinson wrote:
> >
> > > I am prompted for username/password, but I can't authenticate
> > > successfully.  Also, if I ignore req.user and password and just return
> > > apache.OK, it allows me to access the file I am requesting.
> >
> >When you say "can't authenticate" - does the browser come back with the
> >user/password dialog, or some other thing?
> >
> >I just tried your example, and it worked for me.... In the old versions of
> >apache you had to call to call get_basic_auth_pw() before trying to read
> >value of req.user, but that's not longer true I think. May be tried
> >swapping those two lines, but I think the problem is elsewhere.
> >
> >Grisha
>
From jmartinson at info234.com  Thu Jul 10 20:02:22 2003
From: jmartinson at info234.com (Jacob Martinson)
Date: Fri Jan  9 21:53:42 2004
Subject: [mod_python] Problem with win32 installation - can't 
  authenticate
In-Reply-To: <20030710205649.Y56783@onyx.ispol.com>
References: <5.2.1.1.0.20030710185116.00b2ecd8@localhost>
 <5.2.1.1.0.20030710135957.00b2f050@localhost>
 <5.2.1.1.0.20030710135957.00b2f050@localhost>
 <5.2.1.1.0.20030710185116.00b2ecd8@localhost>
Message-ID: <5.2.1.1.0.20030710200107.00ba7598@localhost>

Thanks again for the excellent and fast response!!!

At 09:00 PM 7/10/2003 -0400, Gregory (Grisha) Trubetskoy wrote:

>Thanks Jacob for the config -
>
>I figured it out - it has to do with the placement of LoadModule in the
>config file. I tend to put mine first, which makes mod_auth first in line
>to process, and it internally calls get_basic_auth_pw() thereby filling in
>the req.user value. But if you place mod_python after mod_auth, then
>mod_python is called first, and req->user is NULL (or req.user is None).
>
>I'll make sure this is corrected in the docs for the next release.
>
>Grisha
>
>On Thu, 10 Jul 2003, Jacob Martinson wrote:
>
> > Grisha,
> >
> > The browser comes back with a prompt again a number of times and then
> > eventually I end up at the access forbidden page.  The strangest thing just
> > happened though... I switched the order of getting the username and
> > password, and it started working!  I haven't changed anything in the apache
> > config between then and now.
> >
> > Thanks!
> >
> > -Jacob
> >
> > At 07:50 PM 7/10/2003 -0400, Gregory (Grisha) Trubetskoy wrote:
> >
> >
> > >On Thu, 10 Jul 2003, Jacob Martinson wrote:
> > >
> > > > I am prompted for username/password, but I can't authenticate
> > > > successfully.  Also, if I ignore req.user and password and just return
> > > > apache.OK, it allows me to access the file I am requesting.
> > >
> > >When you say "can't authenticate" - does the browser come back with the
> > >user/password dialog, or some other thing?
> > >
> > >I just tried your example, and it worked for me.... In the old versions of
> > >apache you had to call to call get_basic_auth_pw() before trying to read
> > >value of req.user, but that's not longer true I think. May be tried
> > >swapping those two lines, but I think the problem is elsewhere.
> > >
> > >Grisha
> >

From dustin at ywlcs.org  Thu Jul 10 21:31:20 2003
From: dustin at ywlcs.org (Dustin Mitchell)
Date: Fri Jan  9 21:53:42 2004
Subject: [mod_python] Using shared memory to do global persistence
In-Reply-To: <20030710215743.V56783@onyx.ispol.com>
References: <200306250732.15699.jgardner@jonathangardner.net>
	<20030626183642.GB5652@lyra.org> <20030708153302.C69691@onyx.ispol.com>
	<20030710215743.V56783@onyx.ispol.com>
Message-ID: <20030711023119.GI18379@eleanor.internal.ywlcs.org>

On Thu, Jul 10, 2003 at 10:12:26PM -0400, Gregory (Grisha) Trubetskoy wrote:
> 1. Something using or similar to POSH. This would rule, but it's too much
> work. Posh also relies on it having the cotrol over forking(), which won't
> work in our situation (i think).

Wouldn't a child_init hook do the trick?  That would mean, however,
that all shared objects had to be created (in Python) before child
initializations..

Dustin

-- 

  Dustin Mitchell
  dustin@ywlcs.org/djmitche@alumni.uchicago.edu
  http://people.cs.uchicago.edu/~dustin/
From Denis.Walrave at trema.com  Fri Jul 11 19:04:12 2003
From: Denis.Walrave at trema.com (Denis Walrave)
Date: Fri Jan  9 21:53:42 2004
Subject: [mod_python] apache.py typo fix... ?
Message-ID: <2F520D7DB7B17E4E9EC4ADEC448778F4013B7A89@labsex1.corp.trema.com>

$Id: apache.py,v 1.68 2003/02/28 04:55:15 grisha Exp $

 

def restore_nocgi(sav_env, si, so):

    """ see setup_cgi() """

 

    osenv = os.environ

 

    # restore env

    for k in osenv.keys():

        del osenv[k]

    for k in sav_env:

        osenv[k] = env[k] ######## I would suggest 'sav_env[k]'

 

    sys.stdout = si

    sys.stdin = so

 

Denis Walrave

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20030711/2f640737/attachment-0001.htm
From fitnah55 at hotmail.com  Wed Jul 16 11:49:00 2003
From: fitnah55 at hotmail.com (k d)
Date: Fri Jan  9 21:53:42 2004
Subject: [mod_python] 
	apache API and mod_python <-> protocol module integration
Message-ID: <BAY1-F124Z7fIZHO1g400002f0f@hotmail.com>

alright i'm just starting to look into this to see how feasable it is and 
what has to be done

if anyone has any comments on how the mod_python handler can be invoked 
through a protocol module such that the primary codebase of a particular 
application can be reused in multiple gateways, i'd appreciate it

basically what i'm looking at right now is a low level telnet protocol 
module that is reasonably transparent... that can be augmented to support 
full telnet, pop/3, imap, smtp, whatever... but that has sufficient design 
to invoke a mod_python handler, so that the pop/3 could be implemented in 
python, or whatever would be added on top.. (or potentially the pop/3 could 
be added directly to the protocol module)

the basic idea is that apache2 by default accepts http like connections, 
which aren't conducive to the synchronous communication of telnet..  
keep-alive is vaguely similar but not good enough for the purposes of 
allowing a telnet or pop/3 gateway

i've never looked at the apache2 api before so i'm just digging into that 
today

_________________________________________________________________
MSN 8 with e-mail virus protection service: 2 months FREE*  
http://join.msn.com/?page=features/virus

From azaroth at liverpool.ac.uk  Wed Jul 16 17:17:19 2003
From: azaroth at liverpool.ac.uk (Robert Sanderson)
Date: Fri Jan  9 21:53:42 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
 integration
In-Reply-To: <BAY1-F124Z7fIZHO1g400002f0f@hotmail.com>
Message-ID: <Pine.LNX.4.44.0307161709550.2478-100000@gondolin.hist.liv.ac.uk>


> the basic idea is that apache2 by default accepts http like connections, 
> which aren't conducive to the synchronous communication of telnet..  
> keep-alive is vaguely similar but not good enough for the purposes of 
> allowing a telnet or pop/3 gateway

Currently, as I found when implementing Z39.50, it's a real pain as 
there's no way to read in all available data, and if you try to read past 
the end of the available data the read will block.

This makes it useless for something like (say) an IRC or MUD style server 
where there might be data flowing in either direction at any given time.  
Mod_Perl on the other hand has a better system:
http://perl.apache.org/docs/2.0/user/handlers/protocols.html

When I get time, I'm going to look at how to implement this in mod_python, 
but that might not be for a while, so if anyone else wants to weigh in, 
please do so and let me know :)

Rob

-- 
      ,'/:.          Rob Sanderson (azaroth@liverpool.ac.uk)
    ,'-/::::.        http://www.o-r-g.org/~azaroth/
  ,'--/::(@)::.      Special Collections and Archives, extension 3142
,'---/::::::::::.    Nebmedes:  telnet: nebmedes.o-r-g.org 7777
____/:::::::::::::.                WWW:  http://nebmedes.o-r-g.org:8000/
I L L U M I N A T I

From dustin at ywlcs.org  Wed Jul 16 11:33:30 2003
From: dustin at ywlcs.org (Dustin Mitchell)
Date: Fri Jan  9 21:53:42 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
	integration
In-Reply-To: <Pine.LNX.4.44.0307161709550.2478-100000@gondolin.hist.liv.ac.uk>
References: <BAY1-F124Z7fIZHO1g400002f0f@hotmail.com>
	<Pine.LNX.4.44.0307161709550.2478-100000@gondolin.hist.liv.ac.uk>
Message-ID: <20030716163329.GQ18379@eleanor.internal.ywlcs.org>

On Wed, Jul 16, 2003 at 05:17:19PM +0100, Robert Sanderson wrote:
> 
> > the basic idea is that apache2 by default accepts http like connections, 
> > which aren't conducive to the synchronous communication of telnet..  
> > keep-alive is vaguely similar but not good enough for the purposes of 
> > allowing a telnet or pop/3 gateway

There's talk of doing exactly this over on the Apache-dev list (though
doing it in C).  Somebody produced a small DNS server in Apache for a
masters project (netairt -- very cool!) and the apache people had a
short discussion of supporting UDP and telnet-like connections just
like what you describe.  The upshot of this is that right now Apache
really don't support either of these types of connections, even in its
native C.

See the thread beginning:

 Messsage-ID: <Pine.GSO.4.53.0307142254390.25665@flits.cs.vu.nl>
 From: Michal Szymaniak <michal@cs.vu.nl>
 Subject: DNS+HTTP redirection system inside an Apache module

Dustin

-- 

  Dustin Mitchell
  dustin@ywlcs.org/djmitche@alumni.uchicago.edu
  http://people.cs.uchicago.edu/~dustin/
From grisha at modpython.org  Wed Jul 16 13:59:58 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:42 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
 integration
In-Reply-To: <Pine.LNX.4.44.0307161709550.2478-100000@gondolin.hist.liv.ac.uk>
References: <Pine.LNX.4.44.0307161709550.2478-100000@gondolin.hist.liv.ac.uk>
Message-ID: <20030716134923.B92465@onyx.ispol.com>



On Wed, 16 Jul 2003, Robert Sanderson wrote:

> > the basic idea is that apache2 by default accepts http like connections,
> > which aren't conducive to the synchronous communication of telnet..

There is an example of a simple echo module here:

http://www.modpython.org/live/current/doc-html/pyapi-conn.html

> > keep-alive is vaguely similar but not good enough for the purposes of
> > allowing a telnet or pop/3 gateway
>
> Currently, as I found when implementing Z39.50, it's a real pain as
> there's no way to read in all available data, and if you try to read past
> the end of the available data the read will block.

This is not a problem of mod_python or Apache, this is the way sockets
work. If your protocol is such that you know ahead of time how much to
read (e.g. HTTP), then you can request this much data in one read.
Otherwise, you must read in smallest unit sizes of your protocol, which
(I'm guessing) is 1 byte in case of Z39.50.

> This makes it useless for something like (say) an IRC or MUD style
> server where there might be data flowing in either direction at any
> given time.  Mod_Perl on the other hand has a better system:
> http://perl.apache.org/docs/2.0/user/handlers/protocols.html

Mod_perl doesn't do it any differently (unless I'm missing something). I
don't think implementing an IRC or MUD server in mod_perl is going to be
any different.

BTW, if using Apache is not a requirement, then doing something like this
might be easier in twisted (twistedmatrix.com).

Grisha
From dustin at ywlcs.org  Wed Jul 16 13:25:15 2003
From: dustin at ywlcs.org (Dustin Mitchell)
Date: Fri Jan  9 21:53:42 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
	integration
In-Reply-To: <20030716134923.B92465@onyx.ispol.com>
References: <Pine.LNX.4.44.0307161709550.2478-100000@gondolin.hist.liv.ac.uk>
	<20030716134923.B92465@onyx.ispol.com>
Message-ID: <20030716182515.GR18379@eleanor.internal.ywlcs.org>

On Wed, Jul 16, 2003 at 01:59:58PM -0400, Gregory (Grisha) Trubetskoy wrote:
> This is not a problem of mod_python or Apache, this is the way sockets
> work. If your protocol is such that you know ahead of time how much to
> read (e.g. HTTP), then you can request this much data in one read.
> Otherwise, you must read in smallest unit sizes of your protocol, which
> (I'm guessing) is 1 byte in case of Z39.50.

This is not strictly true, as long as you're OK with possibly getting a
bit of *extra* data beyond a particular PDU (a little bit of buffering
can take care of that).  Apache has to do this to read the HTTP header,
which is not of a fixed length.

The socket blocking read interface is structured such that it will block
when *no* data is available, and will return *up to* the quantity
specified in the recv() call if it is available.  However, if some
smaller amount of data is available, that data will be returned
immediately.

To demonstrate, I hacked this together:

from socket import *
s = socket(AF_INET, SOCK_STREAM)
s.bind(("", 9900))
s.listen(5)
while 1:
  ss, sa = s.accept()
  print "Connect from '%s'" % (sa,)
  while 1:
    data = ss.recv(100)
    if not data: break
    print " Received: %s" % `data`
  print "Connection closed from '%s'" % (sa,)

Then connected with telnet and typed "Hello" and "World" on separate
lines.  Telnet, by default, buffers lines of input until a newline, but
you will note that in the two returns from ss.recv(), neither contained
100 bytes of data:

Connect from '('127.0.0.1', 56260)'
 Received: 'Hello\r\n'
 Received: 'World\r\n'
Connection closed from '('127.0.0.1', 56260)'

Further, a loop such as:
  for i in 'hello world': s.send(i)
will produce output like this:

Connect from '('127.0.0.1', 56277)'
 Received: 'h'
 Received: 'ello world'
Connection closed from '('127.0.0.1', 56277)'

Either the client or the server's socket implementation is buffering the
characters because they're appearing so quickly, which cuts down on the
number of recv() calls which must be made.

I can't speak for the Apache sockets API, or the Python interface
thereto, but sockets themselves *do* support this interface (they'd be
pretty useless if they didn't!).  I highly recommend W. Richard
Stevens' TCP/IP Illustrated for an in-depth and very readable
discussion of this and many other crucial implementation details of
TCP/IP.

Dustin

-- 

  Dustin Mitchell
  dustin@ywlcs.org/djmitche@alumni.uchicago.edu
  http://people.cs.uchicago.edu/~dustin/
From fitnah55 at hotmail.com  Wed Jul 16 14:56:14 2003
From: fitnah55 at hotmail.com (k d)
Date: Fri Jan  9 21:53:42 2004
Subject: [mod_python] apache API and mod_python <-> protocol module
	integration
Message-ID: <BAY1-F40gNVRIbQlwhL0000bd01@hotmail.com>

>There is an example of a simple echo module here:
>
>http://www.modpython.org/live/current/doc-html/pyapi-conn.html

whoa... i totally forgot modpython had a connection handler

do you think its possible to get it to work with character mode input and 
proper display environment?  like a fully functional telnet not just a hack?

>BTW, if using Apache is not a requirement, then doing something like this
>might be easier in twisted (twistedmatrix.com).

yeh i checked out twisted but it's really heavy on stuff i don't need, plus 
the multiplexing and python persistency is a requirement, so 
apache2/modpython is a definite must have..

as far as implementing the protocol i can probably dupe code in twisted, but 
its not fully functional either so it'd just serve as a rough sketch to help 
with initial design

the only problems i really see that i might have are getting proper ascii 
transmission and getting hotkey capable character input

i'm super stoked that i don't have to deal with an apache2 protocol module 
to do it though! woohoo!

_________________________________________________________________
STOP MORE SPAM with the new MSN 8 and get 2 months FREE*  
http://join.msn.com/?page=features/junkmail

From chris at vindaloo.com  Wed Jul 16 14:58:49 2003
From: chris at vindaloo.com (Christopher Sean Hilton)
Date: Fri Jan  9 21:53:42 2004
Subject: [mod_python] Getting access to a file from a post.
In-Reply-To: <20030716134923.B92465@onyx.ispol.com>
References: <Pine.LNX.4.44.0307161709550.2478-100000@gondolin.hist.liv.ac.uk>
	<20030716134923.B92465@onyx.ispol.com>
Message-ID: <20030716185849.GA1129@dagobah.pvt.vindaloo.com>

-----BEGIN PGP SIGNED MESSAGE-----

I'm trying to generate an xml transaction handler using apache,
modpython, python and sax. I would like to be able to post a file to
this website/handler with something like curl and have modpython
process the file. Something like

     $ cat MyXmlFile.xml | \
     >   curl https://www.example.com/iface.py/XmlHandler

My python looks like this:

     $ cat /var/www/data/www.example.com/iface.py
     #! /usr/local/bin/python2.1
     
     from mod_python import apache

     def XmlHandler(req):
        XmlData = req.readlines()
        ...

This does not get the contens of the file that I posted, in fact it's
empty. Is there any way short of using traditional CGI of getting this
file?

Thanks in advance and if I'm missing something in the manual please
feel free to give me a poke that sets me in the right direction.

Chris

- -- 
Chris Hilton                                 chilton-at-vindaloo-dot-com
- ------------------------------------------------------------------------
                "All I was doing was trying to get home from work!"
                                                 -- Rosa Parks
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.1 (FreeBSD)

iQEVAwUBPxWgWILaxorQlXotAQE23Qf9Ec2xBSXHtX6JN9QSwocetyTrDqBecpto
5lkvq6YlwGF4M5Ei5eUBFjOmAo3OydM83zKMzdzJTgrlOOr6p/JmAxV0YH3qm7QI
+ON/vfoNDxVsPCeQPU/B1dEwkRdjtT2dMda68Ce8dG6go/1McKwUGxIm7/J4Qifs
Bt02IeGLhu+03VIfm03dROn95P3LxqiuTUXbHiQYky9k23ahQjZ8O3XXb+3fyYa4
E44ZG0O9T/H5Xig1rTrbAASao86HNolgnbKR2zNbivtOblgl/p1KSWofkqfRaLRz
JcT0jlSrQB1RvG2rZUz2qy1EPunZ2YUgS1gR+MmTJBmGTxYnIRCzJw==
=tbTY
-----END PGP SIGNATURE-----

From fitnah55 at hotmail.com  Wed Jul 16 17:00:43 2003
From: fitnah55 at hotmail.com (fitnah55)
Date: Fri Jan  9 21:53:42 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
	integration
In-Reply-To: <20030716134923.B92465@onyx.ispol.com>
Message-ID: <004c01c34bdd$521e02e0$24c0c20a@computer>


hey..

how do i get the connectionhandler to work properly under a virtual host
and/or
just for a particular port?

everything is running off of a single IP address through about 5 domains
and 20 virtual hosts..

i need telnet access potentially across all of the hosts

all of this from the single application framework




> -----Original Message-----
> From: Gregory (Grisha) Trubetskoy [mailto:grisha@modpython.org] 
> Sent: Wednesday, July 16, 2003 2:00 PM
> To: Robert Sanderson
> Cc: k d; mod_python@modpython.org
> Subject: Re: [mod_python] apache API and mod_python <-> 
> protocol module integration
> 
> 
> 
> 
> On Wed, 16 Jul 2003, Robert Sanderson wrote:
> 
> > > the basic idea is that apache2 by default accepts http 
> like connections,
> > > which aren't conducive to the synchronous communication 
> of telnet..
> 
> There is an example of a simple echo module here:
> 
http://www.modpython.org/live/current/doc-html/pyapi-conn.html

> > keep-alive is vaguely similar but not good enough for the purposes
of
> > allowing a telnet or pop/3 gateway
>
> Currently, as I found when implementing Z39.50, it's a real pain as
> there's no way to read in all available data, and if you try to read
past
> the end of the available data the read will block.

This is not a problem of mod_python or Apache, this is the way sockets
work. If your protocol is such that you know ahead of time how much to
read (e.g. HTTP), then you can request this much data in one read.
Otherwise, you must read in smallest unit sizes of your protocol, which
(I'm guessing) is 1 byte in case of Z39.50.

> This makes it useless for something like (say) an IRC or MUD style
> server where there might be data flowing in either direction at any
> given time.  Mod_Perl on the other hand has a better system:
> http://perl.apache.org/docs/2.0/user/handlers/protocols.html

Mod_perl doesn't do it any differently (unless I'm missing something). I
don't think implementing an IRC or MUD server in mod_perl is going to be
any different.

BTW, if using Apache is not a requirement, then doing something like
this
might be easier in twisted (twistedmatrix.com).

Grisha
From fitnah55 at hotmail.com  Wed Jul 16 17:09:50 2003
From: fitnah55 at hotmail.com (fitnah55)
Date: Fri Jan  9 21:53:43 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
	integration
In-Reply-To: <20030716134923.B92465@onyx.ispol.com>
Message-ID: <004d01c34bde$98310c40$24c0c20a@computer>


duh.. add the port to listen

heh

coincidentally, i don't think the echo example is working

[Tue Jul 15 13:03:18 2003] [error] python_connection:
ConnectionDispatch() returned nothing.

hmm

From grisha at modpython.org  Wed Jul 16 20:47:22 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:43 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
 integration
In-Reply-To: <20030716182515.GR18379@eleanor.internal.ywlcs.org>
References: <Pine.LNX.4.44.0307161709550.2478-100000@gondolin.hist.liv.ac.uk>
	<20030716182515.GR18379@eleanor.internal.ywlcs.org>
Message-ID: <20030716161514.Q95093@onyx.ispol.com>


Well, after some looking, apparently the APR does work this way, it's just
that the way the connection handler was coded probably because I didn't
understand APR well enough at the time I made it loop until specified
length of bytes was read (I started out with replicating req.read(), which
knows how much data there is to read).

I attached a patch to the connobject.c that changes its behaviour so that
read(len) will read at most len bytes, and will only block if no data is
available. And len is an optional argument.

Here is a connection handler code that does the exact same thing you had
below. (note that print writes to stdout, which is visible if you run
httpd with -X (stay in foreground) option:

from mod_python import apache

def connectionhandler(conn):

    print "Connect from '%s'" % `conn.remote_addr`

    while 1:
        data = conn.read()
        if not data: break
        print " Received: %s" % `data`

    print "Connection closed from '%s'" % `conn.remote_addr`

    return apache.OK

And here's the result:

$ ./bin/httpd -X
Connect from '('0.0.0.0', 3513)'
 Received: 'Hello\r\n'
 Received: 'World\r\n'
Connection closed from '('0.0.0.0', 3513)'

If I do 'for i in "Hello World"' thing, I get this:

Connect from '('0.0.0.0', 3524)'
 Received: 'Hello World'
Connection closed from '('0.0.0.0', 3524)'

Grisha

On Wed, 16 Jul 2003, Dustin Mitchell wrote:

> On Wed, Jul 16, 2003 at 01:59:58PM -0400, Gregory (Grisha) Trubetskoy wrote:
> > This is not a problem of mod_python or Apache, this is the way sockets
> > work. If your protocol is such that you know ahead of time how much to
> > read (e.g. HTTP), then you can request this much data in one read.
> > Otherwise, you must read in smallest unit sizes of your protocol, which
> > (I'm guessing) is 1 byte in case of Z39.50.
>
> This is not strictly true, as long as you're OK with possibly getting a
> bit of *extra* data beyond a particular PDU (a little bit of buffering
> can take care of that).  Apache has to do this to read the HTTP header,
> which is not of a fixed length.
>
> The socket blocking read interface is structured such that it will block
> when *no* data is available, and will return *up to* the quantity
> specified in the recv() call if it is available.  However, if some
> smaller amount of data is available, that data will be returned
> immediately.
>
> To demonstrate, I hacked this together:
>
> from socket import *
> s = socket(AF_INET, SOCK_STREAM)
> s.bind(("", 9900))
> s.listen(5)
> while 1:
>   ss, sa = s.accept()
>   print "Connect from '%s'" % (sa,)
>   while 1:
>     data = ss.recv(100)
>     if not data: break
>     print " Received: %s" % `data`
>   print "Connection closed from '%s'" % (sa,)
>
> Then connected with telnet and typed "Hello" and "World" on separate
> lines.  Telnet, by default, buffers lines of input until a newline, but
> you will note that in the two returns from ss.recv(), neither contained
> 100 bytes of data:
>
> Connect from '('127.0.0.1', 56260)'
>  Received: 'Hello\r\n'
>  Received: 'World\r\n'
> Connection closed from '('127.0.0.1', 56260)'
>
> Further, a loop such as:
>   for i in 'hello world': s.send(i)
> will produce output like this:
>
> Connect from '('127.0.0.1', 56277)'
>  Received: 'h'
>  Received: 'ello world'
> Connection closed from '('127.0.0.1', 56277)'
>
> Either the client or the server's socket implementation is buffering the
> characters because they're appearing so quickly, which cuts down on the
> number of recv() calls which must be made.
>
> I can't speak for the Apache sockets API, or the Python interface
> thereto, but sockets themselves *do* support this interface (they'd be
> pretty useless if they didn't!).  I highly recommend W. Richard
> Stevens' TCP/IP Illustrated for an in-depth and very readable
> discussion of this and many other crucial implementation details of
> TCP/IP.
>
> Dustin
>
> --
>
>   Dustin Mitchell
>   dustin@ywlcs.org/djmitche@alumni.uchicago.edu
>   http://people.cs.uchicago.edu/~dustin/
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
-------------- next part --------------
Index: connobject.c
===================================================================
RCS file: /home/cvs/httpd-python/src/connobject.c,v
retrieving revision 1.14
diff -u -r1.14 connobject.c
--- connobject.c	23 Jan 2003 22:34:18 -0000	1.14
+++ connobject.c	17 Jul 2003 00:35:28 -0000
@@ -113,8 +113,10 @@
 
     bb = apr_brigade_create(c->pool, c->bucket_alloc);
 
+    bufsize = len == 0 ? HUGE_STRING_LEN : len;
+
     Py_BEGIN_ALLOW_THREADS;
-    rc = ap_get_brigade(c->input_filters, bb, mode, APR_BLOCK_READ, len);
+    rc = ap_get_brigade(c->input_filters, bb, mode, APR_BLOCK_READ, bufsize);
     Py_END_ALLOW_THREADS;
 
     if (! APR_STATUS_IS_SUCCESS(rc)) {
@@ -135,7 +137,6 @@
         return Py_None;
     }
 
-    bufsize = len == 0 ? HUGE_STRING_LEN : len;
     result = PyString_FromStringAndSize(NULL, bufsize);
 
     /* possibly no more memory */
@@ -180,7 +181,7 @@
 	}
 
 
-        if (mode == AP_MODE_GETLINE) {
+        if (mode == AP_MODE_GETLINE || len == 0) {
             apr_bucket_delete(b);
             break;
         }
@@ -208,11 +209,8 @@
 
     long len = 0;
 
-    if (! PyArg_ParseTuple(args, "l|i", &len)) 
+    if (! PyArg_ParseTuple(args, "|l", &len)) 
         return NULL;
-
-    if (len == 0)
-        return PyString_FromString("");
 
     if (len == -1)
         return _conn_read(self->conn, AP_MODE_EXHAUSTIVE, 0);
From fitnah55 at hotmail.com  Wed Jul 16 21:17:04 2003
From: fitnah55 at hotmail.com (fitnah55)
Date: Fri Jan  9 21:53:43 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
	integration
In-Reply-To: <20030716161514.Q95093@onyx.ispol.com>
Message-ID: <005501c34c01$21dc7480$24c0c20a@computer>


hey i really appreciate it i'll check this out, i think mine is screwed
somehow though, as i can't get it to deal with a connection handler at
all

> I attached a patch to the connobject.c that changes its behaviour so
that
> read(len) will read at most len bytes, and will only block if no data
is
> available. And len is an optional argument.
From fitnah55 at hotmail.com  Wed Jul 16 22:01:36 2003
From: fitnah55 at hotmail.com (fitnah55)
Date: Fri Jan  9 21:53:43 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
	integration
In-Reply-To: <20030716161514.Q95093@onyx.ispol.com>
Message-ID: <005a01c34c07$5a7f4c80$24c0c20a@computer>


alright i just added the patch to my build directory.. and it wouldn't
compile.  OKAY.  what is the freakin point of maintaining an accurate
build archive if the freakin thing gets attacked by gremlins??

okay so i tossed the original build (which without a doubt has not been
changed by any legitimate or accidental work of my own on a machine that
isn't accessable from remote), untarred the same archive, patched,
rebuilt,
no problem... damn gremlins

BUT

i'm still getting the same error with the actual connection test...

any ideas?

[Tue Jul 15 17:56:44 2003] [error] python_connection:
ConnectionDispatch() returned nothing.


> -----Original Message-----
> From: mod_python-bounces@modpython.org 
> [mailto:mod_python-bounces@modpython.org] On Behalf Of 
> Gregory (Grisha) Trubetskoy
> Sent: Wednesday, July 16, 2003 8:47 PM
> To: Dustin Mitchell
> Cc: mod_python@modpython.org
> Subject: Re: [mod_python] apache API and mod_python <-> 
> protocol module integration
> 
> 
> 
> Well, after some looking, apparently the APR does work this 
> way, it's just
> that the way the connection handler was coded probably 
> because I didn't
> understand APR well enough at the time I made it loop until specified
> length of bytes was read (I started out with replicating 
> req.read(), which
> knows how much data there is to read).
> 
> I attached a patch to the connobject.c that changes its 
> behaviour so that
> read(len) will read at most len bytes, and will only block if 
> no data is
> available. And len is an optional argument.
> 
> Here is a connection handler code that does the exact same 
> thing you had
> below. (note that print writes to stdout, which is visible if you run
> httpd with -X (stay in foreground) option:
> 
> from mod_python import apache
> 
> def connectionhandler(conn):
> 
>     print "Connect from '%s'" % `conn.remote_addr`
> 
>     while 1:
>         data = conn.read()
>         if not data: break
>         print " Received: %s" % `data`
> 
>     print "Connection closed from '%s'" % `conn.remote_addr`
> 
>     return apache.OK
> 
> And here's the result:
> 
> $ ./bin/httpd -X
> Connect from '('0.0.0.0', 3513)'
>  Received: 'Hello\r\n'
>  Received: 'World\r\n'
> Connection closed from '('0.0.0.0', 3513)'
> 
> If I do 'for i in "Hello World"' thing, I get this:
> 
> Connect from '('0.0.0.0', 3524)'
>  Received: 'Hello World'
> Connection closed from '('0.0.0.0', 3524)'
> 
> Grisha
> 
> On Wed, 16 Jul 2003, Dustin Mitchell wrote:
> 
> > On Wed, Jul 16, 2003 at 01:59:58PM -0400, Gregory (Grisha) 
> Trubetskoy wrote:
> > > This is not a problem of mod_python or Apache, this is 
> the way sockets
> > > work. If your protocol is such that you know ahead of 
> time how much to
> > > read (e.g. HTTP), then you can request this much data in one read.
> > > Otherwise, you must read in smallest unit sizes of your 
> protocol, which
> > > (I'm guessing) is 1 byte in case of Z39.50.
> >
> > This is not strictly true, as long as you're OK with 
> possibly getting a
> > bit of *extra* data beyond a particular PDU (a little bit 
> of buffering
> > can take care of that).  Apache has to do this to read the 
> HTTP header,
> > which is not of a fixed length.
> >
> > The socket blocking read interface is structured such that 
> it will block
> > when *no* data is available, and will return *up to* the quantity
> > specified in the recv() call if it is available.  However, if some
> > smaller amount of data is available, that data will be returned
> > immediately.
> >
> > To demonstrate, I hacked this together:
> >
> > from socket import *
> > s = socket(AF_INET, SOCK_STREAM)
> > s.bind(("", 9900))
> > s.listen(5)
> > while 1:
> >   ss, sa = s.accept()
> >   print "Connect from '%s'" % (sa,)
> >   while 1:
> >     data = ss.recv(100)
> >     if not data: break
> >     print " Received: %s" % `data`
> >   print "Connection closed from '%s'" % (sa,)
> >
> > Then connected with telnet and typed "Hello" and "World" on separate
> > lines.  Telnet, by default, buffers lines of input until a 
> newline, but
> > you will note that in the two returns from ss.recv(), 
> neither contained
> > 100 bytes of data:
> >
> > Connect from '('127.0.0.1', 56260)'
> >  Received: 'Hello\r\n'
> >  Received: 'World\r\n'
> > Connection closed from '('127.0.0.1', 56260)'
> >
> > Further, a loop such as:
> >   for i in 'hello world': s.send(i)
> > will produce output like this:
> >
> > Connect from '('127.0.0.1', 56277)'
> >  Received: 'h'
> >  Received: 'ello world'
> > Connection closed from '('127.0.0.1', 56277)'
> >
> > Either the client or the server's socket implementation is 
> buffering the
> > characters because they're appearing so quickly, which cuts 
> down on the
> > number of recv() calls which must be made.
> >
> > I can't speak for the Apache sockets API, or the Python interface
> > thereto, but sockets themselves *do* support this interface 
> (they'd be
> > pretty useless if they didn't!).  I highly recommend W. Richard
> > Stevens' TCP/IP Illustrated for an in-depth and very readable
> > discussion of this and many other crucial implementation details of
> > TCP/IP.
> >
> > Dustin
> >
> > --
> >
> >   Dustin Mitchell
> >   dustin@ywlcs.org/djmitche@alumni.uchicago.edu
> >   http://people.cs.uchicago.edu/~dustin/
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
> 
From grisha at modpython.org  Wed Jul 16 23:20:22 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:43 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
 integration
In-Reply-To: <004d01c34bde$98310c40$24c0c20a@computer>
References: <004d01c34bde$98310c40$24c0c20a@computer>
Message-ID: <20030716231830.N5431@onyx.ispol.com>


There is some sort of an error in your code, but because of a bug that was
fixed earlier your mod_python doesn't log the error in the log correctly.

Attached is another patch, this time to apache.py, that should log the
error correctly.

Grisha

On Wed, 16 Jul 2003, fitnah55 wrote:

>
> duh.. add the port to listen
>
> heh
>
> coincidentally, i don't think the echo example is working
>
> [Tue Jul 15 13:03:18 2003] [error] python_connection:
> ConnectionDispatch() returned nothing.
>
> hmm
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
-------------- next part --------------
--- apache.py	12 Jul 2003 02:40:45 -0000	1.70
+++ apache.py	16 Jul 2003 20:23:24 -0000	1.71
@@ -54,7 +54,7 @@
  #
  # Originally developed by Gregory Trubetskoy.
  #
- # $Id: apache.py,v 1.70 2003/07/12 02:40:45 grisha Exp $
+ # $Id: apache.py,v 1.71 2003/07/16 20:23:24 grisha Exp $
 
 import sys
 import traceback
@@ -103,7 +103,7 @@
         try:
 
             handler = conn.hlist.handler
-            
+
             # split module::handler
             l = handler.split('::', 1)
             module_name = l[0]
@@ -115,7 +115,7 @@
 
             # add the directory to pythonpath if
             # not there yet, or pythonpath specified
-            
+
             if config.has_key("PythonPath"):
                 # we want to do as little evaling as possible,
                 # so we remember the path in un-evaled form and
@@ -161,7 +161,8 @@
             try:
                 exc_type, exc_value, exc_traceback = sys.exc_info()
                 result = self.ReportError(exc_type, exc_value, exc_traceback, srv=conn.base_server,
-                                          phase=filter.name, hname=handler, debug=debug)
+                                          phase="ConnectionHandler",
+                                          hname=handler, debug=debug)
             finally:
                 exc_traceback = None
 
From chris at vindaloo.com  Wed Jul 16 14:58:49 2003
From: chris at vindaloo.com (Christopher Sean Hilton)
Date: Fri Jan  9 21:53:43 2004
Subject: [mod_python] Getting access to a file from a post.
In-Reply-To: <20030716134923.B92465@onyx.ispol.com>
References: <Pine.LNX.4.44.0307161709550.2478-100000@gondolin.hist.liv.ac.uk>
	<20030716134923.B92465@onyx.ispol.com>
Message-ID: <20030716185849.GA1129@dagobah.pvt.vindaloo.com>

-----BEGIN PGP SIGNED MESSAGE-----

I'm trying to generate an xml transaction handler using apache,
modpython, python and sax. I would like to be able to post a file to
this website/handler with something like curl and have modpython
process the file. Something like

     $ cat MyXmlFile.xml | \
     >   curl https://www.example.com/iface.py/XmlHandler

My python looks like this:

     $ cat /var/www/data/www.example.com/iface.py
     #! /usr/local/bin/python2.1
     
     from mod_python import apache

     def XmlHandler(req):
        XmlData = req.readlines()
        ...

This does not get the contens of the file that I posted, in fact it's
empty. Is there any way short of using traditional CGI of getting this
file?

Thanks in advance and if I'm missing something in the manual please
feel free to give me a poke that sets me in the right direction.

Chris

- -- 
Chris Hilton                                 chilton-at-vindaloo-dot-com
- ------------------------------------------------------------------------
                "All I was doing was trying to get home from work!"
                                                 -- Rosa Parks
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.1 (FreeBSD)

iQEVAwUBPxWgWILaxorQlXotAQE23Qf9Ec2xBSXHtX6JN9QSwocetyTrDqBecpto
5lkvq6YlwGF4M5Ei5eUBFjOmAo3OydM83zKMzdzJTgrlOOr6p/JmAxV0YH3qm7QI
+ON/vfoNDxVsPCeQPU/B1dEwkRdjtT2dMda68Ce8dG6go/1McKwUGxIm7/J4Qifs
Bt02IeGLhu+03VIfm03dROn95P3LxqiuTUXbHiQYky9k23ahQjZ8O3XXb+3fyYa4
E44ZG0O9T/H5Xig1rTrbAASao86HNolgnbKR2zNbivtOblgl/p1KSWofkqfRaLRz
JcT0jlSrQB1RvG2rZUz2qy1EPunZ2YUgS1gR+MmTJBmGTxYnIRCzJw==
=tbTY
-----END PGP SIGNATURE-----

From azaroth at liverpool.ac.uk  Thu Jul 17 11:57:18 2003
From: azaroth at liverpool.ac.uk (Robert Sanderson)
Date: Fri Jan  9 21:53:43 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
 integration
In-Reply-To: <20030716161514.Q95093@onyx.ispol.com>
Message-ID: <Pine.LNX.4.44.0307171155380.6759-100000@gondolin.hist.liv.ac.uk>


> I attached a patch to the connobject.c that changes its behaviour so that
> read(len) will read at most len bytes, and will only block if no data is
> available. And len is an optional argument.

Great stuff, thanks for this Grisha.  It really is useful to us :)

Rob

-- 
      ,'/:.          Rob Sanderson (azaroth@liverpool.ac.uk)
    ,'-/::::.        http://www.o-r-g.org/~azaroth/
  ,'--/::(@)::.      Special Collections and Archives, extension 3142
,'---/::::::::::.    Nebmedes:  telnet: nebmedes.o-r-g.org 7777
____/:::::::::::::.                WWW:  http://nebmedes.o-r-g.org:8000/
I L L U M I N A T I

From chris at vindaloo.com  Thu Jul 17 09:09:54 2003
From: chris at vindaloo.com (Christopher Sean Hilton)
Date: Fri Jan  9 21:53:43 2004
Subject: [mod_python] Getting access to a file from a post.
In-Reply-To: <20030717034737.GZ18379@eleanor.internal.ywlcs.org>
References: <Pine.LNX.4.44.0307161709550.2478-100000@gondolin.hist.liv.ac.uk>
	<20030716134923.B92465@onyx.ispol.com>
	<20030716185849.GA1129@dagobah.pvt.vindaloo.com>
	<20030717034737.GZ18379@eleanor.internal.ywlcs.org>
Message-ID: <20030717130954.GA526@dagobah.pvt.vindaloo.com>

On Wed, Jul 16, 2003 at 10:47:37PM -0500, Dustin Mitchell wrote:

[snip]

> 
> If I'm not mistaken, you're using the publisher handler for this, and
> curl will generate a POST request.  Publisher, by virtue of using
> util.FieldStorage, will try to read that POST data as form data
> (depending on the content-type; it might just throw up a
> NOT_IMPLEMENTED). 
> 
> So the long and short of it is that publisher will gobble your request
> body, because publisher is intended to talk to a web browser, which
> only sends a certain kind of data there (form data).  If you'd like to
> parse some other format of request body, you'll have to forgo publisher
> and do that in a native handler.  That handler could look very much like
> what you've got:
> 
> # note the name 'handler' is mandatory
> def handler(req):
>   XmlData = req.readlines() # are you sure you want a list of lines?
>   ...
> 
> and in your Apache config,
> 
>   PythonHandler iface
> 
> Hope this helps.  Hope I'm right.  Please correct me if I am not.
> 

The assumption that I'm using the Publisher is correct. I will try the
code I have against the native handler this morning and post my
results to the list.

Thanks
 - Chris

-- 
Chris Hilton                                 chilton-at-vindaloo-dot-com
------------------------------------------------------------------------
                "All I was doing was trying to get home from work!"
                                                 -- Rosa Parks
From fitnah55 at hotmail.com  Thu Jul 17 11:30:15 2003
From: fitnah55 at hotmail.com (fitnah55)
Date: Fri Jan  9 21:53:43 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
	integration
In-Reply-To: <20030716231830.N5431@onyx.ispol.com>
Message-ID: <000301c34c78$52215ad0$24c0c20a@computer>


path problem.. couldn't specify that the connection handler was in a
specific
place, so i added a blah.pth file to site-packages pointing to the lib
directory of the host..

i can actually run the virtual host without specifying a documentroot so
i
guess that works out fine

but i'm not so sure canonical name type name based virtual hosts will
work
with this as is though?

i think right now using the virtual host directive is essentially just
giving
it its own error log

i can actually start developing a rudimentary design now though so
that's
pretty cool... it took a lot less effort than i thought when i first
started
looking into it


> -----Original Message-----
> From: Gregory (Grisha) Trubetskoy [mailto:grisha@modpython.org] 
> Sent: Wednesday, July 16, 2003 11:20 PM
> To: fitnah55
> Cc: mod_python@modpython.org
> Subject: RE: [mod_python] apache API and mod_python <-> 
> protocol module integration
> 
> 
> 
> There is some sort of an error in your code, but because of a 
> bug that was
> fixed earlier your mod_python doesn't log the error in the 
> log correctly.
> 
> Attached is another patch, this time to apache.py, that should log the
> error correctly.
> 
> Grisha
> 
> On Wed, 16 Jul 2003, fitnah55 wrote:
> 
> >
> > duh.. add the port to listen
> >
> > heh
> >
> > coincidentally, i don't think the echo example is working
> >
> > [Tue Jul 15 13:03:18 2003] [error] python_connection:
> > ConnectionDispatch() returned nothing.
> >
> > hmm
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
> 
From grisha at modpython.org  Thu Jul 17 11:47:13 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:43 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
 integration
In-Reply-To: <000301c34c78$52215ad0$24c0c20a@computer>
References: <000301c34c78$52215ad0$24c0c20a@computer>
Message-ID: <20030717114409.V19822@onyx.ispol.com>



On Thu, 17 Jul 2003, fitnah55 wrote:

> but i'm not so sure canonical name type name based virtual hosts will
> work with this as is though?

Name-based hosts certainly will not work because the name comes from the
Host: header, but we're not at the HTTP level here.

> i think right now using the virtual host directive is essentially just
> giving it its own error log

It's more than that, it will let you associate a connection handler with a
particular ip:port.

> i can actually start developing a rudimentary design now though so
> that's pretty cool... it took a lot less effort than i thought when i
> first started looking into it

That's good to know!

Grisha

>
>
> > -----Original Message-----
> > From: Gregory (Grisha) Trubetskoy [mailto:grisha@modpython.org]
> > Sent: Wednesday, July 16, 2003 11:20 PM
> > To: fitnah55
> > Cc: mod_python@modpython.org
> > Subject: RE: [mod_python] apache API and mod_python <->
> > protocol module integration
> >
> >
> >
> > There is some sort of an error in your code, but because of a
> > bug that was
> > fixed earlier your mod_python doesn't log the error in the
> > log correctly.
> >
> > Attached is another patch, this time to apache.py, that should log the
> > error correctly.
> >
> > Grisha
> >
> > On Wed, 16 Jul 2003, fitnah55 wrote:
> >
> > >
> > > duh.. add the port to listen
> > >
> > > heh
> > >
> > > coincidentally, i don't think the echo example is working
> > >
> > > [Tue Jul 15 13:03:18 2003] [error] python_connection:
> > > ConnectionDispatch() returned nothing.
> > >
> > > hmm
> > >
> > > _______________________________________________
> > > Mod_python mailing list
> > > Mod_python@modpython.org
> > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > >
> >
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From azaroth at liverpool.ac.uk  Thu Jul 17 17:18:45 2003
From: azaroth at liverpool.ac.uk (Robert Sanderson)
Date: Fri Jan  9 21:53:43 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
 integration
In-Reply-To: <000301c34c78$52215ad0$24c0c20a@computer>
Message-ID: <Pine.LNX.4.44.0307171710380.11776-100000@gondolin.hist.liv.ac.uk>


You can check the address it was received on and decline to handle 
anything received on the wrong port. Then it'll fall through to the 
normal handlers.

For example:

def connectionhandler(conn):
  if (conn.local_addr[0] != SERVER_IP or conn.local_addr[1] != SERVER_PORT):
    return apache.DECLINED
  elif (conn.base_server.server_hostname != SERVER_NAME):
    return apache.DECLINED
  else:
    # XXX do everything here

  return apache.OK


Also look at conn.base_server for the server object's other bits and 
pieces.

http://www.modpython.org/live/current/doc-html/pyapi-mpconn-mem.html
http://www.modpython.org/live/current/doc-html/pyapi-mpsrv-mem.html

Rob


On Thu, 17 Jul 2003, fitnah55 wrote:

> 
> path problem.. couldn't specify that the connection handler was in a
> specific
> place, so i added a blah.pth file to site-packages pointing to the lib
> directory of the host..
> 
> i can actually run the virtual host without specifying a documentroot so
> i
> guess that works out fine
> 
> but i'm not so sure canonical name type name based virtual hosts will
> work
> with this as is though?
> 
> i think right now using the virtual host directive is essentially just
> giving
> it its own error log
> 
> i can actually start developing a rudimentary design now though so
> that's
> pretty cool... it took a lot less effort than i thought when i first
> started
> looking into it
> 
> 
> > -----Original Message-----
> > From: Gregory (Grisha) Trubetskoy [mailto:grisha@modpython.org] 
> > Sent: Wednesday, July 16, 2003 11:20 PM
> > To: fitnah55
> > Cc: mod_python@modpython.org
> > Subject: RE: [mod_python] apache API and mod_python <-> 
> > protocol module integration
> > 
> > 
> > 
> > There is some sort of an error in your code, but because of a 
> > bug that was
> > fixed earlier your mod_python doesn't log the error in the 
> > log correctly.
> > 
> > Attached is another patch, this time to apache.py, that should log the
> > error correctly.
> > 
> > Grisha
> > 
> > On Wed, 16 Jul 2003, fitnah55 wrote:
> > 
> > >
> > > duh.. add the port to listen
> > >
> > > heh
> > >
> > > coincidentally, i don't think the echo example is working
> > >
> > > [Tue Jul 15 13:03:18 2003] [error] python_connection:
> > > ConnectionDispatch() returned nothing.
> > >
> > > hmm
> > >
> > > _______________________________________________
> > > Mod_python mailing list
> > > Mod_python@modpython.org
> > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > >
> > 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 

-- 
      ,'/:.          Rob Sanderson (azaroth@liverpool.ac.uk)
    ,'-/::::.        http://www.o-r-g.org/~azaroth/
  ,'--/::(@)::.      Special Collections and Archives, extension 3142
,'---/::::::::::.    Nebmedes:  telnet: nebmedes.o-r-g.org 7777
____/:::::::::::::.                WWW:  http://nebmedes.o-r-g.org:8000/
I L L U M I N A T I

From grisha at modpython.org  Thu Jul 17 13:09:08 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:43 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
 integration
In-Reply-To: <Pine.LNX.4.44.0307171710380.11776-100000@gondolin.hist.liv.ac.uk>
References: <Pine.LNX.4.44.0307171710380.11776-100000@gondolin.hist.liv.ac.uk>
Message-ID: <20030717130605.V19963@onyx.ispol.com>


I think this is unnecessary. Something like this in the config will make
your handler listen on 1.1.1.1:8888 only:

Listen 2.2.2.2:80
Listen 1.1.1.1:8888

<VirtualHost 1.1.1.1:8888>

	PythonConnectionHandler blah
	...

</VirtualHost>


On Thu, 17 Jul 2003, Robert Sanderson wrote:

>
> You can check the address it was received on and decline to handle
> anything received on the wrong port. Then it'll fall through to the
> normal handlers.
>
> For example:
>
> def connectionhandler(conn):
>   if (conn.local_addr[0] != SERVER_IP or conn.local_addr[1] != SERVER_PORT):
>     return apache.DECLINED
>   elif (conn.base_server.server_hostname != SERVER_NAME):
>     return apache.DECLINED
>   else:
>     # XXX do everything here
>
>   return apache.OK
>
>
> Also look at conn.base_server for the server object's other bits and
> pieces.
>
> http://www.modpython.org/live/current/doc-html/pyapi-mpconn-mem.html
> http://www.modpython.org/live/current/doc-html/pyapi-mpsrv-mem.html
>
> Rob
>
>
> On Thu, 17 Jul 2003, fitnah55 wrote:
>
> >
> > path problem.. couldn't specify that the connection handler was in a
> > specific
> > place, so i added a blah.pth file to site-packages pointing to the lib
> > directory of the host..
> >
> > i can actually run the virtual host without specifying a documentroot so
> > i
> > guess that works out fine
> >
> > but i'm not so sure canonical name type name based virtual hosts will
> > work
> > with this as is though?
> >
> > i think right now using the virtual host directive is essentially just
> > giving
> > it its own error log
> >
> > i can actually start developing a rudimentary design now though so
> > that's
> > pretty cool... it took a lot less effort than i thought when i first
> > started
> > looking into it
> >
> >
> > > -----Original Message-----
> > > From: Gregory (Grisha) Trubetskoy [mailto:grisha@modpython.org]
> > > Sent: Wednesday, July 16, 2003 11:20 PM
> > > To: fitnah55
> > > Cc: mod_python@modpython.org
> > > Subject: RE: [mod_python] apache API and mod_python <->
> > > protocol module integration
> > >
> > >
> > >
> > > There is some sort of an error in your code, but because of a
> > > bug that was
> > > fixed earlier your mod_python doesn't log the error in the
> > > log correctly.
> > >
> > > Attached is another patch, this time to apache.py, that should log the
> > > error correctly.
> > >
> > > Grisha
> > >
> > > On Wed, 16 Jul 2003, fitnah55 wrote:
> > >
> > > >
> > > > duh.. add the port to listen
> > > >
> > > > heh
> > > >
> > > > coincidentally, i don't think the echo example is working
> > > >
> > > > [Tue Jul 15 13:03:18 2003] [error] python_connection:
> > > > ConnectionDispatch() returned nothing.
> > > >
> > > > hmm
> > > >
> > > > _______________________________________________
> > > > Mod_python mailing list
> > > > Mod_python@modpython.org
> > > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > > >
> > >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
>
> --
>       ,'/:.          Rob Sanderson (azaroth@liverpool.ac.uk)
>     ,'-/::::.        http://www.o-r-g.org/~azaroth/
>   ,'--/::(@)::.      Special Collections and Archives, extension 3142
> ,'---/::::::::::.    Nebmedes:  telnet: nebmedes.o-r-g.org 7777
> ____/:::::::::::::.                WWW:  http://nebmedes.o-r-g.org:8000/
> I L L U M I N A T I
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From fitnah55 at hotmail.com  Thu Jul 17 13:14:53 2003
From: fitnah55 at hotmail.com (fitnah55)
Date: Fri Jan  9 21:53:43 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
	integration
In-Reply-To: <20030717130605.V19963@onyx.ispol.com>
Message-ID: <000a01c34c86$efe09f70$24c0c20a@computer>


doesn't really help if the box only has one IP..  IPv6 isn't a
reality yet, and IPs are extremely expensive

i don't think there's any viable solution without changing the
telnet protocol *erk*


> I think this is unnecessary. Something like this in the 
> config will make
> your handler listen on 1.1.1.1:8888 only:
> 
> Listen 2.2.2.2:80
> Listen 1.1.1.1:8888
> 
> <VirtualHost 1.1.1.1:8888>
> 
> 	PythonConnectionHandler blah
> 	...
> 
> </VirtualHost>
> 
> 
> On Thu, 17 Jul 2003, Robert Sanderson wrote:
> 
> >
> > You can check the address it was received on and decline to handle
> > anything received on the wrong port. Then it'll fall through to the
> > normal handlers.
> >
> > For example:
> >
> > def connectionhandler(conn):
> >   if (conn.local_addr[0] != SERVER_IP or conn.local_addr[1] 
> != SERVER_PORT):
> >     return apache.DECLINED
> >   elif (conn.base_server.server_hostname != SERVER_NAME):
> >     return apache.DECLINED
> >   else:
> >     # XXX do everything here
> >
> >   return apache.OK
> >
> >
> > Also look at conn.base_server for the server object's other bits and
> > pieces.
> >
> > http://www.modpython.org/live/current/doc-html/pyapi-mpconn-mem.html
> > http://www.modpython.org/live/current/doc-html/pyapi-mpsrv-mem.html
> >
> > Rob
> >
> >
> > On Thu, 17 Jul 2003, fitnah55 wrote:
> >
> > >
> > > path problem.. couldn't specify that the connection 
> handler was in a
> > > specific
> > > place, so i added a blah.pth file to site-packages 
> pointing to the lib
> > > directory of the host..
> > >
> > > i can actually run the virtual host without specifying a 
> documentroot so
> > > i
> > > guess that works out fine
> > >
> > > but i'm not so sure canonical name type name based 
> virtual hosts will
> > > work
> > > with this as is though?
> > >
> > > i think right now using the virtual host directive is 
> essentially just
> > > giving
> > > it its own error log
> > >
> > > i can actually start developing a rudimentary design now though so
> > > that's
> > > pretty cool... it took a lot less effort than i thought 
> when i first
> > > started
> > > looking into it
> > >
> > >
From fitnah55 at hotmail.com  Thu Jul 17 21:14:18 2003
From: fitnah55 at hotmail.com (fitnah55)
Date: Fri Jan  9 21:53:43 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
	integration
In-Reply-To: <20030716161514.Q95093@onyx.ispol.com>
Message-ID: <001101c34cc9$e9901fe0$24c0c20a@computer>


okay i'm still having a little problem with this, since i'm trying to
get telnet into full duplex character mode..

apparently the connection object is buffering the input for a CRLF
and i cant quite isolate where this is actually occuring

i see the GETLINE and GETBYTES stuff but so far i cant follow the
flow so well

im sending IAC+DO+ECHO and IAC+DO+SGA (supress go ahead) which should
get the client into the right mode, but the connection read buffer is
still boggling me, if u have any idea

> Well, after some looking, apparently the APR does work this 
> way, it's just
> that the way the connection handler was coded probably 
> because I didn't
> understand APR well enough at the time I made it loop until specified
> length of bytes was read (I started out with replicating 
> req.read(), which
> knows how much data there is to read).
> 
> I attached a patch to the connobject.c that changes its 
> behaviour so that
> read(len) will read at most len bytes, and will only block if 
> no data is
> available. And len is an optional argument.
> 
From greenbeard400 at yahoo.com  Thu Jul 17 20:54:14 2003
From: greenbeard400 at yahoo.com (Greenbeard)
Date: Fri Jan  9 21:53:43 2004
Subject: [mod_python] Passing Cursor Objects 
Message-ID: <20030718035414.67298.qmail@web21302.mail.yahoo.com>

Is it possible to pass the acutal cursor between
requests? 

I can attach the cursor as a <input>


I am using the publisher handler here...


def x(req):
  <snip>
   cursor = dbconn.cursor()
   


__________________________________
Do you Yahoo!?
SBC Yahoo! DSL - Now only $29.95 per month!
http://sbc.yahoo.com
From greenbeard400 at yahoo.com  Thu Jul 17 21:00:43 2003
From: greenbeard400 at yahoo.com (Greenbeard)
Date: Fri Jan  9 21:53:43 2004
Subject: [mod_python] Passing Cursor Objects 
Message-ID: <20030718040043.26298.qmail@web21310.mail.yahoo.com>

Sorry bout the premature email.  Stupid touchpad on
the laptop here.....

Is it possible to pass the acutal cursor between
requests? 

I can attach the cursor as a value on an <input> tag
and when I submit the form and I print the variable
passed I get the <MySQLdb.cursors.Cursor instance at
0x04AC1038> but if I reference it in future operations
I get "'str' object has no attribute 'execute' "

Based on the documentation I see that I could pass the
connection or I can move the cursor information out of
the cursor and pass it as a string.  But am I missing
something here that would allow me to use the cursor
object?  

I am using the publisher handler if that makes a
difference. 

Thanks! 

__________________________________
Do you Yahoo!?
SBC Yahoo! DSL - Now only $29.95 per month!
http://sbc.yahoo.com
From dustin at ywlcs.org  Thu Jul 17 23:38:45 2003
From: dustin at ywlcs.org (Dustin Mitchell)
Date: Fri Jan  9 21:53:43 2004
Subject: [mod_python] Passing Cursor Objects
In-Reply-To: <20030718040043.26298.qmail@web21310.mail.yahoo.com>
References: <20030718040043.26298.qmail@web21310.mail.yahoo.com>
Message-ID: <20030718043845.GX18379@eleanor.internal.ywlcs.org>

On Thu, Jul 17, 2003 at 09:00:43PM -0700, Greenbeard wrote:
> Sorry bout the premature email.  Stupid touchpad on
> the laptop here.....
> 
> Is it possible to pass the acutal cursor between
> requests? 
> 
> I can attach the cursor as a value on an <input> tag
> and when I submit the form and I print the variable
> passed I get the <MySQLdb.cursors.Cursor instance at
> 0x04AC1038> but if I reference it in future operations
> I get "'str' object has no attribute 'execute' "
> 
> Based on the documentation I see that I could pass the
> connection or I can move the cursor information out of
> the cursor and pass it as a string.  But am I missing
> something here that would allow me to use the cursor
> object?  
> 
> I am using the publisher handler if that makes a
> difference. 

Nope, you can't do it.  Basically all you can send to the client (the
browser) is text.   Most browsers are nice enough to send your text
back unmangled, but they're certainly not capable of anything more
complicated.  A cursor is deeply tied into the current state of the
Python Database API, the MySQL server, and whatnot -- all that state
certainly can't be tied up in a string and recreated for the next
request from the browser.

The text you see (<MySQLdb.cursors.Cursor instance at 0x04AC1038>) is
Python's best effor at turning this cursor into a string.  But all it
says is "I had this object here at this address with all this state in
it".  When the request comes back from the browser (milliseconds,
seconds, days later) that object is dead and gone.  Could be Apache
restarted.  MySQL restarted.  The server started smoking and was
replaced.  That cursor is no longer viable.

While I'm on the subject, another good reason not to send things like
this to your client (the browser) is this: you're not sure you'll get
it back.  If you had a way to "reserve" cursors on the server, such
that a browser could indicate "I was using cursor number 243" (perhaps
with an input tag), what would happen if the browser never send another
request?  That cursor would sit around, using up resources.  A couple
dozen idle cursors, and you'll have a DOS'd server..

So the long and short of it is you'll have to open a new cursor for
each request from the web.  It may help to think about the state of the
cursor that's most important to you: not the connection ID to the MySQL
server or anything like that.  It's probably the row number the user
last viewed, along with the components of the query.  If you put *that*
information into the generated HTML in such a way that the browser will
send it back to you (again, <input> tags are good for this), then
you'll be able to create a cursor in the necessary state by grabbing
any old cursor and executing the appropriate query.

I hope this helps.  I try to err on the side of too much explaination.

Dustin

--

  Dustin Mitchell
  dustin@ywlcs.org/djmitche@alumni.uchicago.edu
  http://people.cs.uchicago.edu/~dustin/
From mike.looijmans at asml.com  Fri Jul 18 07:10:37 2003
From: mike.looijmans at asml.com (Mike Looijmans)
Date: Fri Jan  9 21:53:43 2004
Subject: [mod_python] Passing Cursor Objects
Message-ID: <01c34cea$ec7a4480$926a1e6e@wsasd464>

Good explanation, I'm sure you're erring on the 'too much' side here.

Anyway, MySQL has a quite nice LIMIT command for this purpose. You can not
only get the 'first 10' rows, but you can also make it fetch the last 10 or
from 30-40. So all you need is to keep track of where you were and what the
query was (you could make the page into a form and add <input type=hidden>
tags and prev/next submit buttons. Or you could put the query into the url.

If you have really long queries (URLs are limited to 6kB) consider using
either POST requests or store the query into the database and supply a
'handle' (row ID) instead. Throw away the query after an hour or so...


>So the long and short of it is you'll have to open a new cursor for
>each request from the web.  It may help to think about the state of the
>cursor that's most important to you: not the connection ID to the MySQL
>server or anything like that.  It's probably the row number the user
>last viewed, along with the components of the query.  If you put *that*
>information into the generated HTML in such a way that the browser will
>send it back to you (again, <input> tags are good for this), then
>you'll be able to create a cursor in the necessary state by grabbing
>any old cursor and executing the appropriate query.
>
>I hope this helps.  I try to err on the side of too much explaination.




-- 
The information contained in this communication and any attachments is confidential and may be privileged, and is for the sole use of the intended recipient(s). Any unauthorized review, use, disclosure or distribution is prohibited. If you are not the intended recipient, please notify the sender immediately by replying to this message and destroy all copies of this message and any attachments. ASML is neither liable for the proper and complete transmission of the information contained in this communication, nor for any delay in its receipt.


From davidf at sjsoft.com  Fri Jul 18 09:58:00 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 21:53:43 2004
Subject: [mod_python] Passing Cursor Objects
In-Reply-To: <01c34cea$ec7a4480$926a1e6e@wsasd464>
References: <01c34cea$ec7a4480$926a1e6e@wsasd464>
Message-ID: <3F17A888.9000704@sjsoft.com>

Mike Looijmans wrote:

>Good explanation, I'm sure you're erring on the 'too much' side here.
>
>Anyway, MySQL has a quite nice LIMIT command for this purpose. You can not
>only get the 'first 10' rows, but you can also make it fetch the last 10 or
>from 30-40. So all you need is to keep track of where you were and what the
>query was (you could make the page into a form and add <input type=hidden>
>tags and prev/next submit buttons. Or you could put the query into the url.
>
>If you have really long queries (URLs are limited to 6kB) consider using
>either POST requests or store the query into the database and supply a
>'handle' (row ID) instead. Throw away the query after an hour or so...
>  
>
>>So the long and short of it is you'll have to open a new cursor for
>>each request from the web.  It may help to think about the state of the
>>cursor that's most important to you: not the connection ID to the MySQL
>>server or anything like that.  It's probably the row number the user
>>last viewed, along with the components of the query.  If you put *that*
>>information into the generated HTML in such a way that the browser will
>>send it back to you (again, <input> tags are good for this), then
>>you'll be able to create a cursor in the necessary state by grabbing
>>any old cursor and executing the appropriate query.
>>
>>I hope this helps.  I try to err on the side of too much explaination.
>>    
>>
Or if you did really, even after those explanations, want to store the 
cursor, you could create a unique key for it, save it in a global 
dictionary (but note problems with different threads/processes), get the 
client to remember the key (cookie/hidden field/URL) and retrieve the 
cursor using the key on the next request...
But you probably really don't need to do that.

David


From fitnah55 at hotmail.com  Fri Jul 18 13:43:53 2003
From: fitnah55 at hotmail.com (fitnah55)
Date: Fri Jan  9 21:53:43 2004
Subject: [mod_python]  apache API and mod_python <-> protocol
	moduleintegration
In-Reply-To: <001101c34cc9$e9901fe0$24c0c20a@computer>
Message-ID: <000701c34d54$27753450$24c0c20a@computer>


okay i checked the client side by putting it into forced character
at a time mode, and now i can get the python handler to print to
stdout that its getting the characters a character at a time - but
the 'echo' part is still buffering until a CRLF is detected.. which
when i put the client into forced mode, it only sends CR and not the
LF..

i'm going to look at the conn_object.c code and the apache.py code
again, but i am having difficulty following what all is going on


> okay i'm still having a little problem with this, since i'm trying to
> get telnet into full duplex character mode..
> 
> apparently the connection object is buffering the input for a CRLF
> and i cant quite isolate where this is actually occuring
> 
> i see the GETLINE and GETBYTES stuff but so far i cant follow the
> flow so well
> 
> im sending IAC+DO+ECHO and IAC+DO+SGA (supress go ahead) which should
> get the client into the right mode, but the connection read buffer is
> still boggling me, if u have any idea
> 
From fitnah55 at hotmail.com  Fri Jul 18 13:47:42 2003
From: fitnah55 at hotmail.com (fitnah55)
Date: Fri Jan  9 21:53:43 2004
Subject: [mod_python]  apache API and mod_python <-> protocol
	moduleintegration
Message-ID: <000c01c34d54$b0153f80$24c0c20a@computer>


ahh nevermind, modpython is working as expected

its definitely something with the protocol negotiation... sigh

rfc's on telnet suck


> -----Original Message-----
> From: fitnah55 [mailto:fitnah55@hotmail.com] 
> Sent: Friday, July 18, 2003 1:44 PM
> To: 'mod_python@modpython.org'
> Subject: RE: [mod_python] apache API and mod_python <-> 
> protocol moduleintegration
> 
> 
> 
> okay i checked the client side by putting it into forced character
> at a time mode, and now i can get the python handler to print to
> stdout that its getting the characters a character at a time - but
> the 'echo' part is still buffering until a CRLF is detected.. which
> when i put the client into forced mode, it only sends CR and not the
> LF..
> 
> i'm going to look at the conn_object.c code and the apache.py code
> again, but i am having difficulty following what all is going on
> 
> 
> > okay i'm still having a little problem with this, since i'm 
> trying to
> > get telnet into full duplex character mode..
> > 
> > apparently the connection object is buffering the input for a CRLF
> > and i cant quite isolate where this is actually occuring
> > 
> > i see the GETLINE and GETBYTES stuff but so far i cant follow the
> > flow so well
> > 
> > im sending IAC+DO+ECHO and IAC+DO+SGA (supress go ahead) 
> which should
> > get the client into the right mode, but the connection read 
> buffer is
> > still boggling me, if u have any idea
> > 
> 
From hawkeesk8 at yahoo.com  Sun Jul 20 09:10:39 2003
From: hawkeesk8 at yahoo.com (Kevin Smith)
Date: Fri Jan  9 21:53:43 2004
Subject: [mod_python] Adding user-defined objects to the request
Message-ID: <20030720161039.30358.qmail@web10706.mail.yahoo.com>

Hi,

I have been playing with mod_python for a while now
and would like to add my own non-trivial objects to
the request object.

I know that it is easy to add objects that are
built-in types such as:

session = {'Id':'&YFH%^%231234'}
req.session = session

Then, req.session, will be available to downstream
handlers to process.  But simply adding an object
doesn't appear to work if it is a user-defined type. 
I would like to do something similar to the following:

Class Session():
...

session = Session()
...
req.session = session

And then, later, in a downstream handler use my
defined methods:

req.session.athenticate()

I have searched the mailing list and the web in
general and can't find anything that is sending me in
the right direction nor telling me it is impossible. 
I have looked at pso and jotweb.  pso appears to
accomplish something similar to what I want but it
will take me weeks to unravel the trickery going on! 
I would just use pso but it does not implement an
authentication token the way I need to based on our
security needs.

Can someone help?

Many thanks in advance.

__________________________________
Do you Yahoo!?
SBC Yahoo! DSL - Now only $29.95 per month!
http://sbc.yahoo.com
From stian at soiland.no  Sun Jul 20 18:40:57 2003
From: stian at soiland.no (Stian =?iso-8859-1?Q?S=F8iland?=)
Date: Fri Jan  9 21:53:43 2004
Subject: [mod_python] Adding user-defined objects to the request
In-Reply-To: <20030720161039.30358.qmail@web10706.mail.yahoo.com>
References: <20030720161039.30358.qmail@web10706.mail.yahoo.com>
Message-ID: <20030720164057.GA24916@itea.ntnu.no>

On 2003-07-20 18:10:39, Kevin Smith wrote:

> session = {'Id':'&YFH%^%231234'}
> req.session = session
> 
> Then, req.session, will be available to downstream
> handlers to process.  But simply adding an object
> doesn't appear to work if it is a user-defined type. 
> I would like to do something similar to the following:
> 
> Class Session():
> ...

I can't see why this should not work, we do the same thing, but with a
user defined Session (that basically just store itself to disk on
__del__). Are you sure you don't have a path problem or namespace
problem? What is type(req.session) and repr(req.session) further down in
your pipeline?

-- 
Stian S?iland               Work toward win-win situation. Win-lose
Trondheim, Norway           is where you win and the other lose.
http://www.soiland.no/      Lose-lose and lose-win are left as an
                            exercise to the reader.  [Limoncelli/Hogan]

From gnb at itga.com.au  Mon Jul 21 16:29:11 2003
From: gnb at itga.com.au (Gregory Bond)
Date: Fri Jan  9 21:53:43 2004
Subject: [mod_python] 2.7.8: os.error no longer == OSError
Message-ID: <200307210629.QAA06995@lightning.itga.com.au>

I've got
	Apache/1.3.27 (Unix) mod_python/2.7.8 Python/2.1.1 configured
on Solaris 2.6.

Consider an mptest.py that looks like this:
	from mod_python import apache

	import os

	def handler(req):
		req.send_http_header()
		try:
			os.stat('/tmp/not.existing')
		except os.error:
			req.write("caught os.error")
		except OSError:
			req.write("Caught OSError")
		return apache.OK


This always returns "Caught OSError", never "caught os.error".  This breaks a 
whole lotta stuff, including builtin functions like os.path.exists() which 
use the "os.error" form.

What can I conceivably have done to break this????


From gnb at itga.com.au  Mon Jul 21 17:48:14 2003
From: gnb at itga.com.au (Gregory Bond)
Date: Fri Jan  9 21:53:43 2004
Subject: [mod_python] 2.7.8: import exceptions -> os.error no longer ==
	OSError 
In-Reply-To: Your message of Mon, 21 Jul 2003 16:29:11 +1000.
Message-ID: <200307210748.RAA13476@lightning.itga.com.au>

I've done some more work and it appears that doing
	import exceptions
from inside mod_python buggers things more than somewhat for every mod_python 
script run in that process from then on.

(This was in some old and unconverted python 1.3-era code)

------------
def handler(req):
        req.send_http_header()
        req.write("before import exceptions\n")
        req.write("OSError is %d\n" % id(OSError))
        req.write("os.error is %d\n" % id(os.error))
        import exceptions
        req.write("after import exceptions\n")
        req.write("OSError is %d\n" % id(OSError))
        req.write("os.error is %d\n" % id(os.error))

        return apache.OK

------------
before import exceptions
OSError is 539788
os.error is 539788
after import exceptions
OSError is 1258380
os.error is 539788

----------
But if I run the same code (writing to stdout, rather than a req structure) 
from the command line it works OK:
----
import os, sys
req = sys.stdout

req.write("before import exceptions\n")
req.write("OSError is %d\n" % id(OSError))
req.write("os.error is %d\n" % id(os.error))
import exceptions
req.write("after import exceptions\n")
req.write("OSError is %d\n" % id(OSError))
req.write("os.error is %d\n" % id(os.error))
-----
lightning$ python t.py
before import exceptions
OSError is 900204
os.error is 900204
after import exceptions
OSError is 900204
os.error is 900204


From hawkeesk8 at yahoo.com  Mon Jul 21 03:21:25 2003
From: hawkeesk8 at yahoo.com (Kevin Smith)
Date: Fri Jan  9 21:53:43 2004
Subject: [mod_python] Adding user-defined objects to the request
In-Reply-To: <20030720164057.GA24916@itea.ntnu.no>
Message-ID: <20030721102125.65136.qmail@web10706.mail.yahoo.com>

Actually, I think I may have just found the problem
which brings up another question ...

I was trying to do the addition of the object to the
request in the InitHandler.  I then noticed that I
could not even get a simple type to add to the request
in this phase of the handling.  Is that normal
behaviour?  The earliest that I seemed to be able to
add an object to the request was HeaderParser phase.

Can someone confirm or deny that the HeaderParser is
the earliest (inside a 'Location/Directory' context)
that you can add objects/attributes to the request?

In light of this, and Stian's comment, I shall try to
add my user-defined object at this phase instead.

Thanks
--- Stian Siland <stian@soiland.no> wrote:
> On 2003-07-20 18:10:39, Kevin Smith wrote:
> 
> > session = {'Id':'&YFH%^%231234'}
> > req.session = session
> > 
> > Then, req.session, will be available to downstream
> > handlers to process.  But simply adding an object
> > doesn't appear to work if it is a user-defined
> type. 
> > I would like to do something similar to the
> following:
> > 
> > Class Session():
> > ...
> 
> I can't see why this should not work, we do the same
> thing, but with a
> user defined Session (that basically just store
> itself to disk on
> __del__). Are you sure you don't have a path problem
> or namespace
> problem? What is type(req.session) and
> repr(req.session) further down in
> your pipeline?
> 
> -- 
> Stian Siland               Work toward win-win
> situation. Win-lose
> Trondheim, Norway           is where you win and the
> other lose.
> http://www.soiland.no/      Lose-lose and lose-win
> are left as an
>                             exercise to the reader. 
[Limoncelli/Hogan]


__________________________________
Do you Yahoo!?
SBC Yahoo! DSL - Now only $29.95 per month!
http://sbc.yahoo.com
From grisha at modpython.org  Mon Jul 21 10:47:15 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:44 2004
Subject: [mod_python] 2.7.8: os.error no longer == OSError
In-Reply-To: <200307210629.QAA06995@lightning.itga.com.au>
References: <200307210629.QAA06995@lightning.itga.com.au>
Message-ID: <20030721104016.I97244@onyx.ispol.com>



On Mon, 21 Jul 2003, Gregory Bond wrote:

> I've got
> 	Apache/1.3.27 (Unix) mod_python/2.7.8 Python/2.1.1 configured

[snip]

I think it's the same problem as the one causing this:
http://www.modpython.org/FAQ/faqw.py?req=all#5.4

Try upgrading to Python 2.2.3, I'm almost certain it will fix this.

(I'd upgrade to Apache 2.0.x and mod_python 3.0.3 too if that's an option)

Grisha
From sabu at pure-elite.org  Wed Jul 23 03:38:02 2003
From: sabu at pure-elite.org (Xavier)
Date: Fri Jan  9 21:53:44 2004
Subject: [mod_python] Errors off of a fresh install.
Message-ID: <33780.24.199.120.198.1058967482.squirrel@mail.darkscape.net>

Greetings,

I went ahead and installed the mod_python-3.0.3 dist with a fresh
installation of python 2.2, apache 2.0.47, and php4*.  I followed all of
the compile/installation instructions and went ahead with the testing.

While testing the generic (with fine indentation) mptest.py code -- I ran
into the "Internal error"/500 from apache.  Here is why it won't execute:

[Wed Jul 23 09:13:28 2003] [error] make_obcallback: could not import
mod_python.apache.

ImportError: No module named mod_python.apache

I then opened up python and tried to import "mod_python.apache" only to
get this in return:

Traceback (most recent call last):
  File "<stdin>", line 1, in ?
  File "/usr/lib/python2.2/site-packages/mod_python/apache.py", line 67, in ?
    import _apache
ImportError: No module named _apache

Has anyone else ran into this same fault? anyoneh ave any solutions? I'd
like to get mod_python_+Roadkill working and hopefully this is a fixable
problem.

Thanks,
-- Xavier.

From gnb at itga.com.au  Thu Jul 24 09:41:51 2003
From: gnb at itga.com.au (Gregory Bond)
Date: Fri Jan  9 21:53:44 2004
Subject: [mod_python] Errors off of a fresh install. 
In-Reply-To: Your message of Wed, 23 Jul 2003 03:38:02 -1000.
Message-ID: <200307232341.JAA02393@lightning.itga.com.au>

> [Wed Jul 23 09:13:28 2003] [error] make_obcallback: could not import
> mod_python.apache.
> ImportError: No module named mod_python.apache

See the very first question in the FAQ :
	http://www.modpython.org/FAQ/faqw.py?req=show&file=faq02.001.htp

> I then opened up python and tried to import "mod_python.apache" only to
> get this in return:
> ImportError: No module named _apache

Also in the FAQ:
	http://www.modpython.org/FAQ/faqw.py?req=show&file=faq02.002.htp

From hawkeesk8 at yahoo.com  Thu Jul 24 08:46:53 2003
From: hawkeesk8 at yahoo.com (Kevin Smith)
Date: Fri Jan  9 21:53:44 2004
Subject: [mod_python] apxs:Error: Command failed with rc=65536
Message-ID: <20030724154653.51378.qmail@web10704.mail.yahoo.com>

Hi,

I am getting the infamous "apxs:Error: Command failed
with rc=65536" error when trying to compile mod_python
3.0.3 against Apache 2.0.40 on RH9.

I have seen this error mentioned before on this list
and under each circumstance the reply was that the
version of python is too old.

However, I am running a compiled from source, Python
2.3c1 and the 'out-of-the-box' apache 2.0.40 (both
httpd and httpd-devel) that comes with RH9.

I issue ./configure --with-apxs=/usr/sbin/apxs
--with-python=/usr/local/bin/python
and then when I do the make I get the following (only
the last number of lines have been  included because I
don't think there were problems previous to this):

requestobject.c: In function `getreq_recmbr_off':
requestobject.c:1055: `LONG_LONG' undeclared (first
use in this function)
requestobject.c:1055: (Each undeclared identifier is
reported only once
requestobject.c:1055: for each function it appears
in.)
requestobject.c:1056: parse error before "l"
requestobject.c:1057: `l' undeclared (first use in
this function)
requestobject.c: At top level:
requestobject.c:1270: warning: initialization from
incompatible pointer type
apxs:Error: Command failed with rc=65536
.
make[1]: *** [mod_python.so] Error 1
make[1]: Leaving directory
`/usr/local/mod_python-3.0.3/src'
make: *** [do_dso] Error 2

I'm stumped.

Cheers


__________________________________
Do you Yahoo!?
Yahoo! SiteBuilder - Free, easy-to-use web site design software
http://sitebuilder.yahoo.com
From eu5698 at hotmail.com  Fri Jul 25 15:25:46 2003
From: eu5698 at hotmail.com (Rui Santos)
Date: Fri Jan  9 21:53:44 2004
Subject: [mod_python] problem to install mod_python
Message-ID: <LAW15-DAV73ur2iz2Mb00004329@hotmail.com>

hello.

i have been follow this steps: 

http://www.modpython.org/live/mod_python-2.7.8/doc-html/app-wininst.html

but when i test the apache then give me one error:

Invalid command 'PythonHandler'.

i use: 
a.. Python 2.2.3
a.. Apache 1.3.28 .



with the best compliments 
Rui Santos 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20030725/e5177210/attachment-0001.htm
From tnienstedt at telesyn.com  Sat Jul 26 09:30:54 2003
From: tnienstedt at telesyn.com (Ted Nienstedt)
Date: Fri Jan  9 21:53:44 2004
Subject: [mod_python] qdemo/publish_error not working for IE with mod_python
Message-ID: <000201c3537a$23974ea0$2e1210ac@telesyn.corp>

I installed Quixote on Linux RedHat 9 and installed the qdemo as
described in
http://www.mems-exchange.org/software/quixote/doc/web-server.html,
and also doc/demo.txt .  Everything worked fine with the cgi-bin in the
URL.  I've since switched to mod_python and added the <LocationMatch>
directive to httpd.conf.
Once I made the switch to mod_python I encountered a couple of apparent
"bugs" in quixote's http_request.py which I fixed by passing an empty
string instead of None in the 2nd arg of environ.get().  After making
this fix everything works with mod_python, but qdemo/publish_error from
IE returns the standard IE 400 Bad Request.
It works fine with mod_python from Opera or from the local lunix machine
with Mozilla.
Any clues or suggestions?
Thanks,
Ted
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20030726/321fcafc/attachment-0001.htm
From indrek at inversion.ee  Wed Jul 30 11:33:51 2003
From: indrek at inversion.ee (Indrek =?ISO-8859-1?Q?J=E4rve?=)
Date: Fri Jan  9 21:53:44 2004
Subject: [mod_python] A few questions about requestobject.c
Message-ID: <1059554030.13258.71.camel@hercules.dustbite.org>

Hi,

I've been messing around in requestobject.c for a few hours and started
wondering about the way a few things work. Since I'm not sure whether
they are design decisions, apache related stuff or just weird things, I
thought I'd ask the list :)

1. The use of apr_palloc

Multipart POST forms are parsed in util.py/FieldStorage using req's
req_readline function, which happily apr_palloc'ates enough memory to
read the remaining request data into memory, but never seems to free it
(nasty if the users have a habit of uploading 100+MB files, especially
once multiplied with the number of apache processes). Since the pool
used is attached to the apache request, I'm not sure I should freely
apr_pool_clear() or apr_pool_destroy() it either.

I managed to release memory by replacing apr_palloc with malloc and
adding a few free()s where required, but is this the right approach?

2. The use of PyString_FromStringAndSize()

Again in the req_readline() function, the result variable is initialized
at the size of the full remaining request data. Could the result
variable initialization perhaps be moved a bit further down to

a) when checking if rbuff from previous reads has a '\n' in it (perhaps
check with strchr and then initialize if needed) and 
b) after reading data from request and before copying it to the result.

At both these places it should be more obvious how much memory needs to
be allocated.


If I managed to make no sense at all and got something mixed up, please
let me know. However, I feel that at least the first point could use
some attention, as it creates a problem when uploading big files through
mod_python enabled scripts.

Regards,
Indrek

From grisha at modpython.org  Wed Jul 30 09:05:53 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:44 2004
Subject: [mod_python] A few questions about requestobject.c
In-Reply-To: <1059554030.13258.71.camel@hercules.dustbite.org>
References: <1059554030.13258.71.camel@hercules.dustbite.org>
Message-ID: <20030730085411.W86294@onyx.ispol.com>



On Wed, 30 Jul 2003, Indrek [ISO-8859-1] J?rve wrote:
>
> I've been messing around in requestobject.c for a few hours and started
> wondering about the way a few things work. Since I'm not sure whether
> they are design decisions, apache related stuff or just weird things, I
> thought I'd ask the list :)

It's been so long we lost track of which of the three they are :-) (BTW, a
better list for this sort of thing is python-dev@httpd.apache.org).

> 1. The use of apr_palloc
>
> Multipart POST forms are parsed in util.py/FieldStorage using req's
> req_readline function, which happily apr_palloc'ates enough memory to
> read the remaining request data into memory, but never seems to free it
> (nasty if the users have a habit of uploading 100+MB files, especially
> once multiplied with the number of apache processes). Since the pool
> used is attached to the apache request, I'm not sure I should freely
> apr_pool_clear() or apr_pool_destroy() it either.
>
> I managed to release memory by replacing apr_palloc with malloc and
> adding a few free()s where required, but is this the right approach?

Yes, this would definitely be a problem because that memory isn't freed
until the end of the request... We could either create a separate pool,
which then can be apr_pool_cleared(), or just use malloc like you have...
I'll see if I can take a look at it later today. If you have a patch you
could send in, that'd be nice.

>
> 2. The use of PyString_FromStringAndSize()
>
> Again in the req_readline() function, the result variable is initialized
> at the size of the full remaining request data.

This would be a problem with 100M files too... Another thing that occured
to me is that it could be better to rewrite the request read() functions
to use the buckets interface, this way none of this would be an issue.

Grisha
From azaroth at liverpool.ac.uk  Tue Jul  1 15:53:15 2003
From: azaroth at liverpool.ac.uk (Robert Sanderson)
Date: Fri Jan  9 22:00:11 2004
Subject: [mod_python] ConnectionHandler sigsegv (fwd)
In-Reply-To: <20030630092522.B53253@onyx.ispol.com>
Message-ID: <Pine.LNX.4.44.0307011548230.12884-100000@gondolin.hist.liv.ac.uk>


> The normal way of dealing with this sort of thing is by calling select()
> on a socket which will then call your function when there is anything to
> read. I don't know whether APR provides this.

Right. I can't see it anywhere, but that doesn't mean it's not available. 
 
> I think your only option is to read a byte at a time, making sure that
> when you receivie a complete frame/packet/whatever you stop reading so as
> to not block indefinitely.

Yep, I've now successfully implemented a Z39.50 connection handler using 
mod_python and PyZ3950 under Apache using this technique, though it's not 
pretty having to try to parse a PDU after reading in each byte. 

Cheers,

Rob

-- 
      ,'/:.          Rob Sanderson (azaroth@liverpool.ac.uk)
    ,'-/::::.        http://www.o-r-g.org/~azaroth/
  ,'--/::(@)::.      Special Collections and Archives, extension 3142
,'---/::::::::::.    Nebmedes:  telnet: nebmedes.o-r-g.org 7777
____/:::::::::::::.                WWW:  http://nebmedes.o-r-g.org:8000/
I L L U M I N A T I

From grisha at modpython.org  Tue Jul  1 12:12:58 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:00:12 2004
Subject: [mod_python] ConnectionHandler sigsegv (fwd)
In-Reply-To: <Pine.LNX.4.44.0307011548230.12884-100000@gondolin.hist.liv.ac.uk>
References: <Pine.LNX.4.44.0307011548230.12884-100000@gondolin.hist.liv.ac.uk>
Message-ID: <20030701114138.D75368@onyx.ispol.com>



On Tue, 1 Jul 2003, Robert Sanderson wrote:

> > I think your only option is to read a byte at a time, making sure that
> > when you receivie a complete frame/packet/whatever you stop reading so as
> > to not block indefinitely.
>
> Yep, I've now successfully implemented a Z39.50 connection handler using
> mod_python and PyZ3950 under Apache

Cool (even though I don't know what Z39.50 is :-) )

> using this technique, though it's not pretty having to try to parse a
> PDU after reading in each byte.

This is a pretty common technique in C, but in Python it is definitely
very inefficient because every "byte" is really a string... You could
probably get some improvement from using Python buffer(). I imagine this
will be a fairly common problem for people who implement connections, so
if you have any ideas on how it can be improved, please be sure to share
them on the list.

Grisha
From alexiev at activesolutions.bg  Wed Jul  2 17:18:35 2003
From: alexiev at activesolutions.bg (Alexiev Nikolay)
Date: Fri Jan  9 22:00:12 2004
Subject: [mod_python] Cookie
Message-ID: <00ce01c340a4$d30e74a0$0a01010a@dev1>

I want to save 2 cookies using mod_python & Cookie modul. Can somebody help
me, please?
10x

Best regards,
Alexiev, Nikolay

From grisha at modpython.org  Wed Jul  2 17:31:20 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:00:12 2004
Subject: [mod_python] Cookie
In-Reply-To: <00ce01c340a4$d30e74a0$0a01010a@dev1>
References: <00ce01c340a4$d30e74a0$0a01010a@dev1>
Message-ID: <20030702172715.A10551@onyx.ispol.com>


Something like this:

c1 = Cookie.SimpleCookie("cookie1=value1")
req.headers_out["Set-Cookie"] = c1.output(header="").strip()

c2 = Cookie.SimpleCookie("cookie2=value2")
req.headers_out.add("Set-Cookie") = c2.output(header="").strip()


Using the standard lib Cookie module is a bit ugly with mod_python because
Cookie was designed with CGI in mind, which is why the next release of
mod_python will have its own Cookie module.

Grisha


On Wed, 2 Jul 2003, Alexiev Nikolay wrote:

> I want to save 2 cookies using mod_python & Cookie modul. Can somebody help
> me, please?
> 10x
>
> Best regards,
> Alexiev, Nikolay
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From dlrubin at yahoo.com  Wed Jul  2 17:46:52 2003
From: dlrubin at yahoo.com (Daniel Rubin)
Date: Fri Jan  9 22:00:12 2004
Subject: [mod_python] problem creating an instance and debugging
Message-ID: <20030703004652.45793.qmail@web13904.mail.yahoo.com>

I successfully installed mod_python 3.0.3 and have it
working with apache, but one of my handlers isn't
working and I'm unable to get mod_python to record any
error messages about this particular event to the
apache error log. Basically, I have a handler called
xmlrpc that creates a python object called obj.  The
library needed to make this object gets imported
within xmlrpc.py just fine, but right at the line
where I create a new instance of obj (foo = obj()) I
get a stack dump (see below), and there are no errors
in the apache logs.  The xmlrpc.py program runs just
fine as a cgi within apache. It's when it runs with
mod_python that this fails. Any ideas?

in httpd.conf:
<Directory "/home/rubin/opt/apache/htdocs/xmlrpc">
    AddHandler python-program .py
    PythonHandler xmlrpc
    PythonDebug On
</Directory>

The stack dump:

  File "/test.py", line 52, in ?
    p = do_test(data)
  File "/test.py", line 44, in do_test
    return server.do_test(data)
  File "/home/lib/python2.2/xmlrpclib.py", line 821,
in __call__
    return self.__send(self.__name, args)
  File "/home/lib/python2.2/xmlrpclib.py", line 975,
in __request
    verbose=self.__verbose
  File "/home/lib/python2.2/xmlrpclib.py", line 853,
in request
    return self.parse_response(h.getfile())
  File "/home/lib/python2.2/xmlrpclib.py", line 886,
in parse_response
    response = f.read(1024)
  File "/home/lib/python2.2/httplib.py", line 1140, in
read
    assert not self._line_consumed and self._line_left
AssertionError



__________________________________
Do you Yahoo!?
SBC Yahoo! DSL - Now only $29.95 per month!
http://sbc.yahoo.com
From gnb at itga.com.au  Thu Jul  3 11:46:59 2003
From: gnb at itga.com.au (Gregory Bond)
Date: Fri Jan  9 22:00:12 2004
Subject: [mod_python] problem creating an instance and debugging 
In-Reply-To: Your message of Wed, 02 Jul 2003 17:46:52 -0700.
Message-ID: <200307030146.LAA14756@lightning.itga.com.au>

> working and I'm unable to get mod_python to record any
> error messages about this particular event to the
> apache error log.

stderr in mod_python goes to the apache error log but it is buffered.  You 
need to use sys.stderr.flush() at appropriate times.

See FAQ 2.3:
	http://www.modpython.org/FAQ/faqw.py?req=show&file=faq02.003.htp

From dustin at ywlcs.org  Wed Jul  2 21:02:43 2003
From: dustin at ywlcs.org (Dustin Mitchell)
Date: Fri Jan  9 22:00:12 2004
Subject: [mod_python] problem creating an instance and debugging
In-Reply-To: <20030703004652.45793.qmail@web13904.mail.yahoo.com>
References: <20030703004652.45793.qmail@web13904.mail.yahoo.com>
Message-ID: <20030703020242.GD23014@eleanor.internal.ywlcs.org>

On Wed, Jul 02, 2003 at 05:46:52PM -0700, Daniel Rubin wrote:
<snip snip>
> in parse_response
>     response = f.read(1024)
>   File "/home/lib/python2.2/httplib.py", line 1140, in
> read
>     assert not self._line_consumed and self._line_left
> AssertionError

Looking at this assertion, it seems valid.  Which is to say, in a linear
code flow, it should never get triggered.  My conjuecture then would be
that this is a threading issue.  Is your code using global variables of
any sort?  I'm pretty confident xmlrpclib and httplib are thread-safe,
but perhaps someone knows something to the contrary?

Dustin

-- 

  Dustin Mitchell
  dustin@ywlcs.org/djmitche@alumni.uchicago.edu
  http://people.cs.uchicago.edu/~dustin/
From dlrubin at yahoo.com  Wed Jul  2 20:28:35 2003
From: dlrubin at yahoo.com (Daniel Rubin)
Date: Fri Jan  9 22:00:12 2004
Subject: [mod_python] problem creating an instance and debugging 
In-Reply-To: <200307030146.LAA14756@lightning.itga.com.au>
Message-ID: <20030703032835.32306.qmail@web13905.mail.yahoo.com>

Putting sys.stderr.flush() into my xmlrpc.py doesn't
cause anything to get written to the apache log file.
I've even tried sys.stderr.write("stuff") and it
doesn't seem to appear anywhere (console nor apache
logs). Is there no way to track what's going on in the
code running on the server side in mod_python?

Thanks,
Daniel


--- Gregory Bond <gnb@itga.com.au> wrote:
> > working and I'm unable to get mod_python to record
> any
> > error messages about this particular event to the
> > apache error log.
> 
> stderr in mod_python goes to the apache error log
> but it is buffered.  You 
> need to use sys.stderr.flush() at appropriate times.
> 
> See FAQ 2.3:
> 
>
http://www.modpython.org/FAQ/faqw.py?req=show&file=faq02.003.htp
> 


__________________________________
Do you Yahoo!?
SBC Yahoo! DSL - Now only $29.95 per month!
http://sbc.yahoo.com
From gnb at itga.com.au  Thu Jul  3 14:03:17 2003
From: gnb at itga.com.au (Gregory Bond)
Date: Fri Jan  9 22:00:12 2004
Subject: [mod_python] problem creating an instance and debugging 
In-Reply-To: Your message of Wed, 02 Jul 2003 20:28:35 -0700.
Message-ID: <200307030403.OAA27049@lightning.itga.com.au>

> I've even tried sys.stderr.write("stuff") and it
> doesn't seem to appear anywhere (console nor apache
> logs). 

Well, it works fine to the error_log for me!  (apache1 and apache2 on Unix).
It may be something to do with your apache config, in particular the virtual
host logging setup.


From mike.looijmans at asml.com  Thu Jul  3 07:36:59 2003
From: mike.looijmans at asml.com (Mike Looijmans)
Date: Fri Jan  9 22:00:12 2004
Subject: [mod_python] Cookie
Message-ID: <01c34125$1f3a0f80$926a1e6e@wsasd464>

>I want to save 2 cookies using mod_python & Cookie modul. Can somebody help
>me, please?


Put your cookies in a SimpleCookie or SmartCookie, and use:

req.headers_out.add('Set-Cookie', cookies.output(header='',
sep='\r\nSet-Cookie:'))

to add them all in one shot.

--
Mike Looijmans
Private: http://www.milosoftware.com
-- Sorry about the nonsense below --



-- 
The information contained in this communication and any attachments is confidential and may be privileged, and is for the sole use of the intended recipient(s). Any unauthorized review, use, disclosure or distribution is prohibited. If you are not the intended recipient, please notify the sender immediately by replying to this message and destroy all copies of this message and any attachments. ASML is neither liable for the proper and complete transmission of the information contained in this communication, nor for any delay in its receipt.


From mike.looijmans at asml.com  Thu Jul  3 07:42:58 2003
From: mike.looijmans at asml.com (Mike Looijmans)
Date: Fri Jan  9 22:00:12 2004
Subject: [mod_python] Cookie
Message-ID: <01c34125$f5351d00$926a1e6e@wsasd464>

>Using the standard lib Cookie module is a bit ugly with mod_python because
>Cookie was designed with CGI in mind, which is why the next release of
>mod_python will have its own Cookie module.


Something like:

Request.cookie

so that Request has a 'cookie' object by default, which parses the 'cookie'
headers at the first call to Request.cookie. When setting it, it outputs the
cookie to the headers.

It would be a requirement to use the same interface as Cookie does, since that
allows CGI and mod_python code to share that part.

Mike.
-- My message ends here --



-- 
The information contained in this communication and any attachments is confidential and may be privileged, and is for the sole use of the intended recipient(s). Any unauthorized review, use, disclosure or distribution is prohibited. If you are not the intended recipient, please notify the sender immediately by replying to this message and destroy all copies of this message and any attachments. ASML is neither liable for the proper and complete transmission of the information contained in this communication, nor for any delay in its receipt.


From bill at rfa.org  Thu Jul  3 10:07:44 2003
From: bill at rfa.org (Bill Eldridge)
Date: Fri Jan  9 22:00:12 2004
Subject: [mod_python] Cookie
In-Reply-To: <20030702172715.A10551@onyx.ispol.com>
References: <00ce01c340a4$d30e74a0$0a01010a@dev1>
	<20030702172715.A10551@onyx.ispol.com>
Message-ID: <3F03E450.3070203@rfa.org>


PSO also has a session module that can be split off for
mod_python:

http://www.scriptfoundry.com/modules/pso/doc/session-modpython.html
http://www.scriptfoundry.com/modules/pso


Gregory (Grisha) Trubetskoy wrote:

>Something like this:
>
>c1 = Cookie.SimpleCookie("cookie1=value1")
>req.headers_out["Set-Cookie"] = c1.output(header="").strip()
>
>c2 = Cookie.SimpleCookie("cookie2=value2")
>req.headers_out.add("Set-Cookie") = c2.output(header="").strip()
>
>
>Using the standard lib Cookie module is a bit ugly with mod_python because
>Cookie was designed with CGI in mind, which is why the next release of
>mod_python will have its own Cookie module.
>
>Grisha
>
>
>On Wed, 2 Jul 2003, Alexiev Nikolay wrote:
>
>  
>
>>I want to save 2 cookies using mod_python & Cookie modul. Can somebody help
>>me, please?
>>10x
>>
>>Best regards,
>>Alexiev, Nikolay
>>
>>_______________________________________________
>>Mod_python mailing list
>>Mod_python@modpython.org
>>http://mailman.modpython.org/mailman/listinfo/mod_python
>>
>>    
>>
>_______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org
>http://mailman.modpython.org/mailman/listinfo/mod_python
>  
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20030703/42c7f02a/attachment-0002.htm
From alexiev at activesolutions.bg  Thu Jul  3 14:39:49 2003
From: alexiev at activesolutions.bg (Alexiev Nikolay)
Date: Fri Jan  9 22:00:12 2004
Subject: [mod_python] Save cookie and redirect
Message-ID: <012101c34157$cfb52020$0a01010a@dev1>

I try to set cookie and redirect with one response. Redirect works fine but
cookie dosn't exist. What can I do?


HTTP_MOVED_PERMANENTLY = 301
req.headers_out.add('Set-Cookie', cookies.output(header='',
sep='\r\nSet-Cookie:'))
req.headers_out.add('Location', redirect)
req.status = HTTP_MOVED_PERMANENTLY

From manfred.stienstra at dwerg.net  Thu Jul  3 13:57:04 2003
From: manfred.stienstra at dwerg.net (Manfred Stienstra)
Date: Fri Jan  9 22:00:12 2004
Subject: [mod_python] Save cookie and redirect
In-Reply-To: <012101c34157$cfb52020$0a01010a@dev1>
References: <012101c34157$cfb52020$0a01010a@dev1>
Message-ID: <200307031357.04468.manfred.stienstra@dwerg.net>

On Thursday 03 July 2003 13:39, Alexiev Nikolay wrote:
> I try to set cookie and redirect with one response. Redirect works fine but
> cookie dosn't exist. What can I do?
>
>
> HTTP_MOVED_PERMANENTLY = 301
> req.headers_out.add('Set-Cookie', cookies.output(header='',
> sep='\r\nSet-Cookie:'))
> req.headers_out.add('Location', redirect)
> req.status = HTTP_MOVED_PERMANENTLY

First set the cookie and after that redirect. If it's a login page you could 
display a page saying something like 'successfully logged in' (setting the 
cookie) and after that (5 secs or something) you redirect.

Manfred

From dustin at ywlcs.org  Thu Jul  3 08:22:11 2003
From: dustin at ywlcs.org (Dustin Mitchell)
Date: Fri Jan  9 22:00:12 2004
Subject: [mod_python] problem creating an instance and debugging
In-Reply-To: <20030703032835.32306.qmail@web13905.mail.yahoo.com>
References: <200307030146.LAA14756@lightning.itga.com.au>
	<20030703032835.32306.qmail@web13905.mail.yahoo.com>
Message-ID: <20030703132210.GI23014@eleanor.internal.ywlcs.org>

On Wed, Jul 02, 2003 at 08:28:35PM -0700, Daniel Rubin wrote:
> Putting sys.stderr.flush() into my xmlrpc.py doesn't
> cause anything to get written to the apache log file.
> I've even tried sys.stderr.write("stuff") and it
> doesn't seem to appear anywhere (console nor apache
> logs). Is there no way to track what's going on in the
> code running on the server side in mod_python?

I usually open an external file in append mode and write to that.  Then
I tail -f that file, and there's the information I wanted!  It has the
advantage that nothing in the Apache config can cause me to miss
selected messages or anything like that.

Dustin

-- 

  Dustin Mitchell
  dustin@ywlcs.org/djmitche@alumni.uchicago.edu
  http://people.cs.uchicago.edu/~dustin/
From grisha at modpython.org  Thu Jul  3 09:46:00 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:00:12 2004
Subject: [mod_python] problem creating an instance and debugging 
In-Reply-To: <20030703032835.32306.qmail@web13905.mail.yahoo.com>
References: <20030703032835.32306.qmail@web13905.mail.yahoo.com>
Message-ID: <20030703094320.P12723@onyx.ispol.com>


Why not just use apache.log_error or req.log_error?

http://www.modpython.org/live/current/doc-html/pyapi-apmeth.html#l2h-18

On Wed, 2 Jul 2003, Daniel Rubin wrote:

> Putting sys.stderr.flush() into my xmlrpc.py doesn't
> cause anything to get written to the apache log file.
> I've even tried sys.stderr.write("stuff") and it
> doesn't seem to appear anywhere (console nor apache
> logs). Is there no way to track what's going on in the
> code running on the server side in mod_python?
>
> Thanks,
> Daniel
>
>
> --- Gregory Bond <gnb@itga.com.au> wrote:
> > > working and I'm unable to get mod_python to record
> > any
> > > error messages about this particular event to the
> > > apache error log.
> >
> > stderr in mod_python goes to the apache error log
> > but it is buffered.  You
> > need to use sys.stderr.flush() at appropriate times.
> >
> > See FAQ 2.3:
> >
> >
> http://www.modpython.org/FAQ/faqw.py?req=show&file=faq02.003.htp
> >
>
>
> __________________________________
> Do you Yahoo!?
> SBC Yahoo! DSL - Now only $29.95 per month!
> http://sbc.yahoo.com
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From dlrubin at yahoo.com  Thu Jul  3 07:30:13 2003
From: dlrubin at yahoo.com (Daniel Rubin)
Date: Fri Jan  9 22:00:12 2004
Subject: [mod_python] problem creating an instance and debugging 
In-Reply-To: <20030703094320.P12723@onyx.ispol.com>
Message-ID: <20030703143013.36335.qmail@web13907.mail.yahoo.com>

The problem is that the xmlrpc.py script on the server
dies at a line of code that doesn't cause an Exception
to be thrown, so nothing executes after that line of
code and lines calling a log event will never get
executed.  And for some reason, no error message is
appearing in the apache error log (I have a pretty
standard httpd.conf).

--- "Gregory (Grisha) Trubetskoy"
<grisha@modpython.org> wrote:
> 
> Why not just use apache.log_error or req.log_error?
> 
>
http://www.modpython.org/live/current/doc-html/pyapi-apmeth.html#l2h-18
> 
> On Wed, 2 Jul 2003, Daniel Rubin wrote:
> 
> > Putting sys.stderr.flush() into my xmlrpc.py
> doesn't
> > cause anything to get written to the apache log
> file.
> > I've even tried sys.stderr.write("stuff") and it
> > doesn't seem to appear anywhere (console nor
> apache
> > logs). Is there no way to track what's going on in
> the
> > code running on the server side in mod_python?
> >
> > Thanks,
> > Daniel
> >
> >
> > --- Gregory Bond <gnb@itga.com.au> wrote:
> > > > working and I'm unable to get mod_python to
> record
> > > any
> > > > error messages about this particular event to
> the
> > > > apache error log.
> > >
> > > stderr in mod_python goes to the apache error
> log
> > > but it is buffered.  You
> > > need to use sys.stderr.flush() at appropriate
> times.
> > >
> > > See FAQ 2.3:
> > >
> > >
> >
>
http://www.modpython.org/FAQ/faqw.py?req=show&file=faq02.003.htp
> > >
> >
> >
> > __________________________________
> > Do you Yahoo!?
> > SBC Yahoo! DSL - Now only $29.95 per month!
> > http://sbc.yahoo.com
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> >
>
http://mailman.modpython.org/mailman/listinfo/mod_python
> >


__________________________________
Do you Yahoo!?
SBC Yahoo! DSL - Now only $29.95 per month!
http://sbc.yahoo.com
From grisha at modpython.org  Thu Jul  3 10:47:15 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:00:13 2004
Subject: [mod_python] problem creating an instance and debugging
In-Reply-To: <20030703004652.45793.qmail@web13904.mail.yahoo.com>
References: <20030703004652.45793.qmail@web13904.mail.yahoo.com>
Message-ID: <20030703104322.J23236@onyx.ispol.com>



On Wed, 2 Jul 2003, Daniel Rubin wrote:

> within xmlrpc.py just fine, but right at the line where I create a new
> instance of obj (foo = obj()) I get a stack dump (see below), and there
> are no errors in the apache logs.

I'm confused - how do you know you get a stack dump?

Also - which are you most concerned with - the fact that there is nothing
in the logs, or that you get a stack dump under mod_python whereas as a
CGI it works ok?

Grisha
From grisha at modpython.org  Thu Jul  3 10:58:33 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:00:13 2004
Subject: [mod_python] Save cookie and redirect
In-Reply-To: <200307031357.04468.manfred.stienstra@dwerg.net>
References: <012101c34157$cfb52020$0a01010a@dev1>
	<200307031357.04468.manfred.stienstra@dwerg.net>
Message-ID: <20030703104837.L23236@onyx.ispol.com>


Could it be that the location that you're redirecting to isn't valid for
this cookie? IIRC, the default path attribute is the full path, i.e. if
cookie was issued in /my/location1/blah and you're redirecting to
/my/location2/blah, the browser won't send the cookie (unless you
explicitely specify path=/my)

Grisha

On Thu, 3 Jul 2003, Manfred Stienstra wrote:

> On Thursday 03 July 2003 13:39, Alexiev Nikolay wrote:
> > I try to set cookie and redirect with one response. Redirect works fine but
> > cookie dosn't exist. What can I do?
> >
> >
> > HTTP_MOVED_PERMANENTLY = 301
> > req.headers_out.add('Set-Cookie', cookies.output(header='',
> > sep='\r\nSet-Cookie:'))
> > req.headers_out.add('Location', redirect)
> > req.status = HTTP_MOVED_PERMANENTLY
>
> First set the cookie and after that redirect. If it's a login page you could
> display a page saying something like 'successfully logged in' (setting the
> cookie) and after that (5 secs or something) you redirect.
>
> Manfred
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From dlrubin at yahoo.com  Thu Jul  3 09:11:20 2003
From: dlrubin at yahoo.com (Daniel Rubin)
Date: Fri Jan  9 22:00:13 2004
Subject: [mod_python] problem creating an instance and debugging
In-Reply-To: <20030703104322.J23236@onyx.ispol.com>
Message-ID: <20030703161120.58394.qmail@web13908.mail.yahoo.com>

I get the stack dump from the client program that
calls the function in xmlrpc.py running on the apache
server.  The client program gets the stack dump from a
call inside xmlrpclib that is trying to get a response
back from the xmlrpc.py running on the server.  An
error is happening in the xmlrpc.py program, and this
isn't making it's own stack dump or errors written to
the apache logs on the server. So I can't debug what
the nature of the error that is happening in the
remotely called function.

My main concern is that or that I get a stack dump
under mod_python whereas as a CGI it works ok. I'm
concerned about the lack of error logging to apache
only because it might help me figure out what's going
wrong with the code running in mod_python.


--- "Gregory (Grisha) Trubetskoy"
<grisha@modpython.org> wrote:
> 
> 
> On Wed, 2 Jul 2003, Daniel Rubin wrote:
> 
> > within xmlrpc.py just fine, but right at the line
> where I create a new
> > instance of obj (foo = obj()) I get a stack dump
> (see below), and there
> > are no errors in the apache logs.
> 
> I'm confused - how do you know you get a stack dump?
> 
> Also - which are you most concerned with - the fact
> that there is nothing
> in the logs, or that you get a stack dump under
> mod_python whereas as a
> CGI it works ok?
> 
> Grisha


__________________________________
Do you Yahoo!?
SBC Yahoo! DSL - Now only $29.95 per month!
http://sbc.yahoo.com
From grisha at modpython.org  Thu Jul  3 13:31:54 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:00:13 2004
Subject: [mod_python] problem creating an instance and debugging
In-Reply-To: <20030703161120.58394.qmail@web13908.mail.yahoo.com>
References: <20030703161120.58394.qmail@web13908.mail.yahoo.com>
Message-ID: <20030703132213.X23236@onyx.ispol.com>



On Thu, 3 Jul 2003, Daniel Rubin wrote:

> An error is happening in the xmlrpc.py program, and this isn't making
> it's own stack dump or errors written to the apache logs on the server.
> So I can't debug what the nature of the error that is happening in the
> remotely called function.

So, tell me if I understand this correctly (I'm not familiar with
xmlrpc.py) -

Xmlrpc.py is a CGI script which reports its errors by writing them to
stderr. Something happens when you run it under mod_python, and you don't
know what it is because stderr goes nowhere.

As far as I know, stderr output may end up in your error log, but I don't
think that's guaranteed and may be dependent on how your httpd was
compiled.  I think there is really no solution to this other than to tweak
xmlrpc into raising its exception or using mod_python's log_error to
report it.

HTH,

Grisha
From dlrubin at yahoo.com  Thu Jul  3 11:41:10 2003
From: dlrubin at yahoo.com (Daniel Rubin)
Date: Fri Jan  9 22:00:13 2004
Subject: [mod_python] problem creating an instance and debugging
In-Reply-To: <20030703132213.X23236@onyx.ispol.com>
Message-ID: <20030703184110.41206.qmail@web13905.mail.yahoo.com>

Here's the xmlrpc.py code. My client code is calling
the "evaluate" function via a call like this:
server = xmlrpclib.ServerProxy(myURI)
server.evaluate(data)

If I put the "return data" statement right before the
"model=Model()" statement, then things work fine. If I
put the return statement after it, then I get the
stack dump I showed you earlier. The code never jupmps
to the except: clause, and no errors are being written
to the apache logs (and my conf file is set to record
everything with no virtual hosts).


from mod_python import apache
import xmlrpclib

def evaluate(data):
     import MyTools import Model
     try:
          model = Model()  <--an error happens here
          return data
     except:
          open("/tmp/test_xmlrpc01",
'w').write("RUNNING ON %s" % findings)
          import traceback
         
traceback.print_exc(file=open("/tmp/test_xmlrpc03",
'w'))
          raise

def handler(req):
    import sys
    
    module = sys.modules[__name__]

    # Load the method and arguments from the client.
    content = req.read()

    # xmlrpclib fails if there are characters with
ASCII code >= 128.
    # Thus, change anything greater than that to a
space.
    table = ''.join(map(chr, range(128))) + " "*128
    content = content.translate(table)
        
    args, method_name = xmlrpclib.loads(content)

    # Call the method.
    if hasattr(module, method_name):
        try:
            retval = getattr(module,
method_name)(*args)
        except Exception, x:
            retval = xmlrpclib.Fault(
                0, "Exception (%s) raised: %s" %
(Exception.__name__, str(x)))
        except x:
            retval = xmlrpclib.Fault(
                0, "General exception raised: %s" %
str(x))
    else:
        retval = xmlrpclib.Fault(
            0, "This server does not provide: '%s'" %
method_name)

    # Marshal the return value and write the results
back to the
    # client.
    req.content_type = "text/xml"
    marshalled = xmlrpclib.dumps((retval,),
methodresponse=1)
    req.write(marshalled)
    
    return apache.OK



--- "Gregory (Grisha) Trubetskoy"
<grisha@modpython.org> wrote:
> 
> 
> On Thu, 3 Jul 2003, Daniel Rubin wrote:
> 
> > An error is happening in the xmlrpc.py program,
> and this isn't making
> > it's own stack dump or errors written to the
> apache logs on the server.
> > So I can't debug what the nature of the error that
> is happening in the
> > remotely called function.
> 
> So, tell me if I understand this correctly (I'm not
> familiar with
> xmlrpc.py) -
> 
> Xmlrpc.py is a CGI script which reports its errors
> by writing them to
> stderr. Something happens when you run it under
> mod_python, and you don't
> know what it is because stderr goes nowhere.
> 
> As far as I know, stderr output may end up in your
> error log, but I don't
> think that's guaranteed and may be dependent on how
> your httpd was
> compiled.  I think there is really no solution to
> this other than to tweak
> xmlrpc into raising its exception or using
> mod_python's log_error to
> report it.
> 
> HTH,
> 
> Grisha


__________________________________
Do you Yahoo!?
SBC Yahoo! DSL - Now only $29.95 per month!
http://sbc.yahoo.com
From harm-modpython at tty.nl  Fri Jul  4 19:00:39 2003
From: harm-modpython at tty.nl (harm)
Date: Fri Jan  9 22:00:13 2004
Subject: [mod_python] OSx compile problem
Message-ID: <20030704170039.GA5999@godel>


Moi,

somehow compiling on OSX does not work for me (OSX 10.2) with python 2.2.3,
mod_python 2.7.8 and apache 1.3.27


trying a static build gives:

gcc  -DDARWIN -DUSE_HSREGEX -DUSE_EXPAT -I./lib/expat-lite -DNO_DL_NEEDED
`./apaci` -u __dummy -u _PyMac_Error -framework System -framework
CoreServices -framework Foundation        \
      -o httpd buildmark.o modules.o modules/python/libpython.a
modules/standard/libstandard.a main/libmain.a ./os/unix/libos.a ap/libap.a
regex/libregex.a lib/expat-lite/libexpat.a  -lm
/usr/local/lib/python2.2/config/libpython2.2.a   -ldl                 
ld: table of contents for archive: modules/python/libpython.a is out of
date; rerun ranlib(1) (can't load from it)
make[2]: *** [target_static] Error 1
make[1]: *** [build-std] Error 2
make: *** [build] Error 2
[Harmens-Computer:/tmp/apache_1.3.27] harmen%



A DSO gives:
Compiling for DSO. For static, do "make static"

/usr/local/apache/sbin/apxs -I/tmp/mod_python-2.7.8/src/include
-I/usr/local/apache/include -I/usr/local/include/python2.2 -c mod_python.o
_apachemodule.o requestobject.o tableobject.o util.o serverobject.o
connobject.o  -lm  /usr/local/lib/python2.2/config/libpython2.2.a   -ldl                 
  -o mod_python.so mod_python.o _apachemodule.o requestobject.o
tableobject.o util.o serverobject.o connobject.o -lm
/usr/local/lib/python2.2/config/libpython2.2.a -ldl 
apxs:Break: Command failed with rc=16777215
make[1]: *** [mod_python.so] Error 1
make: *** [do_dso] Error 2
[Harmens-Computer:/tmp/mod_python-2.7.8] harmen% 




The ./configure output indicates it does take the right freshly recompiled nonthreaded python libs.  Any hints?

Thanks,
Harmen



(Hope this email does get through, my excuse for any doubles)

-- 
                               The Moon is Waxing Crescent (13% of Full)
From grisha at modpython.org  Fri Jul  4 15:10:21 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:00:13 2004
Subject: [mod_python] OSx compile problem
In-Reply-To: <20030704170039.GA5999@godel>
References: <20030704170039.GA5999@godel>
Message-ID: <20030704150856.U35122@onyx.ispol.com>



On Fri, 4 Jul 2003, harm wrote:

> somehow compiling on OSX does not work for me (OSX 10.2) with python 2.2.3,
>
> The ./configure output indicates it does take the right freshly
> recompiled nonthreaded python libs.  Any hints?

Check the README - there are some problems with darwin's libtool and the
way dynamic linking works, but the README has the steps to get it
compiled.

Grisha
From harm-modpython at tty.nl  Sat Jul  5 00:08:19 2003
From: harm-modpython at tty.nl (harm)
Date: Fri Jan  9 22:00:13 2004
Subject: [mod_python] OSx compile problem
In-Reply-To: <20030704150856.U35122@onyx.ispol.com>
References: <20030704170039.GA5999@godel>
	<20030704150856.U35122@onyx.ispol.com>
Message-ID: <20030704220819.GA6079@godel>

On Fri, Jul 04, 2003 at 03:10:21PM -0400, Gregory (Grisha) Trubetskoy wrote:
> 
> 
> On Fri, 4 Jul 2003, harm wrote:
> 
> > somehow compiling on OSX does not work for me (OSX 10.2) with python 2.2.3,
> >
> > The ./configure output indicates it does take the right freshly
> > recompiled nonthreaded python libs.  Any hints?
> 
> Check the README - there are some problems with darwin's libtool and the
> way dynamic linking works, but the README has the steps to get it
> compiled.

Ah! The readme in 3.0.3 has the info, indeed. Too bad I was trying to
install 2.7.8, which does not have that info :)

Thanks, 

Harmen
> 
> Grisha
> 

-- 
                               The Moon is Waxing Crescent (27% of Full)
From michel_ts at yahoo.com.br  Sat Jul  5 10:39:59 2003
From: michel_ts at yahoo.com.br (=?iso-8859-1?q?Michel=20Thadeu?=)
Date: Fri Jan  9 22:00:13 2004
Subject: [mod_python] A problem with publisher method...
Message-ID: <20030705133959.23742.qmail@web40408.mail.yahoo.com>

Hi guys!

I still have trouble with publisher method, I read a bite about and now
I imagine what is my problem...

The problem is with index, I want to access something like this:

http://127.0.0.1/mypage/test.py or better .../mypage/ (accessing the
index.py), but if I create an index function in test.py ou index.py, it
said 404notfound...

if I access index like in http://127.0.0.1/mypage/index.py/index it
goes ok. I think it conflitates in some point...

What could be the problem?

thanks for help and sorry my poor english!

[]'s

--
Michel Thadeu Sabchuk
Curitiba - Paran? - Brasil

=====
--
Michel Thadeu Sabchuk
Curitiba/PR

_______________________________________________________________________
Yahoo! Mail
Mais espa?o, mais seguran?a e gratuito: caixa postal de 6MB, antiv?rus, prote??o contra spam.
http://br.mail.yahoo.com/
From pascalbarbedor at free.fr  Sun Jul  6 11:29:36 2003
From: pascalbarbedor at free.fr (pascal barbedor)
Date: Fri Jan  9 22:00:13 2004
Subject: [mod_python] Fw: pb with apache readme dir include
Message-ID: <001601c343a1$32b7d550$468f933e@allalswqm99ewu>


>
>
> Hi
>
> I have the following problem with mod_python :
>
> set up a directory like this
>
>
> <Directory "c:/home/">
> AddHandler python-program .py .html
> PythonHandler eindex
> PythonDebug On
> DirectoryIndex index.html eindex.py
> Options Indexes
> Order allow,deny
> Allow from all
> </Directory>
>
> this works ok, I intercept also .html files in the eindex.py script.
>
> now if I call a subdirectory of home, like /home/subdir, control is passed
> to apache
> wich produces a standard directory index
>
> so far so good.
>
>
> now if a readme.html is located in the subdir, apache appends it to the
> directoryindex page,
> as it is normal by default.
>
> but then something interferes and it is like if the appended reame.html
was
> processed by the eindex.py above (but it is located in the subdir) and not
> by apache, though the bare directory index is here.
>
> of course if AddHandler python-program .py  (without .html) everything
goes
> well.
>
> I tried to add
> sethandler default-handler for home/subdir but it does not work
>
>
>
>
> pascal
>

From gnb at itga.com.au  Mon Jul  7 14:20:28 2003
From: gnb at itga.com.au (Gregory Bond)
Date: Fri Jan  9 22:00:13 2004
Subject: [mod_python] Compiling 2.7 statically
Message-ID: <200307070420.OAA24234@lightning.itga.com.au>

I'm trying to compile mod_python 2.7 (plus mod_ssl) statically into apache
1.3.27.  I'm using Python 2.1.1 on Solaris 6.

The first problem is that the Apache link step fails, because the mod_python 
library (libpython.a) refers to symbols in the libpython2.1.a library, and 
this is never referenced anywhere.  

I worked around that by adding ".../libpython2.1.a -lm" to EXTRA_LIBS in src/
Makefile.

This allows me to build an apache binary, and get the "Hello World" mod_python 
app working.  But as soon as I try any substantial application, I get errors 
like this:

PythonHandler oneaccount: ImportError: ld.so.1: /opt/apache/bin/httpd: fatal: relocation error: file /usr/local/lib/python2.1/lib-dynload/cStringIO.so: symbol PyCObject_FromVoidPtr: referenced symbol not found

which makes sense as these symbols are potentially not needed by mod_python 
therefore the relevent .o files aren't sucked in from the .a file.  

So how do I make this work? Or is statically compiling in mod_python a doomed 
exercise?



From stian at soiland.no  Mon Jul  7 18:15:16 2003
From: stian at soiland.no (Stian =?iso-8859-1?Q?S=F8iland?=)
Date: Fri Jan  9 22:00:13 2004
Subject: [mod_python] mod_python weirdness, maybe related to importing?
In-Reply-To: <20030610081422.GC28085@tummy.com>
References: <20030610055927.GB28085@tummy.com> <3EE584EE.9090503@sjsoft.com>
	<20030610081422.GC28085@tummy.com>
Message-ID: <20030707161516.GA614@itea.ntnu.no>

On 1970-01-01 01:00:00, Sean Reifschneider wrote:
   ~~~~
(.. importing the mail archives appearantly does not work that well
anymore :=) )

> On Tue, Jun 10, 2003 at 09:12:46AM +0200, David Fraser wrote:
> >Do you mean you're using this import mechanism when you have the problem 
> >with jotweb.input.Request below?
> 
> I mean that the imp module call is loading a module which then does an
> "import jotweb.input".  If in the jotweb I don't have the __init__.py
> import all sub-packages or sub-modules, I will get an AttributeError
> such as:
> 
>   AttributeError: 'module' object has no attribute 'input'

I can confirm the very same problem. We've been scratching our heads
today.

[ in this post I'll be quoting python code like /print "Python example"/ ]


We're using mod_python.publisher as PythonHandler, and have some
library functions in /usr/local/nav/navme/lib/python.

As our PythonPath seems to be totally mucked up, refering to
/usr/lib/python and so on, we .. as a quickfix.. set it manually

PythonPath "['', '/usr/local/lib/python2.2/site-packages',
    '/usr/lib/apache/python/lib/python2.2',
    '/usr/lib/apache/python/lib/python2.2/plat-linux2',
    '/usr/lib/apache/python/lib/python2.2/lib-tk',
    '/usr/lib/apache/python/lib/python2.2/lib-dynload',
    '/usr/lib/apache/python/lib/python2.2/site-packages',
    '/usr/local/nav/navme/lib/python',
    '/usr/local/lib/python2.2/site-packages', '.']"

(/usr/lib/apache/python/lib/python2.2 is our threadless installation,
this is Apache/1.3.27 (Unix) (Red-Hat/Linux) mod_python/2.7.8
Python/2.2.2 mod_ssl/2.8.12 OpenSSL/0.9.6b PHP/4.1.2)


The problem was weird, in a method logout() in index.py, we try
/from nav.web import state/. This always fail, both if we do it on a
module level or inside the function.

However, /from nav.web import auth/ works fine. The permissions are
perfect, there are no .pyc-files hanging around, and there is really no
big differences between the two files.

Actually we found out that symlinking nav/web to nav/webb - and trying
/from nav.webb import auth/  WORKED, suggesting some problems with
caching. Several apache-restarts gives no more help.

Using /usr/lib/apache/python/lib/python2.2/bin/python from the shell,
running as httpd, with the same PythonPath as above (verified by
req.write("%s" % sys.path)  ), from nav import auth works perfect.


The 'fix' you suggested, using import auth in nav/web/__init__.py - DID
work, however, as in your case, there is no reason why this should be
neccessary. 

In SOME of the cases in this testing, the error message is not from
/usr/local/nav/navme/apache/webroot/index.py (where the import actually
happens), but from mod_python/apache.py in the function import_module.
This function looks pretty weird to me, I tried adding some debug
sentences to follow the execution paths.


However, it turns out that our trouble-module nav.web.state is used as a
fixup handler as well, PythonFixupHandler nav.web.state.

Renaming to /PythonFixupHandler nav.webb.state/ removes the bug, 
/from nav.web import state/  suddenly works again.


So in our case, the problem is related to the module being used both in
handlers and imported by submodules. Appearently the errors from
mod_python.apache.import_module appears only those times the
PythonFixupHandler won't load. 

(debug messages reveal that import_module is NOT called by the normal
import sentence - that's good, as I couldn't understand how it could
have been called at that time :=) )



However, the problem is still unsolved, although the __init__.py-import
is  a working workaround (the symlink magic is NOT! :=) )

Is your problem-module a part of other headers (or imports) as well?


    (our team is also very pissed of by the need to restart apache every
    minute to force reloading of all modules.  It's seems like a 
    boring job to do like in 3.1 - as it still does not assure that
    modules are reloaded only once and in the correct order.

    A simple-but-stupid reload-all-modules-known-to-python fix did NOT
    work, as subclasses in different modules get totally confused being
    subclassed by some class that no longer exist. The problem is
    reloading in the correct order, and only once per request.

    Is there a nice way to UNLOAD all classes?  I'm thinking of
    something like /del sys.modules['mymodule']/ - but.. I'll have to
    check the module to see if it's mine or some internal python module
    first :=) )


-- 
Stian S?iland               Work toward win-win situation. Win-lose
Trondheim, Norway           is where you win and the other lose.
http://www.soiland.no/      Lose-lose and lose-win are left as an
                            exercise to the reader.  [Limoncelli/Hogan]


From stian at soiland.no  Mon Jul  7 18:19:49 2003
From: stian at soiland.no (Stian =?iso-8859-1?Q?S=F8iland?=)
Date: Fri Jan  9 22:00:13 2004
Subject: [mod_python] mod_python weirdness, maybe related to importing?
In-Reply-To: <20030616005419.GM8892@tummy.com>
References: <200306160025.KAA13272@lightning.itga.com.au>
	<20030616005419.GM8892@tummy.com>
Message-ID: <20030707161949.GB614@itea.ntnu.no>

On 1970-01-01 01:00:00, Sean Reifschneider wrote:

> Also, I'm running into cases where I'm setting values within modules in
> my handler, and then when I call code in the module those values are
> reset.  I've resorted to shoving request-persistent data into
> __builtins__, which works around the latter problem, and re-structuring
> some code so that my entire object heirarchy *CAN* be imported all at
> once.

Btw, a good tip to store some info from here to there is to store them
as attributes in the req object. We've created req.session by loading it
in the PythonFixupHandler mentioned in an earlier post, req.session is
available to all subsequent request handlers.

(and in some cases, weird enough, after the request is finished, the
attribute still remains in req.session for the NEXT call.. leading
to..
  
  def fixuphandler(req):
      req.session = None
)




-- 
Stian S?iland               Work toward win-win situation. Win-lose
Trondheim, Norway           is where you win and the other lose.
http://www.soiland.no/      Lose-lose and lose-win are left as an
                            exercise to the reader.  [Limoncelli/Hogan]

From stian at soiland.no  Mon Jul  7 18:33:44 2003
From: stian at soiland.no (Stian =?iso-8859-1?Q?S=F8iland?=)
Date: Fri Jan  9 22:00:13 2004
Subject: [mod_python] mod_python weirdness, maybe related to importing?
Message-ID: <20030707163344.GE614@itea.ntnu.no>

On 1970-01-01 01:00:00, Sean Reifschneider wrote:

> Also, I'm running into cases where I'm setting values within modules in
> my handler, and then when I call code in the module those values are
> reset.  I've resorted to shoving request-persistent data into
> __builtins__, which works around the latter problem, and re-structuring
> some code so that my entire object heirarchy *CAN* be imported all at
> once.

Btw, a good tip to store some info from here to there is to store them
as attributes in the req object. We've created req.session by loading it
in the PythonFixupHandler mentioned in an earlier post, req.session is
available to all subsequent request handlers.

(and in some cases, weird enough, after the request is finished, the
attribute still remains in req.session for the NEXT call.. leading
to..
  
  def fixuphandler(req):
      req.session = None
)




-- 
Stian S?iland               Work toward win-win situation. Win-lose
Trondheim, Norway           is where you win and the other lose.
http://www.soiland.no/      Lose-lose and lose-win are left as an
                            exercise to the reader.  [Limoncelli/Hogan]

From stian at soiland.no  Mon Jul  7 18:33:14 2003
From: stian at soiland.no (Stian =?iso-8859-1?Q?S=F8iland?=)
Date: Fri Jan  9 22:00:13 2004
Subject: [mod_python] mod_python weirdness, maybe related to importing?
Message-ID: <20030707163314.GD614@itea.ntnu.no>

(as I found out, posting before subscribing is a bad idea =) 

On 1970-01-01 01:00:00, Sean Reifschneider wrote:
   ~~~~
(.. importing the mail archives appearantly does not work that well
anymore :=) )

> On Tue, Jun 10, 2003 at 09:12:46AM +0200, David Fraser wrote:
> >Do you mean you're using this import mechanism when you have the problem 
> >with jotweb.input.Request below?
> 
> I mean that the imp module call is loading a module which then does an
> "import jotweb.input".  If in the jotweb I don't have the __init__.py
> import all sub-packages or sub-modules, I will get an AttributeError
> such as:
> 
>   AttributeError: 'module' object has no attribute 'input'

I can confirm the very same problem. We've been scratching our heads
today.

[ in this post I'll be quoting python code like /print "Python example"/ ]


We're using mod_python.publisher as PythonHandler, and have some
library functions in /usr/local/nav/navme/lib/python.

As our PythonPath seems to be totally mucked up, refering to
/usr/lib/python and so on, we .. as a quickfix.. set it manually

PythonPath "['', '/usr/local/lib/python2.2/site-packages',
    '/usr/lib/apache/python/lib/python2.2',
    '/usr/lib/apache/python/lib/python2.2/plat-linux2',
    '/usr/lib/apache/python/lib/python2.2/lib-tk',
    '/usr/lib/apache/python/lib/python2.2/lib-dynload',
    '/usr/lib/apache/python/lib/python2.2/site-packages',
    '/usr/local/nav/navme/lib/python',
    '/usr/local/lib/python2.2/site-packages', '.']"

(/usr/lib/apache/python/lib/python2.2 is our threadless installation,
this is Apache/1.3.27 (Unix) (Red-Hat/Linux) mod_python/2.7.8
Python/2.2.2 mod_ssl/2.8.12 OpenSSL/0.9.6b PHP/4.1.2)


The problem was weird, in a method logout() in index.py, we try
/from nav.web import state/. This always fail, both if we do it on a
module level or inside the function.

However, /from nav.web import auth/ works fine. The permissions are
perfect, there are no .pyc-files hanging around, and there is really no
big differences between the two files.

Actually we found out that symlinking nav/web to nav/webb - and trying
/from nav.webb import auth/  WORKED, suggesting some problems with
caching. Several apache-restarts gives no more help.

Using /usr/lib/apache/python/lib/python2.2/bin/python from the shell,
running as httpd, with the same PythonPath as above (verified by
req.write("%s" % sys.path)  ), from nav import auth works perfect.


The 'fix' you suggested, using import auth in nav/web/__init__.py - DID
work, however, as in your case, there is no reason why this should be
neccessary. 

In SOME of the cases in this testing, the error message is not from
/usr/local/nav/navme/apache/webroot/index.py (where the import actually
happens), but from mod_python/apache.py in the function import_module.
This function looks pretty weird to me, I tried adding some debug
sentences to follow the execution paths.


However, it turns out that our trouble-module nav.web.state is used as a
fixup handler as well, PythonFixupHandler nav.web.state.

Renaming to /PythonFixupHandler nav.webb.state/ removes the bug, 
/from nav.web import state/  suddenly works again.


So in our case, the problem is related to the module being used both in
handlers and imported by submodules. Appearently the errors from
mod_python.apache.import_module appears only those times the
PythonFixupHandler won't load. 

(debug messages reveal that import_module is NOT called by the normal
import sentence - that's good, as I couldn't understand how it could
have been called at that time :=) )



However, the problem is still unsolved, although the __init__.py-import
is  a working workaround (the symlink magic is NOT! :=) )

Is your problem-module a part of other headers (or imports) as well?


    (our team is also very pissed of by the need to restart apache every
    minute to force reloading of all modules.  It's seems like a 
    boring job to do like in 3.1 - as it still does not assure that
    modules are reloaded only once and in the correct order.

    A simple-but-stupid reload-all-modules-known-to-python fix did NOT
    work, as subclasses in different modules get totally confused being
    subclassed by some class that no longer exist. The problem is
    reloading in the correct order, and only once per request.

    Is there a nice way to UNLOAD all classes?  I'm thinking of
    something like /del sys.modules['mymodule']/ - but.. I'll have to
    check the module to see if it's mine or some internal python module
    first :=) )


-- 
Stian S?iland               Work toward win-win situation. Win-lose
Trondheim, Norway           is where you win and the other lose.
http://www.soiland.no/      Lose-lose and lose-win are left as an
                            exercise to the reader.  [Limoncelli/Hogan]

----- End forwarded message -----

-- 
Stian S?iland               Work toward win-win situation. Win-lose
Trondheim, Norway           is where you win and the other lose.
http://www.soiland.no/      Lose-lose and lose-win are left as an
                            exercise to the reader.  [Limoncelli/Hogan]

From jafo at tummy.com  Tue Jul  8 01:42:00 2003
From: jafo at tummy.com (Sean Reifschneider)
Date: Fri Jan  9 22:00:13 2004
Subject: [mod_python] mod_python weirdness, maybe related to importing?
In-Reply-To: <20030707161949.GB614@itea.ntnu.no>
References: <200306160025.KAA13272@lightning.itga.com.au>
	<20030616005419.GM8892@tummy.com> <20030707161949.GB614@itea.ntnu.no>
Message-ID: <20030708074200.GH1996@tummy.com>

On Mon, Jul 07, 2003 at 06:19:49PM +0200, Stian S?iland wrote:
>Btw, a good tip to store some info from here to there is to store them
>as attributes in the req object. We've created req.session by loading it

Yeah, unfortunately I can't really use that.  My handler calls into
SimpleTAL, and the code that really needs to use the extra data no
longer has access to the request object.

Sean
-- 
 *** Quits: TITANIC (Excess Flood)
Sean Reifschneider, Member of Technical Staff <jafo@tummy.com>
tummy.com, ltd. - Linux Consulting since 1995.  Qmail, Python, SysAdmin
      Back off man. I'm a scientist.   http://HackingSociety.org/
From matt at pollenation.net  Wed Jul  9 17:35:26 2003
From: matt at pollenation.net (Matt Goodall)
Date: Fri Jan  9 22:00:13 2004
Subject: [mod_python] missing path element in path_info
Message-ID: <1057768526.27471.335.camel@localhost>

Hi,

Over in the world of Albatross
(http://www.object-craft.com.au/projects/albatross/) we've been playing
with path_info and have come across something that we don't quite
understand.

Here's some example code to demonstrate:

----- .htaccess -----
DirectoryIndex app.py
SetHandler python-program
PythonHandler app
-----

----- app.py -----
from mod_python import apache
                                                                                def handler(req):
    req.content_type = 'text/plain'
    req.send_http_header()

    req.write('the_request: %s\n' % req.the_request)
    req.write('unparsed_uri: %s\n' % req.unparsed_uri)
    req.write('uri: %s\n' % req.uri)
    req.write('filename: %s\n' % req.filename)
    req.write('path_info: %s\n' % req.path_info)

    return apache.OK
-----

If I put those files in /~matt/test on the web server then this is what
I see for each URL:

        = URL /~matt/test/1/2/3 =
        the_request: GET /~matt/test/app.py/1/2/3 HTTP/1.1
        unparsed_uri: /~matt/test/app.py/1/2/3
        uri: /~matt/test/app.py/1/2/3
        filename: /home/matt/public_html/test/app.py
        path_info: /1/2/3
        
        = /~matt/test/app.py/1/2/3 =
        the_request: GET /~matt/test/app.py/1/2/3 HTTP/1.1
        unparsed_uri: /~matt/test/app.py/1/2/3
        uri: /~matt/test/app.py/1/2/3
        filename: /home/matt/public_html/test/app.py
        path_info: /1/2/3
        
        = /~matt/test/1/2/3 =
        the_request: GET /~matt/test/1/2/3 HTTP/1.1
        unparsed_uri: /~matt/test/1/2/3
        uri: /~matt/test/1/2/3
        filename: /home/matt/public_html/test/1
        path_info: /2/3
        
The first two are as expected but the last one drops app.py completely
and thinks that the first element of path_info is part of the filename.

Can anyone explain this?

Server details:

	Apache 1.3.27
	mod_python 2.7.8
	Linux 2.4.x, Gentoo and Debian (I think).

Thanks in advance.

- Matt

-- 
Matt Goodall, Pollenation Internet Ltd
w: http://www.pollenation.net
e: matt@pollenation.net
From grisha at modpython.org  Wed Jul  9 13:10:30 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:00:13 2004
Subject: [mod_python] missing path element in path_info
In-Reply-To: <1057768526.27471.335.camel@localhost>
References: <1057768526.27471.335.camel@localhost>
Message-ID: <20030709130315.K99051@onyx.ispol.com>


I am not sure I understand the difference between the first two, the
request seems to be the same. What are the url's that you're trying to
access (from the browser point of view)?

In the last one, the reason "1" is not part of path_info: path_info is
something apache figures out. I think the rule is that it sees that "test"
is a directory, and the next thing after it isn't, thus, it must refer to
a file (whether or not the file exists doesn't matter). Everything after a
file is path_info.

On Wed, 9 Jul 2003, Matt Goodall wrote:

> Hi,
>
> Over in the world of Albatross
> (http://www.object-craft.com.au/projects/albatross/) we've been playing
> with path_info and have come across something that we don't quite
> understand.
>
> Here's some example code to demonstrate:
>
> ----- .htaccess -----
> DirectoryIndex app.py
> SetHandler python-program
> PythonHandler app
> -----
>
> ----- app.py -----
> from mod_python import apache
>                                                                                 def handler(req):
>     req.content_type = 'text/plain'
>     req.send_http_header()
>
>     req.write('the_request: %s\n' % req.the_request)
>     req.write('unparsed_uri: %s\n' % req.unparsed_uri)
>     req.write('uri: %s\n' % req.uri)
>     req.write('filename: %s\n' % req.filename)
>     req.write('path_info: %s\n' % req.path_info)
>
>     return apache.OK
> -----
>
> If I put those files in /~matt/test on the web server then this is what
> I see for each URL:
>
>         = URL /~matt/test/1/2/3 =
>         the_request: GET /~matt/test/app.py/1/2/3 HTTP/1.1
>         unparsed_uri: /~matt/test/app.py/1/2/3
>         uri: /~matt/test/app.py/1/2/3
>         filename: /home/matt/public_html/test/app.py
>         path_info: /1/2/3
>
>         = /~matt/test/app.py/1/2/3 =
>         the_request: GET /~matt/test/app.py/1/2/3 HTTP/1.1
>         unparsed_uri: /~matt/test/app.py/1/2/3
>         uri: /~matt/test/app.py/1/2/3
>         filename: /home/matt/public_html/test/app.py
>         path_info: /1/2/3
>
>         = /~matt/test/1/2/3 =
>         the_request: GET /~matt/test/1/2/3 HTTP/1.1
>         unparsed_uri: /~matt/test/1/2/3
>         uri: /~matt/test/1/2/3
>         filename: /home/matt/public_html/test/1
>         path_info: /2/3
>
> The first two are as expected but the last one drops app.py completely
> and thinks that the first element of path_info is part of the filename.
>
> Can anyone explain this?
>
> Server details:
>
> 	Apache 1.3.27
> 	mod_python 2.7.8
> 	Linux 2.4.x, Gentoo and Debian (I think).
>
> Thanks in advance.
>
> - Matt
>
> --
> Matt Goodall, Pollenation Internet Ltd
> w: http://www.pollenation.net
> e: matt@pollenation.net
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From matt at pollenation.net  Wed Jul  9 20:36:12 2003
From: matt at pollenation.net (Matt Goodall)
Date: Fri Jan  9 22:00:13 2004
Subject: [mod_python] missing path element in path_info
In-Reply-To: <20030709130315.K99051@onyx.ispol.com>
References: <1057768526.27471.335.camel@localhost>
	 <20030709130315.K99051@onyx.ispol.com>
Message-ID: <1057779371.28628.484.camel@localhost>

On Wed, 2003-07-09 at 18:10, Gregory (Grisha) Trubetskoy wrote:
> I am not sure I understand the difference between the first two, the
> request seems to be the same. What are the url's that you're trying to
> access (from the browser point of view)?

OK, I'm not having a good day ... I can't even copy and paste correctly
anymore! The example output should have been as follows, where the
browser URL is between the '= =', just above the request attribute list.

  = /~matt/test/ =
  the_request: GET /~matt/test/ HTTP/1.1
  unparsed_uri: /~matt/test/app.py
  uri: /~matt/test/app.py
  filename: /home/matt/public_html/test/app.py
  path_info:

  = /~matt/test/app.py/1/2/3 =
  the_request: GET /~matt/test/app.py/1/2/3 HTTP/1.1
  unparsed_uri: /~matt/test/app.py/1/2/3
  uri: /~matt/test/app.py/1/2/3
  filename: /home/matt/public_html/test/app.py
  path_info: /1/2/3

  = /~matt/test/1/2/3 =
  the_request: GET /~matt/test/1/2/3 HTTP/1.1
  unparsed_uri: /~matt/test/1/2/3
  uri: /~matt/test/1/2/3
  filename: /home/matt/public_html/test/1
  path_info: /2/3

The first example demonstrates that app.py is sometimes part of the
filename even when it is not part of the browser's URL. As I mentioned
before, it is only example 3 that was a surprise.

> 
> In the last one, the reason "1" is not part of path_info: path_info is
> something apache figures out. I think the rule is that it sees that "test"
> is a directory, and the next thing after it isn't, thus, it must refer to
> a file (whether or not the file exists doesn't matter). Everything after a
> file is path_info.

I think this answers the original question anyway.

Is there actually a foolproof way of working out the correct base uri of
the application (i.e. the path, with or without the app.py) from the
information in the request alone? The results I would like are below but
I'm not convinced enough information is available:

  URL                        app base uri         path info
  -------------------------  -------------------  ----------
  /~matt/test/               /~matt/test          /
  /~matt/test/app.py/1/2/3   /~matt/test/app.py   /1/2/3
  /~matt/test/1/2/3          /~matt/test          /1/2/3


Of course, the alternative is for the developer to specify the base uri
in configuration code which is how Albatross currently works.

Thanks, Matt


> 
> On Wed, 9 Jul 2003, Matt Goodall wrote:
> 
> > Hi,
> >
> > Over in the world of Albatross
> > (http://www.object-craft.com.au/projects/albatross/) we've been playing
> > with path_info and have come across something that we don't quite
> > understand.
> >
> > Here's some example code to demonstrate:
> >
> > ----- .htaccess -----
> > DirectoryIndex app.py
> > SetHandler python-program
> > PythonHandler app
> > -----
> >
> > ----- app.py -----
> > from mod_python import apache
> >                                                                                 def handler(req):
> >     req.content_type = 'text/plain'
> >     req.send_http_header()
> >
> >     req.write('the_request: %s\n' % req.the_request)
> >     req.write('unparsed_uri: %s\n' % req.unparsed_uri)
> >     req.write('uri: %s\n' % req.uri)
> >     req.write('filename: %s\n' % req.filename)
> >     req.write('path_info: %s\n' % req.path_info)
> >
> >     return apache.OK
> > -----
> >
> > If I put those files in /~matt/test on the web server then this is what
> > I see for each URL:
> >
> >         = URL /~matt/test/1/2/3 =
> >         the_request: GET /~matt/test/app.py/1/2/3 HTTP/1.1
> >         unparsed_uri: /~matt/test/app.py/1/2/3
> >         uri: /~matt/test/app.py/1/2/3
> >         filename: /home/matt/public_html/test/app.py
> >         path_info: /1/2/3
> >
> >         = /~matt/test/app.py/1/2/3 =
> >         the_request: GET /~matt/test/app.py/1/2/3 HTTP/1.1
> >         unparsed_uri: /~matt/test/app.py/1/2/3
> >         uri: /~matt/test/app.py/1/2/3
> >         filename: /home/matt/public_html/test/app.py
> >         path_info: /1/2/3
> >
> >         = /~matt/test/1/2/3 =
> >         the_request: GET /~matt/test/1/2/3 HTTP/1.1
> >         unparsed_uri: /~matt/test/1/2/3
> >         uri: /~matt/test/1/2/3
> >         filename: /home/matt/public_html/test/1
> >         path_info: /2/3
> >
> > The first two are as expected but the last one drops app.py completely
> > and thinks that the first element of path_info is part of the filename.
> >
> > Can anyone explain this?
> >
> > Server details:
> >
> > 	Apache 1.3.27
> > 	mod_python 2.7.8
> > 	Linux 2.4.x, Gentoo and Debian (I think).
> >
> > Thanks in advance.
> >
> > - Matt
> >
> > --
> > Matt Goodall, Pollenation Internet Ltd
> > w: http://www.pollenation.net
> > e: matt@pollenation.net
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
-- 
Matt Goodall, Pollenation Internet Ltd
w: http://www.pollenation.net
e: matt@pollenation.net
From grisha at modpython.org  Wed Jul  9 16:32:39 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:00:13 2004
Subject: [mod_python] missing path element in path_info
In-Reply-To: <1057779371.28628.484.camel@localhost>
References: <1057768526.27471.335.camel@localhost>
	<20030709130315.K99051@onyx.ispol.com>
	<1057779371.28628.484.camel@localhost>
Message-ID: <20030709160740.D600@onyx.ispol.com>



On Wed, 9 Jul 2003, Matt Goodall wrote:

> Is there actually a foolproof way of working out the correct base uri of
> the application (i.e. the path, with or without the app.py) from the
> information in the request alone? The results I would like are below but
> I'm not convinced enough information is available:
>
>   URL                        app base uri         path info
>   -------------------------  -------------------  ----------
>   /~matt/test/               /~matt/test          /
>   /~matt/test/app.py/1/2/3   /~matt/test/app.py   /1/2/3
>   /~matt/test/1/2/3          /~matt/test          /1/2/3

Hmm... This is a flawed question, since path_info in the last line is
really /2/3.

If you look at http://cgi-spec.golux.com/draft-coar-cgi-v11-03.txt section
6.1.6, it formally defines what path info is. However, it relies on the
notion of a "script", which is always present in CGI, but is meaningless
in mod_python since we're not running scripts but provide phase handlers
for apache...

Anyway, the answer to your question is that it is impossible or very
difficult to do, because the transformation from "~matt/test" to
"/home/matt/public_html/test" is not "reversible" and is hidden somewhere
in apache config, yet this mapping is necessary to produce the results
above.

Grisha
From matt at pollenation.net  Wed Jul  9 22:20:10 2003
From: matt at pollenation.net (Matt Goodall)
Date: Fri Jan  9 22:00:13 2004
Subject: [mod_python] missing path element in path_info
In-Reply-To: <20030709160740.D600@onyx.ispol.com>
References: <1057768526.27471.335.camel@localhost>
	<20030709130315.K99051@onyx.ispol.com>
	<20030709160740.D600@onyx.ispol.com>
Message-ID: <1057785610.27471.509.camel@localhost>

On Wed, 2003-07-09 at 21:32, Gregory (Grisha) Trubetskoy wrote:
> Anyway, the answer to your question is that it is impossible or very
> difficult to do, because the transformation from "~matt/test" to
> "/home/matt/public_html/test" is not "reversible" and is hidden somewhere
> in apache config, yet this mapping is necessary to produce the results
> above.

Thanks Grisha.

That's the conclusion I had come to from dumping anything available in
the request object to a log file, but it was worth checking here too.

Cheers, Matt

-- 
Matt Goodall, Pollenation Internet Ltd
w: http://www.pollenation.net
e: matt@pollenation.net
From jmartinson at info234.com  Thu Jul 10 17:00:03 2003
From: jmartinson at info234.com (Jacob Martinson)
Date: Fri Jan  9 22:00:13 2004
Subject: [mod_python] Problem with win32 installation - can't authenticate
Message-ID: <5.2.1.1.0.20030710135957.00b2f050@localhost>

My problem: after installing apache(win32), python(win32) and 
modpython(win32) the basic test works for returning 'hello world' but when 
i try the authentication example from the documentation, I am not able to 
authenticate.  After a little investigation, I find that both req.user and 
req.get_basic_auth_pw() are None.

I am prompted for username/password, but I can't authenticate 
successfully.  Also, if I ignore req.user and password and just return 
apache.OK, it allows me to access the file I am requesting.

Here's the relevant parts of my apache config:

LoadModule python_module modules/mod_python.so

<Directory "c:\Documents and Settings\jmartinson\docroot">
   AddHandler python-program .py
   PythonHandler mptest
   PythonDebug On
</Directory>

<Directory "c:\Documents and Settings\jmartinson\docroot\test1">
     AddHandler python-program .py
     PythonHandler myscript
     PythonAuthenHandler myscript
     PythonDebug Off
     AuthType Basic
     AuthName "Restricted Area"
     require valid-user
</Directory>

Here's my handler (myscript.py):

from mod_python import apache
def authenhandler(req):
         user = req.user
         pw = req.get_basic_auth_pw()
         req.write( str(user) + ':' + str(pw) + str('\n') )
         return apache.OK

         if user == "spam":
                 return apache.OK
         else:
                 return apache.HTTP_UNAUTHORIZED

I put in the first "return apache.OK" for testing purposes.  If I take that 
out authentication still won't work.  I also took out the second half of 
the if statement testing the password too.

Version info:
apache: 
http://apache.oregonstate.edu/httpd/binaries/win32/apache_2.0.47-win32-x86-no_ssl.msi
modpython: 
http://apache.webmeta.com/httpd/modpython/win/3.0.3/mod_python-3.0.3.win32.exe
python: http://python.org/ftp/python/2.2.3/Python-2.2.3.exe

I would much rather be using modpython under a unix environment, but I am 
doing this on my work laptop and I don't have the option of eliminating the 
Windows environment and I can't get apache to compile under cygwin.

Any information or suggestions are greatly appreciated!

-Jacob 

From grisha at modpython.org  Thu Jul 10 19:50:38 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:00:13 2004
Subject: [mod_python] Problem with win32 installation - can't authenticate
In-Reply-To: <5.2.1.1.0.20030710135957.00b2f050@localhost>
References: <5.2.1.1.0.20030710135957.00b2f050@localhost>
Message-ID: <20030710194534.K53265@onyx.ispol.com>



On Thu, 10 Jul 2003, Jacob Martinson wrote:

> I am prompted for username/password, but I can't authenticate
> successfully.  Also, if I ignore req.user and password and just return
> apache.OK, it allows me to access the file I am requesting.

When you say "can't authenticate" - does the browser come back with the
user/password dialog, or some other thing?

I just tried your example, and it worked for me.... In the old versions of
apache you had to call to call get_basic_auth_pw() before trying to read
value of req.user, but that's not longer true I think. May be tried
swapping those two lines, but I think the problem is elsewhere.

Grisha
From jmartinson at info234.com  Thu Jul 10 18:55:49 2003
From: jmartinson at info234.com (Jacob Martinson)
Date: Fri Jan  9 22:00:13 2004
Subject: [mod_python] Problem with win32 installation - can't
  authenticate
In-Reply-To: <20030710194534.K53265@onyx.ispol.com>
References: <5.2.1.1.0.20030710135957.00b2f050@localhost>
 <5.2.1.1.0.20030710135957.00b2f050@localhost>
Message-ID: <5.2.1.1.0.20030710185116.00b2ecd8@localhost>

Grisha,

The browser comes back with a prompt again a number of times and then 
eventually I end up at the access forbidden page.  The strangest thing just 
happened though... I switched the order of getting the username and 
password, and it started working!  I haven't changed anything in the apache 
config between then and now.

Thanks!

-Jacob

At 07:50 PM 7/10/2003 -0400, Gregory (Grisha) Trubetskoy wrote:


>On Thu, 10 Jul 2003, Jacob Martinson wrote:
>
> > I am prompted for username/password, but I can't authenticate
> > successfully.  Also, if I ignore req.user and password and just return
> > apache.OK, it allows me to access the file I am requesting.
>
>When you say "can't authenticate" - does the browser come back with the
>user/password dialog, or some other thing?
>
>I just tried your example, and it worked for me.... In the old versions of
>apache you had to call to call get_basic_auth_pw() before trying to read
>value of req.user, but that's not longer true I think. May be tried
>swapping those two lines, but I think the problem is elsewhere.
>
>Grisha

From grisha at modpython.org  Thu Jul 10 21:00:37 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:00:13 2004
Subject: [mod_python] Problem with win32 installation - can't
	authenticate
In-Reply-To: <5.2.1.1.0.20030710185116.00b2ecd8@localhost>
References: <5.2.1.1.0.20030710135957.00b2f050@localhost>
	<5.2.1.1.0.20030710185116.00b2ecd8@localhost>
Message-ID: <20030710205649.Y56783@onyx.ispol.com>


Thanks Jacob for the config -

I figured it out - it has to do with the placement of LoadModule in the
config file. I tend to put mine first, which makes mod_auth first in line
to process, and it internally calls get_basic_auth_pw() thereby filling in
the req.user value. But if you place mod_python after mod_auth, then
mod_python is called first, and req->user is NULL (or req.user is None).

I'll make sure this is corrected in the docs for the next release.

Grisha

On Thu, 10 Jul 2003, Jacob Martinson wrote:

> Grisha,
>
> The browser comes back with a prompt again a number of times and then
> eventually I end up at the access forbidden page.  The strangest thing just
> happened though... I switched the order of getting the username and
> password, and it started working!  I haven't changed anything in the apache
> config between then and now.
>
> Thanks!
>
> -Jacob
>
> At 07:50 PM 7/10/2003 -0400, Gregory (Grisha) Trubetskoy wrote:
>
>
> >On Thu, 10 Jul 2003, Jacob Martinson wrote:
> >
> > > I am prompted for username/password, but I can't authenticate
> > > successfully.  Also, if I ignore req.user and password and just return
> > > apache.OK, it allows me to access the file I am requesting.
> >
> >When you say "can't authenticate" - does the browser come back with the
> >user/password dialog, or some other thing?
> >
> >I just tried your example, and it worked for me.... In the old versions of
> >apache you had to call to call get_basic_auth_pw() before trying to read
> >value of req.user, but that's not longer true I think. May be tried
> >swapping those two lines, but I think the problem is elsewhere.
> >
> >Grisha
>
From jmartinson at info234.com  Thu Jul 10 20:02:22 2003
From: jmartinson at info234.com (Jacob Martinson)
Date: Fri Jan  9 22:00:13 2004
Subject: [mod_python] Problem with win32 installation - can't 
  authenticate
In-Reply-To: <20030710205649.Y56783@onyx.ispol.com>
References: <5.2.1.1.0.20030710185116.00b2ecd8@localhost>
 <5.2.1.1.0.20030710135957.00b2f050@localhost>
 <5.2.1.1.0.20030710135957.00b2f050@localhost>
 <5.2.1.1.0.20030710185116.00b2ecd8@localhost>
Message-ID: <5.2.1.1.0.20030710200107.00ba7598@localhost>

Thanks again for the excellent and fast response!!!

At 09:00 PM 7/10/2003 -0400, Gregory (Grisha) Trubetskoy wrote:

>Thanks Jacob for the config -
>
>I figured it out - it has to do with the placement of LoadModule in the
>config file. I tend to put mine first, which makes mod_auth first in line
>to process, and it internally calls get_basic_auth_pw() thereby filling in
>the req.user value. But if you place mod_python after mod_auth, then
>mod_python is called first, and req->user is NULL (or req.user is None).
>
>I'll make sure this is corrected in the docs for the next release.
>
>Grisha
>
>On Thu, 10 Jul 2003, Jacob Martinson wrote:
>
> > Grisha,
> >
> > The browser comes back with a prompt again a number of times and then
> > eventually I end up at the access forbidden page.  The strangest thing just
> > happened though... I switched the order of getting the username and
> > password, and it started working!  I haven't changed anything in the apache
> > config between then and now.
> >
> > Thanks!
> >
> > -Jacob
> >
> > At 07:50 PM 7/10/2003 -0400, Gregory (Grisha) Trubetskoy wrote:
> >
> >
> > >On Thu, 10 Jul 2003, Jacob Martinson wrote:
> > >
> > > > I am prompted for username/password, but I can't authenticate
> > > > successfully.  Also, if I ignore req.user and password and just return
> > > > apache.OK, it allows me to access the file I am requesting.
> > >
> > >When you say "can't authenticate" - does the browser come back with the
> > >user/password dialog, or some other thing?
> > >
> > >I just tried your example, and it worked for me.... In the old versions of
> > >apache you had to call to call get_basic_auth_pw() before trying to read
> > >value of req.user, but that's not longer true I think. May be tried
> > >swapping those two lines, but I think the problem is elsewhere.
> > >
> > >Grisha
> >

From dustin at ywlcs.org  Thu Jul 10 21:31:20 2003
From: dustin at ywlcs.org (Dustin Mitchell)
Date: Fri Jan  9 22:00:13 2004
Subject: [mod_python] Using shared memory to do global persistence
In-Reply-To: <20030710215743.V56783@onyx.ispol.com>
References: <200306250732.15699.jgardner@jonathangardner.net>
	<20030626183642.GB5652@lyra.org> <20030708153302.C69691@onyx.ispol.com>
	<20030710215743.V56783@onyx.ispol.com>
Message-ID: <20030711023119.GI18379@eleanor.internal.ywlcs.org>

On Thu, Jul 10, 2003 at 10:12:26PM -0400, Gregory (Grisha) Trubetskoy wrote:
> 1. Something using or similar to POSH. This would rule, but it's too much
> work. Posh also relies on it having the cotrol over forking(), which won't
> work in our situation (i think).

Wouldn't a child_init hook do the trick?  That would mean, however,
that all shared objects had to be created (in Python) before child
initializations..

Dustin

-- 

  Dustin Mitchell
  dustin@ywlcs.org/djmitche@alumni.uchicago.edu
  http://people.cs.uchicago.edu/~dustin/
From Denis.Walrave at trema.com  Fri Jul 11 19:04:12 2003
From: Denis.Walrave at trema.com (Denis Walrave)
Date: Fri Jan  9 22:00:13 2004
Subject: [mod_python] apache.py typo fix... ?
Message-ID: <2F520D7DB7B17E4E9EC4ADEC448778F4013B7A89@labsex1.corp.trema.com>

$Id: apache.py,v 1.68 2003/02/28 04:55:15 grisha Exp $

 

def restore_nocgi(sav_env, si, so):

    """ see setup_cgi() """

 

    osenv = os.environ

 

    # restore env

    for k in osenv.keys():

        del osenv[k]

    for k in sav_env:

        osenv[k] = env[k] ######## I would suggest 'sav_env[k]'

 

    sys.stdout = si

    sys.stdin = so

 

Denis Walrave

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20030711/2f640737/attachment-0002.htm
From fitnah55 at hotmail.com  Wed Jul 16 11:49:00 2003
From: fitnah55 at hotmail.com (k d)
Date: Fri Jan  9 22:00:14 2004
Subject: [mod_python] 
	apache API and mod_python <-> protocol module integration
Message-ID: <BAY1-F124Z7fIZHO1g400002f0f@hotmail.com>

alright i'm just starting to look into this to see how feasable it is and 
what has to be done

if anyone has any comments on how the mod_python handler can be invoked 
through a protocol module such that the primary codebase of a particular 
application can be reused in multiple gateways, i'd appreciate it

basically what i'm looking at right now is a low level telnet protocol 
module that is reasonably transparent... that can be augmented to support 
full telnet, pop/3, imap, smtp, whatever... but that has sufficient design 
to invoke a mod_python handler, so that the pop/3 could be implemented in 
python, or whatever would be added on top.. (or potentially the pop/3 could 
be added directly to the protocol module)

the basic idea is that apache2 by default accepts http like connections, 
which aren't conducive to the synchronous communication of telnet..  
keep-alive is vaguely similar but not good enough for the purposes of 
allowing a telnet or pop/3 gateway

i've never looked at the apache2 api before so i'm just digging into that 
today

_________________________________________________________________
MSN 8 with e-mail virus protection service: 2 months FREE*  
http://join.msn.com/?page=features/virus

From azaroth at liverpool.ac.uk  Wed Jul 16 17:17:19 2003
From: azaroth at liverpool.ac.uk (Robert Sanderson)
Date: Fri Jan  9 22:00:14 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
 integration
In-Reply-To: <BAY1-F124Z7fIZHO1g400002f0f@hotmail.com>
Message-ID: <Pine.LNX.4.44.0307161709550.2478-100000@gondolin.hist.liv.ac.uk>


> the basic idea is that apache2 by default accepts http like connections, 
> which aren't conducive to the synchronous communication of telnet..  
> keep-alive is vaguely similar but not good enough for the purposes of 
> allowing a telnet or pop/3 gateway

Currently, as I found when implementing Z39.50, it's a real pain as 
there's no way to read in all available data, and if you try to read past 
the end of the available data the read will block.

This makes it useless for something like (say) an IRC or MUD style server 
where there might be data flowing in either direction at any given time.  
Mod_Perl on the other hand has a better system:
http://perl.apache.org/docs/2.0/user/handlers/protocols.html

When I get time, I'm going to look at how to implement this in mod_python, 
but that might not be for a while, so if anyone else wants to weigh in, 
please do so and let me know :)

Rob

-- 
      ,'/:.          Rob Sanderson (azaroth@liverpool.ac.uk)
    ,'-/::::.        http://www.o-r-g.org/~azaroth/
  ,'--/::(@)::.      Special Collections and Archives, extension 3142
,'---/::::::::::.    Nebmedes:  telnet: nebmedes.o-r-g.org 7777
____/:::::::::::::.                WWW:  http://nebmedes.o-r-g.org:8000/
I L L U M I N A T I

From dustin at ywlcs.org  Wed Jul 16 11:33:30 2003
From: dustin at ywlcs.org (Dustin Mitchell)
Date: Fri Jan  9 22:00:14 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
	integration
In-Reply-To: <Pine.LNX.4.44.0307161709550.2478-100000@gondolin.hist.liv.ac.uk>
References: <BAY1-F124Z7fIZHO1g400002f0f@hotmail.com>
	<Pine.LNX.4.44.0307161709550.2478-100000@gondolin.hist.liv.ac.uk>
Message-ID: <20030716163329.GQ18379@eleanor.internal.ywlcs.org>

On Wed, Jul 16, 2003 at 05:17:19PM +0100, Robert Sanderson wrote:
> 
> > the basic idea is that apache2 by default accepts http like connections, 
> > which aren't conducive to the synchronous communication of telnet..  
> > keep-alive is vaguely similar but not good enough for the purposes of 
> > allowing a telnet or pop/3 gateway

There's talk of doing exactly this over on the Apache-dev list (though
doing it in C).  Somebody produced a small DNS server in Apache for a
masters project (netairt -- very cool!) and the apache people had a
short discussion of supporting UDP and telnet-like connections just
like what you describe.  The upshot of this is that right now Apache
really don't support either of these types of connections, even in its
native C.

See the thread beginning:

 Messsage-ID: <Pine.GSO.4.53.0307142254390.25665@flits.cs.vu.nl>
 From: Michal Szymaniak <michal@cs.vu.nl>
 Subject: DNS+HTTP redirection system inside an Apache module

Dustin

-- 

  Dustin Mitchell
  dustin@ywlcs.org/djmitche@alumni.uchicago.edu
  http://people.cs.uchicago.edu/~dustin/
From grisha at modpython.org  Wed Jul 16 13:59:58 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:00:14 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
 integration
In-Reply-To: <Pine.LNX.4.44.0307161709550.2478-100000@gondolin.hist.liv.ac.uk>
References: <Pine.LNX.4.44.0307161709550.2478-100000@gondolin.hist.liv.ac.uk>
Message-ID: <20030716134923.B92465@onyx.ispol.com>



On Wed, 16 Jul 2003, Robert Sanderson wrote:

> > the basic idea is that apache2 by default accepts http like connections,
> > which aren't conducive to the synchronous communication of telnet..

There is an example of a simple echo module here:

http://www.modpython.org/live/current/doc-html/pyapi-conn.html

> > keep-alive is vaguely similar but not good enough for the purposes of
> > allowing a telnet or pop/3 gateway
>
> Currently, as I found when implementing Z39.50, it's a real pain as
> there's no way to read in all available data, and if you try to read past
> the end of the available data the read will block.

This is not a problem of mod_python or Apache, this is the way sockets
work. If your protocol is such that you know ahead of time how much to
read (e.g. HTTP), then you can request this much data in one read.
Otherwise, you must read in smallest unit sizes of your protocol, which
(I'm guessing) is 1 byte in case of Z39.50.

> This makes it useless for something like (say) an IRC or MUD style
> server where there might be data flowing in either direction at any
> given time.  Mod_Perl on the other hand has a better system:
> http://perl.apache.org/docs/2.0/user/handlers/protocols.html

Mod_perl doesn't do it any differently (unless I'm missing something). I
don't think implementing an IRC or MUD server in mod_perl is going to be
any different.

BTW, if using Apache is not a requirement, then doing something like this
might be easier in twisted (twistedmatrix.com).

Grisha
From dustin at ywlcs.org  Wed Jul 16 13:25:15 2003
From: dustin at ywlcs.org (Dustin Mitchell)
Date: Fri Jan  9 22:00:14 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
	integration
In-Reply-To: <20030716134923.B92465@onyx.ispol.com>
References: <Pine.LNX.4.44.0307161709550.2478-100000@gondolin.hist.liv.ac.uk>
	<20030716134923.B92465@onyx.ispol.com>
Message-ID: <20030716182515.GR18379@eleanor.internal.ywlcs.org>

On Wed, Jul 16, 2003 at 01:59:58PM -0400, Gregory (Grisha) Trubetskoy wrote:
> This is not a problem of mod_python or Apache, this is the way sockets
> work. If your protocol is such that you know ahead of time how much to
> read (e.g. HTTP), then you can request this much data in one read.
> Otherwise, you must read in smallest unit sizes of your protocol, which
> (I'm guessing) is 1 byte in case of Z39.50.

This is not strictly true, as long as you're OK with possibly getting a
bit of *extra* data beyond a particular PDU (a little bit of buffering
can take care of that).  Apache has to do this to read the HTTP header,
which is not of a fixed length.

The socket blocking read interface is structured such that it will block
when *no* data is available, and will return *up to* the quantity
specified in the recv() call if it is available.  However, if some
smaller amount of data is available, that data will be returned
immediately.

To demonstrate, I hacked this together:

from socket import *
s = socket(AF_INET, SOCK_STREAM)
s.bind(("", 9900))
s.listen(5)
while 1:
  ss, sa = s.accept()
  print "Connect from '%s'" % (sa,)
  while 1:
    data = ss.recv(100)
    if not data: break
    print " Received: %s" % `data`
  print "Connection closed from '%s'" % (sa,)

Then connected with telnet and typed "Hello" and "World" on separate
lines.  Telnet, by default, buffers lines of input until a newline, but
you will note that in the two returns from ss.recv(), neither contained
100 bytes of data:

Connect from '('127.0.0.1', 56260)'
 Received: 'Hello\r\n'
 Received: 'World\r\n'
Connection closed from '('127.0.0.1', 56260)'

Further, a loop such as:
  for i in 'hello world': s.send(i)
will produce output like this:

Connect from '('127.0.0.1', 56277)'
 Received: 'h'
 Received: 'ello world'
Connection closed from '('127.0.0.1', 56277)'

Either the client or the server's socket implementation is buffering the
characters because they're appearing so quickly, which cuts down on the
number of recv() calls which must be made.

I can't speak for the Apache sockets API, or the Python interface
thereto, but sockets themselves *do* support this interface (they'd be
pretty useless if they didn't!).  I highly recommend W. Richard
Stevens' TCP/IP Illustrated for an in-depth and very readable
discussion of this and many other crucial implementation details of
TCP/IP.

Dustin

-- 

  Dustin Mitchell
  dustin@ywlcs.org/djmitche@alumni.uchicago.edu
  http://people.cs.uchicago.edu/~dustin/
From fitnah55 at hotmail.com  Wed Jul 16 14:56:14 2003
From: fitnah55 at hotmail.com (k d)
Date: Fri Jan  9 22:00:14 2004
Subject: [mod_python] apache API and mod_python <-> protocol module
	integration
Message-ID: <BAY1-F40gNVRIbQlwhL0000bd01@hotmail.com>

>There is an example of a simple echo module here:
>
>http://www.modpython.org/live/current/doc-html/pyapi-conn.html

whoa... i totally forgot modpython had a connection handler

do you think its possible to get it to work with character mode input and 
proper display environment?  like a fully functional telnet not just a hack?

>BTW, if using Apache is not a requirement, then doing something like this
>might be easier in twisted (twistedmatrix.com).

yeh i checked out twisted but it's really heavy on stuff i don't need, plus 
the multiplexing and python persistency is a requirement, so 
apache2/modpython is a definite must have..

as far as implementing the protocol i can probably dupe code in twisted, but 
its not fully functional either so it'd just serve as a rough sketch to help 
with initial design

the only problems i really see that i might have are getting proper ascii 
transmission and getting hotkey capable character input

i'm super stoked that i don't have to deal with an apache2 protocol module 
to do it though! woohoo!

_________________________________________________________________
STOP MORE SPAM with the new MSN 8 and get 2 months FREE*  
http://join.msn.com/?page=features/junkmail

From chris at vindaloo.com  Wed Jul 16 14:58:49 2003
From: chris at vindaloo.com (Christopher Sean Hilton)
Date: Fri Jan  9 22:00:14 2004
Subject: [mod_python] Getting access to a file from a post.
In-Reply-To: <20030716134923.B92465@onyx.ispol.com>
References: <Pine.LNX.4.44.0307161709550.2478-100000@gondolin.hist.liv.ac.uk>
	<20030716134923.B92465@onyx.ispol.com>
Message-ID: <20030716185849.GA1129@dagobah.pvt.vindaloo.com>

-----BEGIN PGP SIGNED MESSAGE-----

I'm trying to generate an xml transaction handler using apache,
modpython, python and sax. I would like to be able to post a file to
this website/handler with something like curl and have modpython
process the file. Something like

     $ cat MyXmlFile.xml | \
     >   curl https://www.example.com/iface.py/XmlHandler

My python looks like this:

     $ cat /var/www/data/www.example.com/iface.py
     #! /usr/local/bin/python2.1
     
     from mod_python import apache

     def XmlHandler(req):
        XmlData = req.readlines()
        ...

This does not get the contens of the file that I posted, in fact it's
empty. Is there any way short of using traditional CGI of getting this
file?

Thanks in advance and if I'm missing something in the manual please
feel free to give me a poke that sets me in the right direction.

Chris

- -- 
Chris Hilton                                 chilton-at-vindaloo-dot-com
- ------------------------------------------------------------------------
                "All I was doing was trying to get home from work!"
                                                 -- Rosa Parks
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.1 (FreeBSD)

iQEVAwUBPxWgWILaxorQlXotAQE23Qf9Ec2xBSXHtX6JN9QSwocetyTrDqBecpto
5lkvq6YlwGF4M5Ei5eUBFjOmAo3OydM83zKMzdzJTgrlOOr6p/JmAxV0YH3qm7QI
+ON/vfoNDxVsPCeQPU/B1dEwkRdjtT2dMda68Ce8dG6go/1McKwUGxIm7/J4Qifs
Bt02IeGLhu+03VIfm03dROn95P3LxqiuTUXbHiQYky9k23ahQjZ8O3XXb+3fyYa4
E44ZG0O9T/H5Xig1rTrbAASao86HNolgnbKR2zNbivtOblgl/p1KSWofkqfRaLRz
JcT0jlSrQB1RvG2rZUz2qy1EPunZ2YUgS1gR+MmTJBmGTxYnIRCzJw==
=tbTY
-----END PGP SIGNATURE-----

From fitnah55 at hotmail.com  Wed Jul 16 17:00:43 2003
From: fitnah55 at hotmail.com (fitnah55)
Date: Fri Jan  9 22:00:14 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
	integration
In-Reply-To: <20030716134923.B92465@onyx.ispol.com>
Message-ID: <004c01c34bdd$521e02e0$24c0c20a@computer>


hey..

how do i get the connectionhandler to work properly under a virtual host
and/or
just for a particular port?

everything is running off of a single IP address through about 5 domains
and 20 virtual hosts..

i need telnet access potentially across all of the hosts

all of this from the single application framework




> -----Original Message-----
> From: Gregory (Grisha) Trubetskoy [mailto:grisha@modpython.org] 
> Sent: Wednesday, July 16, 2003 2:00 PM
> To: Robert Sanderson
> Cc: k d; mod_python@modpython.org
> Subject: Re: [mod_python] apache API and mod_python <-> 
> protocol module integration
> 
> 
> 
> 
> On Wed, 16 Jul 2003, Robert Sanderson wrote:
> 
> > > the basic idea is that apache2 by default accepts http 
> like connections,
> > > which aren't conducive to the synchronous communication 
> of telnet..
> 
> There is an example of a simple echo module here:
> 
http://www.modpython.org/live/current/doc-html/pyapi-conn.html

> > keep-alive is vaguely similar but not good enough for the purposes
of
> > allowing a telnet or pop/3 gateway
>
> Currently, as I found when implementing Z39.50, it's a real pain as
> there's no way to read in all available data, and if you try to read
past
> the end of the available data the read will block.

This is not a problem of mod_python or Apache, this is the way sockets
work. If your protocol is such that you know ahead of time how much to
read (e.g. HTTP), then you can request this much data in one read.
Otherwise, you must read in smallest unit sizes of your protocol, which
(I'm guessing) is 1 byte in case of Z39.50.

> This makes it useless for something like (say) an IRC or MUD style
> server where there might be data flowing in either direction at any
> given time.  Mod_Perl on the other hand has a better system:
> http://perl.apache.org/docs/2.0/user/handlers/protocols.html

Mod_perl doesn't do it any differently (unless I'm missing something). I
don't think implementing an IRC or MUD server in mod_perl is going to be
any different.

BTW, if using Apache is not a requirement, then doing something like
this
might be easier in twisted (twistedmatrix.com).

Grisha
From fitnah55 at hotmail.com  Wed Jul 16 17:09:50 2003
From: fitnah55 at hotmail.com (fitnah55)
Date: Fri Jan  9 22:00:14 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
	integration
In-Reply-To: <20030716134923.B92465@onyx.ispol.com>
Message-ID: <004d01c34bde$98310c40$24c0c20a@computer>


duh.. add the port to listen

heh

coincidentally, i don't think the echo example is working

[Tue Jul 15 13:03:18 2003] [error] python_connection:
ConnectionDispatch() returned nothing.

hmm

From grisha at modpython.org  Wed Jul 16 20:47:22 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:00:14 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
 integration
In-Reply-To: <20030716182515.GR18379@eleanor.internal.ywlcs.org>
References: <Pine.LNX.4.44.0307161709550.2478-100000@gondolin.hist.liv.ac.uk>
	<20030716182515.GR18379@eleanor.internal.ywlcs.org>
Message-ID: <20030716161514.Q95093@onyx.ispol.com>


Well, after some looking, apparently the APR does work this way, it's just
that the way the connection handler was coded probably because I didn't
understand APR well enough at the time I made it loop until specified
length of bytes was read (I started out with replicating req.read(), which
knows how much data there is to read).

I attached a patch to the connobject.c that changes its behaviour so that
read(len) will read at most len bytes, and will only block if no data is
available. And len is an optional argument.

Here is a connection handler code that does the exact same thing you had
below. (note that print writes to stdout, which is visible if you run
httpd with -X (stay in foreground) option:

from mod_python import apache

def connectionhandler(conn):

    print "Connect from '%s'" % `conn.remote_addr`

    while 1:
        data = conn.read()
        if not data: break
        print " Received: %s" % `data`

    print "Connection closed from '%s'" % `conn.remote_addr`

    return apache.OK

And here's the result:

$ ./bin/httpd -X
Connect from '('0.0.0.0', 3513)'
 Received: 'Hello\r\n'
 Received: 'World\r\n'
Connection closed from '('0.0.0.0', 3513)'

If I do 'for i in "Hello World"' thing, I get this:

Connect from '('0.0.0.0', 3524)'
 Received: 'Hello World'
Connection closed from '('0.0.0.0', 3524)'

Grisha

On Wed, 16 Jul 2003, Dustin Mitchell wrote:

> On Wed, Jul 16, 2003 at 01:59:58PM -0400, Gregory (Grisha) Trubetskoy wrote:
> > This is not a problem of mod_python or Apache, this is the way sockets
> > work. If your protocol is such that you know ahead of time how much to
> > read (e.g. HTTP), then you can request this much data in one read.
> > Otherwise, you must read in smallest unit sizes of your protocol, which
> > (I'm guessing) is 1 byte in case of Z39.50.
>
> This is not strictly true, as long as you're OK with possibly getting a
> bit of *extra* data beyond a particular PDU (a little bit of buffering
> can take care of that).  Apache has to do this to read the HTTP header,
> which is not of a fixed length.
>
> The socket blocking read interface is structured such that it will block
> when *no* data is available, and will return *up to* the quantity
> specified in the recv() call if it is available.  However, if some
> smaller amount of data is available, that data will be returned
> immediately.
>
> To demonstrate, I hacked this together:
>
> from socket import *
> s = socket(AF_INET, SOCK_STREAM)
> s.bind(("", 9900))
> s.listen(5)
> while 1:
>   ss, sa = s.accept()
>   print "Connect from '%s'" % (sa,)
>   while 1:
>     data = ss.recv(100)
>     if not data: break
>     print " Received: %s" % `data`
>   print "Connection closed from '%s'" % (sa,)
>
> Then connected with telnet and typed "Hello" and "World" on separate
> lines.  Telnet, by default, buffers lines of input until a newline, but
> you will note that in the two returns from ss.recv(), neither contained
> 100 bytes of data:
>
> Connect from '('127.0.0.1', 56260)'
>  Received: 'Hello\r\n'
>  Received: 'World\r\n'
> Connection closed from '('127.0.0.1', 56260)'
>
> Further, a loop such as:
>   for i in 'hello world': s.send(i)
> will produce output like this:
>
> Connect from '('127.0.0.1', 56277)'
>  Received: 'h'
>  Received: 'ello world'
> Connection closed from '('127.0.0.1', 56277)'
>
> Either the client or the server's socket implementation is buffering the
> characters because they're appearing so quickly, which cuts down on the
> number of recv() calls which must be made.
>
> I can't speak for the Apache sockets API, or the Python interface
> thereto, but sockets themselves *do* support this interface (they'd be
> pretty useless if they didn't!).  I highly recommend W. Richard
> Stevens' TCP/IP Illustrated for an in-depth and very readable
> discussion of this and many other crucial implementation details of
> TCP/IP.
>
> Dustin
>
> --
>
>   Dustin Mitchell
>   dustin@ywlcs.org/djmitche@alumni.uchicago.edu
>   http://people.cs.uchicago.edu/~dustin/
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
-------------- next part --------------
Index: connobject.c
===================================================================
RCS file: /home/cvs/httpd-python/src/connobject.c,v
retrieving revision 1.14
diff -u -r1.14 connobject.c
--- connobject.c	23 Jan 2003 22:34:18 -0000	1.14
+++ connobject.c	17 Jul 2003 00:35:28 -0000
@@ -113,8 +113,10 @@
 
     bb = apr_brigade_create(c->pool, c->bucket_alloc);
 
+    bufsize = len == 0 ? HUGE_STRING_LEN : len;
+
     Py_BEGIN_ALLOW_THREADS;
-    rc = ap_get_brigade(c->input_filters, bb, mode, APR_BLOCK_READ, len);
+    rc = ap_get_brigade(c->input_filters, bb, mode, APR_BLOCK_READ, bufsize);
     Py_END_ALLOW_THREADS;
 
     if (! APR_STATUS_IS_SUCCESS(rc)) {
@@ -135,7 +137,6 @@
         return Py_None;
     }
 
-    bufsize = len == 0 ? HUGE_STRING_LEN : len;
     result = PyString_FromStringAndSize(NULL, bufsize);
 
     /* possibly no more memory */
@@ -180,7 +181,7 @@
 	}
 
 
-        if (mode == AP_MODE_GETLINE) {
+        if (mode == AP_MODE_GETLINE || len == 0) {
             apr_bucket_delete(b);
             break;
         }
@@ -208,11 +209,8 @@
 
     long len = 0;
 
-    if (! PyArg_ParseTuple(args, "l|i", &len)) 
+    if (! PyArg_ParseTuple(args, "|l", &len)) 
         return NULL;
-
-    if (len == 0)
-        return PyString_FromString("");
 
     if (len == -1)
         return _conn_read(self->conn, AP_MODE_EXHAUSTIVE, 0);
From fitnah55 at hotmail.com  Wed Jul 16 21:17:04 2003
From: fitnah55 at hotmail.com (fitnah55)
Date: Fri Jan  9 22:00:14 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
	integration
In-Reply-To: <20030716161514.Q95093@onyx.ispol.com>
Message-ID: <005501c34c01$21dc7480$24c0c20a@computer>


hey i really appreciate it i'll check this out, i think mine is screwed
somehow though, as i can't get it to deal with a connection handler at
all

> I attached a patch to the connobject.c that changes its behaviour so
that
> read(len) will read at most len bytes, and will only block if no data
is
> available. And len is an optional argument.
From fitnah55 at hotmail.com  Wed Jul 16 22:01:36 2003
From: fitnah55 at hotmail.com (fitnah55)
Date: Fri Jan  9 22:00:14 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
	integration
In-Reply-To: <20030716161514.Q95093@onyx.ispol.com>
Message-ID: <005a01c34c07$5a7f4c80$24c0c20a@computer>


alright i just added the patch to my build directory.. and it wouldn't
compile.  OKAY.  what is the freakin point of maintaining an accurate
build archive if the freakin thing gets attacked by gremlins??

okay so i tossed the original build (which without a doubt has not been
changed by any legitimate or accidental work of my own on a machine that
isn't accessable from remote), untarred the same archive, patched,
rebuilt,
no problem... damn gremlins

BUT

i'm still getting the same error with the actual connection test...

any ideas?

[Tue Jul 15 17:56:44 2003] [error] python_connection:
ConnectionDispatch() returned nothing.


> -----Original Message-----
> From: mod_python-bounces@modpython.org 
> [mailto:mod_python-bounces@modpython.org] On Behalf Of 
> Gregory (Grisha) Trubetskoy
> Sent: Wednesday, July 16, 2003 8:47 PM
> To: Dustin Mitchell
> Cc: mod_python@modpython.org
> Subject: Re: [mod_python] apache API and mod_python <-> 
> protocol module integration
> 
> 
> 
> Well, after some looking, apparently the APR does work this 
> way, it's just
> that the way the connection handler was coded probably 
> because I didn't
> understand APR well enough at the time I made it loop until specified
> length of bytes was read (I started out with replicating 
> req.read(), which
> knows how much data there is to read).
> 
> I attached a patch to the connobject.c that changes its 
> behaviour so that
> read(len) will read at most len bytes, and will only block if 
> no data is
> available. And len is an optional argument.
> 
> Here is a connection handler code that does the exact same 
> thing you had
> below. (note that print writes to stdout, which is visible if you run
> httpd with -X (stay in foreground) option:
> 
> from mod_python import apache
> 
> def connectionhandler(conn):
> 
>     print "Connect from '%s'" % `conn.remote_addr`
> 
>     while 1:
>         data = conn.read()
>         if not data: break
>         print " Received: %s" % `data`
> 
>     print "Connection closed from '%s'" % `conn.remote_addr`
> 
>     return apache.OK
> 
> And here's the result:
> 
> $ ./bin/httpd -X
> Connect from '('0.0.0.0', 3513)'
>  Received: 'Hello\r\n'
>  Received: 'World\r\n'
> Connection closed from '('0.0.0.0', 3513)'
> 
> If I do 'for i in "Hello World"' thing, I get this:
> 
> Connect from '('0.0.0.0', 3524)'
>  Received: 'Hello World'
> Connection closed from '('0.0.0.0', 3524)'
> 
> Grisha
> 
> On Wed, 16 Jul 2003, Dustin Mitchell wrote:
> 
> > On Wed, Jul 16, 2003 at 01:59:58PM -0400, Gregory (Grisha) 
> Trubetskoy wrote:
> > > This is not a problem of mod_python or Apache, this is 
> the way sockets
> > > work. If your protocol is such that you know ahead of 
> time how much to
> > > read (e.g. HTTP), then you can request this much data in one read.
> > > Otherwise, you must read in smallest unit sizes of your 
> protocol, which
> > > (I'm guessing) is 1 byte in case of Z39.50.
> >
> > This is not strictly true, as long as you're OK with 
> possibly getting a
> > bit of *extra* data beyond a particular PDU (a little bit 
> of buffering
> > can take care of that).  Apache has to do this to read the 
> HTTP header,
> > which is not of a fixed length.
> >
> > The socket blocking read interface is structured such that 
> it will block
> > when *no* data is available, and will return *up to* the quantity
> > specified in the recv() call if it is available.  However, if some
> > smaller amount of data is available, that data will be returned
> > immediately.
> >
> > To demonstrate, I hacked this together:
> >
> > from socket import *
> > s = socket(AF_INET, SOCK_STREAM)
> > s.bind(("", 9900))
> > s.listen(5)
> > while 1:
> >   ss, sa = s.accept()
> >   print "Connect from '%s'" % (sa,)
> >   while 1:
> >     data = ss.recv(100)
> >     if not data: break
> >     print " Received: %s" % `data`
> >   print "Connection closed from '%s'" % (sa,)
> >
> > Then connected with telnet and typed "Hello" and "World" on separate
> > lines.  Telnet, by default, buffers lines of input until a 
> newline, but
> > you will note that in the two returns from ss.recv(), 
> neither contained
> > 100 bytes of data:
> >
> > Connect from '('127.0.0.1', 56260)'
> >  Received: 'Hello\r\n'
> >  Received: 'World\r\n'
> > Connection closed from '('127.0.0.1', 56260)'
> >
> > Further, a loop such as:
> >   for i in 'hello world': s.send(i)
> > will produce output like this:
> >
> > Connect from '('127.0.0.1', 56277)'
> >  Received: 'h'
> >  Received: 'ello world'
> > Connection closed from '('127.0.0.1', 56277)'
> >
> > Either the client or the server's socket implementation is 
> buffering the
> > characters because they're appearing so quickly, which cuts 
> down on the
> > number of recv() calls which must be made.
> >
> > I can't speak for the Apache sockets API, or the Python interface
> > thereto, but sockets themselves *do* support this interface 
> (they'd be
> > pretty useless if they didn't!).  I highly recommend W. Richard
> > Stevens' TCP/IP Illustrated for an in-depth and very readable
> > discussion of this and many other crucial implementation details of
> > TCP/IP.
> >
> > Dustin
> >
> > --
> >
> >   Dustin Mitchell
> >   dustin@ywlcs.org/djmitche@alumni.uchicago.edu
> >   http://people.cs.uchicago.edu/~dustin/
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
> 
From grisha at modpython.org  Wed Jul 16 23:20:22 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:00:14 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
 integration
In-Reply-To: <004d01c34bde$98310c40$24c0c20a@computer>
References: <004d01c34bde$98310c40$24c0c20a@computer>
Message-ID: <20030716231830.N5431@onyx.ispol.com>


There is some sort of an error in your code, but because of a bug that was
fixed earlier your mod_python doesn't log the error in the log correctly.

Attached is another patch, this time to apache.py, that should log the
error correctly.

Grisha

On Wed, 16 Jul 2003, fitnah55 wrote:

>
> duh.. add the port to listen
>
> heh
>
> coincidentally, i don't think the echo example is working
>
> [Tue Jul 15 13:03:18 2003] [error] python_connection:
> ConnectionDispatch() returned nothing.
>
> hmm
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
-------------- next part --------------
--- apache.py	12 Jul 2003 02:40:45 -0000	1.70
+++ apache.py	16 Jul 2003 20:23:24 -0000	1.71
@@ -54,7 +54,7 @@
  #
  # Originally developed by Gregory Trubetskoy.
  #
- # $Id: apache.py,v 1.70 2003/07/12 02:40:45 grisha Exp $
+ # $Id: apache.py,v 1.71 2003/07/16 20:23:24 grisha Exp $
 
 import sys
 import traceback
@@ -103,7 +103,7 @@
         try:
 
             handler = conn.hlist.handler
-            
+
             # split module::handler
             l = handler.split('::', 1)
             module_name = l[0]
@@ -115,7 +115,7 @@
 
             # add the directory to pythonpath if
             # not there yet, or pythonpath specified
-            
+
             if config.has_key("PythonPath"):
                 # we want to do as little evaling as possible,
                 # so we remember the path in un-evaled form and
@@ -161,7 +161,8 @@
             try:
                 exc_type, exc_value, exc_traceback = sys.exc_info()
                 result = self.ReportError(exc_type, exc_value, exc_traceback, srv=conn.base_server,
-                                          phase=filter.name, hname=handler, debug=debug)
+                                          phase="ConnectionHandler",
+                                          hname=handler, debug=debug)
             finally:
                 exc_traceback = None
 
From chris at vindaloo.com  Wed Jul 16 14:58:49 2003
From: chris at vindaloo.com (Christopher Sean Hilton)
Date: Fri Jan  9 22:00:14 2004
Subject: [mod_python] Getting access to a file from a post.
In-Reply-To: <20030716134923.B92465@onyx.ispol.com>
References: <Pine.LNX.4.44.0307161709550.2478-100000@gondolin.hist.liv.ac.uk>
	<20030716134923.B92465@onyx.ispol.com>
Message-ID: <20030716185849.GA1129@dagobah.pvt.vindaloo.com>

-----BEGIN PGP SIGNED MESSAGE-----

I'm trying to generate an xml transaction handler using apache,
modpython, python and sax. I would like to be able to post a file to
this website/handler with something like curl and have modpython
process the file. Something like

     $ cat MyXmlFile.xml | \
     >   curl https://www.example.com/iface.py/XmlHandler

My python looks like this:

     $ cat /var/www/data/www.example.com/iface.py
     #! /usr/local/bin/python2.1
     
     from mod_python import apache

     def XmlHandler(req):
        XmlData = req.readlines()
        ...

This does not get the contens of the file that I posted, in fact it's
empty. Is there any way short of using traditional CGI of getting this
file?

Thanks in advance and if I'm missing something in the manual please
feel free to give me a poke that sets me in the right direction.

Chris

- -- 
Chris Hilton                                 chilton-at-vindaloo-dot-com
- ------------------------------------------------------------------------
                "All I was doing was trying to get home from work!"
                                                 -- Rosa Parks
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.1 (FreeBSD)

iQEVAwUBPxWgWILaxorQlXotAQE23Qf9Ec2xBSXHtX6JN9QSwocetyTrDqBecpto
5lkvq6YlwGF4M5Ei5eUBFjOmAo3OydM83zKMzdzJTgrlOOr6p/JmAxV0YH3qm7QI
+ON/vfoNDxVsPCeQPU/B1dEwkRdjtT2dMda68Ce8dG6go/1McKwUGxIm7/J4Qifs
Bt02IeGLhu+03VIfm03dROn95P3LxqiuTUXbHiQYky9k23ahQjZ8O3XXb+3fyYa4
E44ZG0O9T/H5Xig1rTrbAASao86HNolgnbKR2zNbivtOblgl/p1KSWofkqfRaLRz
JcT0jlSrQB1RvG2rZUz2qy1EPunZ2YUgS1gR+MmTJBmGTxYnIRCzJw==
=tbTY
-----END PGP SIGNATURE-----

From azaroth at liverpool.ac.uk  Thu Jul 17 11:57:18 2003
From: azaroth at liverpool.ac.uk (Robert Sanderson)
Date: Fri Jan  9 22:00:14 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
 integration
In-Reply-To: <20030716161514.Q95093@onyx.ispol.com>
Message-ID: <Pine.LNX.4.44.0307171155380.6759-100000@gondolin.hist.liv.ac.uk>


> I attached a patch to the connobject.c that changes its behaviour so that
> read(len) will read at most len bytes, and will only block if no data is
> available. And len is an optional argument.

Great stuff, thanks for this Grisha.  It really is useful to us :)

Rob

-- 
      ,'/:.          Rob Sanderson (azaroth@liverpool.ac.uk)
    ,'-/::::.        http://www.o-r-g.org/~azaroth/
  ,'--/::(@)::.      Special Collections and Archives, extension 3142
,'---/::::::::::.    Nebmedes:  telnet: nebmedes.o-r-g.org 7777
____/:::::::::::::.                WWW:  http://nebmedes.o-r-g.org:8000/
I L L U M I N A T I

From chris at vindaloo.com  Thu Jul 17 09:09:54 2003
From: chris at vindaloo.com (Christopher Sean Hilton)
Date: Fri Jan  9 22:00:14 2004
Subject: [mod_python] Getting access to a file from a post.
In-Reply-To: <20030717034737.GZ18379@eleanor.internal.ywlcs.org>
References: <Pine.LNX.4.44.0307161709550.2478-100000@gondolin.hist.liv.ac.uk>
	<20030716134923.B92465@onyx.ispol.com>
	<20030716185849.GA1129@dagobah.pvt.vindaloo.com>
	<20030717034737.GZ18379@eleanor.internal.ywlcs.org>
Message-ID: <20030717130954.GA526@dagobah.pvt.vindaloo.com>

On Wed, Jul 16, 2003 at 10:47:37PM -0500, Dustin Mitchell wrote:

[snip]

> 
> If I'm not mistaken, you're using the publisher handler for this, and
> curl will generate a POST request.  Publisher, by virtue of using
> util.FieldStorage, will try to read that POST data as form data
> (depending on the content-type; it might just throw up a
> NOT_IMPLEMENTED). 
> 
> So the long and short of it is that publisher will gobble your request
> body, because publisher is intended to talk to a web browser, which
> only sends a certain kind of data there (form data).  If you'd like to
> parse some other format of request body, you'll have to forgo publisher
> and do that in a native handler.  That handler could look very much like
> what you've got:
> 
> # note the name 'handler' is mandatory
> def handler(req):
>   XmlData = req.readlines() # are you sure you want a list of lines?
>   ...
> 
> and in your Apache config,
> 
>   PythonHandler iface
> 
> Hope this helps.  Hope I'm right.  Please correct me if I am not.
> 

The assumption that I'm using the Publisher is correct. I will try the
code I have against the native handler this morning and post my
results to the list.

Thanks
 - Chris

-- 
Chris Hilton                                 chilton-at-vindaloo-dot-com
------------------------------------------------------------------------
                "All I was doing was trying to get home from work!"
                                                 -- Rosa Parks
From fitnah55 at hotmail.com  Thu Jul 17 11:30:15 2003
From: fitnah55 at hotmail.com (fitnah55)
Date: Fri Jan  9 22:00:14 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
	integration
In-Reply-To: <20030716231830.N5431@onyx.ispol.com>
Message-ID: <000301c34c78$52215ad0$24c0c20a@computer>


path problem.. couldn't specify that the connection handler was in a
specific
place, so i added a blah.pth file to site-packages pointing to the lib
directory of the host..

i can actually run the virtual host without specifying a documentroot so
i
guess that works out fine

but i'm not so sure canonical name type name based virtual hosts will
work
with this as is though?

i think right now using the virtual host directive is essentially just
giving
it its own error log

i can actually start developing a rudimentary design now though so
that's
pretty cool... it took a lot less effort than i thought when i first
started
looking into it


> -----Original Message-----
> From: Gregory (Grisha) Trubetskoy [mailto:grisha@modpython.org] 
> Sent: Wednesday, July 16, 2003 11:20 PM
> To: fitnah55
> Cc: mod_python@modpython.org
> Subject: RE: [mod_python] apache API and mod_python <-> 
> protocol module integration
> 
> 
> 
> There is some sort of an error in your code, but because of a 
> bug that was
> fixed earlier your mod_python doesn't log the error in the 
> log correctly.
> 
> Attached is another patch, this time to apache.py, that should log the
> error correctly.
> 
> Grisha
> 
> On Wed, 16 Jul 2003, fitnah55 wrote:
> 
> >
> > duh.. add the port to listen
> >
> > heh
> >
> > coincidentally, i don't think the echo example is working
> >
> > [Tue Jul 15 13:03:18 2003] [error] python_connection:
> > ConnectionDispatch() returned nothing.
> >
> > hmm
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
> 
From grisha at modpython.org  Thu Jul 17 11:47:13 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:00:14 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
 integration
In-Reply-To: <000301c34c78$52215ad0$24c0c20a@computer>
References: <000301c34c78$52215ad0$24c0c20a@computer>
Message-ID: <20030717114409.V19822@onyx.ispol.com>



On Thu, 17 Jul 2003, fitnah55 wrote:

> but i'm not so sure canonical name type name based virtual hosts will
> work with this as is though?

Name-based hosts certainly will not work because the name comes from the
Host: header, but we're not at the HTTP level here.

> i think right now using the virtual host directive is essentially just
> giving it its own error log

It's more than that, it will let you associate a connection handler with a
particular ip:port.

> i can actually start developing a rudimentary design now though so
> that's pretty cool... it took a lot less effort than i thought when i
> first started looking into it

That's good to know!

Grisha

>
>
> > -----Original Message-----
> > From: Gregory (Grisha) Trubetskoy [mailto:grisha@modpython.org]
> > Sent: Wednesday, July 16, 2003 11:20 PM
> > To: fitnah55
> > Cc: mod_python@modpython.org
> > Subject: RE: [mod_python] apache API and mod_python <->
> > protocol module integration
> >
> >
> >
> > There is some sort of an error in your code, but because of a
> > bug that was
> > fixed earlier your mod_python doesn't log the error in the
> > log correctly.
> >
> > Attached is another patch, this time to apache.py, that should log the
> > error correctly.
> >
> > Grisha
> >
> > On Wed, 16 Jul 2003, fitnah55 wrote:
> >
> > >
> > > duh.. add the port to listen
> > >
> > > heh
> > >
> > > coincidentally, i don't think the echo example is working
> > >
> > > [Tue Jul 15 13:03:18 2003] [error] python_connection:
> > > ConnectionDispatch() returned nothing.
> > >
> > > hmm
> > >
> > > _______________________________________________
> > > Mod_python mailing list
> > > Mod_python@modpython.org
> > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > >
> >
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From azaroth at liverpool.ac.uk  Thu Jul 17 17:18:45 2003
From: azaroth at liverpool.ac.uk (Robert Sanderson)
Date: Fri Jan  9 22:00:14 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
 integration
In-Reply-To: <000301c34c78$52215ad0$24c0c20a@computer>
Message-ID: <Pine.LNX.4.44.0307171710380.11776-100000@gondolin.hist.liv.ac.uk>


You can check the address it was received on and decline to handle 
anything received on the wrong port. Then it'll fall through to the 
normal handlers.

For example:

def connectionhandler(conn):
  if (conn.local_addr[0] != SERVER_IP or conn.local_addr[1] != SERVER_PORT):
    return apache.DECLINED
  elif (conn.base_server.server_hostname != SERVER_NAME):
    return apache.DECLINED
  else:
    # XXX do everything here

  return apache.OK


Also look at conn.base_server for the server object's other bits and 
pieces.

http://www.modpython.org/live/current/doc-html/pyapi-mpconn-mem.html
http://www.modpython.org/live/current/doc-html/pyapi-mpsrv-mem.html

Rob


On Thu, 17 Jul 2003, fitnah55 wrote:

> 
> path problem.. couldn't specify that the connection handler was in a
> specific
> place, so i added a blah.pth file to site-packages pointing to the lib
> directory of the host..
> 
> i can actually run the virtual host without specifying a documentroot so
> i
> guess that works out fine
> 
> but i'm not so sure canonical name type name based virtual hosts will
> work
> with this as is though?
> 
> i think right now using the virtual host directive is essentially just
> giving
> it its own error log
> 
> i can actually start developing a rudimentary design now though so
> that's
> pretty cool... it took a lot less effort than i thought when i first
> started
> looking into it
> 
> 
> > -----Original Message-----
> > From: Gregory (Grisha) Trubetskoy [mailto:grisha@modpython.org] 
> > Sent: Wednesday, July 16, 2003 11:20 PM
> > To: fitnah55
> > Cc: mod_python@modpython.org
> > Subject: RE: [mod_python] apache API and mod_python <-> 
> > protocol module integration
> > 
> > 
> > 
> > There is some sort of an error in your code, but because of a 
> > bug that was
> > fixed earlier your mod_python doesn't log the error in the 
> > log correctly.
> > 
> > Attached is another patch, this time to apache.py, that should log the
> > error correctly.
> > 
> > Grisha
> > 
> > On Wed, 16 Jul 2003, fitnah55 wrote:
> > 
> > >
> > > duh.. add the port to listen
> > >
> > > heh
> > >
> > > coincidentally, i don't think the echo example is working
> > >
> > > [Tue Jul 15 13:03:18 2003] [error] python_connection:
> > > ConnectionDispatch() returned nothing.
> > >
> > > hmm
> > >
> > > _______________________________________________
> > > Mod_python mailing list
> > > Mod_python@modpython.org
> > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > >
> > 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 

-- 
      ,'/:.          Rob Sanderson (azaroth@liverpool.ac.uk)
    ,'-/::::.        http://www.o-r-g.org/~azaroth/
  ,'--/::(@)::.      Special Collections and Archives, extension 3142
,'---/::::::::::.    Nebmedes:  telnet: nebmedes.o-r-g.org 7777
____/:::::::::::::.                WWW:  http://nebmedes.o-r-g.org:8000/
I L L U M I N A T I

From grisha at modpython.org  Thu Jul 17 13:09:08 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:00:14 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
 integration
In-Reply-To: <Pine.LNX.4.44.0307171710380.11776-100000@gondolin.hist.liv.ac.uk>
References: <Pine.LNX.4.44.0307171710380.11776-100000@gondolin.hist.liv.ac.uk>
Message-ID: <20030717130605.V19963@onyx.ispol.com>


I think this is unnecessary. Something like this in the config will make
your handler listen on 1.1.1.1:8888 only:

Listen 2.2.2.2:80
Listen 1.1.1.1:8888

<VirtualHost 1.1.1.1:8888>

	PythonConnectionHandler blah
	...

</VirtualHost>


On Thu, 17 Jul 2003, Robert Sanderson wrote:

>
> You can check the address it was received on and decline to handle
> anything received on the wrong port. Then it'll fall through to the
> normal handlers.
>
> For example:
>
> def connectionhandler(conn):
>   if (conn.local_addr[0] != SERVER_IP or conn.local_addr[1] != SERVER_PORT):
>     return apache.DECLINED
>   elif (conn.base_server.server_hostname != SERVER_NAME):
>     return apache.DECLINED
>   else:
>     # XXX do everything here
>
>   return apache.OK
>
>
> Also look at conn.base_server for the server object's other bits and
> pieces.
>
> http://www.modpython.org/live/current/doc-html/pyapi-mpconn-mem.html
> http://www.modpython.org/live/current/doc-html/pyapi-mpsrv-mem.html
>
> Rob
>
>
> On Thu, 17 Jul 2003, fitnah55 wrote:
>
> >
> > path problem.. couldn't specify that the connection handler was in a
> > specific
> > place, so i added a blah.pth file to site-packages pointing to the lib
> > directory of the host..
> >
> > i can actually run the virtual host without specifying a documentroot so
> > i
> > guess that works out fine
> >
> > but i'm not so sure canonical name type name based virtual hosts will
> > work
> > with this as is though?
> >
> > i think right now using the virtual host directive is essentially just
> > giving
> > it its own error log
> >
> > i can actually start developing a rudimentary design now though so
> > that's
> > pretty cool... it took a lot less effort than i thought when i first
> > started
> > looking into it
> >
> >
> > > -----Original Message-----
> > > From: Gregory (Grisha) Trubetskoy [mailto:grisha@modpython.org]
> > > Sent: Wednesday, July 16, 2003 11:20 PM
> > > To: fitnah55
> > > Cc: mod_python@modpython.org
> > > Subject: RE: [mod_python] apache API and mod_python <->
> > > protocol module integration
> > >
> > >
> > >
> > > There is some sort of an error in your code, but because of a
> > > bug that was
> > > fixed earlier your mod_python doesn't log the error in the
> > > log correctly.
> > >
> > > Attached is another patch, this time to apache.py, that should log the
> > > error correctly.
> > >
> > > Grisha
> > >
> > > On Wed, 16 Jul 2003, fitnah55 wrote:
> > >
> > > >
> > > > duh.. add the port to listen
> > > >
> > > > heh
> > > >
> > > > coincidentally, i don't think the echo example is working
> > > >
> > > > [Tue Jul 15 13:03:18 2003] [error] python_connection:
> > > > ConnectionDispatch() returned nothing.
> > > >
> > > > hmm
> > > >
> > > > _______________________________________________
> > > > Mod_python mailing list
> > > > Mod_python@modpython.org
> > > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > > >
> > >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
>
> --
>       ,'/:.          Rob Sanderson (azaroth@liverpool.ac.uk)
>     ,'-/::::.        http://www.o-r-g.org/~azaroth/
>   ,'--/::(@)::.      Special Collections and Archives, extension 3142
> ,'---/::::::::::.    Nebmedes:  telnet: nebmedes.o-r-g.org 7777
> ____/:::::::::::::.                WWW:  http://nebmedes.o-r-g.org:8000/
> I L L U M I N A T I
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From fitnah55 at hotmail.com  Thu Jul 17 13:14:53 2003
From: fitnah55 at hotmail.com (fitnah55)
Date: Fri Jan  9 22:00:14 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
	integration
In-Reply-To: <20030717130605.V19963@onyx.ispol.com>
Message-ID: <000a01c34c86$efe09f70$24c0c20a@computer>


doesn't really help if the box only has one IP..  IPv6 isn't a
reality yet, and IPs are extremely expensive

i don't think there's any viable solution without changing the
telnet protocol *erk*


> I think this is unnecessary. Something like this in the 
> config will make
> your handler listen on 1.1.1.1:8888 only:
> 
> Listen 2.2.2.2:80
> Listen 1.1.1.1:8888
> 
> <VirtualHost 1.1.1.1:8888>
> 
> 	PythonConnectionHandler blah
> 	...
> 
> </VirtualHost>
> 
> 
> On Thu, 17 Jul 2003, Robert Sanderson wrote:
> 
> >
> > You can check the address it was received on and decline to handle
> > anything received on the wrong port. Then it'll fall through to the
> > normal handlers.
> >
> > For example:
> >
> > def connectionhandler(conn):
> >   if (conn.local_addr[0] != SERVER_IP or conn.local_addr[1] 
> != SERVER_PORT):
> >     return apache.DECLINED
> >   elif (conn.base_server.server_hostname != SERVER_NAME):
> >     return apache.DECLINED
> >   else:
> >     # XXX do everything here
> >
> >   return apache.OK
> >
> >
> > Also look at conn.base_server for the server object's other bits and
> > pieces.
> >
> > http://www.modpython.org/live/current/doc-html/pyapi-mpconn-mem.html
> > http://www.modpython.org/live/current/doc-html/pyapi-mpsrv-mem.html
> >
> > Rob
> >
> >
> > On Thu, 17 Jul 2003, fitnah55 wrote:
> >
> > >
> > > path problem.. couldn't specify that the connection 
> handler was in a
> > > specific
> > > place, so i added a blah.pth file to site-packages 
> pointing to the lib
> > > directory of the host..
> > >
> > > i can actually run the virtual host without specifying a 
> documentroot so
> > > i
> > > guess that works out fine
> > >
> > > but i'm not so sure canonical name type name based 
> virtual hosts will
> > > work
> > > with this as is though?
> > >
> > > i think right now using the virtual host directive is 
> essentially just
> > > giving
> > > it its own error log
> > >
> > > i can actually start developing a rudimentary design now though so
> > > that's
> > > pretty cool... it took a lot less effort than i thought 
> when i first
> > > started
> > > looking into it
> > >
> > >
From fitnah55 at hotmail.com  Thu Jul 17 21:14:18 2003
From: fitnah55 at hotmail.com (fitnah55)
Date: Fri Jan  9 22:00:14 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
	integration
In-Reply-To: <20030716161514.Q95093@onyx.ispol.com>
Message-ID: <001101c34cc9$e9901fe0$24c0c20a@computer>


okay i'm still having a little problem with this, since i'm trying to
get telnet into full duplex character mode..

apparently the connection object is buffering the input for a CRLF
and i cant quite isolate where this is actually occuring

i see the GETLINE and GETBYTES stuff but so far i cant follow the
flow so well

im sending IAC+DO+ECHO and IAC+DO+SGA (supress go ahead) which should
get the client into the right mode, but the connection read buffer is
still boggling me, if u have any idea

> Well, after some looking, apparently the APR does work this 
> way, it's just
> that the way the connection handler was coded probably 
> because I didn't
> understand APR well enough at the time I made it loop until specified
> length of bytes was read (I started out with replicating 
> req.read(), which
> knows how much data there is to read).
> 
> I attached a patch to the connobject.c that changes its 
> behaviour so that
> read(len) will read at most len bytes, and will only block if 
> no data is
> available. And len is an optional argument.
> 
From greenbeard400 at yahoo.com  Thu Jul 17 20:54:14 2003
From: greenbeard400 at yahoo.com (Greenbeard)
Date: Fri Jan  9 22:00:14 2004
Subject: [mod_python] Passing Cursor Objects 
Message-ID: <20030718035414.67298.qmail@web21302.mail.yahoo.com>

Is it possible to pass the acutal cursor between
requests? 

I can attach the cursor as a <input>


I am using the publisher handler here...


def x(req):
  <snip>
   cursor = dbconn.cursor()
   


__________________________________
Do you Yahoo!?
SBC Yahoo! DSL - Now only $29.95 per month!
http://sbc.yahoo.com
From greenbeard400 at yahoo.com  Thu Jul 17 21:00:43 2003
From: greenbeard400 at yahoo.com (Greenbeard)
Date: Fri Jan  9 22:00:14 2004
Subject: [mod_python] Passing Cursor Objects 
Message-ID: <20030718040043.26298.qmail@web21310.mail.yahoo.com>

Sorry bout the premature email.  Stupid touchpad on
the laptop here.....

Is it possible to pass the acutal cursor between
requests? 

I can attach the cursor as a value on an <input> tag
and when I submit the form and I print the variable
passed I get the <MySQLdb.cursors.Cursor instance at
0x04AC1038> but if I reference it in future operations
I get "'str' object has no attribute 'execute' "

Based on the documentation I see that I could pass the
connection or I can move the cursor information out of
the cursor and pass it as a string.  But am I missing
something here that would allow me to use the cursor
object?  

I am using the publisher handler if that makes a
difference. 

Thanks! 

__________________________________
Do you Yahoo!?
SBC Yahoo! DSL - Now only $29.95 per month!
http://sbc.yahoo.com
From dustin at ywlcs.org  Thu Jul 17 23:38:45 2003
From: dustin at ywlcs.org (Dustin Mitchell)
Date: Fri Jan  9 22:00:14 2004
Subject: [mod_python] Passing Cursor Objects
In-Reply-To: <20030718040043.26298.qmail@web21310.mail.yahoo.com>
References: <20030718040043.26298.qmail@web21310.mail.yahoo.com>
Message-ID: <20030718043845.GX18379@eleanor.internal.ywlcs.org>

On Thu, Jul 17, 2003 at 09:00:43PM -0700, Greenbeard wrote:
> Sorry bout the premature email.  Stupid touchpad on
> the laptop here.....
> 
> Is it possible to pass the acutal cursor between
> requests? 
> 
> I can attach the cursor as a value on an <input> tag
> and when I submit the form and I print the variable
> passed I get the <MySQLdb.cursors.Cursor instance at
> 0x04AC1038> but if I reference it in future operations
> I get "'str' object has no attribute 'execute' "
> 
> Based on the documentation I see that I could pass the
> connection or I can move the cursor information out of
> the cursor and pass it as a string.  But am I missing
> something here that would allow me to use the cursor
> object?  
> 
> I am using the publisher handler if that makes a
> difference. 

Nope, you can't do it.  Basically all you can send to the client (the
browser) is text.   Most browsers are nice enough to send your text
back unmangled, but they're certainly not capable of anything more
complicated.  A cursor is deeply tied into the current state of the
Python Database API, the MySQL server, and whatnot -- all that state
certainly can't be tied up in a string and recreated for the next
request from the browser.

The text you see (<MySQLdb.cursors.Cursor instance at 0x04AC1038>) is
Python's best effor at turning this cursor into a string.  But all it
says is "I had this object here at this address with all this state in
it".  When the request comes back from the browser (milliseconds,
seconds, days later) that object is dead and gone.  Could be Apache
restarted.  MySQL restarted.  The server started smoking and was
replaced.  That cursor is no longer viable.

While I'm on the subject, another good reason not to send things like
this to your client (the browser) is this: you're not sure you'll get
it back.  If you had a way to "reserve" cursors on the server, such
that a browser could indicate "I was using cursor number 243" (perhaps
with an input tag), what would happen if the browser never send another
request?  That cursor would sit around, using up resources.  A couple
dozen idle cursors, and you'll have a DOS'd server..

So the long and short of it is you'll have to open a new cursor for
each request from the web.  It may help to think about the state of the
cursor that's most important to you: not the connection ID to the MySQL
server or anything like that.  It's probably the row number the user
last viewed, along with the components of the query.  If you put *that*
information into the generated HTML in such a way that the browser will
send it back to you (again, <input> tags are good for this), then
you'll be able to create a cursor in the necessary state by grabbing
any old cursor and executing the appropriate query.

I hope this helps.  I try to err on the side of too much explaination.

Dustin

--

  Dustin Mitchell
  dustin@ywlcs.org/djmitche@alumni.uchicago.edu
  http://people.cs.uchicago.edu/~dustin/
From mike.looijmans at asml.com  Fri Jul 18 07:10:37 2003
From: mike.looijmans at asml.com (Mike Looijmans)
Date: Fri Jan  9 22:00:15 2004
Subject: [mod_python] Passing Cursor Objects
Message-ID: <01c34cea$ec7a4480$926a1e6e@wsasd464>

Good explanation, I'm sure you're erring on the 'too much' side here.

Anyway, MySQL has a quite nice LIMIT command for this purpose. You can not
only get the 'first 10' rows, but you can also make it fetch the last 10 or
from 30-40. So all you need is to keep track of where you were and what the
query was (you could make the page into a form and add <input type=hidden>
tags and prev/next submit buttons. Or you could put the query into the url.

If you have really long queries (URLs are limited to 6kB) consider using
either POST requests or store the query into the database and supply a
'handle' (row ID) instead. Throw away the query after an hour or so...


>So the long and short of it is you'll have to open a new cursor for
>each request from the web.  It may help to think about the state of the
>cursor that's most important to you: not the connection ID to the MySQL
>server or anything like that.  It's probably the row number the user
>last viewed, along with the components of the query.  If you put *that*
>information into the generated HTML in such a way that the browser will
>send it back to you (again, <input> tags are good for this), then
>you'll be able to create a cursor in the necessary state by grabbing
>any old cursor and executing the appropriate query.
>
>I hope this helps.  I try to err on the side of too much explaination.




-- 
The information contained in this communication and any attachments is confidential and may be privileged, and is for the sole use of the intended recipient(s). Any unauthorized review, use, disclosure or distribution is prohibited. If you are not the intended recipient, please notify the sender immediately by replying to this message and destroy all copies of this message and any attachments. ASML is neither liable for the proper and complete transmission of the information contained in this communication, nor for any delay in its receipt.


From davidf at sjsoft.com  Fri Jul 18 09:58:00 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 22:00:15 2004
Subject: [mod_python] Passing Cursor Objects
In-Reply-To: <01c34cea$ec7a4480$926a1e6e@wsasd464>
References: <01c34cea$ec7a4480$926a1e6e@wsasd464>
Message-ID: <3F17A888.9000704@sjsoft.com>

Mike Looijmans wrote:

>Good explanation, I'm sure you're erring on the 'too much' side here.
>
>Anyway, MySQL has a quite nice LIMIT command for this purpose. You can not
>only get the 'first 10' rows, but you can also make it fetch the last 10 or
>from 30-40. So all you need is to keep track of where you were and what the
>query was (you could make the page into a form and add <input type=hidden>
>tags and prev/next submit buttons. Or you could put the query into the url.
>
>If you have really long queries (URLs are limited to 6kB) consider using
>either POST requests or store the query into the database and supply a
>'handle' (row ID) instead. Throw away the query after an hour or so...
>  
>
>>So the long and short of it is you'll have to open a new cursor for
>>each request from the web.  It may help to think about the state of the
>>cursor that's most important to you: not the connection ID to the MySQL
>>server or anything like that.  It's probably the row number the user
>>last viewed, along with the components of the query.  If you put *that*
>>information into the generated HTML in such a way that the browser will
>>send it back to you (again, <input> tags are good for this), then
>>you'll be able to create a cursor in the necessary state by grabbing
>>any old cursor and executing the appropriate query.
>>
>>I hope this helps.  I try to err on the side of too much explaination.
>>    
>>
Or if you did really, even after those explanations, want to store the 
cursor, you could create a unique key for it, save it in a global 
dictionary (but note problems with different threads/processes), get the 
client to remember the key (cookie/hidden field/URL) and retrieve the 
cursor using the key on the next request...
But you probably really don't need to do that.

David


From fitnah55 at hotmail.com  Fri Jul 18 13:43:53 2003
From: fitnah55 at hotmail.com (fitnah55)
Date: Fri Jan  9 22:00:15 2004
Subject: [mod_python]  apache API and mod_python <-> protocol
	moduleintegration
In-Reply-To: <001101c34cc9$e9901fe0$24c0c20a@computer>
Message-ID: <000701c34d54$27753450$24c0c20a@computer>


okay i checked the client side by putting it into forced character
at a time mode, and now i can get the python handler to print to
stdout that its getting the characters a character at a time - but
the 'echo' part is still buffering until a CRLF is detected.. which
when i put the client into forced mode, it only sends CR and not the
LF..

i'm going to look at the conn_object.c code and the apache.py code
again, but i am having difficulty following what all is going on


> okay i'm still having a little problem with this, since i'm trying to
> get telnet into full duplex character mode..
> 
> apparently the connection object is buffering the input for a CRLF
> and i cant quite isolate where this is actually occuring
> 
> i see the GETLINE and GETBYTES stuff but so far i cant follow the
> flow so well
> 
> im sending IAC+DO+ECHO and IAC+DO+SGA (supress go ahead) which should
> get the client into the right mode, but the connection read buffer is
> still boggling me, if u have any idea
> 
From fitnah55 at hotmail.com  Fri Jul 18 13:47:42 2003
From: fitnah55 at hotmail.com (fitnah55)
Date: Fri Jan  9 22:00:15 2004
Subject: [mod_python]  apache API and mod_python <-> protocol
	moduleintegration
Message-ID: <000c01c34d54$b0153f80$24c0c20a@computer>


ahh nevermind, modpython is working as expected

its definitely something with the protocol negotiation... sigh

rfc's on telnet suck


> -----Original Message-----
> From: fitnah55 [mailto:fitnah55@hotmail.com] 
> Sent: Friday, July 18, 2003 1:44 PM
> To: 'mod_python@modpython.org'
> Subject: RE: [mod_python] apache API and mod_python <-> 
> protocol moduleintegration
> 
> 
> 
> okay i checked the client side by putting it into forced character
> at a time mode, and now i can get the python handler to print to
> stdout that its getting the characters a character at a time - but
> the 'echo' part is still buffering until a CRLF is detected.. which
> when i put the client into forced mode, it only sends CR and not the
> LF..
> 
> i'm going to look at the conn_object.c code and the apache.py code
> again, but i am having difficulty following what all is going on
> 
> 
> > okay i'm still having a little problem with this, since i'm 
> trying to
> > get telnet into full duplex character mode..
> > 
> > apparently the connection object is buffering the input for a CRLF
> > and i cant quite isolate where this is actually occuring
> > 
> > i see the GETLINE and GETBYTES stuff but so far i cant follow the
> > flow so well
> > 
> > im sending IAC+DO+ECHO and IAC+DO+SGA (supress go ahead) 
> which should
> > get the client into the right mode, but the connection read 
> buffer is
> > still boggling me, if u have any idea
> > 
> 
From hawkeesk8 at yahoo.com  Sun Jul 20 09:10:39 2003
From: hawkeesk8 at yahoo.com (Kevin Smith)
Date: Fri Jan  9 22:00:15 2004
Subject: [mod_python] Adding user-defined objects to the request
Message-ID: <20030720161039.30358.qmail@web10706.mail.yahoo.com>

Hi,

I have been playing with mod_python for a while now
and would like to add my own non-trivial objects to
the request object.

I know that it is easy to add objects that are
built-in types such as:

session = {'Id':'&YFH%^%231234'}
req.session = session

Then, req.session, will be available to downstream
handlers to process.  But simply adding an object
doesn't appear to work if it is a user-defined type. 
I would like to do something similar to the following:

Class Session():
...

session = Session()
...
req.session = session

And then, later, in a downstream handler use my
defined methods:

req.session.athenticate()

I have searched the mailing list and the web in
general and can't find anything that is sending me in
the right direction nor telling me it is impossible. 
I have looked at pso and jotweb.  pso appears to
accomplish something similar to what I want but it
will take me weeks to unravel the trickery going on! 
I would just use pso but it does not implement an
authentication token the way I need to based on our
security needs.

Can someone help?

Many thanks in advance.

__________________________________
Do you Yahoo!?
SBC Yahoo! DSL - Now only $29.95 per month!
http://sbc.yahoo.com
From stian at soiland.no  Sun Jul 20 18:40:57 2003
From: stian at soiland.no (Stian =?iso-8859-1?Q?S=F8iland?=)
Date: Fri Jan  9 22:00:15 2004
Subject: [mod_python] Adding user-defined objects to the request
In-Reply-To: <20030720161039.30358.qmail@web10706.mail.yahoo.com>
References: <20030720161039.30358.qmail@web10706.mail.yahoo.com>
Message-ID: <20030720164057.GA24916@itea.ntnu.no>

On 2003-07-20 18:10:39, Kevin Smith wrote:

> session = {'Id':'&YFH%^%231234'}
> req.session = session
> 
> Then, req.session, will be available to downstream
> handlers to process.  But simply adding an object
> doesn't appear to work if it is a user-defined type. 
> I would like to do something similar to the following:
> 
> Class Session():
> ...

I can't see why this should not work, we do the same thing, but with a
user defined Session (that basically just store itself to disk on
__del__). Are you sure you don't have a path problem or namespace
problem? What is type(req.session) and repr(req.session) further down in
your pipeline?

-- 
Stian S?iland               Work toward win-win situation. Win-lose
Trondheim, Norway           is where you win and the other lose.
http://www.soiland.no/      Lose-lose and lose-win are left as an
                            exercise to the reader.  [Limoncelli/Hogan]

From gnb at itga.com.au  Mon Jul 21 16:29:11 2003
From: gnb at itga.com.au (Gregory Bond)
Date: Fri Jan  9 22:00:15 2004
Subject: [mod_python] 2.7.8: os.error no longer == OSError
Message-ID: <200307210629.QAA06995@lightning.itga.com.au>

I've got
	Apache/1.3.27 (Unix) mod_python/2.7.8 Python/2.1.1 configured
on Solaris 2.6.

Consider an mptest.py that looks like this:
	from mod_python import apache

	import os

	def handler(req):
		req.send_http_header()
		try:
			os.stat('/tmp/not.existing')
		except os.error:
			req.write("caught os.error")
		except OSError:
			req.write("Caught OSError")
		return apache.OK


This always returns "Caught OSError", never "caught os.error".  This breaks a 
whole lotta stuff, including builtin functions like os.path.exists() which 
use the "os.error" form.

What can I conceivably have done to break this????


From gnb at itga.com.au  Mon Jul 21 17:48:14 2003
From: gnb at itga.com.au (Gregory Bond)
Date: Fri Jan  9 22:00:15 2004
Subject: [mod_python] 2.7.8: import exceptions -> os.error no longer ==
	OSError 
In-Reply-To: Your message of Mon, 21 Jul 2003 16:29:11 +1000.
Message-ID: <200307210748.RAA13476@lightning.itga.com.au>

I've done some more work and it appears that doing
	import exceptions
from inside mod_python buggers things more than somewhat for every mod_python 
script run in that process from then on.

(This was in some old and unconverted python 1.3-era code)

------------
def handler(req):
        req.send_http_header()
        req.write("before import exceptions\n")
        req.write("OSError is %d\n" % id(OSError))
        req.write("os.error is %d\n" % id(os.error))
        import exceptions
        req.write("after import exceptions\n")
        req.write("OSError is %d\n" % id(OSError))
        req.write("os.error is %d\n" % id(os.error))

        return apache.OK

------------
before import exceptions
OSError is 539788
os.error is 539788
after import exceptions
OSError is 1258380
os.error is 539788

----------
But if I run the same code (writing to stdout, rather than a req structure) 
from the command line it works OK:
----
import os, sys
req = sys.stdout

req.write("before import exceptions\n")
req.write("OSError is %d\n" % id(OSError))
req.write("os.error is %d\n" % id(os.error))
import exceptions
req.write("after import exceptions\n")
req.write("OSError is %d\n" % id(OSError))
req.write("os.error is %d\n" % id(os.error))
-----
lightning$ python t.py
before import exceptions
OSError is 900204
os.error is 900204
after import exceptions
OSError is 900204
os.error is 900204


From hawkeesk8 at yahoo.com  Mon Jul 21 03:21:25 2003
From: hawkeesk8 at yahoo.com (Kevin Smith)
Date: Fri Jan  9 22:00:15 2004
Subject: [mod_python] Adding user-defined objects to the request
In-Reply-To: <20030720164057.GA24916@itea.ntnu.no>
Message-ID: <20030721102125.65136.qmail@web10706.mail.yahoo.com>

Actually, I think I may have just found the problem
which brings up another question ...

I was trying to do the addition of the object to the
request in the InitHandler.  I then noticed that I
could not even get a simple type to add to the request
in this phase of the handling.  Is that normal
behaviour?  The earliest that I seemed to be able to
add an object to the request was HeaderParser phase.

Can someone confirm or deny that the HeaderParser is
the earliest (inside a 'Location/Directory' context)
that you can add objects/attributes to the request?

In light of this, and Stian's comment, I shall try to
add my user-defined object at this phase instead.

Thanks
--- Stian Siland <stian@soiland.no> wrote:
> On 2003-07-20 18:10:39, Kevin Smith wrote:
> 
> > session = {'Id':'&YFH%^%231234'}
> > req.session = session
> > 
> > Then, req.session, will be available to downstream
> > handlers to process.  But simply adding an object
> > doesn't appear to work if it is a user-defined
> type. 
> > I would like to do something similar to the
> following:
> > 
> > Class Session():
> > ...
> 
> I can't see why this should not work, we do the same
> thing, but with a
> user defined Session (that basically just store
> itself to disk on
> __del__). Are you sure you don't have a path problem
> or namespace
> problem? What is type(req.session) and
> repr(req.session) further down in
> your pipeline?
> 
> -- 
> Stian Siland               Work toward win-win
> situation. Win-lose
> Trondheim, Norway           is where you win and the
> other lose.
> http://www.soiland.no/      Lose-lose and lose-win
> are left as an
>                             exercise to the reader. 
[Limoncelli/Hogan]


__________________________________
Do you Yahoo!?
SBC Yahoo! DSL - Now only $29.95 per month!
http://sbc.yahoo.com
From grisha at modpython.org  Mon Jul 21 10:47:15 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:00:15 2004
Subject: [mod_python] 2.7.8: os.error no longer == OSError
In-Reply-To: <200307210629.QAA06995@lightning.itga.com.au>
References: <200307210629.QAA06995@lightning.itga.com.au>
Message-ID: <20030721104016.I97244@onyx.ispol.com>



On Mon, 21 Jul 2003, Gregory Bond wrote:

> I've got
> 	Apache/1.3.27 (Unix) mod_python/2.7.8 Python/2.1.1 configured

[snip]

I think it's the same problem as the one causing this:
http://www.modpython.org/FAQ/faqw.py?req=all#5.4

Try upgrading to Python 2.2.3, I'm almost certain it will fix this.

(I'd upgrade to Apache 2.0.x and mod_python 3.0.3 too if that's an option)

Grisha
From sabu at pure-elite.org  Wed Jul 23 03:38:02 2003
From: sabu at pure-elite.org (Xavier)
Date: Fri Jan  9 22:00:15 2004
Subject: [mod_python] Errors off of a fresh install.
Message-ID: <33780.24.199.120.198.1058967482.squirrel@mail.darkscape.net>

Greetings,

I went ahead and installed the mod_python-3.0.3 dist with a fresh
installation of python 2.2, apache 2.0.47, and php4*.  I followed all of
the compile/installation instructions and went ahead with the testing.

While testing the generic (with fine indentation) mptest.py code -- I ran
into the "Internal error"/500 from apache.  Here is why it won't execute:

[Wed Jul 23 09:13:28 2003] [error] make_obcallback: could not import
mod_python.apache.

ImportError: No module named mod_python.apache

I then opened up python and tried to import "mod_python.apache" only to
get this in return:

Traceback (most recent call last):
  File "<stdin>", line 1, in ?
  File "/usr/lib/python2.2/site-packages/mod_python/apache.py", line 67, in ?
    import _apache
ImportError: No module named _apache

Has anyone else ran into this same fault? anyoneh ave any solutions? I'd
like to get mod_python_+Roadkill working and hopefully this is a fixable
problem.

Thanks,
-- Xavier.

From gnb at itga.com.au  Thu Jul 24 09:41:51 2003
From: gnb at itga.com.au (Gregory Bond)
Date: Fri Jan  9 22:00:15 2004
Subject: [mod_python] Errors off of a fresh install. 
In-Reply-To: Your message of Wed, 23 Jul 2003 03:38:02 -1000.
Message-ID: <200307232341.JAA02393@lightning.itga.com.au>

> [Wed Jul 23 09:13:28 2003] [error] make_obcallback: could not import
> mod_python.apache.
> ImportError: No module named mod_python.apache

See the very first question in the FAQ :
	http://www.modpython.org/FAQ/faqw.py?req=show&file=faq02.001.htp

> I then opened up python and tried to import "mod_python.apache" only to
> get this in return:
> ImportError: No module named _apache

Also in the FAQ:
	http://www.modpython.org/FAQ/faqw.py?req=show&file=faq02.002.htp

From hawkeesk8 at yahoo.com  Thu Jul 24 08:46:53 2003
From: hawkeesk8 at yahoo.com (Kevin Smith)
Date: Fri Jan  9 22:00:15 2004
Subject: [mod_python] apxs:Error: Command failed with rc=65536
Message-ID: <20030724154653.51378.qmail@web10704.mail.yahoo.com>

Hi,

I am getting the infamous "apxs:Error: Command failed
with rc=65536" error when trying to compile mod_python
3.0.3 against Apache 2.0.40 on RH9.

I have seen this error mentioned before on this list
and under each circumstance the reply was that the
version of python is too old.

However, I am running a compiled from source, Python
2.3c1 and the 'out-of-the-box' apache 2.0.40 (both
httpd and httpd-devel) that comes with RH9.

I issue ./configure --with-apxs=/usr/sbin/apxs
--with-python=/usr/local/bin/python
and then when I do the make I get the following (only
the last number of lines have been  included because I
don't think there were problems previous to this):

requestobject.c: In function `getreq_recmbr_off':
requestobject.c:1055: `LONG_LONG' undeclared (first
use in this function)
requestobject.c:1055: (Each undeclared identifier is
reported only once
requestobject.c:1055: for each function it appears
in.)
requestobject.c:1056: parse error before "l"
requestobject.c:1057: `l' undeclared (first use in
this function)
requestobject.c: At top level:
requestobject.c:1270: warning: initialization from
incompatible pointer type
apxs:Error: Command failed with rc=65536
.
make[1]: *** [mod_python.so] Error 1
make[1]: Leaving directory
`/usr/local/mod_python-3.0.3/src'
make: *** [do_dso] Error 2

I'm stumped.

Cheers


__________________________________
Do you Yahoo!?
Yahoo! SiteBuilder - Free, easy-to-use web site design software
http://sitebuilder.yahoo.com
From eu5698 at hotmail.com  Fri Jul 25 15:25:46 2003
From: eu5698 at hotmail.com (Rui Santos)
Date: Fri Jan  9 22:00:15 2004
Subject: [mod_python] problem to install mod_python
Message-ID: <LAW15-DAV73ur2iz2Mb00004329@hotmail.com>

hello.

i have been follow this steps: 

http://www.modpython.org/live/mod_python-2.7.8/doc-html/app-wininst.html

but when i test the apache then give me one error:

Invalid command 'PythonHandler'.

i use: 
a.. Python 2.2.3
a.. Apache 1.3.28 .



with the best compliments 
Rui Santos 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20030725/e5177210/attachment-0002.htm
From tnienstedt at telesyn.com  Sat Jul 26 09:30:54 2003
From: tnienstedt at telesyn.com (Ted Nienstedt)
Date: Fri Jan  9 22:00:15 2004
Subject: [mod_python] qdemo/publish_error not working for IE with mod_python
Message-ID: <000201c3537a$23974ea0$2e1210ac@telesyn.corp>

I installed Quixote on Linux RedHat 9 and installed the qdemo as
described in
http://www.mems-exchange.org/software/quixote/doc/web-server.html,
and also doc/demo.txt .  Everything worked fine with the cgi-bin in the
URL.  I've since switched to mod_python and added the <LocationMatch>
directive to httpd.conf.
Once I made the switch to mod_python I encountered a couple of apparent
"bugs" in quixote's http_request.py which I fixed by passing an empty
string instead of None in the 2nd arg of environ.get().  After making
this fix everything works with mod_python, but qdemo/publish_error from
IE returns the standard IE 400 Bad Request.
It works fine with mod_python from Opera or from the local lunix machine
with Mozilla.
Any clues or suggestions?
Thanks,
Ted
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20030726/321fcafc/attachment-0002.htm
From indrek at inversion.ee  Wed Jul 30 11:33:51 2003
From: indrek at inversion.ee (Indrek =?ISO-8859-1?Q?J=E4rve?=)
Date: Fri Jan  9 22:00:15 2004
Subject: [mod_python] A few questions about requestobject.c
Message-ID: <1059554030.13258.71.camel@hercules.dustbite.org>

Hi,

I've been messing around in requestobject.c for a few hours and started
wondering about the way a few things work. Since I'm not sure whether
they are design decisions, apache related stuff or just weird things, I
thought I'd ask the list :)

1. The use of apr_palloc

Multipart POST forms are parsed in util.py/FieldStorage using req's
req_readline function, which happily apr_palloc'ates enough memory to
read the remaining request data into memory, but never seems to free it
(nasty if the users have a habit of uploading 100+MB files, especially
once multiplied with the number of apache processes). Since the pool
used is attached to the apache request, I'm not sure I should freely
apr_pool_clear() or apr_pool_destroy() it either.

I managed to release memory by replacing apr_palloc with malloc and
adding a few free()s where required, but is this the right approach?

2. The use of PyString_FromStringAndSize()

Again in the req_readline() function, the result variable is initialized
at the size of the full remaining request data. Could the result
variable initialization perhaps be moved a bit further down to

a) when checking if rbuff from previous reads has a '\n' in it (perhaps
check with strchr and then initialize if needed) and 
b) after reading data from request and before copying it to the result.

At both these places it should be more obvious how much memory needs to
be allocated.


If I managed to make no sense at all and got something mixed up, please
let me know. However, I feel that at least the first point could use
some attention, as it creates a problem when uploading big files through
mod_python enabled scripts.

Regards,
Indrek

From grisha at modpython.org  Wed Jul 30 09:05:53 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:00:15 2004
Subject: [mod_python] A few questions about requestobject.c
In-Reply-To: <1059554030.13258.71.camel@hercules.dustbite.org>
References: <1059554030.13258.71.camel@hercules.dustbite.org>
Message-ID: <20030730085411.W86294@onyx.ispol.com>



On Wed, 30 Jul 2003, Indrek [ISO-8859-1] J?rve wrote:
>
> I've been messing around in requestobject.c for a few hours and started
> wondering about the way a few things work. Since I'm not sure whether
> they are design decisions, apache related stuff or just weird things, I
> thought I'd ask the list :)

It's been so long we lost track of which of the three they are :-) (BTW, a
better list for this sort of thing is python-dev@httpd.apache.org).

> 1. The use of apr_palloc
>
> Multipart POST forms are parsed in util.py/FieldStorage using req's
> req_readline function, which happily apr_palloc'ates enough memory to
> read the remaining request data into memory, but never seems to free it
> (nasty if the users have a habit of uploading 100+MB files, especially
> once multiplied with the number of apache processes). Since the pool
> used is attached to the apache request, I'm not sure I should freely
> apr_pool_clear() or apr_pool_destroy() it either.
>
> I managed to release memory by replacing apr_palloc with malloc and
> adding a few free()s where required, but is this the right approach?

Yes, this would definitely be a problem because that memory isn't freed
until the end of the request... We could either create a separate pool,
which then can be apr_pool_cleared(), or just use malloc like you have...
I'll see if I can take a look at it later today. If you have a patch you
could send in, that'd be nice.

>
> 2. The use of PyString_FromStringAndSize()
>
> Again in the req_readline() function, the result variable is initialized
> at the size of the full remaining request data.

This would be a problem with 100M files too... Another thing that occured
to me is that it could be better to rewrite the request read() functions
to use the buckets interface, this way none of this would be an issue.

Grisha
From azaroth at liverpool.ac.uk  Tue Jul  1 15:53:15 2003
From: azaroth at liverpool.ac.uk (Robert Sanderson)
Date: Fri Jan  9 22:04:01 2004
Subject: [mod_python] ConnectionHandler sigsegv (fwd)
In-Reply-To: <20030630092522.B53253@onyx.ispol.com>
Message-ID: <Pine.LNX.4.44.0307011548230.12884-100000@gondolin.hist.liv.ac.uk>


> The normal way of dealing with this sort of thing is by calling select()
> on a socket which will then call your function when there is anything to
> read. I don't know whether APR provides this.

Right. I can't see it anywhere, but that doesn't mean it's not available. 
 
> I think your only option is to read a byte at a time, making sure that
> when you receivie a complete frame/packet/whatever you stop reading so as
> to not block indefinitely.

Yep, I've now successfully implemented a Z39.50 connection handler using 
mod_python and PyZ3950 under Apache using this technique, though it's not 
pretty having to try to parse a PDU after reading in each byte. 

Cheers,

Rob

-- 
      ,'/:.          Rob Sanderson (azaroth@liverpool.ac.uk)
    ,'-/::::.        http://www.o-r-g.org/~azaroth/
  ,'--/::(@)::.      Special Collections and Archives, extension 3142
,'---/::::::::::.    Nebmedes:  telnet: nebmedes.o-r-g.org 7777
____/:::::::::::::.                WWW:  http://nebmedes.o-r-g.org:8000/
I L L U M I N A T I

From grisha at modpython.org  Tue Jul  1 12:12:58 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:04:02 2004
Subject: [mod_python] ConnectionHandler sigsegv (fwd)
In-Reply-To: <Pine.LNX.4.44.0307011548230.12884-100000@gondolin.hist.liv.ac.uk>
References: <Pine.LNX.4.44.0307011548230.12884-100000@gondolin.hist.liv.ac.uk>
Message-ID: <20030701114138.D75368@onyx.ispol.com>



On Tue, 1 Jul 2003, Robert Sanderson wrote:

> > I think your only option is to read a byte at a time, making sure that
> > when you receivie a complete frame/packet/whatever you stop reading so as
> > to not block indefinitely.
>
> Yep, I've now successfully implemented a Z39.50 connection handler using
> mod_python and PyZ3950 under Apache

Cool (even though I don't know what Z39.50 is :-) )

> using this technique, though it's not pretty having to try to parse a
> PDU after reading in each byte.

This is a pretty common technique in C, but in Python it is definitely
very inefficient because every "byte" is really a string... You could
probably get some improvement from using Python buffer(). I imagine this
will be a fairly common problem for people who implement connections, so
if you have any ideas on how it can be improved, please be sure to share
them on the list.

Grisha
From alexiev at activesolutions.bg  Wed Jul  2 17:18:35 2003
From: alexiev at activesolutions.bg (Alexiev Nikolay)
Date: Fri Jan  9 22:04:02 2004
Subject: [mod_python] Cookie
Message-ID: <00ce01c340a4$d30e74a0$0a01010a@dev1>

I want to save 2 cookies using mod_python & Cookie modul. Can somebody help
me, please?
10x

Best regards,
Alexiev, Nikolay

From grisha at modpython.org  Wed Jul  2 17:31:20 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:04:02 2004
Subject: [mod_python] Cookie
In-Reply-To: <00ce01c340a4$d30e74a0$0a01010a@dev1>
References: <00ce01c340a4$d30e74a0$0a01010a@dev1>
Message-ID: <20030702172715.A10551@onyx.ispol.com>


Something like this:

c1 = Cookie.SimpleCookie("cookie1=value1")
req.headers_out["Set-Cookie"] = c1.output(header="").strip()

c2 = Cookie.SimpleCookie("cookie2=value2")
req.headers_out.add("Set-Cookie") = c2.output(header="").strip()


Using the standard lib Cookie module is a bit ugly with mod_python because
Cookie was designed with CGI in mind, which is why the next release of
mod_python will have its own Cookie module.

Grisha


On Wed, 2 Jul 2003, Alexiev Nikolay wrote:

> I want to save 2 cookies using mod_python & Cookie modul. Can somebody help
> me, please?
> 10x
>
> Best regards,
> Alexiev, Nikolay
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From dlrubin at yahoo.com  Wed Jul  2 17:46:52 2003
From: dlrubin at yahoo.com (Daniel Rubin)
Date: Fri Jan  9 22:04:02 2004
Subject: [mod_python] problem creating an instance and debugging
Message-ID: <20030703004652.45793.qmail@web13904.mail.yahoo.com>

I successfully installed mod_python 3.0.3 and have it
working with apache, but one of my handlers isn't
working and I'm unable to get mod_python to record any
error messages about this particular event to the
apache error log. Basically, I have a handler called
xmlrpc that creates a python object called obj.  The
library needed to make this object gets imported
within xmlrpc.py just fine, but right at the line
where I create a new instance of obj (foo = obj()) I
get a stack dump (see below), and there are no errors
in the apache logs.  The xmlrpc.py program runs just
fine as a cgi within apache. It's when it runs with
mod_python that this fails. Any ideas?

in httpd.conf:
<Directory "/home/rubin/opt/apache/htdocs/xmlrpc">
    AddHandler python-program .py
    PythonHandler xmlrpc
    PythonDebug On
</Directory>

The stack dump:

  File "/test.py", line 52, in ?
    p = do_test(data)
  File "/test.py", line 44, in do_test
    return server.do_test(data)
  File "/home/lib/python2.2/xmlrpclib.py", line 821,
in __call__
    return self.__send(self.__name, args)
  File "/home/lib/python2.2/xmlrpclib.py", line 975,
in __request
    verbose=self.__verbose
  File "/home/lib/python2.2/xmlrpclib.py", line 853,
in request
    return self.parse_response(h.getfile())
  File "/home/lib/python2.2/xmlrpclib.py", line 886,
in parse_response
    response = f.read(1024)
  File "/home/lib/python2.2/httplib.py", line 1140, in
read
    assert not self._line_consumed and self._line_left
AssertionError



__________________________________
Do you Yahoo!?
SBC Yahoo! DSL - Now only $29.95 per month!
http://sbc.yahoo.com
From gnb at itga.com.au  Thu Jul  3 11:46:59 2003
From: gnb at itga.com.au (Gregory Bond)
Date: Fri Jan  9 22:04:02 2004
Subject: [mod_python] problem creating an instance and debugging 
In-Reply-To: Your message of Wed, 02 Jul 2003 17:46:52 -0700.
Message-ID: <200307030146.LAA14756@lightning.itga.com.au>

> working and I'm unable to get mod_python to record any
> error messages about this particular event to the
> apache error log.

stderr in mod_python goes to the apache error log but it is buffered.  You 
need to use sys.stderr.flush() at appropriate times.

See FAQ 2.3:
	http://www.modpython.org/FAQ/faqw.py?req=show&file=faq02.003.htp

From dustin at ywlcs.org  Wed Jul  2 21:02:43 2003
From: dustin at ywlcs.org (Dustin Mitchell)
Date: Fri Jan  9 22:04:02 2004
Subject: [mod_python] problem creating an instance and debugging
In-Reply-To: <20030703004652.45793.qmail@web13904.mail.yahoo.com>
References: <20030703004652.45793.qmail@web13904.mail.yahoo.com>
Message-ID: <20030703020242.GD23014@eleanor.internal.ywlcs.org>

On Wed, Jul 02, 2003 at 05:46:52PM -0700, Daniel Rubin wrote:
<snip snip>
> in parse_response
>     response = f.read(1024)
>   File "/home/lib/python2.2/httplib.py", line 1140, in
> read
>     assert not self._line_consumed and self._line_left
> AssertionError

Looking at this assertion, it seems valid.  Which is to say, in a linear
code flow, it should never get triggered.  My conjuecture then would be
that this is a threading issue.  Is your code using global variables of
any sort?  I'm pretty confident xmlrpclib and httplib are thread-safe,
but perhaps someone knows something to the contrary?

Dustin

-- 

  Dustin Mitchell
  dustin@ywlcs.org/djmitche@alumni.uchicago.edu
  http://people.cs.uchicago.edu/~dustin/
From dlrubin at yahoo.com  Wed Jul  2 20:28:35 2003
From: dlrubin at yahoo.com (Daniel Rubin)
Date: Fri Jan  9 22:04:02 2004
Subject: [mod_python] problem creating an instance and debugging 
In-Reply-To: <200307030146.LAA14756@lightning.itga.com.au>
Message-ID: <20030703032835.32306.qmail@web13905.mail.yahoo.com>

Putting sys.stderr.flush() into my xmlrpc.py doesn't
cause anything to get written to the apache log file.
I've even tried sys.stderr.write("stuff") and it
doesn't seem to appear anywhere (console nor apache
logs). Is there no way to track what's going on in the
code running on the server side in mod_python?

Thanks,
Daniel


--- Gregory Bond <gnb@itga.com.au> wrote:
> > working and I'm unable to get mod_python to record
> any
> > error messages about this particular event to the
> > apache error log.
> 
> stderr in mod_python goes to the apache error log
> but it is buffered.  You 
> need to use sys.stderr.flush() at appropriate times.
> 
> See FAQ 2.3:
> 
>
http://www.modpython.org/FAQ/faqw.py?req=show&file=faq02.003.htp
> 


__________________________________
Do you Yahoo!?
SBC Yahoo! DSL - Now only $29.95 per month!
http://sbc.yahoo.com
From gnb at itga.com.au  Thu Jul  3 14:03:17 2003
From: gnb at itga.com.au (Gregory Bond)
Date: Fri Jan  9 22:04:02 2004
Subject: [mod_python] problem creating an instance and debugging 
In-Reply-To: Your message of Wed, 02 Jul 2003 20:28:35 -0700.
Message-ID: <200307030403.OAA27049@lightning.itga.com.au>

> I've even tried sys.stderr.write("stuff") and it
> doesn't seem to appear anywhere (console nor apache
> logs). 

Well, it works fine to the error_log for me!  (apache1 and apache2 on Unix).
It may be something to do with your apache config, in particular the virtual
host logging setup.


From mike.looijmans at asml.com  Thu Jul  3 07:36:59 2003
From: mike.looijmans at asml.com (Mike Looijmans)
Date: Fri Jan  9 22:04:02 2004
Subject: [mod_python] Cookie
Message-ID: <01c34125$1f3a0f80$926a1e6e@wsasd464>

>I want to save 2 cookies using mod_python & Cookie modul. Can somebody help
>me, please?


Put your cookies in a SimpleCookie or SmartCookie, and use:

req.headers_out.add('Set-Cookie', cookies.output(header='',
sep='\r\nSet-Cookie:'))

to add them all in one shot.

--
Mike Looijmans
Private: http://www.milosoftware.com
-- Sorry about the nonsense below --



-- 
The information contained in this communication and any attachments is confidential and may be privileged, and is for the sole use of the intended recipient(s). Any unauthorized review, use, disclosure or distribution is prohibited. If you are not the intended recipient, please notify the sender immediately by replying to this message and destroy all copies of this message and any attachments. ASML is neither liable for the proper and complete transmission of the information contained in this communication, nor for any delay in its receipt.


From mike.looijmans at asml.com  Thu Jul  3 07:42:58 2003
From: mike.looijmans at asml.com (Mike Looijmans)
Date: Fri Jan  9 22:04:02 2004
Subject: [mod_python] Cookie
Message-ID: <01c34125$f5351d00$926a1e6e@wsasd464>

>Using the standard lib Cookie module is a bit ugly with mod_python because
>Cookie was designed with CGI in mind, which is why the next release of
>mod_python will have its own Cookie module.


Something like:

Request.cookie

so that Request has a 'cookie' object by default, which parses the 'cookie'
headers at the first call to Request.cookie. When setting it, it outputs the
cookie to the headers.

It would be a requirement to use the same interface as Cookie does, since that
allows CGI and mod_python code to share that part.

Mike.
-- My message ends here --



-- 
The information contained in this communication and any attachments is confidential and may be privileged, and is for the sole use of the intended recipient(s). Any unauthorized review, use, disclosure or distribution is prohibited. If you are not the intended recipient, please notify the sender immediately by replying to this message and destroy all copies of this message and any attachments. ASML is neither liable for the proper and complete transmission of the information contained in this communication, nor for any delay in its receipt.


From bill at rfa.org  Thu Jul  3 10:07:44 2003
From: bill at rfa.org (Bill Eldridge)
Date: Fri Jan  9 22:04:02 2004
Subject: [mod_python] Cookie
In-Reply-To: <20030702172715.A10551@onyx.ispol.com>
References: <00ce01c340a4$d30e74a0$0a01010a@dev1>
	<20030702172715.A10551@onyx.ispol.com>
Message-ID: <3F03E450.3070203@rfa.org>


PSO also has a session module that can be split off for
mod_python:

http://www.scriptfoundry.com/modules/pso/doc/session-modpython.html
http://www.scriptfoundry.com/modules/pso


Gregory (Grisha) Trubetskoy wrote:

>Something like this:
>
>c1 = Cookie.SimpleCookie("cookie1=value1")
>req.headers_out["Set-Cookie"] = c1.output(header="").strip()
>
>c2 = Cookie.SimpleCookie("cookie2=value2")
>req.headers_out.add("Set-Cookie") = c2.output(header="").strip()
>
>
>Using the standard lib Cookie module is a bit ugly with mod_python because
>Cookie was designed with CGI in mind, which is why the next release of
>mod_python will have its own Cookie module.
>
>Grisha
>
>
>On Wed, 2 Jul 2003, Alexiev Nikolay wrote:
>
>  
>
>>I want to save 2 cookies using mod_python & Cookie modul. Can somebody help
>>me, please?
>>10x
>>
>>Best regards,
>>Alexiev, Nikolay
>>
>>_______________________________________________
>>Mod_python mailing list
>>Mod_python@modpython.org
>>http://mailman.modpython.org/mailman/listinfo/mod_python
>>
>>    
>>
>_______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org
>http://mailman.modpython.org/mailman/listinfo/mod_python
>  
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20030703/42c7f02a/attachment-0003.htm
From alexiev at activesolutions.bg  Thu Jul  3 14:39:49 2003
From: alexiev at activesolutions.bg (Alexiev Nikolay)
Date: Fri Jan  9 22:04:02 2004
Subject: [mod_python] Save cookie and redirect
Message-ID: <012101c34157$cfb52020$0a01010a@dev1>

I try to set cookie and redirect with one response. Redirect works fine but
cookie dosn't exist. What can I do?


HTTP_MOVED_PERMANENTLY = 301
req.headers_out.add('Set-Cookie', cookies.output(header='',
sep='\r\nSet-Cookie:'))
req.headers_out.add('Location', redirect)
req.status = HTTP_MOVED_PERMANENTLY

From manfred.stienstra at dwerg.net  Thu Jul  3 13:57:04 2003
From: manfred.stienstra at dwerg.net (Manfred Stienstra)
Date: Fri Jan  9 22:04:02 2004
Subject: [mod_python] Save cookie and redirect
In-Reply-To: <012101c34157$cfb52020$0a01010a@dev1>
References: <012101c34157$cfb52020$0a01010a@dev1>
Message-ID: <200307031357.04468.manfred.stienstra@dwerg.net>

On Thursday 03 July 2003 13:39, Alexiev Nikolay wrote:
> I try to set cookie and redirect with one response. Redirect works fine but
> cookie dosn't exist. What can I do?
>
>
> HTTP_MOVED_PERMANENTLY = 301
> req.headers_out.add('Set-Cookie', cookies.output(header='',
> sep='\r\nSet-Cookie:'))
> req.headers_out.add('Location', redirect)
> req.status = HTTP_MOVED_PERMANENTLY

First set the cookie and after that redirect. If it's a login page you could 
display a page saying something like 'successfully logged in' (setting the 
cookie) and after that (5 secs or something) you redirect.

Manfred

From dustin at ywlcs.org  Thu Jul  3 08:22:11 2003
From: dustin at ywlcs.org (Dustin Mitchell)
Date: Fri Jan  9 22:04:02 2004
Subject: [mod_python] problem creating an instance and debugging
In-Reply-To: <20030703032835.32306.qmail@web13905.mail.yahoo.com>
References: <200307030146.LAA14756@lightning.itga.com.au>
	<20030703032835.32306.qmail@web13905.mail.yahoo.com>
Message-ID: <20030703132210.GI23014@eleanor.internal.ywlcs.org>

On Wed, Jul 02, 2003 at 08:28:35PM -0700, Daniel Rubin wrote:
> Putting sys.stderr.flush() into my xmlrpc.py doesn't
> cause anything to get written to the apache log file.
> I've even tried sys.stderr.write("stuff") and it
> doesn't seem to appear anywhere (console nor apache
> logs). Is there no way to track what's going on in the
> code running on the server side in mod_python?

I usually open an external file in append mode and write to that.  Then
I tail -f that file, and there's the information I wanted!  It has the
advantage that nothing in the Apache config can cause me to miss
selected messages or anything like that.

Dustin

-- 

  Dustin Mitchell
  dustin@ywlcs.org/djmitche@alumni.uchicago.edu
  http://people.cs.uchicago.edu/~dustin/
From grisha at modpython.org  Thu Jul  3 09:46:00 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:04:02 2004
Subject: [mod_python] problem creating an instance and debugging 
In-Reply-To: <20030703032835.32306.qmail@web13905.mail.yahoo.com>
References: <20030703032835.32306.qmail@web13905.mail.yahoo.com>
Message-ID: <20030703094320.P12723@onyx.ispol.com>


Why not just use apache.log_error or req.log_error?

http://www.modpython.org/live/current/doc-html/pyapi-apmeth.html#l2h-18

On Wed, 2 Jul 2003, Daniel Rubin wrote:

> Putting sys.stderr.flush() into my xmlrpc.py doesn't
> cause anything to get written to the apache log file.
> I've even tried sys.stderr.write("stuff") and it
> doesn't seem to appear anywhere (console nor apache
> logs). Is there no way to track what's going on in the
> code running on the server side in mod_python?
>
> Thanks,
> Daniel
>
>
> --- Gregory Bond <gnb@itga.com.au> wrote:
> > > working and I'm unable to get mod_python to record
> > any
> > > error messages about this particular event to the
> > > apache error log.
> >
> > stderr in mod_python goes to the apache error log
> > but it is buffered.  You
> > need to use sys.stderr.flush() at appropriate times.
> >
> > See FAQ 2.3:
> >
> >
> http://www.modpython.org/FAQ/faqw.py?req=show&file=faq02.003.htp
> >
>
>
> __________________________________
> Do you Yahoo!?
> SBC Yahoo! DSL - Now only $29.95 per month!
> http://sbc.yahoo.com
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From dlrubin at yahoo.com  Thu Jul  3 07:30:13 2003
From: dlrubin at yahoo.com (Daniel Rubin)
Date: Fri Jan  9 22:04:02 2004
Subject: [mod_python] problem creating an instance and debugging 
In-Reply-To: <20030703094320.P12723@onyx.ispol.com>
Message-ID: <20030703143013.36335.qmail@web13907.mail.yahoo.com>

The problem is that the xmlrpc.py script on the server
dies at a line of code that doesn't cause an Exception
to be thrown, so nothing executes after that line of
code and lines calling a log event will never get
executed.  And for some reason, no error message is
appearing in the apache error log (I have a pretty
standard httpd.conf).

--- "Gregory (Grisha) Trubetskoy"
<grisha@modpython.org> wrote:
> 
> Why not just use apache.log_error or req.log_error?
> 
>
http://www.modpython.org/live/current/doc-html/pyapi-apmeth.html#l2h-18
> 
> On Wed, 2 Jul 2003, Daniel Rubin wrote:
> 
> > Putting sys.stderr.flush() into my xmlrpc.py
> doesn't
> > cause anything to get written to the apache log
> file.
> > I've even tried sys.stderr.write("stuff") and it
> > doesn't seem to appear anywhere (console nor
> apache
> > logs). Is there no way to track what's going on in
> the
> > code running on the server side in mod_python?
> >
> > Thanks,
> > Daniel
> >
> >
> > --- Gregory Bond <gnb@itga.com.au> wrote:
> > > > working and I'm unable to get mod_python to
> record
> > > any
> > > > error messages about this particular event to
> the
> > > > apache error log.
> > >
> > > stderr in mod_python goes to the apache error
> log
> > > but it is buffered.  You
> > > need to use sys.stderr.flush() at appropriate
> times.
> > >
> > > See FAQ 2.3:
> > >
> > >
> >
>
http://www.modpython.org/FAQ/faqw.py?req=show&file=faq02.003.htp
> > >
> >
> >
> > __________________________________
> > Do you Yahoo!?
> > SBC Yahoo! DSL - Now only $29.95 per month!
> > http://sbc.yahoo.com
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> >
>
http://mailman.modpython.org/mailman/listinfo/mod_python
> >


__________________________________
Do you Yahoo!?
SBC Yahoo! DSL - Now only $29.95 per month!
http://sbc.yahoo.com
From grisha at modpython.org  Thu Jul  3 10:47:15 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:04:02 2004
Subject: [mod_python] problem creating an instance and debugging
In-Reply-To: <20030703004652.45793.qmail@web13904.mail.yahoo.com>
References: <20030703004652.45793.qmail@web13904.mail.yahoo.com>
Message-ID: <20030703104322.J23236@onyx.ispol.com>



On Wed, 2 Jul 2003, Daniel Rubin wrote:

> within xmlrpc.py just fine, but right at the line where I create a new
> instance of obj (foo = obj()) I get a stack dump (see below), and there
> are no errors in the apache logs.

I'm confused - how do you know you get a stack dump?

Also - which are you most concerned with - the fact that there is nothing
in the logs, or that you get a stack dump under mod_python whereas as a
CGI it works ok?

Grisha
From grisha at modpython.org  Thu Jul  3 10:58:33 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:04:02 2004
Subject: [mod_python] Save cookie and redirect
In-Reply-To: <200307031357.04468.manfred.stienstra@dwerg.net>
References: <012101c34157$cfb52020$0a01010a@dev1>
	<200307031357.04468.manfred.stienstra@dwerg.net>
Message-ID: <20030703104837.L23236@onyx.ispol.com>


Could it be that the location that you're redirecting to isn't valid for
this cookie? IIRC, the default path attribute is the full path, i.e. if
cookie was issued in /my/location1/blah and you're redirecting to
/my/location2/blah, the browser won't send the cookie (unless you
explicitely specify path=/my)

Grisha

On Thu, 3 Jul 2003, Manfred Stienstra wrote:

> On Thursday 03 July 2003 13:39, Alexiev Nikolay wrote:
> > I try to set cookie and redirect with one response. Redirect works fine but
> > cookie dosn't exist. What can I do?
> >
> >
> > HTTP_MOVED_PERMANENTLY = 301
> > req.headers_out.add('Set-Cookie', cookies.output(header='',
> > sep='\r\nSet-Cookie:'))
> > req.headers_out.add('Location', redirect)
> > req.status = HTTP_MOVED_PERMANENTLY
>
> First set the cookie and after that redirect. If it's a login page you could
> display a page saying something like 'successfully logged in' (setting the
> cookie) and after that (5 secs or something) you redirect.
>
> Manfred
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From dlrubin at yahoo.com  Thu Jul  3 09:11:20 2003
From: dlrubin at yahoo.com (Daniel Rubin)
Date: Fri Jan  9 22:04:02 2004
Subject: [mod_python] problem creating an instance and debugging
In-Reply-To: <20030703104322.J23236@onyx.ispol.com>
Message-ID: <20030703161120.58394.qmail@web13908.mail.yahoo.com>

I get the stack dump from the client program that
calls the function in xmlrpc.py running on the apache
server.  The client program gets the stack dump from a
call inside xmlrpclib that is trying to get a response
back from the xmlrpc.py running on the server.  An
error is happening in the xmlrpc.py program, and this
isn't making it's own stack dump or errors written to
the apache logs on the server. So I can't debug what
the nature of the error that is happening in the
remotely called function.

My main concern is that or that I get a stack dump
under mod_python whereas as a CGI it works ok. I'm
concerned about the lack of error logging to apache
only because it might help me figure out what's going
wrong with the code running in mod_python.


--- "Gregory (Grisha) Trubetskoy"
<grisha@modpython.org> wrote:
> 
> 
> On Wed, 2 Jul 2003, Daniel Rubin wrote:
> 
> > within xmlrpc.py just fine, but right at the line
> where I create a new
> > instance of obj (foo = obj()) I get a stack dump
> (see below), and there
> > are no errors in the apache logs.
> 
> I'm confused - how do you know you get a stack dump?
> 
> Also - which are you most concerned with - the fact
> that there is nothing
> in the logs, or that you get a stack dump under
> mod_python whereas as a
> CGI it works ok?
> 
> Grisha


__________________________________
Do you Yahoo!?
SBC Yahoo! DSL - Now only $29.95 per month!
http://sbc.yahoo.com
From grisha at modpython.org  Thu Jul  3 13:31:54 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:04:02 2004
Subject: [mod_python] problem creating an instance and debugging
In-Reply-To: <20030703161120.58394.qmail@web13908.mail.yahoo.com>
References: <20030703161120.58394.qmail@web13908.mail.yahoo.com>
Message-ID: <20030703132213.X23236@onyx.ispol.com>



On Thu, 3 Jul 2003, Daniel Rubin wrote:

> An error is happening in the xmlrpc.py program, and this isn't making
> it's own stack dump or errors written to the apache logs on the server.
> So I can't debug what the nature of the error that is happening in the
> remotely called function.

So, tell me if I understand this correctly (I'm not familiar with
xmlrpc.py) -

Xmlrpc.py is a CGI script which reports its errors by writing them to
stderr. Something happens when you run it under mod_python, and you don't
know what it is because stderr goes nowhere.

As far as I know, stderr output may end up in your error log, but I don't
think that's guaranteed and may be dependent on how your httpd was
compiled.  I think there is really no solution to this other than to tweak
xmlrpc into raising its exception or using mod_python's log_error to
report it.

HTH,

Grisha
From dlrubin at yahoo.com  Thu Jul  3 11:41:10 2003
From: dlrubin at yahoo.com (Daniel Rubin)
Date: Fri Jan  9 22:04:02 2004
Subject: [mod_python] problem creating an instance and debugging
In-Reply-To: <20030703132213.X23236@onyx.ispol.com>
Message-ID: <20030703184110.41206.qmail@web13905.mail.yahoo.com>

Here's the xmlrpc.py code. My client code is calling
the "evaluate" function via a call like this:
server = xmlrpclib.ServerProxy(myURI)
server.evaluate(data)

If I put the "return data" statement right before the
"model=Model()" statement, then things work fine. If I
put the return statement after it, then I get the
stack dump I showed you earlier. The code never jupmps
to the except: clause, and no errors are being written
to the apache logs (and my conf file is set to record
everything with no virtual hosts).


from mod_python import apache
import xmlrpclib

def evaluate(data):
     import MyTools import Model
     try:
          model = Model()  <--an error happens here
          return data
     except:
          open("/tmp/test_xmlrpc01",
'w').write("RUNNING ON %s" % findings)
          import traceback
         
traceback.print_exc(file=open("/tmp/test_xmlrpc03",
'w'))
          raise

def handler(req):
    import sys
    
    module = sys.modules[__name__]

    # Load the method and arguments from the client.
    content = req.read()

    # xmlrpclib fails if there are characters with
ASCII code >= 128.
    # Thus, change anything greater than that to a
space.
    table = ''.join(map(chr, range(128))) + " "*128
    content = content.translate(table)
        
    args, method_name = xmlrpclib.loads(content)

    # Call the method.
    if hasattr(module, method_name):
        try:
            retval = getattr(module,
method_name)(*args)
        except Exception, x:
            retval = xmlrpclib.Fault(
                0, "Exception (%s) raised: %s" %
(Exception.__name__, str(x)))
        except x:
            retval = xmlrpclib.Fault(
                0, "General exception raised: %s" %
str(x))
    else:
        retval = xmlrpclib.Fault(
            0, "This server does not provide: '%s'" %
method_name)

    # Marshal the return value and write the results
back to the
    # client.
    req.content_type = "text/xml"
    marshalled = xmlrpclib.dumps((retval,),
methodresponse=1)
    req.write(marshalled)
    
    return apache.OK



--- "Gregory (Grisha) Trubetskoy"
<grisha@modpython.org> wrote:
> 
> 
> On Thu, 3 Jul 2003, Daniel Rubin wrote:
> 
> > An error is happening in the xmlrpc.py program,
> and this isn't making
> > it's own stack dump or errors written to the
> apache logs on the server.
> > So I can't debug what the nature of the error that
> is happening in the
> > remotely called function.
> 
> So, tell me if I understand this correctly (I'm not
> familiar with
> xmlrpc.py) -
> 
> Xmlrpc.py is a CGI script which reports its errors
> by writing them to
> stderr. Something happens when you run it under
> mod_python, and you don't
> know what it is because stderr goes nowhere.
> 
> As far as I know, stderr output may end up in your
> error log, but I don't
> think that's guaranteed and may be dependent on how
> your httpd was
> compiled.  I think there is really no solution to
> this other than to tweak
> xmlrpc into raising its exception or using
> mod_python's log_error to
> report it.
> 
> HTH,
> 
> Grisha


__________________________________
Do you Yahoo!?
SBC Yahoo! DSL - Now only $29.95 per month!
http://sbc.yahoo.com
From harm-modpython at tty.nl  Fri Jul  4 19:00:39 2003
From: harm-modpython at tty.nl (harm)
Date: Fri Jan  9 22:04:02 2004
Subject: [mod_python] OSx compile problem
Message-ID: <20030704170039.GA5999@godel>


Moi,

somehow compiling on OSX does not work for me (OSX 10.2) with python 2.2.3,
mod_python 2.7.8 and apache 1.3.27


trying a static build gives:

gcc  -DDARWIN -DUSE_HSREGEX -DUSE_EXPAT -I./lib/expat-lite -DNO_DL_NEEDED
`./apaci` -u __dummy -u _PyMac_Error -framework System -framework
CoreServices -framework Foundation        \
      -o httpd buildmark.o modules.o modules/python/libpython.a
modules/standard/libstandard.a main/libmain.a ./os/unix/libos.a ap/libap.a
regex/libregex.a lib/expat-lite/libexpat.a  -lm
/usr/local/lib/python2.2/config/libpython2.2.a   -ldl                 
ld: table of contents for archive: modules/python/libpython.a is out of
date; rerun ranlib(1) (can't load from it)
make[2]: *** [target_static] Error 1
make[1]: *** [build-std] Error 2
make: *** [build] Error 2
[Harmens-Computer:/tmp/apache_1.3.27] harmen%



A DSO gives:
Compiling for DSO. For static, do "make static"

/usr/local/apache/sbin/apxs -I/tmp/mod_python-2.7.8/src/include
-I/usr/local/apache/include -I/usr/local/include/python2.2 -c mod_python.o
_apachemodule.o requestobject.o tableobject.o util.o serverobject.o
connobject.o  -lm  /usr/local/lib/python2.2/config/libpython2.2.a   -ldl                 
  -o mod_python.so mod_python.o _apachemodule.o requestobject.o
tableobject.o util.o serverobject.o connobject.o -lm
/usr/local/lib/python2.2/config/libpython2.2.a -ldl 
apxs:Break: Command failed with rc=16777215
make[1]: *** [mod_python.so] Error 1
make: *** [do_dso] Error 2
[Harmens-Computer:/tmp/mod_python-2.7.8] harmen% 




The ./configure output indicates it does take the right freshly recompiled nonthreaded python libs.  Any hints?

Thanks,
Harmen



(Hope this email does get through, my excuse for any doubles)

-- 
                               The Moon is Waxing Crescent (13% of Full)
From grisha at modpython.org  Fri Jul  4 15:10:21 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:04:02 2004
Subject: [mod_python] OSx compile problem
In-Reply-To: <20030704170039.GA5999@godel>
References: <20030704170039.GA5999@godel>
Message-ID: <20030704150856.U35122@onyx.ispol.com>



On Fri, 4 Jul 2003, harm wrote:

> somehow compiling on OSX does not work for me (OSX 10.2) with python 2.2.3,
>
> The ./configure output indicates it does take the right freshly
> recompiled nonthreaded python libs.  Any hints?

Check the README - there are some problems with darwin's libtool and the
way dynamic linking works, but the README has the steps to get it
compiled.

Grisha
From harm-modpython at tty.nl  Sat Jul  5 00:08:19 2003
From: harm-modpython at tty.nl (harm)
Date: Fri Jan  9 22:04:02 2004
Subject: [mod_python] OSx compile problem
In-Reply-To: <20030704150856.U35122@onyx.ispol.com>
References: <20030704170039.GA5999@godel>
	<20030704150856.U35122@onyx.ispol.com>
Message-ID: <20030704220819.GA6079@godel>

On Fri, Jul 04, 2003 at 03:10:21PM -0400, Gregory (Grisha) Trubetskoy wrote:
> 
> 
> On Fri, 4 Jul 2003, harm wrote:
> 
> > somehow compiling on OSX does not work for me (OSX 10.2) with python 2.2.3,
> >
> > The ./configure output indicates it does take the right freshly
> > recompiled nonthreaded python libs.  Any hints?
> 
> Check the README - there are some problems with darwin's libtool and the
> way dynamic linking works, but the README has the steps to get it
> compiled.

Ah! The readme in 3.0.3 has the info, indeed. Too bad I was trying to
install 2.7.8, which does not have that info :)

Thanks, 

Harmen
> 
> Grisha
> 

-- 
                               The Moon is Waxing Crescent (27% of Full)
From michel_ts at yahoo.com.br  Sat Jul  5 10:39:59 2003
From: michel_ts at yahoo.com.br (=?iso-8859-1?q?Michel=20Thadeu?=)
Date: Fri Jan  9 22:04:02 2004
Subject: [mod_python] A problem with publisher method...
Message-ID: <20030705133959.23742.qmail@web40408.mail.yahoo.com>

Hi guys!

I still have trouble with publisher method, I read a bite about and now
I imagine what is my problem...

The problem is with index, I want to access something like this:

http://127.0.0.1/mypage/test.py or better .../mypage/ (accessing the
index.py), but if I create an index function in test.py ou index.py, it
said 404notfound...

if I access index like in http://127.0.0.1/mypage/index.py/index it
goes ok. I think it conflitates in some point...

What could be the problem?

thanks for help and sorry my poor english!

[]'s

--
Michel Thadeu Sabchuk
Curitiba - Paran? - Brasil

=====
--
Michel Thadeu Sabchuk
Curitiba/PR

_______________________________________________________________________
Yahoo! Mail
Mais espa?o, mais seguran?a e gratuito: caixa postal de 6MB, antiv?rus, prote??o contra spam.
http://br.mail.yahoo.com/
From pascalbarbedor at free.fr  Sun Jul  6 11:29:36 2003
From: pascalbarbedor at free.fr (pascal barbedor)
Date: Fri Jan  9 22:04:02 2004
Subject: [mod_python] Fw: pb with apache readme dir include
Message-ID: <001601c343a1$32b7d550$468f933e@allalswqm99ewu>


>
>
> Hi
>
> I have the following problem with mod_python :
>
> set up a directory like this
>
>
> <Directory "c:/home/">
> AddHandler python-program .py .html
> PythonHandler eindex
> PythonDebug On
> DirectoryIndex index.html eindex.py
> Options Indexes
> Order allow,deny
> Allow from all
> </Directory>
>
> this works ok, I intercept also .html files in the eindex.py script.
>
> now if I call a subdirectory of home, like /home/subdir, control is passed
> to apache
> wich produces a standard directory index
>
> so far so good.
>
>
> now if a readme.html is located in the subdir, apache appends it to the
> directoryindex page,
> as it is normal by default.
>
> but then something interferes and it is like if the appended reame.html
was
> processed by the eindex.py above (but it is located in the subdir) and not
> by apache, though the bare directory index is here.
>
> of course if AddHandler python-program .py  (without .html) everything
goes
> well.
>
> I tried to add
> sethandler default-handler for home/subdir but it does not work
>
>
>
>
> pascal
>

From gnb at itga.com.au  Mon Jul  7 14:20:28 2003
From: gnb at itga.com.au (Gregory Bond)
Date: Fri Jan  9 22:04:02 2004
Subject: [mod_python] Compiling 2.7 statically
Message-ID: <200307070420.OAA24234@lightning.itga.com.au>

I'm trying to compile mod_python 2.7 (plus mod_ssl) statically into apache
1.3.27.  I'm using Python 2.1.1 on Solaris 6.

The first problem is that the Apache link step fails, because the mod_python 
library (libpython.a) refers to symbols in the libpython2.1.a library, and 
this is never referenced anywhere.  

I worked around that by adding ".../libpython2.1.a -lm" to EXTRA_LIBS in src/
Makefile.

This allows me to build an apache binary, and get the "Hello World" mod_python 
app working.  But as soon as I try any substantial application, I get errors 
like this:

PythonHandler oneaccount: ImportError: ld.so.1: /opt/apache/bin/httpd: fatal: relocation error: file /usr/local/lib/python2.1/lib-dynload/cStringIO.so: symbol PyCObject_FromVoidPtr: referenced symbol not found

which makes sense as these symbols are potentially not needed by mod_python 
therefore the relevent .o files aren't sucked in from the .a file.  

So how do I make this work? Or is statically compiling in mod_python a doomed 
exercise?



From stian at soiland.no  Mon Jul  7 18:15:16 2003
From: stian at soiland.no (Stian =?iso-8859-1?Q?S=F8iland?=)
Date: Fri Jan  9 22:04:02 2004
Subject: [mod_python] mod_python weirdness, maybe related to importing?
In-Reply-To: <20030610081422.GC28085@tummy.com>
References: <20030610055927.GB28085@tummy.com> <3EE584EE.9090503@sjsoft.com>
	<20030610081422.GC28085@tummy.com>
Message-ID: <20030707161516.GA614@itea.ntnu.no>

On 1970-01-01 01:00:00, Sean Reifschneider wrote:
   ~~~~
(.. importing the mail archives appearantly does not work that well
anymore :=) )

> On Tue, Jun 10, 2003 at 09:12:46AM +0200, David Fraser wrote:
> >Do you mean you're using this import mechanism when you have the problem 
> >with jotweb.input.Request below?
> 
> I mean that the imp module call is loading a module which then does an
> "import jotweb.input".  If in the jotweb I don't have the __init__.py
> import all sub-packages or sub-modules, I will get an AttributeError
> such as:
> 
>   AttributeError: 'module' object has no attribute 'input'

I can confirm the very same problem. We've been scratching our heads
today.

[ in this post I'll be quoting python code like /print "Python example"/ ]


We're using mod_python.publisher as PythonHandler, and have some
library functions in /usr/local/nav/navme/lib/python.

As our PythonPath seems to be totally mucked up, refering to
/usr/lib/python and so on, we .. as a quickfix.. set it manually

PythonPath "['', '/usr/local/lib/python2.2/site-packages',
    '/usr/lib/apache/python/lib/python2.2',
    '/usr/lib/apache/python/lib/python2.2/plat-linux2',
    '/usr/lib/apache/python/lib/python2.2/lib-tk',
    '/usr/lib/apache/python/lib/python2.2/lib-dynload',
    '/usr/lib/apache/python/lib/python2.2/site-packages',
    '/usr/local/nav/navme/lib/python',
    '/usr/local/lib/python2.2/site-packages', '.']"

(/usr/lib/apache/python/lib/python2.2 is our threadless installation,
this is Apache/1.3.27 (Unix) (Red-Hat/Linux) mod_python/2.7.8
Python/2.2.2 mod_ssl/2.8.12 OpenSSL/0.9.6b PHP/4.1.2)


The problem was weird, in a method logout() in index.py, we try
/from nav.web import state/. This always fail, both if we do it on a
module level or inside the function.

However, /from nav.web import auth/ works fine. The permissions are
perfect, there are no .pyc-files hanging around, and there is really no
big differences between the two files.

Actually we found out that symlinking nav/web to nav/webb - and trying
/from nav.webb import auth/  WORKED, suggesting some problems with
caching. Several apache-restarts gives no more help.

Using /usr/lib/apache/python/lib/python2.2/bin/python from the shell,
running as httpd, with the same PythonPath as above (verified by
req.write("%s" % sys.path)  ), from nav import auth works perfect.


The 'fix' you suggested, using import auth in nav/web/__init__.py - DID
work, however, as in your case, there is no reason why this should be
neccessary. 

In SOME of the cases in this testing, the error message is not from
/usr/local/nav/navme/apache/webroot/index.py (where the import actually
happens), but from mod_python/apache.py in the function import_module.
This function looks pretty weird to me, I tried adding some debug
sentences to follow the execution paths.


However, it turns out that our trouble-module nav.web.state is used as a
fixup handler as well, PythonFixupHandler nav.web.state.

Renaming to /PythonFixupHandler nav.webb.state/ removes the bug, 
/from nav.web import state/  suddenly works again.


So in our case, the problem is related to the module being used both in
handlers and imported by submodules. Appearently the errors from
mod_python.apache.import_module appears only those times the
PythonFixupHandler won't load. 

(debug messages reveal that import_module is NOT called by the normal
import sentence - that's good, as I couldn't understand how it could
have been called at that time :=) )



However, the problem is still unsolved, although the __init__.py-import
is  a working workaround (the symlink magic is NOT! :=) )

Is your problem-module a part of other headers (or imports) as well?


    (our team is also very pissed of by the need to restart apache every
    minute to force reloading of all modules.  It's seems like a 
    boring job to do like in 3.1 - as it still does not assure that
    modules are reloaded only once and in the correct order.

    A simple-but-stupid reload-all-modules-known-to-python fix did NOT
    work, as subclasses in different modules get totally confused being
    subclassed by some class that no longer exist. The problem is
    reloading in the correct order, and only once per request.

    Is there a nice way to UNLOAD all classes?  I'm thinking of
    something like /del sys.modules['mymodule']/ - but.. I'll have to
    check the module to see if it's mine or some internal python module
    first :=) )


-- 
Stian S?iland               Work toward win-win situation. Win-lose
Trondheim, Norway           is where you win and the other lose.
http://www.soiland.no/      Lose-lose and lose-win are left as an
                            exercise to the reader.  [Limoncelli/Hogan]


From stian at soiland.no  Mon Jul  7 18:19:49 2003
From: stian at soiland.no (Stian =?iso-8859-1?Q?S=F8iland?=)
Date: Fri Jan  9 22:04:02 2004
Subject: [mod_python] mod_python weirdness, maybe related to importing?
In-Reply-To: <20030616005419.GM8892@tummy.com>
References: <200306160025.KAA13272@lightning.itga.com.au>
	<20030616005419.GM8892@tummy.com>
Message-ID: <20030707161949.GB614@itea.ntnu.no>

On 1970-01-01 01:00:00, Sean Reifschneider wrote:

> Also, I'm running into cases where I'm setting values within modules in
> my handler, and then when I call code in the module those values are
> reset.  I've resorted to shoving request-persistent data into
> __builtins__, which works around the latter problem, and re-structuring
> some code so that my entire object heirarchy *CAN* be imported all at
> once.

Btw, a good tip to store some info from here to there is to store them
as attributes in the req object. We've created req.session by loading it
in the PythonFixupHandler mentioned in an earlier post, req.session is
available to all subsequent request handlers.

(and in some cases, weird enough, after the request is finished, the
attribute still remains in req.session for the NEXT call.. leading
to..
  
  def fixuphandler(req):
      req.session = None
)




-- 
Stian S?iland               Work toward win-win situation. Win-lose
Trondheim, Norway           is where you win and the other lose.
http://www.soiland.no/      Lose-lose and lose-win are left as an
                            exercise to the reader.  [Limoncelli/Hogan]

From stian at soiland.no  Mon Jul  7 18:33:44 2003
From: stian at soiland.no (Stian =?iso-8859-1?Q?S=F8iland?=)
Date: Fri Jan  9 22:04:02 2004
Subject: [mod_python] mod_python weirdness, maybe related to importing?
Message-ID: <20030707163344.GE614@itea.ntnu.no>

On 1970-01-01 01:00:00, Sean Reifschneider wrote:

> Also, I'm running into cases where I'm setting values within modules in
> my handler, and then when I call code in the module those values are
> reset.  I've resorted to shoving request-persistent data into
> __builtins__, which works around the latter problem, and re-structuring
> some code so that my entire object heirarchy *CAN* be imported all at
> once.

Btw, a good tip to store some info from here to there is to store them
as attributes in the req object. We've created req.session by loading it
in the PythonFixupHandler mentioned in an earlier post, req.session is
available to all subsequent request handlers.

(and in some cases, weird enough, after the request is finished, the
attribute still remains in req.session for the NEXT call.. leading
to..
  
  def fixuphandler(req):
      req.session = None
)




-- 
Stian S?iland               Work toward win-win situation. Win-lose
Trondheim, Norway           is where you win and the other lose.
http://www.soiland.no/      Lose-lose and lose-win are left as an
                            exercise to the reader.  [Limoncelli/Hogan]

From stian at soiland.no  Mon Jul  7 18:33:14 2003
From: stian at soiland.no (Stian =?iso-8859-1?Q?S=F8iland?=)
Date: Fri Jan  9 22:04:02 2004
Subject: [mod_python] mod_python weirdness, maybe related to importing?
Message-ID: <20030707163314.GD614@itea.ntnu.no>

(as I found out, posting before subscribing is a bad idea =) 

On 1970-01-01 01:00:00, Sean Reifschneider wrote:
   ~~~~
(.. importing the mail archives appearantly does not work that well
anymore :=) )

> On Tue, Jun 10, 2003 at 09:12:46AM +0200, David Fraser wrote:
> >Do you mean you're using this import mechanism when you have the problem 
> >with jotweb.input.Request below?
> 
> I mean that the imp module call is loading a module which then does an
> "import jotweb.input".  If in the jotweb I don't have the __init__.py
> import all sub-packages or sub-modules, I will get an AttributeError
> such as:
> 
>   AttributeError: 'module' object has no attribute 'input'

I can confirm the very same problem. We've been scratching our heads
today.

[ in this post I'll be quoting python code like /print "Python example"/ ]


We're using mod_python.publisher as PythonHandler, and have some
library functions in /usr/local/nav/navme/lib/python.

As our PythonPath seems to be totally mucked up, refering to
/usr/lib/python and so on, we .. as a quickfix.. set it manually

PythonPath "['', '/usr/local/lib/python2.2/site-packages',
    '/usr/lib/apache/python/lib/python2.2',
    '/usr/lib/apache/python/lib/python2.2/plat-linux2',
    '/usr/lib/apache/python/lib/python2.2/lib-tk',
    '/usr/lib/apache/python/lib/python2.2/lib-dynload',
    '/usr/lib/apache/python/lib/python2.2/site-packages',
    '/usr/local/nav/navme/lib/python',
    '/usr/local/lib/python2.2/site-packages', '.']"

(/usr/lib/apache/python/lib/python2.2 is our threadless installation,
this is Apache/1.3.27 (Unix) (Red-Hat/Linux) mod_python/2.7.8
Python/2.2.2 mod_ssl/2.8.12 OpenSSL/0.9.6b PHP/4.1.2)


The problem was weird, in a method logout() in index.py, we try
/from nav.web import state/. This always fail, both if we do it on a
module level or inside the function.

However, /from nav.web import auth/ works fine. The permissions are
perfect, there are no .pyc-files hanging around, and there is really no
big differences between the two files.

Actually we found out that symlinking nav/web to nav/webb - and trying
/from nav.webb import auth/  WORKED, suggesting some problems with
caching. Several apache-restarts gives no more help.

Using /usr/lib/apache/python/lib/python2.2/bin/python from the shell,
running as httpd, with the same PythonPath as above (verified by
req.write("%s" % sys.path)  ), from nav import auth works perfect.


The 'fix' you suggested, using import auth in nav/web/__init__.py - DID
work, however, as in your case, there is no reason why this should be
neccessary. 

In SOME of the cases in this testing, the error message is not from
/usr/local/nav/navme/apache/webroot/index.py (where the import actually
happens), but from mod_python/apache.py in the function import_module.
This function looks pretty weird to me, I tried adding some debug
sentences to follow the execution paths.


However, it turns out that our trouble-module nav.web.state is used as a
fixup handler as well, PythonFixupHandler nav.web.state.

Renaming to /PythonFixupHandler nav.webb.state/ removes the bug, 
/from nav.web import state/  suddenly works again.


So in our case, the problem is related to the module being used both in
handlers and imported by submodules. Appearently the errors from
mod_python.apache.import_module appears only those times the
PythonFixupHandler won't load. 

(debug messages reveal that import_module is NOT called by the normal
import sentence - that's good, as I couldn't understand how it could
have been called at that time :=) )



However, the problem is still unsolved, although the __init__.py-import
is  a working workaround (the symlink magic is NOT! :=) )

Is your problem-module a part of other headers (or imports) as well?


    (our team is also very pissed of by the need to restart apache every
    minute to force reloading of all modules.  It's seems like a 
    boring job to do like in 3.1 - as it still does not assure that
    modules are reloaded only once and in the correct order.

    A simple-but-stupid reload-all-modules-known-to-python fix did NOT
    work, as subclasses in different modules get totally confused being
    subclassed by some class that no longer exist. The problem is
    reloading in the correct order, and only once per request.

    Is there a nice way to UNLOAD all classes?  I'm thinking of
    something like /del sys.modules['mymodule']/ - but.. I'll have to
    check the module to see if it's mine or some internal python module
    first :=) )


-- 
Stian S?iland               Work toward win-win situation. Win-lose
Trondheim, Norway           is where you win and the other lose.
http://www.soiland.no/      Lose-lose and lose-win are left as an
                            exercise to the reader.  [Limoncelli/Hogan]

----- End forwarded message -----

-- 
Stian S?iland               Work toward win-win situation. Win-lose
Trondheim, Norway           is where you win and the other lose.
http://www.soiland.no/      Lose-lose and lose-win are left as an
                            exercise to the reader.  [Limoncelli/Hogan]

From jafo at tummy.com  Tue Jul  8 01:42:00 2003
From: jafo at tummy.com (Sean Reifschneider)
Date: Fri Jan  9 22:04:02 2004
Subject: [mod_python] mod_python weirdness, maybe related to importing?
In-Reply-To: <20030707161949.GB614@itea.ntnu.no>
References: <200306160025.KAA13272@lightning.itga.com.au>
	<20030616005419.GM8892@tummy.com> <20030707161949.GB614@itea.ntnu.no>
Message-ID: <20030708074200.GH1996@tummy.com>

On Mon, Jul 07, 2003 at 06:19:49PM +0200, Stian S?iland wrote:
>Btw, a good tip to store some info from here to there is to store them
>as attributes in the req object. We've created req.session by loading it

Yeah, unfortunately I can't really use that.  My handler calls into
SimpleTAL, and the code that really needs to use the extra data no
longer has access to the request object.

Sean
-- 
 *** Quits: TITANIC (Excess Flood)
Sean Reifschneider, Member of Technical Staff <jafo@tummy.com>
tummy.com, ltd. - Linux Consulting since 1995.  Qmail, Python, SysAdmin
      Back off man. I'm a scientist.   http://HackingSociety.org/
From matt at pollenation.net  Wed Jul  9 17:35:26 2003
From: matt at pollenation.net (Matt Goodall)
Date: Fri Jan  9 22:04:03 2004
Subject: [mod_python] missing path element in path_info
Message-ID: <1057768526.27471.335.camel@localhost>

Hi,

Over in the world of Albatross
(http://www.object-craft.com.au/projects/albatross/) we've been playing
with path_info and have come across something that we don't quite
understand.

Here's some example code to demonstrate:

----- .htaccess -----
DirectoryIndex app.py
SetHandler python-program
PythonHandler app
-----

----- app.py -----
from mod_python import apache
                                                                                def handler(req):
    req.content_type = 'text/plain'
    req.send_http_header()

    req.write('the_request: %s\n' % req.the_request)
    req.write('unparsed_uri: %s\n' % req.unparsed_uri)
    req.write('uri: %s\n' % req.uri)
    req.write('filename: %s\n' % req.filename)
    req.write('path_info: %s\n' % req.path_info)

    return apache.OK
-----

If I put those files in /~matt/test on the web server then this is what
I see for each URL:

        = URL /~matt/test/1/2/3 =
        the_request: GET /~matt/test/app.py/1/2/3 HTTP/1.1
        unparsed_uri: /~matt/test/app.py/1/2/3
        uri: /~matt/test/app.py/1/2/3
        filename: /home/matt/public_html/test/app.py
        path_info: /1/2/3
        
        = /~matt/test/app.py/1/2/3 =
        the_request: GET /~matt/test/app.py/1/2/3 HTTP/1.1
        unparsed_uri: /~matt/test/app.py/1/2/3
        uri: /~matt/test/app.py/1/2/3
        filename: /home/matt/public_html/test/app.py
        path_info: /1/2/3
        
        = /~matt/test/1/2/3 =
        the_request: GET /~matt/test/1/2/3 HTTP/1.1
        unparsed_uri: /~matt/test/1/2/3
        uri: /~matt/test/1/2/3
        filename: /home/matt/public_html/test/1
        path_info: /2/3
        
The first two are as expected but the last one drops app.py completely
and thinks that the first element of path_info is part of the filename.

Can anyone explain this?

Server details:

	Apache 1.3.27
	mod_python 2.7.8
	Linux 2.4.x, Gentoo and Debian (I think).

Thanks in advance.

- Matt

-- 
Matt Goodall, Pollenation Internet Ltd
w: http://www.pollenation.net
e: matt@pollenation.net
From grisha at modpython.org  Wed Jul  9 13:10:30 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:04:03 2004
Subject: [mod_python] missing path element in path_info
In-Reply-To: <1057768526.27471.335.camel@localhost>
References: <1057768526.27471.335.camel@localhost>
Message-ID: <20030709130315.K99051@onyx.ispol.com>


I am not sure I understand the difference between the first two, the
request seems to be the same. What are the url's that you're trying to
access (from the browser point of view)?

In the last one, the reason "1" is not part of path_info: path_info is
something apache figures out. I think the rule is that it sees that "test"
is a directory, and the next thing after it isn't, thus, it must refer to
a file (whether or not the file exists doesn't matter). Everything after a
file is path_info.

On Wed, 9 Jul 2003, Matt Goodall wrote:

> Hi,
>
> Over in the world of Albatross
> (http://www.object-craft.com.au/projects/albatross/) we've been playing
> with path_info and have come across something that we don't quite
> understand.
>
> Here's some example code to demonstrate:
>
> ----- .htaccess -----
> DirectoryIndex app.py
> SetHandler python-program
> PythonHandler app
> -----
>
> ----- app.py -----
> from mod_python import apache
>                                                                                 def handler(req):
>     req.content_type = 'text/plain'
>     req.send_http_header()
>
>     req.write('the_request: %s\n' % req.the_request)
>     req.write('unparsed_uri: %s\n' % req.unparsed_uri)
>     req.write('uri: %s\n' % req.uri)
>     req.write('filename: %s\n' % req.filename)
>     req.write('path_info: %s\n' % req.path_info)
>
>     return apache.OK
> -----
>
> If I put those files in /~matt/test on the web server then this is what
> I see for each URL:
>
>         = URL /~matt/test/1/2/3 =
>         the_request: GET /~matt/test/app.py/1/2/3 HTTP/1.1
>         unparsed_uri: /~matt/test/app.py/1/2/3
>         uri: /~matt/test/app.py/1/2/3
>         filename: /home/matt/public_html/test/app.py
>         path_info: /1/2/3
>
>         = /~matt/test/app.py/1/2/3 =
>         the_request: GET /~matt/test/app.py/1/2/3 HTTP/1.1
>         unparsed_uri: /~matt/test/app.py/1/2/3
>         uri: /~matt/test/app.py/1/2/3
>         filename: /home/matt/public_html/test/app.py
>         path_info: /1/2/3
>
>         = /~matt/test/1/2/3 =
>         the_request: GET /~matt/test/1/2/3 HTTP/1.1
>         unparsed_uri: /~matt/test/1/2/3
>         uri: /~matt/test/1/2/3
>         filename: /home/matt/public_html/test/1
>         path_info: /2/3
>
> The first two are as expected but the last one drops app.py completely
> and thinks that the first element of path_info is part of the filename.
>
> Can anyone explain this?
>
> Server details:
>
> 	Apache 1.3.27
> 	mod_python 2.7.8
> 	Linux 2.4.x, Gentoo and Debian (I think).
>
> Thanks in advance.
>
> - Matt
>
> --
> Matt Goodall, Pollenation Internet Ltd
> w: http://www.pollenation.net
> e: matt@pollenation.net
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From matt at pollenation.net  Wed Jul  9 20:36:12 2003
From: matt at pollenation.net (Matt Goodall)
Date: Fri Jan  9 22:04:03 2004
Subject: [mod_python] missing path element in path_info
In-Reply-To: <20030709130315.K99051@onyx.ispol.com>
References: <1057768526.27471.335.camel@localhost>
	 <20030709130315.K99051@onyx.ispol.com>
Message-ID: <1057779371.28628.484.camel@localhost>

On Wed, 2003-07-09 at 18:10, Gregory (Grisha) Trubetskoy wrote:
> I am not sure I understand the difference between the first two, the
> request seems to be the same. What are the url's that you're trying to
> access (from the browser point of view)?

OK, I'm not having a good day ... I can't even copy and paste correctly
anymore! The example output should have been as follows, where the
browser URL is between the '= =', just above the request attribute list.

  = /~matt/test/ =
  the_request: GET /~matt/test/ HTTP/1.1
  unparsed_uri: /~matt/test/app.py
  uri: /~matt/test/app.py
  filename: /home/matt/public_html/test/app.py
  path_info:

  = /~matt/test/app.py/1/2/3 =
  the_request: GET /~matt/test/app.py/1/2/3 HTTP/1.1
  unparsed_uri: /~matt/test/app.py/1/2/3
  uri: /~matt/test/app.py/1/2/3
  filename: /home/matt/public_html/test/app.py
  path_info: /1/2/3

  = /~matt/test/1/2/3 =
  the_request: GET /~matt/test/1/2/3 HTTP/1.1
  unparsed_uri: /~matt/test/1/2/3
  uri: /~matt/test/1/2/3
  filename: /home/matt/public_html/test/1
  path_info: /2/3

The first example demonstrates that app.py is sometimes part of the
filename even when it is not part of the browser's URL. As I mentioned
before, it is only example 3 that was a surprise.

> 
> In the last one, the reason "1" is not part of path_info: path_info is
> something apache figures out. I think the rule is that it sees that "test"
> is a directory, and the next thing after it isn't, thus, it must refer to
> a file (whether or not the file exists doesn't matter). Everything after a
> file is path_info.

I think this answers the original question anyway.

Is there actually a foolproof way of working out the correct base uri of
the application (i.e. the path, with or without the app.py) from the
information in the request alone? The results I would like are below but
I'm not convinced enough information is available:

  URL                        app base uri         path info
  -------------------------  -------------------  ----------
  /~matt/test/               /~matt/test          /
  /~matt/test/app.py/1/2/3   /~matt/test/app.py   /1/2/3
  /~matt/test/1/2/3          /~matt/test          /1/2/3


Of course, the alternative is for the developer to specify the base uri
in configuration code which is how Albatross currently works.

Thanks, Matt


> 
> On Wed, 9 Jul 2003, Matt Goodall wrote:
> 
> > Hi,
> >
> > Over in the world of Albatross
> > (http://www.object-craft.com.au/projects/albatross/) we've been playing
> > with path_info and have come across something that we don't quite
> > understand.
> >
> > Here's some example code to demonstrate:
> >
> > ----- .htaccess -----
> > DirectoryIndex app.py
> > SetHandler python-program
> > PythonHandler app
> > -----
> >
> > ----- app.py -----
> > from mod_python import apache
> >                                                                                 def handler(req):
> >     req.content_type = 'text/plain'
> >     req.send_http_header()
> >
> >     req.write('the_request: %s\n' % req.the_request)
> >     req.write('unparsed_uri: %s\n' % req.unparsed_uri)
> >     req.write('uri: %s\n' % req.uri)
> >     req.write('filename: %s\n' % req.filename)
> >     req.write('path_info: %s\n' % req.path_info)
> >
> >     return apache.OK
> > -----
> >
> > If I put those files in /~matt/test on the web server then this is what
> > I see for each URL:
> >
> >         = URL /~matt/test/1/2/3 =
> >         the_request: GET /~matt/test/app.py/1/2/3 HTTP/1.1
> >         unparsed_uri: /~matt/test/app.py/1/2/3
> >         uri: /~matt/test/app.py/1/2/3
> >         filename: /home/matt/public_html/test/app.py
> >         path_info: /1/2/3
> >
> >         = /~matt/test/app.py/1/2/3 =
> >         the_request: GET /~matt/test/app.py/1/2/3 HTTP/1.1
> >         unparsed_uri: /~matt/test/app.py/1/2/3
> >         uri: /~matt/test/app.py/1/2/3
> >         filename: /home/matt/public_html/test/app.py
> >         path_info: /1/2/3
> >
> >         = /~matt/test/1/2/3 =
> >         the_request: GET /~matt/test/1/2/3 HTTP/1.1
> >         unparsed_uri: /~matt/test/1/2/3
> >         uri: /~matt/test/1/2/3
> >         filename: /home/matt/public_html/test/1
> >         path_info: /2/3
> >
> > The first two are as expected but the last one drops app.py completely
> > and thinks that the first element of path_info is part of the filename.
> >
> > Can anyone explain this?
> >
> > Server details:
> >
> > 	Apache 1.3.27
> > 	mod_python 2.7.8
> > 	Linux 2.4.x, Gentoo and Debian (I think).
> >
> > Thanks in advance.
> >
> > - Matt
> >
> > --
> > Matt Goodall, Pollenation Internet Ltd
> > w: http://www.pollenation.net
> > e: matt@pollenation.net
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
-- 
Matt Goodall, Pollenation Internet Ltd
w: http://www.pollenation.net
e: matt@pollenation.net
From grisha at modpython.org  Wed Jul  9 16:32:39 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:04:03 2004
Subject: [mod_python] missing path element in path_info
In-Reply-To: <1057779371.28628.484.camel@localhost>
References: <1057768526.27471.335.camel@localhost>
	<20030709130315.K99051@onyx.ispol.com>
	<1057779371.28628.484.camel@localhost>
Message-ID: <20030709160740.D600@onyx.ispol.com>



On Wed, 9 Jul 2003, Matt Goodall wrote:

> Is there actually a foolproof way of working out the correct base uri of
> the application (i.e. the path, with or without the app.py) from the
> information in the request alone? The results I would like are below but
> I'm not convinced enough information is available:
>
>   URL                        app base uri         path info
>   -------------------------  -------------------  ----------
>   /~matt/test/               /~matt/test          /
>   /~matt/test/app.py/1/2/3   /~matt/test/app.py   /1/2/3
>   /~matt/test/1/2/3          /~matt/test          /1/2/3

Hmm... This is a flawed question, since path_info in the last line is
really /2/3.

If you look at http://cgi-spec.golux.com/draft-coar-cgi-v11-03.txt section
6.1.6, it formally defines what path info is. However, it relies on the
notion of a "script", which is always present in CGI, but is meaningless
in mod_python since we're not running scripts but provide phase handlers
for apache...

Anyway, the answer to your question is that it is impossible or very
difficult to do, because the transformation from "~matt/test" to
"/home/matt/public_html/test" is not "reversible" and is hidden somewhere
in apache config, yet this mapping is necessary to produce the results
above.

Grisha
From matt at pollenation.net  Wed Jul  9 22:20:10 2003
From: matt at pollenation.net (Matt Goodall)
Date: Fri Jan  9 22:04:03 2004
Subject: [mod_python] missing path element in path_info
In-Reply-To: <20030709160740.D600@onyx.ispol.com>
References: <1057768526.27471.335.camel@localhost>
	<20030709130315.K99051@onyx.ispol.com>
	<20030709160740.D600@onyx.ispol.com>
Message-ID: <1057785610.27471.509.camel@localhost>

On Wed, 2003-07-09 at 21:32, Gregory (Grisha) Trubetskoy wrote:
> Anyway, the answer to your question is that it is impossible or very
> difficult to do, because the transformation from "~matt/test" to
> "/home/matt/public_html/test" is not "reversible" and is hidden somewhere
> in apache config, yet this mapping is necessary to produce the results
> above.

Thanks Grisha.

That's the conclusion I had come to from dumping anything available in
the request object to a log file, but it was worth checking here too.

Cheers, Matt

-- 
Matt Goodall, Pollenation Internet Ltd
w: http://www.pollenation.net
e: matt@pollenation.net
From jmartinson at info234.com  Thu Jul 10 17:00:03 2003
From: jmartinson at info234.com (Jacob Martinson)
Date: Fri Jan  9 22:04:03 2004
Subject: [mod_python] Problem with win32 installation - can't authenticate
Message-ID: <5.2.1.1.0.20030710135957.00b2f050@localhost>

My problem: after installing apache(win32), python(win32) and 
modpython(win32) the basic test works for returning 'hello world' but when 
i try the authentication example from the documentation, I am not able to 
authenticate.  After a little investigation, I find that both req.user and 
req.get_basic_auth_pw() are None.

I am prompted for username/password, but I can't authenticate 
successfully.  Also, if I ignore req.user and password and just return 
apache.OK, it allows me to access the file I am requesting.

Here's the relevant parts of my apache config:

LoadModule python_module modules/mod_python.so

<Directory "c:\Documents and Settings\jmartinson\docroot">
   AddHandler python-program .py
   PythonHandler mptest
   PythonDebug On
</Directory>

<Directory "c:\Documents and Settings\jmartinson\docroot\test1">
     AddHandler python-program .py
     PythonHandler myscript
     PythonAuthenHandler myscript
     PythonDebug Off
     AuthType Basic
     AuthName "Restricted Area"
     require valid-user
</Directory>

Here's my handler (myscript.py):

from mod_python import apache
def authenhandler(req):
         user = req.user
         pw = req.get_basic_auth_pw()
         req.write( str(user) + ':' + str(pw) + str('\n') )
         return apache.OK

         if user == "spam":
                 return apache.OK
         else:
                 return apache.HTTP_UNAUTHORIZED

I put in the first "return apache.OK" for testing purposes.  If I take that 
out authentication still won't work.  I also took out the second half of 
the if statement testing the password too.

Version info:
apache: 
http://apache.oregonstate.edu/httpd/binaries/win32/apache_2.0.47-win32-x86-no_ssl.msi
modpython: 
http://apache.webmeta.com/httpd/modpython/win/3.0.3/mod_python-3.0.3.win32.exe
python: http://python.org/ftp/python/2.2.3/Python-2.2.3.exe

I would much rather be using modpython under a unix environment, but I am 
doing this on my work laptop and I don't have the option of eliminating the 
Windows environment and I can't get apache to compile under cygwin.

Any information or suggestions are greatly appreciated!

-Jacob 

From grisha at modpython.org  Thu Jul 10 19:50:38 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:04:03 2004
Subject: [mod_python] Problem with win32 installation - can't authenticate
In-Reply-To: <5.2.1.1.0.20030710135957.00b2f050@localhost>
References: <5.2.1.1.0.20030710135957.00b2f050@localhost>
Message-ID: <20030710194534.K53265@onyx.ispol.com>



On Thu, 10 Jul 2003, Jacob Martinson wrote:

> I am prompted for username/password, but I can't authenticate
> successfully.  Also, if I ignore req.user and password and just return
> apache.OK, it allows me to access the file I am requesting.

When you say "can't authenticate" - does the browser come back with the
user/password dialog, or some other thing?

I just tried your example, and it worked for me.... In the old versions of
apache you had to call to call get_basic_auth_pw() before trying to read
value of req.user, but that's not longer true I think. May be tried
swapping those two lines, but I think the problem is elsewhere.

Grisha
From jmartinson at info234.com  Thu Jul 10 18:55:49 2003
From: jmartinson at info234.com (Jacob Martinson)
Date: Fri Jan  9 22:04:03 2004
Subject: [mod_python] Problem with win32 installation - can't
  authenticate
In-Reply-To: <20030710194534.K53265@onyx.ispol.com>
References: <5.2.1.1.0.20030710135957.00b2f050@localhost>
 <5.2.1.1.0.20030710135957.00b2f050@localhost>
Message-ID: <5.2.1.1.0.20030710185116.00b2ecd8@localhost>

Grisha,

The browser comes back with a prompt again a number of times and then 
eventually I end up at the access forbidden page.  The strangest thing just 
happened though... I switched the order of getting the username and 
password, and it started working!  I haven't changed anything in the apache 
config between then and now.

Thanks!

-Jacob

At 07:50 PM 7/10/2003 -0400, Gregory (Grisha) Trubetskoy wrote:


>On Thu, 10 Jul 2003, Jacob Martinson wrote:
>
> > I am prompted for username/password, but I can't authenticate
> > successfully.  Also, if I ignore req.user and password and just return
> > apache.OK, it allows me to access the file I am requesting.
>
>When you say "can't authenticate" - does the browser come back with the
>user/password dialog, or some other thing?
>
>I just tried your example, and it worked for me.... In the old versions of
>apache you had to call to call get_basic_auth_pw() before trying to read
>value of req.user, but that's not longer true I think. May be tried
>swapping those two lines, but I think the problem is elsewhere.
>
>Grisha

From grisha at modpython.org  Thu Jul 10 21:00:37 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:04:03 2004
Subject: [mod_python] Problem with win32 installation - can't
	authenticate
In-Reply-To: <5.2.1.1.0.20030710185116.00b2ecd8@localhost>
References: <5.2.1.1.0.20030710135957.00b2f050@localhost>
	<5.2.1.1.0.20030710185116.00b2ecd8@localhost>
Message-ID: <20030710205649.Y56783@onyx.ispol.com>


Thanks Jacob for the config -

I figured it out - it has to do with the placement of LoadModule in the
config file. I tend to put mine first, which makes mod_auth first in line
to process, and it internally calls get_basic_auth_pw() thereby filling in
the req.user value. But if you place mod_python after mod_auth, then
mod_python is called first, and req->user is NULL (or req.user is None).

I'll make sure this is corrected in the docs for the next release.

Grisha

On Thu, 10 Jul 2003, Jacob Martinson wrote:

> Grisha,
>
> The browser comes back with a prompt again a number of times and then
> eventually I end up at the access forbidden page.  The strangest thing just
> happened though... I switched the order of getting the username and
> password, and it started working!  I haven't changed anything in the apache
> config between then and now.
>
> Thanks!
>
> -Jacob
>
> At 07:50 PM 7/10/2003 -0400, Gregory (Grisha) Trubetskoy wrote:
>
>
> >On Thu, 10 Jul 2003, Jacob Martinson wrote:
> >
> > > I am prompted for username/password, but I can't authenticate
> > > successfully.  Also, if I ignore req.user and password and just return
> > > apache.OK, it allows me to access the file I am requesting.
> >
> >When you say "can't authenticate" - does the browser come back with the
> >user/password dialog, or some other thing?
> >
> >I just tried your example, and it worked for me.... In the old versions of
> >apache you had to call to call get_basic_auth_pw() before trying to read
> >value of req.user, but that's not longer true I think. May be tried
> >swapping those two lines, but I think the problem is elsewhere.
> >
> >Grisha
>
From jmartinson at info234.com  Thu Jul 10 20:02:22 2003
From: jmartinson at info234.com (Jacob Martinson)
Date: Fri Jan  9 22:04:03 2004
Subject: [mod_python] Problem with win32 installation - can't 
  authenticate
In-Reply-To: <20030710205649.Y56783@onyx.ispol.com>
References: <5.2.1.1.0.20030710185116.00b2ecd8@localhost>
 <5.2.1.1.0.20030710135957.00b2f050@localhost>
 <5.2.1.1.0.20030710135957.00b2f050@localhost>
 <5.2.1.1.0.20030710185116.00b2ecd8@localhost>
Message-ID: <5.2.1.1.0.20030710200107.00ba7598@localhost>

Thanks again for the excellent and fast response!!!

At 09:00 PM 7/10/2003 -0400, Gregory (Grisha) Trubetskoy wrote:

>Thanks Jacob for the config -
>
>I figured it out - it has to do with the placement of LoadModule in the
>config file. I tend to put mine first, which makes mod_auth first in line
>to process, and it internally calls get_basic_auth_pw() thereby filling in
>the req.user value. But if you place mod_python after mod_auth, then
>mod_python is called first, and req->user is NULL (or req.user is None).
>
>I'll make sure this is corrected in the docs for the next release.
>
>Grisha
>
>On Thu, 10 Jul 2003, Jacob Martinson wrote:
>
> > Grisha,
> >
> > The browser comes back with a prompt again a number of times and then
> > eventually I end up at the access forbidden page.  The strangest thing just
> > happened though... I switched the order of getting the username and
> > password, and it started working!  I haven't changed anything in the apache
> > config between then and now.
> >
> > Thanks!
> >
> > -Jacob
> >
> > At 07:50 PM 7/10/2003 -0400, Gregory (Grisha) Trubetskoy wrote:
> >
> >
> > >On Thu, 10 Jul 2003, Jacob Martinson wrote:
> > >
> > > > I am prompted for username/password, but I can't authenticate
> > > > successfully.  Also, if I ignore req.user and password and just return
> > > > apache.OK, it allows me to access the file I am requesting.
> > >
> > >When you say "can't authenticate" - does the browser come back with the
> > >user/password dialog, or some other thing?
> > >
> > >I just tried your example, and it worked for me.... In the old versions of
> > >apache you had to call to call get_basic_auth_pw() before trying to read
> > >value of req.user, but that's not longer true I think. May be tried
> > >swapping those two lines, but I think the problem is elsewhere.
> > >
> > >Grisha
> >

From dustin at ywlcs.org  Thu Jul 10 21:31:20 2003
From: dustin at ywlcs.org (Dustin Mitchell)
Date: Fri Jan  9 22:04:03 2004
Subject: [mod_python] Using shared memory to do global persistence
In-Reply-To: <20030710215743.V56783@onyx.ispol.com>
References: <200306250732.15699.jgardner@jonathangardner.net>
	<20030626183642.GB5652@lyra.org> <20030708153302.C69691@onyx.ispol.com>
	<20030710215743.V56783@onyx.ispol.com>
Message-ID: <20030711023119.GI18379@eleanor.internal.ywlcs.org>

On Thu, Jul 10, 2003 at 10:12:26PM -0400, Gregory (Grisha) Trubetskoy wrote:
> 1. Something using or similar to POSH. This would rule, but it's too much
> work. Posh also relies on it having the cotrol over forking(), which won't
> work in our situation (i think).

Wouldn't a child_init hook do the trick?  That would mean, however,
that all shared objects had to be created (in Python) before child
initializations..

Dustin

-- 

  Dustin Mitchell
  dustin@ywlcs.org/djmitche@alumni.uchicago.edu
  http://people.cs.uchicago.edu/~dustin/
From Denis.Walrave at trema.com  Fri Jul 11 19:04:12 2003
From: Denis.Walrave at trema.com (Denis Walrave)
Date: Fri Jan  9 22:04:03 2004
Subject: [mod_python] apache.py typo fix... ?
Message-ID: <2F520D7DB7B17E4E9EC4ADEC448778F4013B7A89@labsex1.corp.trema.com>

$Id: apache.py,v 1.68 2003/02/28 04:55:15 grisha Exp $

 

def restore_nocgi(sav_env, si, so):

    """ see setup_cgi() """

 

    osenv = os.environ

 

    # restore env

    for k in osenv.keys():

        del osenv[k]

    for k in sav_env:

        osenv[k] = env[k] ######## I would suggest 'sav_env[k]'

 

    sys.stdout = si

    sys.stdin = so

 

Denis Walrave

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20030711/2f640737/attachment-0003.htm
From fitnah55 at hotmail.com  Wed Jul 16 11:49:00 2003
From: fitnah55 at hotmail.com (k d)
Date: Fri Jan  9 22:04:03 2004
Subject: [mod_python] 
	apache API and mod_python <-> protocol module integration
Message-ID: <BAY1-F124Z7fIZHO1g400002f0f@hotmail.com>

alright i'm just starting to look into this to see how feasable it is and 
what has to be done

if anyone has any comments on how the mod_python handler can be invoked 
through a protocol module such that the primary codebase of a particular 
application can be reused in multiple gateways, i'd appreciate it

basically what i'm looking at right now is a low level telnet protocol 
module that is reasonably transparent... that can be augmented to support 
full telnet, pop/3, imap, smtp, whatever... but that has sufficient design 
to invoke a mod_python handler, so that the pop/3 could be implemented in 
python, or whatever would be added on top.. (or potentially the pop/3 could 
be added directly to the protocol module)

the basic idea is that apache2 by default accepts http like connections, 
which aren't conducive to the synchronous communication of telnet..  
keep-alive is vaguely similar but not good enough for the purposes of 
allowing a telnet or pop/3 gateway

i've never looked at the apache2 api before so i'm just digging into that 
today

_________________________________________________________________
MSN 8 with e-mail virus protection service: 2 months FREE*  
http://join.msn.com/?page=features/virus

From azaroth at liverpool.ac.uk  Wed Jul 16 17:17:19 2003
From: azaroth at liverpool.ac.uk (Robert Sanderson)
Date: Fri Jan  9 22:04:03 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
 integration
In-Reply-To: <BAY1-F124Z7fIZHO1g400002f0f@hotmail.com>
Message-ID: <Pine.LNX.4.44.0307161709550.2478-100000@gondolin.hist.liv.ac.uk>


> the basic idea is that apache2 by default accepts http like connections, 
> which aren't conducive to the synchronous communication of telnet..  
> keep-alive is vaguely similar but not good enough for the purposes of 
> allowing a telnet or pop/3 gateway

Currently, as I found when implementing Z39.50, it's a real pain as 
there's no way to read in all available data, and if you try to read past 
the end of the available data the read will block.

This makes it useless for something like (say) an IRC or MUD style server 
where there might be data flowing in either direction at any given time.  
Mod_Perl on the other hand has a better system:
http://perl.apache.org/docs/2.0/user/handlers/protocols.html

When I get time, I'm going to look at how to implement this in mod_python, 
but that might not be for a while, so if anyone else wants to weigh in, 
please do so and let me know :)

Rob

-- 
      ,'/:.          Rob Sanderson (azaroth@liverpool.ac.uk)
    ,'-/::::.        http://www.o-r-g.org/~azaroth/
  ,'--/::(@)::.      Special Collections and Archives, extension 3142
,'---/::::::::::.    Nebmedes:  telnet: nebmedes.o-r-g.org 7777
____/:::::::::::::.                WWW:  http://nebmedes.o-r-g.org:8000/
I L L U M I N A T I

From dustin at ywlcs.org  Wed Jul 16 11:33:30 2003
From: dustin at ywlcs.org (Dustin Mitchell)
Date: Fri Jan  9 22:04:03 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
	integration
In-Reply-To: <Pine.LNX.4.44.0307161709550.2478-100000@gondolin.hist.liv.ac.uk>
References: <BAY1-F124Z7fIZHO1g400002f0f@hotmail.com>
	<Pine.LNX.4.44.0307161709550.2478-100000@gondolin.hist.liv.ac.uk>
Message-ID: <20030716163329.GQ18379@eleanor.internal.ywlcs.org>

On Wed, Jul 16, 2003 at 05:17:19PM +0100, Robert Sanderson wrote:
> 
> > the basic idea is that apache2 by default accepts http like connections, 
> > which aren't conducive to the synchronous communication of telnet..  
> > keep-alive is vaguely similar but not good enough for the purposes of 
> > allowing a telnet or pop/3 gateway

There's talk of doing exactly this over on the Apache-dev list (though
doing it in C).  Somebody produced a small DNS server in Apache for a
masters project (netairt -- very cool!) and the apache people had a
short discussion of supporting UDP and telnet-like connections just
like what you describe.  The upshot of this is that right now Apache
really don't support either of these types of connections, even in its
native C.

See the thread beginning:

 Messsage-ID: <Pine.GSO.4.53.0307142254390.25665@flits.cs.vu.nl>
 From: Michal Szymaniak <michal@cs.vu.nl>
 Subject: DNS+HTTP redirection system inside an Apache module

Dustin

-- 

  Dustin Mitchell
  dustin@ywlcs.org/djmitche@alumni.uchicago.edu
  http://people.cs.uchicago.edu/~dustin/
From grisha at modpython.org  Wed Jul 16 13:59:58 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:04:03 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
 integration
In-Reply-To: <Pine.LNX.4.44.0307161709550.2478-100000@gondolin.hist.liv.ac.uk>
References: <Pine.LNX.4.44.0307161709550.2478-100000@gondolin.hist.liv.ac.uk>
Message-ID: <20030716134923.B92465@onyx.ispol.com>



On Wed, 16 Jul 2003, Robert Sanderson wrote:

> > the basic idea is that apache2 by default accepts http like connections,
> > which aren't conducive to the synchronous communication of telnet..

There is an example of a simple echo module here:

http://www.modpython.org/live/current/doc-html/pyapi-conn.html

> > keep-alive is vaguely similar but not good enough for the purposes of
> > allowing a telnet or pop/3 gateway
>
> Currently, as I found when implementing Z39.50, it's a real pain as
> there's no way to read in all available data, and if you try to read past
> the end of the available data the read will block.

This is not a problem of mod_python or Apache, this is the way sockets
work. If your protocol is such that you know ahead of time how much to
read (e.g. HTTP), then you can request this much data in one read.
Otherwise, you must read in smallest unit sizes of your protocol, which
(I'm guessing) is 1 byte in case of Z39.50.

> This makes it useless for something like (say) an IRC or MUD style
> server where there might be data flowing in either direction at any
> given time.  Mod_Perl on the other hand has a better system:
> http://perl.apache.org/docs/2.0/user/handlers/protocols.html

Mod_perl doesn't do it any differently (unless I'm missing something). I
don't think implementing an IRC or MUD server in mod_perl is going to be
any different.

BTW, if using Apache is not a requirement, then doing something like this
might be easier in twisted (twistedmatrix.com).

Grisha
From dustin at ywlcs.org  Wed Jul 16 13:25:15 2003
From: dustin at ywlcs.org (Dustin Mitchell)
Date: Fri Jan  9 22:04:03 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
	integration
In-Reply-To: <20030716134923.B92465@onyx.ispol.com>
References: <Pine.LNX.4.44.0307161709550.2478-100000@gondolin.hist.liv.ac.uk>
	<20030716134923.B92465@onyx.ispol.com>
Message-ID: <20030716182515.GR18379@eleanor.internal.ywlcs.org>

On Wed, Jul 16, 2003 at 01:59:58PM -0400, Gregory (Grisha) Trubetskoy wrote:
> This is not a problem of mod_python or Apache, this is the way sockets
> work. If your protocol is such that you know ahead of time how much to
> read (e.g. HTTP), then you can request this much data in one read.
> Otherwise, you must read in smallest unit sizes of your protocol, which
> (I'm guessing) is 1 byte in case of Z39.50.

This is not strictly true, as long as you're OK with possibly getting a
bit of *extra* data beyond a particular PDU (a little bit of buffering
can take care of that).  Apache has to do this to read the HTTP header,
which is not of a fixed length.

The socket blocking read interface is structured such that it will block
when *no* data is available, and will return *up to* the quantity
specified in the recv() call if it is available.  However, if some
smaller amount of data is available, that data will be returned
immediately.

To demonstrate, I hacked this together:

from socket import *
s = socket(AF_INET, SOCK_STREAM)
s.bind(("", 9900))
s.listen(5)
while 1:
  ss, sa = s.accept()
  print "Connect from '%s'" % (sa,)
  while 1:
    data = ss.recv(100)
    if not data: break
    print " Received: %s" % `data`
  print "Connection closed from '%s'" % (sa,)

Then connected with telnet and typed "Hello" and "World" on separate
lines.  Telnet, by default, buffers lines of input until a newline, but
you will note that in the two returns from ss.recv(), neither contained
100 bytes of data:

Connect from '('127.0.0.1', 56260)'
 Received: 'Hello\r\n'
 Received: 'World\r\n'
Connection closed from '('127.0.0.1', 56260)'

Further, a loop such as:
  for i in 'hello world': s.send(i)
will produce output like this:

Connect from '('127.0.0.1', 56277)'
 Received: 'h'
 Received: 'ello world'
Connection closed from '('127.0.0.1', 56277)'

Either the client or the server's socket implementation is buffering the
characters because they're appearing so quickly, which cuts down on the
number of recv() calls which must be made.

I can't speak for the Apache sockets API, or the Python interface
thereto, but sockets themselves *do* support this interface (they'd be
pretty useless if they didn't!).  I highly recommend W. Richard
Stevens' TCP/IP Illustrated for an in-depth and very readable
discussion of this and many other crucial implementation details of
TCP/IP.

Dustin

-- 

  Dustin Mitchell
  dustin@ywlcs.org/djmitche@alumni.uchicago.edu
  http://people.cs.uchicago.edu/~dustin/
From fitnah55 at hotmail.com  Wed Jul 16 14:56:14 2003
From: fitnah55 at hotmail.com (k d)
Date: Fri Jan  9 22:04:03 2004
Subject: [mod_python] apache API and mod_python <-> protocol module
	integration
Message-ID: <BAY1-F40gNVRIbQlwhL0000bd01@hotmail.com>

>There is an example of a simple echo module here:
>
>http://www.modpython.org/live/current/doc-html/pyapi-conn.html

whoa... i totally forgot modpython had a connection handler

do you think its possible to get it to work with character mode input and 
proper display environment?  like a fully functional telnet not just a hack?

>BTW, if using Apache is not a requirement, then doing something like this
>might be easier in twisted (twistedmatrix.com).

yeh i checked out twisted but it's really heavy on stuff i don't need, plus 
the multiplexing and python persistency is a requirement, so 
apache2/modpython is a definite must have..

as far as implementing the protocol i can probably dupe code in twisted, but 
its not fully functional either so it'd just serve as a rough sketch to help 
with initial design

the only problems i really see that i might have are getting proper ascii 
transmission and getting hotkey capable character input

i'm super stoked that i don't have to deal with an apache2 protocol module 
to do it though! woohoo!

_________________________________________________________________
STOP MORE SPAM with the new MSN 8 and get 2 months FREE*  
http://join.msn.com/?page=features/junkmail

From chris at vindaloo.com  Wed Jul 16 14:58:49 2003
From: chris at vindaloo.com (Christopher Sean Hilton)
Date: Fri Jan  9 22:04:03 2004
Subject: [mod_python] Getting access to a file from a post.
In-Reply-To: <20030716134923.B92465@onyx.ispol.com>
References: <Pine.LNX.4.44.0307161709550.2478-100000@gondolin.hist.liv.ac.uk>
	<20030716134923.B92465@onyx.ispol.com>
Message-ID: <20030716185849.GA1129@dagobah.pvt.vindaloo.com>

-----BEGIN PGP SIGNED MESSAGE-----

I'm trying to generate an xml transaction handler using apache,
modpython, python and sax. I would like to be able to post a file to
this website/handler with something like curl and have modpython
process the file. Something like

     $ cat MyXmlFile.xml | \
     >   curl https://www.example.com/iface.py/XmlHandler

My python looks like this:

     $ cat /var/www/data/www.example.com/iface.py
     #! /usr/local/bin/python2.1
     
     from mod_python import apache

     def XmlHandler(req):
        XmlData = req.readlines()
        ...

This does not get the contens of the file that I posted, in fact it's
empty. Is there any way short of using traditional CGI of getting this
file?

Thanks in advance and if I'm missing something in the manual please
feel free to give me a poke that sets me in the right direction.

Chris

- -- 
Chris Hilton                                 chilton-at-vindaloo-dot-com
- ------------------------------------------------------------------------
                "All I was doing was trying to get home from work!"
                                                 -- Rosa Parks
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.1 (FreeBSD)

iQEVAwUBPxWgWILaxorQlXotAQE23Qf9Ec2xBSXHtX6JN9QSwocetyTrDqBecpto
5lkvq6YlwGF4M5Ei5eUBFjOmAo3OydM83zKMzdzJTgrlOOr6p/JmAxV0YH3qm7QI
+ON/vfoNDxVsPCeQPU/B1dEwkRdjtT2dMda68Ce8dG6go/1McKwUGxIm7/J4Qifs
Bt02IeGLhu+03VIfm03dROn95P3LxqiuTUXbHiQYky9k23ahQjZ8O3XXb+3fyYa4
E44ZG0O9T/H5Xig1rTrbAASao86HNolgnbKR2zNbivtOblgl/p1KSWofkqfRaLRz
JcT0jlSrQB1RvG2rZUz2qy1EPunZ2YUgS1gR+MmTJBmGTxYnIRCzJw==
=tbTY
-----END PGP SIGNATURE-----

From fitnah55 at hotmail.com  Wed Jul 16 17:00:43 2003
From: fitnah55 at hotmail.com (fitnah55)
Date: Fri Jan  9 22:04:03 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
	integration
In-Reply-To: <20030716134923.B92465@onyx.ispol.com>
Message-ID: <004c01c34bdd$521e02e0$24c0c20a@computer>


hey..

how do i get the connectionhandler to work properly under a virtual host
and/or
just for a particular port?

everything is running off of a single IP address through about 5 domains
and 20 virtual hosts..

i need telnet access potentially across all of the hosts

all of this from the single application framework




> -----Original Message-----
> From: Gregory (Grisha) Trubetskoy [mailto:grisha@modpython.org] 
> Sent: Wednesday, July 16, 2003 2:00 PM
> To: Robert Sanderson
> Cc: k d; mod_python@modpython.org
> Subject: Re: [mod_python] apache API and mod_python <-> 
> protocol module integration
> 
> 
> 
> 
> On Wed, 16 Jul 2003, Robert Sanderson wrote:
> 
> > > the basic idea is that apache2 by default accepts http 
> like connections,
> > > which aren't conducive to the synchronous communication 
> of telnet..
> 
> There is an example of a simple echo module here:
> 
http://www.modpython.org/live/current/doc-html/pyapi-conn.html

> > keep-alive is vaguely similar but not good enough for the purposes
of
> > allowing a telnet or pop/3 gateway
>
> Currently, as I found when implementing Z39.50, it's a real pain as
> there's no way to read in all available data, and if you try to read
past
> the end of the available data the read will block.

This is not a problem of mod_python or Apache, this is the way sockets
work. If your protocol is such that you know ahead of time how much to
read (e.g. HTTP), then you can request this much data in one read.
Otherwise, you must read in smallest unit sizes of your protocol, which
(I'm guessing) is 1 byte in case of Z39.50.

> This makes it useless for something like (say) an IRC or MUD style
> server where there might be data flowing in either direction at any
> given time.  Mod_Perl on the other hand has a better system:
> http://perl.apache.org/docs/2.0/user/handlers/protocols.html

Mod_perl doesn't do it any differently (unless I'm missing something). I
don't think implementing an IRC or MUD server in mod_perl is going to be
any different.

BTW, if using Apache is not a requirement, then doing something like
this
might be easier in twisted (twistedmatrix.com).

Grisha
From fitnah55 at hotmail.com  Wed Jul 16 17:09:50 2003
From: fitnah55 at hotmail.com (fitnah55)
Date: Fri Jan  9 22:04:03 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
	integration
In-Reply-To: <20030716134923.B92465@onyx.ispol.com>
Message-ID: <004d01c34bde$98310c40$24c0c20a@computer>


duh.. add the port to listen

heh

coincidentally, i don't think the echo example is working

[Tue Jul 15 13:03:18 2003] [error] python_connection:
ConnectionDispatch() returned nothing.

hmm

From grisha at modpython.org  Wed Jul 16 20:47:22 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:04:03 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
 integration
In-Reply-To: <20030716182515.GR18379@eleanor.internal.ywlcs.org>
References: <Pine.LNX.4.44.0307161709550.2478-100000@gondolin.hist.liv.ac.uk>
	<20030716182515.GR18379@eleanor.internal.ywlcs.org>
Message-ID: <20030716161514.Q95093@onyx.ispol.com>


Well, after some looking, apparently the APR does work this way, it's just
that the way the connection handler was coded probably because I didn't
understand APR well enough at the time I made it loop until specified
length of bytes was read (I started out with replicating req.read(), which
knows how much data there is to read).

I attached a patch to the connobject.c that changes its behaviour so that
read(len) will read at most len bytes, and will only block if no data is
available. And len is an optional argument.

Here is a connection handler code that does the exact same thing you had
below. (note that print writes to stdout, which is visible if you run
httpd with -X (stay in foreground) option:

from mod_python import apache

def connectionhandler(conn):

    print "Connect from '%s'" % `conn.remote_addr`

    while 1:
        data = conn.read()
        if not data: break
        print " Received: %s" % `data`

    print "Connection closed from '%s'" % `conn.remote_addr`

    return apache.OK

And here's the result:

$ ./bin/httpd -X
Connect from '('0.0.0.0', 3513)'
 Received: 'Hello\r\n'
 Received: 'World\r\n'
Connection closed from '('0.0.0.0', 3513)'

If I do 'for i in "Hello World"' thing, I get this:

Connect from '('0.0.0.0', 3524)'
 Received: 'Hello World'
Connection closed from '('0.0.0.0', 3524)'

Grisha

On Wed, 16 Jul 2003, Dustin Mitchell wrote:

> On Wed, Jul 16, 2003 at 01:59:58PM -0400, Gregory (Grisha) Trubetskoy wrote:
> > This is not a problem of mod_python or Apache, this is the way sockets
> > work. If your protocol is such that you know ahead of time how much to
> > read (e.g. HTTP), then you can request this much data in one read.
> > Otherwise, you must read in smallest unit sizes of your protocol, which
> > (I'm guessing) is 1 byte in case of Z39.50.
>
> This is not strictly true, as long as you're OK with possibly getting a
> bit of *extra* data beyond a particular PDU (a little bit of buffering
> can take care of that).  Apache has to do this to read the HTTP header,
> which is not of a fixed length.
>
> The socket blocking read interface is structured such that it will block
> when *no* data is available, and will return *up to* the quantity
> specified in the recv() call if it is available.  However, if some
> smaller amount of data is available, that data will be returned
> immediately.
>
> To demonstrate, I hacked this together:
>
> from socket import *
> s = socket(AF_INET, SOCK_STREAM)
> s.bind(("", 9900))
> s.listen(5)
> while 1:
>   ss, sa = s.accept()
>   print "Connect from '%s'" % (sa,)
>   while 1:
>     data = ss.recv(100)
>     if not data: break
>     print " Received: %s" % `data`
>   print "Connection closed from '%s'" % (sa,)
>
> Then connected with telnet and typed "Hello" and "World" on separate
> lines.  Telnet, by default, buffers lines of input until a newline, but
> you will note that in the two returns from ss.recv(), neither contained
> 100 bytes of data:
>
> Connect from '('127.0.0.1', 56260)'
>  Received: 'Hello\r\n'
>  Received: 'World\r\n'
> Connection closed from '('127.0.0.1', 56260)'
>
> Further, a loop such as:
>   for i in 'hello world': s.send(i)
> will produce output like this:
>
> Connect from '('127.0.0.1', 56277)'
>  Received: 'h'
>  Received: 'ello world'
> Connection closed from '('127.0.0.1', 56277)'
>
> Either the client or the server's socket implementation is buffering the
> characters because they're appearing so quickly, which cuts down on the
> number of recv() calls which must be made.
>
> I can't speak for the Apache sockets API, or the Python interface
> thereto, but sockets themselves *do* support this interface (they'd be
> pretty useless if they didn't!).  I highly recommend W. Richard
> Stevens' TCP/IP Illustrated for an in-depth and very readable
> discussion of this and many other crucial implementation details of
> TCP/IP.
>
> Dustin
>
> --
>
>   Dustin Mitchell
>   dustin@ywlcs.org/djmitche@alumni.uchicago.edu
>   http://people.cs.uchicago.edu/~dustin/
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
-------------- next part --------------
Index: connobject.c
===================================================================
RCS file: /home/cvs/httpd-python/src/connobject.c,v
retrieving revision 1.14
diff -u -r1.14 connobject.c
--- connobject.c	23 Jan 2003 22:34:18 -0000	1.14
+++ connobject.c	17 Jul 2003 00:35:28 -0000
@@ -113,8 +113,10 @@
 
     bb = apr_brigade_create(c->pool, c->bucket_alloc);
 
+    bufsize = len == 0 ? HUGE_STRING_LEN : len;
+
     Py_BEGIN_ALLOW_THREADS;
-    rc = ap_get_brigade(c->input_filters, bb, mode, APR_BLOCK_READ, len);
+    rc = ap_get_brigade(c->input_filters, bb, mode, APR_BLOCK_READ, bufsize);
     Py_END_ALLOW_THREADS;
 
     if (! APR_STATUS_IS_SUCCESS(rc)) {
@@ -135,7 +137,6 @@
         return Py_None;
     }
 
-    bufsize = len == 0 ? HUGE_STRING_LEN : len;
     result = PyString_FromStringAndSize(NULL, bufsize);
 
     /* possibly no more memory */
@@ -180,7 +181,7 @@
 	}
 
 
-        if (mode == AP_MODE_GETLINE) {
+        if (mode == AP_MODE_GETLINE || len == 0) {
             apr_bucket_delete(b);
             break;
         }
@@ -208,11 +209,8 @@
 
     long len = 0;
 
-    if (! PyArg_ParseTuple(args, "l|i", &len)) 
+    if (! PyArg_ParseTuple(args, "|l", &len)) 
         return NULL;
-
-    if (len == 0)
-        return PyString_FromString("");
 
     if (len == -1)
         return _conn_read(self->conn, AP_MODE_EXHAUSTIVE, 0);
From fitnah55 at hotmail.com  Wed Jul 16 21:17:04 2003
From: fitnah55 at hotmail.com (fitnah55)
Date: Fri Jan  9 22:04:03 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
	integration
In-Reply-To: <20030716161514.Q95093@onyx.ispol.com>
Message-ID: <005501c34c01$21dc7480$24c0c20a@computer>


hey i really appreciate it i'll check this out, i think mine is screwed
somehow though, as i can't get it to deal with a connection handler at
all

> I attached a patch to the connobject.c that changes its behaviour so
that
> read(len) will read at most len bytes, and will only block if no data
is
> available. And len is an optional argument.
From fitnah55 at hotmail.com  Wed Jul 16 22:01:36 2003
From: fitnah55 at hotmail.com (fitnah55)
Date: Fri Jan  9 22:04:03 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
	integration
In-Reply-To: <20030716161514.Q95093@onyx.ispol.com>
Message-ID: <005a01c34c07$5a7f4c80$24c0c20a@computer>


alright i just added the patch to my build directory.. and it wouldn't
compile.  OKAY.  what is the freakin point of maintaining an accurate
build archive if the freakin thing gets attacked by gremlins??

okay so i tossed the original build (which without a doubt has not been
changed by any legitimate or accidental work of my own on a machine that
isn't accessable from remote), untarred the same archive, patched,
rebuilt,
no problem... damn gremlins

BUT

i'm still getting the same error with the actual connection test...

any ideas?

[Tue Jul 15 17:56:44 2003] [error] python_connection:
ConnectionDispatch() returned nothing.


> -----Original Message-----
> From: mod_python-bounces@modpython.org 
> [mailto:mod_python-bounces@modpython.org] On Behalf Of 
> Gregory (Grisha) Trubetskoy
> Sent: Wednesday, July 16, 2003 8:47 PM
> To: Dustin Mitchell
> Cc: mod_python@modpython.org
> Subject: Re: [mod_python] apache API and mod_python <-> 
> protocol module integration
> 
> 
> 
> Well, after some looking, apparently the APR does work this 
> way, it's just
> that the way the connection handler was coded probably 
> because I didn't
> understand APR well enough at the time I made it loop until specified
> length of bytes was read (I started out with replicating 
> req.read(), which
> knows how much data there is to read).
> 
> I attached a patch to the connobject.c that changes its 
> behaviour so that
> read(len) will read at most len bytes, and will only block if 
> no data is
> available. And len is an optional argument.
> 
> Here is a connection handler code that does the exact same 
> thing you had
> below. (note that print writes to stdout, which is visible if you run
> httpd with -X (stay in foreground) option:
> 
> from mod_python import apache
> 
> def connectionhandler(conn):
> 
>     print "Connect from '%s'" % `conn.remote_addr`
> 
>     while 1:
>         data = conn.read()
>         if not data: break
>         print " Received: %s" % `data`
> 
>     print "Connection closed from '%s'" % `conn.remote_addr`
> 
>     return apache.OK
> 
> And here's the result:
> 
> $ ./bin/httpd -X
> Connect from '('0.0.0.0', 3513)'
>  Received: 'Hello\r\n'
>  Received: 'World\r\n'
> Connection closed from '('0.0.0.0', 3513)'
> 
> If I do 'for i in "Hello World"' thing, I get this:
> 
> Connect from '('0.0.0.0', 3524)'
>  Received: 'Hello World'
> Connection closed from '('0.0.0.0', 3524)'
> 
> Grisha
> 
> On Wed, 16 Jul 2003, Dustin Mitchell wrote:
> 
> > On Wed, Jul 16, 2003 at 01:59:58PM -0400, Gregory (Grisha) 
> Trubetskoy wrote:
> > > This is not a problem of mod_python or Apache, this is 
> the way sockets
> > > work. If your protocol is such that you know ahead of 
> time how much to
> > > read (e.g. HTTP), then you can request this much data in one read.
> > > Otherwise, you must read in smallest unit sizes of your 
> protocol, which
> > > (I'm guessing) is 1 byte in case of Z39.50.
> >
> > This is not strictly true, as long as you're OK with 
> possibly getting a
> > bit of *extra* data beyond a particular PDU (a little bit 
> of buffering
> > can take care of that).  Apache has to do this to read the 
> HTTP header,
> > which is not of a fixed length.
> >
> > The socket blocking read interface is structured such that 
> it will block
> > when *no* data is available, and will return *up to* the quantity
> > specified in the recv() call if it is available.  However, if some
> > smaller amount of data is available, that data will be returned
> > immediately.
> >
> > To demonstrate, I hacked this together:
> >
> > from socket import *
> > s = socket(AF_INET, SOCK_STREAM)
> > s.bind(("", 9900))
> > s.listen(5)
> > while 1:
> >   ss, sa = s.accept()
> >   print "Connect from '%s'" % (sa,)
> >   while 1:
> >     data = ss.recv(100)
> >     if not data: break
> >     print " Received: %s" % `data`
> >   print "Connection closed from '%s'" % (sa,)
> >
> > Then connected with telnet and typed "Hello" and "World" on separate
> > lines.  Telnet, by default, buffers lines of input until a 
> newline, but
> > you will note that in the two returns from ss.recv(), 
> neither contained
> > 100 bytes of data:
> >
> > Connect from '('127.0.0.1', 56260)'
> >  Received: 'Hello\r\n'
> >  Received: 'World\r\n'
> > Connection closed from '('127.0.0.1', 56260)'
> >
> > Further, a loop such as:
> >   for i in 'hello world': s.send(i)
> > will produce output like this:
> >
> > Connect from '('127.0.0.1', 56277)'
> >  Received: 'h'
> >  Received: 'ello world'
> > Connection closed from '('127.0.0.1', 56277)'
> >
> > Either the client or the server's socket implementation is 
> buffering the
> > characters because they're appearing so quickly, which cuts 
> down on the
> > number of recv() calls which must be made.
> >
> > I can't speak for the Apache sockets API, or the Python interface
> > thereto, but sockets themselves *do* support this interface 
> (they'd be
> > pretty useless if they didn't!).  I highly recommend W. Richard
> > Stevens' TCP/IP Illustrated for an in-depth and very readable
> > discussion of this and many other crucial implementation details of
> > TCP/IP.
> >
> > Dustin
> >
> > --
> >
> >   Dustin Mitchell
> >   dustin@ywlcs.org/djmitche@alumni.uchicago.edu
> >   http://people.cs.uchicago.edu/~dustin/
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
> 
From grisha at modpython.org  Wed Jul 16 23:20:22 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:04:03 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
 integration
In-Reply-To: <004d01c34bde$98310c40$24c0c20a@computer>
References: <004d01c34bde$98310c40$24c0c20a@computer>
Message-ID: <20030716231830.N5431@onyx.ispol.com>


There is some sort of an error in your code, but because of a bug that was
fixed earlier your mod_python doesn't log the error in the log correctly.

Attached is another patch, this time to apache.py, that should log the
error correctly.

Grisha

On Wed, 16 Jul 2003, fitnah55 wrote:

>
> duh.. add the port to listen
>
> heh
>
> coincidentally, i don't think the echo example is working
>
> [Tue Jul 15 13:03:18 2003] [error] python_connection:
> ConnectionDispatch() returned nothing.
>
> hmm
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
-------------- next part --------------
--- apache.py	12 Jul 2003 02:40:45 -0000	1.70
+++ apache.py	16 Jul 2003 20:23:24 -0000	1.71
@@ -54,7 +54,7 @@
  #
  # Originally developed by Gregory Trubetskoy.
  #
- # $Id: apache.py,v 1.70 2003/07/12 02:40:45 grisha Exp $
+ # $Id: apache.py,v 1.71 2003/07/16 20:23:24 grisha Exp $
 
 import sys
 import traceback
@@ -103,7 +103,7 @@
         try:
 
             handler = conn.hlist.handler
-            
+
             # split module::handler
             l = handler.split('::', 1)
             module_name = l[0]
@@ -115,7 +115,7 @@
 
             # add the directory to pythonpath if
             # not there yet, or pythonpath specified
-            
+
             if config.has_key("PythonPath"):
                 # we want to do as little evaling as possible,
                 # so we remember the path in un-evaled form and
@@ -161,7 +161,8 @@
             try:
                 exc_type, exc_value, exc_traceback = sys.exc_info()
                 result = self.ReportError(exc_type, exc_value, exc_traceback, srv=conn.base_server,
-                                          phase=filter.name, hname=handler, debug=debug)
+                                          phase="ConnectionHandler",
+                                          hname=handler, debug=debug)
             finally:
                 exc_traceback = None
 
From chris at vindaloo.com  Wed Jul 16 14:58:49 2003
From: chris at vindaloo.com (Christopher Sean Hilton)
Date: Fri Jan  9 22:04:04 2004
Subject: [mod_python] Getting access to a file from a post.
In-Reply-To: <20030716134923.B92465@onyx.ispol.com>
References: <Pine.LNX.4.44.0307161709550.2478-100000@gondolin.hist.liv.ac.uk>
	<20030716134923.B92465@onyx.ispol.com>
Message-ID: <20030716185849.GA1129@dagobah.pvt.vindaloo.com>

-----BEGIN PGP SIGNED MESSAGE-----

I'm trying to generate an xml transaction handler using apache,
modpython, python and sax. I would like to be able to post a file to
this website/handler with something like curl and have modpython
process the file. Something like

     $ cat MyXmlFile.xml | \
     >   curl https://www.example.com/iface.py/XmlHandler

My python looks like this:

     $ cat /var/www/data/www.example.com/iface.py
     #! /usr/local/bin/python2.1
     
     from mod_python import apache

     def XmlHandler(req):
        XmlData = req.readlines()
        ...

This does not get the contens of the file that I posted, in fact it's
empty. Is there any way short of using traditional CGI of getting this
file?

Thanks in advance and if I'm missing something in the manual please
feel free to give me a poke that sets me in the right direction.

Chris

- -- 
Chris Hilton                                 chilton-at-vindaloo-dot-com
- ------------------------------------------------------------------------
                "All I was doing was trying to get home from work!"
                                                 -- Rosa Parks
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.1 (FreeBSD)

iQEVAwUBPxWgWILaxorQlXotAQE23Qf9Ec2xBSXHtX6JN9QSwocetyTrDqBecpto
5lkvq6YlwGF4M5Ei5eUBFjOmAo3OydM83zKMzdzJTgrlOOr6p/JmAxV0YH3qm7QI
+ON/vfoNDxVsPCeQPU/B1dEwkRdjtT2dMda68Ce8dG6go/1McKwUGxIm7/J4Qifs
Bt02IeGLhu+03VIfm03dROn95P3LxqiuTUXbHiQYky9k23ahQjZ8O3XXb+3fyYa4
E44ZG0O9T/H5Xig1rTrbAASao86HNolgnbKR2zNbivtOblgl/p1KSWofkqfRaLRz
JcT0jlSrQB1RvG2rZUz2qy1EPunZ2YUgS1gR+MmTJBmGTxYnIRCzJw==
=tbTY
-----END PGP SIGNATURE-----

From azaroth at liverpool.ac.uk  Thu Jul 17 11:57:18 2003
From: azaroth at liverpool.ac.uk (Robert Sanderson)
Date: Fri Jan  9 22:04:04 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
 integration
In-Reply-To: <20030716161514.Q95093@onyx.ispol.com>
Message-ID: <Pine.LNX.4.44.0307171155380.6759-100000@gondolin.hist.liv.ac.uk>


> I attached a patch to the connobject.c that changes its behaviour so that
> read(len) will read at most len bytes, and will only block if no data is
> available. And len is an optional argument.

Great stuff, thanks for this Grisha.  It really is useful to us :)

Rob

-- 
      ,'/:.          Rob Sanderson (azaroth@liverpool.ac.uk)
    ,'-/::::.        http://www.o-r-g.org/~azaroth/
  ,'--/::(@)::.      Special Collections and Archives, extension 3142
,'---/::::::::::.    Nebmedes:  telnet: nebmedes.o-r-g.org 7777
____/:::::::::::::.                WWW:  http://nebmedes.o-r-g.org:8000/
I L L U M I N A T I

From chris at vindaloo.com  Thu Jul 17 09:09:54 2003
From: chris at vindaloo.com (Christopher Sean Hilton)
Date: Fri Jan  9 22:04:04 2004
Subject: [mod_python] Getting access to a file from a post.
In-Reply-To: <20030717034737.GZ18379@eleanor.internal.ywlcs.org>
References: <Pine.LNX.4.44.0307161709550.2478-100000@gondolin.hist.liv.ac.uk>
	<20030716134923.B92465@onyx.ispol.com>
	<20030716185849.GA1129@dagobah.pvt.vindaloo.com>
	<20030717034737.GZ18379@eleanor.internal.ywlcs.org>
Message-ID: <20030717130954.GA526@dagobah.pvt.vindaloo.com>

On Wed, Jul 16, 2003 at 10:47:37PM -0500, Dustin Mitchell wrote:

[snip]

> 
> If I'm not mistaken, you're using the publisher handler for this, and
> curl will generate a POST request.  Publisher, by virtue of using
> util.FieldStorage, will try to read that POST data as form data
> (depending on the content-type; it might just throw up a
> NOT_IMPLEMENTED). 
> 
> So the long and short of it is that publisher will gobble your request
> body, because publisher is intended to talk to a web browser, which
> only sends a certain kind of data there (form data).  If you'd like to
> parse some other format of request body, you'll have to forgo publisher
> and do that in a native handler.  That handler could look very much like
> what you've got:
> 
> # note the name 'handler' is mandatory
> def handler(req):
>   XmlData = req.readlines() # are you sure you want a list of lines?
>   ...
> 
> and in your Apache config,
> 
>   PythonHandler iface
> 
> Hope this helps.  Hope I'm right.  Please correct me if I am not.
> 

The assumption that I'm using the Publisher is correct. I will try the
code I have against the native handler this morning and post my
results to the list.

Thanks
 - Chris

-- 
Chris Hilton                                 chilton-at-vindaloo-dot-com
------------------------------------------------------------------------
                "All I was doing was trying to get home from work!"
                                                 -- Rosa Parks
From fitnah55 at hotmail.com  Thu Jul 17 11:30:15 2003
From: fitnah55 at hotmail.com (fitnah55)
Date: Fri Jan  9 22:04:04 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
	integration
In-Reply-To: <20030716231830.N5431@onyx.ispol.com>
Message-ID: <000301c34c78$52215ad0$24c0c20a@computer>


path problem.. couldn't specify that the connection handler was in a
specific
place, so i added a blah.pth file to site-packages pointing to the lib
directory of the host..

i can actually run the virtual host without specifying a documentroot so
i
guess that works out fine

but i'm not so sure canonical name type name based virtual hosts will
work
with this as is though?

i think right now using the virtual host directive is essentially just
giving
it its own error log

i can actually start developing a rudimentary design now though so
that's
pretty cool... it took a lot less effort than i thought when i first
started
looking into it


> -----Original Message-----
> From: Gregory (Grisha) Trubetskoy [mailto:grisha@modpython.org] 
> Sent: Wednesday, July 16, 2003 11:20 PM
> To: fitnah55
> Cc: mod_python@modpython.org
> Subject: RE: [mod_python] apache API and mod_python <-> 
> protocol module integration
> 
> 
> 
> There is some sort of an error in your code, but because of a 
> bug that was
> fixed earlier your mod_python doesn't log the error in the 
> log correctly.
> 
> Attached is another patch, this time to apache.py, that should log the
> error correctly.
> 
> Grisha
> 
> On Wed, 16 Jul 2003, fitnah55 wrote:
> 
> >
> > duh.. add the port to listen
> >
> > heh
> >
> > coincidentally, i don't think the echo example is working
> >
> > [Tue Jul 15 13:03:18 2003] [error] python_connection:
> > ConnectionDispatch() returned nothing.
> >
> > hmm
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
> 
From grisha at modpython.org  Thu Jul 17 11:47:13 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:04:04 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
 integration
In-Reply-To: <000301c34c78$52215ad0$24c0c20a@computer>
References: <000301c34c78$52215ad0$24c0c20a@computer>
Message-ID: <20030717114409.V19822@onyx.ispol.com>



On Thu, 17 Jul 2003, fitnah55 wrote:

> but i'm not so sure canonical name type name based virtual hosts will
> work with this as is though?

Name-based hosts certainly will not work because the name comes from the
Host: header, but we're not at the HTTP level here.

> i think right now using the virtual host directive is essentially just
> giving it its own error log

It's more than that, it will let you associate a connection handler with a
particular ip:port.

> i can actually start developing a rudimentary design now though so
> that's pretty cool... it took a lot less effort than i thought when i
> first started looking into it

That's good to know!

Grisha

>
>
> > -----Original Message-----
> > From: Gregory (Grisha) Trubetskoy [mailto:grisha@modpython.org]
> > Sent: Wednesday, July 16, 2003 11:20 PM
> > To: fitnah55
> > Cc: mod_python@modpython.org
> > Subject: RE: [mod_python] apache API and mod_python <->
> > protocol module integration
> >
> >
> >
> > There is some sort of an error in your code, but because of a
> > bug that was
> > fixed earlier your mod_python doesn't log the error in the
> > log correctly.
> >
> > Attached is another patch, this time to apache.py, that should log the
> > error correctly.
> >
> > Grisha
> >
> > On Wed, 16 Jul 2003, fitnah55 wrote:
> >
> > >
> > > duh.. add the port to listen
> > >
> > > heh
> > >
> > > coincidentally, i don't think the echo example is working
> > >
> > > [Tue Jul 15 13:03:18 2003] [error] python_connection:
> > > ConnectionDispatch() returned nothing.
> > >
> > > hmm
> > >
> > > _______________________________________________
> > > Mod_python mailing list
> > > Mod_python@modpython.org
> > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > >
> >
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From azaroth at liverpool.ac.uk  Thu Jul 17 17:18:45 2003
From: azaroth at liverpool.ac.uk (Robert Sanderson)
Date: Fri Jan  9 22:04:04 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
 integration
In-Reply-To: <000301c34c78$52215ad0$24c0c20a@computer>
Message-ID: <Pine.LNX.4.44.0307171710380.11776-100000@gondolin.hist.liv.ac.uk>


You can check the address it was received on and decline to handle 
anything received on the wrong port. Then it'll fall through to the 
normal handlers.

For example:

def connectionhandler(conn):
  if (conn.local_addr[0] != SERVER_IP or conn.local_addr[1] != SERVER_PORT):
    return apache.DECLINED
  elif (conn.base_server.server_hostname != SERVER_NAME):
    return apache.DECLINED
  else:
    # XXX do everything here

  return apache.OK


Also look at conn.base_server for the server object's other bits and 
pieces.

http://www.modpython.org/live/current/doc-html/pyapi-mpconn-mem.html
http://www.modpython.org/live/current/doc-html/pyapi-mpsrv-mem.html

Rob


On Thu, 17 Jul 2003, fitnah55 wrote:

> 
> path problem.. couldn't specify that the connection handler was in a
> specific
> place, so i added a blah.pth file to site-packages pointing to the lib
> directory of the host..
> 
> i can actually run the virtual host without specifying a documentroot so
> i
> guess that works out fine
> 
> but i'm not so sure canonical name type name based virtual hosts will
> work
> with this as is though?
> 
> i think right now using the virtual host directive is essentially just
> giving
> it its own error log
> 
> i can actually start developing a rudimentary design now though so
> that's
> pretty cool... it took a lot less effort than i thought when i first
> started
> looking into it
> 
> 
> > -----Original Message-----
> > From: Gregory (Grisha) Trubetskoy [mailto:grisha@modpython.org] 
> > Sent: Wednesday, July 16, 2003 11:20 PM
> > To: fitnah55
> > Cc: mod_python@modpython.org
> > Subject: RE: [mod_python] apache API and mod_python <-> 
> > protocol module integration
> > 
> > 
> > 
> > There is some sort of an error in your code, but because of a 
> > bug that was
> > fixed earlier your mod_python doesn't log the error in the 
> > log correctly.
> > 
> > Attached is another patch, this time to apache.py, that should log the
> > error correctly.
> > 
> > Grisha
> > 
> > On Wed, 16 Jul 2003, fitnah55 wrote:
> > 
> > >
> > > duh.. add the port to listen
> > >
> > > heh
> > >
> > > coincidentally, i don't think the echo example is working
> > >
> > > [Tue Jul 15 13:03:18 2003] [error] python_connection:
> > > ConnectionDispatch() returned nothing.
> > >
> > > hmm
> > >
> > > _______________________________________________
> > > Mod_python mailing list
> > > Mod_python@modpython.org
> > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > >
> > 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 

-- 
      ,'/:.          Rob Sanderson (azaroth@liverpool.ac.uk)
    ,'-/::::.        http://www.o-r-g.org/~azaroth/
  ,'--/::(@)::.      Special Collections and Archives, extension 3142
,'---/::::::::::.    Nebmedes:  telnet: nebmedes.o-r-g.org 7777
____/:::::::::::::.                WWW:  http://nebmedes.o-r-g.org:8000/
I L L U M I N A T I

From grisha at modpython.org  Thu Jul 17 13:09:08 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:04:04 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
 integration
In-Reply-To: <Pine.LNX.4.44.0307171710380.11776-100000@gondolin.hist.liv.ac.uk>
References: <Pine.LNX.4.44.0307171710380.11776-100000@gondolin.hist.liv.ac.uk>
Message-ID: <20030717130605.V19963@onyx.ispol.com>


I think this is unnecessary. Something like this in the config will make
your handler listen on 1.1.1.1:8888 only:

Listen 2.2.2.2:80
Listen 1.1.1.1:8888

<VirtualHost 1.1.1.1:8888>

	PythonConnectionHandler blah
	...

</VirtualHost>


On Thu, 17 Jul 2003, Robert Sanderson wrote:

>
> You can check the address it was received on and decline to handle
> anything received on the wrong port. Then it'll fall through to the
> normal handlers.
>
> For example:
>
> def connectionhandler(conn):
>   if (conn.local_addr[0] != SERVER_IP or conn.local_addr[1] != SERVER_PORT):
>     return apache.DECLINED
>   elif (conn.base_server.server_hostname != SERVER_NAME):
>     return apache.DECLINED
>   else:
>     # XXX do everything here
>
>   return apache.OK
>
>
> Also look at conn.base_server for the server object's other bits and
> pieces.
>
> http://www.modpython.org/live/current/doc-html/pyapi-mpconn-mem.html
> http://www.modpython.org/live/current/doc-html/pyapi-mpsrv-mem.html
>
> Rob
>
>
> On Thu, 17 Jul 2003, fitnah55 wrote:
>
> >
> > path problem.. couldn't specify that the connection handler was in a
> > specific
> > place, so i added a blah.pth file to site-packages pointing to the lib
> > directory of the host..
> >
> > i can actually run the virtual host without specifying a documentroot so
> > i
> > guess that works out fine
> >
> > but i'm not so sure canonical name type name based virtual hosts will
> > work
> > with this as is though?
> >
> > i think right now using the virtual host directive is essentially just
> > giving
> > it its own error log
> >
> > i can actually start developing a rudimentary design now though so
> > that's
> > pretty cool... it took a lot less effort than i thought when i first
> > started
> > looking into it
> >
> >
> > > -----Original Message-----
> > > From: Gregory (Grisha) Trubetskoy [mailto:grisha@modpython.org]
> > > Sent: Wednesday, July 16, 2003 11:20 PM
> > > To: fitnah55
> > > Cc: mod_python@modpython.org
> > > Subject: RE: [mod_python] apache API and mod_python <->
> > > protocol module integration
> > >
> > >
> > >
> > > There is some sort of an error in your code, but because of a
> > > bug that was
> > > fixed earlier your mod_python doesn't log the error in the
> > > log correctly.
> > >
> > > Attached is another patch, this time to apache.py, that should log the
> > > error correctly.
> > >
> > > Grisha
> > >
> > > On Wed, 16 Jul 2003, fitnah55 wrote:
> > >
> > > >
> > > > duh.. add the port to listen
> > > >
> > > > heh
> > > >
> > > > coincidentally, i don't think the echo example is working
> > > >
> > > > [Tue Jul 15 13:03:18 2003] [error] python_connection:
> > > > ConnectionDispatch() returned nothing.
> > > >
> > > > hmm
> > > >
> > > > _______________________________________________
> > > > Mod_python mailing list
> > > > Mod_python@modpython.org
> > > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > > >
> > >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
>
> --
>       ,'/:.          Rob Sanderson (azaroth@liverpool.ac.uk)
>     ,'-/::::.        http://www.o-r-g.org/~azaroth/
>   ,'--/::(@)::.      Special Collections and Archives, extension 3142
> ,'---/::::::::::.    Nebmedes:  telnet: nebmedes.o-r-g.org 7777
> ____/:::::::::::::.                WWW:  http://nebmedes.o-r-g.org:8000/
> I L L U M I N A T I
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From fitnah55 at hotmail.com  Thu Jul 17 13:14:53 2003
From: fitnah55 at hotmail.com (fitnah55)
Date: Fri Jan  9 22:04:04 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
	integration
In-Reply-To: <20030717130605.V19963@onyx.ispol.com>
Message-ID: <000a01c34c86$efe09f70$24c0c20a@computer>


doesn't really help if the box only has one IP..  IPv6 isn't a
reality yet, and IPs are extremely expensive

i don't think there's any viable solution without changing the
telnet protocol *erk*


> I think this is unnecessary. Something like this in the 
> config will make
> your handler listen on 1.1.1.1:8888 only:
> 
> Listen 2.2.2.2:80
> Listen 1.1.1.1:8888
> 
> <VirtualHost 1.1.1.1:8888>
> 
> 	PythonConnectionHandler blah
> 	...
> 
> </VirtualHost>
> 
> 
> On Thu, 17 Jul 2003, Robert Sanderson wrote:
> 
> >
> > You can check the address it was received on and decline to handle
> > anything received on the wrong port. Then it'll fall through to the
> > normal handlers.
> >
> > For example:
> >
> > def connectionhandler(conn):
> >   if (conn.local_addr[0] != SERVER_IP or conn.local_addr[1] 
> != SERVER_PORT):
> >     return apache.DECLINED
> >   elif (conn.base_server.server_hostname != SERVER_NAME):
> >     return apache.DECLINED
> >   else:
> >     # XXX do everything here
> >
> >   return apache.OK
> >
> >
> > Also look at conn.base_server for the server object's other bits and
> > pieces.
> >
> > http://www.modpython.org/live/current/doc-html/pyapi-mpconn-mem.html
> > http://www.modpython.org/live/current/doc-html/pyapi-mpsrv-mem.html
> >
> > Rob
> >
> >
> > On Thu, 17 Jul 2003, fitnah55 wrote:
> >
> > >
> > > path problem.. couldn't specify that the connection 
> handler was in a
> > > specific
> > > place, so i added a blah.pth file to site-packages 
> pointing to the lib
> > > directory of the host..
> > >
> > > i can actually run the virtual host without specifying a 
> documentroot so
> > > i
> > > guess that works out fine
> > >
> > > but i'm not so sure canonical name type name based 
> virtual hosts will
> > > work
> > > with this as is though?
> > >
> > > i think right now using the virtual host directive is 
> essentially just
> > > giving
> > > it its own error log
> > >
> > > i can actually start developing a rudimentary design now though so
> > > that's
> > > pretty cool... it took a lot less effort than i thought 
> when i first
> > > started
> > > looking into it
> > >
> > >
From fitnah55 at hotmail.com  Thu Jul 17 21:14:18 2003
From: fitnah55 at hotmail.com (fitnah55)
Date: Fri Jan  9 22:04:04 2004
Subject: [mod_python]  apache API and mod_python <-> protocol module
	integration
In-Reply-To: <20030716161514.Q95093@onyx.ispol.com>
Message-ID: <001101c34cc9$e9901fe0$24c0c20a@computer>


okay i'm still having a little problem with this, since i'm trying to
get telnet into full duplex character mode..

apparently the connection object is buffering the input for a CRLF
and i cant quite isolate where this is actually occuring

i see the GETLINE and GETBYTES stuff but so far i cant follow the
flow so well

im sending IAC+DO+ECHO and IAC+DO+SGA (supress go ahead) which should
get the client into the right mode, but the connection read buffer is
still boggling me, if u have any idea

> Well, after some looking, apparently the APR does work this 
> way, it's just
> that the way the connection handler was coded probably 
> because I didn't
> understand APR well enough at the time I made it loop until specified
> length of bytes was read (I started out with replicating 
> req.read(), which
> knows how much data there is to read).
> 
> I attached a patch to the connobject.c that changes its 
> behaviour so that
> read(len) will read at most len bytes, and will only block if 
> no data is
> available. And len is an optional argument.
> 
From greenbeard400 at yahoo.com  Thu Jul 17 20:54:14 2003
From: greenbeard400 at yahoo.com (Greenbeard)
Date: Fri Jan  9 22:04:04 2004
Subject: [mod_python] Passing Cursor Objects 
Message-ID: <20030718035414.67298.qmail@web21302.mail.yahoo.com>

Is it possible to pass the acutal cursor between
requests? 

I can attach the cursor as a <input>


I am using the publisher handler here...


def x(req):
  <snip>
   cursor = dbconn.cursor()
   


__________________________________
Do you Yahoo!?
SBC Yahoo! DSL - Now only $29.95 per month!
http://sbc.yahoo.com
From greenbeard400 at yahoo.com  Thu Jul 17 21:00:43 2003
From: greenbeard400 at yahoo.com (Greenbeard)
Date: Fri Jan  9 22:04:04 2004
Subject: [mod_python] Passing Cursor Objects 
Message-ID: <20030718040043.26298.qmail@web21310.mail.yahoo.com>

Sorry bout the premature email.  Stupid touchpad on
the laptop here.....

Is it possible to pass the acutal cursor between
requests? 

I can attach the cursor as a value on an <input> tag
and when I submit the form and I print the variable
passed I get the <MySQLdb.cursors.Cursor instance at
0x04AC1038> but if I reference it in future operations
I get "'str' object has no attribute 'execute' "

Based on the documentation I see that I could pass the
connection or I can move the cursor information out of
the cursor and pass it as a string.  But am I missing
something here that would allow me to use the cursor
object?  

I am using the publisher handler if that makes a
difference. 

Thanks! 

__________________________________
Do you Yahoo!?
SBC Yahoo! DSL - Now only $29.95 per month!
http://sbc.yahoo.com
From dustin at ywlcs.org  Thu Jul 17 23:38:45 2003
From: dustin at ywlcs.org (Dustin Mitchell)
Date: Fri Jan  9 22:04:04 2004
Subject: [mod_python] Passing Cursor Objects
In-Reply-To: <20030718040043.26298.qmail@web21310.mail.yahoo.com>
References: <20030718040043.26298.qmail@web21310.mail.yahoo.com>
Message-ID: <20030718043845.GX18379@eleanor.internal.ywlcs.org>

On Thu, Jul 17, 2003 at 09:00:43PM -0700, Greenbeard wrote:
> Sorry bout the premature email.  Stupid touchpad on
> the laptop here.....
> 
> Is it possible to pass the acutal cursor between
> requests? 
> 
> I can attach the cursor as a value on an <input> tag
> and when I submit the form and I print the variable
> passed I get the <MySQLdb.cursors.Cursor instance at
> 0x04AC1038> but if I reference it in future operations
> I get "'str' object has no attribute 'execute' "
> 
> Based on the documentation I see that I could pass the
> connection or I can move the cursor information out of
> the cursor and pass it as a string.  But am I missing
> something here that would allow me to use the cursor
> object?  
> 
> I am using the publisher handler if that makes a
> difference. 

Nope, you can't do it.  Basically all you can send to the client (the
browser) is text.   Most browsers are nice enough to send your text
back unmangled, but they're certainly not capable of anything more
complicated.  A cursor is deeply tied into the current state of the
Python Database API, the MySQL server, and whatnot -- all that state
certainly can't be tied up in a string and recreated for the next
request from the browser.

The text you see (<MySQLdb.cursors.Cursor instance at 0x04AC1038>) is
Python's best effor at turning this cursor into a string.  But all it
says is "I had this object here at this address with all this state in
it".  When the request comes back from the browser (milliseconds,
seconds, days later) that object is dead and gone.  Could be Apache
restarted.  MySQL restarted.  The server started smoking and was
replaced.  That cursor is no longer viable.

While I'm on the subject, another good reason not to send things like
this to your client (the browser) is this: you're not sure you'll get
it back.  If you had a way to "reserve" cursors on the server, such
that a browser could indicate "I was using cursor number 243" (perhaps
with an input tag), what would happen if the browser never send another
request?  That cursor would sit around, using up resources.  A couple
dozen idle cursors, and you'll have a DOS'd server..

So the long and short of it is you'll have to open a new cursor for
each request from the web.  It may help to think about the state of the
cursor that's most important to you: not the connection ID to the MySQL
server or anything like that.  It's probably the row number the user
last viewed, along with the components of the query.  If you put *that*
information into the generated HTML in such a way that the browser will
send it back to you (again, <input> tags are good for this), then
you'll be able to create a cursor in the necessary state by grabbing
any old cursor and executing the appropriate query.

I hope this helps.  I try to err on the side of too much explaination.

Dustin

--

  Dustin Mitchell
  dustin@ywlcs.org/djmitche@alumni.uchicago.edu
  http://people.cs.uchicago.edu/~dustin/
From mike.looijmans at asml.com  Fri Jul 18 07:10:37 2003
From: mike.looijmans at asml.com (Mike Looijmans)
Date: Fri Jan  9 22:04:04 2004
Subject: [mod_python] Passing Cursor Objects
Message-ID: <01c34cea$ec7a4480$926a1e6e@wsasd464>

Good explanation, I'm sure you're erring on the 'too much' side here.

Anyway, MySQL has a quite nice LIMIT command for this purpose. You can not
only get the 'first 10' rows, but you can also make it fetch the last 10 or
from 30-40. So all you need is to keep track of where you were and what the
query was (you could make the page into a form and add <input type=hidden>
tags and prev/next submit buttons. Or you could put the query into the url.

If you have really long queries (URLs are limited to 6kB) consider using
either POST requests or store the query into the database and supply a
'handle' (row ID) instead. Throw away the query after an hour or so...


>So the long and short of it is you'll have to open a new cursor for
>each request from the web.  It may help to think about the state of the
>cursor that's most important to you: not the connection ID to the MySQL
>server or anything like that.  It's probably the row number the user
>last viewed, along with the components of the query.  If you put *that*
>information into the generated HTML in such a way that the browser will
>send it back to you (again, <input> tags are good for this), then
>you'll be able to create a cursor in the necessary state by grabbing
>any old cursor and executing the appropriate query.
>
>I hope this helps.  I try to err on the side of too much explaination.




-- 
The information contained in this communication and any attachments is confidential and may be privileged, and is for the sole use of the intended recipient(s). Any unauthorized review, use, disclosure or distribution is prohibited. If you are not the intended recipient, please notify the sender immediately by replying to this message and destroy all copies of this message and any attachments. ASML is neither liable for the proper and complete transmission of the information contained in this communication, nor for any delay in its receipt.


From davidf at sjsoft.com  Fri Jul 18 09:58:00 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 22:04:04 2004
Subject: [mod_python] Passing Cursor Objects
In-Reply-To: <01c34cea$ec7a4480$926a1e6e@wsasd464>
References: <01c34cea$ec7a4480$926a1e6e@wsasd464>
Message-ID: <3F17A888.9000704@sjsoft.com>

Mike Looijmans wrote:

>Good explanation, I'm sure you're erring on the 'too much' side here.
>
>Anyway, MySQL has a quite nice LIMIT command for this purpose. You can not
>only get the 'first 10' rows, but you can also make it fetch the last 10 or
>from 30-40. So all you need is to keep track of where you were and what the
>query was (you could make the page into a form and add <input type=hidden>
>tags and prev/next submit buttons. Or you could put the query into the url.
>
>If you have really long queries (URLs are limited to 6kB) consider using
>either POST requests or store the query into the database and supply a
>'handle' (row ID) instead. Throw away the query after an hour or so...
>  
>
>>So the long and short of it is you'll have to open a new cursor for
>>each request from the web.  It may help to think about the state of the
>>cursor that's most important to you: not the connection ID to the MySQL
>>server or anything like that.  It's probably the row number the user
>>last viewed, along with the components of the query.  If you put *that*
>>information into the generated HTML in such a way that the browser will
>>send it back to you (again, <input> tags are good for this), then
>>you'll be able to create a cursor in the necessary state by grabbing
>>any old cursor and executing the appropriate query.
>>
>>I hope this helps.  I try to err on the side of too much explaination.
>>    
>>
Or if you did really, even after those explanations, want to store the 
cursor, you could create a unique key for it, save it in a global 
dictionary (but note problems with different threads/processes), get the 
client to remember the key (cookie/hidden field/URL) and retrieve the 
cursor using the key on the next request...
But you probably really don't need to do that.

David


From fitnah55 at hotmail.com  Fri Jul 18 13:43:53 2003
From: fitnah55 at hotmail.com (fitnah55)
Date: Fri Jan  9 22:04:04 2004
Subject: [mod_python]  apache API and mod_python <-> protocol
	moduleintegration
In-Reply-To: <001101c34cc9$e9901fe0$24c0c20a@computer>
Message-ID: <000701c34d54$27753450$24c0c20a@computer>


okay i checked the client side by putting it into forced character
at a time mode, and now i can get the python handler to print to
stdout that its getting the characters a character at a time - but
the 'echo' part is still buffering until a CRLF is detected.. which
when i put the client into forced mode, it only sends CR and not the
LF..

i'm going to look at the conn_object.c code and the apache.py code
again, but i am having difficulty following what all is going on


> okay i'm still having a little problem with this, since i'm trying to
> get telnet into full duplex character mode..
> 
> apparently the connection object is buffering the input for a CRLF
> and i cant quite isolate where this is actually occuring
> 
> i see the GETLINE and GETBYTES stuff but so far i cant follow the
> flow so well
> 
> im sending IAC+DO+ECHO and IAC+DO+SGA (supress go ahead) which should
> get the client into the right mode, but the connection read buffer is
> still boggling me, if u have any idea
> 
From fitnah55 at hotmail.com  Fri Jul 18 13:47:42 2003
From: fitnah55 at hotmail.com (fitnah55)
Date: Fri Jan  9 22:04:04 2004
Subject: [mod_python]  apache API and mod_python <-> protocol
	moduleintegration
Message-ID: <000c01c34d54$b0153f80$24c0c20a@computer>


ahh nevermind, modpython is working as expected

its definitely something with the protocol negotiation... sigh

rfc's on telnet suck


> -----Original Message-----
> From: fitnah55 [mailto:fitnah55@hotmail.com] 
> Sent: Friday, July 18, 2003 1:44 PM
> To: 'mod_python@modpython.org'
> Subject: RE: [mod_python] apache API and mod_python <-> 
> protocol moduleintegration
> 
> 
> 
> okay i checked the client side by putting it into forced character
> at a time mode, and now i can get the python handler to print to
> stdout that its getting the characters a character at a time - but
> the 'echo' part is still buffering until a CRLF is detected.. which
> when i put the client into forced mode, it only sends CR and not the
> LF..
> 
> i'm going to look at the conn_object.c code and the apache.py code
> again, but i am having difficulty following what all is going on
> 
> 
> > okay i'm still having a little problem with this, since i'm 
> trying to
> > get telnet into full duplex character mode..
> > 
> > apparently the connection object is buffering the input for a CRLF
> > and i cant quite isolate where this is actually occuring
> > 
> > i see the GETLINE and GETBYTES stuff but so far i cant follow the
> > flow so well
> > 
> > im sending IAC+DO+ECHO and IAC+DO+SGA (supress go ahead) 
> which should
> > get the client into the right mode, but the connection read 
> buffer is
> > still boggling me, if u have any idea
> > 
> 
From hawkeesk8 at yahoo.com  Sun Jul 20 09:10:39 2003
From: hawkeesk8 at yahoo.com (Kevin Smith)
Date: Fri Jan  9 22:04:04 2004
Subject: [mod_python] Adding user-defined objects to the request
Message-ID: <20030720161039.30358.qmail@web10706.mail.yahoo.com>

Hi,

I have been playing with mod_python for a while now
and would like to add my own non-trivial objects to
the request object.

I know that it is easy to add objects that are
built-in types such as:

session = {'Id':'&YFH%^%231234'}
req.session = session

Then, req.session, will be available to downstream
handlers to process.  But simply adding an object
doesn't appear to work if it is a user-defined type. 
I would like to do something similar to the following:

Class Session():
...

session = Session()
...
req.session = session

And then, later, in a downstream handler use my
defined methods:

req.session.athenticate()

I have searched the mailing list and the web in
general and can't find anything that is sending me in
the right direction nor telling me it is impossible. 
I have looked at pso and jotweb.  pso appears to
accomplish something similar to what I want but it
will take me weeks to unravel the trickery going on! 
I would just use pso but it does not implement an
authentication token the way I need to based on our
security needs.

Can someone help?

Many thanks in advance.

__________________________________
Do you Yahoo!?
SBC Yahoo! DSL - Now only $29.95 per month!
http://sbc.yahoo.com
From stian at soiland.no  Sun Jul 20 18:40:57 2003
From: stian at soiland.no (Stian =?iso-8859-1?Q?S=F8iland?=)
Date: Fri Jan  9 22:04:04 2004
Subject: [mod_python] Adding user-defined objects to the request
In-Reply-To: <20030720161039.30358.qmail@web10706.mail.yahoo.com>
References: <20030720161039.30358.qmail@web10706.mail.yahoo.com>
Message-ID: <20030720164057.GA24916@itea.ntnu.no>

On 2003-07-20 18:10:39, Kevin Smith wrote:

> session = {'Id':'&YFH%^%231234'}
> req.session = session
> 
> Then, req.session, will be available to downstream
> handlers to process.  But simply adding an object
> doesn't appear to work if it is a user-defined type. 
> I would like to do something similar to the following:
> 
> Class Session():
> ...

I can't see why this should not work, we do the same thing, but with a
user defined Session (that basically just store itself to disk on
__del__). Are you sure you don't have a path problem or namespace
problem? What is type(req.session) and repr(req.session) further down in
your pipeline?

-- 
Stian S?iland               Work toward win-win situation. Win-lose
Trondheim, Norway           is where you win and the other lose.
http://www.soiland.no/      Lose-lose and lose-win are left as an
                            exercise to the reader.  [Limoncelli/Hogan]

From gnb at itga.com.au  Mon Jul 21 16:29:11 2003
From: gnb at itga.com.au (Gregory Bond)
Date: Fri Jan  9 22:04:04 2004
Subject: [mod_python] 2.7.8: os.error no longer == OSError
Message-ID: <200307210629.QAA06995@lightning.itga.com.au>

I've got
	Apache/1.3.27 (Unix) mod_python/2.7.8 Python/2.1.1 configured
on Solaris 2.6.

Consider an mptest.py that looks like this:
	from mod_python import apache

	import os

	def handler(req):
		req.send_http_header()
		try:
			os.stat('/tmp/not.existing')
		except os.error:
			req.write("caught os.error")
		except OSError:
			req.write("Caught OSError")
		return apache.OK


This always returns "Caught OSError", never "caught os.error".  This breaks a 
whole lotta stuff, including builtin functions like os.path.exists() which 
use the "os.error" form.

What can I conceivably have done to break this????


From gnb at itga.com.au  Mon Jul 21 17:48:14 2003
From: gnb at itga.com.au (Gregory Bond)
Date: Fri Jan  9 22:04:04 2004
Subject: [mod_python] 2.7.8: import exceptions -> os.error no longer ==
	OSError 
In-Reply-To: Your message of Mon, 21 Jul 2003 16:29:11 +1000.
Message-ID: <200307210748.RAA13476@lightning.itga.com.au>

I've done some more work and it appears that doing
	import exceptions
from inside mod_python buggers things more than somewhat for every mod_python 
script run in that process from then on.

(This was in some old and unconverted python 1.3-era code)

------------
def handler(req):
        req.send_http_header()
        req.write("before import exceptions\n")
        req.write("OSError is %d\n" % id(OSError))
        req.write("os.error is %d\n" % id(os.error))
        import exceptions
        req.write("after import exceptions\n")
        req.write("OSError is %d\n" % id(OSError))
        req.write("os.error is %d\n" % id(os.error))

        return apache.OK

------------
before import exceptions
OSError is 539788
os.error is 539788
after import exceptions
OSError is 1258380
os.error is 539788

----------
But if I run the same code (writing to stdout, rather than a req structure) 
from the command line it works OK:
----
import os, sys
req = sys.stdout

req.write("before import exceptions\n")
req.write("OSError is %d\n" % id(OSError))
req.write("os.error is %d\n" % id(os.error))
import exceptions
req.write("after import exceptions\n")
req.write("OSError is %d\n" % id(OSError))
req.write("os.error is %d\n" % id(os.error))
-----
lightning$ python t.py
before import exceptions
OSError is 900204
os.error is 900204
after import exceptions
OSError is 900204
os.error is 900204


From hawkeesk8 at yahoo.com  Mon Jul 21 03:21:25 2003
From: hawkeesk8 at yahoo.com (Kevin Smith)
Date: Fri Jan  9 22:04:04 2004
Subject: [mod_python] Adding user-defined objects to the request
In-Reply-To: <20030720164057.GA24916@itea.ntnu.no>
Message-ID: <20030721102125.65136.qmail@web10706.mail.yahoo.com>

Actually, I think I may have just found the problem
which brings up another question ...

I was trying to do the addition of the object to the
request in the InitHandler.  I then noticed that I
could not even get a simple type to add to the request
in this phase of the handling.  Is that normal
behaviour?  The earliest that I seemed to be able to
add an object to the request was HeaderParser phase.

Can someone confirm or deny that the HeaderParser is
the earliest (inside a 'Location/Directory' context)
that you can add objects/attributes to the request?

In light of this, and Stian's comment, I shall try to
add my user-defined object at this phase instead.

Thanks
--- Stian Siland <stian@soiland.no> wrote:
> On 2003-07-20 18:10:39, Kevin Smith wrote:
> 
> > session = {'Id':'&YFH%^%231234'}
> > req.session = session
> > 
> > Then, req.session, will be available to downstream
> > handlers to process.  But simply adding an object
> > doesn't appear to work if it is a user-defined
> type. 
> > I would like to do something similar to the
> following:
> > 
> > Class Session():
> > ...
> 
> I can't see why this should not work, we do the same
> thing, but with a
> user defined Session (that basically just store
> itself to disk on
> __del__). Are you sure you don't have a path problem
> or namespace
> problem? What is type(req.session) and
> repr(req.session) further down in
> your pipeline?
> 
> -- 
> Stian Siland               Work toward win-win
> situation. Win-lose
> Trondheim, Norway           is where you win and the
> other lose.
> http://www.soiland.no/      Lose-lose and lose-win
> are left as an
>                             exercise to the reader. 
[Limoncelli/Hogan]


__________________________________
Do you Yahoo!?
SBC Yahoo! DSL - Now only $29.95 per month!
http://sbc.yahoo.com
From grisha at modpython.org  Mon Jul 21 10:47:15 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:04:04 2004
Subject: [mod_python] 2.7.8: os.error no longer == OSError
In-Reply-To: <200307210629.QAA06995@lightning.itga.com.au>
References: <200307210629.QAA06995@lightning.itga.com.au>
Message-ID: <20030721104016.I97244@onyx.ispol.com>



On Mon, 21 Jul 2003, Gregory Bond wrote:

> I've got
> 	Apache/1.3.27 (Unix) mod_python/2.7.8 Python/2.1.1 configured

[snip]

I think it's the same problem as the one causing this:
http://www.modpython.org/FAQ/faqw.py?req=all#5.4

Try upgrading to Python 2.2.3, I'm almost certain it will fix this.

(I'd upgrade to Apache 2.0.x and mod_python 3.0.3 too if that's an option)

Grisha
From sabu at pure-elite.org  Wed Jul 23 03:38:02 2003
From: sabu at pure-elite.org (Xavier)
Date: Fri Jan  9 22:04:04 2004
Subject: [mod_python] Errors off of a fresh install.
Message-ID: <33780.24.199.120.198.1058967482.squirrel@mail.darkscape.net>

Greetings,

I went ahead and installed the mod_python-3.0.3 dist with a fresh
installation of python 2.2, apache 2.0.47, and php4*.  I followed all of
the compile/installation instructions and went ahead with the testing.

While testing the generic (with fine indentation) mptest.py code -- I ran
into the "Internal error"/500 from apache.  Here is why it won't execute:

[Wed Jul 23 09:13:28 2003] [error] make_obcallback: could not import
mod_python.apache.

ImportError: No module named mod_python.apache

I then opened up python and tried to import "mod_python.apache" only to
get this in return:

Traceback (most recent call last):
  File "<stdin>", line 1, in ?
  File "/usr/lib/python2.2/site-packages/mod_python/apache.py", line 67, in ?
    import _apache
ImportError: No module named _apache

Has anyone else ran into this same fault? anyoneh ave any solutions? I'd
like to get mod_python_+Roadkill working and hopefully this is a fixable
problem.

Thanks,
-- Xavier.

From gnb at itga.com.au  Thu Jul 24 09:41:51 2003
From: gnb at itga.com.au (Gregory Bond)
Date: Fri Jan  9 22:04:04 2004
Subject: [mod_python] Errors off of a fresh install. 
In-Reply-To: Your message of Wed, 23 Jul 2003 03:38:02 -1000.
Message-ID: <200307232341.JAA02393@lightning.itga.com.au>

> [Wed Jul 23 09:13:28 2003] [error] make_obcallback: could not import
> mod_python.apache.
> ImportError: No module named mod_python.apache

See the very first question in the FAQ :
	http://www.modpython.org/FAQ/faqw.py?req=show&file=faq02.001.htp

> I then opened up python and tried to import "mod_python.apache" only to
> get this in return:
> ImportError: No module named _apache

Also in the FAQ:
	http://www.modpython.org/FAQ/faqw.py?req=show&file=faq02.002.htp

From hawkeesk8 at yahoo.com  Thu Jul 24 08:46:53 2003
From: hawkeesk8 at yahoo.com (Kevin Smith)
Date: Fri Jan  9 22:04:04 2004
Subject: [mod_python] apxs:Error: Command failed with rc=65536
Message-ID: <20030724154653.51378.qmail@web10704.mail.yahoo.com>

Hi,

I am getting the infamous "apxs:Error: Command failed
with rc=65536" error when trying to compile mod_python
3.0.3 against Apache 2.0.40 on RH9.

I have seen this error mentioned before on this list
and under each circumstance the reply was that the
version of python is too old.

However, I am running a compiled from source, Python
2.3c1 and the 'out-of-the-box' apache 2.0.40 (both
httpd and httpd-devel) that comes with RH9.

I issue ./configure --with-apxs=/usr/sbin/apxs
--with-python=/usr/local/bin/python
and then when I do the make I get the following (only
the last number of lines have been  included because I
don't think there were problems previous to this):

requestobject.c: In function `getreq_recmbr_off':
requestobject.c:1055: `LONG_LONG' undeclared (first
use in this function)
requestobject.c:1055: (Each undeclared identifier is
reported only once
requestobject.c:1055: for each function it appears
in.)
requestobject.c:1056: parse error before "l"
requestobject.c:1057: `l' undeclared (first use in
this function)
requestobject.c: At top level:
requestobject.c:1270: warning: initialization from
incompatible pointer type
apxs:Error: Command failed with rc=65536
.
make[1]: *** [mod_python.so] Error 1
make[1]: Leaving directory
`/usr/local/mod_python-3.0.3/src'
make: *** [do_dso] Error 2

I'm stumped.

Cheers


__________________________________
Do you Yahoo!?
Yahoo! SiteBuilder - Free, easy-to-use web site design software
http://sitebuilder.yahoo.com
From eu5698 at hotmail.com  Fri Jul 25 15:25:46 2003
From: eu5698 at hotmail.com (Rui Santos)
Date: Fri Jan  9 22:04:04 2004
Subject: [mod_python] problem to install mod_python
Message-ID: <LAW15-DAV73ur2iz2Mb00004329@hotmail.com>

hello.

i have been follow this steps: 

http://www.modpython.org/live/mod_python-2.7.8/doc-html/app-wininst.html

but when i test the apache then give me one error:

Invalid command 'PythonHandler'.

i use: 
a.. Python 2.2.3
a.. Apache 1.3.28 .



with the best compliments 
Rui Santos 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20030725/e5177210/attachment-0003.htm
From tnienstedt at telesyn.com  Sat Jul 26 09:30:54 2003
From: tnienstedt at telesyn.com (Ted Nienstedt)
Date: Fri Jan  9 22:04:04 2004
Subject: [mod_python] qdemo/publish_error not working for IE with mod_python
Message-ID: <000201c3537a$23974ea0$2e1210ac@telesyn.corp>

I installed Quixote on Linux RedHat 9 and installed the qdemo as
described in
http://www.mems-exchange.org/software/quixote/doc/web-server.html,
and also doc/demo.txt .  Everything worked fine with the cgi-bin in the
URL.  I've since switched to mod_python and added the <LocationMatch>
directive to httpd.conf.
Once I made the switch to mod_python I encountered a couple of apparent
"bugs" in quixote's http_request.py which I fixed by passing an empty
string instead of None in the 2nd arg of environ.get().  After making
this fix everything works with mod_python, but qdemo/publish_error from
IE returns the standard IE 400 Bad Request.
It works fine with mod_python from Opera or from the local lunix machine
with Mozilla.
Any clues or suggestions?
Thanks,
Ted
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20030726/321fcafc/attachment-0003.htm
From indrek at inversion.ee  Wed Jul 30 11:33:51 2003
From: indrek at inversion.ee (Indrek =?ISO-8859-1?Q?J=E4rve?=)
Date: Fri Jan  9 22:04:04 2004
Subject: [mod_python] A few questions about requestobject.c
Message-ID: <1059554030.13258.71.camel@hercules.dustbite.org>

Hi,

I've been messing around in requestobject.c for a few hours and started
wondering about the way a few things work. Since I'm not sure whether
they are design decisions, apache related stuff or just weird things, I
thought I'd ask the list :)

1. The use of apr_palloc

Multipart POST forms are parsed in util.py/FieldStorage using req's
req_readline function, which happily apr_palloc'ates enough memory to
read the remaining request data into memory, but never seems to free it
(nasty if the users have a habit of uploading 100+MB files, especially
once multiplied with the number of apache processes). Since the pool
used is attached to the apache request, I'm not sure I should freely
apr_pool_clear() or apr_pool_destroy() it either.

I managed to release memory by replacing apr_palloc with malloc and
adding a few free()s where required, but is this the right approach?

2. The use of PyString_FromStringAndSize()

Again in the req_readline() function, the result variable is initialized
at the size of the full remaining request data. Could the result
variable initialization perhaps be moved a bit further down to

a) when checking if rbuff from previous reads has a '\n' in it (perhaps
check with strchr and then initialize if needed) and 
b) after reading data from request and before copying it to the result.

At both these places it should be more obvious how much memory needs to
be allocated.


If I managed to make no sense at all and got something mixed up, please
let me know. However, I feel that at least the first point could use
some attention, as it creates a problem when uploading big files through
mod_python enabled scripts.

Regards,
Indrek

From grisha at modpython.org  Wed Jul 30 09:05:53 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:04:04 2004
Subject: [mod_python] A few questions about requestobject.c
In-Reply-To: <1059554030.13258.71.camel@hercules.dustbite.org>
References: <1059554030.13258.71.camel@hercules.dustbite.org>
Message-ID: <20030730085411.W86294@onyx.ispol.com>



On Wed, 30 Jul 2003, Indrek [ISO-8859-1] J?rve wrote:
>
> I've been messing around in requestobject.c for a few hours and started
> wondering about the way a few things work. Since I'm not sure whether
> they are design decisions, apache related stuff or just weird things, I
> thought I'd ask the list :)

It's been so long we lost track of which of the three they are :-) (BTW, a
better list for this sort of thing is python-dev@httpd.apache.org).

> 1. The use of apr_palloc
>
> Multipart POST forms are parsed in util.py/FieldStorage using req's
> req_readline function, which happily apr_palloc'ates enough memory to
> read the remaining request data into memory, but never seems to free it
> (nasty if the users have a habit of uploading 100+MB files, especially
> once multiplied with the number of apache processes). Since the pool
> used is attached to the apache request, I'm not sure I should freely
> apr_pool_clear() or apr_pool_destroy() it either.
>
> I managed to release memory by replacing apr_palloc with malloc and
> adding a few free()s where required, but is this the right approach?

Yes, this would definitely be a problem because that memory isn't freed
until the end of the request... We could either create a separate pool,
which then can be apr_pool_cleared(), or just use malloc like you have...
I'll see if I can take a look at it later today. If you have a patch you
could send in, that'd be nice.

>
> 2. The use of PyString_FromStringAndSize()
>
> Again in the req_readline() function, the result variable is initialized
> at the size of the full remaining request data.

This would be a problem with 100M files too... Another thing that occured
to me is that it could be better to rewrite the request read() functions
to use the buckets interface, this way none of this would be an issue.

Grisha
