From eric.engle at mac.com  Sat Mar  1 05:27:59 2014
From: eric.engle at mac.com (Eric Engle)
Date: Sat, 01 Mar 2014 00:27:59 -0500
Subject: [mod_python] Issue in configure for mod_python 3.5.0
Message-ID: <E6B50C78-E9F9-4AE7-9F6C-B60E9331BF7E@mac.com>

To all mod_python users,

It seems that there is a dependency on git for the mod_python install to work correctly.  In the install package, in dist/, there is a shell script version.sh.  In the script, a git --always command is issued.  See below:

#!/bin/sh

MPV_PATH="`dirname $0`/../src/include/mp_version.h"

MAJ=`awk '/MP_VERSION_MAJOR/ {print $3}' $MPV_PATH`
MIN=`awk '/MP_VERSION_MINOR/ {print $3}' $MPV_PATH`
PCH=`awk '/MP_VERSION_PATCH/ {print $3}' $MPV_PATH`
GIT=`git describe --always`

echo $MAJ.$MIN.$PCH-$GIT

If git is not installed on your system (maybe it should, but current install docs do not state it is a dependency), then version.sh will inserted junk into a variable version in version.py that is generated as a result of make.

A check in the script for git would be very helpful down the road.

#!/bin/sh

MPV_PATH="`dirname $0`/../src/include/mp_version.h"

MAJ=`awk '/MP_VERSION_MAJOR/ {print $3}' $MPV_PATH`
MIN=`awk '/MP_VERSION_MINOR/ {print $3}' $MPV_PATH`
PCH=`awk '/MP_VERSION_PATCH/ {print $3}' $MPV_PATH`
GIT=`git describe --always`

if git ?version &>/dev/null; then
   echo $MAJ.$MIN.$PCH-$GIT
else
   echo $MAJ.$MIN.$PCH
fi

Once I corrected the version number string in version.py, mod_python is working as expected.

Thanks,
Eric


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://mailman.modpython.org/pipermail/mod_python/attachments/20140301/6bb0e834/attachment.html>

From grisha at ispol.com  Sat Mar  1 17:58:57 2014
From: grisha at ispol.com (Grisha Trubetskoy)
Date: Sat, 1 Mar 2014 12:58:57 -0500
Subject: [mod_python] Issue in configure for mod_python 3.5.0
In-Reply-To: <E6B50C78-E9F9-4AE7-9F6C-B60E9331BF7E@mac.com>
References: <E6B50C78-E9F9-4AE7-9F6C-B60E9331BF7E@mac.com>
Message-ID: <CAHb_sysbw8421VzUp4zhgJwu4HEXB=yHHcUdbYuv-YxzO5PvJw@mail.gmail.com>

Eric

This will be resolved in the next version, here is the git issue:
https://github.com/grisha/mod_python/issues/20

Regards,

Grisha

On Sat, Mar 1, 2014 at 12:27 AM, Eric Engle <eric.engle at mac.com> wrote:
> To all mod_python users,
>
> It seems that there is a dependency on git for the mod_python install to
> work correctly.  In the install package, in dist/, there is a shell script
> version.sh.  In the script, a git --always command is issued.  See below:
>
> #!/bin/sh
>
> MPV_PATH="`dirname $0`/../src/include/mp_version.h"
>
> MAJ=`awk '/MP_VERSION_MAJOR/ {print $3}' $MPV_PATH`
> MIN=`awk '/MP_VERSION_MINOR/ {print $3}' $MPV_PATH`
> PCH=`awk '/MP_VERSION_PATCH/ {print $3}' $MPV_PATH`
> GIT=`git describe --always`
>
> echo $MAJ.$MIN.$PCH-$GIT
>
> If git is not installed on your system (maybe it should, but current install
> docs do not state it is a dependency), then version.sh will inserted junk
> into a variable version in version.py that is generated as a result of make.
>
> A check in the script for git would be very helpful down the road.
>
> #!/bin/sh
>
> MPV_PATH="`dirname $0`/../src/include/mp_version.h"
>
> MAJ=`awk '/MP_VERSION_MAJOR/ {print $3}' $MPV_PATH`
> MIN=`awk '/MP_VERSION_MINOR/ {print $3}' $MPV_PATH`
> PCH=`awk '/MP_VERSION_PATCH/ {print $3}' $MPV_PATH`
> GIT=`git describe --always`
>
> if git --version &>/dev/null; then
>    echo $MAJ.$MIN.$PCH-$GIT
> else
>    echo $MAJ.$MIN.$PCH
> fi
>
> Once I corrected the version number string in version.py, mod_python is
> working as expected.
>
> Thanks,
> Eric
>
>
>
> _______________________________________________
> mod_python mailing list
> mod_python at modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>

