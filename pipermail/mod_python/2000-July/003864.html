<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] [ANN] slashbox - class to get/display slashdot.org news stories
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20%5BANN%5D%20slashbox%20-%20class%20to%20get/display%20slashdot.org%20news%20stories&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003862.html">
   <LINK REL="Next"  HREF="003863.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] [ANN] slashbox - class to get/display slashdot.org news stories</H1>
    <B>richard offer</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20%5BANN%5D%20slashbox%20-%20class%20to%20get/display%20slashdot.org%20news%20stories&In-Reply-To="
       TITLE="[mod_python] [ANN] slashbox - class to get/display slashdot.org news stories">richard at whitequeen.com
       </A><BR>
    <I>Thu Jul  6 21:13:04 EST 2000</I>
    <P><UL>
        <LI>Previous message: <A HREF="003862.html">[mod_python] httplib: [notice] child pid 8937 exit signal
 Segmentation fault (11)
</A></li>
        <LI>Next message: <A HREF="003863.html">[mod_python] Compiling on a Debian Potato with Apache binary (and apache-dev)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3864">[ date ]</a>
              <a href="thread.html#3864">[ thread ]</a>
              <a href="subject.html#3864">[ subject ]</a>
              <a href="author.html#3864">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<table border=0 width="100%"><tr><td>
<!--beginarticle-->
<PRE>Hi,

Here's a quick hack of a class to get and format news stories from a
number of sites.

It was designed with mod_python in mind, so all you need to do is

import slashbox
...

def handler(req):
	...
    req.write(str(slashbox.Slashdot()))

To add the latest stories from slashdot to your page.

A number of other sites are included, its easy to add new ones simply
by sub-classing slashbox. The trick is to find the sites .rss/.rdf file.


You'll need the latest PyXML code.



richard.




# $Id: slashbox.py,v 1.2 2000/07/08 21:34:46 richard Exp $
# Copyright (c) 2000 Richard Offer &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">richard at whitequeen.com</A>&gt;. 
# All rights reserved.
#
# Permission is hereby granted, free of charge, to any person obtaining a copy
# of this software and associated documentation files (the &quot;Software&quot;), to deal
# in the Software without restriction, including without limitation the rights
# to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
# copies of the Software, and to permit persons to whom the Software is
# furnished to do so, subject to the following conditions:
# 
# The above copyright notice and this permission notice shall be included in
# all copies or substantial portions of the Software.
# 
# THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL 
# Richard Offer BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN
# AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
# CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
# 
# Except as contained in this notice, the name of Richard Offer shall not be
# used in advertising or otherwise to promote the sale, use or other dealings
# in this Software without prior written authorization from Richard Offer.



#
#
# A python class to grab the Slashdot (and other sites using RSS/RDF) stories.


import stat
import xmllib
import urllib
import urlparse
import os
import time
import string
import sys
from xml.sax import saxlib,saxexts

class _myrdf(saxlib.HandlerBase):
	def __init__(self):
		self._in={}
		self._in[&quot;title&quot;]=0
		self._in[&quot;link&quot;]=0
		self._in[&quot;description&quot;]=0
		self._txt={}
		self._txt[&quot;title&quot;]=&quot;&quot;
		self._txt[&quot;link&quot;]=&quot;&quot;
		self._txt[&quot;description&quot;]=&quot;&quot;

		self._stories=[]


	def startElement(self,ele,attr):
		if ele == 'item' :
			self._txt={}
			self._txt[&quot;title&quot;]=&quot;&quot;
			self._txt[&quot;link&quot;]=&quot;&quot;
			self._txt[&quot;description&quot;]=&quot;&quot;
		elif self._in.has_key(ele) :
			self._in[ele]=1
			
		else:
			pass

	def endElement(self,ele):
		if self._in.has_key(ele) :
			self._in[ele] = 0
			self._txt[ele] = string.join(string.split((self._txt[ele])))
		elif ele == 'item'  :
			self._stories.append(self._txt)

			
	
	def characters(self,ch,start,length):
		for i in self._in.keys():
				if self._in[i] == 1:
					self._txt[i] = self._txt[i] + ch[start:start+length]

	def stories(self):
		return self._stories

# class Site()

class slashbox:
	&quot;&quot;&quot;
Create a single slashbox.
  slashbox(url,freq)
		url is the url of the RSS/RDF file, freq is the update period (mins).
		The freq cannot be less than 30
  raw() 
		returns a list of stories (each story is stored in a dict).
  __str__() 
		returns a HTML table containing the stories.

Several subclasses are available, these already have the url defined,
so to get the headlines from slashdot.org simply do


&gt;&gt;&gt;<i> print Slashdot()
</I>
The list of built-in sites is 

	Slashdot()
	Freshmeat()
	SecurityFocus()
	Parnassus()
	LWN()
	Fool()
	LinuxNetNews()
	SourceForgeReleases()
	SourceForgeNews()


If you are using mod_python, you can embed a slashbox simply by

import slashbox
...

	req.write(str(slashbox.Slashdot()))


&quot;&quot;&quot;
	def __init__(self, url='<A HREF="http://slashdot.org/slashdot.rdf',">http://slashdot.org/slashdot.rdf',</A> freq=60):
		self._url=url
		if freq &lt; 30:
			freq=30
		self._freq=freq
		_u=urlparse.urlparse(self._url)
		self._file=_u[1] + &quot;-&quot; + os.path.basename(url)
		if self._file == '':
			self._file = os.path.basename(url)

		self._file = &quot;/tmp/slashbox-&quot; + self._file

		self.site= _u[0]+ &quot;://&quot; + _u[1] + &quot;/&quot;
		self.name= _u[1]
		
		try:
			st=os.stat(self._file)
			if st[8] &lt; ( time.time() - (self._freq*60) ):
				(fname,headers)=urllib.urlretrieve(self._url, self._file)	
		except OSError:
			(fname,headers)=urllib.urlretrieve(self._url,self._file)	

		fp=open(self._file)

		xmlp=saxexts.make_parser()

		self.dh=_myrdf()
		xmlp.setDocumentHandler(self.dh)
		xmlp.parseFile(fp)

	def stories(self):
		return self.dh.stories()
		

	def __str__(self):
		str=&quot;&lt;SMALL&gt;\n&lt;TABLE BORDER=2 WIDTH=200&gt;\n&quot;
		str=str + '&lt;TH&gt;&lt;A HREF=&quot;%s&quot;&gt;%s&lt;/A&gt;&lt;/TH&gt;\n' % ( self.site,
				self.name )
		str=str + &quot;&lt;TR&gt;&lt;TD&gt;\n  &lt;TABLE&gt;&lt;TBODY&gt;\n&quot; 

		for i in self.dh.stories():
			str=str + '    &lt;TR&gt;&lt;TD&gt;&lt;A HREF=&quot;%s&quot;&gt;%s&lt;/A&gt;' % ( i['link'],i['title'] )
			if i.has_key(&quot;description&quot;):
				str=str + &quot;&lt;BR&gt;&lt;SMALL&gt;%s&lt;/SMALL&gt;&quot; % ( i['description'])
			str=str + '&lt;/TD&gt;&lt;/TR&gt;\n' 
		str=str+&quot;  &lt;/TBODY&gt;&lt;/TABLE&gt;&lt;/TD&gt;&lt;/TR&gt;\n&lt;/TABLE&gt;&lt;/SMALL&gt;\n\n&quot;
		return str
		
	def setName(self,name):
		self.name=name



class Slashdot(slashbox):
	&quot;&quot;&quot;slashbox sub-class for Slashdot.org&quot;&quot;&quot;
	def __init__(self):
		_url='<A HREF="http://slashdot.org/slashdot.rdf'">http://slashdot.org/slashdot.rdf'</A>
		slashbox.__init__(self,url=_url)
		self.setName('Slashdot')

class Freshmeat(slashbox):
	&quot;&quot;&quot;slashbox sub-class for Freshmeat.net&quot;&quot;&quot;
	def __init__(self):
		_url='<A HREF="http://freshmeat.net/backend/fm.rdf'">http://freshmeat.net/backend/fm.rdf'</A>
		slashbox.__init__(self,url=_url)
		self.setName('Freshmeat')

class SecurityFocus(slashbox):
	&quot;&quot;&quot;slashbox sub-class for SecurityFocus.com&quot;&quot;&quot;
	def __init__(self):
		_url='<A HREF="http://www.securityfocus.com/topnews-rss.html'">http://www.securityfocus.com/topnews-rss.html'</A>
		slashbox.__init__(self,url=_url)
		self.setName('Security Focus')

class Parnassus(slashbox):
	&quot;&quot;&quot;slashbox sub-class for the Vaults of Parnassus&quot;&quot;&quot;
	def __init__(self):
		_url='<A HREF="http://www.vex.net/parnassus/parnassus.rss'">http://www.vex.net/parnassus/parnassus.rss'</A>
		slashbox.__init__(self,url=_url)
		self.setName('Vaults of Parnassus')

class LWN(slashbox):
	&quot;&quot;&quot;slashbox sub-class for the Linux Weekly News&quot;&quot;&quot;
	def __init__(self):
		_url='<A HREF="http://lwn.net/headlines/rss'">http://lwn.net/headlines/rss'</A>
		slashbox.__init__(self,url=_url)
		self.setName('Linux Weekly News')


class Fool(slashbox):
	&quot;&quot;&quot;slashbox sub-class for the Motley Fool&quot;&quot;&quot;
	def __init__(self):
		_url='<A HREF="http://www.fool.com/About/headlines/rss_headlines.asp'">http://www.fool.com/About/headlines/rss_headlines.asp'</A>
		slashbox.__init__(self,url=_url)
		self.setName('The Motley Fool')

class LinuxNetNews(slashbox):
	&quot;&quot;&quot;slashbox sub-class for Linux Net News&quot;&quot;&quot;
	def __init__(self):
		_url='<A HREF="http://www.netnews.opensrc.org/index.rdf'">http://www.netnews.opensrc.org/index.rdf'</A>
		slashbox.__init__(self,url=_url)
		self.setName('Linux Net News')

class SourceForgeReleases(slashbox):
	&quot;&quot;&quot;slashbox sub-class for new releases on SourceForge&quot;&quot;&quot;
	def __init__(self):
		_url='<A HREF="http://sourceforge.net/export/rss_sfnewreleases.php'">http://sourceforge.net/export/rss_sfnewreleases.php'</A>
		slashbox.__init__(self,url=_url)
		self.setName('Sourceforge New Releases')

class SourceForgeNews(slashbox):
	&quot;&quot;&quot;slashbox sub-class for Project News at SourceForge&quot;&quot;&quot;
	def __init__(self):
		_url='<A HREF="http://sourceforge.net/export/rss_sfnews.php'">http://sourceforge.net/export/rss_sfnews.php'</A>
		slashbox.__init__(self,url=_url)
		self.setName('Sourceforge News')



if __name__ == &quot;__main__&quot;:

	print Slashdot()	

-- 
richard offer @ home 
          84 FE 48 E4 74 D0 26 D4  31 8E B6 86 98 74 E2 7C  8A FB BF A3
<A HREF="___________________________________http://216.185.15.144/users/richard/">___________________________________http://216.185.15.144/users/richard/</A>

</PRE>
<!--endarticle-->
</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003862.html">[mod_python] httplib: [notice] child pid 8937 exit signal
 Segmentation fault (11)
</A></li>
	<LI>Next message: <A HREF="003863.html">[mod_python] Compiling on a Debian Potato with Apache binary (and apache-dev)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3864">[ date ]</a>
              <a href="thread.html#3864">[ thread ]</a>
              <a href="subject.html#3864">[ subject ]</a>
              <a href="author.html#3864">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
