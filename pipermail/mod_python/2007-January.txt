From scavanagh at avaya.com  Tue Jan  2 09:09:54 2007
From: scavanagh at avaya.com (Cavanagh, Sean (Sean))
Date: Tue Jan  2 09:10:04 2007
Subject: [mod_python] unsubscribe
Message-ID: <5626D959080BBA49BBCA847DAE110FA40101AF33@on0010avexu1.cnda.avaya.com>

unsubscribe

 

	Sean Cavanagh | Software QA Manager | Communication Appliances
Division | P2P Business

	Avaya | 1135 Innovation Drive Suite 100 | Ottawa, ON K2K 3J7

	613.592.4343 x239 | scavanagh@avaya.com
<mailto:scavanagh@avaya.com> 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070102/ddf459c4/attachment.html
From banaouas.medialog at wanadoo.fr  Tue Jan  2 19:49:00 2007
From: banaouas.medialog at wanadoo.fr (m.banaouas)
Date: Tue Jan  2 19:41:54 2007
Subject: [mod_python] strange behaviour with compressed response
Message-ID: <459AFD7C.1000304@wanadoo.fr>

hi,
what is the difference between serving a file directly or by calling a 
script function?
case 1: http://localhost/myfile.xml
case 2: http://localhost/mydir/boo/getfile
Must I do special call to apache api when compression is activated?
With Firefox, every thing works fine in two cases.
With a http client component I'm using in my developpements, both case 1 
and case 2 works fine if I don't ask for compressed data. If I do 
(Accept-Encoding: gzip), case 1 works fine but case 2 fails.
I noticed that returning apache.OK adds unexpected extra "0" on the output.
thanks.

DocumentRoot "C:/Apache/htdocs"
<Directory />
    Options FollowSymLinks
    AllowOverride None
    Order deny,allow
    Deny from all
    Satisfy all
    SetOutputFilter DEFLATE
</Directory>

Alias /mydir "C:/MYDIR"
<Directory C:/MYDIR>
    Allow from All
    SetHandler mod_python
    PythonHandler mod_python.publisher
</Directory>

here is the simple boo.py script:
#---------------------------
# -*- coding: ISO-8859-1 -*-
#
# boo.py
#
import os, sys
from mod_python import apache
#
def getfile(req):
  req.content_type = 'text/xml'
  req.send_http_header()
  #
  f = file('c:/apache/htdocs/myfile.xml','r')
  xmldata = f.read()
  f.close()
  req.write(xmldata)
  #return apache.OK
#
def index(req):
  return "We are in index()"
#---------------------------

and here three traces from a tcp viwer:

#--MyHttpClient/func_access/without_gzip
Resolving Remote Host
Remote Host resolved to 127.0.0.1
Local Port (8080) opened
Waiting for connections
400: Client connected; 127.0.0.1:4657
400: Connecting to Server
400: Client to Server (188 bytes)
GET /mydir/boo/getfile HTTP/1.0
Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, */*
Connection: keep-alive
User-Agent: Mozilla/4.0 (compatible; ICS)
Host: localhost:80

400: Connected to Server
400: Server to Client (255 bytes)
HTTP/1.1 200 OK
Date: Wed, 03 Jan 2007 00:26:55 GMT
Server: Apache/2.2.3 (Win32) mod_python/3.3.0b Python/2.4.4
Vary: Accept-Encoding
Connection: close
Content-Type: text/xml

<?xml version="1.0" encoding="ISO-8859-1"?>
<document>Hello</document>

400: Server disconnected
400: Disconnected from Client

#-MyHttpClient/func_access/with_gzip
Resolving Remote Host
Remote Host resolved to 127.0.0.1
Local Port (8080) opened
Waiting for connections
488: Client connected; 127.0.0.1:4665
488: Connecting to Server
488: Client to Server (211 bytes)
GET /mydir/boo/getfile HTTP/1.0
Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, */*
Connection: keep-alive
Accept-Encoding: gzip
User-Agent: Mozilla/4.0 (compatible; ICS)
Host: localhost:80

488: Connected to Server
488: Server to Client (217 bytes)
HTTP/1.1 200 OK
Date: Wed, 03 Jan 2007 00:29:42 GMT
Server: Apache/2.2.3 (Win32) mod_python/3.3.0b Python/2.4.4
Vary: Accept-Encoding
Content-Encoding: gzip
Connection: close
Content-Type: text/xml

488: Server to Client (74 bytes)
0000  B3 B1 AF C8 CD 51 28 4B  2D 2A CE CC CF B3 55 32  .....Q(K-*....U2
0010  D4 33 50 52 48 CD 4B CE  4F C9 CC 4B B7 55 F2 0C  .3PRH.K.O..K.U..
0020  F6 D7 B5 B0 30 B5 D4 35  54 B2 B7 E3 B2 49 C9 4F  ....0..5T....I.O
0030  2E CD 4D CD 2B B1 F3 48  CD C9 C9 B7 D1 87 F3 B9  ..M.+..H........
0040  B8 00 86 D4 95 DA 48 00  00 00                    ......H...     
488: Server disconnected
488: Disconnected from Client

#--MyHttpClient/file_access/with_gzip
Resolving Remote Host
Remote Host resolved to 127.0.0.1
Local Port (8080) opened
Waiting for connections
428: Client connected; 127.0.0.1:4674
428: Connecting to Server
428: Connected to Server
428: Client to Server (204 bytes)
GET /myfile.xml HTTP/1.0
Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, */*
Connection: keep-alive
Accept-Encoding: gzip
User-Agent: Mozilla/4.0 (compatible; ICS)
Host: localhost:80

428: Server to Client (452 bytes)
HTTP/1.1 200 OK
Date: Wed, 03 Jan 2007 00:37:41 GMT
Server: Apache/2.2.3 (Win32) mod_python/3.3.0b Python/2.4.4
Last-Modified: Tue, 02 Jan 2007 23:30:43 GMT
ETag: "f832-4b-1e6eace9"
Accept-Ranges: bytes
Vary: Accept-Encoding
Content-Encoding: gzip
Content-Length: 87
Keep-Alive: timeout=5, max=100
Connection: Keep-Alive
Content-Type: application/xml

0187  D4 33 50 52 48 CD 4B CE  4F C9 CC 4B B7 55 F2 0C  .3PRH.K.O..K.U..
0197  F6 D7 B5 B0 30 B5 D4 35  54 B2 B7 E3 E5 B2 49 C9  ....0..5T.....I.
01A7  4F 2E CD 4D CD 2B B1 F3  48 CD C9 C9 B7 D1 87 F3  O..M.+..H.......
01B7  79 B9 78 B9 00 CB E5 71  9D 4B 00 00 00           y.x....q.K...  
428: Server disconnected
428: Disconnected from Client

#--Firefox--------------------------
Resolving Remote Host
Remote Host resolved to 127.0.0.1
Local Port (8080) opened
Waiting for connections
512: Client connected; 127.0.0.1:4669
512: Connecting to Server
512: Connected to Server
512: Client to Server (439 bytes)
GET /mydir/boo/getfile HTTP/1.1
Host: localhost:80
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; fr; rv:1.8.1.1) 
Gecko/20061204 Firefox/2.0.0.1
Accept: 
text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5
Accept-Language: fr,fr-fr;q=0.8,en-us;q=0.5,en;q=0.3
Accept-Encoding: gzip,deflate
Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7
Keep-Alive: 300
Connection: keep-alive

512: Server to Client (287 bytes)
HTTP/1.1 200 OK
Date: Wed, 03 Jan 2007 00:32:06 GMT
Server: Apache/2.2.3 (Win32) mod_python/3.3.0b Python/2.4.4
Vary: Accept-Encoding
Content-Encoding: gzip
Keep-Alive: timeout=5, max=100
Connection: Keep-Alive
Transfer-Encoding: chunked
Content-Type: text/xml

a
512: Server to Client (85 bytes)
0000  34 61 0D 0A B3 B1 AF C8  CD 51 28 4B 2D 2A CE CC  4a.......Q(K-*..
0010  CF B3 55 32 D4 33 50 52  48 CD 4B CE 4F C9 CC 4B  ..U2.3PRH.K.O..K
0020  B7 55 F2 0C F6 D7 B5 B0  30 B5 D4 35 54 B2 B7 E3  .U......0..5T...
0030  B2 49 C9 4F 2E CD 4D CD  2B B1 F3 48 CD C9 C9 B7  .I.O..M.+..H....
0040  D1 87 F3 B9 B8 00 86 D4  95 DA 48 00 00 00 0D 0A  ..........H.....
0050  30 0D 0A 0D 0A                                    0....          
512: Server disconnected
512: Disconnected from Client


From grahamd at dscpl.com.au  Tue Jan  2 21:36:02 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Jan  2 22:08:34 2007
Subject: [mod_python] strange behaviour with compressed response
Message-ID: <1167791759.876@dscpl.user.openhosting.com>

m.banaouas wrote ..
> hi,
> what is the difference between serving a file directly or by calling a
> script function?
> case 1: http://localhost/myfile.xml
> case 2: http://localhost/mydir/boo/getfile
> Must I do special call to apache api when compression is activated?
> With Firefox, every thing works fine in two cases.
> With a http client component I'm using in my developpements, both case
> 1 
> and case 2 works fine if I don't ask for compressed data. If I do 
> (Accept-Encoding: gzip), case 1 works fine but case 2 fails.

Your Apache configuration only enables the DEFLATE output filter for static
files in your htdocs directory, it doesn't enable it for anything under mydir
so unless DEFLATE is being enable somehow elsewhere in the Apache configuration
the output of your published functions would never be compressed.

See other notes further done mixed in with your code and configuration.

> I noticed that returning apache.OK adds unexpected extra "0" on the output.

Which would be what one expects as functions published using
mod_python.publisher are not the same as basic mod_python handlers. When using
mod_python.publisher the result of the published function is converted to a
string and written back as response content. In a basic mod_python handler the
response is a status indicating success of otherwise of the handler. Look at
the documentation again to see the difference.

> thanks.
> 
> DocumentRoot "C:/Apache/htdocs"
> <Directory />
>     Options FollowSymLinks
>     AllowOverride None
>     Order deny,allow
>     Deny from all
>     Satisfy all
>     SetOutputFilter DEFLATE
> </Directory>
> 
> Alias /mydir "C:/MYDIR"
> <Directory C:/MYDIR>
>     Allow from All
>     SetHandler mod_python
>     PythonHandler mod_python.publisher

Because this is a separate physical directory with distinct Directory
directive, you would also need here:

      SetOutputFilter DEFLATE

to have response from published functions be compressed.

Do take heed of the Apache documentation I pointed you to originally in
regard to DEFLATE module and a possible need to ensure you don't enable
it for some clients because of broken compressed data implementations
in those clients. Also, you shouldn't enable DEFLATE for all file types as files
such as images are usually already compressed and compressing them
again is a pointless exercise.

Another alternative with mod_python 3.3 is to actually make the judgement
within the published function as to whether for a specific response the output
should be compressed or not. To do this, before writing back any content
from the function, call:

    req.add_output_filter('DEFLATE')

This is the same as having using 'SetOutputFilter' in the Apache configuration.

> </Directory>
> 
> here is the simple boo.py script:
> #---------------------------
> # -*- coding: ISO-8859-1 -*-
> #
> # boo.py
> #
> import os, sys
> from mod_python import apache
> #
> def getfile(req):
>   req.content_type = 'text/xml'
>   req.send_http_header()
>   #
>   f = file('c:/apache/htdocs/myfile.xml','r')
>   xmldata = f.read()
>   f.close()
>   req.write(xmldata)

This is inefficient. Read the documentation and instead simply try:

  req.sendfile('c:/apache/htdocs/myfile.xml')

What I don't know off hand though is if the file contents still go through
the output filters. I have a feeling they don't as it is actually dropping
down and writing it direct out on the socket for efficiency.

>   #return apache.OK

Should not return apache.OK in published functions.

> #
> def index(req):
>   return "We are in index()"
> #---------------------------
> 
> and here three traces from a tcp viwer:
> 
> #--MyHttpClient/func_access/without_gzip
> Resolving Remote Host
> Remote Host resolved to 127.0.0.1
> Local Port (8080) opened
> Waiting for connections
> 400: Client connected; 127.0.0.1:4657
> 400: Connecting to Server
> 400: Client to Server (188 bytes)
> GET /mydir/boo/getfile HTTP/1.0
> Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, */*
> Connection: keep-alive
> User-Agent: Mozilla/4.0 (compatible; ICS)
> Host: localhost:80
> 
> 400: Connected to Server
> 400: Server to Client (255 bytes)
> HTTP/1.1 200 OK
> Date: Wed, 03 Jan 2007 00:26:55 GMT
> Server: Apache/2.2.3 (Win32) mod_python/3.3.0b Python/2.4.4
> Vary: Accept-Encoding
> Connection: close
> Content-Type: text/xml
> 
> <?xml version="1.0" encoding="ISO-8859-1"?>
> <document>Hello</document>
> 
> 400: Server disconnected
> 400: Disconnected from Client
> 
> #-MyHttpClient/func_access/with_gzip
> Resolving Remote Host
> Remote Host resolved to 127.0.0.1
> Local Port (8080) opened
> Waiting for connections
> 488: Client connected; 127.0.0.1:4665
> 488: Connecting to Server
> 488: Client to Server (211 bytes)
> GET /mydir/boo/getfile HTTP/1.0
> Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, */*
> Connection: keep-alive
> Accept-Encoding: gzip
> User-Agent: Mozilla/4.0 (compatible; ICS)
> Host: localhost:80
> 
> 488: Connected to Server
> 488: Server to Client (217 bytes)
> HTTP/1.1 200 OK
> Date: Wed, 03 Jan 2007 00:29:42 GMT
> Server: Apache/2.2.3 (Win32) mod_python/3.3.0b Python/2.4.4
> Vary: Accept-Encoding
> Content-Encoding: gzip
> Connection: close
> Content-Type: text/xml
> 
> 488: Server to Client (74 bytes)
> 0000  B3 B1 AF C8 CD 51 28 4B  2D 2A CE CC CF B3 55 32  .....Q(K-*....U2
> 0010  D4 33 50 52 48 CD 4B CE  4F C9 CC 4B B7 55 F2 0C  .3PRH.K.O..K.U..
> 0020  F6 D7 B5 B0 30 B5 D4 35  54 B2 B7 E3 B2 49 C9 4F  ....0..5T....I.O
> 0030  2E CD 4D CD 2B B1 F3 48  CD C9 C9 B7 D1 87 F3 B9  ..M.+..H........
> 0040  B8 00 86 D4 95 DA 48 00  00 00                    ......H...    
> 488: Server disconnected
> 488: Disconnected from Client
> 
> #--MyHttpClient/file_access/with_gzip
> Resolving Remote Host
> Remote Host resolved to 127.0.0.1
> Local Port (8080) opened
> Waiting for connections
> 428: Client connected; 127.0.0.1:4674
> 428: Connecting to Server
> 428: Connected to Server
> 428: Client to Server (204 bytes)
> GET /myfile.xml HTTP/1.0
> Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, */*
> Connection: keep-alive
> Accept-Encoding: gzip
> User-Agent: Mozilla/4.0 (compatible; ICS)
> Host: localhost:80
> 
> 428: Server to Client (452 bytes)
> HTTP/1.1 200 OK
> Date: Wed, 03 Jan 2007 00:37:41 GMT
> Server: Apache/2.2.3 (Win32) mod_python/3.3.0b Python/2.4.4
> Last-Modified: Tue, 02 Jan 2007 23:30:43 GMT
> ETag: "f832-4b-1e6eace9"
> Accept-Ranges: bytes
> Vary: Accept-Encoding
> Content-Encoding: gzip
> Content-Length: 87
> Keep-Alive: timeout=5, max=100
> Connection: Keep-Alive
> Content-Type: application/xml
> 
> 0187  D4 33 50 52 48 CD 4B CE  4F C9 CC 4B B7 55 F2 0C  .3PRH.K.O..K.U..
> 0197  F6 D7 B5 B0 30 B5 D4 35  54 B2 B7 E3 E5 B2 49 C9  ....0..5T.....I.
> 01A7  4F 2E CD 4D CD 2B B1 F3  48 CD C9 C9 B7 D1 87 F3  O..M.+..H.......
> 01B7  79 B9 78 B9 00 CB E5 71  9D 4B 00 00 00           y.x....q.K... 
> 428: Server disconnected
> 428: Disconnected from Client
> 
> #--Firefox--------------------------
> Resolving Remote Host
> Remote Host resolved to 127.0.0.1
> Local Port (8080) opened
> Waiting for connections
> 512: Client connected; 127.0.0.1:4669
> 512: Connecting to Server
> 512: Connected to Server
> 512: Client to Server (439 bytes)
> GET /mydir/boo/getfile HTTP/1.1
> Host: localhost:80
> User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; fr; rv:1.8.1.1) 
> Gecko/20061204 Firefox/2.0.0.1
> Accept: 
> text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5
> Accept-Language: fr,fr-fr;q=0.8,en-us;q=0.5,en;q=0.3
> Accept-Encoding: gzip,deflate
> Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7
> Keep-Alive: 300
> Connection: keep-alive
> 
> 512: Server to Client (287 bytes)
> HTTP/1.1 200 OK
> Date: Wed, 03 Jan 2007 00:32:06 GMT
> Server: Apache/2.2.3 (Win32) mod_python/3.3.0b Python/2.4.4
> Vary: Accept-Encoding
> Content-Encoding: gzip
> Keep-Alive: timeout=5, max=100
> Connection: Keep-Alive
> Transfer-Encoding: chunked
> Content-Type: text/xml
> 
> a
> 512: Server to Client (85 bytes)
> 0000  34 61 0D 0A B3 B1 AF C8  CD 51 28 4B 2D 2A CE CC  4a.......Q(K-*..
> 0010  CF B3 55 32 D4 33 50 52  48 CD 4B CE 4F C9 CC 4B  ..U2.3PRH.K.O..K
> 0020  B7 55 F2 0C F6 D7 B5 B0  30 B5 D4 35 54 B2 B7 E3  .U......0..5T...
> 0030  B2 49 C9 4F 2E CD 4D CD  2B B1 F3 48 CD C9 C9 B7  .I.O..M.+..H....
> 0040  D1 87 F3 B9 B8 00 86 D4  95 DA 48 00 00 00 0D 0A  ..........H.....
> 0050  30 0D 0A 0D 0A                                    0....         
> 512: Server disconnected
> 512: Disconnected from Client
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
From grahamd at dscpl.com.au  Tue Jan  2 21:54:40 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Jan  2 22:08:37 2007
Subject: [mod_python] strange behaviour with compressed response
Message-ID: <1167792878.8323@dscpl.user.openhosting.com>

Apologies if this comes through twice on the list, having problems with my
site running reaaaaaalllllllllyyyyyyyy slow and don't think if got through last
time. Graham

m.banaouas wrote ..
> hi,
> what is the difference between serving a file directly or by calling a
> script function?
> case 1: http://localhost/myfile.xml
> case 2: http://localhost/mydir/boo/getfile
> Must I do special call to apache api when compression is activated?
> With Firefox, every thing works fine in two cases.
> With a http client component I'm using in my developpements, both case
> 1 
> and case 2 works fine if I don't ask for compressed data. If I do 
> (Accept-Encoding: gzip), case 1 works fine but case 2 fails.

Your Apache configuration only enables the DEFLATE output filter for static
files in your htdocs directory, it doesn't enable it for anything under mydir
so unless DEFLATE is being enable somehow elsewhere in the Apache configuration
the output of your published functions would never be compressed.

See other notes further done mixed in with your code and configuration.

> I noticed that returning apache.OK adds unexpected extra "0" on the output.

Which would be what one expects as functions published using
mod_python.publisher are not the same as basic mod_python handlers. When using
mod_python.publisher the result of the published function is converted to a
string and written back as response content. In a basic mod_python handler the
response is a status indicating success of otherwise of the handler. Look at
the documentation again to see the difference.

> thanks.
> 
> DocumentRoot "C:/Apache/htdocs"
> <Directory />
>     Options FollowSymLinks
>     AllowOverride None
>     Order deny,allow
>     Deny from all
>     Satisfy all
>     SetOutputFilter DEFLATE
> </Directory>
> 
> Alias /mydir "C:/MYDIR"
> <Directory C:/MYDIR>
>     Allow from All
>     SetHandler mod_python
>     PythonHandler mod_python.publisher

Because this is a separate physical directory with distinct Directory
directive, you would also need here:

      SetOutputFilter DEFLATE

to have response from published functions be compressed.

Do take heed of the Apache documentation I pointed you to originally in
regard to DEFLATE module and a possible need to ensure you don't enable
it for some clients because of broken compressed data implementations
in those clients. Also, you shouldn't enable DEFLATE for all file types as files
such as images are usually already compressed and compressing them
again is a pointless exercise.

Another alternative with mod_python 3.3 is to actually make the judgement
within the published function as to whether for a specific response the output
should be compressed or not. To do this, before writing back any content
from the function, call:

    req.add_output_filter('DEFLATE')

This is the same as having using 'SetOutputFilter' in the Apache configuration.

> </Directory>
> 
> here is the simple boo.py script:
> #---------------------------
> # -*- coding: ISO-8859-1 -*-
> #
> # boo.py
> #
> import os, sys
> from mod_python import apache
> #
> def getfile(req):
>   req.content_type = 'text/xml'
>   req.send_http_header()
>   #
>   f = file('c:/apache/htdocs/myfile.xml','r')
>   xmldata = f.read()
>   f.close()
>   req.write(xmldata)

This is inefficient. Read the documentation and instead simply try:

  req.sendfile('c:/apache/htdocs/myfile.xml')

What I don't know off hand though is if the file contents still go through
the output filters. I have a feeling they don't as it is actually dropping
down and writing it direct out on the socket for efficiency.

>   #return apache.OK

Should not return apache.OK in published functions.

> #
> def index(req):
>   return "We are in index()"
> #---------------------------
> 
> and here three traces from a tcp viwer:
> 
> #--MyHttpClient/func_access/without_gzip
> Resolving Remote Host
> Remote Host resolved to 127.0.0.1
> Local Port (8080) opened
> Waiting for connections
> 400: Client connected; 127.0.0.1:4657
> 400: Connecting to Server
> 400: Client to Server (188 bytes)
> GET /mydir/boo/getfile HTTP/1.0
> Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, */*
> Connection: keep-alive
> User-Agent: Mozilla/4.0 (compatible; ICS)
> Host: localhost:80
> 
> 400: Connected to Server
> 400: Server to Client (255 bytes)
> HTTP/1.1 200 OK
> Date: Wed, 03 Jan 2007 00:26:55 GMT
> Server: Apache/2.2.3 (Win32) mod_python/3.3.0b Python/2.4.4
> Vary: Accept-Encoding
> Connection: close
> Content-Type: text/xml
> 
> <?xml version="1.0" encoding="ISO-8859-1"?>
> <document>Hello</document>
> 
> 400: Server disconnected
> 400: Disconnected from Client
> 
> #-MyHttpClient/func_access/with_gzip
> Resolving Remote Host
> Remote Host resolved to 127.0.0.1
> Local Port (8080) opened
> Waiting for connections
> 488: Client connected; 127.0.0.1:4665
> 488: Connecting to Server
> 488: Client to Server (211 bytes)
> GET /mydir/boo/getfile HTTP/1.0
> Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, */*
> Connection: keep-alive
> Accept-Encoding: gzip
> User-Agent: Mozilla/4.0 (compatible; ICS)
> Host: localhost:80
> 
> 488: Connected to Server
> 488: Server to Client (217 bytes)
> HTTP/1.1 200 OK
> Date: Wed, 03 Jan 2007 00:29:42 GMT
> Server: Apache/2.2.3 (Win32) mod_python/3.3.0b Python/2.4.4
> Vary: Accept-Encoding
> Content-Encoding: gzip
> Connection: close
> Content-Type: text/xml
> 
> 488: Server to Client (74 bytes)
> 0000  B3 B1 AF C8 CD 51 28 4B  2D 2A CE CC CF B3 55 32  .....Q(K-*....U2
> 0010  D4 33 50 52 48 CD 4B CE  4F C9 CC 4B B7 55 F2 0C  .3PRH.K.O..K.U..
> 0020  F6 D7 B5 B0 30 B5 D4 35  54 B2 B7 E3 B2 49 C9 4F  ....0..5T....I.O
> 0030  2E CD 4D CD 2B B1 F3 48  CD C9 C9 B7 D1 87 F3 B9  ..M.+..H........
> 0040  B8 00 86 D4 95 DA 48 00  00 00                    ......H...    
> 488: Server disconnected
> 488: Disconnected from Client
> 
> #--MyHttpClient/file_access/with_gzip
> Resolving Remote Host
> Remote Host resolved to 127.0.0.1
> Local Port (8080) opened
> Waiting for connections
> 428: Client connected; 127.0.0.1:4674
> 428: Connecting to Server
> 428: Connected to Server
> 428: Client to Server (204 bytes)
> GET /myfile.xml HTTP/1.0
> Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, */*
> Connection: keep-alive
> Accept-Encoding: gzip
> User-Agent: Mozilla/4.0 (compatible; ICS)
> Host: localhost:80
> 
> 428: Server to Client (452 bytes)
> HTTP/1.1 200 OK
> Date: Wed, 03 Jan 2007 00:37:41 GMT
> Server: Apache/2.2.3 (Win32) mod_python/3.3.0b Python/2.4.4
> Last-Modified: Tue, 02 Jan 2007 23:30:43 GMT
> ETag: "f832-4b-1e6eace9"
> Accept-Ranges: bytes
> Vary: Accept-Encoding
> Content-Encoding: gzip
> Content-Length: 87
> Keep-Alive: timeout=5, max=100
> Connection: Keep-Alive
> Content-Type: application/xml
> 
> 0187  D4 33 50 52 48 CD 4B CE  4F C9 CC 4B B7 55 F2 0C  .3PRH.K.O..K.U..
> 0197  F6 D7 B5 B0 30 B5 D4 35  54 B2 B7 E3 E5 B2 49 C9  ....0..5T.....I.
> 01A7  4F 2E CD 4D CD 2B B1 F3  48 CD C9 C9 B7 D1 87 F3  O..M.+..H.......
> 01B7  79 B9 78 B9 00 CB E5 71  9D 4B 00 00 00           y.x....q.K... 
> 428: Server disconnected
> 428: Disconnected from Client
> 
> #--Firefox--------------------------
> Resolving Remote Host
> Remote Host resolved to 127.0.0.1
> Local Port (8080) opened
> Waiting for connections
> 512: Client connected; 127.0.0.1:4669
> 512: Connecting to Server
> 512: Connected to Server
> 512: Client to Server (439 bytes)
> GET /mydir/boo/getfile HTTP/1.1
> Host: localhost:80
> User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; fr; rv:1.8.1.1) 
> Gecko/20061204 Firefox/2.0.0.1
> Accept: 
> text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5
> Accept-Language: fr,fr-fr;q=0.8,en-us;q=0.5,en;q=0.3
> Accept-Encoding: gzip,deflate
> Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7
> Keep-Alive: 300
> Connection: keep-alive
> 
> 512: Server to Client (287 bytes)
> HTTP/1.1 200 OK
> Date: Wed, 03 Jan 2007 00:32:06 GMT
> Server: Apache/2.2.3 (Win32) mod_python/3.3.0b Python/2.4.4
> Vary: Accept-Encoding
> Content-Encoding: gzip
> Keep-Alive: timeout=5, max=100
> Connection: Keep-Alive
> Transfer-Encoding: chunked
> Content-Type: text/xml
> 
> a
> 512: Server to Client (85 bytes)
> 0000  34 61 0D 0A B3 B1 AF C8  CD 51 28 4B 2D 2A CE CC  4a.......Q(K-*..
> 0010  CF B3 55 32 D4 33 50 52  48 CD 4B CE 4F C9 CC 4B  ..U2.3PRH.K.O..K
> 0020  B7 55 F2 0C F6 D7 B5 B0  30 B5 D4 35 54 B2 B7 E3  .U......0..5T...
> 0030  B2 49 C9 4F 2E CD 4D CD  2B B1 F3 48 CD C9 C9 B7  .I.O..M.+..H....
> 0040  D1 87 F3 B9 B8 00 86 D4  95 DA 48 00 00 00 0D 0A  ..........H.....
> 0050  30 0D 0A 0D 0A                                    0....         
> 512: Server disconnected
> 512: Disconnected from Client
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
From grahamd at dscpl.com.au  Tue Jan  2 22:07:55 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Jan  2 22:08:53 2007
Subject: [mod_python] strange behaviour with compressed response
Message-ID: <1167793675.15506@dscpl.user.openhosting.com>

Apologies if this comes through twice on the list, having problems with my
site running reaaaaaalllllllllyyyyyyyy slow and don't think if got through last
time. Graham

m.banaouas wrote ..
> hi,
> what is the difference between serving a file directly or by calling a
> script function?
> case 1: http://localhost/myfile.xml
> case 2: http://localhost/mydir/boo/getfile
> Must I do special call to apache api when compression is activated?
> With Firefox, every thing works fine in two cases.
> With a http client component I'm using in my developpements, both case
> 1 
> and case 2 works fine if I don't ask for compressed data. If I do 
> (Accept-Encoding: gzip), case 1 works fine but case 2 fails.

Your Apache configuration only enables the DEFLATE output filter for static
files in your htdocs directory, it doesn't enable it for anything under mydir
so unless DEFLATE is being enable somehow elsewhere in the Apache configuration
the output of your published functions would never be compressed.

See other notes further done mixed in with your code and configuration.

> I noticed that returning apache.OK adds unexpected extra "0" on the output.

Which would be what one expects as functions published using
mod_python.publisher are not the same as basic mod_python handlers. When using
mod_python.publisher the result of the published function is converted to a
string and written back as response content. In a basic mod_python handler the
response is a status indicating success of otherwise of the handler. Look at
the documentation again to see the difference.

> thanks.
> 
> DocumentRoot "C:/Apache/htdocs"
> <Directory />
>     Options FollowSymLinks
>     AllowOverride None
>     Order deny,allow
>     Deny from all
>     Satisfy all
>     SetOutputFilter DEFLATE
> </Directory>
> 
> Alias /mydir "C:/MYDIR"
> <Directory C:/MYDIR>
>     Allow from All
>     SetHandler mod_python
>     PythonHandler mod_python.publisher

Because this is a separate physical directory with distinct Directory
directive, you would also need here:

      SetOutputFilter DEFLATE

to have response from published functions be compressed.

Do take heed of the Apache documentation I pointed you to originally in
regard to DEFLATE module and a possible need to ensure you don't enable
it for some clients because of broken compressed data implementations
in those clients. Also, you shouldn't enable DEFLATE for all file types as files
such as images are usually already compressed and compressing them
again is a pointless exercise.

Another alternative with mod_python 3.3 is to actually make the judgement
within the published function as to whether for a specific response the output
should be compressed or not. To do this, before writing back any content
from the function, call:

    req.add_output_filter('DEFLATE')

This is the same as having using 'SetOutputFilter' in the Apache configuration.

> </Directory>
> 
> here is the simple boo.py script:
> #---------------------------
> # -*- coding: ISO-8859-1 -*-
> #
> # boo.py
> #
> import os, sys
> from mod_python import apache
> #
> def getfile(req):
>   req.content_type = 'text/xml'
>   req.send_http_header()
>   #
>   f = file('c:/apache/htdocs/myfile.xml','r')
>   xmldata = f.read()
>   f.close()
>   req.write(xmldata)

This is inefficient. Read the documentation and instead simply try:

  req.sendfile('c:/apache/htdocs/myfile.xml')

What I don't know off hand though is if the file contents still go through
the output filters. I have a feeling they don't as it is actually dropping
down and writing it direct out on the socket for efficiency.

>   #return apache.OK

Should not return apache.OK in published functions.

> #
> def index(req):
>   return "We are in index()"
> #---------------------------
> 
> and here three traces from a tcp viwer:
> 
> #--MyHttpClient/func_access/without_gzip
> Resolving Remote Host
> Remote Host resolved to 127.0.0.1
> Local Port (8080) opened
> Waiting for connections
> 400: Client connected; 127.0.0.1:4657
> 400: Connecting to Server
> 400: Client to Server (188 bytes)
> GET /mydir/boo/getfile HTTP/1.0
> Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, */*
> Connection: keep-alive
> User-Agent: Mozilla/4.0 (compatible; ICS)
> Host: localhost:80
> 
> 400: Connected to Server
> 400: Server to Client (255 bytes)
> HTTP/1.1 200 OK
> Date: Wed, 03 Jan 2007 00:26:55 GMT
> Server: Apache/2.2.3 (Win32) mod_python/3.3.0b Python/2.4.4
> Vary: Accept-Encoding
> Connection: close
> Content-Type: text/xml
> 
> <?xml version="1.0" encoding="ISO-8859-1"?>
> <document>Hello</document>
> 
> 400: Server disconnected
> 400: Disconnected from Client
> 
> #-MyHttpClient/func_access/with_gzip
> Resolving Remote Host
> Remote Host resolved to 127.0.0.1
> Local Port (8080) opened
> Waiting for connections
> 488: Client connected; 127.0.0.1:4665
> 488: Connecting to Server
> 488: Client to Server (211 bytes)
> GET /mydir/boo/getfile HTTP/1.0
> Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, */*
> Connection: keep-alive
> Accept-Encoding: gzip
> User-Agent: Mozilla/4.0 (compatible; ICS)
> Host: localhost:80
> 
> 488: Connected to Server
> 488: Server to Client (217 bytes)
> HTTP/1.1 200 OK
> Date: Wed, 03 Jan 2007 00:29:42 GMT
> Server: Apache/2.2.3 (Win32) mod_python/3.3.0b Python/2.4.4
> Vary: Accept-Encoding
> Content-Encoding: gzip
> Connection: close
> Content-Type: text/xml
> 
> 488: Server to Client (74 bytes)
> 0000  B3 B1 AF C8 CD 51 28 4B  2D 2A CE CC CF B3 55 32  .....Q(K-*....U2
> 0010  D4 33 50 52 48 CD 4B CE  4F C9 CC 4B B7 55 F2 0C  .3PRH.K.O..K.U..
> 0020  F6 D7 B5 B0 30 B5 D4 35  54 B2 B7 E3 B2 49 C9 4F  ....0..5T....I.O
> 0030  2E CD 4D CD 2B B1 F3 48  CD C9 C9 B7 D1 87 F3 B9  ..M.+..H........
> 0040  B8 00 86 D4 95 DA 48 00  00 00                    ......H...    
> 488: Server disconnected
> 488: Disconnected from Client
> 
> #--MyHttpClient/file_access/with_gzip
> Resolving Remote Host
> Remote Host resolved to 127.0.0.1
> Local Port (8080) opened
> Waiting for connections
> 428: Client connected; 127.0.0.1:4674
> 428: Connecting to Server
> 428: Connected to Server
> 428: Client to Server (204 bytes)
> GET /myfile.xml HTTP/1.0
> Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, */*
> Connection: keep-alive
> Accept-Encoding: gzip
> User-Agent: Mozilla/4.0 (compatible; ICS)
> Host: localhost:80
> 
> 428: Server to Client (452 bytes)
> HTTP/1.1 200 OK
> Date: Wed, 03 Jan 2007 00:37:41 GMT
> Server: Apache/2.2.3 (Win32) mod_python/3.3.0b Python/2.4.4
> Last-Modified: Tue, 02 Jan 2007 23:30:43 GMT
> ETag: "f832-4b-1e6eace9"
> Accept-Ranges: bytes
> Vary: Accept-Encoding
> Content-Encoding: gzip
> Content-Length: 87
> Keep-Alive: timeout=5, max=100
> Connection: Keep-Alive
> Content-Type: application/xml
> 
> 0187  D4 33 50 52 48 CD 4B CE  4F C9 CC 4B B7 55 F2 0C  .3PRH.K.O..K.U..
> 0197  F6 D7 B5 B0 30 B5 D4 35  54 B2 B7 E3 E5 B2 49 C9  ....0..5T.....I.
> 01A7  4F 2E CD 4D CD 2B B1 F3  48 CD C9 C9 B7 D1 87 F3  O..M.+..H.......
> 01B7  79 B9 78 B9 00 CB E5 71  9D 4B 00 00 00           y.x....q.K... 
> 428: Server disconnected
> 428: Disconnected from Client
> 
> #--Firefox--------------------------
> Resolving Remote Host
> Remote Host resolved to 127.0.0.1
> Local Port (8080) opened
> Waiting for connections
> 512: Client connected; 127.0.0.1:4669
> 512: Connecting to Server
> 512: Connected to Server
> 512: Client to Server (439 bytes)
> GET /mydir/boo/getfile HTTP/1.1
> Host: localhost:80
> User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; fr; rv:1.8.1.1) 
> Gecko/20061204 Firefox/2.0.0.1
> Accept: 
> text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5
> Accept-Language: fr,fr-fr;q=0.8,en-us;q=0.5,en;q=0.3
> Accept-Encoding: gzip,deflate
> Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7
> Keep-Alive: 300
> Connection: keep-alive
> 
> 512: Server to Client (287 bytes)
> HTTP/1.1 200 OK
> Date: Wed, 03 Jan 2007 00:32:06 GMT
> Server: Apache/2.2.3 (Win32) mod_python/3.3.0b Python/2.4.4
> Vary: Accept-Encoding
> Content-Encoding: gzip
> Keep-Alive: timeout=5, max=100
> Connection: Keep-Alive
> Transfer-Encoding: chunked
> Content-Type: text/xml
> 
> a
> 512: Server to Client (85 bytes)
> 0000  34 61 0D 0A B3 B1 AF C8  CD 51 28 4B 2D 2A CE CC  4a.......Q(K-*..
> 0010  CF B3 55 32 D4 33 50 52  48 CD 4B CE 4F C9 CC 4B  ..U2.3PRH.K.O..K
> 0020  B7 55 F2 0C F6 D7 B5 B0  30 B5 D4 35 54 B2 B7 E3  .U......0..5T...
> 0030  B2 49 C9 4F 2E CD 4D CD  2B B1 F3 48 CD C9 C9 B7  .I.O..M.+..H....
> 0040  D1 87 F3 B9 B8 00 86 D4  95 DA 48 00 00 00 0D 0A  ..........H.....
> 0050  30 0D 0A 0D 0A                                    0....         
> 512: Server disconnected
> 512: Disconnected from Client
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
From banaouas.medialog at wanadoo.fr  Wed Jan  3 04:33:27 2007
From: banaouas.medialog at wanadoo.fr (m.banaouas)
Date: Wed Jan  3 04:32:22 2007
Subject: [mod_python] strange behaviour with compressed response
In-Reply-To: <1167791759.876@dscpl.user.openhosting.com>
References: <1167791759.876@dscpl.user.openhosting.com>
Message-ID: <459B7867.3010600@wanadoo.fr>

Hi,

 >req.sendfile('c:/apache/htdocs/myfile.xml')
In my real case, the response contain "dynamic" data built with database 
extracted rows.
So it's may be not the best thing to do (storing it first in a file).

 >       SetOutputFilter DEFLATE
Now, it works finally! even without this directive.

In fact the right question would be:
"what is the difference between req.write(bla) and return bla ?"

Firefox browser is certainly http-tolerant and can manage some 
"imperfect" http dialogs.
Of course, the problem I meet could be caused by bad implementation in 
MyHttpClient side.
But the same comp in the sames conditions fails when response is 
"written" and works fine when the response is "returned", bizare non ?
I would like to well understand the origin of this difference of 
behaviour, to avoid to meet it again in prod stage.
So I will "dive" deeply in apache documentation ...

special thanks for Graham Dumpleton and all his rich comments ...

Graham Dumpleton a ?crit :
 > m.banaouas wrote ..
 >> hi,
 >> what is the difference between serving a file directly or by calling a
 >> script function?
 >> case 1: http://localhost/myfile.xml
 >> case 2: http://localhost/mydir/boo/getfile
 >> Must I do special call to apache api when compression is activated?
 >> With Firefox, every thing works fine in two cases.
 >> With a http client component I'm using in my developpements, both case
 >> 1
 >> and case 2 works fine if I don't ask for compressed data. If I do
 >> (Accept-Encoding: gzip), case 1 works fine but case 2 fails.
 >
 > Your Apache configuration only enables the DEFLATE output filter for 
static
 > files in your htdocs directory, it doesn't enable it for anything 
under mydir
 > so unless DEFLATE is being enable somehow elsewhere in the Apache 
configuration
 > the output of your published functions would never be compressed.
 >
 > See other notes further done mixed in with your code and configuration.
 >
 >> I noticed that returning apache.OK adds unexpected extra "0" on the 
output.
 >
 > Which would be what one expects as functions published using
 > mod_python.publisher are not the same as basic mod_python handlers. 
When using
 > mod_python.publisher the result of the published function is 
converted to a
 > string and written back as response content. In a basic mod_python 
handler the
 > response is a status indicating success of otherwise of the handler. 
Look at
 > the documentation again to see the difference.
 >
 >> thanks.
 >>
 >> DocumentRoot "C:/Apache/htdocs"
 >> <Directory />
 >>     Options FollowSymLinks
 >>     AllowOverride None
 >>     Order deny,allow
 >>     Deny from all
 >>     Satisfy all
 >>     SetOutputFilter DEFLATE
 >> </Directory>
 >>
 >> Alias /mydir "C:/MYDIR"
 >> <Directory C:/MYDIR>
 >>     Allow from All
 >>     SetHandler mod_python
 >>     PythonHandler mod_python.publisher
 >
 > Because this is a separate physical directory with distinct Directory
 > directive, you would also need here:
 >
 >       SetOutputFilter DEFLATE
 >
 > to have response from published functions be compressed.
 >
 > Do take heed of the Apache documentation I pointed you to originally in
 > regard to DEFLATE module and a possible need to ensure you don't enable
 > it for some clients because of broken compressed data implementations
 > in those clients. Also, you shouldn't enable DEFLATE for all file 
types as files
 > such as images are usually already compressed and compressing them
 > again is a pointless exercise.
 >
 > Another alternative with mod_python 3.3 is to actually make the judgement
 > within the published function as to whether for a specific response 
the output
 > should be compressed or not. To do this, before writing back any content
 > from the function, call:
 >
 >     req.add_output_filter('DEFLATE')
 >
 > This is the same as having using 'SetOutputFilter' in the Apache 
configuration.
 >


From jpg at jgassociates.ca  Wed Jan  3 09:24:35 2007
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Wed Jan  3 09:31:41 2007
Subject: [mod_python] strange behaviour with compressed response
In-Reply-To: <459B7867.3010600@wanadoo.fr>
References: <1167791759.876@dscpl.user.openhosting.com>
	<459B7867.3010600@wanadoo.fr>
Message-ID: <459BBCA3.4060602@jgassociates.ca>

m.banaouas wrote:
> Hi,
> 
>  >req.sendfile('c:/apache/htdocs/myfile.xml')
> In my real case, the response contain "dynamic" data built with database 
> extracted rows.
> So it's may be not the best thing to do (storing it first in a file).
> 
>  >       SetOutputFilter DEFLATE
> Now, it works finally! even without this directive.
> 
> In fact the right question would be:
> "what is the difference between req.write(bla) and return bla ?"

Very little. When you return something using mod_python.publisher, it 
still calls req.write() internally.

Perhaps the biggest difference is that mod_python.publisher calls 
req.write with flush=0, whereas the default is flush=1.

This could have implications concerning the setting of the 
Content-Length header versus use of Transfer-Encoding: chunked. (I'm not 
100% sure about that, but I have the idea that by not immediately 
flushing to the client Apache may be able to set the Content-Length header).

On the other hand, your client is using HTTP/1.0 which may introduce 
other complications. (IIRC HTTP/1.0 does not support Transfer-Encoding)

  > Firefox browser is certainly http-tolerant and can manage some
> "imperfect" http dialogs.
> Of course, the problem I meet could be caused by bad implementation in 
> MyHttpClient side.
> But the same comp in the sames conditions fails when response is 
> "written" and works fine when the response is "returned", bizare non ?

I suspect it may be some implementation detail in your client.

Jim
From banaouas.medialog at wanadoo.fr  Wed Jan  3 11:38:54 2007
From: banaouas.medialog at wanadoo.fr (m.banaouas)
Date: Wed Jan  3 11:38:52 2007
Subject: [mod_python] strange behaviour with compressed response
In-Reply-To: <459BBCA3.4060602@jgassociates.ca>
References: <1167791759.876@dscpl.user.openhosting.com>
	<459B7867.3010600@wanadoo.fr> <459BBCA3.4060602@jgassociates.ca>
Message-ID: <459BDC1E.40703@wanadoo.fr>



Jim Gallacher a ?crit :
> On the other hand, your client is using HTTP/1.0 which may introduce 
> other complications. (IIRC HTTP/1.0 does not support Transfer-Encoding)
>
Actually, the component I'm using has RequestVer property, default '1.0'
I put '1.1' instead ...
thanks


From grahamd at dscpl.com.au  Wed Jan  3 16:05:59 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Jan  3 16:06:11 2007
Subject: [mod_python] strange behaviour with compressed response
Message-ID: <1167858359.29553@dscpl.user.openhosting.com>

Jim Gallacher wrote ..
> m.banaouas wrote:
> > Hi,
> > 
> >  >req.sendfile('c:/apache/htdocs/myfile.xml')
> > In my real case, the response contain "dynamic" data built with database
> > extracted rows.
> > So it's may be not the best thing to do (storing it first in a file).
> > 
> >  >       SetOutputFilter DEFLATE
> > Now, it works finally! even without this directive.
> > 
> > In fact the right question would be:
> > "what is the difference between req.write(bla) and return bla ?"
> 
> Very little. When you return something using mod_python.publisher, it 
> still calls req.write() internally.
> 
> Perhaps the biggest difference is that mod_python.publisher calls 
> req.write with flush=0, whereas the default is flush=1.
> 
> This could have implications concerning the setting of the 
> Content-Length header versus use of Transfer-Encoding: chunked. (I'm not
> 100% sure about that, but I have the idea that by not immediately 
> flushing to the client Apache may be able to set the Content-Length header).

Correct. One can use:

  req.add_output_filter('CONTENT_LENGTH')

and provided all writes have flush=0, Apache will be able to set the
content length output header for you automatically.

Obviously, in doing this, all the content is buffered up within Apache
so doing it on very large files would not be a good idea.

The AddOutputFilter directive can also be used in the Apache
configuration to add this output filter to the processing chain.

Graham

> On the other hand, your client is using HTTP/1.0 which may introduce 
> other complications. (IIRC HTTP/1.0 does not support Transfer-Encoding)
> 
>   > Firefox browser is certainly http-tolerant and can manage some
> > "imperfect" http dialogs.
> > Of course, the problem I meet could be caused by bad implementation in
> > MyHttpClient side.
> > But the same comp in the sames conditions fails when response is 
> > "written" and works fine when the response is "returned", bizare non
> ?
> 
> I suspect it may be some implementation detail in your client.
> 
> Jim
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
From mir at miras.org  Thu Jan  4 04:25:08 2007
From: mir at miras.org (Michael Rasmussen)
Date: Thu Jan  4 04:25:04 2007
Subject: [mod_python] session and psp.redirect
Message-ID: <20070104102508.2c9826be@localhost>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hi list,

New to mod_python so forgive me if I am asking stupid questions:-)

I have found a strange behaviour of psp.redirect (internal redirect to
the same site) which has the side effect that when you use it all
information of the current session is lost. Is this what is suppose to
happen?

$ dpkg -s apache2
Package: apache2
Status: install ok installed
Priority: optional
Section: web
Installed-Size: 80
Maintainer: Debian Apache Maintainers <debian-apache@lists.debian.org>
Architecture: i386
Version: 2.0.54-5sarge1

$ dpkg -s libapache2-mod-python (own backport from Sid)
Package: libapache2-mod-python
Status: install ok installed
Priority: optional
Section: python
Installed-Size: 324
Maintainer: Debian Python Modules Team
<python-modules-team@lists.alioth.debian.org> Architecture: i386
Version: 3.2.10-3

$ dpkg -s python2.4
Package: python2.4
Status: install ok installed
Priority: optional
Section: python
Installed-Size: 11176
Maintainer: Matthias Klose <doko@debian.org>
Architecture: i386
Version: 2.4.1-2sarge1

- -- 
Hilsen/Regards
Michael Rasmussen

Get my public GnuPG keys:
michael <at> rasmussen <dot> cc
http://keyserver.veridis.com:11371/pks/lookup?op=get&search=0xD3C9A00E
mir <at> datanom <dot> net
http://keyserver.veridis.com:11371/pks/lookup?op=get&search=0xE501F51C
mir <at> miras <dot> org
http://keyserver.veridis.com:11371/pks/lookup?op=get&search=0xE3E80917
- --------------------------------------------------------------
Say what you mean, simply and directly.
            - The Elements of Programming Style (Kernighan & Plaugher)
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)

iD8DBQFFnMf1VErYVePoCRcRAkngAJ4gJ4LdSTAn85pOM7OYE62horSYKACeJn/2
b0bndypCEjLfnNZ7SmvZG2s=
=QHDs
-----END PGP SIGNATURE-----

From alex.greif at gmail.com  Thu Jan  4 05:36:42 2007
From: alex.greif at gmail.com (Alex Greif)
Date: Thu Jan  4 05:36:48 2007
Subject: [mod_python] dynamic psp include directive
Message-ID: <778770d80701040236o3c9da519h81c41436c1960319@mail.gmail.com>

Hi,

in the manual only static include is mentioned like
<%@ include filename="page.html" %>

Is there a way to use the filename value dinymically?
I need something like this:
The page variabel can have different values

include this page: <%=page %>
<%@ include filename=page %>


Thanks,
ALex.
From martijn at xs4us.nu  Thu Jan  4 06:20:43 2007
From: martijn at xs4us.nu (Martijn Moeling)
Date: Thu Jan  4 06:21:16 2007
Subject: [mod_python] Returned filename question
Message-ID: <B6C73A5E30565245BB6D32B5F5DF7A521202BE@sense.emmastraat.pijnacker>

Hi,

I was just checking my apache access_log to see if and how the spidering
by Google was going and I found some strange behavior I cannot explain:

cat /var/log/httpd/access_log |grep Googlebot

all the lines I see are like:

66.249.65.15 - - [01/Jan/2007:15:43:54 +0100] "GET /zsswsirofodgrdu.html
HTTP/1.1" 404 298 "-" "Mozilla/5.0 (compatible; Googlebot/2.1;
+http://www.google.com/bot.html)"

Please note the: GET /zsswsirofodgrdu.html

I am seeing this since I upgraded to MP 3.3.0b, I have searched the DOCs
but for some reason I cannot find out where Google gets the filename
from....

-----------------------

One other Interesting thing is that since I started to compile MP myself
(not using standard installed or RMP versions). The creation of .pyc
(and or .pyo) files stopped working. I have read some articles in the
mailinglist archives I found about that, but they seem to be protection
related, and I have not changed a bit other than an upgrade to Python
2.5 and then an upgrade of MP to 3.3.0b, any suggestions?

Martijn


From clodoaldo.pinto.neto at gmail.com  Thu Jan  4 07:19:31 2007
From: clodoaldo.pinto.neto at gmail.com (Clodoaldo)
Date: Thu Jan  4 07:19:37 2007
Subject: [mod_python] Returned filename question
In-Reply-To: <B6C73A5E30565245BB6D32B5F5DF7A521202BE@sense.emmastraat.pijnacker>
References: <B6C73A5E30565245BB6D32B5F5DF7A521202BE@sense.emmastraat.pijnacker>
Message-ID: <a595de7a0701040419u5858e2c2y4c3c1f04476c80de@mail.gmail.com>

2007/1/4, Martijn Moeling <martijn@xs4us.nu>:
> Hi,
>
> I was just checking my apache access_log to see if and how the spidering
> by Google was going and I found some strange behavior I cannot explain:
>
> cat /var/log/httpd/access_log |grep Googlebot
>
> all the lines I see are like:
>
> 66.249.65.15 - - [01/Jan/2007:15:43:54 +0100] "GET /zsswsirofodgrdu.html
> HTTP/1.1" 404 298 "-" "Mozilla/5.0 (compatible; Googlebot/2.1;
> +http://www.google.com/bot.html)"
>
> Please note the: GET /zsswsirofodgrdu.html
>
> I am seeing this since I upgraded to MP 3.3.0b, I have searched the DOCs
> but for some reason I cannot find out where Google gets the filename
> from....

He makes the filename up such as not to find that page on purpose. He
is testing how do you handle not found documents. Why he is doing that
more than a few times I don't know.

Regards,
-- 
Clodoaldo Pinto Neto
From grahamd at dscpl.com.au  Thu Jan  4 16:21:57 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Jan  4 16:22:02 2007
Subject: [mod_python] Returned filename question
Message-ID: <1167945717.24631@dscpl.user.openhosting.com>

Martijn Moeling wrote ..
> One other Interesting thing is that since I started to compile MP myself
> (not using standard installed or RMP versions). The creation of .pyc
> (and or .pyo) files stopped working. I have read some articles in the
> mailinglist archives I found about that, but they seem to be protection
> related, and I have not changed a bit other than an upgrade to Python
> 2.5 and then an upgrade of MP to 3.3.0b, any suggestions?

In mod_python 3.3, the new module importer does not use the standard
Python module importer mechanisms for dealing with file based modules
which are to be candidates for module reloading. As a consequence, you
will no longer see .pyc or .pyo files. Such files were often a security hole
anyway, as many didn't properly setup Apache so as to prevent users
from downloading them. As a consequence, someone could decompile
them and perhaps get sensitive information out of them.

Graham
From grahamd at dscpl.com.au  Thu Jan  4 16:26:44 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Jan  4 16:26:51 2007
Subject: [mod_python] session and psp.redirect
Message-ID: <1167946004.26960@dscpl.user.openhosting.com>

Michael Rasmussen wrote ..
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
> 
> Hi list,
> 
> New to mod_python so forgive me if I am asking stupid questions:-)
> 
> I have found a strange behaviour of psp.redirect (internal redirect to
> the same site) which has the side effect that when you use it all
> information of the current session is lost. Is this what is suppose to
> happen?

By default, PSP only performs a save of the session for you at the end
of the request. If you are going to perform a redirect within a page to
another page, you will need to save the session object first as the act
of redirecting causes the save to be skipped. Ie.,

  session.save()
  psp.redirect(...)

Graham
From mir at miras.org  Fri Jan  5 04:53:17 2007
From: mir at miras.org (Michael Rasmussen)
Date: Fri Jan  5 04:53:13 2007
Subject: [mod_python] Application session
Message-ID: <20070105105317.2059b328@localhost>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hi all,

I have got that impression that installing modules/packages at
application level*) is not possible. I wonder if modules loaded from
one session is accessible from other concurrent sessions?

Is there a way to have modules loaded which is accessible for all
running sessions?


*) when I refer to application level I compare it to the feature from
JSP/Servlets/Beans from Java
- -- 
Hilsen/Regards
Michael Rasmussen

Get my public GnuPG keys:
michael <at> rasmussen <dot> cc
http://keyserver.veridis.com:11371/pks/lookup?op=get&search=0xD3C9A00E
mir <at> datanom <dot> net
http://keyserver.veridis.com:11371/pks/lookup?op=get&search=0xE501F51C
mir <at> miras <dot> org
http://keyserver.veridis.com:11371/pks/lookup?op=get&search=0xE3E80917
- --------------------------------------------------------------
The lunatic, the lover, and the poet,
Are of imagination all compact...
		-- Wm. Shakespeare, "A Midsummer Night's Dream"
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)

iD8DBQFFniANVErYVePoCRcRAgswAJ0a1ml0q8eEN60fMRSOc0Py/j2rgQCfX7A6
XQIHlm2rZrUy2/yvmmMacTE=
=B8oh
-----END PGP SIGNATURE-----

From martijn at xs4us.nu  Fri Jan  5 05:32:39 2007
From: martijn at xs4us.nu (Martijn Moeling)
Date: Fri Jan  5 05:32:47 2007
Subject: [mod_python] Returned filename question
Message-ID: <B6C73A5E30565245BB6D32B5F5DF7A521202C0@sense.emmastraat.pijnacker>

I see,

I have no .py's in my www/html at all, since I have used
mod_python.importer.path. index.py is a static link to the correct
python module in the configured directory.

I use PythonOptimeize On and I. What if I upload .pyc files to my
production server? Does it influence performance?

Martijn

-----Oorspronkelijk bericht-----
Van: Graham Dumpleton [mailto:grahamd@dscpl.com.au] 
Verzonden: Thursday, January 04, 2007 10:22 PM
Aan: Martijn Moeling
CC: mod_python@modpython.org
Onderwerp: Re: [mod_python] Returned filename question

Martijn Moeling wrote ..
> One other Interesting thing is that since I started to compile MP
myself
> (not using standard installed or RMP versions). The creation of .pyc
> (and or .pyo) files stopped working. I have read some articles in the
> mailinglist archives I found about that, but they seem to be
protection
> related, and I have not changed a bit other than an upgrade to Python
> 2.5 and then an upgrade of MP to 3.3.0b, any suggestions?

In mod_python 3.3, the new module importer does not use the standard
Python module importer mechanisms for dealing with file based modules
which are to be candidates for module reloading. As a consequence, you
will no longer see .pyc or .pyo files. Such files were often a security
hole
anyway, as many didn't properly setup Apache so as to prevent users
from downloading them. As a consequence, someone could decompile
them and perhaps get sensitive information out of them.

Graham

From grahamd at dscpl.com.au  Fri Jan  5 19:34:04 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Fri Jan  5 19:35:36 2007
Subject: [mod_python] Returned filename question
In-Reply-To: <B6C73A5E30565245BB6D32B5F5DF7A521202C0@sense.emmastraat.pijnacker>
References: <B6C73A5E30565245BB6D32B5F5DF7A521202C0@sense.emmastraat.pijnacker>
Message-ID: <DAF329EB-6EAA-41CB-A0B6-9C90312DF8A3@dscpl.com.au>


On 05/01/2007, at 9:32 PM, Martijn Moeling wrote:

> I see,
>
> I have no .py's in my www/html at all, since I have used
> mod_python.importer.path. index.py is a static link to the correct
> python module in the configured directory.
>
> I use PythonOptimeize On and I. What if I upload .pyc files to my
> production server? Does it influence performance?

Where the new module importer is what is doing the importing, ie., it
is something not on sys.path, even if there were .pyc files they would
be ignored.

For stuff on sys.path managed by standard Python module importer,
it may use such .pyc files, but given long running nature of Apache
processes anyway, any benefit wouldn't be anything that you notice as
it only comes into play once when module first loaded.

In short, don't go out of your way to generate and upload .pyc files
as it isn't going to make a noticeable difference.

Graham

> Martijn
>
> -----Oorspronkelijk bericht-----
> Van: Graham Dumpleton [mailto:grahamd@dscpl.com.au]
> Verzonden: Thursday, January 04, 2007 10:22 PM
> Aan: Martijn Moeling
> CC: mod_python@modpython.org
> Onderwerp: Re: [mod_python] Returned filename question
>
> Martijn Moeling wrote ..
>> One other Interesting thing is that since I started to compile MP
> myself
>> (not using standard installed or RMP versions). The creation of .pyc
>> (and or .pyo) files stopped working. I have read some articles in the
>> mailinglist archives I found about that, but they seem to be
> protection
>> related, and I have not changed a bit other than an upgrade to Python
>> 2.5 and then an upgrade of MP to 3.3.0b, any suggestions?
>
> In mod_python 3.3, the new module importer does not use the standard
> Python module importer mechanisms for dealing with file based modules
> which are to be candidates for module reloading. As a consequence, you
> will no longer see .pyc or .pyo files. Such files were often a  
> security
> hole
> anyway, as many didn't properly setup Apache so as to prevent users
> from downloading them. As a consequence, someone could decompile
> them and perhaps get sensitive information out of them.
>
> Graham
From grahamd at dscpl.com.au  Fri Jan  5 19:38:14 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Fri Jan  5 19:39:43 2007
Subject: [mod_python] Application session
In-Reply-To: <20070105105317.2059b328@localhost>
References: <20070105105317.2059b328@localhost>
Message-ID: <4D3CB0D7-94F2-4009-9FC6-8596C74F88C0@dscpl.com.au>

For starters read:

   http://www.dscpl.com.au/wiki/ModPython/Articles/ 
TheProcessInterpreterModel

You might then perhaps explain better what you are talking about.

In short, any module that is imported within the context of a Python
interpreter instance is usable by any handler executing within that
Python interpreter instance in that process. This is totally  
unrelated to
user sessions created as a result of some form based/login mechanism.

What isn't clear is whether when you say 'sessions' you are talking
about user sessions or merely concurrent executing request handlers.

Graham

On 05/01/2007, at 8:53 PM, Michael Rasmussen wrote:

> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> Hi all,
>
> I have got that impression that installing modules/packages at
> application level*) is not possible. I wonder if modules loaded from
> one session is accessible from other concurrent sessions?
>
> Is there a way to have modules loaded which is accessible for all
> running sessions?
>
>
> *) when I refer to application level I compare it to the feature from
> JSP/Servlets/Beans from Java
> - --
> Hilsen/Regards
> Michael Rasmussen
>
> Get my public GnuPG keys:
> michael <at> rasmussen <dot> cc
> http://keyserver.veridis.com:11371/pks/lookup?op=get&search=0xD3C9A00E
> mir <at> datanom <dot> net
> http://keyserver.veridis.com:11371/pks/lookup?op=get&search=0xE501F51C
> mir <at> miras <dot> org
> http://keyserver.veridis.com:11371/pks/lookup?op=get&search=0xE3E80917
> - --------------------------------------------------------------
> The lunatic, the lover, and the poet,
> Are of imagination all compact...
> 		-- Wm. Shakespeare, "A Midsummer Night's Dream"
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.6 (GNU/Linux)
>
> iD8DBQFFniANVErYVePoCRcRAgswAJ0a1ml0q8eEN60fMRSOc0Py/j2rgQCfX7A6
> XQIHlm2rZrUy2/yvmmMacTE=
> =B8oh
> -----END PGP SIGNATURE-----
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
From chris at tarot.com  Fri Jan  5 19:54:58 2007
From: chris at tarot.com (Christopher Hiller)
Date: Fri Jan  5 19:55:17 2007
Subject: [mod_python] 0-byte PSP?
Message-ID: <C1C43362.477A%chris@tarot.com>

Hi, I'm trying to get PSP working, but I'm having trouble.

This is my configuration:

Apache/2.2.3 (Debian) DAV/2 SVN/1.4.2 mod_python/3.2.10 Python/2.4.4
PHP/5.2.0-8

I'm using the code near the bottom under 'using PSP as a template mechanism'
on this page: http://www.modpython.org/live/current/doc-html/pyapi-psp.html.
The code:

----
from mod_python import apache, psp

def handler(req):
    template = psp.PSP(req, filename='template.html')
    template.run({'what':'world'})
    return apache.OK
----

and the template:
----


<html>
  <!-- This is a simple psp template called template.html -->
  <h1>Hello, <%=what%>!</h1>
</html>

----

My PythonHandler is 'arie' (arie.py) and my template is 'template.html'.
PythonDebug is ON.

However, when I hit my web server, I get a 0-byte file.  Empty.  Absolutely
nothing.  It seems to fail silently.  My error_log gives:

[Fri Jan 05 16:44:13 2007] [notice] mod_python: (Re)importing module 'arie'

So I know *something* is working, but I have no further information.  The
mod_python.publisher handler seems to work OK, and I'd like to eventually
use PSP and Publisher in tandem, but I can't seem to get this (or the
psp_site example) working at all.

Anyone have any insight?  Point me in the right direction?  thanks.

Chris
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 2135 bytes
Desc: not available
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070105/975667e7/smime.bin
From martijn at xs4us.nu  Sat Jan  6 08:32:51 2007
From: martijn at xs4us.nu (Martijn Moeling)
Date: Sat Jan  6 08:33:02 2007
Subject: [mod_python] Returned filename question (updated)
Message-ID: <B6C73A5E30565245BB6D32B5F5DF7A521202C1@sense.emmastraat.pijnacker>

Hi,

I was just checking my apache access_log to see if and how the spidering
by Google was going and I found some strange behavior I cannot explain:

cat /var/log/httpd/access_log |grep Googlebot

all the lines I see are like:

66.249.65.15 - - [01/Jan/2007:15:43:54 +0100] "GET /zsswsirofodgrdu.html
HTTP/1.1" 404 298 "-" "Mozilla/5.0 (compatible; Googlebot/2.1;
+http://www.google.com/bot.html)"

Please note the: GET /zsswsirofodgrdu.html

I am seeing this since I upgraded to MP 3.3.0b, I have searched the DOCs
but for some reason I cannot find out where Google gets the filename
from....

It seems like MP is returning a random filename now.

The requests send are always http://www2.lokalos.nl or
http://www2.lokalos.nl/?pr=drenthe 

Should I include a filename in my URL's? if I do :
http://www2.lokalos.nl/index.py?pr=drenthe 
Or is there any way I can force MP/Apace to return the filename index.py
an force to overwrite the automatic returned filename (like
fhgdjhlkgjhfhg.html)

Martijn

From grahamd at dscpl.com.au  Sat Jan  6 19:31:51 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sat Jan  6 19:32:10 2007
Subject: [mod_python] Returned filename question (updated)
In-Reply-To: <B6C73A5E30565245BB6D32B5F5DF7A521202C1@sense.emmastraat.pijnacker>
References: <B6C73A5E30565245BB6D32B5F5DF7A521202C1@sense.emmastraat.pijnacker>
Message-ID: <14818968-C5B2-4BDE-91C1-F8B114F9806E@dscpl.com.au>


On 07/01/2007, at 12:32 AM, Martijn Moeling wrote:

> Hi,
>
> I was just checking my apache access_log to see if and how the  
> spidering
> by Google was going and I found some strange behavior I cannot  
> explain:
>
> cat /var/log/httpd/access_log |grep Googlebot
>
> all the lines I see are like:
>
> 66.249.65.15 - - [01/Jan/2007:15:43:54 +0100] "GET / 
> zsswsirofodgrdu.html
> HTTP/1.1" 404 298 "-" "Mozilla/5.0 (compatible; Googlebot/2.1;
> +http://www.google.com/bot.html)"
>
> Please note the: GET /zsswsirofodgrdu.html
>
> I am seeing this since I upgraded to MP 3.3.0b, I have searched the  
> DOCs
> but for some reason I cannot find out where Google gets the filename
> from....
>
> It seems like MP is returning a random filename now.

Not likely to be anything to do with mod_python.

First off, it is Apache which logs to the access_log file and not  
mod_python.
Apache will use whatever is set in req.filename at the end of the  
request.
The value of req.filename isn't changed by mod_python although a user
level mod_python handler could change it.

That the HTTP status code is 404 though suggests that it isn't even  
getting
to a response handler and so mod_python isn't likely being invoked.  
It simply
looks like that is what Google is actually asking for.

Graham

> The requests send are always http://www2.lokalos.nl or
> http://www2.lokalos.nl/?pr=drenthe
>
> Should I include a filename in my URL's? if I do :
> http://www2.lokalos.nl/index.py?pr=drenthe
> Or is there any way I can force MP/Apace to return the filename  
> index.py
> an force to overwrite the automatic returned filename (like
> fhgdjhlkgjhfhg.html)
>
> Martijn
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
From mir at miras.org  Sat Jan  6 21:49:35 2007
From: mir at miras.org (Michael Rasmussen)
Date: Sat Jan  6 22:08:52 2007
Subject: [mod_python] Application session
Message-ID: <AA936A63-C626-4833-BE49-CEC277DF733B@miras.org>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hi Graham,

I might have solve my problems. Your article helped a lot.
Read my solution a clarification of my problem below.

On Sat, 6 Jan 2007 11:38:14 +1100
Graham Dumpleton <grahamd@dscpl.com.au> wrote:

>
> You might then perhaps explain better what you are talking about.
>
> In short, any module that is imported within the context of a Python
> interpreter instance is usable by any handler executing within that
> Python interpreter instance in that process. This is totally
> unrelated to
> user sessions created as a result of some form based/login mechanism.
>
> What isn't clear is whether when you say 'sessions' you are talking
> about user sessions or merely concurrent executing request handlers.
>
The picture:

I have an application which provides admin users the ability to add
extensions into the runtime. These extensions must be available to all
users as soon as they are instantiated without the users needs for
restarting their sessions. The extensions must also be persistent in
the runtime until either the application/apache is restarted or they
deactivated by the admin users. Had the application been programmed in
Java - JSP/Servlets, such extensions would have be stored in the
application session: <jsp:useBean id="applicationBean"
class="some.Bean" scope="application" />. This means that for any user
session currently and later on can access the bean and its members. In
Java/JSP you operate with four different kinds of scope: page, request,
session and application. the first three are all related to the same
user session in the said application while the last one is related to
the application instance and the by nature related to all users of the
application. Studying your article proved to me that mod_python does
not provide application scope directly?

My application is running in apache under GNU/Linux so it is restricted
to the problems described in your article - prefork and worker. By the
way does this problem also apply to MPM worker?

What I have found out is this:
I thought I could create a class implementing the singleton pattern and
store an instance of the class to the request object but even if a
directory/virtual host only designates one python handler one cannot
rely on that all instances will share the same python
runtime/pythonHandler due to apache's forking nature so this was a
dead-end.

So my final solution was to create the said singleton class and in this
class save private attributes with instance information of the object
store in dictionaries and then use cPickle to store and load the
object's state. Since I cannot control when an instance of the
singleton class is unloaded from the session I was forced to save the
state of the object every time the object's state change.

If anybody is interested you can find my solution below

"""
IPCop Module Loader.

This module is licensed under GPL and is part of the UI to IPCop.
Read online documentation <http://www.ipcop.org>.

Copyright: 2006, Michael Rasmussen <mir@datanom.net>

Last maintainer: 2006-08-21 18:57 +0200 Michael Rasmussen
<mir@datanom.net>

Previous maintainers:

If you find any bugs or have any comments please send an email to
Michael Rasmussen <mir@datanom.net>
"""

VERSION = "0.1"

import os, sys, new, cPickle, anydbm, tempfile, ModuleImporter

class ModuleLoaderException(Exception):
     def __init__(self, msg):
         self.value = msg

     def __str__(self):
         return repr(self.value)

class ModuleLoader:
     """
         Available modules contains reference to
         registered modules.
         Key: ModuleId
         Item: Reference to a module
     """

     __instance = None

     def __init__(self):
         if ModuleLoader.__instance is None :
             ModuleLoader.__instance = ModuleLoader.__singleton()
         self.__dict__['_ModuleLoader__instance'] =
ModuleLoader.__instance def __getattr__(self, attr):
         return getattr(self.__instance, attr)

     def __setattr__(self, attr, value):
         return setattr(self.__instance, attr, value)

     class __singleton:

         def __init__(self):
             dbmIn = anydbm.open(tempfile.gettempdir() +
		"/ipcop_modules.dbm", "c")
	    try:
                 self.__availableModules =
                     cPickle.loads(dbmIn["availableModules"])
             except KeyError:
                 self.__availableModules = {}
             try:
                 self.__activeModules =
                     cPickle.loads(dbmIn["activeModules"])
             except KeyError:
                 self.__activeModules = {}
             dbmIn.close()

         def getModulesList(self):
             try:
                 return self.__availableModules
             except AttributeError:
                 return {}

         def setModulesList(self, list):
             self.__availableModules = list
             dbmOut = anydbm.open(tempfile.gettempdir() +
                 "/ipcop_modules.dbm", "c")
             dbmOut["availableModules"] =
                 cPickle.dumps(self.getModulesList(), 1)
             dbmOut.close()

         def setAvailableModule(self, name, desc):
             self.__availableModules[name] = desc
             dbmOut = anydbm.open(tempfile.gettempdir() +
                 "/ipcop_modules.dbm", "c")
             dbmOut["availableModules"] =
                 cPickle.dumps(self.getModulesList(), 1)
             dbmOut.close()

         def register(self, module, path = None):
             try:
                 if path != None:
                     if (path.find(".") != -1):
                         raise ModuleLoaderException("Illegal character
in path")
                     if (not path.startswith("/")):
                         if (os.getcwd() != '/'):
                             path = os.getcwd() + "/" + path
                         else:
                             path = "/" + path
                     if (path in sys.path):
                         pass
                     else:
                         sys.path.append(path)
                 mod = ModuleImporter.get_mod(module)
                 try:
                     modules = getattr(mod,"__all__")
                     for m in modules:
                         self.register(module + "." + m)
                 except AttributeError:
                     lastDot = module.rfind(u".")
                     module = module[lastDot + 1:]
                     self.setAvailableModule(module, getattr(mod,
"__name__"))
                     ModuleImporter.del_mod(getattr(mod, "__name__"))
             except Exception, ex:
                 raise ModuleLoaderException("Loading module: %s" % ex)

         def unregister(self, module):
             """ unregister """
             t = self.getModulesList()
             del t[module]
             self.setModulesList(t)
             dbmOut = anydbm.open(tempfile.gettempdir() +
"/ipcop_modules.dbm", "c")
             dbmOut["availableModules"] =
cPickle.dumps(self.getModulesList(), 1)
             dbmOut.close()
             ModuleImporter.del_mod(getattr(module, "__name__"))

- --
Hilsen/Regards
Michael Rasmussen

Get my public GnuPG keys:
michael <at> rasmussen <dot> cc
http://keyserver.veridis.com:11371/pks/lookup?op=get&search=0xD3C9A00E
mir <at> datanom <dot> net
http://keyserver.veridis.com:11371/pks/lookup?op=get&search=0xE501F51C
mir <at> miras <dot> org
http://keyserver.veridis.com:11371/pks/lookup?op=get&search=0xE3E80917
- --------------------------------------------------------------
It's all in the mind, ya know.
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)

iD8DBQFFoF+/VErYVePoCRcRAtV3AKCiqlVRGu+l8KVno28zxC/6tkl4cgCfQU4L
5Rb3VaXrFtWehT7S5Al+2nk=
=io+9
-----END PGP SIGNATURE-----
From grahamd at dscpl.com.au  Sun Jan  7 00:46:13 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sun Jan  7 00:46:25 2007
Subject: [mod_python] Application session
In-Reply-To: <20070107034935.35e44f46@localhost>
References: <20070105105317.2059b328@localhost>
	<4D3CB0D7-94F2-4009-9FC6-8596C74F88C0@dscpl.com.au>
	<20070107034935.35e44f46@localhost>
Message-ID: <C118744D-FC58-450B-B83D-366D061F4550@dscpl.com.au>

Have forwarded this back to the list. Please keep followups there.

Depending on what you are doing, you might want to look at memcached
for Python as a way of sharing memory between Apache child processes.
Alternatively, look at XML-RPC as a way to connect to a long lived back
end process which contains the true application.

For even more complicated systems, can also suggest messaging system
based solutions for communicating with a back end system. These have
the benefit of not requiring a separate socket connection for each  
request
like XML-RPC does. Down the track, if interested in these, let me know.

Graham

On 07/01/2007, at 1:49 PM, Michael Rasmussen wrote:

> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> Hi Graham,
>
> I might have solve my problems. Your article helped a lot.
> Read my solution a clarification of my problem below.
>
> On Sat, 6 Jan 2007 11:38:14 +1100
> Graham Dumpleton <grahamd@dscpl.com.au> wrote:
>
>>
>> You might then perhaps explain better what you are talking about.
>>
>> In short, any module that is imported within the context of a Python
>> interpreter instance is usable by any handler executing within that
>> Python interpreter instance in that process. This is totally
>> unrelated to
>> user sessions created as a result of some form based/login mechanism.
>>
>> What isn't clear is whether when you say 'sessions' you are talking
>> about user sessions or merely concurrent executing request handlers.
>>
> The picture:
>
> I have an application which provides admin users the ability to add
> extensions into the runtime. These extensions must be available to all
> users as soon as they are instantiated without the users needs for
> restarting their sessions. The extensions must also be persistent in
> the runtime until either the application/apache is restarted or they
> deactivated by the admin users. Had the application been programmed in
> Java - JSP/Servlets, such extensions would have be stored in the
> application session: <jsp:useBean id="applicationBean"
> class="some.Bean" scope="application" />. This means that for any user
> session currently and later on can access the bean and its members. In
> Java/JSP you operate with four different kinds of scope: page,  
> request,
> session and application. the first three are all related to the same
> user session in the said application while the last one is related to
> the application instance and the by nature related to all users of the
> application. Studying your article proved to me that mod_python does
> not provide application scope directly?
>
> My application is running in apache under GNU/Linux so it is  
> restricted
> to the problems described in your article - prefork and worker. By the
> way does this problem also apply to MPM worker?
>
> What I have found out is this:
> I thought I could create a class implementing the singleton pattern  
> and
> store an instance of the class to the request object but even if a
> directory/virtual host only designates one python handler one cannot
> rely on that all instances will share the same python
> runtime/pythonHandler due to apache's forking nature so this was a
> dead-end.
>
> So my final solution was to create the said singleton class and in  
> this
> class save private attributes with instance information of the object
> store in dictionaries and then use cPickle to store and load the
> object's state. Since I cannot control when an instance of the
> singleton class is unloaded from the session I was forced to save the
> state of the object every time the object's state change.
>
> If anybody is interested you can find my solution below
>
> """
> IPCop Module Loader.
>
> This module is licensed under GPL and is part of the UI to IPCop.
> Read online documentation <http://www.ipcop.org>.
>
> Copyright: 2006, Michael Rasmussen <mir@datanom.net>
>
> Last maintainer: 2006-08-21 18:57 +0200 Michael Rasmussen
> <mir@datanom.net>
>
> Previous maintainers:
>
> If you find any bugs or have any comments please send an email to
> Michael Rasmussen <mir@datanom.net>
> """
>
> VERSION = "0.1"
>
> import os, sys, new, cPickle, anydbm, tempfile, ModuleImporter
>
> class ModuleLoaderException(Exception):
>     def __init__(self, msg):
>         self.value = msg
>
>     def __str__(self):
>         return repr(self.value)
>
> class ModuleLoader:
>     """
>         Available modules contains reference to
>         registered modules.
>         Key: ModuleId
>         Item: Reference to a module
>     """
>
>     __instance = None
>
>     def __init__(self):
>         if ModuleLoader.__instance is None :
>             ModuleLoader.__instance = ModuleLoader.__singleton()
>         self.__dict__['_ModuleLoader__instance'] =
> ModuleLoader.__instance def __getattr__(self, attr):
>         return getattr(self.__instance, attr)
>
>     def __setattr__(self, attr, value):
>         return setattr(self.__instance, attr, value)
>
>     class __singleton:
>
>         def __init__(self):
>             dbmIn = anydbm.open(tempfile.gettempdir() +
> 		"/ipcop_modules.dbm", "c")
> 	    try:
>                 self.__availableModules =
>                     cPickle.loads(dbmIn["availableModules"])
>             except KeyError:
>                 self.__availableModules = {}
>             try:
>                 self.__activeModules =
>                     cPickle.loads(dbmIn["activeModules"])
>             except KeyError:
>                 self.__activeModules = {}
>             dbmIn.close()
>
>         def getModulesList(self):
>             try:
>                 return self.__availableModules
>             except AttributeError:
>                 return {}
>
>         def setModulesList(self, list):
>             self.__availableModules = list
>             dbmOut = anydbm.open(tempfile.gettempdir() +
>                 "/ipcop_modules.dbm", "c")
>             dbmOut["availableModules"] =
>                 cPickle.dumps(self.getModulesList(), 1)
>             dbmOut.close()
>
>         def setAvailableModule(self, name, desc):
>             self.__availableModules[name] = desc
>             dbmOut = anydbm.open(tempfile.gettempdir() +
>                 "/ipcop_modules.dbm", "c")
>             dbmOut["availableModules"] =
>                 cPickle.dumps(self.getModulesList(), 1)
>             dbmOut.close()
>
>         def register(self, module, path = None):
>             try:
>                 if path != None:
>                     if (path.find(".") != -1):
>                         raise ModuleLoaderException("Illegal character
> in path")
>                     if (not path.startswith("/")):
>                         if (os.getcwd() != '/'):
>                             path = os.getcwd() + "/" + path
>                         else:
>                             path = "/" + path
>                     if (path in sys.path):
>                         pass
>                     else:
>                         sys.path.append(path)
>                 mod = ModuleImporter.get_mod(module)
>                 try:
>                     modules = getattr(mod,"__all__")
>                     for m in modules:
>                         self.register(module + "." + m)
>                 except AttributeError:
>                     lastDot = module.rfind(u".")
>                     module = module[lastDot + 1:]
>                     self.setAvailableModule(module, getattr(mod,
> "__name__"))
>                     ModuleImporter.del_mod(getattr(mod, "__name__"))
>             except Exception, ex:
>                 raise ModuleLoaderException("Loading module: %s" % ex)
>
>         def unregister(self, module):
>             """ unregister """
>             t = self.getModulesList()
>             del t[module]
>             self.setModulesList(t)
>             dbmOut = anydbm.open(tempfile.gettempdir() +
> "/ipcop_modules.dbm", "c")
>             dbmOut["availableModules"] =
> cPickle.dumps(self.getModulesList(), 1)
>             dbmOut.close()
>             ModuleImporter.del_mod(getattr(module, "__name__"))
>
> - --
> Hilsen/Regards
> Michael Rasmussen
>
> Get my public GnuPG keys:
> michael <at> rasmussen <dot> cc
> http://keyserver.veridis.com:11371/pks/lookup?op=get&search=0xD3C9A00E
> mir <at> datanom <dot> net
> http://keyserver.veridis.com:11371/pks/lookup?op=get&search=0xE501F51C
> mir <at> miras <dot> org
> http://keyserver.veridis.com:11371/pks/lookup?op=get&search=0xE3E80917
> - --------------------------------------------------------------
> It's all in the mind, ya know.
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.6 (GNU/Linux)
>
> iD8DBQFFoF+/VErYVePoCRcRAtV3AKCiqlVRGu+l8KVno28zxC/6tkl4cgCfQU4L
> 5Rb3VaXrFtWehT7S5Al+2nk=
> =io+9
> -----END PGP SIGNATURE-----
From mir at miras.org  Sun Jan  7 04:54:32 2007
From: mir at miras.org (Michael Rasmussen)
Date: Sun Jan  7 04:54:38 2007
Subject: [mod_python] Application session
In-Reply-To: <C118744D-FC58-450B-B83D-366D061F4550@dscpl.com.au>
References: <20070105105317.2059b328@localhost>
	<4D3CB0D7-94F2-4009-9FC6-8596C74F88C0@dscpl.com.au>
	<20070107034935.35e44f46@localhost>
	<C118744D-FC58-450B-B83D-366D061F4550@dscpl.com.au>
Message-ID: <20070107105432.44d659ed@localhost>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On Sun, 7 Jan 2007 16:46:13 +1100
Graham Dumpleton <grahamd@dscpl.com.au> wrote:

> Have forwarded this back to the list. Please keep followups there.
> 
Sorry, I was not aware of that mails from the list does not set
reply-to to list.

> Depending on what you are doing, you might want to look at memcached
> for Python as a way of sharing memory between Apache child processes.
> Alternatively, look at XML-RPC as a way to connect to a long lived
> back end process which contains the true application.
> 
> For even more complicated systems, can also suggest messaging system
> based solutions for communicating with a back end system. These have
> the benefit of not requiring a separate socket connection for each  
> request
> like XML-RPC does. Down the track, if interested in these, let me
> know.
> 
God ideas.
memcached could be an option: pro fast, con looses stat when
apache restarts. This last issue sort of disqualifies it unless there
is a way of making the information persistent?

XML-RPC could be nice: pro very simple protocol and fast, I have
very in-depth knowledge of distributed applications using XML-RPC and
SOAP, con requires a socket for each connection. This last issue, in
theory, could be a problem since the system is supposed to be running
on a firewall - a lot of other active sockets. Then again, I do not
expect zillions of user to the admin interface:-)

Messaging system seems a bit overkill for my application.

To cut it down to a single line - one-liners are great:-)
The XML-RPC solution would be my first objective but if the persistent
problem with memcached has a solution I would prefer this. What is your
opinion to the matter?

PS. I have found a not so good issue with my solution. If an operation
requires both a read and a write it is not guarantied to be atomic.
This will have the effect, should I continue my present solution, that
it requires a separate handler which starts the persistent component in
a thread and stores a reference to this thread in the request
- -- 
Hilsen/Regards
Michael Rasmussen

Get my public GnuPG keys:
michael <at> rasmussen <dot> cc
http://keyserver.veridis.com:11371/pks/lookup?op=get&search=0xD3C9A00E
mir <at> datanom <dot> net
http://keyserver.veridis.com:11371/pks/lookup?op=get&search=0xE501F51C
mir <at> miras <dot> org
http://keyserver.veridis.com:11371/pks/lookup?op=get&search=0xE3E80917
- --------------------------------------------------------------
One good turn...Gets all the blankets.
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)

iD8DBQFFoMNYVErYVePoCRcRAj2zAJ9Xnpjx2RJyt/1WpRA3iyEK56hLbACdH7bK
TEg+mbwzI0XqtblCoSf9p74=
=2Rwz
-----END PGP SIGNATURE-----

From starke.m at gmx.de  Sun Jan  7 21:18:45 2007
From: starke.m at gmx.de (michael starke)
Date: Sun Jan  7 21:18:52 2007
Subject: [mod_python] Building Problems on OS X (intel macbook core2duo)
Message-ID: <49FB1138-02BD-4D4E-B6C0-8A4964EA8160@gmx.de>

Hello there,

i have a big problem and since i'm not to experinced witht the whole  
built from source way i want to ask you, if you know where the  
problem lies.

I have apache2 installed (built and running) in  /usr/local/apache2/...
I have python2.4 installed and running smoothly
I downloaded mod_python 3.2.10 and configured it with

	--with-apxs=/usr/local/apache2/bin/apxs
	--with-python=/usr/local/bin/python2.4

so the configure seems to work, but when i run make/make install at  
the end i get the error, that the build mod_python.so is not found,  
there is a symlink in the /src/ folder and it points to a .built/  
directory, but that is not there...

Having no clue what to do i'm asking for your help. The same routine  
(with apache 2.0.x) and differnent install locations worked fine on  
my powermac a year before but the installation on the macbook is not  
working the way it should be..obviously.

I can give you a logpart form make install, but i guess it's not  
really helping.

----------make install output------------

/usr/local/apache2/build/libtool --silent --mode=compile gcc -prefer- 
pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -g -O2 - 
I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/usr/ 
local/apache2/include  -I/Users/michael/Desktop/mod_python-3.2.10/src/ 
include -I/usr/local/apache2/include -I/Library/Frameworks/ 
Python.framework/Versions/2.4/include/python2.4  -c -o mod_python.lo  
mod_python.c && touch mod_python.slo
mod_python.c: In function 'python_cleanup':
mod_python.c:313: warning: passing argument 1 of 'free' discards  
qualifiers from pointer target type
mod_python.c: In function 'init_mutexes':
mod_python.c:427: warning: assignment discards qualifiers from  
pointer target type
mod_python.c:458: warning: assignment discards qualifiers from  
pointer target type
mod_python.c: In function 'reinit_mutexes':
mod_python.c:540: warning: assignment discards qualifiers from  
pointer target type
/usr/local/apache2/build/libtool --silent --mode=compile gcc -prefer- 
pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -g -O2 - 
I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/usr/ 
local/apache2/include  -I/Users/michael/Desktop/mod_python-3.2.10/src/ 
include -I/usr/local/apache2/include -I/Library/Frameworks/ 
Python.framework/Versions/2.4/include/python2.4  -c -o  
_apachemodule.lo _apachemodule.c && touch _apachemodule.slo
/usr/local/apache2/build/libtool --silent --mode=compile gcc -prefer- 
pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -g -O2 - 
I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/usr/ 
local/apache2/include  -I/Users/michael/Desktop/mod_python-3.2.10/src/ 
include -I/usr/local/apache2/include -I/Library/Frameworks/ 
Python.framework/Versions/2.4/include/python2.4  -c -o  
requestobject.lo requestobject.c && touch requestobject.slo
requestobject.c: In function 'req_get_options':
requestobject.c:426: warning: initialization discards qualifiers from  
pointer target type
requestobject.c:427: warning: initialization from incompatible  
pointer type
requestobject.c: In function 'getmakeobj':
requestobject.c:1447: warning: assignment from incompatible pointer type
requestobject.c:1454: warning: assignment from incompatible pointer type
requestobject.c: In function 'request_tp_clear':
requestobject.c:1569: warning: assignment from incompatible pointer type
/usr/local/apache2/build/libtool --silent --mode=compile gcc -prefer- 
pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -g -O2 - 
I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/usr/ 
local/apache2/include  -I/Users/michael/Desktop/mod_python-3.2.10/src/ 
include -I/usr/local/apache2/include -I/Library/Frameworks/ 
Python.framework/Versions/2.4/include/python2.4  -c -o tableobject.lo  
tableobject.c && touch tableobject.slo
tableobject.c:1057: warning: initialization from incompatible pointer  
type
/usr/local/apache2/build/libtool --silent --mode=compile gcc -prefer- 
pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -g -O2 - 
I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/usr/ 
local/apache2/include  -I/Users/michael/Desktop/mod_python-3.2.10/src/ 
include -I/usr/local/apache2/include -I/Library/Frameworks/ 
Python.framework/Versions/2.4/include/python2.4  -c -o util.lo util.c  
&& touch util.slo
/usr/local/apache2/build/libtool --silent --mode=compile gcc -prefer- 
pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -g -O2 - 
I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/usr/ 
local/apache2/include  -I/Users/michael/Desktop/mod_python-3.2.10/src/ 
include -I/usr/local/apache2/include -I/Library/Frameworks/ 
Python.framework/Versions/2.4/include/python2.4  -c -o  
serverobject.lo serverobject.c && touch serverobject.slo
serverobject.c:351: warning: initialization from incompatible pointer  
type
/usr/local/apache2/build/libtool --silent --mode=compile gcc -prefer- 
pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -g -O2 - 
I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/usr/ 
local/apache2/include  -I/Users/michael/Desktop/mod_python-3.2.10/src/ 
include -I/usr/local/apache2/include -I/Library/Frameworks/ 
Python.framework/Versions/2.4/include/python2.4  -c -o connobject.lo  
connobject.c && touch connobject.slo
/usr/local/apache2/build/libtool --silent --mode=compile gcc -prefer- 
pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -g -O2 - 
I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/usr/ 
local/apache2/include  -I/Users/michael/Desktop/mod_python-3.2.10/src/ 
include -I/usr/local/apache2/include -I/Library/Frameworks/ 
Python.framework/Versions/2.4/include/python2.4  -c -o  
filterobject.lo filterobject.c && touch filterobject.slo
/usr/local/apache2/build/libtool --silent --mode=compile gcc -prefer- 
pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -g -O2 - 
I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/usr/ 
local/apache2/include  -I/Users/michael/Desktop/mod_python-3.2.10/src/ 
include -I/usr/local/apache2/include -I/Library/Frameworks/ 
Python.framework/Versions/2.4/include/python2.4  -c -o hlist.lo  
hlist.c && touch hlist.slo
/usr/local/apache2/build/libtool --silent --mode=compile gcc -prefer- 
pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -g -O2 - 
I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/usr/ 
local/apache2/include  -I/Users/michael/Desktop/mod_python-3.2.10/src/ 
include -I/usr/local/apache2/include -I/Library/Frameworks/ 
Python.framework/Versions/2.4/include/python2.4  -c -o hlistobject.lo  
hlistobject.c && touch hlistobject.slo
/usr/local/apache2/build/libtool --silent --mode=link gcc -o  
mod_python.la  -rpath /usr/local/apache2/modules -module -avoid- 
version    hlistobject.lo hlist.lo filterobject.lo connobject.lo  
serverobject.lo util.lo tableobject.lo requestobject.lo  
_apachemodule.lo mod_python.lo -Wl,-framework,Python -u _PyMac_Error / 
Versions// -arch i386 -arch ppc -isysroot /Developer/SDKs/ 
MacOSX10.4u.sdk -g -lm -framework Python -ldl
install: src/mod_python.so: No such file or directory
make[1]: *** [install_dso] Error 71

---------------end make install output-------------------
From grahamd at dscpl.com.au  Sun Jan  7 23:42:28 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sun Jan  7 23:42:35 2007
Subject: [mod_python] Building Problems on OS X (intel macbook core2duo)
Message-ID: <1168231348.19084@dscpl.user.openhosting.com>

Can you try with the operating system supplied version of Python (2.3.5)
instead of your own compiled Python 2.4 as the build configuration
associated with your 2.4 version doesn't look right.

BTW, did you compiled your Python 2.4 from scratch? You might be better
off using one of the prebuilt dmg versions of Python instead as they tend
to be setup correctly and work in parallel to the OS version better.

Graham

michael starke wrote ..
> Hello there,
> 
> i have a big problem and since i'm not to experinced witht the whole  
> built from source way i want to ask you, if you know where the  
> problem lies.
> 
> I have apache2 installed (built and running) in  /usr/local/apache2/...
> I have python2.4 installed and running smoothly
> I downloaded mod_python 3.2.10 and configured it with
> 
> 	--with-apxs=/usr/local/apache2/bin/apxs
> 	--with-python=/usr/local/bin/python2.4
> 
> so the configure seems to work, but when i run make/make install at  
> the end i get the error, that the build mod_python.so is not found,  
> there is a symlink in the /src/ folder and it points to a .built/  
> directory, but that is not there...
> 
> Having no clue what to do i'm asking for your help. The same routine  
> (with apache 2.0.x) and differnent install locations worked fine on  
> my powermac a year before but the installation on the macbook is not  
> working the way it should be..obviously.
> 
> I can give you a logpart form make install, but i guess it's not  
> really helping.
> 
> ----------make install output------------
> 
> /usr/local/apache2/build/libtool --silent --mode=compile gcc -prefer- 
> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -g -O2 -
> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/usr/ 
> local/apache2/include  -I/Users/michael/Desktop/mod_python-3.2.10/src/
> include -I/usr/local/apache2/include -I/Library/Frameworks/ 
> Python.framework/Versions/2.4/include/python2.4  -c -o mod_python.lo  
> mod_python.c && touch mod_python.slo
> mod_python.c: In function 'python_cleanup':
> mod_python.c:313: warning: passing argument 1 of 'free' discards  
> qualifiers from pointer target type
> mod_python.c: In function 'init_mutexes':
> mod_python.c:427: warning: assignment discards qualifiers from  
> pointer target type
> mod_python.c:458: warning: assignment discards qualifiers from  
> pointer target type
> mod_python.c: In function 'reinit_mutexes':
> mod_python.c:540: warning: assignment discards qualifiers from  
> pointer target type
> /usr/local/apache2/build/libtool --silent --mode=compile gcc -prefer- 
> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -g -O2 -
> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/usr/ 
> local/apache2/include  -I/Users/michael/Desktop/mod_python-3.2.10/src/
> include -I/usr/local/apache2/include -I/Library/Frameworks/ 
> Python.framework/Versions/2.4/include/python2.4  -c -o  
> _apachemodule.lo _apachemodule.c && touch _apachemodule.slo
> /usr/local/apache2/build/libtool --silent --mode=compile gcc -prefer- 
> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -g -O2 -
> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/usr/ 
> local/apache2/include  -I/Users/michael/Desktop/mod_python-3.2.10/src/
> include -I/usr/local/apache2/include -I/Library/Frameworks/ 
> Python.framework/Versions/2.4/include/python2.4  -c -o  
> requestobject.lo requestobject.c && touch requestobject.slo
> requestobject.c: In function 'req_get_options':
> requestobject.c:426: warning: initialization discards qualifiers from 
> pointer target type
> requestobject.c:427: warning: initialization from incompatible  
> pointer type
> requestobject.c: In function 'getmakeobj':
> requestobject.c:1447: warning: assignment from incompatible pointer type
> requestobject.c:1454: warning: assignment from incompatible pointer type
> requestobject.c: In function 'request_tp_clear':
> requestobject.c:1569: warning: assignment from incompatible pointer type
> /usr/local/apache2/build/libtool --silent --mode=compile gcc -prefer- 
> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -g -O2 -
> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/usr/ 
> local/apache2/include  -I/Users/michael/Desktop/mod_python-3.2.10/src/
> include -I/usr/local/apache2/include -I/Library/Frameworks/ 
> Python.framework/Versions/2.4/include/python2.4  -c -o tableobject.lo 
> tableobject.c && touch tableobject.slo
> tableobject.c:1057: warning: initialization from incompatible pointer 
> type
> /usr/local/apache2/build/libtool --silent --mode=compile gcc -prefer- 
> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -g -O2 -
> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/usr/ 
> local/apache2/include  -I/Users/michael/Desktop/mod_python-3.2.10/src/
> include -I/usr/local/apache2/include -I/Library/Frameworks/ 
> Python.framework/Versions/2.4/include/python2.4  -c -o util.lo util.c 
> && touch util.slo
> /usr/local/apache2/build/libtool --silent --mode=compile gcc -prefer- 
> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -g -O2 -
> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/usr/ 
> local/apache2/include  -I/Users/michael/Desktop/mod_python-3.2.10/src/
> include -I/usr/local/apache2/include -I/Library/Frameworks/ 
> Python.framework/Versions/2.4/include/python2.4  -c -o  
> serverobject.lo serverobject.c && touch serverobject.slo
> serverobject.c:351: warning: initialization from incompatible pointer 
> type
> /usr/local/apache2/build/libtool --silent --mode=compile gcc -prefer- 
> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -g -O2 -
> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/usr/ 
> local/apache2/include  -I/Users/michael/Desktop/mod_python-3.2.10/src/
> include -I/usr/local/apache2/include -I/Library/Frameworks/ 
> Python.framework/Versions/2.4/include/python2.4  -c -o connobject.lo  
> connobject.c && touch connobject.slo
> /usr/local/apache2/build/libtool --silent --mode=compile gcc -prefer- 
> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -g -O2 -
> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/usr/ 
> local/apache2/include  -I/Users/michael/Desktop/mod_python-3.2.10/src/
> include -I/usr/local/apache2/include -I/Library/Frameworks/ 
> Python.framework/Versions/2.4/include/python2.4  -c -o  
> filterobject.lo filterobject.c && touch filterobject.slo
> /usr/local/apache2/build/libtool --silent --mode=compile gcc -prefer- 
> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -g -O2 -
> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/usr/ 
> local/apache2/include  -I/Users/michael/Desktop/mod_python-3.2.10/src/
> include -I/usr/local/apache2/include -I/Library/Frameworks/ 
> Python.framework/Versions/2.4/include/python2.4  -c -o hlist.lo  
> hlist.c && touch hlist.slo
> /usr/local/apache2/build/libtool --silent --mode=compile gcc -prefer- 
> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -g -O2 -
> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/usr/ 
> local/apache2/include  -I/Users/michael/Desktop/mod_python-3.2.10/src/
> include -I/usr/local/apache2/include -I/Library/Frameworks/ 
> Python.framework/Versions/2.4/include/python2.4  -c -o hlistobject.lo 
> hlistobject.c && touch hlistobject.slo
> /usr/local/apache2/build/libtool --silent --mode=link gcc -o  
> mod_python.la  -rpath /usr/local/apache2/modules -module -avoid- 
> version    hlistobject.lo hlist.lo filterobject.lo connobject.lo  
> serverobject.lo util.lo tableobject.lo requestobject.lo  
> _apachemodule.lo mod_python.lo -Wl,-framework,Python -u _PyMac_Error /
> Versions// -arch i386 -arch ppc -isysroot /Developer/SDKs/ 
> MacOSX10.4u.sdk -g -lm -framework Python -ldl
> install: src/mod_python.so: No such file or directory
> make[1]: *** [install_dso] Error 71
> 
> ---------------end make install output-------------------
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
From randall at randallsquared.com  Mon Jan  8 01:33:58 2007
From: randall at randallsquared.com (Randall Randall)
Date: Mon Jan  8 01:32:12 2007
Subject: [mod_python] suEXEC and mod_python ( cgihandler )
Message-ID: <C1EFD069-CDD8-48A9-BE14-FCA6E7E9F58C@randallsquared.com>

Hi, all.

I'm writing some CGI in Python, and one of the things I'd like
to do is make it runnable under either CGI or mod_python.  That
works fine in general.

Given that my CGI scripts need to open files for writing, I use
suEXEC with Apache 1.3 to run the Python scripts as the proper
user.

Can someone point me at either a URL (or search terms) for
making mod_python work with suEXEC, or some alternative method
for enforcing user/group on scripts run with mod_python's
cgihandler?

Thanks in advance!

--
Randall Randall <randall@randallsquared.com>
"If you are trying to produce a commercial product in
  a timely and cost efficient way, it is not good to have
  somebody's PhD research on your critical path." -- Chip Morningstar


From grahamd at dscpl.com.au  Mon Jan  8 04:27:26 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon Jan  8 04:27:36 2007
Subject: [mod_python] suEXEC and mod_python ( cgihandler )
In-Reply-To: <C1EFD069-CDD8-48A9-BE14-FCA6E7E9F58C@randallsquared.com>
References: <C1EFD069-CDD8-48A9-BE14-FCA6E7E9F58C@randallsquared.com>
Message-ID: <DCF9611C-D899-46F4-8C9F-CF0B1C0363E3@dscpl.com.au>


On 08/01/2007, at 5:33 PM, Randall Randall wrote:

> Hi, all.
>
> I'm writing some CGI in Python, and one of the things I'd like
> to do is make it runnable under either CGI or mod_python.  That
> works fine in general.
>
> Given that my CGI scripts need to open files for writing, I use
> suEXEC with Apache 1.3 to run the Python scripts as the proper
> user.
>
> Can someone point me at either a URL (or search terms) for
> making mod_python work with suEXEC, or some alternative method
> for enforcing user/group on scripts run with mod_python's
> cgihandler?

Short answer is you can't do it with mod_python. The only way you can
have separate scripts be run as different users is with CGI and suEXEC.

Graham
From grahamd at dscpl.com.au  Mon Jan  8 04:39:49 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon Jan  8 04:40:16 2007
Subject: [mod_python] Building Problems on OS X (intel macbook core2duo)
In-Reply-To: <A258A200-D6DB-47AA-B1AF-8697F3E9F4C3@gmx.de>
References: <1168231348.19084@dscpl.user.openhosting.com>
	<A258A200-D6DB-47AA-B1AF-8697F3E9F4C3@gmx.de>
Message-ID: <E60D84ED-74B0-453C-875E-BCB7A7A13F4E@dscpl.com.au>

Run:

   gcc -v

and post the result here. You might be hitting this problem:

   http://issues.apache.org/jira/browse/MODPYTHON-186

Only seems to affect certain versions of compiler tool chain.

BTW.  Please keep followups on the mailing list.

On 08/01/2007, at 6:45 PM, michael starke wrote:

> I'll try that, but i used a pre-built python version to work parallel
> so i don't know why the error is present there
>
> And i need python 2.4 (if i recall correctly) for some python  
> packages to work.
>
> Michael
>
> On 08.01.2007, at 05:42, Graham Dumpleton wrote:
>
>> Can you try with the operating system supplied version of Python  
>> (2.3.5)
>> instead of your own compiled Python 2.4 as the build configuration
>> associated with your 2.4 version doesn't look right.
>>
>> BTW, did you compiled your Python 2.4 from scratch? You might be  
>> better
>> off using one of the prebuilt dmg versions of Python instead as  
>> they tend
>> to be setup correctly and work in parallel to the OS version better.
>>
>> Graham
>>
>> michael starke wrote ..
>>> Hello there,
>>>
>>> i have a big problem and since i'm not to experinced witht the whole
>>> built from source way i want to ask you, if you know where the
>>> problem lies.
>>>
>>> I have apache2 installed (built and running) in  /usr/local/ 
>>> apache2/...
>>> I have python2.4 installed and running smoothly
>>> I downloaded mod_python 3.2.10 and configured it with
>>>
>>> 	--with-apxs=/usr/local/apache2/bin/apxs
>>> 	--with-python=/usr/local/bin/python2.4
>>>
>>> so the configure seems to work, but when i run make/make install at
>>> the end i get the error, that the build mod_python.so is not found,
>>> there is a symlink in the /src/ folder and it points to a .built/
>>> directory, but that is not there...
>>>
>>> Having no clue what to do i'm asking for your help. The same routine
>>> (with apache 2.0.x) and differnent install locations worked fine on
>>> my powermac a year before but the installation on the macbook is not
>>> working the way it should be..obviously.
>>>
>>> I can give you a logpart form make install, but i guess it's not
>>> really helping.
>>>
>>> ----------make install output------------
>>>
>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc - 
>>> prefer-
>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -g - 
>>> O2 -
>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/usr/
>>> local/apache2/include  -I/Users/michael/Desktop/mod_python-3.2.10/ 
>>> src/
>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
>>> Python.framework/Versions/2.4/include/python2.4  -c -o mod_python.lo
>>> mod_python.c && touch mod_python.slo
>>> mod_python.c: In function 'python_cleanup':
>>> mod_python.c:313: warning: passing argument 1 of 'free' discards
>>> qualifiers from pointer target type
>>> mod_python.c: In function 'init_mutexes':
>>> mod_python.c:427: warning: assignment discards qualifiers from
>>> pointer target type
>>> mod_python.c:458: warning: assignment discards qualifiers from
>>> pointer target type
>>> mod_python.c: In function 'reinit_mutexes':
>>> mod_python.c:540: warning: assignment discards qualifiers from
>>> pointer target type
>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc - 
>>> prefer-
>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -g - 
>>> O2 -
>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/usr/
>>> local/apache2/include  -I/Users/michael/Desktop/mod_python-3.2.10/ 
>>> src/
>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
>>> Python.framework/Versions/2.4/include/python2.4  -c -o
>>> _apachemodule.lo _apachemodule.c && touch _apachemodule.slo
>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc - 
>>> prefer-
>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -g - 
>>> O2 -
>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/usr/
>>> local/apache2/include  -I/Users/michael/Desktop/mod_python-3.2.10/ 
>>> src/
>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
>>> Python.framework/Versions/2.4/include/python2.4  -c -o
>>> requestobject.lo requestobject.c && touch requestobject.slo
>>> requestobject.c: In function 'req_get_options':
>>> requestobject.c:426: warning: initialization discards qualifiers  
>>> from
>>> pointer target type
>>> requestobject.c:427: warning: initialization from incompatible
>>> pointer type
>>> requestobject.c: In function 'getmakeobj':
>>> requestobject.c:1447: warning: assignment from incompatible  
>>> pointer type
>>> requestobject.c:1454: warning: assignment from incompatible  
>>> pointer type
>>> requestobject.c: In function 'request_tp_clear':
>>> requestobject.c:1569: warning: assignment from incompatible  
>>> pointer type
>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc - 
>>> prefer-
>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -g - 
>>> O2 -
>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/usr/
>>> local/apache2/include  -I/Users/michael/Desktop/mod_python-3.2.10/ 
>>> src/
>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
>>> Python.framework/Versions/2.4/include/python2.4  -c -o  
>>> tableobject.lo
>>> tableobject.c && touch tableobject.slo
>>> tableobject.c:1057: warning: initialization from incompatible  
>>> pointer
>>> type
>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc - 
>>> prefer-
>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -g - 
>>> O2 -
>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/usr/
>>> local/apache2/include  -I/Users/michael/Desktop/mod_python-3.2.10/ 
>>> src/
>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
>>> Python.framework/Versions/2.4/include/python2.4  -c -o util.lo  
>>> util.c
>>> && touch util.slo
>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc - 
>>> prefer-
>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -g - 
>>> O2 -
>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/usr/
>>> local/apache2/include  -I/Users/michael/Desktop/mod_python-3.2.10/ 
>>> src/
>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
>>> Python.framework/Versions/2.4/include/python2.4  -c -o
>>> serverobject.lo serverobject.c && touch serverobject.slo
>>> serverobject.c:351: warning: initialization from incompatible  
>>> pointer
>>> type
>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc - 
>>> prefer-
>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -g - 
>>> O2 -
>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/usr/
>>> local/apache2/include  -I/Users/michael/Desktop/mod_python-3.2.10/ 
>>> src/
>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
>>> Python.framework/Versions/2.4/include/python2.4  -c -o connobject.lo
>>> connobject.c && touch connobject.slo
>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc - 
>>> prefer-
>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -g - 
>>> O2 -
>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/usr/
>>> local/apache2/include  -I/Users/michael/Desktop/mod_python-3.2.10/ 
>>> src/
>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
>>> Python.framework/Versions/2.4/include/python2.4  -c -o
>>> filterobject.lo filterobject.c && touch filterobject.slo
>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc - 
>>> prefer-
>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -g - 
>>> O2 -
>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/usr/
>>> local/apache2/include  -I/Users/michael/Desktop/mod_python-3.2.10/ 
>>> src/
>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
>>> Python.framework/Versions/2.4/include/python2.4  -c -o hlist.lo
>>> hlist.c && touch hlist.slo
>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc - 
>>> prefer-
>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -g - 
>>> O2 -
>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/usr/
>>> local/apache2/include  -I/Users/michael/Desktop/mod_python-3.2.10/ 
>>> src/
>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
>>> Python.framework/Versions/2.4/include/python2.4  -c -o  
>>> hlistobject.lo
>>> hlistobject.c && touch hlistobject.slo
>>> /usr/local/apache2/build/libtool --silent --mode=link gcc -o
>>> mod_python.la  -rpath /usr/local/apache2/modules -module -avoid-
>>> version    hlistobject.lo hlist.lo filterobject.lo connobject.lo
>>> serverobject.lo util.lo tableobject.lo requestobject.lo
>>> _apachemodule.lo mod_python.lo -Wl,-framework,Python -u  
>>> _PyMac_Error /
>>> Versions// -arch i386 -arch ppc -isysroot /Developer/SDKs/
>>> MacOSX10.4u.sdk -g -lm -framework Python -ldl
>>> install: src/mod_python.so: No such file or directory
>>> make[1]: *** [install_dso] Error 71
>>>
>>> ---------------end make install output-------------------
>>> _______________________________________________
>>> Mod_python mailing list
>>> Mod_python@modpython.org
>>> http://mailman.modpython.org/mailman/listinfo/mod_python
From huanghao.c at gmail.com  Mon Jan  8 04:46:04 2007
From: huanghao.c at gmail.com (IQDoctor)
Date: Mon Jan  8 04:46:47 2007
Subject: [mod_python] suEXEC and mod_python ( cgihandler )
In-Reply-To: <C1EFD069-CDD8-48A9-BE14-FCA6E7E9F58C@randallsquared.com>
References: <C1EFD069-CDD8-48A9-BE14-FCA6E7E9F58C@randallsquared.com>
Message-ID: <45A212DC.2000809@gmail.com>


You can try with Apache itk MPM(perfork MPM based), it working fine for me.

--
best regards,
IQDoctor


Randall Randall wrote:
> Hi, all.
>
> I'm writing some CGI in Python, and one of the things I'd like
> to do is make it runnable under either CGI or mod_python.  That
> works fine in general.
>
> Given that my CGI scripts need to open files for writing, I use
> suEXEC with Apache 1.3 to run the Python scripts as the proper
> user.
>
> Can someone point me at either a URL (or search terms) for
> making mod_python work with suEXEC, or some alternative method
> for enforcing user/group on scripts run with mod_python's
> cgihandler?
>
> Thanks in advance!
>
> -- 
> Randall Randall <randall@randallsquared.com>
> "If you are trying to produce a commercial product in
>  a timely and cost efficient way, it is not good to have
>  somebody's PhD research on your critical path." -- Chip Morningstar
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>

From grahamd at dscpl.com.au  Mon Jan  8 04:59:01 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon Jan  8 04:59:12 2007
Subject: [mod_python] suEXEC and mod_python ( cgihandler )
In-Reply-To: <45A212DC.2000809@gmail.com>
References: <C1EFD069-CDD8-48A9-BE14-FCA6E7E9F58C@randallsquared.com>
	<45A212DC.2000809@gmail.com>
Message-ID: <FFCFFBDC-8829-4037-896E-50D2DCE5E597@dscpl.com.au>


On 08/01/2007, at 8:46 PM, IQDoctor wrote:

>
> You can try with Apache itk MPM(perfork MPM based), it working fine  
> for me.

To clarify what is being talked about here, this is not a standard MPM
for Apache, ie., doesn't come with Apache. The site for it AFAIK is:

   http://home.samfundet.no/~sesse/mpm-itk/

Also, the level of control over the user is only down to the virtual  
host
and not arbitrary scripts within a virtual host.

Graham


> --
> best regards,
> IQDoctor
>
>
> Randall Randall wrote:
>> Hi, all.
>>
>> I'm writing some CGI in Python, and one of the things I'd like
>> to do is make it runnable under either CGI or mod_python.  That
>> works fine in general.
>>
>> Given that my CGI scripts need to open files for writing, I use
>> suEXEC with Apache 1.3 to run the Python scripts as the proper
>> user.
>>
>> Can someone point me at either a URL (or search terms) for
>> making mod_python work with suEXEC, or some alternative method
>> for enforcing user/group on scripts run with mod_python's
>> cgihandler?
>>
>> Thanks in advance!
>>
>> -- 
>> Randall Randall <randall@randallsquared.com>
>> "If you are trying to produce a commercial product in
>>  a timely and cost efficient way, it is not good to have
>>  somebody's PhD research on your critical path." -- Chip Morningstar
>>
>>
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
From martijn at xs4us.nu  Mon Jan  8 10:31:13 2007
From: martijn at xs4us.nu (Martijn Moeling)
Date: Mon Jan  8 10:31:22 2007
Subject: [mod_python] Returned filename question (updated)
Message-ID: <B6C73A5E30565245BB6D32B5F5DF7A521202C5@sense.emmastraat.pijnacker>

Perhaps my explanation was misunderstood, let me clarify

If I go to http://www.lokalos.nl without a filename given (set By
Directoryindex in the apache config to index.py)

The returned filename seems to be a random generated filename (like
jkfdasadf.html)

/var/www/html/index.py is a symbolic link to
../Python_modules/generate.py

The Googlebot seems to remember the randomly generated filename, and
sure there is no /var/www/html/jkfdasadf.html, so it will 404

So google will get a 404 accessing the Index page and stops indexing
(as seen in the access_log)

I am puzzled by this.

I could set req.filename to "index.py" within my application, but I feel
this has something to do with the symbolic link. Anyway, where is the
jkfdasadf.html filename generated, would this be MP or apache? Is this
done before the MP handler is started, or after the index.py has done
its work?

As you can understand, the Indexing by searchengines is important for a
lot of websites,

Martijn

-----Oorspronkelijk bericht-----
Van: Graham Dumpleton [mailto:grahamd@dscpl.com.au] 
Verzonden: Sunday, January 07, 2007 1:32 AM
Aan: Martijn Moeling
CC: mod_python@modpython.org
Onderwerp: Re: [mod_python] Returned filename question (updated)


On 07/01/2007, at 12:32 AM, Martijn Moeling wrote:

> Hi,
>
> I was just checking my apache access_log to see if and how the  
> spidering
> by Google was going and I found some strange behavior I cannot  
> explain:
>
> cat /var/log/httpd/access_log |grep Googlebot
>
> all the lines I see are like:
>
> 66.249.65.15 - - [01/Jan/2007:15:43:54 +0100] "GET / 
> zsswsirofodgrdu.html
> HTTP/1.1" 404 298 "-" "Mozilla/5.0 (compatible; Googlebot/2.1;
> +http://www.google.com/bot.html)"
>
> Please note the: GET /zsswsirofodgrdu.html
>
> I am seeing this since I upgraded to MP 3.3.0b, I have searched the  
> DOCs
> but for some reason I cannot find out where Google gets the filename
> from....
>
> It seems like MP is returning a random filename now.

Not likely to be anything to do with mod_python.

First off, it is Apache which logs to the access_log file and not  
mod_python.
Apache will use whatever is set in req.filename at the end of the  
request.
The value of req.filename isn't changed by mod_python although a user
level mod_python handler could change it.

That the HTTP status code is 404 though suggests that it isn't even  
getting
to a response handler and so mod_python isn't likely being invoked.  
It simply
looks like that is what Google is actually asking for.

Graham

> The requests send are always http://www2.lokalos.nl or
> http://www2.lokalos.nl/?pr=drenthe
>
> Should I include a filename in my URL's? if I do :
> http://www2.lokalos.nl/index.py?pr=drenthe
> Or is there any way I can force MP/Apace to return the filename  
> index.py
> an force to overwrite the automatic returned filename (like
> fhgdjhlkgjhfhg.html)
>
> Martijn
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From randall at randallsquared.com  Mon Jan  8 11:52:47 2007
From: randall at randallsquared.com (Randall Randall)
Date: Mon Jan  8 11:50:59 2007
Subject: [mod_python] suEXEC and mod_python ( cgihandler )
In-Reply-To: <FFCFFBDC-8829-4037-896E-50D2DCE5E597@dscpl.com.au>
References: <C1EFD069-CDD8-48A9-BE14-FCA6E7E9F58C@randallsquared.com>
	<45A212DC.2000809@gmail.com>
	<FFCFFBDC-8829-4037-896E-50D2DCE5E597@dscpl.com.au>
Message-ID: <E1FDAFFD-8F59-40CD-BDB4-550DBD0B5FAC@randallsquared.com>


On Jan 8, 2007, at 4:59 AM, Graham Dumpleton wrote:

>
> On 08/01/2007, at 8:46 PM, IQDoctor wrote:
>
>>
>> You can try with Apache itk MPM(perfork MPM based), it working  
>> fine for me.
>
> To clarify what is being talked about here, this is not a standard MPM
> for Apache, ie., doesn't come with Apache. The site for it AFAIK is:
>
>   http://home.samfundet.no/~sesse/mpm-itk/
>
> Also, the level of control over the user is only down to the  
> virtual host
> and not arbitrary scripts within a virtual host.

Okay, thanks to both of you!

I note, though, that this MPM is for Apache 2.0, and due to other
dependencies I'm stuck with 1.3 for now.  Perhaps it will be useful
for someone who does use Apache 2.0, however; I wasn't able to find
even this much searching the archives. :)


--
Randall Randall <randall@randallsquared.com>
"Borders are so arbitrary. If they are a good thing, wouldn't it make  
sense
to add a few within current nations? If that is bad, why not remove a  
few
between nations? And if that is bad too, how come all nations have the
perfect size?" - Anders Sandberg


From starke.m at gmx.de  Mon Jan  8 12:39:05 2007
From: starke.m at gmx.de (michael starke)
Date: Mon Jan  8 12:39:20 2007
Subject: [mod_python] Building Problems on OS X (intel macbook core2duo)
In-Reply-To: <E60D84ED-74B0-453C-875E-BCB7A7A13F4E@dscpl.com.au>
References: <1168231348.19084@dscpl.user.openhosting.com>
	<A258A200-D6DB-47AA-B1AF-8697F3E9F4C3@gmx.de>
	<E60D84ED-74B0-453C-875E-BCB7A7A13F4E@dscpl.com.au>
Message-ID: <391311C0-4134-4463-A034-D221D1BBFAC0@gmx.de>

Hi sorry, for the messup with the mailings... am new to this =(

Here's the output form gcc -v

Using built-in specs.
Target: i686-apple-darwin8
Configured with: /private/var/tmp/gcc/gcc-5363.obj~28/src/configure -- 
disable-checking -enable-werror --prefix=/usr --mandir=/share/man -- 
enable-languages=c,objc,c++,obj-c++ --program-transform-name=/^[cg] 
[^.-]*$/s/$/-4.0/ --with-gxx-include-dir=/include/c++/4.0.0 --with- 
slibdir=/usr/lib --build=powerpc-apple-darwin8 --with-arch=nocona -- 
with-tune=generic --program-prefix= --host=i686-apple-darwin8 -- 
target=i686-apple-darwin8
Thread model: posix
gcc version 4.0.1 (Apple Computer, Inc. build 5363)

I startde downloading the 2.4.1 developer tools, to take a look at  
the buildversion of it's gcc and i'll try it with this version then  
again.


On 08.01.2007, at 10:39, Graham Dumpleton wrote:

> Run:
>
>   gcc -v
>
> and post the result here. You might be hitting this problem:
>
>   http://issues.apache.org/jira/browse/MODPYTHON-186
>
> Only seems to affect certain versions of compiler tool chain.
>
> BTW.  Please keep followups on the mailing list.
>
> On 08/01/2007, at 6:45 PM, michael starke wrote:
>
>> I'll try that, but i used a pre-built python version to work parallel
>> so i don't know why the error is present there
>>
>> And i need python 2.4 (if i recall correctly) for some python  
>> packages to work.
>>
>> Michael
>>
>> On 08.01.2007, at 05:42, Graham Dumpleton wrote:
>>
>>> Can you try with the operating system supplied version of Python  
>>> (2.3.5)
>>> instead of your own compiled Python 2.4 as the build configuration
>>> associated with your 2.4 version doesn't look right.
>>>
>>> BTW, did you compiled your Python 2.4 from scratch? You might be  
>>> better
>>> off using one of the prebuilt dmg versions of Python instead as  
>>> they tend
>>> to be setup correctly and work in parallel to the OS version better.
>>>
>>> Graham
>>>
>>> michael starke wrote ..
>>>> Hello there,
>>>>
>>>> i have a big problem and since i'm not to experinced witht the  
>>>> whole
>>>> built from source way i want to ask you, if you know where the
>>>> problem lies.
>>>>
>>>> I have apache2 installed (built and running) in  /usr/local/ 
>>>> apache2/...
>>>> I have python2.4 installed and running smoothly
>>>> I downloaded mod_python 3.2.10 and configured it with
>>>>
>>>> 	--with-apxs=/usr/local/apache2/bin/apxs
>>>> 	--with-python=/usr/local/bin/python2.4
>>>>
>>>> so the configure seems to work, but when i run make/make install at
>>>> the end i get the error, that the build mod_python.so is not found,
>>>> there is a symlink in the /src/ folder and it points to a .built/
>>>> directory, but that is not there...
>>>>
>>>> Having no clue what to do i'm asking for your help. The same  
>>>> routine
>>>> (with apache 2.0.x) and differnent install locations worked fine on
>>>> my powermac a year before but the installation on the macbook is  
>>>> not
>>>> working the way it should be..obviously.
>>>>
>>>> I can give you a logpart form make install, but i guess it's not
>>>> really helping.
>>>>
>>>> ----------make install output------------
>>>>
>>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc - 
>>>> prefer-
>>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -g  
>>>> -O2 -
>>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/usr/
>>>> local/apache2/include  -I/Users/michael/Desktop/ 
>>>> mod_python-3.2.10/src/
>>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
>>>> Python.framework/Versions/2.4/include/python2.4  -c -o  
>>>> mod_python.lo
>>>> mod_python.c && touch mod_python.slo
>>>> mod_python.c: In function 'python_cleanup':
>>>> mod_python.c:313: warning: passing argument 1 of 'free' discards
>>>> qualifiers from pointer target type
>>>> mod_python.c: In function 'init_mutexes':
>>>> mod_python.c:427: warning: assignment discards qualifiers from
>>>> pointer target type
>>>> mod_python.c:458: warning: assignment discards qualifiers from
>>>> pointer target type
>>>> mod_python.c: In function 'reinit_mutexes':
>>>> mod_python.c:540: warning: assignment discards qualifiers from
>>>> pointer target type
>>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc - 
>>>> prefer-
>>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -g  
>>>> -O2 -
>>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/usr/
>>>> local/apache2/include  -I/Users/michael/Desktop/ 
>>>> mod_python-3.2.10/src/
>>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
>>>> Python.framework/Versions/2.4/include/python2.4  -c -o
>>>> _apachemodule.lo _apachemodule.c && touch _apachemodule.slo
>>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc - 
>>>> prefer-
>>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -g  
>>>> -O2 -
>>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/usr/
>>>> local/apache2/include  -I/Users/michael/Desktop/ 
>>>> mod_python-3.2.10/src/
>>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
>>>> Python.framework/Versions/2.4/include/python2.4  -c -o
>>>> requestobject.lo requestobject.c && touch requestobject.slo
>>>> requestobject.c: In function 'req_get_options':
>>>> requestobject.c:426: warning: initialization discards qualifiers  
>>>> from
>>>> pointer target type
>>>> requestobject.c:427: warning: initialization from incompatible
>>>> pointer type
>>>> requestobject.c: In function 'getmakeobj':
>>>> requestobject.c:1447: warning: assignment from incompatible  
>>>> pointer type
>>>> requestobject.c:1454: warning: assignment from incompatible  
>>>> pointer type
>>>> requestobject.c: In function 'request_tp_clear':
>>>> requestobject.c:1569: warning: assignment from incompatible  
>>>> pointer type
>>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc - 
>>>> prefer-
>>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -g  
>>>> -O2 -
>>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/usr/
>>>> local/apache2/include  -I/Users/michael/Desktop/ 
>>>> mod_python-3.2.10/src/
>>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
>>>> Python.framework/Versions/2.4/include/python2.4  -c -o  
>>>> tableobject.lo
>>>> tableobject.c && touch tableobject.slo
>>>> tableobject.c:1057: warning: initialization from incompatible  
>>>> pointer
>>>> type
>>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc - 
>>>> prefer-
>>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -g  
>>>> -O2 -
>>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/usr/
>>>> local/apache2/include  -I/Users/michael/Desktop/ 
>>>> mod_python-3.2.10/src/
>>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
>>>> Python.framework/Versions/2.4/include/python2.4  -c -o util.lo  
>>>> util.c
>>>> && touch util.slo
>>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc - 
>>>> prefer-
>>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -g  
>>>> -O2 -
>>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/usr/
>>>> local/apache2/include  -I/Users/michael/Desktop/ 
>>>> mod_python-3.2.10/src/
>>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
>>>> Python.framework/Versions/2.4/include/python2.4  -c -o
>>>> serverobject.lo serverobject.c && touch serverobject.slo
>>>> serverobject.c:351: warning: initialization from incompatible  
>>>> pointer
>>>> type
>>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc - 
>>>> prefer-
>>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -g  
>>>> -O2 -
>>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/usr/
>>>> local/apache2/include  -I/Users/michael/Desktop/ 
>>>> mod_python-3.2.10/src/
>>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
>>>> Python.framework/Versions/2.4/include/python2.4  -c -o  
>>>> connobject.lo
>>>> connobject.c && touch connobject.slo
>>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc - 
>>>> prefer-
>>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -g  
>>>> -O2 -
>>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/usr/
>>>> local/apache2/include  -I/Users/michael/Desktop/ 
>>>> mod_python-3.2.10/src/
>>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
>>>> Python.framework/Versions/2.4/include/python2.4  -c -o
>>>> filterobject.lo filterobject.c && touch filterobject.slo
>>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc - 
>>>> prefer-
>>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -g  
>>>> -O2 -
>>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/usr/
>>>> local/apache2/include  -I/Users/michael/Desktop/ 
>>>> mod_python-3.2.10/src/
>>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
>>>> Python.framework/Versions/2.4/include/python2.4  -c -o hlist.lo
>>>> hlist.c && touch hlist.slo
>>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc - 
>>>> prefer-
>>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -g  
>>>> -O2 -
>>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/usr/
>>>> local/apache2/include  -I/Users/michael/Desktop/ 
>>>> mod_python-3.2.10/src/
>>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
>>>> Python.framework/Versions/2.4/include/python2.4  -c -o  
>>>> hlistobject.lo
>>>> hlistobject.c && touch hlistobject.slo
>>>> /usr/local/apache2/build/libtool --silent --mode=link gcc -o
>>>> mod_python.la  -rpath /usr/local/apache2/modules -module -avoid-
>>>> version    hlistobject.lo hlist.lo filterobject.lo connobject.lo
>>>> serverobject.lo util.lo tableobject.lo requestobject.lo
>>>> _apachemodule.lo mod_python.lo -Wl,-framework,Python -u  
>>>> _PyMac_Error /
>>>> Versions// -arch i386 -arch ppc -isysroot /Developer/SDKs/
>>>> MacOSX10.4u.sdk -g -lm -framework Python -ldl
>>>> install: src/mod_python.so: No such file or directory
>>>> make[1]: *** [install_dso] Error 71
>>>>
>>>> ---------------end make install output-------------------
>>>> _______________________________________________
>>>> Mod_python mailing list
>>>> Mod_python@modpython.org
>>>> http://mailman.modpython.org/mailman/listinfo/mod_python

From list at joreybump.com  Mon Jan  8 12:52:45 2007
From: list at joreybump.com (Jorey Bump)
Date: Mon Jan  8 12:52:54 2007
Subject: [mod_python] Returned filename question (updated)
In-Reply-To: <B6C73A5E30565245BB6D32B5F5DF7A521202C5@sense.emmastraat.pijnacker>
References: <B6C73A5E30565245BB6D32B5F5DF7A521202C5@sense.emmastraat.pijnacker>
Message-ID: <45A284ED.6070003@joreybump.com>

Martijn Moeling wrote:

> If I go to http://www.lokalos.nl without a filename given (set By
> Directoryindex in the apache config to index.py)
> 
> The returned filename seems to be a random generated filename (like
> jkfdasadf.html)

You are mistaken. This is how Google checks the way a site responds to 
404 errors. It is *intentionally* requesting a file it assumes will not 
exist. They tend to guard their reasons, but it could be a way to 
distinguish domain parkers or link farms. It's safe to ignore this and 
move on.

From g.farina at pharaondev.com  Mon Jan  8 15:57:37 2007
From: g.farina at pharaondev.com (g.farina@pharaondev.com)
Date: Mon Jan  8 15:57:45 2007
Subject: [mod_python] Redirect
Message-ID: <16740.82.58.86.60.1168289857.squirrel@webmail.pharaondev.com>

Hi

I have an autentication script and I'd like the browser to redirect to a
specific http location if the authentication fails.
There is a way to do this redirection using mod_python internals ?

Gabriele

From grahamd at dscpl.com.au  Mon Jan  8 16:12:11 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon Jan  8 16:12:15 2007
Subject: [mod_python] Redirect
Message-ID: <1168290730.28664@dscpl.user.openhosting.com>

g.farina@pharaondev.com wrote ..
> Hi
> 
> I have an autentication script and I'd like the browser to redirect to
> a
> specific http location if the authentication fails.
> There is a way to do this redirection using mod_python internals ?

Use:

  from mod_python import util

  util.redirect(req, 'http://some-host/....')

See:

  http://www.modpython.org/live/current/doc-html/pyapi-util-funcs.html

Note though that if using mod_python < 3.3, you will hit this problem
if trying to do it from an authentication handler.

  http://issues.apache.org/jira/browse/MODPYTHON-140

Thus, if on an older version of mod_python you should look at how the
redirect function is implemented and just do the same thing yourself,
ensuring you use DONE and not OK.

If using mod_python 3.3, you might also look at the req.construct_url()
method as a means of properly constructing the target URL for your
redirect. See:

  http://www.modpython.org/live/mod_python-3.3.0b/doc-html/pyapi-mprequest-meth.html

Version 3.3.0b is available from:

  http://httpd.apache.org/modules/python-download.cgi

Although announced, the mod_python site hasn't been updated to mention it.

Graham
From ccbean at gmail.com  Mon Jan  8 16:16:57 2007
From: ccbean at gmail.com (Colin Bean)
Date: Mon Jan  8 16:17:07 2007
Subject: [mod_python] Redirect
In-Reply-To: <16740.82.58.86.60.1168289857.squirrel@webmail.pharaondev.com>
References: <16740.82.58.86.60.1168289857.squirrel@webmail.pharaondev.com>
Message-ID: <29a6ca010701081316m73584362nb8347bbafc86548a@mail.gmail.com>

Use util.redirect(...) :

http://modpython.org/live/current/doc-html/pyapi-util-funcs.html

-Colin

On 1/8/07, g.farina@pharaondev.com <g.farina@pharaondev.com> wrote:
> Hi
>
> I have an autentication script and I'd like the browser to redirect to a
> specific http location if the authentication fails.
> There is a way to do this redirection using mod_python internals ?
>
> Gabriele
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From gustavo-listas at overstep.com.br  Tue Jan  9 08:22:30 2007
From: gustavo-listas at overstep.com.br (Gustavo Henrique Cervi)
Date: Tue Jan  9 08:21:54 2007
Subject: [mod_python] execution time limit
Message-ID: <45A39716.7040604@overstep.com.br>

Hi.

How can I to limit the execution time for an python script?
Something like max_execution_time on PHP..

thanks.
-Gustavo

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070109/9efbd66a/attachment.html
From grahamd at dscpl.com.au  Tue Jan  9 15:52:49 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Jan  9 15:52:55 2007
Subject: [mod_python] execution time limit
Message-ID: <1168375969.10166@dscpl.user.openhosting.com>

Gustavo Henrique Cervi wrote ..
> Hi.
> 
> How can I to limit the execution time for an python script?
> Something like max_execution_time on PHP..

Are you talking a CGI script written in Python or a Python handler running
under mod_python?

Either way you would have to program such ability within the script. Ie., if
the script is performing some sort of calculation, it would need to
occasionally check itself how long it has been going and abort if need be. If
you are communicating with other processes, rather than block you are going to
have to use some sort of mechanism which will allow you to timeout an
operation. Database systems don't usually allow this though. Depending on the
circumstances, you may be able to farm the operation off to a distinct thread
with the parent waiting for the thread to complete, but if it doesn't complete
in time for it to send back failure. The separate thread will still continue
until it completes though as not easy to kill threads.

You might explain more about what you are actually trying to do.

Graham
From mir at miras.org  Tue Jan  9 16:13:42 2007
From: mir at miras.org (Michael Rasmussen)
Date: Tue Jan  9 16:13:46 2007
Subject: [mod_python] execution time limit
In-Reply-To: <1168375969.10166@dscpl.user.openhosting.com>
References: <1168375969.10166@dscpl.user.openhosting.com>
Message-ID: <20070109221342.35b536d5@localhost>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On Tue, 9 Jan 2007 15:52:49 -0500
"Graham Dumpleton" <grahamd@dscpl.com.au> wrote:

> 
> You might explain more about what you are actually trying to do.
> 
Could it be an option to have the handler starting a
threading.Timer(timeout, function) and the delegate handling of
terminating the current process?

- -- 
Hilsen/Regards
Michael Rasmussen

Get my public GnuPG keys:
michael <at> rasmussen <dot> cc
http://keyserver.veridis.com:11371/pks/lookup?op=get&search=0xD3C9A00E
mir <at> datanom <dot> net
http://keyserver.veridis.com:11371/pks/lookup?op=get&search=0xE501F51C
mir <at> miras <dot> org
http://keyserver.veridis.com:11371/pks/lookup?op=get&search=0xE3E80917
- --------------------------------------------------------------
panic("Alas, I survived.\n");
        linux-2.6.6/arch/ppc64/kernel/rtas.c
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)

iD8DBQFFpAWGVErYVePoCRcRAr0/AJ9l0MVAxZ6Oh72Z1b/LhD7kwQ585QCeI3ZZ
Kkq1SA3pdbambHrvdh5/Zws=
=HAyN
-----END PGP SIGNATURE-----

From grahamd at dscpl.com.au  Tue Jan  9 16:17:56 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Jan  9 16:18:13 2007
Subject: [mod_python] execution time limit
Message-ID: <1168377476.22127@dscpl.user.openhosting.com>

Michael Rasmussen wrote ..
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
> 
> On Tue, 9 Jan 2007 15:52:49 -0500
> "Graham Dumpleton" <grahamd@dscpl.com.au> wrote:
> 
> > 
> > You might explain more about what you are actually trying to do.
> > 
> Could it be an option to have the handler starting a
> threading.Timer(timeout, function) and the delegate handling of
> terminating the current process?

Would only work if prefork MPM was being used, can't work if using worker MPM
or Windows.

Graham
From mir at miras.org  Tue Jan  9 16:33:42 2007
From: mir at miras.org (Michael Rasmussen)
Date: Tue Jan  9 16:33:54 2007
Subject: Fw: [mod_python] execution time limit
Message-ID: <20070109223342.70aeeff0@localhost>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1



Begin forwarded message:

Date: Tue, 9 Jan 2007 22:32:59 +0100
From: Michael Rasmussen <mir@miras.org>
To: "Graham Dumpleton" <grahamd@dscpl.com.au>
Subject: Re: [mod_python] execution time limit


- -----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On Tue, 9 Jan 2007 16:17:56 -0500
"Graham Dumpleton" <grahamd@dscpl.com.au> wrote:

> 
> Would only work if prefork MPM was being used, can't work if using
> worker MPM or Windows.
> 
Also if the called script spawned a new thread to actually handle the
request and then called wait(). The terminater thread should then call
the appropriate function in the called script instructing it to
terminated the created thread?

Sort of implementing the MVC pattern.

- - -- 
Hilsen/Regards
Michael Rasmussen

Get my public GnuPG keys:
michael <at> rasmussen <dot> cc
http://keyserver.veridis.com:11371/pks/lookup?op=get&search=0xD3C9A00E
mir <at> datanom <dot> net
http://keyserver.veridis.com:11371/pks/lookup?op=get&search=0xE501F51C
mir <at> miras <dot> org
http://keyserver.veridis.com:11371/pks/lookup?op=get&search=0xE3E80917
- - --------------------------------------------------------------
BOFH excuse #184:

loop found in loop in redundant loopback
- -----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)

iD8DBQFFpAoLVErYVePoCRcRAgjPAJ4xEvNxNdbqx8R2mMvlNtweWiBRXQCfVM3R
0lMZPn1aHCww90reCqpFkeA=
=kOVi
- -----END PGP SIGNATURE-----


- -- 
Hilsen/Regards
Michael Rasmussen

Get my public GnuPG keys:
michael <at> rasmussen <dot> cc
http://keyserver.veridis.com:11371/pks/lookup?op=get&search=0xD3C9A00E
mir <at> datanom <dot> net
http://keyserver.veridis.com:11371/pks/lookup?op=get&search=0xE501F51C
mir <at> miras <dot> org
http://keyserver.veridis.com:11371/pks/lookup?op=get&search=0xE3E80917
- --------------------------------------------------------------
Terminate input by end-of-file or marker, not by count.
            - The Elements of Programming Style (Kernighan & Plaugher)
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)

iD8DBQFFpAo2VErYVePoCRcRAjlsAJ9tnUhNJ8z9aSe0R6jJKurVifp8CACdEvA4
tDu4cfEPKOLkWmJwMh2dJFY=
=pEdC
-----END PGP SIGNATURE-----

From mir at miras.org  Tue Jan  9 17:00:14 2007
From: mir at miras.org (Michael Rasmussen)
Date: Tue Jan  9 17:00:10 2007
Subject: [mod_python] execution time limit
In-Reply-To: <1168377476.22127@dscpl.user.openhosting.com>
References: <1168377476.22127@dscpl.user.openhosting.com>
Message-ID: <20070109230014.146a5ac3@localhost>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On Tue, 9 Jan 2007 16:17:56 -0500
"Graham Dumpleton" <grahamd@dscpl.com.au> wrote:

> 
> Would only work if prefork MPM was being used, can't work if using
> worker MPM or Windows.
> 
Come to think of it, if my suggestion is valid it could be implemented
as a feature in mod_python. Any runnable wanting to implement timeout
must extend from object timeout an provide implementation for the
function. E.g extend the example from page 219 in the cookbook 

- -- 
Hilsen/Regards
Michael Rasmussen

Get my public GnuPG keys:
michael <at> rasmussen <dot> cc
http://keyserver.veridis.com:11371/pks/lookup?op=get&search=0xD3C9A00E
mir <at> datanom <dot> net
http://keyserver.veridis.com:11371/pks/lookup?op=get&search=0xE501F51C
mir <at> miras <dot> org
http://keyserver.veridis.com:11371/pks/lookup?op=get&search=0xE3E80917
- --------------------------------------------------------------
BOFH excuse #349:

Stray Alpha Particles from memory packaging caused Hard Memory Error on
Server.
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)

iD8DBQFFpBBuVErYVePoCRcRAgEiAJ9xpG2PJ7fBlffdyooX1tORxX9M/ACgl85Q
oDqX+Lpb1u+VbJi1oVrE7g8=
=KaBa
-----END PGP SIGNATURE-----

From grahamd at dscpl.com.au  Tue Jan  9 17:19:06 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Jan  9 17:19:18 2007
Subject: [mod_python] execution time limit
Message-ID: <1168381146.19254@dscpl.user.openhosting.com>

Michael Rasmussen wrote ..
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
> 
> On Tue, 9 Jan 2007 16:17:56 -0500
> "Graham Dumpleton" <grahamd@dscpl.com.au> wrote:
> 
> > 
> > Would only work if prefork MPM was being used, can't work if using
> > worker MPM or Windows.
> > 
> Come to think of it, if my suggestion is valid it could be implemented
> as a feature in mod_python. Any runnable wanting to implement timeout
> must extend from object timeout an provide implementation for the
> function. E.g extend the example from page 219 in the cookbook 

You've lost me. What cookbook are you talking about?

The basic problem still remains though is if you are talking about a handler
running under mod_python, you can't just go killing off the Apache child
process as ignoring the fact of whether it is even a good idea, it would only
be possible on prefork MPM. If you did it with the worker MPM you can
kill of concurrent requests and on Windows you would potentially be
killing off the whole Apache server.

If you are talking about within a CGI script that is different, but then that
has got nothing to do with mod_python.

Can you provide a better description?

Graham
From mir at miras.org  Tue Jan  9 18:00:28 2007
From: mir at miras.org (Michael Rasmussen)
Date: Tue Jan  9 18:00:23 2007
Subject: Fw: [mod_python] execution time limit
Message-ID: <20070110000028.137401b8@localhost>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1



Begin forwarded message:

Date: Tue, 9 Jan 2007 23:59:25 +0100
From: Michael Rasmussen <mir@miras.org>
To: "Graham Dumpleton" <grahamd@dscpl.com.au>
Subject: Re: [mod_python] execution time limit


- -----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On Tue, 9 Jan 2007 17:19:06 -0500
"Graham Dumpleton" <grahamd@dscpl.com.au> wrote:

> 
> You've lost me. What cookbook are you talking about?
> 
Python cookbook: ISBN: 0-596-00167-3

> 
> Can you provide a better description?
> 

Assuming we are called with this URL: http://www.some.domain/my/script
Assuming myscript.py is designated to handle requests for /my/script
Assuming myscript.py has implemented the function run
Assuming timeout is 30 sec.

But what really goes on is that this call are delegated to a controller
script which directs the call to a script on the server. E.g the server
has a controller which is delegated any request despite of the URL. It
splits the request up in main parts an then calls myscript.py. This call
is carrying out by starting myscript.py in a new thread in either of
two ways:

1:
    t1 = myscript.MyScript()
    t1.start()
    t1.join(30.0)
    return http code 500 to caller

2:
  (Assumption myscript.MyScript has implemented self destruction as the
example from the python cookbook)
    t1 = myscript.MyScript()
    t1.start()
    t1.join()
    return http code 500 to caller

The must elegant solution would be 2. IMHO.

So you see, it is not the apache child process I am killing but a
thread running inside that apache process. The apache process stays
alive and is unknowing of what actually goes on. I think this is
thread safe, at least when discussing the actual apache child
processes.
   
- - -- 
Hilsen/Regards
Michael Rasmussen

Get my public GnuPG keys:
michael <at> rasmussen <dot> cc
http://keyserver.veridis.com:11371/pks/lookup?op=get&search=0xD3C9A00E
mir <at> datanom <dot> net
http://keyserver.veridis.com:11371/pks/lookup?op=get&search=0xE501F51C
mir <at> miras <dot> org
http://keyserver.veridis.com:11371/pks/lookup?op=get&search=0xE3E80917
- - --------------------------------------------------------------
[After hitting Jenny's boyfriend] 

Forrest Gump: "Sorry I had a fight in the middle of your
Black Panther party" 
- -----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)

iD8DBQFFpB5NVErYVePoCRcRAkjfAJ0TFNgz8WgaHzD5PPesygV/vUf/XACePdg9
iH2nSCgduM5KPRQZzfES1Wo=
=S4xC
- -----END PGP SIGNATURE-----


- -- 
Hilsen/Regards
Michael Rasmussen

Get my public GnuPG keys:
michael <at> rasmussen <dot> cc
http://keyserver.veridis.com:11371/pks/lookup?op=get&search=0xD3C9A00E
mir <at> datanom <dot> net
http://keyserver.veridis.com:11371/pks/lookup?op=get&search=0xE501F51C
mir <at> miras <dot> org
http://keyserver.veridis.com:11371/pks/lookup?op=get&search=0xE3E80917
- --------------------------------------------------------------
Q:	Why was Stonehenge abandoned?
A:	It wasn't IBM compatible.
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)

iD8DBQFFpB6MVErYVePoCRcRAhWEAJ9AoWvl2zG6kfSO3+z3DLMi6RVYpwCfceXR
uB/KtBCqaWLhNDDZt0QxDiE=
=Qh1e
-----END PGP SIGNATURE-----

From grahamd at dscpl.com.au  Tue Jan  9 18:10:09 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Jan  9 18:10:21 2007
Subject: [mod_python] execution time limit
Message-ID: <1168384209.11100@dscpl.user.openhosting.com>

Michael Rasmussen wrote ..
> > You've lost me. What cookbook are you talking about?
> > 
> Python cookbook: ISBN: 0-596-00167-3
> 
> > 
> > Can you provide a better description?
> > 
> 
> Assuming we are called with this URL: http://www.some.domain/my/script
> Assuming myscript.py is designated to handle requests for /my/script
> Assuming myscript.py has implemented the function run
> Assuming timeout is 30 sec.
> 
> But what really goes on is that this call are delegated to a controller
> script which directs the call to a script on the server. E.g the server
> has a controller which is delegated any request despite of the URL. It
> splits the request up in main parts an then calls myscript.py. This call
> is carrying out by starting myscript.py in a new thread in either of
> two ways:
> 
> 1:
>     t1 = myscript.MyScript()
>     t1.start()
>     t1.join(30.0)
>     return http code 500 to caller
> 
> 2:
>   (Assumption myscript.MyScript has implemented self destruction as the
> example from the python cookbook)
>     t1 = myscript.MyScript()
>     t1.start()
>     t1.join()
>     return http code 500 to caller
> 
> The must elegant solution would be 2. IMHO.
> 
> So you see, it is not the apache child process I am killing but a
> thread running inside that apache process. The apache process stays
> alive and is unknowing of what actually goes on. I think this is
> thread safe, at least when discussing the actual apache child
> processes.

Which when you take out killing of process it is exactly what I was talking about
in my initial post. Posting again what I said:

   Either way you would have to program such ability within the script. Ie., if
   the script is performing some sort of calculation, it would need to
   occasionally check itself how long it has been going and abort if need be.
   If you are communicating with other processes, rather than block you are
   going to have to use some sort of mechanism which will allow you to timeout
   an operation. Database systems don't usually allow this though. Depending on
   the circumstances, you may be able to farm the operation off to a distinct
   thread with the parent waiting for the thread to complete, but if it doesn't
   complete in time for it to send back failure. The separate thread will still
   continue until it completes though as not easy to kill threads.

This sort of stuff very much has to be done by a user in their handlers, it can't
be done as a standard feature of mod_python as it would be impossible to
come up with something that would work for all users code.

Graham
From dm at ling.ohio-state.edu  Tue Jan  9 18:31:32 2007
From: dm at ling.ohio-state.edu (Detmar Meurers)
Date: Tue Jan  9 18:31:38 2007
Subject: [mod_python] question on new import functionality (python 3.3.0b)
Message-ID: <20070109233132.GA26364@ling.ohio-state.edu>

Hi,

I'm transitioning to mod_python 3.3.0b and have a question about the
description of import_module at
http://www.modpython.org/live/mod_python-3.3.0b/doc-html/pyapi-apmeth.html
where it states

     As a new feature in mod_python 3.3, when using the standard
     Python ?mport' statement to import a module, if the import is
     being done from a module which was previously imported by the
     mod_python module importer, it is equivalent to having called
     apache.import_module() directly.
 
     For example:

        import name

     is equivalent to:
    
        from mod_python import apache
            name = apache.import_module('name')
	    

In a setup where I am using the mod_python.publisher to
load a file index.py as specified in an .htaccess file stating

DirectoryIndex index.html index.py
AddHandler python-program .py
PythonHandler mod_python.publisher

is that index.py being loaded using the new module importer?

Can I just use plain "import" in such an index.py file loaded by the
mod_python.publisher in order to import other modules using the new
importing mechanism - or do I have to explicitly use
"apache.import_module" in that index.py?

Best,
Detmar

--
Detmar Meurers, Associate Professor, Dept. of Linguistics, OSU
201a Oxley Hall, 1712 Neil Avenue, Columbus OH 43210-1298, USA
http://ling.osu.edu/~dm/                 GnuPG key on web page
From grahamd at dscpl.com.au  Tue Jan  9 18:56:46 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Jan  9 18:57:08 2007
Subject: [mod_python] question on new import functionality (python 3.3.0b)
Message-ID: <1168387006.32211@dscpl.user.openhosting.com>

Detmar Meurers wrote ..
> Hi,
> 
> I'm transitioning to mod_python 3.3.0b and have a question about the
> description of import_module at
> http://www.modpython.org/live/mod_python-3.3.0b/doc-html/pyapi-apmeth.html
> where it states
> 
>      As a new feature in mod_python 3.3, when using the standard
>      Python ?mport' statement to import a module, if the import is
>      being done from a module which was previously imported by the
>      mod_python module importer, it is equivalent to having called
>      apache.import_module() directly.
>  
>      For example:
> 
>         import name
> 
>      is equivalent to:
>     
>         from mod_python import apache
>             name = apache.import_module('name')
> 	    
> 
> In a setup where I am using the mod_python.publisher to
> load a file index.py as specified in an .htaccess file stating
> 
> DirectoryIndex index.html index.py
> AddHandler python-program .py
> PythonHandler mod_python.publisher
> 
> is that index.py being loaded using the new module importer?

Yes, modules imported by mod_python.publisher from the document
tree use the mod_python importing/caching mechanism.

> Can I just use plain "import" in such an index.py file loaded by the
> mod_python.publisher in order to import other modules using the new
> importing mechanism - or do I have to explicitly use
> "apache.import_module" in that index.py?

Yes. It will first look in the same directory for the desired module,
then in directories in __mp_path__ and the 'mod_python.importer.path'.
If found here, that module itself is also imported using the mod_python
importer, will be cached and also be a candidate for reloading.

If the module cannot be found in those places, the search is handed
off to the standard Python module importer which will look in sys.path,
this being able to be customised using PythonPath directive.

Note that the mod_python importer/cache doesn't work with Python
packages. Python packages should always be on sys.path and will be
handled by the standard Python module importer.

Graham
From richardlewis at fastmail.co.uk  Wed Jan 10 12:28:14 2007
From: richardlewis at fastmail.co.uk (Richard Lewis)
Date: Wed Jan 10 12:28:25 2007
Subject: [mod_python] mod_python and sqlite
Message-ID: <200701101728.14497.richardlewis@fastmail.co.uk>

Hi there, 
 
I'm just trying to use SQLite with mod_python and I'm having a few problems. 
 
I have a script which responds to the URL "/session" and does this:

from mod_python import apache
import sqlite, datetime
def handler(req):
    # make query_dict from req.parsed_uri[apache.URI_QUERY]
    # <snipped>

    # load the sessions database
    con = sqlite.connect("/abs/path/to/sessions.db")
    cur = con.cursor()

    # select the record for the session
    cur.execute("SELECT * FROM sessions WHERE id=%s" % 
query_dict["session-no"])

    session = cur.fetchone()

    if int(session[1]) == 0:
        # this means that the session is not in use

        # update the sessions database to set the session as 'in use'
        cur.execute("UPDATE sessions SET in_use=1, name=\"%s\", started=\"%s\" 
WHERE id=%d" % \
                    (query_dict["name"], str(datetime.datetime.now()), 
int(query_dict["session-no"])))
        con.commit()

        # goes on to generate some HTML, etc.

The problem I have is that when I try to execute the SQL UPDATE query, the 
database raises the exception "Database error: unable to open database file". 
 
I've checked to make sure that I can execute the code correctly from the 
Python interpreter, and I can. 
 
So I also made sure that Apache has write permission to the database file by 
setting the permissions to rwxrwxrwx! 
 
Any ideas what may be wrong with this?

Cheers,
Richard
-- 
-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
Richard Lewis
Sonic Arts Research Archive
http://www.sara.uea.ac.uk/
JID: ironchicken@jabber.earth.li
-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
From mir at miras.org  Wed Jan 10 12:45:02 2007
From: mir at miras.org (Michael Rasmussen)
Date: Wed Jan 10 12:45:04 2007
Subject: [mod_python] mod_python and sqlite
In-Reply-To: <200701101728.14497.richardlewis@fastmail.co.uk>
References: <200701101728.14497.richardlewis@fastmail.co.uk>
Message-ID: <20070110184502.130c6bfe@localhost>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On Wed, 10 Jan 2007 17:28:14 +0000
Richard Lewis <richardlewis@fastmail.co.uk> wrote:

> 
> The problem I have is that when I try to execute the SQL UPDATE
> query, the database raises the exception "Database error: unable to
> open database file". 
> I've checked to make sure that I can execute the code correctly from
> the Python interpreter, and I can. 
>  
> So I also made sure that Apache has write permission to the database
> file by setting the permissions to rwxrwxrwx! 
>  
You are sure your webserver does not run in a jail/chroot environment
in which case a running instance of the webserver might never have
access to the required directory?

What does the webservers errorlog show?

- -- 
Hilsen/Regards
Michael Rasmussen

Get my public GnuPG keys:
michael <at> rasmussen <dot> cc
http://keyserver.veridis.com:11371/pks/lookup?op=get&search=0xD3C9A00E
mir <at> datanom <dot> net
http://keyserver.veridis.com:11371/pks/lookup?op=get&search=0xE501F51C
mir <at> miras <dot> org
http://keyserver.veridis.com:11371/pks/lookup?op=get&search=0xE3E80917
- --------------------------------------------------------------
Q:	What lies on the bottom of the ocean and twitches?
A:	A nervous wreck.
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)

iD8DBQFFpSYfVErYVePoCRcRAt+jAJ4zlfP3uITe1h0c6rQqC05j3WNhTwCeNRlv
Ee2Ih6w4dsgAxaddL4E2L3M=
=Kzjs
-----END PGP SIGNATURE-----

From richardlewis at fastmail.co.uk  Wed Jan 10 12:58:29 2007
From: richardlewis at fastmail.co.uk (Richard Lewis)
Date: Wed Jan 10 12:58:41 2007
Subject: [mod_python] mod_python and sqlite
In-Reply-To: <20070110184502.130c6bfe@localhost>
References: <200701101728.14497.richardlewis@fastmail.co.uk>
	<20070110184502.130c6bfe@localhost>
Message-ID: <200701101758.29423.richardlewis@fastmail.co.uk>

On Wednesday 10 January 2007 17:45, Michael Rasmussen wrote:
> On Wed, 10 Jan 2007 17:28:14 +0000
>
> Richard Lewis <richardlewis@fastmail.co.uk> wrote:
> > The problem I have is that when I try to execute the SQL UPDATE
> > query, the database raises the exception "Database error: unable to
> > open database file".
> > I've checked to make sure that I can execute the code correctly from
> > the Python interpreter, and I can.
> >
> > So I also made sure that Apache has write permission to the database
> > file by setting the permissions to rwxrwxrwx!
>
> You are sure your webserver does not run in a jail/chroot environment
> in which case a running instance of the webserver might never have
> access to the required directory?
>
Um, not as far as I know. Its just Apache 2.2 on Debian (unstable).

> What does the webservers errorlog show?

[Wed Jan 10 17:12:23 2007] [error] [client c_ip] PythonHandler session: 
Traceback (most recent call last):, referer: http://server/

[Wed Jan 10 17:12:23 2007] [error] [client c_ip] PythonHandler session:   
File "/usr/lib/python2.4/site-packages/mod_python/apache.py", line 299, in 
HandlerDispatch\n    result = object(req), referer: http://server/

[Wed Jan 10 17:12:23 2007] [error] [client c_ip] PythonHandler session: 
File "/var/www/session.py", line 50, in handler\n    cur.execute("UPDATE 
users SET in_use=1, name=\\"%s\\", started=\\"%s\\" WHERE id=%d" % \\, 
referer: http://server/

[Wed Jan 10 17:12:23 2007] [error] [client c_ip] PythonHandler session:   
File "/usr/lib/python2.4/site-packages/sqlite/main.py", line 237, in 
execute\n    self.con._begin(), referer: http://server/

[Wed Jan 10 17:12:23 2007] [error] [client c_ip] PythonHandler session:   
File "/usr/lib/python2.4/site-packages/sqlite/main.py", line 503, in _begin\n    
self.db.execute("BEGIN"), referer: http://server/

[Wed Jan 10 17:12:23 2007] [error] [client c_ip] PythonHandler session: 
DatabaseError: unable to open database file, referer: http://server/

Cheers,
Richard
-- 
-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
Richard Lewis
Sonic Arts Research Archive
http://www.sara.uea.ac.uk/
JID: ironchicken@jabber.earth.li
-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
From gustavo-listas at overstep.com.br  Wed Jan 10 13:20:22 2007
From: gustavo-listas at overstep.com.br (Gustavo Henrique Cervi)
Date: Wed Jan 10 13:19:41 2007
Subject: [mod_python] execution time limit
In-Reply-To: <1168375969.10166@dscpl.user.openhosting.com>
References: <1168375969.10166@dscpl.user.openhosting.com>
Message-ID: <45A52E66.90005@overstep.com.br>

Python handler running under mod_python.
Im using the "mod_python.publisher" handler.

-Gustavo


Graham Dumpleton wrote:
> Gustavo Henrique Cervi wrote ..
>   
>> Hi.
>>
>> How can I to limit the execution time for an python script?
>> Something like max_execution_time on PHP..
>>     
>
> Are you talking a CGI script written in Python or a Python handler running
> under mod_python?
>
> Either way you would have to program such ability within the script. Ie., if
> the script is performing some sort of calculation, it would need to
> occasionally check itself how long it has been going and abort if need be. If
> you are communicating with other processes, rather than block you are going to
> have to use some sort of mechanism which will allow you to timeout an
> operation. Database systems don't usually allow this though. Depending on the
> circumstances, you may be able to farm the operation off to a distinct thread
> with the parent waiting for the thread to complete, but if it doesn't complete
> in time for it to send back failure. The separate thread will still continue
> until it completes though as not easy to kill threads.
>
> You might explain more about what you are actually trying to do.
>
> Graham
>
>   

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070110/c2915da7/attachment.html
From mir at miras.org  Wed Jan 10 13:37:04 2007
From: mir at miras.org (Michael Rasmussen)
Date: Wed Jan 10 13:37:05 2007
Subject: [mod_python] mod_python and sqlite
In-Reply-To: <200701101758.29423.richardlewis@fastmail.co.uk>
References: <200701101728.14497.richardlewis@fastmail.co.uk>
	<20070110184502.130c6bfe@localhost>
	<200701101758.29423.richardlewis@fastmail.co.uk>
Message-ID: <20070110193704.68613ad7@localhost>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On Wed, 10 Jan 2007 17:58:29 +0000
Richard Lewis <richardlewis@fastmail.co.uk> wrote:

> Um, not as far as I know. Its just Apache 2.2 on Debian (unstable).
> 
Unless you have change configuration it is not running chroot - default
for Debian is not to run chroot.

> > What does the webservers errorlog show?
> 
Not much:-)
This path - /abs/path/to/sessions.db - does this point somewhere
below /var/www? If it does there could be some restrictions applied in
/etc/apache2/apache2.conf to the specific directory. Does is change
anything if you use /tmp as directory?

- -- 
Hilsen/Regards
Michael Rasmussen

Get my public GnuPG keys:
michael <at> rasmussen <dot> cc
http://keyserver.veridis.com:11371/pks/lookup?op=get&search=0xD3C9A00E
mir <at> datanom <dot> net
http://keyserver.veridis.com:11371/pks/lookup?op=get&search=0xE501F51C
mir <at> miras <dot> org
http://keyserver.veridis.com:11371/pks/lookup?op=get&search=0xE3E80917
- --------------------------------------------------------------
Avoid temporary variables.
            - The Elements of Programming Style (Kernighan & Plaugher)
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)

iD8DBQFFpTJRVErYVePoCRcRAuV5AJ0XK2gEqSRP6UwK0g4aZGK8BIfiCQCgl6ZM
Z93YAMYE6GP0RNSv2wXhI/I=
=w9ll
-----END PGP SIGNATURE-----

From ccbean at gmail.com  Wed Jan 10 14:18:30 2007
From: ccbean at gmail.com (Colin Bean)
Date: Wed Jan 10 14:18:36 2007
Subject: [mod_python] mod_python and sqlite
In-Reply-To: <200701101758.29423.richardlewis@fastmail.co.uk>
References: <200701101728.14497.richardlewis@fastmail.co.uk>
	<20070110184502.130c6bfe@localhost>
	<200701101758.29423.richardlewis@fastmail.co.uk>
Message-ID: <29a6ca010701101118p1ce51986l4389412fd51c635b@mail.gmail.com>

Hi Richard,

Could it be concurrency problems due to two apache instances trying to
write to the database simultaneously?  Does it always fail on the
first request?  Does it fail if you limit apache to a single child
process?

I'm looking at sqlite3 that came with python2.5 right now, so I'm not
sure if the behavior and errors are the same, but I opened the same
database from two different python interpreters and tried to insert a
value from each one.  If I executed the first insert, then executed a
second insert from the other interpreter (before committing the first
one), it failed with an sqlite3.OperationalError.  I tried again with
the isolation level set to None on both connections (so sqlite will
autocommit after each statement), and both inserts worked.

So I'd also try
con = sqlite.connect("file.db", isolation_level=None)
and see if that helps.

hth,
Colin


On 1/10/07, Richard Lewis <richardlewis@fastmail.co.uk> wrote:
> On Wednesday 10 January 2007 17:45, Michael Rasmussen wrote:
> > On Wed, 10 Jan 2007 17:28:14 +0000
> >
> > Richard Lewis <richardlewis@fastmail.co.uk> wrote:
> > > The problem I have is that when I try to execute the SQL UPDATE
> > > query, the database raises the exception "Database error: unable to
> > > open database file".
> > > I've checked to make sure that I can execute the code correctly from
> > > the Python interpreter, and I can.
> > >
> > > So I also made sure that Apache has write permission to the database
> > > file by setting the permissions to rwxrwxrwx!
> >
> > You are sure your webserver does not run in a jail/chroot environment
> > in which case a running instance of the webserver might never have
> > access to the required directory?
> >
> Um, not as far as I know. Its just Apache 2.2 on Debian (unstable).
>
> > What does the webservers errorlog show?
>
> [Wed Jan 10 17:12:23 2007] [error] [client c_ip] PythonHandler session:
> Traceback (most recent call last):, referer: http://server/
>
> [Wed Jan 10 17:12:23 2007] [error] [client c_ip] PythonHandler session:
> File "/usr/lib/python2.4/site-packages/mod_python/apache.py", line 299, in
> HandlerDispatch\n    result = object(req), referer: http://server/
>
> [Wed Jan 10 17:12:23 2007] [error] [client c_ip] PythonHandler session:
> File "/var/www/session.py", line 50, in handler\n    cur.execute("UPDATE
> users SET in_use=1, name=\\"%s\\", started=\\"%s\\" WHERE id=%d" % \\,
> referer: http://server/
>
> [Wed Jan 10 17:12:23 2007] [error] [client c_ip] PythonHandler session:
> File "/usr/lib/python2.4/site-packages/sqlite/main.py", line 237, in
> execute\n    self.con._begin(), referer: http://server/
>
> [Wed Jan 10 17:12:23 2007] [error] [client c_ip] PythonHandler session:
> File "/usr/lib/python2.4/site-packages/sqlite/main.py", line 503, in _begin\n
> self.db.execute("BEGIN"), referer: http://server/
>
> [Wed Jan 10 17:12:23 2007] [error] [client c_ip] PythonHandler session:
> DatabaseError: unable to open database file, referer: http://server/
>
> Cheers,
> Richard
> --
> -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
> Richard Lewis
> Sonic Arts Research Archive
> http://www.sara.uea.ac.uk/
> JID: ironchicken@jabber.earth.li
> -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From grahamd at dscpl.com.au  Wed Jan 10 15:50:07 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Jan 10 15:50:16 2007
Subject: [mod_python] mod_python and sqlite
Message-ID: <1168462207.30692@dscpl.user.openhosting.com>

Michael Rasmussen wrote ..
> -----BEGIN PGP SIGNED MESSAGE-----
> > > What does the webservers errorlog show?
> > 
> Not much:-)
> This path - /abs/path/to/sessions.db - does this point somewhere
> below /var/www? If it does there could be some restrictions applied in
> /etc/apache2/apache2.conf to the specific directory. Does is change
> anything if you use /tmp as directory?

Directory restrictions in the Apache configuration have got nothing to do with
file system access done using standard operating system functions. The only
restrictions which might derive from how Apache is configured are the user it
runs as and any chroot jail in use as has already been mentioned.

Graham
From nogradi at gmail.com  Wed Jan 10 17:46:10 2007
From: nogradi at gmail.com (Daniel Nogradi)
Date: Wed Jan 10 17:46:19 2007
Subject: [mod_python] mod_python and sqlite
In-Reply-To: <1168462207.30692@dscpl.user.openhosting.com>
References: <1168462207.30692@dscpl.user.openhosting.com>
Message-ID: <5f56302b0701101446k6ae23e9bv2177781d4cb62243@mail.gmail.com>

>
> > Not much:-)
> > This path - /abs/path/to/sessions.db - does this point somewhere
> > below /var/www? If it does there could be some restrictions applied in
> > /etc/apache2/apache2.conf to the specific directory. Does is change
> > anything if you use /tmp as directory?
>
> Directory restrictions in the Apache configuration have got nothing to do
> with
> file system access done using standard operating system functions. The
> only
> restrictions which might derive from how Apache is configured are the user
> it
> runs as and any chroot jail in use as has already been mentioned.



Sqlite needs write access also to the directory containing the database
file.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070110/e9fb04b7/attachment-0001.html
From starke.m at gmx.de  Wed Jan 10 23:14:24 2007
From: starke.m at gmx.de (michael starke)
Date: Wed Jan 10 23:14:36 2007
Subject: [mod_python] Building Problems on OS X (intel macbook core2duo)
In-Reply-To: <391311C0-4134-4463-A034-D221D1BBFAC0@gmx.de>
References: <1168231348.19084@dscpl.user.openhosting.com>
	<A258A200-D6DB-47AA-B1AF-8697F3E9F4C3@gmx.de>
	<E60D84ED-74B0-453C-875E-BCB7A7A13F4E@dscpl.com.au>
	<391311C0-4134-4463-A034-D221D1BBFAC0@gmx.de>
Message-ID: <C4E031F0-CAF8-4BD0-A4FB-9454996E3387@gmx.de>

Well,

i upgraded the Xtools and now got the built 5367 of the gcc compiler,  
but still i get the same error while building mod_python.
Any suggestions? Help would be appreciatiated :)

greetings,
michael

On 08.01.2007, at 18:39, michael starke wrote:

> Hi sorry, for the messup with the mailings... am new to this =(
>
> Here's the output form gcc -v
>
> Using built-in specs.
> Target: i686-apple-darwin8
> Configured with: /private/var/tmp/gcc/gcc-5363.obj~28/src/configure  
> --disable-checking -enable-werror --prefix=/usr --mandir=/share/man  
> --enable-languages=c,objc,c++,obj-c++ --program-transform-name=/^ 
> [cg][^.-]*$/s/$/-4.0/ --with-gxx-include-dir=/include/c++/4.0.0 -- 
> with-slibdir=/usr/lib --build=powerpc-apple-darwin8 --with- 
> arch=nocona --with-tune=generic --program-prefix= --host=i686-apple- 
> darwin8 --target=i686-apple-darwin8
> Thread model: posix
> gcc version 4.0.1 (Apple Computer, Inc. build 5363)
>
> I startde downloading the 2.4.1 developer tools, to take a look at  
> the buildversion of it's gcc and i'll try it with this version then  
> again.
>
>
> On 08.01.2007, at 10:39, Graham Dumpleton wrote:
>
>> Run:
>>
>>   gcc -v
>>
>> and post the result here. You might be hitting this problem:
>>
>>   http://issues.apache.org/jira/browse/MODPYTHON-186
>>
>> Only seems to affect certain versions of compiler tool chain.
>>
>> BTW.  Please keep followups on the mailing list.
>>
>> On 08/01/2007, at 6:45 PM, michael starke wrote:
>>
>>> I'll try that, but i used a pre-built python version to work  
>>> parallel
>>> so i don't know why the error is present there
>>>
>>> And i need python 2.4 (if i recall correctly) for some python  
>>> packages to work.
>>>
>>> Michael
>>>
>>> On 08.01.2007, at 05:42, Graham Dumpleton wrote:
>>>
>>>> Can you try with the operating system supplied version of Python  
>>>> (2.3.5)
>>>> instead of your own compiled Python 2.4 as the build configuration
>>>> associated with your 2.4 version doesn't look right.
>>>>
>>>> BTW, did you compiled your Python 2.4 from scratch? You might be  
>>>> better
>>>> off using one of the prebuilt dmg versions of Python instead as  
>>>> they tend
>>>> to be setup correctly and work in parallel to the OS version  
>>>> better.
>>>>
>>>> Graham
>>>>
>>>> michael starke wrote ..
>>>>> Hello there,
>>>>>
>>>>> i have a big problem and since i'm not to experinced witht the  
>>>>> whole
>>>>> built from source way i want to ask you, if you know where the
>>>>> problem lies.
>>>>>
>>>>> I have apache2 installed (built and running) in  /usr/local/ 
>>>>> apache2/...
>>>>> I have python2.4 installed and running smoothly
>>>>> I downloaded mod_python 3.2.10 and configured it with
>>>>>
>>>>> 	--with-apxs=/usr/local/apache2/bin/apxs
>>>>> 	--with-python=/usr/local/bin/python2.4
>>>>>
>>>>> so the configure seems to work, but when i run make/make  
>>>>> install at
>>>>> the end i get the error, that the build mod_python.so is not  
>>>>> found,
>>>>> there is a symlink in the /src/ folder and it points to a .built/
>>>>> directory, but that is not there...
>>>>>
>>>>> Having no clue what to do i'm asking for your help. The same  
>>>>> routine
>>>>> (with apache 2.0.x) and differnent install locations worked  
>>>>> fine on
>>>>> my powermac a year before but the installation on the macbook  
>>>>> is not
>>>>> working the way it should be..obviously.
>>>>>
>>>>> I can give you a logpart form make install, but i guess it's not
>>>>> really helping.
>>>>>
>>>>> ----------make install output------------
>>>>>
>>>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc - 
>>>>> prefer-
>>>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp - 
>>>>> g -O2 -
>>>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/ 
>>>>> usr/
>>>>> local/apache2/include  -I/Users/michael/Desktop/ 
>>>>> mod_python-3.2.10/src/
>>>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
>>>>> Python.framework/Versions/2.4/include/python2.4  -c -o  
>>>>> mod_python.lo
>>>>> mod_python.c && touch mod_python.slo
>>>>> mod_python.c: In function 'python_cleanup':
>>>>> mod_python.c:313: warning: passing argument 1 of 'free' discards
>>>>> qualifiers from pointer target type
>>>>> mod_python.c: In function 'init_mutexes':
>>>>> mod_python.c:427: warning: assignment discards qualifiers from
>>>>> pointer target type
>>>>> mod_python.c:458: warning: assignment discards qualifiers from
>>>>> pointer target type
>>>>> mod_python.c: In function 'reinit_mutexes':
>>>>> mod_python.c:540: warning: assignment discards qualifiers from
>>>>> pointer target type
>>>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc - 
>>>>> prefer-
>>>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp - 
>>>>> g -O2 -
>>>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/ 
>>>>> usr/
>>>>> local/apache2/include  -I/Users/michael/Desktop/ 
>>>>> mod_python-3.2.10/src/
>>>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
>>>>> Python.framework/Versions/2.4/include/python2.4  -c -o
>>>>> _apachemodule.lo _apachemodule.c && touch _apachemodule.slo
>>>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc - 
>>>>> prefer-
>>>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp - 
>>>>> g -O2 -
>>>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/ 
>>>>> usr/
>>>>> local/apache2/include  -I/Users/michael/Desktop/ 
>>>>> mod_python-3.2.10/src/
>>>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
>>>>> Python.framework/Versions/2.4/include/python2.4  -c -o
>>>>> requestobject.lo requestobject.c && touch requestobject.slo
>>>>> requestobject.c: In function 'req_get_options':
>>>>> requestobject.c:426: warning: initialization discards  
>>>>> qualifiers from
>>>>> pointer target type
>>>>> requestobject.c:427: warning: initialization from incompatible
>>>>> pointer type
>>>>> requestobject.c: In function 'getmakeobj':
>>>>> requestobject.c:1447: warning: assignment from incompatible  
>>>>> pointer type
>>>>> requestobject.c:1454: warning: assignment from incompatible  
>>>>> pointer type
>>>>> requestobject.c: In function 'request_tp_clear':
>>>>> requestobject.c:1569: warning: assignment from incompatible  
>>>>> pointer type
>>>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc - 
>>>>> prefer-
>>>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp - 
>>>>> g -O2 -
>>>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/ 
>>>>> usr/
>>>>> local/apache2/include  -I/Users/michael/Desktop/ 
>>>>> mod_python-3.2.10/src/
>>>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
>>>>> Python.framework/Versions/2.4/include/python2.4  -c -o  
>>>>> tableobject.lo
>>>>> tableobject.c && touch tableobject.slo
>>>>> tableobject.c:1057: warning: initialization from incompatible  
>>>>> pointer
>>>>> type
>>>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc - 
>>>>> prefer-
>>>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp - 
>>>>> g -O2 -
>>>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/ 
>>>>> usr/
>>>>> local/apache2/include  -I/Users/michael/Desktop/ 
>>>>> mod_python-3.2.10/src/
>>>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
>>>>> Python.framework/Versions/2.4/include/python2.4  -c -o util.lo  
>>>>> util.c
>>>>> && touch util.slo
>>>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc - 
>>>>> prefer-
>>>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp - 
>>>>> g -O2 -
>>>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/ 
>>>>> usr/
>>>>> local/apache2/include  -I/Users/michael/Desktop/ 
>>>>> mod_python-3.2.10/src/
>>>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
>>>>> Python.framework/Versions/2.4/include/python2.4  -c -o
>>>>> serverobject.lo serverobject.c && touch serverobject.slo
>>>>> serverobject.c:351: warning: initialization from incompatible  
>>>>> pointer
>>>>> type
>>>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc - 
>>>>> prefer-
>>>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp - 
>>>>> g -O2 -
>>>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/ 
>>>>> usr/
>>>>> local/apache2/include  -I/Users/michael/Desktop/ 
>>>>> mod_python-3.2.10/src/
>>>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
>>>>> Python.framework/Versions/2.4/include/python2.4  -c -o  
>>>>> connobject.lo
>>>>> connobject.c && touch connobject.slo
>>>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc - 
>>>>> prefer-
>>>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp - 
>>>>> g -O2 -
>>>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/ 
>>>>> usr/
>>>>> local/apache2/include  -I/Users/michael/Desktop/ 
>>>>> mod_python-3.2.10/src/
>>>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
>>>>> Python.framework/Versions/2.4/include/python2.4  -c -o
>>>>> filterobject.lo filterobject.c && touch filterobject.slo
>>>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc - 
>>>>> prefer-
>>>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp - 
>>>>> g -O2 -
>>>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/ 
>>>>> usr/
>>>>> local/apache2/include  -I/Users/michael/Desktop/ 
>>>>> mod_python-3.2.10/src/
>>>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
>>>>> Python.framework/Versions/2.4/include/python2.4  -c -o hlist.lo
>>>>> hlist.c && touch hlist.slo
>>>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc - 
>>>>> prefer-
>>>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp - 
>>>>> g -O2 -
>>>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/ 
>>>>> usr/
>>>>> local/apache2/include  -I/Users/michael/Desktop/ 
>>>>> mod_python-3.2.10/src/
>>>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
>>>>> Python.framework/Versions/2.4/include/python2.4  -c -o  
>>>>> hlistobject.lo
>>>>> hlistobject.c && touch hlistobject.slo
>>>>> /usr/local/apache2/build/libtool --silent --mode=link gcc -o
>>>>> mod_python.la  -rpath /usr/local/apache2/modules -module -avoid-
>>>>> version    hlistobject.lo hlist.lo filterobject.lo connobject.lo
>>>>> serverobject.lo util.lo tableobject.lo requestobject.lo
>>>>> _apachemodule.lo mod_python.lo -Wl,-framework,Python -u  
>>>>> _PyMac_Error /
>>>>> Versions// -arch i386 -arch ppc -isysroot /Developer/SDKs/
>>>>> MacOSX10.4u.sdk -g -lm -framework Python -ldl
>>>>> install: src/mod_python.so: No such file or directory
>>>>> make[1]: *** [install_dso] Error 71
>>>>>
>>>>> ---------------end make install output-------------------
>>>>> _______________________________________________
>>>>> Mod_python mailing list
>>>>> Mod_python@modpython.org
>>>>> http://mailman.modpython.org/mailman/listinfo/mod_python
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From grahamd at dscpl.com.au  Wed Jan 10 23:20:09 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Jan 10 23:20:15 2007
Subject: [mod_python] mod_python and sqlite
Message-ID: <1168489209.14021@dscpl.user.openhosting.com>

Edit 'src/Makefile' and look for LDFLAGS definition similar to:

LDFLAGS= -Wl,-framework,Python  -u __dummy -u _PyMac_Error -framework System $(PYTHONFRAMEWORKDIR)/Versions/$(VERSION)/$(PYTHONFRAMEWORK) -framework CoreServices -framework Foundation   -Wl,-F. -Wl,-F.

Edit this like to remove:

  $(PYTHONFRAMEWORKDIR)/Versions/$(VERSION)/$(PYTHONFRAMEWORK)

Then try a make again.

Graham

Daniel Nogradi wrote ..
> >
> > > Not much:-)
> > > This path - /abs/path/to/sessions.db - does this point somewhere
> > > below /var/www? If it does there could be some restrictions applied
> in
> > > /etc/apache2/apache2.conf to the specific directory. Does is change
> > > anything if you use /tmp as directory?
> >
> > Directory restrictions in the Apache configuration have got nothing to
> do
> > with
> > file system access done using standard operating system functions. The
> > only
> > restrictions which might derive from how Apache is configured are the
> user
> > it
> > runs as and any chroot jail in use as has already been mentioned.
> 
> 
> 
> Sqlite needs write access also to the directory containing the database
> file.
From grahamd at dscpl.com.au  Wed Jan 10 23:28:32 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Jan 10 23:28:46 2007
Subject: [mod_python] Building Problems on OS X (intel macbook core2duo)
Message-ID: <1168489712.17717@dscpl.user.openhosting.com>

Whoops. My web mail used the wrong email when I clicked reply on it. :-(

Lets reply to the correct email.

Edit 'src/Makefile' and look for LDFLAGS definition similar to:

LDFLAGS= -Wl,-framework,Python  -u __dummy -u _PyMac_Error -framework System $(PYTHONFRAMEWORKDIR)/Versions/$(VERSION)/$(PYTHONFRAMEWORK)
-framework CoreServices -framework Foundation   -Wl,-F. -Wl,-F.

Edit this like to remove:

  $(PYTHONFRAMEWORKDIR)/Versions/$(VERSION)/$(PYTHONFRAMEWORK)

Then try a make again.

Graham

michael starke wrote ..
> Well,
> 
> i upgraded the Xtools and now got the built 5367 of the gcc compiler, 
> but still i get the same error while building mod_python.
> Any suggestions? Help would be appreciatiated :)
> 
> greetings,
> michael
> 
> On 08.01.2007, at 18:39, michael starke wrote:
> 
> > Hi sorry, for the messup with the mailings... am new to this =(
> >
> > Here's the output form gcc -v
> >
> > Using built-in specs.
> > Target: i686-apple-darwin8
> > Configured with: /private/var/tmp/gcc/gcc-5363.obj~28/src/configure 
> > --disable-checking -enable-werror --prefix=/usr --mandir=/share/man 
> > --enable-languages=c,objc,c++,obj-c++ --program-transform-name=/^ 
> > [cg][^.-]*$/s/$/-4.0/ --with-gxx-include-dir=/include/c++/4.0.0 -- 
> > with-slibdir=/usr/lib --build=powerpc-apple-darwin8 --with- 
> > arch=nocona --with-tune=generic --program-prefix= --host=i686-apple-
> > darwin8 --target=i686-apple-darwin8
> > Thread model: posix
> > gcc version 4.0.1 (Apple Computer, Inc. build 5363)
> >
> > I startde downloading the 2.4.1 developer tools, to take a look at  
> > the buildversion of it's gcc and i'll try it with this version then 
> > again.
> >
> >
> > On 08.01.2007, at 10:39, Graham Dumpleton wrote:
> >
> >> Run:
> >>
> >>   gcc -v
> >>
> >> and post the result here. You might be hitting this problem:
> >>
> >>   http://issues.apache.org/jira/browse/MODPYTHON-186
> >>
> >> Only seems to affect certain versions of compiler tool chain.
> >>
> >> BTW.  Please keep followups on the mailing list.
> >>
> >> On 08/01/2007, at 6:45 PM, michael starke wrote:
> >>
> >>> I'll try that, but i used a pre-built python version to work  
> >>> parallel
> >>> so i don't know why the error is present there
> >>>
> >>> And i need python 2.4 (if i recall correctly) for some python  
> >>> packages to work.
> >>>
> >>> Michael
> >>>
> >>> On 08.01.2007, at 05:42, Graham Dumpleton wrote:
> >>>
> >>>> Can you try with the operating system supplied version of Python 
> >>>> (2.3.5)
> >>>> instead of your own compiled Python 2.4 as the build configuration
> >>>> associated with your 2.4 version doesn't look right.
> >>>>
> >>>> BTW, did you compiled your Python 2.4 from scratch? You might be 
> >>>> better
> >>>> off using one of the prebuilt dmg versions of Python instead as  
> >>>> they tend
> >>>> to be setup correctly and work in parallel to the OS version  
> >>>> better.
> >>>>
> >>>> Graham
> >>>>
> >>>> michael starke wrote ..
> >>>>> Hello there,
> >>>>>
> >>>>> i have a big problem and since i'm not to experinced witht the  
> >>>>> whole
> >>>>> built from source way i want to ask you, if you know where the
> >>>>> problem lies.
> >>>>>
> >>>>> I have apache2 installed (built and running) in  /usr/local/ 
> >>>>> apache2/...
> >>>>> I have python2.4 installed and running smoothly
> >>>>> I downloaded mod_python 3.2.10 and configured it with
> >>>>>
> >>>>> 	--with-apxs=/usr/local/apache2/bin/apxs
> >>>>> 	--with-python=/usr/local/bin/python2.4
> >>>>>
> >>>>> so the configure seems to work, but when i run make/make  
> >>>>> install at
> >>>>> the end i get the error, that the build mod_python.so is not  
> >>>>> found,
> >>>>> there is a symlink in the /src/ folder and it points to a .built/
> >>>>> directory, but that is not there...
> >>>>>
> >>>>> Having no clue what to do i'm asking for your help. The same  
> >>>>> routine
> >>>>> (with apache 2.0.x) and differnent install locations worked  
> >>>>> fine on
> >>>>> my powermac a year before but the installation on the macbook  
> >>>>> is not
> >>>>> working the way it should be..obviously.
> >>>>>
> >>>>> I can give you a logpart form make install, but i guess it's not
> >>>>> really helping.
> >>>>>
> >>>>> ----------make install output------------
> >>>>>
> >>>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc - 
> >>>>> prefer-
> >>>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp - 
> >>>>> g -O2 -
> >>>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/ 
> >>>>> usr/
> >>>>> local/apache2/include  -I/Users/michael/Desktop/ 
> >>>>> mod_python-3.2.10/src/
> >>>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
> >>>>> Python.framework/Versions/2.4/include/python2.4  -c -o  
> >>>>> mod_python.lo
> >>>>> mod_python.c && touch mod_python.slo
> >>>>> mod_python.c: In function 'python_cleanup':
> >>>>> mod_python.c:313: warning: passing argument 1 of 'free' discards
> >>>>> qualifiers from pointer target type
> >>>>> mod_python.c: In function 'init_mutexes':
> >>>>> mod_python.c:427: warning: assignment discards qualifiers from
> >>>>> pointer target type
> >>>>> mod_python.c:458: warning: assignment discards qualifiers from
> >>>>> pointer target type
> >>>>> mod_python.c: In function 'reinit_mutexes':
> >>>>> mod_python.c:540: warning: assignment discards qualifiers from
> >>>>> pointer target type
> >>>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc - 
> >>>>> prefer-
> >>>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp - 
> >>>>> g -O2 -
> >>>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/ 
> >>>>> usr/
> >>>>> local/apache2/include  -I/Users/michael/Desktop/ 
> >>>>> mod_python-3.2.10/src/
> >>>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
> >>>>> Python.framework/Versions/2.4/include/python2.4  -c -o
> >>>>> _apachemodule.lo _apachemodule.c && touch _apachemodule.slo
> >>>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc - 
> >>>>> prefer-
> >>>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp - 
> >>>>> g -O2 -
> >>>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/ 
> >>>>> usr/
> >>>>> local/apache2/include  -I/Users/michael/Desktop/ 
> >>>>> mod_python-3.2.10/src/
> >>>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
> >>>>> Python.framework/Versions/2.4/include/python2.4  -c -o
> >>>>> requestobject.lo requestobject.c && touch requestobject.slo
> >>>>> requestobject.c: In function 'req_get_options':
> >>>>> requestobject.c:426: warning: initialization discards  
> >>>>> qualifiers from
> >>>>> pointer target type
> >>>>> requestobject.c:427: warning: initialization from incompatible
> >>>>> pointer type
> >>>>> requestobject.c: In function 'getmakeobj':
> >>>>> requestobject.c:1447: warning: assignment from incompatible  
> >>>>> pointer type
> >>>>> requestobject.c:1454: warning: assignment from incompatible  
> >>>>> pointer type
> >>>>> requestobject.c: In function 'request_tp_clear':
> >>>>> requestobject.c:1569: warning: assignment from incompatible  
> >>>>> pointer type
> >>>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc - 
> >>>>> prefer-
> >>>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp - 
> >>>>> g -O2 -
> >>>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/ 
> >>>>> usr/
> >>>>> local/apache2/include  -I/Users/michael/Desktop/ 
> >>>>> mod_python-3.2.10/src/
> >>>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
> >>>>> Python.framework/Versions/2.4/include/python2.4  -c -o  
> >>>>> tableobject.lo
> >>>>> tableobject.c && touch tableobject.slo
> >>>>> tableobject.c:1057: warning: initialization from incompatible  
> >>>>> pointer
> >>>>> type
> >>>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc - 
> >>>>> prefer-
> >>>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp - 
> >>>>> g -O2 -
> >>>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/ 
> >>>>> usr/
> >>>>> local/apache2/include  -I/Users/michael/Desktop/ 
> >>>>> mod_python-3.2.10/src/
> >>>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
> >>>>> Python.framework/Versions/2.4/include/python2.4  -c -o util.lo  
> >>>>> util.c
> >>>>> && touch util.slo
> >>>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc - 
> >>>>> prefer-
> >>>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp - 
> >>>>> g -O2 -
> >>>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/ 
> >>>>> usr/
> >>>>> local/apache2/include  -I/Users/michael/Desktop/ 
> >>>>> mod_python-3.2.10/src/
> >>>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
> >>>>> Python.framework/Versions/2.4/include/python2.4  -c -o
> >>>>> serverobject.lo serverobject.c && touch serverobject.slo
> >>>>> serverobject.c:351: warning: initialization from incompatible  
> >>>>> pointer
> >>>>> type
> >>>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc - 
> >>>>> prefer-
> >>>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp - 
> >>>>> g -O2 -
> >>>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/ 
> >>>>> usr/
> >>>>> local/apache2/include  -I/Users/michael/Desktop/ 
> >>>>> mod_python-3.2.10/src/
> >>>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
> >>>>> Python.framework/Versions/2.4/include/python2.4  -c -o  
> >>>>> connobject.lo
> >>>>> connobject.c && touch connobject.slo
> >>>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc - 
> >>>>> prefer-
> >>>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp - 
> >>>>> g -O2 -
> >>>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/ 
> >>>>> usr/
> >>>>> local/apache2/include  -I/Users/michael/Desktop/ 
> >>>>> mod_python-3.2.10/src/
> >>>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
> >>>>> Python.framework/Versions/2.4/include/python2.4  -c -o
> >>>>> filterobject.lo filterobject.c && touch filterobject.slo
> >>>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc - 
> >>>>> prefer-
> >>>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp - 
> >>>>> g -O2 -
> >>>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/ 
> >>>>> usr/
> >>>>> local/apache2/include  -I/Users/michael/Desktop/ 
> >>>>> mod_python-3.2.10/src/
> >>>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
> >>>>> Python.framework/Versions/2.4/include/python2.4  -c -o hlist.lo
> >>>>> hlist.c && touch hlist.slo
> >>>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc - 
> >>>>> prefer-
> >>>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp - 
> >>>>> g -O2 -
> >>>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/ 
> >>>>> usr/
> >>>>> local/apache2/include  -I/Users/michael/Desktop/ 
> >>>>> mod_python-3.2.10/src/
> >>>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
> >>>>> Python.framework/Versions/2.4/include/python2.4  -c -o  
> >>>>> hlistobject.lo
> >>>>> hlistobject.c && touch hlistobject.slo
> >>>>> /usr/local/apache2/build/libtool --silent --mode=link gcc -o
> >>>>> mod_python.la  -rpath /usr/local/apache2/modules -module -avoid-
> >>>>> version    hlistobject.lo hlist.lo filterobject.lo connobject.lo
> >>>>> serverobject.lo util.lo tableobject.lo requestobject.lo
> >>>>> _apachemodule.lo mod_python.lo -Wl,-framework,Python -u  
> >>>>> _PyMac_Error /
> >>>>> Versions// -arch i386 -arch ppc -isysroot /Developer/SDKs/
> >>>>> MacOSX10.4u.sdk -g -lm -framework Python -ldl
> >>>>> install: src/mod_python.so: No such file or directory
> >>>>> make[1]: *** [install_dso] Error 71
> >>>>>
> >>>>> ---------------end make install output-------------------
> >>>>> _______________________________________________
> >>>>> Mod_python mailing list
> >>>>> Mod_python@modpython.org
> >>>>> http://mailman.modpython.org/mailman/listinfo/mod_python
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
From richardlewis at fastmail.co.uk  Thu Jan 11 09:27:42 2007
From: richardlewis at fastmail.co.uk (Richard Lewis)
Date: Thu Jan 11 09:27:54 2007
Subject: [mod_python] mod_python and sqlite
In-Reply-To: <5f56302b0701101446k6ae23e9bv2177781d4cb62243@mail.gmail.com>
References: <1168462207.30692@dscpl.user.openhosting.com>
	<5f56302b0701101446k6ae23e9bv2177781d4cb62243@mail.gmail.com>
Message-ID: <200701111427.42611.richardlewis@fastmail.co.uk>

On Wednesday 10 January 2007 22:46, Daniel Nogradi wrote:
>
> Sqlite needs write access also to the directory containing the database
> file.
Aha. That seems to have been the problem.

Thanks very much!
Richard
-- 
-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
Richard Lewis
Sonic Arts Research Archive
http://www.sara.uea.ac.uk/
JID: ironchicken@jabber.earth.li
-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
From starke.m at gmx.de  Thu Jan 11 10:48:11 2007
From: starke.m at gmx.de (michael starke)
Date: Thu Jan 11 10:48:21 2007
Subject: [mod_python] Building Problems on OS X (intel macbook core2duo)
In-Reply-To: <1168489712.17717@dscpl.user.openhosting.com>
References: <1168489712.17717@dscpl.user.openhosting.com>
Message-ID: <8C993430-C2D9-4EB1-A1C5-00CF590A0776@gmx.de>

Even the routines make mistakes, makes them look more human.

I did what you suggested, the line in my makefile (after configure, i  
told you, am new to this =) looks like this:

LDFLAGS= -Wl,-framework,Python  -u _PyMac_Error $(PYTHONFRAMEWORKDIR)/ 
Versions/$(VERSION)/$(PYTHONFRAMEWORK)   -arch i386 -arch ppc - 
isysroot /Developer/SDKs/MacOSX10.4u.sdk -g

I changed it to

LDFLAGS= -Wl,-framework,Python  -u _PyMac_Error   -arch i386 -arch  
ppc -isysroot /Developer/SDKs/MacOSX10.4u.sdk -g

after a make and a make install i still get no result, it still tries  
to find the mod_python.so in the scr/ folder, but it's still not  
there. (just the link, not the real file)
Any other suggestions? Or do i have a bigger issue with my setup. The  
system is quite near to a blank installation, cause the book was  
right out of the box, just developer tools installed, apache  
compiled, and the then errors with mod_python.

michael

On 11.01.2007, at 05:28, Graham Dumpleton wrote:

> Whoops. My web mail used the wrong email when I clicked reply on  
> it. :-(
>
> Lets reply to the correct email.
>
> Edit 'src/Makefile' and look for LDFLAGS definition similar to:
>
> LDFLAGS= -Wl,-framework,Python  -u __dummy -u _PyMac_Error - 
> framework System $(PYTHONFRAMEWORKDIR)/Versions/$(VERSION)/$ 
> (PYTHONFRAMEWORK)
> -framework CoreServices -framework Foundation   -Wl,-F. -Wl,-F.
>
> Edit this like to remove:
>
>   $(PYTHONFRAMEWORKDIR)/Versions/$(VERSION)/$(PYTHONFRAMEWORK)
>
> Then try a make again.
>
> Graham
>
> michael starke wrote ..
>> Well,
>>
>> i upgraded the Xtools and now got the built 5367 of the gcc compiler,
>> but still i get the same error while building mod_python.
>> Any suggestions? Help would be appreciatiated :)
>>
>> greetings,
>> michael
>>
>> On 08.01.2007, at 18:39, michael starke wrote:
>>
>>> Hi sorry, for the messup with the mailings... am new to this =(
>>>
>>> Here's the output form gcc -v
>>>
>>> Using built-in specs.
>>> Target: i686-apple-darwin8
>>> Configured with: /private/var/tmp/gcc/gcc-5363.obj~28/src/configure
>>> --disable-checking -enable-werror --prefix=/usr --mandir=/share/man
>>> --enable-languages=c,objc,c++,obj-c++ --program-transform-name=/^
>>> [cg][^.-]*$/s/$/-4.0/ --with-gxx-include-dir=/include/c++/4.0.0 --
>>> with-slibdir=/usr/lib --build=powerpc-apple-darwin8 --with-
>>> arch=nocona --with-tune=generic --program-prefix= --host=i686-apple-
>>> darwin8 --target=i686-apple-darwin8
>>> Thread model: posix
>>> gcc version 4.0.1 (Apple Computer, Inc. build 5363)
>>>
>>> I startde downloading the 2.4.1 developer tools, to take a look at
>>> the buildversion of it's gcc and i'll try it with this version then
>>> again.
>>>
>>>
>>> On 08.01.2007, at 10:39, Graham Dumpleton wrote:
>>>
>>>> Run:
>>>>
>>>>   gcc -v
>>>>
>>>> and post the result here. You might be hitting this problem:
>>>>
>>>>   http://issues.apache.org/jira/browse/MODPYTHON-186
>>>>
>>>> Only seems to affect certain versions of compiler tool chain.
>>>>
>>>> BTW.  Please keep followups on the mailing list.
>>>>
>>>> On 08/01/2007, at 6:45 PM, michael starke wrote:
>>>>
>>>>> I'll try that, but i used a pre-built python version to work
>>>>> parallel
>>>>> so i don't know why the error is present there
>>>>>
>>>>> And i need python 2.4 (if i recall correctly) for some python
>>>>> packages to work.
>>>>>
>>>>> Michael
>>>>>
>>>>> On 08.01.2007, at 05:42, Graham Dumpleton wrote:
>>>>>
>>>>>> Can you try with the operating system supplied version of Python
>>>>>> (2.3.5)
>>>>>> instead of your own compiled Python 2.4 as the build  
>>>>>> configuration
>>>>>> associated with your 2.4 version doesn't look right.
>>>>>>
>>>>>> BTW, did you compiled your Python 2.4 from scratch? You might be
>>>>>> better
>>>>>> off using one of the prebuilt dmg versions of Python instead as
>>>>>> they tend
>>>>>> to be setup correctly and work in parallel to the OS version
>>>>>> better.
>>>>>>
>>>>>> Graham
>>>>>>
>>>>>> michael starke wrote ..
>>>>>>> Hello there,
>>>>>>>
>>>>>>> i have a big problem and since i'm not to experinced witht the
>>>>>>> whole
>>>>>>> built from source way i want to ask you, if you know where the
>>>>>>> problem lies.
>>>>>>>
>>>>>>> I have apache2 installed (built and running) in  /usr/local/
>>>>>>> apache2/...
>>>>>>> I have python2.4 installed and running smoothly
>>>>>>> I downloaded mod_python 3.2.10 and configured it with
>>>>>>>
>>>>>>> 	--with-apxs=/usr/local/apache2/bin/apxs
>>>>>>> 	--with-python=/usr/local/bin/python2.4
>>>>>>>
>>>>>>> so the configure seems to work, but when i run make/make
>>>>>>> install at
>>>>>>> the end i get the error, that the build mod_python.so is not
>>>>>>> found,
>>>>>>> there is a symlink in the /src/ folder and it points to  
>>>>>>> a .built/
>>>>>>> directory, but that is not there...
>>>>>>>
>>>>>>> Having no clue what to do i'm asking for your help. The same
>>>>>>> routine
>>>>>>> (with apache 2.0.x) and differnent install locations worked
>>>>>>> fine on
>>>>>>> my powermac a year before but the installation on the macbook
>>>>>>> is not
>>>>>>> working the way it should be..obviously.
>>>>>>>
>>>>>>> I can give you a logpart form make install, but i guess it's not
>>>>>>> really helping.
>>>>>>>
>>>>>>> ----------make install output------------
>>>>>>>
>>>>>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc -
>>>>>>> prefer-
>>>>>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -
>>>>>>> g -O2 -
>>>>>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/
>>>>>>> usr/
>>>>>>> local/apache2/include  -I/Users/michael/Desktop/
>>>>>>> mod_python-3.2.10/src/
>>>>>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
>>>>>>> Python.framework/Versions/2.4/include/python2.4  -c -o
>>>>>>> mod_python.lo
>>>>>>> mod_python.c && touch mod_python.slo
>>>>>>> mod_python.c: In function 'python_cleanup':
>>>>>>> mod_python.c:313: warning: passing argument 1 of 'free' discards
>>>>>>> qualifiers from pointer target type
>>>>>>> mod_python.c: In function 'init_mutexes':
>>>>>>> mod_python.c:427: warning: assignment discards qualifiers from
>>>>>>> pointer target type
>>>>>>> mod_python.c:458: warning: assignment discards qualifiers from
>>>>>>> pointer target type
>>>>>>> mod_python.c: In function 'reinit_mutexes':
>>>>>>> mod_python.c:540: warning: assignment discards qualifiers from
>>>>>>> pointer target type
>>>>>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc -
>>>>>>> prefer-
>>>>>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -
>>>>>>> g -O2 -
>>>>>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/
>>>>>>> usr/
>>>>>>> local/apache2/include  -I/Users/michael/Desktop/
>>>>>>> mod_python-3.2.10/src/
>>>>>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
>>>>>>> Python.framework/Versions/2.4/include/python2.4  -c -o
>>>>>>> _apachemodule.lo _apachemodule.c && touch _apachemodule.slo
>>>>>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc -
>>>>>>> prefer-
>>>>>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -
>>>>>>> g -O2 -
>>>>>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/
>>>>>>> usr/
>>>>>>> local/apache2/include  -I/Users/michael/Desktop/
>>>>>>> mod_python-3.2.10/src/
>>>>>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
>>>>>>> Python.framework/Versions/2.4/include/python2.4  -c -o
>>>>>>> requestobject.lo requestobject.c && touch requestobject.slo
>>>>>>> requestobject.c: In function 'req_get_options':
>>>>>>> requestobject.c:426: warning: initialization discards
>>>>>>> qualifiers from
>>>>>>> pointer target type
>>>>>>> requestobject.c:427: warning: initialization from incompatible
>>>>>>> pointer type
>>>>>>> requestobject.c: In function 'getmakeobj':
>>>>>>> requestobject.c:1447: warning: assignment from incompatible
>>>>>>> pointer type
>>>>>>> requestobject.c:1454: warning: assignment from incompatible
>>>>>>> pointer type
>>>>>>> requestobject.c: In function 'request_tp_clear':
>>>>>>> requestobject.c:1569: warning: assignment from incompatible
>>>>>>> pointer type
>>>>>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc -
>>>>>>> prefer-
>>>>>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -
>>>>>>> g -O2 -
>>>>>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/
>>>>>>> usr/
>>>>>>> local/apache2/include  -I/Users/michael/Desktop/
>>>>>>> mod_python-3.2.10/src/
>>>>>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
>>>>>>> Python.framework/Versions/2.4/include/python2.4  -c -o
>>>>>>> tableobject.lo
>>>>>>> tableobject.c && touch tableobject.slo
>>>>>>> tableobject.c:1057: warning: initialization from incompatible
>>>>>>> pointer
>>>>>>> type
>>>>>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc -
>>>>>>> prefer-
>>>>>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -
>>>>>>> g -O2 -
>>>>>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/
>>>>>>> usr/
>>>>>>> local/apache2/include  -I/Users/michael/Desktop/
>>>>>>> mod_python-3.2.10/src/
>>>>>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
>>>>>>> Python.framework/Versions/2.4/include/python2.4  -c -o util.lo
>>>>>>> util.c
>>>>>>> && touch util.slo
>>>>>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc -
>>>>>>> prefer-
>>>>>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -
>>>>>>> g -O2 -
>>>>>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/
>>>>>>> usr/
>>>>>>> local/apache2/include  -I/Users/michael/Desktop/
>>>>>>> mod_python-3.2.10/src/
>>>>>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
>>>>>>> Python.framework/Versions/2.4/include/python2.4  -c -o
>>>>>>> serverobject.lo serverobject.c && touch serverobject.slo
>>>>>>> serverobject.c:351: warning: initialization from incompatible
>>>>>>> pointer
>>>>>>> type
>>>>>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc -
>>>>>>> prefer-
>>>>>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -
>>>>>>> g -O2 -
>>>>>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/
>>>>>>> usr/
>>>>>>> local/apache2/include  -I/Users/michael/Desktop/
>>>>>>> mod_python-3.2.10/src/
>>>>>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
>>>>>>> Python.framework/Versions/2.4/include/python2.4  -c -o
>>>>>>> connobject.lo
>>>>>>> connobject.c && touch connobject.slo
>>>>>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc -
>>>>>>> prefer-
>>>>>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -
>>>>>>> g -O2 -
>>>>>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/
>>>>>>> usr/
>>>>>>> local/apache2/include  -I/Users/michael/Desktop/
>>>>>>> mod_python-3.2.10/src/
>>>>>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
>>>>>>> Python.framework/Versions/2.4/include/python2.4  -c -o
>>>>>>> filterobject.lo filterobject.c && touch filterobject.slo
>>>>>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc -
>>>>>>> prefer-
>>>>>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -
>>>>>>> g -O2 -
>>>>>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/
>>>>>>> usr/
>>>>>>> local/apache2/include  -I/Users/michael/Desktop/
>>>>>>> mod_python-3.2.10/src/
>>>>>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
>>>>>>> Python.framework/Versions/2.4/include/python2.4  -c -o hlist.lo
>>>>>>> hlist.c && touch hlist.slo
>>>>>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc -
>>>>>>> prefer-
>>>>>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -
>>>>>>> g -O2 -
>>>>>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/
>>>>>>> usr/
>>>>>>> local/apache2/include  -I/Users/michael/Desktop/
>>>>>>> mod_python-3.2.10/src/
>>>>>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
>>>>>>> Python.framework/Versions/2.4/include/python2.4  -c -o
>>>>>>> hlistobject.lo
>>>>>>> hlistobject.c && touch hlistobject.slo
>>>>>>> /usr/local/apache2/build/libtool --silent --mode=link gcc -o
>>>>>>> mod_python.la  -rpath /usr/local/apache2/modules -module -avoid-
>>>>>>> version    hlistobject.lo hlist.lo filterobject.lo connobject.lo
>>>>>>> serverobject.lo util.lo tableobject.lo requestobject.lo
>>>>>>> _apachemodule.lo mod_python.lo -Wl,-framework,Python -u
>>>>>>> _PyMac_Error /
>>>>>>> Versions// -arch i386 -arch ppc -isysroot /Developer/SDKs/
>>>>>>> MacOSX10.4u.sdk -g -lm -framework Python -ldl
>>>>>>> install: src/mod_python.so: No such file or directory
>>>>>>> make[1]: *** [install_dso] Error 71
>>>>>>>
>>>>>>> ---------------end make install output-------------------
>>>>>>> _______________________________________________
>>>>>>> Mod_python mailing list
>>>>>>> Mod_python@modpython.org
>>>>>>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>>
>>> _______________________________________________
>>> Mod_python mailing list
>>> Mod_python@modpython.org
>>> http://mailman.modpython.org/mailman/listinfo/mod_python

From grahamd at dscpl.com.au  Thu Jan 11 16:07:34 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Jan 11 16:09:09 2007
Subject: [mod_python] Building Problems on OS X (intel macbook core2duo)
In-Reply-To: <8C993430-C2D9-4EB1-A1C5-00CF590A0776@gmx.de>
References: <1168489712.17717@dscpl.user.openhosting.com>
	<8C993430-C2D9-4EB1-A1C5-00CF590A0776@gmx.de>
Message-ID: <858F2159-D3FF-4B65-ACBB-B50CF5BFF84D@dscpl.com.au>


On 12/01/2007, at 2:48 AM, michael starke wrote:

> Even the routines make mistakes, makes them look more human.
>
> I did what you suggested, the line in my makefile (after configure,  
> i told you, am new to this =) looks like this:
>
> LDFLAGS= -Wl,-framework,Python  -u _PyMac_Error $ 
> (PYTHONFRAMEWORKDIR)/Versions/$(VERSION)/$(PYTHONFRAMEWORK)   -arch  
> i386 -arch ppc -isysroot /Developer/SDKs/MacOSX10.4u.sdk -g
>
> I changed it to
>
> LDFLAGS= -Wl,-framework,Python  -u _PyMac_Error   -arch i386 -arch  
> ppc -isysroot /Developer/SDKs/MacOSX10.4u.sdk -g

Try taking out:

   -arch ppc

and if still not working, also take out:

   -arch i386

You could even drop the:

   -isysroot /Developer/SDKs/MacOSX10.4u.sdk

which I have never seen before and may be screwing up libtool.

Graham

> after a make and a make install i still get no result, it still  
> tries to find the mod_python.so in the scr/ folder, but it's still  
> not there. (just the link, not the real file)
> Any other suggestions? Or do i have a bigger issue with my setup.  
> The system is quite near to a blank installation, cause the book  
> was right out of the box, just developer tools installed, apache  
> compiled, and the then errors with mod_python.
>
> michael
>
> On 11.01.2007, at 05:28, Graham Dumpleton wrote:
>
>> Whoops. My web mail used the wrong email when I clicked reply on  
>> it. :-(
>>
>> Lets reply to the correct email.
>>
>> Edit 'src/Makefile' and look for LDFLAGS definition similar to:
>>
>> LDFLAGS= -Wl,-framework,Python  -u __dummy -u _PyMac_Error - 
>> framework System $(PYTHONFRAMEWORKDIR)/Versions/$(VERSION)/$ 
>> (PYTHONFRAMEWORK)
>> -framework CoreServices -framework Foundation   -Wl,-F. -Wl,-F.
>>
>> Edit this like to remove:
>>
>>   $(PYTHONFRAMEWORKDIR)/Versions/$(VERSION)/$(PYTHONFRAMEWORK)
>>
>> Then try a make again.
>>
>> Graham
>>
>> michael starke wrote ..
>>> Well,
>>>
>>> i upgraded the Xtools and now got the built 5367 of the gcc  
>>> compiler,
>>> but still i get the same error while building mod_python.
>>> Any suggestions? Help would be appreciatiated :)
>>>
>>> greetings,
>>> michael
>>>
>>> On 08.01.2007, at 18:39, michael starke wrote:
>>>
>>>> Hi sorry, for the messup with the mailings... am new to this =(
>>>>
>>>> Here's the output form gcc -v
>>>>
>>>> Using built-in specs.
>>>> Target: i686-apple-darwin8
>>>> Configured with: /private/var/tmp/gcc/gcc-5363.obj~28/src/configure
>>>> --disable-checking -enable-werror --prefix=/usr --mandir=/share/man
>>>> --enable-languages=c,objc,c++,obj-c++ --program-transform-name=/^
>>>> [cg][^.-]*$/s/$/-4.0/ --with-gxx-include-dir=/include/c++/4.0.0 --
>>>> with-slibdir=/usr/lib --build=powerpc-apple-darwin8 --with-
>>>> arch=nocona --with-tune=generic --program-prefix= --host=i686- 
>>>> apple-
>>>> darwin8 --target=i686-apple-darwin8
>>>> Thread model: posix
>>>> gcc version 4.0.1 (Apple Computer, Inc. build 5363)
>>>>
>>>> I startde downloading the 2.4.1 developer tools, to take a look at
>>>> the buildversion of it's gcc and i'll try it with this version then
>>>> again.
>>>>
>>>>
>>>> On 08.01.2007, at 10:39, Graham Dumpleton wrote:
>>>>
>>>>> Run:
>>>>>
>>>>>   gcc -v
>>>>>
>>>>> and post the result here. You might be hitting this problem:
>>>>>
>>>>>   http://issues.apache.org/jira/browse/MODPYTHON-186
>>>>>
>>>>> Only seems to affect certain versions of compiler tool chain.
>>>>>
>>>>> BTW.  Please keep followups on the mailing list.
>>>>>
>>>>> On 08/01/2007, at 6:45 PM, michael starke wrote:
>>>>>
>>>>>> I'll try that, but i used a pre-built python version to work
>>>>>> parallel
>>>>>> so i don't know why the error is present there
>>>>>>
>>>>>> And i need python 2.4 (if i recall correctly) for some python
>>>>>> packages to work.
>>>>>>
>>>>>> Michael
>>>>>>
>>>>>> On 08.01.2007, at 05:42, Graham Dumpleton wrote:
>>>>>>
>>>>>>> Can you try with the operating system supplied version of Python
>>>>>>> (2.3.5)
>>>>>>> instead of your own compiled Python 2.4 as the build  
>>>>>>> configuration
>>>>>>> associated with your 2.4 version doesn't look right.
>>>>>>>
>>>>>>> BTW, did you compiled your Python 2.4 from scratch? You might be
>>>>>>> better
>>>>>>> off using one of the prebuilt dmg versions of Python instead as
>>>>>>> they tend
>>>>>>> to be setup correctly and work in parallel to the OS version
>>>>>>> better.
>>>>>>>
>>>>>>> Graham
>>>>>>>
>>>>>>> michael starke wrote ..
>>>>>>>> Hello there,
>>>>>>>>
>>>>>>>> i have a big problem and since i'm not to experinced witht the
>>>>>>>> whole
>>>>>>>> built from source way i want to ask you, if you know where the
>>>>>>>> problem lies.
>>>>>>>>
>>>>>>>> I have apache2 installed (built and running) in  /usr/local/
>>>>>>>> apache2/...
>>>>>>>> I have python2.4 installed and running smoothly
>>>>>>>> I downloaded mod_python 3.2.10 and configured it with
>>>>>>>>
>>>>>>>> 	--with-apxs=/usr/local/apache2/bin/apxs
>>>>>>>> 	--with-python=/usr/local/bin/python2.4
>>>>>>>>
>>>>>>>> so the configure seems to work, but when i run make/make
>>>>>>>> install at
>>>>>>>> the end i get the error, that the build mod_python.so is not
>>>>>>>> found,
>>>>>>>> there is a symlink in the /src/ folder and it points to  
>>>>>>>> a .built/
>>>>>>>> directory, but that is not there...
>>>>>>>>
>>>>>>>> Having no clue what to do i'm asking for your help. The same
>>>>>>>> routine
>>>>>>>> (with apache 2.0.x) and differnent install locations worked
>>>>>>>> fine on
>>>>>>>> my powermac a year before but the installation on the macbook
>>>>>>>> is not
>>>>>>>> working the way it should be..obviously.
>>>>>>>>
>>>>>>>> I can give you a logpart form make install, but i guess it's  
>>>>>>>> not
>>>>>>>> really helping.
>>>>>>>>
>>>>>>>> ----------make install output------------
>>>>>>>>
>>>>>>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc -
>>>>>>>> prefer-
>>>>>>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -
>>>>>>>> g -O2 -
>>>>>>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/
>>>>>>>> usr/
>>>>>>>> local/apache2/include  -I/Users/michael/Desktop/
>>>>>>>> mod_python-3.2.10/src/
>>>>>>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
>>>>>>>> Python.framework/Versions/2.4/include/python2.4  -c -o
>>>>>>>> mod_python.lo
>>>>>>>> mod_python.c && touch mod_python.slo
>>>>>>>> mod_python.c: In function 'python_cleanup':
>>>>>>>> mod_python.c:313: warning: passing argument 1 of 'free'  
>>>>>>>> discards
>>>>>>>> qualifiers from pointer target type
>>>>>>>> mod_python.c: In function 'init_mutexes':
>>>>>>>> mod_python.c:427: warning: assignment discards qualifiers from
>>>>>>>> pointer target type
>>>>>>>> mod_python.c:458: warning: assignment discards qualifiers from
>>>>>>>> pointer target type
>>>>>>>> mod_python.c: In function 'reinit_mutexes':
>>>>>>>> mod_python.c:540: warning: assignment discards qualifiers from
>>>>>>>> pointer target type
>>>>>>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc -
>>>>>>>> prefer-
>>>>>>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -
>>>>>>>> g -O2 -
>>>>>>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/
>>>>>>>> usr/
>>>>>>>> local/apache2/include  -I/Users/michael/Desktop/
>>>>>>>> mod_python-3.2.10/src/
>>>>>>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
>>>>>>>> Python.framework/Versions/2.4/include/python2.4  -c -o
>>>>>>>> _apachemodule.lo _apachemodule.c && touch _apachemodule.slo
>>>>>>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc -
>>>>>>>> prefer-
>>>>>>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -
>>>>>>>> g -O2 -
>>>>>>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/
>>>>>>>> usr/
>>>>>>>> local/apache2/include  -I/Users/michael/Desktop/
>>>>>>>> mod_python-3.2.10/src/
>>>>>>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
>>>>>>>> Python.framework/Versions/2.4/include/python2.4  -c -o
>>>>>>>> requestobject.lo requestobject.c && touch requestobject.slo
>>>>>>>> requestobject.c: In function 'req_get_options':
>>>>>>>> requestobject.c:426: warning: initialization discards
>>>>>>>> qualifiers from
>>>>>>>> pointer target type
>>>>>>>> requestobject.c:427: warning: initialization from incompatible
>>>>>>>> pointer type
>>>>>>>> requestobject.c: In function 'getmakeobj':
>>>>>>>> requestobject.c:1447: warning: assignment from incompatible
>>>>>>>> pointer type
>>>>>>>> requestobject.c:1454: warning: assignment from incompatible
>>>>>>>> pointer type
>>>>>>>> requestobject.c: In function 'request_tp_clear':
>>>>>>>> requestobject.c:1569: warning: assignment from incompatible
>>>>>>>> pointer type
>>>>>>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc -
>>>>>>>> prefer-
>>>>>>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -
>>>>>>>> g -O2 -
>>>>>>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/
>>>>>>>> usr/
>>>>>>>> local/apache2/include  -I/Users/michael/Desktop/
>>>>>>>> mod_python-3.2.10/src/
>>>>>>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
>>>>>>>> Python.framework/Versions/2.4/include/python2.4  -c -o
>>>>>>>> tableobject.lo
>>>>>>>> tableobject.c && touch tableobject.slo
>>>>>>>> tableobject.c:1057: warning: initialization from incompatible
>>>>>>>> pointer
>>>>>>>> type
>>>>>>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc -
>>>>>>>> prefer-
>>>>>>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -
>>>>>>>> g -O2 -
>>>>>>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/
>>>>>>>> usr/
>>>>>>>> local/apache2/include  -I/Users/michael/Desktop/
>>>>>>>> mod_python-3.2.10/src/
>>>>>>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
>>>>>>>> Python.framework/Versions/2.4/include/python2.4  -c -o util.lo
>>>>>>>> util.c
>>>>>>>> && touch util.slo
>>>>>>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc -
>>>>>>>> prefer-
>>>>>>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -
>>>>>>>> g -O2 -
>>>>>>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/
>>>>>>>> usr/
>>>>>>>> local/apache2/include  -I/Users/michael/Desktop/
>>>>>>>> mod_python-3.2.10/src/
>>>>>>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
>>>>>>>> Python.framework/Versions/2.4/include/python2.4  -c -o
>>>>>>>> serverobject.lo serverobject.c && touch serverobject.slo
>>>>>>>> serverobject.c:351: warning: initialization from incompatible
>>>>>>>> pointer
>>>>>>>> type
>>>>>>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc -
>>>>>>>> prefer-
>>>>>>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -
>>>>>>>> g -O2 -
>>>>>>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/
>>>>>>>> usr/
>>>>>>>> local/apache2/include  -I/Users/michael/Desktop/
>>>>>>>> mod_python-3.2.10/src/
>>>>>>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
>>>>>>>> Python.framework/Versions/2.4/include/python2.4  -c -o
>>>>>>>> connobject.lo
>>>>>>>> connobject.c && touch connobject.slo
>>>>>>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc -
>>>>>>>> prefer-
>>>>>>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -
>>>>>>>> g -O2 -
>>>>>>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/
>>>>>>>> usr/
>>>>>>>> local/apache2/include  -I/Users/michael/Desktop/
>>>>>>>> mod_python-3.2.10/src/
>>>>>>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
>>>>>>>> Python.framework/Versions/2.4/include/python2.4  -c -o
>>>>>>>> filterobject.lo filterobject.c && touch filterobject.slo
>>>>>>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc -
>>>>>>>> prefer-
>>>>>>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -
>>>>>>>> g -O2 -
>>>>>>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/
>>>>>>>> usr/
>>>>>>>> local/apache2/include  -I/Users/michael/Desktop/
>>>>>>>> mod_python-3.2.10/src/
>>>>>>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
>>>>>>>> Python.framework/Versions/2.4/include/python2.4  -c -o hlist.lo
>>>>>>>> hlist.c && touch hlist.slo
>>>>>>>> /usr/local/apache2/build/libtool --silent --mode=compile gcc -
>>>>>>>> prefer-
>>>>>>>> pic   -DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp -
>>>>>>>> g -O2 -
>>>>>>>> I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/
>>>>>>>> usr/
>>>>>>>> local/apache2/include  -I/Users/michael/Desktop/
>>>>>>>> mod_python-3.2.10/src/
>>>>>>>> include -I/usr/local/apache2/include -I/Library/Frameworks/
>>>>>>>> Python.framework/Versions/2.4/include/python2.4  -c -o
>>>>>>>> hlistobject.lo
>>>>>>>> hlistobject.c && touch hlistobject.slo
>>>>>>>> /usr/local/apache2/build/libtool --silent --mode=link gcc -o
>>>>>>>> mod_python.la  -rpath /usr/local/apache2/modules -module - 
>>>>>>>> avoid-
>>>>>>>> version    hlistobject.lo hlist.lo filterobject.lo  
>>>>>>>> connobject.lo
>>>>>>>> serverobject.lo util.lo tableobject.lo requestobject.lo
>>>>>>>> _apachemodule.lo mod_python.lo -Wl,-framework,Python -u
>>>>>>>> _PyMac_Error /
>>>>>>>> Versions// -arch i386 -arch ppc -isysroot /Developer/SDKs/
>>>>>>>> MacOSX10.4u.sdk -g -lm -framework Python -ldl
>>>>>>>> install: src/mod_python.so: No such file or directory
>>>>>>>> make[1]: *** [install_dso] Error 71
>>>>>>>>
>>>>>>>> ---------------end make install output-------------------
>>>>>>>> _______________________________________________
>>>>>>>> Mod_python mailing list
>>>>>>>> Mod_python@modpython.org
>>>>>>>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>>>
>>>> _______________________________________________
>>>> Mod_python mailing list
>>>> Mod_python@modpython.org
>>>> http://mailman.modpython.org/mailman/listinfo/mod_python
From moski666 at gmail.com  Thu Jan 11 16:56:31 2007
From: moski666 at gmail.com (Emiliano Moscato)
Date: Thu Jan 11 16:56:38 2007
Subject: [mod_python] how to handle xforms with publisher handler
Message-ID: <4388f4180701111356q53f2cae7t93bd23bac7d2cffd@mail.gmail.com>

Hi all!

I'm getting crazy trying to receive xforms xml data with mod_python +
publisher handler.
In a normal HTML form, the data would be sent as
application/x-www-form-urlencoded, in the XForms world however, this
information is sent as XML formatted data (application/xml).
Up to now I've used cherryPy as web server and I've got my xml data with
cherrypy.threadData.xform.
I've read that PHP receive this in $HTTP_RAW_POST_DATA variable. If I send
the form to a php script all work fine.
But when I try to submit a xforms with method POST to a script managed by
publisher handler I get an error with no log in my apache server error log.
Any help?
TIA
-- 
mOsKi
"No hay nada que uno haga mal , lo que hay es poco vino." Autor Anonimo
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070111/363c1514/attachment.html
From jpg at jgassociates.ca  Thu Jan 11 20:28:26 2007
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Thu Jan 11 20:22:46 2007
Subject: [mod_python] how to handle xforms with publisher handler
In-Reply-To: <4388f4180701111356q53f2cae7t93bd23bac7d2cffd@mail.gmail.com>
References: <4388f4180701111356q53f2cae7t93bd23bac7d2cffd@mail.gmail.com>
Message-ID: <45A6E43A.3090604@jgassociates.ca>

Emiliano Moscato wrote:
> Hi all!
> 
> I'm getting crazy trying to receive xforms xml data with mod_python +
> publisher handler.
> In a normal HTML form, the data would be sent as
> application/x-www-form-urlencoded, in the XForms world however, this
> information is sent as XML formatted data (application/xml).
> Up to now I've used cherryPy as web server and I've got my xml data with
> cherrypy.threadData.xform.
> I've read that PHP receive this in $HTTP_RAW_POST_DATA variable. If I send
> the form to a php script all work fine.
> But when I try to submit a xforms with method POST to a script managed by
> publisher handler I get an error with no log in my apache server error log.
> Any help?

You'll need to elaborate on the error you are getting, but I think part 
of the problem is that you are bumping up against part of the internal 
"magic" of publisher.

Publisher automatically creates a FieldStorage instance. Unfortunately 
FieldStorage assumes that the content-type starts with either 
"application/x-www-form-urlencoded" or "multipart/". If I had to guess 
I'd say that you are getting "501 Not Implemented error" as a result.

Here are a couple of solutions that you might consider as a workaround:

1. Hack util.FieldStorage to properly handle your content-type. If you 
do this feel free to submit a patch so FieldStorage can be fixed. ;)

2. Hack publisher to skip the automatic creation of FieldStorage. (Line 
424 in publisher.py for mod_python 3.3.0b). You can then use req.read() 
to read and process the POST'd data within your content handler.

3. Use a PythonFixupHandler before the content handler. In the 
fixuphandler use req.read() to grab the raw data and adjust the 
content-type header so that FieldStorage doesn't bomb out. Note that if 
you want to pass xml field data as parameters to your handler method 
you'll need to do a bit more work. For example

def index(foo="bar"):
     return "whatever"

won't get foo from your xml data. You can likely work around this but 
you'll need to take a look at the source for FieldStorage and publisher 
to work out a strategy.

I hope this helps.

Jim
From grahamd at dscpl.com.au  Thu Jan 11 20:44:38 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Jan 11 20:44:45 2007
Subject: [mod_python] execution time limit
Message-ID: <1168566278.28347@dscpl.user.openhosting.com>

Send this back to the mailing list. I have no idea how PHP does it.

Michael Rasmussen wrote ..
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
> 
> On Tue, 9 Jan 2007 18:10:09 -0500
> "Graham Dumpleton" <grahamd@dscpl.com.au> wrote:
> 
> > 
> > This sort of stuff very much has to be done by a user in their
> > handlers, it can't be done as a standard feature of mod_python as it
> > would be impossible to come up with something that would work for all
> > users code.
> > 
> How have they done this in PHP? Have the taken a different path in
> design?
> 
> - -- 
> Hilsen/Regards
> Michael Rasmussen
> 
> Get my public GnuPG keys:
> michael <at> rasmussen <dot> cc
> http://keyserver.veridis.com:11371/pks/lookup?op=get&search=0xD3C9A00E
> mir <at> datanom <dot> net
> http://keyserver.veridis.com:11371/pks/lookup?op=get&search=0xE501F51C
> mir <at> miras <dot> org
> http://keyserver.veridis.com:11371/pks/lookup?op=get&search=0xE3E80917
> - --------------------------------------------------------------
> BOFH excuse #60:
> 
> system has been recalled
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.6 (GNU/Linux)
> 
> iD8DBQFFpsSAVErYVePoCRcRAmaxAJ907bU3UvqFvyvGInbTEeH8QvdiIgCglWRm
> CLUjsbCdbA/kh1ahk4f4Myg=
> =cUuh
> -----END PGP SIGNATURE-----
From grahamd at dscpl.com.au  Thu Jan 11 21:00:20 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Jan 11 21:00:26 2007
Subject: [mod_python] how to handle xforms with publisher handler
Message-ID: <1168567220.3164@dscpl.user.openhosting.com>

Jim Gallacher wrote ..
> Emiliano Moscato wrote:
> > Hi all!
> > 
> > I'm getting crazy trying to receive xforms xml data with mod_python +
> > publisher handler.

In what way are you using mod_python.publisher? Depending to what
degree you are using it, mod_python 3.3 offers some alternate mechanisms
for doing basic dispatch against different resources which might be more
useful and allow you to still access content of response to decode it.

> > In a normal HTML form, the data would be sent as
> > application/x-www-form-urlencoded, in the XForms world however, this
> > information is sent as XML formatted data (application/xml).
> > Up to now I've used cherryPy as web server and I've got my xml data with
> > cherrypy.threadData.xform.
> > I've read that PHP receive this in $HTTP_RAW_POST_DATA variable. If I
> send
> > the form to a php script all work fine.
> > But when I try to submit a xforms with method POST to a script managed
> by
> > publisher handler I get an error with no log in my apache server error
> log.
> > Any help?
> 
> You'll need to elaborate on the error you are getting, but I think part
> of the problem is that you are bumping up against part of the internal
> "magic" of publisher.
> 
> Publisher automatically creates a FieldStorage instance. Unfortunately
> FieldStorage assumes that the content-type starts with either 
> "application/x-www-form-urlencoded" or "multipart/". If I had to guess
> I'd say that you are getting "501 Not Implemented error" as a result.
> 
> Here are a couple of solutions that you might consider as a workaround:
> 
> 1. Hack util.FieldStorage to properly handle your content-type. If you
> do this feel free to submit a patch so FieldStorage can be fixed. ;)

Hmmm, xforms is quite different.

  http://www.w3.org/TR/xforms/

Looks like a lot of work.

> 2. Hack publisher to skip the automatic creation of FieldStorage. (Line
> 424 in publisher.py for mod_python 3.3.0b). You can then use req.read()
> to read and process the POST'd data within your content handler.

I've raised this issue before about publisher not being able to accept other
content types. See:

  http://issues.apache.org/jira/browse/MODPYTHON-29

Also, like PSP now does, publisher could be made to use 'req.form' if it
already existed. This would allow a stacked response handler before
publisher to decide whether some other form content was supplied, decode
it and set req.form to a compatible class to FieldStorage. I don't know that I
have created an issue for that idea before, but have certainly thought
about it and perhaps mentioned it on the mailing list.

> 3. Use a PythonFixupHandler before the content handler. In the 
> fixuphandler use req.read() to grab the raw data and adjust the 
> content-type header so that FieldStorage doesn't bomb out. Note that if
> you want to pass xml field data as parameters to your handler method 
> you'll need to do a bit more work. For example
> 
> def index(foo="bar"):
>      return "whatever"
> 
> won't get foo from your xml data. You can likely work around this but 
> you'll need to take a look at the source for FieldStorage and publisher
> to work out a strategy.

If you are talking about modifying the input stream, an input filter would
perhaps be better. Not sure that that will help since xforms is quite
different and isn't just a matter of changing content type.

Graham
From starke.m at gmx.de  Thu Jan 11 21:16:39 2007
From: starke.m at gmx.de (michael starke)
Date: Thu Jan 11 21:16:48 2007
Subject: [mod_python] Building Problems on OS X (intel macbook core2duo)
In-Reply-To: <858F2159-D3FF-4B65-ACBB-B50CF5BFF84D@dscpl.com.au>
References: <1168489712.17717@dscpl.user.openhosting.com>
	<8C993430-C2D9-4EB1-A1C5-00CF590A0776@gmx.de>
	<858F2159-D3FF-4B65-ACBB-B50CF5BFF84D@dscpl.com.au>
Message-ID: <8EA16210-586C-4C9D-9779-C1D70672097A@gmx.de>

I'm confused, either i'm making some stupid mistake all the time or  
it's still not working.
I removed the 3 arguments one by one and still, the built fails.
Damn, is there a way to get the mod built on another machine and then  
just load up the installtion to the macbook, hoping that it works?

michael

On 11.01.2007, at 22:07, Graham Dumpleton wrote:

>
> On 12/01/2007, at 2:48 AM, michael starke wrote:
>
>> Even the routines make mistakes, makes them look more human.
>>
>> I did what you suggested, the line in my makefile (after  
>> configure, i told you, am new to this =) looks like this:
>>
>> LDFLAGS= -Wl,-framework,Python  -u _PyMac_Error $ 
>> (PYTHONFRAMEWORKDIR)/Versions/$(VERSION)/$(PYTHONFRAMEWORK)   - 
>> arch i386 -arch ppc -isysroot /Developer/SDKs/MacOSX10.4u.sdk -g
>>
>> I changed it to
>>
>> LDFLAGS= -Wl,-framework,Python  -u _PyMac_Error   -arch i386 -arch  
>> ppc -isysroot /Developer/SDKs/MacOSX10.4u.sdk -g
>
> Try taking out:
>
>   -arch ppc
>
> and if still not working, also take out:
>
>   -arch i386
>
> You could even drop the:
>
>   -isysroot /Developer/SDKs/MacOSX10.4u.sdk
>
> which I have never seen before and may be screwing up libtool.
>
> Graham
>

From grahamd at dscpl.com.au  Thu Jan 11 21:50:20 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Jan 11 21:50:33 2007
Subject: [mod_python] Building Problems on OS X (intel macbook core2duo)
Message-ID: <1168570220.26129@dscpl.user.openhosting.com>

michael starke wrote ..
> I'm confused, either i'm making some stupid mistake all the time or  
> it's still not working.
> I removed the 3 arguments one by one and still, the built fails.
> Damn, is there a way to get the mod built on another machine and then 
> just load up the installtion to the macbook, hoping that it works?

Are you doing a:

  make clean

between build attempts when changing the makefile?

Can you run:

  gcc -v 

again so can see what version number it is now saying?

Graham


> On 11.01.2007, at 22:07, Graham Dumpleton wrote:
> 
> >
> > On 12/01/2007, at 2:48 AM, michael starke wrote:
> >
> >> Even the routines make mistakes, makes them look more human.
> >>
> >> I did what you suggested, the line in my makefile (after  
> >> configure, i told you, am new to this =) looks like this:
> >>
> >> LDFLAGS= -Wl,-framework,Python  -u _PyMac_Error $ 
> >> (PYTHONFRAMEWORKDIR)/Versions/$(VERSION)/$(PYTHONFRAMEWORK)   - 
> >> arch i386 -arch ppc -isysroot /Developer/SDKs/MacOSX10.4u.sdk -g
> >>
> >> I changed it to
> >>
> >> LDFLAGS= -Wl,-framework,Python  -u _PyMac_Error   -arch i386 -arch 
> >> ppc -isysroot /Developer/SDKs/MacOSX10.4u.sdk -g
> >
> > Try taking out:
> >
> >   -arch ppc
> >
> > and if still not working, also take out:
> >
> >   -arch i386
> >
> > You could even drop the:
> >
> >   -isysroot /Developer/SDKs/MacOSX10.4u.sdk
> >
> > which I have never seen before and may be screwing up libtool.
> >
> > Graham
> >
From jpg at jgassociates.ca  Thu Jan 11 22:04:11 2007
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Thu Jan 11 21:57:49 2007
Subject: [mod_python] how to handle xforms with publisher handler
In-Reply-To: <1168567220.3164@dscpl.user.openhosting.com>
References: <1168567220.3164@dscpl.user.openhosting.com>
Message-ID: <45A6FAAB.9070707@jgassociates.ca>

Graham Dumpleton wrote:
> Jim Gallacher wrote ..
>> Emiliano Moscato wrote:
>>> Hi all!
>>>
>>> I'm getting crazy trying to receive xforms xml data with mod_python +
>>> publisher handler.
> 
> In what way are you using mod_python.publisher? Depending to what
> degree you are using it, mod_python 3.3 offers some alternate mechanisms
> for doing basic dispatch against different resources which might be more
> useful and allow you to still access content of response to decode it.
> 
>>> In a normal HTML form, the data would be sent as
>>> application/x-www-form-urlencoded, in the XForms world however, this
>>> information is sent as XML formatted data (application/xml).
>>> Up to now I've used cherryPy as web server and I've got my xml data with
>>> cherrypy.threadData.xform.
>>> I've read that PHP receive this in $HTTP_RAW_POST_DATA variable. If I
>> send
>>> the form to a php script all work fine.
>>> But when I try to submit a xforms with method POST to a script managed
>> by
>>> publisher handler I get an error with no log in my apache server error
>> log.
>>> Any help?
>> You'll need to elaborate on the error you are getting, but I think part
>> of the problem is that you are bumping up against part of the internal
>> "magic" of publisher.
>>
>> Publisher automatically creates a FieldStorage instance. Unfortunately
>> FieldStorage assumes that the content-type starts with either 
>> "application/x-www-form-urlencoded" or "multipart/". If I had to guess
>> I'd say that you are getting "501 Not Implemented error" as a result.
>>
>> Here are a couple of solutions that you might consider as a workaround:
>>
>> 1. Hack util.FieldStorage to properly handle your content-type. If you
>> do this feel free to submit a patch so FieldStorage can be fixed. ;)
> 
> Hmmm, xforms is quite different.
> 
>   http://www.w3.org/TR/xforms/
> 
> Looks like a lot of work.

Probably. I certainly wasn't offering to do it. ;)

>> 2. Hack publisher to skip the automatic creation of FieldStorage. (Line
>> 424 in publisher.py for mod_python 3.3.0b). You can then use req.read()
>> to read and process the POST'd data within your content handler.
> 
> I've raised this issue before about publisher not being able to accept other
> content types. See:
> 
>   http://issues.apache.org/jira/browse/MODPYTHON-29
> 
> Also, like PSP now does, publisher could be made to use 'req.form' if it
> already existed. This would allow a stacked response handler before
> publisher to decide whether some other form content was supplied, decode
> it and set req.form to a compatible class to FieldStorage. I don't know that I
> have created an issue for that idea before, but have certainly thought
> about it and perhaps mentioned it on the mailing list.

That seems like a reasonable solution.

>> 3. Use a PythonFixupHandler before the content handler. In the 
>> fixuphandler use req.read() to grab the raw data and adjust the 
>> content-type header so that FieldStorage doesn't bomb out. Note that if
>> you want to pass xml field data as parameters to your handler method 
>> you'll need to do a bit more work. For example
>>
>> def index(foo="bar"):
>>      return "whatever"
>>
>> won't get foo from your xml data. You can likely work around this but 
>> you'll need to take a look at the source for FieldStorage and publisher
>> to work out a strategy.
> 
> If you are talking about modifying the input stream, an input filter would
> perhaps be better. Not sure that that will help since xforms is quite
> different and isn't just a matter of changing content type.

No, I was just thinking you could get the raw data with req.read() 
(parsing the xml or whatever) and then set the content-type to 
application/x-www-form-urlencoded. That way the subsequent call to 
FieldStorage within publisher won't bomb out. The code would look 
something like this:

def fixuphandler(req):
     if req.headers_in.has_key("content-type"):
         ctype = req.headers_in["content-type"]
         if ctype.startswith("application/xml"):
             req.data = parse_the_xml_data_or_whatever(req.read())
             req.headers_in["content-type"] =
                      "application/x-www-form-urlencoded"
     return apache.OK

A little too hackish perhaps? (Assuming it would even work).

Jim
From grahamd at dscpl.com.au  Fri Jan 12 05:06:40 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Fri Jan 12 05:06:50 2007
Subject: [mod_python] Building Problems on OS X (intel macbook core2duo)
In-Reply-To: <1168570220.26129@dscpl.user.openhosting.com>
References: <1168570220.26129@dscpl.user.openhosting.com>
Message-ID: <6C54BB3F-02FB-4DDA-A1B2-1093A1F7E99B@dscpl.com.au>

BTW, I know you want to use Python 2.4, but can you go back and actually
try the Python 2.3.5 supplied with the operating system as standard  
instead
to see if that works.

Graham

On 12/01/2007, at 1:50 PM, Graham Dumpleton wrote:

> michael starke wrote ..
>> I'm confused, either i'm making some stupid mistake all the time or
>> it's still not working.
>> I removed the 3 arguments one by one and still, the built fails.
>> Damn, is there a way to get the mod built on another machine and then
>> just load up the installtion to the macbook, hoping that it works?
>
> Are you doing a:
>
>   make clean
>
> between build attempts when changing the makefile?
>
> Can you run:
>
>   gcc -v
>
> again so can see what version number it is now saying?
>
> Graham
>
>
>> On 11.01.2007, at 22:07, Graham Dumpleton wrote:
>>
>>>
>>> On 12/01/2007, at 2:48 AM, michael starke wrote:
>>>
>>>> Even the routines make mistakes, makes them look more human.
>>>>
>>>> I did what you suggested, the line in my makefile (after
>>>> configure, i told you, am new to this =) looks like this:
>>>>
>>>> LDFLAGS= -Wl,-framework,Python  -u _PyMac_Error $
>>>> (PYTHONFRAMEWORKDIR)/Versions/$(VERSION)/$(PYTHONFRAMEWORK)   -
>>>> arch i386 -arch ppc -isysroot /Developer/SDKs/MacOSX10.4u.sdk -g
>>>>
>>>> I changed it to
>>>>
>>>> LDFLAGS= -Wl,-framework,Python  -u _PyMac_Error   -arch i386 -arch
>>>> ppc -isysroot /Developer/SDKs/MacOSX10.4u.sdk -g
>>>
>>> Try taking out:
>>>
>>>   -arch ppc
>>>
>>> and if still not working, also take out:
>>>
>>>   -arch i386
>>>
>>> You could even drop the:
>>>
>>>   -isysroot /Developer/SDKs/MacOSX10.4u.sdk
>>>
>>> which I have never seen before and may be screwing up libtool.
>>>
>>> Graham
>>>
From fred at urlbit.us  Fri Jan 12 10:45:21 2007
From: fred at urlbit.us (Fred of UrlBit.Us)
Date: Fri Jan 12 10:45:40 2007
Subject: [mod_python] 2006 "MySQL server has gone away" failures
Message-ID: <200701121045.22939.fred@urlbit.us>

Hello, all.

I intend to use mod_python for a couple of major websites, but I am running 
into an annoying problem.

I've seen something similar posted elsewhere, but no firm resolution.

My mod_python server will run just fine for a while following a restart of 
Apache, but after some time I get the following OperationalError exception:

OperationalError: (2006, 'MySQL server has gone away')

I can't seem to nail this one down, or even why it would happen. I even tried 
pinging the connection early on in the handler, but still no dice.

A restart of the server eliminates the problem for a while. Also, sometimes 
the problem goes away on its own (but comes back later). And of course, when 
I am sitting there trying to reproduce the problem, it works perfectly!

Any clues or suggestions would be extremely helpful.

Setup: Apache 2, Python 2.5, mod_python 3.2.10

stack dump:

ERROR In PyClops plugin <module 'app.urlbit' 
from '/home/urlbit/site/web/php/app/urlbit/__init__.py'> 
            Traceback (most recent call last):
  File "/home/ecms/py/pyclops/plugins/__init__.py", line 34, in 
_application_dispatcher
    if plug.handle(pyreq):
  File "/home/urlbit/site/web/php/app/urlbit/__init__.py", line 52, in handle
    psp.handle(pyreq)
  File "/home/ecms/py/pyclops/psp.py", line 25, in handle
    p.run()
  File "/usr/local/lib/python2.5/site-packages/mod_python/psp.py", line 213, 
in run
    exec code in global_scope
  File "/home/urlbit/site/web/create.html", line 100, in <module>
  File "/usr/local/lib/python2.5/site-packages/MySQLdb/cursors.py", line 163, 
in execute
    self.errorhandler(self, exc, value)
  File "/usr/local/lib/python2.5/site-packages/MySQLdb/connections.py", line 
35, in defaulterrorhandler
    raise errorclass, errorvalue
OperationalError: (2006, 'MySQL server has gone away')

-- Fred
http://urlbit.us
Bite those long URLs!
From martijn at xs4us.nu  Fri Jan 12 11:30:38 2007
From: martijn at xs4us.nu (Martijn Moeling)
Date: Fri Jan 12 11:30:50 2007
Subject: [mod_python] 2006 "MySQL server has gone away" failures
Message-ID: <B6C73A5E30565245BB6D32B5F5DF7A521202CE@sense.emmastraat.pijnacker>

Hi

First you should create a database connection non globally the best way
to do so is to create it as part of the req object in your handler

I suggest you do in your handler routine:

def handler(req):
	req.database=whatever to connect to your database
	req.cursor=req.database.cursor()
	req.register_cleanup(closedb,req)	
	... # dor the rest of your stuff

Note the register cleanup line, this is always called, even  if the
request fails with a python error:

def closedb(req):
	req.cursor.close()
	req.database.close()
	


Now the connections get closed nicely and mysql does not run out of
resources anymore.

Martijn

-----Oorspronkelijk bericht-----
Van: mod_python-bounces@modpython.org
[mailto:mod_python-bounces@modpython.org] Namens Fred of UrlBit.Us
Verzonden: Friday, January 12, 2007 4:45 PM
Aan: mod_python@modpython.org
Onderwerp: [mod_python] 2006 "MySQL server has gone away" failures

Hello, all.

I intend to use mod_python for a couple of major websites, but I am
running 
into an annoying problem.

I've seen something similar posted elsewhere, but no firm resolution.

My mod_python server will run just fine for a while following a restart
of 
Apache, but after some time I get the following OperationalError
exception:

OperationalError: (2006, 'MySQL server has gone away')

I can't seem to nail this one down, or even why it would happen. I even
tried 
pinging the connection early on in the handler, but still no dice.

A restart of the server eliminates the problem for a while. Also,
sometimes 
the problem goes away on its own (but comes back later). And of course,
when 
I am sitting there trying to reproduce the problem, it works perfectly!

Any clues or suggestions would be extremely helpful.

Setup: Apache 2, Python 2.5, mod_python 3.2.10

stack dump:

ERROR In PyClops plugin <module 'app.urlbit' 
from '/home/urlbit/site/web/php/app/urlbit/__init__.py'> 
            Traceback (most recent call last):
  File "/home/ecms/py/pyclops/plugins/__init__.py", line 34, in 
_application_dispatcher
    if plug.handle(pyreq):
  File "/home/urlbit/site/web/php/app/urlbit/__init__.py", line 52, in
handle
    psp.handle(pyreq)
  File "/home/ecms/py/pyclops/psp.py", line 25, in handle
    p.run()
  File "/usr/local/lib/python2.5/site-packages/mod_python/psp.py", line
213, 
in run
    exec code in global_scope
  File "/home/urlbit/site/web/create.html", line 100, in <module>
  File "/usr/local/lib/python2.5/site-packages/MySQLdb/cursors.py", line
163, 
in execute
    self.errorhandler(self, exc, value)
  File "/usr/local/lib/python2.5/site-packages/MySQLdb/connections.py",
line 
35, in defaulterrorhandler
    raise errorclass, errorvalue
OperationalError: (2006, 'MySQL server has gone away')

-- Fred
http://urlbit.us
Bite those long URLs!
_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://mailman.modpython.org/mailman/listinfo/mod_python

From alainna at pha.jhu.edu  Fri Jan 12 12:24:16 2007
From: alainna at pha.jhu.edu (Alainna C. Wonders)
Date: Fri Jan 12 12:24:24 2007
Subject: [mod_python] Can't get/create handler errors
Message-ID: <Pine.LNX.4.44.0701121218020.28148-100000@skysrv.pha.jhu.edu>


Hi All, 

I have a Scientific Linux 4.2 server with two versions of python installed 
(2.3.4, stock; 2.4.2, my installation).  

In my apache error log, I see errors like: 

python_handler: no interpreter callback found.
python_handler: Can't get/create interpreter.
make_obcallback: could not import mod_python.apache.\n
ImportError: No module named mod_python.apache
make_obcallback: Python path being used 
"['/usr/lib/python23.zip', '/usr/lib/python2.3', 
'/usr/lib/python2.3/plat-linux2', '/usr/lib/python2.3/lib-tk', 
'/usr/lib/python2.3/lib-dynload', '/usr/lib/python2.3/site-packages', 
'/usr/lib/python2.3/site-packages/gtk-2.0']".

My configure command looked like this: 

./configure --with-apxs=/usr/sbin/apxs 
--with-python=/usr/local/bin/python2.4

It ran without error, as did make/make install. 

I have also set a PATH variable in the httpd init script telling it to 
look in /usr/local/bin first.  There is /usr/local/bin/python, which is 
set to Python 2.4.2

Any recommendations?  I've seen some stuff on google, and it suggested 
setting apache's path, which I thought could be done by setting the PATH 
variable in the init script and then restarting the daemon.

Thanks,

Alainna

From list at joreybump.com  Fri Jan 12 12:31:26 2007
From: list at joreybump.com (Jorey Bump)
Date: Fri Jan 12 12:31:34 2007
Subject: [mod_python] 2006 "MySQL server has gone away" failures
In-Reply-To: <B6C73A5E30565245BB6D32B5F5DF7A521202CE@sense.emmastraat.pijnacker>
References: <B6C73A5E30565245BB6D32B5F5DF7A521202CE@sense.emmastraat.pijnacker>
Message-ID: <45A7C5EE.8070909@joreybump.com>

Martijn Moeling wrote:

> First you should create a database connection non globally the best way
> to do so is to create it as part of the req object in your handler
> 
> I suggest you do in your handler routine:
> 
> def handler(req):
> 	req.database=whatever to connect to your database
> 	req.cursor=req.database.cursor()
> 	req.register_cleanup(closedb,req)	
> 	... # dor the rest of your stuff
> 
> Note the register cleanup line, this is always called, even  if the
> request fails with a python error:
> 
> def closedb(req):
> 	req.cursor.close()
> 	req.database.close()
> 	
> Now the connections get closed nicely and mysql does not run out of
> resources anymore.

Interesting solution, but aren't you now (briefly) opening a database 
connection for every page view, regardless of it actually needing one?

Also, it looks like the OP is using the PSP handler, not a custom one. 
In that case, the best solution might be to explicitly open and close 
the db handle before and after every query (or tightly grouped series of 
queries). Recent versions of MySQLdb have made it difficult to create 
persistent db connections, and users are advised against it, since the 
overhead of creating new connections is negligible. I had to rewrite a 
number of applications that imported a shared db handle, due to this 
change. Bummer. :(


From mh at pixar.com  Fri Jan 12 14:38:41 2007
From: mh at pixar.com (Mark Harrison)
Date: Fri Jan 12 14:38:47 2007
Subject: [mod_python] execution time limit
In-Reply-To: <1168566278.28347@dscpl.user.openhosting.com>
References: <1168566278.28347@dscpl.user.openhosting.com>
Message-ID: <45A7E3C1.1060903@pixar.com>

Graham Dumpleton wrote:
> Send this back to the mailing list. I have no idea how PHP does it.

Something like this might work:

import signal

def myalarm(signo, stackframe):
    ...


def handler(req):
     signal.alarm(10) # schedule a sigalarm in 10 seconds
     signal.signal(signal.SIGALRM, myalarm)
     do_stuff()
     signal.alarm(0)  # cancel the alarm
From export at hope.cz  Fri Jan 12 15:37:22 2007
From: export at hope.cz (export@hope.cz)
Date: Fri Jan 12 15:38:08 2007
Subject: [mod_python] Several handlers
Message-ID: <45A7FF92.1986.809773E@export.hope.cz>

In my httpd.conf, I use
....
....
 SetHandler python-program
  PythonHandler django.core.handlers.modpython
...
...

now I would like to add my own PythonInputFilter.
How can  I add PythonInputFilter into httpd.conf?
I tried to add

 PythonInputFilter django.core.handlers.modpython

but it does not work.
The function inputfilter(filter)  was added into  django.core.handlers.modpython file.
Or must I use  a separate file, different from django.core.handlers.modpython file?

Thank you for help.
La.



  
From grahamd at dscpl.com.au  Fri Jan 12 16:32:38 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Fri Jan 12 16:32:50 2007
Subject: [mod_python] execution time limit
In-Reply-To: <45A7E3C1.1060903@pixar.com>
References: <1168566278.28347@dscpl.user.openhosting.com>
	<45A7E3C1.1060903@pixar.com>
Message-ID: <6C58CDFF-FEA2-4AD5-BA0A-A9254B53D243@dscpl.com.au>


On 13/01/2007, at 6:38 AM, Mark Harrison wrote:

> Graham Dumpleton wrote:
>> Send this back to the mailing list. I have no idea how PHP does it.
>
> Something like this might work:
>
> import signal
>
> def myalarm(signo, stackframe):
>    ...
>
>
> def handler(req):
>     signal.alarm(10) # schedule a sigalarm in 10 seconds
>     signal.signal(signal.SIGALRM, myalarm)
>     do_stuff()
>     signal.alarm(0)  # cancel the alarm

No. Could have potential for problems when using worker MPM or Windows
as you could interrupt system calls being done by handlers executing in
other threads within the same process. It could also interfere with  
the operation
of Apache as well and the manner in which it communicates information  
back
to the head process.

I would thus probably recommend against this approach.

Graham
From grahamd at dscpl.com.au  Fri Jan 12 16:39:35 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Fri Jan 12 16:39:48 2007
Subject: [mod_python] Several handlers
In-Reply-To: <45A7FF92.1986.809773E@export.hope.cz>
References: <45A7FF92.1986.809773E@export.hope.cz>
Message-ID: <3D33C3C7-2AC2-4759-87B9-8A5FE7776274@dscpl.com.au>


On 13/01/2007, at 7:37 AM, export@hope.cz wrote:

> In my httpd.conf, I use
> ....
> ....
>  SetHandler python-program
>   PythonHandler django.core.handlers.modpython
> ...
> ...
>
> now I would like to add my own PythonInputFilter.
> How can  I add PythonInputFilter into httpd.conf?
> I tried to add
>
>  PythonInputFilter django.core.handlers.modpython

Check the mod_python documentation. You don't have enough arguments
to this directive for a start and you also need AddInputFilter or  
SetInputFilter
to actually activate it as the PythonInputFilter directive only  
registers it, not
set it up for use. See:

   http://www.modpython.org/live/current/doc-html/dir-filter-if.html
   http://www.modpython.org/live/current/doc-html/pyapi-filter.html

> but it does not work.
> The function inputfilter(filter)  was added into   
> django.core.handlers.modpython file.
> Or must I use  a separate file, different from  
> django.core.handlers.modpython file?

My question now would be what are you trying to actually do? Unless  
you are
one of the developers of Django, why are you sticking the input  
filter in the
Django source code? Either location is okay, but if you aren't one of  
the Django
developers trying to enhance it in some way, put it in its own module  
file.

Graham
From moski666 at gmail.com  Fri Jan 12 16:41:26 2007
From: moski666 at gmail.com (Emiliano Moscato)
Date: Fri Jan 12 16:41:37 2007
Subject: [mod_python] how to handle xforms with publisher handler
In-Reply-To: <45A6FAAB.9070707@jgassociates.ca>
References: <1168567220.3164@dscpl.user.openhosting.com>
	<45A6FAAB.9070707@jgassociates.ca>
Message-ID: <4388f4180701121341i51c36fck5aa424b0e0a1e447@mail.gmail.com>

Hi all!

Thanks for your answers.
I've been looking the code of FieldStorage and publisher. I think it is not
soo dificult to patch FieldStorage, but: Is anybody else interested in patch
FieldStorage? If so I'll try it on monday.

On the other hand, I've trying to use another method to send my xforms which
uses "multipart/related" as Content-type and I realized that mozilla xforms
plugin sends a boundary that is bad handled by publisher-FieldStorage. This
is what browser sends:

[...]
Content-Length: 522
Content-Type: multipart/related;
boundary=---------------------------13592280651221337293469391600;
type="application/xml"; start="<4c599da9.58c746e8@mozilla.org>"
Cookie: lang=1

-----------------------------13592280651221337293469391600
Content-Type: application/xml
Content-ID: <4c599da9.58c746e8@mozilla.org>

<?xml version="1.0" encoding="UTF-8"?>
<idioma xmlns:xf="http://www.w3.org/2002/xforms" xmlns:ev="
http://www.w3.org/2001/xml-events" xmlns:xsi="
http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="
http://www.w3.org/2001/XMLSchema">

      <H__interface>main</H__interface>
      <idioma>adadsfasd</idioma>
    </idioma>
-----------------------------13592280651221337293469391600--


But FieldStorage parse the content-type line up to the end trying to get
boundary, getting this as boundary:
-----------------------------7393760691212604279930853199;
type="application/xml"; start="<b8f2849.19571884@mozilla.org>

Is this a firefox problem or a FieldStorage problem?
Regards, enjoy the weekend :)

Emiliano


2007/1/12, Jim Gallacher <jpg@jgassociates.ca>:
>
> Graham Dumpleton wrote:
> > Jim Gallacher wrote ..
> >> Emiliano Moscato wrote:
> >>> Hi all!
> >>>
> >>> I'm getting crazy trying to receive xforms xml data with mod_python +
> >>> publisher handler.
> >
> > In what way are you using mod_python.publisher? Depending to what
> > degree you are using it, mod_python 3.3 offers some alternate mechanisms
> > for doing basic dispatch against different resources which might be more
> > useful and allow you to still access content of response to decode it.
> >
> >>> In a normal HTML form, the data would be sent as
> >>> application/x-www-form-urlencoded, in the XForms world however, this
> >>> information is sent as XML formatted data (application/xml).
> >>> Up to now I've used cherryPy as web server and I've got my xml data
> with
> >>> cherrypy.threadData.xform.
> >>> I've read that PHP receive this in $HTTP_RAW_POST_DATA variable. If I
> >> send
> >>> the form to a php script all work fine.
> >>> But when I try to submit a xforms with method POST to a script managed
> >> by
> >>> publisher handler I get an error with no log in my apache server error
> >> log.
> >>> Any help?
> >> You'll need to elaborate on the error you are getting, but I think part
> >> of the problem is that you are bumping up against part of the internal
> >> "magic" of publisher.
> >>
> >> Publisher automatically creates a FieldStorage instance. Unfortunately
> >> FieldStorage assumes that the content-type starts with either
> >> "application/x-www-form-urlencoded" or "multipart/". If I had to guess
> >> I'd say that you are getting "501 Not Implemented error" as a result.
> >>
> >> Here are a couple of solutions that you might consider as a workaround:
> >>
> >> 1. Hack util.FieldStorage to properly handle your content-type. If you
> >> do this feel free to submit a patch so FieldStorage can be fixed. ;)
> >
> > Hmmm, xforms is quite different.
> >
> >   http://www.w3.org/TR/xforms/
> >
> > Looks like a lot of work.
>
> Probably. I certainly wasn't offering to do it. ;)
>
> >> 2. Hack publisher to skip the automatic creation of FieldStorage. (Line
> >> 424 in publisher.py for mod_python 3.3.0b). You can then use req.read()
> >> to read and process the POST'd data within your content handler.
> >
> > I've raised this issue before about publisher not being able to accept
> other
> > content types. See:
> >
> >   http://issues.apache.org/jira/browse/MODPYTHON-29
> >
> > Also, like PSP now does, publisher could be made to use 'req.form' if it
> > already existed. This would allow a stacked response handler before
> > publisher to decide whether some other form content was supplied, decode
> > it and set req.form to a compatible class to FieldStorage. I don't know
> that I
> > have created an issue for that idea before, but have certainly thought
> > about it and perhaps mentioned it on the mailing list.
>
> That seems like a reasonable solution.
>
> >> 3. Use a PythonFixupHandler before the content handler. In the
> >> fixuphandler use req.read() to grab the raw data and adjust the
> >> content-type header so that FieldStorage doesn't bomb out. Note that if
> >> you want to pass xml field data as parameters to your handler method
> >> you'll need to do a bit more work. For example
> >>
> >> def index(foo="bar"):
> >>      return "whatever"
> >>
> >> won't get foo from your xml data. You can likely work around this but
> >> you'll need to take a look at the source for FieldStorage and publisher
> >> to work out a strategy.
> >
> > If you are talking about modifying the input stream, an input filter
> would
> > perhaps be better. Not sure that that will help since xforms is quite
> > different and isn't just a matter of changing content type.
>
> No, I was just thinking you could get the raw data with req.read()
> (parsing the xml or whatever) and then set the content-type to
> application/x-www-form-urlencoded. That way the subsequent call to
> FieldStorage within publisher won't bomb out. The code would look
> something like this:
>
> def fixuphandler(req):
>      if req.headers_in.has_key("content-type"):
>          ctype = req.headers_in["content-type"]
>          if ctype.startswith("application/xml"):
>              req.data = parse_the_xml_data_or_whatever(req.read())
>              req.headers_in["content-type"] =
>                       "application/x-www-form-urlencoded"
>      return apache.OK
>
> A little too hackish perhaps? (Assuming it would even work).
>
> Jim
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>



-- 
mOsKi
"No hay nada que uno haga mal , lo que hay es poco vino." Autor Anonimo
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070112/8b5a2bac/attachment-0001.html
From grahamd at dscpl.com.au  Fri Jan 12 17:28:08 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Fri Jan 12 17:28:21 2007
Subject: [mod_python] how to handle xforms with publisher handler
In-Reply-To: <4388f4180701121341i51c36fck5aa424b0e0a1e447@mail.gmail.com>
References: <1168567220.3164@dscpl.user.openhosting.com>
	<45A6FAAB.9070707@jgassociates.ca>
	<4388f4180701121341i51c36fck5aa424b0e0a1e447@mail.gmail.com>
Message-ID: <E0E30E93-95A1-408B-B408-9C33F780D613@dscpl.com.au>

If you are using mod_python 3.2.10 or earlier, try 3.3.0b as it has  
some fixes
to FieldStorage class. Can be downloaded from:

   http://httpd.apache.org/modules/python-download.cgi

I suspect though that it still will not work though, as code is:

         # figure out boundary
         try:
             i = ctype.lower().rindex("boundary=")
             boundary = ctype[i+9:]
             if len(boundary) >= 2 and boundary[0] == boundary[-1] ==  
'"':
                 boundary = boundary[1:-1]
             boundary = re.compile("--" + re.escape(boundary) + "(--)? 
\r?\n")

Ie., it assumes that boundary is last field on content type line  
which is a
bad assumption.

Graham

On 13/01/2007, at 8:41 AM, Emiliano Moscato wrote:

> Hi all!
>
> Thanks for your answers.
> I've been looking the code of FieldStorage and publisher. I think  
> it is not soo dificult to patch FieldStorage, but: Is anybody else  
> interested in patch FieldStorage? If so I'll try it on monday.
>
> On the other hand, I've trying to use another method to send my  
> xforms which uses "multipart/related" as Content-type and I  
> realized that mozilla xforms plugin sends a boundary that is bad  
> handled by publisher-FieldStorage. This is what browser sends:
>
> [...]
> Content-Length: 522
> Content-Type: multipart/related;  
> boundary=---------------------------13592280651221337293469391600;  
> type="application/xml"; start="<4c599da9.58c746e8@mozilla.org >"
> Cookie: lang=1
>
> -----------------------------13592280651221337293469391600
> Content-Type: application/xml
> Content-ID: <4c599da9.58c746e8@mozilla.org>
>
> <?xml version="1.0" encoding="UTF-8"?>
> <idioma xmlns:xf="http://www.w3.org/2002/xforms" xmlns:ev=" http:// 
> www.w3.org/2001/xml-events" xmlns:xsi="http://www.w3.org/2001/ 
> XMLSchema-instance" xmlns:xsd=" http://www.w3.org/2001/XMLSchema">
>
>       <H__interface>main</H__interface>
>       <idioma>adadsfasd</idioma>
>     </idioma>
> -----------------------------13592280651221337293469391600--
>
>
> But FieldStorage parse the content-type line up to the end trying  
> to get boundary, getting this as boundary:
> -----------------------------7393760691212604279930853199;  
> type="application/xml"; start="< b8f2849.19571884@mozilla.org>
>
> Is this a firefox problem or a FieldStorage problem?
> Regards, enjoy the weekend :)
>
> Emiliano
>
>
> 2007/1/12, Jim Gallacher <jpg@jgassociates.ca>:
> Graham Dumpleton wrote:
> > Jim Gallacher wrote ..
> >> Emiliano Moscato wrote:
> >>> Hi all!
> >>>
> >>> I'm getting crazy trying to receive xforms xml data with  
> mod_python +
> >>> publisher handler.
> >
> > In what way are you using mod_python.publisher? Depending to what
> > degree you are using it, mod_python 3.3 offers some alternate  
> mechanisms
> > for doing basic dispatch against different resources which might  
> be more
> > useful and allow you to still access content of response to  
> decode it.
> >
> >>> In a normal HTML form, the data would be sent as
> >>> application/x-www-form-urlencoded, in the XForms world however,  
> this
> >>> information is sent as XML formatted data (application/xml).
> >>> Up to now I've used cherryPy as web server and I've got my xml  
> data with
> >>> cherrypy.threadData.xform.
> >>> I've read that PHP receive this in $HTTP_RAW_POST_DATA  
> variable. If I
> >> send
> >>> the form to a php script all work fine.
> >>> But when I try to submit a xforms with method POST to a script  
> managed
> >> by
> >>> publisher handler I get an error with no log in my apache  
> server error
> >> log.
> >>> Any help?
> >> You'll need to elaborate on the error you are getting, but I  
> think part
> >> of the problem is that you are bumping up against part of the  
> internal
> >> "magic" of publisher.
> >>
> >> Publisher automatically creates a FieldStorage instance.  
> Unfortunately
> >> FieldStorage assumes that the content-type starts with either
> >> "application/x-www-form-urlencoded" or "multipart/". If I had to  
> guess
> >> I'd say that you are getting "501 Not Implemented error" as a  
> result.
> >>
> >> Here are a couple of solutions that you might consider as a  
> workaround:
> >>
> >> 1. Hack util.FieldStorage to properly handle your content-type.  
> If you
> >> do this feel free to submit a patch so FieldStorage can be  
> fixed. ;)
> >
> > Hmmm, xforms is quite different.
> >
> >   http://www.w3.org/TR/xforms/
> >
> > Looks like a lot of work.
>
> Probably. I certainly wasn't offering to do it. ;)
>
> >> 2. Hack publisher to skip the automatic creation of  
> FieldStorage. (Line
> >> 424 in publisher.py for mod_python 3.3.0b). You can then use  
> req.read()
> >> to read and process the POST'd data within your content handler.
> >
> > I've raised this issue before about publisher not being able to  
> accept other
> > content types. See:
> >
> >   http://issues.apache.org/jira/browse/MODPYTHON-29
> >
> > Also, like PSP now does, publisher could be made to use  
> 'req.form' if it
> > already existed. This would allow a stacked response handler before
> > publisher to decide whether some other form content was supplied,  
> decode
> > it and set req.form to a compatible class to FieldStorage. I  
> don't know that I
> > have created an issue for that idea before, but have certainly  
> thought
> > about it and perhaps mentioned it on the mailing list.
>
> That seems like a reasonable solution.
>
> >> 3. Use a PythonFixupHandler before the content handler. In the
> >> fixuphandler use req.read() to grab the raw data and adjust the
> >> content-type header so that FieldStorage doesn't bomb out. Note  
> that if
> >> you want to pass xml field data as parameters to your handler  
> method
> >> you'll need to do a bit more work. For example
> >>
> >> def index(foo="bar"):
> >>      return "whatever"
> >>
> >> won't get foo from your xml data. You can likely work around  
> this but
> >> you'll need to take a look at the source for FieldStorage and  
> publisher
> >> to work out a strategy.
> >
> > If you are talking about modifying the input stream, an input  
> filter would
> > perhaps be better. Not sure that that will help since xforms is  
> quite
> > different and isn't just a matter of changing content type.
>
> No, I was just thinking you could get the raw data with req.read()
> (parsing the xml or whatever) and then set the content-type to
> application/x-www-form-urlencoded. That way the subsequent call to
> FieldStorage within publisher won't bomb out. The code would look
> something like this:
>
> def fixuphandler(req):
>      if req.headers_in.has_key("content-type"):
>          ctype = req.headers_in["content-type"]
>          if ctype.startswith("application/xml"):
>              req.data = parse_the_xml_data_or_whatever(req.read())
>              req.headers_in["content-type"] =
>                       "application/x-www-form-urlencoded"
>      return apache.OK
>
> A little too hackish perhaps? (Assuming it would even work).
>
> Jim
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
>
> -- 
> mOsKi
> "No hay nada que uno haga mal , lo que hay es poco vino." Autor  
> Anonimo
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070113/a86cb0db/attachment.html
From fred at urlbit.us  Fri Jan 12 17:42:25 2007
From: fred at urlbit.us (Fred of UrlBit.Us)
Date: Fri Jan 12 17:42:37 2007
Subject: [mod_python] 2006 "MySQL server has gone away" failures
In-Reply-To: <45A7C5EE.8070909@joreybump.com>
References: <B6C73A5E30565245BB6D32B5F5DF7A521202CE@sense.emmastraat.pijnacker>
	<45A7C5EE.8070909@joreybump.com>
Message-ID: <200701121742.25317.fred@urlbit.us>

On Friday 12 January 2007 12:31, Jorey Bump uttered thusly:
> Martijn Moeling wrote:
...
> > Now the connections get closed nicely and mysql does not run out of
> > resources anymore.
>
> Interesting solution, but aren't you now (briefly) opening a database
> connection for every page view, regardless of it actually needing one?

In my particular application most pages are hitting the database, so that's 
not really a problem.

> Also, it looks like the OP is using the PSP handler, not a custom one.

Actually, in my case I am calling the PSP class directly rather than using 
the Apache directives to do it. Most of the code will be in libraries and 
just a touch will actually be in PSP.

> In that case, the best solution might be to explicitly open and close
> the db handle before and after every query (or tightly grouped series of
> queries). Recent versions of MySQLdb have made it difficult to create
> persistent db connections, and users are advised against it, since the
> overhead of creating new connections is negligible. I had to rewrite a
> number of applications that imported a shared db handle, due to this
> change. Bummer. :(

Curious. This highlights some questions I have about what exactly mod_python 
is doing. Does mod_python behaves well with MPM? I would rather use MPM over 
the perforking I currently do (to mainly keep legacy PHP happy). Basically, 
what are the issues with regards the Global Interpreter Lock and MPM? And 
are there any other issues I need be concerned about with regards to states 
and sessions and loaded modules?

-- Fred
http://urlbit.us
Bite those long URLs!
From jpg at jgassociates.ca  Fri Jan 12 18:40:37 2007
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Fri Jan 12 18:39:51 2007
Subject: [mod_python] Can't get/create handler errors
In-Reply-To: <Pine.LNX.4.44.0701121218020.28148-100000@skysrv.pha.jhu.edu>
References: <Pine.LNX.4.44.0701121218020.28148-100000@skysrv.pha.jhu.edu>
Message-ID: <45A81C75.50009@jgassociates.ca>

Alainna C. Wonders wrote:
> Hi All, 
> 
> I have a Scientific Linux 4.2 server with two versions of python installed 
> (2.3.4, stock; 2.4.2, my installation).  
> 
> In my apache error log, I see errors like: 
> 
> python_handler: no interpreter callback found.
> python_handler: Can't get/create interpreter.
> make_obcallback: could not import mod_python.apache.\n
> ImportError: No module named mod_python.apache
> make_obcallback: Python path being used 
> "['/usr/lib/python23.zip', '/usr/lib/python2.3', 
> '/usr/lib/python2.3/plat-linux2', '/usr/lib/python2.3/lib-tk', 
> '/usr/lib/python2.3/lib-dynload', '/usr/lib/python2.3/site-packages', 
> '/usr/lib/python2.3/site-packages/gtk-2.0']".
> 
> My configure command looked like this: 
> 
> ./configure --with-apxs=/usr/sbin/apxs 
> --with-python=/usr/local/bin/python2.4
> 
> It ran without error, as did make/make install. 
> 
> I have also set a PATH variable in the httpd init script telling it to 
> look in /usr/local/bin first.  There is /usr/local/bin/python, which is 
> set to Python 2.4.2
> 
> Any recommendations?  I've seen some stuff on google, and it suggested 
> setting apache's path, which I thought could be done by setting the PATH 
> variable in the init script and then restarting the daemon.

Well, that should work. I assume you are seeing the correct mod_python 
version string in your Apache log after a restart? ie something like:

[Fri Jan 12 17:37:16 2007] [notice] Apache/2.2.3 (Debian) 
mod_python/3.3.0b Python/2.4.4 configured -- resuming normal operations

Jim

From export at hope.cz  Sat Jan 13 01:56:15 2007
From: export at hope.cz (export@hope.cz)
Date: Sat Jan 13 01:56:41 2007
Subject: [mod_python] Several handlers
In-Reply-To: <3D33C3C7-2AC2-4759-87B9-8A5FE7776274@dscpl.com.au>
References: <45A7FF92.1986.809773E@export.hope.cz>
Message-ID: <45A8909F.26203.A401169@export.hope.cz>

Graham ,
Thank you for your reply.
So now my httpd.conf looks like this:
...
...
 SetHandler python-program
 PythonHandler django.core.handlers.modpython

 PythonInputFilter InputFilter django.core.handlers.myinputfilter
 SetInputFilter django.core.handlers.myinputfilter
...
..
and I have the filter in a file myinputfilter.py
in a directory C:\Python23\Lib\site-packages\django\core\handlers.

but when I try to run , I received the error
###################
Mod_python error: "PythonInputFilter django.core.handlers.modpython" 

Traceback (most recent call last): File "C:\PYTHON23\Lib\site-
packages\mod_python\apache.py", line 299, in HandlerDispatch result = object(req) 

File "C:\PYTHON23\lib\site-packages\django\core\handlers\modpython.py", line 
165, in handler return ModPythonHandler()(req) 
File "C:\PYTHON23\lib\site-packages\django\core\handlers\modpython.py", line 
139, in __call__ response = self.get_response(req.uri, request) 
....
...
##############
Why Mod_python calls  django.core.handlers.modpython  , expecting PythonInputFilter 
should be there?
So, it seems to me that myinputfilter has not been called at all .
Can you please help?
Thank you
La.

From grahamd at dscpl.com.au  Sat Jan 13 05:29:26 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sat Jan 13 05:29:36 2007
Subject: [mod_python] Several handlers
In-Reply-To: <45A8909F.26203.A401169@export.hope.cz>
References: <45A7FF92.1986.809773E@export.hope.cz>
	<45A8909F.26203.A401169@export.hope.cz>
Message-ID: <BA4280F8-A203-44BB-99AC-87221FF17959@dscpl.com.au>


On 13/01/2007, at 5:56 PM, export@hope.cz wrote:

> Graham ,
> Thank you for your reply.
> So now my httpd.conf looks like this:
> ...
> ...
>  SetHandler python-program
>  PythonHandler django.core.handlers.modpython
>
>  PythonInputFilter InputFilter django.core.handlers.myinputfilter
>  SetInputFilter django.core.handlers.myinputfilter

Check documentation again. You have these around the wrong way:

  PythonInputFilter django.core.handlers.myinputfilter InputFilter
  SetInputFilter InputFilter


> and I have the filter in a file myinputfilter.py
> in a directory C:\Python23\Lib\site-packages\django\core\handlers.
>
> but when I try to run , I received the error
> ###################
> Mod_python error: "PythonInputFilter django.core.handlers.modpython"
>
> Traceback (most recent call last): File "C:\PYTHON23\Lib\site-
> packages\mod_python\apache.py", line 299, in HandlerDispatch result  
> = object(req)
>
> File "C:\PYTHON23\lib\site-packages\django\core\handlers 
> \modpython.py", line
> 165, in handler return ModPythonHandler()(req)
> File "C:\PYTHON23\lib\site-packages\django\core\handlers 
> \modpython.py", line
> 139, in __call__ response = self.get_response(req.uri, request)
> ....
> ...
> ##############
> Why Mod_python calls  django.core.handlers.modpython  , expecting  
> PythonInputFilter
> should be there?
> So, it seems to me that myinputfilter has not been called at all .
> Can you please help?
> Thank you
> La.
From grahamd at dscpl.com.au  Sat Jan 13 05:32:54 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sat Jan 13 05:33:03 2007
Subject: [mod_python] Can't get/create handler errors
In-Reply-To: <Pine.LNX.4.44.0701121218020.28148-100000@skysrv.pha.jhu.edu>
References: <Pine.LNX.4.44.0701121218020.28148-100000@skysrv.pha.jhu.edu>
Message-ID: <DFB99325-612C-4ED2-BF99-E5C1E53A3287@dscpl.com.au>


On 13/01/2007, at 4:24 AM, Alainna C. Wonders wrote:

>
> Hi All,
>
> I have a Scientific Linux 4.2 server with two versions of python  
> installed
> (2.3.4, stock; 2.4.2, my installation).
>
> In my apache error log, I see errors like:
>
> python_handler: no interpreter callback found.
> python_handler: Can't get/create interpreter.
> make_obcallback: could not import mod_python.apache.\n
> ImportError: No module named mod_python.apache
> make_obcallback: Python path being used
> "['/usr/lib/python23.zip', '/usr/lib/python2.3',
> '/usr/lib/python2.3/plat-linux2', '/usr/lib/python2.3/lib-tk',
> '/usr/lib/python2.3/lib-dynload', '/usr/lib/python2.3/site-packages',
> '/usr/lib/python2.3/site-packages/gtk-2.0']".
>
> My configure command looked like this:
>
> ./configure --with-apxs=/usr/sbin/apxs
> --with-python=/usr/local/bin/python2.4
>
> It ran without error, as did make/make install.
>
> I have also set a PATH variable in the httpd init script telling it to
> look in /usr/local/bin first.  There is /usr/local/bin/python,  
> which is
> set to Python 2.4.2.

Did you export the PATH variable in the init script?

   export PATH

Even though PATH is inherited into the script, local changes aren't  
exported
from it unless an export is done explicitly. It is a strange gotcha  
of init scripts
that has got me before.

> Any recommendations?  I've seen some stuff on google, and it suggested
> setting apache's path, which I thought could be done by setting the  
> PATH
> variable in the init script and then restarting the daemon.
>
> Thanks,
>
> Alainna
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
From export at hope.cz  Sat Jan 13 10:34:42 2007
From: export at hope.cz (export@hope.cz)
Date: Sat Jan 13 10:35:14 2007
Subject: [mod_python] Several handlers
In-Reply-To: <BA4280F8-A203-44BB-99AC-87221FF17959@dscpl.com.au>
References: <45A8909F.26203.A401169@export.hope.cz>
Message-ID: <45A90A22.15187.C1ABA3B@export.hope.cz>

Graham,
Thank you for your help.
Now Apache can find my inputinput filter.
Here it is:
################
from mod_python import apache
import os, shutil

def log(text):
    f = open('C:/Python23/Lib/site-packages/django/core/handlers/log', 'a')
    f.write(text)
    f.write('\n')
    f.close()
    
def inputfilter(filter):
    if filter.req.method != 'POST':
        filter.disable()
        return
    f=open('C:/Python23/Lib/site-packages/django/core/handlers/filter.log','ab')
    log('first read')
    s = filter.read()
    while s:
        log('writing (%s)' % len(s))
        f.write(s)
        f.flush()
        filter.write(s)
        log('loop read')
        filter.flush()
        s = filter.read()
    if s is None:
        log('closing')
        filter.close()
        raise "error"
      f.close()
################
But I would expect that it will read some data, write to a file and release the memory and 
again.
But it does NOT. As it reads more and more data more and more memory is used - no 
memory is released. As a result, python program  crashes because of little memory available.
Am I right if I suppose that the memory allocation should not increase during reading data?
Or am I wrong?
Thank you again for help
L.


From crosseyedpenguin at cox.net  Sat Jan 13 11:00:11 2007
From: crosseyedpenguin at cox.net (Roger)
Date: Sat Jan 13 11:00:18 2007
Subject: [mod_python] 2006 "MySQL server has gone away" failures
In-Reply-To: <200701121045.22939.fred@urlbit.us>
References: <200701121045.22939.fred@urlbit.us>
Message-ID: <45A9020B.6000109@cox.net>

Fred of UrlBit.Us wrote:
> Hello, all.
>
> I intend to use mod_python for a couple of major websites, but I am running 
> into an annoying problem.
>
> I've seen something similar posted elsewhere, but no firm resolution.
>
> My mod_python server will run just fine for a while following a restart of 
> Apache, but after some time I get the following OperationalError exception:
>
> OperationalError: (2006, 'MySQL server has gone away')
>
> I can't seem to nail this one down, or even why it would happen. I even tried 
> pinging the connection early on in the handler, but still no dice.
>
> A restart of the server eliminates the problem for a while. Also, sometimes 
> the problem goes away on its own (but comes back later). And of course, when 
> I am sitting there trying to reproduce the problem, it works perfectly!
>
> Any clues or suggestions would be extremely helpful.
>
> Setup: Apache 2, Python 2.5, mod_python 3.2.10
>
> stack dump:
>
> ERROR In PyClops plugin <module 'app.urlbit' 
> from '/home/urlbit/site/web/php/app/urlbit/__init__.py'> 
>             Traceback (most recent call last):
>   File "/home/ecms/py/pyclops/plugins/__init__.py", line 34, in 
> _application_dispatcher
>     if plug.handle(pyreq):
>   File "/home/urlbit/site/web/php/app/urlbit/__init__.py", line 52, in handle
>     psp.handle(pyreq)
>   File "/home/ecms/py/pyclops/psp.py", line 25, in handle
>     p.run()
>   File "/usr/local/lib/python2.5/site-packages/mod_python/psp.py", line 213, 
> in run
>     exec code in global_scope
>   File "/home/urlbit/site/web/create.html", line 100, in <module>
>   File "/usr/local/lib/python2.5/site-packages/MySQLdb/cursors.py", line 163, 
> in execute
>     self.errorhandler(self, exc, value)
>   File "/usr/local/lib/python2.5/site-packages/MySQLdb/connections.py", line 
> 35, in defaulterrorhandler
>     raise errorclass, errorvalue
> OperationalError: (2006, 'MySQL server has gone away')
>
>
>   
You didn't say what versions of MySQL and MySQLdb you are using.  If 
your connection is lost after being idle for 8 hours and it is version 
MySQL 5, then this from
http://dev.mysql.com/doc/refman/5.0/en/upgrading-from-4-1.html is a
clue:

'''
The reconnect flag in the MYSQL structure is set to 0 by
mysql_real_connect(). Only those client programs which did not
explicitly set this flag to 0 or 1 after mysql_real_connect()
experience a change. Having automatic reconnection enabled by default
was considered too dangerous (due to the fact that table locks,
temporary tables, user variables, and session variables are lost after
reconnection).
'''

The problem is MySQLdb isn't setting the reconnect flag required by 
version MySQL 5.  A mysqldb patch can be found here:
http://sourceforge.net/tracker/index.php?func=detail&aid=1483074&group_id=22307&atid=374934

If you are restarting your application daily to take backups of your 
database or for some other reason, then an alternative is to just up the 
default timeout from 8 hours to 25 hours by adding a wait_timeout to  
/etc/my.cnf.

'''
[mysqld]
datadir=/var/lib/mysql
socket=/var/lib/mysql/mysql.sock
# Default to using old password format for compatibility with mysql 3.x
# clients (those using the mysqlclient10 compatibility package).
old_passwords=1
# rdh 2006-12-27 fix for OperationalError: (2006, 'MySQL server has gone 
away')
wait_timeout=90000
    
[mysql.server]
user=mysql
basedir=/var/lib

[mysqld_safe]
log-error=/var/log/mysqld.log
pid-file=/var/run/mysqld/mysqld.pid
'''

The default MySQL timeout is set to 8 hours, you can see it by doing a:
   /usr/libexec/mysqld --help --verbose

Roger


From grahamd at dscpl.com.au  Sat Jan 13 21:37:55 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sat Jan 13 21:38:18 2007
Subject: [mod_python] Several handlers
In-Reply-To: <45A90A22.15187.C1ABA3B@export.hope.cz>
References: <45A8909F.26203.A401169@export.hope.cz>
	<45A90A22.15187.C1ABA3B@export.hope.cz>
Message-ID: <9AC1E135-262E-486F-BADA-8DB104681042@dscpl.com.au>


On 14/01/2007, at 2:34 AM, export@hope.cz wrote:

> Graham,
> Thank you for your help.
> Now Apache can find my inputinput filter.
> Here it is:
> ################
> from mod_python import apache
> import os, shutil
>
> def log(text):
>     f = open('C:/Python23/Lib/site-packages/django/core/handlers/ 
> log', 'a')
>     f.write(text)
>     f.write('\n')
>     f.close()
>
> def inputfilter(filter):
>     if filter.req.method != 'POST':
>         filter.disable()

Normally 'filter.pass_on()' would be used here, not 'filter.disable()'.

>         return
>     f=open('C:/Python23/Lib/site-packages/django/core/handlers/ 
> filter.log','ab')
>     log('first read')

You would be better of using Apache's own logging mechanism instead
of your own. Thus instead use:

   filter.req.log_error('first read')

The messages will then appear in the Apache error log whatever that  
may be
on Windows.

>     s = filter.read()
>     while s:
>         log('writing (%s)' % len(s))
>         f.write(s)
>         f.flush()
>         filter.write(s)
>         log('loop read')
>         filter.flush()

It is not necessary to explicitly flush the filter. Leave this out  
until you have
a reason for really doing it.

>         s = filter.read()
>     if s is None:
>         log('closing')
>         filter.close()
>         raise "error"

Huh!!!!  Your raising an exception here. Do you really mean to do  
that? This
would always result in the client getting back an error. The  
following 'f.close()'
would never be called, so you would be at the mercy of the garbage  
collector
as far as the file being closed. If for some reason that isn't being  
done straight
away it could cause resources to run out.

>       f.close()
> ################
> But I would expect that it will read some data, write to a file and  
> release the memory and
> again.
> But it does NOT. As it reads more and more data more and more  
> memory is used - no
> memory is released. As a result, python program  crashes because of  
> little memory available.
> Am I right if I suppose that the memory allocation should not  
> increase during reading data?
> Or am I wrong?
> Thank you again for help

Fix up the things noted first and use Apache's logging facility  
instead of
your own and see if there is a difference.


Graham
From keith at uglyslug.com  Sun Jan 14 16:52:26 2007
From: keith at uglyslug.com (keith@uglyslug.com)
Date: Sun Jan 14 16:53:01 2007
Subject: [mod_python] Starting a background process with mod_python?
Message-ID: <49266.69.177.133.6.1168811546.squirrel@64.20.43.157>


I want to have a user click a 'submit' button on an HTML form, submit to a
mod_python page, and have that mod_python page start 3 or 4 processes in
the background which then run for hours and hours and hours. Obviously a
result should be returned to the user before the hours and hours and hours
are up.

I'm a bit of a python and mod_python newbie, and I tried some stuff with
the 'threading' library, but no luck so far. Can anyone give me a working
example?

Thanks!

 - Keith
From grahamd at dscpl.com.au  Sun Jan 14 17:15:24 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sun Jan 14 17:15:29 2007
Subject: [mod_python] Starting a background process with mod_python?
Message-ID: <1168812924.20428@dscpl.user.openhosting.com>

keith@uglyslug.com wrote ..
> 
> I want to have a user click a 'submit' button on an HTML form, submit to
> a
> mod_python page, and have that mod_python page start 3 or 4 processes in
> the background which then run for hours and hours and hours. Obviously
> a
> result should be returned to the user before the hours and hours and hours
> are up.
> 
> I'm a bit of a python and mod_python newbie, and I tried some stuff with
> the 'threading' library, but no luck so far. Can anyone give me a working
> example?

Create a long running daemon process which runs separately to Apache
and which embeds an XML-RPC server in. Have the Apache request handler
use an XML-RPC client to make calls against the backend process to
request it do what needs to be done. The backend process can fire off
what is needed, including possibly fork/execing to run stuff as a separate
process. The XML-RPC request can return as soon as the separate process
is started.

Separating things like this so that it is a backend process which is doing
any fork/execing is much more preferable than having Apache child
processes do it.

Graham
From export at hope.cz  Mon Jan 15 03:41:30 2007
From: export at hope.cz (export@hope.cz)
Date: Mon Jan 15 03:41:51 2007
Subject: [mod_python] Several handlers
Message-ID: <45AB4C4A.8469.14ED24E4@export.hope.cz>

 Graham,
Thank you for your reply and help.
 So,now my input filter looks like this:
 
 def inputfilter(filter):
     if filter.req.method != 'POST':
         filter.pass_on()
         return
     filter.req.log_error('first read')
     s = filter.read()
     while s:
         filter.req.log_error('writing (%s)' % len(s))
         filter.write(s)
         s = filter.read()
     if s is None:
         filter.req.log_error('closing')
         filter.close()
 
 When I check error log I can see list of
  writing (8000)
 which could be good.I think it says that data is read /write in 8000bytes chunks.
 
 But still memory is NOT released but increases in the process of reading.
 Should  memory be released after each writing?
 What should I check to find out the  reason that  causes resources are run out?
 Thank you for helo and reply
 La.


From grahamd at dscpl.com.au  Mon Jan 15 04:14:36 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon Jan 15 04:16:09 2007
Subject: [mod_python] Several handlers
In-Reply-To: <45AB4C4A.8469.14ED24E4@export.hope.cz>
References: <45AB4C4A.8469.14ED24E4@export.hope.cz>
Message-ID: <13C99F26-ACCD-48F1-A62C-D496DCC18160@dscpl.com.au>


On 15/01/2007, at 7:41 PM, export@hope.cz wrote:

>  Graham,
> Thank you for your reply and help.
>  So,now my input filter looks like this:
>
>  def inputfilter(filter):
>      if filter.req.method != 'POST':
>          filter.pass_on()
>          return
>      filter.req.log_error('first read')
>      s = filter.read()
>      while s:
>          filter.req.log_error('writing (%s)' % len(s))
>          filter.write(s)
>          s = filter.read()
>      if s is None:
>          filter.req.log_error('closing')
>          filter.close()
>
>  When I check error log I can see list of
>   writing (8000)
>  which could be good.I think it says that data is read /write in  
> 8000bytes chunks.
>
>  But still memory is NOT released but increases in the process of  
> reading.
>  Should  memory be released after each writing?
>  What should I check to find out the  reason that  causes resources  
> are run out?
>  Thank you for helo and reply

Are you still running Django as the content handler? Are you sure that
the increase in memory size isn't something to do with Django?

Instead of running Django as the response handler write a small
custom handler which does:

def handler(req):
   req.content_type = 'text/plain'
   req.write(req.read())
   return apache.OK

You will then need to create a static HTML page with a POST form that
posts to the URL which matches the handler. This should have the
result of exercising the filter with the contents of the POST being
returned as the response.

See if that small example still uses increasing resources.

Graham
From starke.m at gmx.de  Mon Jan 15 06:19:19 2007
From: starke.m at gmx.de (michael starke)
Date: Mon Jan 15 06:19:27 2007
Subject: [mod_python] Building Problems on OS X (intel macbook core2duo)
In-Reply-To: <6C54BB3F-02FB-4DDA-A1B2-1093A1F7E99B@dscpl.com.au>
References: <1168570220.26129@dscpl.user.openhosting.com>
	<6C54BB3F-02FB-4DDA-A1B2-1093A1F7E99B@dscpl.com.au>
Message-ID: <9101B155-36C8-4AB3-8A5A-97F4779AC6DD@gmx.de>

Well, i fixed it =)

I found out, that my installtion of apache2 was incorret, i had no  
mod_so support (i thought it was always enabled on apache2.x) but  
with a rebuilt (--enable-modules-shared=all --enable-so) i started  
the mod_python built (no makefile alteration, just plain apxs and  
python options) and it worked out well.

Thanks for your patience, i was having a hard time and did not  
realize the problem was in apache not in mod_python.

Maybe if someone else has the same problem you know what to aks too =)

Greetings,
michael

On 12.01.2007, at 11:06, Graham Dumpleton wrote:

> BTW, I know you want to use Python 2.4, but can you go back and  
> actually
> try the Python 2.3.5 supplied with the operating system as standard  
> instead
> to see if that works.
>
> Graham
>
> On 12/01/2007, at 1:50 PM, Graham Dumpleton wrote:
>
>> michael starke wrote ..
>>> I'm confused, either i'm making some stupid mistake all the time or
>>> it's still not working.
>>> I removed the 3 arguments one by one and still, the built fails.
>>> Damn, is there a way to get the mod built on another machine and  
>>> then
>>> just load up the installtion to the macbook, hoping that it works?
>>
>> Are you doing a:
>>
>>   make clean
>>
>> between build attempts when changing the makefile?
>>
>> Can you run:
>>
>>   gcc -v
>>
>> again so can see what version number it is now saying?
>>
>> Graham
>>
>>
>>> On 11.01.2007, at 22:07, Graham Dumpleton wrote:
>>>
>>>>
>>>> On 12/01/2007, at 2:48 AM, michael starke wrote:
>>>>
>>>>> Even the routines make mistakes, makes them look more human.
>>>>>
>>>>> I did what you suggested, the line in my makefile (after
>>>>> configure, i told you, am new to this =) looks like this:
>>>>>
>>>>> LDFLAGS= -Wl,-framework,Python  -u _PyMac_Error $
>>>>> (PYTHONFRAMEWORKDIR)/Versions/$(VERSION)/$(PYTHONFRAMEWORK)   -
>>>>> arch i386 -arch ppc -isysroot /Developer/SDKs/MacOSX10.4u.sdk -g
>>>>>
>>>>> I changed it to
>>>>>
>>>>> LDFLAGS= -Wl,-framework,Python  -u _PyMac_Error   -arch i386 -arch
>>>>> ppc -isysroot /Developer/SDKs/MacOSX10.4u.sdk -g
>>>>
>>>> Try taking out:
>>>>
>>>>   -arch ppc
>>>>
>>>> and if still not working, also take out:
>>>>
>>>>   -arch i386
>>>>
>>>> You could even drop the:
>>>>
>>>>   -isysroot /Developer/SDKs/MacOSX10.4u.sdk
>>>>
>>>> which I have never seen before and may be screwing up libtool.
>>>>
>>>> Graham
>>>>

From maksim.kasimov at gmail.com  Mon Jan 15 08:06:24 2007
From: maksim.kasimov at gmail.com (Maksim Kasimov)
Date: Mon Jan 15 08:07:16 2007
Subject: [mod_python] how to define publisher when page not found
Message-ID: <a072330b0701150506m88c61dfmbbfde3aa7203f67b@mail.gmail.com>

hi,

in apache conf file i use:

    <Directory "/mypath/mydir">
        SetHandler python-program
        PythonHandler mod_python.publisher
    </Directory>


there is file:

in file  /mypath/mydir/index.py there some functions:

def index(req):

    return "index"


def free(req):

    return 'free'


def not_found(req):

    # some computation
    return 'page not found'



and every thing is just fine and works as expected:

       for http://myhostname.org/mydir/free i can see "free"
       for http://myhostname.org/mydir/ i can see "index"


my question is: How to get output of "not_found" function for any other uri,
such as "http://myhostname.org/mydir/hello" ?

many thanks for any advice.


-- 
Maksim Kasimov
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070115/da3efc52/attachment.html
From export at hope.cz  Mon Jan 15 10:41:08 2007
From: export at hope.cz (export@hope.cz)
Date: Mon Jan 15 10:41:48 2007
Subject: [mod_python] Several handlers- not releasing memory
In-Reply-To: <13C99F26-ACCD-48F1-A62C-D496DCC18160@dscpl.com.au>
References: <45AB4C4A.8469.14ED24E4@export.hope.cz>
Message-ID: <45ABAEA4.12583.166D53B9@export.hope.cz>

Graham,
Thank you for your reply.
So I removed Django handlers from conf.httpd and made a static page where FORM looks 
like this

<form method="post" action="/cgi-bin/handler.py" enctype="multipart/form-data">
...
...
</form>

Now ,  no Django is  running but still the memory is not released and in the reading/filtering 
process,  memory is going up and up?
Is my assumption that the memory should be release after each writing(  before each 
reading) that is  done  in InputFilter  correct?
Or do I make a mistake somewhere?

Thank you for your reply
Lad


> Are you still running Django as the content handler? Are you sure that
 >the increase in memory size isn't something to do with Django?
> 
> Instead of running Django as the response handler write a small
> custom handler which does:
> 
> def handler(req):
>    req.content_type = 'text/plain'
>    req.write(req.read())
>    return apache.OK
> 
> You will then need to create a static HTML page with a POST form that
> posts to the URL which matches the handler. This should have the
> result of exercising the filter with the contents of the POST being
> returned as the response.
> 
> See if that small example still uses increasing resources.
> 
> Graham


From grahamd at dscpl.com.au  Mon Jan 15 16:17:12 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon Jan 15 16:17:17 2007
Subject: [mod_python] how to define publisher when page not found
Message-ID: <1168895831.20396@dscpl.user.openhosting.com>

Maksim Kasimov wrote ..
> hi,
> 
> in apache conf file i use:
> 
>     <Directory "/mypath/mydir">
>         SetHandler python-program
>         PythonHandler mod_python.publisher
>     </Directory>
> 
> 
> there is file:
> 
> in file  /mypath/mydir/index.py there some functions:
> 
> def index(req):
> 
>     return "index"
> 
> 
> def free(req):
> 
>     return 'free'
> 
> 
> def not_found(req):
> 
>     # some computation
>     return 'page not found'
> 
> 
> 
> and every thing is just fine and works as expected:
> 
>        for http://myhostname.org/mydir/free i can see "free"
>        for http://myhostname.org/mydir/ i can see "index"
> 
> 
> my question is: How to get output of "not_found" function for any other
> uri,
> such as "http://myhostname.org/mydir/hello" ?
> 
> many thanks for any advice.

Use the Apache ErrorDocument directive, specifying the URL to the not_found
function as the argument.

Graham
From bgailer at alum.rpi.edu  Mon Jan 15 19:39:12 2007
From: bgailer at alum.rpi.edu (Bob Gailer)
Date: Mon Jan 15 19:39:29 2007
Subject: [mod_python] Decoding POST requests
Message-ID: <45AC1EB0.2080108@alum.rpi.edu>

I'm getting POST request data from a form using request.read(). I note 
that blanks have been coded as +, + as %2B, etc. etc. How do I decode 
this? My goal is to use HTTPRequest to send POST data. How do I specify 
the coding? What alternatives are there?  Is there any reference to all 
of this?

-- 
Bob Gailer
510-978-4454

From grahamd at dscpl.com.au  Mon Jan 15 19:54:43 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon Jan 15 19:54:51 2007
Subject: [mod_python] Decoding POST requests
Message-ID: <1168908883.29183@dscpl.user.openhosting.com>

Bob Gailer wrote ..
> I'm getting POST request data from a form using request.read(). I note
> that blanks have been coded as +, + as %2B, etc. etc. How do I decode 
> this? My goal is to use HTTPRequest to send POST data. How do I specify
> the coding? What alternatives are there?  Is there any reference to all
> of this?

What sort of POST request data is it? If it is either of the standard forms:

  application/x-www-form-urlencoded
  multipart/* (eg. multipart/mixed)

you can use the FieldStorage class included with mod_python. See the
documentation for details.

Also look at the parse_qs() functions in documentation as well.

Documentation at:

  http://www.modpython.org/live/current/doc-html/pyapi-util.html

Graham

From maksim.kasimov at gmail.com  Tue Jan 16 05:07:42 2007
From: maksim.kasimov at gmail.com (Maksim Kasimov)
Date: Tue Jan 16 05:07:52 2007
Subject: [mod_python] how to define publisher when page not found
In-Reply-To: <1168895831.20396@dscpl.user.openhosting.com>
References: <1168895831.20396@dscpl.user.openhosting.com>
Message-ID: <a072330b0701160207w6f59f936pb4bc26fb712995ca@mail.gmail.com>

On 1/15/07, Graham Dumpleton <grahamd@dscpl.com.au> wrote:
>
> Maksim Kasimov wrote ..
> > hi,
> >
> > in apache conf file i use:
> >
> >     <Directory "/mypath/mydir">
> >         SetHandler python-program
> >         PythonHandler mod_python.publisher
> >     </Directory>
> >
> >
> > there is file:
> >
> > in file  /mypath/mydir/index.py there some functions:
> >
> > def index(req):
> >
> >     return "index"
> >
> >
> > def free(req):
> >
> >     return 'free'
> >
> >
> > def not_found(req):
> >
> >     # some computation
> >     return 'page not found'
> >
> >
> >
> > and every thing is just fine and works as expected:
> >
> >        for http://myhostname.org/mydir/free i can see "free"
> >        for http://myhostname.org/mydir/ i can see "index"
> >
> >
> > my question is: How to get output of "not_found" function for any other
> > uri,
> > such as "http://myhostname.org/mydir/hello" ?
> >
> > many thanks for any advice.
>
> Use the Apache ErrorDocument directive, specifying the URL to the
> not_found
> function as the argument.
>
> Graham
>

it is very inconveniently because:
    1) in the directory "mydir" there can be a lot of *.py scripts (not only
index.py), and i need to specify some default handler for each of module in
the directory.
    2) it makes superfluous redirections
So my question is still opened.

To provide this, temporary, i've changed resolve_object function in
publisher.py from mod_python in that way:

        try:
            #obj = getattr(obj, obj_str)
            obj = getattr(obj, obj_str, getattr(obj, '_default'))
        except AttributeError:
            raise apache.SERVER_RETURN, apache.HTTP_NOT_FOUND

than, i will define _default function in my /mypath/mydir/index.py or any
other modules in mydir.

i think it is very wrong to change standart libraries, but i did not found
the way, how to redifine this behavior in my index.py file.

is it possible to define some function in my module, to make it return
default attribute for getattr function?
or may be, if i dare, to expect such changes as above in future releases of
mod_python?

thanks for any help.

-- 
Maksim Kasimov
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070116/167ade24/attachment.html
From grahamd at dscpl.com.au  Tue Jan 16 05:31:52 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Jan 16 05:32:19 2007
Subject: [mod_python] how to define publisher when page not found
In-Reply-To: <a072330b0701160207w6f59f936pb4bc26fb712995ca@mail.gmail.com>
References: <1168895831.20396@dscpl.user.openhosting.com>
	<a072330b0701160207w6f59f936pb4bc26fb712995ca@mail.gmail.com>
Message-ID: <51F7D9A7-8FA0-41C7-8563-6C64BCCDF579@dscpl.com.au>


On 16/01/2007, at 9:07 PM, Maksim Kasimov wrote:

>
>
> On 1/15/07, Graham Dumpleton <grahamd@dscpl.com.au> wrote:
> Maksim Kasimov wrote ..
> > hi,
> >
> > in apache conf file i use:
> >
> >     <Directory "/mypath/mydir">
> >         SetHandler python-program
> >         PythonHandler mod_python.publisher
> >     </Directory>
> >
> >
> > there is file:
> >
> > in file  /mypath/mydir/index.py there some functions:
> >
> > def index(req):
> >
> >     return "index"
> >
> >
> > def free(req):
> >
> >     return 'free'
> >
> >
> > def not_found(req):
> >
> >     # some computation
> >     return 'page not found'
> >
> >
> >
> > and every thing is just fine and works as expected:
> >
> >        for http://myhostname.org/mydir/free i can see "free"
> >        for http://myhostname.org/mydir/ i can see "index"
> >
> >
> > my question is: How to get output of "not_found" function for any  
> other
> > uri,
> > such as " http://myhostname.org/mydir/hello" ?
> >
> > many thanks for any advice.
>
> Use the Apache ErrorDocument directive, specifying the URL to the  
> not_found
> function as the argument.
>
> Graham
>
> it is very inconveniently because:
>     1) in the directory "mydir" there can be a lot of *.py scripts  
> (not only index.py), and i need to specify some default handler for  
> each of module in the directory.
>     2) it makes superfluous redirections

But if it is only for not found errors, it wouldn't occur much so why  
would
it matter.

> So my question is still opened.
>
> To provide this, temporary, i've changed resolve_object function in  
> publisher.py from mod_python in that way:
>
>         try:
>             #obj = getattr(obj, obj_str)
>             obj = getattr(obj, obj_str, getattr(obj, '_default'))
>         except AttributeError:
>             raise apache.SERVER_RETURN, apache.HTTP_NOT_FOUND
>
> than, i will define _default function in my /mypath/mydir/index.py  
> or any other modules in mydir.
>
> i think it is very wrong to change standart libraries, but i did  
> not found the way, how to redifine this behavior in my index.py file.
>
> is it possible to define some function in my module, to make it  
> return default attribute for getattr function?
> or may be, if i dare, to expect such changes as above in future  
> releases of mod_python?

It is unlikely you will see such a feature in future versions of  
mod_python.
I also question why you would want to do that anyway, ie., have a  
separate
not found page for every file resource. Care to explain what you  
thing you
get from it? Maybe you shouldn't be using mod_python.publisher but  
should
be writing a custom dispatcher of your own.

BTW, you could always do the following:

   SetHandler mypublisherwrapper

Then in handler() of mypublisherwrapper do something like (untested):

   from mod_python import apache, publisher

   def handler(req):
     try:
       result = publisher.handler(req)
     except SERVER_RETURN, value:
             try:
                 if len(value.args) == 2:
                     raise
                 else:
                     result = value.args[0]

      if result == apache.HTTP_NOT_FOUND:
         req.filename = req.filename + '/err404'
         req.path_info = ''
         result = publisher.handler(req)

     return result

although I wouldn't recommend it.

Anyway, please explain why as there is probably a better way of doing  
it but
not knowing what you are trying to achieve makes it very hard to suggest
anything.

Graham
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070116/1a2bf2e7/attachment.html
From maksim.kasimov at gmail.com  Tue Jan 16 07:14:44 2007
From: maksim.kasimov at gmail.com (Maksim Kasimov)
Date: Tue Jan 16 07:14:55 2007
Subject: [mod_python] how to define publisher when page not found
In-Reply-To: <51F7D9A7-8FA0-41C7-8563-6C64BCCDF579@dscpl.com.au>
References: <1168895831.20396@dscpl.user.openhosting.com>
	<a072330b0701160207w6f59f936pb4bc26fb712995ca@mail.gmail.com>
	<51F7D9A7-8FA0-41C7-8563-6C64BCCDF579@dscpl.com.au>
Message-ID: <a072330b0701160414u6dbc0548h7b0008eee2487553@mail.gmail.com>

On 1/16/07, Graham Dumpleton <grahamd@dscpl.com.au> wrote:
>
>
> On 16/01/2007, at 9:07 PM, Maksim Kasimov wrote:
>
>
>
> On 1/15/07, Graham Dumpleton <grahamd@dscpl.com.au> wrote:
> >
> > Maksim Kasimov wrote ..
> > > hi,
> > >
> > > in apache conf file i use:
> > >
> > >     <Directory "/mypath/mydir">
> > >         SetHandler python-program
> > >         PythonHandler mod_python.publisher
> > >     </Directory>
> > >
> > >
> > > there is file:
> > >
> > > in file  /mypath/mydir/index.py there some functions:
> > >
> > > def index(req):
> > >
> > >     return "index"
> > >
> > >
> > > def free(req):
> > >
> > >     return 'free'
> > >
> > >
> > > def not_found(req):
> > >
> > >     # some computation
> > >     return 'page not found'
> > >
> > >
> > >
> > > and every thing is just fine and works as expected:
> > >
> > >        for http://myhostname.org/mydir/free i can see "free"
> > >        for http://myhostname.org/mydir/ i can see "index"
> > >
> > >
> > > my question is: How to get output of "not_found" function for any
> > other
> > > uri,
> > > such as " http://myhostname.org/mydir/hello" ?
> > >
> > > many thanks for any advice.
> >
> > Use the Apache ErrorDocument directive, specifying the URL to the
> > not_found
> > function as the argument.
> >
> > Graham
> >
>
> it is very inconveniently because:
>     1) in the directory "mydir" there can be a lot of *.py scripts (not
> only index.py), and i need to specify some default handler for each of
> module in the directory.
>     2) it makes superfluous redirections
>
>
> But if it is only for not found errors, it wouldn't occur much so why
> would
> it matter.
>
> So my question is still opened.
>
> To provide this, temporary, i've changed resolve_object function in
> publisher.py from mod_python in that way:
>
>         try:
>             #obj = getattr(obj, obj_str)
>             obj = getattr(obj, obj_str, getattr(obj, '_default'))
>         except AttributeError:
>             raise apache.SERVER_RETURN, apache.HTTP_NOT_FOUND
>
> than, i will define _default function in my /mypath/mydir/index.py or any
> other modules in mydir.
>
> i think it is very wrong to change standart libraries, but i did not found
> the way, how to redifine this behavior in my index.py file.
>
> is it possible to define some function in my module, to make it return
> default attribute for getattr function?
> or may be, if i dare, to expect such changes as above in future releases
> of mod_python?
>
>
> It is unlikely you will see such a feature in future versions of
> mod_python.
> I also question why you would want to do that anyway, ie., have a separate
> not found page for every file resource. Care to explain what you thing you
> get from it? Maybe you shouldn't be using mod_python.publisher but should
> be writing a custom dispatcher of your own.
>
> BTW, you could always do the following:
>
>   SetHandler mypublisherwrapper
>
> Then in handler() of mypublisherwrapper do something like (untested):
>
>   from mod_python import apache, publisher
>
>   def handler(req):
>     try:
>       result = publisher.handler(req)
>     except SERVER_RETURN, value:
>             try:
>                 if len(value.args) == 2:
>                     raise
>                 else:
>                     result = value.args[0]
>
>      if result == apache.HTTP_NOT_FOUND:
>         req.filename = req.filename + '/err404'
>         req.path_info = ''
>         result = publisher.handler(req)
>
>     return result
>
> although I wouldn't recommend it.
>
> Anyway, please explain why as there is probably a better way of doing it
> butnot knowing what you are trying to achieve makes it very hard to
> suggest
> anything.
> Graham
>

Hi Graham, i'm very pleased to get your answer, thank you!

>I also question why you would want to do that anyway, ie., have a separate
>not found page for every file resource. Care to explain what you thing you
>get from it?

take it as "default attribute", not as "not found page", but defining
default attribute is a native thing (at least for pythonic applications).
And having ability to define or not define default attribute, in case of
mod_python.publisher, is also not a bad thing, just make it more flexible.
Isn't it?
But any way, i do not  insist.

As we all know, there not only web related projects that uses Apache
web-server and can use mod_python.publisher - there are a lot of things
based on http-protocol.
For example i'm planning to port my Wireles Village project based on
pythonic web-server to Apache, and there many of such things that exists at
the moment and can appears in future.

For web case: all users of my site are mobile operators subscribers, they
download various content from my site (melodies, pictures and so on). For a
different mobile operators, there are different requirements: page design,
error messages format, error message text and many other parameters, it can
be wml, xhtml or html format ... and some times some operator can change its
own requirements (as i can see it happens many times) and so on.
in my turn, i can have a lot of related projects, they must have different
logic, or just a design or use different technology to download (such as
drm-technology)

For various project it is convinient to have different directories, and i
can make some modules with names related to some operator.

One project can have different parts: web/wap-based part, and some
http-based part (Wireless Village + gate to another messengers, SyncML or
smth else)

My case is not unique.


>Maybe you shouldn't be using mod_python.publisher but should
>be writing a custom dispatcher of your own.

it is looks like a discovering a bicycle again and again. But exactly that
change i've suggest before, do not make some unexpected things for those
developers that uses mod_python.publisher but did not define _default
function.



-- 
Maksim Kasimov
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070116/da4297ae/attachment-0001.html
From alainna at pha.jhu.edu  Tue Jan 16 10:09:15 2007
From: alainna at pha.jhu.edu (Alainna C. Wonders)
Date: Tue Jan 16 10:09:32 2007
Subject: [mod_python] Can't get/create handler errors
In-Reply-To: <DFB99325-612C-4ED2-BF99-E5C1E53A3287@dscpl.com.au>
Message-ID: <Pine.LNX.4.44.0701160951340.6881-100000@skysrv.pha.jhu.edu>


Hi Graham, 

Sorry for the late response.  Yes, I did put an export PATH after defining 
the PATH.  

So in the error log I spotted some errors that look like this: 

[error] make_obcallback: could not import mod_python.apache.\n
[error] make_obcallback: Python path being used 
"['/usr/lib/python23.zip', '/usr/lib/python2.3', 
'/usr/lib/python2.3/plat-linux2', '/usr/lib/python2.3/lib-tk', 
'/usr/lib/python2.3/lib-dynload', '/usr/lib/python2.3/site-packages', 
'/usr/lib/python2.3/site-packages/gtk-2.0']".

So after the PATH and export PATH lines in the init script, I put 'echo 
$PATH' so it would echo the path it was using on startup.  

>/etc/init.d/httpd start
>/usr/local/bin:/sbin:/usr/sbin:/bin:/usr/bin:/usr/X11R6/bin

I'm not sure why it's still using the old version.

- Alainna



On Sat, 13 Jan 2007, Graham Dumpleton wrote:

> 
> On 13/01/2007, at 4:24 AM, Alainna C. Wonders wrote:
> 
> >
> > Hi All,
> >
> > I have a Scientific Linux 4.2 server with two versions of python  
> > installed
> > (2.3.4, stock; 2.4.2, my installation).
> >
> > In my apache error log, I see errors like:
> >
> > python_handler: no interpreter callback found.
> > python_handler: Can't get/create interpreter.
> > make_obcallback: could not import mod_python.apache.\n
> > ImportError: No module named mod_python.apache
> > make_obcallback: Python path being used
> > "['/usr/lib/python23.zip', '/usr/lib/python2.3',
> > '/usr/lib/python2.3/plat-linux2', '/usr/lib/python2.3/lib-tk',
> > '/usr/lib/python2.3/lib-dynload', '/usr/lib/python2.3/site-packages',
> > '/usr/lib/python2.3/site-packages/gtk-2.0']".
> >
> > My configure command looked like this:
> >
> > ./configure --with-apxs=/usr/sbin/apxs
> > --with-python=/usr/local/bin/python2.4
> >
> > It ran without error, as did make/make install.
> >
> > I have also set a PATH variable in the httpd init script telling it to
> > look in /usr/local/bin first.  There is /usr/local/bin/python,  
> > which is
> > set to Python 2.4.2.
> 
> Did you export the PATH variable in the init script?
> 
>    export PATH
> 
> Even though PATH is inherited into the script, local changes aren't  
> exported
> from it unless an export is done explicitly. It is a strange gotcha  
> of init scripts
> that has got me before.
> 
> > Any recommendations?  I've seen some stuff on google, and it suggested
> > setting apache's path, which I thought could be done by setting the  
> > PATH
> > variable in the init script and then restarting the daemon.
> >
> > Thanks,
> >
> > Alainna
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> 

-- 
Alainna C. Wonders
Bloomberg Physics & Astronomy
Johns Hopkins University
Email_alainna@pha.jhu.edu
Voice_410.516.4536


From programmer.py at gmail.com  Tue Jan 16 12:20:50 2007
From: programmer.py at gmail.com (Jaime Wyant)
Date: Tue Jan 16 12:20:58 2007
Subject: [mod_python] changing publisher `content' before sent to client
Message-ID: <d52c72d20701160920r37fbecb8i5427c54e07503aaa@mail.gmail.com>

Hi all.  I was not sure of a good subject, but I think this is close.  Here
is what I want to do:

* Use publisher handler.
* "Grab" data before it is sent to the client, perform some `string
substitution' , send modified string / data onto the client.

I made a copy of publisher.py and now use a modified version which performs
the necessary string changes before doing req.write.  But, I can't help but
think that there is a cleaner way to do this.  Is there a `better' way?

Thanks!
jw
-- 
"Government does not solve problems; it subsidizes them."
Ronald Reagan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070116/a4e855c8/attachment.html
From list at joreybump.com  Tue Jan 16 12:51:29 2007
From: list at joreybump.com (Jorey Bump)
Date: Tue Jan 16 12:51:35 2007
Subject: [mod_python] changing publisher `content' before sent to client
In-Reply-To: <d52c72d20701160920r37fbecb8i5427c54e07503aaa@mail.gmail.com>
References: <d52c72d20701160920r37fbecb8i5427c54e07503aaa@mail.gmail.com>
Message-ID: <45AD10A1.8050901@joreybump.com>

Jaime Wyant wrote:
> Hi all.  I was not sure of a good subject, but I think this is close.  
> Here is what I want to do:
> 
> * Use publisher handler.
> * "Grab" data before it is sent to the client, perform some `string 
> substitution' , send modified string / data onto the client.
> 
> I made a copy of publisher.py and now use a modified version which 
> performs the necessary string changes before doing req.write.  But, I 
> can't help but think that there is a cleaner way to do this.  Is there a 
> `better' way?

Ordinary python string replacement is available in the returned result:

def index()
     body = """
<html>
<head>
<title>%s</title>
</head>
<body>
%s
</body>
</html>
"""
     title = "This is the Title"
     content = "<p>This is the content</p>"
     return body % (title, content)

Or did you have something else in mind?


From programmer.py at gmail.com  Tue Jan 16 12:56:24 2007
From: programmer.py at gmail.com (Jaime Wyant)
Date: Tue Jan 16 12:56:35 2007
Subject: [mod_python] changing publisher `content' before sent to client
In-Reply-To: <45AD10A1.8050901@joreybump.com>
References: <d52c72d20701160920r37fbecb8i5427c54e07503aaa@mail.gmail.com>
	<45AD10A1.8050901@joreybump.com>
Message-ID: <d52c72d20701160956q6fe5ee7dp6bd8101637bfa884@mail.gmail.com>

Actually, I need to perform string manipulation on *everything* that gets
handled by publisher.  I don't want to manually edit each function that the
handler exposes.

FWIW, I'm doing this because I would like to have two versions of my website
->

test.mysite.com
real.mysite.com

These sites are identical, except for the domain name well and the database
they use.

But the problem is, I decided to do this a bit late in the game.  And I
didn't have enough foresight *not to* hardcode real.mysite.com.  So I have
real.mysite.com sprinkled throughout various python modules.  Yeah the right
thing to do would be to `fix' everything site wide, but i'm in a pinch (and
lazy :p), so I simply want to change all instances of real.mysite.com to
test.mysite.com.

jw

On 1/16/07, Jorey Bump <list@joreybump.com> wrote:
>
> Jaime Wyant wrote:
> > Hi all.  I was not sure of a good subject, but I think this is close.
> > Here is what I want to do:
> >
> > * Use publisher handler.
> > * "Grab" data before it is sent to the client, perform some `string
> > substitution' , send modified string / data onto the client.
> >
> > I made a copy of publisher.py and now use a modified version which
> > performs the necessary string changes before doing req.write.  But, I
> > can't help but think that there is a cleaner way to do this.  Is there a
> > `better' way?
>
> Ordinary python string replacement is available in the returned result:
>
> def index()
>      body = """
> <html>
> <head>
> <title>%s</title>
> </head>
> <body>
> %s
> </body>
> </html>
> """
>      title = "This is the Title"
>      content = "<p>This is the content</p>"
>      return body % (title, content)
>
> Or did you have something else in mind?
>
>
>


-- 
"Government does not solve problems; it subsidizes them."
Ronald Reagan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070116/8ac3d2fb/attachment.html
From list at joreybump.com  Tue Jan 16 13:31:53 2007
From: list at joreybump.com (Jorey Bump)
Date: Tue Jan 16 13:31:59 2007
Subject: [mod_python] changing publisher `content' before sent to client
In-Reply-To: <d52c72d20701160956q6fe5ee7dp6bd8101637bfa884@mail.gmail.com>
References: <d52c72d20701160920r37fbecb8i5427c54e07503aaa@mail.gmail.com>	
	<45AD10A1.8050901@joreybump.com>
	<d52c72d20701160956q6fe5ee7dp6bd8101637bfa884@mail.gmail.com>
Message-ID: <45AD1A19.5050900@joreybump.com>

Jaime Wyant wrote:
> Actually, I need to perform string manipulation on *everything* that 
> gets handled by publisher.  I don't want to manually edit each function 
> that the handler exposes.
> 
> FWIW, I'm doing this because I would like to have two versions of my 
> website ->
> 
> test.mysite.com
> real.mysite.com

def index(req)
     body = do_stuff_with_your_modules(req)
     return body.replace("test.mysite.com", "real.mysite.com")



From programmer.py at gmail.com  Tue Jan 16 13:41:29 2007
From: programmer.py at gmail.com (Jaime Wyant)
Date: Tue Jan 16 13:41:37 2007
Subject: [mod_python] changing publisher `content' before sent to client
In-Reply-To: <45AD1A19.5050900@joreybump.com>
References: <d52c72d20701160920r37fbecb8i5427c54e07503aaa@mail.gmail.com>
	<45AD10A1.8050901@joreybump.com>
	<d52c72d20701160956q6fe5ee7dp6bd8101637bfa884@mail.gmail.com>
	<45AD1A19.5050900@joreybump.com>
Message-ID: <d52c72d20701161041ne2fc5c8oc0e75ffbcce6724@mail.gmail.com>

I must be missing something obvious here...

But, I want the publisher to continue mapping URLS like it is doing now.  Is
there some way to have the publisher do this, but automagically call some
other function (like index below) before doing a req.write?

jw

On 1/16/07, Jorey Bump <list@joreybump.com> wrote:
>
> Jaime Wyant wrote:
> > Actually, I need to perform string manipulation on *everything* that
> > gets handled by publisher.  I don't want to manually edit each function
> > that the handler exposes.
> >
> > FWIW, I'm doing this because I would like to have two versions of my
> > website ->
> >
> > test.mysite.com
> > real.mysite.com
>
> def index(req)
>      body = do_stuff_with_your_modules(req)
>      return body.replace("test.mysite.com", "real.mysite.com")
>
>
>
>


-- 
"Government does not solve problems; it subsidizes them."
Ronald Reagan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070116/cde6d6b3/attachment.html
From list at joreybump.com  Tue Jan 16 14:17:48 2007
From: list at joreybump.com (Jorey Bump)
Date: Tue Jan 16 14:17:53 2007
Subject: [mod_python] changing publisher `content' before sent to client
In-Reply-To: <d52c72d20701161041ne2fc5c8oc0e75ffbcce6724@mail.gmail.com>
References: <d52c72d20701160920r37fbecb8i5427c54e07503aaa@mail.gmail.com>	
	<45AD10A1.8050901@joreybump.com>	
	<d52c72d20701160956q6fe5ee7dp6bd8101637bfa884@mail.gmail.com>	
	<45AD1A19.5050900@joreybump.com>
	<d52c72d20701161041ne2fc5c8oc0e75ffbcce6724@mail.gmail.com>
Message-ID: <45AD24DC.5040206@joreybump.com>

Jaime Wyant wrote:
> I must be missing something obvious here...
> 
> But, I want the publisher to continue mapping URLS like it is doing 
> now.  Is there some way to have the publisher do this, but automagically 
> call some other function (like index below) before doing a req.write?

It's impossible to know, without seeing your code (no, don't send it). 
How did you design your application? Are your calling functions using 
return to send the resulting page as a string (the typical approach), or 
are you using req.write statements (only necessary to improve 
performance in rare occasions)?

Why did you hardcode a hostname in the first place? It's easy to write a 
publisher application that is portable between hosts. You may be better 
off ripping the hostname out and making sure that your relative links 
are properly constructed. Or, you could pass the hostname as an argument.

As I mentioned, the typical approach with Publisher is to have a 
function return a string (the web page) to the browser. You can 
manipulate this string in the return statement to modify it, if you 
wish. If you want a 'quick fix' that involves tampering with mod_python 
or Apache internals, you are probably better off correcting the design 
flaws in your application instead.
From programmer.py at gmail.com  Tue Jan 16 14:27:26 2007
From: programmer.py at gmail.com (Jaime Wyant)
Date: Tue Jan 16 14:27:35 2007
Subject: [mod_python] changing publisher `content' before sent to client
In-Reply-To: <45AD24DC.5040206@joreybump.com>
References: <d52c72d20701160920r37fbecb8i5427c54e07503aaa@mail.gmail.com>
	<45AD10A1.8050901@joreybump.com>
	<d52c72d20701160956q6fe5ee7dp6bd8101637bfa884@mail.gmail.com>
	<45AD1A19.5050900@joreybump.com>
	<d52c72d20701161041ne2fc5c8oc0e75ffbcce6724@mail.gmail.com>
	<45AD24DC.5040206@joreybump.com>
Message-ID: <d52c72d20701161127o72c65872x42f6ff6fe87f9b91@mail.gmail.com>

On 1/16/07, Jorey Bump <list@joreybump.com> wrote:
>
> Jaime Wyant wrote:
> > I must be missing something obvious here...
> >
> > But, I want the publisher to continue mapping URLS like it is doing
> > now.  Is there some way to have the publisher do this, but automagically
> > call some other function (like index below) before doing a req.write?
>
> It's impossible to know, without seeing your code (no, don't send it).
> How did you design your application? Are your calling functions using
> return to send the resulting page as a string (the typical approach), or
> are you using req.write statements (only necessary to improve
> performance in rare occasions)?


Maybe I did not explain things very well?  I am using mod_python.publisher,
which does its magic calling my functions automagically.  In my called
functions, I simply return a string.


Why did you hardcode a hostname in the first place? It's easy to write a
> publisher application that is portable between hosts. You may be better
> off ripping the hostname out and making sure that your relative links
> are properly constructed. Or, you could pass the hostname as an argument.


I hardcoded them because I sort of hacked this together about 4 or so years
ago --  you learn a lot in four years. Would I hardcode the server name
today - well no:).  (But this is not relevant to my question, imo).

As I mentioned, the typical approach with Publisher is to have a
> function return a string (the web page) to the browser. You can
> manipulate this string in the return statement to modify it, if you
> wish. If you want a 'quick fix' that involves tampering with mod_python
> or Apache internals, you are probably better off correcting the design
> flaws in your application instead.
>

Yes, I'm quite aware of how the publisher works.  But the problem is, I have
this string scattered through a handful of modules.  Yeah, I'll fix them
correctly in the future.  For now I need a bandaid.  I have that bandaid, a
modified  copy of mod_python's publisher.py.

Yeah, it'd be better to fix the website, but I'm in a time crunch.  Plus,
publisher.py is well written / commented.  So plugging in my fix well was
simple - about 4 lines IIRC.  (Nice job mod_python developers!)

In the end, I guess there is no way to intercept the `req.write' call before
the publisher makes it.

Thanks,
jw

-- 
"Government does not solve problems; it subsidizes them."
Ronald Reagan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070116/174487e9/attachment-0001.html
From list at joreybump.com  Tue Jan 16 14:53:06 2007
From: list at joreybump.com (Jorey Bump)
Date: Tue Jan 16 14:53:13 2007
Subject: [mod_python] changing publisher `content' before sent to client
In-Reply-To: <d52c72d20701161127o72c65872x42f6ff6fe87f9b91@mail.gmail.com>
References: <d52c72d20701160920r37fbecb8i5427c54e07503aaa@mail.gmail.com>	
	<45AD10A1.8050901@joreybump.com>	
	<d52c72d20701160956q6fe5ee7dp6bd8101637bfa884@mail.gmail.com>	
	<45AD1A19.5050900@joreybump.com>	
	<d52c72d20701161041ne2fc5c8oc0e75ffbcce6724@mail.gmail.com>	
	<45AD24DC.5040206@joreybump.com>
	<d52c72d20701161127o72c65872x42f6ff6fe87f9b91@mail.gmail.com>
Message-ID: <45AD2D22.10505@joreybump.com>

Jaime Wyant wrote:

> Maybe I did not explain things very well?  

No, you explained your problem precisely.

> I am using 
> mod_python.publisher, which does its magic calling my functions 
> automagically.  In my called functions, I simply return a string.

Good.

> I hardcoded them because I sort of hacked this together about 4 or so 
> years ago --  you learn a lot in four years. Would I hardcode the server 
> name today - well no:).  (But this is not relevant to my question, imo).

You're right. Sorry for second-guessing. It's not easy to determine if 
the requested solution indicates lack of expertise. Of course, in this 
case, you're trying to solve a problem caused by your former newbie self. :)

> Yeah, it'd be better to fix the website, but I'm in a time crunch.  
> Plus, publisher.py is well written / commented.  So plugging in my fix 
> well was simple - about 4 lines IIRC.  (Nice job mod_python developers!)
> 
> In the end, I guess there is no way to intercept the `req.write' call 
> before the publisher makes it.

There probably is. There is also an external module that might work for you:

  http://mod-replace.sourceforge.net/

Graham's discussed adding filter support to mod_python, as well, but I 
don't know how usable it is at the moment.

From bgailer at alum.rpi.edu  Tue Jan 16 15:32:53 2007
From: bgailer at alum.rpi.edu (Bob Gailer)
Date: Tue Jan 16 15:33:01 2007
Subject: [mod_python] sending post data using xmlhttprequest
Message-ID: <45AD3675.90705@alum.rpi.edu>

I'm usung XmlHTTPRequest to send POST data.
I'm using util.FieldStorage to retrieve it.
The program returns an html page containing in part:
<h1>Cannot process request!</h1>
<p> The server does not support the action requested by the browser.

I've tried several varieties of post data, all with the same outcome.

What should XmlHTTPRequest post data look like?

I tested my server side code by sending post data from an html form, and 
that works OK.

-- 
Bob Gailer
510-978-4454

From grahamd at dscpl.com.au  Tue Jan 16 15:58:52 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Jan 16 15:58:59 2007
Subject: [mod_python] changing publisher `content' before sent to client
Message-ID: <1168981132.21804@dscpl.user.openhosting.com>

Jorey Bump wrote ..
> Jaime Wyant wrote:
> > In the end, I guess there is no way to intercept the `req.write' call
> > before the publisher makes it.
> 
> There probably is. There is also an external module that might work for
> you:
> 
>   http://mod-replace.sourceforge.net/
> 
> Graham's discussed adding filter support to mod_python, as well, but I
> don't know how usable it is at the moment.

Using a mod_python output filter is certainly another choice, it can be
used to do the same thing as mod_replace, you just need to code what
you want done yourself. For getting something done quickly, you might
be better off using mod_replace as suggested since you just have to
install it and configure it.

If still interested in doing it using mod_python, look up output filters in
the mod_python documentation. There have also been past discussions
on the mailing list about output filters with examples, for example:

  http://www.modpython.org/pipermail/mod_python/2006-April/020870.html

Thus, use the search box on mod_python site to search through past
discussions on output filters.

Graham

From grahamd at dscpl.com.au  Tue Jan 16 16:10:23 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Jan 16 16:10:33 2007
Subject: [mod_python] sending post data using xmlhttprequest
Message-ID: <1168981823.27999@dscpl.user.openhosting.com>

Bob Gailer wrote ..
> I'm usung XmlHTTPRequest to send POST data.
> I'm using util.FieldStorage to retrieve it.
> The program returns an html page containing in part:
> <h1>Cannot process request!</h1>
> <p> The server does not support the action requested by the browser.
> 
> I've tried several varieties of post data, all with the same outcome.
> 
> What should XmlHTTPRequest post data look like?
> 
> I tested my server side code by sending post data from an html form, and
> that works OK.

That error page corresponds to:

  HTTP_NOT_IMPLEMENTED

The question is why you are getting this.

What you need to do in some way is to be able to capture exactly what
is being sent by your browser. Others may be able to suggest simple ways
of doing that, personally I would 'nc' on my platform and run:

  nc -l -p 8888

and then have the browser post the request to:

  http://localhost:8888

and see what comes out. By looking at what is posted you can see how it
may be malformed.

If using Apache 2.X another thing you can do is turn on multi lang error
documents. The benefit of doing that is that the default error document
pages will embed in them what is call 'error-notes' from Apache. These
constitute additional information about why an error occurred. It may
indicate under what circumstances the not implemented error is being
produced. You may also find the reason listed in the Apache error log, but
that isn't always the case.

Graham
From grahamd at dscpl.com.au  Tue Jan 16 16:55:49 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Jan 16 16:55:55 2007
Subject: [mod_python] how to handle xforms with publisher handler
Message-ID: <1168984549.16823@dscpl.user.openhosting.com>

Emiliano Moscato wrote ..
> Hi all:
> 
> I've added this few lines to FieldStorage and it works fine for me:
> 
>         if ctype.lower() == "application/xml":
>             from xml.dom.minidom import parseString
>             xml = req.read(clen)
>             try:
>                 parseString(xml)
>             except:
>                 raise apache.SERVER_RETURN, apache.HTTP_BAD_REQUEST
>             req.xml = xml
>             return
> 
> Is this interesting for a patch?
> Regards
> 
> Emiliano

It doesn't really fit in with what FieldStorage is meant to do which is to
decode a post request and convert form parameters into a dictionary
for use. All your code does is leave the content as an attribute of req
for something else to deal with. In essence, all you are doing is hacking
FieldStorage to get around the limitation described in:

  http://issues.apache.org/jira/browse/MODPYTHON-29

If you just want to get around that limitation, you might want to instead
look at 'vampire::publisher' from:

  http://www.dscpl.com.au/projects/vampire/

Vampire contains a distinct implementation of publisher which does not
have  the limitation and so in your published function you would be
able to simply do:

  def index(req):
    if req.headers_in['Content-Type'] == 'application/xml':
      ...

This will work because 'vampire::publisher' doesn't error when content type
doesn't equate to something FieldStorage can't handle, instead it just lets
the function deal with it.

For any change to FieldStorage to be accepted in this area, it would have
to properly decode any xforms POST into key/value lists as appropriate and
populate the FieldStorage data structure. That is if that makes sense as I
haven't looked at what is in an xforms POST and whether it is equivalent
to normal form POST but just a different format.

Graham

> 2007/1/12, Graham Dumpleton <grahamd@dscpl.com.au>:
> >
> > If you are using mod_python 3.2.10 or earlier, try 3.3.0b as it has some
> > fixesto FieldStorage class. Can be downloaded from:
> >
> >   http://httpd.apache.org/modules/python-download.cgi
> >
> > I suspect though that it still will not work though, as code is:
> >
> >         # figure out boundary
> >         try:
> >             i = ctype.lower().rindex("boundary=")
> >             boundary = ctype[i+9:]
> >             if len(boundary) >= 2 and boundary[0] == boundary[-1] ==
> '"':
> >                 boundary = boundary[1:-1]
> >             boundary = re.compile("--" + re.escape(boundary) +
> > "(--)?\r?\n")
> >
> > Ie., it assumes that boundary is last field on content type line which
> is
> > a
> > bad assumption.
> >
> > Graham
> >
> > On 13/01/2007, at 8:41 AM, Emiliano Moscato wrote:
> >
> > Hi all!
> >
> > Thanks for your answers.
> > I've been looking the code of FieldStorage and publisher. I think it
> is
> > not soo dificult to patch FieldStorage, but: Is anybody else interested
> in
> > patch FieldStorage? If so I'll try it on monday.
> >
> > On the other hand, I've trying to use another method to send my xforms
> > which uses "multipart/related" as Content-type and I realized that mozilla
> > xforms plugin sends a boundary that is bad handled by
> > publisher-FieldStorage. This is what browser sends:
> >
> > [...]
> > Content-Length: 522
> > Content-Type: multipart/related;
> > boundary=---------------------------13592280651221337293469391600;
> > type="application/xml"; start="<4c599da9.58c746e8@mozilla.org >"
> > Cookie: lang=1
> >
> > -----------------------------13592280651221337293469391600
> > Content-Type: application/xml
> > Content-ID: <4c599da9.58c746e8@mozilla.org>
> >
> > <?xml version="1.0" encoding="UTF-8"?>
> > <idioma xmlns:xf="http://www.w3.org/2002/xforms" xmlns:ev="http://www.w3.org/2001/xml-events"
> > xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema
> > ">
> >
> >       <H__interface>main</H__interface>
> >       <idioma>adadsfasd</idioma>
> >     </idioma>
> > -----------------------------13592280651221337293469391600--
> >
> >
> > But FieldStorage parse the content-type line up to the end trying to
> get
> > boundary, getting this as boundary:
> > -----------------------------7393760691212604279930853199;
> > type="application/xml"; start="< b8f2849.19571884@mozilla.org>
> >
> > Is this a firefox problem or a FieldStorage problem?
> > Regards, enjoy the weekend :)
> >
> > Emiliano
> >
> >
> > 2007/1/12, Jim Gallacher <jpg@jgassociates.ca>:
> > >
> > > Graham Dumpleton wrote:
> > > > Jim Gallacher wrote ..
> > > >> Emiliano Moscato wrote:
> > > >>> Hi all!
> > > >>>
> > > >>> I'm getting crazy trying to receive xforms xml data with mod_python
> > > +
> > > >>> publisher handler.
> > > >
> > > > In what way are you using mod_python.publisher? Depending to what
> > > > degree you are using it, mod_python 3.3 offers some alternate
> > > mechanisms
> > > > for doing basic dispatch against different resources which might
> be
> > > more
> > > > useful and allow you to still access content of response to decode
> it.
> > > >
> > > >>> In a normal HTML form, the data would be sent as
> > > >>> application/x-www-form-urlencoded, in the XForms world however,
> this
> > >
> > > >>> information is sent as XML formatted data (application/xml).
> > > >>> Up to now I've used cherryPy as web server and I've got my xml
> data
> > > with
> > > >>> cherrypy.threadData.xform.
> > > >>> I've read that PHP receive this in $HTTP_RAW_POST_DATA variable.
> If
> > > I
> > > >> send
> > > >>> the form to a php script all work fine.
> > > >>> But when I try to submit a xforms with method POST to a script
> > > managed
> > > >> by
> > > >>> publisher handler I get an error with no log in my apache server
> > > error
> > > >> log.
> > > >>> Any help?
> > > >> You'll need to elaborate on the error you are getting, but I think
> > > part
> > > >> of the problem is that you are bumping up against part of the
> > > internal
> > > >> "magic" of publisher.
> > > >>
> > > >> Publisher automatically creates a FieldStorage instance.
> > > Unfortunately
> > > >> FieldStorage assumes that the content-type starts with either
> > > >> "application/x-www-form-urlencoded" or "multipart/". If I had to
> > > guess
> > > >> I'd say that you are getting "501 Not Implemented error" as a result.
> > >
> > > >>
> > > >> Here are a couple of solutions that you might consider as a
> > > workaround:
> > > >>
> > > >> 1. Hack util.FieldStorage to properly handle your content-type.
> If
> > > you
> > > >> do this feel free to submit a patch so FieldStorage can be fixed.
> ;)
> > > >
> > > > Hmmm, xforms is quite different.
> > > >
> > > >   http://www.w3.org/TR/xforms/
> > > >
> > > > Looks like a lot of work.
> > >
> > > Probably. I certainly wasn't offering to do it. ;)
> > >
> > > >> 2. Hack publisher to skip the automatic creation of FieldStorage.
> > > (Line
> > > >> 424 in publisher.py for mod_python 3.3.0b). You can then use req.read
> > > ()
> > > >> to read and process the POST'd data within your content handler.
> > > >
> > > > I've raised this issue before about publisher not being able to accept
> > > other
> > > > content types. See:
> > > >
> > > >   http://issues.apache.org/jira/browse/MODPYTHON-29
> > > >
> > > > Also, like PSP now does, publisher could be made to use 'req.form'
> if
> > > it
> > > > already existed. This would allow a stacked response handler before
> > > > publisher to decide whether some other form content was supplied,
> > > decode
> > > > it and set req.form to a compatible class to FieldStorage. I don't
> > > know that I
> > > > have created an issue for that idea before, but have certainly thought
> > > > about it and perhaps mentioned it on the mailing list.
> > >
> > > That seems like a reasonable solution.
> > >
> > > >> 3. Use a PythonFixupHandler before the content handler. In the
> > > >> fixuphandler use req.read() to grab the raw data and adjust the
> > > >> content-type header so that FieldStorage doesn't bomb out. Note
> that
> > > if
> > > >> you want to pass xml field data as parameters to your handler method
> > > >> you'll need to do a bit more work. For example
> > > >>
> > > >> def index(foo="bar"):
> > > >>      return "whatever"
> > > >>
> > > >> won't get foo from your xml data. You can likely work around this
> but
> > > >> you'll need to take a look at the source for FieldStorage and
> > > publisher
> > > >> to work out a strategy.
> > > >
> > > > If you are talking about modifying the input stream, an input filter
> > > would
> > > > perhaps be better. Not sure that that will help since xforms is quite
> > > > different and isn't just a matter of changing content type.
> > >
> > > No, I was just thinking you could get the raw data with req.read()
> > > (parsing the xml or whatever) and then set the content-type to
> > > application/x-www-form-urlencoded. That way the subsequent call to
> > > FieldStorage within publisher won't bomb out. The code would look
> > > something like this:
> > >
> > > def fixuphandler(req):
> > >      if req.headers_in.has_key("content-type"):
> > >          ctype = req.headers_in["content-type"]
> > >          if ctype.startswith("application/xml"):
> > >              req.data = parse_the_xml_data_or_whatever(req.read())
> > >              req.headers_in["content-type"] =
> > >                       "application/x-www-form-urlencoded"
> > >      return apache.OK
> > >
> > > A little too hackish perhaps? (Assuming it would even work).
> > >
> > > Jim
> > > _______________________________________________
> > > Mod_python mailing list
> > > Mod_python@modpython.org
> > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > >
> >
> >
> >
> > --
> > mOsKi
> > "No hay nada que uno haga mal , lo que hay es poco vino." Autor Anonimo
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
> >
> >
> 
> 
> -- 
> mOsKi
> "No hay nada que uno haga mal , lo que hay es poco vino." Autor Anonimo
From moski666 at gmail.com  Tue Jan 16 17:11:33 2007
From: moski666 at gmail.com (Emiliano Moscato)
Date: Tue Jan 16 17:11:42 2007
Subject: [mod_python] how to handle xforms with publisher handler
In-Reply-To: <1168984549.16823@dscpl.user.openhosting.com>
References: <1168984549.16823@dscpl.user.openhosting.com>
Message-ID: <4388f4180701161411h75c3a0p98cdafd2571c152b@mail.gmail.com>

Hi Graham:

The point is that the post method to send xforms give you an xml document
with all the xforms data. I understand that it have no sense to make a
dictionary of the xml document, because the goal is to handle the data as an
structured xml document.
Maybe I am wrong trying to use publisher that makes dictionaries with the
form data...
Regards.

Emiliano

2007/1/16, Graham Dumpleton <grahamd@dscpl.com.au>:
>
> Emiliano Moscato wrote ..
> > Hi all:
> >
> > I've added this few lines to FieldStorage and it works fine for me:
> >
> >         if ctype.lower() == "application/xml":
> >             from xml.dom.minidom import parseString
> >             xml = req.read(clen)
> >             try:
> >                 parseString(xml)
> >             except:
> >                 raise apache.SERVER_RETURN, apache.HTTP_BAD_REQUEST
> >             req.xml = xml
> >             return
> >
> > Is this interesting for a patch?
> > Regards
> >
> > Emiliano
>
> It doesn't really fit in with what FieldStorage is meant to do which is to
> decode a post request and convert form parameters into a dictionary
> for use. All your code does is leave the content as an attribute of req
> for something else to deal with. In essence, all you are doing is hacking
> FieldStorage to get around the limitation described in:
>
>   http://issues.apache.org/jira/browse/MODPYTHON-29
>
> If you just want to get around that limitation, you might want to instead
> look at 'vampire::publisher' from:
>
>   http://www.dscpl.com.au/projects/vampire/
>
> Vampire contains a distinct implementation of publisher which does not
> have  the limitation and so in your published function you would be
> able to simply do:
>
>   def index(req):
>     if req.headers_in['Content-Type'] == 'application/xml':
>       ...
>
> This will work because 'vampire::publisher' doesn't error when content
> type
> doesn't equate to something FieldStorage can't handle, instead it just
> lets
> the function deal with it.
>
> For any change to FieldStorage to be accepted in this area, it would have
> to properly decode any xforms POST into key/value lists as appropriate and
> populate the FieldStorage data structure. That is if that makes sense as I
> haven't looked at what is in an xforms POST and whether it is equivalent
> to normal form POST but just a different format.
>
> Graham
>
> > 2007/1/12, Graham Dumpleton <grahamd@dscpl.com.au>:
> > >
> > > If you are using mod_python 3.2.10 or earlier, try 3.3.0b as it has
> some
> > > fixesto FieldStorage class. Can be downloaded from:
> > >
> > >   http://httpd.apache.org/modules/python-download.cgi
> > >
> > > I suspect though that it still will not work though, as code is:
> > >
> > >         # figure out boundary
> > >         try:
> > >             i = ctype.lower().rindex("boundary=")
> > >             boundary = ctype[i+9:]
> > >             if len(boundary) >= 2 and boundary[0] == boundary[-1] ==
> > '"':
> > >                 boundary = boundary[1:-1]
> > >             boundary = re.compile("--" + re.escape(boundary) +
> > > "(--)?\r?\n")
> > >
> > > Ie., it assumes that boundary is last field on content type line which
> > is
> > > a
> > > bad assumption.
> > >
> > > Graham
> > >
> > > On 13/01/2007, at 8:41 AM, Emiliano Moscato wrote:
> > >
> > > Hi all!
> > >
> > > Thanks for your answers.
> > > I've been looking the code of FieldStorage and publisher. I think it
> > is
> > > not soo dificult to patch FieldStorage, but: Is anybody else
> interested
> > in
> > > patch FieldStorage? If so I'll try it on monday.
> > >
> > > On the other hand, I've trying to use another method to send my xforms
> > > which uses "multipart/related" as Content-type and I realized that
> mozilla
> > > xforms plugin sends a boundary that is bad handled by
> > > publisher-FieldStorage. This is what browser sends:
> > >
> > > [...]
> > > Content-Length: 522
> > > Content-Type: multipart/related;
> > > boundary=---------------------------13592280651221337293469391600;
> > > type="application/xml"; start="<4c599da9.58c746e8@mozilla.org >"
> > > Cookie: lang=1
> > >
> > > -----------------------------13592280651221337293469391600
> > > Content-Type: application/xml
> > > Content-ID: <4c599da9.58c746e8@mozilla.org>
> > >
> > > <?xml version="1.0" encoding="UTF-8"?>
> > > <idioma xmlns:xf="http://www.w3.org/2002/xforms" xmlns:ev="
> http://www.w3.org/2001/xml-events"
> > > xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="
> http://www.w3.org/2001/XMLSchema
> > > ">
> > >
> > >       <H__interface>main</H__interface>
> > >       <idioma>adadsfasd</idioma>
> > >     </idioma>
> > > -----------------------------13592280651221337293469391600--
> > >
> > >
> > > But FieldStorage parse the content-type line up to the end trying to
> > get
> > > boundary, getting this as boundary:
> > > -----------------------------7393760691212604279930853199;
> > > type="application/xml"; start="< b8f2849.19571884@mozilla.org>
> > >
> > > Is this a firefox problem or a FieldStorage problem?
> > > Regards, enjoy the weekend :)
> > >
> > > Emiliano
> > >
> > >
> > > 2007/1/12, Jim Gallacher <jpg@jgassociates.ca>:
> > > >
> > > > Graham Dumpleton wrote:
> > > > > Jim Gallacher wrote ..
> > > > >> Emiliano Moscato wrote:
> > > > >>> Hi all!
> > > > >>>
> > > > >>> I'm getting crazy trying to receive xforms xml data with
> mod_python
> > > > +
> > > > >>> publisher handler.
> > > > >
> > > > > In what way are you using mod_python.publisher? Depending to what
> > > > > degree you are using it, mod_python 3.3 offers some alternate
> > > > mechanisms
> > > > > for doing basic dispatch against different resources which might
> > be
> > > > more
> > > > > useful and allow you to still access content of response to decode
> > it.
> > > > >
> > > > >>> In a normal HTML form, the data would be sent as
> > > > >>> application/x-www-form-urlencoded, in the XForms world however,
> > this
> > > >
> > > > >>> information is sent as XML formatted data (application/xml).
> > > > >>> Up to now I've used cherryPy as web server and I've got my xml
> > data
> > > > with
> > > > >>> cherrypy.threadData.xform.
> > > > >>> I've read that PHP receive this in $HTTP_RAW_POST_DATA variable.
> > If
> > > > I
> > > > >> send
> > > > >>> the form to a php script all work fine.
> > > > >>> But when I try to submit a xforms with method POST to a script
> > > > managed
> > > > >> by
> > > > >>> publisher handler I get an error with no log in my apache server
> > > > error
> > > > >> log.
> > > > >>> Any help?
> > > > >> You'll need to elaborate on the error you are getting, but I
> think
> > > > part
> > > > >> of the problem is that you are bumping up against part of the
> > > > internal
> > > > >> "magic" of publisher.
> > > > >>
> > > > >> Publisher automatically creates a FieldStorage instance.
> > > > Unfortunately
> > > > >> FieldStorage assumes that the content-type starts with either
> > > > >> "application/x-www-form-urlencoded" or "multipart/". If I had to
> > > > guess
> > > > >> I'd say that you are getting "501 Not Implemented error" as a
> result.
> > > >
> > > > >>
> > > > >> Here are a couple of solutions that you might consider as a
> > > > workaround:
> > > > >>
> > > > >> 1. Hack util.FieldStorage to properly handle your content-type.
> > If
> > > > you
> > > > >> do this feel free to submit a patch so FieldStorage can be fixed.
> > ;)
> > > > >
> > > > > Hmmm, xforms is quite different.
> > > > >
> > > > >   http://www.w3.org/TR/xforms/
> > > > >
> > > > > Looks like a lot of work.
> > > >
> > > > Probably. I certainly wasn't offering to do it. ;)
> > > >
> > > > >> 2. Hack publisher to skip the automatic creation of FieldStorage.
> > > > (Line
> > > > >> 424 in publisher.py for mod_python 3.3.0b). You can then use
> req.read
> > > > ()
> > > > >> to read and process the POST'd data within your content handler.
> > > > >
> > > > > I've raised this issue before about publisher not being able to
> accept
> > > > other
> > > > > content types. See:
> > > > >
> > > > >   http://issues.apache.org/jira/browse/MODPYTHON-29
> > > > >
> > > > > Also, like PSP now does, publisher could be made to use 'req.form'
> > if
> > > > it
> > > > > already existed. This would allow a stacked response handler
> before
> > > > > publisher to decide whether some other form content was supplied,
> > > > decode
> > > > > it and set req.form to a compatible class to FieldStorage. I don't
> > > > know that I
> > > > > have created an issue for that idea before, but have certainly
> thought
> > > > > about it and perhaps mentioned it on the mailing list.
> > > >
> > > > That seems like a reasonable solution.
> > > >
> > > > >> 3. Use a PythonFixupHandler before the content handler. In the
> > > > >> fixuphandler use req.read() to grab the raw data and adjust the
> > > > >> content-type header so that FieldStorage doesn't bomb out. Note
> > that
> > > > if
> > > > >> you want to pass xml field data as parameters to your handler
> method
> > > > >> you'll need to do a bit more work. For example
> > > > >>
> > > > >> def index(foo="bar"):
> > > > >>      return "whatever"
> > > > >>
> > > > >> won't get foo from your xml data. You can likely work around this
> > but
> > > > >> you'll need to take a look at the source for FieldStorage and
> > > > publisher
> > > > >> to work out a strategy.
> > > > >
> > > > > If you are talking about modifying the input stream, an input
> filter
> > > > would
> > > > > perhaps be better. Not sure that that will help since xforms is
> quite
> > > > > different and isn't just a matter of changing content type.
> > > >
> > > > No, I was just thinking you could get the raw data with req.read()
> > > > (parsing the xml or whatever) and then set the content-type to
> > > > application/x-www-form-urlencoded. That way the subsequent call to
> > > > FieldStorage within publisher won't bomb out. The code would look
> > > > something like this:
> > > >
> > > > def fixuphandler(req):
> > > >      if req.headers_in.has_key("content-type"):
> > > >          ctype = req.headers_in["content-type"]
> > > >          if ctype.startswith("application/xml"):
> > > >              req.data = parse_the_xml_data_or_whatever(req.read())
> > > >              req.headers_in["content-type"] =
> > > >                       "application/x-www-form-urlencoded"
> > > >      return apache.OK
> > > >
> > > > A little too hackish perhaps? (Assuming it would even work).
> > > >
> > > > Jim
> > > > _______________________________________________
> > > > Mod_python mailing list
> > > > Mod_python@modpython.org
> > > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > > >
> > >
> > >
> > >
> > > --
> > > mOsKi
> > > "No hay nada que uno haga mal , lo que hay es poco vino." Autor
> Anonimo
> > > _______________________________________________
> > > Mod_python mailing list
> > > Mod_python@modpython.org
> > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > >
> > >
> > >
> >
> >
> > --
> > mOsKi
> > "No hay nada que uno haga mal , lo que hay es poco vino." Autor Anonimo
>



-- 
mOsKi
"No hay nada que uno haga mal , lo que hay es poco vino." Autor Anonimo
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070116/e1044dd4/attachment-0001.html
From grahamd at dscpl.com.au  Tue Jan 16 17:35:41 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Jan 16 17:35:48 2007
Subject: [mod_python] how to define publisher when page not found
Message-ID: <1168986941.3751@dscpl.user.openhosting.com>

Maksim Kasimov wrote ..
> Hi Graham, i'm very pleased to get your answer, thank you!
> 
> >I also question why you would want to do that anyway, ie., have a separate
> >not found page for every file resource. Care to explain what you thing
> you
> >get from it?
> 
> take it as "default attribute", not as "not found page", but defining
> default attribute is a native thing (at least for pythonic applications).
> And having ability to define or not define default attribute, in case of
> mod_python.publisher, is also not a bad thing, just make it more flexible.
> Isn't it?
> But any way, i do not  insist.
> 
> As we all know, there not only web related projects that uses Apache
> web-server and can use mod_python.publisher - there are a lot of things
> based on http-protocol.
> For example i'm planning to port my Wireles Village project based on
> pythonic web-server to Apache, and there many of such things that exists
> at
> the moment and can appears in future.
> 
> For web case: all users of my site are mobile operators subscribers, they
> download various content from my site (melodies, pictures and so on). For
> a
> different mobile operators, there are different requirements: page design,
> error messages format, error message text and many other parameters, it
> can
> be wml, xhtml or html format ... and some times some operator can change
> its
> own requirements (as i can see it happens many times) and so on.
> in my turn, i can have a lot of related projects, they must have different
> logic, or just a design or use different technology to download (such as
> drm-technology)
> 
> For various project it is convinient to have different directories, and
> i
> can make some modules with names related to some operator.
> 
> One project can have different parts: web/wap-based part, and some
> http-based part (Wireless Village + gate to another messengers, SyncML
> or
> smth else)
> 
> My case is not unique.
> 
> 
> >Maybe you shouldn't be using mod_python.publisher but should
> >be writing a custom dispatcher of your own.
> 
> it is looks like a discovering a bicycle again and again. But exactly that
> change i've suggest before, do not make some unexpected things for those
> developers that uses mod_python.publisher but did not define _default
> function.

Your change does have the potential to break existing code as publisher at the
moment would ignore anything called _default. With this change publisher would
then treat it as special in some way. If existing code had used this name for
an internal function, data or class name, then that code would then start
failing.

Overall I would suggest that using mod_python.publisher would be a poor choice
for what you are wanting. I sort of get the impression that you chose it
because it was the only option you could find which provided a means of
dispatching different URLs to different functions within different code files.

The problem you are going to have with using mod_python.publisher is that
although it does provide an ability to map URLs to arbitrary functions and
data, the functions aren't normal mod_python handlers and are instead
restricted as to what they can do.

For example, you can only use GET/POST requests against them. Thus, if you want
to use other request methods to implement a more REST like interface it will
not work. Next is that when you do use POST, it will only accept certain types
of content type which correspond to what is used in HTML forms. Thus, you
wouldn't be able to implement using publisher endpoints for JSON-RPC, XML-RPC
servers, REST handlers which want to accept other content types etc etc.

Other problems are that publisher as written expects the full URL to be able to
be mapped, meaning in effect you have a static URL system. There are ways to
overcome this without hacking the publisher internals as you want to do, but
since you didn't precisely explain why you wanted the _default fallback I can't
say that it is because of this issue that you want it.

Thus, although you think you are getting a lot of flexibility, you aren't
really and your users would be quite restricted in what they can do. There
are thus perhaps better ways of doing what you want, but at the moment your
description of what you want to do is very broad and isn't specific about
the desirable features you want.

To give you a better idea of what you could do, you might perhaps indicate
what of the following basic features you are after, plus add any others you
think you want.

1. Have URLs be able to map to handlers in different code files corresponding
to different resources.

2. For a code file for a specific resource, map to different handlers within that
code file based on what format the user wants to view that resource. Ie.,
different handlers based on whether they want to view that resource as HTML,
TXT, CSV, etc.

3. Automatic decoding and mapping to handler parameters of any fields in
a HTML form POST.

4. Ability for a handler to accept other POST content types besides HTML form
POST.

5. Within a code file for a resource, the ability to have the additional path
information be mapped onto handlers contained within instances of classes
contained in that code file.

6. The ability that not all the additional path information be mapped and that
instead any extra path information beyond what was mapped to still be available
to a handler to process.

7. The ability to have parts of the additional path information be passed to
a handler as parameters, overriding what may have been provided in a HTML
form post.

8. The ability to have instances of classes created on the fly specific to each
request rather than all requests being handled by a single instance of a class.

I will have missed some, but to me these are basic desirable features that
one might want. It would actually be interesting if as a group we can come
up with a more complete list of such basic features one might want and that
may even be used as a checklist against available dispatchers/frameworks
to see if it meets ones requirements or at least how they achieve them.

As is, publisher can't do all these. Some it can do but it isn't going to be
obvious to the average user how to achieve it using publisher.

Anyway, try to be more specific of the features you want instead of talking
about the problem domains you users might want to work in and we can
probably give better feedback.

Graham
From eric at bright-interactive.com  Tue Jan 16 17:45:26 2007
From: eric at bright-interactive.com (Eric Clack)
Date: Tue Jan 16 17:45:31 2007
Subject: [mod_python] mod_python example code
Message-ID: <5c58e3ca0701161445g76d3af7cq3583594b9e8c3bbb@mail.gmail.com>

I've been using Python, MySQL, Apache and mod_python for some time now
and think that it is a great combination for many projects. However I
have been constantly surprised by the lack of any visible mod_python
examples on the web.

So, I've released my framework in the hope that it will be useful to
others and of course to seek comments, corrections, criticisms from the
community.

This framework takes care of:
- templating (using Cheetah)
- querying MySQL (using Manager objects)
- sending emails
- debugging (to Apache log or stdout)
- users and security

Download the framework from this page:
http://www.bright-interactive.com/python/
It's licensed under the GPL.

I hope to add more examples over the coming months (e.g. demonstrating
emails, etc). However, the full source code is provided and its
reasonably well commented, so you can always discover for yourself.

-Eric.
From bgailer at alum.rpi.edu  Tue Jan 16 18:51:58 2007
From: bgailer at alum.rpi.edu (Bob Gailer)
Date: Tue Jan 16 18:52:15 2007
Subject: [mod_python] sending post data using xmlhttprequest
In-Reply-To: <1168981823.27999@dscpl.user.openhosting.com>
References: <1168981823.27999@dscpl.user.openhosting.com>
Message-ID: <45AD651E.6000405@alum.rpi.edu>

An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070116/8ad51b08/attachment.html
From grahamd at dscpl.com.au  Tue Jan 16 19:09:01 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Jan 16 19:09:11 2007
Subject: [mod_python] sending post data using xmlhttprequest
Message-ID: <1168992541.15097@dscpl.user.openhosting.com>

Bob Gailer wrote ..

>    My concern is that I may not be providing the post data in a form acceptable
>    to FieldStorage. If I use req.read() I see what I posted, and that's
> OK.
>
>> If using Apache 2.X another thing you can do is turn on multi lang error
>> documents. The benefit of doing that is that the default error document
>> pages will embed in them what is call 'error-notes' from Apache. These
>> constitute additional information about why an error occurred. It may
>> indicate under what circumstances the not implemented error is being
>> produced.
> 
>    OK; how do I "turn on multi lang error documents"?

Probably will not help anyway. I stupidly forgot to look in FieldStorage itself.
You are probably just hitting:

        if not ctype.startswith("multipart/"):
            # we don't understand this content-type
            raise apache.SERVER_RETURN, apache.HTTP_NOT_IMPLEMENTED

What is the content type header you are sending contain (exactly)?

If using a basic handler and read() to see what is sent, also dump out
req.headers_in as well.

Graham
From grahamd at dscpl.com.au  Tue Jan 16 19:30:20 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Jan 16 19:30:26 2007
Subject: [mod_python] Can't get/create handler errors
Message-ID: <1168993820.24657@dscpl.user.openhosting.com>

What version of mod_python are you using?

What does the message of the form:

  [Tue Jan 16 21:54:16 2007] [notice] Apache/2.2.2 (Unix) mod_python/3.3.0-dev-20061203 Python/2.3.5 configured -- resuming normal operations

in the error log file say?

Are you see a message of the form:

  python_init: Python version mismatch, expected '%s', found '%s'."

in the error log file? Probably will not as think this is 3.3 only.

You wouldn't be able by chance be able to upgrade to mod_python 3.3.0b would
you. The error reporting when these problems occur is slightly better and makes
it easier to debug?

You can get 3.3.0b source code from mod_python download page.

One last thing to try is set:

  PYTHONHOME=/usr/local/lib
  export PYTHONHOME

in the Apache init script. Change the value if it appears in error log but I haven't
quite got location correct.

Graham

Alainna C. Wonders wrote ..
> 
> Hi Graham, 
> 
> Sorry for the late response.  Yes, I did put an export PATH after defining
> the PATH.  
> 
> So in the error log I spotted some errors that look like this: 
> 
> [error] make_obcallback: could not import mod_python.apache.\n
> [error] make_obcallback: Python path being used 
> "['/usr/lib/python23.zip', '/usr/lib/python2.3', 
> '/usr/lib/python2.3/plat-linux2', '/usr/lib/python2.3/lib-tk', 
> '/usr/lib/python2.3/lib-dynload', '/usr/lib/python2.3/site-packages', 
> '/usr/lib/python2.3/site-packages/gtk-2.0']".
> 
> So after the PATH and export PATH lines in the init script, I put 'echo
> $PATH' so it would echo the path it was using on startup.  
> 
> >/etc/init.d/httpd start
> >/usr/local/bin:/sbin:/usr/sbin:/bin:/usr/bin:/usr/X11R6/bin
> 
> I'm not sure why it's still using the old version.
> 
> - Alainna
> 
> 
> 
> On Sat, 13 Jan 2007, Graham Dumpleton wrote:
> 
> > 
> > On 13/01/2007, at 4:24 AM, Alainna C. Wonders wrote:
> > 
> > >
> > > Hi All,
> > >
> > > I have a Scientific Linux 4.2 server with two versions of python  
> > > installed
> > > (2.3.4, stock; 2.4.2, my installation).
> > >
> > > In my apache error log, I see errors like:
> > >
> > > python_handler: no interpreter callback found.
> > > python_handler: Can't get/create interpreter.
> > > make_obcallback: could not import mod_python.apache.\n
> > > ImportError: No module named mod_python.apache
> > > make_obcallback: Python path being used
> > > "['/usr/lib/python23.zip', '/usr/lib/python2.3',
> > > '/usr/lib/python2.3/plat-linux2', '/usr/lib/python2.3/lib-tk',
> > > '/usr/lib/python2.3/lib-dynload', '/usr/lib/python2.3/site-packages',
> > > '/usr/lib/python2.3/site-packages/gtk-2.0']".
> > >
> > > My configure command looked like this:
> > >
> > > ./configure --with-apxs=/usr/sbin/apxs
> > > --with-python=/usr/local/bin/python2.4
> > >
> > > It ran without error, as did make/make install.
> > >
> > > I have also set a PATH variable in the httpd init script telling it
> to
> > > look in /usr/local/bin first.  There is /usr/local/bin/python,  
> > > which is
> > > set to Python 2.4.2.
> > 
> > Did you export the PATH variable in the init script?
> > 
> >    export PATH
> > 
> > Even though PATH is inherited into the script, local changes aren't 
> > exported
> > from it unless an export is done explicitly. It is a strange gotcha 
> > of init scripts
> > that has got me before.
> > 
> > > Any recommendations?  I've seen some stuff on google, and it suggested
> > > setting apache's path, which I thought could be done by setting the
> > > PATH
> > > variable in the init script and then restarting the daemon.
> > >
> > > Thanks,
> > >
> > > Alainna
> > >
> > > _______________________________________________
> > > Mod_python mailing list
> > > Mod_python@modpython.org
> > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > 
> 
> -- 
> Alainna C. Wonders
> Bloomberg Physics & Astronomy
> Johns Hopkins University
> Email_alainna@pha.jhu.edu
> Voice_410.516.4536
From moski666 at gmail.com  Wed Jan 17 07:56:22 2007
From: moski666 at gmail.com (Emiliano Moscato)
Date: Wed Jan 17 07:56:34 2007
Subject: [mod_python] how to handle xforms with publisher handler
In-Reply-To: <4388f4180701161411h75c3a0p98cdafd2571c152b@mail.gmail.com>
References: <1168984549.16823@dscpl.user.openhosting.com>
	<4388f4180701161411h75c3a0p98cdafd2571c152b@mail.gmail.com>
Message-ID: <4388f4180701170456l1e86725bqc5e18bf648dc5662@mail.gmail.com>

Hi;

I've followed my tiny work with FieldStorage.
I changed the line:
            boundary = ctype[i+9:]
for:
            boundary = ctype[i+9:ctype.find(';',i+9)]
to fix the problem with boundary.
I've tried to use this method without any other change to FieldStorage and
works. I only need this bugfix and it is a good new for me.
On the other hand, I was thinking about the matter with "application/xml"
serialize method and the name of the method says all: who uses
"application/xml" as serialize method waits in the server for an xml
document, not for its mapping to a dict, and it have nothing to do with
xforms.
For example: cherryPy, where I come from, uses the same philosophy of put
the form fields as attributes of an object, but when it receives an
"application/xml" puts it available in "threadData" attribute.
Thanks for the attention :)

Emiliano

2007/1/16, Emiliano Moscato <moski666@gmail.com>:
>
> Hi Graham:
>
> The point is that the post method to send xforms give you an xml document
> with all the xforms data. I understand that it have no sense to make a
> dictionary of the xml document, because the goal is to handle the data as an
> structured xml document.
> Maybe I am wrong trying to use publisher that makes dictionaries with the
> form data...
> Regards.
>
> Emiliano
>
> 2007/1/16, Graham Dumpleton < grahamd@dscpl.com.au>:
> >
> > Emiliano Moscato wrote ..
> > > Hi all:
> > >
> > > I've added this few lines to FieldStorage and it works fine for me:
> > >
> > >         if ctype.lower() == "application/xml":
> > >             from xml.dom.minidom import parseString
> > >             xml = req.read(clen)
> > >             try:
> > >                 parseString(xml)
> > >             except:
> > >                 raise apache.SERVER_RETURN, apache.HTTP_BAD_REQUEST
> > >             req.xml = xml
> > >             return
> > >
> > > Is this interesting for a patch?
> > > Regards
> > >
> > > Emiliano
> >
> > It doesn't really fit in with what FieldStorage is meant to do which is
> > to
> > decode a post request and convert form parameters into a dictionary
> > for use. All your code does is leave the content as an attribute of req
> > for something else to deal with. In essence, all you are doing is
> > hacking
> > FieldStorage to get around the limitation described in:
> >
> >   http://issues.apache.org/jira/browse/MODPYTHON-29
> >
> > If you just want to get around that limitation, you might want to
> > instead
> > look at 'vampire::publisher' from:
> >
> >   http://www.dscpl.com.au/projects/vampire/
> >
> > Vampire contains a distinct implementation of publisher which does not
> > have  the limitation and so in your published function you would be
> > able to simply do:
> >
> >   def index(req):
> >     if req.headers_in ['Content-Type'] == 'application/xml':
> >       ...
> >
> > This will work because 'vampire::publisher' doesn't error when content
> > type
> > doesn't equate to something FieldStorage can't handle, instead it just
> > lets
> > the function deal with it.
> >
> > For any change to FieldStorage to be accepted in this area, it would
> > have
> > to properly decode any xforms POST into key/value lists as appropriate
> > and
> > populate the FieldStorage data structure. That is if that makes sense as
> > I
> > haven't looked at what is in an xforms POST and whether it is equivalent
> > to normal form POST but just a different format.
> >
> > Graham
> >
> > > 2007/1/12, Graham Dumpleton < grahamd@dscpl.com.au>:
> > > >
> > > > If you are using mod_python 3.2.10 or earlier, try 3.3.0b as it has
> > some
> > > > fixesto FieldStorage class. Can be downloaded from:
> > > >
> > > >   http://httpd.apache.org/modules/python-download.cgi
> > > >
> > > > I suspect though that it still will not work though, as code is:
> > > >
> > > >         # figure out boundary
> > > >         try:
> > > >             i = ctype.lower().rindex("boundary=")
> > > >             boundary = ctype[i+9:]
> > > >             if len(boundary) >= 2 and boundary[0] == boundary[-1] ==
> >
> > > '"':
> > > >                 boundary = boundary[1:-1]
> > > >             boundary = re.compile("--" + re.escape(boundary) +
> > > > "(--)?\r?\n")
> > > >
> > > > Ie., it assumes that boundary is last field on content type line
> > which
> > > is
> > > > a
> > > > bad assumption.
> > > >
> > > > Graham
> > > >
> > > > On 13/01/2007, at 8:41 AM, Emiliano Moscato wrote:
> > > >
> > > > Hi all!
> > > >
> > > > Thanks for your answers.
> > > > I've been looking the code of FieldStorage and publisher. I think it
> > > is
> > > > not soo dificult to patch FieldStorage, but: Is anybody else
> > interested
> > > in
> > > > patch FieldStorage? If so I'll try it on monday.
> > > >
> > > > On the other hand, I've trying to use another method to send my
> > xforms
> > > > which uses "multipart/related" as Content-type and I realized that
> > mozilla
> > > > xforms plugin sends a boundary that is bad handled by
> > > > publisher-FieldStorage. This is what browser sends:
> > > >
> > > > [...]
> > > > Content-Length: 522
> > > > Content-Type: multipart/related;
> > > > boundary=---------------------------13592280651221337293469391600;
> > > > type="application/xml"; start="<4c599da9.58c746e8@mozilla.org >"
> > > > Cookie: lang=1
> > > >
> > > > -----------------------------13592280651221337293469391600
> > > > Content-Type: application/xml
> > > > Content-ID: < 4c599da9.58c746e8@mozilla.org>
> > > >
> > > > <?xml version="1.0" encoding="UTF-8"?>
> > > > <idioma xmlns:xf="http://www.w3.org/2002/xforms " xmlns:ev="
> > http://www.w3.org/2001/xml-events"
> > > > xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance " xmlns:xsd="
> > http://www.w3.org/2001/XMLSchema
> > > > ">
> > > >
> > > >       <H__interface>main</H__interface>
> > > >       <idioma>adadsfasd</idioma>
> > > >     </idioma>
> > > > -----------------------------13592280651221337293469391600--
> > > >
> > > >
> > > > But FieldStorage parse the content-type line up to the end trying to
> > > get
> > > > boundary, getting this as boundary:
> > > > -----------------------------7393760691212604279930853199;
> > > > type="application/xml"; start="< b8f2849.19571884@mozilla.org>
> > > >
> > > > Is this a firefox problem or a FieldStorage problem?
> > > > Regards, enjoy the weekend :)
> > > >
> > > > Emiliano
> > > >
> > > >
> > > > 2007/1/12, Jim Gallacher <jpg@jgassociates.ca>:
> > > > >
> > > > > Graham Dumpleton wrote:
> > > > > > Jim Gallacher wrote ..
> > > > > >> Emiliano Moscato wrote:
> > > > > >>> Hi all!
> > > > > >>>
> > > > > >>> I'm getting crazy trying to receive xforms xml data with
> > mod_python
> > > > > +
> > > > > >>> publisher handler.
> > > > > >
> > > > > > In what way are you using mod_python.publisher? Depending to
> > what
> > > > > > degree you are using it, mod_python 3.3 offers some alternate
> > > > > mechanisms
> > > > > > for doing basic dispatch against different resources which might
> > > be
> > > > > more
> > > > > > useful and allow you to still access content of response to
> > decode
> > > it.
> > > > > >
> > > > > >>> In a normal HTML form, the data would be sent as
> > > > > >>> application/x-www-form-urlencoded, in the XForms world
> > however,
> > > this
> > > > >
> > > > > >>> information is sent as XML formatted data (application/xml).
> > > > > >>> Up to now I've used cherryPy as web server and I've got my xml
> > > data
> > > > > with
> > > > > >>> cherrypy.threadData.xform.
> > > > > >>> I've read that PHP receive this in $HTTP_RAW_POST_DATA
> > variable.
> > > If
> > > > > I
> > > > > >> send
> > > > > >>> the form to a php script all work fine.
> > > > > >>> But when I try to submit a xforms with method POST to a script
> > > > > managed
> > > > > >> by
> > > > > >>> publisher handler I get an error with no log in my apache
> > server
> > > > > error
> > > > > >> log.
> > > > > >>> Any help?
> > > > > >> You'll need to elaborate on the error you are getting, but I
> > think
> > > > > part
> > > > > >> of the problem is that you are bumping up against part of the
> > > > > internal
> > > > > >> "magic" of publisher.
> > > > > >>
> > > > > >> Publisher automatically creates a FieldStorage instance.
> > > > > Unfortunately
> > > > > >> FieldStorage assumes that the content-type starts with either
> > > > > >> "application/x-www-form-urlencoded" or "multipart/". If I had
> > to
> > > > > guess
> > > > > >> I'd say that you are getting "501 Not Implemented error" as a
> > result.
> > > > >
> > > > > >>
> > > > > >> Here are a couple of solutions that you might consider as a
> > > > > workaround:
> > > > > >>
> > > > > >> 1. Hack util.FieldStorage to properly handle your content-type.
> > > If
> > > > > you
> > > > > >> do this feel free to submit a patch so FieldStorage can be
> > fixed.
> > > ;)
> > > > > >
> > > > > > Hmmm, xforms is quite different.
> > > > > >
> > > > > >   http://www.w3.org/TR/xforms/
> > > > > >
> > > > > > Looks like a lot of work.
> > > > >
> > > > > Probably. I certainly wasn't offering to do it. ;)
> > > > >
> > > > > >> 2. Hack publisher to skip the automatic creation of
> > FieldStorage.
> > > > > (Line
> > > > > >> 424 in publisher.py for mod_python 3.3.0b). You can then use
> > req.read
> > > > > ()
> > > > > >> to read and process the POST'd data within your content
> > handler.
> > > > > >
> > > > > > I've raised this issue before about publisher not being able to
> > accept
> > > > > other
> > > > > > content types. See:
> > > > > >
> > > > > >   http://issues.apache.org/jira/browse/MODPYTHON-29
> > > > > >
> > > > > > Also, like PSP now does, publisher could be made to use '
> > req.form'
> > > if
> > > > > it
> > > > > > already existed. This would allow a stacked response handler
> > before
> > > > > > publisher to decide whether some other form content was
> > supplied,
> > > > > decode
> > > > > > it and set req.form to a compatible class to FieldStorage. I
> > don't
> > > > > know that I
> > > > > > have created an issue for that idea before, but have certainly
> > thought
> > > > > > about it and perhaps mentioned it on the mailing list.
> > > > >
> > > > > That seems like a reasonable solution.
> > > > >
> > > > > >> 3. Use a PythonFixupHandler before the content handler. In the
> > > > > >> fixuphandler use req.read() to grab the raw data and adjust the
> > > > > >> content-type header so that FieldStorage doesn't bomb out. Note
> > > that
> > > > > if
> > > > > >> you want to pass xml field data as parameters to your handler
> > method
> > > > > >> you'll need to do a bit more work. For example
> > > > > >>
> > > > > >> def index(foo="bar"):
> > > > > >>      return "whatever"
> > > > > >>
> > > > > >> won't get foo from your xml data. You can likely work around
> > this
> > > but
> > > > > >> you'll need to take a look at the source for FieldStorage and
> > > > > publisher
> > > > > >> to work out a strategy.
> > > > > >
> > > > > > If you are talking about modifying the input stream, an input
> > filter
> > > > > would
> > > > > > perhaps be better. Not sure that that will help since xforms is
> > quite
> > > > > > different and isn't just a matter of changing content type.
> > > > >
> > > > > No, I was just thinking you could get the raw data with req.read()
> > > > > (parsing the xml or whatever) and then set the content-type to
> > > > > application/x-www-form-urlencoded. That way the subsequent call to
> > > > > FieldStorage within publisher won't bomb out. The code would look
> > > > > something like this:
> > > > >
> > > > > def fixuphandler(req):
> > > > >      if req.headers_in.has_key("content-type"):
> > > > >          ctype = req.headers_in ["content-type"]
> > > > >          if ctype.startswith("application/xml"):
> > > > >              req.data = parse_the_xml_data_or_whatever(req.read())
> > > > >              req.headers_in ["content-type"] =
> > > > >                       "application/x-www-form-urlencoded"
> > > > >      return apache.OK
> > > > >
> > > > > A little too hackish perhaps? (Assuming it would even work).
> > > > >
> > > > > Jim
> > > > > _______________________________________________
> > > > > Mod_python mailing list
> > > > > Mod_python@modpython.org
> > > > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > > > >
> > > >
> > > >
> > > >
> > > > --
> > > > mOsKi
> > > > "No hay nada que uno haga mal , lo que hay es poco vino." Autor
> > Anonimo
> > > > _______________________________________________
> > > > Mod_python mailing list
> > > > Mod_python@modpython.org
> > > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > > >
> > > >
> > > >
> > >
> > >
> > > --
> > > mOsKi
> > > "No hay nada que uno haga mal , lo que hay es poco vino." Autor
> > Anonimo
> >
>
>
>
> --
> mOsKi
> "No hay nada que uno haga mal , lo que hay es poco vino." Autor Anonimo
>



-- 
mOsKi
"No hay nada que uno haga mal , lo que hay es poco vino." Autor Anonimo
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070117/3382f248/attachment-0001.html
From thiagocomicio at gmail.com  Wed Jan 17 15:10:53 2007
From: thiagocomicio at gmail.com (Thiago Comicio)
Date: Wed Jan 17 15:11:13 2007
Subject: [mod_python] Problems with ZODB / modpython
Message-ID: <c1e7137e0701171210t42e7ef61ka762dbc8fba2592a@mail.gmail.com>

Hi,

I'm trying to install a program that needs mod_python and ZODB. The
program is not running, so I tried to connect to the database through
this script:

from ZODB import FileStorage, DB

def index(req, **params):
        storage = FileStorage.FileStorage('mydatabase.fs')
        db = DB(storage)
        connection = db.open()
        root = connection.root()
        return TestPage().getHTML()

And I received the error below.
Does anybody know how to fix it?

Thanks

Thiago

---------------------------

Mod_python error: "PythonHandler mod_python.publisher"

Traceback (most recent call last):

  File "/usr/lib/python2.4/site-packages/mod_python/apache.py", line
299, in HandlerDispatch
    result = object(req)

  File "/usr/lib/python2.4/site-packages/mod_python/publisher.py",
line 213, in handler
    published = publish_object(req, object)

  File "/usr/lib/python2.4/site-packages/mod_python/publisher.py",
line 412, in publish_object
    return publish_object(req,util.apply_fs_data(object, req.form, req=req))

  File "/usr/lib/python2.4/site-packages/mod_python/util.py", line
439, in apply_fs_data
    return object(**args)

  File "/var/www/html/indico/teste.py", line 4, in index
    storage = FileStorage.FileStorage('mydatabase.fs')

  File "/usr/lib/zope/lib/python/ZODB/FileStorage/FileStorage.py",
line 112, in __init__
    self._lock_file = LockFile(file_name + '.lock')

  File "/usr/lib/zope/lib/python/ZODB/lock_file.py", line 60, in __init__
    self._fp = open(path, 'w+')

IOError: [Errno 13] Permission denied: 'mydatabase.fs.lock'
From grahamd at dscpl.com.au  Wed Jan 17 15:48:42 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Jan 17 15:48:48 2007
Subject: [mod_python] how to handle xforms with publisher handler
Message-ID: <1169066921.19333@dscpl.user.openhosting.com>

Emiliano Moscato wrote ..
> Hi;
> 
> I've followed my tiny work with FieldStorage.
> I changed the line:
>             boundary = ctype[i+9:]
> for:
>             boundary = ctype[i+9:ctype.find(';',i+9)]
> to fix the problem with boundary.

I don't think this will always work. Where there is no semicolon then the
result would be:

  boundary = ctype[i+9:-1]

This would have the affect of dropping off the last character in the value
which may be part of the boundary tag or the quote which might surround
it.

Graham


> I've tried to use this method without any other change to FieldStorage
> and
> works. I only need this bugfix and it is a good new for me.
> On the other hand, I was thinking about the matter with "application/xml"
> serialize method and the name of the method says all: who uses
> "application/xml" as serialize method waits in the server for an xml
> document, not for its mapping to a dict, and it have nothing to do with
> xforms.
> For example: cherryPy, where I come from, uses the same philosophy of put
> the form fields as attributes of an object, but when it receives an
> "application/xml" puts it available in "threadData" attribute.
> Thanks for the attention :)
> 
> Emiliano
> 
> 2007/1/16, Emiliano Moscato <moski666@gmail.com>:
> >
> > Hi Graham:
> >
> > The point is that the post method to send xforms give you an xml document
> > with all the xforms data. I understand that it have no sense to make
> a
> > dictionary of the xml document, because the goal is to handle the data
> as an
> > structured xml document.
> > Maybe I am wrong trying to use publisher that makes dictionaries with
> the
> > form data...
> > Regards.
> >
> > Emiliano
> >
> > 2007/1/16, Graham Dumpleton < grahamd@dscpl.com.au>:
> > >
> > > Emiliano Moscato wrote ..
> > > > Hi all:
> > > >
> > > > I've added this few lines to FieldStorage and it works fine for me:
> > > >
> > > >         if ctype.lower() == "application/xml":
> > > >             from xml.dom.minidom import parseString
> > > >             xml = req.read(clen)
> > > >             try:
> > > >                 parseString(xml)
> > > >             except:
> > > >                 raise apache.SERVER_RETURN, apache.HTTP_BAD_REQUEST
> > > >             req.xml = xml
> > > >             return
> > > >
> > > > Is this interesting for a patch?
> > > > Regards
> > > >
> > > > Emiliano
> > >
> > > It doesn't really fit in with what FieldStorage is meant to do which
> is
> > > to
> > > decode a post request and convert form parameters into a dictionary
> > > for use. All your code does is leave the content as an attribute of
> req
> > > for something else to deal with. In essence, all you are doing is
> > > hacking
> > > FieldStorage to get around the limitation described in:
> > >
> > >   http://issues.apache.org/jira/browse/MODPYTHON-29
> > >
> > > If you just want to get around that limitation, you might want to
> > > instead
> > > look at 'vampire::publisher' from:
> > >
> > >   http://www.dscpl.com.au/projects/vampire/
> > >
> > > Vampire contains a distinct implementation of publisher which does
> not
> > > have  the limitation and so in your published function you would be
> > > able to simply do:
> > >
> > >   def index(req):
> > >     if req.headers_in ['Content-Type'] == 'application/xml':
> > >       ...
> > >
> > > This will work because 'vampire::publisher' doesn't error when content
> > > type
> > > doesn't equate to something FieldStorage can't handle, instead it just
> > > lets
> > > the function deal with it.
> > >
> > > For any change to FieldStorage to be accepted in this area, it would
> > > have
> > > to properly decode any xforms POST into key/value lists as appropriate
> > > and
> > > populate the FieldStorage data structure. That is if that makes sense
> as
> > > I
> > > haven't looked at what is in an xforms POST and whether it is equivalent
> > > to normal form POST but just a different format.
> > >
> > > Graham
> > >
> > > > 2007/1/12, Graham Dumpleton < grahamd@dscpl.com.au>:
> > > > >
> > > > > If you are using mod_python 3.2.10 or earlier, try 3.3.0b as it
> has
> > > some
> > > > > fixesto FieldStorage class. Can be downloaded from:
> > > > >
> > > > >   http://httpd.apache.org/modules/python-download.cgi
> > > > >
> > > > > I suspect though that it still will not work though, as code is:
> > > > >
> > > > >         # figure out boundary
> > > > >         try:
> > > > >             i = ctype.lower().rindex("boundary=")
> > > > >             boundary = ctype[i+9:]
> > > > >             if len(boundary) >= 2 and boundary[0] == boundary[-1]
> ==
> > >
> > > > '"':
> > > > >                 boundary = boundary[1:-1]
> > > > >             boundary = re.compile("--" + re.escape(boundary) +
> > > > > "(--)?\r?\n")
> > > > >
> > > > > Ie., it assumes that boundary is last field on content type line
> > > which
> > > > is
> > > > > a
> > > > > bad assumption.
> > > > >
> > > > > Graham
> > > > >
> > > > > On 13/01/2007, at 8:41 AM, Emiliano Moscato wrote:
> > > > >
> > > > > Hi all!
> > > > >
> > > > > Thanks for your answers.
> > > > > I've been looking the code of FieldStorage and publisher. I think
> it
> > > > is
> > > > > not soo dificult to patch FieldStorage, but: Is anybody else
> > > interested
> > > > in
> > > > > patch FieldStorage? If so I'll try it on monday.
> > > > >
> > > > > On the other hand, I've trying to use another method to send my
> > > xforms
> > > > > which uses "multipart/related" as Content-type and I realized that
> > > mozilla
> > > > > xforms plugin sends a boundary that is bad handled by
> > > > > publisher-FieldStorage. This is what browser sends:
> > > > >
> > > > > [...]
> > > > > Content-Length: 522
> > > > > Content-Type: multipart/related;
> > > > > boundary=---------------------------13592280651221337293469391600;
> > > > > type="application/xml"; start="<4c599da9.58c746e8@mozilla.org >"
> > > > > Cookie: lang=1
> > > > >
> > > > > -----------------------------13592280651221337293469391600
> > > > > Content-Type: application/xml
> > > > > Content-ID: < 4c599da9.58c746e8@mozilla.org>
> > > > >
> > > > > <?xml version="1.0" encoding="UTF-8"?>
> > > > > <idioma xmlns:xf="http://www.w3.org/2002/xforms " xmlns:ev="
> > > http://www.w3.org/2001/xml-events"
> > > > > xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance " xmlns:xsd="
> > > http://www.w3.org/2001/XMLSchema
> > > > > ">
> > > > >
> > > > >       <H__interface>main</H__interface>
> > > > >       <idioma>adadsfasd</idioma>
> > > > >     </idioma>
> > > > > -----------------------------13592280651221337293469391600--
> > > > >
> > > > >
> > > > > But FieldStorage parse the content-type line up to the end trying
> to
> > > > get
> > > > > boundary, getting this as boundary:
> > > > > -----------------------------7393760691212604279930853199;
> > > > > type="application/xml"; start="< b8f2849.19571884@mozilla.org>
> > > > >
> > > > > Is this a firefox problem or a FieldStorage problem?
> > > > > Regards, enjoy the weekend :)
> > > > >
> > > > > Emiliano
> > > > >
> > > > >
> > > > > 2007/1/12, Jim Gallacher <jpg@jgassociates.ca>:
> > > > > >
> > > > > > Graham Dumpleton wrote:
> > > > > > > Jim Gallacher wrote ..
> > > > > > >> Emiliano Moscato wrote:
> > > > > > >>> Hi all!
> > > > > > >>>
> > > > > > >>> I'm getting crazy trying to receive xforms xml data with
> > > mod_python
> > > > > > +
> > > > > > >>> publisher handler.
> > > > > > >
> > > > > > > In what way are you using mod_python.publisher? Depending to
> > > what
> > > > > > > degree you are using it, mod_python 3.3 offers some alternate
> > > > > > mechanisms
> > > > > > > for doing basic dispatch against different resources which
> might
> > > > be
> > > > > > more
> > > > > > > useful and allow you to still access content of response to
> > > decode
> > > > it.
> > > > > > >
> > > > > > >>> In a normal HTML form, the data would be sent as
> > > > > > >>> application/x-www-form-urlencoded, in the XForms world
> > > however,
> > > > this
> > > > > >
> > > > > > >>> information is sent as XML formatted data (application/xml).
> > > > > > >>> Up to now I've used cherryPy as web server and I've got my
> xml
> > > > data
> > > > > > with
> > > > > > >>> cherrypy.threadData.xform.
> > > > > > >>> I've read that PHP receive this in $HTTP_RAW_POST_DATA
> > > variable.
> > > > If
> > > > > > I
> > > > > > >> send
> > > > > > >>> the form to a php script all work fine.
> > > > > > >>> But when I try to submit a xforms with method POST to a script
> > > > > > managed
> > > > > > >> by
> > > > > > >>> publisher handler I get an error with no log in my apache
> > > server
> > > > > > error
> > > > > > >> log.
> > > > > > >>> Any help?
> > > > > > >> You'll need to elaborate on the error you are getting, but
> I
> > > think
> > > > > > part
> > > > > > >> of the problem is that you are bumping up against part of
> the
> > > > > > internal
> > > > > > >> "magic" of publisher.
> > > > > > >>
> > > > > > >> Publisher automatically creates a FieldStorage instance.
> > > > > > Unfortunately
> > > > > > >> FieldStorage assumes that the content-type starts with either
> > > > > > >> "application/x-www-form-urlencoded" or "multipart/". If I
> had
> > > to
> > > > > > guess
> > > > > > >> I'd say that you are getting "501 Not Implemented error" as
> a
> > > result.
> > > > > >
> > > > > > >>
> > > > > > >> Here are a couple of solutions that you might consider as
> a
> > > > > > workaround:
> > > > > > >>
> > > > > > >> 1. Hack util.FieldStorage to properly handle your content-type.
> > > > If
> > > > > > you
> > > > > > >> do this feel free to submit a patch so FieldStorage can be
> > > fixed.
> > > > ;)
> > > > > > >
> > > > > > > Hmmm, xforms is quite different.
> > > > > > >
> > > > > > >   http://www.w3.org/TR/xforms/
> > > > > > >
> > > > > > > Looks like a lot of work.
> > > > > >
> > > > > > Probably. I certainly wasn't offering to do it. ;)
> > > > > >
> > > > > > >> 2. Hack publisher to skip the automatic creation of
> > > FieldStorage.
> > > > > > (Line
> > > > > > >> 424 in publisher.py for mod_python 3.3.0b). You can then use
> > > req.read
> > > > > > ()
> > > > > > >> to read and process the POST'd data within your content
> > > handler.
> > > > > > >
> > > > > > > I've raised this issue before about publisher not being able
> to
> > > accept
> > > > > > other
> > > > > > > content types. See:
> > > > > > >
> > > > > > >   http://issues.apache.org/jira/browse/MODPYTHON-29
> > > > > > >
> > > > > > > Also, like PSP now does, publisher could be made to use '
> > > req.form'
> > > > if
> > > > > > it
> > > > > > > already existed. This would allow a stacked response handler
> > > before
> > > > > > > publisher to decide whether some other form content was
> > > supplied,
> > > > > > decode
> > > > > > > it and set req.form to a compatible class to FieldStorage.
> I
> > > don't
> > > > > > know that I
> > > > > > > have created an issue for that idea before, but have certainly
> > > thought
> > > > > > > about it and perhaps mentioned it on the mailing list.
> > > > > >
> > > > > > That seems like a reasonable solution.
> > > > > >
> > > > > > >> 3. Use a PythonFixupHandler before the content handler. In
> the
> > > > > > >> fixuphandler use req.read() to grab the raw data and adjust
> the
> > > > > > >> content-type header so that FieldStorage doesn't bomb out.
> Note
> > > > that
> > > > > > if
> > > > > > >> you want to pass xml field data as parameters to your handler
> > > method
> > > > > > >> you'll need to do a bit more work. For example
> > > > > > >>
> > > > > > >> def index(foo="bar"):
> > > > > > >>      return "whatever"
> > > > > > >>
> > > > > > >> won't get foo from your xml data. You can likely work around
> > > this
> > > > but
> > > > > > >> you'll need to take a look at the source for FieldStorage
> and
> > > > > > publisher
> > > > > > >> to work out a strategy.
> > > > > > >
> > > > > > > If you are talking about modifying the input stream, an input
> > > filter
> > > > > > would
> > > > > > > perhaps be better. Not sure that that will help since xforms
> is
> > > quite
> > > > > > > different and isn't just a matter of changing content type.
> > > > > >
> > > > > > No, I was just thinking you could get the raw data with req.read()
> > > > > > (parsing the xml or whatever) and then set the content-type to
> > > > > > application/x-www-form-urlencoded. That way the subsequent call
> to
> > > > > > FieldStorage within publisher won't bomb out. The code would
> look
> > > > > > something like this:
> > > > > >
> > > > > > def fixuphandler(req):
> > > > > >      if req.headers_in.has_key("content-type"):
> > > > > >          ctype = req.headers_in ["content-type"]
> > > > > >          if ctype.startswith("application/xml"):
> > > > > >              req.data = parse_the_xml_data_or_whatever(req.read())
> > > > > >              req.headers_in ["content-type"] =
> > > > > >                       "application/x-www-form-urlencoded"
> > > > > >      return apache.OK
> > > > > >
> > > > > > A little too hackish perhaps? (Assuming it would even work).
> > > > > >
> > > > > > Jim
> > > > > > _______________________________________________
> > > > > > Mod_python mailing list
> > > > > > Mod_python@modpython.org
> > > > > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > > > > >
> > > > >
> > > > >
> > > > >
> > > > > --
> > > > > mOsKi
> > > > > "No hay nada que uno haga mal , lo que hay es poco vino." Autor
> > > Anonimo
> > > > > _______________________________________________
> > > > > Mod_python mailing list
> > > > > Mod_python@modpython.org
> > > > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > > > >
> > > > >
> > > > >
> > > >
> > > >
> > > > --
> > > > mOsKi
> > > > "No hay nada que uno haga mal , lo que hay es poco vino." Autor
> > > Anonimo
> > >
> >
> >
> >
> > --
> > mOsKi
> > "No hay nada que uno haga mal , lo que hay es poco vino." Autor Anonimo
> >
> 
> 
> 
> -- 
> mOsKi
> "No hay nada que uno haga mal , lo que hay es poco vino." Autor Anonimo
From grahamd at dscpl.com.au  Wed Jan 17 15:53:00 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Jan 17 15:53:06 2007
Subject: [mod_python] Problems with ZODB / modpython
Message-ID: <1169067180.21199@dscpl.user.openhosting.com>

Thiago Comicio wrote ..
> Hi,
> 
> I'm trying to install a program that needs mod_python and ZODB. The
> program is not running, so I tried to connect to the database through
> this script:
> 
> from ZODB import FileStorage, DB
> 
> def index(req, **params):
>         storage = FileStorage.FileStorage('mydatabase.fs')
>         db = DB(storage)
>         connection = db.open()
>         root = connection.root()
>         return TestPage().getHTML()
> 
> And I received the error below.
> Does anybody know how to fix it?

A couple of things to be aware of.

1. The Apache web server generally runs as a special user and thus that user
must have write access to the directory where you are wanting to create the
database.

2. The current working directory is normally '/' for the Apache processes and
thus if you do not specify an absolute path to where you want to store the
database, it will try and store it in '/' where you are unlikely to have permissions
to write. You should not change the working directory as if every handler did
that they would all interfere with each other.

Graham
 
> Thanks
> 
> Thiago
> 
> ---------------------------
> 
> Mod_python error: "PythonHandler mod_python.publisher"
> 
> Traceback (most recent call last):
> 
>   File "/usr/lib/python2.4/site-packages/mod_python/apache.py", line
> 299, in HandlerDispatch
>     result = object(req)
> 
>   File "/usr/lib/python2.4/site-packages/mod_python/publisher.py",
> line 213, in handler
>     published = publish_object(req, object)
> 
>   File "/usr/lib/python2.4/site-packages/mod_python/publisher.py",
> line 412, in publish_object
>     return publish_object(req,util.apply_fs_data(object, req.form, req=req))
> 
>   File "/usr/lib/python2.4/site-packages/mod_python/util.py", line
> 439, in apply_fs_data
>     return object(**args)
> 
>   File "/var/www/html/indico/teste.py", line 4, in index
>     storage = FileStorage.FileStorage('mydatabase.fs')
> 
>   File "/usr/lib/zope/lib/python/ZODB/FileStorage/FileStorage.py",
> line 112, in __init__
>     self._lock_file = LockFile(file_name + '.lock')
> 
>   File "/usr/lib/zope/lib/python/ZODB/lock_file.py", line 60, in __init__
>     self._fp = open(path, 'w+')
> 
> IOError: [Errno 13] Permission denied: 'mydatabase.fs.lock'
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
From bgailer at alum.rpi.edu  Wed Jan 17 23:31:33 2007
From: bgailer at alum.rpi.edu (Bob Gailer)
Date: Wed Jan 17 23:31:43 2007
Subject: [mod_python] sending post data using xmlhttprequest
In-Reply-To: <1168992541.15097@dscpl.user.openhosting.com>
References: <1168992541.15097@dscpl.user.openhosting.com>
Message-ID: <45AEF825.5070705@alum.rpi.edu>

An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070117/088f3f6a/attachment.html
From thiagocomicio at gmail.com  Thu Jan 18 06:20:21 2007
From: thiagocomicio at gmail.com (Thiago Comicio)
Date: Thu Jan 18 06:20:28 2007
Subject: [mod_python] Problems with ZODB / modpython
In-Reply-To: <1169067180.21199@dscpl.user.openhosting.com>
References: <1169067180.21199@dscpl.user.openhosting.com>
Message-ID: <c1e7137e0701180320m7ab6dc51r27e87108b596f3eb@mail.gmail.com>

On 1/17/07, Graham Dumpleton <grahamd@dscpl.com.au> wrote:
> Thiago Comicio wrote ..
> > Hi,
> >
> > I'm trying to install a program that needs mod_python and ZODB. The
> > program is not running, so I tried to connect to the database through
> > this script:
> >
> > from ZODB import FileStorage, DB
> >
> > def index(req, **params):
> >         storage = FileStorage.FileStorage('mydatabase.fs')
> >         db = DB(storage)
> >         connection = db.open()
> >         root = connection.root()
> >         return TestPage().getHTML()
> >
> > And I received the error below.
> > Does anybody know how to fix it?
>
> A couple of things to be aware of.
>
> 1. The Apache web server generally runs as a special user and thus that user
> must have write access to the directory where you are wanting to create the
> database.
>
> 2. The current working directory is normally '/' for the Apache processes and
> thus if you do not specify an absolute path to where you want to store the
> database, it will try and store it in '/' where you are unlikely to have permissions
> to write. You should not change the working directory as if every handler did
> that they would all interfere with each other.
>
> Graham


Thanks Graham, this solved my initial problem, now I have another.

I created a simple script to run when I boot my system.

#main part of the script
PYTHONPATH=/usr/lib/zope/lib/python

zope=$PYTHONPATH/ZEO/runzeo.py
python=/usr/bin/python
zopeconf=$PYTHONPATH/ZEO/zeo.config

start() {
        echo -n $"Starting $prog1: "
        $python $zope -C $zopeconf &
}

I put a symbolic link at /etc/rc5.d with the name S50myscript and a
symbolink link to http like S85http.
When I try to access a page that needs ZEO I receive the error below,
that disappears when I restart apache.
How can I fix this new problem?

Thanks,

Thiago

----------------------------------------

Mod_python error: "PythonHandler mod_python.publisher"

Traceback (most recent call last):

  File "/usr/lib/python2.4/site-packages/mod_python/apache.py", line
299, in HandlerDispatch
    result = object(req)

  File "/usr/lib/python2.4/site-packages/mod_python/publisher.py",
line 204, in handler
    module = page_cache[req]

  File "/usr/lib/python2.4/site-packages/mod_python/cache.py", line
82, in __getitem__
    return self._checkitem(name)[2]

  File "/usr/lib/python2.4/site-packages/mod_python/cache.py", line
124, in _checkitem
    value = self.build(key, name, opened, entry)

  File "/usr/lib/python2.4/site-packages/mod_python/publisher.py",
line 77, in build
    return ModuleCache.build(self, key, req, opened, entry)

  File "/usr/lib/python2.4/site-packages/mod_python/cache.py", line
371, in build
    exec opened in module.__dict__

  File "/var/www/html/indico/index.py", line 1, in ?
    import MaKaC.webinterface.rh.welcome as welcome

  File "/usr/lib/python2.4/site-packages/MaKaC/webinterface/rh/welcome.py",
line 1, in ?
    import MaKaC.webinterface.rh.base as base

  File "/usr/lib/python2.4/site-packages/MaKaC/webinterface/rh/base.py",
line 13, in ?
    from ZODB.POSException import ConflictError

ImportError: No module named ZODB.POSException
From export at hope.cz  Thu Jan 18 15:32:11 2007
From: export at hope.cz (export@hope.cz)
Date: Thu Jan 18 15:32:41 2007
Subject: [mod_python] Request object 
Message-ID: <45AFE75B.11384.31DEB45@export.hope.cz>

Is there a description of request object in details?
As I browse through some examples I find  that authors uses various request 
methods/objects.

For example
req.main
req.headers_in.get
req.headers_in
req.headers_out
req.streambuffer

and more
Thank you for reply.
Lad.


From ccbean at gmail.com  Thu Jan 18 15:50:59 2007
From: ccbean at gmail.com (Colin Bean)
Date: Thu Jan 18 15:51:03 2007
Subject: [mod_python] Request object
In-Reply-To: <45AFE75B.11384.31DEB45@export.hope.cz>
References: <45AFE75B.11384.31DEB45@export.hope.cz>
Message-ID: <29a6ca010701181250l306d12cfme2df1cf558c0a389@mail.gmail.com>

There's a section on the request object in the "apache" section of the
documentation on modpython.org

http://modpython.org/live/current/doc-html/pyapi-mprequest.html

Or were you looking for something more?

Colin

On 1/18/07, export@hope.cz <export@hope.cz> wrote:
> Is there a description of request object in details?
> As I browse through some examples I find  that authors uses various request
> methods/objects.
>
> For example
> req.main
> req.headers_in.get
> req.headers_in
> req.headers_out
> req.streambuffer
>
> and more
> Thank you for reply.
> Lad.
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From grahamd at dscpl.com.au  Thu Jan 18 15:55:00 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Jan 18 15:55:08 2007
Subject: [mod_python] Request object 
Message-ID: <1169153700.19897@dscpl.user.openhosting.com>

export@hope.cz wrote ..
> Is there a description of request object in details?
> As I browse through some examples I find  that authors uses various request
> methods/objects.
> 
> For example
> req.main
> req.headers_in.get
> req.headers_in
> req.headers_out

Yes, in the documentation on the mod_python web site. See:

  http://www.modpython.org/live/current/doc-html/pyapi-mprequest.html

These attributes aren't specific to mod_python though and are just the same
attribute as exists within the underlying Apache request_rec attribute. Thus
you can also find out more information about them from any material which
talks about programming with Apache. Note though that since mod_python
provides a wrapper around them, how you may use them may be slightly
different. For example, 'headers_in' is made more dictionary like.

Other sources of information are:

  http://162.105.203.19/apache-doc/128.htm#BIN267

> req.streambuffer

This one is not a mod_python attribute but was being added by the filter.
Ie., in order to transfer information between distinct invocations of the
filter, or even different handler phases, it is possible for user code to add
additional attributes to the request object.

Graham
From grahamd at dscpl.com.au  Thu Jan 18 15:58:32 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Jan 18 15:58:38 2007
Subject: [mod_python] Problems with ZODB / modpython
Message-ID: <1169153912.21600@dscpl.user.openhosting.com>

What version of mod_python are you using, is it an older version? At
least upgrade to mod_python 3.2.10 if you haven't already. There are
certainly bugs in mod_python 3.1.X which may cause this. Also, what
Apache configuration do you use for enabling mod_python for that
part of the URL namespace? Do you use PythonPath or PythonImport
directives?

Graham

Thiago Comicio wrote ..
> On 1/17/07, Graham Dumpleton <grahamd@dscpl.com.au> wrote:
> > Thiago Comicio wrote ..
> > > Hi,
> > >
> > > I'm trying to install a program that needs mod_python and ZODB. The
> > > program is not running, so I tried to connect to the database through
> > > this script:
> > >
> > > from ZODB import FileStorage, DB
> > >
> > > def index(req, **params):
> > >         storage = FileStorage.FileStorage('mydatabase.fs')
> > >         db = DB(storage)
> > >         connection = db.open()
> > >         root = connection.root()
> > >         return TestPage().getHTML()
> > >
> > > And I received the error below.
> > > Does anybody know how to fix it?
> >
> > A couple of things to be aware of.
> >
> > 1. The Apache web server generally runs as a special user and thus that
> user
> > must have write access to the directory where you are wanting to create
> the
> > database.
> >
> > 2. The current working directory is normally '/' for the Apache processes
> and
> > thus if you do not specify an absolute path to where you want to store
> the
> > database, it will try and store it in '/' where you are unlikely to have
> permissions
> > to write. You should not change the working directory as if every handler
> did
> > that they would all interfere with each other.
> >
> > Graham
> 
> 
> Thanks Graham, this solved my initial problem, now I have another.
> 
> I created a simple script to run when I boot my system.
> 
> #main part of the script
> PYTHONPATH=/usr/lib/zope/lib/python
> 
> zope=$PYTHONPATH/ZEO/runzeo.py
> python=/usr/bin/python
> zopeconf=$PYTHONPATH/ZEO/zeo.config
> 
> start() {
>         echo -n $"Starting $prog1: "
>         $python $zope -C $zopeconf &
> }
> 
> I put a symbolic link at /etc/rc5.d with the name S50myscript and a
> symbolink link to http like S85http.
> When I try to access a page that needs ZEO I receive the error below,
> that disappears when I restart apache.
> How can I fix this new problem?
> 
> Thanks,
> 
> Thiago
> 
> ----------------------------------------
> 
> Mod_python error: "PythonHandler mod_python.publisher"
> 
> Traceback (most recent call last):
> 
>   File "/usr/lib/python2.4/site-packages/mod_python/apache.py", line
> 299, in HandlerDispatch
>     result = object(req)
> 
>   File "/usr/lib/python2.4/site-packages/mod_python/publisher.py",
> line 204, in handler
>     module = page_cache[req]
> 
>   File "/usr/lib/python2.4/site-packages/mod_python/cache.py", line
> 82, in __getitem__
>     return self._checkitem(name)[2]
> 
>   File "/usr/lib/python2.4/site-packages/mod_python/cache.py", line
> 124, in _checkitem
>     value = self.build(key, name, opened, entry)
> 
>   File "/usr/lib/python2.4/site-packages/mod_python/publisher.py",
> line 77, in build
>     return ModuleCache.build(self, key, req, opened, entry)
> 
>   File "/usr/lib/python2.4/site-packages/mod_python/cache.py", line
> 371, in build
>     exec opened in module.__dict__
> 
>   File "/var/www/html/indico/index.py", line 1, in ?
>     import MaKaC.webinterface.rh.welcome as welcome
> 
>   File "/usr/lib/python2.4/site-packages/MaKaC/webinterface/rh/welcome.py",
> line 1, in ?
>     import MaKaC.webinterface.rh.base as base
> 
>   File "/usr/lib/python2.4/site-packages/MaKaC/webinterface/rh/base.py",
> line 13, in ?
>     from ZODB.POSException import ConflictError
> 
> ImportError: No module named ZODB.POSException
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
From bgailer at alum.rpi.edu  Thu Jan 18 16:55:37 2007
From: bgailer at alum.rpi.edu (Bob Gailer)
Date: Thu Jan 18 16:55:43 2007
Subject: [mod_python] session management
Message-ID: <45AFECD9.9070004@alum.rpi.edu>

I just read the session management topic in the mod_python manual. I 
wish I understood it and knew how to apply it. Alas I do not.

Is there any documentation or discussion or complete example that might 
help me?  Should I be looking at Apache documentation?

In addition there are a number of terms I do't know: APR global_mutex, 
MPM, ...?

-- 
Bob Gailer
510-978-4454

From grahamd at dscpl.com.au  Thu Jan 18 17:11:34 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Jan 18 17:11:43 2007
Subject: [mod_python] session management
Message-ID: <1169158293.23182@dscpl.user.openhosting.com>

Bob Gailer wrote ..
> I just read the session management topic in the mod_python manual. I 
> wish I understood it and knew how to apply it. Alas I do not.
> 
> Is there any documentation or discussion or complete example that might
> help me? 

What version of mod_python are you using?

There are examples in the mailing list archives, which can be searched from
search box on mod_python web site.

> Should I be looking at Apache documentation?

Not really, mostly internal to mod_python unless you have mod_python 3.3.0b
where session management can be better integrated with Apache authentication
handler phase.

> In addition there are a number of terms I do't know: APR global_mutex,
> MPM, ...?

You don't need to know about global mutex, it is just an implementation
artefact. An MPM is the Apache process/threading model used. See:

  http://www.dscpl.com.au/wiki/ModPython/Articles/TheProcessInterpreterModel

The MPMs you will most like encounter are 'prefork', 'worker' and 'winnt'.

Graham
From grahamd at dscpl.com.au  Fri Jan 19 16:45:17 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Fri Jan 19 16:45:33 2007
Subject: [mod_python] Problems with ZODB / modpython
In-Reply-To: <c1e7137e0701190255w4feee310t772b0c13e48500ad@mail.gmail.com>
References: <1169153912.21600@dscpl.user.openhosting.com>
	<c1e7137e0701190255w4feee310t772b0c13e48500ad@mail.gmail.com>
Message-ID: <92C61961-2618-467A-B549-7BF06D34AD6B@dscpl.com.au>

Followups to the mailing list please.

On 19/01/2007, at 9:55 PM, Thiago Comicio wrote:

> On 1/18/07, Graham Dumpleton <grahamd@dscpl.com.au> wrote:
>> What version of mod_python are you using, is it an older version? At
>> least upgrade to mod_python 3.2.10 if you haven't already. There are
>> certainly bugs in mod_python 3.1.X which may cause this.
>
> I'm using the version 3.2.8-3.1 fo Fedora 6. I've tried to run this
> boot script with mod_python 3.2.10 without success.
>
>> Also, what
>> Apache configuration do you use for enabling mod_python for that
>> part of the URL namespace? Do you use PythonPath or PythonImport
>> directives?
>
> I didn't understand very well your question, but the PYTHONPATH is
> used to run ZODB, which is part of ZOPE (zope-2.9.6-1.fc6).
> My Apache configuration to access the directory with the python  
> scripts is:
>
> <Directory /var/www/html/indico>
>        AddHandler python-program .py
>        PythonHandler mod_python.publisher
>        PythonDebug On
> </Directory>

The PYTHONPATH setting if required has to be duplicated with equivalent
in mod_python. Ie., add:

   PythonPath "sys.path+['/usr/lib/zope/lib/python']"

Read the documentation for information about the PythonPath directive.

> When I boot the computer it doesn't work, but when I restart Apache,
> without changing any configuration, it works.

It works when you do a restart as it is probably inheriting PYTHONPATH
from your user account. The Apache startup script will not have this on
a reboot, so you need to set it up in Apache configuration file.

> I made some tests.
> When I initialize ZODB at the startup and start Apache after logging
> in, it works. Or, after logging in, I initialize ZODB and Apache, it
> works too. The problem is when I initialize both at the startup, first
> ZODB and then Apache.
>
> Thanks,
>
> Thiago Comicio
>
>>
>> Graham
>>
>> Thiago Comicio wrote ..
>> > On 1/17/07, Graham Dumpleton <grahamd@dscpl.com.au> wrote:
>> > > Thiago Comicio wrote ..
>> > > > Hi,
>> > > >
>> > > > I'm trying to install a program that needs mod_python and  
>> ZODB. The
>> > > > program is not running, so I tried to connect to the  
>> database through
>> > > > this script:
>> > > >
>> > > > from ZODB import FileStorage, DB
>> > > >
>> > > > def index(req, **params):
>> > > >         storage = FileStorage.FileStorage('mydatabase.fs')
>> > > >         db = DB(storage)
>> > > >         connection = db.open()
>> > > >         root = connection.root()
>> > > >         return TestPage().getHTML()
>> > > >
>> > > > And I received the error below.
>> > > > Does anybody know how to fix it?
>> > >
>> > > A couple of things to be aware of.
>> > >
>> > > 1. The Apache web server generally runs as a special user and  
>> thus that
>> > user
>> > > must have write access to the directory where you are wanting  
>> to create
>> > the
>> > > database.
>> > >
>> > > 2. The current working directory is normally '/' for the  
>> Apache processes
>> > and
>> > > thus if you do not specify an absolute path to where you want  
>> to store
>> > the
>> > > database, it will try and store it in '/' where you are  
>> unlikely to have
>> > permissions
>> > > to write. You should not change the working directory as if  
>> every handler
>> > did
>> > > that they would all interfere with each other.
>> > >
>> > > Graham
>> >
>> >
>> > Thanks Graham, this solved my initial problem, now I have another.
>> >
>> > I created a simple script to run when I boot my system.
>> >
>> > #main part of the script
>> > PYTHONPATH=/usr/lib/zope/lib/python
>> >
>> > zope=$PYTHONPATH/ZEO/runzeo.py
>> > python=/usr/bin/python
>> > zopeconf=$PYTHONPATH/ZEO/zeo.config
>> >
>> > start() {
>> >         echo -n $"Starting $prog1: "
>> >         $python $zope -C $zopeconf &
>> > }
>> >
>> > I put a symbolic link at /etc/rc5.d with the name S50myscript and a
>> > symbolink link to http like S85http.
>> > When I try to access a page that needs ZEO I receive the error  
>> below,
>> > that disappears when I restart apache.
>> > How can I fix this new problem?
>> >
>> > Thanks,
>> >
>> > Thiago
>> >
>> > ----------------------------------------
>> >
>> > Mod_python error: "PythonHandler mod_python.publisher"
>> >
>> > Traceback (most recent call last):
>> >
>> >   File "/usr/lib/python2.4/site-packages/mod_python/apache.py",  
>> line
>> > 299, in HandlerDispatch
>> >     result = object(req)
>> >
>> >   File "/usr/lib/python2.4/site-packages/mod_python/publisher.py",
>> > line 204, in handler
>> >     module = page_cache[req]
>> >
>> >   File "/usr/lib/python2.4/site-packages/mod_python/cache.py", line
>> > 82, in __getitem__
>> >     return self._checkitem(name)[2]
>> >
>> >   File "/usr/lib/python2.4/site-packages/mod_python/cache.py", line
>> > 124, in _checkitem
>> >     value = self.build(key, name, opened, entry)
>> >
>> >   File "/usr/lib/python2.4/site-packages/mod_python/publisher.py",
>> > line 77, in build
>> >     return ModuleCache.build(self, key, req, opened, entry)
>> >
>> >   File "/usr/lib/python2.4/site-packages/mod_python/cache.py", line
>> > 371, in build
>> >     exec opened in module.__dict__
>> >
>> >   File "/var/www/html/indico/index.py", line 1, in ?
>> >     import MaKaC.webinterface.rh.welcome as welcome
>> >
>> >   File "/usr/lib/python2.4/site-packages/MaKaC/webinterface/rh/ 
>> welcome.py",
>> > line 1, in ?
>> >     import MaKaC.webinterface.rh.base as base
>> >
>> >   File "/usr/lib/python2.4/site-packages/MaKaC/webinterface/rh/ 
>> base.py",
>> > line 13, in ?
>> >     from ZODB.POSException import ConflictError
>> >
>> > ImportError: No module named ZODB.POSException
>> > _______________________________________________
>> > Mod_python mailing list
>> > Mod_python@modpython.org
>> > http://mailman.modpython.org/mailman/listinfo/mod_python
>>
From export at hope.cz  Sat Jan 20 05:41:35 2007
From: export at hope.cz (export@hope.cz)
Date: Sat Jan 20 05:41:58 2007
Subject: [mod_python] How to find a filename
Message-ID: <45B1FFEF.93.B4DEDF2@export.hope.cz>

An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070120/63de8e57/attachment.html
From trevor at thennion.demon.co.uk  Sat Jan 20 06:42:47 2007
From: trevor at thennion.demon.co.uk (Trevor Hennion)
Date: Sat Jan 20 06:42:46 2007
Subject: [mod_python] How to find a filename
Message-ID: <45B20037.6040904@thennion.demon.co.uk>

Hi,

You need a value="" in your <input..> element.

Regards

Trevor Hennion

http://www.infocentrality.co.uk
From clodoaldo.pinto.neto at gmail.com  Sat Jan 20 07:14:59 2007
From: clodoaldo.pinto.neto at gmail.com (Clodoaldo)
Date: Sat Jan 20 07:15:08 2007
Subject: [mod_python] How to find a filename
In-Reply-To: <45B1FFEF.93.B4DEDF2@export.hope.cz>
References: <45B1FFEF.93.B4DEDF2@export.hope.cz>
Message-ID: <a595de7a0701200414u252ac9dbnf08ae9ecf459899a@mail.gmail.com>

2007/1/20, export@hope.cz <export@hope.cz>:
>
>
> I have a form through which users upload a file.
>
>
> <form method="post" action="test/mptest.py" enctype="multipart/form-data">
>   <p><input type="file" name="Picture"> </p>
> </form>
> </body>
>
>
> Is it possible to find out the name of a file the user is being uploaded?
> I could not find it .I tried req.headers_in but I failed.

I think this works:

fileitem = req.form.get('Picture', None)
if fileitem:
    picture_name = fileitem.filename

Regards,
-- 
Clodoaldo Pinto Neto
From export at hope.cz  Sat Jan 20 07:40:27 2007
From: export at hope.cz (export@hope.cz)
Date: Sat Jan 20 07:40:48 2007
Subject: [mod_python] How to find a filename
In-Reply-To: <a595de7a0701200414u252ac9dbnf08ae9ecf459899a@mail.gmail.com>
References: <45B1FFEF.93.B4DEDF2@export.hope.cz>
Message-ID: <45B21BCB.19460.BBAC0B6@export.hope.cz>

Thank you for your reply but it does NOT work.
When I tried it I received an error:

AttributeError: 'mp_request' object has no attribute 'form' 

Is there  another way?
Thank you for help
Lad.



> 
> I think this works:
> 
> fileitem = req.form.get('Picture', None)
> if fileitem:
>     picture_name = fileitem.filename
> 
> Regards,
> -- 
> Clodoaldo Pinto Neto


From list at joreybump.com  Sat Jan 20 07:43:00 2007
From: list at joreybump.com (Jorey Bump)
Date: Sat Jan 20 07:43:07 2007
Subject: [mod_python] How to find a filename
In-Reply-To: <45B1FFEF.93.B4DEDF2@export.hope.cz>
References: <45B1FFEF.93.B4DEDF2@export.hope.cz>
Message-ID: <45B20E54.10304@joreybump.com>

export@hope.cz wrote:
> I have a form through which users upload a file.
> 
> <form method="post" action="test/mptest.py" enctype="multipart/form-data">
>   <p><input type="file" name="Picture"> </p>
> </form>
> </body>
> 
> Is it possible to find out the name of a file the user is being uploaded?

If you are using Publisher, it will be available as:

  req.form['Picture'].filename

From export at hope.cz  Sat Jan 20 08:20:39 2007
From: export at hope.cz (export@hope.cz)
Date: Sat Jan 20 08:21:16 2007
Subject: [mod_python] How to find a filename
In-Reply-To: <45B20E54.10304@joreybump.com>
References: <45B1FFEF.93.B4DEDF2@export.hope.cz>
Message-ID: <45B22537.15344.BDF8E09@export.hope.cz>

Thank you for your reply but I do not use publisher.
Is there any other way?
Thank you for help
Lad


> export@hope.cz wrote:
> > I have a form through which users upload a file.
> > 
> > <form method="post" action="test/mptest.py" enctype="multipart/form-data">
> >   <p><input type="file" name="Picture"> </p>
> > </form>
> > </body>
> > 
> > Is it possible to find out the name of a file the user is being uploaded?
> 
> If you are using Publisher, it will be available as:
> 
>   req.form['Picture'].filename
> 


From jpg at jgassociates.ca  Sat Jan 20 10:14:05 2007
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Sat Jan 20 10:14:11 2007
Subject: [mod_python] How to find a filename
In-Reply-To: <45B22537.15344.BDF8E09@export.hope.cz>
References: <45B1FFEF.93.B4DEDF2@export.hope.cz>
	<45B22537.15344.BDF8E09@export.hope.cz>
Message-ID: <45B231BD.60203@jgassociates.ca>

If you are not using publisher or the psp handler you'll need to create 
a FieldStorage instance explicitly.

from mod_python import util

def handler(req):
     req.form = util.FieldStorage(req)
     ... and so on ...

Jim

export@hope.cz wrote:
> Thank you for your reply but I do not use publisher.
> Is there any other way?
> Thank you for help
> Lad
> 
> 
>> export@hope.cz wrote:
>>> I have a form through which users upload a file.
>>>
>>> <form method="post" action="test/mptest.py" enctype="multipart/form-data">
>>>   <p><input type="file" name="Picture"> </p>
>>> </form>
>>> </body>
>>>
>>> Is it possible to find out the name of a file the user is being uploaded?
>> If you are using Publisher, it will be available as:
>>
>>   req.form['Picture'].filename
>>
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 

From export at hope.cz  Sat Jan 20 10:31:02 2007
From: export at hope.cz (export@hope.cz)
Date: Sat Jan 20 10:31:25 2007
Subject: [mod_python] Question about mod_python configuration
Message-ID: <45B243C6.6635.C56EBC6@export.hope.cz>

I am able to use mod_python with this configuration

<Directory "C:/Program Files/Apache Software Foundation/Apache2.2/htdocs/test"> 
        AddHandler mod_python .py
       PythonHandler mptest 
      PythonDebug On 
  </Directory>
 
where server root is 
 "C:/Program Files/Apache Software Foundation/Apache2.2"


But now I would like to  move PythonHandler  ( here mptest) to a different place.
I need  the PythonHandler to  be in 

C:/MyDirectory/projects/mimproject/apps/mimi/ModPythonPom/views/mod

How must change the above configuration so that I can use mod_python?

Thank you for help
Lad.



From export at hope.cz  Sat Jan 20 10:36:17 2007
From: export at hope.cz (export@hope.cz)
Date: Sat Jan 20 10:36:38 2007
Subject: [mod_python] How to find a filename
In-Reply-To: <45B231BD.60203@jgassociates.ca>
References: <45B22537.15344.BDF8E09@export.hope.cz>
Message-ID: <45B24501.29845.C5BB9B2@export.hope.cz>

An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070120/2a61dffb/attachment-0001.html
From jpg at jgassociates.ca  Sat Jan 20 11:01:04 2007
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Sat Jan 20 11:00:48 2007
Subject: [mod_python] How to find a filename
In-Reply-To: <45B24501.29845.C5BB9B2@export.hope.cz>
References: <45B22537.15344.BDF8E09@export.hope.cz>
	<45B24501.29845.C5BB9B2@export.hope.cz>
Message-ID: <45B23CC0.7020400@jgassociates.ca>

export@hope.cz wrote:
> But how can I get the name of an uploaded file?
> I tried util.FieldStorage but I received the content of the file but not the 
> name of the file.

Jorey already gave you that answer.

filename = req.form['Picture'].filename

Jim


> Did I make a mistake somewhere?
> Lad.
> 
> 
> 
>>  If you are not using publisher or the psp handler you'll need to create
>>  a FieldStorage instance explicitly.
>>
>>  from mod_python import util
>>
>>  def handler(req):
>>      req.form = util.FieldStorage(req)
>>      ... and so on ...
>>
>>  Jim
>>
>>  export@hope.cz wrote:
>>  > Thank you for your reply but I do not use publisher.
>>  > Is there any other way?
>>  > Thank you for help
>>  > Lad
>>  >
>>  >
>>  >> export@hope.cz wrote:
>>  >>> I have a form through which users upload a file.
>>  >>>
>>  >>> <form method="post" action="test/mptest.py" enctype="multipart/form-data">
>>  >>>   <p><input type="file" name="Picture"> </p>
>>  >>> </form>
>>  >>> </body>
>>  >>>
>>  >>> Is it possible to find out the name of a file the user is being uploaded?
>>  >> If you are using Publisher, it will be available as:
>>  >>
>>  >>   req.form['Picture'].filename
>>  >>
>>  >
>>  >
>>  > _______________________________________________
>>  > Mod_python mailing list
>>  > Mod_python@modpython.org
>>  > http://mailman.modpython.org/mailman/listinfo/mod_python
>>  >
>>
> 
> 
> ------------------------------------------------------------------------
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From jpg at jgassociates.ca  Sat Jan 20 11:10:11 2007
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Sat Jan 20 11:09:53 2007
Subject: [mod_python] Question about mod_python configuration
In-Reply-To: <45B243C6.6635.C56EBC6@export.hope.cz>
References: <45B243C6.6635.C56EBC6@export.hope.cz>
Message-ID: <45B23EE3.2010305@jgassociates.ca>

export@hope.cz wrote:
> I am able to use mod_python with this configuration
> 
> <Directory "C:/Program Files/Apache Software Foundation/Apache2.2/htdocs/test"> 
>         AddHandler mod_python .py
>        PythonHandler mptest 
>       PythonDebug On 
>   </Directory>
>  
> where server root is 
>  "C:/Program Files/Apache Software Foundation/Apache2.2"
> 
> 
> But now I would like to  move PythonHandler  ( here mptest) to a different place.
> I need  the PythonHandler to  be in 
> 
> C:/MyDirectory/projects/mimproject/apps/mimi/ModPythonPom/views/mod
> 
> How must change the above configuration so that I can use mod_python?

The easiest way is to use the PythonPath directive to include your 
handler in the search path. See 
http://www.modpython.org/live/current/doc-html/dir-other-pp.html

So use something like:

<Directory "C:/Program Files/Apache Software 
Foundation/Apache2.2/htdocs/test">
   PythonPath "sys.path + 
['C:/MyDirectory/projects/mimproject/apps/mimi/ModPythonPom/views/mod']"
   AddHandler mod_python .py
   PythonHandler mptest
   PythonDebug On
</Directory>

Note that the PythonPath statement above should be on one line. There 
might be line wrapping issues with this message.

Jim
From export at hope.cz  Sat Jan 20 13:39:43 2007
From: export at hope.cz (export@hope.cz)
Date: Sat Jan 20 13:39:59 2007
Subject: [mod_python] Question about mod_python configuration
In-Reply-To: <45B23EE3.2010305@jgassociates.ca>
References: <45B243C6.6635.C56EBC6@export.hope.cz>
Message-ID: <45B26FFF.17101.D03AB59@export.hope.cz>

An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070120/3f89a829/attachment.html
From grahamd at dscpl.com.au  Sat Jan 20 18:03:01 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sat Jan 20 18:03:22 2007
Subject: [mod_python] Question about mod_python configuration
In-Reply-To: <45B26FFF.17101.D03AB59@export.hope.cz>
References: <45B243C6.6635.C56EBC6@export.hope.cz>
	<45B26FFF.17101.D03AB59@export.hope.cz>
Message-ID: <CA582A30-D7C2-49CB-90AC-5FDE6FFE788B@dscpl.com.au>


On 21/01/2007, at 5:39 AM, export@hope.cz wrote:

> Jim,
> Thank you for your reply.
>
> I  added the PythonPath, so that the configuration looks  like this
>
> <Directory "C:/Program Files/Apache Software Foundation/Apache2.2/ 
> htdocs/test">
>     PythonPath "sys.path +  ['C:/MyDirectory/projects/mimproject/ 
> apps/mimi/ModPythonPom/views/mod']"
>     AddHandler mod_python .py
>     PythonHandler mptest
>     PythonDebug On
> </Directory>
>
> but it still does not  work when I try to run mptest handler in mod  
> directory.
> Where can be a problem?

The problem is that you never quite give enough information for us to  
really
know what the issue may be and so we can only make wild guesses based
on past experience of what people do wrong.

Please do the following:

1. Give the exact location of where the mptest.py now is. Does the user
that Apache runs as have permission to search that location and read
the handler file?

2. Give the URL that you are now using and expect to match to that  
handler.
Are you still wanting to access it as '/test/....' or expecting it to  
be available
as something else?

3. Give what error message the browser is giving back or otherwise  
indicate
what sort of error you are getting that makes you believe it isn't  
working.

4. Look in the Apache error log and give whatever error messages appear
there which relates to the failed request.

If you can give this information our guesses may be better. :-)

Graham

> Thank you for help
> Lad
>
>
>
> > export@hope.cz wrote:
> > > I am able to use mod_python with this configuration
> > >
> > > <Directory "C:/Program Files/Apache Software Foundation/ 
> Apache2.2/htdocs/test">
> > >         AddHandler mod_python .py
> > >        PythonHandler mptest
> > >       PythonDebug On
> > >   </Directory>
> > >
> > > where server root is
> > >  "C:/Program Files/Apache Software Foundation/Apache2.2"
> > >
> > >
> > > But now I would like to  move PythonHandler  ( here mptest) to  
> a different place.
> > > I need  the PythonHandler to  be in
> > >
> > > C:/MyDirectory/projects/mimproject/apps/mimi/ModPythonPom/views/ 
> mod
> > >
> > > How must change the above configuration so that I can use  
> mod_python?
> >
> > The easiest way is to use the PythonPath directive to include your
> > handler in the search path. See
> > http://www.modpython.org/live/current/doc-html/dir-other-pp.html
> >
> > So use something like:
> >
> > <Directory "C:/Program Files/Apache Software
> > Foundation/Apache2.2/htdocs/test">
> >    PythonPath "sys.path +
> > ['C:/MyDirectory/projects/mimproject/apps/mimi/ModPythonPom/views/ 
> mod']"
> >    AddHandler mod_python .py
> >    PythonHandler mptest
> >    PythonDebug On
> > </Directory>
> >
> > Note that the PythonPath statement above should be on one line.  
> There
> > might be line wrapping issues with this message.
> >
> > Jim
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070121/3cca6495/attachment.html
From sandipm at talentica.com  Sat Jan 20 22:51:10 2007
From: sandipm at talentica.com (sandipm@talentica.com)
Date: Sat Jan 20 22:51:16 2007
Subject: [mod_python] How to find a filename
Message-ID: <29576.1169351470@talentica.com>

An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070120/f4900007/attachment-0001.html
From grahamd at dscpl.com.au  Sat Jan 20 23:17:21 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sat Jan 20 23:17:34 2007
Subject: [mod_python] How to find a filename
In-Reply-To: <29576.1169351470@talentica.com>
References: <29576.1169351470@talentica.com>
Message-ID: <7F62E33F-A8C0-4FA6-B8D6-B0B1FAF5455A@dscpl.com.au>


On 21/01/2007, at 2:51 PM, sandipm@talentica.com wrote:

> other way of doing this..dont use req.form at all...
>
> from mod_python import util
>
> frm = util.FieldStorage(req)
>  upfile = frm.getlist('UploadFile')[0] # name of field
>  filename = upfile.filename
>  filedata = upfile.value
>
>
> you can get all form fields using frm.getlist('fieldname')[0]
>
>
>
> Thanks
>
> Sandip
Your getting a bit confused.

Where req.form comes into it is that it is the prevailing convention  
that if anything
ever creates an instance of util.FieldStorage, that it store it as  
req.form. It should
only create the instance of util.FieldStorage though if req.form  
doesn't already exist.

Thus the code for a handler becomes:

   if not hasattr(req, 'form'):
     req.form = util.FieldStorage(req)

   upfile = req.form.getfirst('UploadFile')
   if upfile:
     ...

This is what mod_python.publisher and mod_python.psp do in more  
recent versions.

Peoples comments about req.form were referring to that under the  
belief that the
person was using one of the handlers that leaves the form it creates  
as req.form.
The person was however using a basic handler where it isn't created  
and so they
would have to create it themselves. Following best practice, they  
should when
they create the form, store it as req.form as the code I give shows.  
Using this
convention you have a better chance of things working when  
integrating different
handler mechanisms together as you will inherit the form created by  
another
handler instead of creating it again and loosing your POST data.

BTW, one is best off using getfirst() instead of either subscript  
operator or getlist().
By using getfirst() in preference to getlist(), you do not have to  
then access the
first element as only one will be returned or None if it doesn't  
exist. If there is no
field, getlist() returns an empty list and access the first entry in  
the list will raise
an exception. It is also better than using subscript operator as it  
will raise an
exception if field doesn't exist also and if it does exist can return  
either a single
field object or a list of fields if there were duplicated entries.

Graham

> On Sat Jan 20 11:01 , Jim Gallacher sent:
>
>
> export@hope.cz wrote:
> > But how can I get the name of an uploaded file?
> > I tried util.FieldStorage but I received the content of the file  
> but not the
> > name of the file.
>
> Jorey already gave you that answer.
>
> filename = req.form['Picture'].filename
>
> Jim
>
>
> > Did I make a mistake somewhere?
> > Lad.
> >
> >
> >
> >> If you are not using publisher or the psp handler you'll need to  
> create
> >> a FieldStorage instance explicitly.
> >>
> >> from mod_python import util
> >>
> >> def handler(req):
> >> req.form = util.FieldStorage(req)
> >> ... and so on ...
> >>
> >> Jim
> >>
> >> export@hope.cz wrote:
> >> > Thank you for your reply but I do not use publisher.
> >> > Is there any other way?
> >> > Thank you for help
> >> > Lad
> >> >
> >> >
> >> >> export@hope.cz wrote:
> >> >>> I have a form through which users upload a file.
> >> >>>
> >> >>>
> >> >>>
>
>
>
> >> >>>
> >> >>>
> >> >>>
> >> >>> Is it possible to find out the name of a file the user is  
> being uploaded?
> >> >> If you are using Publisher, it will be available as:
> >> >>
> >> >> req.form['Picture'].filename
> >> >>
> >> >
> >> >
> >> > _______________________________________________
> >> > Mod_python mailing list
> >> > Mod_python@modpython.org
> >> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >> >
> >>
> >
> >
> >  
> ---------------------------------------------------------------------- 
> --
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070121/5207a30b/attachment.html
From jadacyrus at gmail.com  Sun Jan 21 20:11:33 2007
From: jadacyrus at gmail.com (alex)
Date: Sun Jan 21 20:11:51 2007
Subject: [mod_python] How to start a new "page" from within program?
Message-ID: <45B40F45.9000104@gmail.com>

Okay, im using the publisher handler and when my web forms do a POST 
action to functions in my index.py, it loads the information fresh, 
however when I call a function or series of functions from within my 
program, it ends up just concatenating the html (req.write's) onto the 
existing page. I really want this one function to just start a new 
"page" or "connection" (I guess thats what u would call it) , when it is 
summoned. I have no idea how to go about this..Thanks..

ALEX
From grahamd at dscpl.com.au  Sun Jan 21 21:20:35 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sun Jan 21 21:20:41 2007
Subject: [mod_python] How to start a new "page" from within program?
Message-ID: <1169432435.31237@dscpl.user.openhosting.com>

alex wrote ..
> Okay, im using the publisher handler and when my web forms do a POST 
> action to functions in my index.py, it loads the information fresh, 
> however when I call a function or series of functions from within my 
> program, it ends up just concatenating the html (req.write's) onto the
> existing page. I really want this one function to just start a new 
> "page" or "connection" (I guess thats what u would call it) , when it is
> summoned. I have no idea how to go about this..Thanks..

Do you mean that you want to redirect the client web browser to another page?
If so, look at mod_python.util.redirect() function in mod_python documentation.
If that is not what you mean, then I am not sure what you are talking about.

Graham
From grahamd at dscpl.com.au  Mon Jan 22 05:09:04 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon Jan 22 05:09:16 2007
Subject: [mod_python] Question about mod_python configuration
In-Reply-To: <45B492C1.28294.155B7187@export.hope.cz>
References: <45B26FFF.17101.D03AB59@export.hope.cz>
	<45B492C1.28294.155B7187@export.hope.cz>
Message-ID: <A39509E7-0194-4F6F-A8B2-BEECFA9F0DEB@dscpl.com.au>


On 22/01/2007, at 8:32 PM, export@hope.cz wrote:

> Graham ,
> Thank you for your reply
>
>> Please do the following:
>>
>> 1. Give the exact location of where the mptest.py now is. Does the  
>> user
>> that Apache runs as have permission to search that location and read
>> the handler file?
>
>  mptest.py is now  in the (working)location:
> C:\Program Files\Apache Software Foundation\Apache2.2\htdocs\test
>
> Yes, the users have the permission ( I test it on my XP windows)
>
>
>> 2. Give the URL that you are now using and expect to match to that
>> handler.
> Working URL was: http://127.0.0.1/test/mptest.py?17624
>
> I am trying( but not working )
> http://127.0.0.1/mod/mptest.py?17624

That isn't going to work as your Apache configuration isn't set up to  
have URLs
beginning with /mod use mod_python. You would need to use:

<Location /mod>
  AddHandler mod_python .py
  PythonPath "[' C:/MyDirectory/projects/mimproject/apps/mimi/ 
ModPythonPom/views/mod'] + sys.path"
  PythonHandler mptest
  PythonDebug On
</Location>

You might want to read up Apache documentation as to what Location and
Directory directives actually mean.

>>
>> 3. Give what error message the browser is giving back or otherwise
>> indicate
>> what sort of error you are getting that makes you believe it isn't
>> working.
> Mod_python does NOT find the handler ( mptest.py) at all in the new  
> location that is
> C:/MyDirectory/projects/mimproject/apps/mimi/ModPythonPom/views/mod
>
> Not working  httpd.conf( a part)  :
> <Directory "C:/Program Files/Apache Software Foundation/Apache2.2/ 
> htdocs/test">
>  AddHandler mod_python .py
>  PythonPath "[' C:/MyDirectory/projects/mimproject/apps/mimi/ 
> ModPythonPom/views/mod'] +
> sys.path"
>        PythonHandler mptest
>    PythonDebug On
>   </Directory>
>
>
>
>>
>> 4. Look in the Apache error log and give whatever error messages  
>> appear
>> there which relates to the failed request.
> Mod_python does NOT find the handler ( mptest.py) at all in the new  
> location
>
>
> Thank you for help
> Lad.
>
>
>
>
>
>
>>
>> If you can give this information our guesses may be better. :-)
>>
>> Graham
>>
>>> Thank you for help
>>> Lad
>>>
>>>
>>>
>>>> export@hope.cz wrote:
>>>>> I am able to use mod_python with this configuration
>>>>>
>>>>> <Directory "C:/Program Files/Apache Software Foundation/
>>> Apache2.2/htdocs/test">
>>>>>         AddHandler mod_python .py
>>>>>        PythonHandler mptest
>>>>>       PythonDebug On
>>>>>   </Directory>
>>>>>
>>>>> where server root is
>>>>>  "C:/Program Files/Apache Software Foundation/Apache2.2"
>>>>>
>>>>>
>>>>> But now I would like to  move PythonHandler  ( here mptest) to
>>> a different place.
>>>>> I need  the PythonHandler to  be in
>>>>>
>>>>> C:/MyDirectory/projects/mimproject/apps/mimi/ModPythonPom/views/
>>> mod
>>>>>
>>>>> How must change the above configuration so that I can use
>>> mod_python?
>>>>
>>>> The easiest way is to use the PythonPath directive to include your
>>>> handler in the search path. See
>>>> http://www.modpython.org/live/current/doc-html/dir-other-pp.html
>>>>
>>>> So use something like:
>>>>
>>>> <Directory "C:/Program Files/Apache Software
>>>> Foundation/Apache2.2/htdocs/test">
>>>>    PythonPath "sys.path +
>>>> ['C:/MyDirectory/projects/mimproject/apps/mimi/ModPythonPom/views/
>>> mod']"
>>>>    AddHandler mod_python .py
>>>>    PythonHandler mptest
>>>>    PythonDebug On
>>>> </Directory>
>>>>
>>>> Note that the PythonPath statement above should be on one line.
>>> There
>>>> might be line wrapping issues with this message.
>>>>
>>>> Jim
>>>
>>> _______________________________________________
>>> Mod_python mailing list
>>> Mod_python@modpython.org
>>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>
>>
>
From thiagocomicio at gmail.com  Mon Jan 22 10:49:20 2007
From: thiagocomicio at gmail.com (Thiago Comicio)
Date: Mon Jan 22 10:49:28 2007
Subject: [mod_python] Problems with ZODB / modpython
In-Reply-To: <92C61961-2618-467A-B549-7BF06D34AD6B@dscpl.com.au>
References: <1169153912.21600@dscpl.user.openhosting.com>
	<c1e7137e0701190255w4feee310t772b0c13e48500ad@mail.gmail.com>
	<92C61961-2618-467A-B549-7BF06D34AD6B@dscpl.com.au>
Message-ID: <c1e7137e0701220749t62612923n244171c65bf51c9e@mail.gmail.com>

On 1/19/07, Graham Dumpleton <grahamd@dscpl.com.au> wrote:
> Followups to the mailing list please.
>
> On 19/01/2007, at 9:55 PM, Thiago Comicio wrote:
>
> > On 1/18/07, Graham Dumpleton <grahamd@dscpl.com.au> wrote:
> >> What version of mod_python are you using, is it an older version? At
> >> least upgrade to mod_python 3.2.10 if you haven't already. There are
> >> certainly bugs in mod_python 3.1.X which may cause this.
> >
> > I'm using the version 3.2.8-3.1 fo Fedora 6. I've tried to run this
> > boot script with mod_python 3.2.10 without success.
> >
> >> Also, what
> >> Apache configuration do you use for enabling mod_python for that
> >> part of the URL namespace? Do you use PythonPath or PythonImport
> >> directives?
> >
> > I didn't understand very well your question, but the PYTHONPATH is
> > used to run ZODB, which is part of ZOPE (zope-2.9.6-1.fc6).
> > My Apache configuration to access the directory with the python
> > scripts is:
> >
> > <Directory /var/www/html/indico>
> >        AddHandler python-program .py
> >        PythonHandler mod_python.publisher
> >        PythonDebug On
> > </Directory>
>
> The PYTHONPATH setting if required has to be duplicated with equivalent
> in mod_python. Ie., add:
>
>    PythonPath "sys.path+['/usr/lib/zope/lib/python']"
>

Thanks Graham, it worked and my apologies for sending you those emails.

Thiago Comicio

> Read the documentation for information about the PythonPath directive.
>
> > When I boot the computer it doesn't work, but when I restart Apache,
> > without changing any configuration, it works.
>
> It works when you do a restart as it is probably inheriting PYTHONPATH
> from your user account. The Apache startup script will not have this on
> a reboot, so you need to set it up in Apache configuration file.
>
> > I made some tests.
> > When I initialize ZODB at the startup and start Apache after logging
> > in, it works. Or, after logging in, I initialize ZODB and Apache, it
> > works too. The problem is when I initialize both at the startup, first
> > ZODB and then Apache.
> >
> > Thanks,
> >
> > Thiago Comicio
> >
> >>
> >> Graham
> >>
> >> Thiago Comicio wrote ..
> >> > On 1/17/07, Graham Dumpleton <grahamd@dscpl.com.au> wrote:
> >> > > Thiago Comicio wrote ..
> >> > > > Hi,
> >> > > >
> >> > > > I'm trying to install a program that needs mod_python and
> >> ZODB. The
> >> > > > program is not running, so I tried to connect to the
> >> database through
> >> > > > this script:
> >> > > >
> >> > > > from ZODB import FileStorage, DB
> >> > > >
> >> > > > def index(req, **params):
> >> > > >         storage = FileStorage.FileStorage('mydatabase.fs')
> >> > > >         db = DB(storage)
> >> > > >         connection = db.open()
> >> > > >         root = connection.root()
> >> > > >         return TestPage().getHTML()
> >> > > >
> >> > > > And I received the error below.
> >> > > > Does anybody know how to fix it?
> >> > >
> >> > > A couple of things to be aware of.
> >> > >
> >> > > 1. The Apache web server generally runs as a special user and
> >> thus that
> >> > user
> >> > > must have write access to the directory where you are wanting
> >> to create
> >> > the
> >> > > database.
> >> > >
> >> > > 2. The current working directory is normally '/' for the
> >> Apache processes
> >> > and
> >> > > thus if you do not specify an absolute path to where you want
> >> to store
> >> > the
> >> > > database, it will try and store it in '/' where you are
> >> unlikely to have
> >> > permissions
> >> > > to write. You should not change the working directory as if
> >> every handler
> >> > did
> >> > > that they would all interfere with each other.
> >> > >
> >> > > Graham
> >> >
> >> >
> >> > Thanks Graham, this solved my initial problem, now I have another.
> >> >
> >> > I created a simple script to run when I boot my system.
> >> >
> >> > #main part of the script
> >> > PYTHONPATH=/usr/lib/zope/lib/python
> >> >
> >> > zope=$PYTHONPATH/ZEO/runzeo.py
> >> > python=/usr/bin/python
> >> > zopeconf=$PYTHONPATH/ZEO/zeo.config
> >> >
> >> > start() {
> >> >         echo -n $"Starting $prog1: "
> >> >         $python $zope -C $zopeconf &
> >> > }
> >> >
> >> > I put a symbolic link at /etc/rc5.d with the name S50myscript and a
> >> > symbolink link to http like S85http.
> >> > When I try to access a page that needs ZEO I receive the error
> >> below,
> >> > that disappears when I restart apache.
> >> > How can I fix this new problem?
> >> >
> >> > Thanks,
> >> >
> >> > Thiago
> >> >
> >> > ----------------------------------------
> >> >
> >> > Mod_python error: "PythonHandler mod_python.publisher"
> >> >
> >> > Traceback (most recent call last):
> >> >
> >> >   File "/usr/lib/python2.4/site-packages/mod_python/apache.py",
> >> line
> >> > 299, in HandlerDispatch
> >> >     result = object(req)
> >> >
> >> >   File "/usr/lib/python2.4/site-packages/mod_python/publisher.py",
> >> > line 204, in handler
> >> >     module = page_cache[req]
> >> >
> >> >   File "/usr/lib/python2.4/site-packages/mod_python/cache.py", line
> >> > 82, in __getitem__
> >> >     return self._checkitem(name)[2]
> >> >
> >> >   File "/usr/lib/python2.4/site-packages/mod_python/cache.py", line
> >> > 124, in _checkitem
> >> >     value = self.build(key, name, opened, entry)
> >> >
> >> >   File "/usr/lib/python2.4/site-packages/mod_python/publisher.py",
> >> > line 77, in build
> >> >     return ModuleCache.build(self, key, req, opened, entry)
> >> >
> >> >   File "/usr/lib/python2.4/site-packages/mod_python/cache.py", line
> >> > 371, in build
> >> >     exec opened in module.__dict__
> >> >
> >> >   File "/var/www/html/indico/index.py", line 1, in ?
> >> >     import MaKaC.webinterface.rh.welcome as welcome
> >> >
> >> >   File "/usr/lib/python2.4/site-packages/MaKaC/webinterface/rh/
> >> welcome.py",
> >> > line 1, in ?
> >> >     import MaKaC.webinterface.rh.base as base
> >> >
> >> >   File "/usr/lib/python2.4/site-packages/MaKaC/webinterface/rh/
> >> base.py",
> >> > line 13, in ?
> >> >     from ZODB.POSException import ConflictError
> >> >
> >> > ImportError: No module named ZODB.POSException
> >> > _______________________________________________
> >> > Mod_python mailing list
> >> > Mod_python@modpython.org
> >> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >>
>
From export at hope.cz  Mon Jan 22 15:22:04 2007
From: export at hope.cz (export@hope.cz)
Date: Mon Jan 22 15:22:25 2007
Subject: [mod_python] Memory error
Message-ID: <45B52AFC.4226.17AE1733@export.hope.cz>

I spent some time to write an input filter hoping  that an input filter will
help me upload large files without memory errors.
But it does NOT help.
When I checked Apache error log today I saw:
MemoryError, referer: http://127.0.0.1/mod/mptest.py?17644

( mptest.py is handler I use for uploading .)


 I use
Apache 2.2.4
Mod_python 3.3.0.b
Python 2.3.5


Input filter looks like this

def inputfilter(filter):
	if filter.req.method != 'POST':
		filter.pass_on()
		return
	f=open('uploadedfile','ab')
	
	s = filter.read()
	while s:
		f.write(s)
		f.flush()
		filter.write(s)
		filter.flush()
		s = filter.read()
	if s is None:
		filter.close()
		f.close()

Can anyone help? Will input filter really help or not?
Does anyone have any experience with uploading large files( 100 MB and higher)?
Thank you help
Lad.


From eric at bright-interactive.com  Mon Jan 22 16:26:22 2007
From: eric at bright-interactive.com (Eric Clack)
Date: Mon Jan 22 16:26:28 2007
Subject: [mod_python] Memory error
In-Reply-To: <45B52AFC.4226.17AE1733@export.hope.cz>
References: <45B52AFC.4226.17AE1733@export.hope.cz>
Message-ID: <5c58e3ca0701221326j1da9758dr39b91e61d779329b@mail.gmail.com>

I'm not really answering the question you've asked, but I've found
that using a browser to upload files larger than a few MB often causes
the browser to hang or disconnect (regardless of server technology).
It seems that some browsers are not designed to upload such large
files.

Perhaps you could upload these files via SFTP or FTP?

-Eric.

On 22/01/07, export@hope.cz <export@hope.cz> wrote:
> I spent some time to write an input filter hoping  that an input filter will
> help me upload large files without memory errors.
> But it does NOT help.
> When I checked Apache error log today I saw:
> MemoryError, referer: http://127.0.0.1/mod/mptest.py?17644
>
> ( mptest.py is handler I use for uploading .)
>
>
>  I use
> Apache 2.2.4
> Mod_python 3.3.0.b
> Python 2.3.5
>
>
> Input filter looks like this
>
> def inputfilter(filter):
>         if filter.req.method != 'POST':
>                 filter.pass_on()
>                 return
>         f=open('uploadedfile','ab')
>
>         s = filter.read()
>         while s:
>                 f.write(s)
>                 f.flush()
>                 filter.write(s)
>                 filter.flush()
>                 s = filter.read()
>         if s is None:
>                 filter.close()
>                 f.close()
>
> Can anyone help? Will input filter really help or not?
> Does anyone have any experience with uploading large files( 100 MB and higher)?
> Thank you help
> Lad.
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>


-- 
Eric Clack
eric@bright-interactive.com

Bright Interactive : Successfully delivering interactive websites and
business applications
http://www.bright-interactive.com/
0870 240 6520
From grahamd at dscpl.com.au  Mon Jan 22 16:28:23 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon Jan 22 16:28:32 2007
Subject: [mod_python] Memory error
Message-ID: <1169501303.18421@dscpl.user.openhosting.com>

export@hope.cz wrote ..
> I spent some time to write an input filter hoping  that an input filter
> will
> help me upload large files without memory errors.
> But it does NOT help.
> When I checked Apache error log today I saw:
> MemoryError, referer: http://127.0.0.1/mod/mptest.py?17644
> 
> ( mptest.py is handler I use for uploading .)
> 
> 
>  I use
> Apache 2.2.4
> Mod_python 3.3.0.b
> Python 2.3.5
> 
> 
> Input filter looks like this
> 
> def inputfilter(filter):
> 	if filter.req.method != 'POST':
> 		filter.pass_on()
> 		return
> 	f=open('uploadedfile','ab')

Where the file will be placed is unpredictable. You should use an
absolute path to the file. You should also be using some unique
name for the actual file else concurrent uploads will interfere with
each other. The name you use for the file should be passed through
to your request handler by setting an attribute in filter.req, ie.,

  filter.req.uploadfilename = "someuniquename"
 	
> 	s = filter.read()
> 	while s:
> 		f.write(s)
> 		f.flush()
> 		filter.write(s)
> 		filter.flush()

If you are wanting the data to be written to a file but not take up
memory in Apache as well, you shouldn't be also writing the data
onto the filter object as by doing so it isn't being discarded and
your process will run out of memory.

> 		s = filter.read()
> 	if s is None:
> 		filter.close()
> 		f.close()
> 
> Can anyone help? Will input filter really help or not?
> Does anyone have any experience with uploading large files( 100 MB and
> higher)?

I can't remember if it was you again or someone else has been asking about
input filters and large file uploads, but I have already pointed out Tramline
in a post recently, which can be used as a working example of how to do this
sort of stuff. The only difference in Tramline was that the final request was
being proxied through to a backend, so it was setting the filename in a header
rather than an attribute of the request object. The URL for Tramline again is:

  http://www.infrae.com/products/tramline

Graham
From mboorshtein at gmail.com  Tue Jan 23 00:21:04 2007
From: mboorshtein at gmail.com (Marc Boorshtein)
Date: Tue Jan 23 00:21:11 2007
Subject: [mod_python] Building on solaris with gcc
Message-ID: <800df6390701222121q25c2aeffmae50ea64ff5fedd2@mail.gmail.com>

Hello,

I'm trying to build mod_python on solaris 8 with gcc.  I was able to
build mod_perl with gcc, so this should work and I'm sure I'm missing
something.  Configure succeeds, but make gives me the following
errors:

bash-2.03$ make
make[1]: Entering directory `/clocal/users/users/mlb/mod_python-3.2.10/src'
ar -x `gcc -print-libgcc-file-name` _eprintf.o
ar -x `gcc -print-libgcc-file-name` _floatdidf.o
ar -x `gcc -print-libgcc-file-name` _muldi3.o

Compiling for DSO.

/clocal/users/users/mlb/ihs-6.1/bin/apxs
-I/clocal/users/users/mlb/mod_python-3.2.10/src/include
-I/clocal/users/users/mlb/ihs-6.1/include
-I/global/site/vendor/cci/python/include/python2.5 -c mod_python.c
_apachemodule.c requestobject.c tableobject.c util.c serverobject.c
connobject.c filterobject.c hlist.c hlistobject.c -lgcc    -lm
/global/site/vendor/cci/python/lib/python2.5/config/libpython2.5.a
_eprintf.o _floatdidf.o _muldi3.o
/clocal/users/users/mlb/ihs-6.1/build/libtool --silent --mode=compile
cc -prefer-pic   -DSOLARIS2=8 -D_POSIX_PTHREAD_SEMANTICS -D_REENTRANT
-g -I/clocal/users/users/mlb/ihs-6.1/include
-I/clocal/users/users/mlb/ihs-6.1/include
-I/clocal/users/users/mlb/ihs-6.1/include
-I/clocal/users/users/mlb/mod_python-3.2.10/src/include
-I/clocal/users/users/mlb/ihs-6.1/include
-I/global/site/vendor/cci/python/include/python2.5  -c -o
mod_python.lo mod_python.c && touch mod_python.slo
/clocal/users/users/mlb/ihs-6.1/build/libtool: cc: not found
apxs:Error: Command failed with rc=65536
.
make[1]: *** [mod_python.so] Error 1
make[1]: Leaving directory `/clocal/users/users/mlb/mod_python-3.2.10/src'
make: *** [do_dso] Error 2

I'm sure I've missed something.  I set CC=gcc.  Any help would be
greatly appreciated.

Thanks

Marc
From grahamd at dscpl.com.au  Tue Jan 23 01:00:39 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Jan 23 01:00:45 2007
Subject: [mod_python] Building on solaris with gcc
Message-ID: <1169532039.19533@dscpl.user.openhosting.com>

Run:

  apxs -q CC

If you get back:

  cc

it usually means that your Apache was compiled with Sun C compiler and not
with gcc. This means that the version of libtool embedded within Apache
installation is also configured for Sun C compiler and not gcc. The Sun C
compiler setup is incompatible because the options to each compiler are
different for building shared objects and libraries.

Your options are to rebuild Apache using gcc instead of Sun C compiler, or
make a copy of various bits of Apache build scripts and libtool and change
them so they will work with gcc instead. I have done the latter before and
it is a bit of a fiddle, so rebuilding Apache with gcc is prefered option.

If you really want to try the second approach of hacking Apache build
scripts and libtool I can dig up my stuff on that, but will not have time until
tomorrow to do that.

You were able to build mod_perl because it probably ignores libtool and
does compiling of code files itself.

Graham

Marc Boorshtein wrote ..
> Hello,
> 
> I'm trying to build mod_python on solaris 8 with gcc.  I was able to
> build mod_perl with gcc, so this should work and I'm sure I'm missing
> something.  Configure succeeds, but make gives me the following
> errors:
> 
> bash-2.03$ make
> make[1]: Entering directory `/clocal/users/users/mlb/mod_python-3.2.10/src'
> ar -x `gcc -print-libgcc-file-name` _eprintf.o
> ar -x `gcc -print-libgcc-file-name` _floatdidf.o
> ar -x `gcc -print-libgcc-file-name` _muldi3.o
> 
> Compiling for DSO.
> 
> /clocal/users/users/mlb/ihs-6.1/bin/apxs
> -I/clocal/users/users/mlb/mod_python-3.2.10/src/include
> -I/clocal/users/users/mlb/ihs-6.1/include
> -I/global/site/vendor/cci/python/include/python2.5 -c mod_python.c
> _apachemodule.c requestobject.c tableobject.c util.c serverobject.c
> connobject.c filterobject.c hlist.c hlistobject.c -lgcc    -lm
> /global/site/vendor/cci/python/lib/python2.5/config/libpython2.5.a
> _eprintf.o _floatdidf.o _muldi3.o
> /clocal/users/users/mlb/ihs-6.1/build/libtool --silent --mode=compile
> cc -prefer-pic   -DSOLARIS2=8 -D_POSIX_PTHREAD_SEMANTICS -D_REENTRANT
> -g -I/clocal/users/users/mlb/ihs-6.1/include
> -I/clocal/users/users/mlb/ihs-6.1/include
> -I/clocal/users/users/mlb/ihs-6.1/include
> -I/clocal/users/users/mlb/mod_python-3.2.10/src/include
> -I/clocal/users/users/mlb/ihs-6.1/include
> -I/global/site/vendor/cci/python/include/python2.5  -c -o
> mod_python.lo mod_python.c && touch mod_python.slo
> /clocal/users/users/mlb/ihs-6.1/build/libtool: cc: not found
> apxs:Error: Command failed with rc=65536
> .
> make[1]: *** [mod_python.so] Error 1
> make[1]: Leaving directory `/clocal/users/users/mlb/mod_python-3.2.10/src'
> make: *** [do_dso] Error 2
> 
> I'm sure I've missed something.  I set CC=gcc.  Any help would be
> greatly appreciated.
> 
> Thanks
> 
> Marc
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
From export at hope.cz  Tue Jan 23 02:47:26 2007
From: export at hope.cz (export@hope.cz)
Date: Tue Jan 23 02:47:35 2007
Subject: [mod_python] Memory error
In-Reply-To: <5c58e3ca0701221326j1da9758dr39b91e61d779329b@mail.gmail.com>
References: <45B52AFC.4226.17AE1733@export.hope.cz>
Message-ID: <45B5CB9E.6129.561D1A@export.hope.cz>

 Eric,
Thank you for your reply.
> 
> Perhaps you could upload these files via SFTP or FTP?
> 
I was also thinking about SFTP and FTP but the problem is that users would have need 
SFTP or FTP client to be able to upload files via SFTP or FTP protocol.
Or is there any other solution for users so that they will NOT have to install FTP/SFTP client 
first?


From export at hope.cz  Tue Jan 23 02:47:27 2007
From: export at hope.cz (export@hope.cz)
Date: Tue Jan 23 02:47:37 2007
Subject: [mod_python] Memory error
In-Reply-To: <1169501303.18421@dscpl.user.openhosting.com>
Message-ID: <45B5CB9F.3203.561EC0@export.hope.cz>

 Graham ,
Thank you for your reply and help.
I tried not to use
filter.write(s)
and it seem that the memory is not used so much then.
But I will have to test it more to be sure that it will be the solution to memory problem.
Thanks again for help
Lad.


> If you are wanting the data to be written to a file but not take up
> memory in Apache as well, you shouldn't be also writing the data
> onto the filter object as by doing so it isn't being discarded and
> your process will run out of memory.
> 
> > 		s = filter.read()
> > 	if s is None:
> > 		filter.close()
> > 		f.close()
> > 
> > Can anyone help? Will input filter really help or not?
> > Does anyone have any experience with uploading large files( 100 MB and
> > higher)?
> 
> I can't remember if it was you again or someone else has been asking about
> input filters and large file uploads, but I have already pointed out Tramline
> in a post recently, which can be used as a working example of how to do this
> sort of stuff. The only difference in Tramline was that the final request was
> being proxied through to a backend, so it was setting the filename in a header
> rather than an attribute of the request object. The URL for Tramline again is:
> 
>   http://www.infrae.com/products/tramline
> 
> Graham


From suresh.lakshmanan at gmail.com  Tue Jan 23 09:33:41 2007
From: suresh.lakshmanan at gmail.com (Suresh Lakshmanan)
Date: Tue Jan 23 09:33:50 2007
Subject: [mod_python] how to run multiple subinterpreters from mod_python
Message-ID: <bfe260b10701230633o66ddd966o71474b743f39862@mail.gmail.com>

Hi,
Is it possible for mod_python to create new subinterpreter when requests
arrive? I was thinking that mod_python has a configurable pool of python
interpreters
and it will delegate a request to an interpreter from the pool.

But, it looks like this is not the case. Only one subinterpreter is only
created for a virtual host or directory config according to documentation.
This is
creating problems because the other requests have to wait for a long time
and i get 503 from apache. It will be useful if i have multiple
subinterpreters
to which apache can assign requests arbitrarily. I do not maintain state in
any of the interpreters.

iow, how do i scale this to a large number of users. how do i introduce
parallel processing of requests for the same virtual host/directory. at the
moment it looks
like its single threaded.

definitely there should be a way as this is a common problem... can someone
please point me to the solution.

thanks in advance.
-- 
"Little by little, through patience and repeated effort, the mind will
become stilled in the Self." - Bhagawad Gita
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070123/a68ff455/attachment.html
From durumdara at gmail.com  Tue Jan 23 09:44:43 2007
From: durumdara at gmail.com (durumdara)
Date: Tue Jan 23 09:44:55 2007
Subject: [mod_python] modpy3.2 + apache2.2 + odbc + dbisam - substitute to
	cgi ?
Message-ID: <45B61F5B.7020104@gmail.com>

Hi!

My problem is that:

I need to use DBISAM databases.
There is no native Python driver for DBISAM, but DBISAM have ODBC driver.

I build two sites with DBISAM local database, and with ODBC drived by 
pywin32 odbc module.
Everything is worked good (it seems to be) if I drop my cursors on every 
request.

But now I needed to change ODBC to remote mode (to read remote database).
Yesterday I simple changed the settings of the driver, and next I found 
me in the hell... :-(((

In every 2.-3. request the httpd.exe is crashed. No error msg. generated 
(logs), only Windows create some dumps about it.
In the event log I see that ntdll.dll and sometimes the odbc.pyd is the 
source of the error.
Interesting thing, that my sites are working good with odbc.pyd and 
DBISAM when they are not used remote databases.

I tried everything: I set MaxReqPChild to 1 (to cleanup), close 
cursors/databases on finishing of scripts, etc.
When I try to do same thing with normal python interpreter, I cannot do 
it. I can open many-many connections, and they are cleaned up normally...

Next I downloaded mxODBC, and tried it. It is working good, but it's 
prices are not good for me.

Today I download the pyodbc package, but it is possible not thread-safe. 
Or possible it is not working good later, I don't know.
I have not experienced with this.

BUT IF WILL NOT WORKING, I WILL NEED SOME CHANGING.

So:
I need some information to prepare to change if needed.
There is two way to working with dbisam + odbc under apache.
First: I need to write a database server (socketserver) that communicate 
beetween my apache processes and ODBC database. It is payful.
Second: I need to change to cgi mode to avoid these problems.

Please help me: what you offer me when I want to use cgi? The modpy 
library can supports this working mode? Or what I need to do for it?
Please offer me some library, and example to prepare if the problems 
appearing!

Thanks for your help:
    dd

From ron at udel.edu  Tue Jan 23 10:41:07 2007
From: ron at udel.edu (Ron Reisor)
Date: Tue Jan 23 10:41:13 2007
Subject: [mod_python] Building on solaris with gcc
In-Reply-To: <1169532039.19533@dscpl.user.openhosting.com>
References: <1169532039.19533@dscpl.user.openhosting.com>
Message-ID: <Pine.OSX.4.62.0701231036100.637@zim.nss.udel.edu>

Graham is correct, it's very important the that the apache and resultant 
libtool configuration match your mod_python configuration. We're running 
mod_python-3.3.0b on Solaris 10 sparc, but it and apache are built using 
the Sun C compiler. You should be able to get it working with gcc but I 
haven't tried that.

cheers,

Ron


On Tue, 23 Jan 2007, Graham Dumpleton wrote:

> Run:
>
>  apxs -q CC
>
> If you get back:
>
>  cc
>
> it usually means that your Apache was compiled with Sun C compiler and not
> with gcc. This means that the version of libtool embedded within Apache
> installation is also configured for Sun C compiler and not gcc. The Sun C
> compiler setup is incompatible because the options to each compiler are
> different for building shared objects and libraries.
>
> Your options are to rebuild Apache using gcc instead of Sun C compiler, or
> make a copy of various bits of Apache build scripts and libtool and change
> them so they will work with gcc instead. I have done the latter before and
> it is a bit of a fiddle, so rebuilding Apache with gcc is prefered option.
>
> If you really want to try the second approach of hacking Apache build
> scripts and libtool I can dig up my stuff on that, but will not have time until
> tomorrow to do that.
>
> You were able to build mod_perl because it probably ignores libtool and
> does compiling of code files itself.
>
> Graham
>
> Marc Boorshtein wrote ..
>> Hello,
>>
>> I'm trying to build mod_python on solaris 8 with gcc.  I was able to
>> build mod_perl with gcc, so this should work and I'm sure I'm missing
>> something.  Configure succeeds, but make gives me the following
>> errors:
>>
>> bash-2.03$ make
>> make[1]: Entering directory `/clocal/users/users/mlb/mod_python-3.2.10/src'
>> ar -x `gcc -print-libgcc-file-name` _eprintf.o
>> ar -x `gcc -print-libgcc-file-name` _floatdidf.o
>> ar -x `gcc -print-libgcc-file-name` _muldi3.o
>>
>> Compiling for DSO.
>>
>> /clocal/users/users/mlb/ihs-6.1/bin/apxs
>> -I/clocal/users/users/mlb/mod_python-3.2.10/src/include
>> -I/clocal/users/users/mlb/ihs-6.1/include
>> -I/global/site/vendor/cci/python/include/python2.5 -c mod_python.c
>> _apachemodule.c requestobject.c tableobject.c util.c serverobject.c
>> connobject.c filterobject.c hlist.c hlistobject.c -lgcc    -lm
>> /global/site/vendor/cci/python/lib/python2.5/config/libpython2.5.a
>> _eprintf.o _floatdidf.o _muldi3.o
>> /clocal/users/users/mlb/ihs-6.1/build/libtool --silent --mode=compile
>> cc -prefer-pic   -DSOLARIS2=8 -D_POSIX_PTHREAD_SEMANTICS -D_REENTRANT
>> -g -I/clocal/users/users/mlb/ihs-6.1/include
>> -I/clocal/users/users/mlb/ihs-6.1/include
>> -I/clocal/users/users/mlb/ihs-6.1/include
>> -I/clocal/users/users/mlb/mod_python-3.2.10/src/include
>> -I/clocal/users/users/mlb/ihs-6.1/include
>> -I/global/site/vendor/cci/python/include/python2.5  -c -o
>> mod_python.lo mod_python.c && touch mod_python.slo
>> /clocal/users/users/mlb/ihs-6.1/build/libtool: cc: not found
>> apxs:Error: Command failed with rc=65536
>> .
>> make[1]: *** [mod_python.so] Error 1
>> make[1]: Leaving directory `/clocal/users/users/mlb/mod_python-3.2.10/src'
>> make: *** [do_dso] Error 2
>>
>> I'm sure I've missed something.  I set CC=gcc.  Any help would be
>> greatly appreciated.
>>
>> Thanks
>>
>> Marc
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>

Ron Reisor <ron@udel.edu> (RWR3)
University of Delaware Information Technologies/Network and Systems Services
Computing Center/192 South Chapel Street/Newark DE, 19716
pgp finger print: 0D 73 06 6F D3 6A 99 D3  F5 D5 6E FF 3B B9 7C 2C
From labs at ixopusada.com  Tue Jan 23 10:46:25 2007
From: labs at ixopusada.com (Dirk van Oosterbosch, IR labs)
Date: Tue Jan 23 10:47:18 2007
Subject: [mod_python] Version strings (or Server signature)
Message-ID: <4F9676A1-F2D2-4682-8CED-0DE858E420A7@ixopusada.com>

Hi,

I am constructing my own error pages, and would very much like to use  
the same version string (ServerSignature) that Apache puts on the  
bottom of its error pages ... like e.g. "Apache/2.0.55 (Unix)  
mod_python/3.1.4 Python/2.4.1 Server at localhost Port 80"

Is there any way I can access that signature (or the separate pieces  
of information to build the string myself) from within mod_python code?

thanks,
dirk


-----------------------------
Dirk van Oosterbosch
de Wittenstraat 225
1052 AT Amsterdam
the Netherlands

http://labs.ixopusada.com
-----------------------------

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070123/a8c4d821/attachment.html
From grisha at apache.org  Tue Jan 23 10:54:45 2007
From: grisha at apache.org (Gregory (Grisha) Trubetskoy)
Date: Tue Jan 23 10:54:47 2007
Subject: [mod_python] ANNOUNCE: Mod_python 3.2.10
Message-ID: <20060807122954.C16306@grisha.dyndns.org>


The Apache Software Foundation and The Apache HTTP Server Project are
pleased to announce the 3.2.10 release of mod_python. Mod_python
3.2.10 is considered a stable release, suitable for production use.

Mod_python is an Apache HTTP Server module that embeds the Python
language interpreter within the server. With mod_python you can write
web-based applications in Python that will run many times faster than
traditional CGI and will have access to advanced features such as
ability to maintain objects between requests, access to httpd
internals, content filters and connection handlers.

The 3.2.10 release has many new features, feature enhancements, fixed
bugs and other improvements over the previous version. 3.2.10 now
works with Apache HTTP Server 2.2. See Appendix A of mod_python
documentation for a complete list.

Mod_python 3.2.10 is released under Apache License version 2.0.

Mod_python 3.2.10 is available for download from:

http://httpd.apache.org/modules/python-download.cgi

More information about mod_python is available at:

http://httpd.apache.org/modules/

Many thanks to Jim Gallacher, Graham Dumpleton, Nicolas Lehuen and
everyone else who contributed to and helped test this release, without
your help it would not be possible!

Regards,

Grisha Trubetskoy
From mboorshtein at gmail.com  Tue Jan 23 10:58:23 2007
From: mboorshtein at gmail.com (Marc Boorshtein)
Date: Tue Jan 23 10:58:28 2007
Subject: [mod_python] Building on solaris with gcc
In-Reply-To: <Pine.OSX.4.62.0701231036100.637@zim.nss.udel.edu>
References: <1169532039.19533@dscpl.user.openhosting.com>
	<Pine.OSX.4.62.0701231036100.637@zim.nss.udel.edu>
Message-ID: <800df6390701230758s581c1ey3797682362cc832f@mail.gmail.com>

OK, sounds like I should get Sun's C compiler working.  Thanks
everyone for the quick responses!

Marc
From grahamd at dscpl.com.au  Tue Jan 23 17:18:14 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Jan 23 17:18:20 2007
Subject: [mod_python] how to run multiple subinterpreters from mod_python
Message-ID: <1169590694.5242@dscpl.user.openhosting.com>

Suresh Lakshmanan wrote ..
> Hi,
> Is it possible for mod_python to create new subinterpreter when requests
> arrive? I was thinking that mod_python has a configurable pool of python
> interpreters
> and it will delegate a request to an interpreter from the pool.
> 
> But, it looks like this is not the case.

Correct, that is not the case. You are misunderstand what the subinterpreters
are there for.

> Only one subinterpreter is only
> created for a virtual host or directory config according to documentation.

More or less, yes. Each sub interpreter is named and is tied to some part of
the URL namespace. The default is that there will be a sub interpreter for
each virtual host, but this can be overridden by various directives. 

> This is
> creating problems because the other requests have to wait for a long time
> and i get 503 from apache.

The way Python sub interpreters are used, it is highly unlikely that a 503
response is going to be because of them. It may be how you have Apache
configured, but to know you will have to state what platform you are using
and if on UNIX whether you have compiled Apache with the prefork MPM
or worker MPM. You also should post what you Apache configuration is
that controls the number of Apache sub processes and/or threads within
a process.

> It will be useful if i have multiple
> subinterpreters
> to which apache can assign requests arbitrarily. I do not maintain state
> in
> any of the interpreters.

This will not make any difference, what matters is how many Apache child
process are allowed to be created when using prefork MPM, or how many
child processes and/or threads with a process that Apache is allowed to
create when using a multithreaded MPM.

If using prefork MPM and you have restricted the number of Apache child
processes to a small fixed number, then if you get more requests than
that arrive, there will be no processes available to handle the request. If
you are using a multithreaded MPM, then a small number of threads across
all processes will limit how many requests can be handled concurrently.

Creating extra Python subinterpreters only gives you separation of data,
it doesn't provide any additional concurrency abilities. You seem not to
understand this point.

> iow, how do i scale this to a large number of users. how do i introduce
> parallel processing of requests for the same virtual host/directory. at
> the
> moment it looks
> like its single threaded.

If you use prefork, then only one request in each child process can be
handled at a time, but then you should be running with adequate child
processes so that isn't a problem. If using a multithreaded MPM, then there
already can be multiple requests handled at the same time and these
can be handled even within the same Python subinterpreter.

> definitely there should be a way as this is a common problem... can someone
> please point me to the solution.

You probably need to research more about the different MPM models for
Apache. For starters, read:

  http://www.dscpl.com.au/wiki/ModPython/Articles/TheProcessInterpreterModel

You might then see what you can find in documentation about Apache referenced on:

  http://wiki.apache.org/mod_python/

On first guess I would say how you have configured Apache is limiting things.

If you are using a multithreaded MPM, then you might have a third party module
for Python you are using which doesn't release the Python GIL around a long
running operation being performed in C code. Thus, what extra Python modules
are you using?


Graham
From grahamd at dscpl.com.au  Tue Jan 23 17:22:36 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Jan 23 17:22:41 2007
Subject: [mod_python] Version strings (or Server signature)
Message-ID: <1169590956.7447@dscpl.user.openhosting.com>

Dirk van Oosterbosch, IR labs wrote ..
> Hi,
> 
> I am constructing my own error pages, and would very much like to use 
> the same version string (ServerSignature) that Apache puts on the  
> bottom of its error pages ... like e.g. "Apache/2.0.55 (Unix)  
> mod_python/3.1.4 Python/2.4.1 Server at localhost Port 80"
> 
> Is there any way I can access that signature (or the separate pieces  
> of information to build the string myself) from within mod_python code?

Haven't tested this, but try:

  req.add_common_vars()
  version = req.subprocess_env["SERVER_SOFTWARE"]

Graham
From grahamd at dscpl.com.au  Tue Jan 23 19:09:27 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Jan 23 19:09:35 2007
Subject: [mod_python] modpy3.2 + apache2.2 + odbc + dbisam - substitute
	tocgi ?
Message-ID: <1169597367.22603@dscpl.user.openhosting.com>

If not doing so already, force all your mod_python request handlers to run
within the context of the first Python interpreter instance created by
mod_python by using:

  PythonInterpeter main_interpreter

I think you need to have at least mod_python 3.2.10 for this to
be of any use because of bugs in earlier versions of mod_python.

This can be required where third party Python modules are not written
correctly so as to be usable from secondary interpreters. For more
details on what this issue is about, see:

  http://issues.apache.org/jira/browse/MODPYTHON-77

That said, this may not help at all and is just a guess.

Graham

durumdara wrote ..
> Hi!
> 
> My problem is that:
> 
> I need to use DBISAM databases.
> There is no native Python driver for DBISAM, but DBISAM have ODBC driver.
> 
> I build two sites with DBISAM local database, and with ODBC drived by 
> pywin32 odbc module.
> Everything is worked good (it seems to be) if I drop my cursors on every
> request.
> 
> But now I needed to change ODBC to remote mode (to read remote database).
> Yesterday I simple changed the settings of the driver, and next I found
> me in the hell... :-(((
> 
> In every 2.-3. request the httpd.exe is crashed. No error msg. generated
> (logs), only Windows create some dumps about it.
> In the event log I see that ntdll.dll and sometimes the odbc.pyd is the
> source of the error.
> Interesting thing, that my sites are working good with odbc.pyd and 
> DBISAM when they are not used remote databases.
> 
> I tried everything: I set MaxReqPChild to 1 (to cleanup), close 
> cursors/databases on finishing of scripts, etc.
> When I try to do same thing with normal python interpreter, I cannot do
> it. I can open many-many connections, and they are cleaned up normally...
> 
> Next I downloaded mxODBC, and tried it. It is working good, but it's 
> prices are not good for me.
> 
> Today I download the pyodbc package, but it is possible not thread-safe.
> Or possible it is not working good later, I don't know.
> I have not experienced with this.
> 
> BUT IF WILL NOT WORKING, I WILL NEED SOME CHANGING.
> 
> So:
> I need some information to prepare to change if needed.
> There is two way to working with dbisam + odbc under apache.
> First: I need to write a database server (socketserver) that communicate
> beetween my apache processes and ODBC database. It is payful.
> Second: I need to change to cgi mode to avoid these problems.
> 
> Please help me: what you offer me when I want to use cgi? The modpy 
> library can supports this working mode? Or what I need to do for it?
> Please offer me some library, and example to prepare if the problems 
> appearing!
> 
> Thanks for your help:
>     dd
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
From suresh.lakshmanan at gmail.com  Tue Jan 23 23:09:14 2007
From: suresh.lakshmanan at gmail.com (Suresh Lakshmanan)
Date: Tue Jan 23 23:09:22 2007
Subject: [mod_python] how to run multiple subinterpreters from mod_python
In-Reply-To: <1169590694.5242@dscpl.user.openhosting.com>
References: <1169590694.5242@dscpl.user.openhosting.com>
Message-ID: <bfe260b10701232009l6e525a27k72569b34a9f0e119@mail.gmail.com>

Hi Graham,
I'm not very familiar with the apache MPM model. Thanks for your references,
im able to get an idea of how the subinterpreters work in mod_python.

My python application is a django based application. It uses a few python
modules like
PIL (python imaging library), dnspython, django, libxx (our c++ extension
written in python)

Multiple requests to my django application (running inside apache with
mod_python) are serialized and they execute one by one.
Lot of them get 503 responses.

Here's my apache conf.
# worker MPM
# StartServers: initial number of server processes to start
# MaxClients: maximum number of simultaneous client connections
# MinSpareThreads: minimum number of worker threads which are kept spare
# MaxSpareThreads: maximum number of worker threads which are kept spare
# ThreadsPerChild: constant number of worker threads in each server process
# MaxRequestsPerChild: maximum number of requests a server process serves
<IfModule worker.c>
StartServers         1
MaxClients          64
MinSpareThreads     64
MaxSpareThreads     64
ThreadsPerChild     64
MaxRequestsPerChild  0
ServerLimit          1
</IfModule>

<Location "/reg/">
    SetEnv PYTHONHOME "/usr/local/bin/python2.4"
    SetHandler python-program
    PythonPath "['/usr/local/pi/applications/',
'/usr/local/pi/nodes/data/regist
ration', '/usr/local/pi/pimgr/lib', '/usr/local/pi/pimgr/lib/ca' ,
'/usr/local/p
i/pimgr/lib/MySQLdb'] + sys.path"
    PythonHandler django.core.handlers.modpython
    SetEnv PINET_HOME
"/usr/local/pi/nodes/data/registration/pimgr/reg/ca/config
"
    SetEnv PIMGR_PATH "/usr/local/pi/nodes/data/registration/pimgr"
    SetEnv DJANGO_SETTINGS_MODULE pimgr.settings
    PythonDebug On
</Location>

On 1/24/07, Graham Dumpleton <grahamd@dscpl.com.au> wrote:
>
> Suresh Lakshmanan wrote ..
> > Hi,
> > Is it possible for mod_python to create new subinterpreter when requests
> > arrive? I was thinking that mod_python has a configurable pool of python
> > interpreters
> > and it will delegate a request to an interpreter from the pool.
> >
> > But, it looks like this is not the case.
>
> Correct, that is not the case. You are misunderstand what the
> subinterpreters
> are there for.
>
> > Only one subinterpreter is only
> > created for a virtual host or directory config according to
> documentation.
>
> More or less, yes. Each sub interpreter is named and is tied to some part
> of
> the URL namespace. The default is that there will be a sub interpreter for
> each virtual host, but this can be overridden by various directives.
>
> > This is
> > creating problems because the other requests have to wait for a long
> time
> > and i get 503 from apache.
>
> The way Python sub interpreters are used, it is highly unlikely that a 503
> response is going to be because of them. It may be how you have Apache
> configured, but to know you will have to state what platform you are using
> and if on UNIX whether you have compiled Apache with the prefork MPM
> or worker MPM. You also should post what you Apache configuration is
> that controls the number of Apache sub processes and/or threads within
> a process.
>
> > It will be useful if i have multiple
> > subinterpreters
> > to which apache can assign requests arbitrarily. I do not maintain state
> > in
> > any of the interpreters.
>
> This will not make any difference, what matters is how many Apache child
> process are allowed to be created when using prefork MPM, or how many
> child processes and/or threads with a process that Apache is allowed to
> create when using a multithreaded MPM.
>
> If using prefork MPM and you have restricted the number of Apache child
> processes to a small fixed number, then if you get more requests than
> that arrive, there will be no processes available to handle the request.
> If
> you are using a multithreaded MPM, then a small number of threads across
> all processes will limit how many requests can be handled concurrently.
>
> Creating extra Python subinterpreters only gives you separation of data,
> it doesn't provide any additional concurrency abilities. You seem not to
> understand this point.
>
> > iow, how do i scale this to a large number of users. how do i introduce
> > parallel processing of requests for the same virtual host/directory. at
> > the
> > moment it looks
> > like its single threaded.
>
> If you use prefork, then only one request in each child process can be
> handled at a time, but then you should be running with adequate child
> processes so that isn't a problem. If using a multithreaded MPM, then
> there
> already can be multiple requests handled at the same time and these
> can be handled even within the same Python subinterpreter.
>
> > definitely there should be a way as this is a common problem... can
> someone
> > please point me to the solution.
>
> You probably need to research more about the different MPM models for
> Apache. For starters, read:
>
>
> http://www.dscpl.com.au/wiki/ModPython/Articles/TheProcessInterpreterModel
>
> You might then see what you can find in documentation about Apache
> referenced on:
>
>   http://wiki.apache.org/mod_python/
>
> On first guess I would say how you have configured Apache is limiting
> things.
>
> If you are using a multithreaded MPM, then you might have a third party
> module
> for Python you are using which doesn't release the Python GIL around a
> long
> running operation being performed in C code. Thus, what extra Python
> modules
> are you using?
>
>
> Graham
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070124/f5b92723/attachment.html
From grahamd at dscpl.com.au  Tue Jan 23 23:53:48 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Jan 23 23:54:00 2007
Subject: [mod_python] how to run multiple subinterpreters from mod_python
Message-ID: <1169614428.18296@dscpl.user.openhosting.com>

Suresh Lakshmanan wrote ..
> Hi Graham,
> I'm not very familiar with the apache MPM model. Thanks for your references,
> im able to get an idea of how the subinterpreters work in mod_python.
> 
> My python application is a django based application. It uses a few python
> modules like
> PIL (python imaging library), dnspython, django, libxx (our c++ extension
> written in python)
> 
> Multiple requests to my django application (running inside apache with
> mod_python) are serialized and they execute one by one.
> Lot of them get 503 responses.
> 
> Here's my apache conf.

Does running:

  httpd -l

actually show worker.c in the list of files. Ie. to confirm that worker MPM is
actually compiled in.

> # worker MPM
> # StartServers: initial number of server processes to start
> # MaxClients: maximum number of simultaneous client connections
> # MinSpareThreads: minimum number of worker threads which are kept spare
> # MaxSpareThreads: maximum number of worker threads which are kept spare
> # ThreadsPerChild: constant number of worker threads in each server process
> # MaxRequestsPerChild: maximum number of requests a server process serves
> <IfModule worker.c>
> StartServers         1
> MaxClients          64
> MinSpareThreads     64
> MaxSpareThreads     64
> ThreadsPerChild     64
> MaxRequestsPerChild  0
> ServerLimit          1

This is what I was talking about with limiting the maximum number of child
process to 1. Because you have this, if a single request takes some time to
execute and the point it is waiting or taking time in is in C/C++ code in a
external Python module, and that module doesn't properly release the Python
GIL, all other requests will bank up behind that one request waiting for it to
return out of the C/C++ code.

In your libxx module, do you perform things in the C++ code that take a while
or do you make calls to stuff which can block. Do you ensure that you wrap time
consuming operations of code that can block in:

    Py_BEGIN_ALLOW_THREADS
    ... blocking or time consuming operation.
    Py_END_ALLOW_THREADS

> </IfModule>
>
> <Location "/reg/">
>     SetEnv PYTHONHOME "/usr/local/bin/python2.4"

This will not actually do anything for mod_python itself. Would only affect CGI
scripts which are written in Python.

>     SetHandler python-program
>     PythonPath "['/usr/local/pi/applications/',
> '/usr/local/pi/nodes/data/regist
> ration', '/usr/local/pi/pimgr/lib', '/usr/local/pi/pimgr/lib/ca' ,
> '/usr/local/p
> i/pimgr/lib/MySQLdb'] + sys.path"
>     PythonHandler django.core.handlers.modpython
>     SetEnv PINET_HOME
> "/usr/local/pi/nodes/data/registration/pimgr/reg/ca/config
> "
>     SetEnv PIMGR_PATH "/usr/local/pi/nodes/data/registration/pimgr"
>     SetEnv DJANGO_SETTINGS_MODULE pimgr.settings
>     PythonDebug On
> </Location>
> 
> On 1/24/07, Graham Dumpleton <grahamd@dscpl.com.au> wrote:
> >
> > Suresh Lakshmanan wrote ..
> > > Hi,
> > > Is it possible for mod_python to create new subinterpreter when requests
> > > arrive? I was thinking that mod_python has a configurable pool of python
> > > interpreters
> > > and it will delegate a request to an interpreter from the pool.
> > >
> > > But, it looks like this is not the case.
> >
> > Correct, that is not the case. You are misunderstand what the
> > subinterpreters
> > are there for.
> >
> > > Only one subinterpreter is only
> > > created for a virtual host or directory config according to
> > documentation.
> >
> > More or less, yes. Each sub interpreter is named and is tied to some
> part
> > of
> > the URL namespace. The default is that there will be a sub interpreter
> for
> > each virtual host, but this can be overridden by various directives.
> >
> > > This is
> > > creating problems because the other requests have to wait for a long
> > time
> > > and i get 503 from apache.
> >
> > The way Python sub interpreters are used, it is highly unlikely that
> a 503
> > response is going to be because of them. It may be how you have Apache
> > configured, but to know you will have to state what platform you are
> using
> > and if on UNIX whether you have compiled Apache with the prefork MPM
> > or worker MPM. You also should post what you Apache configuration is
> > that controls the number of Apache sub processes and/or threads within
> > a process.
> >
> > > It will be useful if i have multiple
> > > subinterpreters
> > > to which apache can assign requests arbitrarily. I do not maintain
> state
> > > in
> > > any of the interpreters.
> >
> > This will not make any difference, what matters is how many Apache child
> > process are allowed to be created when using prefork MPM, or how many
> > child processes and/or threads with a process that Apache is allowed
> to
> > create when using a multithreaded MPM.
> >
> > If using prefork MPM and you have restricted the number of Apache child
> > processes to a small fixed number, then if you get more requests than
> > that arrive, there will be no processes available to handle the request.
> > If
> > you are using a multithreaded MPM, then a small number of threads across
> > all processes will limit how many requests can be handled concurrently.
> >
> > Creating extra Python subinterpreters only gives you separation of data,
> > it doesn't provide any additional concurrency abilities. You seem not
> to
> > understand this point.
> >
> > > iow, how do i scale this to a large number of users. how do i introduce
> > > parallel processing of requests for the same virtual host/directory.
> at
> > > the
> > > moment it looks
> > > like its single threaded.
> >
> > If you use prefork, then only one request in each child process can be
> > handled at a time, but then you should be running with adequate child
> > processes so that isn't a problem. If using a multithreaded MPM, then
> > there
> > already can be multiple requests handled at the same time and these
> > can be handled even within the same Python subinterpreter.
> >
> > > definitely there should be a way as this is a common problem... can
> > someone
> > > please point me to the solution.
> >
> > You probably need to research more about the different MPM models for
> > Apache. For starters, read:
> >
> >
> > http://www.dscpl.com.au/wiki/ModPython/Articles/TheProcessInterpreterModel
> >
> > You might then see what you can find in documentation about Apache
> > referenced on:
> >
> >   http://wiki.apache.org/mod_python/
> >
> > On first guess I would say how you have configured Apache is limiting
> > things.
> >
> > If you are using a multithreaded MPM, then you might have a third party
> > module
> > for Python you are using which doesn't release the Python GIL around
> a
> > long
> > running operation being performed in C code. Thus, what extra Python
> > modules
> > are you using?
> >
> >
> > Graham
> >
From durumdara at gmail.com  Wed Jan 24 03:12:04 2007
From: durumdara at gmail.com (durumdara)
Date: Wed Jan 24 03:12:14 2007
Subject: [mod_python] modpy3.2 + apache2.2 + odbc + dbisam - substitute
	tocgi ?
In-Reply-To: <1169597367.22603@dscpl.user.openhosting.com>
References: <1169597367.22603@dscpl.user.openhosting.com>
Message-ID: <45B714D4.9080800@gmail.com>

Hi!

Sorry, but I not understand it fully.
I thinking about that:

    If I do this, only one interpreter created.
    And this interpreter serve all of the requests.
    So any concurrent requests are "need to pause" until the interpreter
    getting free state, and  ready to serve the next request.

Or I thinking wrong?
If not, that is making "slow" serving, or not?

Any question that if I must use cgi, can I use template system without 
any problems? Rendering is need apache import? If yes, it is not working 
in normal interpreter...

Thanks for your help:
    dd

Graham Dumpleton wrote:
> If not doing so already, force all your mod_python request handlers to run
> within the context of the first Python interpreter instance created by
> mod_python by using:
>
>   PythonInterpeter main_interpreter
>
> I think you need to have at least mod_python 3.2.10 for this to
> be of any use because of bugs in earlier versions of mod_python.
>
> This can be required where third party Python modules are not written
> correctly so as to be usable from secondary interpreters. For more
> details on what this issue is about, see:
>
>   http://issues.apache.org/jira/browse/MODPYTHON-77
>
> That said, this may not help at all and is just a guess.
>
> Graham
>
> durumdara wrote ..
>   
>> Hi!
>>
>> My problem is that:
>>
>> I need to use DBISAM databases.
>> There is no native Python driver for DBISAM, but DBISAM have ODBC driver.
>>
>> I build two sites with DBISAM local database, and with ODBC drived by 
>> pywin32 odbc module.
>> Everything is worked good (it seems to be) if I drop my cursors on every
>> request.
>>
>> But now I needed to change ODBC to remote mode (to read remote database).
>> Yesterday I simple changed the settings of the driver, and next I found
>> me in the hell... :-(((
>>
>> In every 2.-3. request the httpd.exe is crashed. No error msg. generated
>> (logs), only Windows create some dumps about it.
>> In the event log I see that ntdll.dll and sometimes the odbc.pyd is the
>> source of the error.
>> Interesting thing, that my sites are working good with odbc.pyd and 
>> DBISAM when they are not used remote databases.
>>
>> I tried everything: I set MaxReqPChild to 1 (to cleanup), close 
>> cursors/databases on finishing of scripts, etc.
>> When I try to do same thing with normal python interpreter, I cannot do
>> it. I can open many-many connections, and they are cleaned up normally...
>>
>> Next I downloaded mxODBC, and tried it. It is working good, but it's 
>> prices are not good for me.
>>
>> Today I download the pyodbc package, but it is possible not thread-safe.
>> Or possible it is not working good later, I don't know.
>> I have not experienced with this.
>>
>> BUT IF WILL NOT WORKING, I WILL NEED SOME CHANGING.
>>
>> So:
>> I need some information to prepare to change if needed.
>> There is two way to working with dbisam + odbc under apache.
>> First: I need to write a database server (socketserver) that communicate
>> beetween my apache processes and ODBC database. It is payful.
>> Second: I need to change to cgi mode to avoid these problems.
>>
>> Please help me: what you offer me when I want to use cgi? The modpy 
>> library can supports this working mode? Or what I need to do for it?
>> Please offer me some library, and example to prepare if the problems 
>> appearing!
>>
>> Thanks for your help:
>>     dd
>>
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>     
>
>   

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070124/332200d1/attachment.html
From export at hope.cz  Wed Jan 24 03:17:21 2007
From: export at hope.cz (export@hope.cz)
Date: Wed Jan 24 03:17:34 2007
Subject: [mod_python] Is it  possible to stop  file uploading?
Message-ID: <45B72421.23768.597DA52@export.hope.cz>

Hello,
Can anyone please answer these questions?

1.When a user uploads file, using FORM ( POST method), is there a  possibility  to stop 
uploading, if the file extension  is not among those  allowed? 

2.
Is there a good/recommended way how to find out the file extension?
I use a handler that can find the extension( using  util.FieldStorage(req))
but it does not stop uploading in progress but uploads the whole file first.

Thank you for help
Lad.


From suresh.lakshmanan at gmail.com  Wed Jan 24 04:23:41 2007
From: suresh.lakshmanan at gmail.com (Suresh Lakshmanan)
Date: Wed Jan 24 04:23:46 2007
Subject: [mod_python] how to run multiple subinterpreters from mod_python
In-Reply-To: <1169614428.18296@dscpl.user.openhosting.com>
References: <1169614428.18296@dscpl.user.openhosting.com>
Message-ID: <bfe260b10701240123i375abfd1ufbbb1079a98443d@mail.gmail.com>

Hi Graham,
my libxx makes openssl calls to do some crypto stuff. only a few http
requests land up on that code path.

i made this test...
for a url say, http://myserver/myapp/test. i put sleep in the python handler
code.

//python handler for the above url
{
    import time
    log('before sleep')
    time.sleep(60)
    log('after sleep')
}

when multiple clients access the url, the calls are serialized. the second
client waits for a minute and then comes to this handler.
why is this so? that's why i was lead to believe that the requests were
serialized.

am i missing something in the config?

this is httpd -l output. worker.c is compiled in
Compiled in modules:
  core.c
  mod_authn_file.c
  mod_authn_default.c
  mod_authz_host.c
  mod_authz_groupfile.c
  mod_authz_user.c
  mod_authz_default.c
  mod_auth_basic.c
  mod_auth_digest.c
  mod_include.c
  mod_filter.c
  mod_deflate.c
  mod_log_config.c
  mod_env.c
  mod_expires.c
  mod_setenvif.c
  mod_proxy.c
  mod_proxy_connect.c
  mod_proxy_ftp.c
  mod_proxy_http.c
  mod_proxy_ajp.c
  mod_proxy_balancer.c
  mod_ssl.c
  worker.c
  http_core.c
  mod_mime.c
  mod_status.c
  mod_autoindex.c
  mod_asis.c
  mod_negotiation.c
  mod_dir.c
  mod_actions.c
  mod_userdir.c
  mod_alias.c
  mod_rewrite.c
  mod_so.c

On 1/24/07, Graham Dumpleton <grahamd@dscpl.com.au> wrote:
>
> Suresh Lakshmanan wrote ..
> > Hi Graham,
> > I'm not very familiar with the apache MPM model. Thanks for your
> references,
> > im able to get an idea of how the subinterpreters work in mod_python.
> >
> > My python application is a django based application. It uses a few
> python
> > modules like
> > PIL (python imaging library), dnspython, django, libxx (our c++
> extension
> > written in python)
> >
> > Multiple requests to my django application (running inside apache with
> > mod_python) are serialized and they execute one by one.
> > Lot of them get 503 responses.
> >
> > Here's my apache conf.
>
> Does running:
>
>   httpd -l
>
> actually show worker.c in the list of files. Ie. to confirm that worker
> MPM is
> actually compiled in.
>
> > # worker MPM
> > # StartServers: initial number of server processes to start
> > # MaxClients: maximum number of simultaneous client connections
> > # MinSpareThreads: minimum number of worker threads which are kept spare
> > # MaxSpareThreads: maximum number of worker threads which are kept spare
> > # ThreadsPerChild: constant number of worker threads in each server
> process
> > # MaxRequestsPerChild: maximum number of requests a server process
> serves
> > <IfModule worker.c>
> > StartServers         1
> > MaxClients          64
> > MinSpareThreads     64
> > MaxSpareThreads     64
> > ThreadsPerChild     64
> > MaxRequestsPerChild  0
> > ServerLimit          1
>
> This is what I was talking about with limiting the maximum number of child
> process to 1. Because you have this, if a single request takes some time
> to
> execute and the point it is waiting or taking time in is in C/C++ code in
> a
> external Python module, and that module doesn't properly release the
> Python
> GIL, all other requests will bank up behind that one request waiting for
> it to
> return out of the C/C++ code.
>
> In your libxx module, do you perform things in the C++ code that take a
> while
> or do you make calls to stuff which can block. Do you ensure that you wrap
> time
> consuming operations of code that can block in:
>
>     Py_BEGIN_ALLOW_THREADS
>     ... blocking or time consuming operation.
>     Py_END_ALLOW_THREADS
>
> > </IfModule>
> >
> > <Location "/reg/">
> >     SetEnv PYTHONHOME "/usr/local/bin/python2.4"
>
> This will not actually do anything for mod_python itself. Would only
> affect CGI
> scripts which are written in Python.
>
> >     SetHandler python-program
> >     PythonPath "['/usr/local/pi/applications/',
> > '/usr/local/pi/nodes/data/regist
> > ration', '/usr/local/pi/pimgr/lib', '/usr/local/pi/pimgr/lib/ca' ,
> > '/usr/local/p
> > i/pimgr/lib/MySQLdb'] + sys.path"
> >     PythonHandler django.core.handlers.modpython
> >     SetEnv PINET_HOME
> > "/usr/local/pi/nodes/data/registration/pimgr/reg/ca/config
> > "
> >     SetEnv PIMGR_PATH "/usr/local/pi/nodes/data/registration/pimgr"
> >     SetEnv DJANGO_SETTINGS_MODULE pimgr.settings
> >     PythonDebug On
> > </Location>
> >
>
-- 
"Little by little, through patience and repeated effort, the mind will
become stilled in the Self." - Bhagawad Gita
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070124/d2f1c50c/attachment.html
From nlv11281 at natlab.research.philips.com  Wed Jan 24 04:51:46 2007
From: nlv11281 at natlab.research.philips.com (Mike Looijmans)
Date: Wed Jan 24 04:52:07 2007
Subject: [mod_python] Is it  possible to stop  file uploading?
In-Reply-To: <45B72421.23768.597DA52@export.hope.cz>
References: <45B72421.23768.597DA52@export.hope.cz>
Message-ID: <45B72C32.2030500@natlab.research.philips.com>

> 1.When a user uploads file, using FORM ( POST method), is there a  possibility  to stop 
> uploading, if the file extension  is not among those  allowed? 

Yes. Write out an error and close the HTTP connection.

> 2.
> Is there a good/recommended way how to find out the file extension?
> I use a handler that can find the extension( using  util.FieldStorage(req))
> but it does not stop uploading in progress but uploads the whole file first.

Create a FieldStorage instance, and pass it the callbacks for file 
processing. You'll be called while the file stream is being read, and 
you can check the extension at that time.

Mike.

From nlv11281 at natlab.research.philips.com  Wed Jan 24 04:56:13 2007
From: nlv11281 at natlab.research.philips.com (Mike Looijmans)
Date: Wed Jan 24 04:56:22 2007
Subject: [mod_python] how to run multiple subinterpreters from mod_python
In-Reply-To: <bfe260b10701240123i375abfd1ufbbb1079a98443d@mail.gmail.com>
References: <1169614428.18296@dscpl.user.openhosting.com>
	<bfe260b10701240123i375abfd1ufbbb1079a98443d@mail.gmail.com>
Message-ID: <45B72D3D.10807@natlab.research.philips.com>

> i made this test...
> for a url say, http://myserver/myapp/test <http://myserver/myapp/test>. 
> i put sleep in the python handler code.
> 
> //python handler for the above url
> {
>     import time
>     log('before sleep')
>     time.sleep(60)
>     log('after sleep')
> }
> 
> when multiple clients access the url, the calls are serialized. the 
> second client waits for a minute and then comes to this handler.
> why is this so? that's why i was lead to believe that the requests were 
> serialized.

Make sure that your test is correct. A browser will use the same 
connection for several request, in effect serializing the requests 
already. Many other HTTP client libraries do the same (which is a good 
thing).

Your best test is to open telnet sessions to port 80, and write "GET 
/test HTTP/1.0<return><return>" to the telnet session.

From suresh.lakshmanan at gmail.com  Wed Jan 24 05:12:38 2007
From: suresh.lakshmanan at gmail.com (Suresh Lakshmanan)
Date: Wed Jan 24 05:12:44 2007
Subject: [mod_python] how to run multiple subinterpreters from mod_python
In-Reply-To: <45B72D3D.10807@natlab.research.philips.com>
References: <1169614428.18296@dscpl.user.openhosting.com>
	<bfe260b10701240123i375abfd1ufbbb1079a98443d@mail.gmail.com>
	<45B72D3D.10807@natlab.research.philips.com>
Message-ID: <bfe260b10701240212o6257c484vdfe6907045d18594@mail.gmail.com>

you are right! i tried opening two different http clients and they ran
concurrently!
thanks.

now my original question remains. why do i get 503? any config change
i need to make?

On 1/24/07, Mike Looijmans <nlv11281@natlab.research.philips.com> wrote:
>
> > i made this test...
> > for a url say, http://myserver/myapp/test <http://myserver/myapp/test>.
> > i put sleep in the python handler code.
> >
> > //python handler for the above url
> > {
> >     import time
> >     log('before sleep')
> >     time.sleep(60)
> >     log('after sleep')
> > }
> >
> > when multiple clients access the url, the calls are serialized. the
> > second client waits for a minute and then comes to this handler.
> > why is this so? that's why i was lead to believe that the requests were
> > serialized.
>
> Make sure that your test is correct. A browser will use the same
> connection for several request, in effect serializing the requests
> already. Many other HTTP client libraries do the same (which is a good
> thing).
>
> Your best test is to open telnet sessions to port 80, and write "GET
> /test HTTP/1.0<return><return>" to the telnet session.
>
>


-- 
"Little by little, through patience and repeated effort, the mind will
become stilled in the Self." - Bhagawad Gita
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070124/51bbc751/attachment.html
From export at hope.cz  Wed Jan 24 08:46:14 2007
From: export at hope.cz (export@hope.cz)
Date: Wed Jan 24 08:46:32 2007
Subject: [mod_python] Is it  possible to stop  file uploading?
In-Reply-To: <45B72C32.2030500@natlab.research.philips.com>
References: <45B72421.23768.597DA52@export.hope.cz>
Message-ID: <45B77136.27877.6C4F506@export.hope.cz>

An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070124/c6b76228/attachment.html
From labs at ixopusada.com  Wed Jan 24 09:28:59 2007
From: labs at ixopusada.com (Dirk van Oosterbosch, IR labs)
Date: Wed Jan 24 09:29:40 2007
Subject: [mod_python] Version strings (or Server signature) [SOLVED]
In-Reply-To: <1169590956.7447@dscpl.user.openhosting.com>
References: <1169590956.7447@dscpl.user.openhosting.com>
Message-ID: <F8CD63E4-CB94-4829-B68B-D89BC4507012@ixopusada.com>

Thanks Graham,
that was exactly what I was looking for.

...req.subprocess_env["SERVER_SOFTWARE"] gives e.g. "Apache/2.0.55  
(Unix) mod_python/3.1.4 Python/2.4.1"
Note that you can also get the complete server signature (including  
"Server at ... Port ...") from req.subprocess_env 
["SERVER_SIGNATURE"], which adds an <address> tag around it.

d


On 23-jan-2007, at 23:22, Graham Dumpleton wrote:
> Dirk van Oosterbosch, IR labs wrote ..
>> I am constructing my own error pages, and would very much like to use
>> the same version string (ServerSignature) that Apache puts on the
>> bottom of its error pages ... like e.g. "Apache/2.0.55 (Unix)
>> mod_python/3.1.4 Python/2.4.1 Server at localhost Port 80"
>>
>> Is there any way I can access that signature (or the separate pieces
>> of information to build the string myself) from within mod_python  
>> code?
>
> Haven't tested this, but try:
>
>   req.add_common_vars()
>   version = req.subprocess_env["SERVER_SOFTWARE"]
>
> Graham
>



From moski666 at gmail.com  Wed Jan 24 12:09:38 2007
From: moski666 at gmail.com (Emiliano Moscato)
Date: Wed Jan 24 12:09:45 2007
Subject: [mod_python] how to handle xforms with publisher handler
In-Reply-To: <1169066921.19333@dscpl.user.openhosting.com>
References: <1169066921.19333@dscpl.user.openhosting.com>
Message-ID: <4388f4180701240909n7a13cdf6gb94f40651860e53@mail.gmail.com>

Hi, I'm sorry, I've forgot to send this lines:

        # figure out boundary
        try:
            i = ctype.lower().rindex("boundary=")
            end = set([ctype.find(';', i+9), ctype.find(' ', i+9)])
            end.discard(-1)
            if len(end) > 0:
                boundary = ctype[i+9:min(list(end))]
            else:
                boundary = ctype[i+9:]
            boundary_str = boundary
            if len(boundary) >= 2 and boundary[0] == boundary[-1] == '"':
                boundary = boundary[1:-1]
            boundary = re.compile("--" + re.escape(boundary) + "(--)?\r?\n")


        except ValueError:
            raise apache.SERVER_RETURN, apache.HTTP_BAD_REQUEST


Is a little long, but I didn't find a shorter way.

Graham et all, I'm interested on the another tip (how to treat xml dom
models), I'd like to know your opinion about my opinion sent with the first
bugfix. I'd like to use mod_python (and publisher handler if possible) in
our framework.
Thanks

Emiliano

2007/1/17, Graham Dumpleton <grahamd@dscpl.com.au>:
>
> Emiliano Moscato wrote ..
> > Hi;
> >
> > I've followed my tiny work with FieldStorage.
> > I changed the line:
> >             boundary = ctype[i+9:]
> > for:
> >             boundary = ctype[i+9:ctype.find(';',i+9)]
> > to fix the problem with boundary.
>
> I don't think this will always work. Where there is no semicolon then the
> result would be:
>
>   boundary = ctype[i+9:-1]
>
> This would have the affect of dropping off the last character in the value
> which may be part of the boundary tag or the quote which might surround
> it.
>
> Graham
>
>
> > I've tried to use this method without any other change to FieldStorage
> > and
> > works. I only need this bugfix and it is a good new for me.
> > On the other hand, I was thinking about the matter with
> "application/xml"
> > serialize method and the name of the method says all: who uses
> > "application/xml" as serialize method waits in the server for an xml
> > document, not for its mapping to a dict, and it have nothing to do with
> > xforms.
> > For example: cherryPy, where I come from, uses the same philosophy of
> put
> > the form fields as attributes of an object, but when it receives an
> > "application/xml" puts it available in "threadData" attribute.
> > Thanks for the attention :)
> >
> > Emiliano
> >
>


-- 
mOsKi
"No hay nada que uno haga mal , lo que hay es poco vino." Autor Anonimo
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070124/82705a61/attachment.html
From grahamd at dscpl.com.au  Wed Jan 24 16:53:13 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Jan 24 16:53:19 2007
Subject: [mod_python] Is it  possible to stop  file uploading?
Message-ID: <1169675593.23605@dscpl.user.openhosting.com>

Mike Looijmans wrote ..
> > 1.When a user uploads file, using FORM ( POST method), is there a  possibility
> to stop 
> > uploading, if the file extension  is not among those  allowed? 
> 
> Yes. Write out an error and close the HTTP connection.

Actually, whether you can stop the client sending any of the actual data
contained in the body of the POST request depends on a few issues.

First off, if the client is using the HTTP 1.0 protocol the answer is that you
cannot. This is because with HTTP 1.0 protocol the client will immediately
start sending the body of the POST. Thus even if the server side returns an
error status based on looking at only the URL for the request, the client will
already have potentially sent all the actual data. The return of the error from
a handler on the server should result in the connection being dropped and so
the server will not read the data, but this will not have prevented some amount
of bandwidth being used up by the client to send the data anyway. How much data
the client will have sent will depend on how much will get buffered by the
connection before it would have detected the connection had closed.

If the client is using the HTTP/1.1 protocol it gets more interesting. This is
because HTTP/1.1 implements a mechanism whereby a client can request that the
server send a 100 continue status response before it will actually start
sending the body of the POST request. This is something that is dealt with at a
lower layer than mod_python so you don't have to worry about it yourself. How
it works with mod_python though, is that the very first time that the handler
calls req.read(), the lower level layers will take that as meaning you are
ready to start consuming the data and so Apache will send back a 100 continue
response to the client and it will only then start sending the data. If rather
than call req.read(), the handler returns an error response instead, then the
client will see the error response and will stop before it has even sent the
body of the POST request.

So, although with both HTTP 1.0 and 1.1, the way to end the request early is to
send the error response, only with HTTP 1.1 protocol may you be able to get the
client to stop before it has actually sent any data at all. This though can
only be achieved if you can determine whether the request should be aborted
from just the URL and the request headers. If the only way you can work out if
the request is to be aborted is from the actual body of the POST request, then
none of this applies and the client is always going to send some amount of
the data anyway.

> > 2.
> > Is there a good/recommended way how to find out the file extension?
> > I use a handler that can find the extension( using  util.FieldStorage(req))
> > but it does not stop uploading in progress but uploads the whole file
> first.
> 
> Create a FieldStorage instance, and pass it the callbacks for file 
> processing. You'll be called while the file stream is being read, and 
> you can check the extension at that time.

As pointed out above though, if the extension is being derived from the
filename attribute of the Content-Disposition header within a part of the
multipart/mixed body of the POST request, this means that req.read() would have
had to have been called and so none of the above applies and the client has had
to send some of the data anyway.

All you can achieve by using the file callbacks is to detect that the extension
is unacceptable before the client has sent too much data by sending back
the error response. You can't stop all of it being sent and how much will still
be sent will depend a bit of buffering within the network, by Apache and how
big a chunks of data FieldStorage consumes in one go.

Graham
From grahamd at dscpl.com.au  Wed Jan 24 17:04:10 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Jan 24 17:04:16 2007
Subject: [mod_python] modpy3.2 + apache2.2 + odbc + dbisam -
	substitutetocgi ?
Message-ID: <1169676250.28903@dscpl.user.openhosting.com>

durumdara wrote ..
> Hi!
> 
> Sorry, but I not understand it fully.
> I thinking about that:
> 
>     If I do this, only one interpreter created.
>     And this interpreter serve all of the requests.
>     So any concurrent requests are "need to pause" until the interpreter
>     getting free state, and  ready to serve the next request.
> 
> Or I thinking wrong?
> If not, that is making "slow" serving, or not?

As I explained in posts in the last day or so in response to questions by
Suresh, how many Python subinterpreters are created has got nothing to do with
concurrency of requests. Subinterpreters are used merely to keep data from
different applications linked to different URLs separate so they do not
interfere with each other. Even if all requests are handled within the one
subinterpreter, there can still be concurrent requests being handled at the
same time within different threads where a multithreaded MPM is used such as on
Windows or with worker MPM on UNIX.

Thus, forcing the "main_interpreter" to be used is not an issue, will not slow
down handling of requests and may solve problems caused by poorly written
third party extensions for Python which expect to be run from the first Python
interpreter created within a process.

> Any question that if I must use cgi, can I use template system without
> any problems? Rendering is need apache import? If yes, it is not working
> in normal interpreter...

You can use any template system you want in CGI provided that it isn't dependent
on mod_python. Ie., you can't use mod_python.psp for example, and can otherwise
work with CGI environment.

Graham

> Thanks for your help:
>     dd
> 
> Graham Dumpleton wrote:
> > If not doing so already, force all your mod_python request handlers to
> run
> > within the context of the first Python interpreter instance created by
> > mod_python by using:
> >
> >   PythonInterpeter main_interpreter
> >
> > I think you need to have at least mod_python 3.2.10 for this to
> > be of any use because of bugs in earlier versions of mod_python.
> >
> > This can be required where third party Python modules are not written
> > correctly so as to be usable from secondary interpreters. For more
> > details on what this issue is about, see:
> >
> >   http://issues.apache.org/jira/browse/MODPYTHON-77
> >
> > That said, this may not help at all and is just a guess.
> >
> > Graham
> >
> > durumdara wrote ..
> >   
> >> Hi!
> >>
> >> My problem is that:
> >>
> >> I need to use DBISAM databases.
> >> There is no native Python driver for DBISAM, but DBISAM have ODBC driver.
> >>
> >> I build two sites with DBISAM local database, and with ODBC drived by
> >> pywin32 odbc module.
> >> Everything is worked good (it seems to be) if I drop my cursors on every
> >> request.
> >>
> >> But now I needed to change ODBC to remote mode (to read remote database).
> >> Yesterday I simple changed the settings of the driver, and next I found
> >> me in the hell... :-(((
> >>
> >> In every 2.-3. request the httpd.exe is crashed. No error msg. generated
> >> (logs), only Windows create some dumps about it.
> >> In the event log I see that ntdll.dll and sometimes the odbc.pyd is
> the
> >> source of the error.
> >> Interesting thing, that my sites are working good with odbc.pyd and
> >> DBISAM when they are not used remote databases.
> >>
> >> I tried everything: I set MaxReqPChild to 1 (to cleanup), close 
> >> cursors/databases on finishing of scripts, etc.
> >> When I try to do same thing with normal python interpreter, I cannot
> do
> >> it. I can open many-many connections, and they are cleaned up normally...
> >>
> >> Next I downloaded mxODBC, and tried it. It is working good, but it's
> >> prices are not good for me.
> >>
> >> Today I download the pyodbc package, but it is possible not thread-safe.
> >> Or possible it is not working good later, I don't know.
> >> I have not experienced with this.
> >>
> >> BUT IF WILL NOT WORKING, I WILL NEED SOME CHANGING.
> >>
> >> So:
> >> I need some information to prepare to change if needed.
> >> There is two way to working with dbisam + odbc under apache.
> >> First: I need to write a database server (socketserver) that communicate
> >> beetween my apache processes and ODBC database. It is payful.
> >> Second: I need to change to cgi mode to avoid these problems.
> >>
> >> Please help me: what you offer me when I want to use cgi? The modpy
> >> library can supports this working mode? Or what I need to do for it?
> >> Please offer me some library, and example to prepare if the problems
> >> appearing!
> >>
> >> Thanks for your help:
> >>     dd
> >>
> >> _______________________________________________
> >> Mod_python mailing list
> >> Mod_python@modpython.org
> >> http://mailman.modpython.org/mailman/listinfo/mod_python
> >>     
> >
> >   
From grahamd at dscpl.com.au  Wed Jan 24 17:16:57 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Jan 24 17:17:03 2007
Subject: [mod_python] how to handle xforms with publisher handler
Message-ID: <1169677017.2192@dscpl.user.openhosting.com>

Thanks, I've added a link to this in issue:

  http://issues.apache.org/jira/browse/MODPYTHON-210

Note though that patch as is can't be used as it looks like you use "set" which only
newer versions of Python support. Python 2.3 is still supported by mod_python.

A similar thing to this splitting up has to be done for cookies, so something like
the Cookie._parse_cookie might be able to be done.

Graham

Emiliano Moscato wrote ..
> Hi, I'm sorry, I've forgot to send this lines:
> 
>         # figure out boundary
>         try:
>             i = ctype.lower().rindex("boundary=")
>             end = set([ctype.find(';', i+9), ctype.find(' ', i+9)])
>             end.discard(-1)
>             if len(end) > 0:
>                 boundary = ctype[i+9:min(list(end))]
>             else:
>                 boundary = ctype[i+9:]
>             boundary_str = boundary
>             if len(boundary) >= 2 and boundary[0] == boundary[-1] == '"':
>                 boundary = boundary[1:-1]
>             boundary = re.compile("--" + re.escape(boundary) + "(--)?\r?\n")
> 
> 
>         except ValueError:
>             raise apache.SERVER_RETURN, apache.HTTP_BAD_REQUEST
> 
> 
> Is a little long, but I didn't find a shorter way.
> 
> Graham et all, I'm interested on the another tip (how to treat xml dom
> models), I'd like to know your opinion about my opinion sent with the first
> bugfix. I'd like to use mod_python (and publisher handler if possible)
> in
> our framework.
> Thanks
> 
> Emiliano
> 
> 2007/1/17, Graham Dumpleton <grahamd@dscpl.com.au>:
> >
> > Emiliano Moscato wrote ..
> > > Hi;
> > >
> > > I've followed my tiny work with FieldStorage.
> > > I changed the line:
> > >             boundary = ctype[i+9:]
> > > for:
> > >             boundary = ctype[i+9:ctype.find(';',i+9)]
> > > to fix the problem with boundary.
> >
> > I don't think this will always work. Where there is no semicolon then
> the
> > result would be:
> >
> >   boundary = ctype[i+9:-1]
> >
> > This would have the affect of dropping off the last character in the
> value
> > which may be part of the boundary tag or the quote which might surround
> > it.
> >
> > Graham
> >
> >
> > > I've tried to use this method without any other change to FieldStorage
> > > and
> > > works. I only need this bugfix and it is a good new for me.
> > > On the other hand, I was thinking about the matter with
> > "application/xml"
> > > serialize method and the name of the method says all: who uses
> > > "application/xml" as serialize method waits in the server for an xml
> > > document, not for its mapping to a dict, and it have nothing to do
> with
> > > xforms.
> > > For example: cherryPy, where I come from, uses the same philosophy
> of
> > put
> > > the form fields as attributes of an object, but when it receives an
> > > "application/xml" puts it available in "threadData" attribute.
> > > Thanks for the attention :)
> > >
> > > Emiliano
> > >
> >
> 
> 
> -- 
> mOsKi
> "No hay nada que uno haga mal , lo que hay es poco vino." Autor Anonimo
From mboorshtein at gmail.com  Wed Jan 24 18:12:15 2007
From: mboorshtein at gmail.com (Marc Boorshtein)
Date: Wed Jan 24 18:12:22 2007
Subject: [mod_python] Help with mod_python, mod_proxy & cookies
Message-ID: <800df6390701241512r4d01fcccqe15bca38ad4f05a8@mail.gmail.com>

All,

I am trying to figure out a way to use mod python to change the Cookie
header of a request and then pass the request off to mod_proxy.  When
the response comes I wish to be able to adjust any Set-Cookie headers
in the response back to the client.  I did something similar in
mod_perl using filters and am assuming it would be a similar process.
I wrote a quick input filter to trace the data going through the
filter and found a few issues:

1.  When I have a ProxyPass in my httpd config, apache doesn't fire my filter
2.  When I remove the ProxyPass rule my filter fires, but no data
seems to be going through it
3.  When I specify AddInputFilter, is there anyway to have it apply
globally (as opposed to for a particular file extension)?

Here's my code:

from mod_python import apache

def inputfilter(filter):
    apache.log_error('in filter');
    s = filter.read()
    apache.log_error('begin data');
    while s:
        apache.log_error('data : ' + s);
        filter.write(s.upper())
        s = filter.read()
    apache.log_error('end data');

    if s is None:
        filter.close()

Here's my apache config:
<VirtualHost *>
  PythonDebug On
  PythonPath "sys.path + ['/home/mlb/workspace/Python\ CookieFilter/src']"
  PythonInputFilter CookieFilterInbound COOKIEINBOUND
  AddInputFilter COOKIEINBOUND .html
   ProxyPass / http://localhost:8080/
</VirtualHost>

Here's my log:

[Wed Jan 24 16:28:25 2007] [notice] Apache/2.2.3 (Fedora) configured
-- resuming normal operations
[Wed Jan 24 16:28:28 2007] [notice] mod_python: (Re)importing module
'CookieFilterInbound'
[Wed Jan 24 16:28:28 2007] [error] in filter
[Wed Jan 24 16:28:28 2007] [error] begin data
[Wed Jan 24 16:28:28 2007] [error] end data
[Wed Jan 24 16:28:28 2007] [error] [client 127.0.0.1] File does not
exist: /var/www/html/showcookie.html
[Wed Jan 24 16:28:28 2007] [error] in filter
[Wed Jan 24 16:28:28 2007] [error] begin data
[Wed Jan 24 16:28:28 2007] [error] end data
[Wed Jan 24 16:29:23 2007] [notice] caught SIGTERM, shutting down

Any help would be greatly appreciated.

Thanks
Marc
From nick at dd.revealed.net  Wed Jan 24 17:50:44 2007
From: nick at dd.revealed.net (Nick)
Date: Wed Jan 24 18:24:23 2007
Subject: [mod_python] how to handle xforms with publisher handler
In-Reply-To: <1169677017.2192@dscpl.user.openhosting.com>
References: <1169677017.2192@dscpl.user.openhosting.com>
Message-ID: <45B7E2C4.8080905@dd.revealed.net>

You probably could adapt this to use Set (in the sets module), which became 
available in the standard lib in 2.3.

Nick

Graham Dumpleton wrote:
> Thanks, I've added a link to this in issue:
> 
>   http://issues.apache.org/jira/browse/MODPYTHON-210
> 
> Note though that patch as is can't be used as it looks like you use "set" which only
> newer versions of Python support. Python 2.3 is still supported by mod_python.
> 
> A similar thing to this splitting up has to be done for cookies, so something like
> the Cookie._parse_cookie might be able to be done.
> 
> Graham
> 
> Emiliano Moscato wrote ..
>> Hi, I'm sorry, I've forgot to send this lines:
>>
>>         # figure out boundary
>>         try:
>>             i = ctype.lower().rindex("boundary=")
>>             end = set([ctype.find(';', i+9), ctype.find(' ', i+9)])
>>             end.discard(-1)
>>             if len(end) > 0:
>>                 boundary = ctype[i+9:min(list(end))]
>>             else:
>>                 boundary = ctype[i+9:]
>>             boundary_str = boundary
>>             if len(boundary) >= 2 and boundary[0] == boundary[-1] == '"':
>>                 boundary = boundary[1:-1]
>>             boundary = re.compile("--" + re.escape(boundary) + "(--)?\r?\n")
>>
>>
>>         except ValueError:
>>             raise apache.SERVER_RETURN, apache.HTTP_BAD_REQUEST
>>
>>
>> Is a little long, but I didn't find a shorter way.
>>
>> Graham et all, I'm interested on the another tip (how to treat xml dom
>> models), I'd like to know your opinion about my opinion sent with the first
>> bugfix. I'd like to use mod_python (and publisher handler if possible)
>> in
>> our framework.
>> Thanks
>>
>> Emiliano
>>
>> 2007/1/17, Graham Dumpleton <grahamd@dscpl.com.au>:
>>> Emiliano Moscato wrote ..
>>>> Hi;
>>>>
>>>> I've followed my tiny work with FieldStorage.
>>>> I changed the line:
>>>>             boundary = ctype[i+9:]
>>>> for:
>>>>             boundary = ctype[i+9:ctype.find(';',i+9)]
>>>> to fix the problem with boundary.
>>> I don't think this will always work. Where there is no semicolon then
>> the
>>> result would be:
>>>
>>>   boundary = ctype[i+9:-1]
>>>
>>> This would have the affect of dropping off the last character in the
>> value
>>> which may be part of the boundary tag or the quote which might surround
>>> it.
>>>
>>> Graham
>>>
>>>
>>>> I've tried to use this method without any other change to FieldStorage
>>>> and
>>>> works. I only need this bugfix and it is a good new for me.
>>>> On the other hand, I was thinking about the matter with
>>> "application/xml"
>>>> serialize method and the name of the method says all: who uses
>>>> "application/xml" as serialize method waits in the server for an xml
>>>> document, not for its mapping to a dict, and it have nothing to do
>> with
>>>> xforms.
>>>> For example: cherryPy, where I come from, uses the same philosophy
>> of
>>> put
>>>> the form fields as attributes of an object, but when it receives an
>>>> "application/xml" puts it available in "threadData" attribute.
>>>> Thanks for the attention :)
>>>>
>>>> Emiliano
>>>>
>>
>> -- 
>> mOsKi
>> "No hay nada que uno haga mal , lo que hay es poco vino." Autor Anonimo
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From grahamd at dscpl.com.au  Wed Jan 24 18:47:11 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Jan 24 18:47:17 2007
Subject: [mod_python] Help with mod_python, mod_proxy & cookies
Message-ID: <1169682431.9601@dscpl.user.openhosting.com>

Marc Boorshtein wrote ..
> All,
> 
> I am trying to figure out a way to use mod python to change the Cookie
> header of a request and then pass the request off to mod_proxy.  When
> the response comes I wish to be able to adjust any Set-Cookie headers
> in the response back to the client.  I did something similar in
> mod_perl using filters and am assuming it would be a similar process.
> I wrote a quick input filter to trace the data going through the
> filter and found a few issues:
> 
> 1.  When I have a ProxyPass in my httpd config, apache doesn't fire my
> filter
> 2.  When I remove the ProxyPass rule my filter fires, but no data
> seems to be going through it
> 3.  When I specify AddInputFilter, is there anyway to have it apply
> globally (as opposed to for a particular file extension)?

Use SetInputFilter. This should be mentioned in Apache documentation
where AddInputFilter is described.

> Here's my code:
> 
> from mod_python import apache
> 
> def inputfilter(filter):
>     apache.log_error('in filter');
>     s = filter.read()
>     apache.log_error('begin data');
>     while s:
>         apache.log_error('data : ' + s);
>         filter.write(s.upper())
>         s = filter.read()
>     apache.log_error('end data');
> 
>     if s is None:
>         filter.close()
> 
> Here's my apache config:
> <VirtualHost *>
>   PythonDebug On
>   PythonPath "sys.path + ['/home/mlb/workspace/Python\ CookieFilter/src']"
>   PythonInputFilter CookieFilterInbound COOKIEINBOUND
>   AddInputFilter COOKIEINBOUND .html
>    ProxyPass / http://localhost:8080/
> </VirtualHost>
> 
> Here's my log:
> 
> [Wed Jan 24 16:28:25 2007] [notice] Apache/2.2.3 (Fedora) configured
> -- resuming normal operations
> [Wed Jan 24 16:28:28 2007] [notice] mod_python: (Re)importing module
> 'CookieFilterInbound'
> [Wed Jan 24 16:28:28 2007] [error] in filter
> [Wed Jan 24 16:28:28 2007] [error] begin data
> [Wed Jan 24 16:28:28 2007] [error] end data
> [Wed Jan 24 16:28:28 2007] [error] [client 127.0.0.1] File does not
> exist: /var/www/html/showcookie.html
> [Wed Jan 24 16:28:28 2007] [error] in filter
> [Wed Jan 24 16:28:28 2007] [error] begin data
> [Wed Jan 24 16:28:28 2007] [error] end data
> [Wed Jan 24 16:29:23 2007] [notice] caught SIGTERM, shutting down
> 
> Any help would be greatly appreciated.

I don't believe you need to use an input filter, you could instead use a
fixup handler to do everything, including enabling of the proxy itself.

 <VirtualHost *>
   PythonDebug On
   PythonPath "sys.path + ['/home/mlb/workspace/Python CookieFilter/src']"
   PythonFixupHandler myredirectandcookiefixup
 </VirtualHost>

For starters, below (myredirectandcookiefixup.py) is how you initiate proxying.

import posixpath

from mod_python import apache

def fixuphandler(req):

  if req.proxyreq:
    return apache.DECLINED

  normalised_uri = posixpath.normpath(req.uri)

  if normalised_uri:
    if normalised_uri != '/' and req.uri[-1] == '/':
      normalised_uri += '/'

  length = len(req.filename)
  length -= len(req.hlist.directory) - 1
  length += len(req.path_info or '')

  baseurl = normalised_uri[:-length]
  path = normalised_uri[len(baseurl):]

  req.proxyreq = apache.PROXYREQ_REVERSE
  req.uri = 'http://localhost:8080' + path
  req.filename = 'proxy:%s' % req.uri
  req.handler = 'proxy-server'

  return apache.OK

All you then need to do is incorporate into this some code which uses
req.headers_in to get to the cookie headers, strip them apart, change
them as needed and then reassign them back into req.headers_in.
When the "proxy-server" handler is run, it will take the headers from
req.headers_in and use them when passing data through to backend.

You will need to have mod_python 3.3.0b for this to work though.

For more on enabling proxying in this way, see:

  http://issues.apache.org/jira/browse/MODPYTHON-141

and the mailing list discussion linked to it.

Graham
From grahamd at dscpl.com.au  Wed Jan 24 18:56:38 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Jan 24 18:56:50 2007
Subject: [mod_python] Help with mod_python, mod_proxy & cookies
Message-ID: <1169682998.14377@dscpl.user.openhosting.com>

Graham Dumpleton wrote ..
> Marc Boorshtein wrote ..
> > All,
> > 
> > I am trying to figure out a way to use mod python to change the Cookie
> > header of a request and then pass the request off to mod_proxy.  When
> > the response comes I wish to be able to adjust any Set-Cookie headers
> > in the response back to the client.  I did something similar in
> > mod_perl using filters and am assuming it would be a similar process.
> > I wrote a quick input filter to trace the data going through the
> > filter and found a few issues:
> > 
> > 1.  When I have a ProxyPass in my httpd config, apache doesn't fire my
> > filter
> > 2.  When I remove the ProxyPass rule my filter fires, but no data
> > seems to be going through it
> > 3.  When I specify AddInputFilter, is there anyway to have it apply
> > globally (as opposed to for a particular file extension)?
> 
> Use SetInputFilter. This should be mentioned in Apache documentation
> where AddInputFilter is described.
> 
> > Here's my code:
> > 
> > from mod_python import apache
> > 
> > def inputfilter(filter):
> >     apache.log_error('in filter');
> >     s = filter.read()
> >     apache.log_error('begin data');
> >     while s:
> >         apache.log_error('data : ' + s);
> >         filter.write(s.upper())
> >         s = filter.read()
> >     apache.log_error('end data');
> > 
> >     if s is None:
> >         filter.close()
> > 
> > Here's my apache config:
> > <VirtualHost *>
> >   PythonDebug On
> >   PythonPath "sys.path + ['/home/mlb/workspace/Python\ CookieFilter/src']"
> >   PythonInputFilter CookieFilterInbound COOKIEINBOUND
> >   AddInputFilter COOKIEINBOUND .html
> >    ProxyPass / http://localhost:8080/
> > </VirtualHost>
> > 
> > Here's my log:
> > 
> > [Wed Jan 24 16:28:25 2007] [notice] Apache/2.2.3 (Fedora) configured
> > -- resuming normal operations
> > [Wed Jan 24 16:28:28 2007] [notice] mod_python: (Re)importing module
> > 'CookieFilterInbound'
> > [Wed Jan 24 16:28:28 2007] [error] in filter
> > [Wed Jan 24 16:28:28 2007] [error] begin data
> > [Wed Jan 24 16:28:28 2007] [error] end data
> > [Wed Jan 24 16:28:28 2007] [error] [client 127.0.0.1] File does not
> > exist: /var/www/html/showcookie.html
> > [Wed Jan 24 16:28:28 2007] [error] in filter
> > [Wed Jan 24 16:28:28 2007] [error] begin data
> > [Wed Jan 24 16:28:28 2007] [error] end data
> > [Wed Jan 24 16:29:23 2007] [notice] caught SIGTERM, shutting down
> > 
> > Any help would be greatly appreciated.
> 
> I don't believe you need to use an input filter, you could instead use
> a
> fixup handler to do everything, including enabling of the proxy itself.
> 
>  <VirtualHost *>
>    PythonDebug On
>    PythonPath "sys.path + ['/home/mlb/workspace/Python CookieFilter/src']"
>    PythonFixupHandler myredirectandcookiefixup
>  </VirtualHost>
> 
> For starters, below (myredirectandcookiefixup.py) is how you initiate proxying.
> 
> import posixpath
> 
> from mod_python import apache
> 
> def fixuphandler(req):
> 
>   if req.proxyreq:
>     return apache.DECLINED
> 
>   normalised_uri = posixpath.normpath(req.uri)
> 
>   if normalised_uri:
>     if normalised_uri != '/' and req.uri[-1] == '/':
>       normalised_uri += '/'
> 
>   length = len(req.filename)
>   length -= len(req.hlist.directory) - 1
>   length += len(req.path_info or '')
> 
>   baseurl = normalised_uri[:-length]
>   path = normalised_uri[len(baseurl):]
> 
>   req.proxyreq = apache.PROXYREQ_REVERSE
>   req.uri = 'http://localhost:8080' + path
>   req.filename = 'proxy:%s' % req.uri
>   req.handler = 'proxy-server'
> 
>   return apache.OK
> 
> All you then need to do is incorporate into this some code which uses
> req.headers_in to get to the cookie headers, strip them apart, change
> them as needed and then reassign them back into req.headers_in.
> When the "proxy-server" handler is run, it will take the headers from
> req.headers_in and use them when passing data through to backend.
> 
> You will need to have mod_python 3.3.0b for this to work though.
> 
> For more on enabling proxying in this way, see:
> 
>   http://issues.apache.org/jira/browse/MODPYTHON-141
> 
> and the mailing list discussion linked to it.

Forgot the second half of the problem. In the same file add:

  def mycookiefixup(filter):
    # interrogate req.headers_out, get out cookie headers, change
    # them and ressign it.
    filter.pass_on()

Then in the fixuphandler() have:

  req.register_output_filter("MYCOOKIEFIXUP", mycookiefixup)
  req.add_output_filter("MYCOOKIEFIXUP")

This will register the filter function as an output filter from within
the handler, allow you to change the cookies on the way back as
well.

Again, this requires mod_python 3.3.0b.

Graham
From mboorshtein at gmail.com  Wed Jan 24 19:04:03 2007
From: mboorshtein at gmail.com (Marc Boorshtein)
Date: Wed Jan 24 19:04:11 2007
Subject: [mod_python] Help with mod_python, mod_proxy & cookies
In-Reply-To: <1169682998.14377@dscpl.user.openhosting.com>
References: <1169682998.14377@dscpl.user.openhosting.com>
Message-ID: <800df6390701241604k60bfb8a7i46bd29b2d72348cc@mail.gmail.com>

THANKS!
>
> Again, this requires mod_python 3.3.0b.

Whats in mod_python 3.3.0b that this requires?
From grahamd at dscpl.com.au  Wed Jan 24 19:13:28 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Jan 24 19:13:42 2007
Subject: [mod_python] Help with mod_python, mod_proxy & cookies
Message-ID: <1169684008.22114@dscpl.user.openhosting.com>

Marc Boorshtein wrote ..
> THANKS!
> >
> > Again, this requires mod_python 3.3.0b.
> 
> Whats in mod_python 3.3.0b that this requires?

Prior to mod_python 3.3.0b you couldn't change req.uri so as to set up
what 'proxy-server' expects to see. Also, mod_python 3.3.0b added the
ability to create Python based input/output filter functions that could then
be registered and enabled for just the current request from inside the
handler itself using an actual reference to the function object.

You can find mod_python 3.3.0b at:

  http://httpd.apache.org/modules/python-download.cgi

if you aren't currently using it.

Graham
From mboorshtein at gmail.com  Wed Jan 24 19:34:37 2007
From: mboorshtein at gmail.com (Marc Boorshtein)
Date: Wed Jan 24 19:34:43 2007
Subject: [mod_python] Help with mod_python, mod_proxy & cookies
In-Reply-To: <1169684008.22114@dscpl.user.openhosting.com>
References: <1169684008.22114@dscpl.user.openhosting.com>
Message-ID: <800df6390701241634h647cf17bsaf7bf86aa8121011@mail.gmail.com>

Thanks again for your help.  I've got two last questions:

1. when is 3.3 estimated to go gold?
2. do you have any notion of how much overhead mod_python would add to
a regular reverse proxy?

Thanks Again!
Marc
From grahamd at dscpl.com.au  Wed Jan 24 19:45:19 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Jan 24 19:45:30 2007
Subject: [mod_python] Help with mod_python, mod_proxy & cookies
Message-ID: <1169685919.3968@dscpl.user.openhosting.com>

Marc Boorshtein wrote ..
> Thanks again for your help.  I've got two last questions:
> 
> 1. when is 3.3 estimated to go gold?

There hasn't been a single complaint about 3.3.0b since it was released back
before Christmas. I don't know whether this is because no one is using it, or
because it is working out to be so good. The only thing probably stopping it
from being released as non beta is apathy on our part. ;-)

> 2. do you have any notion of how much overhead mod_python would add to
> a regular reverse proxy?

It wouldn't be much as the fixuphandler is called only once per request and
even the output filter is only called once with the output filter not actually
process the body of the response at all, just fiddling the headers and then
stepping out of the way. Only your own testing will indicate for sure what
the overhead will be.

Graham
From mboorshtein at gmail.com  Wed Jan 24 20:18:13 2007
From: mboorshtein at gmail.com (Marc Boorshtein)
Date: Wed Jan 24 20:18:18 2007
Subject: [mod_python] Help with mod_python, mod_proxy & cookies
In-Reply-To: <1169685919.3968@dscpl.user.openhosting.com>
References: <1169685919.3968@dscpl.user.openhosting.com>
Message-ID: <800df6390701241718r5b7e73e3xd5408184e2488359@mail.gmail.com>

> > 1. when is 3.3 estimated to go gold?
>
> There hasn't been a single complaint about 3.3.0b since it was released back
> before Christmas. I don't know whether this is because no one is using it, or
> because it is working out to be so good. The only thing probably stopping it
> from being released as non beta is apathy on our part. ;-)
>

fair enough.  need to tell my boss something to make him happy :-D

> > 2. do you have any notion of how much overhead mod_python would add to
> > a regular reverse proxy?
>
> It wouldn't be much as the fixuphandler is called only once per request and
> even the output filter is only called once with the output filter not actually
> process the body of the response at all, just fiddling the headers and then
> stepping out of the way. Only your own testing will indicate for sure what
> the overhead will be.
>

good to know, will be running some performance tests in the next week
or so (assuming I get the code to work).

Thanks Again!
Marc
From jpg at jgassociates.ca  Wed Jan 24 21:46:08 2007
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Wed Jan 24 21:44:11 2007
Subject: [mod_python] Help with mod_python, mod_proxy & cookies
In-Reply-To: <1169685919.3968@dscpl.user.openhosting.com>
References: <1169685919.3968@dscpl.user.openhosting.com>
Message-ID: <45B819F0.3080808@jgassociates.ca>

Graham Dumpleton wrote:
> Marc Boorshtein wrote ..
>> Thanks again for your help.  I've got two last questions:
>>
>> 1. when is 3.3 estimated to go gold?
> 
> There hasn't been a single complaint about 3.3.0b since it was released back
> before Christmas. I don't know whether this is because no one is using it, or
> because it is working out to be so good. The only thing probably stopping it
> from being released as non beta is apathy on our part. ;-)

Indeed. I can't see any reason to delay it any longer.

Jim
From moski666 at gmail.com  Wed Jan 24 21:56:06 2007
From: moski666 at gmail.com (Emiliano Moscato)
Date: Wed Jan 24 21:56:15 2007
Subject: [mod_python] how to handle xforms with publisher handler
In-Reply-To: <1169677017.2192@dscpl.user.openhosting.com>
References: <1169677017.2192@dscpl.user.openhosting.com>
Message-ID: <4388f4180701241856p6907efd5paa027956b69f4128@mail.gmail.com>

Hi all;

Even though nobody answer my question about "application/xml" here is the
0.3 version patch for problem with "multipart/*", available for python 2.3;)
I think that it'll work...
Regards

Emiliano

       # figure out boundary
       try:
           i = ctype.lower().rindex("boundary=")
           end = [ctype.find(';', i+9),ctype.find(' ', i+9)]
           def not_minus_one(x): return x != -1
           filter(not_minus_one, end)
           if len(end) > 0:
               boundary = ctype[i+9:min(end)]
           else:
               boundary = ctype[i+9:]
           if len(boundary) >= 2 and boundary[0] == boundary[-1] == '"':
               boundary = boundary[1:-1]
           boundary = re.compile("--" + re.escape(boundary) + "(--)?\r?\n")

2007/1/24, Graham Dumpleton <grahamd@dscpl.com.au>:
>
> Thanks, I've added a link to this in issue:
>
>   http://issues.apache.org/jira/browse/MODPYTHON-210
>
> Note though that patch as is can't be used as it looks like you use "set"
> which only
> newer versions of Python support. Python 2.3 is still supported by
> mod_python.
>
> A similar thing to this splitting up has to be done for cookies, so
> something like
> the Cookie._parse_cookie might be able to be done.
>
> Graham
>
> Emiliano Moscato wrote ..
> > Hi, I'm sorry, I've forgot to send this lines:
> >
> >         # figure out boundary
> >         try:
> >             i = ctype.lower().rindex("boundary=")
> >             end = set([ctype.find(';', i+9), ctype.find(' ', i+9)])
> >             end.discard(-1)
> >             if len(end) > 0:
> >                 boundary = ctype[i+9:min(list(end))]
> >             else:
> >                 boundary = ctype[i+9:]
> >             boundary_str = boundary
> >             if len(boundary) >= 2 and boundary[0] == boundary[-1] ==
> '"':
> >                 boundary = boundary[1:-1]
> >             boundary = re.compile("--" + re.escape(boundary) +
> "(--)?\r?\n")
> >
> >
> >         except ValueError:
> >             raise apache.SERVER_RETURN, apache.HTTP_BAD_REQUEST
> >
> >
> > Is a little long, but I didn't find a shorter way.
> >
> > Graham et all, I'm interested on the another tip (how to treat xml dom
> > models), I'd like to know your opinion about my opinion sent with the
> first
> > bugfix. I'd like to use mod_python (and publisher handler if possible)
> > in
> > our framework.
> > Thanks
> >
> > Emiliano
> >
> > 2007/1/17, Graham Dumpleton <grahamd@dscpl.com.au>:
> > >
> > > Emiliano Moscato wrote ..
> > > > Hi;
> > > >
> > > > I've followed my tiny work with FieldStorage.
> > > > I changed the line:
> > > >             boundary = ctype[i+9:]
> > > > for:
> > > >             boundary = ctype[i+9:ctype.find(';',i+9)]
> > > > to fix the problem with boundary.
> > >
> > > I don't think this will always work. Where there is no semicolon then
> > the
> > > result would be:
> > >
> > >   boundary = ctype[i+9:-1]
> > >
> > > This would have the affect of dropping off the last character in the
> > value
> > > which may be part of the boundary tag or the quote which might
> surround
> > > it.
> > >
> > > Graham
> > >
> > >
> > > > I've tried to use this method without any other change to
> FieldStorage
> > > > and
> > > > works. I only need this bugfix and it is a good new for me.
> > > > On the other hand, I was thinking about the matter with
> > > "application/xml"
> > > > serialize method and the name of the method says all: who uses
> > > > "application/xml" as serialize method waits in the server for an xml
> > > > document, not for its mapping to a dict, and it have nothing to do
> > with
> > > > xforms.
> > > > For example: cherryPy, where I come from, uses the same philosophy
> > of
> > > put
> > > > the form fields as attributes of an object, but when it receives an
> > > > "application/xml" puts it available in "threadData" attribute.
> > > > Thanks for the attention :)
> > > >
> > > > Emiliano
> > > >
> > >
> >
> >
> > --
> > mOsKi
> > "No hay nada que uno haga mal , lo que hay es poco vino." Autor Anonimo
>



-- 
mOsKi
"No hay nada que uno haga mal , lo que hay es poco vino." Autor Anonimo
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070124/c1742091/attachment-0001.html
From grahamd at dscpl.com.au  Wed Jan 24 22:13:29 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Jan 24 22:13:35 2007
Subject: [mod_python] how to handle xforms with publisher handler
Message-ID: <1169694809.5717@dscpl.user.openhosting.com>

Emiliano Moscato wrote ..
> Hi all;
> 
> Even though nobody answer my question about "application/xml"

I already pointed out the following in the original discussion:

  http://issues.apache.org/jira/browse/MODPYTHON-29

The issue is to what degree mod_python.publisher should be generalised
to allow stuff beyond what it can do now. Making such a change needs a
consensus from enough people who understand the issues that changing
it would be a good idea. Although I have raised it previously no one has
ever commented on it.

Graham

> here is the
> 0.3 version patch for problem with "multipart/*", available for python
> 2.3;)
> I think that it'll work...
> Regards
> 
> Emiliano
> 
>        # figure out boundary
>        try:
>            i = ctype.lower().rindex("boundary=")
>            end = [ctype.find(';', i+9),ctype.find(' ', i+9)]
>            def not_minus_one(x): return x != -1
>            filter(not_minus_one, end)
>            if len(end) > 0:
>                boundary = ctype[i+9:min(end)]
>            else:
>                boundary = ctype[i+9:]
>            if len(boundary) >= 2 and boundary[0] == boundary[-1] == '"':
>                boundary = boundary[1:-1]
>            boundary = re.compile("--" + re.escape(boundary) + "(--)?\r?\n")
> 
> 2007/1/24, Graham Dumpleton <grahamd@dscpl.com.au>:
> >
> > Thanks, I've added a link to this in issue:
> >
> >   http://issues.apache.org/jira/browse/MODPYTHON-210
> >
> > Note though that patch as is can't be used as it looks like you use "set"
> > which only
> > newer versions of Python support. Python 2.3 is still supported by
> > mod_python.
> >
> > A similar thing to this splitting up has to be done for cookies, so
> > something like
> > the Cookie._parse_cookie might be able to be done.
> >
> > Graham
> >
> > Emiliano Moscato wrote ..
> > > Hi, I'm sorry, I've forgot to send this lines:
> > >
> > >         # figure out boundary
> > >         try:
> > >             i = ctype.lower().rindex("boundary=")
> > >             end = set([ctype.find(';', i+9), ctype.find(' ', i+9)])
> > >             end.discard(-1)
> > >             if len(end) > 0:
> > >                 boundary = ctype[i+9:min(list(end))]
> > >             else:
> > >                 boundary = ctype[i+9:]
> > >             boundary_str = boundary
> > >             if len(boundary) >= 2 and boundary[0] == boundary[-1] ==
> > '"':
> > >                 boundary = boundary[1:-1]
> > >             boundary = re.compile("--" + re.escape(boundary) +
> > "(--)?\r?\n")
> > >
> > >
> > >         except ValueError:
> > >             raise apache.SERVER_RETURN, apache.HTTP_BAD_REQUEST
> > >
> > >
> > > Is a little long, but I didn't find a shorter way.
> > >
> > > Graham et all, I'm interested on the another tip (how to treat xml
> dom
> > > models), I'd like to know your opinion about my opinion sent with the
> > first
> > > bugfix. I'd like to use mod_python (and publisher handler if possible)
> > > in
> > > our framework.
> > > Thanks
> > >
> > > Emiliano
> > >
> > > 2007/1/17, Graham Dumpleton <grahamd@dscpl.com.au>:
> > > >
> > > > Emiliano Moscato wrote ..
> > > > > Hi;
> > > > >
> > > > > I've followed my tiny work with FieldStorage.
> > > > > I changed the line:
> > > > >             boundary = ctype[i+9:]
> > > > > for:
> > > > >             boundary = ctype[i+9:ctype.find(';',i+9)]
> > > > > to fix the problem with boundary.
> > > >
> > > > I don't think this will always work. Where there is no semicolon
> then
> > > the
> > > > result would be:
> > > >
> > > >   boundary = ctype[i+9:-1]
> > > >
> > > > This would have the affect of dropping off the last character in
> the
> > > value
> > > > which may be part of the boundary tag or the quote which might
> > surround
> > > > it.
> > > >
> > > > Graham
> > > >
> > > >
> > > > > I've tried to use this method without any other change to
> > FieldStorage
> > > > > and
> > > > > works. I only need this bugfix and it is a good new for me.
> > > > > On the other hand, I was thinking about the matter with
> > > > "application/xml"
> > > > > serialize method and the name of the method says all: who uses
> > > > > "application/xml" as serialize method waits in the server for an
> xml
> > > > > document, not for its mapping to a dict, and it have nothing to
> do
> > > with
> > > > > xforms.
> > > > > For example: cherryPy, where I come from, uses the same philosophy
> > > of
> > > > put
> > > > > the form fields as attributes of an object, but when it receives
> an
> > > > > "application/xml" puts it available in "threadData" attribute.
> > > > > Thanks for the attention :)
> > > > >
> > > > > Emiliano
> > > > >
> > > >
> > >
> > >
> > > --
> > > mOsKi
> > > "No hay nada que uno haga mal , lo que hay es poco vino." Autor Anonimo
> >
> 
> 
> 
> -- 
> mOsKi
> "No hay nada que uno haga mal , lo que hay es poco vino." Autor Anonimo
From moski666 at gmail.com  Wed Jan 24 22:23:12 2007
From: moski666 at gmail.com (Emiliano Moscato)
Date: Wed Jan 24 22:23:18 2007
Subject: [mod_python] how to handle xforms with publisher handler
In-Reply-To: <1169694809.5717@dscpl.user.openhosting.com>
References: <1169694809.5717@dscpl.user.openhosting.com>
Message-ID: <4388f4180701241923l67d35005v41e30c2c4dd1764@mail.gmail.com>

Ok, I'm sorry but I didn't know the mechanism, I'm an old user of free
software and open source, but new in collaborating :)
Regards

2007/1/25, Graham Dumpleton <grahamd@dscpl.com.au>:
>
> Emiliano Moscato wrote ..
> > Hi all;
> >
> > Even though nobody answer my question about "application/xml"
>
> I already pointed out the following in the original discussion:
>
>   http://issues.apache.org/jira/browse/MODPYTHON-29
>
> The issue is to what degree mod_python.publisher should be generalised
> to allow stuff beyond what it can do now. Making such a change needs a
> consensus from enough people who understand the issues that changing
> it would be a good idea. Although I have raised it previously no one has
> ever commented on it.
>
> Graham
>
> > here is the
> > 0.3 version patch for problem with "multipart/*", available for python
> > 2.3;)
> > I think that it'll work...
> > Regards
> >
> > Emiliano
> >
> >        # figure out boundary
> >        try:
> >            i = ctype.lower().rindex("boundary=")
> >            end = [ctype.find(';', i+9),ctype.find(' ', i+9)]
> >            def not_minus_one(x): return x != -1
> >            filter(not_minus_one, end)
> >            if len(end) > 0:
> >                boundary = ctype[i+9:min(end)]
> >            else:
> >                boundary = ctype[i+9:]
> >            if len(boundary) >= 2 and boundary[0] == boundary[-1] == '"':
> >                boundary = boundary[1:-1]
> >            boundary = re.compile("--" + re.escape(boundary) +
> "(--)?\r?\n")
> >
> > 2007/1/24, Graham Dumpleton <grahamd@dscpl.com.au>:
> > >
> > > Thanks, I've added a link to this in issue:
> > >
> > >   http://issues.apache.org/jira/browse/MODPYTHON-210
> > >
> > > Note though that patch as is can't be used as it looks like you use
> "set"
> > > which only
> > > newer versions of Python support. Python 2.3 is still supported by
> > > mod_python.
> > >
> > > A similar thing to this splitting up has to be done for cookies, so
> > > something like
> > > the Cookie._parse_cookie might be able to be done.
> > >
> > > Graham
> > >
> > > Emiliano Moscato wrote ..
> > > > Hi, I'm sorry, I've forgot to send this lines:
> > > >
> > > >         # figure out boundary
> > > >         try:
> > > >             i = ctype.lower().rindex("boundary=")
> > > >             end = set([ctype.find(';', i+9), ctype.find(' ', i+9)])
> > > >             end.discard(-1)
> > > >             if len(end) > 0:
> > > >                 boundary = ctype[i+9:min(list(end))]
> > > >             else:
> > > >                 boundary = ctype[i+9:]
> > > >             boundary_str = boundary
> > > >             if len(boundary) >= 2 and boundary[0] == boundary[-1] ==
> > > '"':
> > > >                 boundary = boundary[1:-1]
> > > >             boundary = re.compile("--" + re.escape(boundary) +
> > > "(--)?\r?\n")
> > > >
> > > >
> > > >         except ValueError:
> > > >             raise apache.SERVER_RETURN, apache.HTTP_BAD_REQUEST
> > > >
> > > >
> > > > Is a little long, but I didn't find a shorter way.
> > > >
> > > > Graham et all, I'm interested on the another tip (how to treat xml
> > dom
> > > > models), I'd like to know your opinion about my opinion sent with
> the
> > > first
> > > > bugfix. I'd like to use mod_python (and publisher handler if
> possible)
> > > > in
> > > > our framework.
> > > > Thanks
> > > >
> > > > Emiliano
> > > >
> > > > 2007/1/17, Graham Dumpleton <grahamd@dscpl.com.au>:
> > > > >
> > > > > Emiliano Moscato wrote ..
> > > > > > Hi;
> > > > > >
> > > > > > I've followed my tiny work with FieldStorage.
> > > > > > I changed the line:
> > > > > >             boundary = ctype[i+9:]
> > > > > > for:
> > > > > >             boundary = ctype[i+9:ctype.find(';',i+9)]
> > > > > > to fix the problem with boundary.
> > > > >
> > > > > I don't think this will always work. Where there is no semicolon
> > then
> > > > the
> > > > > result would be:
> > > > >
> > > > >   boundary = ctype[i+9:-1]
> > > > >
> > > > > This would have the affect of dropping off the last character in
> > the
> > > > value
> > > > > which may be part of the boundary tag or the quote which might
> > > surround
> > > > > it.
> > > > >
> > > > > Graham
> > > > >
> > > > >
> > > > > > I've tried to use this method without any other change to
> > > FieldStorage
> > > > > > and
> > > > > > works. I only need this bugfix and it is a good new for me.
> > > > > > On the other hand, I was thinking about the matter with
> > > > > "application/xml"
> > > > > > serialize method and the name of the method says all: who uses
> > > > > > "application/xml" as serialize method waits in the server for an
> > xml
> > > > > > document, not for its mapping to a dict, and it have nothing to
> > do
> > > > with
> > > > > > xforms.
> > > > > > For example: cherryPy, where I come from, uses the same
> philosophy
> > > > of
> > > > > put
> > > > > > the form fields as attributes of an object, but when it receives
> > an
> > > > > > "application/xml" puts it available in "threadData" attribute.
> > > > > > Thanks for the attention :)
> > > > > >
> > > > > > Emiliano
> > > > > >
> > > > >
> > > >
> > > >
> > > > --
> > > > mOsKi
> > > > "No hay nada que uno haga mal , lo que hay es poco vino." Autor
> Anonimo
> > >
> >
> >
> >
> > --
> > mOsKi
> > "No hay nada que uno haga mal , lo que hay es poco vino." Autor Anonimo
>



-- 
mOsKi
"No hay nada que uno haga mal , lo que hay es poco vino." Autor Anonimo
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070125/8054e82b/attachment.html
From mboorshtein at gmail.com  Wed Jan 24 22:48:39 2007
From: mboorshtein at gmail.com (Marc Boorshtein)
Date: Wed Jan 24 22:48:44 2007
Subject: [mod_python] Help with mod_python, mod_proxy & cookies
In-Reply-To: <1169682998.14377@dscpl.user.openhosting.com>
References: <1169682998.14377@dscpl.user.openhosting.com>
Message-ID: <800df6390701241948n789ce3b0pda5cc3db16db0b9c@mail.gmail.com>

>
> Forgot the second half of the problem. In the same file add:
>
>   def mycookiefixup(filter):
>     # interrogate req.headers_out, get out cookie headers, change
>     # them and ressign it.
>     filter.pass_on()
>
> Then in the fixuphandler() have:
>
>   req.register_output_filter("MYCOOKIEFIXUP", mycookiefixup)
>   req.add_output_filter("MYCOOKIEFIXUP")
>
> This will register the filter function as an output filter from within
> the handler, allow you to change the cookies on the way back as
> well.

OK, this works ALMOST perfectly.  What about an equivalent to
ReverseProxyPass? I need to be able to handle redirects with cookies
as well.

Thanks!
From grahamd at dscpl.com.au  Wed Jan 24 23:02:13 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Jan 24 23:02:25 2007
Subject: [mod_python] Help with mod_python, mod_proxy & cookies
Message-ID: <1169697733.27598@dscpl.user.openhosting.com>

Marc Boorshtein wrote ..
> >
> > Forgot the second half of the problem. In the same file add:
> >
> >   def mycookiefixup(filter):
> >     # interrogate req.headers_out, get out cookie headers, change
> >     # them and ressign it.
> >     filter.pass_on()
> >
> > Then in the fixuphandler() have:
> >
> >   req.register_output_filter("MYCOOKIEFIXUP", mycookiefixup)
> >   req.add_output_filter("MYCOOKIEFIXUP")
> >
> > This will register the filter function as an output filter from within
> > the handler, allow you to change the cookies on the way back as
> > well.
> 
> OK, this works ALMOST perfectly.  What about an equivalent to
> ReverseProxyPass? I need to be able to handle redirects with cookies
> as well.

Do you mean ProxyPassReverse?

The example should have been equivalent to that. The values for proxyreq are:

  PROXYREQ_NONE = 0       # No proxy
  PROXYREQ_PROXY = 1      # Standard proxy
  PROXYREQ_REVERSE = 2    # Reverse proxy
  PROXYREQ_RESPONSE = 3   # Origin response

I believe that PROXYREQ_PROXY is equivalent to ProxyPass and PROXYREQ_REVERSE
as used is equivalent to ProxyPassReverse.

If you need Apache 2.2 equivalent of ProxyPassReverseCookieDomain or
ProxyPassReverseCookiePath then I don't know how to set that up and would
need to look again at Apache source. I don't know what fixups you were
wanting to make to the cookies, but it wasn't something you could just
do with these Apache 2.2 directives is it?

Graham
From nlv11281 at natlab.research.philips.com  Thu Jan 25 01:30:17 2007
From: nlv11281 at natlab.research.philips.com (Mike Looijmans)
Date: Thu Jan 25 01:30:26 2007
Subject: [mod_python] Is it  possible to stop  file uploading?
In-Reply-To: <1169675593.23605@dscpl.user.openhosting.com>
References: <1169675593.23605@dscpl.user.openhosting.com>
Message-ID: <45B84E79.4080501@natlab.research.philips.com>

In addition to Graham's (as usual much more useful and less cryptic) 
response, I think you can detect the request for a '100-continue' 
because the browser sends out a "Expect: continue" or something like 
that (don't have the exact information here, but RFC2068 will help you 
out).

The only way to stop the client from sending you data once the 
100-continue has been sent is to close the underlying socket connection. 
It is good practice to send a "Connection: Close" header along with your 
error response. The underlying socket is available as req.connection if 
i'm not mistaken. This is not very "nice" to the client, and should be 
used only if you expect really big downloads. You might want to check 
the Content-Length of the upload - if it is less than say 16k, it is 
probably more efficient to just "eat" the data even though you're not 
going to process it.

--
Mike Looijmans
Philips Natlab / Topic Automation


Graham Dumpleton wrote:
> Mike Looijmans wrote ..
> 
>>>1.When a user uploads file, using FORM ( POST method), is there a  possibility
>>
>>to stop 
>>
>>>uploading, if the file extension  is not among those  allowed? 
>>
>>Yes. Write out an error and close the HTTP connection.
> 
> 
> Actually, whether you can stop the client sending any of the actual data
> contained in the body of the POST request depends on a few issues.
> 
> First off, if the client is using the HTTP 1.0 protocol the answer is that you
> cannot. This is because with HTTP 1.0 protocol the client will immediately
> start sending the body of the POST. Thus even if the server side returns an
> error status based on looking at only the URL for the request, the client will
> already have potentially sent all the actual data. The return of the error from
> a handler on the server should result in the connection being dropped and so
> the server will not read the data, but this will not have prevented some amount
> of bandwidth being used up by the client to send the data anyway. How much data
> the client will have sent will depend on how much will get buffered by the
> connection before it would have detected the connection had closed.
> 
> If the client is using the HTTP/1.1 protocol it gets more interesting. This is
> because HTTP/1.1 implements a mechanism whereby a client can request that the
> server send a 100 continue status response before it will actually start
> sending the body of the POST request. This is something that is dealt with at a
> lower layer than mod_python so you don't have to worry about it yourself. How
> it works with mod_python though, is that the very first time that the handler
> calls req.read(), the lower level layers will take that as meaning you are
> ready to start consuming the data and so Apache will send back a 100 continue
> response to the client and it will only then start sending the data. If rather
> than call req.read(), the handler returns an error response instead, then the
> client will see the error response and will stop before it has even sent the
> body of the POST request.
> 
> So, although with both HTTP 1.0 and 1.1, the way to end the request early is to
> send the error response, only with HTTP 1.1 protocol may you be able to get the
> client to stop before it has actually sent any data at all. This though can
> only be achieved if you can determine whether the request should be aborted
> from just the URL and the request headers. If the only way you can work out if
> the request is to be aborted is from the actual body of the POST request, then
> none of this applies and the client is always going to send some amount of
> the data anyway.
> 
> 
>>>2.
>>>Is there a good/recommended way how to find out the file extension?
>>>I use a handler that can find the extension( using  util.FieldStorage(req))
>>>but it does not stop uploading in progress but uploads the whole file
>>
>>first.
>>
>>Create a FieldStorage instance, and pass it the callbacks for file 
>>processing. You'll be called while the file stream is being read, and 
>>you can check the extension at that time.
> 
> 
> As pointed out above though, if the extension is being derived from the
> filename attribute of the Content-Disposition header within a part of the
> multipart/mixed body of the POST request, this means that req.read() would have
> had to have been called and so none of the above applies and the client has had
> to send some of the data anyway.
> 
> All you can achieve by using the file callbacks is to detect that the extension
> is unacceptable before the client has sent too much data by sending back
> the error response. You can't stop all of it being sent and how much will still
> be sent will depend a bit of buffering within the network, by Apache and how
> big a chunks of data FieldStorage consumes in one go.
> 
> Graham
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 

From export at hope.cz  Thu Jan 25 04:14:16 2007
From: export at hope.cz (export@hope.cz)
Date: Thu Jan 25 04:14:26 2007
Subject: [mod_python] Is it  possible to stop  file uploading?
Message-ID: <45B882F8.2437.AF254BA@export.hope.cz>

Graham and Mike
Thank you for help and some explanation about my question.
Mike you say:"It is good practice to send a "Connection: Close" header along with your
error response",
But how shall I send that?Can you please send detail?
Thank you again for help
Lad.



From grahamd at dscpl.com.au  Thu Jan 25 04:37:24 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Jan 25 04:39:10 2007
Subject: [mod_python] Is it  possible to stop  file uploading?
In-Reply-To: <45B882F8.2437.AF254BA@export.hope.cz>
References: <45B882F8.2437.AF254BA@export.hope.cz>
Message-ID: <298EE92A-9D5E-4654-AE3C-67F4ABD4BD63@dscpl.com.au>


On 25/01/2007, at 8:14 PM, export@hope.cz wrote:

> Graham and Mike
> Thank you for help and some explanation about my question.
> Mike you say:"It is good practice to send a "Connection: Close"  
> header along with your
> error response",
> But how shall I send that?Can you please send detail?
> Thank you again for help

Probably simpler to return an error status of HTTP_BAD_REQUEST. This
is one of the error status values which is guaranteed to always  
result in the
connection being closed even if keep alive was requested. There are  
others
which do the same, but I guess it depends on what one classifies a  
request
to upload an unsupported file type as.

Overall the logic for determining if keep alive is maintained is  
quite convoluted.

#define ap_status_drops_connection(x) \
                                    (((x) ==  
HTTP_BAD_REQUEST)           || \
                                     ((x) ==  
HTTP_REQUEST_TIME_OUT)      || \
                                     ((x) ==  
HTTP_LENGTH_REQUIRED)       || \
                                     ((x) ==  
HTTP_REQUEST_ENTITY_TOO_LARGE) || \
                                     ((x) ==  
HTTP_REQUEST_URI_TOO_LARGE) || \
                                     ((x) ==  
HTTP_INTERNAL_SERVER_ERROR) || \
                                     ((x) ==  
HTTP_SERVICE_UNAVAILABLE) || \
                                     ((x) == HTTP_NOT_IMPLEMENTED))

     /* The following convoluted conditional determines whether or not
      * the current connection should remain persistent after this  
response
      * (a.k.a. HTTP Keep-Alive) and whether or not the output message
      * body should use the HTTP/1.1 chunked transfer-coding.  In  
English,
      *
      *   IF  we have not marked this connection as errored;
      *   and the response body has a defined length due to the  
status code
      *       being 304 or 204, the request method being HEAD, already
      *       having defined Content-Length or Transfer-Encoding:  
chunked, or
      *       the request version being HTTP/1.1 and thus capable of  
being set
      *       as chunked [we know the (r->chunked = 1) side-effect is  
ugly];
      *   and the server configuration enables keep-alive;
      *   and the server configuration has a reasonable inter-request  
timeout;
      *   and there is no maximum # requests or the max hasn't been  
reached;
      *   and the response status does not require a close;
      *   and the response generator has not already indicated close;
      *   and the client did not request non-persistence (Connection:  
close);
      *   and    we haven't been configured to ignore the buggy twit
      *       or they're a buggy twit coming through a HTTP/1.1 proxy
      *   and    the client is requesting an HTTP/1.0-style keep-alive
      *       or the client claims to be HTTP/1.1 compliant (perhaps  
a proxy);
      *   THEN we can be persistent, which requires more headers be  
output.
      *
      * Note that the condition evaluation order is extremely important.
      */

     if ((r->connection->keepalive != AP_CONN_CLOSE)
         && ((r->status == HTTP_NOT_MODIFIED)
             || (r->status == HTTP_NO_CONTENT)
             || r->header_only
             || apr_table_get(r->headers_out, "Content-Length")
             || ap_find_last_token(r->pool,
                                   apr_table_get(r->headers_out,
                                                 "Transfer-Encoding"),
                                   "chunked")
             || ((r->proto_num >= HTTP_VERSION(1,1))
                 && (r->chunked = 1))) /* THIS CODE IS CORRECT, see  
above. */
         && r->server->keep_alive
         && (r->server->keep_alive_timeout > 0)
         && ((r->server->keep_alive_max == 0)
             || (r->server->keep_alive_max > r->connection->keepalives))
         && !ap_status_drops_connection(r->status)
         && !wimpy
         && !ap_find_token(r->pool, conn, "close")
         && (!apr_table_get(r->subprocess_env, "nokeepalive")
             || apr_table_get(r->headers_in, "Via"))
         && ((ka_sent = ap_find_token(r->pool, conn, "keep-alive"))
             || (r->proto_num >= HTTP_VERSION(1,1)))) {
         int left = r->server->keep_alive_max - r->connection- 
 >keepalives;

         r->connection->keepalive = AP_CONN_KEEPALIVE;
         r->connection->keepalives++;

From grahamd at dscpl.com.au  Thu Jan 25 04:49:16 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Jan 25 04:50:56 2007
Subject: [mod_python] Is it  possible to stop  file uploading?
In-Reply-To: <298EE92A-9D5E-4654-AE3C-67F4ABD4BD63@dscpl.com.au>
References: <45B882F8.2437.AF254BA@export.hope.cz>
	<298EE92A-9D5E-4654-AE3C-67F4ABD4BD63@dscpl.com.au>
Message-ID: <02929C67-4517-478C-91A6-6CBF10D75E37@dscpl.com.au>

Actually, there is another interesting way one can stop it without
resorting to specific status values. Ie., can be done for OK response
as well. That is:

         && (!apr_table_get(r->subprocess_env, "nokeepalive")

In other words, in your request handler have:

   req.subprocess_env["nokeepalive"] = "1"

Graham

On 25/01/2007, at 8:37 PM, Graham Dumpleton wrote:

>
> On 25/01/2007, at 8:14 PM, export@hope.cz wrote:
>
>> Graham and Mike
>> Thank you for help and some explanation about my question.
>> Mike you say:"It is good practice to send a "Connection: Close"  
>> header along with your
>> error response",
>> But how shall I send that?Can you please send detail?
>> Thank you again for help
>
> Probably simpler to return an error status of HTTP_BAD_REQUEST. This
> is one of the error status values which is guaranteed to always  
> result in the
> connection being closed even if keep alive was requested. There are  
> others
> which do the same, but I guess it depends on what one classifies a  
> request
> to upload an unsupported file type as.
>
> Overall the logic for determining if keep alive is maintained is  
> quite convoluted.
>
> #define ap_status_drops_connection(x) \
>                                    (((x) ==  
> HTTP_BAD_REQUEST)           || \
>                                     ((x) ==  
> HTTP_REQUEST_TIME_OUT)      || \
>                                     ((x) ==  
> HTTP_LENGTH_REQUIRED)       || \
>                                     ((x) ==  
> HTTP_REQUEST_ENTITY_TOO_LARGE) || \
>                                     ((x) ==  
> HTTP_REQUEST_URI_TOO_LARGE) || \
>                                     ((x) ==  
> HTTP_INTERNAL_SERVER_ERROR) || \
>                                     ((x) ==  
> HTTP_SERVICE_UNAVAILABLE) || \
>                                     ((x) == HTTP_NOT_IMPLEMENTED))
>
>     /* The following convoluted conditional determines whether or not
>      * the current connection should remain persistent after this  
> response
>      * (a.k.a. HTTP Keep-Alive) and whether or not the output message
>      * body should use the HTTP/1.1 chunked transfer-coding.  In  
> English,
>      *
>      *   IF  we have not marked this connection as errored;
>      *   and the response body has a defined length due to the  
> status code
>      *       being 304 or 204, the request method being HEAD, already
>      *       having defined Content-Length or Transfer-Encoding:  
> chunked, or
>      *       the request version being HTTP/1.1 and thus capable of  
> being set
>      *       as chunked [we know the (r->chunked = 1) side-effect  
> is ugly];
>      *   and the server configuration enables keep-alive;
>      *   and the server configuration has a reasonable inter- 
> request timeout;
>      *   and there is no maximum # requests or the max hasn't been  
> reached;
>      *   and the response status does not require a close;
>      *   and the response generator has not already indicated close;
>      *   and the client did not request non-persistence  
> (Connection: close);
>      *   and    we haven't been configured to ignore the buggy twit
>      *       or they're a buggy twit coming through a HTTP/1.1 proxy
>      *   and    the client is requesting an HTTP/1.0-style keep-alive
>      *       or the client claims to be HTTP/1.1 compliant (perhaps  
> a proxy);
>      *   THEN we can be persistent, which requires more headers be  
> output.
>      *
>      * Note that the condition evaluation order is extremely  
> important.
>      */
>
>     if ((r->connection->keepalive != AP_CONN_CLOSE)
>         && ((r->status == HTTP_NOT_MODIFIED)
>             || (r->status == HTTP_NO_CONTENT)
>             || r->header_only
>             || apr_table_get(r->headers_out, "Content-Length")
>             || ap_find_last_token(r->pool,
>                                   apr_table_get(r->headers_out,
>                                                 "Transfer-Encoding"),
>                                   "chunked")
>             || ((r->proto_num >= HTTP_VERSION(1,1))
>                 && (r->chunked = 1))) /* THIS CODE IS CORRECT, see  
> above. */
>         && r->server->keep_alive
>         && (r->server->keep_alive_timeout > 0)
>         && ((r->server->keep_alive_max == 0)
>             || (r->server->keep_alive_max > r->connection- 
> >keepalives))
>         && !ap_status_drops_connection(r->status)
>         && !wimpy
>         && !ap_find_token(r->pool, conn, "close")
>         && (!apr_table_get(r->subprocess_env, "nokeepalive")
>             || apr_table_get(r->headers_in, "Via"))
>         && ((ka_sent = ap_find_token(r->pool, conn, "keep-alive"))
>             || (r->proto_num >= HTTP_VERSION(1,1)))) {
>         int left = r->server->keep_alive_max - r->connection- 
> >keepalives;
>
>         r->connection->keepalive = AP_CONN_KEEPALIVE;
>         r->connection->keepalives++;
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
From mboorshtein at gmail.com  Thu Jan 25 05:30:13 2007
From: mboorshtein at gmail.com (Marc Boorshtein)
Date: Thu Jan 25 05:30:18 2007
Subject: [mod_python] Help with mod_python, mod_proxy & cookies
In-Reply-To: <1169697733.27598@dscpl.user.openhosting.com>
References: <1169697733.27598@dscpl.user.openhosting.com>
Message-ID: <800df6390701250230qe3bb0c9p9674028c44ab14f6@mail.gmail.com>

> Do you mean ProxyPassReverse?
>

Yes


> The example should have been equivalent to that. The values for proxyreq are:
>

No, it didn't change the 'Location' header on the 302 response

>   PROXYREQ_NONE = 0       # No proxy
>   PROXYREQ_PROXY = 1      # Standard proxy
>   PROXYREQ_REVERSE = 2    # Reverse proxy
>   PROXYREQ_RESPONSE = 3   # Origin response
>
> I believe that PROXYREQ_PROXY is equivalent to ProxyPass and PROXYREQ_REVERSE
> as used is equivalent to ProxyPassReverse.
>

This didn't seem to be the case.  It was easy to work around though.
I looked for a 302 response and then changed the location header in
the output filter:

if filter.req.status_line[0:3] == '302':
       redirto = filter.req.headers_out['Location']
       rediruri = redirto[redirto.find('/',8):]
       apache.log_error(rediruri)
       filter.req.headers_out['Location'] = 'http://localhost' + rediruri

Needs some better error checking but it works.

Thanks
Marc
From suresh.lakshmanan at gmail.com  Thu Jan 25 05:42:39 2007
From: suresh.lakshmanan at gmail.com (Suresh Lakshmanan)
Date: Thu Jan 25 05:42:46 2007
Subject: [mod_python] how to run multiple subinterpreters from mod_python
In-Reply-To: <bfe260b10701240212o6257c484vdfe6907045d18594@mail.gmail.com>
References: <1169614428.18296@dscpl.user.openhosting.com>
	<bfe260b10701240123i375abfd1ufbbb1079a98443d@mail.gmail.com>
	<45B72D3D.10807@natlab.research.philips.com>
	<bfe260b10701240212o6257c484vdfe6907045d18594@mail.gmail.com>
Message-ID: <bfe260b10701250242p71c0fb5ft878bfc6509af0a78@mail.gmail.com>

looking further ... looks like apache does not give 503. it must be due to
an intermediate proxy that give
503 on a connection timeout when connecting to apache. so, i guess i would
need to configure apache to
accept more number or connections from the network.

can someone please point out what that option is?

On 1/24/07, Suresh Lakshmanan <suresh.lakshmanan@gmail.com> wrote:
>
> you are right! i tried opening two different http clients and they ran
> concurrently!
> thanks.
>
> now my original question remains. why do i get 503? any config change
> i need to make?
>
> On 1/24/07, Mike Looijmans <nlv11281@natlab.research.philips.com> wrote:
> >
> > > i made this test...
> > > for a url say, http://myserver/myapp/test <http://myserver/myapp/test
> > >.
> > > i put sleep in the python handler code.
> > >
> > > //python handler for the above url
> > > {
> > >     import time
> > >     log('before sleep')
> > >     time.sleep(60)
> > >     log('after sleep')
> > > }
> > >
> > > when multiple clients access the url, the calls are serialized. the
> > > second client waits for a minute and then comes to this handler.
> > > why is this so? that's why i was lead to believe that the requests
> > were
> > > serialized.
> >
> > Make sure that your test is correct. A browser will use the same
> > connection for several request, in effect serializing the requests
> > already. Many other HTTP client libraries do the same (which is a good
> > thing).
> >
> > Your best test is to open telnet sessions to port 80, and write "GET
> > /test HTTP/1.0<return><return>" to the telnet session.
> >
> >
>
>
> --
> "Little by little, through patience and repeated effort, the mind will
> become stilled in the Self." - Bhagawad Gita
>



-- 
"Little by little, through patience and repeated effort, the mind will
become stilled in the Self." - Bhagawad Gita
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070125/fe45af8b/attachment.html
From ron at udel.edu  Thu Jan 25 08:24:35 2007
From: ron at udel.edu (Ron Reisor)
Date: Thu Jan 25 08:25:36 2007
Subject: [mod_python] 3.3 going gold?
In-Reply-To: <1169685919.3968@dscpl.user.openhosting.com>
References: <1169685919.3968@dscpl.user.openhosting.com>
Message-ID: <Pine.OSX.4.62.0701250812230.352@zim.nss.udel.edu>

On Wed, 24 Jan 2007, Graham Dumpleton wrote:

> Marc Boorshtein wrote ..
>> Thanks again for your help.  I've got two last questions:
>>
>> 1. when is 3.3 estimated to go gold?
>
> There hasn't been a single complaint about 3.3.0b since it was released back
> before Christmas. I don't know whether this is because no one is using it, or
> because it is working out to be so good. The only thing probably stopping it
> from being released as non beta is apathy on our part. ;-)

Lest the group think their efforts are in vain, I'm using mod_python 
3.3.0b every day with great success. I suggest you go ahead with the 
release.

Thanks for mod_python!

Ron

Ron Reisor <ron@udel.edu> (RWR3)
University of Delaware Information Technologies/Network and Systems Services
Computing Center/192 South Chapel Street/Newark DE, 19716
pgp finger print: 0D 73 06 6F D3 6A 99 D3  F5 D5 6E FF 3B B9 7C 2C
From export at hope.cz  Thu Jan 25 10:45:06 2007
From: export at hope.cz (export@hope.cz)
Date: Thu Jan 25 10:45:20 2007
Subject: [mod_python] How to pass values
Message-ID: <45B8DE92.14124.D378D7@export.hope.cz>

Depending on a value being calculated in input filter,
I will have to  make a decission in request handler.
What is a  way to find out  the value of the variable  from input filter in request handler?
Thank you for help
Lad.


From alainna at pha.jhu.edu  Thu Jan 25 15:33:53 2007
From: alainna at pha.jhu.edu (Alainna C. Wonders)
Date: Thu Jan 25 15:33:59 2007
Subject: [mod_python] Can't get/create handler errors
Message-ID: <Pine.LNX.4.44.0701251531190.21222-100000@skysrv.pha.jhu.edu>



Nope, no message of that sorts in the log file. 

Does this make it even more strange? 

- Alainna


[Previous Message from Jim Gallacher: 

Well, that should work. I assume you are seeing the correct mod_python 
version string in your Apache log after a restart? ie something like:

[Fri Jan 12 17:37:16 2007] [notice] Apache/2.2.3 (Debian) 
mod_python/3.3.0b Python/2.4.4 configured -- resuming normal operations

Jim

From grahamd at dscpl.com.au  Thu Jan 25 16:05:58 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Jan 25 16:06:10 2007
Subject: [mod_python] How to pass values
In-Reply-To: <45B8DE92.14124.D378D7@export.hope.cz>
References: <45B8DE92.14124.D378D7@export.hope.cz>
Message-ID: <3BE66BE5-0D97-4135-8BE4-C334CCD924F3@dscpl.com.au>


On 26/01/2007, at 2:45 AM, export@hope.cz wrote:

> Depending on a value being calculated in input filter,
> I will have to  make a decission in request handler.
> What is a  way to find out  the value of the variable  from input  
> filter in request handler?

I believe this was mentioned before.

In filter, set an attribute on the request object:

   def inputfilter(filter):
     ...
     filter.req.myflag = True
     ...

In the request handler, you can then access that variable.

   def handler(req):
     ...
     if req.myflag:
        ...
     ...

Graham
From export at hope.cz  Fri Jan 26 03:09:00 2007
From: export at hope.cz (export@hope.cz)
Date: Fri Jan 26 03:09:10 2007
Subject: [mod_python] How to pass values
In-Reply-To: <3BE66BE5-0D97-4135-8BE4-C334CCD924F3@dscpl.com.au>
References: <45B8DE92.14124.D378D7@export.hope.cz>
Message-ID: <45B9C52C.21283.4584025@export.hope.cz>

An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070126/1e9008da/attachment.html
From grahamd at dscpl.com.au  Fri Jan 26 04:15:30 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Fri Jan 26 04:15:43 2007
Subject: [mod_python] How to pass values
In-Reply-To: <45B9C52C.21283.4584025@export.hope.cz>
References: <45B8DE92.14124.D378D7@export.hope.cz>
	<45B9C52C.21283.4584025@export.hope.cz>
Message-ID: <F83ECC98-5E16-4971-A8C6-70898A560446@dscpl.com.au>

Your input filter can't have been called then, or not the part where you
assigned the attribute. If the variable may not be there in all  
situations,
then use:

   if hasattr(req, 'myflag'):
     if req.myflag:
       ..

Graham

On 26/01/2007, at 7:09 PM, export@hope.cz wrote:

> Graham ,
> Thank you for your reply and help.
> I tried the way you suggested but I received the error
>
> AttributeError: 'mp_request' object has no attribute 'myflag'
>
> Can you please help?
> Thank you
> Lad.
>
>
> >
> > On 26/01/2007, at 2:45 AM, export@hope.cz wrote:
> >
> > > Depending on a value being calculated in input filter,
> > > I will have to  make a decission in request handler.
> > > What is a  way to find out  the value of the variable  from input
> > > filter in request handler?
> >
> > I believe this was mentioned before.
> >
> > In filter, set an attribute on the request object:
> >
> >    def inputfilter(filter):
> >      ...
> >      filter.req.myflag = True
> >      ...
> >
> > In the request handler, you can then access that variable.
> >
> >    def handler(req):
> >      ...
> >      if req.myflag:
> >         ...
> >      ...
> >
> > Graham
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070126/61e0bc59/attachment.html
From export at hope.cz  Fri Jan 26 06:44:20 2007
From: export at hope.cz (export@hope.cz)
Date: Fri Jan 26 06:44:32 2007
Subject: (Fwd) Re: [mod_python] How to pass values
Message-ID: <45B9F7A4.3241.4C3101@export.hope.cz>

Graham,
Thank you for your reply.
I have

def inputfilter(filter):
filter.req.myflag = True
...
...

so, as you can see the first command in input filter
is filter.req.myflag = True
but yet, I can not access the req.myflag
in my request handler.
When I try
req.write(`req.myflag`)
I will receive the same error:

AttributeError: 'mp_request' object has no attribute 'myflag' 

What shall I try to solve the problem. Do you have any idea?
Thank you
Lad

> Your input filter can't have been called then, or not the part where you
> assigned the attribute. If the variable may not be there in all 
> situations,
> then use:
> 
> if hasattr(req, 'myflag'):
> if req.myflag:
> ..
> 
> Graham
> 
> On 26/01/2007, at 7:09 PM, export@hope.cz wrote:
> 
> > Graham ,
> > Thank you for your reply and help.
> > I tried the way you suggested but I received the error
> >
> > AttributeError: 'mp_request' object has no attribute 'myflag'
> >
> > Can you please help?
> > Thank you
> > Lad.
> >
> >
> > >
> > > On 26/01/2007, at 2:45 AM, export@hope.cz wrote:
> > >
> > > > Depending on a value being calculated in input filter,
> > > > I will have to make a decission in request handler.
> > > > What is a way to find out the value of the variable from input
> > > > filter in request handler?
> > >
> > > I believe this was mentioned before.
> > >
> > > In filter, set an attribute on the request object:
> > >
> > > def inputfilter(filter):
> > > ...
> > > filter.req.myflag = True
> > > ...
> > >
> > > In the request handler, you can then access that variable.
> > >
> > > def handler(req):
> > > ...
> > > if req.myflag:
> > > ...
> > > ...
> > >
> > > Graham
> >
> 
> 


------- End of forwarded message -------
From nogradi at gmail.com  Fri Jan 26 08:05:12 2007
From: nogradi at gmail.com (Daniel Nogradi)
Date: Fri Jan 26 08:05:56 2007
Subject: [mod_python] 3.3 going gold?
In-Reply-To: <Pine.OSX.4.62.0701250812230.352@zim.nss.udel.edu>
References: <1169685919.3968@dscpl.user.openhosting.com>
	<Pine.OSX.4.62.0701250812230.352@zim.nss.udel.edu>
Message-ID: <5f56302b0701260505i43011e5et756af305814e13ec@mail.gmail.com>

> >> Thanks again for your help.  I've got two last questions:
> >>
> >> 1. when is 3.3 estimated to go gold?
> >
> > There hasn't been a single complaint about 3.3.0b since it was released
> back
> > before Christmas. I don't know whether this is because no one is using it,
> or
> > because it is working out to be so good. The only thing probably stopping
> it
> > from being released as non beta is apathy on our part. ;-)
>
> Lest the group think their efforts are in vain, I'm using mod_python
> 3.3.0b every day with great success. I suggest you go ahead with the
> release.
>
> Thanks for mod_python!
>
> Ron

I also use it without problems and have to say that the package itself
as well as the support on this list is far above average.

Thanks very much!

Daniel
From grahamd at dscpl.com.au  Fri Jan 26 16:19:51 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Fri Jan 26 16:20:12 2007
Subject: (Fwd) Re: [mod_python] How to pass values
In-Reply-To: <45B9F7A4.3241.4C3101@export.hope.cz>
References: <45B9F7A4.3241.4C3101@export.hope.cz>
Message-ID: <E8CBA63B-725B-4A0F-ADAE-11DA96C2002B@dscpl.com.au>

Use some standard debugging techniques yourself to try and work it out.

On 26/01/2007, at 10:44 PM, export@hope.cz wrote:

> Graham,
> Thank you for your reply.
> I have
>
> def inputfilter(filter):
> filter.req.myflag = True

Add:

   filter.req.log_error('inputfilter')

> ...
> ...
>
> so, as you can see the first command in input filter
> is filter.req.myflag = True
> but yet, I can not access the req.myflag
> in my request handler.
> When I try
> req.write(`req.myflag`)

Add before this:

   req.log_error('handler')

In other words, use the logging system to dump information into the  
Apache
log files to see if the input filter is actually being called. It  
would look like it
isn't. What have you done so far to confirm it is?

Graham

> I will receive the same error:
>
> AttributeError: 'mp_request' object has no attribute 'myflag'
>
> What shall I try to solve the problem. Do you have any idea?
> Thank you
> Lad
>
>> Your input filter can't have been called then, or not the part  
>> where you
>> assigned the attribute. If the variable may not be there in all
>> situations,
>> then use:
>>
>> if hasattr(req, 'myflag'):
>> if req.myflag:
>> ..
>>
>> Graham
>>
>> On 26/01/2007, at 7:09 PM, export@hope.cz wrote:
>>
>>> Graham ,
>>> Thank you for your reply and help.
>>> I tried the way you suggested but I received the error
>>>
>>> AttributeError: 'mp_request' object has no attribute 'myflag'
>>>
>>> Can you please help?
>>> Thank you
>>> Lad.
>>>
>>>
>>>>
>>>> On 26/01/2007, at 2:45 AM, export@hope.cz wrote:
>>>>
>>>>> Depending on a value being calculated in input filter,
>>>>> I will have to make a decission in request handler.
>>>>> What is a way to find out the value of the variable from input
>>>>> filter in request handler?
>>>>
>>>> I believe this was mentioned before.
>>>>
>>>> In filter, set an attribute on the request object:
>>>>
>>>> def inputfilter(filter):
>>>> ...
>>>> filter.req.myflag = True
>>>> ...
>>>>
>>>> In the request handler, you can then access that variable.
>>>>
>>>> def handler(req):
>>>> ...
>>>> if req.myflag:
>>>> ...
>>>> ...
>>>>
>>>> Graham
>>>
>>
>>
>
>
> ------- End of forwarded message -------
From export at hope.cz  Sat Jan 27 04:01:03 2007
From: export at hope.cz (export@hope.cz)
Date: Sat Jan 27 04:01:19 2007
Subject: (Fwd) Re: [mod_python] How to pass values
In-Reply-To: <E8CBA63B-725B-4A0F-ADAE-11DA96C2002B@dscpl.com.au>
References: <45B9F7A4.3241.4C3101@export.hope.cz>
Message-ID: <45BB22DF.6099.4DD0E11@export.hope.cz>

 Graham,
Thank you for your reply.
So, I used the debugging  techniques like this:

in input filter
###########################
from mod_python import apache,Cookie
def inputfilter(filter):
	filter.req.log_error('Running inputfilter')
	filter.req.log_error('Setting myflag..')
	filter.req.myflag = True
	filter.req.log_error('myflag was set to:')
	filter.req.log_error(`filter.req.myflag`)
	if filter.req.method != 'POST':
		filter.pass_on()
		return
	s = filter.read()
	while s:
		f.write(s)
		f.flush()
		filter.write(s)
		filter.flush()
		s = filter.read()
		
	if s is None:
		filter.close()
		f.close()
########################

in handler 
##########################
   
def handler(req):
     if req.method == 'GET':
	......

    else:
	if  req.method == 'POST':
	 	req.log_error('Myhandler')
		req.log_error('MyHandler, in POST request, has myflag')
		req.log_error(`req.myflag`)
	....
	....
#######################
and here is a part of error log

..
[Sat Jan 27 09:48:54 2007] [notice] Child 2196: Starting thread to listen on port 80.
[Sat Jan 27 09:49:05 2007] [error] [client 127.0.0.1] Running inputfilter
[Sat Jan 27 09:49:05 2007] [error] [client 127.0.0.1] Setting myflag..
[Sat Jan 27 09:49:05 2007] [error] [client 127.0.0.1] myflag was set to:
[Sat Jan 27 09:49:05 2007] [error] [client 127.0.0.1] True
[Sat Jan 27 09:49:05 2007] [error] [client 127.0.0.1] Running inputfilter
[Sat Jan 27 09:49:05 2007] [error] [client 127.0.0.1] Setting myflag..
[Sat Jan 27 09:49:05 2007] [error] [client 127.0.0.1] myflag was set to:
[Sat Jan 27 09:49:05 2007] [error] [client 127.0.0.1] True
[Sat Jan 27 09:49:08 2007] [error] [client 127.0.0.1] Running inputfilter
[Sat Jan 27 09:49:08 2007] [error] [client 127.0.0.1] Setting myflag..
[Sat Jan 27 09:49:08 2007] [error] [client 127.0.0.1] myflag was set to:
[Sat Jan 27 09:49:08 2007] [error] [client 127.0.0.1] True
[Sat Jan 27 09:49:08 2007] [error] [client 127.0.0.1] Running inputfilter
[Sat Jan 27 09:49:08 2007] [error] [client 127.0.0.1] Setting myflag..
[Sat Jan 27 09:49:08 2007] [error] [client 127.0.0.1] myflag was set to:
[Sat Jan 27 09:49:08 2007] [error] [client 127.0.0.1] True
[Sat Jan 27 09:49:12 2007] [error] [client 127.0.0.1] Myhandler, referer: 
http://127.0.0.1/mod/uploadvideo.py?17644
[Sat Jan 27 09:49:12 2007] [error] [client 127.0.0.1] MyHandler, in POST request, has myflag, 
referer: http://127.0.0.1/mod/uploadvideo.py?17644
.....
....
....
[Sat Jan 27 09:49:12 2007] [error] [client 127.0.0.1] AttributeError: 'mp_request' object has no 
attribute 'myflag', referer: http://127.0.0.1/mod/uploadvideo.py?17644
...


Where can be a problem? What shall I try?
Can you see any mistake I make?
Thank you again for help
Lad


> Use some standard debugging techniques yourself to try and work it out.
> 
> On 26/01/2007, at 10:44 PM, export@hope.cz wrote:
> 
> > Graham,
> > Thank you for your reply.
> > I have
> >
> > def inputfilter(filter):
> > filter.req.myflag = True
> 
> Add:
> 
>    filter.req.log_error('inputfilter')
> 
> > ...
> > ...
> >
> > so, as you can see the first command in input filter
> > is filter.req.myflag = True
> > but yet, I can not access the req.myflag
> > in my request handler.
> > When I try
> > req.write(`req.myflag`)
> 
> Add before this:
> 
>    req.log_error('handler')
> 
> In other words, use the logging system to dump information into the  
> Apache
> log files to see if the input filter is actually being called. It  
> would look like it
> isn't. What have you done so far to confirm it is?
> 
> Graham
> 
> > I will receive the same error:
> >
> > AttributeError: 'mp_request' object has no attribute 'myflag'
> >
> > What shall I try to solve the problem. Do you have any idea?
> > Thank you
> > Lad
> >
> >> Your input filter can't have been called then, or not the part  
> >> where you
> >> assigned the attribute. If the variable may not be there in all
> >> situations,
> >> then use:
> >>
> >> if hasattr(req, 'myflag'):
> >> if req.myflag:
> >> ..
> >>
> >> Graham
> >>
> >> On 26/01/2007, at 7:09 PM, export@hope.cz wrote:
> >>
> >>> Graham ,
> >>> Thank you for your reply and help.
> >>> I tried the way you suggested but I received the error
> >>>
> >>> AttributeError: 'mp_request' object has no attribute 'myflag'
> >>>
> >>> Can you please help?
> >>> Thank you
> >>> Lad.
> >>>
> >>>
> >>>>
> >>>> On 26/01/2007, at 2:45 AM, export@hope.cz wrote:
> >>>>
> >>>>> Depending on a value being calculated in input filter,
> >>>>> I will have to make a decission in request handler.
> >>>>> What is a way to find out the value of the variable from input
> >>>>> filter in request handler?
> >>>>
> >>>> I believe this was mentioned before.
> >>>>
> >>>> In filter, set an attribute on the request object:
> >>>>
> >>>> def inputfilter(filter):
> >>>> ...
> >>>> filter.req.myflag = True
> >>>> ...
> >>>>
> >>>> In the request handler, you can then access that variable.
> >>>>
> >>>> def handler(req):
> >>>> ...
> >>>> if req.myflag:
> >>>> ...
> >>>> ...
> >>>>
> >>>> Graham
> >>>
> >>
> >>
> >
> >
> > ------- End of forwarded message -------


From grahamd at dscpl.com.au  Sat Jan 27 06:26:09 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sat Jan 27 06:26:20 2007
Subject: (Fwd) Re: [mod_python] How to pass values
In-Reply-To: <45BB22DF.6099.4DD0E11@export.hope.cz>
References: <45B9F7A4.3241.4C3101@export.hope.cz>
	<45BB22DF.6099.4DD0E11@export.hope.cz>
Message-ID: <BA234C2D-1ED6-4314-AA79-0DB126969375@dscpl.com.au>

There is 4 seconds between the filter call and the handler call. That  
seems a bit
long. Are you sure they come from the same request?

In both filter and handler also log the following attributes:

   req.method
   req.uri
   req.connection.id

For the filter, prefix with 'filter.' to get to req object first  
obviously.

You might also log result of os.getpid() to verify that each is run  
in the same
process.

Anyway, I suspect that it isn't from the same request. What is  
missing here and
you need to understand is that the input filters for a request are  
not actually
called until the handler calls req.read() or one of the other read  
methods of the
request object. It is only after req.read() is called that the  
req.myflag value would
have been set. So, if you haven't called req.read() before accessing  
the attribute
it will fail.

Graham

On 27/01/2007, at 8:01 PM, export@hope.cz wrote:

>  Graham,
> Thank you for your reply.
> So, I used the debugging  techniques like this:
>
> in input filter
> ###########################
> from mod_python import apache,Cookie
> def inputfilter(filter):
> 	filter.req.log_error('Running inputfilter')
> 	filter.req.log_error('Setting myflag..')
> 	filter.req.myflag = True
> 	filter.req.log_error('myflag was set to:')
> 	filter.req.log_error(`filter.req.myflag`)
> 	if filter.req.method != 'POST':
> 		filter.pass_on()
> 		return
> 	s = filter.read()
> 	while s:
> 		f.write(s)
> 		f.flush()
> 		filter.write(s)
> 		filter.flush()
> 		s = filter.read()
> 		
> 	if s is None:
> 		filter.close()
> 		f.close()
> ########################
>
> in handler
> ##########################
>
> def handler(req):
>      if req.method == 'GET':
> 	......
>
>     else:
> 	if  req.method == 'POST':
> 	 	req.log_error('Myhandler')
> 		req.log_error('MyHandler, in POST request, has myflag')
> 		req.log_error(`req.myflag`)
> 	....
> 	....
> #######################
> and here is a part of error log
>
> ..
> [Sat Jan 27 09:48:54 2007] [notice] Child 2196: Starting thread to  
> listen on port 80.
> [Sat Jan 27 09:49:05 2007] [error] [client 127.0.0.1] Running  
> inputfilter
> [Sat Jan 27 09:49:05 2007] [error] [client 127.0.0.1] Setting myflag..
> [Sat Jan 27 09:49:05 2007] [error] [client 127.0.0.1] myflag was  
> set to:
> [Sat Jan 27 09:49:05 2007] [error] [client 127.0.0.1] True
> [Sat Jan 27 09:49:05 2007] [error] [client 127.0.0.1] Running  
> inputfilter
> [Sat Jan 27 09:49:05 2007] [error] [client 127.0.0.1] Setting myflag..
> [Sat Jan 27 09:49:05 2007] [error] [client 127.0.0.1] myflag was  
> set to:
> [Sat Jan 27 09:49:05 2007] [error] [client 127.0.0.1] True
> [Sat Jan 27 09:49:08 2007] [error] [client 127.0.0.1] Running  
> inputfilter
> [Sat Jan 27 09:49:08 2007] [error] [client 127.0.0.1] Setting myflag..
> [Sat Jan 27 09:49:08 2007] [error] [client 127.0.0.1] myflag was  
> set to:
> [Sat Jan 27 09:49:08 2007] [error] [client 127.0.0.1] True
> [Sat Jan 27 09:49:08 2007] [error] [client 127.0.0.1] Running  
> inputfilter
> [Sat Jan 27 09:49:08 2007] [error] [client 127.0.0.1] Setting myflag..
> [Sat Jan 27 09:49:08 2007] [error] [client 127.0.0.1] myflag was  
> set to:
> [Sat Jan 27 09:49:08 2007] [error] [client 127.0.0.1] True
> [Sat Jan 27 09:49:12 2007] [error] [client 127.0.0.1] Myhandler,  
> referer:
> http://127.0.0.1/mod/uploadvideo.py?17644
> [Sat Jan 27 09:49:12 2007] [error] [client 127.0.0.1] MyHandler, in  
> POST request, has myflag,
> referer: http://127.0.0.1/mod/uploadvideo.py?17644
> .....
> ....
> ....
> [Sat Jan 27 09:49:12 2007] [error] [client 127.0.0.1]  
> AttributeError: 'mp_request' object has no
> attribute 'myflag', referer: http://127.0.0.1/mod/uploadvideo.py?17644
> ...
>
>
> Where can be a problem? What shall I try?
> Can you see any mistake I make?
> Thank you again for help
> Lad
>
>
>> Use some standard debugging techniques yourself to try and work it  
>> out.
>>
>> On 26/01/2007, at 10:44 PM, export@hope.cz wrote:
>>
>>> Graham,
>>> Thank you for your reply.
>>> I have
>>>
>>> def inputfilter(filter):
>>> filter.req.myflag = True
>>
>> Add:
>>
>>    filter.req.log_error('inputfilter')
>>
>>> ...
>>> ...
>>>
>>> so, as you can see the first command in input filter
>>> is filter.req.myflag = True
>>> but yet, I can not access the req.myflag
>>> in my request handler.
>>> When I try
>>> req.write(`req.myflag`)
>>
>> Add before this:
>>
>>    req.log_error('handler')
>>
>> In other words, use the logging system to dump information into the
>> Apache
>> log files to see if the input filter is actually being called. It
>> would look like it
>> isn't. What have you done so far to confirm it is?
>>
>> Graham
>>
>>> I will receive the same error:
>>>
>>> AttributeError: 'mp_request' object has no attribute 'myflag'
>>>
>>> What shall I try to solve the problem. Do you have any idea?
>>> Thank you
>>> Lad
>>>
>>>> Your input filter can't have been called then, or not the part
>>>> where you
>>>> assigned the attribute. If the variable may not be there in all
>>>> situations,
>>>> then use:
>>>>
>>>> if hasattr(req, 'myflag'):
>>>> if req.myflag:
>>>> ..
>>>>
>>>> Graham
>>>>
>>>> On 26/01/2007, at 7:09 PM, export@hope.cz wrote:
>>>>
>>>>> Graham ,
>>>>> Thank you for your reply and help.
>>>>> I tried the way you suggested but I received the error
>>>>>
>>>>> AttributeError: 'mp_request' object has no attribute 'myflag'
>>>>>
>>>>> Can you please help?
>>>>> Thank you
>>>>> Lad.
>>>>>
>>>>>
>>>>>>
>>>>>> On 26/01/2007, at 2:45 AM, export@hope.cz wrote:
>>>>>>
>>>>>>> Depending on a value being calculated in input filter,
>>>>>>> I will have to make a decission in request handler.
>>>>>>> What is a way to find out the value of the variable from input
>>>>>>> filter in request handler?
>>>>>>
>>>>>> I believe this was mentioned before.
>>>>>>
>>>>>> In filter, set an attribute on the request object:
>>>>>>
>>>>>> def inputfilter(filter):
>>>>>> ...
>>>>>> filter.req.myflag = True
>>>>>> ...
>>>>>>
>>>>>> In the request handler, you can then access that variable.
>>>>>>
>>>>>> def handler(req):
>>>>>> ...
>>>>>> if req.myflag:
>>>>>> ...
>>>>>> ...
>>>>>>
>>>>>> Graham
>>>>>
>>>>
>>>>
>>>
>>>
>>> ------- End of forwarded message -------
>
From export at hope.cz  Sat Jan 27 07:12:07 2007
From: export at hope.cz (export@hope.cz)
Date: Sat Jan 27 07:12:21 2007
Subject: (Fwd) Re: [mod_python] How to pass values
In-Reply-To: <BA234C2D-1ED6-4314-AA79-0DB126969375@dscpl.com.au>
References: <45BB22DF.6099.4DD0E11@export.hope.cz>
Message-ID: <45BB4FA7.4581.58BFD07@export.hope.cz>

Graham ,
Thank you again  for your help.
So I added .both to input filter and handler
  req.method
  req.uri
   req.connection.id
Now they looks like this:

###############
from mod_python import apache,Cookie
def inputfilter(filter):
	filter.req.log_error('Running inputfilter')
	filter.req.log_error('Setting myflag..')
	filter.req.myflag = True
	filter.req.log_error('myflag was set to:')
	filter.req.log_error(`filter.req.myflag`)
	filter.req.log_error('inputfilter-filter.req.method')
	filter.req.log_error(`filter.req.method`)
	filter.req.log_error('inputfilter-filter.req.uri:')
	filter.req.log_error(`filter.req.uri`)
	filter.req.log_error('inputfilter-filter.req.connection.i.d')
	filter.req.log_error(`filter.req.connection.id`)
	if filter.req.method != 'POST':
		filter.pass_on()
		return
	s = filter.read()
	while s:
		f.write(s)
		f.flush()
		filter.write(s)
		filter.flush()
		s = filter.read()
		
	if s is None:
		filter.close()
		f.close()
###############
and a part of handler looks like this
:
##############
else:
	if  req.method == 'POST':
	 	req.log_error('Myhandler')
		req.log_error('MyHandler, in POST request, has myflag')
		req.log_error('myhandler-req.method')
		req.log_error(`req.method`)
		req.log_error('myhandler-req.uri')
		req.log_error(`req.uri`)
		req.log_error('myhandler-req.connection.id')
		req.log_error(`req.connection.id`)
	
		req.log_error(`req.myflag`)
		
###############

and the error log is here
##################
[Sat Jan 27 13:01:33 2007] [notice] Apache/2.2.4 (Win32) configured -- resuming normal 
operations
[Sat Jan 27 13:01:33 2007] [notice] Server built: Jan  9 2007 23:17:20
[Sat Jan 27 13:01:33 2007] [notice] Parent: Created child process 1864
[Sat Jan 27 13:01:33 2007] [notice] mod_python: Creating 8 session mutexes based on 0 
max processes and 250 max threads.
[Sat Jan 27 13:01:34 2007] [notice] Child 1864: Child process is running
[Sat Jan 27 13:01:34 2007] [notice] Child 1864: Acquired the start mutex.
[Sat Jan 27 13:01:34 2007] [notice] Child 1864: Starting 250 worker threads.
[Sat Jan 27 13:01:34 2007] [notice] Child 1864: Starting thread to listen on port 80.
[Sat Jan 27 13:01:41 2007] [error] [client 127.0.0.1] Running inputfilter
[Sat Jan 27 13:01:41 2007] [error] [client 127.0.0.1] Setting myflag..
[Sat Jan 27 13:01:41 2007] [error] [client 127.0.0.1] myflag was set to:
[Sat Jan 27 13:01:41 2007] [error] [client 127.0.0.1] True
[Sat Jan 27 13:01:41 2007] [error] [client 127.0.0.1] inputfilter-filter.req.method
[Sat Jan 27 13:01:41 2007] [error] [client 127.0.0.1] 'GET'
[Sat Jan 27 13:01:41 2007] [error] [client 127.0.0.1] inputfilter-filter.req.uri:
[Sat Jan 27 13:01:41 2007] [error] [client 127.0.0.1] '/mod/uploadvideo.py'
[Sat Jan 27 13:01:41 2007] [error] [client 127.0.0.1] inputfilter-filter.req.connection.i.d
[Sat Jan 27 13:01:41 2007] [error] [client 127.0.0.1] 236
[Sat Jan 27 13:01:41 2007] [error] [client 127.0.0.1] Running inputfilter
[Sat Jan 27 13:01:41 2007] [error] [client 127.0.0.1] Setting myflag..
[Sat Jan 27 13:01:41 2007] [error] [client 127.0.0.1] myflag was set to:
[Sat Jan 27 13:01:41 2007] [error] [client 127.0.0.1] True
[Sat Jan 27 13:01:41 2007] [error] [client 127.0.0.1] inputfilter-filter.req.method
[Sat Jan 27 13:01:41 2007] [error] [client 127.0.0.1] 'GET'
[Sat Jan 27 13:01:41 2007] [error] [client 127.0.0.1] inputfilter-filter.req.uri:
[Sat Jan 27 13:01:41 2007] [error] [client 127.0.0.1] '/mod/uploadvideo.py'
[Sat Jan 27 13:01:41 2007] [error] [client 127.0.0.1] inputfilter-filter.req.connection.i.d
[Sat Jan 27 13:01:41 2007] [error] [client 127.0.0.1] 236
[Sat Jan 27 13:01:48 2007] [error] [client 127.0.0.1] Myhandler, referer: 
http://127.0.0.1/mod/uploadvideo.py?17644
[Sat Jan 27 13:01:48 2007] [error] [client 127.0.0.1] MyHandler, in POST request, has myflag, 
referer: http://127.0.0.1/mod/uploadvideo.py?17644
[Sat Jan 27 13:01:48 2007] [error] [client 127.0.0.1] myhandler-req.method, referer: 
http://127.0.0.1/mod/uploadvideo.py?17644
[Sat Jan 27 13:01:48 2007] [error] [client 127.0.0.1] 'POST', referer: 
http://127.0.0.1/mod/uploadvideo.py?17644
[Sat Jan 27 13:01:48 2007] [error] [client 127.0.0.1] myhandler-req.uri, referer: 
http://127.0.0.1/mod/uploadvideo.py?17644
[Sat Jan 27 13:01:48 2007] [error] [client 127.0.0.1] '/mod/uploadvideo.py', referer: 
http://127.0.0.1/mod/uploadvideo.py?17644
[Sat Jan 27 13:01:48 2007] [error] [client 127.0.0.1] myhandler-req.connection.id, referer: 
http://127.0.0.1/mod/uploadvideo.py?17644
[Sat Jan 27 13:01:48 2007] [error] [client 127.0.0.1] 236, referer: 
http://127.0.0.1/mod/uploadvideo.py?17644
[Sat Jan 27 13:01:48 2007] [error] [client 127.0.0.1] mod_python (pid=1864, 
interpreter='www.emim.cz', phase='PythonHandler', handler='uploadvideo'): Application error, 
referer: http://127.0.0.1/mod/uploadvideo.py?17644
[Sat Jan 27 13:01:48 2007] [error] [client 127.0.0.1] ServerName: 'www.emim.cz', referer: 
http://127.0.0.1/mod/uploadvideo.py?17644
[Sat Jan 27 13:01:48 2007] [error] [client 127.0.0.1] DocumentRoot: 'C:/Program 
Files/Apache Software Foundation/Apache2.2/htdocs', referer: 
http://127.0.0.1/mod/uploadvideo.py?17644
[Sat Jan 27 13:01:48 2007] [error] [client 127.0.0.1] URI: '/mod/uploadvideo.py', referer: 
http://127.0.0.1/mod/uploadvideo.py?17644
[Sat Jan 27 13:01:48 2007] [error] [client 127.0.0.1] Location: '/mod', referer: 
http://127.0.0.1/mod/uploadvideo.py?17644
[Sat Jan 27 13:01:48 2007] [error] [client 127.0.0.1] Directory: None, referer: 
http://127.0.0.1/mod/uploadvideo.py?17644
[Sat Jan 27 13:01:48 2007] [error] [client 127.0.0.1] Filename: 'C:/Program Files/Apache 
Software Foundation/Apache2.2/htdocs/mod', referer: 
http://127.0.0.1/mod/uploadvideo.py?17644
[Sat Jan 27 13:01:48 2007] [error] [client 127.0.0.1] PathInfo: '/uploadvideo.py', referer: 
http://127.0.0.1/mod/uploadvideo.py?17644
[Sat Jan 27 13:01:48 2007] [error] [client 127.0.0.1] Traceback (most recent call last):, 
referer: http://127.0.0.1/mod/uploadvideo.py?17644
[Sat Jan 27 13:01:48 2007] [error] [client 127.0.0.1]   File "C:\\PYTHON23\\Lib\\site-
packages\\mod_python\\importer.py", line 1537, in HandlerDispatch\n    
default=default_handler, arg=req, silent=hlist.silent), referer: 
http://127.0.0.1/mod/uploadvideo.py?17644
[Sat Jan 27 13:01:48 2007] [error] [client 127.0.0.1]   File "C:\\PYTHON23\\Lib\\site-
packages\\mod_python\\importer.py", line 1229, in _process_target\n    result = 
_execute_target(config, req, object, arg), referer: http://127.0.0.1/mod/uploadvideo.py?17644
[Sat Jan 27 13:01:48 2007] [error] [client 127.0.0.1]   File "C:\\PYTHON23\\Lib\\site-
packages\\mod_python\\importer.py", line 1128, in _execute_target\n    result = object(arg), 
referer: http://127.0.0.1/mod/uploadvideo.py?17644
[Sat Jan 27 13:01:48 2007] [error] [client 127.0.0.1]   File 
"C:/Django/projekty/mimiproject/apps/mimi/mod\\uploadvideo.py", line 69, in handler\n    
req.log_error(`req.myflag`), referer: http://127.0.0.1/mod/uploadvideo.py?17644
[Sat Jan 27 13:01:48 2007] [error] [client 127.0.0.1] AttributeError: 'mp_request' object has no 
attribute 'myflag', referer: http://127.0.0.1/mod/uploadvideo.py?17644
################################

Can you see any problem there?
Thank you for help and reply
Lad.



> 
> There is 4 seconds between the filter call and the handler call. That  
> seems a bit
> long. Are you sure they come from the same request?
> 
> In both filter and handler also log the following attributes:
> 
>    req.method
>    req.uri
>    req.connection.id
> 
> For the filter, prefix with 'filter.' to get to req object first  
> obviously.
> 
> You might also log result of os.getpid() to verify that each is run  
> in the same
> process.
> 
> Anyway, I suspect that it isn't from the same request. What is  
> missing here and
> you need to understand is that the input filters for a request are  
> not actually
> called until the handler calls req.read() or one of the other read  
> methods of the
> request object. It is only after req.read() is called that the  
> req.myflag value would
> have been set. So, if you haven't called req.read() before accessing  
> the attribute
> it will fail.
> 
> Graham
> 
> On 27/01/2007, at 8:01 PM, export@hope.cz wrote:
> 
> >  Graham,
> > Thank you for your reply.
> > So, I used the debugging  techniques like this:
> >
> > in input filter
> > ###########################
> > from mod_python import apache,Cookie
> > def inputfilter(filter):
> > 	filter.req.log_error('Running inputfilter')
> > 	filter.req.log_error('Setting myflag..')
> > 	filter.req.myflag = True
> > 	filter.req.log_error('myflag was set to:')
> > 	filter.req.log_error(`filter.req.myflag`)
> > 	if filter.req.method != 'POST':
> > 		filter.pass_on()
> > 		return
> > 	s = filter.read()
> > 	while s:
> > 		f.write(s)
> > 		f.flush()
> > 		filter.write(s)
> > 		filter.flush()
> > 		s = filter.read()
> > 		
> > 	if s is None:
> > 		filter.close()
> > 		f.close()
> > ########################
> >
> > in handler
> > ##########################
> >
> > def handler(req):
> >      if req.method == 'GET':
> > 	......
> >
> >     else:
> > 	if  req.method == 'POST':
> > 	 	req.log_error('Myhandler')
> > 		req.log_error('MyHandler, in POST request, has myflag')
> > 		req.log_error(`req.myflag`)
> > 	....
> > 	....
> > #######################
> > and here is a part of error log
> >
> > ..
> > [Sat Jan 27 09:48:54 2007] [notice] Child 2196: Starting thread to  
> > listen on port 80.
> > [Sat Jan 27 09:49:05 2007] [error] [client 127.0.0.1] Running  
> > inputfilter
> > [Sat Jan 27 09:49:05 2007] [error] [client 127.0.0.1] Setting myflag..
> > [Sat Jan 27 09:49:05 2007] [error] [client 127.0.0.1] myflag was  
> > set to:
> > [Sat Jan 27 09:49:05 2007] [error] [client 127.0.0.1] True
> > [Sat Jan 27 09:49:05 2007] [error] [client 127.0.0.1] Running  
> > inputfilter
> > [Sat Jan 27 09:49:05 2007] [error] [client 127.0.0.1] Setting myflag..
> > [Sat Jan 27 09:49:05 2007] [error] [client 127.0.0.1] myflag was  
> > set to:
> > [Sat Jan 27 09:49:05 2007] [error] [client 127.0.0.1] True
> > [Sat Jan 27 09:49:08 2007] [error] [client 127.0.0.1] Running  
> > inputfilter
> > [Sat Jan 27 09:49:08 2007] [error] [client 127.0.0.1] Setting myflag..
> > [Sat Jan 27 09:49:08 2007] [error] [client 127.0.0.1] myflag was  
> > set to:
> > [Sat Jan 27 09:49:08 2007] [error] [client 127.0.0.1] True
> > [Sat Jan 27 09:49:08 2007] [error] [client 127.0.0.1] Running  
> > inputfilter
> > [Sat Jan 27 09:49:08 2007] [error] [client 127.0.0.1] Setting myflag..
> > [Sat Jan 27 09:49:08 2007] [error] [client 127.0.0.1] myflag was  
> > set to:
> > [Sat Jan 27 09:49:08 2007] [error] [client 127.0.0.1] True
> > [Sat Jan 27 09:49:12 2007] [error] [client 127.0.0.1] Myhandler,  
> > referer:
> > http://127.0.0.1/mod/uploadvideo.py?17644
> > [Sat Jan 27 09:49:12 2007] [error] [client 127.0.0.1] MyHandler, in  
> > POST request, has myflag,
> > referer: http://127.0.0.1/mod/uploadvideo.py?17644
> > .....
> > ....
> > ....
> > [Sat Jan 27 09:49:12 2007] [error] [client 127.0.0.1]  
> > AttributeError: 'mp_request' object has no
> > attribute 'myflag', referer: http://127.0.0.1/mod/uploadvideo.py?17644
> > ...
> >
> >
> > Where can be a problem? What shall I try?
> > Can you see any mistake I make?
> > Thank you again for help
> > Lad
> >
> >
> >> Use some standard debugging techniques yourself to try and work it  
> >> out.
> >>
> >> On 26/01/2007, at 10:44 PM, export@hope.cz wrote:
> >>
> >>> Graham,
> >>> Thank you for your reply.
> >>> I have
> >>>
> >>> def inputfilter(filter):
> >>> filter.req.myflag = True
> >>
> >> Add:
> >>
> >>    filter.req.log_error('inputfilter')
> >>
> >>> ...
> >>> ...
> >>>
> >>> so, as you can see the first command in input filter
> >>> is filter.req.myflag = True
> >>> but yet, I can not access the req.myflag
> >>> in my request handler.
> >>> When I try
> >>> req.write(`req.myflag`)
> >>
> >> Add before this:
> >>
> >>    req.log_error('handler')
> >>
> >> In other words, use the logging system to dump information into the
> >> Apache
> >> log files to see if the input filter is actually being called. It
> >> would look like it
> >> isn't. What have you done so far to confirm it is?
> >>
> >> Graham
> >>
> >>> I will receive the same error:
> >>>
> >>> AttributeError: 'mp_request' object has no attribute 'myflag'
> >>>
> >>> What shall I try to solve the problem. Do you have any idea?
> >>> Thank you
> >>> Lad
> >>>
> >>>> Your input filter can't have been called then, or not the part
> >>>> where you
> >>>> assigned the attribute. If the variable may not be there in all
> >>>> situations,
> >>>> then use:
> >>>>
> >>>> if hasattr(req, 'myflag'):
> >>>> if req.myflag:
> >>>> ..
> >>>>
> >>>> Graham
> >>>>
> >>>> On 26/01/2007, at 7:09 PM, export@hope.cz wrote:
> >>>>
> >>>>> Graham ,
> >>>>> Thank you for your reply and help.
> >>>>> I tried the way you suggested but I received the error
> >>>>>
> >>>>> AttributeError: 'mp_request' object has no attribute 'myflag'
> >>>>>
> >>>>> Can you please help?
> >>>>> Thank you
> >>>>> Lad.
> >>>>>
> >>>>>
> >>>>>>
> >>>>>> On 26/01/2007, at 2:45 AM, export@hope.cz wrote:
> >>>>>>
> >>>>>>> Depending on a value being calculated in input filter,
> >>>>>>> I will have to make a decission in request handler.
> >>>>>>> What is a way to find out the value of the variable from input
> >>>>>>> filter in request handler?
> >>>>>>
> >>>>>> I believe this was mentioned before.
> >>>>>>
> >>>>>> In filter, set an attribute on the request object:
> >>>>>>
> >>>>>> def inputfilter(filter):
> >>>>>> ...
> >>>>>> filter.req.myflag = True
> >>>>>> ...
> >>>>>>
> >>>>>> In the request handler, you can then access that variable.
> >>>>>>
> >>>>>> def handler(req):
> >>>>>> ...
> >>>>>> if req.myflag:
> >>>>>> ...
> >>>>>> ...
> >>>>>>
> >>>>>> Graham
> >>>>>
> >>>>
> >>>>
> >>>
> >>>
> >>> ------- End of forwarded message -------
> >


From jpg at jgassociates.ca  Sat Jan 27 11:19:46 2007
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Sat Jan 27 11:19:27 2007
Subject: (Fwd) Re: [mod_python] How to pass values
In-Reply-To: <45BB4FA7.4581.58BFD07@export.hope.cz>
References: <45BB22DF.6099.4DD0E11@export.hope.cz>
	<45BB4FA7.4581.58BFD07@export.hope.cz>
Message-ID: <45BB7BA2.1070500@jgassociates.ca>

export@hope.cz wrote:
> Graham ,
> Thank you again  for your help.
> So I added .both to input filter and handler
>   req.method
>   req.uri
>    req.connection.id
> Now they looks like this:
> 
> ###############
> from mod_python import apache,Cookie
> def inputfilter(filter):
> 	filter.req.log_error('Running inputfilter')
> 	filter.req.log_error('Setting myflag..')
> 	filter.req.myflag = True
> 	filter.req.log_error('myflag was set to:')
> 	filter.req.log_error(`filter.req.myflag`)
> 	filter.req.log_error('inputfilter-filter.req.method')
> 	filter.req.log_error(`filter.req.method`)
> 	filter.req.log_error('inputfilter-filter.req.uri:')
> 	filter.req.log_error(`filter.req.uri`)
> 	filter.req.log_error('inputfilter-filter.req.connection.i.d')
> 	filter.req.log_error(`filter.req.connection.id`)
> 	if filter.req.method != 'POST':
> 		filter.pass_on()
> 		return
> 	s = filter.read()
> 	while s:
> 		f.write(s)
> 		f.flush()
> 		filter.write(s)
> 		filter.flush()
> 		s = filter.read()
> 		
> 	if s is None:
> 		filter.close()
> 		f.close()
> ###############
> and a part of handler looks like this
> :
> ##############
> else:
> 	if  req.method == 'POST':
> 	 	req.log_error('Myhandler')
> 		req.log_error('MyHandler, in POST request, has myflag')
> 		req.log_error('myhandler-req.method')
> 		req.log_error(`req.method`)
> 		req.log_error('myhandler-req.uri')
> 		req.log_error(`req.uri`)
> 		req.log_error('myhandler-req.connection.id')
> 		req.log_error(`req.connection.id`)
> 	
> 		req.log_error(`req.myflag`)
> 		
> ###############
> 
> and the error log is here
> ##################
> [Sat Jan 27 13:01:33 2007] [notice] Apache/2.2.4 (Win32) configured -- resuming normal 
> operations
> [Sat Jan 27 13:01:33 2007] [notice] Server built: Jan  9 2007 23:17:20
> [Sat Jan 27 13:01:33 2007] [notice] Parent: Created child process 1864
> [Sat Jan 27 13:01:33 2007] [notice] mod_python: Creating 8 session mutexes based on 0 
> max processes and 250 max threads.
> [Sat Jan 27 13:01:34 2007] [notice] Child 1864: Child process is running
> [Sat Jan 27 13:01:34 2007] [notice] Child 1864: Acquired the start mutex.
> [Sat Jan 27 13:01:34 2007] [notice] Child 1864: Starting 250 worker threads.
> [Sat Jan 27 13:01:34 2007] [notice] Child 1864: Starting thread to listen on port 80.
> [Sat Jan 27 13:01:41 2007] [error] [client 127.0.0.1] Running inputfilter
> [Sat Jan 27 13:01:41 2007] [error] [client 127.0.0.1] Setting myflag..
> [Sat Jan 27 13:01:41 2007] [error] [client 127.0.0.1] myflag was set to:
> [Sat Jan 27 13:01:41 2007] [error] [client 127.0.0.1] True
> [Sat Jan 27 13:01:41 2007] [error] [client 127.0.0.1] inputfilter-filter.req.method
> [Sat Jan 27 13:01:41 2007] [error] [client 127.0.0.1] 'GET'
> [Sat Jan 27 13:01:41 2007] [error] [client 127.0.0.1] inputfilter-filter.req.uri:
> [Sat Jan 27 13:01:41 2007] [error] [client 127.0.0.1] '/mod/uploadvideo.py'
> [Sat Jan 27 13:01:41 2007] [error] [client 127.0.0.1] inputfilter-filter.req.connection.i.d
> [Sat Jan 27 13:01:41 2007] [error] [client 127.0.0.1] 236
> [Sat Jan 27 13:01:41 2007] [error] [client 127.0.0.1] Running inputfilter
> [Sat Jan 27 13:01:41 2007] [error] [client 127.0.0.1] Setting myflag..
> [Sat Jan 27 13:01:41 2007] [error] [client 127.0.0.1] myflag was set to:
> [Sat Jan 27 13:01:41 2007] [error] [client 127.0.0.1] True
> [Sat Jan 27 13:01:41 2007] [error] [client 127.0.0.1] inputfilter-filter.req.method
> [Sat Jan 27 13:01:41 2007] [error] [client 127.0.0.1] 'GET'
> [Sat Jan 27 13:01:41 2007] [error] [client 127.0.0.1] inputfilter-filter.req.uri:
> [Sat Jan 27 13:01:41 2007] [error] [client 127.0.0.1] '/mod/uploadvideo.py'
> [Sat Jan 27 13:01:41 2007] [error] [client 127.0.0.1] inputfilter-filter.req.connection.i.d
> [Sat Jan 27 13:01:41 2007] [error] [client 127.0.0.1] 236
> [Sat Jan 27 13:01:48 2007] [error] [client 127.0.0.1] Myhandler, referer: 
> http://127.0.0.1/mod/uploadvideo.py?17644
> [Sat Jan 27 13:01:48 2007] [error] [client 127.0.0.1] MyHandler, in POST request, has myflag, 
> referer: http://127.0.0.1/mod/uploadvideo.py?17644
> [Sat Jan 27 13:01:48 2007] [error] [client 127.0.0.1] myhandler-req.method, referer: 
> http://127.0.0.1/mod/uploadvideo.py?17644
> [Sat Jan 27 13:01:48 2007] [error] [client 127.0.0.1] 'POST', referer: 
> http://127.0.0.1/mod/uploadvideo.py?17644
> [Sat Jan 27 13:01:48 2007] [error] [client 127.0.0.1] myhandler-req.uri, referer: 
> http://127.0.0.1/mod/uploadvideo.py?17644
> [Sat Jan 27 13:01:48 2007] [error] [client 127.0.0.1] '/mod/uploadvideo.py', referer: 
> http://127.0.0.1/mod/uploadvideo.py?17644
> [Sat Jan 27 13:01:48 2007] [error] [client 127.0.0.1] myhandler-req.connection.id, referer: 
> http://127.0.0.1/mod/uploadvideo.py?17644
> [Sat Jan 27 13:01:48 2007] [error] [client 127.0.0.1] 236, referer: 
> http://127.0.0.1/mod/uploadvideo.py?17644
> [Sat Jan 27 13:01:48 2007] [error] [client 127.0.0.1] mod_python (pid=1864, 
> interpreter='www.emim.cz', phase='PythonHandler', handler='uploadvideo'): Application error, 
> referer: http://127.0.0.1/mod/uploadvideo.py?17644
> [Sat Jan 27 13:01:48 2007] [error] [client 127.0.0.1] ServerName: 'www.emim.cz', referer: 
> http://127.0.0.1/mod/uploadvideo.py?17644
> [Sat Jan 27 13:01:48 2007] [error] [client 127.0.0.1] DocumentRoot: 'C:/Program 
> Files/Apache Software Foundation/Apache2.2/htdocs', referer: 
> http://127.0.0.1/mod/uploadvideo.py?17644
> [Sat Jan 27 13:01:48 2007] [error] [client 127.0.0.1] URI: '/mod/uploadvideo.py', referer: 
> http://127.0.0.1/mod/uploadvideo.py?17644
> [Sat Jan 27 13:01:48 2007] [error] [client 127.0.0.1] Location: '/mod', referer: 
> http://127.0.0.1/mod/uploadvideo.py?17644
> [Sat Jan 27 13:01:48 2007] [error] [client 127.0.0.1] Directory: None, referer: 
> http://127.0.0.1/mod/uploadvideo.py?17644
> [Sat Jan 27 13:01:48 2007] [error] [client 127.0.0.1] Filename: 'C:/Program Files/Apache 
> Software Foundation/Apache2.2/htdocs/mod', referer: 
> http://127.0.0.1/mod/uploadvideo.py?17644
> [Sat Jan 27 13:01:48 2007] [error] [client 127.0.0.1] PathInfo: '/uploadvideo.py', referer: 
> http://127.0.0.1/mod/uploadvideo.py?17644
> [Sat Jan 27 13:01:48 2007] [error] [client 127.0.0.1] Traceback (most recent call last):, 
> referer: http://127.0.0.1/mod/uploadvideo.py?17644
> [Sat Jan 27 13:01:48 2007] [error] [client 127.0.0.1]   File "C:\\PYTHON23\\Lib\\site-
> packages\\mod_python\\importer.py", line 1537, in HandlerDispatch\n    
> default=default_handler, arg=req, silent=hlist.silent), referer: 
> http://127.0.0.1/mod/uploadvideo.py?17644
> [Sat Jan 27 13:01:48 2007] [error] [client 127.0.0.1]   File "C:\\PYTHON23\\Lib\\site-
> packages\\mod_python\\importer.py", line 1229, in _process_target\n    result = 
> _execute_target(config, req, object, arg), referer: http://127.0.0.1/mod/uploadvideo.py?17644
> [Sat Jan 27 13:01:48 2007] [error] [client 127.0.0.1]   File "C:\\PYTHON23\\Lib\\site-
> packages\\mod_python\\importer.py", line 1128, in _execute_target\n    result = object(arg), 
> referer: http://127.0.0.1/mod/uploadvideo.py?17644
> [Sat Jan 27 13:01:48 2007] [error] [client 127.0.0.1]   File 
> "C:/Django/projekty/mimiproject/apps/mimi/mod\\uploadvideo.py", line 69, in handler\n    
> req.log_error(`req.myflag`), referer: http://127.0.0.1/mod/uploadvideo.py?17644
> [Sat Jan 27 13:01:48 2007] [error] [client 127.0.0.1] AttributeError: 'mp_request' object has no 
> attribute 'myflag', referer: http://127.0.0.1/mod/uploadvideo.py?17644
> ################################
> 
> Can you see any problem there?
> Thank you for help and reply
> Lad.
> 
> 
> 
>> There is 4 seconds between the filter call and the handler call. That  
>> seems a bit
>> long. Are you sure they come from the same request?
>>
>> In both filter and handler also log the following attributes:
>>
>>    req.method
>>    req.uri
>>    req.connection.id
>>
>> For the filter, prefix with 'filter.' to get to req object first  
>> obviously.
>>
>> You might also log result of os.getpid() to verify that each is run  
>> in the same
>> process.
>>
>> Anyway, I suspect that it isn't from the same request. What is  
>> missing here and
>> you need to understand is that the input filters for a request are  
>> not actually
>> called until the handler calls req.read() or one of the other read  
>> methods of the
>> request object. It is only after req.read() is called that the  
>> req.myflag value would
>> have been set. So, if you haven't called req.read() before accessing  
>> the attribute
>> it will fail.
>>
>> Graham
>>
>> On 27/01/2007, at 8:01 PM, export@hope.cz wrote:
>>
>>>  Graham,
>>> Thank you for your reply.
>>> So, I used the debugging  techniques like this:
>>>
>>> in input filter
>>> ###########################
>>> from mod_python import apache,Cookie
>>> def inputfilter(filter):
>>> 	filter.req.log_error('Running inputfilter')
>>> 	filter.req.log_error('Setting myflag..')
>>> 	filter.req.myflag = True
>>> 	filter.req.log_error('myflag was set to:')
>>> 	filter.req.log_error(`filter.req.myflag`)
>>> 	if filter.req.method != 'POST':
>>> 		filter.pass_on()
>>> 		return
>>> 	s = filter.read()
>>> 	while s:
>>> 		f.write(s)
>>> 		f.flush()
>>> 		filter.write(s)
>>> 		filter.flush()
>>> 		s = filter.read()
>>> 		
>>> 	if s is None:
>>> 		filter.close()
>>> 		f.close()
>>> ########################
>>>
>>> in handler
>>> ##########################
>>>
>>> def handler(req):
>>>      if req.method == 'GET':
>>> 	......
>>>
>>>     else:
>>> 	if  req.method == 'POST':
>>> 	 	req.log_error('Myhandler')
>>> 		req.log_error('MyHandler, in POST request, has myflag')
>>> 		req.log_error(`req.myflag`)
>>> 	....
>>> 	....
>>> #######################
>>> and here is a part of error log
>>>
>>> ..
>>> [Sat Jan 27 09:48:54 2007] [notice] Child 2196: Starting thread to  
>>> listen on port 80.
>>> [Sat Jan 27 09:49:05 2007] [error] [client 127.0.0.1] Running  
>>> inputfilter
>>> [Sat Jan 27 09:49:05 2007] [error] [client 127.0.0.1] Setting myflag..
>>> [Sat Jan 27 09:49:05 2007] [error] [client 127.0.0.1] myflag was  
>>> set to:
>>> [Sat Jan 27 09:49:05 2007] [error] [client 127.0.0.1] True
>>> [Sat Jan 27 09:49:05 2007] [error] [client 127.0.0.1] Running  
>>> inputfilter
>>> [Sat Jan 27 09:49:05 2007] [error] [client 127.0.0.1] Setting myflag..
>>> [Sat Jan 27 09:49:05 2007] [error] [client 127.0.0.1] myflag was  
>>> set to:
>>> [Sat Jan 27 09:49:05 2007] [error] [client 127.0.0.1] True
>>> [Sat Jan 27 09:49:08 2007] [error] [client 127.0.0.1] Running  
>>> inputfilter
>>> [Sat Jan 27 09:49:08 2007] [error] [client 127.0.0.1] Setting myflag..
>>> [Sat Jan 27 09:49:08 2007] [error] [client 127.0.0.1] myflag was  
>>> set to:
>>> [Sat Jan 27 09:49:08 2007] [error] [client 127.0.0.1] True
>>> [Sat Jan 27 09:49:08 2007] [error] [client 127.0.0.1] Running  
>>> inputfilter
>>> [Sat Jan 27 09:49:08 2007] [error] [client 127.0.0.1] Setting myflag..
>>> [Sat Jan 27 09:49:08 2007] [error] [client 127.0.0.1] myflag was  
>>> set to:
>>> [Sat Jan 27 09:49:08 2007] [error] [client 127.0.0.1] True
>>> [Sat Jan 27 09:49:12 2007] [error] [client 127.0.0.1] Myhandler,  
>>> referer:
>>> http://127.0.0.1/mod/uploadvideo.py?17644
>>> [Sat Jan 27 09:49:12 2007] [error] [client 127.0.0.1] MyHandler, in  
>>> POST request, has myflag,
>>> referer: http://127.0.0.1/mod/uploadvideo.py?17644
>>> .....
>>> ....
>>> ....
>>> [Sat Jan 27 09:49:12 2007] [error] [client 127.0.0.1]  
>>> AttributeError: 'mp_request' object has no
>>> attribute 'myflag', referer: http://127.0.0.1/mod/uploadvideo.py?17644
>>> ...
>>>
>>>
>>> Where can be a problem? What shall I try?
>>> Can you see any mistake I make?

As Graham pointed out you need a call to req.read() or create a 
FieldStorage instance which will do that internally. When I take your 
code snippet and call util.FieldStorage(req) it works just fine.

Jim


>>> Thank you again for help
>>> Lad
>>>
>>>
>>>> Use some standard debugging techniques yourself to try and work it  
>>>> out.
>>>>
>>>> On 26/01/2007, at 10:44 PM, export@hope.cz wrote:
>>>>
>>>>> Graham,
>>>>> Thank you for your reply.
>>>>> I have
>>>>>
>>>>> def inputfilter(filter):
>>>>> filter.req.myflag = True
>>>> Add:
>>>>
>>>>    filter.req.log_error('inputfilter')
>>>>
>>>>> ...
>>>>> ...
>>>>>
>>>>> so, as you can see the first command in input filter
>>>>> is filter.req.myflag = True
>>>>> but yet, I can not access the req.myflag
>>>>> in my request handler.
>>>>> When I try
>>>>> req.write(`req.myflag`)
>>>> Add before this:
>>>>
>>>>    req.log_error('handler')
>>>>
>>>> In other words, use the logging system to dump information into the
>>>> Apache
>>>> log files to see if the input filter is actually being called. It
>>>> would look like it
>>>> isn't. What have you done so far to confirm it is?
>>>>
>>>> Graham
>>>>
>>>>> I will receive the same error:
>>>>>
>>>>> AttributeError: 'mp_request' object has no attribute 'myflag'
>>>>>
>>>>> What shall I try to solve the problem. Do you have any idea?
>>>>> Thank you
>>>>> Lad
>>>>>
>>>>>> Your input filter can't have been called then, or not the part
>>>>>> where you
>>>>>> assigned the attribute. If the variable may not be there in all
>>>>>> situations,
>>>>>> then use:
>>>>>>
>>>>>> if hasattr(req, 'myflag'):
>>>>>> if req.myflag:
>>>>>> ..
>>>>>>
>>>>>> Graham
>>>>>>
>>>>>> On 26/01/2007, at 7:09 PM, export@hope.cz wrote:
>>>>>>
>>>>>>> Graham ,
>>>>>>> Thank you for your reply and help.
>>>>>>> I tried the way you suggested but I received the error
>>>>>>>
>>>>>>> AttributeError: 'mp_request' object has no attribute 'myflag'
>>>>>>>
>>>>>>> Can you please help?
>>>>>>> Thank you
>>>>>>> Lad.
>>>>>>>
>>>>>>>
>>>>>>>> On 26/01/2007, at 2:45 AM, export@hope.cz wrote:
>>>>>>>>
>>>>>>>>> Depending on a value being calculated in input filter,
>>>>>>>>> I will have to make a decission in request handler.
>>>>>>>>> What is a way to find out the value of the variable from input
>>>>>>>>> filter in request handler?
>>>>>>>> I believe this was mentioned before.
>>>>>>>>
>>>>>>>> In filter, set an attribute on the request object:
>>>>>>>>
>>>>>>>> def inputfilter(filter):
>>>>>>>> ...
>>>>>>>> filter.req.myflag = True
>>>>>>>> ...
>>>>>>>>
>>>>>>>> In the request handler, you can then access that variable.
>>>>>>>>
>>>>>>>> def handler(req):
>>>>>>>> ...
>>>>>>>> if req.myflag:
>>>>>>>> ...
>>>>>>>> ...
>>>>>>>>
>>>>>>>> Graham
>>>>>>
>>>>>
>>>>> ------- End of forwarded message -------
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 

From martijn at xs4us.nu  Sun Jan 28 08:50:18 2007
From: martijn at xs4us.nu (Martijn Moeling)
Date: Sun Jan 28 08:50:28 2007
Subject: [mod_python] 3.3 going gold?
Message-ID: <B6C73A5E30565245BB6D32B5F5DF7A521202DD@sense.emmastraat.pijnacker>

I argued for this some time ago.

3.3.0b is excellently stable in my setup as I went "live" with it on 1st
of January.

Next to that I must confirm the excellent support given by the guys. I
suggest we all keep reading the mailing list and help them out by
answering the newby questions for them. I am fixing up my work on a
whole load of short examples on various topics:

Use of MySQLdb
Sessions stored in MySQL
Uploading of pictures (or other binairy data) into Mysql.
Coverting pictures on the server with the PIP Image package
The use of XMLHttp request in conjunction with MP
Using MP to handle virtual hosts and paths within
Various methods of passing data between MP and the browser.

Etc.

Maybe we can put up a wish list and work that one out into the Wiki?

Martijn


-----Oorspronkelijk bericht-----
Van: mod_python-bounces@modpython.org
[mailto:mod_python-bounces@modpython.org] Namens Daniel Nogradi
Verzonden: Friday, January 26, 2007 2:05 PM
Aan: mod_python@modpython.org
Onderwerp: Re: [mod_python] 3.3 going gold?

> >> Thanks again for your help.  I've got two last questions:
> >>
> >> 1. when is 3.3 estimated to go gold?
> >
> > There hasn't been a single complaint about 3.3.0b since it was
released
> back
> > before Christmas. I don't know whether this is because no one is
using it,
> or
> > because it is working out to be so good. The only thing probably
stopping
> it
> > from being released as non beta is apathy on our part. ;-)
>
> Lest the group think their efforts are in vain, I'm using mod_python
> 3.3.0b every day with great success. I suggest you go ahead with the
> release.
>
> Thanks for mod_python!
>
> Ron

I also use it without problems and have to say that the package itself
as well as the support on this list is far above average.

Thanks very much!

Daniel
_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://mailman.modpython.org/mailman/listinfo/mod_python

From eric at bright-interactive.com  Sun Jan 28 14:42:13 2007
From: eric at bright-interactive.com (Eric Clack)
Date: Sun Jan 28 14:42:20 2007
Subject: [mod_python] Memory error
In-Reply-To: <45B5CB9E.6129.561D1A@export.hope.cz>
References: <45B52AFC.4226.17AE1733@export.hope.cz>
	<5c58e3ca0701221326j1da9758dr39b91e61d779329b@mail.gmail.com>
	<45B5CB9E.6129.561D1A@export.hope.cz>
Message-ID: <5c58e3ca0701281142h6db8e127yac618662f4bf96d1@mail.gmail.com>

I believe that Internet Explorer has FTP functionality built in, which
might help depending upon your user base. Try this search on google:
http://www.google.com/search?q=ie+ftp+upload
-Eric.

On 23/01/07, export@hope.cz <export@hope.cz> wrote:
>  Eric,
> Thank you for your reply.
> >
> > Perhaps you could upload these files via SFTP or FTP?
> >
> I was also thinking about SFTP and FTP but the problem is that users would have need
> SFTP or FTP client to be able to upload files via SFTP or FTP protocol.
> Or is there any other solution for users so that they will NOT have to install FTP/SFTP client
> first?
>
>
>


-- 
Eric Clack
eric@bright-interactive.com

Bright Interactive : Successfully delivering interactive websites and
business applications
http://www.bright-interactive.com/
0870 240 6520
From grahamd at dscpl.com.au  Sun Jan 28 16:37:11 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sun Jan 28 16:37:17 2007
Subject: [mod_python] 3.3 going gold?
Message-ID: <1170020230.4114@dscpl.user.openhosting.com>

Martijn Moeling wrote ..
> Next to that I must confirm the excellent support given by the guys. I
> suggest we all keep reading the mailing list and help them out by
> answering the newby questions for them.

You'll all get your chance come February as I'll be off on holidays for a
few weeks and will not have much chance to read email. ;-)

Graham
From export at hope.cz  Mon Jan 29 04:53:22 2007
From: export at hope.cz (export@hope.cz)
Date: Mon Jan 29 04:53:33 2007
Subject: [mod_python] How to pass values -solved
In-Reply-To: <BA234C2D-1ED6-4314-AA79-0DB126969375@dscpl.com.au>
References: <45BB22DF.6099.4DD0E11@export.hope.cz>
Message-ID: <45BDD222.554.85D732E@export.hope.cz>

 
Big thanks to Graham Dumpleton and Jim Gallacher .
Without their help I would not be able to solve the problem

Now it works on my testing XP.
I believe that the same  solution will also work on my Linux box.
Lad.

From john_nowlan at carleton.ca  Wed Jan 31 11:49:10 2007
From: john_nowlan at carleton.ca (John_Nowlan)
Date: Wed Jan 31 11:49:30 2007
Subject: [mod_python] wsgi support?
In-Reply-To: <1170020230.4114@dscpl.user.openhosting.com>
Message-ID: <6A5D305B0DE17541907AC0448C828A71012FB16F@CCSEXB10.CUNET.CARLETON.CA>

Are there plans to add wsgi support to mod_python?

Looking at the archives, it seems to be on the radar but I 'm wondering if there have been any developments, especially with wsgi part of python 2.5.

Cheers
From clodoaldo.pinto.neto at gmail.com  Wed Jan 31 12:10:59 2007
From: clodoaldo.pinto.neto at gmail.com (Clodoaldo)
Date: Wed Jan 31 12:11:07 2007
Subject: [mod_python] in modpython ,how to restrict the upload file size?
Message-ID: <a595de7a0701310910r17e3a4ceh441fcd36cc826a5c@mail.gmail.com>

Jorey Bump Wed Sep 20 08:18:40 EDT 2006
>yjfuk wrote:
>> in modpython ,how to restrict the upload file size?

>I prefer to do this in the apache config, so it applies to all applications:

># limit size of uploads
># 3MB
>LimitRequestBody 3072000

I'm using modpython 3.3 and publisher.

I'm trying to use the LimitRequestBody directive and it works to
prevent the uploding of big files.

The problem I'm having is that although an error is logged by Apache,
a 200 response is sent to the browser. It looks like my publisher
module is not called after Apache catches the file upload error or it
is called and somehow a 20 bytes body is sent with a 200 code. I can't
see those 20 bytes in the browser, the html source is blank.

I would like my publisher module to be called so I can handle the
error and send an appropriate page to the client. Is it possible with
the publisher?

[Wed Jan 31 15:59:47 2007] [error] [client 10.1.1.101] Requested
content-length of 1482946 is larger than the configured limit of
50000, referer: http://carroarodo.s0/upload_fotos

10.1.1.101 - - [31/Jan/2007:15:59:47 +0000] "POST /upload_fotos
HTTP/1.1" 200 20 "http://carroarodo.s0/upload_fotos" "Mozilla/5.0
(X11; U; Linux i686; en-US; rv:1.8.0.9) Gecko/20061221
Fedora/1.5.0.9-1.fc5 Firefox/1.5.0.9"

<VirtualHost 10.1.1.103:80>
    ServerName carroarodo.s0
    ServerAdmin admin@carroarodo.com
    DocumentRoot /var/www/html/carroarodo.com
    ErrorLog logs/carroarodo.s0-error_log
    CustomLog logs/carroarodo.s0-access_log combined
    LimitRequestBody 50000
    PythonDebug On
    <Directory /var/www/html/carroarodo.com>
       SetHandler mod_python
       PythonHandler ~/_publisher.py
       PythonOption mod_python.importer.path "['~/mod']"
    </Directory>
    <Directory /var/www/html/carroarodo.com/mod>
       Order Allow,Deny
       Deny from all
    </Directory>
    <Directory /var/www/html/carroarodo.com/pub/fotos>
       ExpiresActive On
       ExpiresDefault "access plus 0 hours"
    </Directory>
    Options -Indexes
    <Files ~ "\.(gif|jpg|png|css|js)$">
       SetHandler default-handler
    </Files>
</VirtualHost>

$ cat _publisher.py
from mod_python import publisher

def handler(req):
   req.add_output_filter('DEFLATE')
   return publisher.handler(req)

Regards,
-- 
Clodoaldo Pinto Neto
From export at hope.cz  Wed Jan 31 14:16:29 2007
From: export at hope.cz (export@hope.cz)
Date: Wed Jan 31 14:16:42 2007
Subject: [mod_python] How to set utf-8 charset from mod_python?
Message-ID: <45C0F91D.23846.14ADB94C@export.hope.cz>

How can set utf-8 charset using mod_python handler?

 I used in my handler


req.write('''	<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>")
..
..

but it does not work.
Thank you for help
L.


From nogradi at gmail.com  Wed Jan 31 15:28:09 2007
From: nogradi at gmail.com (Daniel Nogradi)
Date: Wed Jan 31 15:28:17 2007
Subject: [mod_python] How to set utf-8 charset from mod_python?
In-Reply-To: <45C0F91D.23846.14ADB94C@export.hope.cz>
References: <45C0F91D.23846.14ADB94C@export.hope.cz>
Message-ID: <5f56302b0701311228l48c89f94pa8ae337ed3a3bd44@mail.gmail.com>

> How can set utf-8 charset using mod_python handler?
>
>  I used in my handler
>
>
> req.write('''	<html>
>
> <head>
> <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
> </head>
> <body>")
> ..
> ..
>
> but it does not work.
> Thank you for help

What is exactly what is not working? How do you try to output utf-8
characters? Do you use utf-8 encoding for your strings?
From nogradi at gmail.com  Wed Jan 31 15:42:07 2007
From: nogradi at gmail.com (Daniel Nogradi)
Date: Wed Jan 31 15:42:16 2007
Subject: [mod_python] wsgi support?
In-Reply-To: <6A5D305B0DE17541907AC0448C828A71012FB16F@CCSEXB10.CUNET.CARLETON.CA>
References: <1170020230.4114@dscpl.user.openhosting.com>
	<6A5D305B0DE17541907AC0448C828A71012FB16F@CCSEXB10.CUNET.CARLETON.CA>
Message-ID: <5f56302b0701311242j73e08c70u7287e7b70487e3cf@mail.gmail.com>

> Are there plans to add wsgi support to mod_python?
>
> Looking at the archives, it seems to be on the radar but I 'm wondering if
> there have been any developments, especially with wsgi part of python 2.5.
>
> Cheers

I haven't used any of these but could of interest to you:

http://projects.amor.org/misc/wiki/ModPythonGateway
http://trac.gerf.org/pse/wiki/WSGIHandler
From grahamd at dscpl.com.au  Wed Jan 31 16:05:27 2007
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Jan 31 16:05:40 2007
Subject: [mod_python] wsgi support?
In-Reply-To: <6A5D305B0DE17541907AC0448C828A71012FB16F@CCSEXB10.CUNET.CARLETON.CA>
References: <6A5D305B0DE17541907AC0448C828A71012FB16F@CCSEXB10.CUNET.CARLETON.CA>
Message-ID: <ADBE4EEA-8E6F-41A9-87BF-A25CA6EF8EB9@dscpl.com.au>


On 01/02/2007, at 3:49 AM, John_Nowlan wrote:

> Are there plans to add wsgi support to mod_python?
>
> Looking at the archives, it seems to be on the radar but I 'm  
> wondering if
> there have been any developments, especially with wsgi part of  
> python 2.5.

At this point I would have to say that there is probably no good  
reason to do so.

This is in part because it isn't going to benefit people who are  
stuck with older
versions of mod_python, but also because the overhead of all the  
extra stuff in
mod_python for everything else mod_python does would just slow it down.

I am sure you are all saying, but it would be a great idea, well, I  
would say it
isn't when you have the following. ;-)

   http://www.dscpl.com.au/wiki/ModWsgi

The code for this has just gone out for testing to the first person  
to see it besides
myself. I'll actually be adding more documentation on the site today  
about how
it works, so check back some time over the next few days.

Graham
From martijn at xs4us.nu  Wed Jan 31 17:05:22 2007
From: martijn at xs4us.nu (Martijn Moeling)
Date: Wed Jan 31 17:05:33 2007
Subject: [mod_python] How to set utf-8 charset from mod_python?
Message-ID: <B6C73A5E30565245BB6D32B5F5DF7A521202E9@sense.emmastraat.pijnacker>

Like req.write(' <html>....').encode('utf-8')

Or

Def do_some_processing(Req):
	Req.return_html+="<!-- -->\n"

Handler(Req):
	Req.return_html=""
	Req.return_html+="<html>....\n"
      do_some_processing(Req)
	Req.write(Req.return_html).encode('utf-8')
	......


Martijn

-----Oorspronkelijk bericht-----
Van: mod_python-bounces@modpython.org
[mailto:mod_python-bounces@modpython.org] Namens Daniel Nogradi
Verzonden: Wednesday, January 31, 2007 21:28
Aan: mod_python@modpython.org
Onderwerp: Re: [mod_python] How to set utf-8 charset from mod_python?

> How can set utf-8 charset using mod_python handler?
>
>  I used in my handler
>
>
> req.write('''	<html>
>
> <head>
> <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
> </head>
> <body>")
> ..
> ..
>
> but it does not work.
> Thank you for help

What is exactly what is not working? How do you try to output utf-8
characters? Do you use utf-8 encoding for your strings?
_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://mailman.modpython.org/mailman/listinfo/mod_python

